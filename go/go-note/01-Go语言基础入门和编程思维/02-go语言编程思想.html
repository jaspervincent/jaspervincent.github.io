<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Go: Goè¯­è¨€ç¼–ç¨‹æ€æƒ³</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/font.css"/>
<link rel="stylesheet" type="text/css" href="/static/drollery.e825b870.css"/>
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
</head>
<body>
<header id="preamble" class="status">
<header class="{className}" data-astro-cid-3ef6ksr2>
  <div class=header-branding data-astro-cid-g2lrb5xm>
      <span class=header-text data-astro-cid-g2lrb5xm>
          <span class=dropcap data-astro-cid-g2lrb5xm aria-hidden=true>
              <span class=actual data-astro-cid-g2lrb5xm>J</span>
              <span class=rest data-astro-cid-g2lrb5xm>asper Hsu</span>
              <span class=period data-astro-cid-g2lrb5xm>.</span>
          </span>
          <span class=sr-only data-astro-cid-g2lrb5xm>Drollery</span>
      </span>
      <img alt="Medieval drollery of a knight on a horse" class=spring decoding=async height=250 loading=lazy src=/images/knight-horse.a96eee7d_Z1WCOYs.webp width=68 data-astro-cid-g2lrb5xm>
  </div>

  <nav data-astro-cid-pux6a34n>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/jcodelog.html class=nobracket data-astro-cid-pux6a34n>æŠ€æœ¯</a>
      <span class=flower2 data-astro-cid-pux6a34n>K</span>
      <a href=/reading/index.html class=nobracket data-astro-cid-pux6a34n>é˜…è¯»</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
      <a href=/lisp/jasper-emacs.html class=nobracket data-astro-cid-pux6a34n>æˆ‘çš„Emacsé…ç½®</a>
      <span class=flower2 data-astro-cid-pux6a34n>L</span>
      <a href=/link/index.html class=nobracket data-astro-cid-pux6a34n>å‹é“¾</a>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/about.html class=nobracket data-astro-cid-pux6a34n>å…³äº</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
  </nav>


  <div class="container" data-astro-cid-3ef6ksr2>
    <p class="info" data-astro-cid-3ef6ksr2>
              ğŸ† æ¬¢è¿æ¥åˆ°æœ¬ç«™ï¼š
              <a href="https://xuchangwei.com/">https://xuchangwei.com/</a>ã€‚
              <strong>å¸Œæœ›è¿™é‡Œæœ‰ä½ æ„Ÿå…´è¶£çš„å†…å®¹</strong>ã€‚
            </p>
  </div>
  <div id=borderArtWrapper class="tt1" data-astro-cid-5hce7sga data-turbo-permanent>
      <script>
          var man, shakeCount = 0, noSound = new Audio("/audio/effects/no.m4a"), screamSound = new Audio("/audio/effects/scream.m4a");
          function animateManShakeHandler() {
              man.removeEventListener("animationend", animateManShakeHandler, !1),
              shakeCount += 1,
              man.classList.remove("shakeMan")
          }
          function animateManFallHandler() {
              man.removeEventListener("animationend", animateManFallHandler, !1),
              man.classList.add("hide")
          }
          function animateMan() {
              man = man ?? document.getElementById("borderMan"),
              3 === shakeCount ? (man.classList.add("fallMan"),
              screamSound.play(),
              man.addEventListener("animationend", animateManFallHandler, !1)) : (man.classList.add("shakeMan"),
              noSound.play(),
              man.addEventListener("animationend", animateManShakeHandler, !1))
          }
      </script>
      <div class=borderArt data-astro-cid-5dda5nwp id=articleBorder>
          <img alt="flowery border with man falling" decoding=async height=620 loading=lazy src=/images/border-vines-no-man.b7d246cc_DRxSe.webp width=909 class=border data-astro-cid-5dda5nwp>
          <div class=fallWrapper data-astro-cid-5dda5nwp>
              <img alt="flowery border with man falling" decoding=async height=292 loading=lazy src=/images/man-no-vines.247a3187_Z2ioXNM.webp width=98 class=man data-astro-cid-5dda5nwp id=borderMan onclick=animateMan()>
          </div>
      </div>
  </div>
</header>
</header>
<main class="container" id="content" class="content">
<header>
<h1 class="title">Go: Goè¯­è¨€ç¼–ç¨‹æ€æƒ³</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orga87c8bc">æ¥å£ï¼Œæ¥å£çš„å€¼ç±»å‹</a>
<ul>
<li><a href="#org74b950a">æ¥å£çš„æ¦‚å¿µ</a></li>
<li><a href="#orgc33509e">duck typingçš„æ¦‚å¿µ</a>
<ul>
<li><a href="#org9a3d71c">pythonä¸­çš„duck typing</a></li>
<li><a href="#org0a80e30">c++ä¸­çš„duck typing</a></li>
<li><a href="#org2ffd021">javaä¸­çš„ç±»ä¼¼duck typingçš„ä»£ç </a></li>
<li><a href="#org7e24a13">goè¯­è¨€çš„duck typing</a></li>
</ul>
</li>
<li><a href="#org4cf0b26">æ¥å£çš„å®šä¹‰</a>
<ul>
<li><a href="#org32ab788">ä½¿ç”¨è€…(download)å’Œå®ç°è€…(retriever)</a></li>
<li><a href="#orgd292b17">æ¥å£çš„å®šä¹‰</a></li>
<li><a href="#orgc53f505">æ¥å£çš„å®ç°</a></li>
</ul>
</li>
<li><a href="#org1e959e6">æ¥å£çš„å€¼ç±»å‹</a>
<ul>
<li>
<ul>
<li><a href="#org6de3f4f">æ¥å£ç±»å‹çš„åˆ¤æ–­</a></li>
</ul>
</li>
<li><a href="#org7e82e02">æ¥å£å˜é‡é‡Œæœ‰ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="#org94afc86">æŸ¥çœ‹æ¥å£å˜é‡</a></li>
</ul>
</li>
<li><a href="#orgeaf8ad0">æ¥å£çš„ç»„åˆ</a></li>
<li><a href="#orgc61d84b">å¸¸ç”¨ç³»ç»Ÿçš„æ¥å£</a>
<ul>
<li><a href="#org85ef0cd">fmtåº“Stringeræ¥å£</a></li>
<li><a href="#org3f3c82e">ioåº“çš„Readeræ¥å£å’ŒWriteræ¥å£</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orge9ea1a2">å‡½æ•°å¼ç¼–ç¨‹</a>
<ul>
<li><a href="#org59830f1">å‡½æ•°å¼ç¼–ç¨‹</a>
<ul>
<li><a href="#orge83e5eb">å‡½æ•°å¼ç¼–ç¨‹ vs å‡½æ•°æŒ‡é’ˆ</a></li>
<li><a href="#org397fd3f">â€œæ­£ç»Ÿâ€å‡½æ•°å¼ç¼–ç¨‹</a></li>
<li><a href="#org0d14876">é—­åŒ…</a>
<ul>
<li><a href="#org640c605">pythonä¸­çš„é—­åŒ…</a></li>
<li><a href="#org34a782b">c++ ä¸­çš„é—­åŒ…</a></li>
<li><a href="#org3caeee0">java ä¸­çš„é—­åŒ…</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgce20571">goè¯­è¨€é—­åŒ…çš„åº”ç”¨</a>
<ul>
<li><a href="#org5af9a06">å‡½æ•°å¼ç¼–ç¨‹èŒƒä¾‹1 æ–æ³¢é‚£å¥‘æ•°åˆ—</a></li>
<li><a href="#orgbe9a1e8">å‡½æ•°å¼ç¼–ç¨‹èŒƒä¾‹2 ä¸ºå‡½æ•°å®ç°æ¥å£</a></li>
<li><a href="#org310fc58">å‡½æ•°å¼ç¼–ç¨‹èŒƒä¾‹3 ä½¿ç”¨å‡½æ•°æ¥éå†äºŒå‰æ ‘</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org3aa8b91">å‡ºé”™å¤„ç†ä¸defer/panic/recover</a>
<ul>
<li><a href="#org95fc1a3">deferè°ƒç”¨</a>
<ul>
<li><a href="#org24078f6">ä½•æ—¶ä½¿ç”¨deferè°ƒç”¨</a></li>
</ul>
</li>
<li><a href="#org852847e">é”™è¯¯å¤„ç†æ¦‚å¿µ</a></li>
<li><a href="#orgafd390e">æœåŠ¡å™¨ç»Ÿä¸€å‡ºé”™å¤„ç†1</a></li>
<li><a href="#orga349f70">æœåŠ¡å™¨ç»Ÿä¸€å‡ºé”™å¤„ç†2</a></li>
<li><a href="#org0ff64e8">error vs panic</a></li>
<li><a href="#org018cfe2">èŒƒä¾‹å°ç»“</a></li>
</ul>
</li>
<li><a href="#orgea8bf82">æµ‹è¯•ä¸æ€§èƒ½è°ƒä¼˜</a>
<ul>
<li><a href="#org758f377">æµ‹è¯•</a>
<ul>
<li><a href="#org179de01">ä¼ ç»Ÿæµ‹è¯• vs è¡¨æ ¼é©±åŠ¨æµ‹è¯•</a>
<ul>
<li><a href="#orge6b00bd">ä¼ ç»Ÿæµ‹è¯•</a></li>
<li><a href="#org54aadfb">è¡¨æ ¼é©±åŠ¨æµ‹è¯•</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org67fd7d7">è¡¨æ ¼é©±åŠ¨æµ‹è¯•</a></li>
<li><a href="#org994d207">ä»£ç è¦†ç›–ç‡å’Œæ€§èƒ½æµ‹è¯•</a>
<ul>
<li><a href="#orgca92d46">ä»£ç è¦†ç›–ç‡</a></li>
<li><a href="#org00e324d">æ€§èƒ½æµ‹è¯•</a></li>
</ul>
</li>
<li><a href="#org14604c2">ä½¿ç”¨pprofè¿›è¡Œæ€§èƒ½è°ƒä¼˜</a>
<ul>
<li><a href="#org2c6a83d">æ€§èƒ½è°ƒä¼˜æ¨¡å¼</a></li>
</ul>
</li>
<li><a href="#org4c6b70a">æµ‹è¯•httpæœåŠ¡å™¨</a>
<ul>
<li><a href="#org7fa0195">httpæµ‹è¯•å°ç»“</a></li>
</ul>
</li>
<li><a href="#orgd8fec09">ç”Ÿæˆæ–‡æ¡£å’Œç¤ºä¾‹ä»£ç </a>
<ul>
<li><a href="#orgd29ad01">`go doc` å’Œ `godoc` å‘½ä»¤</a></li>
<li><a href="#orgcae339f">ç”¨æ³¨é‡Šå†™æ–‡æ¡£</a></li>
<li><a href="#org60a1df6">ç”Ÿæˆç¤ºä¾‹ä»£ç </a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgfb924ab">goroutine</a>
<ul>
<li><a href="#org55df1d4">goroutine</a></li>
<li><a href="#orge1041e6">åç¨‹Coroutine</a></li>
<li><a href="#orgfdced21">goè¯­è¨€è°ƒåº¦å™¨</a>
<ul>
<li><a href="#orgbeb1970">æ™®é€šå‡½æ•° vs åç¨‹</a></li>
<li><a href="#org26ad43b">å…¶ä»–è¯­è¨€å¯¹åç¨‹çš„æ”¯æŒ</a></li>
<li><a href="#org3119a96">goè¯­è¨€ä¸­çš„åç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</a></li>
<li><a href="#org817725b">goroutineçš„å®šä¹‰</a></li>
<li><a href="#org156fb0b">goroutineå¯èƒ½åˆ‡æ¢çš„ç‚¹</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgdbbeaab">channel</a>
<ul>
<li><a href="#org6906160">channelè¯­æ³•</a>
<ul>
<li>
<ul>
<li><a href="#org9d9c8f9">channelä¹Ÿæ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œä¹Ÿèƒ½ä½œä¸ºå‚æ•°ã€ä½œä¸ºè¿”å›å€¼</a></li>
<li><a href="#org8896433">buffer channel</a></li>
<li><a href="#org0a8bbc9">channel close and range</a></li>
<li><a href="#orge280888">å°ç»“channelè¯­æ³•</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgeefbbf8">ä½¿ç”¨Channelç­‰å¾…ä»»åŠ¡ç»“æŸ</a>
<ul>
<li><a href="#org7aaa47e">ä½¿ç”¨WaitGroupç­‰å¾…å¤šäººå®Œæˆä»»åŠ¡</a></li>
</ul>
</li>
<li><a href="#org1c805d1">ä½¿ç”¨Channelè¿›è¡Œæ ‘çš„éå†</a></li>
<li><a href="#org0f95d98">ä½¿ç”¨Selectæ¥è¿›è¡Œè°ƒåº¦</a>
<ul>
<li><a href="#orgbeea46a">selectå°ç»“</a></li>
</ul>
</li>
<li><a href="#orgee07218">ä¼ ç»ŸåŒæ­¥æœºåˆ¶</a>
<ul>
<li><a href="#org31f394f">Mutexäº’æ–¥é‡çš„ä½¿ç”¨</a></li>
</ul>
</li>
<li><a href="#org8761074">å¹¶å‘æ¨¡å¼</a>
<ul>
<li><a href="#org5f03309">channelå¯ä»¥åšä¸€ä¸ªç”Ÿæˆå™¨</a></li>
<li><a href="#org5bffdc9">æœåŠ¡/ä»»åŠ¡</a></li>
<li><a href="#orgf7589e7">åŒæ—¶ç­‰å¾…å¤šä¸ªæœåŠ¡ï¼šä¸¤ç§æ–¹æ³•</a>
<ul>
<li><a href="#org7cf6a02">æ–¹æ³•1 ä¸ç¡®å®šæœ‰å‡ ä¸ªæœåŠ¡</a></li>
<li><a href="#orgfd0577c">æ–¹æ³•2ï¼šselect ç¡®å®šæœ‰å‡ ä¸ªæœåŠ¡</a></li>
</ul>
</li>
<li><a href="#org930a180">å¹¶å‘æ¨¡å¼å°ç»“</a></li>
</ul>
</li>
<li><a href="#org979c025">å¹¶å‘ä»»åŠ¡çš„æ§åˆ¶</a>
<ul>
<li><a href="#org84f0390">éé˜»å¡ç­‰å¾…</a></li>
<li><a href="#org266ef0f">è¶…æ—¶æœºåˆ¶</a></li>
<li><a href="#org2e081a0">ä»»åŠ¡ä¸­æ–­/é€€å‡º</a></li>
<li><a href="#org1707347">ä¼˜é›…é€€å‡º</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2d8a40e">è¿·å®«å®ç°</a>
<ul>
<li><a href="#org1fd0986">è¿·å®«ç®—æ³•-å¹¿åº¦ä¼˜å…ˆç®—æ³•</a></li>
<li><a href="#orgeba0fa2">è¿·å®«ä»£ç å®ç°</a>
<ul>
<li><a href="#org7c57a89">è¯»è¿›è¿·å®«æ–‡ä»¶</a></li>
<li><a href="#org5e65ec9">èµ°è¿·å®«</a></li>
<li><a href="#org175fa17">å¹¿åº¦ä¼˜å…ˆæ¢ç´¢èµ°è¿·å®«å°ç»“</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org9f53624">æ ‡å‡†åº“</a>
<ul>
<li><a href="#orgcd41bea">httpåº“</a>
<ul>
<li><a href="#org6d5eedd">ä½¿ç”¨httpå®¢æˆ·ç«¯å‘é€è¯·æ±‚</a></li>
<li><a href="#org4dd4d91">ä½¿ç”¨http.Clientæ§åˆ¶è¯·æ±‚å¤´éƒ¨ç­‰</a></li>
<li><a href="#orgdc0620d">ä½¿ç”¨httputilç®€åŒ–å·¥ä½œ</a></li>
<li><a href="#org5df599a">http æœåŠ¡å™¨æ€§èƒ½åˆ†æ</a></li>
</ul>
</li>
<li><a href="#org9de86df">jsonåº“</a>
<ul>
<li><a href="#orgb3b8e80">JSONçš„è§£æ</a>
<ul>
<li><a href="#org363111d">èŒƒä¾‹ï¼šè½¬JSONæ•°æ®æ ¼å¼`json.Marshal(o)`</a></li>
<li><a href="#orgc36b05a">jsonè§£æ</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org3468308">ç¬¬ä¸‰æ–¹APIæ•°æ®æ ¼å¼çš„è§£ææŠ€å·§</a></li>
<li><a href="#org2e9fe83">ginæ¡†æ¶</a>
<ul>
<li><a href="#orgc5718a9">`gin-gonic/gin`</a></li>
<li><a href="#org48f507f">middlewareçš„ä½¿ç”¨</a></li>
<li><a href="#org35e9fc5">contextçš„ä½¿ç”¨</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../../index.html">Golang</a></li>
</ul>

<p>
è¿›å…¥å·¥ç¨‹åŒ–é˜¶æ®µï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥è¦é¢å¯¹çš„ä¸ä»…ä»…æ˜¯ä»£ç ç‰‡æ®µï¼Œ
æˆ‘ä»¬è¦å­¦ä¹ åœ¨åšå·¥ç¨‹æ—¶ï¼Œåˆ©ç”¨goè¯­è¨€åšåˆ°æ¨¡å—åŒ–ï¼Œå¦‚ä½•è®©ç³»ç»Ÿå¯é…ç½®ï¼Œ
å¦‚ä½•æµ‹è¯•ï¼Œå¦‚ä½•ç”¨goè¯­è¨€è¿›è¡Œå¹¶å‘ã€‚
</p>

<p>
è®²è¿°å‡½æ•°å¼ç¼–ç¨‹ï¼Œæ¥å£ï¼Œgoroutine/channelåŠå…¶æ¨¡å¼
</p>
<section id="outline-container-orga87c8bc" class="outline-2">
<h2 id="orga87c8bc">æ¥å£ï¼Œæ¥å£çš„å€¼ç±»å‹</h2>
<div class="outline-text-2" id="text-orga87c8bc">
<p>
æœ¬èŠ‚ç†è§£çš„å†…å®¹
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">type</span> Traversal interface {
    Traverse()
}

func main() {
    traversal := getTraversal()
    traversal.Traverse()
}
</pre>
</div>
<p>
`getTraversal()`å®šä¹‰äº†æ¥å£çš„ä½¿ç”¨æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªæ¥å£ç±»å‹
</p>
</div>
<div id="outline-container-org74b950a" class="outline-3">
<h3 id="org74b950a">æ¥å£çš„æ¦‚å¿µ</h3>
<div class="outline-text-3" id="text-org74b950a">
<p>
å¤§å®¶èƒŒæ™¯
</p>
<ul class="org-ul">
<li>å¼ºç±»å‹è¯­è¨€ï¼šç†Ÿæ‚‰æ¥å£çš„æ¦‚å¿µ
å­¦è¿‡å¼ºç±»å‹è¯­è¨€çš„äººä¸€èˆ¬å¯¹æ¥å£æ¦‚å¿µæ¯”è¾ƒç†Ÿæ‚‰ã€‚java, c++ä¸­æ¥å£æ˜¯éå¸¸é‡è¦çš„æ¦‚å¿µ</li>
<li>å¼±ç±»å‹è¯­è¨€ï¼šæ²¡ï¼ˆå°‘ï¼‰æœ‰æ¥å£æ¦‚å¿µã€‚
php, python, jsä½¿ç”¨è€…å¯èƒ½æ²¡æœ‰å®é™…ç”¨åˆ°</li>
</ul>

<p>
æ¥å£çš„æ¦‚å¿µå¦‚æœåªæœ‰æ–‡å­—æè¿°ï¼Œæ²¡æœ‰å®ä¾‹è®²è§£æ˜¯éå¸¸éš¾ç†è§£çš„ã€‚
</p>

<p>
ä¸€ä¸ªæ®µå­ï¼š
</p>
<ul class="org-ul">
<li>å°å­©æ‰åˆ†å¯¹é”™
å‰é¢å‡ ç« åŸºç¡€éƒ¨åˆ†å±äºå°å­¦ç”Ÿçš„æ¦‚å¿µ</li>
<li>å¤§äººåªçœ‹åˆ©å¼Š</li>
</ul>

<p>
èŒƒä¾‹ï¼šä¸‹è½½ç½‘é¡µï¼ˆå‡½æ•°ï¼‰
downloader.goæ–‡ä»¶
</p>
<div class="org-src-container">
<pre class="src src-sh">package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"fmt"</span>
    <span style="color: #8b2252;">"io/ioutil"</span>
    <span style="color: #8b2252;">"net/http"</span>
)

func main() {
    resp, err := http.Get(<span style="color: #8b2252;">"http://www.imooc.com"</span>)
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }

    defer resp.Body.Close()

    bytes, _ := ioutil.ReadAll(resp.Body)
    fmt.Printf(<span style="color: #8b2252;">"%s\n"</span>, bytes)
}
</pre>
</div>

<p>
æå–åŠŸèƒ½ï¼šretrieveå‡½æ•°è´Ÿè´£åŠŸèƒ½å®ç°ï¼Œmainå‡½æ•°è°ƒç”¨retrieveå‡½æ•°è´Ÿè´£è¾“å‡ºç»“æœ
</p>
<div class="org-src-container">
<pre class="src src-sh">package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"fmt"</span>
    <span style="color: #8b2252;">"io/ioutil"</span>
    <span style="color: #8b2252;">"net/http"</span>
)

func retrieve(url string) string {
    resp, err := http.Get(url)
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }

    defer resp.Body.Close()

    bytes, _ := ioutil.ReadAll(resp.Body)
    <span style="color: #a020f0;">return</span> string(bytes)
}

func main() {
    fmt.Println(retrieve(<span style="color: #8b2252;">"http://www.imooc.com"</span>))
}
</pre>
</div>

<p>
èŒƒä¾‹ï¼šå›¢é˜Ÿåä½œï¼Œä¸‹è½½ç½‘é¡µï¼ˆæ¥å£å¼•å…¥ï¼‰
ç›®å½•ç»“æ„ï¼Œä½å¶åˆ
</p>
<div class="org-src-container">
<pre class="src src-sh">D:.
&#9474;  downloader.go   // main&#20989;&#25968;&#65292;&#20351;&#29992;&#25509;&#21475;
&#9474;  go.mod
&#9474;
&#9500;&#9472;infra      //infra&#21253;&#65292;&#22522;&#30784;&#26550;&#26500;&#22242;&#38431;&#65292;&#36127;&#36131;&#32593;&#32476;&#35831;&#27714;&#12289;&#30913;&#30424;&#35835;&#20889;&#12289;&#25968;&#25454;&#24211;&#31561;
&#9474;       urlretriever.go  // &#25509;&#21475;&#26041;&#27861;&#30340;&#23454;&#29616;
&#9492;&#9472;testing    //testing&#21253;&#65292;&#27979;&#35797;&#22242;&#38431;
        retriever.go     // &#25509;&#21475;&#26041;&#27861;&#30340;&#23454;&#29616;

<span style="color: #b22222;">#</span><span style="color: #b22222;">infra/urlretriever.go &#25991;&#20214;&#20195;&#30721;</span>
package infra

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"io/ioutil"</span>
    <span style="color: #8b2252;">"net/http"</span>
)

<span style="color: #483d8b;">type</span> Retriever struct{}

// &#23450;&#20041;&#26041;&#27861;
<span style="color: #0000ff;">func</span> (Retriever) Get(url string) string { // &#25509;&#25910;&#32773;(Retriever)&#37324;&#20160;&#20040;&#20063;&#27809;&#26377;&#65292;&#36825;&#37324;&#19981;&#38656;&#35201;&#23450;&#20041;&#21517;&#23383;&#65292;&#20063;&#29992;&#19981;&#21040;
    resp, err := http.Get(url)
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }

    defer resp.Body.Close()

    bytes, _ := ioutil.ReadAll(resp.Body)
    <span style="color: #a020f0;">return</span> string(bytes)
}

<span style="color: #b22222;">#</span><span style="color: #b22222;">testing/retriever.go &#25991;&#20214;&#20195;&#30721;</span>
package testing

<span style="color: #483d8b;">type</span> Retriever struct {}

<span style="color: #0000ff;">func</span> (Retriever) Get(url string) string {
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"fake content"</span> // &#36820;&#22238;&#20551;&#25968;&#25454;
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">downloader.go &#25991;&#20214;&#20195;&#30721;</span>
package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"fmt"</span>
    <span style="color: #8b2252;">"learngo/testing"</span>
)

// &#28436;&#21464;1
// &#25226;retriever&#32465;&#23450;&#21040; infra.Retriever&#19978;&#65292;&#30475;&#19978;&#21435;&#26356;&#20687;&#26159;&#37197;&#32622;&#36824;&#19981;&#20687;&#36923;&#36753;&#65292;&#36825;&#37324;&#25226;&#23427;&#25552;&#20986;&#26469;&#20889;&#19968;&#20010;&#20989;&#25968;
// func main() {
//  retriever := infra.Retriever{}
//  fmt.Println(retriever.Get(<span style="color: #8b2252;">"http://www.imooc.com"</span>))
// }

// &#28436;&#21464;2
// retriever&#36923;&#36753;&#21270; var retriever infra.Retriever = getRetriever()
// &#32570;&#28857; retriever &#19968;&#23450;&#26159; infra.Retriever &#31867;&#22411;
// func getRetriever() infra.Retriever {
//  return infra.Retriever{}
// }

// func main() {
//  var retriever infra.Retriever = getRetriever()
//  fmt.Println(retriever.Get(<span style="color: #8b2252;">"http://www.imooc.com"</span>))
// }

// &#28436;&#21464;3
// &#25442;&#19968;&#20010;retriever&#65292;&#20351;&#29992;&#27979;&#35797;&#22242;&#38431;&#30340;&#26041;&#27861;
// &#35201;&#22312;&#21407;&#26469;&#22522;&#30784;&#19978;&#25913;&#24456;&#22810;&#22320;&#26041;
// func getRetriever() testing.Retriever {
//  return testing.Retriever{}
// }

// func main() {
//  var retriever testing.Retriever = getRetriever()
//  fmt.Println(retriever.Get(<span style="color: #8b2252;">"http://www.imooc.com"</span>))
// }

// &#28436;&#21464;4 &#25509;&#21475;&#24341;&#20837;
// go&#35821;&#35328;&#26159;&#24378;&#31867;&#22411;&#30340;
// &#38656;&#35201;&#20195;&#30721;&#21644;&#36923;&#36753;&#19968;&#33268;
// var retriever &#65311; = getRetriever() &#20854;&#20013;&#65311;&#26159;&#19968;&#20010;&#19996;&#35199;&#65292;&#21487;&#20197;Get(string)&#30340;&#19996;&#35199;
// &#36825;&#20010;&#65311;&#38382;&#21495;&#24590;&#20040;&#25551;&#36848;&#65292;&#36825;&#23601;&#26159;&#25105;&#20204;&#30340;&#25509;&#21475;
func getRetriever() retriever {
    <span style="color: #a020f0;">return</span> testing.Retriever{} // &#27979;&#35797;&#22242;&#38431;&#20195;&#30721;&#36890;&#36807;&#65292;&#21487;&#25442;&#25104;&#27491;&#24335;&#20195;&#30721; return infra.Retriever{}
}

// ?Something that can <span style="color: #8b2252;">"Get"</span>
<span style="color: #483d8b;">type</span> retriever interface { // &#36825;&#20010;&#25509;&#21475;&#21487;&#20197;Get
    Get(string) string
}
func main() {
    var r retriever = getRetriever() // &#36825;&#20010;&#19996;&#35199;&#26159;&#20160;&#20040;&#65311;&#26159;getRetriever()
    fmt.Println(r.Get(<span style="color: #8b2252;">"http://www.imooc.com"</span>))
}
</pre>
</div>

<p>
æ¥å£æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œæ²¡æœ‰å…·ä½“å¹²ä»€ä¹ˆï¼Œåªè¦é‡Œé¢æœ‰è°ƒç”¨çš„æ–¹æ³•å°±å¯ä»¥
</p>
</div>
</div>
<div id="outline-container-orgc33509e" class="outline-3">
<h3 id="orgc33509e">duck typingçš„æ¦‚å¿µ</h3>
<div class="outline-text-3" id="text-orgc33509e">
<p>
å¤§é»„é¸­æ˜¯é¸­å­å—ï¼Ÿ
</p>
<ul class="org-ul">
<li>ä¼ ç»Ÿç±»å‹ç³»ç»Ÿï¼šè„Šç´¢åŠ¨ç‰©é—¨ï¼Œè„Šæ¤åŠ¨ç‰©äºšé—¨ï¼Œé¸Ÿçº²é›å½¢ç›®</li>
<li>duck typingï¼šæ˜¯é¸­å­
<ul class="org-ul">
<li>â€œåƒé¸­å­èµ°è·¯ï¼Œåƒé¸­å­å«ï¼ˆé•¿å¾—åƒé¸­å­ï¼‰ï¼Œé‚£ä¹ˆå°±æ˜¯é¸­å­â€ &#x2013;åŸè¯</li>
<li>æè¿°äº‹ç‰©çš„å¤–éƒ¨è¡Œä¸ºè€Œéå†…éƒ¨ç»“æ„</li>
<li>ä¸¥æ ¼è¯´goè¯­è¨€å±äºç»“æ„åŒ–ç±»å‹ç³»ç»Ÿï¼Œç±»ä¼¼duck typing
<ul class="org-ul">
<li>duck typingä¸­è¯´ä¸€å®šè¦åŠ¨æ€ç»‘å®šï¼Œä½†goè¯­è¨€æ˜¯ç¼–è¯‘å°±ç»‘å®šçš„</li>
</ul></li>
</ul></li>
</ul>

<p>
å…¶å®ƒè¯­è¨€ä¸­çš„duck typing
</p>
</div>
<div id="outline-container-org9a3d71c" class="outline-4">
<h4 id="org9a3d71c">pythonä¸­çš„duck typing</h4>
<div class="outline-text-4" id="text-org9a3d71c">
<div class="org-src-container">
<pre class="src src-sh">def download(retriever):
   <span style="color: #a020f0;">return</span> retriver.get(<span style="color: #8b2252;">"xx.com"</span>)
</pre>
</div>
<p>
retriveræ˜¯ç”¨æ¥è·å–èµ„æºçš„ï¼Œretriverå°±æ˜¯duck typingä¸­çš„å¯¹è±¡ï¼Œdownloadæ˜¯ä½¿ç”¨è€…ä½¿ç”¨äº†
duck typing
</p>

<ul class="org-ul">
<li>è¿è¡Œæ—¶æ‰çŸ¥é“ä¼ å…¥çš„retrieveræœ‰æ²¡æœ‰get</li>
<li>éœ€è¦æ³¨é‡Šæ¥è¯´æ˜æ¥å£</li>
</ul>
</div>
</div>
<div id="outline-container-org0a80e30" class="outline-4">
<h4 id="org0a80e30">c++ä¸­çš„duck typing</h4>
<div class="outline-text-4" id="text-org0a80e30">
<div class="org-src-container">
<pre class="src src-sh">template &lt;class R&gt;
string dowload(const R&amp; retriever) {
    <span style="color: #a020f0;">return</span> retriever.get(<span style="color: #8b2252;">"xx.com"</span>);
}
</pre>
</div>
<p>
é€šè¿‡templateæ¥æ”¯æŒduck typing
</p>
<ul class="org-ul">
<li>ç¼–è¯‘æ—¶æ‰çŸ¥é“ä¼ å…¥çš„retrieveræœ‰æ²¡æœ‰get
<ul class="org-ul">
<li>æ‰“ä»£ç æ—¶ä¸çŸ¥é“</li>
</ul></li>
<li>éœ€è¦æ³¨é‡Šæ¥è¯´æ˜æ¥å£</li>
</ul>
</div>
</div>
<div id="outline-container-org2ffd021" class="outline-4">
<h4 id="org2ffd021">javaä¸­çš„ç±»ä¼¼duck typingçš„ä»£ç </h4>
<div class="outline-text-4" id="text-org2ffd021">
<div class="org-src-container">
<pre class="src src-sh">&lt;R extends Retriever&gt;
String dowload(R r) {
    <span style="color: #a020f0;">return</span> r.get(<span style="color: #8b2252;">"xx.com"</span>);
}
</pre>
</div>
<ul class="org-ul">
<li>ä¼ å…¥çš„å‚æ•°å¿…é¡»å®ç°Retrieveræ¥å£
<ul class="org-ul">
<li>æ²¡æœ‰è¿è¡Œæ—¶ã€ç¼–è¯‘æ—¶é”™è¯¯</li>
</ul></li>
<li>ä¸æ˜¯duck typing
<ul class="org-ul">
<li>å› ä¸ºå¿…é¡»å®ç°Retrieveræ¥å£</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org7e24a13" class="outline-4">
<h4 id="org7e24a13">goè¯­è¨€çš„duck typing</h4>
<div class="outline-text-4" id="text-org7e24a13">
<ul class="org-ul">
<li>javaåŒæ—¶éœ€è¦Readable, Appendableæ€ä¹ˆåŠï¼Ÿ(appche polygence)</li>
<li>åŒæ—¶å…·æœ‰python, c++çš„duck typingçš„çµæ´»æ€§
<ul class="org-ul">
<li>ä»€ä¹ˆç±»å‹éƒ½å¯ä»¥ä¼ ï¼Œåªè¦å®ç°äº†getçš„æ–¹æ³•å°±è¡Œ</li>
</ul></li>
<li>åˆå…·æœ‰javaçš„ç±»å‹æ£€æŸ¥
<ul class="org-ul">
<li>ä¸æƒ³é€šè¿‡æ³¨é‡Šæ¥è¯´æ˜éœ€è¦ä»€ä¹ˆç±»å‹</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org4cf0b26" class="outline-3">
<h3 id="org4cf0b26">æ¥å£çš„å®šä¹‰</h3>
<div class="outline-text-3" id="text-org4cf0b26">
<p>
è®²è¿°æ¥å£å®šä¹‰å‰å…ˆç†è§£ä¸Šé¢ä»£ç èŒƒä¾‹ä¸­downloadå’Œretrieverè§’è‰²æ˜¯ä»€ä¹ˆ
</p>
</div>
<div id="outline-container-org32ab788" class="outline-4">
<h4 id="org32ab788">ä½¿ç”¨è€…(download)å’Œå®ç°è€…(retriever)</h4>
<div class="outline-text-4" id="text-org32ab788">
<ul class="org-ul">
<li>goè¯­è¨€çš„æ¥å£æ˜¯*ä½¿ç”¨è€…*æ¥å®šä¹‰çš„</li>
</ul>

<p>
èŒƒä¾‹ï¼šä½¿ç”¨è€…å®šä¹‰æ¥å£å’Œå®ç°è€…å®ç°
å®šä¹‰æ¥å£
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;retriever/main.go &#25991;&#20214;</span>
package main

import <span style="color: #8b2252;">"fmt"</span>

<span style="color: #483d8b;">type</span> Retriever interface { // &#23450;&#20041;&#25509;&#21475;Retriever&#65292;&#37324;&#38754;&#26377;&#20010;Get&#26041;&#27861;
    Get(url string) string
}

func download(r Retriever) string { // &#20351;&#29992;&#32773;&#65292;&#23450;&#20041;&#20989;&#25968;download&#65292;&#20351;&#29992;&#25509;&#21475;r&#30340;Get&#26041;&#27861;
    <span style="color: #a020f0;">return</span> r.Get(<span style="color: #8b2252;">"http://www.imooc.com"</span>)
}

func main() {
    var r Retriever // r&#36824;&#19981;&#30693;&#36947;&#26159;&#20160;&#20040;&#65292;&#36816;&#34892;&#20250;&#20986;&#38169;&#30340;
    fmt.Println(download(r))
}
</pre>
</div>
<p>
æ¥ä¸‹æ¥æˆ‘ä»¬å°±å®ç°`Retriever interface`
å®ç°æ¥å£ï¼šmockretrieverï¼Œå®ç°äº†æ¥å£ä¸­çš„æ–¹æ³•å°±è¯æ˜å®ç°äº†æ¥å£
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314; retriever/mock/mockretriever.go&#25991;&#20214;</span>
package mock

<span style="color: #483d8b;">type</span> Retriever struct {
    Contents string  // &#20869;&#23481;
}

<span style="color: #0000ff;">func</span> (r Retriever) Get(url string) string { // &#23454;&#29616;&#25509;&#21475;&#30340;&#26041;&#27861;
    <span style="color: #a020f0;">return</span> r.Contents
                                          }

<span style="color: #b22222;"># </span><span style="color: #b22222;">retriever/main.go&#25991;&#20214;&#20013;</span>
func main() {
        var r Retriever
        r = mock.Retriever{<span style="color: #8b2252;">"this is a fake imooc.com"</span>} // &#24341;&#29992;&#23454;&#29616;&#25509;&#21475;&#30340;&#23454;&#20363;
        fmt.Println(download(r))
}
&#25110;&#32773;
func main() {
    fmt.Println(download(
        mock.Retriever{
            <span style="color: #8b2252;">"this is a fake imooc.com"</span>}))
}
</pre>
</div>

<p>
å®ç°æ¥å£ï¼šçœŸå®çš„retriver
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#23454;&#29616;&#30340;retriever</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314; retriever/real/retriever.go&#25991;&#20214;</span>
package real

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"net/http"</span>
    <span style="color: #8b2252;">"net/http/httputil"</span>
    <span style="color: #8b2252;">"time"</span>
)

<span style="color: #483d8b;">type</span> Retriever struct {
    UserAgent string
    TimeOut   time.Duration
}

<span style="color: #0000ff;">func</span> (r Retriever) Get(url string) string {
    resp, err := http.Get(url)
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }

    result, err := httputil.DumpResponse(resp, true)

    resp.Body.Close() // &#35835;&#23436;body&#20449;&#24687;&#35201;&#20851;&#38381;body&#12290;http.Get&#65306; Caller should close resp.Body when done reading from it.

    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }

    <span style="color: #a020f0;">return</span> string(result)
}

<span style="color: #b22222;">#  </span><span style="color: #b22222;">retriever/main.go&#25991;&#20214;&#20869;&#23481;</span>
package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"fmt"</span>
    <span style="color: #8b2252;">"learngo/retriever/mock"</span>
    <span style="color: #8b2252;">"learngo/retriever/real"</span>
)

<span style="color: #483d8b;">type</span> Retriever interface { // &#23450;&#20041;&#25509;&#21475;Retriever&#65292;&#37324;&#38754;&#26377;&#20010;Get&#26041;&#27861;
    Get(url string) string
}

func download(r Retriever) string { // &#20351;&#29992;&#32773;&#65292;&#23450;&#20041;&#20989;&#25968;download&#65292;&#20351;&#29992;&#25509;&#21475;r&#30340;Get&#26041;&#27861;
    <span style="color: #a020f0;">return</span> r.Get(<span style="color: #8b2252;">"http://www.imooc.com"</span>)
}

func main() {
    var r Retriever
    r = mock.Retriever{<span style="color: #8b2252;">"this is a fake imooc.com"</span>}
    r = real.Retriever{}
    fmt.Println(download(r))
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd292b17" class="outline-4">
<h4 id="orgd292b17">æ¥å£çš„å®šä¹‰</h4>
<div class="outline-text-4" id="text-orgd292b17">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">type</span> Retriever interface {
    Get(<span style="color: #483d8b;">source</span> string) string
}

func download(retriever Retriever) string {
    retrun retriever.Get(<span style="color: #8b2252;">"http://www.imooc.com"</span>)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc53f505" class="outline-4">
<h4 id="orgc53f505">æ¥å£çš„å®ç°</h4>
<div class="outline-text-4" id="text-orgc53f505">
<ul class="org-ul">
<li>æ¥å£çš„å®ç°æ˜¯éšå¼çš„
<ul class="org-ul">
<li>ä¸éœ€è¦è¯´æ˜å®ƒå®ç°äº†å“ªä¸ªæ¥å£</li>
</ul></li>
<li>åªè¦å®ç°æ¥å£é‡Œçš„æ–¹æ³•</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org1e959e6" class="outline-3">
<h3 id="org1e959e6">æ¥å£çš„å€¼ç±»å‹</h3>
<div class="outline-text-3" id="text-org1e959e6">
<p>
æ¥å£é‡Œæœ‰ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿ
</p>

<p>
èŒƒä¾‹ï¼š
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#  </span><span style="color: #b22222;">retriever/main.go&#25991;&#20214;</span>
func main() {
    var r Retriever
    r = mock.Retriever{<span style="color: #8b2252;">"this is a fake imooc.com"</span>}
    fmt.Printf(<span style="color: #8b2252;">"%T %v\n"</span>, r, r) // &#26597;&#30475;r&#30340;&#31867;&#22411; mock.Retriever {this is a fake imooc.com}

    r = real.Retriever{
        UserAgent: <span style="color: #8b2252;">"Mozilla/5.0"</span>,
        TimeOut: time.Minute,
    }
    fmt.Printf(<span style="color: #8b2252;">"%T %v\n"</span>, r, r) // real.Retriever {Mozilla/5.0 1m0s}

    //fmt.Println(download(r))
}


<span style="color: #b22222;"># </span><span style="color: #b22222;">real&#20013;Retriever&#23450;&#20041;&#25104;&#25351;&#38024;&#31867;&#22411;&#65292;&#36890;&#36807;&#25351;&#38024;&#35775;&#38382;Get</span>
<span style="color: #b22222;">#  </span><span style="color: #b22222;">retriever/real/retriever.go&#25991;&#20214;</span>
<span style="color: #483d8b;">type</span> Retriever struct {
    UserAgent string
    TimeOut   time.Duration
}

<span style="color: #0000ff;">func</span> (r *Retriever) Get(url string) string {

<span style="color: #b22222;">#  </span><span style="color: #b22222;">retriever/main.go&#25991;&#20214;</span>
func main() {
    var r Retriever
    r = mock.Retriever{<span style="color: #8b2252;">"this is a fake imooc.com"</span>}
    fmt.Printf(<span style="color: #8b2252;">"%T %v\n"</span>, r, r) // &#26597;&#30475;r&#30340;&#31867;&#22411; mock.Retriever {this is a fake imooc.com}

    r = &amp;real.Retriever{             //Retriever&#20013;Get&#26159;&#25351;&#38024;&#25509;&#25910;&#32773;
        UserAgent: <span style="color: #8b2252;">"Mozilla/5.0"</span>,
        TimeOut: time.Minute,

    }
    fmt.Printf(<span style="color: #8b2252;">"%T %v\n"</span>, r, r) // &#31867;&#22411;&#25351;&#38024;*real.Retriever &#20540;&#20063;&#26159;&#25351;&#38024;&amp;{Mozilla/5.0 1m0s}

    //fmt.Println(download(r))
}
</pre>
</div>
<p>
è¯´æ˜ interface é‡Œæœ‰2ä¸ªä¸œè¥¿ï¼šç±»å‹å’Œå€¼
</p>
<ul class="org-ul">
<li>å€¼å¯ä»¥æ˜¯çœŸå®å€¼ä¹Ÿå¯ä»¥æ˜¯æŒ‡é’ˆã€‚</li>
</ul>
<p>
å¦‚æœæ˜¯çœŸå®çš„å€¼å®ƒæ˜¯æ‹·è´çš„ï¼Œæ‹·è´åˆ°rçš„è‚šå­é‡Œã€‚
æ¥å£å‡ ä¹ä¸ä¼šç”¨åˆ°æ¥å£çš„æŒ‡é’ˆï¼Œå› ä¸ºæ¥å£è‚šå­é‡Œé€šå¸¸ä¼šå«æœ‰ä¸€ä¸ªæŒ‡é’ˆã€‚
</p>
</div>
<div id="outline-container-org6de3f4f" class="outline-5">
<h5 id="org6de3f4f">æ¥å£ç±»å‹çš„åˆ¤æ–­</h5>
<div class="outline-text-5" id="text-org6de3f4f">
<p>
å–æ¥å£ç±»å‹2ç§æ–¹æ³•
é€šè¿‡switchåˆ¤æ–­ï¼Œæˆ–è€…é€šè¿‡type assertionåˆ¤æ–­
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">retriever/main.go&#25991;&#20214;</span>

func main() {
    var r Retriever
    r = mock.Retriever{<span style="color: #8b2252;">"this is a fake imooc.com"</span>}
    inspect(r) // &#26597;&#30475;r&#30340;&#31867;&#22411; mock.Retriever {this is a fake imooc.com}
               // Contents: this is a fake imooc.com

    r = &amp;real.Retriever{
        UserAgent: <span style="color: #8b2252;">"Mozilla/5.0"</span>,
        TimeOut: time.Minute,
    }
    // &#21462;&#25509;&#21475;&#31867;&#22411;&#65292;&#26041;&#27861;1&#65306;switch
    inspect(r)  // *real.Retriever &amp;{Mozilla/5.0 1m0s}
               // UserAgent: Mozilla/5.0
    // &#21462;&#25509;&#21475;&#31867;&#22411;&#65292;&#26041;&#27861;2&#65306;Type assertition
    realRetriever := r.(*real.Retriever)
    fmt.Println(realRetriever.TimeOut)

    <span style="color: #a020f0;">if</span> mockRetriever, ok := r.(mock.Retriever); ok { // &#26356;&#20005;&#35880;&#30340;&#20889;&#27861;
        fmt.Println(mockRetriever.Contents)
    } <span style="color: #a020f0;">else</span> {
        fmt.Println(<span style="color: #8b2252;">"not a mock retriever"</span>)
    }

    //fmt.Println(download(r))
}

func inspect(r Retriever) {
    fmt.Printf(<span style="color: #8b2252;">"%T %v\n"</span>, r, r)
    switch v := r.(<span style="color: #483d8b;">type</span>) {  // &#24324;&#28165;&#26970;r&#30340;&#31867;&#22411;&#26159;&#20160;&#20040;
    <span style="color: #a020f0;">case</span> mock.Retriever:
        fmt.Println(<span style="color: #8b2252;">"Contents:"</span>, v.Contents)
    <span style="color: #a020f0;">case</span> *real.Retriever:
        fmt.Println(<span style="color: #8b2252;">"UserAgent:"</span>, v.UserAgent)
    }
}

</pre>
</div>
</div>
</div>
<div id="outline-container-org7e82e02" class="outline-4">
<h4 id="org7e82e02">æ¥å£å˜é‡é‡Œæœ‰ä»€ä¹ˆï¼Ÿ</h4>
<div class="outline-text-4" id="text-org7e82e02">
<p>
æ¥å£å˜é‡é‡Œæœ‰
</p>
<ul class="org-ul">
<li>å®ç°è€…çš„ç±»å‹</li>
<li>å®ç°è€…çš„å€¼</li>
</ul>

<p>
æˆ–è€…
æ¥å£å˜é‡é‡Œæœ‰
</p>
<ul class="org-ul">
<li>å®ç°è€…çš„ç±»å‹</li>
<li>å®ç°è€…çš„æŒ‡é’ˆ
<ul class="org-ul">
<li>æŒ‡å‘å®ç°è€…</li>
</ul></li>
</ul>

<p>
æ€»ç»“ï¼š
</p>
<ul class="org-ul">
<li>æ¥å£å˜é‡è‡ªå¸¦æŒ‡é’ˆ
æœ‰æ—¶å€™å¸¦æŒ‡é’ˆï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å¸¦å€¼ï¼Œé€šå¸¸æ¥è¯´è‡ªå·±å¸¦æŒ‡é’ˆçš„ã€‚</li>
<li>æ¥å£å˜é‡åŒæ ·é‡‡ç”¨å€¼ä¼ é€’ï¼Œå‡ ä¹ä¸éœ€è¦ä½¿ç”¨æ¥å£çš„æŒ‡é’ˆã€‚
<ul class="org-ul">
<li>å› ä¸ºæ¥å£å˜é‡è‚šå­é‡Œæœ‰ä¸€ä¸ªæŒ‡é’ˆ</li>
</ul></li>
<li>æŒ‡é’ˆæ¥æ”¶è€…å®ç°åªèƒ½ç”¨æŒ‡é’ˆæ–¹å¼ä½¿ç”¨ï¼›å€¼æ¥æ”¶è€…éƒ½å¯</li>
</ul>
</div>
</div>
<div id="outline-container-org94afc86" class="outline-4">
<h4 id="org94afc86">æŸ¥çœ‹æ¥å£å˜é‡</h4>
<div class="outline-text-4" id="text-org94afc86">
<ul class="org-ul">
<li>è¡¨ç¤ºä»»ä½•ç±»å‹ï¼š`interface{}`</li>
<li>Type Assertion</li>
<li>Type switch</li>
</ul>

<p>
èŒƒä¾‹ï¼š`interface{}`ä»£è¡¨ä»»ä½•ç±»å‹
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">type</span> Queue []interface{}

<span style="color: #0000ff;">func</span> (q *Queue) Push(v int) {
    *q = append(*q, v)
}

<span style="color: #0000ff;">func</span> (q *Queue) Pop() int {
    head := (*q)[0]
    *q = (*q)[1:]
    <span style="color: #a020f0;">return</span> head.(int) // &#24378;&#21046;&#36716;&#25442;&#25104;int&#31867;&#22411;
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgeaf8ad0" class="outline-3">
<h3 id="orgeaf8ad0">æ¥å£çš„ç»„åˆ</h3>
<div class="outline-text-3" id="text-orgeaf8ad0">
<p>
ç›¸å¯¹ä½¿ç”¨è€…æ¥è¯´çš„
</p>

<p>
æ¯”å¦‚ï¼š
æ ‡å‡†åº“ï¼šioåº“
</p>
<div class="org-src-container">
<pre class="src src-sh">// ReadCloser is the interface that groups the basic Read and Close methods.
<span style="color: #483d8b;">type</span> ReadCloser interface {
    Reader
    Closer
}

// WriteCloser is the interface that groups the basic Write and Close methods.
<span style="color: #483d8b;">type</span> WriteCloser interface {
    Writer
    Closer
}

// ReadWriteCloser is the interface that groups the basic Read, Write and Close methods.
<span style="color: #483d8b;">type</span> ReadWriteCloser interface {
    Reader
    Writer
    Closer
}
</pre>
</div>

<p>
èŒƒä¾‹ï¼šæ¥å£ç»„åˆ
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">retriever/main.go</span>
package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"fmt"</span>
    <span style="color: #8b2252;">"learngo/retriever/mock"</span>
)

<span style="color: #483d8b;">type</span> Retriever interface { // &#23450;&#20041;&#25509;&#21475;Retriever&#65292;&#37324;&#38754;&#26377;&#20010;Get&#26041;&#27861;
    Get(url string) string
}

<span style="color: #483d8b;">type</span> Poster interface {
    Post(url string,
        form map[string]string) string
}

const url = <span style="color: #8b2252;">"http://www.imooc.com"</span>
func download(r Retriever) string { // &#20351;&#29992;&#32773;&#65292;&#23450;&#20041;&#20989;&#25968;download&#65292;&#20351;&#29992;&#25509;&#21475;r&#30340;Get&#26041;&#27861;
    <span style="color: #a020f0;">return</span> r.Get(url)
}

func post(poster Poster) {
    poster.Post(url,
     map[string]string {
        <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"xxx"</span>,
        <span style="color: #8b2252;">"course"</span>: <span style="color: #8b2252;">"golang"</span>,
     })
}

// &#25509;&#21475;&#32452;&#21512;   &#32452;&#21512; Retriever&#21644;Poster&#25509;&#21475;
<span style="color: #483d8b;">type</span> RetrieverPoster interface {
    Retriever
    Poster
}
func session(s RetrieverPoster) string {
    s.Post(url, map[string]string {
        <span style="color: #8b2252;">"contents"</span>: <span style="color: #8b2252;">"another faked imooc.com"</span>,
    })
    <span style="color: #a020f0;">return</span>  s.Get(url)
}

func main() {
    retriever := mock.Retriever{<span style="color: #8b2252;">"this is a fake imooc.com"</span>}

    fmt.Println(<span style="color: #8b2252;">"Try a session"</span>)
    fmt.Println(session(&amp;retriever))
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#23454;&#29616;&#32773;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">retriever/mock/mockretriever.go</span>
package mock

<span style="color: #483d8b;">type</span> Retriever struct {
    Contents string  // &#20869;&#23481;
}

<span style="color: #0000ff;">func</span> (r *Retriever) Get(url string) string { // &#23454;&#29616;&#25509;&#21475;&#30340;&#26041;&#27861;
    <span style="color: #a020f0;">return</span> r.Contents
}

<span style="color: #0000ff;">func</span> (r *Retriever) Post(url string,
    form map[string]string) string {
        r.Contents = form[<span style="color: #8b2252;">"contents"</span>]
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"ok"</span>
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc61d84b" class="outline-3">
<h3 id="orgc61d84b">å¸¸ç”¨ç³»ç»Ÿçš„æ¥å£</h3>
<div class="outline-text-3" id="text-orgc61d84b">
</div>
<div id="outline-container-org85ef0cd" class="outline-4">
<h4 id="org85ef0cd">fmtåº“Stringeræ¥å£</h4>
<div class="outline-text-4" id="text-org85ef0cd">
<p>
å¯ä»¥æ ¼å¼åŒ–è¾“å‡º
<a href="https://pkg.go.dev/fmt#Stringer">https://pkg.go.dev/fmt#Stringer</a>
åªè¦å®ç°äº†Stringæ–¹æ³•å°±å¯ä»¥
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">type</span> Stringer interface {
    String() string
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org3f3c82e" class="outline-4">
<h4 id="org3f3c82e">ioåº“çš„Readeræ¥å£å’ŒWriteræ¥å£</h4>
<div class="outline-text-4" id="text-org3f3c82e">
<p>
<a href="https://pkg.go.dev/io#Reader">https://pkg.go.dev/io#Reader</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">type</span> Reader interface {
        Read(p []byte) (n int, err error) // &#30456;&#24403;&#19968;&#20010;&#25991;&#20214;&#65292;&#23454;&#29616;reader&#30340;&#20154;&#26159;&#19968;&#20010;&#25991;&#20214;&#65292;&#23427;&#21487;&#20197;Read&#12290;&#20174;&#25991;&#20214;&#37324;&#35835;&#36827;&#19996;&#35199;&#32473;byte
}

<span style="color: #483d8b;">type</span> Writer interface {
        Write(p []byte) (n int, err error) // &#30456;&#24403;&#19968;&#20010;&#25991;&#20214;&#65292;&#25552;&#20379;&#32473;&#20320;&#36825;&#20123;byte&#30340;&#25968;&#25454;&#25226;&#25991;&#20214;&#20889;&#36827;&#21435;
}
//&#19981;&#21482;&#26159;&#25991;&#20214;&#65292;&#32593;&#32476;&#12289;string&#65292;&#20854;&#23427;&#30340;&#19968;&#20123;&#37117;&#21487;&#20197;&#29992;
</pre>
</div>
<p>
`os.Open`å‡½æ•°è¿”å›Fileç»“æ„ï¼ŒFileç»“æ„å°±æœ‰å¯¹Readæ¥å£çš„å®ç°
`fmt.Fprintf`å‡½æ•°ä¸­å‚æ•°`io.Writer`
`fmt.Fscanf`å‡½æ•°ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯`io.Reader`
</p>

<p>
æ‰€ä»¥æŠŠåº•å±‚è¯»å†™ç›¸å…³çš„ä¸œè¥¿åšæˆReaderæˆ–è€…Writerå°±å¯ä»¥å†™è®¸å¤šç³»ç»Ÿå‡½æ•°å…±ç”¨ï¼Œå°¤å…¶æ˜¯printf, scanfã€‚
</p>

<p>
èŒƒä¾‹ï¼šå‡½æ•°å‚æ•°å¤šç”¨æ¥å£ï¼Œå¦‚io.Readeræ¥å£åˆ©ç”¨
</p>
<div class="org-src-container">
<pre class="src src-sh">package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"bufio"</span>
    <span style="color: #8b2252;">"bytes"</span>
    <span style="color: #8b2252;">"fmt"</span>
    <span style="color: #8b2252;">"io"</span>
    <span style="color: #8b2252;">"os"</span>
    <span style="color: #8b2252;">"strings"</span>
)

func printFile(filename string) {
    file, err := os.Open(filename)
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }

    PrintFileContents(file) // &#25226;&#23454;&#29616;&#37117;&#23454;&#20363;&#32465;&#23450;&#21040;io.Reader&#25509;&#21475;
}

func PrintFileContents(<span style="color: #483d8b;">read</span> io.Reader) { // &#21033;&#29992;io.Reader&#65292;&#21487;&#35835;&#25991;&#20214;&#65292;&#23383;&#31526;&#20018;&#31561;
    scanner := bufio.NewScanner(<span style="color: #483d8b;">read</span>)

    <span style="color: #a020f0;">for</span> scanner.Scan() {
        fmt.Println(scanner.Text())
    }
}

func main() {
    printFile(<span style="color: #8b2252;">"loop/abc.txt"</span>)
    s := <span style="color: #ff00ff;">`abc"d"</span>
<span style="color: #ff00ff;">    kkk</span>
<span style="color: #ff00ff;">    123</span>

<span style="color: #ff00ff;">    p`</span>
    PrintFileContents(strings.NewReader(s))
    PrintFileContents(bytes.NewReader([]byte(s)))
}
</pre>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-orge9ea1a2" class="outline-2">
<h2 id="orge9ea1a2">å‡½æ•°å¼ç¼–ç¨‹</h2>
<div class="outline-text-2" id="text-orge9ea1a2">
</div>
<div id="outline-container-org59830f1" class="outline-3">
<h3 id="org59830f1">å‡½æ•°å¼ç¼–ç¨‹</h3>
<div class="outline-text-3" id="text-org59830f1">
<p>
å‡½æ•°å¼ç¼–ç¨‹ä¸æ˜¯goè¯­è¨€ç‰¹æœ‰çš„
goè¯­è¨€å¯¹å‡½æ•°å¼ç¼–ç¨‹çš„æ”¯æŒä¸»è¦ä½“ç°åœ¨é—­åŒ…ä¸Šé¢
</p>

<div class="org-src-container">
<pre class="src src-sh">func adder() func (value int) int {
    sum := 0
    <span style="color: #a020f0;">return</span> func(value int) int {
        sum += value
        <span style="color: #a020f0;">return</span> sum
    }
}

func main() {
    adder := adder()
    <span style="color: #a020f0;">for</span> i := 0; i &lt; 100; i++ {
            fmt.Println(adder(i))
    }
}
</pre>
</div>
<p>
adderè¿”å›ä¸€ä¸ªç´¯åŠ å€¼
</p>

<p>
æ¥çœ‹çœ‹å‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µ
</p>
</div>
<div id="outline-container-orge83e5eb" class="outline-4">
<h4 id="orge83e5eb">å‡½æ•°å¼ç¼–ç¨‹ vs å‡½æ•°æŒ‡é’ˆ</h4>
<div class="outline-text-4" id="text-orge83e5eb">
<p>
æœ€å¤§çš„åŒºåˆ«
</p>
<ul class="org-ul">
<li>å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼šå‚æ•°ï¼Œå˜é‡ï¼Œè¿”å›å€¼éƒ½å¯ä»¥æ˜¯å‡½æ•°
<ul class="org-ul">
<li>c++ä¸­åªæœ‰å‡½æ•°æŒ‡é’ˆï¼Œjavaä¸­æ²¡æœ‰åŠæ³•æŠŠå‡½æ•°ä¼ ç»™åˆ«äºº</li>
</ul></li>
<li>é«˜é˜¶å‡½æ•°
<ul class="org-ul">
<li>å‡½æ•°çš„å‚æ•°å¯ä»¥æ˜¯å‡½æ•°</li>
</ul></li>
<li>å‡½æ•° &#x2013;&gt; é—­åŒ…
<ul class="org-ul">
<li>é‡ç‚¹</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org397fd3f" class="outline-4">
<h4 id="org397fd3f">â€œæ­£ç»Ÿâ€å‡½æ•°å¼ç¼–ç¨‹</h4>
<div class="outline-text-4" id="text-org397fd3f">
<ul class="org-ul">
<li>ä¸å¯å˜æ€§ï¼šä¸èƒ½æœ‰çŠ¶æ€ï¼Œåªæœ‰å¸¸é‡å’Œå‡½æ•°</li>
<li>å‡½æ•°åªèƒ½æœ‰ä¸€ä¸ªå‚æ•°</li>
</ul>
<p>
å†™å‡ºçš„ç¨‹åºä¸ä¸€å®šæ›´å¥½ã€‚
</p>

<p>
èŒƒä¾‹ï¼šç”¨goè¯­è¨€å†™â€œæ­£ç»Ÿâ€å‡½æ•°å¼ç¼–ç¨‹
åˆ›å»ºç›®å½•functional/adderï¼Œåœ¨adderç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶adder.goæ–‡ä»¶
</p>
<div class="org-src-container">
<pre class="src src-sh">package main

import <span style="color: #8b2252;">"fmt"</span>

func adder() func(int) int { // &#32047;&#21152;&#22120;
    sum := 0                     // sum&#20026;&#33258;&#30001;&#21464;&#37327;&#65292; &#19981;&#26159;&#20989;&#25968;&#20307;func(value init) int&#37324;&#38754;&#23450;&#20041;&#30340;&#65292;&#26159;&#22806;&#38754;&#30340;
    <span style="color: #a020f0;">return</span> func(value int) int { // value&#20026;&#23616;&#37096;&#21464;&#37327; &#12290;&#36825;&#20010;&#20989;&#25968;&#36820;&#22238;&#20102;&#19968;&#20010;&#38381;&#21253;func(value int) int&#20869;&#25972;&#20307;
        sum += value
        <span style="color: #a020f0;">return</span> sum
    }
}

// &#8220;&#27491;&#32479;&#8221;&#20989;&#25968;&#24335;&#32534;&#31243;
// &#21482;&#26377;&#24120;&#37327;&#21644;&#20989;&#25968;
// &#19981;&#33021;&#26377;&#29366;&#24577;sum&#12290;&#36825;&#37324;&#25226;&#29366;&#24577;&#25918;&#22312;&#19968;&#20010;&#26032;&#30340;&#20989;&#25968;&#20013;
<span style="color: #483d8b;">type</span> iAdder func(int) (int, iAdder) // &#36820;&#22238;&#24403;&#21069;&#21152;&#23436;&#30340;&#20540;&#21644;&#19979;&#19968;&#20010;&#20540;&#12290;&#36825;&#26159;&#19968;&#20010;&#36882;&#24402;&#30340;&#23450;&#20041;

func adder2(base int) iAdder {
    <span style="color: #a020f0;">return</span> func(v int) (int, iAdder) {
        <span style="color: #a020f0;">return</span> base + v, adder2(base + v)
    }
}

func main() {
    a := adder()
    <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ {
        fmt.Printf(<span style="color: #8b2252;">"0 + 1 ... %d = %d\n"</span>,
            i, a(i)) // a()&#20989;&#25968;&#37324;&#23384;&#20102;&#21464;&#37327;sum&#65292;&#25152;&#20197;&#20250;&#19981;&#26029;&#32047;&#21152;
    }

    a1 := adder2(0)
    <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ {
        var s int
        s, a1 = a1(i)
        fmt.Printf(<span style="color: #8b2252;">"0 + 1 ... %d = %d\n"</span>,
            i, s) // a()&#20989;&#25968;&#37324;&#23384;&#20102;&#21464;&#37327;sum&#65292;&#25152;&#20197;&#20250;&#19981;&#26029;&#32047;&#21152;
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org0d14876" class="outline-4">
<h4 id="org0d14876">é—­åŒ…</h4>
<div class="outline-text-4" id="text-org0d14876">
<ul class="org-ul">
<li><p>
å‡½æ•°ä½“å†…æœ‰å±€éƒ¨å˜é‡å’Œè‡ªç”±å˜é‡
</p>
<ul class="org-ul">
<li>è‡ªç”±å˜é‡ï¼šç¼–è¯‘å™¨è¿½è¸ªï¼Œä¸æ–­æ‰¾è¿æ¥å…³ç³»ï¼Œç›´åˆ°æ‰€æœ‰è¿æ¥çš„å˜é‡éƒ½è¿æ¥åˆ°</li>
<li>è¿åˆ°æ‰€æœ‰å˜é‡åï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ•´ä½“å«é—­åŒ…ã€‚è¿™ä¸ªå‡½æ•°è¿”å›äº†ä¸€ä¸ªé—­åŒ…</li>
</ul>

<p>
å…¶å®ƒè¯­è¨€å¯¹é—­åŒ…çš„æ”¯æŒ
</p></li>
</ul>
</div>
<div id="outline-container-org640c605" class="outline-5">
<h5 id="org640c605">pythonä¸­çš„é—­åŒ…</h5>
<div class="outline-text-5" id="text-org640c605">
<div class="org-src-container">
<pre class="src src-sh">def adder()
    sum = 0

    def f(value):
        nonlocal sum
        sum += value
        <span style="color: #a020f0;">return</span> sum

    <span style="color: #a020f0;">return</span> f
</pre>
</div>
<ul class="org-ul">
<li>pythonåŸç”Ÿæ”¯æŒé—­åŒ…</li>
<li>ä½¿ç”¨`__closure__`æ¥æŸ¥çœ‹é—­åŒ…å†…å®¹</li>
</ul>
</div>
</div>
<div id="outline-container-org34a782b" class="outline-5">
<h5 id="org34a782b">c++ ä¸­çš„é—­åŒ…</h5>
<div class="outline-text-5" id="text-org34a782b">
<p>
æ–°c++14çš„è¯­æ³•
</p>
<div class="org-src-container">
<pre class="src src-sh">auto adder() {
    auto sum = 0;
    <span style="color: #a020f0;">return</span> [=] (int value) mutable {
        sum += value;
        <span style="color: #a020f0;">return</span> sum;
    };
}
</pre>
</div>
<ul class="org-ul">
<li>è¿‡å»ï¼šstlæˆ–è€…boostå¸¦æœ‰ç±»ä¼¼åº“</li>
<li>c++11åŠä»¥åï¼šæ”¯æŒé—­åŒ…</li>
</ul>
</div>
</div>
<div id="outline-container-org3caeee0" class="outline-5">
<h5 id="org3caeee0">java ä¸­çš„é—­åŒ…</h5>
<div class="outline-text-5" id="text-org3caeee0">
<div class="org-src-container">
<pre class="src src-sh">Function &lt;Integer, Intege&gt; adder() {
    final Holder&lt;Integer&gt; sum = new Holder&lt;&gt;(0);
    <span style="color: #a020f0;">return</span> (Integer value) -&gt; {
        sum.value += value;
        <span style="color: #a020f0;">return</span> sum.value;
    };
}
</pre>
</div>
<ul class="org-ul">
<li>1.8ä»¥åï¼šä½¿ç”¨Functionæ¥å£å’ŒLambdaè¡¨è¾¾å¼æ¥åˆ›å»ºå‡½æ•°å¯¹è±¡</li>
<li>åŒ¿åç±»æˆ–Lambdaè¡¨è¾¾å¼å‡æ”¯æŒé—­åŒ…</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-orgce20571" class="outline-3">
<h3 id="orgce20571">goè¯­è¨€é—­åŒ…çš„åº”ç”¨</h3>
<div class="outline-text-3" id="text-orgce20571">
</div>
<div id="outline-container-org5af9a06" class="outline-4">
<h4 id="org5af9a06">å‡½æ•°å¼ç¼–ç¨‹èŒƒä¾‹1 æ–æ³¢é‚£å¥‘æ•°åˆ—</h4>
<div class="outline-text-4" id="text-org5af9a06">
<div class="org-src-container">
<pre class="src src-sh">package main

import <span style="color: #8b2252;">"fmt"</span>

// 1, 1, 2, 3, 5, 8, 13 ...
// &#29983;&#25104;&#22120;&#29983;&#25104;&#26000;&#27874;&#37027;&#22865;&#25968;&#21015;&#65292;&#36820;&#22238;&#19968;&#20010;&#26080;&#21442;&#25968;&#30340;&#20989;&#25968;
func fibonacci() func() int {
    a, b := 0, 1  // &#35760;&#24405;&#21069;2&#20010;&#25968;
    <span style="color: #a020f0;">return</span> func() int {
        a, b = b, a + b
        <span style="color: #a020f0;">return</span> a
    }
}

func main() {
    f := fibonacci()  //&#27599;&#20010;&#25968;&#37117;&#26159;&#21069;2&#20010;&#25968;&#30340;&#21644;
    fmt.Println(f()) // 1
    fmt.Println(f()) // 1
    fmt.Println(f()) // 2
    fmt.Println(f()) // 3
    fmt.Println(f())
    fmt.Println(f())
    fmt.Println(f())
    fmt.Println(f())
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbe9a1e8" class="outline-4">
<h4 id="orgbe9a1e8">å‡½æ•°å¼ç¼–ç¨‹èŒƒä¾‹2 ä¸ºå‡½æ•°å®ç°æ¥å£</h4>
<div class="outline-text-4" id="text-orgbe9a1e8">
<p>
æˆ‘ä»¬å‘ç°æ–æ³¢é‚£å¥‘ç”Ÿæˆçš„fåƒä¸€ä¸ªç”Ÿæˆå™¨ä¸€æ ·ï¼Œæ¯æ¬¡è‡ªåŠ¨è°ƒç”¨få°±ä¼šç”Ÿæˆä¸‹ä¸€ä¸ªæ–æ³¢æ•°ï¼Œè¿™ä¸ªä¸œè¥¿è·Ÿæ–‡ä»¶æœ‰ç‚¹åƒ
æˆ‘ä»¬ä½¿ç”¨`io.Reader`æ¥å£åŒ…è£…ä¸€ä¸‹ï¼ŒæŠŠå®ƒå½“æˆæ–‡ä»¶ä¸€æ ·è¯»
</p>
<div class="org-src-container">
<pre class="src src-sh">package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"bufio"</span>
    <span style="color: #8b2252;">"fmt"</span>
    <span style="color: #8b2252;">"io"</span>
    <span style="color: #8b2252;">"strings"</span>
)


func fibonacci() intGen {
    a, b := 0, 1
    <span style="color: #a020f0;">return</span> func() int {
        a, b = b, a + b
        <span style="color: #a020f0;">return</span> a
    }
}

<span style="color: #483d8b;">type</span> intGen func() int

// &#23454;&#29616;io.Reader&#25509;&#21475;
<span style="color: #0000ff;">func</span> (g intGen) Read(p []byte) (n int, err error) { // intGen&#20989;&#25968;&#20063;&#33021;&#23454;&#29616;&#25509;&#21475;&#65292;&#22240;&#20026;&#20989;&#25968;&#26159;&#19968;&#31561;&#20844;&#27665;&#65292;&#21487;&#24403;&#20989;&#25968;&#21442;&#25968;&#65292;&#25509;&#25910;&#32773;&#23601;&#26159;&#20989;&#25968;&#29305;&#27530;&#30340;&#21442;&#25968;&#32780;&#24050;
    next := g() // &#21462;&#24471;&#19979;&#19968;&#20010;&#20803;&#32032;

    // &#38480;&#21046;&#36755;&#20986;&#20010;&#25968;
    <span style="color: #a020f0;">if</span> next &gt; 10000 {
        <span style="color: #a020f0;">return</span> 0, io.EOF
    }

    // &#23558;&#19979;&#19968;&#20010;&#20803;&#32032;&#20889;&#36827; p []byte&#20013;&#65292;&#36820;&#22238;&#23450;&#20889;&#20102;&#20960;&#20010;&#23383;&#33410;&#21644;&#20986;&#20102;&#20160;&#20040;&#38169;&#35823;
    // &#23454;&#29616;&#27604;&#36739;&#24213;&#23618;&#65292;&#29992;&#20854;&#23427;&#24211;&#20195;&#29702;&#19968;&#19979;&#12290;
    s := fmt.Sprintf(<span style="color: #8b2252;">"%d "</span>, next) // &#25968;&#23383;&#25442;&#25104;&#23383;&#31526;&#20018;&#65292;&#23558; s &#20889;&#36827; p []byte&#20013;
    <span style="color: #a020f0;">return</span> strings.NewReader(s).Read(p)
    // TODO&#65306;incorrect if p is too small!
}


func printFileContents(reader io.Reader) { // &#21407;&#26412;&#29992;&#22788;&#26159;&#25171;&#21360;&#25991;&#20214;&#65292;fibonacci&#23454;&#29616;reader&#25509;&#21475;&#20063;&#33021;&#25171;&#21360;
    scanner := bufio.NewScanner(reader)

    <span style="color: #a020f0;">for</span> scanner.Scan() {
        fmt.Println(scanner.Text())
    }
}

func main() {
    f := fibonacci()  //&#27599;&#20010;&#25968;&#37117;&#26159;&#21069;2&#20010;&#25968;&#30340;&#21644;
    printFileContents(f)
}
</pre>
</div>
<p>
ç¨‹åºä¼˜åŒ–ï¼š`p []byte`å¦‚æœç»™çš„æ¯”è¾ƒå°ä¸€ä¸ªæ•´æ•°è£…ä¸ä¸‹ï¼Œåªèƒ½ç¼“å­˜çŠ¶æ€äº†ã€‚
</p>
</div>
</div>
<div id="outline-container-org310fc58" class="outline-4">
<h4 id="org310fc58">å‡½æ•°å¼ç¼–ç¨‹èŒƒä¾‹3 ä½¿ç”¨å‡½æ•°æ¥éå†äºŒå‰æ ‘</h4>
<div class="outline-text-4" id="text-org310fc58">
<div class="org-src-container">
<pre class="src src-sh">&#9492;&#9472;tree  // tree&#21253;
    &#9474;  node.go     // &#32467;&#26500;&#26041;&#27861;
    &#9474;  traversal.go // &#36941;&#21382;&#26641;&#26041;&#27861;
    &#9474;
    &#9492;&#9472;treentry // main&#21253;
            entry.go
</pre>
</div>
<p>
node.goä»£ç 
</p>
<div class="org-src-container">
<pre class="src src-sh">package tree

import <span style="color: #8b2252;">"fmt"</span>

<span style="color: #483d8b;">type</span> Node struct {
    Value       int
    Left, Right *Node
}

// &#23450;&#20041;&#32467;&#26500;&#30340;&#26041;&#27861;
<span style="color: #0000ff;">func</span> (node Node) Print() { //&#20540;&#20256;&#36882; &#22312;&#20989;&#25968;&#21069;&#38754;&#28155;&#21152;&#20102;(node Node)&#25509;&#25910;&#32773;&#65292;&#21644;print(node Node)&#30456;&#24403;
    fmt.Print(node.Value, <span style="color: #8b2252;">" "</span>)
}

<span style="color: #0000ff;">func</span> (node *Node) SetValue(Value int) { // &#24341;&#29992;&#20256;&#36882;
    <span style="color: #a020f0;">if</span> node == nil {
        fmt.Println(<span style="color: #8b2252;">"Setting Value to nil node. Ignored."</span>)
        <span style="color: #a020f0;">return</span> // &#22914;&#26524;node&#26159;nil&#25351;&#38024;&#65292;&#25343;&#20869;&#37096;&#20540;&#26159;&#25343;&#19981;&#21040;&#30340;&#65292;&#20250;&#25253;&#38169;&#65292;&#25152;&#20197;&#35201;return&#36820;&#22238;
    }
    node.Value = Value
}

func CreatNode(Value int) *Node {
    <span style="color: #a020f0;">return</span> &amp;Node{Value: Value}
}
</pre>
</div>
<p>
traversal.goä»£ç ï¼Œå¢åŠ éå†åŠŸèƒ½
</p>
<div class="org-src-container">
<pre class="src src-sh">package tree

import <span style="color: #8b2252;">"fmt"</span>

<span style="color: #0000ff;">func</span> (node *Node) Traverse() {
        node.TraverseFunc(func(n *Node) {
                n.Print()
        })
        fmt.Println()
}

// &#36941;&#21382;&#26102;&#19981;&#19968;&#23450;&#26159;&#35201;&#25171;&#21360;&#65292;&#21487;&#33021;&#26159;&#20854;&#23427;&#20107;
<span style="color: #0000ff;">func</span> (node *Node) TraverseFunc(f func(*Node)) {
        <span style="color: #a020f0;">if</span> node == nil {
                <span style="color: #a020f0;">return</span>
        }

        node.Left.TraverseFunc(f)
        f(node)
        node.Right.TraverseFunc(f)
}
</pre>
</div>
<p>
entry.goä»£ç 
</p>
<div class="org-src-container">
<pre class="src src-sh">package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"fmt"</span>
    <span style="color: #8b2252;">"learngo/tree"</span>
)

<span style="color: #483d8b;">type</span> myTreeNode struct {
    node *tree.Node
}

// &#23450;&#20041;&#19968;&#20010;&#21518;&#32493;&#36941;&#21382;&#30340;&#20989;&#25968;
<span style="color: #0000ff;">func</span> (myNode *myTreeNode) postOrder() {
    <span style="color: #a020f0;">if</span> myNode == nil || myNode.node == nil {
        <span style="color: #a020f0;">return</span>
    }

    left := myTreeNode{myNode.node.Left}
    right := myTreeNode{myNode.node.Right}

    left.postOrder()
    right.postOrder()
    myNode.node.Print()
}

func main() {
    // &#32467;&#26500;&#20307;&#30340;&#21019;&#24314;
    var root tree.Node //{0 &lt;nil&gt; &lt;nil&gt;}

    root = tree.Node{Value: 3}
    root.Left = &amp;tree.Node{}
    root.Right = &amp;tree.Node{5, nil, nil}
    root.Right.Left = new(tree.Node)    // root.right&#21518;&#20063;&#21487;&#20197;&#29992;<span style="color: #8b2252;">"."</span>&#28857;&#21495;&#65292;
    root.Left.Right = tree.CreatNode(2) // &#21033;&#29992;&#33258;&#23450;&#20041;&#24037;&#21378;&#20989;&#25968;&#26500;&#36896;&#32467;&#26500;
    // &#32467;&#26500;&#26041;&#27861;&#30340;&#20351;&#29992;
    root.Print()                // 3 &#20854;&#20013;print&#26159;&#20010;&#20989;&#25968;&#65292;&#23427;&#19981;&#26159;&#26080;&#21442;&#30340;&#65292;&#23427;&#26377;&#20010;&#25509;&#25910;&#32773;root
    fmt.Println()
    root.Right.Left.SetValue(4) // setValue&#20989;&#25968;&#20250;&#25226;&#25509;&#25910;&#32773;root.right.left&#30340;&#22320;&#22336;&#20570;&#21442;&#25968;&#20256;&#36882;&#36807;&#21435;

    root.Traverse()
    fmt.Println()
    myRoot := myTreeNode{&amp;root}
    myRoot.postOrder()

    // &#25968;&#19968;&#25968;&#26377;&#20960;&#20010;&#33410;&#28857;
    nodeCount := 0
    root.TraverseFunc(func(n *tree.Node) {
        nodeCount++
    })
    fmt.Println(<span style="color: #8b2252;">"Node count:"</span>, nodeCount)
}
</pre>
</div>

<ul class="org-ul">
<li>èŒƒä¾‹1 æ–æ³¢é‚£å¥‘æ•°åˆ—
å±•ç¤ºgoè¯­è¨€çš„é—­åŒ…</li>
<li>èŒƒä¾‹2 ä¸ºå‡½æ•°å®ç°æ¥å£
å±•ç¤ºå‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œä¸ä»…å¯ä»¥åšä¸ºå‚æ•°ã€å˜é‡ã€è¿”å›å€¼ï¼Œè¿˜å¯ä»¥åšä¸ºå®ç°æ¥å£ï¼Œ
å› ä¸ºgoè¯­è¨€ä¸­çš„ç»“æ„æ–¹æ³•æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°è€Œå·²
ä¸º æ–æ³¢é‚£å¥‘æ•°åˆ— å®ç°äº†ä¸€ä¸ªReaderæ¥å£</li>
<li>èŒƒä¾‹3 ä½¿ç”¨å‡½æ•°æ¥éå†äºŒå‰æ ‘
æŠŠä¸­é—´çš„æ‰“å°æ¢æˆäº†å‡½æ•°ï¼Œå®ç°å¤šç§ç”¨é€”çš„éå†</li>
</ul>

<p>
æ€»ç»“ï¼šgoè¯­è¨€é—­åŒ…çš„åº”ç”¨
</p>
<ul class="org-ul">
<li>æ›´ä¸ºè‡ªç„¶ï¼Œä¸éœ€è¦ä¿®é¥°å¦‚ä½•è®¿é—®è‡ªç”±å˜é‡</li>
<li>æ²¡æœ‰Lambdaè¡¨è¾¾å¼ï¼Œä½†æ˜¯æœ‰åŒ¿åå‡½æ•°
ä»è¯­æ³•å±‚é¢ä¸ŠLambdaè¡¨è¾¾å¼å’ŒåŒ¿åå‡½æ•°åšçš„äº‹ä¸€æ ·ï¼Œæ²¡å¿…è¦å†æœ‰Lambdaè¯­æ³•</li>
</ul>
</div>
</div>
</div>
</section>
<section id="outline-container-org3aa8b91" class="outline-2">
<h2 id="org3aa8b91">å‡ºé”™å¤„ç†ä¸defer/panic/recover</h2>
<div class="outline-text-2" id="text-org3aa8b91">
<p>
èµ„æºç®¡ç†ï¼š
</p>
<ul class="org-ul">
<li>æ‰“å¼€æ–‡ä»¶è¦å…³é—­</li>
<li>è¿æ¥æ•°æ®åº“è¦é‡Šæ”¾</li>
<li><p>
è¿™äº›æ˜¯è¦æˆå¯¹å‡ºç°çš„
</p>

<p>
åŠ å…¥å‡ºé”™å¤„ç†åç¨‹åºæœ‰å¯èƒ½ä¸­é—´è·³å‡ºæ¥ï¼Œæ€ä¹ˆä¿è¯æ‰“å¼€çš„è¿æ¥å…³é—­æ‰ï¼Œè¿™æ—¶å°±éœ€è¦èµ„æºç®¡ç†
ä¸å‡ºé”™å¤„ç†ã€‚
é€šè¿‡deferè°ƒç”¨æ¥å®ç°èµ„æºç®¡ç†çš„ã€‚
</p></li>
</ul>
</div>
<div id="outline-container-org95fc1a3" class="outline-3">
<h3 id="org95fc1a3">deferè°ƒç”¨</h3>
<div class="outline-text-3" id="text-org95fc1a3">
<ul class="org-ul">
<li>ç¡®ä¿è°ƒç”¨åœ¨å‡½æ•°ç»“æŸæ—¶å‘ç”Ÿ</li>
<li>å‚æ•°åœ¨deferè¯­å¥æ—¶è®¡ç®—</li>
<li>deferåˆ—è¡¨ä¸ºå…ˆè¿›åå‡º</li>
</ul>


<p>
èŒƒä¾‹ï¼šdeferè°ƒç”¨åŠå°†æ–æ³¢é‚£å¥‘æ•°åˆ—å†™å…¥åˆ°æ–‡ä»¶
åˆ›å»ºerrhanding/defer/defer.goæ–‡ä»¶
</p>
<div class="org-src-container">
<pre class="src src-sh">package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"bufio"</span>
    <span style="color: #8b2252;">"fmt"</span>
    <span style="color: #8b2252;">"learngo/functional/fib"</span>
    <span style="color: #8b2252;">"os"</span>
)

func tryDefer() {
    defer fmt.Println(1) // defer&#37324;&#38754;&#30456;&#24403;&#20110;&#26377;&#19968;&#20010;&#26632;&#65292;&#20808;&#36827;&#21518;&#20986;&#30340;
    defer fmt.Println(2)
    fmt.Println(3)
    // defer&#30340;&#22909;&#22788;&#26159;&#19981;&#24597;&#20013;&#38388;&#26377;return, &#29978;&#33267;panic
    panic(<span style="color: #8b2252;">"error occurred"</span>)
    fmt.Println(4)
}

func writeFile(filename string) { // &#23558;&#26000;&#27874;&#37027;&#22865;&#25968;&#21015;&#20889;&#20837;&#21040;&#25991;&#20214;
    file, err := os.Create(filename)  // &#25171;&#24320;&#19968;&#20010;&#25991;&#20214;
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }
    defer file.Close() // &#20351;&#29992;defer&#65292;&#20989;&#25968;&#32467;&#26463;&#21518;&#20851;&#38381;&#25991;&#20214;

    // file&#30452;&#25509;&#20889;&#25991;&#20214;&#27604;&#36739;&#24930;&#65292;&#36825;&#37324;&#29992; bufio &#21152;&#36733;&#21040;&#20869;&#23384;&#26041;&#24335;
    writer := bufio.NewWriter(file)
    defer writer.Flush() // &#20445;&#23384;&#21040;&#25991;&#20214;

    f := fib.Fibonacci()
    <span style="color: #a020f0;">for</span> i := 0; i &lt; 20; i++ { //&#20889;&#20837;&#21069;20&#20010;
        fmt.Fprintln(writer, f())
    }
}

func main() {
    writeFile(<span style="color: #8b2252;">"fib.txt"</span>)
}
</pre>
</div>
<p>
åˆ›å»ºfunctional/fib/fib.goæ–‡ä»¶
</p>
<div class="org-src-container">
<pre class="src src-sh">package fib

func Fibonacci() func() int {
    a, b := 0, 1
    <span style="color: #a020f0;">return</span> func() int {
        a, b = b, a + b
        <span style="color: #a020f0;">return</span> a
    }
}
</pre>
</div>
</div>
<div id="outline-container-org24078f6" class="outline-4">
<h4 id="org24078f6">ä½•æ—¶ä½¿ç”¨deferè°ƒç”¨</h4>
<div class="outline-text-4" id="text-org24078f6">
<ul class="org-ul">
<li>Open/Close</li>
<li>Lock/Unlock</li>
<li>PrintHeader/PrintFooter æ‰“å°ç½‘é¡µå¤´å°¾</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org852847e" class="outline-3">
<h3 id="org852847e">é”™è¯¯å¤„ç†æ¦‚å¿µ</h3>
<div class="outline-text-3" id="text-org852847e">
<div class="org-src-container">
<pre class="src src-sh">file, err := os.Open(<span style="color: #8b2252;">"abc.txt"</span>)
<span style="color: #a020f0;">if</span> err != nil {
        <span style="color: #a020f0;">if</span> pathError, ok := err.(*os.PathError); ok {
               fmt.Println(pathError.Err)
           } <span style="color: #a020f0;">else</span> {
               fmt.Println(<span style="color: #8b2252;">"unknwon error"</span>, err)
           }
    }
</pre>
</div>

<p>
èŒƒä¾‹ï¼šerrorçš„å¤„ç†
åˆ›å»ºerrhanding/defer/defer.goæ–‡ä»¶
</p>
<div class="org-src-container">
<pre class="src src-sh">package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"bufio"</span>
    <span style="color: #8b2252;">"errors"</span>
    <span style="color: #8b2252;">"fmt"</span>
    <span style="color: #8b2252;">"learngo/functional/fib"</span>
    <span style="color: #8b2252;">"os"</span>
)

func tryDefer() {
    defer fmt.Println(1) // defer&#37324;&#38754;&#30456;&#24403;&#20110;&#26377;&#19968;&#20010;&#26632;&#65292;&#20808;&#36827;&#21518;&#20986;&#30340;
    defer fmt.Println(2)
    fmt.Println(3)
    // defer&#30340;&#22909;&#22788;&#26159;&#19981;&#24597;&#20013;&#38388;&#26377;return, &#29978;&#33267;panic
    panic(<span style="color: #8b2252;">"error occurred"</span>)
    fmt.Println(4)
}

func writeFile(filename string) { // &#23558;&#26000;&#27874;&#37027;&#22865;&#25968;&#21015;&#20889;&#20837;&#21040;&#25991;&#20214;
    file, err := os.OpenFile(filename, os.O_EXCL|os.O_CREATE, 0666)  // &#25171;&#24320;&#19968;&#20010;&#25991;&#20214;

    // &#33258;&#24049;&#35774;&#32622;&#30340;error
    err = errors.New(<span style="color: #8b2252;">"this is a custom error"</span>)
    // error&#30340;&#22788;&#29702;
    <span style="color: #a020f0;">if</span> err != nil {
        // panic(err) // panic&#27604;&#36739;&#38590;&#30475;
        // fmt.Println(<span style="color: #8b2252;">"file already exists"</span>)
        // fmt.Println(<span style="color: #8b2252;">"Error:"</span>, err.Error()) // &#19981;&#21152;err.Error() &#20063;&#21487;&#20197; &#65292;Println&#20250;err&#20013;&#30340;string&#25214;&#21040;
        // os.OpenFile&#20013;&#36820;&#22238;&#30340;error&#26159;*PathError&#12290;If there is an error, it will be of type *PathError
        <span style="color: #a020f0;">if</span> pathError, ok := err.(*os.PathError); !ok {
            panic(err)
        } <span style="color: #a020f0;">else</span> {
            fmt.Printf(<span style="color: #8b2252;">"%s, %s, %s\n"</span>, pathError.Op,
            pathError.Path,
            pathError.Err) // open, fib.txt, The file exists.
        }
        <span style="color: #a020f0;">return</span>
    }
    defer file.Close() // &#20351;&#29992;defer&#65292;&#20989;&#25968;&#32467;&#26463;&#21518;&#20851;&#38381;&#25991;&#20214;

    // file&#30452;&#25509;&#20889;&#25991;&#20214;&#27604;&#36739;&#24930;&#65292;&#36825;&#37324;&#29992; bufio &#21152;&#36733;&#21040;&#20869;&#23384;&#26041;&#24335;
    writer := bufio.NewWriter(file)
    defer writer.Flush() // &#20445;&#23384;&#21040;&#25991;&#20214;

    f := fib.Fibonacci()
    <span style="color: #a020f0;">for</span> i := 0; i &lt; 20; i++ { //&#20889;&#20837;&#21069;20&#20010;
        fmt.Fprintln(writer, f())
    }
}

func main() {
    writeFile(<span style="color: #8b2252;">"fib.txt"</span>)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgafd390e" class="outline-3">
<h3 id="orgafd390e">æœåŠ¡å™¨ç»Ÿä¸€å‡ºé”™å¤„ç†1</h3>
<div class="outline-text-3" id="text-orgafd390e">
<p>
è¿™é‡Œæ²¡æœ‰æ–°çš„é€»è¾‘ï¼Œåªæ˜¯å®šä»£ç çš„æ–¹å¼
</p>

<p>
èŒƒä¾‹ï¼š
æ“ä½œ1
åˆ›å»ºerrhandling/filelistingserver/web.go æ–‡ä»¶
</p>
<div class="org-src-container">
<pre class="src src-sh">// url&#20013;&#26174;&#31034;&#25991;&#20214;&#20869;&#23481;
package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"io/ioutil"</span>
    <span style="color: #8b2252;">"net/http"</span>
    <span style="color: #8b2252;">"os"</span>
)

func main() {
    http.HandleFunc(<span style="color: #8b2252;">"/list/"</span>,
        func(writer http.ResponseWriter, request *http.Request) {
            path := request.URL.Path[len(<span style="color: #8b2252;">"/list/"</span>):] // /list/fib.txt &#24471;&#21040;&#30495;&#23454;&#25991;&#20214;&#30340;&#36335;&#24452;
            file, err := os.Open(path)
            <span style="color: #a020f0;">if</span> err != nil {
                panic(err)
            }
            defer file.Close()

            all, err := ioutil.ReadAll(file)
            <span style="color: #a020f0;">if</span> err != nil {
                panic(err)
            }

            writer.Write(all)
        })

    err := http.ListenAndServe(<span style="color: #8b2252;">":8888"</span>, nil)
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }
}
</pre>
</div>
<p>
è®¿é—® `localhost:8888/list/fib.txts`å¯ä»¥çœ‹åˆ°å†…å®¹ï¼Œè®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶å¯ä»¥çœ‹åˆ°ç¨‹åºè¿”å›é”™è¯¯ã€‚
</p>

<p>
åšä¸€ä¸‹é”™è¯¯å¤„ç†
</p>
<div class="org-src-container">
<pre class="src src-sh">file, err := os.Open(path)
<span style="color: #a020f0;">if</span> err != nil {  // &#38169;&#35823;&#22788;&#29702;&#65292;&#36820;&#22238;&#38169;&#35823;&#21450;http&#29366;&#24577;
    http.Error(writer,
        err.Error(),
        http.StatusInternalServerError)
    <span style="color: #a020f0;">return</span>
}
</pre>
</div>
<p>
è®¿é—®é”™è¯¯é¡µé¢<a href="http://localhost:8888/list/fib.txta">http://localhost:8888/list/fib.txta</a>,
é¡µé¢è¿”å›äº†`open fib.txta: The system cannot find the file specified.`
ç¼ºç‚¹ï¼šæŠŠç¨‹åºå†…éƒ¨çš„ä¿¡æ¯æš´éœ²å‡ºæ¥äº†ï¼Œç”¨æˆ·çœ‹åˆ°ä¸å®‰å…¨
</p>

<p>
æ“ä½œ2ï¼š
æŠŠerroråŒ…è£…æˆå¤–éƒ¨çš„error
æŠŠå‡½æ•°æœ¬èº«çš„ä¸šåŠ¡é€»è¾‘æå‡ºæ¥
åˆ›å»ºerrhandling/filelisting/handler.go æ–‡ä»¶
</p>
<div class="org-src-container">
<pre class="src src-sh">package filelisting

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"io/ioutil"</span>
    <span style="color: #8b2252;">"net/http"</span>
    <span style="color: #8b2252;">"os"</span>
)

func HandleFileList(writer http.ResponseWriter,
    request *http.Request) error {
    path := request.URL.Path[len(<span style="color: #8b2252;">"/list/"</span>):] // /list/fib.txt &#24471;&#21040;&#30495;&#23454;&#25991;&#20214;&#30340;&#36335;&#24452;
    file, err := os.Open(path)
    <span style="color: #a020f0;">if</span> err != nil { // &#38169;&#35823;&#22788;&#29702;&#65292;&#19981;&#38656;&#35201;&#22788;&#29702;err
        <span style="color: #a020f0;">return</span> err
    }
    defer file.Close()

    all, err := ioutil.ReadAll(file)
    <span style="color: #a020f0;">if</span> err != nil {
        <span style="color: #a020f0;">return</span> err
    }

    writer.Write(all)
    <span style="color: #a020f0;">return</span> err
}
</pre>
</div>
<p>
errhandling/filelistingserver/web.go æ–‡ä»¶
</p>
<div class="org-src-container">
<pre class="src src-sh">// url&#20013;&#26174;&#31034;&#25991;&#20214;&#20869;&#23481;
package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"learngo/errhandling/filelistingserver/filelisting"</span>
    <span style="color: #8b2252;">"log"</span>
    <span style="color: #8b2252;">"net/http"</span>
    <span style="color: #8b2252;">"os"</span>
)

// &#32479;&#19968;&#38169;&#35823;&#22788;&#29702;
<span style="color: #483d8b;">type</span> appHandler func(writer http.ResponseWriter, request *http.Request) error

func errWrapper(handler appHandler) func(http.ResponseWriter, *http.Request) { // &#25226;&#36755;&#20837;&#30340;&#20989;&#25968;&#21253;&#35013;&#25104;&#19968;&#20010;&#36755;&#20986;&#30340;&#20989;&#25968;&#12290; &#20989;&#25968;&#24335;&#32534;&#31243;&#65292;&#20989;&#25968;&#21363;&#21487;&#20570;&#21442;&#25968;&#65292;&#20063;&#21487;&#20570;&#36820;&#22238;&#20540;
    <span style="color: #a020f0;">return</span> func(writer http.ResponseWriter,
        request *http.Request) {
        err := handler(writer, request)
        <span style="color: #a020f0;">if</span> err != nil { // &#38169;&#35823;&#22788;&#29702;
            log.Printf(<span style="color: #8b2252;">"error handing request: %s"</span>,
                err.Error()) // &#31243;&#24207;&#35760;&#24405;&#38169;&#35823;
            code := http.StatusOK
            switch {
            <span style="color: #a020f0;">case</span> os.IsNotExist(err): // &#25991;&#20214;&#19981;&#23384;&#22312;&#30340;&#38169;&#35823;
                code = http.StatusNotFound
            <span style="color: #a020f0;">case</span> os.IsPermission(err): // &#27809;&#26377;&#26435;&#38480; 403
                code = http.StatusForbidden
            default: // &#20160;&#20040;&#37117;&#19981;&#30693;&#36947;&#36820;&#22238; 500
                code = http.StatusInternalServerError
            }
            // &#21442;&#25968;&#30340;&#24847;&#20041;&#65292;1th: &#21521;&#35841;&#27719;&#25253;err&#65292;&#36825;&#37324;&#20026;writer, 2th: &#39029;&#38754;&#26174;&#31034;&#30340;&#38169;&#35823;&#20449;&#24687;&#65292; 3th: &#29366;&#24577;&#30721;
            http.Error(writer,
                http.StatusText(code),
                code)
        }
    }
}

func main() {
    http.HandleFunc(<span style="color: #8b2252;">"/list/"</span>, errWrapper(filelisting.HandleFileList)) // &#23558;&#20989;&#25968;&#20013;&#19994;&#21153;&#36923;&#36753;&#25552;&#20986;&#21435;

    err := http.ListenAndServe(<span style="color: #8b2252;">":8888"</span>, nil)
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }
}
</pre>
</div>
<p>
è®¿é—®é”™è¯¯é¡µé¢<a href="http://localhost:8888/list/fib.txta">http://localhost:8888/list/fib.txta</a>,
é¡µé¢è¿”å›äº†`Not Found`
</p>
</div>
</div>
<div id="outline-container-orga349f70" class="outline-3">
<h3 id="orga349f70">æœåŠ¡å™¨ç»Ÿä¸€å‡ºé”™å¤„ç†2</h3>
<div class="outline-text-3" id="text-orga349f70">
<p>
èŒƒä¾‹ï¼š
ä¸ä»¥`/list/`ä¸ºå…¥å£
ä¿®æ”¹errhandling/filelistingserver/web.go
</p>
<div class="org-src-container">
<pre class="src src-sh">// url&#20013;&#26174;&#31034;&#25991;&#20214;&#20869;&#23481;
package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"learngo/errhandling/filelistingserver/filelisting"</span>
    <span style="color: #8b2252;">"log"</span>
    <span style="color: #8b2252;">"net/http"</span>
    <span style="color: #8b2252;">"os"</span>
)

// &#32479;&#19968;&#38169;&#35823;&#22788;&#29702;
<span style="color: #483d8b;">type</span> appHandler func(writer http.ResponseWriter, request *http.Request) error

func errWrapper(handler appHandler) func(http.ResponseWriter, *http.Request) { // &#25226;&#36755;&#20837;&#30340;&#20989;&#25968;&#21253;&#35013;&#25104;&#19968;&#20010;&#36755;&#20986;&#30340;&#20989;&#25968;&#12290; &#20989;&#25968;&#24335;&#32534;&#31243;&#65292;&#20989;&#25968;&#21363;&#21487;&#20570;&#21442;&#25968;&#65292;&#20063;&#21487;&#20570;&#36820;&#22238;&#20540;
    <span style="color: #a020f0;">return</span> func(writer http.ResponseWriter,
        request *http.Request) {
        defer func() { // &#24403;&#26381;&#21153;&#21457;&#29616;panic&#26102;&#65292;&#25318;&#25130;&#20445;&#25345;&#19968;&#19979;
            <span style="color: #a020f0;">if</span> r := recover(); r != nil { // &#25318;&#25130;pannic&#65292;&#19981;&#20013;&#26029;&#31243;&#24207;
                log.Printf(<span style="color: #8b2252;">"Panic: %v"</span>, r)
                http.Error(writer,
                    http.StatusText(http.StatusInternalServerError),
                    http.StatusInternalServerError)
            }
        }()

        err := handler(writer, request)

        <span style="color: #a020f0;">if</span> err != nil { // &#38169;&#35823;&#22788;&#29702;
            log.Printf(<span style="color: #8b2252;">"Error handing request: %s"</span>,
                err.Error())
            code := http.StatusOK
            switch {
            <span style="color: #a020f0;">case</span> os.IsNotExist(err): // &#25991;&#20214;&#19981;&#23384;&#22312;&#30340;&#38169;&#35823;
                code = http.StatusNotFound
            <span style="color: #a020f0;">case</span> os.IsPermission(err): // &#27809;&#26377;&#26435;&#38480; 403
                code = http.StatusForbidden
            default: // &#20160;&#20040;&#37117;&#19981;&#30693;&#36947;&#36820;&#22238; 500
                code = http.StatusInternalServerError
            }
            // &#21442;&#25968;&#30340;&#24847;&#20041;&#65292;1th: &#21521;&#35841;&#27719;&#25253;err&#65292;&#36825;&#37324;&#20026;writer, 2th: &#39029;&#38754;&#26174;&#31034;&#30340;&#38169;&#35823;&#20449;&#24687;&#65292; 3th: &#29366;&#24577;&#30721;
            http.Error(writer,
                http.StatusText(code),
                code)
        }
    }
}

func main() {
    http.HandleFunc(<span style="color: #8b2252;">"/"</span>, errWrapper(filelisting.HandleFileList)) // &#21709;&#24212;/&#36335;&#24452;

    err := http.ListenAndServe(<span style="color: #8b2252;">":8888"</span>, nil)
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }
}
</pre>
</div>
<p>
è®¿é—®é”™è¯¯é¡µé¢<a href="http://localhost:8888/abc">http://localhost:8888/abc</a>,è§¦å‘panic
é¡µé¢è¿”å›äº†`Internal Server Error`ï¼ŒåŒæ—¶ç¨‹åºæ‰“å°å‹å¥½çš„ `Panic: Internal Server Error`
</p>

<p>
ä¸šåŠ¡é€»è¾‘åˆ¤æ–­urlè·¯å¾„ä¸åŒ¹é…æ—¶ï¼Œè¿”å›error
ä¿®æ”¹rrhandling/filelisting/handler.go æ–‡ä»¶
</p>
<div class="org-src-container">
<pre class="src src-sh">package filelisting

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"errors"</span>
    <span style="color: #8b2252;">"io/ioutil"</span>
    <span style="color: #8b2252;">"net/http"</span>
    <span style="color: #8b2252;">"os"</span>
    <span style="color: #8b2252;">"strings"</span>
)

const prefix = <span style="color: #8b2252;">"/list/"</span>

func HandleFileList(writer http.ResponseWriter,
    request *http.Request) error {
    <span style="color: #a020f0;">if</span> strings.Index(
        request.URL.Path, prefix) != 0 { // &#21028;&#26029;&#36335;&#24452;&#26159;&#21542;&#21305;&#37197;
        <span style="color: #a020f0;">return</span> errors.New(<span style="color: #8b2252;">"path must start with "</span> + prefix)
    }
    path := request.URL.Path[len(prefix):] // /list/fib.txt &#24471;&#21040;&#30495;&#23454;&#25991;&#20214;&#30340;&#36335;&#24452;
    file, err := os.Open(path)
    <span style="color: #a020f0;">if</span> err != nil { // &#38169;&#35823;&#22788;&#29702;&#65292;&#19981;&#38656;&#35201;&#22788;&#29702;err
        <span style="color: #a020f0;">return</span> err
    }
    defer file.Close()

    all, err := ioutil.ReadAll(file)
    <span style="color: #a020f0;">if</span> err != nil {
        <span style="color: #a020f0;">return</span> err
    }

    writer.Write(all)
    <span style="color: #a020f0;">return</span> err
}
</pre>
</div>
<p>
è®¿é—®é”™è¯¯é¡µé¢<a href="http://localhost:8888/abc">http://localhost:8888/abc</a>,è§¦å‘panic
é¡µé¢è¿”å›äº†`Internal Server Error`ï¼ŒåŒæ—¶ç¨‹åºæ‰“å°erroræ—¥å¿— `Error handing request: path must start with /list/`
ç¼ºç‚¹ï¼šè¿”å›ä¿¡æ¯å“ªäº›èƒ½ç»™ç”¨æˆ·çœ‹åˆ°å“ªäº›ä¸è®©çœ‹æ²¡æœ‰åšåŒºåˆ†
</p>

<p>
åŒºåˆ†ç»™ç”¨æˆ·æ˜¾ç¤ºçš„é”™è¯¯ä¿¡æ¯
ä¿®æ”¹errhandling/filelistingserver/web.go
</p>
<div class="org-src-container">
<pre class="src src-sh">// url&#20013;&#26174;&#31034;&#25991;&#20214;&#20869;&#23481;
package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"learngo/errhandling/filelistingserver/filelisting"</span>
    <span style="color: #8b2252;">"log"</span>
    <span style="color: #8b2252;">"net/http"</span>
    <span style="color: #8b2252;">"os"</span>
)

// &#32479;&#19968;&#38169;&#35823;&#22788;&#29702;&#65306;
<span style="color: #483d8b;">type</span> appHandler func(writer http.ResponseWriter, request *http.Request) error

func errWrapper(handler appHandler) func(http.ResponseWriter, *http.Request) { // &#25226;&#36755;&#20837;&#30340;&#20989;&#25968;&#21253;&#35013;&#25104;&#19968;&#20010;&#36755;&#20986;&#30340;&#20989;&#25968;&#12290; &#20989;&#25968;&#24335;&#32534;&#31243;&#65292;&#20989;&#25968;&#21363;&#21487;&#20570;&#21442;&#25968;&#65292;&#20063;&#21487;&#20570;&#36820;&#22238;&#20540;
    <span style="color: #a020f0;">return</span> func(writer http.ResponseWriter,
        request *http.Request) {
        defer func() { // &#25351;&#23450;&#36335;&#24452;&#65306;&#24403;&#26381;&#21153;&#21457;&#29616;panic&#26102;&#65292;&#25318;&#25130;&#20445;&#25345;&#19968;&#19979;
            <span style="color: #a020f0;">if</span> r := recover(); r != nil { // &#25351;&#23450;&#36335;&#24452;&#65306;&#25318;&#25130;pannic&#65292;&#19981;&#20013;&#26029;&#31243;&#24207;
                log.Printf(<span style="color: #8b2252;">"Panic: %v"</span>, r)
                http.Error(writer,
                    http.StatusText(http.StatusInternalServerError),
                    http.StatusInternalServerError)
            }
        }()

        err := handler(writer, request)

        <span style="color: #a020f0;">if</span> err != nil { // &#32479;&#19968;&#38169;&#35823;&#22788;&#29702;&#65306;&#38169;&#35823;&#22788;&#29702;
            log.Printf(<span style="color: #8b2252;">"Error handing request: %s"</span>,
                err.Error())

            // &#21306;&#20998;&#29992;&#25143;&#20449;&#24687;&#65306;&#21306;&#20998;&#32473;&#29992;&#25143;&#30475;&#30340;&#38169;&#35823;&#20449;&#24687;
            <span style="color: #a020f0;">if</span> userErr, ok := err.(userError); ok {
                http.Error(writer,
                    userErr.Message(),
                    http.StatusBadRequest)
                <span style="color: #a020f0;">return</span>
            }
            code := http.StatusOK
            switch {
            <span style="color: #a020f0;">case</span> os.IsNotExist(err): // &#25991;&#20214;&#19981;&#23384;&#22312;&#30340;&#38169;&#35823;
                code = http.StatusNotFound
            <span style="color: #a020f0;">case</span> os.IsPermission(err): // &#27809;&#26377;&#26435;&#38480; 403
                code = http.StatusForbidden
            default: // &#20160;&#20040;&#37117;&#19981;&#30693;&#36947;&#36820;&#22238; 500
                code = http.StatusInternalServerError
            }
            // &#21442;&#25968;&#30340;&#24847;&#20041;&#65292;1th: &#21521;&#35841;&#27719;&#25253;err&#65292;&#36825;&#37324;&#20026;writer, 2th: &#39029;&#38754;&#26174;&#31034;&#30340;&#38169;&#35823;&#20449;&#24687;&#65292; 3th: &#29366;&#24577;&#30721;
            http.Error(writer,
                http.StatusText(code),
                code)
        }
    }
}

// &#21306;&#20998;&#29992;&#25143;&#20449;&#24687;&#65306;&#23450;&#20041;&#29992;&#25143;&#38169;&#35823;&#25509;&#21475;
<span style="color: #483d8b;">type</span> userError interface {
    error            // &#31995;&#32479;&#30475;&#30340;&#20449;&#24687;
    Message() string // &#29992;&#25143;&#30475;&#30340;&#20449;&#24687;
}

func main() {
    http.HandleFunc(<span style="color: #8b2252;">"/"</span>, errWrapper(filelisting.HandleFileList)) // &#32479;&#19968;&#38169;&#35823;&#22788;&#29702;|&#25351;&#23450;&#36335;&#24452;&#65306;&#23558;&#20989;&#25968;&#20013;&#19994;&#21153;&#36923;&#36753;&#25552;&#20986;&#21435;

    err := http.ListenAndServe(<span style="color: #8b2252;">":8888"</span>, nil)
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }
}
</pre>
</div>
<p>
ä¿®æ”¹rrhandling/filelisting/handler.go æ–‡ä»¶
</p>
<div class="org-src-container">
<pre class="src src-sh">package filelisting

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"io/ioutil"</span>
    <span style="color: #8b2252;">"net/http"</span>
    <span style="color: #8b2252;">"os"</span>
    <span style="color: #8b2252;">"strings"</span>
)

const prefix = <span style="color: #8b2252;">"/list/"</span>

// &#21306;&#20998;&#29992;&#25143;&#20449;&#24687;&#65306;&#23450;&#20041;userError&#31867;&#22411;
<span style="color: #483d8b;">type</span> userError string

<span style="color: #0000ff;">func</span> (e userError) Error() string {
    <span style="color: #a020f0;">return</span> e.Message()
}

<span style="color: #0000ff;">func</span> (e userError) Message() string {
    <span style="color: #a020f0;">return</span> string(e)
}

func HandleFileList(writer http.ResponseWriter,
    request *http.Request) error { // &#32479;&#19968;&#38169;&#35823;&#22788;&#29702;: &#19994;&#21153;&#36923;&#36753;
    <span style="color: #a020f0;">if</span> strings.Index(
        request.URL.Path, prefix) != 0 { // &#21305;&#37197;&#36335;&#24452;&#65306;&#21028;&#26029;&#36335;&#24452;&#26159;&#21542;&#21305;&#37197;
        <span style="color: #a020f0;">return</span> userError(<span style="color: #8b2252;">"path must start with "</span> + prefix) // &#21306;&#20998;&#29992;&#25143;&#20449;&#24687;&#65306;&#36820;&#22238;&#29992;&#25143;&#38169;&#35823;&#20449;&#24687;&#31867;&#22411;&#20540;
    }
    path := request.URL.Path[len(prefix):] // &#21305;&#37197;&#36335;&#24452;&#65306; /list/fib.txt &#24471;&#21040;&#30495;&#23454;&#25991;&#20214;&#30340;&#36335;&#24452;
    file, err := os.Open(path)
    <span style="color: #a020f0;">if</span> err != nil { // &#38169;&#35823;&#22788;&#29702;&#65292;&#19981;&#38656;&#35201;&#22788;&#29702;err
        <span style="color: #a020f0;">return</span> err
    }
    defer file.Close()

    all, err := ioutil.ReadAll(file)
    <span style="color: #a020f0;">if</span> err != nil {
        <span style="color: #a020f0;">return</span> err
    }

    writer.Write(all)
    <span style="color: #a020f0;">return</span> err
}
</pre>
</div>
<p>
è®¿é—®é”™è¯¯é¡µé¢<a href="http://localhost:8888/list/fib.txta">http://localhost:8888/list/fib.txta</a>,
é¡µé¢è¿”å›äº†`Not Found`ï¼ŒåŒæ—¶ç¨‹åºæ‰“å°erroræ—¥å¿—`Error handing request: open fib.txta: The system cannot find the file specified.`
ç»™ç”¨æˆ·éšè—äº†ç³»ç»Ÿé”™è¯¯ä¿¡æ¯
è®¿é—®é”™è¯¯é¡µé¢<a href="http://localhost:8888/abc">http://localhost:8888/abc</a>,è§¦å‘panic
é¡µé¢è¿”å›äº†`path must start with /list/`ï¼ŒåŒæ—¶ç¨‹åºæ‰“å°erroræ—¥å¿— `Error handing request: path must start with /list/`
ç»™ç”¨æˆ·æ˜¾ç¤ºäº†ç”¨æˆ·é”™è¯¯ä¿¡æ¯
</p>
</div>
</div>
<div id="outline-container-org0ff64e8" class="outline-3">
<h3 id="org0ff64e8">error vs panic</h3>
<div class="outline-text-3" id="text-org0ff64e8">
<p>
å°½é‡ä¸ç”¨panic
</p>
<ul class="org-ul">
<li>æ„æ–™ä¹‹ä¸­çš„ï¼šç”¨errorã€‚å¦‚ï¼šæ–‡ä»¶æ‰“ä¸å¼€</li>
<li>æ„æ–™ä¹‹å¤–çš„ï¼šç”¨panicã€‚å¦‚ï¼šæ•°ç»„è¶Šç•Œ</li>
</ul>
</div>
</div>
<div id="outline-container-org018cfe2" class="outline-3">
<h3 id="org018cfe2">èŒƒä¾‹å°ç»“</h3>
<div class="outline-text-3" id="text-org018cfe2">
<ul class="org-ul">
<li>defer + panic + recover
åšé”™è¯¯å¤„ç†</li>
<li>Type Assertion
åˆ¤æ–­é”™è¯¯ç±»å‹</li>
<li><p>
å‡½æ•°å¼ç¼–ç¨‹çš„åº”ç”¨
åŒ…è£…å‡½æ•°
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">type</span> appHandler func(writer http.ResponseWriter, request *http.Request) error
<span style="color: #0000ff;">errWrapper</span>(handler appHandler) func(
    http.ResponseWriter,
    *http.Request) { // &#25226;&#36755;&#20837;&#30340;&#20989;&#25968;&#21253;&#35013;&#25104;&#19968;&#20010;&#36755;&#20986;&#30340;&#20989;&#25968;&#12290; &#20989;&#25968;&#24335;&#32534;&#31243;&#65292;&#20989;&#25968;&#21363;&#21487;&#20570;&#21442;&#25968;&#65292;&#20063;&#21487;&#20570;&#36820;&#22238;&#20540;
</pre>
</div></li>
</ul>
</div>
</div>
</section>
<section id="outline-container-orgea8bf82" class="outline-2">
<h2 id="orgea8bf82">æµ‹è¯•ä¸æ€§èƒ½è°ƒä¼˜</h2>
<div class="outline-text-2" id="text-orgea8bf82">
</div>
<div id="outline-container-org758f377" class="outline-3">
<h3 id="org758f377">æµ‹è¯•</h3>
<div class="outline-text-3" id="text-org758f377">
<p>
å¸Œæœ›ç¨‹åºå‘˜å¤šåšæµ‹è¯•è€Œä¸æ˜¯å¤šåšè°ƒè¯•ï¼Œèƒ½å¦å†™å‡ºä¸€ä¸ªå¥½çš„æµ‹è¯•å¯¹ä¸€åæˆåŠŸçš„è½¯ä»¶å·¥ç¨‹éå¸¸é‡è¦ã€‚
</p>

<p>
èŒƒä¾‹ï¼šè°ƒè¯•
</p>
</div>
<div id="outline-container-org179de01" class="outline-4">
<h4 id="org179de01">ä¼ ç»Ÿæµ‹è¯• vs è¡¨æ ¼é©±åŠ¨æµ‹è¯•</h4>
<div class="outline-text-4" id="text-org179de01">
<p>
goè¯­è¨€æ˜¯ä½¿ç”¨è¡¨æ ¼é©±åŠ¨çš„æµ‹è¯•æ–¹æ³•
</p>
</div>
<div id="outline-container-orge6b00bd" class="outline-5">
<h5 id="orge6b00bd">ä¼ ç»Ÿæµ‹è¯•</h5>
<div class="outline-text-5" id="text-orge6b00bd">
<div class="org-src-container">
<pre class="src src-sh">@Test public void testAdd() {
    assertEquals(3, add(1, 2)); // 1th: 3 &#26399;&#24453;&#20540;&#65292;2th&#65306;add(1, 2)&#31639;&#20986;&#30340;&#20540;
    assertEquals(2, add(0, 2));
    assertEquals(0, add(0, 0));
    assertEquals(0, add(-1, 1));
    assertEquals(Integer.MIN_VALUE, add(1, Integer.MAX_VALUE));
}
</pre>
</div>
<p>
ç¼ºç‚¹ï¼š
</p>
<ul class="org-ul">
<li>æµ‹è¯•æ•°æ®å’Œæµ‹è¯•é€»è¾‘æ··åœ¨ä¸€èµ·</li>
<li>å‡ºé”™ä¿¡æ¯ä¸æ˜ç¡®</li>
<li>ä¸€æ—¦ä¸€ä¸ªæ•°æ®å‡ºé”™æµ‹è¯•å…¨éƒ¨ç»“æŸ</li>
</ul>
</div>
</div>
<div id="outline-container-org54aadfb" class="outline-5">
<h5 id="org54aadfb">è¡¨æ ¼é©±åŠ¨æµ‹è¯•</h5>
<div class="outline-text-5" id="text-org54aadfb">
<p>
goä»£ç ç¤ºä¾‹ï¼š
</p>
<div class="org-src-container">
<pre class="src src-sh">tests := []struct { // &#25968;&#25454;
    a, b, c int32
}{
    {1, 2, 3},
    {0, 2, 2},
    {0, 0, 0},
    {-1, 1, 0},
    {math.MaxInt32, 1, math.MinInt32},
}

<span style="color: #a020f0;">for</span> _, test := range tests { // &#36923;&#36753;
        <span style="color: #a020f0;">if</span> actual := add(test.a, test.b); actual != test.c {}
    }
</pre>
</div>
<p>
ä¼˜ç‚¹ï¼š
</p>
<ul class="org-ul">
<li>åˆ†ç¦»çš„æµ‹è¯•æ•°æ®å’Œæµ‹è¯•é€»è¾‘</li>
<li>æ˜ç¡®çš„å‡ºé”™ä¿¡æ¯</li>
<li>å¯ä»¥éƒ¨åˆ†å¤±è´¥</li>
<li>goè¯­è¨€çš„è¯­æ³•ä½¿ç”¨æˆ‘ä»¬æ›´æ˜“å®è·µè¡¨æ ¼é©±åŠ¨æµ‹è¯•
<ul class="org-ul">
<li>java, c++å†™è¡¨æ ¼é©±åŠ¨æµ‹è¯•æ¯”è¾ƒéº»çƒ¦</li>
</ul></li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-org67fd7d7" class="outline-3">
<h3 id="org67fd7d7">è¡¨æ ¼é©±åŠ¨æµ‹è¯•</h3>
<div class="outline-text-3" id="text-org67fd7d7">
<ul class="org-ul">
<li>`testing.T`çš„ä½¿ç”¨
<ul class="org-ul">
<li>æµ‹è¯•æ–‡ä»¶ï¼š
<ul class="org-ul">
<li>æ–‡ä»¶å`*_test.go`,å’Œè¢«æµ‹è¯•ä»£ç æ”¾åœ¨ä¸€èµ·</li>
<li>å‡½æ•°å`Test*`å¼€å¤´</li>
</ul></li>
</ul></li>

<li>è¿è¡Œæµ‹è¯•
<ul class="org-ul">
<li>å‘½ä»¤è¡Œï¼š`go test .`</li>
</ul></li>
</ul>



<p>
èŒƒä¾‹ï¼štriangleä¸‰è§’å½¢
</p>
<div class="org-src-container">
<pre class="src src-sh">// learngo/basic/basic/basic.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"math"</span>
)

func triangle() {
  var a, b int = 3, 4
  fmt.Println(calcTriangle(a, b))
}

func calcTriangle(a, b int) int {
  var c int
  c = int(math.Sqrt(float64(a*a + b*b)))
  <span style="color: #a020f0;">return</span> c
}
func main() {
  triangle()
}


// learngo/basic/basic/triangle_test.go

package main

import <span style="color: #8b2252;">"testing"</span>

func TestTriangle(t *testing.T) {
  tests := []struct{ a, b, c int }{
    {3, 4, 5},
    {5, 12, 13},
    {8, 15, 17},
    {12, 35, 37},
    {30000, 40000, 0},
  }

  <span style="color: #a020f0;">for</span> _, tt := range tests {
    <span style="color: #a020f0;">if</span> actual := calcTriangle(tt.a, tt.b); actual != tt.c {
      t.Errorf(<span style="color: #8b2252;">"calcTriangle(%d, %d); got %d; expected %d"</span>,
        tt.a, tt.b, actual, tt.c)
    }
  }
}
</pre>
</div>
<p>
è¿è¡Œæµ‹è¯•
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#36827;&#20837;&#21040;&#34987;&#27979;&#30446;&#24405;&#65292; &#25191;&#34892;go test .</span>
<span style="color: #483d8b;">cd</span> basic/basic
PS D:\project\learngo\basic\basic&gt; go test .
--- FAIL: TestTriangle (0.00s)
    triangle_test.go:16: calcTriangle(30000, 40000); got 50000; expected 0
FAIL
FAIL    xxx.com/jasper/learngo/basic/basic      0.311s
</pre>
</div>

<p>
èŒƒä¾‹2ï¼šæ±‚æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²
</p>
<div class="org-src-container">
<pre class="src src-sh">// leedcode/nonrepeatingsubstr/nonrepeating.go

package main

import <span style="color: #8b2252;">"fmt"</span>

func lengthOfNonRepeatingSubStr(s string) int {
  lastOccurred := make(map[rune]int) // &#27599;&#20010;&#23383;&#27597;&#26368;&#21518;&#20986;&#29616;&#30340;&#20301;&#32622;
  start := 0                         // &#24403;&#21069;&#25214;&#21040;&#30340;&#26368;&#38271;&#19981;&#21547;&#26377;&#23383;&#31526;&#30340;&#23376;&#20018;&#24320;&#22987;
  maxLength := 0                     // &#37325;&#22797;&#23376;&#20018;&#30340;&#26368;&#22823;&#38271;&#24230;
  // &#36941;&#21382;&#23383;&#31526;&#20018;
  <span style="color: #a020f0;">for</span> i, ch := range []rune(s) {

    <span style="color: #a020f0;">if</span> lastI, ok := lastOccurred[ch]; ok &amp;&amp; lastI &gt;= start { // lastOccurred[ch]&#21487;&#33021;&#26159;&#19981;&#23384;&#22312;&#30340;&#23427;&#30340;&#20540;&#26159;0&#65292;0&#21442;&#19982;&#19979;&#38754;&#30340;&#36816;&#31639;&#26159;&#19981;&#23545;&#30340;
      start = lastOccurred[ch] + 1
    }

    <span style="color: #a020f0;">if</span> i-start+1 &gt; maxLength { // &#26356;&#26032;maxLength
      maxLength = i - start + 1
    }

    lastOccurred[ch] = i
  }

  <span style="color: #a020f0;">return</span> maxLength
}

func main() {
  fmt.Println(
    lengthOfNonRepeatingSubStr(<span style="color: #8b2252;">"abccabcbb"</span>))
  fmt.Println(
    lengthOfNonRepeatingSubStr(<span style="color: #8b2252;">"pwwkewwe"</span>))
  fmt.Println(
    lengthOfNonRepeatingSubStr(<span style="color: #8b2252;">""</span>))
  fmt.Println(
    lengthOfNonRepeatingSubStr(<span style="color: #8b2252;">"b"</span>))
  fmt.Println(
    lengthOfNonRepeatingSubStr(<span style="color: #8b2252;">"&#19968;&#20108;&#19977;&#20108;&#19968;"</span>))
}


// leedcode/nonrepeatingsubstr/nonrepeating_test.go

package main

import <span style="color: #8b2252;">"testing"</span>

func TestSubstr(t *testing.T) {
  tests := []struct {
    s   string
    ans int
  }{
    // Normal cases &#19968;&#33324;&#20363;&#23376;
    {<span style="color: #8b2252;">"abccabcbb"</span>, 3},
    {<span style="color: #8b2252;">"pwwkewwe"</span>, 3},

    // Edg cases &#29305;&#27530;&#20363;&#23376;
    {<span style="color: #8b2252;">""</span>, 0},
    {<span style="color: #8b2252;">"b"</span>, 1},
    {<span style="color: #8b2252;">"bbbb"</span>, 1},
    {<span style="color: #8b2252;">"abcabcabcd"</span>, 4},

    // Chinese support
    {<span style="color: #8b2252;">"&#36825;&#37324;&#26159;"</span>, 3},
    {<span style="color: #8b2252;">"&#19968;&#20108;&#19977;&#20108;&#19968;"</span>, 3},
    {<span style="color: #8b2252;">"&#40657;&#21270;&#40657;&#28784;&#21270;&#32933;&#40657;&#28784;&#20250;&#25381;&#21457;&#21457;&#28784;&#40657;&#21270;&#32933;&#40657;&#28784;&#21270;&#32933;&#25381;&#21457;"</span>, 0},
  }

  <span style="color: #a020f0;">for</span> _, tt := range tests {
    actual := lengthOfNonRepeatingSubStr(tt.s)
    <span style="color: #a020f0;">if</span> actual != tt.ans {
      t.Errorf(<span style="color: #8b2252;">"got %d for input %s; "</span>+
        <span style="color: #8b2252;">"expect %d"</span>,
        actual, tt.s, tt.ans)
    }
  }
}
</pre>
</div>
<p>
è¿è¡Œæµ‹è¯•
</p>
<div class="org-src-container">
<pre class="src src-sh">PS D:\project\learngo\basic\basic&gt; cd ..<span style="color: #8b2252;">\.</span>.\leedcode\nonrepeatingsubstr<span style="color: #8b2252;">\</span>

PS D:\project\learngo\leedcode\nonrepeatingsubstr&gt; go test .
--- FAIL: TestSubstr (0.00s)
    nonrepeating_test.go:29: got 7 for input &#40657;&#21270;&#40657;&#28784;&#21270;&#32933;&#40657;&#28784;&#20250;&#25381;&#21457;&#21457;&#28784;&#40657;&#21270;&#32933;&#40657;&#28784;&#21270;&#32933;&#25381;&#21457;; expect 0
FAIL
FAIL    xxx.com/jasper/learngo/leedcode/nonrepeatingsubstr      0.245s
FAIL
</pre>
</div>
</div>
</div>
<div id="outline-container-org994d207" class="outline-3">
<h3 id="org994d207">ä»£ç è¦†ç›–ç‡å’Œæ€§èƒ½æµ‹è¯•</h3>
<div class="outline-text-3" id="text-org994d207">
</div>
<div id="outline-container-orgca92d46" class="outline-4">
<h4 id="orgca92d46">ä»£ç è¦†ç›–ç‡</h4>
<div class="outline-text-4" id="text-orgca92d46">
<p>
å‘½ä»¤è¡Œ
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">1.&#29983;&#25104;&#20195;&#30721;&#35206;&#30422;&#29575;&#25991;&#20214;&#65306;</span>
go test -coverprofile=<span style="color: #8b2252;">"c.out"</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25110;&#32773; go test -cover</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">2. &#20351;&#29992;go tool &#26597;&#30475;&#65292;&#19979;&#38754;&#20197;&#39029;&#38754;&#26041;&#24335;&#26597;&#30475;&#20026;&#20363;</span>
go tool cover -html=<span style="color: #8b2252;">"c.out"</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#32511;&#33394;&#26159;cover&#21040;&#30340;&#65292;&#32418;&#33394;&#26159;&#27809;&#26377;cover&#21040;&#30340;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org00e324d" class="outline-4">
<h4 id="org00e324d">æ€§èƒ½æµ‹è¯•</h4>
<div class="outline-text-4" id="text-org00e324d">
<ul class="org-ul">
<li>å‡½æ•°åï¼š`Benchmark*`å¼€å¤´</li>
<li><p>
å‘½ä»¤è¡Œï¼š
</p>
<div class="org-src-container">
<pre class="src src-sh">go test -bench .
</pre>
</div></li>
</ul>

<p>
èŒƒä¾‹ï¼šæ±‚æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²
</p>
<div class="org-src-container">
<pre class="src src-sh">// leedcode/nonrepeatingsubstr/nonrepeating_test.go

package main

import <span style="color: #8b2252;">"testing"</span>

func TestSubstr(t *testing.T) {
  tests := []struct {
    s   string
    ans int
  }{
    // Normal cases &#19968;&#33324;&#20363;&#23376;
    {<span style="color: #8b2252;">"abccabcbb"</span>, 3},
    {<span style="color: #8b2252;">"pwwkewwe"</span>, 3},

    // Edg cases &#29305;&#27530;&#20363;&#23376;
    {<span style="color: #8b2252;">""</span>, 0},
    {<span style="color: #8b2252;">"b"</span>, 1},
    {<span style="color: #8b2252;">"bbbb"</span>, 1},
    {<span style="color: #8b2252;">"abcabcabcd"</span>, 4},

    // Chinese support
    {<span style="color: #8b2252;">"&#36825;&#37324;&#26159;"</span>, 3},
    {<span style="color: #8b2252;">"&#19968;&#20108;&#19977;&#20108;&#19968;"</span>, 3},
    {<span style="color: #8b2252;">"&#40657;&#21270;&#40657;&#28784;&#21270;&#32933;&#40657;&#28784;&#20250;&#25381;&#21457;&#21457;&#28784;&#40657;&#21270;&#32933;&#40657;&#28784;&#21270;&#32933;&#25381;&#21457;"</span>, 7},
  }

  <span style="color: #a020f0;">for</span> _, tt := range tests {
    actual := lengthOfNonRepeatingSubStr(tt.s)
    <span style="color: #a020f0;">if</span> actual != tt.ans {
      t.Errorf(<span style="color: #8b2252;">"got %d for input %s; "</span>+
        <span style="color: #8b2252;">"expect %d"</span>,
        actual, tt.s, tt.ans)
    }
  }
}

func BenchmarkSubstr(b *testing.B) {
  // &#36825;&#37324;&#36873;&#19968;&#20010;&#27604;&#36739;&#38590;&#30340;&#26469;&#31034;&#20363;
  s, ans := <span style="color: #8b2252;">"&#40657;&#21270;&#40657;&#28784;&#21270;&#32933;&#40657;&#28784;&#20250;&#25381;&#21457;&#21457;&#28784;&#40657;&#21270;&#32933;&#40657;&#28784;&#21270;&#32933;&#25381;&#21457;"</span>, 7

  <span style="color: #a020f0;">for</span> i := 0; i &lt; b.N; i++ { // b.N &#31995;&#32479;&#20915;&#23450;&#20570;&#22810;&#23569;&#36941;
    actual := lengthOfNonRepeatingSubStr(s)
    <span style="color: #a020f0;">if</span> actual != ans {
      b.Errorf(<span style="color: #8b2252;">"got %d for input %s; "</span>+
        <span style="color: #8b2252;">"expect %d"</span>,
        actual, s, ans)
    }
  }
}
</pre>
</div>
<p>
è¿è¡Œæ€§èƒ½æµ‹è¯•
</p>
<div class="org-src-container">
<pre class="src src-sh">PS D:\project\learngo\leedcode\nonrepeatingsubstr&gt; go test -bench .
goos: windows
goarch: amd64
pkg: xxx.com/jasper/learngo/leedcode/nonrepeatingsubstr
cpu: Intel(R) Core(TM) i7-6700HQ CPU @ 2.60GHz
BenchmarkSubstr-8        1488318               815.3 ns/op
PASS
ok      xxx.com/jasper/learngo/leedcode/nonrepeatingsubstr      2.290s

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36305;&#20102;1488318&#27425;, &#27599;&#27425;&#29992;&#26102; 815.3&#32435;&#31186;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org14604c2" class="outline-3">
<h3 id="org14604c2">ä½¿ç”¨pprofè¿›è¡Œæ€§èƒ½è°ƒä¼˜</h3>
<div class="outline-text-3" id="text-org14604c2">
<p>
èŒƒä¾‹ï¼šå¢åŠ æ±‚æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²éš¾åº¦
</p>
<div class="org-src-container">
<pre class="src src-sh"> // leedcode/nonrepeatingsubstr/nonrepeating_test.go
func BenchmarkSubstr(b *testing.B) {
  // &#36825;&#37324;&#36873;&#19968;&#20010;&#27604;&#36739;&#38590;&#30340;&#26469;&#31034;&#20363;
  s, ans := <span style="color: #8b2252;">"&#40657;&#21270;&#40657;&#28784;&#21270;&#32933;&#40657;&#28784;&#20250;&#25381;&#21457;&#21457;&#28784;&#40657;&#21270;&#32933;&#40657;&#28784;&#21270;&#32933;&#25381;&#21457;"</span>, 7
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 13; i++ { // &#22686;&#21152;s&#38271;&#24230;
    s = s + s
  }

  b.Logf(<span style="color: #8b2252;">"len(s) = %d"</span>, len(s)) //&#26597;&#30475;s&#30340;&#38271;&#24230; b.Logf()&#36755;&#20986;&#26085;&#24535;
  b.ResetTimer() // &#37325;&#32622;&#26102;&#38388;&#65292;&#25490;&#38500;&#19978;&#38754;&#20934;&#22791;&#25968;&#25454;&#30340;&#26102;&#38388;

  <span style="color: #a020f0;">for</span> i := 0; i &lt; b.N; i++ { // b.N &#31995;&#32479;&#20915;&#23450;&#20570;&#22810;&#23569;&#36941;
    actual := lengthOfNonRepeatingSubStr(s)
    <span style="color: #a020f0;">if</span> actual != ans {
      b.Errorf(<span style="color: #8b2252;">"got %d for input %s; "</span>+
        <span style="color: #8b2252;">"expect %d"</span>,
        actual, s, ans)
    }
  }
}
</pre>
</div>
<p>
å¢åŠ å­—ç¬¦ä¸²é•¿åº¦åï¼Œç”¨æ—¶
</p>
<div class="org-src-container">
<pre class="src src-sh">PS D:\project\learngo\leedcode\nonrepeatingsubstr&gt; go test -bench .
goos: windows
goarch: amd64
pkg: xxx.com/jasper/learngo/leedcode/nonrepeatingsubstr
cpu: Intel(R) Core(TM) i7-6700HQ CPU @ 2.60GHz
BenchmarkSubstr-8            187           6298157 ns/op
--- BENCH: BenchmarkSubstr-8
    nonrepeating_test.go:43: len(s) = 540672
    nonrepeating_test.go:43: len(s) = 540672
    nonrepeating_test.go:43: len(s) = 540672
PASS
ok      xxx.com/jasper/learngo/leedcode/nonrepeatingsubstr      2.121s

<span style="color: #b22222;"># </span><span style="color: #b22222;">187&#27425;&#65292;&#27599;&#27425;6ms&#24038;&#21491;</span>
</pre>
</div>

<p>
æ‰¾åˆ°è¿è¡Œæ…¢çš„åœ°æ–¹
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#36305;&#24615;&#33021;&#27979;&#35797;&#30340;&#21516;&#26102;&#65292;&#29983;&#25104;cpu&#32791;&#26102;&#20108;&#36827;&#21046;&#25991;&#20214;</span>
go test -bench . -cpuprofile=<span style="color: #8b2252;">"cpu.out"</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992;go tool pprof &#26597;&#30475;&#65292; &#22312;&#20132;&#20114;&#24335;&#37324;&#29983;&#25104;&#22270;&#29255;&#26597;&#30475;</span>
go tool pprof cpu.out
(pprof) <span style="color: #483d8b;">help</span>
(pprof) web
</pre>
</div>
<p>
ä½¿ç”¨webç”Ÿæˆå›¾ç‰‡å‰ï¼Œæå‰å®‰è£…<a href="https://graphviz.org/download/">graphviz</a>å·¥å…·
å›¾ç‰‡ä¸­å±•ç¤ºä¿¡æ¯ï¼š
</p>
<ul class="org-ul">
<li>æ–¹æ¡†è¶Šå¤§è¶ŠèŠ±æ—¶é—´</li>
<li>ç®­å¤´è¶Šç²—è¶ŠèŠ±æ—¶é—´</li>
</ul>

<p>
ä¼˜åŒ–èŠ±æ—¶é—´å¤šçš„åœ°æ–¹
ä»¥ä¸Šé¢ä»£ç â€œæ±‚ä¸é‡å¤çš„æœ€é•¿å­ä¸²â€ä¸ºä¾‹ï¼Œéœ€è¦ä¼˜åŒ–3å—åœ°æ–¹
</p>
<ul class="org-ul">
<li>runtime &#x2013; stringoslicerune &#x2013; decoderune
stringåœ¨è½¬æˆ`[]rune`æ—¶ï¼Œä¸­é—´æœ‰decodeè¿‡ç¨‹ï¼Œä¸å¯é¿å…ï¼Œæ— æ³•ä¼˜åŒ–</li>
<li>runtime &#x2013; mapassign_fast32  `lastOccurred[ch] = i` å¯ä¼˜åŒ–</li>
<li>runtime &#x2013; mapaccess2_fast32 `lastoccurred[ch]` å¯ä¼˜åŒ–</li>
</ul>
<p>
ä¼˜åŒ–mapï¼Œç”¨å…¶å®ƒçš„æ•°æ®ç»“æ„å­˜
</p>
<div class="org-src-container">
<pre class="src src-sh">// leedcode/nonrepeatingsubstr/nonrepeating.go

func lengthOfNonRepeatingSubStr(s string) int {
  // lastOccurred := make(map[rune]int) // &#27599;&#20010;&#23383;&#27597;&#26368;&#21518;&#20986;&#29616;&#30340;&#20301;&#32622;
  lastOccurred := make([]int, 0xffff) // &#23545;&#20110;&#23383;&#31526;&#22411;map&#20248;&#21270;&#30340;&#26041;&#27861;&#65292;&#29992;&#31354;&#38388;&#25442;&#26102;&#38388;&#65292;c++
  // lastOccurred[<span style="color: #8b2252;">'e'</span>] = 1 // lastOccurred[0x65] = 1
  // lastOccurred[<span style="color: #8b2252;">'&#35838;'</span>] = 6 // lastOccurred[0x8BFE] = 6
  <span style="color: #a020f0;">for</span> i := range lastOccurred { // &#21021;&#22987;&#20540;&#35774;&#32622;&#20026; -1
    lastOccurred[i] = -1
  }

  start := 0
  maxLength := 0

  <span style="color: #a020f0;">for</span> i, ch := range []rune(s) {

    <span style="color: #a020f0;">if</span> lastI := lastOccurred[ch]; lastI != -1 &amp;&amp; lastI &gt;= start {  // &#21028;&#26029;
      start = lastOccurred[ch] + 1
    }

    <span style="color: #a020f0;">if</span> i-start+1 &gt; maxLength {
      maxLength = i - start + 1
    }

    lastOccurred[ch] = i
  }

  <span style="color: #a020f0;">return</span> maxLength
}
</pre>
</div>
<p>
è¿è¡Œæ€§èƒ½æµ‹è¯•
</p>
<div class="org-src-container">
<pre class="src src-sh">PS D:\project\learngo\leedcode\nonrepeatingsubstr&gt; go test -bench . -cpuprofile=<span style="color: #8b2252;">"cpu.out"</span>
goos: windows
goarch: amd64
pkg: xxx.com/jasper/learngo/leedcode/nonrepeatingsubstr
cpu: Intel(R) Core(TM) i7-6700HQ CPU @ 2.60GHz
BenchmarkSubstr-8            435           3457264 ns/op
--- BENCH: BenchmarkSubstr-8
    nonrepeating_test.go:43: len(s) = 540672
    nonrepeating_test.go:43: len(s) = 540672
    nonrepeating_test.go:43: len(s) = 540672
PASS
ok      xxx.com/jasper/learngo/leedcode/nonrepeatingsubstr      2.190s

<span style="color: #b22222;"># </span><span style="color: #b22222;">435&#27425;&#65292;&#27599;&#27425;3ms&#24038;&#21491;&#65292;&#24555;&#20102;2&#20493;&#24038;&#21491;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20877;&#30475;&#19968;&#19979;&#24615;&#33021;&#22270;</span>
go test -bench . -cpuprofile=<span style="color: #8b2252;">"cpu.out"</span>
go tool pprof cpu.out
(pprof) web
</pre>
</div>
<p>
è¿˜å¯ä»¥å†ä¼˜åŒ–ï¼šruntime &#x2013; makeslice
</p>
<div class="org-src-container">
<pre class="src src-sh">// &#20462;&#25913; leedcode/nonrepeatingsubstr/nonrepeating.go
var lastOccurred = make([]int, 0xffff) // &#25552;&#21040;&#20989;&#25968;&#22806;&#38754;

func lengthOfNonRepeatingSubStr(s string) int {

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36816;&#34892;&#24615;&#33021;&#27979;&#35797;</span>
go test -bench . -cpuprofile=<span style="color: #8b2252;">"cpu.out"</span>
go tool pprof cpu.out
(pprof) web
</pre>
</div>
<p>
ç°åœ¨æ—¶é—´éƒ½èŠ±åœ¨ runtime &#x2013; stringoslicerune &#x2013; decoderuneä¸Šäº†ï¼Œæ²¡æœ‰ä¼˜åŒ–ç©ºé—´äº†
</p>
</div>
<div id="outline-container-org2c6a83d" class="outline-4">
<h4 id="org2c6a83d">æ€§èƒ½è°ƒä¼˜æ¨¡å¼</h4>
<div class="outline-text-4" id="text-org2c6a83d">
<ul class="org-ul">
<li>`-cpuprofile`è·å–æ€§èƒ½æ•°æ®</li>
<li>`go tool pprof`æŸ¥çœ‹æ€§èƒ½æ•°æ®
<ul class="org-ul">
<li>webå‘½ä»¤å¯çœ‹å¯è§†åŒ–å›¾å½¢</li>
</ul></li>
<li>åˆ†ææ…¢åœ¨å“ªé‡Œ
<ul class="org-ul">
<li>æ¡†æœ€å¤§çš„æ…¢</li>
</ul></li>
<li>ä¼˜åŒ–ä»£ç </li>
<li>é‡å¤åŠ¨ä½œ</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org4c6b70a" class="outline-3">
<h3 id="org4c6b70a">æµ‹è¯•httpæœåŠ¡å™¨</h3>
<div class="outline-text-3" id="text-org4c6b70a">
<p>
èŒƒä¾‹ï¼šæµ‹è¯•è·Ÿä¸šåŠ¡æ²¡æœ‰é€»è¾‘çš„å‡ºé”™å¤„ç†
å°†å‡ºé”™çš„è¿”å›å€¼æ¥ä¸‹æ¥
</p>
<div class="org-src-container">
<pre class="src src-sh">// learngo\errhandling\filelistingserver/errwrapper_test.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"errors"</span>
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"io/ioutil"</span>
  <span style="color: #8b2252;">"net/http"</span>
  <span style="color: #8b2252;">"net/http/httptest"</span>
  <span style="color: #8b2252;">"os"</span>
  <span style="color: #8b2252;">"strings"</span>
  <span style="color: #8b2252;">"testing"</span>
)

func errPanic(writer http.ResponseWriter, request *http.Request) error { // &#36755;&#20837;&#20989;&#25968;&#65306;&#20250;panicw&#20449;&#24687;&#30340;&#20989;&#25968;
  panic(123)
}

// &#21306;&#20998;&#29992;&#25143;&#20449;&#24687;&#65306;&#23450;&#20041;userError&#31867;&#22411;
<span style="color: #483d8b;">type</span> testingUserError string

<span style="color: #0000ff;">func</span> (e testingUserError) Error() string {
  <span style="color: #a020f0;">return</span> e.Message()
}

<span style="color: #0000ff;">func</span> (e testingUserError) Message() string {
  <span style="color: #a020f0;">return</span> string(e)
}
func errUserError(writer http.ResponseWriter, request *http.Request) error { // &#36755;&#20837;&#20989;&#25968;&#65306;&#29992;&#25143;&#38169;&#35823;&#20449;&#24687;&#30340;&#20989;&#25968;
  <span style="color: #a020f0;">return</span> testingUserError(<span style="color: #8b2252;">"user error"</span>)
}

func errNotFound(writer http.ResponseWriter, request *http.Request) error { // &#36755;&#20837;&#20989;&#25968;&#65306;&#25991;&#20214;&#19981;&#23384;&#22312;&#38169;&#35823;&#20449;&#24687;&#30340;&#20989;&#25968;
  <span style="color: #a020f0;">return</span> os.ErrNotExist
}

func errPermission(writer http.ResponseWriter, request *http.Request) error { // &#36755;&#20837;&#20989;&#25968;&#65306;&#26435;&#38480;&#38169;&#35823;&#20449;&#24687;&#30340;&#20989;&#25968;
  <span style="color: #a020f0;">return</span> os.ErrPermission
}

func errUnkown(writer http.ResponseWriter, request *http.Request) error { // &#36755;&#20837;&#20989;&#25968;&#65306;500&#38169;&#35823;&#20449;&#24687;&#30340;&#20989;&#25968;
  <span style="color: #a020f0;">return</span> errors.New(<span style="color: #8b2252;">"unknown err"</span>)
}

func noError(writer http.ResponseWriter, request *http.Request) error { // &#36755;&#20837;&#20989;&#25968;&#65306;&#27809;&#26377;&#38169;&#35823;&#20449;&#24687;&#30340;&#20989;&#25968;
  fmt.Fprintln(writer, <span style="color: #8b2252;">"no error"</span>)
  <span style="color: #a020f0;">return</span> nil
}

func TestErrWrapper(t *testing.T) {
  tests := []struct {
    h       appHandler // &#36755;&#20837;&#30340;&#26159;&#20989;&#25968;
    code    int        // &#26399;&#26395;&#30340;&#36755;&#20986;&#65306;&#29366;&#24577;&#30721;
    message string     // &#26399;&#26395;&#30340;&#36755;&#20986;&#65306;&#20449;&#24687;
  }{
    {errPanic, 500, <span style="color: #8b2252;">"Internal Server Error"</span>},
    {errUserError, 400, <span style="color: #8b2252;">"user error"</span>},
    {errNotFound, 404, <span style="color: #8b2252;">"Not Found"</span>},
    {errPermission, 403, <span style="color: #8b2252;">"Forbidden"</span>},
    {errUnkown, 500, <span style="color: #8b2252;">"Internal Server Error"</span>},
    {noError, 200, <span style="color: #8b2252;">"no error"</span>},
  }

  <span style="color: #a020f0;">for</span> _, tt := range tests {
    f := errWrapper(tt.h)
    response := httptest.NewRecorder()
    request := httptest.NewRequest(
      http.MethodGet,
      <span style="color: #8b2252;">"http://www.immoc.com"</span>,
      nil)
    f(response, request) // &#35843;&#29992;&#20986;&#38169;&#20989;&#25968;
    b, _ := ioutil.ReadAll(response.Body)
    body := strings.Trim(string(b), <span style="color: #8b2252;">"\n"</span>) // &#25226;string&#20013;&#30340;&#25442;&#34892;&#21435;&#25481;
    <span style="color: #a020f0;">if</span> response.Code != tt.code ||
      body != tt.message {
      t.Errorf(<span style="color: #8b2252;">"expect (%d, %s); "</span>+
        <span style="color: #8b2252;">"got (%d, %s)"</span>,
        tt.code, tt.message,
        response.Code, body)
    }
  }
}


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;&#19968;&#19979;&#21738;&#20123;&#20195;&#30721;&#27809;&#26377;&#35206;&#30422;&#21040;</span>
go test -coverprofile=<span style="color: #8b2252;">"c.out"</span>
go tool cover -html=<span style="color: #8b2252;">"c.out"</span>

</pre>
</div>

<p>
çœŸå®è¯·æ±‚
</p>
<div class="org-src-container">
<pre class="src src-sh">// &#20462;&#25913; learngo\errhandling\filelistingserver/errwrapper_test.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"errors"</span>
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"io/ioutil"</span>
  <span style="color: #8b2252;">"net/http"</span>
  <span style="color: #8b2252;">"net/http/httptest"</span>
  <span style="color: #8b2252;">"os"</span>
  <span style="color: #8b2252;">"strings"</span>
  <span style="color: #8b2252;">"testing"</span>
)

func errPanic(writer http.ResponseWriter, request *http.Request) error { // &#36755;&#20837;&#20989;&#25968;&#65306;&#20250;panicw&#20449;&#24687;&#30340;&#20989;&#25968;
  panic(123)
}

// &#21306;&#20998;&#29992;&#25143;&#20449;&#24687;&#65306;&#23450;&#20041;userError&#31867;&#22411;
<span style="color: #483d8b;">type</span> testingUserError string

<span style="color: #0000ff;">func</span> (e testingUserError) Error() string {
  <span style="color: #a020f0;">return</span> e.Message()
}

<span style="color: #0000ff;">func</span> (e testingUserError) Message() string {
  <span style="color: #a020f0;">return</span> string(e)
}
func errUserError(writer http.ResponseWriter, request *http.Request) error { // &#36755;&#20837;&#20989;&#25968;&#65306;&#29992;&#25143;&#38169;&#35823;&#20449;&#24687;&#30340;&#20989;&#25968;
  <span style="color: #a020f0;">return</span> testingUserError(<span style="color: #8b2252;">"user error"</span>)
}

func errNotFound(writer http.ResponseWriter, request *http.Request) error { // &#36755;&#20837;&#20989;&#25968;&#65306;&#25991;&#20214;&#19981;&#23384;&#22312;&#38169;&#35823;&#20449;&#24687;&#30340;&#20989;&#25968;
  <span style="color: #a020f0;">return</span> os.ErrNotExist
}

func errPermission(writer http.ResponseWriter, request *http.Request) error { // &#36755;&#20837;&#20989;&#25968;&#65306;&#26435;&#38480;&#38169;&#35823;&#20449;&#24687;&#30340;&#20989;&#25968;
  <span style="color: #a020f0;">return</span> os.ErrPermission
}

func errUnkown(writer http.ResponseWriter, request *http.Request) error { // &#36755;&#20837;&#20989;&#25968;&#65306;500&#38169;&#35823;&#20449;&#24687;&#30340;&#20989;&#25968;
  <span style="color: #a020f0;">return</span> errors.New(<span style="color: #8b2252;">"unknown err"</span>)
}

func noError(writer http.ResponseWriter, request *http.Request) error { // &#36755;&#20837;&#20989;&#25968;&#65306;&#27809;&#26377;&#38169;&#35823;&#20449;&#24687;&#30340;&#20989;&#25968;
  fmt.Fprintln(writer, <span style="color: #8b2252;">"no error"</span>)
  <span style="color: #a020f0;">return</span> nil
}

var tests = []struct { // &#27979;&#35797;&#25968;&#25454;&#20849;&#29992;
  h       appHandler // &#36755;&#20837;&#30340;&#26159;&#20989;&#25968;
  code    int        // &#26399;&#26395;&#30340;&#36755;&#20986;&#65306;&#29366;&#24577;&#30721;
  message string     // &#26399;&#26395;&#30340;&#36755;&#20986;&#65306;&#20449;&#24687;
}{
  {errPanic, 500, <span style="color: #8b2252;">"Internal Server Error"</span>},
  {errUserError, 400, <span style="color: #8b2252;">"user error"</span>},
  {errNotFound, 404, <span style="color: #8b2252;">"Not Found"</span>},
  {errPermission, 403, <span style="color: #8b2252;">"Forbidden"</span>},
  {errUnkown, 500, <span style="color: #8b2252;">"Internal Server Error"</span>},
  {noError, 200, <span style="color: #8b2252;">"no error"</span>},
}

func TestErrWrapper(t *testing.T) { // &#20551;&#25968;&#25454;

  <span style="color: #a020f0;">for</span> _, tt := range tests {
    f := errWrapper(tt.h)
    response := httptest.NewRecorder() // &#25552;&#20379;&#20551;&#25968;&#25454;
    request := httptest.NewRequest(
      http.MethodGet,
      <span style="color: #8b2252;">"http://www.immoc.com"</span>,
      nil)
    f(response, request) // &#35843;&#29992;&#20986;&#38169;&#20989;&#25968;
    verifyResponse(
      response.Result(), tt.code, tt.message, t)
  }
}

func TestErrWrapperInServer(t *testing.T) {  // &#21551;&#19968;&#20010;server&#65292;&#30495;&#23454;url&#35775;&#38382;&#35831;&#27714;
  <span style="color: #a020f0;">for</span> _, tt := range tests {
    f := errWrapper(tt.h)
    server := httptest.NewServer(
      http.HandlerFunc(f))
    resp, _ := http.Get(server.URL)

    verifyResponse(
      resp, tt.code, tt.message, t)
  }
}

func verifyResponse(resp *http.Response,
  expectCode int, expectMsssage string,
  t *testing.T) {
  b, _ := ioutil.ReadAll(resp.Body)
  body := strings.Trim(string(b), <span style="color: #8b2252;">"\n"</span>) // &#25226;string&#20013;&#30340;&#25442;&#34892;&#21435;&#25481;
  <span style="color: #a020f0;">if</span> resp.StatusCode != expectCode ||
    body != expectMsssage {
    t.Errorf(<span style="color: #8b2252;">"expect (%d, %s); "</span>+
      <span style="color: #8b2252;">"got (%d, %s)"</span>,
      expectCode, expectMsssage,
      resp.StatusCode, body)
  }
}


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36816;&#34892;&#27979;&#35797;</span>
PS D:\project\learngo\errhandling\filelistingserver&gt; go test -run=<span style="color: #8b2252;">"TestErrWrapperInServer$"</span>
2021/11/12 22:26:45 Panic: 123
2021/11/12 22:26:45 Error handing request: user error
2021/11/12 22:26:45 Error handing request: file does not exist
2021/11/12 22:26:45 Error handing request: permission denied
2021/11/12 22:26:45 Error handing request: unknown err
PASS
ok      xxx.com/jasper/learngo/errhandling/filelistingserver    0.302s
</pre>
</div>
<p>
æµ‹è¯•ä»£ç å°±æ˜¯å †èµ·æ¥çš„ï¼Œç»´æŠ¤èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿
</p>
</div>
<div id="outline-container-org7fa0195" class="outline-4">
<h4 id="org7fa0195">httpæµ‹è¯•å°ç»“</h4>
<div class="outline-text-4" id="text-org7fa0195">
<ul class="org-ul">
<li>é€šè¿‡ä½¿ç”¨å‡çš„Request/Response
ä¼˜ç‚¹ï¼šé€Ÿåº¦å¿«ï¼Œæµ‹è¯•ç²’åº¦ç»†ï¼Œæ›´åƒå•å…ƒæµ‹è¯•åªæ˜¯æµ‹è¯•æŸä¸ªå‡½æ•°</li>
<li>é€šè¿‡èµ·æœåŠ¡å™¨
ä¼˜ç‚¹ï¼šä»£ç è¦†ç›–é‡å¤§ã€‚ ç¼ºç‚¹ï¼šæ…¢</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgd8fec09" class="outline-3">
<h3 id="orgd8fec09">ç”Ÿæˆæ–‡æ¡£å’Œç¤ºä¾‹ä»£ç </h3>
<div class="outline-text-3" id="text-orgd8fec09">
</div>
<div id="outline-container-orgd29ad01" class="outline-4">
<h4 id="orgd29ad01">`go doc` å’Œ `godoc` å‘½ä»¤</h4>
<div class="outline-text-4" id="text-orgd29ad01">
<p>
`go doc`æŸ¥çœ‹æ–‡æ¡£
</p>
<div class="org-src-container">
<pre class="src src-sh">PS D:\project\learngo\queue&gt; go doc    // &#24403;&#21069;&#30446;&#24405;&#19979;&#30340;&#25991;&#26723;
package queue // import <span style="color: #8b2252;">"xxx.com/jasper/learngo/queue"</span>

<span style="color: #483d8b;">type</span> Queue []int

PS D:\project\learngo\queue&gt; go doc Queue

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26174;&#31034;&#33258;&#24102;&#21253;&#20013;&#30340;&#25991;&#26723;</span>
go doc json.Decoder.Decode
PS D:\project\learngo\queue&gt; go doc fmt.Println
package fmt // import <span style="color: #8b2252;">"fmt"</span>

func Println(a ...interface{}) (n int, err error)
    Println formats using the default formats for its operands and writes to
    standard output. Spaces are always added between operands and a newline is
    appended. It returns the number of bytes written and any write error
    encountered.
</pre>
</div>

<p>
`godoc` ç”Ÿæˆæ–‡æ¡£
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">1. godoc&#23433;&#35013;</span>
go get golang.org/x/tools/cmd/godoc
go install golang.org/x/tools/cmd/godoc
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;&#20108;&#36827;&#21046;&#25991;&#20214;&#25918;&#21040;$GOROOT/bin&#19979;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">2. &#39029;&#38754;&#35775;&#38382; http://localhost:6060</span>
godoc -http :6060
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#25214;&#21040;&#25105;&#20204;&#33258;&#24049;&#20889;&#30340;&#25991;&#26723;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcae339f" class="outline-4">
<h4 id="orgcae339f">ç”¨æ³¨é‡Šå†™æ–‡æ¡£</h4>
<div class="outline-text-4" id="text-orgcae339f">
<p>
æ³¨é‡Šå¯ä»¥è‡ªåŠ¨è½¬æˆæ–‡æ¡£
</p>
<div class="org-src-container">
<pre class="src src-sh">// learngo/queue/queue.go

package queue

// An FIFO queue.
<span style="color: #483d8b;">type</span> Queue []int

// Pushes the element into the queue.
//   e.g. q.Push(123) &#31354;&#26684;&#32473;&#25991;&#23383;&#65292;&#26174;&#31034;&#26102;&#20250;&#26694;&#36215;&#26469;
<span style="color: #0000ff;">func</span> (q *Queue) Push(v int) {
  *q = append(*q, v)
}

// Pops element from head.
<span style="color: #0000ff;">func</span> (q *Queue) Pop() int {
  head := (*q)[0]
  *q = (*q)[1:]
  <span style="color: #a020f0;">return</span> head
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org60a1df6" class="outline-4">
<h4 id="org60a1df6">ç”Ÿæˆç¤ºä¾‹ä»£ç </h4>
<div class="outline-text-4" id="text-org60a1df6">
<p>
åœ¨æµ‹è¯•ä¸­åŠ å…¥Example
</p>
<div class="org-src-container">
<pre class="src src-sh">// learngo/queue/queue_test.go

package queue

import <span style="color: #8b2252;">"fmt"</span>

func ExampleQueue_Pop() {
  q := Queue{1}
  q.Push(2)
  q.Push(3)
  fmt.Println(q.Pop())
  fmt.Println(q.Pop())

  // Output:
  // 1
  // 2
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#39029;&#38754;&#20013;&#26597;&#30475;&#31034;&#20363;</span>
godoc -http :6060
</pre>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-orgfb924ab" class="outline-2">
<h2 id="orgfb924ab">goroutine</h2>
<div class="outline-text-2" id="text-orgfb924ab">
</div>
<div id="outline-container-org55df1d4" class="outline-3">
<h3 id="org55df1d4">goroutine</h3>
<div class="outline-text-3" id="text-org55df1d4">
<div class="org-src-container">
<pre class="src src-sh">func main() {
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 1000; i++ {
    go func(i int) {
      <span style="color: #a020f0;">for</span> {
        fmt.Println(<span style="color: #8b2252;">"Hello %d\n"</span>, i)
      }
    }(i)
  }
  time.Sleep(time.Microsecond)
}
</pre>
</div>
<p>
åŠ äº†å…³é”®å­— go ï¼Œå…¶åå‡½æ•°ä¼šå¹¶å‘æ‰§è¡Œã€‚
</p>

<p>
èŒƒä¾‹ï¼šgoroutine
</p>
<div class="org-src-container">
<pre class="src src-sh">// goroutine/goroutine.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"time"</span>
)

func main() {
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 1000; i++ {
    go func(i int) { // i &#24341;&#29992;&#22806;&#38754;&#30340; i &#19981;&#23433;&#20840;&#65292;&#36825;&#37324;&#23558; i &#20256;&#36827;&#26469;
      <span style="color: #a020f0;">for</span> { // &#21453;&#22797;&#25171;&#21360;
        fmt.Printf(<span style="color: #8b2252;">"Hello from goroutine %d\n"</span>, i) // &#35777;&#26126;&#24456;&#22810;&#20154;&#25171;&#65292;&#32473;&#23427;&#35774;&#32622;&#19968;&#20010;&#32534;&#21495;
      }
    }(i)
  }
  // &#36825;&#37324;&#30340; main &#21644; for {} &#26159;&#24182;&#21457;&#25191;&#34892;&#30340;&#65292;&#36824;&#26469;&#19981;&#21450;&#25171;&#21360;&#23601;&#25191;&#34892;&#23436;&#20102;
  // main &#32467;&#26463;&#20102;&#65292;&#25152;&#26377;&#30340; goroutine&#23601;&#34987;&#26432;&#25481;&#20102;
  // &#32473;&#19968;&#23450;&#26102;&#38388;&#35753; for{} &#33021;&#25171;&#20986;&#19996;&#35199;
  time.Sleep(time.Millisecond)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orge1041e6" class="outline-3">
<h3 id="orge1041e6">åç¨‹Coroutine</h3>
<div class="outline-text-3" id="text-orge1041e6">
<p>
goroutineæ˜¯ä¸€ç§åç¨‹ã€‚
</p>
<ul class="org-ul">
<li>è½»é‡çº§â€œçº¿ç¨‹â€
éƒ½æ˜¯å¹¶å‘æ‰§è¡Œä¸œè¥¿çš„</li>
<li>æ˜¯*éæŠ¢å å¼*å¤šä»»åŠ¡å¤„ç†ï¼Œç”±åç¨‹ä¸»åŠ¨äº¤å‡ºæ§åˆ¶æƒ
åªè¦å¤„ç†å…¶ä¸­åˆ‡æ¢çš„å‡ ä¸ªç‚¹å°±å¯ä»¥äº†ï¼Œè¿™ä¸ªå¯¹èµ„æºçš„æ¶ˆè€—å°±ä¼šå°‘ä¸€äº›</li>
<li>æ˜¯ç¼–è¯‘å™¨/è§£é‡Šå™¨/è™šæ‹Ÿæœºå±‚é¢çš„å¤šä»»åŠ¡
<ul class="org-ul">
<li>ä¸æ˜¯æ“ä½œç³»ç»Ÿå±‚é¢çš„å¤šä»»åŠ¡ï¼Œæ“ä½œç³»ç»Ÿå±‚é¢åªæœ‰çº¿ç¨‹æ²¡æœ‰åç¨‹</li>
<li>ç¼–è¯‘å™¨çº§åˆ«çš„å¤šä»»åŠ¡ï¼šç¼–è¯‘å™¨ä¼šæŠŠgo ä¸€ä¸ªfunctionè§£é‡Šæˆä¸€ä¸ªåç¨‹</li>
<li>åœ¨æ‰§è¡Œä¸Šgoè¯­è¨€ä¼šæœ‰ä¸€ä¸ªè°ƒåº¦å™¨è°ƒåº¦åç¨‹</li>
</ul></li>
<li>å¤šåç¨‹å¯èƒ½åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸Šè¿è¡Œ
è¿™ä¸ªæ˜¯ç”±è°ƒåº¦å™¨æ¥å†³å®šçš„</li>
</ul>

<p>
ä»€ä¹ˆæ˜¯â€œéæŠ¢å å¼å¤šä»»åŠ¡â€
æŠ¢å å¼ï¼š`fmt.Printf`æ˜¯ioçš„æ“ä½œï¼Œioçš„æ“ä½œé‡Œä¼šè¿›è¡Œåˆ‡æ¢ï¼Œå› ä¸ºioæ“ä½œæ€»ä¼šæœ‰ç­‰å¾…çš„è¿‡ç¨‹ã€‚
èŒƒä¾‹ï¼š`runtime.Gosched()`äº¤å‡ºæ§åˆ¶æƒ
</p>
<div class="org-src-container">
<pre class="src src-sh">// goroutine/goroutine.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"runtime"</span>
  <span style="color: #8b2252;">"time"</span>
)

func main() {
  var a [10]int
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ {
    go func(i int) {
      <span style="color: #a020f0;">for</span> {
        a[i]++ // &#27809;&#26377;&#26426;&#20250;&#21327;&#31243;&#38388;&#20999;&#25442;&#65292;&#23601;&#20250;&#34987;&#19968;&#20010;&#21327;&#31243;&#25250;&#25481;&#12290;&#19981;&#20027;&#21160;&#20132;&#20986;&#25511;&#21046;&#26435;&#65292;&#23601;&#20250;&#22987;&#32456;&#22312;&#36825;&#20010;&#21327;&#31243;&#20013;
        runtime.Gosched()
      }
    }(i)
  }
  time.Sleep(time.Millisecond)
  fmt.Println(a)
}

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32467;&#26524;</span>
PS D:\project\learngo&gt; go run .\goroutine\goroutine.go
[854 442 626 625 578 564 640 620 537 589]
</pre>
</div>

<p>
`go run -race` æ£€æµ‹æ•°æ®è®¿é—®çš„å†²çª
èŒƒä¾‹ï¼š
</p>
<div class="org-src-container">
<pre class="src src-sh">func main() {
  var a [10]int
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ {
    go func() {
      <span style="color: #a020f0;">for</span> {
        a[i]++
        runtime.Gosched()
      }
    }() // &#35299;&#20915;&#25253;&#38169;&#38656;&#35201;&#22266;&#23450;i&#20540;&#65292;&#21363;&#25226;i&#20256;&#36827;&#20989;&#25968;&#20013;
  }
  time.Sleep(time.Millisecond) // &#21322;&#21253;&#20013; i &#22312;&#36825;&#26159; <span style="color: #a0522d;">i</span>= 10&#65292;a[10]&#26159;&#19981;&#23384;&#22312;&#30340;&#65292;&#26080;&#27861;&#22312;&#38381;&#21253;&#20013;&#36816;&#34892;
  fmt.Println(a)
}

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26816;&#26597;&#25968;&#25454;&#20914;&#31361;</span>
PS D:\project\learngo&gt; go run  -race .\goroutine\goroutine.go
==================
WARNING: DATA RACE
Read at 0x00c00012c078 by goroutine 7:
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfdced21" class="outline-3">
<h3 id="orgfdced21">goè¯­è¨€è°ƒåº¦å™¨</h3>
<div class="outline-text-3" id="text-orgfdced21">
<ul class="org-ul">
<li>å­ç¨‹åºæ˜¯åç¨‹çš„ä¸€ä¸ªç‰¹ä¾‹</li>
</ul>
</div>
<div id="outline-container-orgbeb1970" class="outline-4">
<h4 id="orgbeb1970">æ™®é€šå‡½æ•° vs åç¨‹</h4>
<div class="outline-text-4" id="text-orgbeb1970">
<p>
æ™®é€šå‡½æ•°åœ¨ä¸€ä¸ªçº¿ç¨‹å†…&#x2013; çº¿ç¨‹ä¸­æœ‰mainå‡½æ•°&#x2013; mainå‡½æ•°è°ƒç”¨doWorkå‡½æ•°ï¼Œç­‰doWorkç»“æŸæ‰æŠŠ
æ§åˆ¶æƒäº¤ç»™mainå‡½æ•°
</p>

<p>
åç¨‹ä¹Ÿæ˜¯æœ‰mainå’ŒdoWorkå‡½æ•°ï¼Œä½†ä»–ä»¬ä¹‹é—´ä¸æ˜¯å•å‘çš„ç®­å¤´ï¼Œä»–ä»¬ä¸­é—´æœ‰ä¸ªåŒå‘çš„é€šé“ã€‚
mainå’ŒdoWorkä¹‹é—´æ•°æ®å¯ä»¥è¿›è¡ŒåŒå‘çš„æµé€šã€æ§åˆ¶æƒä¹Ÿå¯ä»¥åŒå‘çš„æµé€šã€‚å°±ç›¸å½“äºå¹¶å‘æ‰§è¡Œ
çš„ä¸¤ä¸ªçº¿ç¨‹ã€‚
mainå’ŒdoWorkå¯èƒ½è¿è¡Œåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ä¹Ÿå¯èƒ½åœ¨å¤šä¸ªçº¿ç¨‹ä¸­ï¼Œè¿™ä¸ªäº‹æƒ…ä¸éœ€è¦ç®¡ï¼Œç”±è°ƒåº¦å™¨è´Ÿè´£ã€‚
</p>
</div>
</div>
<div id="outline-container-org26ad43b" class="outline-4">
<h4 id="org26ad43b">å…¶ä»–è¯­è¨€å¯¹åç¨‹çš„æ”¯æŒ</h4>
<div class="outline-text-4" id="text-org26ad43b">
<p>
å…¶ä»–è¯­è¨€ä¸æ˜¯åŸç”Ÿæ”¯æŒ
</p>
<ul class="org-ul">
<li>c++ ï¼šBoost.Coroutineåº“</li>
<li>java: ä¸æ”¯æŒï¼›ç¬¬ä¸‰æ–¹çš„æœ‰</li>
<li>pythonä¸­çš„åç¨‹
<ul class="org-ul">
<li>ä½¿ç”¨yieldå…³é”®å­—å®ç°åç¨‹</li>
<li>python 3.5åŠ å…¥async defå¯¹åç¨‹åŸç”Ÿæ”¯æŒ</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org3119a96" class="outline-4">
<h4 id="org3119a96">goè¯­è¨€ä¸­çš„åç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</h4>
<div class="outline-text-4" id="text-org3119a96">
<p>
goè¯­è¨€çš„ä¸€ä¸ªè¿›ç¨‹ï¼Œç¨‹åºå¼€å¯åä»–ä¸‹é¢æœ‰ä¸€ä¸ªè°ƒåº¦å™¨ï¼Œè°ƒåº¦å™¨è´Ÿè´£è°ƒåº¦åç¨‹ã€‚
æœ‰äº›åç¨‹æ˜¯1ä¸ªåç¨‹æ”¾åœ¨çº¿ç¨‹ä¸­ã€æœ‰äº›åç¨‹æ˜¯2ä¸ªåç¨‹æ”¾ä¸€ä¸ªçº¿ç¨‹ä¸­ç­‰ï¼Œè¿™äº›æ˜¯è°ƒåº¦å™¨æ¥
æ§åˆ¶çš„ã€‚
</p>
</div>
</div>
<div id="outline-container-org817725b" class="outline-4">
<h4 id="org817725b">goroutineçš„å®šä¹‰</h4>
<div class="outline-text-4" id="text-org817725b">
<ul class="org-ul">
<li>ä»»ä½•å‡½æ•°åªéœ€åŠ ä¸Šgoå…³é”®å­—å°±èƒ½é€ç»™è°ƒåº¦å™¨è¿è¡Œã€‚</li>
<li>å¥½å¤„ï¼šä¸éœ€è¦åœ¨å®šä¹‰æ—¶åŒºåˆ†æ˜¯å¦æ˜¯å¼‚æ­¥å‡½æ•°
è¿™æ˜¯ç›¸å¯¹äºpythonæ¥è®²çš„</li>
<li>è°ƒåº¦å™¨ä¼šåœ¨åˆé€‚çš„ç‚¹è¿›è¡Œåˆ‡æ¢
è™½ç„¶æ˜¯éæŠ¢å å¼çš„ï¼Œä½†è¿˜æ˜¯æœ‰ä¸ªè°ƒåº¦å™¨è¿›è¡Œåˆ‡æ¢ï¼Œè¿™äº›åˆ‡æ¢çš„ç‚¹æˆ‘ä»¬å¹¶ä¸è¿›è¡Œå®Œå…¨çš„
æ§åˆ¶ã€‚è¿™ä¸ªä¹Ÿæ˜¯goroutineå’Œä¼ ç»Ÿæ„ä¹‰ä¸Šåç¨‹æœ‰ä¸€å®šåŒºåˆ«çš„åœ°æ–¹ã€‚
ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„åç¨‹æ˜¯éæŠ¢å å¼çš„ï¼Œæ‰€æœ‰åˆ‡æ¢çš„ç‚¹éƒ½éœ€è¦æ˜¾ç¤ºåœ°å†™å‡ºæ¥ï¼Œä½†goroutine
ä¸ä¸€æ ·ï¼Œå°±åƒå†™æ™®é€šå‡½æ•°ä¸€æ ·ï¼Œè°ƒåº¦å™¨ä¼šè¿›è¡Œåˆ‡æ¢ã€‚
ä½†å®ƒåˆå’Œçº¿ç¨‹çš„åˆ‡æ¢ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯å›ºå®šçš„ç‚¹åˆ‡æ¢</li>
<li>ä½¿ç”¨`-race`æ¥æ£€æµ‹æ•°æ®è®¿é—®å†²çª</li>
</ul>
</div>
</div>
<div id="outline-container-org156fb0b" class="outline-4">
<h4 id="org156fb0b">goroutineå¯èƒ½åˆ‡æ¢çš„ç‚¹</h4>
<div class="outline-text-4" id="text-org156fb0b">
<ul class="org-ul">
<li>I/Oæˆ–è€…select
i/oï¼šå¦‚ï¼Œå‘å±å¹•ä¸Šæ‰“å°å­—</li>
<li>channel</li>
<li>ç­‰å¾…é”</li>
<li>å‡½æ•°è°ƒç”¨(æœ‰æ—¶)
æ˜¯ä¸€ä¸ªåˆ‡æ¢çš„æœºä¼šï¼Œè¿™ä¸ªç”±è°ƒåº¦å™¨å†³å®š</li>
<li>runtime.Gosched()
æ‰‹åŠ¨æä¾›ä¸€ä¸ªåˆ‡æ¢çš„ç‚¹ï¼Œäº¤å‡ºæ§åˆ¶æƒ</li>
<li>ä¸Šé¢çš„åªæ˜¯å‚è€ƒï¼Œä¸èƒ½ä¿è¯åˆ‡æ¢ï¼Œä¸èƒ½ä¿è¯åœ¨å…¶ä»–åœ°æ–¹ä¸åˆ‡æ¢
goroutineåç¨‹æ˜¯éæŠ¢å å¼çš„ï¼Œä»ä»£ç æ¥çœ‹å¯èƒ½è·ŸæŠ¢å å¼çš„æœ‰ç‚¹åƒï¼Œä½†å®é™…è¿è¡Œçš„æœºåˆ¶
è¿˜æ˜¯éæŠ¢å å¼çš„</li>
</ul>
</div>
</div>
</div>
</section>
<section id="outline-container-orgdbbeaab" class="outline-2">
<h2 id="orgdbbeaab">channel</h2>
<div class="outline-text-2" id="text-orgdbbeaab">
<p>
åç¨‹ä¹‹é—´çš„åŒå‘é€šé“ï¼Œå³channel
</p>
</div>
<div id="outline-container-org6906160" class="outline-3">
<h3 id="org6906160">channelè¯­æ³•</h3>
<div class="outline-text-3" id="text-org6906160">
<p>
èŒƒä¾‹ï¼šåˆ›å»ºchannel
</p>
<div class="org-src-container">
<pre class="src src-sh">package main

import <span style="color: #8b2252;">"fmt"</span>

func chanDemo() {
  // &#21019;&#24314;channel
  // var c chan int // c == nil &#65292;&#21482;&#26159;&#23450;&#20041;&#20102;chan&#65292;&#23427;&#30340;&#20540;&#26159;nil&#65292;nil&#30340;channel&#26080;&#27861;&#20351;&#29992;&#65292;&#20294;&#22312;select&#20013;&#20250;&#29992;&#21040;
  c := make(chan int)
  // &#21457;&#25968;&#25454;
  c &lt;- 1  // &#27515;&#38145;&#22312;&#21521;chan&#21457;&#36865;1
  c &lt;- 2
  // &#20174;chan&#20013;&#25910;&#25968;&#25454;
  n := &lt;-c
  fmt.Println(n)
}

func main() {
  chanDemo()
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#25253;&#38169;&#65292;&#27515;&#38145;</span>
PS D:\project\learngo&gt; go run .\channel\channel.go
fatal error: all goroutines are asleep - deadlock!

goroutine 1 [chan send]:
<span style="color: #0000ff;">main.chanDemo</span>()
        D:/project/learngo/channel/channel.go:10 +0x37
</pre>
</div>
<p>
channelæ˜¯goroutineå’Œgoroutineä¹‹é—´çš„äº¤äº’ï¼Œå‘äº†æ•°æ®æ²¡äººæ”¶å°±ä¼šdeadlockï¼
ä¿®æ”¹ä¹‹åä»£ç 
</p>
<div class="org-src-container">
<pre class="src src-sh">func chanDemo() {
  // &#21019;&#24314;channel
  // var c chan int // c == nil &#65292;&#21482;&#26159;&#23450;&#20041;&#20102;chan&#65292;&#23427;&#30340;&#20540;&#26159;nil&#65292;nil&#30340;channel&#26080;&#27861;&#20351;&#29992;&#65292;&#20294;&#22312;select&#20013;&#20250;&#29992;&#21040;
  c := make(chan int)
  go func() {
    <span style="color: #a020f0;">for</span> {
      n := &lt;-c
      fmt.Println(n)
    }
  }()
  // &#21457;&#25968;&#25454;
  c &lt;- 1
  c &lt;- 2
  // &#36991;&#20813;&#26469;&#19981;&#21450;&#25171;&#21360;&#65292;main&#20989;&#25968;&#20808;&#32467;&#26463;&#20102;
  time.Sleep(time.Millisecond)
}

func main() {
  chanDemo()
}
</pre>
</div>
</div>
<div id="outline-container-org9d9c8f9" class="outline-5">
<h5 id="org9d9c8f9">channelä¹Ÿæ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œä¹Ÿèƒ½ä½œä¸ºå‚æ•°ã€ä½œä¸ºè¿”å›å€¼</h5>
<div class="outline-text-5" id="text-org9d9c8f9">
<p>
èŒƒä¾‹ï¼šchannelå½“å‡½æ•°å‚æ•°
</p>
<div class="org-src-container">
<pre class="src src-sh">package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"time"</span>
)

func worker(id int, c chan int) {
  <span style="color: #a020f0;">for</span> {
    fmt.Printf(<span style="color: #8b2252;">"worker %d received %d\n"</span>,
      id, &lt;-c)
  }
}

func chanDemo() {
  // &#21019;&#24314;channel
  // var c chan int // c == nil &#65292;&#21482;&#26159;&#23450;&#20041;&#20102;chan&#65292;&#23427;&#30340;&#20540;&#26159;nil&#65292;nil&#30340;channel&#26080;&#27861;&#20351;&#29992;&#65292;&#20294;&#22312;select&#20013;&#20250;&#29992;&#21040;
  c := make(chan int)
  //go worker(c)
  go worker(0, c)
  // &#21457;&#25968;&#25454;
  c &lt;- 1
  c &lt;- 2
  // &#36991;&#20813;&#26469;&#19981;&#21450;&#25171;&#21360;&#65292;main&#20989;&#25968;&#20808;&#32467;&#26463;&#20102;
  time.Sleep(time.Millisecond)
}

func main() {
  chanDemo()
}
</pre>
</div>

<p>
èŒƒä¾‹ï¼šchannelä½œä¸ºæ•°ç»„çš„ç±»å‹
</p>
<div class="org-src-container">
<pre class="src src-sh">package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"time"</span>
)

func worker(id int, c chan int) {
  <span style="color: #a020f0;">for</span> {
    fmt.Printf(<span style="color: #8b2252;">"worker %d received %c\n"</span>,
      id, &lt;-c)
  }
}

func chanDemo() {

  var channels [10]chan int // channel&#20316;&#20026;&#25968;&#32452;&#30340;&#31867;&#22411;
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ { // &#24320;10&#20010;work&#25509;&#25910;channel&#25968;&#25454;
    channels[i] = make(chan int)
    go worker(i, channels[i])
  }

  // &#21521;10&#20010;channels[i]&#21457;&#25968;&#25454;
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ {
    channels[i] &lt;- <span style="color: #8b2252;">'a'</span> + i
  }
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ {
    channels[i] &lt;- <span style="color: #8b2252;">'A'</span> + i
  }

  // &#36991;&#20813;&#26469;&#19981;&#21450;&#25171;&#21360;&#65292;main&#20989;&#25968;&#20808;&#32467;&#26463;&#20102;
  time.Sleep(time.Millisecond)
}

func main() {
  chanDemo()
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986;</span>
PS D:\project\learngo&gt; go run .\channel\channel.go
worker 3 received d
worker 0 received a
worker 0 received A
worker 5 received f
worker 4 received e
worker 8 received i
worker 9 received j
worker 2 received c
worker 1 received b
worker 1 received B
worker 7 received h
worker 6 received g
worker 6 received G
worker 2 received C
worker 3 received D
</pre>
</div>

<p>
èŒƒä¾‹ï¼šchannelä½œä¸ºè¿”å›å€¼
</p>
<div class="org-src-container">
<pre class="src src-sh">package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"time"</span>
)

func createWorker(id int) chan int {
  c := make(chan int)
  go func(){ // &#30495;&#27491;&#20570;&#20107;&#30340;work
    <span style="color: #a020f0;">for</span> {
      fmt.Printf(<span style="color: #8b2252;">"worker %d received %c\n"</span>,
        id, &lt;-c)
    }
  }()

  <span style="color: #a020f0;">return</span> c
}

func chanDemo() {

  var channels [10]chan int // channel&#20316;&#20026;&#25968;&#32452;&#30340;&#31867;&#22411;
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ { // &#24320;10&#20010;work&#25509;&#25910;channel&#25968;&#25454;
    channels[i] = createWorker(i)
  }

  // &#21521;10&#20010;channels[i]&#21457;&#25968;&#25454;
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ {
    channels[i] &lt;- <span style="color: #8b2252;">'a'</span> + i
  }
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ {
    channels[i] &lt;- <span style="color: #8b2252;">'A'</span> + i
  }

  // &#36991;&#20813;&#26469;&#19981;&#21450;&#25171;&#21360;&#65292;main&#20989;&#25968;&#20808;&#32467;&#26463;&#20102;
  time.Sleep(time.Millisecond)
}

func main() {
  chanDemo()
}

</pre>
</div>

<p>
èŒƒä¾‹ï¼šchannelçš„å®šä¹‰ä¸Šè¿›ä¸€æ­¥ä¿®é¥°ï¼Œå‘ŠçŸ¥channelçš„ä½¿ç”¨æ–¹å¼
</p>
<div class="org-src-container">
<pre class="src src-sh">func createWorker(id int) chan&lt;- int { // &#21578;&#30693;channel&#26159;&#21521;channel&#21457;&#25968;&#25454;&#30340;
  c := make(chan int)
  go func(){ // &#30495;&#27491;&#20570;&#20107;&#30340;work
    <span style="color: #a020f0;">for</span> {
      fmt.Printf(<span style="color: #8b2252;">"worker %d received %c\n"</span>,
        id, &lt;-c)  // &#37324;&#38754;&#21482;&#33021;&#20174;channel&#20013;&#25910;&#25968;&#25454;
    }
  }()

  <span style="color: #a020f0;">return</span> c
}

func chanDemo() {

  var channels [10]chan&lt;- int //
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ { // &#24320;10&#20010;work&#25509;&#25910;channel&#25968;&#25454;
    channels[i] = createWorker(i)
  }

  // &#21521;10&#20010;channels[i]&#21457;&#25968;&#25454;
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ {
    channels[i] &lt;- <span style="color: #8b2252;">'a'</span> + i
  }
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ {
    channels[i] &lt;- <span style="color: #8b2252;">'A'</span> + i
  }

  // &#36991;&#20813;&#26469;&#19981;&#21450;&#25171;&#21360;&#65292;main&#20989;&#25968;&#20808;&#32467;&#26463;&#20102;
  time.Sleep(time.Millisecond)
}

func main() {
  chanDemo()
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org8896433" class="outline-5">
<h5 id="org8896433">buffer channel</h5>
<div class="outline-text-5" id="text-org8896433">
<p>
èŒƒä¾‹ï¼šchannelæœ‰ç¼“å†²åŒº
</p>
<div class="org-src-container">
<pre class="src src-sh">package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"time"</span>
)

func worker(id int, c chan int) {
  <span style="color: #a020f0;">for</span> {
    fmt.Printf(<span style="color: #8b2252;">"worker %d received %c\n"</span>,
      id, &lt;-c)  // &#37324;&#38754;&#21482;&#33021;&#20174;channel&#20013;&#25910;&#25968;&#25454;
  }
}

func bufferChannel() {
  c := make(chan int, 3) // &#26377;3&#20010;&#32531;&#20914;
  go worker(0, c)
  c &lt;- <span style="color: #8b2252;">'a'</span>
  c &lt;- <span style="color: #8b2252;">'b'</span>
  c &lt;- <span style="color: #8b2252;">'c'</span>
  c &lt;- <span style="color: #8b2252;">'d'</span>
  time.Sleep(time.Millisecond)
}

func main() {
  bufferChannel()
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org0a8bbc9" class="outline-5">
<h5 id="org0a8bbc9">channel close and range</h5>
<div class="outline-text-5" id="text-org0a8bbc9">
<p>
èŒƒä¾‹ï¼šchannelå¯ä»¥closeï¼Œæ°¸è¿œæ˜¯å‘é€æ–¹close
</p>
<div class="org-src-container">
<pre class="src src-sh">package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"time"</span>
)

func worker(id int, c chan int) {
  // for {
  //  n, ok := &lt;-c // &#21028;&#26029;channel&#26159;&#21542;&#26377;&#25968;&#25454;&#26041;&#27861;1
  //  if !ok {
  //    break
  //  }
  //  fmt.Printf(<span style="color: #8b2252;">"worker %d received %c\n"</span>,
  //    id, n)
  // }

  <span style="color: #a020f0;">for</span> n := range c {  // &#21028;&#26029;channel&#26159;&#21542;&#26377;&#25968;&#25454;&#26041;&#27861;2
    fmt.Printf(<span style="color: #8b2252;">"worker %d received %c\n"</span>,
    id, n)
  }
}

func channelClose() {
  c := make(chan int, 3) // &#26377;3&#20010;&#32531;&#20914;
  go worker(0, c)
  c &lt;- <span style="color: #8b2252;">'a'</span>
  c &lt;- <span style="color: #8b2252;">'b'</span>
  c &lt;- <span style="color: #8b2252;">'c'</span>
  c &lt;- <span style="color: #8b2252;">'d'</span>
  close(c) // &#21578;&#35785;&#25509;&#25910;&#26041;&#25968;&#25454;&#21457;&#23436;&#20102;
  time.Sleep(time.Millisecond)
}

func main() {
  channelClose()
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orge280888" class="outline-5">
<h5 id="orge280888">å°ç»“channelè¯­æ³•</h5>
<div class="outline-text-5" id="text-orge280888">
<ul class="org-ul">
<li>channel</li>
<li>buffered channel</li>
<li>range
channelå¯ä»¥closeï¼Œæ³¨æ„ä¸€å®šæ˜¯å‘é€æ–¹closeã€‚æ¥æ”¶æ–¹æœ‰2ç§åˆ¤æ–­æ–¹æ³•</li>
<li>ç†è®ºåŸºç¡€ï¼šCommunication Sequential Process(CSP)æ¨¡å¼</li>
</ul>

<p>
channelçš„å®é™…åº”ç”¨
</p>
<ul class="org-ul">
<li>Don't communicate by sharing memory; share memory by communicating.</li>
<li>ä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡ï¼›é€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgeefbbf8" class="outline-3">
<h3 id="orgeefbbf8">ä½¿ç”¨Channelç­‰å¾…ä»»åŠ¡ç»“æŸ</h3>
<div class="outline-text-3" id="text-orgeefbbf8">
<p>
åŸºäºCSPï¼Œé€šè¿‡é€šä¿¡æ¥å…±äº«å†…
</p>

<p>
èŒƒä¾‹ï¼šchannelç­‰å¾…ä»»åŠ¡ç»“æŸ
</p>
<div class="org-src-container">
<pre class="src src-sh">// &#21019;&#24314;channel/done/done.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
)

func doWorker(id int, c chan int, done chan bool) {
  <span style="color: #a020f0;">for</span> n := range c {
    fmt.Printf(<span style="color: #8b2252;">"worker %d received %c\n"</span>,
      id, n)
    // &#36890;&#30693;&#22806;&#37096;&#25171;&#21360;&#23436;&#27605;&#65292;&#36890;&#36807;&#36890;&#20449;&#20849;&#20139;&#20869;&#23384;
    <span style="color: #a020f0;">done</span> &lt;- true
  }
}

<span style="color: #483d8b;">type</span> worker struct { // &#21253;&#35013;&#19968;&#19979;2&#20010;channel
  <span style="color: #a020f0;">in</span>   chan int
  <span style="color: #a020f0;">done</span> chan bool
}

func createWorker(id int) worker {
  w := worker{
    <span style="color: #a020f0;">in</span>:   make(chan int),
    <span style="color: #a020f0;">done</span>: make(chan bool),
  }
  go doWorker(id, w.in, w.done)
  <span style="color: #a020f0;">return</span> w
}

func chanDemo() {
  var workers [10]worker    //
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ { // &#24320;10&#20010;work&#25509;&#25910;channel&#25968;&#25454;
    workers[i] = createWorker(i)
  }

  // &#21521;10&#20010;channel&#21457;&#25968;&#25454;
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ {
    workers[i].in &lt;- <span style="color: #8b2252;">'a'</span> + i
    &lt;-workers[i].done
  }
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ {
    workers[i].in &lt;- <span style="color: #8b2252;">'A'</span> + i
    &lt;-workers[i].done
  }

}

func main() {
  chanDemo()
}

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20986;&#65292;&#20026;&#26377;&#39034;&#24207;&#25171;&#21360;</span>
PS D:\project\learngo&gt; go run .\channel\done\done.go
worker 0 received a
worker 1 received b
worker 2 received c
worker 3 received d
worker 4 received e
worker 5 received f
worker 6 received g
worker 7 received h
worker 8 received i
worker 9 received j
worker 0 received A
worker 1 received B
worker 2 received C
worker 3 received D
worker 4 received E
worker 5 received F
worker 6 received G
worker 7 received H
worker 8 received I
worker 9 received J
</pre>
</div>
<p>
ä¸Šé¢ä»£ç ç¤ºä¾‹æ˜¯é¡ºåºæ‰“å°çš„ï¼Œä¸æ˜¯æˆ‘ä»¬è¦çš„ï¼Œè¿™ä¸æ˜¯å¹¶å‘æ‰§è¡Œï¼Œä¸€ä¸ªä¸ªæ‰“ä¸å°±è¡Œäº†ï¼Ÿ
ä¸å¸Œæœ›å‘ä¸€ä¸ªå°±ç­‰å¾…channelç»“æŸï¼Œè¦ç­‰å¾…å…¨éƒ¨ç»“æŸå†mainå‡½æ•°ä¸­é€€å‡ºæ¥
</p>

<p>
ä¿®æ”¹ï¼Œå»æ‰sleep
</p>
<div class="org-src-container">
<pre class="src src-sh">// channel/done/done.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
)

func doWorker(id int, c chan int, done chan bool) {
  <span style="color: #a020f0;">for</span> n := range c {
    fmt.Printf(<span style="color: #8b2252;">"worker %d received %c\n"</span>,
      id, n)
    // &#36890;&#30693;&#22806;&#37096;&#25171;&#21360;&#23436;&#27605;&#65292;&#36890;&#36807;&#36890;&#20449;&#20849;&#20139;&#20869;&#23384;
    go func() { <span style="color: #a020f0;">done</span> &lt;- true }() // &#24182;&#34892;&#30340;done
  }
}

<span style="color: #483d8b;">type</span> worker struct { // &#21253;&#35013;&#19968;&#19979;2&#20010;channel
  <span style="color: #a020f0;">in</span>   chan int
  <span style="color: #a020f0;">done</span> chan bool
}

func createWorker(id int) worker {
  w := worker{
    <span style="color: #a020f0;">in</span>:   make(chan int),
    <span style="color: #a020f0;">done</span>: make(chan bool),
  }
  go doWorker(id, w.in, w.done)
  <span style="color: #a020f0;">return</span> w
}

func chanDemo() {
  var workers [10]worker    //
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ { // &#24320;10&#20010;work&#25509;&#25910;channel&#25968;&#25454;
    workers[i] = createWorker(i)
  }

  // &#21521;10&#20010;channels[i]&#21457;&#25968;&#25454;
  <span style="color: #a020f0;">for</span> i, worker := range workers {
    worker.in &lt;- <span style="color: #8b2252;">'a'</span> + i
  }
  <span style="color: #a020f0;">for</span> i, worker := range workers {
    worker.in &lt;- <span style="color: #8b2252;">'A'</span> + i
  }

  // &#31561;&#24453;&#25152;&#26377;
  <span style="color: #a020f0;">for</span> _, worker := range workers {
    &lt;-worker.done
    &lt;-worker.done
  }
}

func main() {
  chanDemo()
}
</pre>
</div>


<ul class="org-ul">
<li>ä»¥åŠWaitGroupçš„ä½¿ç”¨</li>
</ul>
</div>
<div id="outline-container-org7aaa47e" class="outline-4">
<h4 id="org7aaa47e">ä½¿ç”¨WaitGroupç­‰å¾…å¤šäººå®Œæˆä»»åŠ¡</h4>
<div class="outline-text-4" id="text-org7aaa47e">
<p>
èŒƒä¾‹ï¼šä½¿ç”¨WaitGroupç­‰å¾…å¤šäººå®Œæˆä»»åŠ¡
</p>
<div class="org-src-container">
<pre class="src src-sh">// channel/done/done.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"sync"</span>
)

func doWorker(
  id int, c chan int, wg *sync.WaitGroup) {
  <span style="color: #a020f0;">for</span> n := range c {
    fmt.Printf(<span style="color: #8b2252;">"worker %d received %c\n"</span>,
      id, n)
    // &#36890;&#30693;&#22806;&#37096;&#25171;&#21360;&#23436;&#27605;&#65292;&#36890;&#36807;&#36890;&#20449;&#20849;&#20139;&#20869;&#23384;
    wg.Done()
  }
}

<span style="color: #483d8b;">type</span> worker struct { // &#21253;&#35013;&#19968;&#19979;2&#20010;channel
  <span style="color: #a020f0;">in</span> chan int
  wg *sync.WaitGroup // &#20351;&#29992;wg
}

func createWorker(
  id int, wg *sync.WaitGroup) worker {
  w := worker{
    <span style="color: #a020f0;">in</span>: make(chan int),
    wg: wg,
  }
  go doWorker(id, w.in, wg)
  <span style="color: #a020f0;">return</span> w
}

func chanDemo() {
  var wg sync.WaitGroup
  var workers [10]worker    //
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ { // &#24320;10&#20010;work&#25509;&#25910;channel&#25968;&#25454;
    workers[i] = createWorker(i, &amp;wg)
  }

  // &#21521;10&#20010;channels[i]&#21457;&#25968;&#25454;
  <span style="color: #a020f0;">for</span> i, worker := range workers {
    worker.in &lt;- <span style="color: #8b2252;">'a'</span> + i
    wg.Add(1)
  }
  <span style="color: #a020f0;">for</span> i, worker := range workers {
    worker.in &lt;- <span style="color: #8b2252;">'A'</span> + i
    wg.Add(1)
  }

  // &#31561;&#24453;&#25152;&#26377;
  wg.Wait()
}

func main() {
  chanDemo()
}
</pre>
</div>

<p>
åŒ…è£…ä¸€ä¸‹waitgroupï¼ŒæŠ½è±¡ç¨‹åº¦æ›´é«˜äº†ä¸€ç‚¹
</p>
<div class="org-src-container">
<pre class="src src-sh">// channel/done/done.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"sync"</span>
)

func doWorker(
  id int, w worker) {
  <span style="color: #a020f0;">for</span> n := range w.in {
    fmt.Printf(<span style="color: #8b2252;">"worker %d received %c\n"</span>,
      id, n)
    // &#36890;&#30693;&#22806;&#37096;&#25171;&#21360;&#23436;&#27605;&#65292;&#36890;&#36807;&#36890;&#20449;&#20849;&#20139;&#20869;&#23384;
    w.done()
  }
}

<span style="color: #483d8b;">type</span> worker struct { // &#21253;&#35013;&#19968;&#19979;2&#20010;channel
  <span style="color: #a020f0;">in</span>   chan int
  <span style="color: #a020f0;">done</span> func() // waitgroup&#21253;&#35013;&#25104;&#20989;&#25968;
}

func createWorker(
  id int, wg *sync.WaitGroup) worker {
  w := worker{
    <span style="color: #a020f0;">in</span>:   make(chan int),
    <span style="color: #a020f0;">done</span>: func() { wg.Done() },
  }
  go doWorker(id, w)
  <span style="color: #a020f0;">return</span> w
}

func chanDemo() {
  var wg sync.WaitGroup
  var workers [10]worker    //
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 10; i++ { // &#24320;10&#20010;work&#25509;&#25910;channel&#25968;&#25454;
    workers[i] = createWorker(i, &amp;wg)
  }

  // &#21521;10&#20010;channels[i]&#21457;&#25968;&#25454;
  wg.Add(20)
  <span style="color: #a020f0;">for</span> i, worker := range workers {
    worker.in &lt;- <span style="color: #8b2252;">'a'</span> + i
  }
  <span style="color: #a020f0;">for</span> i, worker := range workers {
    worker.in &lt;- <span style="color: #8b2252;">'A'</span> + i
  }

  // &#31561;&#24453;&#25152;&#26377;
  wg.Wait()
}

func main() {
  chanDemo()
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org1c805d1" class="outline-3">
<h3 id="org1c805d1">ä½¿ç”¨Channelè¿›è¡Œæ ‘çš„éå†</h3>
<div class="outline-text-3" id="text-org1c805d1">
<p>
ä½¿ç”¨channelæ˜¾ç¤ºæ›´åºåˆ—åŒ–ä¸€äº›
èŒƒä¾‹ï¼šä½¿ç”¨Channelè¿›è¡Œæ ‘çš„éå†
ä½¿ç”¨
</p>
<div class="org-src-container">
<pre class="src src-sh">// &#20462;&#25913; tree/treentry/entry.go
func main() {
...

  // channel&#65292;&#32479;&#35745;&#26368;&#22823;&#30340;&#33410;&#28857;&#26641;
  c := root.TraversWithChannel()
  maxNode := 0
  <span style="color: #a020f0;">for</span> node := range c {
    <span style="color: #a020f0;">if</span> node.Value &gt; maxNode {
      maxNode = node.Value
    }
  }
  fmt.Println(<span style="color: #8b2252;">"Max node value:"</span>, maxNode)
}
</pre>
</div>

<p>
å®ç°
</p>
<div class="org-src-container">
<pre class="src src-sh">// &#20462;&#25913;&#28155;&#21152; tree/traversal.go

<span style="color: #0000ff;">func</span> (node *Node) TraversWithChannel() chan *Node {
  out := make(chan *Node)
  go func() {
    node.TraverseFunc(func(n *Node) {
      out &lt;- n
    })
    close(out)
  }()
  <span style="color: #a020f0;">return</span> out
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org0f95d98" class="outline-3">
<h3 id="org0f95d98">ä½¿ç”¨Selectæ¥è¿›è¡Œè°ƒåº¦</h3>
<div class="outline-text-3" id="text-org0f95d98">
<p>
èŒƒä¾‹ï¼šéé˜»å¡å¼channel é€‰æ‹©select defautl
</p>
<div class="org-src-container">
<pre class="src src-sh">// &#21019;&#24314;select/select.go

package main

import <span style="color: #8b2252;">"fmt"</span>

func main() {
  var c1, c2 chan int // c1 and c2 == nil
  // &#21516;&#26102;&#25910;&#65292;&#35841;&#25910;&#30340;&#24555;&#35201;&#35841;
  <span style="color: #a020f0;">select</span> {  // channel&#20540;&#20026;nil&#65292; &#22312;select&#20013;&#26159;&#25343;&#19981;&#21040;&#25968;&#25454;&#30340;&#65292;&#20250;&#36208;default&#65292; &#36825;&#26159;&#19968;&#20010;&#38750;&#38459;&#22622;&#24335;&#30340;channel
  <span style="color: #a020f0;">case</span> n := &lt;-c1:
    fmt.Println(<span style="color: #8b2252;">"Received from c1:"</span>, n)
  <span style="color: #a020f0;">case</span> n := &lt;-c2:
    fmt.Println(<span style="color: #8b2252;">"Received from c2:"</span>, n)
  default:
    fmt.Println(<span style="color: #8b2252;">"No value received"</span>) // No value received
  }
}
</pre>
</div>

<p>
å°†ä»channelæ¥æ”¶æ¥çš„æ•°æ®é€ç»™channel
</p>
<div class="org-src-container">
<pre class="src src-sh">// channel/select/select.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"math/rand"</span>
  <span style="color: #8b2252;">"time"</span>
)

func generator() chan int { // &#29983;&#25104;channel&#25968;&#25454;
  out := make(chan int)
  go func() {
    i := 0
    <span style="color: #a020f0;">for</span> {
      time.Sleep(time.Duration(rand.Intn(1500)) * time.Millisecond)
      out &lt;- i
      i++
    }
  }()
  <span style="color: #a020f0;">return</span> out
}

func worker(id int, c chan int) {
  <span style="color: #a020f0;">for</span> n := range c { // &#21028;&#26029;channel&#26159;&#21542;&#26377;&#25968;&#25454;&#26041;&#27861;2
    fmt.Printf(<span style="color: #8b2252;">"worker %d received %d\n"</span>,
      id, n)
  }
}

func createWorker(id int) chan&lt;- int { // &#21578;&#30693;channel&#26159;&#21521;channel&#21457;&#25968;&#25454;&#30340;
  c := make(chan int)
  go worker(id, c)
  <span style="color: #a020f0;">return</span> c
}

func main() {
  var c1, c2 = generator(), generator()
  // &#21516;&#26102;&#25910;&#65292;&#35841;&#25910;&#30340;&#24555;&#35201;&#35841;
  // &#23558;&#25910;&#36807;&#26469;&#30340; c &#36865;&#32473; worker
  var worker = createWorker(0)
  n := 0
  haseValue := false // &#21578;&#35785;&#26159;&#21542;&#26377;&#20540;
  <span style="color: #a020f0;">for</span> {
    var activeWorker chan&lt;- int
    <span style="color: #a020f0;">if</span> haseValue {  // &#26377;&#20540;&#26102;&#65292;&#23558;activeWorker&#28608;&#27963;
      activeWorker = worker
    }

    <span style="color: #a020f0;">select</span> {
    <span style="color: #a020f0;">case</span> n = &lt;-c1: // &#25910;&#25968;&#65292; &#20294;&#19981;&#24076;&#26395;&#25910;&#19968;&#20010;&#25968;&#25454;&#20877;&#36865;&#32473;channel&#34987;&#38459;&#22622;&#20303; w &lt;- n
      haseValue = true //&#25910;&#21040;&#20540;&#65292;haseValue&#20026;true
    <span style="color: #a020f0;">case</span> n = &lt;-c2:
      haseValue = true
    <span style="color: #a020f0;">case</span> activeWorker &lt;- n: // &#21457;&#25968;&#25454;, nil&#30340;chanel&#20250;&#34987;&#38459;&#22622;&#21040;
      haseValue = false  // &#21457;&#36865;&#23436; haseValue&#21464;&#20026;fasle
    }
  }
  // time.Sleep()
}
</pre>
</div>
<p>
ä¸Šé¢ä»£ç æœ‰ä¸€ä¸ªé—®é¢˜ï¼šç”Ÿæˆæ•°æ®çš„channelå’Œæ¶ˆè€—æ•°æ®çš„channelçš„é€Ÿåº¦æ˜¯ä¸ä¸€æ ·çš„
å¦‚æœç”Ÿæˆçš„æ•°æ®å¤ªå¿«äº†ï¼Œä¸­é—´æœ‰äº›æ•°æ®ä¼šå†²æ‰
</p>

<p>
å°†æ”¶åˆ°æ•°æ®æ’é˜Ÿï¼Œä¹‹åå†è®©åˆ«äººæ¶ˆè€—å®ƒ
</p>
<div class="org-src-container">
<pre class="src src-sh">// channel/select/select.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"math/rand"</span>
  <span style="color: #8b2252;">"time"</span>
)

func generator() chan int { // &#29983;&#25104;channel&#25968;&#25454;
  out := make(chan int)
  go func() {
    i := 0
    <span style="color: #a020f0;">for</span> {
      time.Sleep(time.Duration(rand.Intn(1500)) * time.Millisecond)
      out &lt;- i
      i++
    }
  }()
  <span style="color: #a020f0;">return</span> out
}

func worker(id int, c chan int) {
  <span style="color: #a020f0;">for</span> n := range c { // &#21028;&#26029;channel&#26159;&#21542;&#26377;&#25968;&#25454;&#26041;&#27861;2
    time.Sleep(1 * time.Second) // &#31561;&#24453;5&#31186;
    fmt.Printf(<span style="color: #8b2252;">"worker %d received %d\n"</span>,
      id, n)
  }
}

func createWorker(id int) chan&lt;- int { // &#21578;&#30693;channel&#26159;&#21521;channel&#21457;&#25968;&#25454;&#30340;
  c := make(chan int)
  go worker(id, c)
  <span style="color: #a020f0;">return</span> c
}

func main() {
  var c1, c2 = generator(), generator()
  // &#21516;&#26102;&#25910;&#65292;&#35841;&#25910;&#30340;&#24555;&#35201;&#35841;
  // &#23558;&#25910;&#36807;&#26469;&#30340; c &#36865;&#32473; worker
  var worker = createWorker(0)

  // &#23558;&#25910;&#21040;&#25968;&#25454;&#25490;&#38431;&#65292;&#20043;&#21518;&#20877;&#35753;&#21035;&#20154;&#28040;&#32791;&#23427;
  var values  []int

  <span style="color: #a020f0;">for</span> {
    var activeWorker chan&lt;- int
    var activeValue int
    <span style="color: #a020f0;">if</span> len(values)  &gt;0 {  // &#26377;&#20540;&#26102;&#65292;&#23558;activeWorker&#28608;&#27963;
      activeWorker = worker
      activeValue = values[0]
    }

    <span style="color: #a020f0;">select</span> {
    <span style="color: #a020f0;">case</span> n := &lt;-c1: // &#25910;&#25968;&#65292; &#20294;&#19981;&#24076;&#26395;&#25910;&#19968;&#20010;&#25968;&#25454;&#20877;&#36865;&#32473;channel&#34987;&#38459;&#22622;&#20303; w &lt;- n
      values = append(values, n)
    <span style="color: #a020f0;">case</span> n := &lt;-c2:
      values = append(values, n)
    <span style="color: #a020f0;">case</span> activeWorker &lt;- activeValue: // &#21457;&#25968;&#25454;, nil&#30340;chanel&#20250;&#34987;&#38459;&#22622;&#21040;
      values = values[1:]
    }
  }
  // time.Sleep()

}
</pre>
</div>

<p>
è®¡æ—¶å™¨çš„ä½¿ç”¨
</p>
<div class="org-src-container">
<pre class="src src-sh">// channel/select/select.go
package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"math/rand"</span>
  <span style="color: #8b2252;">"time"</span>
)

func generator() chan int { // &#29983;&#25104;channel&#25968;&#25454;
  out := make(chan int)
  go func() {
    i := 0
    <span style="color: #a020f0;">for</span> {
      time.Sleep(time.Duration(rand.Intn(1500)) * time.Millisecond)
      out &lt;- i
      i++
    }
  }()
  <span style="color: #a020f0;">return</span> out
}

func worker(id int, c chan int) {
  <span style="color: #a020f0;">for</span> n := range c { // &#21028;&#26029;channel&#26159;&#21542;&#26377;&#25968;&#25454;&#26041;&#27861;2
    time.Sleep(1 * time.Second) // &#31561;&#24453;5&#31186;
    fmt.Printf(<span style="color: #8b2252;">"worker %d received %d\n"</span>,
      id, n)
  }
}

func createWorker(id int) chan&lt;- int { // &#21578;&#30693;channel&#26159;&#21521;channel&#21457;&#25968;&#25454;&#30340;
  c := make(chan int)
  go worker(id, c)
  <span style="color: #a020f0;">return</span> c
}

func main() {
  var c1, c2 = generator(), generator()
  // &#21516;&#26102;&#25910;&#65292;&#35841;&#25910;&#30340;&#24555;&#35201;&#35841;
  // &#23558;&#25910;&#36807;&#26469;&#30340; c &#36865;&#32473; worker
  var worker = createWorker(0)

  // &#23558;&#25910;&#21040;&#25968;&#25454;&#25490;&#38431;&#65292;&#20043;&#21518;&#20877;&#35753;&#21035;&#20154;&#28040;&#32791;&#23427;
  var values  []int
  tm := time.After(10 * time.Second)
  tick := time.Tick(time.Second) // &#23450;&#26102;&#21151;&#33021;&#12290;&#36825;&#37324;&#26159;&#27599;&#31186;&#31181;&#36865;&#19968;&#20010;&#20540;
  <span style="color: #a020f0;">for</span> {
    var activeWorker chan&lt;- int
    var activeValue int
    <span style="color: #a020f0;">if</span> len(values)  &gt;0 {  // &#26377;&#20540;&#26102;&#65292;&#23558;activeWorker&#28608;&#27963;
      activeWorker = worker
      activeValue = values[0]
    }

    <span style="color: #a020f0;">select</span> {
    <span style="color: #a020f0;">case</span> n := &lt;-c1: // &#25910;&#25968;&#65292; &#20294;&#19981;&#24076;&#26395;&#25910;&#19968;&#20010;&#25968;&#25454;&#20877;&#36865;&#32473;channel&#34987;&#38459;&#22622;&#20303; w &lt;- n
      values = append(values, n)
    <span style="color: #a020f0;">case</span> n := &lt;-c2:
      values = append(values, n)
    <span style="color: #a020f0;">case</span> activeWorker &lt;- activeValue: // &#21457;&#25968;&#25454;, nil&#30340;chanel&#20250;&#34987;&#38459;&#22622;&#21040;
      values = values[1:]
    <span style="color: #a020f0;">case</span> &lt;- time.After(800 * time.Millisecond): // 800&#27627;&#31186;&#38388;&#27809;&#26377;&#25968;&#25454;&#25171;&#21360;timeout
      fmt.Println(<span style="color: #8b2252;">"timeout"</span>)
    <span style="color: #a020f0;">case</span> &lt;- tick: // &#23450;&#26102;&#22120;&#65292;&#27599;&#38548;1&#31186;&#25171;&#21360;value&#30340;&#38271;&#24230;
      fmt.Println(<span style="color: #8b2252;">"queue len="</span>, len(values))
    <span style="color: #a020f0;">case</span> &lt;-tm:    // 10 &#31186;&#21518;&#32467;&#26463;
      fmt.Println(<span style="color: #8b2252;">"bye"</span>)
      <span style="color: #a020f0;">return</span>
    }
  }
  // time.Sleep()

}

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20986;</span>
PS D:\project\learngo&gt; go run .\channel\select\select.go
queue <span style="color: #a0522d;">len</span>= 3
worker 0 received 0
queue <span style="color: #a0522d;">len</span>= 5
worker 0 received 0
queue <span style="color: #a0522d;">len</span>= 5
worker 0 received 1
queue <span style="color: #a0522d;">len</span>= 10
worker 0 received 1
queue <span style="color: #a0522d;">len</span>= 10
worker 0 received 2
queue <span style="color: #a0522d;">len</span>= 11
worker 0 received 2
queue <span style="color: #a0522d;">len</span>= 12
worker 0 received 3
queue <span style="color: #a0522d;">len</span>= 13
worker 0 received 3
queue <span style="color: #a0522d;">len</span>= 14
worker 0 received 4
<span style="color: #a020f0;">bye</span>
</pre>
</div>
</div>
<div id="outline-container-orgbeea46a" class="outline-4">
<h4 id="orgbeea46a">selectå°ç»“</h4>
<div class="outline-text-4" id="text-orgbeea46a">
<ul class="org-ul">
<li>selectçš„ä½¿ç”¨</li>
<li>å®šæ—¶å™¨çš„ä½¿ç”¨
3ç§å®šæ—¶å™¨çš„ä½¿ç”¨æ–¹æ³•</li>
<li>åœ¨selectä¸­ä½¿ç”¨Nil Channel
channelæ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½æ—¶ï¼Œselectå°±ä¸ä¼šæ‰§è¡Œã€‚</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgee07218" class="outline-3">
<h3 id="orgee07218">ä¼ ç»ŸåŒæ­¥æœºåˆ¶</h3>
<div class="outline-text-3" id="text-orgee07218">
<ul class="org-ul">
<li>WaitGroup
è™½ç„¶é‡Œé¢æ˜¯channelå®ç°çš„ï¼Œä½†çœ‹èµ·æ¥åƒä¼ ç»Ÿçš„åŒæ­¥æœºåˆ¶</li>
<li>Mutex
äº’æ–¥é‡</li>
<li><p>
Cond
ç”¨æ³•ç±»ä¼¼
</p>

<p>
ä¸€èˆ¬ä½¿ç”¨channelé€šä¿¡
</p></li>
</ul>
</div>
<div id="outline-container-org31f394f" class="outline-4">
<h4 id="org31f394f">Mutexäº’æ–¥é‡çš„ä½¿ç”¨</h4>
<div class="outline-text-4" id="text-org31f394f">
<p>
èŒƒä¾‹ï¼š
</p>
<div class="org-src-container">
<pre class="src src-sh">// basic/atomic/atomic.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"time"</span>
)

// &#23454;&#29616;atomic int
<span style="color: #483d8b;">type</span> atomicInt int

<span style="color: #0000ff;">func</span> (a *atomicInt) increment() { // &#33258;&#22686;&#38271;&#21151;&#33021;
  *a++
}

<span style="color: #0000ff;">func</span> (a *atomicInt) get() int {
  <span style="color: #a020f0;">return</span> int(*a)
}

func main() {
  // atomic.AddInt32() &#31995;&#32479;&#20013;&#33258;&#24102;&#21407;&#23376;&#21270;&#30340;int&#65292;&#32447;&#31243;&#23433;&#20840;&#30340;
  var a atomicInt
  a.increment()
  go func() {
    a.increment()
  }()
  time.Sleep(time.Millisecond)
  fmt.Println(a)
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986; -race &#25171;&#21040;&#25968;&#25454;&#20914;&#31361;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">27&#34892;&#35835;fmt.Println(a) &#21644; 12&#34892;&#20889;*a++&#26377;&#20914;&#31361;&#65292;</span>
PS D:\project\learngo&gt; go  run -race .\basic\atomic\atomic.go
==================
WARNING: DATA RACE
Read at 0x00c0000ac078 by main goroutine:
  main.main()
      D:/project/learngo/basic/atomic/atomic.go:27 +0xee

Previous write at 0x00c0000ac078 by goroutine 7:
  main.(*atomicInt).increment()
      D:/project/learngo/basic/atomic/atomic.go:12 +0x45
  main.main.func1()
      D:/project/learngo/basic/atomic/atomic.go:24 +0x2e
</pre>
</div>

<p>
åŠ é”
</p>
<div class="org-src-container">
<pre class="src src-sh">// basic/atomic/atomic.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"sync"</span>
  <span style="color: #8b2252;">"time"</span>
)

// &#23454;&#29616;atomic int
<span style="color: #483d8b;">type</span> atomicInt struct {
  value int
  lock sync.Mutex  // &#38145;
}

<span style="color: #0000ff;">func</span> (a *atomicInt) increment() { // &#33258;&#22686;&#38271;&#21151;&#33021;
  // &#38145;&#26469;&#20445;&#25252;
  a.lock.Lock()
  defer a.lock.Unlock()
  a.value++
}

<span style="color: #0000ff;">func</span> (a *atomicInt) get() int {
  a.lock.Lock()
  defer a.lock.Unlock()
  <span style="color: #a020f0;">return</span> int(a.value)
}

func main() {
  // atomic.AddInt32() &#31995;&#32479;&#20013;&#33258;&#24102;&#21407;&#23376;&#21270;&#30340;int&#65292;&#32447;&#31243;&#23433;&#20840;&#30340;
  var a atomicInt
  a.increment()
  go func() {
    a.increment()
  }()
  time.Sleep(time.Millisecond)
  fmt.Println(a.get())
}


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986; -race &#27809;&#26377;&#25968;&#25454;&#20914;&#31361;&#20102;</span>
PS D:\project\learngo&gt; go  run -race .\basic\atomic\atomic.go
2
</pre>
</div>
<p>
çœŸæ­£ç”¨æ—¶è¿˜å¾—ç”¨ç³»ç»Ÿè‡ªå¸¦çš„åŸå­åŒ–æ“ä½œã€‚
</p>

<p>
ä»£ç åŒºä¸­é”ä¿æŠ¤ï¼šä½¿ç”¨åŒ¿åå‡½æ•°
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #0000ff;">func</span> (a *atomicInt) increment() { // &#33258;&#22686;&#38271;&#21151;&#33021;
  // &#22312;&#19968;&#27573;&#20195;&#30721;&#21306;&#65292;&#38145;&#26469;&#20445;&#25252;.
  func() { // &#20351;&#29992;&#21311;&#21517;&#20989;&#25968;
    a.lock.Lock()
    defer a.lock.Unlock()
    a.value++
  }()
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org8761074" class="outline-3">
<h3 id="org8761074">å¹¶å‘æ¨¡å¼</h3>
<div class="outline-text-3" id="text-org8761074">
<p>
ä»åº”ç”¨çš„è§’åº¦è§£å†³ç±»å‹çš„é—®é¢˜
</p>
</div>
<div id="outline-container-org5f03309" class="outline-4">
<h4 id="org5f03309">channelå¯ä»¥åšä¸€ä¸ªç”Ÿæˆå™¨</h4>
<div class="outline-text-4" id="text-org5f03309">
<p>
èŒƒä¾‹ï¼šchannelåšä¸€ä¸ªç”Ÿæˆå™¨
æ¡†æ¶
</p>
<div class="org-src-container">
<pre class="src src-sh">// channel/pattern/main.go

package main

import <span style="color: #8b2252;">"fmt"</span>

func msgGen() chan string {
  c := make(chan string)
  go func() { // &#22312;goroutine&#20013;&#36865;&#25968;&#25454;

  }()
  <span style="color: #a020f0;">return</span> c
}

func main() {
  m := msgGen() // &#29983;&#25104;&#28040;&#24687;
  <span style="color: #a020f0;">for</span> {  // &#19981;&#26029;&#33719;&#21462;&#28040;&#24687;
    fmt.Println(&lt;-m)
  }
}
</pre>
</div>
<p>
ä»£ç å†…å®¹
</p>
<div class="org-src-container">
<pre class="src src-sh">// channel/pattern/main.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"math/rand"</span>
  <span style="color: #8b2252;">"time"</span>
)

func msgGen() chan string {
  c := make(chan string)
  go func() { // &#22312;goroutine&#20013;&#36865;&#25968;&#25454;
    i := 0
    <span style="color: #a020f0;">for</span> {
      time.Sleep(time.Duration(rand.Intn(2000)) * time.Millisecond)
      c &lt;- fmt.Sprintf(<span style="color: #8b2252;">"message %d"</span>, i)
      i++
    }

  }()
  <span style="color: #a020f0;">return</span> c
}

func main() {
  m1 := msgGen() // &#29983;&#25104;&#28040;&#24687;
  m2 := msgGen()
  <span style="color: #a020f0;">for</span> {         // &#19981;&#26029;&#33719;&#21462;&#28040;&#24687;
    fmt.Println(&lt;-m1)
    fmt.Println(&lt;-m2)
  }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org5bffdc9" class="outline-4">
<h4 id="org5bffdc9">æœåŠ¡/ä»»åŠ¡</h4>
<div class="outline-text-4" id="text-org5bffdc9">
<p>
channelä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªæœåŠ¡çš„å¥æŸ„handleï¼Œæˆ‘ä»¬æ‹¿ç€å®ƒå°±å¯ä»¥è·ŸæœåŠ¡å»äº¤äº’ã€‚
</p>
<div class="org-src-container">
<pre class="src src-sh">// channel/pattern/main.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"math/rand"</span>
  <span style="color: #8b2252;">"time"</span>
)

func msgGen(name string) chan string {
  c := make(chan string)
  go func() { // &#22312;goroutine&#20013;&#36865;&#25968;&#25454;
    i := 0
    <span style="color: #a020f0;">for</span> {
      time.Sleep(time.Duration(rand.Intn(2000)) * time.Millisecond)
      c &lt;- fmt.Sprintf(<span style="color: #8b2252;">"service %s: message %d"</span>, name, i)
      i++
    }

  }()
  <span style="color: #a020f0;">return</span> c
}

func main() {
  m1 := msgGen(<span style="color: #8b2252;">"service1"</span>) // &#29983;&#25104;&#28040;&#24687;
  m2 := msgGen(<span style="color: #8b2252;">"service2"</span>)
  <span style="color: #a020f0;">for</span> { // &#19981;&#26029;&#33719;&#21462;&#28040;&#24687;
    fmt.Println(&lt;-m1)
    fmt.Println(&lt;-m2)
  }
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986;</span>
PS D:\project\learngo&gt; go run -race .\channel\pattern\main.go
service service1: message 0
service service2: message 0
service service1: message 1
service service2: message 1
service service1: message 2
</pre>
</div>
<p>
ç¼ºç‚¹ï¼šéœ€è¦ç­‰å¾…ç¬¬ä¸€ä¸ªm1æœåŠ¡ç”Ÿæˆåå†ç­‰ç¬¬äºŒm2ï¼Œè¿™æ ·äº¤æ›¿è¿›è¡Œã€‚å®é™…ä¸Šæˆ‘ä»¬å¸Œæœ›åŒæ—¶å»ç­‰å¾…ä»–ä»¬ã€‚
</p>
</div>
</div>
<div id="outline-container-orgf7589e7" class="outline-4">
<h4 id="orgf7589e7">åŒæ—¶ç­‰å¾…å¤šä¸ªæœåŠ¡ï¼šä¸¤ç§æ–¹æ³•</h4>
<div class="outline-text-4" id="text-orgf7589e7">
<p>
åŒæ—¶æ”¶åˆ°2ä¸ªæœåŠ¡å‘çš„æ¶ˆæ¯ï¼šç»Ÿä¸€æ”¶ä¸‹æ¶ˆæ¯å‘åˆ°ç¬¬ä¸‰channelä¸Šï¼Œå†ä»ç¬¬ä¸‰ä¸ªchannelæ”¶æ¶ˆæ¯
</p>
</div>
<div id="outline-container-org7cf6a02" class="outline-5">
<h5 id="org7cf6a02">æ–¹æ³•1 ä¸ç¡®å®šæœ‰å‡ ä¸ªæœåŠ¡</h5>
<div class="outline-text-5" id="text-org7cf6a02">
<div class="org-src-container">
<pre class="src src-sh">// channel/pattern/main.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"math/rand"</span>
  <span style="color: #8b2252;">"time"</span>
)

func msgGen(name string) chan string {
  c := make(chan string)
  go func() { // &#22312;goroutine&#20013;&#36865;&#25968;&#25454;
    i := 0
    <span style="color: #a020f0;">for</span> {
      time.Sleep(time.Duration(rand.Intn(2000)) * time.Millisecond)
      c &lt;- fmt.Sprintf(<span style="color: #8b2252;">"service %s: message %d"</span>, name, i)
      i++
    }

  }()
  <span style="color: #a020f0;">return</span> c
}

func fanIn(c1, c2 chan string) chan string {
  c := make(chan string)
  // &#20998;&#21035;&#23558;c1 c2 &#25968;&#25454;&#21462;&#20986;&#36865;&#32473;c
  go func() {
    <span style="color: #a020f0;">for</span> {
      c &lt;- &lt;-c1
    }
  }()
  go func() {
    <span style="color: #a020f0;">for</span> {
      c &lt;- &lt;-c2
    }
  }()
  <span style="color: #a020f0;">return</span> c
}

func main() {
  m1 := msgGen(<span style="color: #8b2252;">"service1"</span>) // &#29983;&#25104;&#28040;&#24687;
  m2 := msgGen(<span style="color: #8b2252;">"service2"</span>)
  m := fanIn(m1, m2) // &#21516;&#26102;&#31561;&#24453;&#22810;&#26381;&#21153;&#28040;&#24687;
  <span style="color: #a020f0;">for</span> {              // &#19981;&#26029;&#33719;&#21462;&#28040;&#24687;
    fmt.Println(&lt;-m)
  }
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986; &#35841;&#20808;&#26377;&#25968;&#25454;&#25171;&#21360;&#35841;</span>
PS D:\project\learngo&gt; go run -race .\channel\pattern\main.go
service service1: message 0
service service2: message 0
service service1: message 1
service service2: message 1
service service1: message 2
service service1: message 3
</pre>
</div>

<p>
ä¸ç¡®å®šæœ‰å‡ ä¸ªæœåŠ¡
</p>
<div class="org-src-container">
<pre class="src src-sh">// channel/pattern/main.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"math/rand"</span>
  <span style="color: #8b2252;">"time"</span>
)

func msgGen(name string) chan string {
  c := make(chan string)
  go func() { // &#22312;goroutine&#20013;&#36865;&#25968;&#25454;
    i := 0
    <span style="color: #a020f0;">for</span> {
      time.Sleep(time.Duration(rand.Intn(2000)) * time.Millisecond)
      c &lt;- fmt.Sprintf(<span style="color: #8b2252;">"service %s: message %d"</span>, name, i)
      i++
    }

  }()
  <span style="color: #a020f0;">return</span> c
}

func fanIn(chs ...chan string) chan string {
  c := make(chan string)
  // channel &#24490;&#29615;&#21464;&#37327;&#30340;&#22353;
  // for _, ch := range chs {
  //  go func() {
  //    for {
  //      c &lt;- &lt;-ch // &#38381;&#21253;&#20013; ch &#21464;&#37327; &#24341;&#29992;&#22806;&#32622;&#21464;&#26356;&#26377;&#22353;, ch&#21482;&#26377;range chs&#26368;&#21518;&#19968;&#20010;&#30340;&#20540;
  //    }
  //  }()
  // }

  // &#35299;&#20915;1&#65292; &#25335;&#36125;
  // for _, ch := range chs {
  //  chCopy := ch
  //  go func() {
  //    for {
  //      c &lt;- &lt;-chCopy
  //    }
  //  }()
  // }

  //  &#35299;&#20915;2&#65292;&#20540;&#20256;&#36882;
  <span style="color: #a020f0;">for</span> _, ch := range chs {
    go func(ch chan string) {
      <span style="color: #a020f0;">for</span> {
        c &lt;- &lt;-ch
      }
    }(ch)
  }

  <span style="color: #a020f0;">return</span> c
}

func main() {
  m1 := msgGen(<span style="color: #8b2252;">"service1"</span>) // &#29983;&#25104;&#28040;&#24687;
  m2 := msgGen(<span style="color: #8b2252;">"service2"</span>)
  m := fanIn(m1, m2) // &#21516;&#26102;&#31561;&#24453;&#22810;&#26381;&#21153;&#28040;&#24687;
  <span style="color: #a020f0;">for</span> {              // &#19981;&#26029;&#33719;&#21462;&#28040;&#24687;
    fmt.Println(&lt;-m)
  }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfd0577c" class="outline-5">
<h5 id="orgfd0577c">æ–¹æ³•2ï¼šselect ç¡®å®šæœ‰å‡ ä¸ªæœåŠ¡</h5>
<div class="outline-text-5" id="text-orgfd0577c">
<div class="org-src-container">
<pre class="src src-sh">// channel/pattern/main.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"math/rand"</span>
  <span style="color: #8b2252;">"time"</span>
)

func msgGen(name string) chan string {
  c := make(chan string)
  go func() { // &#22312;goroutine&#20013;&#36865;&#25968;&#25454;
    i := 0
    <span style="color: #a020f0;">for</span> {
      time.Sleep(time.Duration(rand.Intn(2000)) * time.Millisecond)
      c &lt;- fmt.Sprintf(<span style="color: #8b2252;">"service %s: message %d"</span>, name, i)
      i++
    }

  }()
  <span style="color: #a020f0;">return</span> c
}

func fanInBySelect(c1, c2 chan string) chan string {
  c := make(chan string)
  go func() {
    <span style="color: #a020f0;">for</span> {
      <span style="color: #a020f0;">select</span> {
      <span style="color: #a020f0;">case</span> m := &lt;-c1:
        c &lt;- m
      <span style="color: #a020f0;">case</span> m := &lt;-c2:
        c &lt;- m
      }
    }
  }()
  <span style="color: #a020f0;">return</span> c
}

func main() {
  m1 := msgGen(<span style="color: #8b2252;">"service1"</span>) // &#29983;&#25104;&#28040;&#24687;
  m2 := msgGen(<span style="color: #8b2252;">"service2"</span>)
  m := fanInBySelect(m1, m2) // &#21516;&#26102;&#31561;&#24453;&#22810;&#26381;&#21153;&#28040;&#24687;
  <span style="color: #a020f0;">for</span> {              // &#19981;&#26029;&#33719;&#21462;&#28040;&#24687;
    fmt.Println(&lt;-m)
  }
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org930a180" class="outline-4">
<h4 id="org930a180">å¹¶å‘æ¨¡å¼å°ç»“</h4>
<div class="outline-text-4" id="text-org930a180">
<ul class="org-ul">
<li>channelå¯ä»¥åšä¸€ä¸ªç”Ÿæˆå™¨
å®è·µæ¡ˆä¾‹ï¼š<a href="https://www.imooc.com/learn/927">æ­å»ºå¹¶è¡Œå¤„ç†ç®¡é“ï¼Œæ„Ÿå—GOè¯­è¨€é­…åŠ›</a></li>
<li>æœåŠ¡/ä»»åŠ¡</li>
<li>åŒæ—¶ç­‰å¾…å¤šä¸ªæœåŠ¡ï¼šä¸¤ç§æ–¹æ³•
<ul class="org-ul">
<li>æ–¹æ³•1ï¼šä¸ç¡®è®¤æœ‰å‡ ä¸ªæœåŠ¡ï¼Œrange å¾ªç¯å˜é‡å‘</li>
<li>æ–¹æ³•2ï¼šçŸ¥é“æœ‰å‡ ä¸ªæœåŠ¡ï¼Œselect</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org979c025" class="outline-3">
<h3 id="org979c025">å¹¶å‘ä»»åŠ¡çš„æ§åˆ¶</h3>
<div class="outline-text-3" id="text-org979c025">
<ul class="org-ul">
<li>éé˜»å¡ç­‰å¾…</li>
<li>è¶…æ—¶æœºåˆ¶</li>
<li>ä»»åŠ¡ä¸­æ–­/é€€å‡º</li>
<li>ä¼˜é›…é€€å‡º</li>
</ul>
</div>
<div id="outline-container-org84f0390" class="outline-4">
<h4 id="org84f0390">éé˜»å¡ç­‰å¾…</h4>
<div class="outline-text-4" id="text-org84f0390">
<p>
èŒƒä¾‹ï¼š
</p>
<div class="org-src-container">
<pre class="src src-sh">// channel/pattern/main.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"math/rand"</span>
  <span style="color: #8b2252;">"time"</span>
)

func msgGen(name string) chan string {
  c := make(chan string)
  go func() { // &#22312;goroutine&#20013;&#36865;&#25968;&#25454;
    i := 0
    <span style="color: #a020f0;">for</span> {
      time.Sleep(time.Duration(rand.Intn(2000)) * time.Millisecond)
      c &lt;- fmt.Sprintf(<span style="color: #8b2252;">"service %s: message %d"</span>, name, i)
      i++
    }

  }()
  <span style="color: #a020f0;">return</span> c
}

func nonBlockingWait(c chan string) (string, bool) {
  <span style="color: #a020f0;">select</span> {
  <span style="color: #a020f0;">case</span> m := &lt;-c:
    <span style="color: #a020f0;">return</span> m, true
  default:
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">""</span>, false
  }
}

func main() {
  m1 := msgGen(<span style="color: #8b2252;">"service1"</span>) // &#29983;&#25104;&#28040;&#24687;
  m2 := msgGen(<span style="color: #8b2252;">"service2"</span>)
  <span style="color: #a020f0;">for</span> {
    fmt.Println(&lt;-m1)
    <span style="color: #a020f0;">if</span> m, ok := nonBlockingWait(m2); ok {
      fmt.Println(m)
    } <span style="color: #a020f0;">else</span> {
      fmt.Println(<span style="color: #8b2252;">"no message from service2"</span>)
    }
  }
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986;</span>
PS D:\project\learngo&gt; go run -race .\channel\pattern\main.go
service service1: message 0
no message from service2
service service1: message 1
service service2: message 0
</pre>
</div>
</div>
</div>
<div id="outline-container-org266ef0f" class="outline-4">
<h4 id="org266ef0f">è¶…æ—¶æœºåˆ¶</h4>
<div class="outline-text-4" id="text-org266ef0f">
<p>
èŒƒä¾‹ï¼š
</p>
<div class="org-src-container">
<pre class="src src-sh">// channel/pattern/main.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"math/rand"</span>
  <span style="color: #8b2252;">"time"</span>
)

func msgGen(name string) chan string {
  c := make(chan string)
  go func() { // &#22312;goroutine&#20013;&#36865;&#25968;&#25454;
    i := 0
    <span style="color: #a020f0;">for</span> {
      time.Sleep(time.Duration(rand.Intn(5000)) * time.Millisecond)
      c &lt;- fmt.Sprintf(<span style="color: #8b2252;">"service %s: message %d"</span>, name, i)
      i++
    }

  }()
  <span style="color: #a020f0;">return</span> c
}

func timeoutWait(c chan string, timeout time.Duration) (string, bool) {
  <span style="color: #a020f0;">select</span> {
  <span style="color: #a020f0;">case</span> m := &lt;-c:
    <span style="color: #a020f0;">return</span> m, true
  <span style="color: #a020f0;">case</span> &lt;-time.After(timeout):
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">""</span>, false
  }
}

func main() {
  m1 := msgGen(<span style="color: #8b2252;">"service1"</span>) // &#29983;&#25104;&#28040;&#24687;
  <span style="color: #a020f0;">for</span> {
    <span style="color: #a020f0;">if</span> m, ok := timeoutWait(m1, 2 * time.Second); ok {
      fmt.Println(m)
    } <span style="color: #a020f0;">else</span> {
      fmt.Println(<span style="color: #8b2252;">"no message from service2"</span>)
    }
  }
}


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986;</span>
PS D:\project\learngo&gt; go run -race .\channel\pattern\main.go
no message from service2
service service1: message 0
no message from service2
service service1: message 1
</pre>
</div>
</div>
</div>
<div id="outline-container-org2e081a0" class="outline-4">
<h4 id="org2e081a0">ä»»åŠ¡ä¸­æ–­/é€€å‡º</h4>
<div class="outline-text-4" id="text-org2e081a0">
<p>
çŸ¥é“é€€å‡ºäº†
`done chan bool` å’Œ`done chan struct{}` éƒ½å¯ä»¥ï¼Œstruct{}æ¯”boolæ›´çœç©ºé—´
</p>

<p>
èŒƒä¾‹ï¼š
</p>
<div class="org-src-container">
<pre class="src src-sh">// channel/pattern/main.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"math/rand"</span>
  <span style="color: #8b2252;">"time"</span>
)

func msgGen(name string, done chan struct{}) chan string { //  done chan bool &#21644; done chan struct{} &#37117;&#21487;&#20197;&#65292;struct{}&#27604;bool&#26356;&#30465;&#31354;&#38388;
  c := make(chan string)
  go func() { // &#22312;goroutine&#20013;&#36865;&#25968;&#25454;
    i := 0
    <span style="color: #a020f0;">for</span> {
      <span style="color: #a020f0;">select</span> {
      <span style="color: #a020f0;">case</span> &lt;- time.After(time.Duration(rand.Intn(5000)) * time.Millisecond):  // 5&#31186;&#21518;&#27809;&#26377;&#25910;&#21040;done&#30340;&#25968;&#25454;&#23601;&#20135;&#29983;&#19968;&#26465;&#25968;&#25454;
        c &lt;- fmt.Sprintf(<span style="color: #8b2252;">"service %s: message %d"</span>, name, i)
      <span style="color: #a020f0;">case</span> &lt;-done:
        fmt.Println(<span style="color: #8b2252;">"cleaning up"</span>)
        <span style="color: #a020f0;">return</span>
      }
      i++
    }
  }()
  <span style="color: #a020f0;">return</span> c
}

func timeoutWait(c chan string, timeout time.Duration) (string, bool) {
  <span style="color: #a020f0;">select</span> {
  <span style="color: #a020f0;">case</span> m := &lt;-c:
    <span style="color: #a020f0;">return</span> m, true
  <span style="color: #a020f0;">case</span> &lt;-time.After(timeout):
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">""</span>, false
  }
}

func main() {
  <span style="color: #a020f0;">done</span> := make(chan struct{})
  m1 := msgGen(<span style="color: #8b2252;">"service1"</span>, done) // &#29983;&#25104;&#28040;&#24687;
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 5; i++ {
    <span style="color: #a020f0;">if</span> m, ok := timeoutWait(m1, time.Second); ok {
      fmt.Println(m)
    } <span style="color: #a020f0;">else</span> {
      fmt.Println(<span style="color: #8b2252;">"timeout"</span>)
    }
  }
  <span style="color: #a020f0;">done</span> &lt;- struct{}{} // &#36864;&#20986;&#65307;struct{}{}&#34920;&#31034;&#31354;&#30340;struct{}&#32467;&#26500;
  time.Sleep(time.Second)
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986;</span>
PS D:\project\learngo&gt; go run -race .\channel\pattern\main.go
timeout
timeout
timeout
service service1: message 0
timeout
cleaning up
</pre>
</div>
</div>
</div>
<div id="outline-container-org1707347" class="outline-4">
<h4 id="org1707347">ä¼˜é›…é€€å‡º</h4>
<div class="outline-text-4" id="text-org1707347">
<p>
æ€ä¹ˆçŸ¥é“æ¸…ç†åšå®Œäº†ï¼Ÿæœ‰ä¸€ä¸ªchannelèƒ½å‘Šè¯‰æˆ‘ä»¬åšå®Œäº†
</p>
<div class="org-src-container">
<pre class="src src-sh">// channel/pattern/main.go

package main

<span style="color: #0000ff;">import</span> (
  <span style="color: #8b2252;">"fmt"</span>
  <span style="color: #8b2252;">"math/rand"</span>
  <span style="color: #8b2252;">"time"</span>
)

func msgGen(name string, done chan struct{}) chan string { //  done chan bool &#21644; done chan struct{} &#37117;&#21487;&#20197;&#65292;struct{}&#27604;bool&#26356;&#30465;&#31354;&#38388;
  c := make(chan string)
  go func() { // &#22312;goroutine&#20013;&#36865;&#25968;&#25454;
    i := 0
    <span style="color: #a020f0;">for</span> {
      <span style="color: #a020f0;">select</span> {
      <span style="color: #a020f0;">case</span> &lt;- time.After(time.Duration(rand.Intn(5000)) * time.Millisecond):  // 5&#31186;&#21518;&#27809;&#26377;&#25910;&#21040;done&#30340;&#25968;&#25454;&#23601;&#20135;&#29983;&#19968;&#26465;&#25968;&#25454;
        c &lt;- fmt.Sprintf(<span style="color: #8b2252;">"service %s: message %d"</span>, name, i)
      <span style="color: #a020f0;">case</span> &lt;-done:
        fmt.Println(<span style="color: #8b2252;">"cleaning up"</span>)
        time.Sleep(2 * time.Second)
        fmt.Println(<span style="color: #8b2252;">"cleaning done"</span>)
        <span style="color: #a020f0;">done</span> &lt;- struct{}{} // &#21578;&#35785;&#20570;&#23436;&#20102;&#65292;&#22823;&#37096;&#20998;&#19981;&#20250;&#20570;&#25104;&#21452;&#21521;&#30340;
        <span style="color: #a020f0;">return</span>
      }
      i++
    }

  }()
  <span style="color: #a020f0;">return</span> c
}


func timeoutWait(c chan string, timeout time.Duration) (string, bool) {
  <span style="color: #a020f0;">select</span> {
  <span style="color: #a020f0;">case</span> m := &lt;-c:
    <span style="color: #a020f0;">return</span> m, true
  <span style="color: #a020f0;">case</span> &lt;-time.After(timeout):
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">""</span>, false
  }
}

func main() {
  <span style="color: #a020f0;">done</span> := make(chan struct{})
  m1 := msgGen(<span style="color: #8b2252;">"service1"</span>, done) // &#29983;&#25104;&#28040;&#24687;
  <span style="color: #a020f0;">for</span> i := 0; i &lt; 5; i++ {
    <span style="color: #a020f0;">if</span> m, ok := timeoutWait(m1, time.Second); ok {
      fmt.Println(m)
    } <span style="color: #a020f0;">else</span> {
      fmt.Println(<span style="color: #8b2252;">"timeout"</span>)
    }
  }
  <span style="color: #a020f0;">done</span> &lt;- struct{}{} // &#36864;&#20986;&#65307;struct{}{}&#34920;&#31034;&#31354;&#30340;struct{}&#32467;&#26500;
  &lt;-done // &#25910;&#20570;&#23436;&#20102;&#30340;&#28040;&#24687;
}


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986;</span>
PS D:\project\learngo&gt; go run -race .\channel\pattern\main.go
timeout
timeout
timeout
service service1: message 0
timeout
cleaning up
cleaning done
</pre>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-org2d8a40e" class="outline-2">
<h2 id="org2d8a40e">è¿·å®«å®ç°</h2>
<div class="outline-text-2" id="text-org2d8a40e">
</div>
<div id="outline-container-org1fd0986" class="outline-3">
<h3 id="org1fd0986">è¿·å®«ç®—æ³•-å¹¿åº¦ä¼˜å…ˆç®—æ³•</h3>
<div class="outline-text-3" id="text-org1fd0986">
<p>
æ·±åº¦ä¼˜å…ˆç®—æ³•æœ‰å¯èƒ½ä¼šç»•è¿œè·¯
</p>

<ul class="org-ul">
<li>ä¸ºçˆ¬è™«å®æˆ˜é¡¹ç›®åšå¥½å‡†å¤‡</li>
<li>åº”ç”¨å¹¿æ³›ï¼Œç»¼åˆæ€§å¼º
æ¶‰åŠè¯­è¨€æ–¹é¢å¹¿åº¦æ¯”è¾ƒå¤šï¼Œä¸€é—¨è¯­è¨€èƒ½å¤Ÿé¡ºåˆ©çš„å¾’æ‰‹å†™å‡ºå¹¿åº¦ä¼˜å…ˆç®—æ³•èµ°è¿·å®«ï¼Œè¯´æ˜å·²ç»å¯¹è¿™é—¨è¯­è¨€æŒæ¡æ¯”è¾ƒç†Ÿç»ƒäº†ã€‚</li>
<li><p>
é¢è¯•å¸¸è§
</p>

<p>
è¿·å®«æè¿°ï¼š
</p>
<ul class="org-ul">
<li>6è¡Œ5åˆ—ï¼Œ1ä»£è¡¨å¢™ï¼Œ0ä»£è¡¨è·¯ï¼Œå·¦ä¸Šè§’è¿›ï¼Œå³ä¸‹è§’å‡ºã€‚</li>
<li>è§„åˆ™ï¼šä¸Šä¸‹å·¦å³èµ°ï¼Œä¸èƒ½å¯¹è§’èµ°</li>
<li>ç®—å‡ºæœ€çŸ­è·¯çº¿</li>
</ul>

<p>
æ€è·¯ï¼š
èµ·ç‚¹ä¸º0ï¼Œæ¢ç´¢ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘ï¼Œå‘ç°é€šè¿‡ä¸€æ­¥èƒ½èµ°çš„æ ¼å­ä¸€å…±4ä¸ªã€‚
ä»èµ·ç‚¹èµ°2æ­¥æ‰€èƒ½èµ°çš„æ ¼å­ï¼Œä¸èƒ½å¾€å›èµ°ï¼Œä»ä¸Šæ–¹é€†æ—¶é’ˆï¼ˆä¸Šå·¦ä¸‹å³90åº¦90åº¦è½¬ï¼‰æ¢ç´¢èƒ½èµ°çš„æ ¼å­ã€‚
</p>
<div class="org-src-container">
<pre class="src src-sh">
   3
  323
 32123
3210123
 32123
  323
   3
</pre>
</div></li>
</ul>
<p>
æ¯ä¸ªç‚¹éƒ½æœ‰2ç§çŠ¶æ€ï¼š
é¦–å…ˆæ˜¯0ï¼Œå‘ç°æœ‰è¿™ä¸ª0ä½†æ²¡æœ‰æ¢ç´¢è¿‡çš„ç‚¹ï¼Œæ¢ç´¢äº†é‚£ä¹ˆå‘¨å›´å°±ä¼šæœ‰4ä¸ª1
è¿™ä¸ª1æ˜¯å·²ç»å‘ç°ä½†æ²¡æœ‰æ¢ç´¢è¿‡çš„ç‚¹ï¼Œä¸­é—´çš„0æ˜¯æˆ‘ä»¬å·²ç»æ¢ç´¢è¿‡çš„ç‚¹
æ¢ç´¢ä¸Šæ–¹çš„1ï¼Œå‘ç°å‘¨å›´æœ‰3ä¸ª2ï¼Œå†æ¢ç´¢å·¦é¢çš„1ï¼Œå‘ç°æœ‰2ä¸ª2ï¼Œç­‰1æ¢ç´¢å®Œäº†æ‰è½®åˆ°2.
å› æ­¤ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ï¼šå·²ç»å‘ç°è¿˜æœªæ¢ç´¢ã€å·²ç»å‘ç°ä¸”æ¢ç´¢å®Œæˆã€æ²¡å‘ç°è¿‡ï¼Œå…¶ä¸­
â€œå·²ç»å‘ç°è¿˜æœªæ¢ç´¢â€çš„ç‚¹éœ€è¦æ’é˜Ÿï¼Œç­‰ä»€ä¹ˆæ—¶å€™åŠåˆ°ä½ äº†å†æ¢ç´¢ï¼Œä¸èƒ½ç›´æ¥æ¢ç´¢ï¼Œè¿™
å°±æ˜¯å¹¿åº¦ä¼˜å…ˆç®—æ³•ï¼Œä¸€å±‚ä¸€å±‚å¾€å¤–é€’è¿›ï¼Œè¿™æ ·èƒ½åˆ°çš„ç‚¹å°±æ˜¯æœ€çŸ­è·¯å¾„ã€‚
</p>

<p>
åº”ç”¨ï¼š
</p>
<div class="org-src-container">
<pre class="src src-sh">6 5
0 1 0 0 0
0 0 0 1 0
0 1 0 1 0
1 1 1 0 0
0 1 0 0 1
0 1 0 0 0
</pre>
</div>
<p>
ä¸‹é¢æ˜¯0åˆ°5æ˜¯ä¸‹æ ‡ï¼Œèµ·ç‚¹æ˜¯0æ­¥èƒ½èµ°åˆ°ï¼Œå…¶å®ƒéƒ½æ˜¯æœªçŸ¥çš„ã€‚
</p>
<table>


<colgroup>
<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">

<col  class="org-right">
</colgroup>
<tbody>
<tr>
<td class="org-right">&#xa0;</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-right">èµ·ç‚¹0</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">4</td>
<td class="org-right">5</td>
<td class="org-right">6</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">7</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">4</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">8</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">10</td>
<td class="org-right">9</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">12</td>
<td class="org-right">11</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">13</td>
<td class="org-right">12</td>
<td class="org-right">ç»ˆç‚¹13</td>
</tr>
</tbody>
</table>

<p>
å·²ç»å‘ç°è¿˜æ²¡æ¢ç´¢è¿‡çš„`(0,0)`æ”¾åˆ°é˜Ÿåˆ—ä¸­
</p>
<ul class="org-ul">
<li>æ¢ç´¢`(0,0)`ï¼Œå¾€ä¸‹æ˜¯èƒ½èµ°çš„å‡ºç°ä¸€ä¸ª1ï¼Œå‘ç°ç‚¹`(1,0)`æ”¾è¿›é˜Ÿåˆ—ä¸­ï¼›</li>
<li>æ¢ç´¢`(1,0)`ï¼Œä»åˆ—é˜Ÿä¸­æ‹¿å‡ºæ¥ï¼Œ2ä¸ª2ï¼Œè¿™ä¿©ä¸ªèŠ‚ç‚¹é€šè¿‡2æ­¥èƒ½èµ°åˆ°ï¼Œå°†`(2,0),(1,1)`åŠ å…¥é˜Ÿåˆ—</li>
<li>æ¢ç´¢`(2,0)`ï¼Œä»åˆ—é˜Ÿä¸­æ‹¿å‡ºæ¥ï¼Œå·¦å³éƒ½æ˜¯å¢™ä¸”ä¸èƒ½å¾€å›èµ°ï¼Œå› æ­¤æ˜¯æ¡æ­»è·¯</li>
<li>æ¢ç´¢`(1,1)`ï¼Œä»åˆ—é˜Ÿä¸­æ‹¿å‡ºæ¥é˜Ÿåˆ—ç©ºæ‰äº†ï¼Œå¯ä»¥å¾€å³èµ°å‘ç°1ä¸ª3ï¼Œå°†ç‚¹`(1,2)`åŠ å…¥é˜Ÿåˆ—</li>
<li>æ¢ç´¢`(1,2)`ï¼Œä»åˆ—é˜Ÿä¸­æ‹¿å‡ºæ¥é˜Ÿåˆ—ç©ºæ‰äº†ï¼Œå¯ä»¥å¾€ä¸Šå¾€ä¸‹èµ°å‘ç°2ä¸ª4ï¼Œå°†`(0,2),(2,2)`åŠ å…¥é˜Ÿåˆ—</li>
<li>ä»¥æ­¤ç±»ä¼¼æ¨ï¼Œè¿™æ¡è·¯å°±è¢«ç”»å‡ºæ¥äº†ï¼Œä»ç»ˆç‚¹å€’è¿‡æ¥å°±èƒ½ç”»å‡ºæœ€çŸ­è·¯ï¼Œ13å‘¨å›´åªæœ‰ä¸€ä¸ª12ç­‰ç­‰ç­‰</li>
</ul>

<p>
å¹¿åº¦ä¼˜å…ˆç®—æ³•ç»“æŸæ¡ä»¶ï¼š
</p>
<ul class="org-ul">
<li>åˆ°ç»ˆç‚¹ç»“æŸ</li>
<li>èµ°åˆ°æ­»è·¯ï¼Œé˜Ÿåˆ—ä¸ºç©ºç»“æŸã€‚</li>
</ul>
</div>
</div>
<div id="outline-container-orgeba0fa2" class="outline-3">
<h3 id="orgeba0fa2">è¿·å®«ä»£ç å®ç°</h3>
<div class="outline-text-3" id="text-orgeba0fa2">
<p>
åˆ›å»ºè¿·å®«å›¾æ–‡ä»¶ maze/maze.in
6è¡Œ5åˆ—
</p>
<div class="org-src-container">
<pre class="src src-sh">6 5
0 1 0 0 0
0 0 0 1 0
0 1 0 1 0
1 1 1 0 0
0 1 0 0 1
0 1 0 0 0
</pre>
</div>
<p>
åœ¨vscodeä¸­ï¼Œå¯ä»¥ä¿®æ”¹çŠ¶æ€æ å³ä¸‹è§’çš„CRLFï¼Œæ”¹ä¸ºLFã€‚
</p>
</div>
<div id="outline-container-org7c57a89" class="outline-4">
<h4 id="org7c57a89">è¯»è¿›è¿·å®«æ–‡ä»¶</h4>
<div class="outline-text-4" id="text-org7c57a89">
<div class="org-src-container">
<pre class="src src-sh">// maze/maze.go

package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"fmt"</span>
    <span style="color: #8b2252;">"os"</span>
)

func readMaze(filename string) [][]int { // &#36820;&#22238;2&#32500;slice
    file, err := os.Open(filename)
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }

    var row, col int
    fmt.Fscanf(file, <span style="color: #8b2252;">"%d %d"</span>, &amp;row, &amp;col) // &#35835;&#36827;&#36855;&#23467;&#34892;&#21644;&#21015;

    maze := make([][]int, row) // &#21019;&#24314;&#36855;&#23467;
    <span style="color: #a020f0;">for</span> i := range maze {
        maze[i] = make([]int, col)
        <span style="color: #a020f0;">for</span> j := range maze[i] {
            fmt.Fscanf(file, <span style="color: #8b2252;">"%d"</span>, &amp;maze[i][j]) // &#27599;&#20010;&#28857;&#22352;&#26631;&#20301;&#32622;
        }
    }
    <span style="color: #a020f0;">return</span> maze
}

func main() {
    m := readMaze(<span style="color: #8b2252;">"maze/maze.in"</span>)
    <span style="color: #a020f0;">for</span> _, row := range m {
        <span style="color: #a020f0;">for</span> _, col := range row {
            fmt.Printf(<span style="color: #8b2252;">"%d "</span>, col)
        }
        fmt.Println()
    }
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986;</span>
PS D:\project\learngo&gt; go run -race .\maze\maze.go
0 1 0 0 0
0 0 0 1 0
0 1 0 1 0
1 1 1 0 0
0 1 0 0 1
0 1 0 0 0
</pre>
</div>
</div>
</div>
<div id="outline-container-org5e65ec9" class="outline-4">
<h4 id="org5e65ec9">èµ°è¿·å®«</h4>
<div class="outline-text-4" id="text-org5e65ec9">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">type</span> point struct { // &#36208;&#30340;&#28857;
    i, j int
}

func walk(maze [][]int, start, end point) {

}

<span style="color: #0000ff;">walk</span>(maze, point{0, 0}, point{len(maze) - 1, len(maze[0]) - 1})
</pre>
</div>

<p>
ä»£ç ï¼š
</p>
<div class="org-src-container">
<pre class="src src-sh">// maze/maze.go

package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"fmt"</span>
    <span style="color: #8b2252;">"os"</span>
)

func readMaze(filename string) [][]int { // &#36820;&#22238;2&#32500;slice
    file, err := os.Open(filename)
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }

    var row, col int
    fmt.Fscanf(file, <span style="color: #8b2252;">"%d %d"</span>, &amp;row, &amp;col) // &#35835;&#36827;&#36855;&#23467;&#34892;&#21644;&#21015;

    maze := make([][]int, row) // &#21019;&#24314;&#36855;&#23467;
    <span style="color: #a020f0;">for</span> i := range maze {
        maze[i] = make([]int, col)
        <span style="color: #a020f0;">for</span> j := range maze[i] {
            fmt.Fscanf(file, <span style="color: #8b2252;">"%d"</span>, &amp;maze[i][j]) // &#27599;&#20010;&#28857;&#22352;&#26631;&#20301;&#32622;
        }
    }
    <span style="color: #a020f0;">return</span> maze
}

<span style="color: #483d8b;">type</span> point struct { // &#36208;&#30340;&#28857;
    i, j int // i &#32437;&#22352;&#26631;&#65292; j &#27178;&#22352;&#26631;
}

var dirs = []point{ // &#23450;&#20041; &#19978;&#24038;&#19979;&#21491;&#26041;&#21521;
    {-1, 0}, {0, -1}, {1, 0}, {0, 1}}

<span style="color: #0000ff;">func</span> (p point) add(r point) point {
    <span style="color: #a020f0;">return</span> point{p.i + r.i, p.j + r.j}
}

<span style="color: #0000ff;">func</span> (p point) at(grid [][]int) (int, bool) { // &#21516;&#26102;&#30475;point&#26377;&#27809;&#26377;&#36234;&#30028;
    <span style="color: #a020f0;">if</span> p.i &lt; 0 || p.i &gt;= len(grid) { // i &#34892;&#26465;&#20214;
        <span style="color: #a020f0;">return</span> 0, false
    }

    <span style="color: #a020f0;">if</span> p.j &lt; 0 || p.j &gt;= len(grid[p.i]) { // j &#21015;&#26465;&#20214;
        <span style="color: #a020f0;">return</span> 0, false
    }

    <span style="color: #a020f0;">return</span> grid[p.i][p.j], true
}

func walk(maze [][]int,
    start, end point) [][]int {
    steps := make([][]int, len(maze))
    <span style="color: #a020f0;">for</span> i := range steps {
        steps[i] = make([]int, len(maze[i]))
    }

    Q := []point{start} // &#36215;&#28857;&#21152;&#36827;&#38431;&#21015;&#20013;

    <span style="color: #a020f0;">for</span> len(Q) &gt; 0 { // &#36864;&#20986;&#26465;&#20214;&#65292;&#38431;&#21015;&#19981;&#31354;&#26102;
        // &#25506;&#32034;&#28857;
        cur := Q[0]
        Q = Q[1:]

        <span style="color: #a020f0;">if</span> cur == end { // &#26159;&#32456;&#28857;&#23601;&#36864;&#20986;
            <span style="color: #a020f0;">break</span>
        }

        <span style="color: #a020f0;">for</span> _, dir := range dirs { // &#19978;&#24038;&#19979;&#21491;&#26041;&#21521;
            next := cur.add(dir) // &#19979;&#19968;&#20010;&#33410;&#28857;&#22352;&#26631;

            // &#25506;&#32034;&#19979;&#19968;&#20010;&#33410;&#28857;&#65292;&#35201;&#20445;&#35777;&#19979;&#19968;&#20010;&#33410;&#28857;&#33021;&#36208;&#36807;&#25165;&#33021;&#25506;&#32034; maze at next is 0
            // &#24182;&#19988;&#20445;&#35777;&#19979;&#19968;&#20010;&#33410;&#28857;step&#20540;&#24471;&#26377; and steps at next is 0
            // &#19981;&#33021;&#22238;&#21040;&#36215;&#28857; and next != start
            val, ok := next.at(maze)
            <span style="color: #a020f0;">if</span> !ok || val == 1 { // &#20540;&#36234;&#30028;&#20102;&#25110;&#32773;&#25758;&#22681;&#20102;&#65292;&#26029;&#32493;&#30475;&#19979;&#19968;&#20010;&#28857;
                <span style="color: #a020f0;">continue</span>
            }

            val, ok = next.at(steps)
            <span style="color: #a020f0;">if</span> !ok || val != 0 {
                <span style="color: #a020f0;">continue</span>
            }

            <span style="color: #a020f0;">if</span> next == start {
                <span style="color: #a020f0;">continue</span>
            }

            curSteps, _ := cur.at(steps)
            steps[next.i][next.j] = curSteps + 1

            Q = append(Q, next)
        }
    }

    <span style="color: #a020f0;">return</span> steps
}

func main() {
    maze := readMaze(<span style="color: #8b2252;">"maze/maze.in"</span>)

    steps := walk(maze, point{0, 0}, point{len(maze) - 1, len(maze[0]) - 1})
    <span style="color: #a020f0;">for</span> _, row := range steps {
        <span style="color: #a020f0;">for</span> _, val := range row {
            fmt.Printf(<span style="color: #8b2252;">"%3d "</span>, val)
        }
        fmt.Println()
    }
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986;</span>
PS D:\project\learngo&gt; go run -race .\maze\maze.go
  0   0   4   5   6
  1   2   3   0   7
  2   0   4   0   8
  0   0   0  10   9
  0   0  12  11   0
  0   0  13  12  13
</pre>
</div>
</div>
</div>
<div id="outline-container-org175fa17" class="outline-4">
<h4 id="org175fa17">å¹¿åº¦ä¼˜å…ˆæ¢ç´¢èµ°è¿·å®«å°ç»“</h4>
<div class="outline-text-4" id="text-org175fa17">
<ul class="org-ul">
<li>ç”¨å¾ªç¯åˆ›å»ºäºŒç»´slice</li>
<li>ä½¿ç”¨sliceæ¥å®ç°é˜Ÿåˆ—</li>
<li>ç”¨Fscanfè¯»å–æ–‡ä»¶</li>
<li>å¯¹Pointçš„æŠ½è±¡</li>
</ul>
</div>
</div>
</div>
</section>
<section id="outline-container-org9f53624" class="outline-2">
<h2 id="org9f53624">æ ‡å‡†åº“</h2>
<div class="outline-text-2" id="text-org9f53624">
</div>
<div id="outline-container-orgcd41bea" class="outline-3">
<h3 id="orgcd41bea">httpåº“</h3>
<div class="outline-text-3" id="text-orgcd41bea">
<p>
é™¤äº†åšæœåŠ¡å™¨è¿˜å¯ä»¥åšclient
</p>
<ul class="org-ul">
<li>ä½¿ç”¨httpå®¢æˆ·ç«¯å‘é€è¯·æ±‚</li>
<li>ä½¿ç”¨http.Clientæ§åˆ¶è¯·æ±‚å¤´éƒ¨ç­‰</li>
<li>ä½¿ç”¨httputilç®€åŒ–å·¥ä½œ</li>
</ul>
</div>
<div id="outline-container-org6d5eedd" class="outline-4">
<h4 id="org6d5eedd">ä½¿ç”¨httpå®¢æˆ·ç«¯å‘é€è¯·æ±‚</h4>
<div class="outline-text-4" id="text-org6d5eedd">
<div class="org-src-container">
<pre class="src src-sh">// http/client.go

package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"fmt"</span>
    <span style="color: #8b2252;">"net/http"</span>
    <span style="color: #8b2252;">"net/http/httputil"</span>
)

func main() {
    resp, err := http.Get(<span style="color: #8b2252;">"http://www.imooc.com"</span>)
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }
    defer resp.Body.Close()

    s, err := httputil.DumpResponse(resp, true)
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }

    fmt.Printf(<span style="color: #8b2252;">"%s\n"</span>, s)
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org4dd4d91" class="outline-4">
<h4 id="org4dd4d91">ä½¿ç”¨http.Clientæ§åˆ¶è¯·æ±‚å¤´éƒ¨ç­‰</h4>
<div class="outline-text-4" id="text-org4dd4d91">
<p>
è®¿é—®æ‰‹æœºç‰ˆæœ¬
</p>
<div class="org-src-container">
<pre class="src src-sh">// http/client.go

package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"fmt"</span>
    <span style="color: #8b2252;">"net/http"</span>
    <span style="color: #8b2252;">"net/http/httputil"</span>
)

func main() {
    request, err := http.NewRequest(http.MethodGet, <span style="color: #8b2252;">"http://www.imooc.com"</span>, nil)
    request.Header.Add(<span style="color: #8b2252;">"User-Agent"</span>,
        <span style="color: #8b2252;">"Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1"</span>)

    client := http.Client{
        CheckRedirect: func(
            req *http.Request,
            via []*http.Request) error {
            fmt.Println(<span style="color: #8b2252;">"Redirect:"</span>, req)
            <span style="color: #a020f0;">return</span> nil
        },
    }
    // resp, err := http.DefaultClient.Do(request)
    resp, err := client.Do(request)
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }
    defer resp.Body.Close()

    s, err := httputil.DumpResponse(resp, true)
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }

    fmt.Printf(<span style="color: #8b2252;">"%s\n"</span>, s)
}


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986; &#21487;&#20197;&#30475;&#21040;&#37325;&#23450;&#21521;&#21040;https://m.imooc.com</span>
PS D:\project\learngo&gt; go run -race .\http\client.go
Redirect: &amp;{GET https://www.imooc.com  0 0 map[Referer:[http://www.imooc.com] User-Agent:[Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1]] &lt;nil&gt; &lt;nil&gt; 0 [] false  map[] map[] &lt;nil&gt; map[]   &lt;nil&gt; &lt;nil&gt; 0xc000206000 0xc0000140c8}
Redirect: &amp;{GET https://m.imooc.com  0 0 map[Referer:[https://www.imooc.com] User-Agent:[Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1]] &lt;nil&gt; &lt;nil&gt; 0 [] false  map[] map[] &lt;nil&gt; map[]   &lt;nil&gt; &lt;nil&gt; 0xc00012a000 0xc0000140c8}
HTTP/1.1 200 OK
Transfer-Encoding: chunked
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdc0620d" class="outline-4">
<h4 id="orgdc0620d">ä½¿ç”¨httputilç®€åŒ–å·¥ä½œ</h4>
<div class="outline-text-4" id="text-orgdc0620d">
<p>
ä½¿ç”¨`httputil.DumpResponse(resp, true)` æ¥ç®€åŒ–å·¥ä½œï¼Œæ‰“å°æ‰€æœ‰å†…å®¹
</p>
</div>
</div>
<div id="outline-container-org5df599a" class="outline-4">
<h4 id="org5df599a">http æœåŠ¡å™¨æ€§èƒ½åˆ†æ</h4>
<div class="outline-text-4" id="text-org5df599a">
<ul class="org-ul">
<li>`import _ "net/http/ppro"`</li>
<li>è®¿é—® /debug/pprof</li>
<li>ä½¿ç”¨`go tool pprof`åˆ†ææ€§èƒ½</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">//&#20462;&#25913; errhanding/filelistinserver/web.go
package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"log"</span>
    <span style="color: #8b2252;">"net/http"</span>
    _ <span style="color: #8b2252;">"net/http/pprof"</span> // &#21152;&#36733;&#19968;&#20123;&#24110;&#21161;&#31243;&#24207;
    <span style="color: #8b2252;">"os"</span>

    <span style="color: #8b2252;">"xxx.com/jasper/learngo/errhandling/filelistingserver/filelisting"</span>
)

func main() {
    http.HandleFunc(<span style="color: #8b2252;">"/"</span>, errWrapper(filelisting.HandleFileList)) // &#32479;&#19968;&#38169;&#35823;&#22788;&#29702;|&#25351;&#23450;&#36335;&#24452;&#65306;&#23558;&#20989;&#25968;&#20013;&#19994;&#21153;&#36923;&#36753;&#25552;&#20986;&#21435;
</pre>
</div>
<p>
è®¿é—®urlæŸ¥çœ‹æ€§èƒ½ï¼š<a href="http://localhost:8888/debug/pprof/">http://localhost:8888/debug/pprof/</a>
30ç§’cpuæ€§èƒ½è¾“å…¥å‘½ä»¤ï¼š`go tool pprof <a href="http://localhost:8888/debug/pprof/profile">http://localhost:8888/debug/pprof/profile</a>` å†è¾“å…¥`web`ä»æµè§ˆå™¨ä¸Šç”¨æ—¶
30ç§’å†…å­˜ä½¿ç”¨ï¼š`go tool ppro <a href="http://localhost:6060/debug/pprof/heap">http://localhost:6060/debug/pprof/heap</a>`ï¼Œ å†è¾“å…¥`web`ä»æµè§ˆå™¨ä¸Šç”¨æ—¶
å¯å¯¹æœåŠ¡è¿›è¡Œç›¸åº”ä¼˜åŒ–
</p>
</div>
</div>
</div>
<div id="outline-container-org9de86df" class="outline-3">
<h3 id="org9de86df">jsonåº“</h3>
<div class="outline-text-3" id="text-org9de86df">
</div>
<div id="outline-container-orgb3b8e80" class="outline-4">
<h4 id="orgb3b8e80">JSONçš„è§£æ</h4>
<div class="outline-text-4" id="text-orgb3b8e80">
<ul class="org-ul">
<li>JSONæ•°æ®æ ¼å¼</li>
<li>ç»“æ„ä½“çš„tag
å¤„ç†å­—æ®µåé—®é¢˜</li>
<li>JSON Marshalä¸Unmarshalï¼Œæ•°æ®ç±»å‹</li>
</ul>
</div>
<div id="outline-container-org363111d" class="outline-5">
<h5 id="org363111d">èŒƒä¾‹ï¼šè½¬JSONæ•°æ®æ ¼å¼`json.Marshal(o)`</h5>
<div class="outline-text-5" id="text-org363111d">
<div class="org-src-container">
<pre class="src src-sh">// lang/json/main.go

package main

import <span style="color: #8b2252;">"fmt"</span>

<span style="color: #483d8b;">type</span> Order struct { // &#35746;&#21333;
    ID         string
    Name       string
    Quantity   int
    TotalPrice float64
}

func main() {
    o := Order{
        ID:         <span style="color: #8b2252;">"1234"</span>,
        Name:       <span style="color: #8b2252;">"learn go"</span>,
        Quantity:   3,
        TotalPrice: 30,
    }

    fmt.Printf(<span style="color: #8b2252;">"%+v\n"</span>, o) // {ID:1234 Name:learn go Quantity:3 TotalPrice:30} &#32570;&#23569;&#24341;&#21495;
}
</pre>
</div>

<p>
ä½¿ç”¨jsonæ‰“å°
</p>
<div class="org-src-container">
<pre class="src src-sh">// lang/json/main.go

package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"encoding/json"</span>
    <span style="color: #8b2252;">"fmt"</span>
)

<span style="color: #483d8b;">type</span> Order struct { // &#35746;&#21333;
    ID         string
    Name       string
    Quantity   int
    TotalPrice float64
}

func main() {
    o := Order{
        ID:         <span style="color: #8b2252;">"1234"</span>,
        Name:       <span style="color: #8b2252;">"learn go"</span>,
        Quantity:   3,
        TotalPrice: 30,
    }

    b, err := json.Marshal(o) // Marsha &#23558;&#20869;&#23384;&#32467;&#26500;&#24207;&#21015;&#21270;&#25104;&#22312;&#32593;&#32476;&#19978;&#20256;&#36755;&#30340;&#23383;&#33410;
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }

    fmt.Printf(<span style="color: #8b2252;">"%s\n"</span>, b) // &#34429;&#28982; b &#26159;&#23383;&#31526;byte&#30340;&#20999;&#29255;[]byte&#65292;&#20294;&#25105;&#20204;&#30693;&#36947;&#23427;&#37324;&#38754;&#26159;&#19968;&#20010;&#23383;&#31526;&#20018;&#65292;&#21487;&#20197;&#29992;%s&#26469;&#25171;&#21360;
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986;</span>
PS D:\project\learngo&gt; go run  .\lang\json\main.go
{<span style="color: #8b2252;">"ID"</span>:<span style="color: #8b2252;">"1234"</span>,<span style="color: #8b2252;">"Name"</span>:<span style="color: #8b2252;">"learn go"</span>,<span style="color: #8b2252;">"Quantity"</span>:3,<span style="color: #8b2252;">"TotalPrice"</span>:30}
</pre>
</div>

<p>
jsonåœ¨ç½‘ç»œä¸Šä¼ è¾“æ˜¯è·¨è¯­è¨€çš„ï¼Œåº”ç”¨æœ‰è‡ªå®šä¹‰å­—æ®µ
ç»™æ¯ä¸ªå­—æ®µæ‰“ä¸Šjsonçš„tag
</p>
<div class="org-src-container">
<pre class="src src-sh">// lang/json/main.go

<span style="color: #483d8b;">type</span> Order struct { // &#35746;&#21333;
    ID         string  <span style="color: #ff00ff;">`json:"id"`</span>
    Name       string  <span style="color: #ff00ff;">`json:"name,omitempty"`</span> // &#31354;&#30340;&#19981;&#30465;&#30053;&#65292;&#19981;&#25171;&#21360;
    Quantity   int     <span style="color: #ff00ff;">`json:"quantity"`</span>
    TotalPrice float64 <span style="color: #ff00ff;">`json:"totalprice"`</span>
}

func main() {
    o := Order{
        ID:         <span style="color: #8b2252;">"1234"</span>,
        Quantity:   3,
        TotalPrice: 30,
    }

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986;</span>
PS D:\project\learngo&gt; go run  .\lang\json\main.go
{<span style="color: #8b2252;">"id"</span>:<span style="color: #8b2252;">"1234"</span>,<span style="color: #8b2252;">"quantity"</span>:3,<span style="color: #8b2252;">"totalprice"</span>:30}
</pre>
</div>

<p>
æ›´å¤æ‚çš„ç»“æ„
</p>
<div class="org-src-container">
<pre class="src src-sh">// lang/json/main.go

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#26159;&#19968;&#20010;&#22823;&#30340;&#23545;&#35937;</span>
<span style="color: #483d8b;">type</span> OrderItem struct {
    ID    string  <span style="color: #ff00ff;">`json:"id"`</span>
    Name  string  <span style="color: #ff00ff;">`json:"name,omitempty"`</span> // &#31354;&#30340;&#19981;&#30465;&#30053;&#65292;&#19981;&#25171;&#21360;
    Price float64 <span style="color: #ff00ff;">`json:"price"`</span>
}

<span style="color: #483d8b;">type</span> Order struct { // &#35746;&#21333;
    ID         string    <span style="color: #ff00ff;">`json:"id"`</span>
    Item       OrderItem <span style="color: #ff00ff;">`json:"Item"`</span>
    Quantity   int       <span style="color: #ff00ff;">`json:"quantity"`</span>
    TotalPrice float64   <span style="color: #ff00ff;">`json:"totalprice"`</span>
}

func main() {
    o := Order{
        ID:         <span style="color: #8b2252;">"1234"</span>,
        Quantity: 3,
        TotalPrice: 30,
        Item: OrderItem{
            ID: <span style="color: #8b2252;">"item_1"</span>,
            Name: <span style="color: #8b2252;">"learn go"</span>,
            Price: 15,
        },
    }

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986;</span>
PS D:\project\learngo&gt; go run  .\lang\json\main.go
{<span style="color: #8b2252;">"id"</span>:<span style="color: #8b2252;">"1234"</span>,<span style="color: #8b2252;">"Item"</span>:{<span style="color: #8b2252;">"id"</span>:<span style="color: #8b2252;">"item_1"</span>,<span style="color: #8b2252;">"name"</span>:<span style="color: #8b2252;">"learn go"</span>,<span style="color: #8b2252;">"price"</span>:15},<span style="color: #8b2252;">"quantity"</span>:3,<span style="color: #8b2252;">"totalprice"</span>:30}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#26159;&#23884;&#20837;&#25351;&#38024;</span>
<span style="color: #483d8b;">type</span> OrderItem struct {
    ID    string  <span style="color: #ff00ff;">`json:"id"`</span>
    Name  string  <span style="color: #ff00ff;">`json:"name,omitempty"`</span> // &#31354;&#30340;&#19981;&#30465;&#30053;&#65292;&#19981;&#25171;&#21360;
    Price float64 <span style="color: #ff00ff;">`json:"price"`</span>
}

<span style="color: #483d8b;">type</span> Order struct { // &#35746;&#21333;
    ID         string    <span style="color: #ff00ff;">`json:"id"`</span>
    Item       *OrderItem <span style="color: #ff00ff;">`json:"Item"`</span> // &#25351;&#21521;&#32531;&#23384;&#30340;OrderItem
    Quantity   int       <span style="color: #ff00ff;">`json:"quantity"`</span>
    TotalPrice float64   <span style="color: #ff00ff;">`json:"totalprice"`</span>
}

func main() {
    o := Order{
        ID:         <span style="color: #8b2252;">"1234"</span>,
        Quantity: 3,
        TotalPrice: 30,
        Item: &amp;OrderItem{
            ID: <span style="color: #8b2252;">"item_1"</span>,
            Name: <span style="color: #8b2252;">"learn go"</span>,
            Price: 15,
        },
    }

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986;</span>
PS D:\project\learngo&gt; go run  .\lang\json\main.go
{<span style="color: #8b2252;">"id"</span>:<span style="color: #8b2252;">"1234"</span>,<span style="color: #8b2252;">"Item"</span>:{<span style="color: #8b2252;">"id"</span>:<span style="color: #8b2252;">"item_1"</span>,<span style="color: #8b2252;">"name"</span>:<span style="color: #8b2252;">"learn go"</span>,<span style="color: #8b2252;">"price"</span>:15},<span style="color: #8b2252;">"quantity"</span>:3,<span style="color: #8b2252;">"totalprice"</span>:30}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#26159;&#25968;&#32452;</span>
<span style="color: #483d8b;">type</span> Order struct { // &#35746;&#21333;
    ID         string      <span style="color: #ff00ff;">`json:"id"`</span>
    Items      []OrderItem <span style="color: #ff00ff;">`json:"Item"`</span> // &#25351;&#21521;&#32531;&#23384;&#30340;OrderItem
    TotalPrice float64     <span style="color: #ff00ff;">`json:"totalprice"`</span>
}

func main() {
    o := Order{
        ID:         <span style="color: #8b2252;">"1234"</span>,
        TotalPrice: 20,
        Items: []OrderItem{
            {
                ID: <span style="color: #8b2252;">"item_1"</span>,
                Name:  <span style="color: #8b2252;">"learn go"</span>,
                Price: 15,
            },
            {
                ID: <span style="color: #8b2252;">"item_2"</span>,
                Name:  <span style="color: #8b2252;">"interview"</span>,
                Price: 10,
            },
        },
    }

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986;</span>
PS D:\project\learngo&gt; go run  .\lang\json\main.go
{<span style="color: #8b2252;">"id"</span>:<span style="color: #8b2252;">"1234"</span>,<span style="color: #8b2252;">"Item"</span>:[{<span style="color: #8b2252;">"id"</span>:<span style="color: #8b2252;">"item_1"</span>,<span style="color: #8b2252;">"name"</span>:<span style="color: #8b2252;">"learn go"</span>,<span style="color: #8b2252;">"price"</span>:15},{<span style="color: #8b2252;">"id"</span>:<span style="color: #8b2252;">"item_2"</span>,<span style="color: #8b2252;">"name"</span>:<span style="color: #8b2252;">"interview"</span>,<span style="color: #8b2252;">"price"</span>:10}],<span style="color: #8b2252;">"totalprice"</span>:20}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#26159;&#25351;&#38024;&#25968;&#32452;</span>
<span style="color: #483d8b;">type</span> Order struct { // &#35746;&#21333;
    ID         string      <span style="color: #ff00ff;">`json:"id"`</span>
    Items      []*OrderItem <span style="color: #ff00ff;">`json:"Item"`</span> // &#25351;&#21521;&#32531;&#23384;&#30340;OrderItem
    TotalPrice float64     <span style="color: #ff00ff;">`json:"totalprice"`</span>
}

func main() {
    o := Order{
        ID:         <span style="color: #8b2252;">"1234"</span>,
        TotalPrice: 20,
        Items: []*OrderItem{
            {
                ID: <span style="color: #8b2252;">"item_1"</span>,
                Name:  <span style="color: #8b2252;">"learn go"</span>,
                Price: 15,
            },
            {
                ID: <span style="color: #8b2252;">"item_2"</span>,
                Name:  <span style="color: #8b2252;">"interview"</span>,
                Price: 10,
            },
        },
    }
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986;&#32467;&#26524;&#26159;&#19968;&#26679;&#30340;</span>
PS D:\project\learngo&gt; go run  .\lang\json\main.go
{<span style="color: #8b2252;">"id"</span>:<span style="color: #8b2252;">"1234"</span>,<span style="color: #8b2252;">"Item"</span>:[{<span style="color: #8b2252;">"id"</span>:<span style="color: #8b2252;">"item_1"</span>,<span style="color: #8b2252;">"name"</span>:<span style="color: #8b2252;">"learn go"</span>,<span style="color: #8b2252;">"price"</span>:15},{<span style="color: #8b2252;">"id"</span>:<span style="color: #8b2252;">"item_2"</span>,<span style="color: #8b2252;">"name"</span>:<span style="color: #8b2252;">"interview"</span>,<span style="color: #8b2252;">"price"</span>:10}],<span style="color: #8b2252;">"totalprice"</span>:20}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc36b05a" class="outline-5">
<h5 id="orgc36b05a">jsonè§£æ</h5>
<div class="outline-text-5" id="text-orgc36b05a">
<p>
èŒƒä¾‹ï¼šç”ŸæˆJSONæ•°æ®æ ¼å¼`json.Marshal(o)`
</p>
<div class="org-src-container">
<pre class="src src-sh">// lang/json/main.go

package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"encoding/json"</span>
    <span style="color: #8b2252;">"fmt"</span>
)

<span style="color: #483d8b;">type</span> OrderItem struct {
    ID    string  <span style="color: #ff00ff;">`json:"id"`</span>
    Name  string  <span style="color: #ff00ff;">`json:"name,omitempty"`</span> // &#31354;&#30340;&#19981;&#30465;&#30053;&#65292;&#19981;&#25171;&#21360;
    Price float64 <span style="color: #ff00ff;">`json:"price"`</span>
}

<span style="color: #483d8b;">type</span> Order struct { // &#35746;&#21333;
    ID         string       <span style="color: #ff00ff;">`json:"id"`</span>
    Items      []OrderItem <span style="color: #ff00ff;">`json:"Item"`</span> // &#25351;&#21521;&#32531;&#23384;&#30340;OrderItem
    TotalPrice float64      <span style="color: #ff00ff;">`json:"totalprice"`</span>
}

func main() {
    unmarshal()
}

func unmarshal() {
    s := <span style="color: #ff00ff;">`{"id":"1234","Item":[{"id":"item_1","name":"learn go","price":15},{"id":"item_2","name":"interview","price":10}],"totalprice":20}`</span>
    var o Order // &#23450;&#20041;&#19968;&#20010;order&#26469;&#25509;&#25910;
    err := json.Unmarshal([]byte(s), &amp;o)
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }
    fmt.Printf(<span style="color: #8b2252;">"%+v\n"</span>, o)
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986;&#32467;&#26524;&#26159;&#19968;&#26679;&#30340;</span>
PS D:\project\learngo&gt; go run  .\lang\json\main.go
{ID:1234 Items:[{ID:item_1 Name:learn go Price:15} {ID:item_2 Name:interview Price:10}] TotalPrice:20}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org3468308" class="outline-3">
<h3 id="org3468308">ç¬¬ä¸‰æ–¹APIæ•°æ®æ ¼å¼çš„è§£ææŠ€å·§</h3>
<div class="outline-text-3" id="text-org3468308">
<p>
èŒƒä¾‹
</p>
<div class="org-src-container">
<pre class="src src-sh">res := <span style="color: #ff00ff;">`{</span>
<span style="color: #ff00ff;">"data": [</span>
<span style="color: #ff00ff;">    {</span>
<span style="color: #ff00ff;">        "synonym":"",</span>
<span style="color: #ff00ff;">        "weight":"0.6",</span>
<span style="color: #ff00ff;">        "word": "&#30495;&#19997;",</span>
<span style="color: #ff00ff;">        "tag":"&#26448;&#36136;"</span>
<span style="color: #ff00ff;">    },</span>
<span style="color: #ff00ff;">    {</span>
<span style="color: #ff00ff;">        "synonym":"",</span>
<span style="color: #ff00ff;">        "weight":"0.8",</span>
<span style="color: #ff00ff;">        "word": "&#38889;&#37117;&#34915;&#33293;",</span>
<span style="color: #ff00ff;">        "tag":"&#21697;&#29260;"</span>
<span style="color: #ff00ff;">    },</span>
<span style="color: #ff00ff;">    {</span>
<span style="color: #ff00ff;">        "synonym":"&#36830;&#36523;&#35033;;&#32852;&#34915;&#35033;",</span>
<span style="color: #ff00ff;">        "weight":"1.0",</span>
<span style="color: #ff00ff;">        "word": "&#36830;&#34915;&#35033;",</span>
<span style="color: #ff00ff;">        "tag":"&#21697;&#31867;"</span>
<span style="color: #ff00ff;">    }</span>
<span style="color: #ff00ff;">]</span>
<span style="color: #ff00ff;">}`</span>
</pre>
</div>

<p>
ä½¿ç”¨mapæ¥æ”¶
</p>
<div class="org-src-container">
<pre class="src src-sh">// json&#35299;&#26512;
m := make(map[string]interface{})
err := json.Unmarshal([]byte(res), &amp;m)
<span style="color: #a020f0;">if</span> err != nil {
        panic(err)
}

<span style="color: #0000ff;">fmt.Printf</span>(<span style="color: #8b2252;">"%+v\n"</span>, m) // map[data:[map[synonym: tag:&#26448;&#36136; weight:0.6 word:&#30495;&#19997;] map[synonym: tag:&#21697;&#29260; weight:0.8 word:&#38889;&#37117;&#34915;&#33293;] map[synonym:&#36830;&#36523;&#35033;;&#32852;&#34915;&#35033; tag:&#21697;&#31867; weight:1.0 word:&#36830;&#34915;&#35033;]]]

// &#21462;&#20986; <span style="color: #8b2252;">"&#36830;&#36523;&#35033;;&#32852;&#34915;&#35033;"</span>
<span style="color: #0000ff;">fmt.Printf</span>(<span style="color: #8b2252;">"%+v\n"</span>,m[<span style="color: #8b2252;">"data"</span>].([]interface{})[2].(map[string]interface{})[<span style="color: #8b2252;">"synonym"</span>]   ) // &#20351;&#29992;type assertion &#21578;&#35785;&#27599;&#20010;&#20803;&#32032;&#30340;&#31867;&#22411;
</pre>
</div>
<p>
ç¼ºç‚¹ï¼šå¤„ç†mapæ—¶ä»£ç éš¾æ‡‚
</p>

<p>
å®šä¹‰ç»“æ„
</p>
<div class="org-src-container">
<pre class="src src-sh">// json&#35299;&#26512;
m := struct{
        Data []struct{
                Synonym string <span style="color: #ff00ff;">`json:"synonym"`</span>
        } <span style="color: #ff00ff;">`json:"data"`</span>
}{}
err := json.Unmarshal([]byte(res), &amp;m)
<span style="color: #a020f0;">if</span> err != nil {
        panic(err)
}

<span style="color: #0000ff;">fmt.Printf</span>(<span style="color: #8b2252;">"%+v\n"</span>, m.Data[2].Synonym)
</pre>
</div>
</div>
</div>
<div id="outline-container-org2e9fe83" class="outline-3">
<h3 id="org2e9fe83">ginæ¡†æ¶</h3>
<div class="outline-text-3" id="text-org2e9fe83">
<p>
goè¯­è¨€æ¡†æ¶çš„è®¾è®¡æ€è·¯åŸºæœ¬éƒ½æ˜¯ä¸€æ ·çš„
</p>

<ul class="org-ul">
<li>`gin-gonic/gin`</li>
<li>middlewareçš„ä½¿ç”¨
æ³¨å†Œä¸€äº›å‡½æ•°ï¼Œè®©æ‰€æœ‰çš„è¯·æ±‚éƒ½ä»middlewareèµ°è¿‡</li>
<li>contextçš„ä½¿ç”¨
åŒ…æ‹¬ç”¨æˆ·è¯·æ±‚ã€åé¦ˆæ˜¯ä»€ä¹ˆæ ·çš„ã€è®¾ç½®è‡ªå·±çš„key value</li>
</ul>
</div>
<div id="outline-container-orgc5718a9" class="outline-4">
<h4 id="orgc5718a9">`gin-gonic/gin`</h4>
<div class="outline-text-4" id="text-orgc5718a9">
<div class="org-src-container">
<pre class="src src-sh">go get -u github.com/gin-gonic/gin
</pre>
</div>

<p>
èŒƒä¾‹ï¼šç®€å•æ¼”ç¤º
</p>
<div class="org-src-container">
<pre class="src src-sh">// lang/http/gindemo/ginserver.go

package main

import <span style="color: #8b2252;">"github.com/gin-gonic/gin"</span>

func main() {
        r := gin.Default()  // &#36820;&#22238;&#19968;&#20010;gin&#30340;Engine
        r.GET(<span style="color: #8b2252;">"/ping"</span>, func(c *gin.Context) { // Engine&#26377;&#20010;Get&#26041;&#27861;&#65292;&#23427;&#27880;&#20876;&#21040;ping&#19978;&#38754;&#65292; &#36820;&#22238;&#20102;&#20010;json
                c.JSON(200, gin.H{
                        <span style="color: #8b2252;">"message"</span>: <span style="color: #8b2252;">"pong"</span>,
                })
        })
        r.Run() // listen and serve on 0.0.0.0:8080 (<span style="color: #a020f0;">for</span> windows <span style="color: #8b2252;">"localhost:8080"</span>)
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35831;&#27714; http://localhost:8080/ping</span>
[GIN-debug] Environment variable PORT is undefined. Using port :8080 by default
[GIN-debug] Listening and serving HTTP on :8080
[GIN] 2021/11/24 - 00:34:44 |?[97;42m 200 ?[0m|            0s |             ::1 |?[97;44m GET     ?[0m <span style="color: #8b2252;">"/ping"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org48f507f" class="outline-4">
<h4 id="org48f507f">middlewareçš„ä½¿ç”¨</h4>
<div class="outline-text-4" id="text-org48f507f">
<p>
ä¸è®ºè®¿é—®å“ªä¸ªè·¯å¾„ï¼Œä¸€å¾‹è¿›å…¥åˆ°r.useä¸­
</p>



<p>
èŒƒä¾‹ï¼šä½¿ç”¨middlewareç»Ÿä¸€çš„å†™æ—¥å¿—
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#23433;&#35013;&#20889;&#26085;&#24535;&#30340;&#24211;zap</span>
go get -u go.uber.org/zap
</pre>
</div>

<p>
è¾“å‡ºpath
</p>
<div class="org-src-container">
<pre class="src src-sh">// lang/http/gindemo/ginserver.go

package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"github.com/gin-gonic/gin"</span>
    <span style="color: #8b2252;">"go.uber.org/zap"</span>
)

func main() {
    r := gin.Default()
    logger, err := zap.NewProduction()
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }

    r.Use(func(c *gin.Context) {
        // path, log latency, response code
        logger.Info(<span style="color: #8b2252;">"incoming request"</span>,
            zap.String(<span style="color: #8b2252;">"path"</span>, c.Request.URL.Path))

        c.Next()
    })

    r.GET(<span style="color: #8b2252;">"/ping"</span>, func(c *gin.Context) {
        c.JSON(200, gin.H{
            <span style="color: #8b2252;">"message"</span>: <span style="color: #8b2252;">"pong"</span>,
        })
    })

    r.GET(<span style="color: #8b2252;">"/hello"</span>, func(c *gin.Context) {
        c.String(200, <span style="color: #8b2252;">"hello"</span>)
    })

    r.Run()
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35775;&#27714;&#36755;&#20986;&#12290;&#35831;&#38382;http://localhost:8080/ping, http://localhost:8080/hello, http://localhost:8080/</span>
{<span style="color: #8b2252;">"level"</span>:<span style="color: #8b2252;">"info"</span>,<span style="color: #8b2252;">"ts"</span>:1637686464.1075187,<span style="color: #8b2252;">"caller"</span>:<span style="color: #8b2252;">"gindemo/ginserver.go:17"</span>,<span style="color: #8b2252;">"msg"</span>:<span style="color: #8b2252;">"incoming request"</span>,<span style="color: #8b2252;">"path"</span>:<span style="color: #8b2252;">"/ping"</span>}
[GIN] 2021/11/24 - 00:54:24 |?[97;42m 200 ?[0m|       994.2&#181;s |             ::1 |?[97;44m GET     ?[0m <span style="color: #8b2252;">"/ping"</span>
{<span style="color: #8b2252;">"level"</span>:<span style="color: #8b2252;">"info"</span>,<span style="color: #8b2252;">"ts"</span>:1637686478.7833898,<span style="color: #8b2252;">"caller"</span>:<span style="color: #8b2252;">"gindemo/ginserver.go:17"</span>,<span style="color: #8b2252;">"msg"</span>:<span style="color: #8b2252;">"incoming request"</span>,<span style="color: #8b2252;">"path"</span>:<span style="color: #8b2252;">"/hello"</span>}
[GIN] 2021/11/24 - 00:54:38 |?[97;42m 200 ?[0m|       290.7&#181;s |             ::1 |?[97;44m GET     ?[0m <span style="color: #8b2252;">"/hello"</span>
{<span style="color: #8b2252;">"level"</span>:<span style="color: #8b2252;">"info"</span>,<span style="color: #8b2252;">"ts"</span>:1637686482.1059425,<span style="color: #8b2252;">"caller"</span>:<span style="color: #8b2252;">"gindemo/ginserver.go:17"</span>,<span style="color: #8b2252;">"msg"</span>:<span style="color: #8b2252;">"incoming request"</span>,<span style="color: #8b2252;">"path"</span>:<span style="color: #8b2252;">"/"</span>}
[GIN] 2021/11/24 - 00:54:42 |?[90;43m 404 ?[0m|         788&#181;s |             ::1 |?[97;44m GET     ?[0m <span style="color: #8b2252;">"/"</span>
</pre>
</div>

<p>
è€—æ—¶ï¼ŒçŠ¶æ€
</p>
<div class="org-src-container">
<pre class="src src-sh">
// lang/http/gindemo/ginserver.go

package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"time"</span>

    <span style="color: #8b2252;">"github.com/gin-gonic/gin"</span>
    <span style="color: #8b2252;">"go.uber.org/zap"</span>
)

func main() {
    r := gin.Default()
    logger, err := zap.NewProduction()
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }

    r.Use(func(c *gin.Context) {
        s := time.Now() // &#35760;&#24405;&#24320;&#22987;&#26102;&#38388;

        c.Next() // &#23427;&#20043;&#21518;&#23601;&#21487;&#20197; response code

        // path, response code, log latency
        logger.Info(<span style="color: #8b2252;">"incoming request"</span>,
            zap.String(<span style="color: #8b2252;">"path"</span>, c.Request.URL.Path),
            zap.Int(<span style="color: #8b2252;">"status"</span>, c.Writer.Status()),
            zap.Duration(<span style="color: #8b2252;">"elapsed"</span>, time.Now().Sub(s))) // &#23558;&#32467;&#26463;&#26102;&#38388;&#35760;&#24405;&#36827;&#21435;
    })

    r.GET(<span style="color: #8b2252;">"/ping"</span>, func(c *gin.Context) {
        c.JSON(200, gin.H{
            <span style="color: #8b2252;">"message"</span>: <span style="color: #8b2252;">"pong"</span>,
        })
    })

    r.GET(<span style="color: #8b2252;">"/hello"</span>, func(c *gin.Context) {
        c.String(200, <span style="color: #8b2252;">"hello"</span>)
    })

    r.Run()
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35775;&#27714;&#36755;&#20986;&#12290;&#35831;&#38382;http://localhost:8080/ping, http://localhost:8080/hello, http://localhost:8080/</span>
{<span style="color: #8b2252;">"level"</span>:<span style="color: #8b2252;">"info"</span>,<span style="color: #8b2252;">"ts"</span>:1637687286.6143937,<span style="color: #8b2252;">"caller"</span>:<span style="color: #8b2252;">"gindemo/ginserver.go:23"</span>,<span style="color: #8b2252;">"msg"</span>:<span style="color: #8b2252;">"incoming request"</span>,<span style="color: #8b2252;">"path"</span>:<span style="color: #8b2252;">"/"</span>,<span style="color: #8b2252;">"status"</span>:404,<span style="color: #8b2252;">"elapsed"</span>:0}
[GIN] 2021/11/24 - 01:08:06 |?[90;43m 404 ?[0m|       998.5&#181;s |             ::1 |?[97;44m GET     ?[0m <span style="color: #8b2252;">"/"</span>
{<span style="color: #8b2252;">"level"</span>:<span style="color: #8b2252;">"info"</span>,<span style="color: #8b2252;">"ts"</span>:1637687290.1554174,<span style="color: #8b2252;">"caller"</span>:<span style="color: #8b2252;">"gindemo/ginserver.go:23"</span>,<span style="color: #8b2252;">"msg"</span>:<span style="color: #8b2252;">"incoming request"</span>,<span style="color: #8b2252;">"path"</span>:<span style="color: #8b2252;">"/hello"</span>,<span style="color: #8b2252;">"status"</span>:200,<span style="color: #8b2252;">"elapsed"</span>:0.0005609}
[GIN] 2021/11/24 - 01:08:10 |?[97;42m 200 ?[0m|       560.9&#181;s |             ::1 |?[97;44m GET     ?[0m <span style="color: #8b2252;">"/hello"</span>
{<span style="color: #8b2252;">"level"</span>:<span style="color: #8b2252;">"info"</span>,<span style="color: #8b2252;">"ts"</span>:1637687294.1163,<span style="color: #8b2252;">"caller"</span>:<span style="color: #8b2252;">"gindemo/ginserver.go:23"</span>,<span style="color: #8b2252;">"msg"</span>:<span style="color: #8b2252;">"incoming request"</span>,<span style="color: #8b2252;">"path"</span>:<span style="color: #8b2252;">"/ping"</span>,<span style="color: #8b2252;">"status"</span>:200,<span style="color: #8b2252;">"elapsed"</span>:0.000952}
[GIN] 2021/11/24 - 01:08:14 |?[97;42m 200 ?[0m|         952&#181;s |             ::1 |?[97;44m GET     ?[0m <span style="color: #8b2252;">"/ping"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org35e9fc5" class="outline-4">
<h4 id="org35e9fc5">contextçš„ä½¿ç”¨</h4>
<div class="outline-text-4" id="text-org35e9fc5">
<p>
gin.Contextå®ç°äº†context åº“Contextæ¥å£
</p>

<p>
èŒƒä¾‹ï¼šå°†æ•°å­—æ’å…¥åˆ°æ¯ä¸€ä¸ªrequestä¸­ç”ŸæˆrequestId
</p>
<div class="org-src-container">
<pre class="src src-sh">// lang/http/gindemo/ginserver.go

package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"math/rand"</span>
    <span style="color: #8b2252;">"time"</span>

    <span style="color: #8b2252;">"github.com/gin-gonic/gin"</span>
    <span style="color: #8b2252;">"go.uber.org/zap"</span>
)

func main() {
    r := gin.Default()
    logger, err := zap.NewProduction()
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }

    r.Use(func(c *gin.Context) {
        s := time.Now() // &#35760;&#24405;&#24320;&#22987;&#26102;&#38388;

        c.Next() // &#23427;&#20043;&#21518;&#23601;&#21487;&#20197; response code

        // path, response code, log latency
        logger.Info(<span style="color: #8b2252;">"incoming request"</span>,
            zap.String(<span style="color: #8b2252;">"path"</span>, c.Request.URL.Path),
            zap.Int(<span style="color: #8b2252;">"status"</span>, c.Writer.Status()),
            zap.Duration(<span style="color: #8b2252;">"elapsed"</span>, time.Now().Sub(s))) // &#23558;&#32467;&#26463;&#26102;&#38388;&#35760;&#24405;&#36827;&#21435;
    }, func(c *gin.Context) {
        c.Set(<span style="color: #8b2252;">"requestId"</span>, rand.Int())
        c.Next()
    })

    r.GET(<span style="color: #8b2252;">"/ping"</span>, func(c *gin.Context) {

        h := gin.H{
            <span style="color: #8b2252;">"message"</span>: <span style="color: #8b2252;">"pong"</span>,
        }
        <span style="color: #a020f0;">if</span> rid, exists := c.Get(<span style="color: #8b2252;">"requestId"</span>); exists { // &#21028;&#26029;requestId&#22312;&#19981;&#22312;
            h[<span style="color: #8b2252;">"requestId"</span>] = rid
        }
        c.JSON(200, h)
    })

    r.GET(<span style="color: #8b2252;">"/hello"</span>, func(c *gin.Context) {
        c.String(200, <span style="color: #8b2252;">"hello"</span>)
    })

    r.Run()
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35775;&#27714;&#36755;&#20986;&#12290;&#27983;&#35272;&#22120;&#35831;&#38382;http://localhost:8080/ping</span>
{<span style="color: #8b2252;">"message"</span>:<span style="color: #8b2252;">"pong"</span>,<span style="color: #8b2252;">"requestId"</span>:3916589616287113937}
</pre>
</div>

<p>
requestIdå¸¸é‡
</p>
<div class="org-src-container">
<pre class="src src-sh">// lang/http/gindemo/ginserver.go

package main

<span style="color: #0000ff;">import</span> (
    <span style="color: #8b2252;">"math/rand"</span>
    <span style="color: #8b2252;">"time"</span>

    <span style="color: #8b2252;">"github.com/gin-gonic/gin"</span>
    <span style="color: #8b2252;">"go.uber.org/zap"</span>
)

const keyRequestId = <span style="color: #8b2252;">"requestId"</span>

func main() {
    r := gin.Default()
    logger, err := zap.NewProduction()
    <span style="color: #a020f0;">if</span> err != nil {
        panic(err)
    }

    r.Use(func(c *gin.Context) {
        s := time.Now() // &#35760;&#24405;&#24320;&#22987;&#26102;&#38388;

        c.Next() // &#23427;&#20043;&#21518;&#23601;&#21487;&#20197; response code

        // path, response code, log latency
        logger.Info(<span style="color: #8b2252;">"incoming request"</span>,
            zap.String(<span style="color: #8b2252;">"path"</span>, c.Request.URL.Path),
            zap.Int(<span style="color: #8b2252;">"status"</span>, c.Writer.Status()),
            zap.Duration(<span style="color: #8b2252;">"elapsed"</span>, time.Now().Sub(s))) // &#23558;&#32467;&#26463;&#26102;&#38388;&#35760;&#24405;&#36827;&#21435;
    }, func(c *gin.Context) {
        c.Set(keyRequestId, rand.Int())
        c.Next()
    })

    r.GET(<span style="color: #8b2252;">"/ping"</span>, func(c *gin.Context) {

        h := gin.H{
            <span style="color: #8b2252;">"message"</span>: <span style="color: #8b2252;">"pong"</span>,
        }
        <span style="color: #a020f0;">if</span> rid, exists := c.Get(keyRequestId); exists { // &#21028;&#26029;requestId&#22312;&#19981;&#22312;
            h[keyRequestId] = rid
        }
        c.JSON(200, h)
    })

    r.GET(<span style="color: #8b2252;">"/hello"</span>, func(c *gin.Context) {
        c.String(200, <span style="color: #8b2252;">"hello"</span>)
    })

    r.Run()
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35775;&#27714;&#36755;&#20986;&#12290;&#27983;&#35272;&#22120;&#35831;&#38382;http://localhost:8080/ping</span>
{<span style="color: #8b2252;">"message"</span>:<span style="color: #8b2252;">"pong"</span>,<span style="color: #8b2252;">"requestId"</span>:3916589616287113937}
</pre>
</div>
</div>
</div>
</div>
</section>
</main class="container">
<footer id="postamble" class="status">
<footer data-astro-cid-sz7xmlte data-turbo-permanent id=rootFooter>
    <script>
        const shuffle = e => e.map((e => ({
            v: e,
            sort: Math.random()
        }))).sort(( (e, o) => e.sort - o.sort)).map(( ({v: e}) => e));
        var songList = ["barbie-girl--stantough", "blue-da-ba-dee--cornelius-link", "hips-dont-lie--stantough", "i-want-it-that-way--stantough", "seven-nation-army--stantough", "smooth-criminal--stantough"]
          , songOrder = songOrder ?? shuffle(songList).map((e => `/audio/music/${e}.opus`))
          , song = new Audio(songOrder[0])
          , nextSong = new Audio(songOrder[1])
          , songIndex = 2
          , musicWrapper = void 0
          , arrow = void 0
          , notes = void 0;
        song.addEventListener("ended", next);
        const toggle = () => song.paused ? play() : pause();
        function play() {
            song.play(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.add("shakeManHorse"),
            notes.classList.remove("hideNotes")
        }
        function pause() {
            song.pause(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.remove("shakeManHorse"),
            notes.classList.add("hideNotes")
        }
        function next() {
            song = nextSong,
            play(),
            songIndex === songOrder.length && (songIndex = 0),
            nextSong = new Audio(songOrder[songIndex]),
            songIndex += 1
        }
        function skip() {
            pause(),
            (arrow = arrow || document.getElementById("musicArrow")).classList.add("shootArrow");
            new Audio("/audio/effects/ohno.m4a").play(),
            arrow.addEventListener("animationend", arrowShootHandler, !1)
        }
        function arrowShootHandler() {
            arrow.removeEventListener("animationend", arrowShootHandler, !1),
            arrow.classList.remove("shootArrow");
            new Audio("/audio/effects/heythathurt.m4a").play(),
            next()
        }
    </script>
    <div id=musicPlayer data-astro-cid-q7a5pyro>
        <button class=skip data-astro-cid-q7a5pyro onclick=skip() title="Skip song">
            <div id=skipWrapper data-astro-cid-q7a5pyro>
                <img alt="Medieval drollery of a man/snail/bat/monkey shooting an arrow" class=archer decoding=async height=334 loading=lazy src=/images/archer-no-arrow.448ccd8b_Z1KfRYq.webp width=226 data-astro-cid-q7a5pyro>
                <img alt="Arrow for archer" class="arrow complete" decoding=async height=23 loading=lazy src=/images/no-archer-full-arrow.87aa9971_Z2qL2KO.webp width=141 data-astro-cid-q7a5pyro id=musicArrow>
            </div>
        </button>
        <button class=playPause data-astro-cid-q7a5pyro onclick=toggle() title="Play/pause song">
            <div id=musicWrapper data-astro-cid-q7a5pyro>
                <div class=hideNotes id=notesWrapper data-astro-cid-q7a5pyro>
                    <div class=lyreNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                    <div class=fluteNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                </div>
                <img alt="Medieval drollery of a man/horse playing a lyre and a horn" class=manHorse decoding=async height=665 loading=lazy src=/images/man-horse-band.e3a2efcf_q8FCa.webp width=531 data-astro-cid-q7a5pyro>
            </div>
        </button>
    </div>
    <hr data-astro-cid-sz7xmlte>
    <div class=salutation data-astro-cid-gdmrbrho>
        <p data-astro-cid-gdmrbrho>
            <span class=flower2 data-astro-cid-gdmrbrho>A</span>
            <span class=smallcap data-astro-cid-gdmrbrho>pax vobiscum</span>
            <span class="flower2 wiggle" data-astro-cid-gdmrbrho id=leaf>a</span>
        </p>
    </div>
    <script>
        function animateLeafBlownHandler() {
            leaf.removeEventListener("animationend", animateLeafBlownHandler, !1),
            leaf.classList.remove("blownAway"),
            leaf.classList.add("wiggle")
        }
        function animateLeaf() {
            leaf = leaf ?? document.getElementById("leaf"),
            leaf.classList.remove("wiggle"),
            leaf.classList.add("blownAway"),
            leaf.addEventListener("animationend", animateLeafBlownHandler, !1)
        }
        document.getElementById("leaf").onclick = animateLeaf
    </script>


    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>æ‰“èµ</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Â© 2024 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
</footer>
</footer>
</body>
</html>
