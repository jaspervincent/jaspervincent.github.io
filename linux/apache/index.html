<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linux: Apache</title>
<meta name="generator" content="Org Mode" />
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<!-- from -->
<!--
<style>#back-to-top{background:#000;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;bottom:20px;-webkit-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);-moz-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);box-shadow:0 2px 5px 0 rgba(0,0,0,.26);color:#fff;cursor:pointer;display:block;height:56px;opacity:1;outline:0;position:fixed;right:20px;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-transition:bottom .2s,opacity .2s;-o-transition:bottom .2s,opacity .2s;-moz-transition:bottom .2s,opacity .2s;transition:bottom .2s,opacity .2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:56px;z-index:1}#back-to-top svg{display:block;fill:currentColor;height:24px;margin:16px auto 0;width:24px}#back-to-top.hidden{bottom:-56px;opacity:0}</style>
-->
<link rel="stylesheet" href="/static/aandds.com/css/main.css">
<link rel="stylesheet" href="/static/aandds.com/css/drollery.min.css">
<script type="text/javascript" src="/static/aandds.com/js/main.js"></script>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Linux: Apache</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:f3d0ae14-db0f-45c1-81bb-f24579f47e1b">Internet和HTTP协议</a>
<ul>
<li><a href="#h:24b8ff8b-b50a-4394-aa71-bf89e2ffac05">Internet 因特网</a></li>
<li><a href="#h:7a6a52db-7d93-43e6-9bda-6c3bea2669ae">Internet 和中国</a></li>
<li><a href="#h:f2c3ffbe-8e83-499e-81b9-357257cca1c3">跨网络的主机间通讯</a></li>
<li><a href="#h:abc1b8b1-5c73-4dce-9376-eeb6e5eaf8c0">HTTP 超文本传输协议</a>
<ul>
<li><a href="#h:1ce2cdca-fa2d-4fb8-ac6c-832cfb08e004">HTTP相关概念</a></li>
<li><a href="#h:3009b3c2-3b39-43b6-8fc0-059ddcd8d644">浏览器访问网站的过程</a></li>
<li><a href="#h:1e22b3b9-c5a4-4e73-9ece-7c73b8e30069">HTTP协议通信过程</a></li>
<li><a href="#h:193bb043-ab96-496c-8408-db365ae38e77">HTTP相关技术</a>
<ul>
<li><a href="#h:e1f33359-e873-45d0-a945-c51021c0a511">WEB开发语言</a></li>
<li><a href="#h:a0da3dce-ec3e-476a-872b-5b6362b10dd4">MIME</a></li>
<li><a href="#h:3c105a70-4ab7-436d-94d8-e8068c6f48ec">URI和URL</a></li>
<li><a href="#h:08c7a8e6-754f-4876-8d45-3ff7897e8510">网站访问量</a></li>
</ul>
</li>
<li><a href="#h:f3d871b6-f9fa-42d9-aa7c-cdef8b0a4364">HTTP工作机制</a></li>
<li><a href="#h:0090c568-0462-41f5-b9f7-9045deab098b">HTTP 协议版本</a></li>
<li><a href="#h:9ccaba6b-2fce-4569-bca2-ac81f07a4aaa">HTTP 请求访问的完整过程</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:886dade5-0ba5-46a7-a35f-d0956614a255">httpd 安装和组成</a>
<ul>
<li><a href="#h:e3cf388e-2619-4530-aed9-6aab0c5e6a46">常见http服务器程序</a></li>
<li><a href="#h:9ec74498-be2e-40e0-91d4-0f58154b2299">apache介绍和特点</a>
<ul>
<li><a href="#h:7ca77787-4297-4d10-921e-5d7b02477866">apache 介绍</a></li>
<li><a href="#h:7bdb045a-82d7-45bd-9b72-99540de64a52">MPM multi-processing module 工作模式</a></li>
</ul>
</li>
<li><a href="#h:eee02015-eabb-49b5-b7f0-70b2d587d150">Httpd 安装和相关文件</a>
<ul>
<li><a href="#h:51ef4daf-fd91-4b1b-9549-bf2046471582">rpm包安装httpd并启动httpd服务</a></li>
<li><a href="#h:4580a8b3-b34a-42d9-9852-b0532b8dd84f">httpd-2.4 相关文件</a></li>
<li><a href="#h:8173fb36-adc6-45df-9d02-b248964b65fa">httpd 配置文件的组成</a></li>
<li><a href="#h:ddf7839e-50f1-4991-8827-f0d97202e934">编译安装httpd 2.4</a>
<ul>
<li><a href="#h:52ef9f27-bbce-42ff-9203-2c03fe9dc7a3">编译说明和准备</a></li>
<li><a href="#h:43a0151f-1c59-4f2b-87fd-37be991fc3cb">编译安装httpd-2.4 方法一</a></li>
<li><a href="#h:6819331f-59de-4c1c-919e-ca38cd344b32">编译安装httpd-2.4方法二</a></li>
<li><a href="#h:7b9e18a5-b83c-4a19-a8fe-f4ea5a635f8c">编译安装后配置</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:4f517b42-f853-4eb3-a94e-f9acdf55f042">httpd 常见配置</a>
<ul>
<li><a href="#h:5c309535-59b4-40d3-ac28-0c2ffbd60356">指定服务器名</a></li>
<li><a href="#h:e4afbcca-7a7a-4bf2-938a-8adb9991d0c4">显示服务器版本信息</a></li>
<li><a href="#h:2343235c-8bc8-4444-9d46-f8fc6c59cf9f">包含其它配置文件</a></li>
<li><a href="#h:f417fbd7-d718-433c-8c03-22c6752c3ac5">监听的IP和Port</a></li>
<li><a href="#h:b6c5075f-6e58-4bef-a525-e7464a2190f3">持久连接</a></li>
<li><a href="#h:d8ab7f98-7568-4f16-99d2-183fd89fd868">DSO (Dynamic Shared Object)</a></li>
<li><a href="#h:8e78c1dc-5358-4766-b736-b6c5f186966f">MPM (Multi-Processing Module) 多路处理模块</a></li>
<li><a href="#h:b80f3760-4b5c-4f15-a160-5e3e37e5853f">prefork 模式相关的配置：</a></li>
<li><a href="#h:43d68b21-6dfc-4cf6-b754-02c62981c2f0">worker和event 模式相关的配置</a></li>
<li><a href="#h:41b90760-21bf-4888-a503-6b3dcc829160">定义Main server的文档页面路径</a></li>
<li><a href="#h:ccf9d41e-ad72-47ce-b1fb-6c20086c3605">定义站点主页面</a></li>
<li><a href="#h:475b8715-5f4c-4f78-bfcb-604b887481f1">可实现访问控制的资源</a></li>
<li><a href="#h:c67ab704-b95c-4210-a84d-9999df1e8fcb">针对目录和URL实现访问控制</a></li>
<li><a href="#h:5a5943f2-3207-4afd-9f49-121f1f58c75f">基于客户端 IP 地址实现访问控制</a></li>
<li><a href="#h:e56a80ea-ec5b-4e79-b4eb-a3201cac802e">日志设定</a>
<ul>
<li><a href="#h:5693987d-6cae-4d15-b141-9dde027f8a9f">错误日志</a></li>
<li><a href="#h:670f329d-cb07-47e0-842c-bab2523a7906">访问日志</a></li>
</ul>
</li>
<li><a href="#h:1a174979-4f1e-4a15-9e63-6e189a3eea54">设定默认字符集</a></li>
<li><a href="#h:b2645e56-b056-43a8-bc14-699588ba34d8">定义路径别名</a></li>
<li><a href="#h:4d3b379a-e398-4a41-87e9-9e2de7a4995c">基于用户的访问控制</a></li>
<li><a href="#h:ce8d6f44-77c3-4297-8406-e8c8aaa2c53e">远程客户端和用户验证的控制</a></li>
<li><a href="#h:0c0c1ed0-1cdc-4834-8393-d40b931a770d">实现用户家目录的http共享</a></li>
<li><a href="#h:3e7b515c-008d-469d-bdf3-3db082e11e8c">隐藏服务器版本信息</a></li>
<li><a href="#h:eac581b8-d4b0-4730-be26-a28711cb4aa3">禁止trace方法</a></li>
<li><a href="#h:573952f1-f000-431e-a2cb-8be4d692eb19">status 状态页</a></li>
<li><a href="#h:62ee18f5-4552-4edd-9224-b0d96fd66bd2">多虚拟主机</a></li>
<li><a href="#h:7d45a0b3-d269-413b-a6b0-9b89a23b2a1a">压缩</a></li>
<li><a href="#h:ba8057c3-c081-43ca-a24f-c8b67f4af505">实现 https</a>
<ul>
<li><a href="#h:009c8364-fd59-4ef5-9155-bea6d473692c">HTTPS 会话的简化过程</a></li>
<li><a href="#h:ce2a590c-b359-434b-9333-d762c4065da6">apache实现https过程</a></li>
<li><a href="#h:49d94901-d418-4707-a7fe-4fc417e88f7d">实现https 实战案例</a></li>
</ul>
</li>
<li><a href="#h:c5d37e07-df5b-4fcc-820d-fcec736c7377">URL重定向</a></li>
<li><a href="#h:d229e1a3-f5e1-45ae-a3f8-28d3eb41dcd2">实现HSTS</a></li>
<li><a href="#h:a2204ab3-5a88-4d1b-8c1f-92b95e9d4d79">正向代理和反向代理</a></li>
<li><a href="#h:c62a8c44-00f7-43e8-bf6a-58e287249d59">Sendfile 机制</a></li>
<li><a href="#h:4824f73c-7f84-45fa-b425-ba6a79666039">指定文件类型 content type</a></li>
</ul>
</li>
<li><a href="#h:ea2bf7b2-2d91-4da2-a050-d7029131e305">http 协议及报文头部结构</a>
<ul>
<li><a href="#h:f0b15f82-1eca-4180-bfaa-751f7a9aa3c6">HTTP请求报文</a></li>
<li><a href="#h:14083aab-6a14-44fd-928b-d2544819b943">HTTP响应报文</a></li>
<li><a href="#h:49501854-89de-4a3b-9956-0dfa7e651d09">HTTP报文格式详解</a>
<ul>
<li><a href="#h:95fe9dca-96c6-43fd-89ce-756ef824c035">Method 方法</a></li>
<li><a href="#h:07a118c5-6362-4132-ac04-f41905d7067d">version版本</a></li>
<li><a href="#h:9c383f80-c17c-46dd-a420-c10215f10fba">status 状态码</a></li>
<li><a href="#h:825cb110-6f50-47e2-92dd-9ed25b367172">reason-phrase原因短语</a></li>
<li><a href="#h:9444b040-c855-4718-9cad-eabd526ec4c1">headers首部字段头</a></li>
<li><a href="#h:e277d20a-c222-4157-b264-bd5a70544811">entity-body实体</a></li>
</ul>
</li>
<li><a href="#h:2e7cdbbe-ecc5-454a-acb1-0acc5304ebfa">Cookie 和 session</a>
<ul>
<li><a href="#h:d724a264-aba8-4a16-b92c-b4412378398f">Cookie</a></li>
<li><a href="#h:8e091a80-7aab-4a68-9495-ea6f14cf085b">Sessio</a></li>
<li><a href="#h:7269dc91-b5ae-4cac-a3d1-0237dda19781">cookie和session比较</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:3d9ef48f-b3eb-473f-ba03-8de98f9bee30">Web相关工具</a>
<ul>
<li><a href="#h:341f0e3a-fad9-4412-bc71-d23df52c8e68">links</a></li>
<li><a href="#h:5deecaf7-2241-4622-b3bd-87fee36c5e14">wget</a></li>
<li><a href="#h:fd2183ba-2087-4189-a99d-d96a7c49b478">curl</a></li>
<li><a href="#h:a0b8aa96-25f8-4c8c-b9a4-72ffe707d539">httpie</a></li>
<li><a href="#h:7c34faa2-d072-4de8-b4b5-6e3924a983c4">压力测试工具</a></li>
<li><a href="#h:8df40b1a-191f-42bd-9c32-9c67718f505d">httpd自带的工具程序</a></li>
</ul>
</li>
<li><a href="#h:4ee11918-bdbb-439d-a154-883b9e850bbb">实现LAMP架构</a>
<ul>
<li><a href="#h:a5e2870a-040d-43df-8f80-0cc966922235">LAMP介绍</a>
<ul>
<li><a href="#h:c19e32e6-37f7-4d78-b196-c32e7325487e">动态资源与语言</a></li>
<li><a href="#h:7352551d-16b9-47b4-9e05-91958f5314c4">LAMP架构组成</a></li>
<li><a href="#h:76ec4b9b-e2ca-4a9a-b60a-53f4f088d64a">CGI和fastcgi</a>
<ul>
<li><a href="#h:410ff47d-b1f7-4d60-8532-2e08d7760c25">CGI</a></li>
<li><a href="#h:28497813-34a5-461d-a5d0-6ffe718c8172">fastcgi</a></li>
<li><a href="#h:c404b450-1fc6-41fa-8247-975c22bf615a">CGI和fastcgi 比较</a></li>
</ul>
</li>
<li><a href="#h:e41e207f-1a46-427a-9e50-945081df3fe6">PHP</a>
<ul>
<li><a href="#h:ed40c273-7197-4b1a-b7b0-4bed78169711">PHP 简介</a></li>
<li><a href="#h:c3e67a4b-2c50-42d7-9329-2d4af0f8f923">PHP的Opcode语言</a></li>
<li><a href="#h:91bd6e82-b90b-45e8-b117-702f8a1af204">php配置</a></li>
<li><a href="#h:e9212390-9904-4f48-bc53-35e69126eb7d">PHP语言格式</a></li>
<li><a href="#h:6483684e-ec76-4bed-a8c1-4267542568b3">php测试代码</a></li>
</ul>
</li>
<li><a href="#h:5c88b6b5-0334-40d7-8007-cd216d7becaf">LAMP实现方式</a></li>
</ul>
</li>
<li><a href="#h:9b75b62f-c19b-4bf1-8ea6-dc35dc1dc5d8">实现LAMP</a>
<ul>
<li><a href="#h:e78fd958-7511-4ea6-b286-44b527b89123">利用rpm包实现LAMP安装部署</a></li>
<li><a href="#h:dc15ef58-b2a9-41a4-b8fc-8ab5eb3449d8">PHP连接MySQL的方式</a>
<ul>
<li><a href="#h:3e5b7154-9d30-4138-8985-f17492d2e580">使用mysql扩展连接数据库</a></li>
<li><a href="#h:d98d2b46-1a8e-48fe-b5f1-899869ca5ba9">使用mysqli扩展连接数据库</a></li>
</ul>
</li>
<li><a href="#h:d3f02d72-a14e-43d4-993d-d1ae487c7423">实现LAMP实战案例</a></li>
</ul>
</li>
<li><a href="#h:bf05667f-e646-44bb-b895-6b1ebd62e1fd">常见LAMP应用实现</a>
<ul>
<li><a href="#h:75a0b6d2-4ad8-4f62-b274-783bd43e4e70">常见LAMP应用介绍</a></li>
<li><a href="#h:d0225b7f-a1de-4526-b4e2-e29b8a3e2f78">实现 phpMyadmin应用部署</a></li>
<li><a href="#h:c215a697-743c-46ed-9cbd-405e7d805cfe">实现 wordpress 应用部署</a></li>
<li><a href="#h:b3a9cf37-9655-48b4-be42-896e81dfc171">实现 Discuz！应用部署</a></li>
<li><a href="#h:00b3c0cd-8a4d-434e-b80f-b89fa0730074">实现 PowerDNS 应用部署</a></li>
</ul>
</li>
<li><a href="#h:2a241b5d-82a8-4342-b042-4a91b826f550">php的加速器</a>
<ul>
<li><a href="#h:c332d5ef-3e9c-48a0-ab28-2b1186b1d24d">常见的第三方php加速器</a></li>
<li><a href="#h:9f62b0ef-1d2e-49c6-9fdf-80e64b18d390">实现 xcache 加速 php 5.X</a></li>
<li><a href="#h:fa1c838d-004f-4283-9f92-b5c1827d5133">opcache加速php 7.X</a></li>
</ul>
</li>
<li><a href="#h:7834f166-b7f7-4102-803a-7517d8966590">php-fpm 模式实现LAMP</a>
<ul>
<li><a href="#h:7eb329ec-ce46-4e9c-87bb-990c149d2bc9">实现php-fpm(PHP FastCGI Process Manager)模式</a></li>
<li><a href="#h:22a23065-db26-4403-b931-5d3c90cf7111">安装php-fpm</a></li>
<li><a href="#h:6dd3304c-62ac-424b-8dbf-aed79f065105">配置php-fpm</a></li>
<li><a href="#h:f127df1e-1147-4b8e-a286-a34f37e37cd1">配置httpd 支持 fastcgi</a>
<ul>
<li><a href="#h:805a6eea-02ad-44da-94a0-2344f7e8901e">实战案例：虚拟主机配置支持FCGI</a></li>
<li><a href="#h:3c1428fb-e09e-462a-96ce-9be79fa55017">实战案例：CentOS 7 利用yum安装基于PHP-FPM模式的LAMP</a></li>
<li><a href="#h:6ba34eee-8501-4728-b1f9-b60d9f4fa05d">实战案例：CentOS 7 利用清华yum源实现PHP-FPM的UDS模式</a></li>
<li><a href="#h:c1585b3a-7dc9-4a5a-a301-7430a08332e4">实战案例：CentOS 8上实现PHP-FPM状态页</a></li>
</ul>
</li>
<li><a href="#h:10d40a5b-ea87-4631-94d7-b6acef66453a">综合实战案例</a>
<ul>
<li><a href="#h:772461c8-d0ea-45a6-8195-63c9d521ea9a">目标</a></li>
<li><a href="#h:ea9d46ce-0af7-4f35-8aa9-b74d149781d3">环境准备</a></li>
<li><a href="#h:cb7d7853-ac17-4831-84dc-d9324bb8fcf6">步骤</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:928e2599-91d5-4417-838b-b62c49ae5823">编译安装php</a>
<ul>
<li><a href="#h:52589d4f-503f-4990-abcf-0f58b0ef0eda">编译安装 httpd 模块方式的php5.6</a></li>
<li><a href="#h:93553f7b-ce0a-4797-a21f-3f11db5dfaf5">编译安装 httpd 模块方式的 php 7.3</a></li>
<li><a href="#h:7bcb9e69-fead-4da4-ad4e-bda4cc9a3c70">编译安装 fastcgi 方式的php 7.4</a></li>
<li><a href="#h:5f9a9442-a6f6-4daf-bc2a-2c85c176b63a">编译安装 fastcgi 方式的php 7.3</a></li>
</ul>
</li>
<li><a href="#h:3e04e6db-1e44-4938-a89f-8fccccecdbb3">实战案例</a>
<ul>
<li><a href="#h:3010e178-b9b9-4f5c-8f72-1acc0a89403d">实战案例1: 编译安装基于HTTPD模块的LAMP架构应用</a>
<ul>
<li><a href="#h:9d577a06-bb95-45b6-b724-1c9131b0e310">目标</a></li>
<li><a href="#h:3d09fc97-afd6-44f9-a1aa-3ddc5c25921c">环境准备</a></li>
<li><a href="#h:19d714a4-9caa-4eb5-942f-9957e2d9092d">实现步骤</a></li>
</ul>
</li>
<li><a href="#h:eab82c1a-d11b-4a31-b40b-6290639140b6">实战案例2: 编译安装基于 FASTCGI 模式LAMP架构应用（重点）</a>
<ul>
<li><a href="#h:e1ec9b59-b9df-4ce6-8707-54ba518a550c">目标</a></li>
<li><a href="#h:c3a81fb9-b324-4fbe-b947-95a7b07baacc">环境准备</a></li>
<li><a href="#h:6a2ff891-1c16-4f84-8b47-4461ed771a75">实现步骤</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../index.html">Linux</a></li>
</ul>
<section id="outline-container-h:f3d0ae14-db0f-45c1-81bb-f24579f47e1b" class="outline-2">
<h2 id="h:f3d0ae14-db0f-45c1-81bb-f24579f47e1b">Internet和HTTP协议</h2>
<div class="outline-text-2" id="text-h:f3d0ae14-db0f-45c1-81bb-f24579f47e1b">
</div>
<div id="outline-container-h:24b8ff8b-b50a-4394-aa71-bf89e2ffac05" class="outline-3">
<h3 id="h:24b8ff8b-b50a-4394-aa71-bf89e2ffac05">Internet 因特网</h3>
<div class="outline-text-3" id="text-h:24b8ff8b-b50a-4394-aa71-bf89e2ffac05">
<p>
因特网是“Internet”的中文译名，它起源于美国的五角大楼，它的前身是美国
国防部高级研究计划局（ARPA）主持研制的ARPAnet。20世纪50年代末，正处于
冷战时期。当时美国军方为了自己的计算机网络在受到袭击时,即使部分网络被
摧毁，其余部分仍能保持通信联系，便由美国国防部的高级研究计划局（ARPA）
建设了一个军用网，叫做“阿帕网”（ARPAnet）。阿帕网于1969年正式启用，
当时仅连接了4台计算机，供科学家们进行计算机联网实验用，这就是因特网的
前身。到70年代，ARPAnet已经有了好几十个计算机网络，但是每个网络只能在
网络内部的计算机之间互联通信，不同计算机网络之间仍然不能互通。为此，
ARPA又设立了新的研究项目，支持学术界和工业界进行有关的研究，研究的主要
内容就是想用一种新的方法将不同的计算机局域网互联，形成“互联网”。研究
人员称之为“internetwork”，简称“Internet”
</p>

<p>
ARPA DNS反向解析
</p>

<p>
在研究实现互联的过程中，计算机软件起了主要的作用。1974年，出现了连接分组网络的协议，其中就包括了TCP/IP协议。TCP/IP有一个非常重要的特点，就是开放性，即TCP/IP的规范和Internet的技术都是公开的。目的就是使任何厂家生产的计算机都能相互通信，使Internet成为一个开放的系统，这正是后来Internet得到飞速发展的重要原因。ARPA在1982年接受了TCP/IP，选定Internet为主要的计算机通信系统，并把其它的军用计算机网络都转换到TCP/IP。1983年，ARPAnet分成两部分：一部分军用，称为MILNET；另一部分仍称ARPAnet，供民用。
</p>

<p>
1986年，美国国家科学基金组织（NSF）将分布在美国各地的5个为科研教育服务的超级计算机中心互联，并支持地区网络，形成SNSFnet。1988
年，SNSFnet替代ARPAnet成为Internet的主干网。NSFnet主干网利用了在ARPAnet中已证明是非常成功的TCP/IP技术，准许各大学、政府或私人科研机构的网络加入。1989年，ARPAnet解散，Internet从军用转向民用。
</p>

<p>
Internet的发展引起了商家的极大兴趣。1992年，美国IBM、MCI、MERIT三家公司联合组建了一个高级网络服务公司（SNS），建立了一个新的网络，叫做SNSnet，成为Internet的另一个主干网。它与SNSFnet不同，NSFnet是由国家出资建立的，而SNSnet则是SNS公司所有，从而使Internet开始走向商业化。
</p>

<p>
1995年4月30日，SNSFnet正式宣布停止运作。而此时Internet的骨干网已经覆盖了全球91个国家，主机已超过400万台。而在当前，因特网仍以惊人的速度向前发展
</p>

<p>
在90年代，超文本标识语言（HTML），即一个可以获得因特网的图像信息的超文本因特网协议被采用，使每一个人可以产生自己的图像页面（网址），然后成为一个巨大的虚拟超文本网络的组成部分。这个增强型的因特网又被非正式地称为万维网，与此同时产生了数量庞大的新用户群。于是，许多人用“因特网”
一词指这个网络的物理结构，包括连接所有事物的客户机、服务器和网络；而用“万维网”一词指利用这个网络可以访问的所有网站和信息。
</p>
</div>
</div>
<div id="outline-container-h:7a6a52db-7d93-43e6-9bda-6c3bea2669ae" class="outline-3">
<h3 id="h:7a6a52db-7d93-43e6-9bda-6c3bea2669ae">Internet 和中国</h3>
<div class="outline-text-3" id="text-h:7a6a52db-7d93-43e6-9bda-6c3bea2669ae">
<p>
北京时间1987年9月14日，钱天白建立起一个网络节点，通过电话拨号连接到国
际互联网，向他的德国朋友发出来自中国的第一封电子邮件：Across the Great
Wall we can reach every corner in the world，自此，中国与国际计算机网
络开始连接在一起
</p>

<p>
1990年10月，
钱天白教授代表中国正式在国际互联网络信息中心的前身DDN-NIC注册登记了我国的顶级域名CN，并且从此开通了使用中国顶级域名CN的国际电子邮件服务。由于当时中国尚未正式连入Internet，所以委托德国卡尔斯鲁厄大学运行CN域名服务器
</p>

<p>
1993年3月2日，
中国科学院高能物理研究所租用AT&amp;T公司的国际卫星信道接入美国斯坦福线性加速器中心（SLAC）的64K专线正式开通,专线开通后，美国政府以Internet上有许多科技信息和其它各种资源，不能让社会主义国家接入为由，只允许这条专线进入美国能源网而不能连接到其它地方。尽管如此，这条专线仍是我国部分连入Internet的第一根专线
</p>

<p>
1994年4月20日，中国通过一条64k的国际专线全功能接入国际互联网，成为国际互联网大家庭中的第77个成员，正式开启了互联网时代。随后，中科院高能物理研究所推出第一个WWW网站和第一套网页
</p>

<p>
1994年5月21日，
在钱天白教授和德国卡尔斯鲁厄大学的协助下，中国科学院计算机网络信息中心完成了中国国家顶级域名(CN)服务器的设置，改变了中国CN顶级域名服务器一直放在国外的历史
</p>

<p>
1995年5月17日，
第27个世界电信日，邮电部正式宣布，向国内社会开放计算机互联网接入服务
</p>

<p>
1995年5月，北京的中关村南大街上出现了一块巨大的广告牌，"中国离信息高速公路还有多远？向北1500米。"那个位置就是一家叫“瀛海威”的网络科教馆，瀛海威正是information
highway的音译，作为中国第一个互联网接入服务商，瀛海威几乎就是当时互联网的代名词
</p>

<p>
1996年1月，中国互联网全国骨干网建成并正式开通，开始提供服务<br>
1995年4月，马云凑了两万块钱，成立杭州海博网络公司，专门给企业做主页<br>
1997年5月，丁磊创立网易<br>
1998年2月， 张朝阳创立搜狐<br>
1998年6月18日，刘强东在中关村创办京东公司，代理销售光磁产品<br>
1998年11月，马化腾和张志东成立深圳市腾讯计算机系统有限公司，OICQ开通<br>
1998年12月， 新浪网成立，关键人物：王志东<br>
1999年5月18日，中国第一家电子商务企业8848.com成立，创始人王峻涛也曾被誉为“中国电子商务教父”。2000年底，调查显示接近70%的人说上网买东西首选
8848<br>
2000年1月，李彦宏创建了百度<br>
2003年5月，阿里巴巴集团在创立淘宝网<br>
2003年10月， 淘宝网首次推出支付宝服务<br>
2004年1月，京东多媒体网正式开通，启用域名&lt;www.jdlaser.com&gt;<br>
2010年4月，雷军创办小米<br>
2011年1月21日，腾讯公司推出微信 (WeChat)<br>
2012年3月，今日头条由张一鸣于创建<br>
2012年7月10日，北京小桔科技有限公司成立，滴滴司机端3个月后北京上线
</p>

<p>
下一个又是谁呢？
</p>

<p>
<b>中国互联网连接世界</b>
</p>

<p>
1885年台湾建省，首任巡抚刘铭传派人与福州船政联系，使用船政电报学堂毕业生为技术人员，于1887年铺设成功台湾淡水至福州川石海底电缆，全长117海里。这是我国自行设计安装的第一条海底电缆。此电缆毁于第二次世界大战我国于1989年开始投入到全球海底光缆的投资与建设中来，并于1993年实现了首条国际海底光缆的登陆（中日之间C-J海底光缆系统）；随后在1997年，我国参与建设的全球海底光缆系统（FLAG）建成并投入运营，这也是第一条在我国登陆的洲际海底光缆中国连接世界目前共有8条光缆，四个登陆站允许入境，目前我国的登陆站设立在三个城市的四个地区，分别是山东青岛登陆站（隶属中国联通）、上海崇明登陆站（隶属中国电信）、上海南汇登陆站（隶属中国联通）和
广东汕头登陆站（隶属中国电信）
</p>


<figure id="org2e555f6">
<img src="./images/network-communication.png" alt="network-communication.png" width="100%">

</figure>
</div>
</div>
<div id="outline-container-h:f2c3ffbe-8e83-499e-81b9-357257cca1c3" class="outline-3">
<h3 id="h:f2c3ffbe-8e83-499e-81b9-357257cca1c3">跨网络的主机间通讯</h3>
<div class="outline-text-3" id="text-h:f2c3ffbe-8e83-499e-81b9-357257cca1c3">
<p>
<b>Socket套接字</b>
</p>



<figure id="orgabc3f18">
<img src="./images/socket.png" alt="socket.png" width="60%">

</figure>



<p>
套接字Socket是进程间通信IPC的一种实现，允许位于不同主机（或同一主机）上不同进程之间进行通信和数据交换，SocketAPI出现于1983年，4.2
BSD实现
</p>

<p>
在建立通信连接的每一端，进程间的传输要有两个标志：*IP地址和端口号，合称为套接字*地址
socket address<br>
客户机套接字地址定义了一个唯一的客户进程<br>
服务器套接字地址定义了一个唯一的服务器进程
</p>


<figure id="org02bedfc">
<img src="./images/img_20241105_104618.png" alt="img_20241105_104618.png" width="50%">

</figure>

<p>
<b>Socket API</b>
</p>

<p>
封装了内核中所提供的socket通信相关的系统调用
</p>

<ul class="org-ul">
<li>Socket Domain：根据其所使用的地址

<ul class="org-ul">
<li>AF_INET：Address Family，IPv4</li>
<li>AF_INET6：IPv6</li>
<li>AF_UNIX：同一主机上不同进程之间通信时使用</li>
</ul></li>

<li>Socket Type：根据使用的传输层协议

<ul class="org-ul">
<li>SOCK_STREAM：流，tcp套接字，可靠地传递、面向连接</li>
<li>SOCK_DGRAM：数据报，udp套接字，不可靠地传递、无连接</li>
<li>SOCK_RAW: 裸套接字,无须tcp或udp,APP直接通过IP包通信</li>
</ul></li>
</ul>

<p>
<b>客户/服务器程序的套接字函数</b>
</p>


<p>
*套接字相关的系统调用*：
</p>

<ul class="org-ul">
<li>socket() 创建一个套接字</li>
<li>bind() 绑定IP和端口</li>
<li>listen() 监听</li>
<li>accept() 接收请求</li>
<li>connect() 请求连接建立</li>
<li>write() 发送</li>
<li>read() 接收</li>
<li>close()关闭连接</li>
</ul>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21033;&#29992;nc&#23454;&#29616;&#26381;&#21153;&#22120;&#31471;
</span>[root@centos8 ~]#nc -l 8000
hello,I am CentOS8
hello,I am CentOS7

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21033;&#29992;nc&#23454;&#29616;&#23458;&#25143;&#31471;
</span>[root@centos7 ~]#nc 10.0.0.8 8000
hello,I am CentOS8
hello,I am CentOS7
</pre>
</div>

<p>
范例：查看socket实现过程
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#strace -ff -o nc.log nc -l 8000
[root@centos7 ~]#nc 10.0.0.8 8000
</pre>
</div>

<p>
范例：socket 相关系统调用
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#dnf -y install man-pages
[root@centos8 ~]#man 2 socket
[root@centos8 ~]#man 2 bind
[root@centos8 ~]#man 2 listen
[root@centos8 ~]#man 2 accept
[root@centos8 ~]#man 2 read
[root@centos8 ~]#man 2 write
[root@centos8 ~]#man 2 connect
[root@centos8 ~]#man 2 close
</pre>
</div>

<p>
<b>范例：Socket通信Python 3.6实现</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#38656;&#35201;&#23433;&#35013;python3
</span>[root@centos8 ~]#dnf install python3
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26381;&#21153;&#22120;&#31471;tcpserver.py
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">!/usr/bin/python3
</span>import socket
<span style="color: #a0522d;">HOST</span>=<span style="color: #8b2252;">'127.0.0.1'</span>
<span style="color: #a0522d;">PORT</span>=9527
<span style="color: #a0522d;">BUFFER</span>=4096
<span style="color: #a0522d;">sock</span>=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
                         <span style="color: #b22222;"># </span><span style="color: #b22222;">IPv4&#21327;&#35758;         tcp&#21327;&#35758;
</span><span style="color: #0000ff;">sock.bind</span>((HOST,PORT))   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32465;&#23450;&#22320;&#22336;&#20449;&#24687;
</span><span style="color: #0000ff;">sock.listen</span>(3)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#24320;&#31471;&#21475;,&#35753;&#20182;&#22788;&#20110;&#30417;&#21548;&#29366;&#24577;
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'tcpServer listen at: %s:%s\n\r'</span> %(HOST,PORT))
<span style="color: #a020f0;">while</span> True:
    client_sock,<span style="color: #a0522d;">client_addr</span>=sock.accept()
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'%s:%s connect'</span> %client_addr)
    <span style="color: #a020f0;">while</span> True:
      <span style="color: #a0522d;">recv</span>=client_sock.recv(BUFFER)
      <span style="color: #a020f0;">if</span> not recv:
        client_sock.close()
        <span style="color: #a020f0;">break</span>
      <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'[Client %s:%s said]:%s'</span> %
(client_addr[0],client_addr[1],recv.decode()))
      client_sock.send(b<span style="color: #8b2252;">'tcpServer has received your message'</span>)
<span style="color: #0000ff;">sock.close</span>()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23458;&#25143;&#31471;tcpclient.py
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23458;&#25143;&#31471;&#19981;&#38656;&#35201;&#32465;&#23450;&#22320;&#22336;&#20449;&#24687;,&#20351;&#29992;&#38543;&#26426;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">!/usr/bin/python3
</span>import socket
<span style="color: #a0522d;">HOST</span>=<span style="color: #8b2252;">'127.0.0.1'</span>
<span style="color: #a0522d;">PORT</span>=9527
<span style="color: #a0522d;">BUFFER</span>=4096
<span style="color: #a0522d;">sock</span>=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
<span style="color: #0000ff;">sock.connect</span>((HOST,PORT))   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36830;&#25509;&#26381;&#21153;&#22120;&#30340;&#22320;&#22336;&#21644;&#31471;&#21475;
</span><span style="color: #0000ff;">sock.send</span>(b<span style="color: #8b2252;">'hello, tcpServer!,I am tcp client'</span>)
<span style="color: #a0522d;">recv</span>=sock.recv(BUFFER)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'[tcpServer said]: %s'</span> % recv.decode())
<span style="color: #0000ff;">sock.close</span>()
</pre>
</div>
</div>
</div>
<div id="outline-container-h:abc1b8b1-5c73-4dce-9376-eeb6e5eaf8c0" class="outline-3">
<h3 id="h:abc1b8b1-5c73-4dce-9376-eeb6e5eaf8c0">HTTP 超文本传输协议</h3>
<div class="outline-text-3" id="text-h:abc1b8b1-5c73-4dce-9376-eeb6e5eaf8c0">
</div>
<div id="outline-container-h:1ce2cdca-fa2d-4fb8-ac6c-832cfb08e004" class="outline-4">
<h4 id="h:1ce2cdca-fa2d-4fb8-ac6c-832cfb08e004">HTTP相关概念</h4>
<div class="outline-text-4" id="text-h:1ce2cdca-fa2d-4fb8-ac6c-832cfb08e004">
<p>
互联网：是网络的网络，是所有类型网络的母集。
</p>

<p>
因特网：世界上最大的互联网网络。即因特网概念从属于互联网概念。习惯上，大家把连接在因特网上的计算机都成为主机。
</p>

<p>
万维网：WWW（world wide web）万维网并非某种特殊的计算机网络，是一个大规模的、联机式的信息贮藏所， <b>使用链接的方法能非常方便地从因特网上的一个站点访问另一个站点</b> （超链技术），具有提供分布式服务的特点。万维网是一个分布式的超媒体系统，是超文本系统的扩充，基于B/S架构实现
</p>


<p>
<b>URL</b> ：万维网使用*统一资源定位符*（Uniform Resource Locator）来标志万维网上的各种文档，并使每个文档在整个因特网的范围内具有唯一的标识符URL。
</p>

<p>
HTTP：为解决“用什么样的网络协议来实现整个因特网上的万维网文档”这一难题，就要使万维网客户程序（以浏览器为主，但不限于浏览器）与万维网服务器程序之间的交互遵守严格的协议，即超文本传送协议（HyperText Transfer Protocol）。HTTP是处于应用层的协议，使用TCP传输层协议进行可靠的传送。因此，需要特别提醒的是，万维网是基于因特网的一种广泛因特网应用系统，且万维网采用的是HTTP（80/TCP）和 HTTPS（443/TCP）的传输协议，但因特网还有其他的网络应用系统（如：FTP、SMTP等等）。
</p>

<p>
HTML：为了解决“怎样使不同作者创作的不同风格的万维网文档，都能在因特网上的各种主机上显示出来，同时使用户清楚地知道在什么地方存在着链接”这一问题，万维网使用超文本标记语言（HyperText Markup Language），使得万维网页面的设计者可以很方便地用链接从页面的某处链接到因特网的任何一个万维网页面，并且能够在自己的主机品目上将这些页面显示出来。HTML与txt一样，仅仅是是一种文档，不同之处在于，这种文档专供于浏览器上为浏览器用户提供统一的界面呈现的统一规约。且具备结构化的特征，这是txt所不具备的强制规定。
</p>
</div>
</div>
<div id="outline-container-h:3009b3c2-3b39-43b6-8fc0-059ddcd8d644" class="outline-4">
<h4 id="h:3009b3c2-3b39-43b6-8fc0-059ddcd8d644">浏览器访问网站的过程</h4>
<div class="outline-text-4" id="text-h:3009b3c2-3b39-43b6-8fc0-059ddcd8d644">

<figure id="orgbedde3f">
<img src="./images/img_20241105_105155.png" alt="img_20241105_105155.png" width="50%">

</figure>
</div>
</div>
<div id="outline-container-h:1e22b3b9-c5a4-4e73-9ece-7c73b8e30069" class="outline-4">
<h4 id="h:1e22b3b9-c5a4-4e73-9ece-7c73b8e30069">HTTP协议通信过程</h4>
<div class="outline-text-4" id="text-h:1e22b3b9-c5a4-4e73-9ece-7c73b8e30069">
<p>
HTTP（HyperText Transfer Protocol，超文本传输协议）是一种用于分布式、协作式和超媒体信息系统的应用层协议。HTTP是万维网的数据通信的基础设计HTTP最初的目的是为了提供一种远距离共享知识的方式，借助多文档进行关联实现超文本，连成相互参阅的WWW（world wide web,万维网）
</p>

<p>
HTTP的发展是由蒂姆·伯纳斯-李（Tim Berners-Lee）于1989年在欧洲核子研究组织（CERN）所发起。HTTP的标准制定由万维网协会（World Wide Web Consortium，W3C）和互联网工程任务组（Internet Engineering Task Force，IETF）进行协调，最终发布了一系列的RFC，其中最著名的是1999年6月公布的 RFC 2616，定义了HTTP协议中现今广泛使用的一个版本-&#x2013;&#x2014;HTTP 1.1版
</p>

<p>
<b>HTTP服务通信过程</b>
</p>


<figure id="org95feddb">
<img src="./images/img_20241105_105306.png" alt="img_20241105_105306.png" width="50%">

</figure>


<p>
<b>HTTP协议分层</b>
</p>



<figure id="org23b9693">
<img src="./images/img_20241105_105522.png" alt="img_20241105_105522.png" width="50%">

</figure>
</div>
</div>
<div id="outline-container-h:193bb043-ab96-496c-8408-db365ae38e77" class="outline-4">
<h4 id="h:193bb043-ab96-496c-8408-db365ae38e77">HTTP相关技术</h4>
<div class="outline-text-4" id="text-h:193bb043-ab96-496c-8408-db365ae38e77">
</div>
<div id="outline-container-h:e1f33359-e873-45d0-a945-c51021c0a511" class="outline-5">
<h5 id="h:e1f33359-e873-45d0-a945-c51021c0a511">WEB开发语言</h5>
<div class="outline-text-5" id="text-h:e1f33359-e873-45d0-a945-c51021c0a511">
<p>
*http*：Hyper Text Transfer Protocol 应用层协议，默认端口： 80/tcp
</p>

<p>
<b>WEB前端开发语言</b> ：
</p>

<ul class="org-ul">
<li>html</li>
<li>css</li>
<li>javascript</li>
</ul>

<p>
<b>html</b>
</p>

<p>
Hyper Text Markup Language
超文本标记语言，编程语言，主要负责实现页面的结构
</p>

<p>
范例：html 语言
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #0000ff;">html</span>&gt;
&lt;<span style="color: #0000ff;">head</span>&gt;
&lt;<span style="color: #0000ff;">meta</span> http-equiv=Content-Type <span style="color: #a0522d;">content</span>=<span style="color: #8b2252;">"text/html;charset=utf-8"</span>&gt;
&lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">HTML&#35821;&#35328;</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;
&lt;<span style="color: #0000ff;">body</span>&gt;
&lt;<span style="color: #0000ff;">img</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"http://www.ciciedu.com/wp-content/uploads/2017/09/logo.png"</span> &gt;
&lt;<span style="color: #0000ff;">h1</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">"color:red"</span>&gt;<span style="font-weight: bold; text-decoration: underline;">&#27426;&#36814;</span>&lt;/<span style="color: #0000ff;">h1</span>&gt;
&lt;<span style="color: #0000ff;">p</span>&gt;&lt;<span style="color: #0000ff;">a</span> href=http://www.ciciedu.com&gt;&#39532;&#21733;&#25945;&#32946;&lt;/<span style="color: #0000ff;">a</span>&gt;&#27426;&#36814;&#20320;&lt;/<span style="color: #0000ff;">p</span>&gt;
&lt;/<span style="color: #0000ff;">body</span>&gt;
&lt;/<span style="color: #0000ff;">html</span>&gt;
</pre>
</div>

<p>
<b>CSS</b>
</p>

<p>
Cascading Style Sheet 层叠样式表， 定义了如何显示（装扮） HTML元素，比如：字体大小和颜色属性等。样式通常保存在外部的 .css文件中。通过仅编辑一个简单的 CSS文档，可以同时改变站点中所有页面的布局和外观。
</p>

<p>
范例 ：CSS
</p>

<div class="org-src-container">
<pre class="src src-css">#test.html
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=Content-Type content=<span style="color: #8b2252;">"text/html;charset=utf-8"</span>&gt;
&lt;link rel=<span style="color: #8b2252;">"stylesheet"</span> type=<span style="color: #8b2252;">"text/css"</span> href=<span style="color: #8b2252;">"mystyle.css"</span> /&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;&#36825;&#26159; heading 1&lt;/h1&gt;
&lt;p&gt;&#36825;&#26159;&#19968;&#27573;&#26222;&#36890;&#30340;&#27573;&#33853;&#12290;&#35831;&#27880;&#24847;&#65292;&#35813;&#27573;&#33853;&#30340;&#25991;&#26412;&#26159;&#32418;&#33394;&#30340;&#12290;&#22312; body &#36873;&#25321;&#22120;&#20013;&#23450;&#20041;&#20102;&#26412;&#39029;&#38754;&#20013;&#30340;&#40664;&#35748;&#25991;&#26412;&#39068;&#33394;&#12290;&lt;/p&gt;
&lt;p class=<span style="color: #8b2252;">"ex"</span>&gt;&#35813;&#27573;&#33853;&#23450;&#20041;&#20102; class=<span style="color: #8b2252;">"ex"</span>&#12290;&#35813;&#27573;&#33853;&#20013;&#30340;&#25991;&#26412;&#26159;&#34013;&#33394;&#30340;&#12290;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;

<span style="color: #0000ff;">#mystyle.css
body</span> {<span style="color: #a020f0;">color</span>:<span style="color: #ffffff; background-color: #ff0000;">red</span>}
<span style="color: #0000ff;">h1</span> {<span style="color: #a020f0;">color</span>:<span style="color: #000000; background-color: #00ff00;">#00ff00</span>}
<span style="color: #0000ff;">p.ex</span> {<span style="color: #a020f0;">color</span>:<span style="color: #ffffff; background-color: #0000ff;">rgb(0,0,255)</span>}
</pre>
</div>

<p>
<b>Js</b>
</p>

<p>
javascript，实现网页的动画效果，但实属于静态资源
</p>

<p>
范例：javascript
</p>

<div class="org-src-container">
<pre class="src src-javascript">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=Content-Type content=<span style="color: #8b2252;">"text/html;charset=utf-8"</span>&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h2&gt;&#25105;&#30340;&#31532;&#19968;&#27573; JavaScript&lt;/h2&gt;

&lt;button type=<span style="color: #8b2252;">"button"</span>
onclick=<span style="color: #8b2252;">"document.getElementById('demo').innerHTML = Date()"</span>&gt;
&#28857;&#20987;&#36825;&#37324;&#26469;&#26174;&#31034;&#26085;&#26399;&#21644;&#26102;&#38388;
&lt;/button&gt;

&lt;p id=<span style="color: #8b2252;">"demo"</span>&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a0da3dce-ec3e-476a-872b-5b6362b10dd4" class="outline-5">
<h5 id="h:a0da3dce-ec3e-476a-872b-5b6362b10dd4">MIME</h5>
<div class="outline-text-5" id="text-h:a0da3dce-ec3e-476a-872b-5b6362b10dd4">
<p>
MIME : Multipurpose Internet Mail Extensions 多用途互联网邮件扩展
</p>

<p>
文件 /etc/mime.types ,来自于mailcap包
</p>

<p>
MIME格式：major/minor
</p>

<p>
参考链接：
</p>
<ul class="org-ul">
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/MIME_types">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/MIME_types</a></li>
<li><a href="https://www.w3school.com.cn/media/media_mimeref.asp">https://www.w3school.com.cn/media/media_mimeref.asp</a></li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">text/plain
text/html
text/css
image/jpeg
image/png
video/mp4
application/javascript
</pre>
</div>
</div>
</div>
<div id="outline-container-h:3c105a70-4ab7-436d-94d8-e8068c6f48ec" class="outline-5">
<h5 id="h:3c105a70-4ab7-436d-94d8-e8068c6f48ec">URI和URL</h5>
<div class="outline-text-5" id="text-h:3c105a70-4ab7-436d-94d8-e8068c6f48ec">
<p>
URI： Uniform Resource Identifier 统一资源标识，分为URL 和 URN
</p>

<ul class="org-ul">
<li><p>
URN：Uniform Resource Naming，统一资源命名
</p>

<p>
示例 : P2P下载使用的磁力链接是URN的一种实现
magnet:?xt=urn:btih:660557A6890EF888666
</p></li>

<li><p>
URL：Uniform Resorce Locator，统一资源定位符，用于描述某服务器某特定资源位置
</p>

<p>
两者区别：URN如同一个人的名称，而URL代表一个人的住址。换言之，URN定义某事物的身份，而URL提供查找该事物的方法。URN仅用于命名，而不指定地址
</p></li>
</ul>

<p>
URL组成
</p>


<figure id="org806b714">
<img src="./images/20200706131817800.png" alt="20200706131817800.png" width="90%">

</figure>


<div class="org-src-container">
<pre class="src src-sh">&lt;scheme&gt;://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;path&gt;;&lt;params&gt;?&lt;query&gt;<span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;frag&gt;
</span>                  &#29992;&#25143;&#23494;&#30721;&#30465;&#30053;      &#31471;&#21475;&#27809;&#25913;&#30340;&#35805;&#20063;&#30465;&#30053;
    http://www.cicin.com/testdir/test.html
    https://list.jd.com/list.html?<span style="color: #a0522d;">cat</span>=9987,653,655  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20140;&#19996;&#25628;&#25163;&#26426;
</span>
scheme   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#26696;&#65292;&#35775;&#38382;&#26381;&#21153;&#22120;&#20197;&#33719;&#21462;&#36164;&#28304;&#26102;&#35201;&#20351;&#29992;&#21738;&#31181;&#21327;&#35758;
</span>user     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#25143;&#65292;&#26576;&#20123;&#26041;&#26696;&#35775;&#38382;&#36164;&#28304;&#26102;&#38656;&#35201;&#30340;&#29992;&#25143;&#21517;
</span>password <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23494;&#30721;&#65292;&#29992;&#25143;&#23545;&#24212;&#30340;&#23494;&#30721;&#65292;&#20013;&#38388;&#29992;&#65306;&#20998;&#38548;
</span>Host     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20027;&#26426;&#65292;&#36164;&#28304;&#23487;&#20027;&#26381;&#21153;&#22120;&#30340;&#20027;&#26426;&#21517;&#25110;IP&#22320;&#22336;
</span>port     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31471;&#21475;,&#36164;&#28304;&#23487;&#20027;&#26381;&#21153;&#22120;&#27491;&#22312;&#30417;&#21548;&#30340;&#31471;&#21475;&#21495;&#65292;&#24456;&#22810;&#26041;&#26696;&#26377;&#40664;&#35748;&#31471;&#21475;&#21495;
</span>path     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36335;&#24452;,&#26381;&#21153;&#22120;&#36164;&#28304;&#30340;&#26412;&#22320;&#21517;&#65292;&#30001;&#19968;&#20010;/&#23558;&#20854;&#19982;&#21069;&#38754;&#30340;URL&#32452;&#20214;&#20998;&#38548;
</span>params   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21442;&#25968;&#65292;&#25351;&#23450;&#36755;&#20837;&#30340;&#21442;&#25968;&#65292;&#21442;&#25968;&#20026;&#21517;/&#20540;&#23545;&#65292;&#22810;&#20010;&#21442;&#25968;&#65292;&#29992;;&#20998;&#38548;
</span>query    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#35810;&#65292;&#20256;&#36882;&#21442;&#25968;&#32473;&#31243;&#24207;&#65292;&#22914;&#25968;&#25454;&#24211;&#65292;&#29992;&#65311;&#20998;&#38548;,&#22810;&#20010;&#26597;&#35810;&#29992;&amp;&#20998;&#38548;
</span>frag     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29255;&#27573;,&#19968;&#23567;&#29255;&#25110;&#19968;&#37096;&#20998;&#36164;&#28304;&#30340;&#21517;&#23383;&#65292;&#27492;&#32452;&#20214;&#22312;&#23458;&#25143;&#31471;&#20351;&#29992;&#65292;&#29992;#&#20998;&#38548;</span>
</pre>
</div>


<p>
<b>URL示例</b>
</p>


<figure id="org5bcdc30">
<img src="./images/20200706131827811.png" alt="20200706131827811.png" width="90%">

</figure>

<div class="org-src-container">
<pre class="src src-sh">http://www.ciciedu.com:8080/images/logo.jpg
ftp://cici:password@172.16.0.1/pub/linux.ppt
rtsp://videoserver/video_demo/ <span style="color: #b22222;">#</span><span style="color: #b22222;">Real Time Streaming Protocol  &#23454;&#26102;&#27969;&#21327;&#35758;
</span>gcomm://10.0.0.8,10.0.0.18,10.0.0.28  <span style="color: #b22222;">#</span><span style="color: #b22222;">PXC
</span>http://www.ciciedu.com/bbs/hello;<span style="color: #a0522d;">gender</span>=f/send;<span style="color: #a0522d;">type</span>=title
https://list.jd.com/list.html?<span style="color: #a0522d;">cat</span>=670,671,672&amp;<span style="color: #a0522d;">ev</span>=14_2&amp;<span style="color: #a0522d;">sort</span>=sort_totalsales15_desc&amp;<span style="color: #a0522d;">trans</span>=1
http://apache.org/index.html#projects-list
</pre>
</div>
</div>
</div>
<div id="outline-container-h:08c7a8e6-754f-4876-8d45-3ff7897e8510" class="outline-5">
<h5 id="h:08c7a8e6-754f-4876-8d45-3ff7897e8510">网站访问量</h5>
<div class="outline-text-5" id="text-h:08c7a8e6-754f-4876-8d45-3ff7897e8510">
<p>
<b>网站访问量统计的重要指标</b>
</p>

<ul class="org-ul">
<li>IP(独立IP)：即Internet Protocol,指独立IP数。一天内来自相同客户机IP地
址只计算一次，记录远程客户机IP地址的计算机访问网站的次数，是衡量网站
流量的重要指标</li>
<li>PV(访问量)： 即Page View,页面浏览量或点击量，用户每次刷新即被计算一
次，PV反映的是浏览某网站的页面数，PV与来访者的数量成正比，PV并不是页
面的来访者数量，而是网站被访问的页面数量</li>
<li>UV(独立访客)：即Unique Visitor,访问网站的一台电脑为一个访客。一天内
相同的客户端只被计算一次。可以理解成访问某网站的电脑的数量。网站判断
来访电脑的身份是通过cookies实现的。如果更换了IP后但不清除cookies，再
访问相同网站，该网站的统计中UV数是不变的</li>
</ul>

<p>
<b>网站统计</b> : <a href="http://www.alexa.cn/rank/">http://www.alexa.cn/rank/</a>
</p>

<p>
范例：网站访问统计
</p>

<div class="org-src-container">
<pre class="src src-shell">1. &#30002;&#20057;&#19993;&#19977;&#20154;&#22312;&#21516;&#19968;&#21488;&#36890;&#36807; ADSL&#19978;&#32593;&#30340;&#30005;&#33041;&#19978;&#65288;&#20013;&#38388;&#27809;&#26377;&#26029;&#32593;&#65289;&#65292;&#20998;&#21035;&#35775;&#38382;www.ciciedu.com &#32593;&#31449;&#65292;
&#24182;&#19988;&#27599;&#20154;&#20849;&#29992;&#19968;&#20010;&#27983;&#35272;&#22120;&#65292;&#21508;&#27983;&#35272;&#20102;2&#20010;&#39029;&#38754;&#65292;&#37027;&#20040;&#32593;&#31449;&#30340;&#27969;&#37327;&#32479;&#35745;&#26159;&#65306;
IP: 1   PV:6   UV&#65306;1

2. &#33509;&#19977;&#20154;&#37117;&#26159;ADSL&#37325;&#26032;&#25320;&#21495;&#21518;,&#21508;&#27983;&#35272;&#20102;2&#20010;&#39029;&#38754;&#65292;&#21017;
IP: 3   PV:6   UV&#65306;1
</pre>
</div>

<p>
<b>网站访问量</b>
</p>

<p>
QPS：request per second，每秒请求数
</p>

<p>
PV，QPS和并发连接数换算公式
</p>

<ul class="org-ul">
<li>QPS= PV * 页面衍生连接次数/ 统计时间（86400）</li>
<li>并发连接数 =QPS * http平均响应时间</li>
</ul>

<p>
峰值时间：每天80%的访问集中在20%的时间里，这20%时间为峰值时间
</p>

<p>
峰值时间每秒请求数(QPS)=( 总PV数 *页面衍生连接次数）*80% ) / ( 每天秒数 * 20% )
</p>
</div>
</div>
</div>
<div id="outline-container-h:f3d871b6-f9fa-42d9-aa7c-cdef8b0a4364" class="outline-4">
<h4 id="h:f3d871b6-f9fa-42d9-aa7c-cdef8b0a4364">HTTP工作机制</h4>
<div class="outline-text-4" id="text-h:f3d871b6-f9fa-42d9-aa7c-cdef8b0a4364">
<p>
一次http事务包括：
</p>

<ul class="org-ul">
<li>http请求：http request</li>
<li>http响应：http response</li>
</ul>

<p>
<b>Web资源</b> ：web resource，一个网页由多个资源（文件）构成，打开一个页面，
通常会有多个资源展示出来，但是每个资源都要单独请求。因此，一个“Web页
面”通常并不是单个资源，而是一组资源的集合
</p>

<p>
<b>资源类型</b> ：
</p>

<ul class="org-ul">
<li><p>
静态文件：无需服务端做出额外处理
</p>

<p>
文件后缀：.html, .txt, .jpg, .js, .css, .mp3, .avi
</p></li>

<li><p>
动态文件：服务端执行程序，返回执行的结果
</p>

<p>
文件后缀：.php, .jsp ,.asp
</p></li>
</ul>

<p>
<b>HTTP连接请求</b>
</p>


<figure id="orga230690">
<img src="./images/20200706131849257.png" alt="20200706131849257.png">

</figure>

<p>
<b>串行和并行连接</b>
</p>


<figure id="org803a0c1">
<img src="./images/20200706131856885.png" alt="20200706131856885.png">

</figure>

<p>
<b>串行,持久连接和管道</b>
</p>

<p>
其中管道化持久连接效率最高
</p>


<figure id="orgcf79c01">
<img src="./images/20200706131908483.png" alt="20200706131908483.png">

</figure>

<p>
<b>提高HTTP连接性能</b>
</p>

<ul class="org-ul">
<li>并行连接：通过多条TCP连接发起并发的HTTP请求</li>
<li>持久连接：keep-alive，重用TCP连接，以消除连接和关闭的时延,以事务个数和时间来决定是否关闭连接</li>
<li>管道化连接：通过共享TCP连接，发起并发的HTTP请求</li>
<li>复用的连接：交替传送请求和响应报文（实验阶段）</li>
</ul>
</div>
</div>
<div id="outline-container-h:0090c568-0462-41f5-b9f7-9045deab098b" class="outline-4">
<h4 id="h:0090c568-0462-41f5-b9f7-9045deab098b">HTTP 协议版本</h4>
<div class="outline-text-4" id="text-h:0090c568-0462-41f5-b9f7-9045deab098b">

<figure id="org3b0c906">
<img src="./images/20200706131918827.png" alt="20200706131918827.png">

</figure>

<p>
<b>http/0.9：</b>
</p>

<p>
1991，原型版本，功能简陋，只有一个命令GET。GET /index.html,服务器只能回应HTML格式字符串，不能回应别的格式
</p>

<p>
<b>http/1.0</b>
</p>

<p>
1996年5月,支持cache, MIME, method
</p>

<p>
每个TCP连接只能发送一个请求，发送数据完毕，连接就关闭，如果还要请求其他资源，就必须再新建一个连接
</p>

<p>
引入了POST命令和HEAD命令
</p>

<p>
头信息是 ASCII码，后面数据可为任何格式。服务器回应时会告诉客户端，数据是什么格式，即Content-Type字段的作用。这些数据类型总称为MIME
多用途互联网邮件扩展，每个值包括一级类型和二级类型，预定义的类型，也可自定义类型,
常见Content-Type值：text/xml image/jpeg audio/mp3
</p>

<p>
<b>http/1.1</b>
</p>

<p>
1997年1月，引入了*持久连接*（persistent
connection），即TCP连接默认不关闭，可以被多个请求复用，不用声明Connection:
keep-alive。对于同一个域名，大多数浏览器允许同时建立6个持久连接引入了管道机制，即在同一个TCP连接里，客户端可以同时发送多个请求，进一步改进了HTTP协议的效率
</p>

<p>
新增方法：PUT、PATCH、OPTIONS、DELETE
</p>

<p>
同一个TCP连接里，所有的数据通信是按次序进行的。服务器只能顺序处理回应，前面的回应慢，会有许多请求排队，造成”队头堵塞”（Head-of-line
blocking）
</p>

<p>
为避免上述问题，两种方法：一是减少请求数，二是*同时多开持久连接*。
</p>

<p>
网页优化技巧，如合并脚本和样式表、将图片嵌入CSS代码、域名分片（domain sharding）等
</p>

<p>
HTTP
协议不带有状态，每次请求都必须附上所有信息。请求的很多字段都是重复的，浪费带宽，影响速度
</p>

<p>
<b>HTTP1.0和HTTP1.1的区别</b>
</p>


<figure id="org452909f">
<img src="./images/20200706131934638.png" alt="20200706131934638.png">

</figure>

<p>
1.0版本 : 三次握手建立连接后只说了一句话就断开了
</p>

<p>
1.1版本 : 三次握手建立连接后可以进行多次交互
</p>

<ul class="org-ul">
<li>缓存处理，在HTTP1.0中主要使用header里的If-Modified-Since,Expires来做为缓存判断的标准，HTTP1.1则引入了更多的缓存控制策略例如Entity
tag，If-Unmodified-Since, If-Match,
If-NoneMatch等更多可供选择的缓存头来控制缓存策略</li>
<li>带宽优化及网络连接的使用，HTTP1.0中，存在一些浪费带宽的现象，例如：客户端只是需要某个对象的一部分，而服务器却将整个对象送过来了，并且不支持断点续传功能，HTTP1.1则在请求头引入了range头域，它允许只请求资源的某个部分，即返回码是206（Partial
Content），方便了开发者自由的选择以便于充分利用带宽和连接</li>
<li>错误通知的管理，在HTTP1.1中新增24个状态响应码，如409（Conflict）表示请求的资源与资源当前状态冲突；410（Gone）表示服务器上的某个资源被永久性的删除<br>
Host
头处理，在HTTP1.0中认为每台服务器都绑定一个唯一的IP地址，因此，请求消息中的URL并没有传递主机名（hostname）。但随着虚拟主机技术的发展，在一台物理服务器上可以存在多个虚拟主机（Multi-homed
Web
Servers），并且它们共享一个IP地址。HTTP1.1的请求消息和响应消息都应支持Host头域，且请求消息中如果没有Host头域会报告一个错误（400
Bad Request）</li>
<li>长连接，HTTP
1.1支持长连接（PersistentConnection）和请求的流水线（Pipelining）处理，在一个TCP连接上可以传送多个HTTP请求和响应，减少了建立和关闭连接的消耗和延迟，在HTTP1.1中默认开启Connection：
keep-alive，弥补了HTTP1.0每次请求都要创建连接的缺点</li>
</ul>

<p>
<b>HTTP1.0和1.1的问题</b>
</p>

<ul class="org-ul">
<li>HTTP1.x在传输数据时，每次都需要重新建立连接，无疑增加了大量的延迟时间，特别是在移动端更为突出</li>
<li>HTTP1.x在传输数据时，所有传输的内容都是明文，客户端和服务器端都无法验证对方的身份，无法保证数据的安全性</li>
<li>HTTP1.x在使用时，header里携带的内容过大，增加了传输的成本，并且每次请求header基本不怎么变化，尤其在移动端增加用户流量</li>
<li>虽然HTTP1.x支持了keep-alive，来弥补多次创建连接产生的延迟，但是keep-alive使用多了同样会给服务端带来大量的性能压力，并且对于单个文件被不断请求的服务(例如图片存放网站)，keep-alive可能会极大的影响性能，因为它在文件被请求之后还保持了不必要的连接很长时间</li>
</ul>

<p>
*HTTPS协议*：
</p>

<p>
为解决安全问题，网景在1994年创建了HTTPS，并应用在网景导航者浏览器中。
最初，HTTPS是与SSL一起使用的；在SSL逐渐演变到TLS时（其实两个是一个东西，只是名字不同而已），最新的HTTPS也由在2000年五月公布的RFC
2818正式确定下来。HTTPS就是安全版的HTTP，目前大型网站基本实现全站HTTPS
</p>

<p>
<b>HTTPS特点</b>
</p>

<ul class="org-ul">
<li>HTTPS协议需要到CA申请证书，一般免费证书很少，需要交费</li>
<li>HTTP协议运行在TCP之上，所有传输的内容都是明文，HTTPS运行在SSL/TLS之上
, SSL/TLS运行在TCP之上，所有传输的内容都经过加密的</li>
<li>HTTP和HTTPS使用的是不同的连接方式，端口不同，前者是80，后者是443</li>
<li>HTTPS可以有效的防止运营商劫持，解决了防劫持的一个大问题</li>
<li>HTTPS 实现过程降低用户访问速度，但经过合理优化和部署，HTTPS
对速度的影响还是可以接受的</li>
</ul>

<p>
<b>SPDY协议</b>
</p>

<p>
SPDY：2009年谷歌研发，综合HTTPS和HTTP两者有点于一体的传输协议，主要特点：
</p>

<ul class="org-ul">
<li>降低延迟，针对HTTP高延迟的问题，SPDY优雅的采取了多路复用（multiplexing）。多路复用通过多个请求stream共享一个tcp连接的方式，解决了HOL
blocking的问题，降低了延迟同时提高了带宽的利用率</li>
<li>请求优先级（request
prioritization）。多路复用带来一个新的问题是，在连接共享的基础之上有可能会导致关键请求被阻塞。SPDY允许给每个request设置优先级，重要的请求就会优先得到响应。比如浏览器加载首页，首页的html内容应该优先展示，之后才是各种静态资源文件，脚本文件等加载，可以保证用户能第一时间看到网页内容</li>
<li>header压缩。HTTP1.x的header很多时候都是重复多余的。选择合适的压缩算法可以减小包的大小和数量</li>
<li>基于HTTPS的加密协议传输，大大提高了传输数据的可靠性</li>
<li>服务端推送（server
push），采用了SPDY的网页，例如网页有一个sytle.css的请求，在客户端收到sytle.css数据的同时，服务端会将sytle.js的文件推送给客户端，当客户端再次尝试获取sytle.js
时就可以直接从缓存中获取到，不用再发请求了</li>
</ul>

<p>
<b>HTTP2协议</b>
</p>

<p>
http/2.0：2015年，HTTP2.0是SPDY的升级版
</p>

<ul class="org-ul">
<li>头信息和数据体都是二进制，称为头信息帧和数据帧</li>
<li>复用TCP连接，在一个连接里，客户端和浏览器都可以同时发送多个请求或回应，且不用按顺序一
一对应，避免了“队头堵塞“,此双向的实时通信称为多工（Multiplexing）</li>
<li>引入头信息压缩机制（header
compression）,头信息使用gzip或compress压缩后再发送；客户端和服务器同时维护一张头信息表，所有字段都会存入这个表，生成一个索引号，不发送同样字段，只发送索引号，提高速度</li>
<li>HTTP/2 允许服务器未经请求，主动向客户端发送资源，即服务器推送（server
push）</li>
</ul>

<p>
<b>HTTP2.0和SPDY区别</b> ：
</p>

<ul class="org-ul">
<li>HTTP2.0 支持明文 HTTP 传输，而 SPDY 强制使用 HTTPS</li>
<li>HTTP2.0 消息头的压缩算法采用 HPACK，而非 SPDY 采用的 DEFLATE</li>
</ul>
</div>
</div>
<div id="outline-container-h:9ccaba6b-2fce-4569-bca2-ac81f07a4aaa" class="outline-4">
<h4 id="h:9ccaba6b-2fce-4569-bca2-ac81f07a4aaa">HTTP 请求访问的完整过程</h4>
<div class="outline-text-4" id="text-h:9ccaba6b-2fce-4569-bca2-ac81f07a4aaa">

<figure id="orga0f1341">
<img src="./images/20180621215710728.png" alt="20180621215710728.png" width="50%">

</figure>

<p>
<b>一次完整的http请求处理过程</b>
</p>

<p>
1、建立连接：接收或拒绝连接请求
</p>

<p>
2、接收请求：接收客户端请求报文中对某资源的一次请求的过程
</p>

<p>
Web访问响应模型（Web I/O）
</p>


<figure id="orge1d4057">
<img src="./images/20200706132027521.png" alt="20200706132027521.png">

</figure>

<ul class="org-ul">
<li>单进程I/O模型：启动一个进程处理用户请求，而且一次只处理一个，多个请求被串行响应</li>
<li>多进程I/O模型：并行启动多个进程,每个进程响应一个连接请求
(apache采用,浪费资源)</li>
<li>复用I/O结构：启动一个进程，同时响应N个连接请求</li>
<li>复用的多进程I/O模型：启动M个进程，每个进程响应N个连接请求，同时接收M*N个请求</li>
</ul>

<p>
3、处理请求：服务器对请求报文进行解析，并获取请求的资源及请求方法等相关信息，根据方法，资源，首部和可选的主体部分对请求进行处理
</p>

<p>
常用请求Method: GET、POST、HEAD、PUT、DELETE、TRACE、OPTIONS
</p>

<p>
4、访问资源：
</p>

<p>
服务器获取请求报文中请求的资源web服务器，即存放了web资源的服务器，负责向请求者提供对方请求的静态资源，或动态运行后生成的资源
</p>

<p>
5、构建响应报文：
</p>

<p>
一旦Web服务器识别除了资源，就执行请求方法中描述的动作，并返回响应报文。响应报文中
包含有响应状态码、响应首部，如果生成了响应主体的话，还包括响应主体
</p>

<p>
1）响应实体：如果事务处理产生了响应主体，就将内容放在响应报文中回送过去。响应报文中通常包括：
</p>

<ul class="org-ul">
<li>描述了响应主体MIME类型的Content-Type首部</li>
<li>描述了响应主体长度的Content-Length</li>
<li>实际报文的主体内容</li>
</ul>

<p>
2）URL重定向：web服务构建的响应并非客户端请求的资源，而是资源另外一个访问路径
</p>

<p>
3）MIME类型：
Web服务器要负责确定响应主体的MIME类型。多种配置服务器的方法可将MIME类型与资源管理起来
</p>

<ul class="org-ul">
<li>魔法分类：Apache
web服务器可以扫描每个资源的内容，并将其与一个已知模式表(被称为魔法文件)进行匹配，以决定每个文件的MIME类型。这样做可能比较慢，但很方便，尤其是文件没有标准扩展名时</li>
<li>显式分类：可以对Web服务器进行配置，使其不考虑文件的扩展名或内容，强制特定文件或目录内容拥有某个MIME类型</li>
<li>类型协商：
有些Web服务器经过配置，可以以多种文档格式来存储资源。在这种情况下，可以配置Web服务器，使其可以通过与用户的协商来决定使用哪种格式(及相关的MIME类型)"最好"</li>
</ul>

<p>
6、发送响应报文
</p>

<p>
Web服务器通过连接发送数据时也会面临与接收数据一样的问题。服务器可能有很多条到各个客户端的连接，有些是空闲的，有些在向服务器发送数据，还有一些在向客户端回送响应数据。服务器要记录连接的状态，还要特别注意对持久连接的处理。对非持久连接而言，服务器应该在发送了整条报文之后，关闭自己这一端的连接。对持久连接来说，连接可能仍保持打开状态，在这种情况下，服务器要正确地计算Content-Length首部，不然客户端就无法知道响应什么时候结束
</p>

<p>
7、记录日志
</p>

<p>
最后，当事务结束时，Web服务器会在日志文件中添加一个条目，来描述已执行的事务
</p>
</div>
</div>
</div>
</section>
<section id="outline-container-h:886dade5-0ba5-46a7-a35f-d0956614a255" class="outline-2">
<h2 id="h:886dade5-0ba5-46a7-a35f-d0956614a255">httpd 安装和组成</h2>
<div class="outline-text-2" id="text-h:886dade5-0ba5-46a7-a35f-d0956614a255">
<p>
http 服务基于 C/S 结构
</p>
</div>
<div id="outline-container-h:e3cf388e-2619-4530-aed9-6aab0c5e6a46" class="outline-3">
<h3 id="h:e3cf388e-2619-4530-aed9-6aab0c5e6a46">常见http服务器程序</h3>
<div class="outline-text-3" id="text-h:e3cf388e-2619-4530-aed9-6aab0c5e6a46">
<ul class="org-ul">
<li>httpd apache，存在C10K（10K connections）问题</li>
<li>nginx 解决C10K问题</li>
<li>lighttpd</li>
<li>IIS .asp 应用程序服务器</li>
<li>tomcat .jsp 应用程序服务器</li>
<li>jetty 开源的servlet容器，基于Java的web容器</li>
<li>Resin CAUCHO公司，支持servlets和jsp的引擎</li>
<li>webshpere：IBM公司</li>
<li>weblogic：BEA，Oracle</li>
<li>jboss：RedHat，IBM</li>
<li>oc4j：Oracle</li>
</ul>

<p>
<b>HTTP服务器市场占有率统计</b> ： <a href="http://www.netcraft.com">http://www.netcraft.com</a>
</p>
</div>
</div>
<div id="outline-container-h:9ec74498-be2e-40e0-91d4-0f58154b2299" class="outline-3">
<h3 id="h:9ec74498-be2e-40e0-91d4-0f58154b2299">apache介绍和特点</h3>
<div class="outline-text-3" id="text-h:9ec74498-be2e-40e0-91d4-0f58154b2299">
</div>
<div id="outline-container-h:7ca77787-4297-4d10-921e-5d7b02477866" class="outline-4">
<h4 id="h:7ca77787-4297-4d10-921e-5d7b02477866">apache 介绍</h4>
<div class="outline-text-4" id="text-h:7ca77787-4297-4d10-921e-5d7b02477866">
<p>
20世纪90年代初，国家超级计算机应用中心NCSA开发,1995年开源社区发布apache
</p>

<p>
apache
名字来源，流传最广的解释是（也是最显而易见的）：这个名字来自于一个事实：当Apache在1995年初开发的时候，它是由当时最流行的HTTP服务器NCSA
HTTPd 1.3的代码修改而成的，因此是“一个修补的（apatchy）”服务器。然而，在Apache服务器官方网站的FAQ中是这么解释的："Apache
这个名字是为了纪念名为Apache的美洲原住民印第安人的一支，众所周知他们拥有高超的作战策略和无穷的耐性。"贝伦多夫说："我选择阿帕奇这个名字是取其积极含义。阿帕奇族是最后一个屈服于美国政府的民族。当时我们担心大公司迟早会参与竞争并‘教化'这块最早的网络之地，所以在我看来，阿帕奇是个很好的名称，也有人说这个词一语双关-因为正如Apache（与"a
patchy”谐音）的名字所表明的那样，他们确实是在给服务器打补丁。”
</p>

<p>
软件基金会
</p>

<ul class="org-ul">
<li>ASF：apache software foundation</li>
<li>FSF：Free Software Foundation</li>
</ul>

<p>
<b>apache特性</b> ：
</p>

<ul class="org-ul">
<li>高度模块化：core + modules</li>
<li>DSO：Dynamic Shared Object 动态加载/卸载</li>
<li>MPM：multi-processing module 多路处理模块</li>
</ul>

<p>
<b>apache 功能</b> ：
</p>

<ul class="org-ul">
<li>虚拟主机：IP、Port、FQDN</li>
<li>CGI：Common Gateway Interface，通用网关接口</li>
<li>反向代理</li>
<li>负载均衡</li>
<li>路径别名</li>
<li>丰富的用户认证机制：basic，digest</li>
<li>支持第三方模块</li>
</ul>

<p>
<b>httpd-2.4 新特性</b>
</p>

<ul class="org-ul">
<li>MPM支持运行为DSO机制；以模块形式按需加载</li>
<li>event MPM生产环境可用</li>
<li>异步读写机制</li>
<li>支持每模块及每目录的单独日志级别定义</li>
<li>每请求相关的专用配置</li>
<li>增强版的表达式分析式</li>
<li>毫秒级持久连接时长定义</li>
<li>基于FQDN的虚拟主机不需要NameVirutalHost指令</li>
<li>新指令</li>
<li>支持用户自定义变量</li>
<li>.更低的内存消耗</li>
</ul>
</div>
</div>
<div id="outline-container-h:7bdb045a-82d7-45bd-9b72-99540de64a52" class="outline-4">
<h4 id="h:7bdb045a-82d7-45bd-9b72-99540de64a52">MPM multi-processing module 工作模式</h4>
<div class="outline-text-4" id="text-h:7bdb045a-82d7-45bd-9b72-99540de64a52">
<ul class="org-ul">
<li><p>
<b>prefork</b> ：多进程I/O模型，每个进程响应一个请求，CentOS 7 默认模型
</p>

<p>
一个主进程：生成和回收n个子进程，创建套接字，不响应请求
</p>

<p>
多个子进程：工作work进程，每个子进程处理一个请求；系统初始时，预先生成多个空闲进程，等待请求
</p>

<p>
<img src="./images/20200706183535498.png" alt="20200706183535498.png">]]
</p>

<p>
Prefork MPM:
预派生模式，有一个主控制进程，然后生成多个子进程,每个子进程有一个独立的线程响应用户请求，相对比较占用内存，但是比较稳定，可以设置最大和最小进程数，是最古老的一种模式，也是最稳定的模式，适用于访问量不是很大的场景
</p>

<p>
优点：稳定
</p>

<p>
缺点：慢，占用资源，不适用于高并发场景
</p></li>

<li><p>
worker：复用的多进程I/O模型,多进程多线程，IIS使用此模型
</p>

<p>
一个主进程：生成m个子进程，每个子进程负责生个n个线程，每个线程响应一个请求，并发响应请求：m*n
</p></li>
</ul>


<figure id="orgcf4dfec">
<img src="./images/20200706183615244.png" alt="20200706183615244.png">

</figure>

<p>
worker
MPM：是一种多进程和多线程混合的模型，有一个控制进程，启动多个子进程，每个子进程里面包含固定的线程，使用线程来处理请求，当线程不够使用的时候会再启动一个新的子进程，然后在进程里面再启动线程处理请求，由于其使用了线程处理请求，因此可以承受更高的并发。
</p>

<p>
优点：相比prefork 占用的内存较少，可以同时处理更多的请求
</p>

<p>
缺点：使用keep-alive的长连接方式，某个线程会一直被占据，即使没有传输数据，也需要一直等待到超时才会被释放。如果过多的线程，被这样占据，也会导致在高并发场景下的无服务线程可用。（该问题在prefork模式下，同样会发生）
</p>

<ul class="org-ul">
<li><p>
event：事件驱动模型（worker模型的变种），CentOS8 默认模型
</p>

<p>
<img src="./images/20200706183642162.png" alt="20200706183642162.png">]]
</p>

<p>
一个主进程：生成m个子进程，每个子进程负责生个n个线程，每个线程响应一个请求，并发响应请求：m*n，有专门的监控线程来管理这些keep-alive类型的线程，当有真实请求时，将请求传递给服务线程，执行完毕后，又允许释放。这样增强了高并发场景下的请求处理能力
</p>

<p>
uevent
MPM：Apache中最新的模式，属于事件驱动模型(epoll)，每个进程响应多个请求，在现在版本里的已经是稳定可用的模式。它和worker模式很像，最大的区别在于，它解决了keep-alive场景下，长期被占用的线程的资源浪费问题（某些线程因为被keep-alive，空挂在哪里等待，中间几乎没有请求过来，甚至等到超时）。event
MPM中，会有一个专门的线程来管理这些keep-alive类型的线程，当有真实请求过来的时候，将请求传递给服务线程，执行完毕后，又允许它释放。这样增强了高并发场景下的请求处理能力
</p>

<p>
event只在有数据发送的时候才开始建立连接，连接请求才会触发工作线程，即使用了TCP的一个选项，叫做延迟接受连接TCP_DEFER_ACCEPT，加了这个选项后，若客户端只进行TCP连接，不发送请求，则不会触发Accept操作，也就不会触发工作线程去干活，进行了简单的防攻击（TCP连接）
</p>

<p>
优点：单线程响应多请求，占据更少的内存，高并发下表现更优秀，会有一个专门的线程来管理keep-alive类型的线程，当有真实请求过来的时候，将请求传递给服务线程，执行完毕后，又允许它释放
</p>

<p>
缺点：没有线程安全控制
</p>

<p>
httpd-2.4：event 稳定版，centos7 以后默认
</p>

<p>
httpd-2.2：event 测试版，centos6 默认
</p></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:eee02015-eabb-49b5-b7f0-70b2d587d150" class="outline-3">
<h3 id="h:eee02015-eabb-49b5-b7f0-70b2d587d150">Httpd 安装和相关文件</h3>
<div class="outline-text-3" id="text-h:eee02015-eabb-49b5-b7f0-70b2d587d150">
</div>
<div id="outline-container-h:51ef4daf-fd91-4b1b-9549-bf2046471582" class="outline-4">
<h4 id="h:51ef4daf-fd91-4b1b-9549-bf2046471582">rpm包安装httpd并启动httpd服务</h4>
<div class="outline-text-4" id="text-h:51ef4daf-fd91-4b1b-9549-bf2046471582">
<p>
版本说明：CentOS 7 以上，默认系统是httpd 2.4，CentOS 6 版默认为httpd 2.2
</p>

<p>
<b>安装方式</b> ：
</p>

<ul class="org-ul">
<li>rpm：centos发行版，稳定，建议使用</li>
<li>编译：定制或特殊需求</li>
</ul>

<p>
<b>范例：安装httpd 2.4</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#yum install -y httpd
Last metadata expiration check: 0:21:54 ago on Tue 23 Jun 2020 09:25:23 AM CST.
Dependencies resolved.
===========================================================================================================
 Package                  Architecture Version                                       Repository       Size
===========================================================================================================
Installing:
 httpd                    x86_64       2.4.37-16.module_el8.1.0+256+ae790463         AppStream       1.7 M
Installing dependencies:
 mailcap                  noarch       2.1.48-3.el8                                  base             39 k
 apr                      x86_64       1.6.3-9.el8                                   AppStream       125 k
 apr-util                 x86_64       1.6.1-6.el8                                   AppStream       105 k
 centos-logos-httpd       noarch       80.5-2.el8                                    AppStream        24 k
...&#30465;&#30053;...
Install  10 Packages

Total download size: 2.3 M
Installed size: 6.6 M
Downloading Packages: 
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
Preparing :
1/1
Installing : apr-1.6.3-9.el8.x86_64
1/9
Running scriptlet: apr-1.6.3-9.el8.x86_64
1/9
...&#30465;&#30053;...
Complete!

[root@centos8 ~]#systemctl start httpd
[root@centos8 ~]#ss -ntl |grep :80
State        Recv-Q        Send-Q                Local Address:Port               Peer Address:Port   
LISTEN       0             128                         0.0.0.0:80                      0.0.0.0:*               
[root@centos8 ~]#lsof -i :80
COMMAND  PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
httpd   4666   root    3u  IPv4  42696      0t0  TCP *:http (LISTEN)
httpd   4669 apache    3u  IPv4  42696      0t0  TCP *:http (LISTEN)
httpd   4670 apache    3u  IPv4  42696      0t0  TCP *:http (LISTEN)
httpd   4671 apache    3u  IPv4  42696      0t0  TCP *:http (LISTEN)
httpd   4884 apache    3u  IPv4  42696      0t0  TCP *:http (LISTEN)

[root@centos8 ~]#rpm -qf /var/www/html/
httpd-filesystem-2.4.37-16.module_el8.1.0+256+ae790463.noarch
</pre>
</div>
</div>
</div>
<div id="outline-container-h:4580a8b3-b34a-42d9-9852-b0532b8dd84f" class="outline-4">
<h4 id="h:4580a8b3-b34a-42d9-9852-b0532b8dd84f">httpd-2.4 相关文件</h4>
<div class="outline-text-4" id="text-h:4580a8b3-b34a-42d9-9852-b0532b8dd84f">
<p>
配置文件：
</p>

<ul class="org-ul">
<li>/etc/httpd/conf/httpd.conf 主配置文件</li>
<li>/etc/httpd/conf.d/*.conf 子配置文件</li>
<li><i>etc/httpd/conf.d/conf.modules.d</i> 模块加载的配置文件</li>
</ul>

<p>
检查配置语法：httpd &#x2013;t
</p>

<p>
服务单元文件：
</p>

<ul class="org-ul">
<li>/usr/lib/systemd/system/httpd.service</li>
<li>配置文件：/etc/sysconfig/httpd</li>
</ul>

<p>
服务控制和启动
</p>

<ul class="org-ul">
<li>systemctl enable|disable httpd.service</li>
<li>systemctl {start|stop|restart|status|reload} httpd.service</li>
<li>apachectl start|stop|restart|configtest</li>
</ul>

<p>
站点网页文档根目录：/var/www/html
</p>

<p>
模块文件路径：
</p>

<ul class="org-ul">
<li>/etc/httpd/modules</li>
<li>/usr/lib64/httpd/modules</li>
</ul>

<p>
主服务器程序文件： /usr/sbin/httpd
</p>

<p>
主进程文件： /etc/httpd/run/httpd.pid
</p>

<p>
日志文件目录：/var/log/httpd
</p>

<ul class="org-ul">
<li>access_log: 访问日志</li>
<li>error_log：错误日志</li>
</ul>

<p>
帮助文档包：httpd-manual
</p>

<div class="org-src-container">
<pre class="src src-sh">http://10.0.0.8/manual/
</pre>
</div>
</div>
</div>
<div id="outline-container-h:8173fb36-adc6-45df-9d02-b248964b65fa" class="outline-4">
<h4 id="h:8173fb36-adc6-45df-9d02-b248964b65fa">httpd 配置文件的组成</h4>
<div class="outline-text-4" id="text-h:8173fb36-adc6-45df-9d02-b248964b65fa">
<p>
主要组成
</p>

<ul class="org-ul">
<li>Global Environment</li>
<li>Main server configuration</li>
<li>virtual host</li>
</ul>

<p>
配置文件格式：
</p>

<div class="org-src-container">
<pre class="src src-sh">directive value
</pre>
</div>

<p>
格式说明：
</p>

<ul class="org-ul">
<li>directive 不区分字符大小写</li>
<li>value 为路径时，是否区分大小写，取决于文件系统</li>
</ul>

<p>
配置文件语法检查：
</p>

<div class="org-src-container">
<pre class="src src-sh">apachectl configtest
httpd -t
</pre>
</div>

<p>
配置官方帮助： <a href="http://httpd.apache.org/docs/2.4/">http://httpd.apache.org/docs/2.4/</a>
</p>

<p>
范例：CentOS 8.0 默认配置文件
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cp /etc/httpd/conf/httpd.conf{,.bak}  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20808;&#20570;&#22791;&#20221;,&#20813;&#24471;&#37325;&#35013;&#31995;&#32479;
</span>[root@centos8 ~]#grep -Ev <span style="color: #8b2252;">'^ *#|^$'</span> /etc/httpd/conf/httpd.conf
ServerRoot <span style="color: #8b2252;">"/etc/httpd"</span>
Listen 80
Include conf.modules.d/*.conf
User apache
Group apache
ServerAdmin root@localhost
&lt;Directory /&gt;
    AllowOverride none
    Require all denied
&lt;/Directory&gt;
DocumentRoot <span style="color: #8b2252;">"/var/www/html"</span>
&lt;Directory <span style="color: #8b2252;">"/var/www"</span>&gt;
    AllowOverride None
    Require all granted
&lt;/Directory&gt;
&lt;Directory <span style="color: #8b2252;">"/var/www/html"</span>&gt;
    Options Indexes FollowSymLinks
    AllowOverride None
    Require all granted
&lt;/Directory&gt;
&lt;IfModule dir_module&gt;
    DirectoryIndex haha.html index.html    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32593;&#31449;&#20027;&#39029;&#38754;,&#21487;&#20197;&#26377;&#22791;&#29992;&#30340;,&#20462;&#25913;&#21518;&#24314;&#35758;&#29992;systemctl reload httpd ,&#19981;&#20250;&#20572;&#27490;&#36827;&#31243; 
</span>&lt;/IfModule&gt;
&lt;Files <span style="color: #8b2252;">".ht*"</span>&gt;
    Require all denied
&lt;/Files&gt;
ErrorLog <span style="color: #8b2252;">"logs/error_log"</span>
LogLevel warn
&lt;IfModule log_config_module&gt;
    LogFormat <span style="color: #8b2252;">"%h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-Agent}i\""</span> combined
    LogFormat <span style="color: #8b2252;">"%h %l %u %t \"%r\" %&gt;s %b"</span> common
    &lt;IfModule logio_module&gt;
      LogFormat <span style="color: #8b2252;">"%h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O"</span> combinedio
    &lt;/IfModule&gt;
    CustomLog <span style="color: #8b2252;">"logs/access_log"</span> combined
&lt;/IfModule&gt;
&lt;IfModule alias_module&gt;
    ScriptAlias /cgi-bin/ <span style="color: #8b2252;">"/var/www/cgi-bin/"</span>
&lt;/IfModule&gt;
&lt;Directory <span style="color: #8b2252;">"/var/www/cgi-bin"</span>&gt;
    AllowOverride None
    Options None
    Require all granted
&lt;/Directory&gt;
&lt;IfModule mime_module&gt;
    TypesConfig /etc/mime.types
    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz
    AddType text/html .shtml
    AddOutputFilter INCLUDES .shtml
&lt;/IfModule&gt;
AddDefaultCharset UTF-8
&lt;IfModule mime_magic_module&gt;
    MIMEMagicFile conf/magic
&lt;/IfModule&gt;
EnableSendfile on
IncludeOptional conf.d/*.conf
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ddf7839e-50f1-4991-8827-f0d97202e934" class="outline-4">
<h4 id="h:ddf7839e-50f1-4991-8827-f0d97202e934">编译安装httpd 2.4</h4>
<div class="outline-text-4" id="text-h:ddf7839e-50f1-4991-8827-f0d97202e934">
</div>
<div id="outline-container-h:52ef9f27-bbce-42ff-9203-2c03fe9dc7a3" class="outline-5">
<h5 id="h:52ef9f27-bbce-42ff-9203-2c03fe9dc7a3">编译说明和准备</h5>
<div class="outline-text-5" id="text-h:52ef9f27-bbce-42ff-9203-2c03fe9dc7a3">

<figure id="org4ec1bfa">
<img src="./images/20200706183725868.png" alt="20200706183725868.png">

</figure>

<p>
APR：Apache portable Run-time
libraries，Apache可移植运行库，主要为上层的应用程序提供一个可以跨越多操作系统平台使用的底层支持接口库。在早期的Apache版本中，应用程序本身必须能够处理各种具体操作系统平台的细节，并针对不同的平台调用不同的处理函数随着Apache的进一步开发，Apache组织决定将这些通用的函数独立出来并发展成为一个新的项目。这样，APR的开发就从Apache
中独立出来，Apache仅仅是使用
APR而已。目前APR主要还是由Apache使用，由于APR的较好的移植性，因此一些需要进行移植的C程序也开始使用APR，开源项目：比如用于服务器压力测试的Flood
loader tester，项目站点：<a href="http://httpd.apache.org/test/flood">http://httpd.apache.org/test/flood</a>
</p>

<p>
APR官网：<a href="http://apr.apache.org">http://apr.apache.org</a>
</p>

<p>
说明：安装httpd-2.4，依赖于apr-1.4+, apr-util-1.4+
</p>

<p>
<b>编译安装httpd-2.4准备</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#30456;&#20851;&#21253;&#65306;
</span>[root@centos7 ~]#yum -y install gcc make pcre-devel openssl-devel expat-devel
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#19979;&#36733;&#28304;&#20195;&#30721;&#24182;&#35299;&#21387;&#32553;&#65306;
</span>[root@centos7 ~]#wget https://downloads.apache.org//apr/apr-1.7.0.tar.bz2
[root@centos7 ~]#wget https://downloads.apache.org//apr/apr-util-1.6.1.tar.bz2
[root@centos7 ~]#wget https://downloads.apache.org//httpd/httpd-2.4.43.tar.bz2
[root@centos7 ~]#ls
httpd-2.4.43.tar.bz2,apr-1.7.0.tar.bz2,apr-util-1.6.1.tar.bz2
[root@centos7 ~]#tar xvf apr-1.7.0.tar.bz2
[root@centos7 ~]#tar xvf apr-util-1.6.1.tar.bz2
[root@centos7 ~]#tar xvf httpd-2.4.43.tar.bz2
</pre>
</div>
</div>
</div>
<div id="outline-container-h:43a0151f-1c59-4f2b-87fd-37be991fc3cb" class="outline-5">
<h5 id="h:43a0151f-1c59-4f2b-87fd-37be991fc3cb">编译安装httpd-2.4 方法一</h5>
<div class="outline-text-5" id="text-h:43a0151f-1c59-4f2b-87fd-37be991fc3cb">
<ol class="org-ol">
<li><p>
<b>编译安装apr</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">cd</span> apr-1.7.0
./configure --prefix=/app/apr
make &amp;&amp; make install
</pre>
</div></li>

<li><p>
<b>编译安装apr-util</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">cd</span> ./apr-util-1.6.1
./configure --prefix=/app/apr-util --with-apr=/app/apr/
make -j 2 &amp;&amp; make install
</pre>
</div></li>

<li><p>
<b>编译安装 httpd-2.4</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">cd</span> ../httpd-2.4.41
./configure --prefix=/app/httpd24 <span style="color: #8b2252;">\</span>
--enable-so <span style="color: #8b2252;">\</span>
--enable-ssl <span style="color: #8b2252;">\</span>
--enable-cgi <span style="color: #8b2252;">\</span>
--enable-rewrite <span style="color: #8b2252;">\</span>
--with-zlib <span style="color: #8b2252;">\</span>
--with-pcre <span style="color: #8b2252;">\</span>
--with-apr=/app/apr/ <span style="color: #8b2252;">\</span>
--with-apr-util=/app/apr-util/ <span style="color: #8b2252;">\</span>
--enable-modules=most <span style="color: #8b2252;">\ </span>   
--enable-mpms-shared=all <span style="color: #8b2252;">\ </span> 
--with-mpm=prefork          <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#21069;mpm&#35774;&#32622;&#20026;prefork&#27169;&#22411;
</span>make -j 4 &amp;&amp; make install
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-h:6819331f-59de-4c1c-919e-ca38cd344b32" class="outline-5">
<h5 id="h:6819331f-59de-4c1c-919e-ca38cd344b32">编译安装httpd-2.4方法二</h5>
<div class="outline-text-5" id="text-h:6819331f-59de-4c1c-919e-ca38cd344b32">
<ol class="org-ol">
<li><p>
<b>将apr 和apr-util源码与httpd 源码合并</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">mv apr-1.7.0 httpd-2.4.41/srclib/apr
mv apr-util-1.6.1 httpd-2.4.41/srclib/apr-util
ls httpd-2.4.41/srclib/
apr apr-util Makefile.in
</pre>
</div></li>

<li><p>
<b>将三者一并编译并安装</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">cd</span> httpd-2.4.41/
./configure <span style="color: #8b2252;">\</span>
--prefix=/app/httpd24 <span style="color: #8b2252;">\</span>
--enable-so <span style="color: #8b2252;">\</span>
--enable-ssl <span style="color: #8b2252;">\</span>
--enable-cgi <span style="color: #8b2252;">\</span>
--enable-rewrite <span style="color: #8b2252;">\</span>
--with-zlib <span style="color: #8b2252;">\</span>
--with-pcre <span style="color: #8b2252;">\</span>
--with-included-apr <span style="color: #8b2252;">\</span>
--enable-modules=most <span style="color: #8b2252;">\ </span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22823;&#37096;&#20998;&#27169;&#22359;&#37117;&#21152;&#36827;&#21435;
</span>--enable-mpms-shared=all <span style="color: #8b2252;">\ </span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#29992;mpms&#22810;&#21151;&#33021;&#22788;&#29702;&#27169;&#22359;
</span>--with-mpm=prefork          <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#21069;mpm&#35774;&#32622;&#20026;prefork&#27169;&#22411;
</span>make -j 4 &amp;&amp; make install
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-h:7b9e18a5-b83c-4a19-a8fe-f4ea5a635f8c" class="outline-5">
<h5 id="h:7b9e18a5-b83c-4a19-a8fe-f4ea5a635f8c">编译安装后配置</h5>
<div class="outline-text-5" id="text-h:7b9e18a5-b83c-4a19-a8fe-f4ea5a635f8c">
<p>
Httpd编译过程：/app/httpd24/build/config.nice
</p>

<p>
自带的服务控制脚本：/app/httpd24/bin/apachectl
</p>

<p>
<b>创建专用用户</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">useradd -s /sbin/nologin -r apache
</pre>
</div>

<p>
<b>指定运行httpd的用户</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">vim /app/httpd24/conf/httpd.conf
user apache
group apache
</pre>
</div>

<p>
<b>配置环境变量</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#26041;&#27861;&#19968;:
vim /etc/profile.d/httpd24.sh
<span style="color: #a0522d;">PATH</span>=/app/httpd24/bin:$<span style="color: #a0522d;">PATH</span>

&#26041;&#27861;&#20108;:
ln -s /app/httpd24/bin/* /usr/bin/
</pre>
</div>

<p>
<b>配置帮助</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">vim /etc/man_db.conf
MANDATORY_MANPATH /app/httpd24/man

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#40664;&#35748;&#27809;&#26377;man&#24110;&#21161;
</span>[root@Centos7 ~]#man httpd
No manual entry for httpd

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#19979;&#38754;&#26159;httpd&#30340;man&#36335;&#24452;
</span>[root@Centos7 ~]#ls /app/httpd24/
bin  build  cgi-bin  conf  error  htdocs  icons  include  lib  logs  man  manual  modules
[root@Centos7 ~]#ls /app/httpd24/man
man1  man8

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;man&#24110;&#21161;&#37197;&#32622;&#25991;&#20214;
</span>[root@Centos7 ~]#vim /etc/man_db.conf 
MANDATORY_MANPATH           /app/httpd24/man     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21152;&#20837;&#36825;&#19968;&#34892;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37325;&#26032;&#21152;&#36733;
</span>[root@Centos7 ~]#mandb
</pre>
</div>

<p>
<b>设置开机自动启动</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">vim /etc/rc.d/rc.local
/app/httpd24/bin/apachectl start
chmod +x /etc/rc.d/rc.local
</pre>
</div>

<p>
<b>创建service unit文件(CentOS 7 以上版本)</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">vim /usr/lib/systemd/system/httpd24.service
[Unit]
<span style="color: #a0522d;">Description</span>=The Apache HTTP Server
<span style="color: #a0522d;">After</span>=network.target remote-fs.target nss-lookup.target
<span style="color: #a0522d;">Documentation</span>=man:httpd(8)
<span style="color: #a0522d;">Documentation</span>=man:apachectl(8)
[Service]
<span style="color: #a0522d;">Type</span>=forking
<span style="color: #b22222;">#</span><span style="color: #b22222;">EnvironmentFile=/etc/sysconfig/httpd
</span><span style="color: #a0522d;">ExecStart</span>=/app/httpd24/bin/apachectl start
<span style="color: #b22222;">#</span><span style="color: #b22222;">ExecStart=/app/httpd24/bin/httpd $OPTIONS -k start
</span><span style="color: #a0522d;">ExecReload</span>=/app/httpd24/bin/apachectl graceful
<span style="color: #b22222;">#</span><span style="color: #b22222;">ExecReload=/app/httpd24/bin/httpd $OPTIONS -k graceful
</span><span style="color: #a0522d;">ExecStop</span>=/app/httpd24/bin/apachectl stop
<span style="color: #a0522d;">KillSignal</span>=SIGCONT
<span style="color: #a0522d;">PrivateTmp</span>=true
[Install]
<span style="color: #a0522d;">WantedBy</span>=multi-user.target

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37325;&#26032;&#21152;&#36733;
</span>[root@Centos7 ~]#systemctl daemon-reload
[root@Centos7 ~]#systemctl status httpd
&#9679; httpd.service - The Apache HTTP Server
   Loaded: loaded (/usr/lib/systemd/system/httpd.service; disabled; vendor preset: disabled)
   Active: inactive (dead)
     Docs: man:httpd(8)
           man:apachectl(8)
</pre>
</div>

<p>
<b>实验:设置页面</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@Centos7 ~]#cd /app/httpd24/htdocs/
[root@Centos7 htdocs]#ls
index.html
[root@Centos7 htdocs]#cat index.html 
&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;
[root@Centos7 htdocs]#mkdir /data/www/

[root@Centos7 htdocs]#vim /app/httpd24/conf/httpd.conf
DocumentRoot <span style="color: #8b2252;">"/data/www"</span>
&lt;directory /data/www&gt;
require all granted
&lt;/directory&gt;

[root@Centos7 htdocs]#httpd -t
Syntax OK

[root@Centos7 htdocs]#systemctl reload httpd
[root@Centos7 htdocs]#echo /data/www/ &gt; /data/www/index.html

&#25928;&#26524;&#22914;&#19979;&#22270;:
</pre>
</div>


<figure id="org3261999">
<img src="./images/20200706183755679.png" alt="20200706183755679.png">

</figure>

<p>
<b>创建启动脚本(CentOS 6 以前版本)</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#33258;&#23450;&#20041;&#21551;&#21160;&#33050;&#26412;(&#21442;&#32771;httpd-2.2&#30340;&#26381;&#21153;&#33050;&#26412;)
</span>cp /etc/rc.d/init.d/httpd /etc/rc.d/init.d/httpd24
vim /etc/rc.d/init.d/httpd24
<span style="color: #a0522d;">apachectl</span>=/app/httpd24/bin/apachectl
<span style="color: #a0522d;">httpd</span>=${<span style="color: #a0522d;">HTTPD</span>-/app/httpd24/bin/httpd}
<span style="color: #a0522d;">pidfile</span>=${<span style="color: #a0522d;">PIDFILE</span>-/app/httpd24/logs/httpd.pid}
<span style="color: #a0522d;">lockfile</span>=${<span style="color: #a0522d;">LOCKFILE</span>-/var/lock/subsys/httpd24}

chkconfig &#8211;add httpd24
chkconfig &#8211;list httpd24
</pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-h:4f517b42-f853-4eb3-a94e-f9acdf55f042" class="outline-2">
<h2 id="h:4f517b42-f853-4eb3-a94e-f9acdf55f042">httpd 常见配置</h2>
<div class="outline-text-2" id="text-h:4f517b42-f853-4eb3-a94e-f9acdf55f042">
</div>
<div id="outline-container-h:5c309535-59b4-40d3-ac28-0c2ffbd60356" class="outline-3">
<h3 id="h:5c309535-59b4-40d3-ac28-0c2ffbd60356">指定服务器名</h3>
<div class="outline-text-3" id="text-h:5c309535-59b4-40d3-ac28-0c2ffbd60356">
<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#httpd -t
AH00558: httpd: Could not reliably determine the server<span style="color: #8b2252;">'s fully qualified domain name, using centos8.localdomain. Set the '</span>ServerName<span style="color: #8b2252;">' directive globally to suppress this message
Syntax OK
[root@centos8 ~]#vim /etc/httpd/conf/httpd.conf
#ServerName www.example.com:80
servername www.ciciedu.org
[root@centos8 ~]#httpd -t
Syntax OK</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:e4afbcca-7a7a-4bf2-938a-8adb9991d0c4" class="outline-3">
<h3 id="h:e4afbcca-7a7a-4bf2-938a-8adb9991d0c4">显示服务器版本信息</h3>
<div class="outline-text-3" id="text-h:e4afbcca-7a7a-4bf2-938a-8adb9991d0c4">
<div class="org-src-container">
<pre class="src src-sh">ServerTokens Major|Minor|Min[imal]|Prod[uctOnly]|OS|Full
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">ServerTokens Prod[uctOnly] &#65306;Server: Apache
ServerTokens Major: Server: Apache/2
ServerTokens Minor: Server: Apache/2.0
ServerTokens Min[imal]: Server: Apache/2.0.41
ServerTokens OS: Server: Apache/2.0.41 (Unix)
ServerTokens Full (or not specified): Server: Apache/2.0.41 (Unix) PHP/4.2.2
MyMod/1.2
</pre>
</div>

<p>
建议使用：ServerTokens Prod
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#40664;&#35748;&#25928;&#26524;
</span>[root@Centos7 htdocs]#curl -I http://10.0.0.17
HTTP/1.1 200 OK
Date: Tue, 23 Jun 2020 12:08:06 GMT
Server: Apache/2.4.43 (Unix)
Last-Modified: Tue, 23 Jun 2020 09:45:00 GMT
ETag: <span style="color: #8b2252;">"b-5a8bd367e085a"</span>
Accept-Ranges: bytes
Content-Length: 11
Content-Type: text/html

[root@Centos7 ~]#cd /app/httpd24/conf/
[root@Centos7 conf]#ls
extra  httpd.conf  magic  mime.types  original
[root@Centos7 conf]#vim httpd.conf    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23613;&#21487;&#33021;&#19981;&#25913;&#20027;&#37197;&#32622;&#25991;&#20214;
</span>Include conf.d/*.conf
[root@Centos7 conf]#cd ..
[root@Centos7 httpd24]#ls
bin    cgi-bin  error   icons    lib   man     modules
build  conf     htdocs  include  logs  manual
[root@Centos7 httpd24]#mkdir conf.d
[root@Centos7 httpd24]#vim conf.d/test.conf
[root@Centos7 httpd24]#httpd -t
Syntax OK
[root@Centos7 httpd24]#systemctl reload httpd
[root@Centos7 httpd24]#curl -I http://10.0.0.17
HTTP/1.1 200 OK
Date: Tue, 23 Jun 2020 12:15:17 GMT
Server: Apache
Last-Modified: Tue, 23 Jun 2020 09:45:00 GMT
ETag: <span style="color: #8b2252;">"b-5a8bd367e085a"</span>
Accept-Ranges: bytes
Content-Length: 11
Content-Type: text/html
</pre>
</div>


<figure id="orgc514da8">
<img src="./images/20200706223148307.png" alt="20200706223148307.png">

</figure>
</div>
</div>
<div id="outline-container-h:2343235c-8bc8-4444-9d46-f8fc6c59cf9f" class="outline-3">
<h3 id="h:2343235c-8bc8-4444-9d46-f8fc6c59cf9f">包含其它配置文件</h3>
<div class="outline-text-3" id="text-h:2343235c-8bc8-4444-9d46-f8fc6c59cf9f">
<p>
指令：
</p>

<div class="org-src-container">
<pre class="src src-sh">Include file-path|directory-path|wildcard
IncludeOptional file-path|directory-path|wildcard
</pre>
</div>

<p>
说明：
</p>

<ul class="org-ul">
<li>Include和IncludeOptional功能相同，都可以包括其它配置文件</li>
<li>但是当无匹配文件时，include会报错，IncludeOptional会忽略错误</li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">Wildcards may be included in the directory or file portion of the path. This example will fail if there is no subdirectory in conf/vhosts that contains at least one *.conf file:
</span>Include conf/vhosts/*/*.conf
<span style="color: #b22222;">#</span><span style="color: #b22222;">Alternatively, the following command will just be ignored in case of missing files or directories:
</span>
IncludeOptional conf/vhosts/*/*.conf
</pre>
</div>
</div>
</div>
<div id="outline-container-h:f417fbd7-d718-433c-8c03-22c6752c3ac5" class="outline-3">
<h3 id="h:f417fbd7-d718-433c-8c03-22c6752c3ac5">监听的IP和Port</h3>
<div class="outline-text-3" id="text-h:f417fbd7-d718-433c-8c03-22c6752c3ac5">
<div class="org-src-container">
<pre class="src src-sh">Listen [IP:]PORT
</pre>
</div>

<p>
说明：
</p>

<p>
(1) 省略IP表示为本机所有IP
</p>

<p>
(2) Listen指令至少一个，可重复出现多次
</p>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">vim /app/httpd24/httpd.conf
Listen 192.168.1.100:8080    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27492;ip&#21482;&#33021;&#36890;&#36807;8080&#31471;&#21475;&#35775;&#38382;
</span>Lsten 80
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b6c5075f-6e58-4bef-a525-e7464a2190f3" class="outline-3">
<h3 id="h:b6c5075f-6e58-4bef-a525-e7464a2190f3">持久连接</h3>
<div class="outline-text-3" id="text-h:b6c5075f-6e58-4bef-a525-e7464a2190f3">
<p>
Persistent
Connection：连接建立，每个资源获取完成后不会断开连接，而是继续等待其它的请求完成，默认开启持久连接
</p>

<p>
断开条件：
</p>

<div class="org-src-container">
<pre class="src src-sh">&#26102;&#38388;&#38480;&#21046;&#65306;&#20197;&#31186;&#20026;&#21333;&#20301;&#65292; &#40664;&#35748;5s&#65292;httpd-2.4 &#25903;&#25345;&#27627;&#31186;&#32423;
&#35831;&#27714;&#25968;&#37327;: &#35831;&#27714;&#25968;&#36798;&#21040;&#25351;&#23450;&#20540;,&#20063;&#20250;&#26029;&#24320; 
</pre>
</div>

<p>
副作用：对并发访问量大的服务器，持久连接会使有些请求得不到响应
</p>

<p>
折衷：使用较短的持久连接时间
</p>

<p>
持久连接相关指令：
</p>

<div class="org-src-container">
<pre class="src src-sh">KeepAlive On|Off
KeepAliveTimeout 15      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36830;&#25509;&#25345;&#32493;15s,&#21487;&#20197;&#20197;ms&#20026;&#21333;&#20301;,&#40664;&#35748;&#20540;&#20026;5s
</span>MaxKeepAliveRequests 500 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25345;&#20037;&#36830;&#25509;&#26368;&#22823;&#25509;&#25910;&#30340;&#35831;&#27714;&#25968;,&#40664;&#35748;&#20540;100</span>
</pre>
</div>

<p>
测试方法：
</p>

<div class="org-src-container">
<pre class="src src-sh">telnet WEB_SERVER_IP PORT
GET /URL HTTP/1.1
Host: WEB_SERVER_IP
</pre>
</div>


<figure id="org58bdb4c">
<img src="./images/20200706223205359.png" alt="20200706223205359.png">

</figure>
</div>
</div>
<div id="outline-container-h:d8ab7f98-7568-4f16-99d2-183fd89fd868" class="outline-3">
<h3 id="h:d8ab7f98-7568-4f16-99d2-183fd89fd868">DSO (Dynamic Shared Object)</h3>
<div class="outline-text-3" id="text-h:d8ab7f98-7568-4f16-99d2-183fd89fd868">
<p>
*Dynamic Shared Object*，加载动态模块配置，不需重启即生效
</p>

<p>
动态模块所在路径： <i>usr/lib64/httpd/modules</i>
</p>

<p>
主配置 /etc/httpd/conf/httpd.conf 文件中指定加载模块配置文件
</p>

<div class="org-src-container">
<pre class="src src-sh">ServerRoot <span style="color: #8b2252;">"/etc/httpd"</span>
Include conf.modules.d/*.conf
</pre>
</div>

<p>
配置指定实现模块加载格式：
</p>

<div class="org-src-container">
<pre class="src src-sh">LoadModule &lt;mod_name&gt; &lt;mod_path&gt;
</pre>
</div>

<p>
模块文件路径可使用相对路径：相对于ServerRoot（默认/etc/httpd）
</p>

<p>
范例：查看模块加载的配置文件
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#ls /etc/httpd/conf.modules.d/
00-base.conf 00-lua.conf 00-optional.conf 00-systemd.conf 10-h2.conf
README
00-dav.conf 00-mpm.conf 00-proxy.conf 01-cgi.conf 10-proxy_h2.conf

[root@centos8 ~]#cat /etc/httpd/conf.modules.d/00-base.conf
<span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">This file loads most of the modules included with the Apache HTTP
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Server itself.
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span>LoadModule access_compat_module modules/mod_access_compat.so
LoadModule actions_module modules/mod_actions.so
LoadModule alias_module modules/mod_alias.so
LoadModule allowmethods_module modules/mod_allowmethods.so
LoadModule auth_basic_module modules/mod_auth_basic.so
...&#30465;&#30053;...
</pre>
</div>

<p>
<b>查看静态编译的模块</b> ：httpd -l
</p>

<p>
<b>查看静态编译及动态装载的模块</b> ：httpd &#x2013;M
</p>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#20986;&#38745;&#24577;&#32534;&#35793;&#27169;&#22359;
</span>[root@centos8 ~]#httpd -l
Compiled<span style="color: #a020f0;"> in</span> modules:
core.c
mod_so.c
http_core.c

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#20986;&#38745;&#24577;&#21644;&#21160;&#24577;&#32534;&#35793;&#30340;&#27169;&#22359;
</span>[root@centos8 ~]#httpd -M
AH00558: httpd: Could not reliably determine the server<span style="color: #8b2252;">'s fully qualified domain name, using centos8.localdomain. Set the '</span>ServerName<span style="color: #8b2252;">' directive globally to suppress this message
Loaded Modules:
core_module (static)
so_module (static)
http_module (static)
access_compat_module (shared)
actions_module (shared)
alias_module (shared)
allowmethods_module (shared)
auth_basic_module (shared)
...&#30465;&#30053;...</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:8e78c1dc-5358-4766-b736-b6c5f186966f" class="outline-3">
<h3 id="h:8e78c1dc-5358-4766-b736-b6c5f186966f">MPM (Multi-Processing Module) 多路处理模块</h3>
<div class="outline-text-3" id="text-h:8e78c1dc-5358-4766-b736-b6c5f186966f">
<p>
httpd 支持三种MPM工作模式：prefork, worker, event
</p>

<p>
切换使用的MPM：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#29992;&#35201;&#21551;&#29992;&#30340;MPM&#30456;&#20851;&#30340;LoadModule&#25351;&#20196;&#21363;&#21487;&#65292;&#20854;&#23427;&#26410;&#21551;&#29992;&#30340;&#20004;&#39033;&#38656;&#35201;&#22312;&#34892;&#39318;&#21152;#&#27880;&#37322;
</span>vim /etc/httpd/conf.modules.d/00-mpm.conf
<span style="color: #b22222;">#</span><span style="color: #b22222;">LoadModule mpm_prefork_module modules/mod_mpm_prefork.so
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">LoadModule mpm_worker_module modules/mod_mpm_worker.so
</span>LoadModule mpm_event_module modules/mod_mpm_event.so
</pre>
</div>

<p>
注意：不要同时启用多个MPM模块，否则会出现以下错误
</p>

<div class="org-src-container">
<pre class="src src-sh">AH00534: httpd: Configuration error: More than one MPM loaded.
</pre>
</div>

<p>
范例：查看CentOS 8 和 CentOS 7 默认的MPM工作模式
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;CentOS 8 &#40664;&#35748;&#30340;MPM&#24037;&#20316;&#27169;&#24335;
</span>[root@centos8 ~]#httpd -M |grep mpm
AH00558: httpd: Could not reliably determine the server<span style="color: #8b2252;">'s fully qualified domain name, using centos8.localdomain. Set the '</span>ServerName<span style="color: #8b2252;">' directive globally to suppress this message
mpm_event_module (shared)

#&#26597;&#30475;CentOS 7 &#40664;&#35748;&#30340;MPM&#24037;&#20316;&#27169;&#24335;
[root@centos7 ~]#httpd -M |grep mpm
AH00558: httpd: Could not reliably determine the server'</span>s fully qualified domain name, using centos7.localdomain. Set the <span style="color: #8b2252;">'ServerName'</span> directive globally to suppress this message
<span style="color: #0000ff;">mpm_prefork_module</span> (shared)
</pre>
</div>

<p>
范例：修改CentOS 8使用 prefork 模型
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#vim /etc/httpd/conf.modules.d/00-mpm.conf
[root@centos8 ~]#grep Load /etc/httpd/conf.modules.d/00-mpm.conf
<span style="color: #b22222;"># </span><span style="color: #b22222;">one of the following LoadModule lines. See the httpd.conf(5) man
</span>LoadModule mpm_prefork_module modules/mod_mpm_prefork.so
<span style="color: #b22222;">#</span><span style="color: #b22222;">LoadModule mpm_worker_module modules/mod_mpm_worker.so
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">LoadModule mpm_event_module modules/mod_mpm_event.so
</span>[root@centos8 ~]#httpd -M | grep mpm
AH00558: httpd: Could not reliably determine the server<span style="color: #8b2252;">'s fully qualified domain name, using centos8.localdomain. Set the '</span>ServerName<span style="color: #8b2252;">' directive globally to suppress this message
mpm_prefork_module (shared)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b80f3760-4b5c-4f15-a160-5e3e37e5853f" class="outline-3">
<h3 id="h:b80f3760-4b5c-4f15-a160-5e3e37e5853f">prefork 模式相关的配置：</h3>
<div class="outline-text-3" id="text-h:b80f3760-4b5c-4f15-a160-5e3e37e5853f">
<div class="org-src-container">
<pre class="src src-sh">StartServers            2000
MinSpareServers         1000 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26368;&#23569;&#31354;&#38386;&#36827;&#31243;&#25968;
</span>MaxSpareServers         3000 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26368;&#22810;&#31354;&#38386;&#36827;&#31243;&#25968;
</span>ServerLimit             2560 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26368;&#22810;&#36827;&#31243;&#25968;,&#26368;&#22823;&#20540; 20000
</span>MaxRequestWorkers       2560 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26368;&#22823;&#30340;&#24182;&#21457;&#36830;&#25509;&#25968;&#65292;&#40664;&#35748;256
</span>MaxConnectionsPerChild  4000 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23376;&#36827;&#31243;&#26368;&#22810;&#33021;&#22788;&#29702;&#30340;&#35831;&#27714;&#25968;&#37327;&#12290;&#22312;&#22788;&#29702;MaxRequestsPerChild &#20010;&#35831;&#27714;&#20043;&#21518;,&#23376;&#36827;&#31243;&#23558;&#20250;&#34987;&#29238;&#36827;&#31243;&#32456;&#27490;&#65292;&#36825;&#26102;&#20505;&#23376;&#36827;&#31243;&#21344;&#29992;&#30340;&#20869;&#23384;&#23601;&#20250;&#37322;&#25918;(&#20026;0&#26102;&#27704;&#36828;&#19981;&#37322;&#25918;&#65289;
</span>MaxRequestsPerChild     4000 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20174; httpd.2.3.9&#24320;&#22987;&#34987;MaxConnectionsPerChild&#20195;&#26367;</span>
</pre>
</div>

<p>
实验:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@Centos7 httpd24]#cat  conf.d/test.conf 
ServerTokens Prod
StartServers            100
MinSpareServers         80
MaxSpareServers         90
ServerLimit             2560
MaxRequestWorkers       2560

[root@Centos7 httpd24]#ps aux | grep httpd |wc -l
92     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20854;&#20013;&#26377;&#20004;&#20010;root</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:43d68b21-6dfc-4cf6-b754-02c62981c2f0" class="outline-3">
<h3 id="h:43d68b21-6dfc-4cf6-b754-02c62981c2f0">worker和event 模式相关的配置</h3>
<div class="outline-text-3" id="text-h:43d68b21-6dfc-4cf6-b754-02c62981c2f0">
<div class="org-src-container">
<pre class="src src-sh">ServerLimit       16 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26368;&#22810;&#24320;&#21551;worker&#36827;&#31243;&#30340;&#25968;&#37327;Upper limit on configurable number of processes
</span>StartServers      10 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24320;&#21551;&#30340;&#36827;&#31243;&#25968;  Number of child server processes created at startup
</span>MaxRequestWorkers 150 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26368;&#22823;&#22788;&#29702;&#36830;&#25509;&#25968;&#37327; Maximum number of connections that will be processed simultaneously
</span>MinSpareThreads   25 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26368;&#23569;&#31354;&#38386;&#32447;&#31243;
</span>MaxSpareThreads   75 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26368;&#22810;&#31354;&#38386;&#32447;&#31243;
</span>ThreadsPerChild   25 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#20010;&#36827;&#31243;&#37324;&#30340;&#32447;&#31243;&#25968; Number of threads created by each child process</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:41b90760-21bf-4888-a503-6b3dcc829160" class="outline-3">
<h3 id="h:41b90760-21bf-4888-a503-6b3dcc829160">定义Main server的文档页面路径</h3>
<div class="outline-text-3" id="text-h:41b90760-21bf-4888-a503-6b3dcc829160">
<div class="org-src-container">
<pre class="src src-sh">DocumentRoot <span style="color: #8b2252;">"/path"</span>
&lt;directory /path&gt;
    Require all granted    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24517;&#39035;&#25480;&#26435;
</span>&lt;/directory&gt;
</pre>
</div>

<p>
说明：
</p>

<ul class="org-ul">
<li>DocumentRoot指向的路径为URL路径的起始位置</li>
<li>/path 必须显式授权后才可以访问</li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">DocumentRoot <span style="color: #8b2252;">"/data/html"</span>
&lt;directory /data/html&gt;
    Require all granted
&lt;/directory&gt;
</pre>
</div>

<p>
<a href="http://host:port/test/index.html">http://host:port/test/index.html</a> &#x2013;&gt; /data/html/test/index.html
</p>
</div>
</div>
<div id="outline-container-h:ccf9d41e-ad72-47ce-b1fb-6c20086c3605" class="outline-3">
<h3 id="h:ccf9d41e-ad72-47ce-b1fb-6c20086c3605">定义站点主页面</h3>
<div class="outline-text-3" id="text-h:ccf9d41e-ad72-47ce-b1fb-6c20086c3605">
<div class="org-src-container">
<pre class="src src-sh">DirectoryIndex index.php index.html
</pre>
</div>
</div>
</div>
<div id="outline-container-h:475b8715-5f4c-4f78-bfcb-604b887481f1" class="outline-3">
<h3 id="h:475b8715-5f4c-4f78-bfcb-604b887481f1">可实现访问控制的资源</h3>
<div class="outline-text-3" id="text-h:475b8715-5f4c-4f78-bfcb-604b887481f1">
<p>
可以针对文件系统和URI的资源进行访问控制
</p>

<p>
说明: 所谓文件系统是指一个目录能不能访问
,URI是统一资源标识,分为URN和URL,通常我们指的是URL(统一资源定位服务)
</p>

<p>
文件系统路径：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#22522;&#20110;&#30446;&#24405;
</span>&lt;Directory &#8220;/path<span style="color: #8b2252;">"&gt;
...
&lt;/Directory&gt;

#&#22522;&#20110;&#25991;&#20214;
&lt;File &#8220;/path/file&#8221;&gt;
...
&lt;/File&gt;

#&#22522;&#20110;&#25991;&#20214;&#36890;&#37197;&#31526;
&lt;File &#8220;/path/*file*&#8221;&gt;
...
&lt;/File&gt;

#&#22522;&#20110;&#25193;&#23637;&#27491;&#21017;&#34920;&#36798;&#24335;
&lt;FileMatch &#8220;regex&#8221;&gt;
...
&lt;/FileMatch&gt;</span>
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">.+&#34920;&#31034;&#19968;&#20010;&#23383;&#31526;&#20197;&#19978;    \.&#34920;&#31034;&#23545;.&#36716;&#20041;   |&#34920;&#31034;&#25110;    e?&#34920;&#31034;e&#21487;&#26377;&#21487;&#26080;     &#21305;&#37197;&#25991;&#20214;&#21517;&#20107;&#23452;&#22270;&#29255;&#20026;&#21518;&#32512;
</span>&lt;FilesMatch <span style="color: #8b2252;">".+\.(gif|jpe?g|png)$"</span>&gt;     
    <span style="color: #b22222;"># </span><span style="color: #b22222;">...         #&#27492;&#22788;&#21487;&#20197;&#22635;&#26159;&#21542;&#20801;&#35768;&#35775;&#38382;
</span>&lt;/FilesMatch&gt;

&lt;Files <span style="color: #8b2252;">".ht*"</span>&gt;  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#37197;&#31526;,&#34920;&#31034;.ht&#24320;&#22836;
</span>    Require all denied
&lt;/Files&gt;
</pre>
</div>

<p>
URL路径：
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;Location <span style="color: #8b2252;">"URL"</span>&gt;
...
&lt;/Location&gt;

&lt;LocationMatch <span style="color: #8b2252;">"regex"</span>&gt;    <span style="color: #b22222;">#</span><span style="color: #b22222;">location&#30340;&#27491;&#21017;&#34920;&#36798;&#24335;
</span>...
&lt;/LocationMatch&gt;
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">/private1, /private1/&#65292;/private1/file.txt &#21305;&#37197;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">/private1other &#19981;&#21305;&#37197;
</span>&lt;Location <span style="color: #8b2252;">"/private1"</span>&gt;
    <span style="color: #b22222;"># </span><span style="color: #b22222;">...
</span>&lt;/Location&gt;

<span style="color: #b22222;">#</span><span style="color: #b22222;">/private2/&#65292;/private2/file.txt &#21305;&#37197;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">/private2&#65292;/private2other &#19981;&#21305;&#37197;
</span>&lt;Location <span style="color: #8b2252;">"/private2/"</span>&gt;
    <span style="color: #b22222;"># </span><span style="color: #b22222;">...
</span>&lt;/Location&gt;
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;Location /status&gt;
&lt;LocationMatch <span style="color: #8b2252;">"/(extra|special)/data"</span>&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c67ab704-b95c-4210-a84d-9999df1e8fcb" class="outline-3">
<h3 id="h:c67ab704-b95c-4210-a84d-9999df1e8fcb">针对目录和URL实现访问控制</h3>
<div class="outline-text-3" id="text-h:c67ab704-b95c-4210-a84d-9999df1e8fcb">
<p>
<b>(1) Options指令：</b>
</p>

<p>
后跟1个或多个以空白字符分隔的选项列表， 在选项前的+，-表示增加或删除指定选项
</p>

<p>
常见选项：
</p>

<ul class="org-ul">
<li>Indexes：指明的URL路径下不存在与定义的主页面资源相符的资源文件时，返回索引列表给用户</li>
<li>FollowSymLinks：允许访问符号链接文件所指向的源文件</li>
<li>None：全部禁用</li>
<li>All： 全部允许</li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;Directory /web/docs&gt;
    Options -Indexes -FollowSymLinks
&lt;/Directory&gt;

&lt;Directory /web/docs/spec&gt;
    Options -FollowSymLinks
&lt;/Directory&gt;
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cd /etc/httpd/conf.d/
[root@centos8 conf.d]#mv welcome.conf{,.bak}   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27426;&#36814;&#39029;&#38754;&#25386;&#36208;&#21518;,&#23558;&#26174;&#31034;&#40664;&#35748;&#30340;&#25991;&#20214;&#21015;&#34920;
</span>[root@centos8 conf.d]#cd /var/www/html/
[root@centos8 html]#cp /etc/fstab f1.txt
[root@centos8 html]#mkdir dir1
[root@centos8 html]#ln -s /etc/ etclink
[root@centos8 html]#ll
total 4
drwxr-xr-x 2 root root   6 Jun 25 10:50 dir1
lrwxrwxrwx 1 root root   5 Jun 25 10:51 etclink -&gt; /etc/
-rw-r--r-- 1 root root 709 Jun 25 10:50 f1.txt

[root@centos8 ~]#systemctl restart httpd
</pre>
</div>

<p>
打开浏览器，访问 <a href="http://httpd主机ip/">http://httpd主机ip/</a> 可看到下面所示
</p>


<figure id="org0106235">
<img src="./images/20200706223254753.png" alt="20200706223254753.png">

</figure>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#vim /etc/httpd/conf/httpd.conf
<span style="color: #b22222;">#</span><span style="color: #b22222;">Options Indexes FollowSymLinks
</span>Options Indexes <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#19978;&#38754;&#34892;&#21152;&#27880;&#37322;&#65292;&#20462;&#25913;&#20026;&#27492;&#34892;
</span>[root@centos8 ~]#systemctl restart httpd
</pre>
</div>

<p>
打开浏览器，访问 <a href="http://httpd主机ip/">http://httpd主机ip/</a>
可看到下面所示,无法看软链接目录datalink
</p>

<p>
<img src="./images/20200706225357677.png" alt="20200706225357677.png">
把Options Indexes这一行删除,则会有下面提示
</p>


<figure id="orgbc6f9fc">
<img src="./images/20200706225431891.png" alt="20200706225431891.png">

</figure>

<p>
<b>(2) AllowOverride指令</b>
</p>

<p>
与访问控制相关的哪些指令可以放在指定目录下的.htaccess（由AccessFileName 指令指定,AccessFileName .htaccess
为默认值）文件中，覆盖之前的配置指令，只对语句有效
</p>

<p>
常见用法：
</p>

<ul class="org-ul">
<li>AllowOverride All: .htaccess中所有指令都有效</li>
<li>AllowOverride None： .htaccess 文件无效，此为httpd 2.3.9以后版的默认值</li>
<li>AllowOverride AuthConfig .htaccess 文件中，除了AuthConfig
其它指令都无法生效</li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">vim /etc/httpd/conf/httpd.conf
<span style="color: #b22222;">#</span><span style="color: #b22222;">Options Indexes FollowSymLinks
</span>Options Indexes

<span style="color: #b22222;">#</span><span style="color: #b22222;">AllowOverride None
</span>AllowOverride <span style="color: #a0522d;">options</span>=FollowSymLinks,indexes <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27880;&#37322;&#19978;&#19968;&#34892;&#65292;&#20462;&#25913;&#20026;&#27492;&#34892;
</span>
[root@centos8 ~]#vim /var/www/html/dir1/.htaccess
Options FollowSymLinks indexes <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21152;&#27492;&#34892;
</span>
[root@centos8 ~]#cd /var/www/html/dir1/
[root@centos8 dir1]#cp /etc/fstab f2.txt
[root@centos8 dir1]#mkdir dir2
[root@centos8 dir1]#ln -s /tmp tmplink
[root@centos8 dir1]#ll
total 4
drwxr-xr-x 2 root root   6 Jun 25 11:00 dir2
-rw-r--r-- 1 root root 709 Jun 25 11:00 f2.txt
lrwxrwxrwx 1 root root   4 Jun 25 11:00 tmplink -&gt; /tmp
[root@centos8 dir1]#pwd
/var/www/html/dir1

[root@centos8 ~]#systemctl restart httpd
</pre>
</div>

<p>
打开浏览器，访问 <a href="http://httpd主机ip/dir1">http://httpd主机ip/dir1</a> ，可以看到tmplink的软链接
</p>

<p>
<img src="./images/20200706225450132.png" alt="20200706225450132.png">
打开浏览器，访问 <a href="http://httpd主机ip/">http://httpd主机ip/</a>
可看到下面所示,无法看软链接目录datalink
</p>


<figure id="org4a6728b">
<img src="./images/20200706225509275.png" alt="20200706225509275.png">

</figure>

<p>
范例：.htaccess文件默认被禁止访问
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 test2]#grep -Ev <span style="color: #8b2252;">'^ *#|^$'</span> /app/httpd24/conf/httpd.conf |grep -A 2 <span style="color: #8b2252;">'ht\*'</span>
&lt;Files <span style="color: #8b2252;">".ht*"</span>&gt;
    Require all denied
&lt;/Files&gt;  
</pre>
</div>
</div>
</div>
<div id="outline-container-h:5a5943f2-3207-4afd-9f49-121f1f58c75f" class="outline-3">
<h3 id="h:5a5943f2-3207-4afd-9f49-121f1f58c75f">基于客户端 IP 地址实现访问控制</h3>
<div class="outline-text-3" id="text-h:5a5943f2-3207-4afd-9f49-121f1f58c75f">
<p>
针对各种资源，可以基于以下两种方式的访问控制：
</p>

<ul class="org-ul">
<li>客户端来源地址</li>
<li>用户账号</li>
</ul>

<p>
基于客户端的IP地址的访问控制:
</p>

<ul class="org-ul">
<li>无明确授权的目录，默认拒绝</li>
<li>允许所有主机访问：Require all granted</li>
<li>拒绝所有主机访问：Require all denied</li>
<li><p>
控制特定的IP访问：
</p>

<p>
Require ip IPADDR：授权指定来源的IP访问
</p>

<p>
Require not ip IPADDR：拒绝特定的IP访问
</p></li>
<li><p>
控制特定的主机访问：
</p>

<p>
Require host HOSTNAME：授权特定主机访问
</p>

<p>
Require not host HOSTNAME：拒绝
</p>
<ul class="org-ul">
<li>HOSTNAME：
<ul class="org-ul">
<li>FQDN：特定主机</li>
<li>domin.tld：指定域名下的所有主机</li>
</ul></li>
</ul></li>
</ul>

<p>
不能有失败，至少有一个成功匹配才成功，即失败优先
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;RequireAll&gt;
    Require all granted
    Require not ip 172.16.1.1 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25298;&#32477;&#29305;&#23450;IP
</span>&lt;/RequireAll&gt;
</pre>
</div>

<p>
多个语句有一个成功，则成功，即成功优先
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;RequireAny&gt;
    Require all denied
    require ip 172.16.1.1 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20801;&#35768;&#29305;&#23450;IP
</span>&lt;/RequireAny&gt;
</pre>
</div>

<p>
提示：早期版本使用 mod_access_compat 模块提供的
Allow,Deny,Order指令，将被废弃，不推荐使用
</p>

<p>
<a href="http://httpd.apache.org/docs/2.4/mod/mod_access_compat.html">http://httpd.apache.org/docs/2.4/mod/mod_access_compat.html</a>
</p>

<p>
Available in Apache HTTP Server 2.3 as a compatibility module with
previous versions of Apache httpd 2.x. The directives provided by this
module have been deprecated by the new authz refactoring. Please see
mod_authz_host
</p>

<p>
The Allow , Deny , and Order directives, provided by mod_access_compat ,
are deprecated and will go away in a future version. You should avoid
using them, and avoid outdated tutorials recommending their use.
</p>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;directory /var/www/html/dir&gt;
&lt;requireany&gt;
    require all denied
    Require ip 10.0.0.0/24
&lt;/requireany&gt;
&lt;/directory&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:e56a80ea-ec5b-4e79-b4eb-a3201cac802e" class="outline-3">
<h3 id="h:e56a80ea-ec5b-4e79-b4eb-a3201cac802e">日志设定</h3>
<div class="outline-text-3" id="text-h:e56a80ea-ec5b-4e79-b4eb-a3201cac802e">
<p>
httpd有两种日志类型
</p>

<ul class="org-ul">
<li>访问日志</li>
<li>错误日志</li>
</ul>
</div>
<div id="outline-container-h:5693987d-6cae-4d15-b141-9dde027f8a9f" class="outline-4">
<h4 id="h:5693987d-6cae-4d15-b141-9dde027f8a9f">错误日志</h4>
<div class="outline-text-4" id="text-h:5693987d-6cae-4d15-b141-9dde027f8a9f">
<div class="org-src-container">
<pre class="src src-sh">LogLevel warn <span style="color: #b22222;">#</span><span style="color: #b22222;">LogLevel &#21487;&#36873;&#20540;: debug, info, notice, warn,error, crit, alert,emerg
</span>ErrorLog logs/error_log <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30456;&#23545;&#36335;&#24452;,&#30456;&#23545;&#20110;/etc/httpd,&#37197;&#32622;&#25991;&#20214;&#37324;&#26377;&#19968;&#34892;ServerRoot</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:670f329d-cb07-47e0-842c-bab2523a7906" class="outline-4">
<h4 id="h:670f329d-cb07-47e0-842c-bab2523a7906">访问日志</h4>
<div class="outline-text-4" id="text-h:670f329d-cb07-47e0-842c-bab2523a7906">
<p>
定义日志格式
</p>

<div class="org-src-container">
<pre class="src src-sh">LogFormat format nickname
</pre>
</div>

<p>
使用日志格式
</p>

<div class="org-src-container">
<pre class="src src-sh">CustomLog file nickname
</pre>
</div>

<p>
范例
</p>

<div class="org-src-container">
<pre class="src src-sh">LogFormat <span style="color: #8b2252;">"%h %l %u %{%F %T}t "</span>%r<span style="color: #8b2252;">" %&gt;s %b "</span>%{Referer}i<span style="color: #8b2252;">"\"%{User-Agent}i\""</span> testlog
</pre>
</div>

<p>
参考帮助：<a href="http://httpd.apache.org/docs/2.4/mod/mod_log_config.html#formats">http://httpd.apache.org/docs/2.4/mod/mod_log_config.html#formats</a>
</p>

<div class="org-src-container">
<pre class="src src-sh">%h <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23458;&#25143;&#31471;IP&#22320;&#22336;
</span>%l <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36828;&#31243;&#29992;&#25143;,&#21551;&#29992;mod_ident&#25165;&#26377;&#25928;&#65292;&#36890;&#24120;&#20026;&#20943;&#21495;"-&#8221;
</span>%u <span style="color: #b22222;">#</span><span style="color: #b22222;">&#39564;&#35777;&#65288;basic&#65292;digest&#65289;&#36828;&#31243;&#29992;&#25143;,&#38750;&#30331;&#24405;&#35775;&#38382;&#26102;&#65292;&#20026;&#19968;&#20010;&#20943;&#21495;"-&#8221;
</span>%t <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26381;&#21153;&#22120;&#25910;&#21040;&#35831;&#27714;&#26102;&#30340;&#26102;&#38388;
</span>%r <span style="color: #b22222;">#</span><span style="color: #b22222;">First line of request&#65292;&#21363;&#34920;&#31034;&#35831;&#27714;&#25253;&#25991;&#30340;&#39318;&#34892;&#65307;&#35760;&#24405;&#20102;&#27492;&#27425;&#35831;&#27714;&#30340;"&#26041;&#27861;&#8221;&#65292;"URL&#8221;&#20197;&#21450;&#21327;&#35758;&#29256;&#26412;
</span>%&gt;s <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21709;&#24212;&#29366;&#24577;&#30721;
</span>%b <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21709;&#24212;&#25253;&#25991;&#30340;&#22823;&#23567;&#65292;&#21333;&#20301;&#26159;&#23383;&#33410;&#65307;&#19981;&#21253;&#25324;&#21709;&#24212;&#25253;&#25991;http&#39318;&#37096;
</span>%{Referer}i <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35831;&#27714;&#25253;&#25991;&#20013;&#39318;&#37096;"referer&#8221;&#30340;&#20540;&#65307;&#21363;&#20174;&#21738;&#20010;&#39029;&#38754;&#20013;&#30340;&#36229;&#38142;&#25509;&#36339;&#36716;&#33267;&#24403;&#21069;&#39029;&#38754;&#30340;
</span>%{User-Agent}i <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35831;&#27714;&#25253;&#25991;&#20013;&#39318;&#37096;"User-Agent&#8221;&#30340;&#20540;&#65307;&#21363;&#21457;&#20986;&#35831;&#27714;&#30340;&#24212;&#29992;&#31243;&#24207;
</span>
%{VARNAME}i <span style="color: #b22222;">#</span><span style="color: #b22222;">The contents of VARNAME: header line(s) in the request sent to the server</span>
</pre>
</div>

<p>
范例: 通过自定义访问日志格式,实现自定义时间格式
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#vim /etc/httpd/conf/httpd.conf

logFormat <span style="color: #8b2252;">"%h \"%{%F %T}t\" %&gt;s %{User-Agent}i"</span> testlog
CustomLog <span style="color: #8b2252;">"logs/access_log"</span> testlog

[root@centos8 ~]#tail -f /var/log/httpd/access_log
10.0.0.7 <span style="color: #8b2252;">"2020-06-24 10:26:51"</span> 200 curl/7.29.0
</pre>
</div>

<p>
实验:查看报文头部
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#27169;&#20223;chrome&#27983;&#35272;&#22120;&#23545;163&#36827;&#34892;&#35775;&#38382;,&#26597;&#30475;&#25253;&#25991;&#22836;&#37096;
</span>[root@Centos7 ~]#curl -A chrome -I http://www.163.com
HTTP/1.1 200 OK
Date: Thu, 25 Jun 2020 06:12:01 GMT
Content-Type: text/html; <span style="color: #a0522d;">charset</span>=GBK
Connection: keep-alive
Expires: Thu, 25 Jun 2020 06:13:15 GMT
Server: nginx
Vary: Accept-Encoding
Cache-Control: no-cache,no-store,private
X-Cache-Spec: Yes
X-Via: 1.1 PS-CZX-0165159:5 (Cdn Cache Server V2.0), 1.1 PSsdzbwt5he22:2 (Cdn Cache Server V2.0), 1.1 tjtg129:2 (Cdn Cache Server V2.0)
X-Ws-Request-Id: 5ef44030_tjtg129_31362-51585
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:1a174979-4f1e-4a15-9e63-6e189a3eea54" class="outline-3">
<h3 id="h:1a174979-4f1e-4a15-9e63-6e189a3eea54">设定默认字符集</h3>
<div class="outline-text-3" id="text-h:1a174979-4f1e-4a15-9e63-6e189a3eea54">
<p>
设定字符集指令
</p>

<div class="org-src-container">
<pre class="src src-sh">AddDefaultCharset UTF-8  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27492;&#20026;&#40664;&#35748;&#20540;</span>
</pre>
</div>

<p>
中文字符集：GBK, GB2312, GB18030
</p>
</div>
</div>
<div id="outline-container-h:b2645e56-b056-43a8-bc14-699588ba34d8" class="outline-3">
<h3 id="h:b2645e56-b056-43a8-bc14-699588ba34d8">定义路径别名</h3>
<div class="outline-text-3" id="text-h:b2645e56-b056-43a8-bc14-699588ba34d8">
<p>
格式：
</p>

<div class="org-src-container">
<pre class="src src-sh">Alias /URL/  <span style="color: #8b2252;">"/PATH/"</span> 
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">DocumentRoot <span style="color: #8b2252;">"/www/htdocs"</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">http://www.ciciedu.com/download/bash.rpm ==&gt;/www/htdocs/download/bash.rpm
</span>Alias /download/  <span style="color: #8b2252;">"/rpms/pub/"</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">http://www.ciciedu.com/download/bash.rpm ==&gt;/rpms/pub/bash.rpm
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">http://www.ciciedu.com/images/logo.png ==&gt;/www/htdocs/images/logo.png</span>
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 html]#mkdir /data/newsdir
[root@centos8 html]#echo /data/newsdir/index.html &gt; /data/newsdir/index.html
[root@centos8 ~]#cat /etc/httpd/conf.d/test.conf
<span style="color: #483d8b;">alias</span> /news /data/html/newsdir/
&lt;directory /data/html/newsdir&gt;
require all granted
&lt;/directory&gt;
</pre>
</div>

<p>
效果如下图:
</p>


<figure id="org9265574">
<img src="./images/20200706225545780.png" alt="20200706225545780.png">

</figure>
</div>
</div>
<div id="outline-container-h:4d3b379a-e398-4a41-87e9-9e2de7a4995c" class="outline-3">
<h3 id="h:4d3b379a-e398-4a41-87e9-9e2de7a4995c">基于用户的访问控制</h3>
<div class="outline-text-3" id="text-h:4d3b379a-e398-4a41-87e9-9e2de7a4995c">
<p>
认证质询：WWW-Authenticate，响应码为401，拒绝客户端请求，并说明要求客户端需要提供账号和密码
</p>

<p>
认证：Authorization，客户端用户填入账号和密码后再次发送请求报文；认证通过时，则服务器发送响应的资源
</p>

<p>
认证方式两种：
</p>

<ul class="org-ul">
<li>basic：明文</li>
<li>digest：消息摘要认证,兼容性差</li>
</ul>

<p>
安全域：需要用户认证后方能访问的路径；应该通过名称对其进行标识，以便于告知用户认证的原因
</p>

<p>
用户的账号和密码
</p>

<p>
虚拟账号：仅用于访问某服务时用到的认证标识
</p>

<p>
存储：文本文件，SQL数据库，ldap目录存储，nis等
</p>

<p>
basic认证配置示例：
</p>

<p>
(1) 定义安全域
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;Directory <span style="color: #8b2252;">"/path"</span>&gt;
Options None
AllowOverride None
AuthType Basic
AuthName <span style="color: #8b2252;">"String"</span>
AuthUserFile  <span style="color: #8b2252;">"/PATH/HTTPD_USER_PASSWD_FILE"</span>
Require user username1 username2 ...
&lt;/Directory&gt; 
</pre>
</div>

<p>
允许账号文件中的所有用户登录访问：
</p>

<div class="org-src-container">
<pre class="src src-sh">Require valid-user
</pre>
</div>

<p>
(2) 提供账号和密码存储（文本文件）
</p>

<p>
使用专用命令完成此类文件的创建及用户管理
</p>

<div class="org-src-container">
<pre class="src src-sh">htpasswd [options] /PATH/HTTPD_PASSWD_FILE username

<span style="color: #b22222;">#</span><span style="color: #b22222;">apache&#29992;&#25143;&#38656;&#35201;&#26377;read&#26435;&#38480;
</span>setfacl -m u:apache:r /PATH/HTTPD_PASSWD_FILE
</pre>
</div>

<p>
选项：
</p>

<div class="org-src-container">
<pre class="src src-sh">-c &#33258;&#21160;&#21019;&#24314;&#25991;&#20214;&#65292;&#20165;&#24212;&#35813;&#22312;&#25991;&#20214;&#19981;&#23384;&#22312;&#26102;&#20351;&#29992;
-p &#26126;&#25991;&#23494;&#30721;
-d CRYPT&#26684;&#24335;&#21152;&#23494;&#65292;&#40664;&#35748;
-m md5&#26684;&#24335;&#21152;&#23494;  
-s sha&#26684;&#24335;&#21152;&#23494;
-D &#21024;&#38500;&#25351;&#23450;&#29992;&#25143;


htpasswd -b .passwd Jack 123456
&#21435;&#25481; -c &#36873;&#39033;&#65292;&#21363;&#21487;&#22312;&#31532;&#19968;&#20010;&#29992;&#25143;&#20043;&#21518;&#28155;&#21152;&#31532;&#20108;&#20010;&#29992;&#25143;&#65292;&#20381;&#27492;&#31867;&#25512;&#12290;
&#21033;&#29992; htpasswd &#21629;&#20196;&#20462;&#25913;&#23494;&#30721;
htpasswd -D .passwd Jack  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21024;&#38500;&#29992;&#25143;
</span>htpasswd -b .passwd Jack 123456
</pre>
</div>

<p>
<b>基于组账号进行认证</b>
</p>

<p>
(1) 定义安全域
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;Directory <span style="color: #8b2252;">"/path"</span>&gt;
AuthType Basic
AuthName <span style="color: #8b2252;">"String"</span>
AuthUserFile  <span style="color: #8b2252;">"/PATH/HTTPD_USER_PASSWD_FILE"</span>
AuthGroupFile <span style="color: #8b2252;">"/PATH/HTTPD_GROUP_FILE"</span>
Require group grpname1 grpname2 ...
&lt;/Directory&gt;
</pre>
</div>

<p>
范例：方法1
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 html]#mkdir admin
[root@centos8 html]#echo /var/www/html/admin/index.html &gt; admin/index.html

[root@centos8 ~]#cat /etc/httpd/conf.d/test.conf
&lt;directory /var/www/html/admin&gt;
AuthType Basic
AuthName <span style="color: #8b2252;">"Please input valid user and password"</span>
AuthUserFile  <span style="color: #8b2252;">"/etc/httpd/conf.d/.httpuser"</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">Require user xiaoming xiaohong    #&#25351;&#23450;&#29992;&#25143;&#25165;&#21487;&#20197;&#35775;&#38382;
</span>require valid-user
&lt;/directory&gt;

[root@centos8 ~]#htpasswd -c /etc/httpd/conf.d/.httpuser xiaoming
[root@centos8 ~]#htpasswd -c /etc/httpd/conf.d/.httpuser xiaohong
[root@centos8 ~]#cd /etc/httpd/conf.d
[root@centos8 conf.d]#cat .httpduser 
xiaoming:$<span style="color: #a0522d;">apr1</span>$<span style="color: #a0522d;">4</span>m8msymf$<span style="color: #a0522d;">Fa</span>.r4sSRz/nIhpZzxRx3J.
xiaohong:$<span style="color: #a0522d;">apr1</span>$<span style="color: #a0522d;">pPruVR2y</span>$<span style="color: #a0522d;">yKuN</span>.TkgMy2.tTAoc2YBA1

[root@centos8 conf.d]#pwd
/etc/httpd/conf.d
[root@centos8 conf.d]#ll -a
total 24
drwxr-xr-x 2 root root  121 Jun 25 14:57 .
drwxr-xr-x 5 root root  105 Jun 25 10:45 ..
-rw-r--r-- 1 root root 2926 Dec 24  2019 autoindex.conf
-rw-r--r-- 1 root root  236 Jun 25 14:59 .httpduser
-rw-r--r-- 1 root root  400 Dec 24  2019 README
-rw-r--r-- 1 root root  198 Jun 25 14:34 test.conf
-rw-r--r-- 1 root root 1252 Dec 24  2019 userdir.conf
-rw-r--r-- 1 root root  738 Dec 24  2019 welcome.conf.bak
[root@centos8 conf.d]#chmod 600 .httpduser 
[root@centos8 conf.d]#ll .httpduser
-rw------- 1 root root 236 Jun 25 14:59 .httpduser
[root@centos8 ~]#systemctl reload httpd
</pre>
</div>

<p>
浏览器访问 <a href="http://httpd服务器/admin">http://httpd服务器/admin</a> 可以看到以下显示
</p>

<p>
<img src="./images/20200706225605554.png" alt="20200706225605554.png">
<img src="./images/20200706225626880.png" alt="20200706225626880.png">
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">apache&#29992;&#25143;&#38656;&#35201;&#26377;&#35835;&#26435;&#38480;
</span>setfacl -m u:apache:r /etc/httpd/conf.d/.httpduser
</pre>
</div>

<p>
<img src="./images/20200706225638915.png" alt="20200706225638915.png">
<img src="./images/20200706225647297.png" alt="20200706225647297.png">
</p>

<p>
使用wireshark 抓包软件，可以看到明文密码
</p>


<figure id="org2ab15a6">
<img src="./images/20200706225700345.png" alt="20200706225700345.png">

</figure>

<p>
查看访问日志文件/var/logs/httpd/access_log，可以观察到以下内容
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 html]#tail -f /var/log/httpd/access_log
10.0.0.1 xiaoming <span style="color: #8b2252;">"2020-06-25 15:36:18"</span> 301 Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.106 Safari/537.36
10.0.0.1 xiaoming <span style="color: #8b2252;">"2020-06-25 15:36:18"</span> 200 Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.106 Safari/537.36
</pre>
</div>

<p>
范例：方法2
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#mkdir /var/www/html/secret
[root@centos8 ~]#echo /var/www/html/secret/index.html &gt;
/var/www/html/secret/index.html
[root@centos8 ~]#cd /var/www/html/secret/
[root@centos8 secret]#ls
index.html
[root@centos8 secret]#vim .htaccess
[root@centos8 ~]#cat /var/www/html/secret/.htaccess
AuthType Basic
AuthName <span style="color: #8b2252;">"FBI warning"</span>
AuthUserFile  <span style="color: #8b2252;">"/etc/httpd/conf.d/.httpuser"</span>
Require user xiaoming
[root@centos8 ~]#vim /etc/httpd/conf.d/test.conf
[root@centos8 ~]#cat /etc/httpd/conf.d/test.conf
&lt;directory /var/www/html/admin&gt;
AuthType Basic
AuthName <span style="color: #8b2252;">"FBI warning"</span>
AuthUserFile  <span style="color: #8b2252;">"/etc/httpd/conf.d/.httpuser"</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">Require user xiaoming xiaohong
</span>require valid-user
&lt;/directory&gt;

&lt;directory /var/www/html/secret&gt;
allowoverride authconfig
&lt;/directory&gt;

[root@centos8 ~]#systemctl reload httpd
</pre>
</div>

<p>
(2) 创建用户账号和组账号文件
</p>

<p>
组文件：每一行定义一个组
</p>

<div class="org-src-container">
<pre class="src src-sh">GRP_NAME: username1 username2 ...
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;Directory <span style="color: #8b2252;">"/www/htdocs/admin"</span>&gt;
Options None
AllowOverride None
AuthType Basic
AuthName <span style="color: #8b2252;">"Administator private"</span>
AuthUserFile <span style="color: #8b2252;">"/etc/httpd/conf.d/.htpasswd"</span>
AuthGroupFile <span style="color: #8b2252;">"/etc/httpd/conf.d/.htgroup"</span>
Require group webadmins
&lt;/Directory&gt;

vim /etc/httpd/conf.d/.htgroup
webadmins:wang cici
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /var/www/html/secret/.htaccess
AuthType Basic
AuthName <span style="color: #8b2252;">"FBI warning"</span>
AuthUserFile  <span style="color: #8b2252;">"/etc/httpd/conf.d/.httpuser"</span>
AuthGroupFile <span style="color: #8b2252;">"/etc/httpd/conf.d/.httpgroup"</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">Require user xiaoming
</span>Require group webadmins

[root@centos8 ~]#cat /etc/httpd/conf.d/.httpgroup
webadmins: xiaoming xiaobai

[root@centos8 ~]#cat /etc/httpd/conf.d/test.conf
&lt;directory /var/www/html/admin&gt;
AuthType Basic
AuthName <span style="color: #8b2252;">"FBI warning"</span>
AuthUserFile  <span style="color: #8b2252;">"/etc/httpd/conf.d/.httpuser"</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">Require user xiaoming xiaohong
</span>require valid-user
&lt;/directory&gt;

&lt;directory /var/www/html/secret&gt;
allowoverride authconfig
&lt;/directory&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ce8d6f44-77c3-4297-8406-e8c8aaa2c53e" class="outline-3">
<h3 id="h:ce8d6f44-77c3-4297-8406-e8c8aaa2c53e">远程客户端和用户验证的控制</h3>
<div class="outline-text-3" id="text-h:ce8d6f44-77c3-4297-8406-e8c8aaa2c53e">
<div class="org-src-container">
<pre class="src src-sh">Satisfy ALL|Any
</pre>
</div>

<p>
说明：
</p>

<p>
ALL 客户机IP和用户验证都需要通过才可以，此为默认值
</p>

<p>
Any 客户机IP和用户验证,有一个满足即可
</p>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#38024;&#23545;/var/www/html/test&#30446;&#24405;&#65292;&#26469;&#33258;192.168.1.0/24&#30340;&#23458;&#25143;&#21487;&#20197;&#35775;&#38382;&#65292;&#20854;&#23427;&#32593;&#32476;&#30340;&#29992;&#25143;&#38656;&#35201;&#32463;&#36807;&#29992;&#25143;&#39564;&#35777;&#25165;&#33021;&#35775;&#38382;
</span>&lt;Directory <span style="color: #8b2252;">"/var/www/html/test"</span>&gt;
Require valid-user
Allow from 192.168.1
Satisfy Any
&lt;/Directory&gt;

<span style="color: #b22222;">#</span><span style="color: #b22222;">/var/www/private&#30446;&#24405;&#21482;&#26377;&#29992;&#25143;&#39564;&#35777;&#25165;&#33021;&#35775;&#38382;
</span>&lt;Directory <span style="color: #8b2252;">"/var/www/private"</span>&gt;
   Require valid-user
&lt;/Directory&gt;

<span style="color: #b22222;">#</span><span style="color: #b22222;">/var/www/private/public &#19981;&#38656;&#35201;&#29992;&#25143;&#39564;&#35777;&#65292;&#20219;&#20309;&#23458;&#25143;&#37117;&#21487;&#20197;&#35775;&#38382;
</span>&lt;Directory <span style="color: #8b2252;">"/var/www/private/public"</span>&gt;
   Allow from all
   Satisfy Any
&lt;/Directory&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:0c0c1ed0-1cdc-4834-8393-d40b931a770d" class="outline-3">
<h3 id="h:0c0c1ed0-1cdc-4834-8393-d40b931a770d">实现用户家目录的http共享</h3>
<div class="outline-text-3" id="text-h:0c0c1ed0-1cdc-4834-8393-d40b931a770d">
<p>
基于模块 mod_userdir.so 实现
</p>

<p>
相关设置：
</p>

<div class="org-src-container">
<pre class="src src-sh">vim /etc/httpd/conf.d/userdir.conf
&lt;IfModule mod_userdir.c&gt;
   <span style="color: #b22222;">#</span><span style="color: #b22222;">UserDir disabled     #&#23558;&#27492;&#34892;&#27880;&#37322;
</span>   UserDir public_html   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#27492;&#34892;&#27880;&#37322;&#21462;&#28040;,&#25351;&#23450;&#20849;&#20139;&#30446;&#24405;&#30340;&#21517;&#31216;
</span>&lt;/IfModule&gt;
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;&#30446;&#24405;
</span>su &#8211; wang;
mkdir ~/public_html
setfacl &#8211;m u:apache:x ~wang
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35775;&#38382;
</span>http://localhost/~wang/index.html
</pre>
</div>

<p>
范例：对家目录共享
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#su - wang
[wang@centos8 ~]$<span style="color: #a0522d;">mkdir</span> html
[wang@centos8 ~]$<span style="color: #a0522d;">echo</span> /home/wang/html/index.html &gt; html/index.html
[wang@centos8 ~]$<span style="color: #a0522d;">setfacl</span> -m u:apache:x /home/wang
[root@centos8 ~]#vim /etc/httpd/conf.d/userdir.conf
[root@centos8 ~]#grep -v <span style="color: #8b2252;">'^ *#'</span> /etc/httpd/conf.d/userdir.conf
&lt;IfModule mod_userdir.c&gt;
   UserDir html
&lt;/IfModule&gt;
&lt;directory /home/wang/html&gt;
require all granted 
&lt;/directory&gt;

&#27983;&#35272;&#22120;&#35775;&#38382;
http://localhost/~wang/
</pre>
</div>

<p>
范例：对家目录共享并实现basic验证
</p>

<div class="org-src-container">
<pre class="src src-sh">Vi /etc/httpd/conf.d/userdir.conf   centos7
&lt;IfModule mod_userdir.c&gt;
    <span style="color: #b22222;">#</span><span style="color: #b22222;">UserDir disabled
</span>    UserDir public_html
&lt;/IfModule&gt;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27880;&#37322;&#19979;&#38754;&#20960;&#34892;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;Directory "/home/*/public_html"&gt;
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">AllowOverride FileInfo AuthConfig Limit Indexes
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">Require method GET POST OPTIONS
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;/Directory&gt;
</span>
Vi /etc/httpd/conf.d/userdir.conf  
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21152;&#19979;&#38754;&#20960;&#34892;&#65292;&#23454;&#29616;&#21311;&#21517;&#35775;&#38382;
</span>&lt;Directory <span style="color: #8b2252;">"/home/test/public_html"</span>&gt;
Require all granted
&lt;/Directory&gt;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;&#30446;&#24405;&#21644;&#32593;&#39029;&#25991;&#20214;
</span>su &#8211; test
mkdir ~/public_html
<span style="color: #483d8b;">echo</span> testhomewebsite &gt; ~/public_html/index.html
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21152;&#26435;&#38480;&#25165;&#25104;&#21151;
</span>setfacl &#8211;m u:apache:x ~test

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35775;&#38382;
</span>http://localhost/~test/index.html

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500;&#19978;&#38754;&#34892;&#65292;&#22686;&#21152;&#19979;&#38754;&#34892;&#23454;&#29616;&#35748;&#35777;&#21151;&#33021;
</span>Vi /etc/httpd/conf.d/userdir.conf
&lt;directory /home/test/public_html&gt;
AuthType Basic
AuthName <span style="color: #8b2252;">"test home"</span>
AuthUserFile <span style="color: #8b2252;">"/etc/httpd/conf.d/htuser"</span>
require user http1
&lt;/directory&gt;
Systemctl restart httpd

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26032;&#24314;&#23494;&#30721;&#25991;&#20214;
</span>htpasswd -c -m /etc/httpd/conf/.htpasswd test  

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20877;&#27425;&#35775;&#38382;
</span>http://localhost/~test/index.html
</pre>
</div>
</div>
</div>
<div id="outline-container-h:3e7b515c-008d-469d-bdf3-3db082e11e8c" class="outline-3">
<h3 id="h:3e7b515c-008d-469d-bdf3-3db082e11e8c">隐藏服务器版本信息</h3>
<div class="outline-text-3" id="text-h:3e7b515c-008d-469d-bdf3-3db082e11e8c">
<div class="org-src-container">
<pre class="src src-b">ServerTokens Major|Minor|Min[imal]|Prod[uctOnly]|OS|Full
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">ServerTokens Prod[uctOnly] &#65306;Server: Apache
ServerTokens Major: Server: Apache/2
ServerTokens Minor: Server: Apache/2.0
ServerTokens Min[imal]: Server: Apache/2.0.41
ServerTokens OS: Server: Apache/2.0.41 (Unix)
ServerTokens Full (or not specified): Server: Apache/2.0.41 (Unix) PHP/4.2.2 MyMod/1.2
</pre>
</div>

<p>
建议使用：ServerTokens Prod
</p>

<p>
<b>禁止错误网页版本泄露</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">ServerSignature On | Off | EMail 
</pre>
</div>

<p>
默认值Off，如果ServerTokens
使用默认值,并且ServerSignature选项为on，当客户请求的网页并不存在时，服务器将产生错误文档，错误文档的最后一行将包含服务器名字、Apache版本等信息，如果不对外显示这些信息，就可将这个参数设置为Off,
如果设置为Email，将显示ServerAdmin 的Email提示
</p>

<div class="org-src-container">
<pre class="src src-sh">ServerSignature on
</pre>
</div>


<figure id="org9f6e108">
<img src="./images/20200706225745221.png" alt="20200706225745221.png">

</figure>
</div>
</div>
<div id="outline-container-h:eac581b8-d4b0-4730-be26-a28711cb4aa3" class="outline-3">
<h3 id="h:eac581b8-d4b0-4730-be26-a28711cb4aa3">禁止trace方法</h3>
<div class="outline-text-3" id="text-h:eac581b8-d4b0-4730-be26-a28711cb4aa3">
<div class="org-src-container">
<pre class="src src-sh">TraceEnable [on|off|extended]
</pre>
</div>

<p>
默认on，基于安全风险，建议关闭
</p>

<p>
范例：关闭 trace方法
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#curl -IX OPTIONS http://www.apache.org
HTTP/1.1 200 OK
Date: Wed, 24 Jun 2020 06:02:45 GMT
Server: Apache/2.4.18 (Ubuntu)
Allow: GET,HEAD,POST,OPTIONS
Cache-Control: max-age=3600
Expires: Wed, 24 Jun 2020 07:02:45 GMT
Content-Length: 0
Content-Type: text/html

[root@centos8 ~]#curl -IX OPTIONS http://127.0.0.1
HTTP/1.1 200 OK
Date: Wed, 24 Jun 2020 06:04:45 GMT
Server: Apache/2.4.37 (centos)
Allow: POST,OPTIONS,HEAD,GET,TRACE
Content-Length: 0
Content-Type: httpd/unix-directory

[root@centos8 ~]#vim /etc/httpd/conf.d/test.conf
TraceEnable off

[root@centos8 ~]#curl -IX OPTIONS http://127.0.0.1
HTTP/1.1 200 OK
Date: Tue, 10 Dec 2019 04:09:41 GMT
Server: Apache/2.4.37 (centos)
Allow: GET,POST,OPTIONS,HEAD
Content-Length: 0
Content-Type: text/html; <span style="color: #a0522d;">charset</span>=UTF-8
</pre>
</div>
</div>
</div>
<div id="outline-container-h:573952f1-f000-431e-a2cb-8be4d692eb19" class="outline-3">
<h3 id="h:573952f1-f000-431e-a2cb-8be4d692eb19">status 状态页</h3>
<div class="outline-text-3" id="text-h:573952f1-f000-431e-a2cb-8be4d692eb19">
<p>
httpd
提供了状态页，可以用来观察httpd的运行情况。此功能需要加载mod_status.so模块才能实现
</p>

<div class="org-src-container">
<pre class="src src-sh">LoadModule status_module modules/mod_status.so
&lt;Location <span style="color: #8b2252;">"/status"</span>&gt;
SetHandler server-status
&lt;/Location&gt;
ExtendedStatus On   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#25193;&#23637;&#20449;&#24687;,httpd 2.3.6&#20197;&#21518;&#29256;&#40664;&#35748;&#20026;On</span>
</pre>
</div>

<p>
范例：启动状态页
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#30830;&#35748;&#21152;&#36733;mod_status.so&#27169;&#22359;
</span>[root@centos8 conf.d]#httpd -M |grep status
<span style="color: #0000ff;">status_module</span> (shared)
[root@centos8 ~]#vim /etc/httpd/conf.d/status.conf
&lt;Location <span style="color: #8b2252;">"/status"</span>&gt;
   SetHandler server-status  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38024;&#23545;status&#30446;&#24405;&#24320;&#21551;&#29366;&#24577;&#39029;&#38754;
</span>   &lt;RequireAny&gt;
   Require all denied
   require ip  172.16.1.1  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20801;&#35768;&#29305;&#23450;IP
</span>   &lt;/RequireAny&gt;
   <span style="color: #b22222;">#</span><span style="color: #b22222;">Order Deny,Allow   &#27492;&#26041;&#24335;&#20063;&#21487;&#20197;&#25511;&#21046;&#35775;&#38382;
</span>   <span style="color: #b22222;">#</span><span style="color: #b22222;">Deny from all
</span>   <span style="color: #b22222;">#</span><span style="color: #b22222;">Allow from 192.168.100
</span>&lt;/Location&gt;
ExtendedStatus Off  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26159;&#21542;&#35814;&#32454;&#30340;&#20449;&#24687;,&#40664;&#35748;&#20540;&#20026;on
</span>
[root@centos8 ~]#systemctl restart httpd
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#24320;&#27983;&#35272;&#22120;&#35775;&#38382;http://httpd&#26381;&#21153;&#22120;IP/status&#21487;&#20197;&#21442;&#30475;&#21040;&#20197;&#19979;&#39029;&#38754;</span>
</pre>
</div>


<figure id="org67c562c">
<img src="./images/20200706225815316.png" alt="20200706225815316.png">

</figure>
</div>
</div>
<div id="outline-container-h:62ee18f5-4552-4edd-9224-b0d96fd66bd2" class="outline-3">
<h3 id="h:62ee18f5-4552-4edd-9224-b0d96fd66bd2">多虚拟主机</h3>
<div class="outline-text-3" id="text-h:62ee18f5-4552-4edd-9224-b0d96fd66bd2">
<p>
httpd 支持在一台物理主机上实现多个网站，即多虚拟主机
</p>

<p>
网站的唯一标识：
</p>

<ul class="org-ul">
<li>IP相同，但端口不同</li>
<li>IP不同，但端口均为默认端口</li>
<li>FQDN不同, IP和端口都相同</li>
</ul>

<p>
多虚拟主机有三种实现方案：
</p>

<ul class="org-ul">
<li>基于ip：为每个虚拟主机准备至少一个ip地址</li>
<li>基于port：为每个虚拟主机使用至少一个独立的port</li>
<li>基于FQDN：为每个虚拟主机使用至少一个FQDN，请求报文中首部 Host:
www.ciciedu.com</li>
</ul>

<p>
注意：httpd 2.4版本中，基于FQDN的虚拟主机不再需要NameVirutalHost指令
</p>

<p>
虚拟主机的基本配置方法：
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;VirtualHost IP:PORT&gt;
ServerName FQDN
DocumentRoot  <span style="color: #8b2252;">"/path"</span>
&lt;/VirtualHost&gt;
</pre>
</div>

<p>
建议：上述配置存放在独立的配置文件中
</p>

<p>
其它常用可用指令：
</p>

<div class="org-src-container">
<pre class="src src-sh">ServerAlias&#65306;&#34394;&#25311;&#20027;&#26426;&#30340;&#21035;&#21517;&#65307;&#21487;&#22810;&#27425;&#20351;&#29992;
ErrorLog&#65306; &#38169;&#35823;&#26085;&#24535;
CustomLog&#65306;&#35775;&#38382;&#26085;&#24535;
&lt;Directory <span style="color: #8b2252;">"/path"</span>&gt; &lt;/Directory&gt;
</pre>
</div>

<p>
范例：基于端口的虚拟主机
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#echo /data/website1/index.html &gt; /data/website1/index.html
[root@centos8 ~]#echo /data/website2/index.html &gt; /data/website2/index.html
[root@centos8 ~]#echo /data/website3/index.html &gt; /data/website3/index.html

[root@centos8 ~]#cat /etc/httpd/conf.d/test.conf
listen 81
listen 82
listen 83
&lt;virtualhost *:81&gt;
documentroot /data/website1/
CustomLog logs/website1_access.log combined
&lt;directory /data/website1&gt;
require all granted
&lt;/directory&gt;
&lt;/virtualhost&gt;

&lt;virtualhost *:82&gt;
documentroot /data/website2/
CustomLog logs/website2_access.log combined
&lt;directory /data/website2&gt;
require all granted
&lt;/directory&gt;
&lt;/virtualhost&gt;

&lt;virtualhost *:83&gt;
documentroot /data/website3/
CustomLog logs/website3_access.log combined
&lt;directory /data/website3&gt;
require all granted
&lt;/directory&gt;
&lt;/virtualhost&gt;

[root@centos8 ~]#ll /var/log/httpd/
total 44
-rw-r--r-- 1 root root 10679 Dec 10 12:00 access_log
-rw-r--r-- 1 root root 18883 Dec 10 11:59 error_log
-rw-r--r-- 1 root root  1969 Dec 10 12:00 website1_access.log
-rw-r--r-- 1 root root   482 Dec 10 12:00 website2_access.log
-rw-r--r-- 1 root root   482 Dec 10 12:00 website3_access.log

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27983;&#35272;&#22120;&#35775;&#38382;&#19981;&#21516;&#31471;&#21475;&#65292;&#24471;&#21040;&#19981;&#21516;&#30340;&#39029;&#38754;
</span>http://10.0.0.8:81/
http://10.0.0.8:82/
http://10.0.0.8:83/
</pre>
</div>


<figure id="orge40d024">
<img src="./images/20200706225907490.png" alt="20200706225907490.png">

</figure>


<figure id="orgcd92fb2">
<img src="./images/20200706225918238.png" alt="20200706225918238.png">

</figure>


<figure id="orgc62c13c">
<img src="./images/20200706225935875.png" alt="20200706225935875.png">

</figure>

<p>
范例：基于IP的虚拟主机
</p>

<p>
说明:这样做的话需要在互联网上申请三个公网ip
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#ip a a 10.0.0.8/24 dev eth0 label eth0:1
[root@centos8 ~]#ip a a 10.0.0.18/24 dev eth0 label eth0:2
[root@centos8 ~]#ip a a 10.0.0.28/24 dev eth0 label eth0:3
[root@centos8 ~]#ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
   link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
   inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
   inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
   link/ether 00:0c:29:f9:8d:90 brd ff:ff:ff:ff:ff:ff
   inet 192.168.39.8/24 brd 192.168.39.255 scope global noprefixroute eth0
       valid_lft forever preferred_lft forever
   inet 10.0.0.8/24 scope global eth0
       valid_lft forever preferred_lft forever
   inet 10.0.0.18/24 scope global secondary eth0
       valid_lft forever preferred_lft forever
   inet 10.0.0.28/24 scope global secondary eth0
       valid_lft forever preferred_lft forever
   inet6 fe80::20c:29ff:fef9:8d90/64 scope link
       valid_lft forever preferred_lft forever

[root@centos8 ~]#vim /etc/httpd/conf.d/test.conf
[root@centos8 ~]#cat /etc/httpd/conf.d/test.conf
&lt;virtualhost 10.0.0.8:80&gt;
documentroot /data/website1/
CustomLog logs/website1_access.log combined
&lt;directory /data/website1&gt;
require all granted
&lt;/directory&gt;
&lt;/virtualhost&gt;

&lt;virtualhost 10.0.0.18:80&gt;
documentroot /data/website2/
CustomLog logs/website2_access.log combined
&lt;directory /data/website2&gt;
require all granted
&lt;/directory&gt;
&lt;/virtualhost&gt;

&lt;virtualhost 10.0.0.28:80&gt;
documentroot /data/website3/
CustomLog logs/website3_access.log combined
&lt;directory /data/website3&gt;
require all granted
&lt;/directory&gt;
&lt;/virtualhost&gt;
[root@centos8 ~]#httpd -t
Syntax OK
[root@centos8 ~]#systemctl reload httpd
[root@centos8 ~]#curl 10.0.0.8
/data/website1/index.html
[root@centos8 ~]#curl 10.0.0.18
/data/website2/index.html
[root@centos8 ~]#curl 10.0.0.28
/data/website3/index.html
</pre>
</div>

<p>
范例：基于FQDN(主机头)虚拟主机
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;VirtualHost *:80&gt;
ServerName www.a.com
DocumentRoot <span style="color: #8b2252;">"/www/a.com/htdocs"</span>
&lt;Directory <span style="color: #8b2252;">"/www/a.com/htdocs"</span>&gt;
ErrorLog <span style="color: #8b2252;">"logs/a_error_log"</span>
CustomLog <span style="color: #8b2252;">"logs/a_access_log"</span> combined
Options None
AllowOverride None
Require all granted
&lt;/Directory&gt;
&lt;/VirtualHost&gt;

&lt;VirtualHost *:80&gt;
ServerName www.b.net
DocumentRoot <span style="color: #8b2252;">"/www/b.net/htdocs"</span>
&lt;Directory <span style="color: #8b2252;">"/www/b.net/htdocs"</span>&gt;
ErrorLog <span style="color: #8b2252;">"logs/b_error_log"</span>
CustomLog <span style="color: #8b2252;">"logs/b_access_log"</span> combined
Options None
AllowOverride None
Require all granted
&lt;/Directory&gt;
&lt;/VirtualHost&gt;

&lt;VirtualHost *:80&gt;
ServerName www.c.org
DocumentRoot <span style="color: #8b2252;">"/www/c.org/htdocs"</span>
&lt;Directory <span style="color: #8b2252;">"/www/c.org/htdocs"</span>&gt;
errorLog <span style="color: #8b2252;">"logs/c_error_log"</span>
CustomLog <span style="color: #8b2252;">"logs/c_access_log"</span> combined
Options None
AllowOverride None
Require all granted
&lt;/Directory&gt;
&lt;/VirtualHost&gt; 
</pre>
</div>

<p>
注意：
</p>

<ul class="org-ul">
<li>任意目录下的页面只有显式授权才能被访问</li>
<li>三种方式的虚拟主机可以混和使用</li>
</ul>
</div>
</div>
<div id="outline-container-h:7d45a0b3-d269-413b-a6b0-9b89a23b2a1a" class="outline-3">
<h3 id="h:7d45a0b3-d269-413b-a6b0-9b89a23b2a1a">压缩</h3>
<div class="outline-text-3" id="text-h:7d45a0b3-d269-413b-a6b0-9b89a23b2a1a">
<p>
使用mod_deflate模块压缩页面优化传输速度
</p>

<div class="org-src-container">
<pre class="src src-sh">LoadModule deflate_module modules/mod_deflate.so SetOutputFilter 
</pre>
</div>

<p>
适用场景：
</p>

<p>
(1) 节约带宽，额外消耗CPU；同时，可能有些较老浏览器不支持
</p>

<p>
(2) 压缩适于压缩的资源，例如文本文件
</p>

<p>
压缩指令
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#36873;&#39033;
</span>SetOutputFilter DEFLATE  

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25351;&#23450;&#23545;&#21738;&#31181;MIME&#31867;&#22411;&#36827;&#34892;&#21387;&#32553;&#65292;&#24517;&#39035;&#25351;&#23450;&#39033;
</span>AddOutputFilterByType DEFLATE text/plain
AddOutputFilterByType DEFLATE text/html
AddOutputFilterByType DEFLATE application/xhtml+xml
AddOutputFilterByType DEFLATE text/xml
AddOutputFilterByType DEFLATE application/xml
AddOutputFilterByType DEFLATE application/x-javascript
AddOutputFilterByType DEFLATE text/javascript
AddOutputFilterByType DEFLATE text/css

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21387;&#32553;&#32423;&#21035; (Highest 9 - Lowest 1)
</span>DeflateCompressionLevel 9
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25490;&#38500;&#29305;&#23450;&#26087;&#29256;&#26412;&#30340;&#27983;&#35272;&#22120;&#65292;&#19981;&#25903;&#25345;&#21387;&#32553;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">Netscape 4.x &#21482;&#21387;&#32553;text/html
</span>BrowserMatch ^Mozilla/4 gzip-only-text/html
<span style="color: #b22222;">#</span><span style="color: #b22222;">Netscape 4.06-08 &#19977;&#20010;&#29256;&#26412; &#19981;&#21387;&#32553;
</span>BrowserMatch ^Mozilla/4<span style="color: #8b2252;">\.</span>0[678] no-gzip
<span style="color: #b22222;">#</span><span style="color: #b22222;">Internet Explorer&#26631;&#35782;&#26412;&#36523;&#20026;"Mozilla / 4&#8221;&#65292;&#20294;&#23454;&#38469;&#19978;&#26159;&#33021;&#22815;&#22788;&#29702;&#35831;&#27714;&#30340;&#21387;&#32553;&#12290;&#22914;&#26524;&#29992;&#25143;&#20195;&#29702;&#39318;&#37096;&#21305;&#37197;&#23383;&#31526;&#20018;"MSIE&#8221;&#65288;"B&#8221;&#20026;&#21333;&#35789;&#36793;&#30028;&#8221;&#65289;&#65292;&#23601;&#20851;&#38381;&#20043;&#21069;&#23450;&#20041;&#30340;&#38480;&#21046;
</span>BrowserMatch \bMSI[E] !no-gzip !gzip-only-text/html
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ba8057c3-c081-43ca-a24f-c8b67f4af505" class="outline-3">
<h3 id="h:ba8057c3-c081-43ca-a24f-c8b67f4af505">实现 https</h3>
<div class="outline-text-3" id="text-h:ba8057c3-c081-43ca-a24f-c8b67f4af505">
<p>
https：http over ssl ,实现验证和加密功能
</p>
</div>
<div id="outline-container-h:009c8364-fd59-4ef5-9155-bea6d473692c" class="outline-4">
<h4 id="h:009c8364-fd59-4ef5-9155-bea6d473692c">HTTPS 会话的简化过程</h4>
<div class="outline-text-4" id="text-h:009c8364-fd59-4ef5-9155-bea6d473692c">

<figure id="orgb754641">
<img src="./images/20200706225952921.png" alt="20200706225952921.png">

</figure>

<ol class="org-ol">
<li>客户端发送可供选择的加密方式，并向服务器请求证书</li>

<li>服务器端发送证书以及选定的加密方式给客户端</li>

<li><p>
客户端取得证书并进行证书验证，如果信任给其发证书的CA
</p>

<p>
(a) 验证证书来源的合法性；用CA的公钥解密证书上数字签名
</p>

<p>
(b) 验证证书的内容的合法性：完整性验证
</p>

<p>
(c) 检查证书的有效期限
</p>

<p>
(d) 检查证书是否被吊销
</p>

<p>
(e) 证书中拥有者的名字，与访问的目标主机要一致
</p></li>

<li>客户端生成临时会话密钥（对称密钥），并使用服务器端的公钥加密此数据发送给服务器，完成密钥交换</li>

<li>服务用此密钥加密用户请求的资源，响应给客户端</li>
</ol>

<p>
注意：SSL是基于IP地址实现,单IP的httpd主机，仅可以使用一个https虚拟主机
</p>
</div>
</div>
<div id="outline-container-h:ce2a590c-b359-434b-9333-d762c4065da6" class="outline-4">
<h4 id="h:ce2a590c-b359-434b-9333-d762c4065da6">apache实现https过程</h4>
<div class="outline-text-4" id="text-h:ce2a590c-b359-434b-9333-d762c4065da6">
<ol class="org-ol">
<li><p>
为服务器申请数字证书
</p>

<p>
可以通过私建CA颁发证书实现
</p>

<p>
(a) 创建私有CA
</p>

<p>
(b) 在服务器创建证书签署请求
</p>

<p>
(c) CA签证
</p></li>

<li><p>
配置httpd支持使用ssl，及使用的证书
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;mod_ssl&#21253;
</span>yum -y install mod_ssl
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#23545;&#24212;&#30340;&#37197;&#32622;&#25991;&#20214;&#65306;/etc/httpd/conf.d/ssl.conf
</span>DocumentRoot
ServerName
SSLCertificateFile   /path/file
SSLCertificateKeyFile /path/file
SSLCACertificateFile /path/file
</pre>
</div></li>

<li><p>
测试基于https访问相应的主机
</p>

<div class="org-src-container">
<pre class="src src-sh">openssl s_client [-connect host:port] [-cert filename] [-CApath directory] [-CAfile filename]
</pre>
</div></li>
</ol>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ssl]#openssl s_client -connect www.cicin.com:443 -CAfile 3395645_cicin.com_chain.crt
</pre>
</div>
</div>
</div>
<div id="outline-container-h:49d94901-d418-4707-a7fe-4fc417e88f7d" class="outline-4">
<h4 id="h:49d94901-d418-4707-a7fe-4fc417e88f7d">实现https 实战案例</h4>
<div class="outline-text-4" id="text-h:49d94901-d418-4707-a7fe-4fc417e88f7d">
<p>
<b>3.25.3.1 范例1：生成自签名证书</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#yum -y install   mod_ssl
[root@centos7 ~]#cd /etc/pki/tls/certs
[root@centos7 certs]#pwd
/etc/pki/tls/certs
[root@centos7 certs]#ls
ca-bundle.crt ca-bundle.trust.crt make-dummy-cert Makefile renew-dummy-cert

[root@centos7 certs]#vim Makefile
<span style="color: #b22222;">#</span><span style="color: #b22222;">/usr/bin/openssl genrsa -aes128 $(KEYLEN) &gt; $@
</span>/usr/bin/openssl genrsa  $(KEYLEN) &gt; $<span style="color: #a0522d;">@</span>    
[root@centos7 certs]#make ciciedu.org
make: *** No rule to make target <span style="color: #8b2252;">'ciciedu.org'</span>. Stop.
[root@centos7 certs]#make ciciedu.org.crt
<span style="color: #483d8b;">umask</span> 77 ; <span style="color: #8b2252;">\</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">/usr/bin/openssl genrsa -aes128 2048 &gt; ciciedu.org.key
</span>/usr/bin/openssl genrsa  2048 &gt; ciciedu.org.key
Generating RSA private key, 2048 bit long modulus
......................+++
...+++
e is 65537 (0x10001)
<span style="color: #483d8b;">umask</span> 77 ; <span style="color: #8b2252;">\</span>
/usr/bin/openssl req -utf8 -new -key ciciedu.org.key -x509 -days 365 -out
ciciedu.org.crt
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter <span style="color: #8b2252;">'.'</span>, the field will be left blank.
-----
Country Name (2 letter code) [XX]:CN
State or Province Name (full name) []:beijing
Locality Name (eg, city) [Default City]:beijing
Organization Name (eg, company) [Default Company Ltd]:ciciedu
Organizational Unit Name (eg, section) []:devops
Common Name (eg, your name or your server<span style="color: #8b2252;">'s hostname) []:www.ciciedu.org
Email Address []:
[root@centos7 certs]#ls
ca-bundle.crt ca-bundle.trust.crt ciciedu.org.crt ciciedu.org.key make-dummycert Makefile renew-dummy-cert

[root@Centos7 ~]#mkdir /etc/httpd/conf.d/ssl
[root@Centos7 ~]#ll /etc/httpd/conf.d/ssl
total 16
-rw-r--r-- 1 root root 1143 Jun 25 23:40 cacert.pem
-rw-r--r-- 1 root root 1078 Jun 25 23:40 www.b.com.crt
-rw-r--r-- 1 root root  976 Jun 25 23:40 www.b.com.csr
-rw------- 1 root root 1708 Jun 25 23:40 www.b.com.key
[root@Centos7 ~]#vim /etc/httpd/conf.d/ssl.conf 
[root@Centos7 ~]#systemctl restart httpd
[root@Centos7 ~]#echo centos7 &gt; /var/www/html/index.html</span>
</pre>
</div>


<figure id="orgebfc2a7">
<img src="./images/20200706230010343.png" alt="20200706230010343.png">

</figure>

<p>
<b>3.25.3.2 范例2：互联网网站证书实现</b> (待补充)
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#dnf -y install   mod_ssl
[root@centos8 ~]#ll /etc/httpd/conf.d/ssl/
total 24
-rw-r--r-- 1 root root 1679 Dec 10  2019 www.cicin.com_chain.crt
-rw-r--r-- 1 root root 1675 Dec 10  2019 www.cicin.com.key
-rw-r--r-- 1 root root 2021 Dec 10  2019 www.cicin.com_public.crt

[root@centos8 ~]#cd /etc/httpd/conf.d/ssl/
[root@centos8 ssl]#openssl x509 -in www.cicin.com_public.crt -noout -text


[root@centos8 ~]#grep -Ev <span style="color: #8b2252;">"^ *#|^$"</span> /etc/httpd/conf.d/ssl.conf 

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:c5d37e07-df5b-4fcc-820d-fcec736c7377" class="outline-3">
<h3 id="h:c5d37e07-df5b-4fcc-820d-fcec736c7377">URL重定向</h3>
<div class="outline-text-3" id="text-h:c5d37e07-df5b-4fcc-820d-fcec736c7377">
<p>
URL重定向，即将httpd 请求的URL转发至另一个的URL
</p>

<p>
重定向指令
</p>

<div class="org-src-container">
<pre class="src src-sh">Redirect [status] URL-path URL
</pre>
</div>

<p>
*status状态*：
</p>

<ul class="org-ul">
<li>permanent： 返回永久重定向状态码 301,浏览器会将 此重定向信息进行缓存</li>
<li>temp：返回临时重定向状态码302. 此为默认值</li>
</ul>

<p>
说明:
</p>

<p>
服务器返回301或者302的值是公司的一种策略,并不是强制约定
</p>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#vim /etc/httpd/conf.d/test.conf
Redirect permanent / https://www.ciciedu.com/
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#vim /etc/httpd/conf.d/test.conf
Redirect permanent / http://www.b.com/ 
</pre>
</div>

<p>
<img src="./images/20200706230049112.png" alt="20200706230049112.png">
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#vim /etc/httpd/conf.d/test.conf
Redirect temp / http://www.b.com/ 
</pre>
</div>


<figure id="orgb3b27bb">
<img src="./images/20200706230102315.png" alt="20200706230102315.png">

</figure>

<div class="org-src-container">
<pre class="src src-sh">Redirect permanent / https://www.a.com/ 
</pre>
</div>


<figure id="org9f0d5cf">
<img src="./images/20200706230114368.png" alt="20200706230114368.png">

</figure>

<div class="org-src-container">
<pre class="src src-sh">RewriteEngine on
RewriteRule ^(/.*)$ https://%{HTTP_HOST}$<span style="color: #a0522d;">1</span> [<span style="color: #a0522d;">redirect</span>=302]
</pre>
</div>

<p>
<img src="./images/20200706230123141.png" alt="20200706230123141.png">
实验 :
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@Centos7 ~]#curl -I http://www.jd.com/
HTTP/1.1 302 Moved Temporarily
Server: nginx
Date: Fri, 26 Jun 2020 02:10:04 GMT
Content-Type: text/html
Content-Length: 138
Connection: keep-alive
Location: https://www.jd.com/
Access-Control-Allow-Origin: *
Timing-Allow-Origin: *
X-Trace: 302-1593137404905-0-0-0-0-0
Strict-Transport-Security: max-age=360

[root@Centos7 ~]#curl -I http://www.taobao.com/
HTTP/1.1 301 Moved Permanently
Server: Tengine
Date: Fri, 26 Jun 2020 02:10:18 GMT
Content-Type: text/html
Content-Length: 278
Connection: keep-alive
Location: https://www.taobao.com/
Via: cache19.cn2588[,0]
Timing-Allow-Origin: *
EagleId: 6fa02c9515931374188153124e
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d229e1a3-f5e1-45ae-a3f8-28d3eb41dcd2" class="outline-3">
<h3 id="h:d229e1a3-f5e1-45ae-a3f8-28d3eb41dcd2">实现HSTS</h3>
<div class="outline-text-3" id="text-h:d229e1a3-f5e1-45ae-a3f8-28d3eb41dcd2">
<p>
HSTS:HTTP Strict Transport Security ,
服务器端配置支持HSTS后，会在给浏览器返回的HTTP首部中携带HSTS字段。浏览器获取到该信息后，会将所有HTTP访问请求在内部做307跳转到HTTPS。而无需任何网络过程,实现更高的安全性
</p>

<p>
HSTS preload list:
是Chrome浏览器中的HSTS预载入列表，在该列表中的网站，使用Chrome浏览器访问时，会自动转换成HTTPS。Firefox、Safari、Edge浏览器也会采用这个列表<br>
<img src="./images/20200706230210830.png" alt="20200706230210830.png">
</p>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@Centos7 ~]#curl -Ik http://www.tmall.com/
HTTP/1.1 302 Found
Server: Tengine
Date: Fri, 26 Jun 2020 07:15:31 GMT
Content-Type: text/html
Content-Length: 258
Connection: keep-alive
Location: https://www.tmall.com/
Via: cache8.cn791[,0]
Timing-Allow-Origin: *
EagleId: 77f9309c15931557314598911e
Strict-Transport-Security: max-age=31536000

[root@centos7 ~]#curl -Ik http://www.jd.com/
HTTP/1.1 302 Moved Temporarily
Server: nginx
Date: Fri, 26 Jun 2020 07:15:38 GMT
Content-Type: text/html
Content-Length: 138
Connection: keep-alive
Location: https://www.jd.com/
Access-Control-Allow-Origin: *
Timing-Allow-Origin: *
X-Trace: 302-1593155738017-0-0-0-0-0
Strict-Transport-Security: max-age=360
</pre>
</div>

<p>
范例：实现HSTS
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20005;&#26684;&#30340;&#20256;&#36755;&#23433;&#20840;,&#19968;&#24180;&#26377;&#25928;&#26399;
</span>[root@centos8 ~]#vim /etc/httpd/conf.d/test.conf
Header always set Strict-Transport-Security <span style="color: #8b2252;">"max-age=31536000"</span>   
RewriteEngine on
RewriteRule ^(/.*)$ https://%{HTTP_HOST}$<span style="color: #a0522d;">1</span> [<span style="color: #a0522d;">redirect</span>=302]

[root@Centos7 ~]#curl -I http://www.a.com/  
HTTP/1.1 302 Found
Date: Fri, 26 Jun 2020 03:45:27 GMT
Server: Apache/2.4.37 (centos) OpenSSL/1.1.1c
Strict-Transport-Security: max-age=31536000
Location: https://www.a.com/
Content-Type: text/html; <span style="color: #a0522d;">charset</span>=iso-8859-1

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#33021;&#30475;&#21040;302&#30340;&#36339;&#36716;&#20449;&#24687;,&#30475;&#19981;&#21040;&#24076;&#26395;&#30475;&#21040;&#30340;&#26368;&#32456;&#39029;&#38754;
</span>[root@Centos7 ~]#curl http://www.a.com/
&lt;!DOCTYPE HTML PUBLIC <span style="color: #8b2252;">"-//IETF//DTD HTML 2.0//EN"</span>&gt;
&lt;html&gt;&lt;head&gt;
&lt;title&gt;302 Found&lt;/title&gt;
&lt;/head&gt;&lt;body&gt;
&lt;h1&gt;Found&lt;/h1&gt;
&lt;p&gt;The document has moved &lt;a <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"https://www.a.com/"</span>&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;/body&gt;&lt;/html&gt;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25353;&#29031;&#36339;&#36716;&#30340;&#32467;&#26524;&#21435;&#35775;&#38382;&#39029;&#38754;,&#26368;&#32456;&#35775;&#38382;&#21040;&#21152;&#23494;&#30340;&#39029;&#38754;
</span>[root@Centos7 ~]#curl -L http://www.a.com/
curl: (60) Peer<span style="color: #8b2252;">'s certificate issuer has been marked as not trusted by the user.
More details here: http://curl.haxx.se/docs/sslcerts.html

curl performs SSL certificate verification by default, using a "bundle"
 of Certificate Authority (CA) public keys (CA certs). If the default
 bundle file isn'</span>t adequate, you can specify an alternate file
 using the --cacert option.
If this HTTPS server uses a certificate signed by a CA represented<span style="color: #a020f0;"> in</span>
 the bundle, the certificate verification probably failed due to a
 problem with the certificate (it might be expired, or the name might
 not match the domain name<span style="color: #a020f0;"> in</span> the URL).
If you<span style="color: #8b2252;">'d like to turn off curl'</span>s verification of the certificate, use
 the -k (or --insecure) option.

 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21152;k&#36873;&#39033;,&#24573;&#30053;&#35777;&#20070;&#26816;&#26597;,&#30475;&#21040;&#26368;&#32456;&#30340;&#39029;&#38754;
</span>[root@Centos7 ~]#curl -Lk http://www.a.com/
&lt;h1&gt;/var/www/html/index.html&lt;/h1&gt;
</pre>
</div>


<figure id="org60fefb0">
<img src="./images/20200706230235683.png" alt="20200706230235683.png">

</figure>
</div>
</div>
<div id="outline-container-h:a2204ab3-5a88-4d1b-8c1f-92b95e9d4d79" class="outline-3">
<h3 id="h:a2204ab3-5a88-4d1b-8c1f-92b95e9d4d79">正向代理和反向代理</h3>
<div class="outline-text-3" id="text-h:a2204ab3-5a88-4d1b-8c1f-92b95e9d4d79">

<figure id="org7196865">
<img src="./images/20200706230247529.png" alt="20200706230247529.png">

</figure>

<p>
正向代理说明: 服务于客户端,隐藏了客户端的IP地址
</p>

<p>
<b>假设某小区里的几个用户想要去网上看一个500M的视频 ,
500M的视频会反复地下载,这样小区的带宽就被重复da的公司的浪费掉了,
搭建了正向代理服务器后,每个用户就通过代理服务器进行上网,这时用户再去看视频时,代理服务器就会替用户把视频下载缓存下来,其他用户再浏览同一个视频时,就不需要再从服务器上下载,于是网络带宽的消耗大幅减少
; 另外,在代理服务器上还可以设置访问控制,实现安全策略</b>
</p>

<p>
反向代理说明: 服务于服务端,隐藏了服务端的IP地址
</p>

<p>
<b>大的公司可能会有多个服务器
,用户访问时就不知道访问哪个,反向代理服务器就像一个接待者,首先用户向DNS发请求,DNS给用户一个反向代理服务器的地址,反向代理服务器收到请求后,转发给它觉得合理的服务器上去</b>
</p>

<p>
<b>启用反向代理</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">ProxyPass <span style="color: #8b2252;">"/"</span> <span style="color: #8b2252;">"http://www.example.com/"</span>
ProxyPassReverse <span style="color: #8b2252;">"/"</span> <span style="color: #8b2252;">"http://www.example.com/"</span>
</pre>
</div>

<p>
<b>特定URL反向代理</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">ProxyPass <span style="color: #8b2252;">"/images"</span> <span style="color: #8b2252;">"http://www.example.com/"</span>
ProxyPassReverse <span style="color: #8b2252;">"/images"</span> http://www.example.com/
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;VirtualHost *&gt;
ServerName www.ciciedu.com
ProxyPass / http://localhost:8080/
ProxyPassReverse / http://localhost:8080/
&lt;/VirtualHost&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c62a8c44-00f7-43e8-bf6a-58e287249d59" class="outline-3">
<h3 id="h:c62a8c44-00f7-43e8-bf6a-58e287249d59">Sendfile 机制</h3>
<div class="outline-text-3" id="text-h:c62a8c44-00f7-43e8-bf6a-58e287249d59">
<p>
设置Sendfile 功能
</p>

<div class="org-src-container">
<pre class="src src-sh">EnableSendfile On|Off  
</pre>
</div>

<p>
属于”零复制”技术
</p>

<p>
不用 sendfile 的传统网络传输过程：
</p>

<p>
read(file, tmp_buf, len)
</p>

<p>
write(socket, tmp_buf, len)
</p>

<p>
硬盘 &gt;&gt; kernel buffer &gt;&gt; user buffer &gt;&gt; kernel socket buffer &gt;&gt; 协议栈
</p>


<figure id="org6b2c86f">
<img src="./images/20200706230304345.png" alt="20200706230304345.png">

</figure>

<p>
一般网络应用通过读硬盘数据，写数据到 socket
来完成网络传输,底层执行过程：
</p>

<ol class="org-ol">
<li>系统调用 read() 产生一个上下文切换：从 user mode 切换到 kernel
mode，然后 DMA 执行拷贝，把文件数据从硬盘读到一个 kernel buffer 里</li>

<li>数据从 kernel buffer 拷贝到 user buffer，然后系统调用 read()
返回，这时又产生一个上下文切换：从kernel mode 切换到 user mode</li>

<li>系统调用 write() 产生一个上下文切换：从 user mode 切换到 kernel
mode，然后把步骤2读到 user buffer 的数据拷贝到 kernel
buffer（数据第2次拷贝到 kernel buffer），不过这次是个不同的 kernel
buffer，这个 buffer和 socket 相关联</li>

<li>系统调用 write() 返回，产生一个上下文切换：从 kernel mode 切换到 user
mode(第4次切换),然后DMA从 kernel buffer 拷贝数据到协议栈（第4次拷贝）</li>
</ol>

<p>
上面4个步骤有4次上下文切换，有4次拷贝，如果能减少切换次数和拷贝次数将会有效提升性能
</p>

<p>
<b>Sendfile机制</b>
</p>


<figure id="org4a314a2">
<img src="./images/20200706230316235.png" alt="20200706230316235.png">

</figure>

<p>
在kernel 2.0+ 版本中，系统调用 sendfile()
就是用来简化上面步骤提升性能的。sendfile()
不但能减少切换次数而且还能减少拷贝次数用 sendfile()
来进行网络传输的过程：
</p>

<p>
sendfile(socket, file, len);
</p>

<p>
硬盘 &gt;&gt; kernel buffer (快速拷贝到kernel socket buffer) &gt;&gt; 协议栈
</p>

<ol class="org-ol">
<li>系统调用 sendfile() 通过 DMA 把硬盘数据拷贝到 kernel
buffer，然后数据被 kernel 直接拷贝到另外一个与 socket 相关的 kernel
buffer。这里没有 user mode 和 kernel mode 之间的切换，在 kernel
中直接完成了从一个 buffer 到另一个 buffer 的拷贝</li>

<li>DMA 把数据从 kernel buffer 直接拷贝给协议栈，没有切换，也不需要数据从
user mode 拷贝到 kernel mode，因为数据就在 kernel 里</li>
</ol>
</div>
</div>
<div id="outline-container-h:4824f73c-7f84-45fa-b425-ba6a79666039" class="outline-3">
<h3 id="h:4824f73c-7f84-45fa-b425-ba6a79666039">指定文件类型 content type</h3>
<div class="outline-text-3" id="text-h:4824f73c-7f84-45fa-b425-ba6a79666039">
<p>
相关指令
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450;&#25991;&#20214;&#21644;content type &#30340;&#23545;&#24212;&#25991;&#20214;
</span>TypesConfig file-path
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;&#32473;&#23450;&#30340;&#25991;&#20214;&#25193;&#23637;&#21517;&#19982;&#29305;&#23450;&#30340;content type&#20869;&#23481;&#31867;&#22411;&#20043;&#38388;&#24314;&#31435;&#26144;&#23556;&#20851;&#31995;&#12290;MIME-type&#25351;&#26126;&#20102;&#21253;&#21547;extension&#25193;&#23637;&#21517;&#30340;&#25991;&#20214;&#30340;&#23186;&#20307;&#31867;&#22411;&#12290;&#36825;&#20010;&#26144;&#23556;&#20851;&#31995;&#20250;&#28155;&#21152;&#22312;&#25152;&#26377;&#26377;&#25928;&#30340;&#26144;&#23556;&#20851;&#31995;&#19978;&#65292;&#24182;&#35206;&#30422;&#25152;&#26377;&#30456;&#21516;&#30340;extension&#25193;&#23637;&#21517;&#26144;&#23556;&#65292;extension&#21442;&#25968;&#26159;&#19981;&#21306;&#20998;&#22823;&#23567;&#30340;&#65292;&#24182;&#19988;&#21487;&#20197;&#24102;&#25110;&#19981;&#24102;&#21069;&#23548;&#28857;
</span>AddType MIME-type extension [extension] ...
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">TypesConfig /etc/mime.types <span style="color: #b22222;">#</span><span style="color: #b22222;">&#40664;&#35748;&#25351;&#21521;&#37197;&#32622;&#25991;&#20214;
</span>AddType image/jpeg jpeg jpg jpe
AddType application/x-httpd-php .php
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:ea2bf7b2-2d91-4da2-a050-d7029131e305" class="outline-2">
<h2 id="h:ea2bf7b2-2d91-4da2-a050-d7029131e305">http 协议及报文头部结构</h2>
<div class="outline-text-2" id="text-h:ea2bf7b2-2d91-4da2-a050-d7029131e305">
<p>
浏览器访问网页的过程<br>
<img src="./images/20200706231335294.png" alt="20200706231335294.png">
</p>

<p>
http协议：http/0.9, http/1.0, http/1.1, http/2.0，http/3.0
</p>

<p>
http协议：stateless 无状态, 服务器无法持续追踪访问者来源
</p>

<p>
解决http协议无状态方法
</p>

<ul class="org-ul">
<li>cookie 客户端存放</li>
<li>session 服务端存放</li>
</ul>

<p>
http事务：一次访问的过程
</p>

<ul class="org-ul">
<li>请求：request</li>
<li>响应：response</li>
</ul>

<p>
HTTP报文结构
</p>

<p>
协议查看或分析的工具：tcpdump, wireshark,tshark
</p>

<p>
参考资料：<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP">https://developer.mozilla.org/zh-CN/docs/Web/HTTP</a>
</p>
</div>
<div id="outline-container-h:f0b15f82-1eca-4180-bfaa-751f7a9aa3c6" class="outline-3">
<h3 id="h:f0b15f82-1eca-4180-bfaa-751f7a9aa3c6">HTTP请求报文</h3>
<div class="outline-text-3" id="text-h:f0b15f82-1eca-4180-bfaa-751f7a9aa3c6">
<p>
<img src="./images/20200706231347521.png" alt="20200706231347521.png">
<b>request报文格式</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;method&gt; &lt;request-URL&gt; &lt;version&gt;
&lt;headers&gt;
&lt;entity-body
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">GET / HTTP/1.1
Accept: */*
Accept-Encoding: gzip, deflate
Connection: keep-alive
Host: www.ciciedu.com
User-Agent: HTTPie/0.9.4
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-html">#post.html
&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">"index.html"</span> <span style="color: #a0522d;">method</span>=<span style="color: #8b2252;">"POST"</span>&gt;
username:&lt;<span style="color: #0000ff;">br</span>&gt;
&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"username"</span> &gt;
&lt;<span style="color: #0000ff;">br</span>&gt;
password:&lt;<span style="color: #0000ff;">br</span>&gt;
&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"password"</span> &gt;
&lt;<span style="color: #0000ff;">br</span>&gt;&lt;<span style="color: #0000ff;">br</span>&gt;
&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"submit"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"Submit"</span>&gt;
&lt;/<span style="color: #0000ff;">form</span>&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:14083aab-6a14-44fd-928b-d2544819b943" class="outline-3">
<h3 id="h:14083aab-6a14-44fd-928b-d2544819b943">HTTP响应报文</h3>
<div class="outline-text-3" id="text-h:14083aab-6a14-44fd-928b-d2544819b943">

<figure id="orgcd16686">
<img src="./images/20200706231400999.png" alt="20200706231400999.png">

</figure>

<p>
<b>response报文格式</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;version&gt; &lt;status&gt; &lt;reason-phrase&gt;
&lt;headers&gt;
&lt;entity-body&gt;
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">HTTP/1.1 200 OK
Cache-Control: max-age=3, must-revalidate
Connection: keep-alive
Content-Encoding: gzip
Content-Type: text/html; <span style="color: #a0522d;">charset</span>=UTF-8
Date: Thu, 07 Nov 2019 03:44:14 GMT
Server: Tengine
Transfer-Encoding: chunked
Vary: Accept-Encoding
Vary: Accept-Encoding, Cookie
</pre>
</div>
</div>
</div>
<div id="outline-container-h:49501854-89de-4a3b-9956-0dfa7e651d09" class="outline-3">
<h3 id="h:49501854-89de-4a3b-9956-0dfa7e651d09">HTTP报文格式详解</h3>
<div class="outline-text-3" id="text-h:49501854-89de-4a3b-9956-0dfa7e651d09">
</div>
<div id="outline-container-h:95fe9dca-96c6-43fd-89ce-756ef824c035" class="outline-4">
<h4 id="h:95fe9dca-96c6-43fd-89ce-756ef824c035">Method 方法</h4>
<div class="outline-text-4" id="text-h:95fe9dca-96c6-43fd-89ce-756ef824c035">
<p>
请求方法，标明客户端希望服务器对资源执行的动作，包括以下：
</p>

<ul class="org-ul">
<li>GET： 从服务器获取一个资源</li>
<li>HEAD： 只从服务器获取文档的响应首部</li>
<li>POST： 向服务器输入数据，通常会再由网关程序继续处理</li>
<li>PUT： 将请求的主体部分存储在服务器中，如上传文件</li>
<li>DELETE： 请求删除服务器上指定的文档</li>
<li>TRACE： 追踪请求到达服务器中间经过的代理服务器</li>
<li>OPTIONS：请求服务器返回对指定资源支持使用的请求方法</li>
<li>CONNECT：建立一个到由目标资源标识的服务器的隧道</li>
<li>PATCH：用于对资源应用部分修改</li>
</ul>

<p>
其中GET,HEAD,POST用得较多
</p>
</div>
</div>
<div id="outline-container-h:07a118c5-6362-4132-ac04-f41905d7067d" class="outline-4">
<h4 id="h:07a118c5-6362-4132-ac04-f41905d7067d">version版本</h4>
<div class="outline-text-4" id="text-h:07a118c5-6362-4132-ac04-f41905d7067d">
<div class="org-src-container">
<pre class="src src-sh">HTTP/&lt;major&gt;.&lt;minor&gt;
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">HTTP/1.1
</pre>
</div>
</div>
</div>
<div id="outline-container-h:9c383f80-c17c-46dd-a420-c10215f10fba" class="outline-4">
<h4 id="h:9c383f80-c17c-46dd-a420-c10215f10fba">status 状态码</h4>
<div class="outline-text-4" id="text-h:9c383f80-c17c-46dd-a420-c10215f10fba">
<p>
<img src="./images/2020070623142089.png" alt="2020070623142089.png">
三位数字，标记请求处理过程中发生的情况
</p>

<p>
参考资料：<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status</a>
</p>

<p>
<b>http协议状态码分类</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">1xx&#65306;100-101 &#20449;&#24687;&#25552;&#31034;
2xx&#65306;200-206 &#25104;&#21151;
3xx&#65306;300-307 &#37325;&#23450;&#21521;
4xx&#65306;400-415 &#38169;&#35823;&#31867;&#20449;&#24687;&#65292;&#23458;&#25143;&#31471;&#38169;&#35823;
5xx&#65306;500-505 &#38169;&#35823;&#31867;&#20449;&#24687;&#65292;&#26381;&#21153;&#22120;&#31471;&#38169;&#35823;
</pre>
</div>

<p>
<b>http协议常用的状态码</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">200&#65306; &#25104;&#21151;&#65292;&#35831;&#27714;&#25968;&#25454;&#36890;&#36807;&#21709;&#24212;&#25253;&#25991;&#30340;entity-body&#37096;&#20998;&#21457;&#36865;;OK
301&#65306; &#35831;&#27714;&#30340;URL&#25351;&#21521;&#30340;&#36164;&#28304;&#24050;&#32463;&#34987;&#21024;&#38500;&#65307;&#20294;&#22312;&#21709;&#24212;&#25253;&#25991;&#20013;&#36890;&#36807;&#39318;&#37096;Location&#25351;&#26126;&#20102;&#36164;&#28304;&#29616;&#22312;&#25152;&#22788;&#30340;&#26032;&#20301;&#32622;&#65307;Moved Permanently
302&#65306; &#21709;&#24212;&#25253;&#25991;Location&#25351;&#26126;&#36164;&#28304;&#20020;&#26102;&#26032;&#20301;&#32622; Moved Temporarily
304&#65306; &#23458;&#25143;&#31471;&#21457;&#20986;&#20102;&#26465;&#20214;&#24335;&#35831;&#27714;&#65292;&#20294;&#26381;&#21153;&#22120;&#19978;&#30340;&#36164;&#28304;&#26410;&#26366;&#21457;&#29983;&#25913;&#21464;&#65292;&#21017;&#36890;&#36807;&#21709;&#24212;&#27492;&#21709;&#24212;&#29366;&#24577;&#30721;&#36890;&#30693;&#23458;&#25143;&#31471;&#65307;Not Modified
307:  &#27983;&#35272;&#22120;&#20869;&#37096;&#37325;&#23450;&#21521;
401&#65306; &#38656;&#35201;&#36755;&#20837;&#36134;&#21495;&#21644;&#23494;&#30721;&#35748;&#35777;&#26041;&#33021;&#35775;&#38382;&#36164;&#28304;&#65307;Unauthorized
403&#65306; &#35831;&#27714;&#34987;&#31105;&#27490;&#65307;Forbidden
404&#65306; &#26381;&#21153;&#22120;&#26080;&#27861;&#25214;&#21040;&#23458;&#25143;&#31471;&#35831;&#27714;&#30340;&#36164;&#28304;&#65307;Not Found
500&#65306; &#26381;&#21153;&#22120;&#20869;&#37096;&#38169;&#35823;&#65307;Internal Server Error
502&#65306; &#20195;&#29702;&#26381;&#21153;&#22120;&#20174;&#21518;&#31471;&#26381;&#21153;&#22120;&#25910;&#21040;&#20102;&#19968;&#26465;&#20266;&#21709;&#24212;&#65292;&#22914;&#26080;&#27861;&#36830;&#25509;&#21040;&#32593;&#20851;&#65307;Bad Gateway
503&#65306; &#26381;&#21153;&#19981;&#21487;&#29992;&#65292;&#20020;&#26102;&#26381;&#21153;&#22120;&#32500;&#25252;&#25110;&#36807;&#36733;&#65292;&#26381;&#21153;&#22120;&#26080;&#27861;&#22788;&#29702;&#35831;&#27714;
504&#65306; &#32593;&#20851;&#36229;&#26102;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:825cb110-6f50-47e2-92dd-9ed25b367172" class="outline-4">
<h4 id="h:825cb110-6f50-47e2-92dd-9ed25b367172">reason-phrase原因短语</h4>
<div class="outline-text-4" id="text-h:825cb110-6f50-47e2-92dd-9ed25b367172">
<p>
状态码所标记的状态的简要描述
</p>
</div>
</div>
<div id="outline-container-h:9444b040-c855-4718-9cad-eabd526ec4c1" class="outline-4">
<h4 id="h:9444b040-c855-4718-9cad-eabd526ec4c1">headers首部字段头</h4>
<div class="outline-text-4" id="text-h:9444b040-c855-4718-9cad-eabd526ec4c1">
<p>
首部字段包含的信息最为丰富。首部字段同时存在于请求和响应报文内，并涵盖
HTTP
报文相关的内容信息。使用首部字段是为了给客服端和服务器端提供报文主体大小、所使用的语言、认证信息等内容
</p>

<p>
首部字段是由首部字段名和字段值构成的，中间用冒号”：”分隔字段值对应，即key/value
键/值对单个 HTTP 首部字段可以有多个值
</p>

<p>
参考资料：<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers</a>
</p>

<p>
*首部的分类*：
</p>

<ol class="org-ol">
<li>通用首部:请求报文和响应报文两方都会使用的首部</li>
<li>请求首部:从客户端向服务器端发送请求报文时使用的首部。补充了请求的附加内容、客户端信息、请求内容相关优先级等信息</li>
<li>响应首部：从服务器端向客户端返回响应报文时使用的首部。补充了响应的附加内容，也会要求客户端附加额外的内容信息</li>
<li>实体首部：针对请求报文和响应报文的实体部分使用的首部。补充了资源内容更新时间等与实体有关的的信息</li>
<li>扩展首部</li>
</ol>

<p>
*通用首部*：
</p>

<ul class="org-ul">
<li>Date: 报文的创建时间</li>
<li>Connection：连接状态，如keep-alive, close</li>
<li>Via：显示报文经过的中间节点（代理，网关）</li>
<li>Cache-Control：控制缓存，如缓存时长</li>
<li>MIME-Version:发送端使用的MIME版本</li>
<li>Warning：错误通知</li>
</ul>

<p>
*请求首部*：
</p>

<ul class="org-ul">
<li>Accept：通知服务器自己可接受的媒体类型</li>

<li>Accept-Charset： 客户端可接受的字符集</li>

<li>Accept-Encoding：客户端可接受编码格式，如gzip</li>

<li>Accept-Language：客户端可接受的语言</li>

<li>Client-IP: 请求的客户端IP</li>

<li>Host: 请求的服务器名称和端口号</li>

<li>Referer：跳转至当前URI的前一个URL</li>

<li><p>
User-Agent：客户端代理，浏览器版本
</p>

<p>
<b>条件式请求首部</b> ：
</p></li>

<li>Expect：允许客户端列出某请求所要求的服务器行为</li>

<li>If-Modified-Since：自从指定的时间之后，请求的资源是否发生过修改</li>

<li>If-Unmodified-Since：与上面相反</li>

<li>If-None-Match：本地缓存中存储的文档的ETag标签是否与服务器文档的Etag不匹配</li>

<li><p>
If-Match：与上面相反
</p>

<p>
<b>安全请求首部</b> ：
</p></li>

<li>Authorization：向服务器发送认证信息，如账号和密码</li>

<li><p>
Cookie: 客户端向服务器发送cookie
</p>

<p>
<b>代理请求首部</b> ：
</p></li>

<li>Proxy-Authorization: 向代理服务器认证</li>
</ul>

<p>
<b>响应首部</b> ：
</p>

<p>
信息性：
</p>

<ul class="org-ul">
<li>Age：从最初创建开始，响应持续时长</li>
<li>Server：服务器程序软件名称和版本</li>
</ul>

<p>
协商首部：某资源有多种表示方法时使用
</p>

<ul class="org-ul">
<li>Accept-Ranges：服务器可接受的请求范围类型</li>
<li>Vary：服务器查看的其它首部列表</li>
</ul>

<p>
安全响应首部：
</p>

<ul class="org-ul">
<li>Set-Cookie：向客户端设置cookie</li>
<li>WWW-Authenticate：来自服务器对客户端的质询列表</li>
</ul>

<p>
*实体首部*：
</p>

<ul class="org-ul">
<li>Allow: 列出对此资源实体可使用的请求方法</li>

<li>Location：告诉客户端真正的实体位于何处</li>

<li>Content-Encoding:对主体执行的编码</li>

<li>Content-Language:理解主体时最适合的语言</li>

<li>Content-Length: 主体的长度</li>

<li>Content-Location: 实体真正所处位置</li>

<li><p>
Content-Type：主体的对象类型，如text
</p>

<p>
<b>缓存相关</b> ：
</p></li>

<li>ETag：实体的扩展标签</li>

<li>Expires：实体的过期时间</li>

<li>Last-Modified：最后一次修改的时间</li>
</ul>
</div>
</div>
<div id="outline-container-h:e277d20a-c222-4157-b264-bd5a70544811" class="outline-4">
<h4 id="h:e277d20a-c222-4157-b264-bd5a70544811">entity-body实体</h4>
<div class="outline-text-4" id="text-h:e277d20a-c222-4157-b264-bd5a70544811">
<p>
请求时附加的数据或响应时附加的数据，例如：登录网站时的用户名和密码，博客的上传文章，论坛上的发言等。
</p>
</div>
</div>
</div>
<div id="outline-container-h:2e7cdbbe-ecc5-454a-acb1-0acc5304ebfa" class="outline-3">
<h3 id="h:2e7cdbbe-ecc5-454a-acb1-0acc5304ebfa">Cookie 和 session</h3>
<div class="outline-text-3" id="text-h:2e7cdbbe-ecc5-454a-acb1-0acc5304ebfa">

<figure id="org57556f1">
<img src="./images/20200706232152681.png" alt="20200706232152681.png">

</figure>

<p>
<b>无状态协议</b> 是指协议对事物处理 <b>没有记忆能力</b> 。缺少状态意味着如果后
续处理需要前面的信息，则必须重传，这样可能导致每次连接传送的数据量增大。
另一方面，在服务器不需要先前信息时它应答就很快。
</p>

<p>
HTTP是超本文传输协议，顾名思义，这个协议支持超文本的传输。什么是超文本？说白了就是使用HTML编写的页面。通常，我们使用客户端浏览器访问服务器的资源，最常见的URL也是以html为后缀的文件，因此可以说超文本是网络上最主要的资源。
</p>

<p>
既然HTTP协议的目的是在于支持超文本的传输，也就是资源的传输，那么客户端浏览器向HTTP服务器发送请求，继而HTTP服务器将相信资源发回给客户端这样一个过程中，无论对于客户端还是服务器，都没有必要记录这个过程，因为每一次请求和响应都是相对独立的，一般而言，一个URL对应着一个唯一的超文本，正是因为这样的唯一性，使得记录用户的行为状态变得毫无意义，所以，HTTP协议被设计为无状态的连接协议符合它本身的需求。
</p>

<p>
HTTP协议这种特性有优点也有缺点，优点在于解放了服务器，每一次请求”点到为止”，不会造成不必要的连接占用，缺点在于如果为了保留状态，每次请求都会传输大量的重复信息内容。
</p>

<p>
可是随着 Web 的不断发展，很多业务都需要对通信状态进行保存.
</p>

<p>
如果是一次性会话的过程： 打开浏览器 -&gt; 访问一些服务器内容 -&gt; 关闭浏览器
</p>

<p>
但目前有很多WEB访问场景，并不是一次性会话，而是多次相关的会话，比如：
</p>

<p>
登录场景：打开浏览器 -&gt; 浏览到登陆页面 -&gt; 输入用户名和密码 -&gt;
访问到用户主页(显示用户名) -&gt; 修改密码（输入原密码）-&gt; 修改收货地址&#x2026;
</p>

<p>
问题：在此处登录会话过程中产生的数据（用户会话数据）如何保存下来呢？
</p>

<p>
购物场景：打开浏览器 -&gt; 浏览商品列表 -&gt; 加入购物车(把商品信息保存下来)
-&gt; 关闭浏览器
</p>

<p>
打开浏览器-&gt; 直接进入购物车 -&gt; 查看到上次加入购物车的商品 -&gt; 下订单 -&gt;
支付
</p>

<p>
问题： 在购物会话过程中，如何保存商品信息？
</p>

<p>
以上场景都需要保留会话数据，需要会话管理机制。
</p>

<p>
会话管理： 管理浏览器客户端和服务器端之间会话过程中产生的会话数据。
</p>

<p>
为了会话管理，HTTP就需要传输大量重复信息内容的问题，造成大量的网络带宽消耗。于是
Cookie 和 Session
技术闪亮登场了，它们可以为用户进行会话管理，实现保存状态。
</p>
</div>
<div id="outline-container-h:d724a264-aba8-4a16-b92c-b4412378398f" class="outline-4">
<h4 id="h:d724a264-aba8-4a16-b92c-b4412378398f">Cookie</h4>
<div class="outline-text-4" id="text-h:d724a264-aba8-4a16-b92c-b4412378398f">
<p>
Cookie
又称为”小甜饼”。类型为”小型文本文件”，指某些网站为了辨别用户身份而储存在用户本地终端（Client
Side）上的数据（通常经过加密）。由网景公司的前雇员卢·蒙特利在1993年3月发明
</p>

<p>
因为HTTP协议是无状态的，即服务器不知道用户上一次做了什么，这严重阻碍了交互式Web应用程序的实现。在典型的网上购物场景中，用户浏览了几个页面，买了一盒饼干和两瓶饮料。最后结帐时，由于HTTP的无状态性，不通过额外的手段，服务器并不知道用户到底买了什么，所以Cookie就是用来绕开HTTP的无状态性的”额外手段”之一。服务器可以设置或读取Cookies中包含信息，借此维护用户跟服务器会话中的状态。
</p>

<p>
在上面的购物场景中，当用户选购了第一项商品，服务器在向用户发送网页的同时，还发送了一段Cookie，记录着那项商品的信息。当用户访问另一个页面，浏览器会把Cookie发送给服务器，于是服务器知道他之前选购了什么。用户继续选购饮料，服务器就在原来那段Cookie里追加新的商品信息。结帐时，服务器读取发送来的Cookie就行了。
</p>

<p>
<img src="./images/2020070623154080.png" alt="2020070623154080.png">
set-cookie是首部字段
</p>

<p>
Cookie基于HTTP协议，也叫Web
Cookie或浏览器Cookie，是服务器发送到用户浏览器并保存在客户端本地的一小块数据，它会在浏览器下次向同一服务器再发起请求时被携带并发送到服务器上。通常，它用于告知服务端两个请求是否来自同一浏览器，如保持用户的登录状态。Cookie使基于无状态的HTTP协议记录稳定的状态信息成为了可能。
</p>

<p>
Cookie主要用于以下三个方面：
</p>

<ul class="org-ul">
<li>会话状态管理（如用户登录状态、购物车、游戏分数或其它需要记录的信息）</li>
<li>个性化设置（如用户自定义设置、主题等）</li>
<li>浏览器行为跟踪（如跟踪分析用户行为等）</li>
</ul>

<p>
使用 Cookie 的状态管理
</p>

<p>
Cookie 技术通过在请求和响应报文中写入 Cookie
信息来控制客户端的状态。当服务器收到HTTP请求时，服务器可以在响应头里面添加一个Set-Cookie选项。浏览器收到响应后通常会保存下Cookie，之后对该服务器每一次请求中都通过Cookie请求头部将Cookie信息发送给服务器。服务器端发现客户端发送过来的
Cookie
后，会去检查究竟是从哪一个客户端发来的连接请求，然后对比服务器上的记录，最后得到之前的状态信息.另外，Cookie的过期时间、域、路径、有效期、适用站点都可以根据需要来指定。
</p>

<p>
<b>Set-Cookie首部字段</b>
</p>

<ul class="org-ul">
<li>NAME=VALUE 赋予 Cookie 的名称和其值,此为必需项</li>

<li><p>
expires=DATE Cookie 的有效期，若不明确指定则默认为浏览器关闭前为止
</p>

<p>
<b>会话期Cookie</b>
</p>

<p>
基于内存保存，会话期Cookie是最简单的Cookie：*浏览器关闭之后它会被自动删除*，也就是说它仅在会话期内有效。会话期Cookie不需要指定过期时间（Expires）或者有效期（Max-Age）。需要注意的是，有些浏览器提供了会话恢复功能，这种情况下即使关闭了浏览器，会话期Cookie也会被保留下来，就好像浏览器从来没有关闭一样。
</p>

<p>
<b>持久性Cookie</b>
</p>

<p>
基于硬盘保存，和关闭浏览器便失效的会话期Cookie不同，持久性Cookie可以指定一个特定的过期时间（Expires）或有效期（Max-Age）。
</p>

<div class="org-src-container">
<pre class="src src-sh">Set-Cookie: <span style="color: #a0522d;">id</span>=a3fWa; <span style="color: #a0522d;">Expires</span>=Wed, 21 Oct 2015 07:28:00 GMT;
                      &#36807;&#26399;&#26102;&#38388;
</pre>
</div>

<p>
提示：当Cookie的过期时间被设定时，设定的日期和时间只与客户端相关，而不是服务端。
</p></li>

<li><p>
path=PATH
指定了主机下的哪些路径可以接受Cookie（该URL路径必须存在于请求URL中）。若不指定则默认为文档所在的文件目录,以字符
%x2F ("/") 作为路径分隔符，子路径也会被匹配。
</p>

<p>
例如，设置 Path=/docs ，则以下地址都会匹配：
</p>

<ul class="org-ul">
<li>/docs</li>
<li><i>docs/Web</i></li>
<li>/docs/Web/HTTP</li>
</ul></li>

<li><p>
domain=域名
指定了哪些主机可以接受Cookie。如果不指定，默认为当前文档的主机（不包含子域名）。如果指定了Domain，则一般包含子域名。
</p>

<p>
例如，如果设置
Domain=ciciedu.com，则Cookie也包含子域名（如：study.ciciedu.com）
</p></li>

<li>Secure 标记为 Secure
的Cookie只应通过被HTTPS协议加密过的请求发送给服务端。但即便设置了
Secure
标记，敏感信息也不应该通过Cookie传输，因为Cookie有其固有的不安全性，Secure
标记也无法提供确实的安全保障。从 Chrome 52 和 Firefox 52
开始，不安全的站点（<a href="http:%EF%BC%89%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8Cookie%E7%9A%84">http:%EF%BC%89%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8Cookie%E7%9A%84</a> Secure 标记。</li>

<li>HttpOnly 加以限制使 Cookie 不能被 JavaScript 脚本访问,为避免跨域脚本
(XSS) 攻击，通过JavaScript的 Document.cookie API无法访问带有 HttpOnly
标记的Cookie，它们只应该发送给服务端。如果包含服务端 Session 信息的
Cookie 不想被客户端 JavaScript 脚本调用，那么就应该为其设置 HttpOnly
标记</li>
</ul>

<p>
*浏览器对cookie的限制*：
</p>

<p>
Cookie 存储的限制是不一样的。例如：单个域名可存储的 Cookie 数量、Cookie
大小等。
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">IE6.0</th>
<th scope="col" class="org-left">IE7.0/8.0</th>
<th scope="col" class="org-left">Opera</th>
<th scope="col" class="org-left">FF</th>
<th scope="col" class="org-left">Safari</th>
<th scope="col" class="org-left">Chrome</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">cookie个数</td>
<td class="org-left">每个域为20个</td>
<td class="org-left">每个域为50个</td>
<td class="org-left">每个域为30个</td>
<td class="org-left">每个域为50个</td>
<td class="org-left">没有个数限制</td>
<td class="org-left">每个域为53个</td>
</tr>

<tr>
<td class="org-left">cookie大小</td>
<td class="org-left">4095个字节</td>
<td class="org-left">4095个字节</td>
<td class="org-left">4096个字节</td>
<td class="org-left">4097个字节</td>
<td class="org-left">4097个字节</td>
<td class="org-left">4097个字节</td>
</tr>
</tbody>
</table>

<p>
在进行页面 Cookie 操作的时候，应该尽量保证 Cookie 的个数小于 20
个，总大小小于 4KB，这是一个安全且保险的范围。
</p>

<p>
范例：响应报文中的set-cookie首部
</p>

<div class="org-src-container">
<pre class="src src-sh">HTTP/1.0 200 OK
Content-type: text/html
Set-Cookie: <span style="color: #a0522d;">yummy_cookie</span>=choco
Set-Cookie: <span style="color: #a0522d;">tasty_cookie</span>=strawberry
</pre>
</div>

<p>
范例：请求报文中的cookie首部字段
</p>

<div class="org-src-container">
<pre class="src src-sh">GET /sample_page.html HTTP/1.1
Host: www.example.org
Cookie: <span style="color: #a0522d;">yummy_cookie</span>=choco; <span style="color: #a0522d;">tasty_cookie</span>=strawberry
</pre>
</div>

<p>
范例：响应报文set-cookie中的Secure 和 HttpOnly
</p>

<div class="org-src-container">
<pre class="src src-sh">Set-Cookie: <span style="color: #a0522d;">id</span>=a3fWa; <span style="color: #a0522d;">Expires</span>=Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnly
</pre>
</div>

<p>
范例：浏览器查看cookie
</p>


<figure id="org32a1a2f">
<img src="./images/20200706231627481.png" alt="20200706231627481.png">

</figure>

<p>
范例：chrome 浏览器禁止cookie
</p>

<p>
<img src="./images/2020070623170722.png" alt="2020070623170722.png">
<img src="./images/20200706231650698.png" alt="20200706231650698.png">
</p>

<p>
范例：php语言实现cookie的管理
</p>

<div class="org-src-container">
<pre class="src src-php">#设置cookie
#cat setcookie.php
&lt;?php
setcookie('title','cto'); #有效期为会话级
setcookie('user','wang',time()+3600*12); #有效期为12小时
echo "&lt;h1&gt;test setcookie &lt;/h1&gt;"
?&gt;
#说明：setcookie设置的cookie，只有下一次http请求才能生效

#显示cookie
cat showcookies.php
&lt;?php
echo "&lt;h1&gt;test showcookie &lt;/h1&gt;";
echo $_COOKIE["user"]; #显示user的这一个cookie
echo "&lt;br /&gt;";
var_dump($_COOKIE); #显示所有cookie
//print_r($_COOKIE); #不如上面方式详细
?&gt;

#删除cookie，通过设置过期时间实现
#vim delcookie.php
&lt;?php
setcookie('user','cui',time()-3600*12);
echo "&lt;h1&gt;cookie:user is deleted &lt;/h1&gt;";
?&gt;
</pre>
</div>

<p>
显示cookie
</p>


<figure id="orgb9644bb">
<img src="./images/20200706231728796.png" alt="20200706231728796.png">

</figure>
</div>
</div>
<div id="outline-container-h:8e091a80-7aab-4a68-9495-ea6f14cf085b" class="outline-4">
<h4 id="h:8e091a80-7aab-4a68-9495-ea6f14cf085b">Sessio</h4>
<div class="outline-text-4" id="text-h:8e091a80-7aab-4a68-9495-ea6f14cf085b">
<p>
<img src="./images/20200706231747405.png" alt="20200706231747405.png">
<b>session</b>
</p>

<p>
session是相对于cookie的另外一个状态保持的解决方案，它是通过服务器来保持状态的。session指的是服务器上为每个客户端所开辟的独立存储空间，在其中保存的信息就是用于保存状态的。
</p>

<p>
Session是服务器端程序运行的过程中创建的，不同语言实现的应用程序有不同创建session的方法。在创建了session的同时，服务器会为该session生成唯一的sessionId，而这个sessionId被创建了之后，就可以调用session相关的方法往session中增加内容了，而这些内容只会保存在服务器中，每个sessionid就像数据库中主键，可以根据SessionId
关联每个session的相关信息，比如：购物车里的商器，登录用户等。但发送给客户端浏览器的只有sessionId。当客户端浏览器再次发送http请求时，会自动地将这个sessionId
附加在请求报文中
，服务器收到请求之后就会根据sessionId找到对应的session，从而再次使用，使得用户的状态得以保持。
</p>

<p>
每个session都有一个sessionId，这个ID存放有两种方式：
</p>

<p>
1、通过URL存取，比如：Java程序中，URL会带上一个jsessionId=xxxxxx等，这样每次重新请求的时候都传了sessionId给服务器
</p>

<p>
2、通过cookie存取（Tomcat默认如此），这种cookie是session
cookie，区别于persistent cookies也就是我们常说的cookie，session
cookie要注意的是存储在浏览器内存中，而不是写到硬盘上。程序一开始执行，服务器就生成一个sessionId并通过cookie携带客户端浏览器的缓存中，当下一次访问的时候，服务器先检测一下是否有这个cookie，如果有就取它的ID，如果没有就再生成一个。这就是为什么关闭浏览器之后，再进去session已经没有了，其实在服务器端session并没有清空，而是sessionId变了。
</p>

<p>
当将浏览器关闭，服务器保存的session数据不是立即释放的，此时数据还会存在一段时间（可以在程序中加以设置，Tomcat默认15分钟），只要我们知道那个sessionId，就可以继续通过请求获得此session的信息。session里面的数据都放在服务器端，通过sessionId保证不会访问错误，服务端自动对session进行管理，如果在规定的时间内没有访问，则释放掉这个session。
</p>

<p>
最后提两点：
</p>

<p>
1、sessionId通常是看不到的，但是当我们把浏览器的cookie禁止之后，Web服务器会采用URL重写的方式传递sessionId，这样就可以在地址栏看到sessionId了
</p>

<p>
2、session cookie不可以跨窗口使用，但可以跨同一个窗口的多个标签页。
</p>

<p>
<b>范例：PHP的PHPSESSID</b>
</p>

<div class="org-src-container">
<pre class="src src-php">&lt;?php
session_start();
echo session_id();
?&gt;
#执行结果如下图
</pre>
</div>


<figure id="orgfcffc70">
<img src="./images/20200706231807145.png" alt="20200706231807145.png">

</figure>

<p>
<b>范例：JAVA的JSESSIONID</b>
</p>

<p>
<img src="./images/20200706231846651.png" alt="20200706231846651.png">
<img src="./images/20200706231856921.png" alt="20200706231856921.png">
</p>
</div>
</div>
<div id="outline-container-h:7269dc91-b5ae-4cac-a3d1-0237dda19781" class="outline-4">
<h4 id="h:7269dc91-b5ae-4cac-a3d1-0237dda19781">cookie和session比较</h4>
<div class="outline-text-4" id="text-h:7269dc91-b5ae-4cac-a3d1-0237dda19781">
<p>
cookie和session的相同和不同：
</p>

<ul class="org-ul">
<li>cookie和session两者都是在服务器端生成</li>
<li>session
将数据信息保存在服务器端，可以是内存，文件，数据库等多种形式,cookie
将数据保存在客户端的内存或文件中</li>
<li>单个cookie保存的数据不能超过4K，每个站点cookie个数有限制，比如IE8为50个、Firefox为50个、Opera为30个；session存储在服务器，没有容量限制</li>
<li>cookie存放在用户本地，可以被轻松访问和修改，安全性不高；session存储于服务器，比较安全</li>
<li>cookie有会话cookie和持久cookie，生命周期为浏览器会话期的会话cookie保存在缓存，关闭浏览器窗口就消失，持久cookie被保存在硬盘，知道超过设定的过期时间；随着服务端session存储压力增大，会根据需要定期清理session数据</li>
<li>session中有众多数据，只将sessionID这一项可以通过cookie发送至客户端进行保留，客户端下次访问时，在请求报文中的cookie会自动携带sessionID，从而和服务器上的的session进行关联</li>
</ul>

<p>
cookie缺点：
</p>

<p>
1、使用cookie来传递信息，随着cookie个数的增多和访问量的增加，它占用的网络带宽也很大，试想假如cookie占用200字节，如果一天的PV有几个亿，那么它要占用多少带宽？
</p>

<p>
2、cookie并不安全，因为cookie是存放在客户端的，所以这些cookie可以被访问到，设置可以通过插件添加、修改cookie。所以从这个角度来说，我们要使用sesssion，session是将数据保存在服务端的，只是通过cookie传递一个sessionId而已，所以session更适合存储用户隐私和重要的数据
</p>

<p>
session 缺点：
</p>

<p>
1、不容易在多台服务器之间共享，可以使用session绑定，session复制，session共享解决
</p>

<p>
2、session存放在服务器中，所以session如果太多会非常消耗服务器的性能
</p>

<p>
cookie和session各有优缺点，在大型互联网系统中，单独使用cookie和session都是不可行的
</p>
</div>
</div>
</div>
</section>
<section id="outline-container-h:3d9ef48f-b3eb-473f-ba03-8de98f9bee30" class="outline-2">
<h2 id="h:3d9ef48f-b3eb-473f-ba03-8de98f9bee30">Web相关工具</h2>
<div class="outline-text-2" id="text-h:3d9ef48f-b3eb-473f-ba03-8de98f9bee30">
</div>
<div id="outline-container-h:341f0e3a-fad9-4412-bc71-d23df52c8e68" class="outline-3">
<h3 id="h:341f0e3a-fad9-4412-bc71-d23df52c8e68">links</h3>
<div class="outline-text-3" id="text-h:341f0e3a-fad9-4412-bc71-d23df52c8e68">
<p>
格式：
</p>

<div class="org-src-container">
<pre class="src src-sh">links [OPTION]... [URL]...
</pre>
</div>

<p>
常用选项：
</p>

<ul class="org-ul">
<li>-dump 非交互式模式，显示输出结果</li>
<li>-source 打印源码</li>
</ul>
</div>
</div>
<div id="outline-container-h:5deecaf7-2241-4622-b3bd-87fee36c5e14" class="outline-3">
<h3 id="h:5deecaf7-2241-4622-b3bd-87fee36c5e14">wget</h3>
<div class="outline-text-3" id="text-h:5deecaf7-2241-4622-b3bd-87fee36c5e14">
<p>
格式：
</p>

<div class="org-src-container">
<pre class="src src-sh">wget [OPTION]... [URL]...
</pre>
</div>

<p>
常用选项：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#21160;
</span>-V, &#8211;version    &#26174;&#31034;wget&#30340;&#29256;&#26412;&#21518;&#36864;&#20986;
-h, &#8211;help       &#25171;&#21360;&#35821;&#27861;&#24110;&#21161;
-b, &#8211;background &#21551;&#21160;&#21518;&#36716;&#20837;&#21518;&#21488;&#25191;&#34892;
-e, &#8211;<span style="color: #a0522d;">execute</span>=COMMAND &#25191;&#34892;<span style="color: #8b2252;">'.wgetrc'</span>&#26684;&#24335;&#30340;&#21629;&#20196;&#65292;wgetrc&#26684;&#24335;&#21442;&#35265;/etc/wgetrc&#25110;~/.wgetrc

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35760;&#24405;&#21644;&#36755;&#20837;&#25991;&#20214;
</span>-o, &#8211;output-file=FILE   &#25226;&#35760;&#24405;&#20889;&#21040;FILE&#25991;&#20214;&#20013;
-a, &#8211;append-output=FILE &#25226;&#35760;&#24405;&#36861;&#21152;&#21040;FILE&#25991;&#20214;&#20013;
-d, &#8211;debug              &#25171;&#21360;&#35843;&#35797;&#36755;&#20986;
-q, &#8211;quiet              &#23433;&#38745;&#27169;&#24335;(&#27809;&#26377;&#36755;&#20986;)
-v, &#8211;verbose            &#20887;&#38271;&#27169;&#24335;(&#36825;&#26159;&#32570;&#30465;&#35774;&#32622;)
-nv, &#8211;non-verbose       &#20851;&#25481;&#20887;&#38271;&#27169;&#24335;&#65292;&#20294;&#19981;&#26159;&#23433;&#38745;&#27169;&#24335;
-i, &#8211;input-file=FILE    &#19979;&#36733;&#22312;FILE&#25991;&#20214;&#20013;&#20986;&#29616;&#30340;URLs
-F, &#8211;force-html         &#25226;&#36755;&#20837;&#25991;&#20214;&#24403;&#20316;HTML&#26684;&#24335;&#25991;&#20214;&#23545;&#24453;
-B, &#8211;<span style="color: #a0522d;">base</span>=URL           &#23558;URL&#20316;&#20026;&#22312;-F -i&#21442;&#25968;&#25351;&#23450;&#30340;&#25991;&#20214;&#20013;&#20986;&#29616;&#30340;&#30456;&#23545;&#38142;&#25509;&#30340;&#21069;&#32512;
&#8211;<span style="color: #a0522d;">sslcertfile</span>=FILE       &#21487;&#36873;&#23458;&#25143;&#31471;&#35777;&#20070;
&#8211;<span style="color: #a0522d;">sslcertkey</span>=KEYFILE     &#21487;&#36873;&#23458;&#25143;&#31471;&#35777;&#20070;&#30340;KEYFILE
&#8211;egd-file=FILE          &#25351;&#23450;EGD socket&#30340;&#25991;&#20214;&#21517;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#19979;&#36733;
</span>-bind-address=ADDRESS    &#25351;&#23450;&#26412;&#22320;&#20351;&#29992;&#22320;&#22336;(&#20027;&#26426;&#21517;&#25110;IP&#65292;&#24403;&#26412;&#22320;&#26377;&#22810;&#20010;IP&#25110;&#21517;&#23383;&#26102;&#20351;&#29992;)
-t, &#8211;<span style="color: #a0522d;">tries</span>=NUMBER        &#35774;&#23450;&#26368;&#22823;&#23581;&#35797;&#38142;&#25509;&#27425;&#25968;(0 &#34920;&#31034;&#26080;&#38480;&#21046;).
-O &#8211;output-document=FILE &#25226;&#25991;&#26723;&#20889;&#21040;FILE&#25991;&#20214;&#20013;
-nc, &#8211;no-clobber         &#19981;&#35201;&#35206;&#30422;&#23384;&#22312;&#30340;&#25991;&#20214;&#25110;&#20351;&#29992;.#&#21069;&#32512;
-c, &#8211;continue            &#25509;&#30528;&#19979;&#36733;&#27809;&#19979;&#36733;&#23436;&#30340;&#25991;&#20214;
-progress=TYPE           &#35774;&#23450;&#36827;&#31243;&#26465;&#26631;&#35760;
-N, &#8211;timestamping        &#19981;&#35201;&#37325;&#26032;&#19979;&#36733;&#25991;&#20214;&#38500;&#38750;&#27604;&#26412;&#22320;&#25991;&#20214;&#26032;
-S, &#8211;server-response     &#25171;&#21360;&#26381;&#21153;&#22120;&#30340;&#22238;&#24212;
-spider                  &#19981;&#19979;&#36733;&#20219;&#20309;&#19996;&#35199;
-T, &#8211;<span style="color: #a0522d;">timeout</span>=SECONDS     &#35774;&#23450;&#21709;&#24212;&#36229;&#26102;&#30340;&#31186;&#25968;
-w, &#8211;<span style="color: #a0522d;">wait</span>=SECONDS        &#20004;&#27425;&#23581;&#35797;&#20043;&#38388;&#38388;&#38548;SECONDS&#31186;
-waitretry=SECONDS       &#22312;&#37325;&#26032;&#38142;&#25509;&#20043;&#38388;&#31561;&#24453;1&#8230;SECONDS&#31186;
-random-wait             &#22312;&#19979;&#36733;&#20043;&#38388;&#31561;&#24453;0&#8230;2*WAIT&#31186;
-Y, &#8211;<span style="color: #a0522d;">proxy</span>=on/off        &#25171;&#24320;&#25110;&#20851;&#38381;&#20195;&#29702;
-Q, &#8211;<span style="color: #a0522d;">quota</span>=NUMBER        &#35774;&#32622;&#19979;&#36733;&#30340;&#23481;&#37327;&#38480;&#21046;
-limit-rate=RATE         &#38480;&#23450;&#19979;&#36733;&#36755;&#29575;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#30446;&#24405;
</span>-nd &#8211;no-directories       &#19981;&#21019;&#24314;&#30446;&#24405;
-x, &#8211;force-directories    &#24378;&#21046;&#21019;&#24314;&#30446;&#24405;
-nH, &#8211;no-host-directories &#19981;&#21019;&#24314;&#20027;&#26426;&#30446;&#24405;
-P
, &#8211;directory-prefix=PREFIX &#23558;&#25991;&#20214;&#20445;&#23384;&#21040;&#30446;&#24405; PREFIX/&#8230;
&#8211;cut-dirs=NUMBER           &#24573;&#30053; NUMBER&#23618;&#36828;&#31243;&#30446;&#24405;

<span style="color: #b22222;">#</span><span style="color: #b22222;">HTTP &#36873;&#39033;
</span>&#8211;http-user=USER         &#35774;&#23450;HTTP&#29992;&#25143;&#21517;&#20026; USER.
&#8211;http-passwd=PASS       &#35774;&#23450;http&#23494;&#30721;&#20026; PASS.
-C, &#8211;<span style="color: #a0522d;">cache</span>=on/off       &#20801;&#35768;/&#19981;&#20801;&#35768;&#26381;&#21153;&#22120;&#31471;&#30340;&#25968;&#25454;&#32531;&#23384; (&#19968;&#33324;&#24773;&#20917;&#19979;&#20801;&#35768;).
-E, &#8211;html-extension     &#23558;&#25152;&#26377;text/html&#25991;&#26723;&#20197;.html&#25193;&#23637;&#21517;&#20445;&#23384;
&#8211;ignore-length          &#24573;&#30053; <span style="color: #8b2252;">'Content-Length'</span>&#22836;&#22495;
&#8211;<span style="color: #a0522d;">header</span>=STRING          &#22312;headers&#20013;&#25554;&#20837;&#23383;&#31526;&#20018; STRING
&#8211;proxy-user=USER        &#35774;&#23450;&#20195;&#29702;&#30340;&#29992;&#25143;&#21517;&#20026; USER
&#8211;proxy-passwd=PASS      &#35774;&#23450;&#20195;&#29702;&#30340;&#23494;&#30721;&#20026; PASS
&#8211;<span style="color: #a0522d;">referer</span>=URL            &#22312;HTTP&#35831;&#27714;&#20013;&#21253;&#21547; <span style="color: #8b2252;">'Referer: URL'</span>&#22836;
-s, &#8211;save-headers       &#20445;&#23384;HTTP&#22836;&#21040;&#25991;&#20214;
-U, &#8211;user-agent=AGENT   &#35774;&#23450;&#20195;&#29702;&#30340;&#21517;&#31216;&#20026; AGENT&#32780;&#19981;&#26159; Wget/VERSION.
&#8211;no-http-keep-alive     &#20851;&#38381; HTTP&#27963;&#21160;&#38142;&#25509; (&#27704;&#36828;&#38142;&#25509;).
&#8211;<span style="color: #a0522d;">cookies</span>=off            &#19981;&#20351;&#29992; cookies.
&#8211;load-cookies=FILE      &#22312;&#24320;&#22987;&#20250;&#35805;&#21069;&#20174;&#25991;&#20214; FILE&#20013;&#21152;&#36733;cookie
&#8211;save-cookies=FILE      &#22312;&#20250;&#35805;&#32467;&#26463;&#21518;&#23558; cookies&#20445;&#23384;&#21040; FILE&#25991;&#20214;&#20013;

<span style="color: #b22222;">#</span><span style="color: #b22222;">FTP &#36873;&#39033;
</span>-nr, &#8211;dont-remove-listing &#19981;&#31227;&#36208; <span style="color: #8b2252;">'.listing'</span>&#25991;&#20214;
-g, &#8211;<span style="color: #a0522d;">glob</span>=on/off          &#25171;&#24320;&#25110;&#20851;&#38381;&#25991;&#20214;&#21517;&#30340; globbing&#26426;&#21046;
&#8211;passive-ftp              &#20351;&#29992;&#34987;&#21160;&#20256;&#36755;&#27169;&#24335; (&#32570;&#30465;&#20540;).
&#8211;active-ftp               &#20351;&#29992;&#20027;&#21160;&#20256;&#36755;&#27169;&#24335;
&#8211;retr-symlinks            &#22312;&#36882;&#24402;&#30340;&#26102;&#20505;&#65292;&#23558;&#38142;&#25509;&#25351;&#21521;&#25991;&#20214;(&#32780;&#19981;&#26159;&#30446;&#24405;)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36882;&#24402;&#19979;&#36733;
</span>-r, &#8211;recursive        &#36882;&#24402;&#19979;&#36733;&#65293;&#65293;&#24910;&#29992;!
-l, &#8211;<span style="color: #a0522d;">level</span>=NUMBER     &#26368;&#22823;&#36882;&#24402;&#28145;&#24230; (inf &#25110; 0 &#20195;&#34920;&#26080;&#31351;).
&#8211;delete-after         &#22312;&#29616;&#22312;&#23436;&#27605;&#21518;&#23616;&#37096;&#21024;&#38500;&#25991;&#20214;
-k, &#8211;convert-links    &#36716;&#25442;&#38750;&#30456;&#23545;&#38142;&#25509;&#20026;&#30456;&#23545;&#38142;&#25509;
-K, &#8211;backup-converted &#22312;&#36716;&#25442;&#25991;&#20214;X&#20043;&#21069;&#65292;&#23558;&#20043;&#22791;&#20221;&#20026; X.orig
-m, &#8211;mirror           &#31561;&#20215;&#20110; -r -N -l inf -nr.
-p, &#8211;page-requisites  &#19979;&#36733;&#26174;&#31034;HTML&#25991;&#20214;&#30340;&#25152;&#26377;&#22270;&#29255;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36882;&#24402;&#19979;&#36733;&#20013;&#30340;&#21253;&#21547;&#21644;&#19981;&#21253;&#21547;(accept/reject)
</span>-A, &#8211;<span style="color: #a0522d;">accept</span>=LIST        &#20998;&#21495;&#20998;&#38548;&#30340;&#34987;&#25509;&#21463;&#25193;&#23637;&#21517;&#30340;&#21015;&#34920;
-R, &#8211;<span style="color: #a0522d;">reject</span>=LIST        &#20998;&#21495;&#20998;&#38548;&#30340;&#19981;&#34987;&#25509;&#21463;&#30340;&#25193;&#23637;&#21517;&#30340;&#21015;&#34920;
-D, &#8211;<span style="color: #a0522d;">domains</span>=LIST       &#20998;&#21495;&#20998;&#38548;&#30340;&#34987;&#25509;&#21463;&#22495;&#30340;&#21015;&#34920;
&#8211;exclude-domains=LIST   &#20998;&#21495;&#20998;&#38548;&#30340;&#19981;&#34987;&#25509;&#21463;&#30340;&#22495;&#30340;&#21015;&#34920;
&#8211;follow-ftp             &#36319;&#36394;HTML&#25991;&#26723;&#20013;&#30340;FTP&#38142;&#25509;
&#8211;follow-tags=LIST       &#20998;&#21495;&#20998;&#38548;&#30340;&#34987;&#36319;&#36394;&#30340;HTML&#26631;&#31614;&#30340;&#21015;&#34920;
-G, &#8211;ignore-tags=LIST   &#20998;&#21495;&#20998;&#38548;&#30340;&#34987;&#24573;&#30053;&#30340;HTML&#26631;&#31614;&#30340;&#21015;&#34920;
-H, &#8211;span-hosts         &#24403;&#36882;&#24402;&#26102;&#36716;&#21040;&#22806;&#37096;&#20027;&#26426;
-L, &#8211;relative           &#20165;&#20165;&#36319;&#36394;&#30456;&#23545;&#38142;&#25509;
-I, &#8211;include-directories=LIST &#20801;&#35768;&#30446;&#24405;&#30340;&#21015;&#34920;
-X, &#8211;exclude-directories=LIST &#19981;&#34987;&#21253;&#21547;&#30446;&#24405;&#30340;&#21015;&#34920;
-np, &#8211;no-parent         &#19981;&#35201;&#36861;&#28335;&#21040;&#29238;&#30446;&#24405;
</pre>
</div>

<p>
常用选项:
</p>

<div class="org-src-container">
<pre class="src src-sh">-q              &#38745;&#40664;&#27169;&#24335;
-c              &#26029;&#28857;&#32493;&#20256;
-P /path        &#20445;&#23384;&#22312;&#25351;&#23450;&#30446;&#24405;
-O filename     &#20445;&#23384;&#20026;&#25351;&#23450;&#25991;&#20214;&#21517;&#65292;filename &#20026; &#8211; &#26102;&#65292;&#21457;&#36865;&#33267;&#26631;&#20934;&#36755;&#20986;
--limit-rate=   &#25351;&#23450;&#20256;&#36755;&#36895;&#29575;&#65292;&#21333;&#20301;K&#65292;M&#31561;
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#wget --limit-rate 1M -P /data
https://mirrors.aliyun.com/centos/8/isos/x86_64/CentOS-8-x86_64-1905-dvd1.iso
--2019-12-12 13:02:18--  https://mirrors.aliyun.com/centos/8/isos/x86_64/CentOS-8-x86_64-1905-dvd1.iso
Resolving mirrors.aliyun.com (mirrors.aliyun.com)... 27.221.92.112,
119.167.168.225, 61.240.128.248, ...
Connecting to mirrors.aliyun.com (mirrors.aliyun.com)|27.221.92.112|:443...connected.
HTTP request sent, awaiting response... 200 OK
Length: 7135559680 (6.6G) [application/octet-stream]
Saving to: &#8216;/data/CentOS-8-x86_64-1905-dvd1.iso&#8217;

CentOS-8-x86_64-1905-dvd1.iso 100%
[========================================================================================&gt;] 6.65G 1.04MB/s<span style="color: #a020f0;"> in</span> 1h 53m

2019-12-12 14:55:45 (1024 KB/s) - &#8216;/data/CentOS-8-x86_64-1905-dvd1.iso&#8217; saved[7135559680/7135559680]

[root@centos8 ~]#ls /data
CentOS-8-x86_64-1905-dvd1.iso
</pre>
</div>

<p>
范例：实现浏览器功能
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#20123;&#23481;&#22120;&#20013;&#21629;&#20196;&#27604;&#36739;&#23569;&#65292;&#21487;&#33021;&#20250;&#32570;&#23569;curl&#65292;&#27492;&#26102;&#23601;&#21487;&#20197;&#29992;wget&#20195;&#26367;curl&#23454;&#29616;&#27983;&#35272;&#22120;&#21151;&#33021;
</span>[root@Centos7 ~]#wget -qO - http://10.0.0.8/
&lt;h1&gt;welcome to centos8&lt;/h1&gt;
[root@Centos7 ~]#curl http://10.0.0.8/
&lt;h1&gt;welcome to centos8&lt;/h1&gt;
</pre>
</div>

<p>
范例: 下载指定目录
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#wget -r -np -nH -R index.html http://www.example.com/dir/
[root@centos8 ~]#wget -c -r -np -k -L -p http://www.example.com/dir/

-r : &#36941;&#21382;&#25152;&#26377;&#23376;&#30446;&#24405;
-np : &#19981;&#21040;&#19978;&#19968;&#23618;&#23376;&#30446;&#24405;&#21435;
-nH : &#19981;&#35201;&#23558;&#25991;&#20214;&#20445;&#23384;&#21040;&#20027;&#26426;&#21517;&#25991;&#20214;&#22841;
-R index.html : &#19981;&#19979;&#36733; index.html &#25991;&#20214;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:fd2183ba-2087-4189-a99d-d96a7c49b478" class="outline-3">
<h3 id="h:fd2183ba-2087-4189-a99d-d96a7c49b478">curl</h3>
<div class="outline-text-3" id="text-h:fd2183ba-2087-4189-a99d-d96a7c49b478">
<p>
curl是基于URL语法在命令行方式下工作的文件传输工具，它支持FTP, FTPS,
HTTP, HTTPS, GOPHER, TELNET, DICT,
FILE及LDAP等协议。curl支持HTTPS认证，并且支持HTTP的POST、PUT等方法， FTP
上传， kerberos认证，HTTP上传，代理服务器，cookies，用户名/密码认证，
下载文件断点续传，上载文件断点续传, http代理服务器管道（ proxy
tunneling），还支持IPv6，socks5代理服务器，通过http代理服务器上传文件到FTP服务器等，功能十分强大
</p>

<p>
格式：
</p>

<div class="org-src-container">
<pre class="src src-sh">curl [options] [URL...]
</pre>
</div>

<p>
常见选项：
</p>

<div class="org-src-container">
<pre class="src src-sh">-A/--user-agent &lt;string&gt; &#35774;&#32622;&#29992;&#25143;&#20195;&#29702;&#21457;&#36865;&#32473;&#26381;&#21153;&#22120;
-e/--referer &lt;URL&gt; &#26469;&#28304;&#32593;&#22336;
--cacert &lt;file&gt; CA&#35777;&#20070; (SSL)
-k/--insecure &#20801;&#35768;&#24573;&#30053;&#35777;&#20070;&#36827;&#34892; SSL &#36830;&#25509;
--compressed &#35201;&#27714;&#36820;&#22238;&#26159;&#21387;&#32553;&#30340;&#26684;&#24335;
-H/--header <span style="color: #8b2252;">"key:value&#8221; &#33258;&#23450;&#20041;&#39318;&#37096;&#23383;&#27573;&#20256;&#36882;&#32473;&#26381;&#21153;&#22120;
-i &#26174;&#31034;&#39029;&#38754;&#20869;&#23481;&#65292;&#21253;&#25324;&#25253;&#25991;&#39318;&#37096;&#20449;&#24687;
-I/--head &#21482;&#26174;&#31034;&#21709;&#24212;&#25253;&#25991;&#39318;&#37096;&#20449;&#24687;
-D/--dump-header &lt;file&gt;&#23558;url&#30340;header&#20449;&#24687;&#23384;&#25918;&#22312;&#25351;&#23450;&#25991;&#20214;&#20013;
--basic &#20351;&#29992;HTTP&#22522;&#26412;&#35748;&#35777;
-u/--user &lt;user[:password]&gt;&#35774;&#32622;&#26381;&#21153;&#22120;&#30340;&#29992;&#25143;&#21644;&#23494;&#30721;
-L &#22914;&#26524;&#26377;3xx&#21709;&#24212;&#30721;&#65292;&#37325;&#26032;&#21457;&#35831;&#27714;&#21040;&#26032;&#20301;&#32622;
-O &#20351;&#29992;URL&#20013;&#40664;&#35748;&#30340;&#25991;&#20214;&#21517;&#20445;&#23384;&#25991;&#20214;&#21040;&#26412;&#22320;
-o &lt;file&gt; &#23558;&#32593;&#32476;&#25991;&#20214;&#20445;&#23384;&#20026;&#25351;&#23450;&#30340;&#25991;&#20214;&#20013;
--limit-rate &lt;rate&gt; &#35774;&#32622;&#20256;&#36755;&#36895;&#24230;
-0/--http1.0 &#25968;&#23383;0&#65292;&#20351;&#29992;HTTP 1.0
-v/--verbose &#26356;&#35814;&#32454;
-C &#36873;&#39033;&#21487;&#23545;&#25991;&#20214;&#20351;&#29992;&#26029;&#28857;&#32493;&#20256;&#21151;&#33021;
-c/--cookie-jar &lt;file name&gt; &#23558;url&#20013;cookie&#23384;&#25918;&#22312;&#25351;&#23450;&#25991;&#20214;&#20013;
-x/--proxy &lt;proxyhost[:port]&gt; &#25351;&#23450;&#20195;&#29702;&#26381;&#21153;&#22120;&#22320;&#22336;
-X/--request &lt;command&gt; &#21521;&#26381;&#21153;&#22120;&#21457;&#36865;&#25351;&#23450;&#35831;&#27714;&#26041;&#27861;
-U/--proxy-user &lt;user:password&gt; &#20195;&#29702;&#26381;&#21153;&#22120;&#29992;&#25143;&#21644;&#23494;&#30721;
-T &#36873;&#39033;&#21487;&#23558;&#25351;&#23450;&#30340;&#26412;&#22320;&#25991;&#20214;&#19978;&#20256;&#21040;FTP&#26381;&#21153;&#22120;&#19978;
--data/-d &#26041;&#24335;&#25351;&#23450;&#20351;&#29992;POST&#26041;&#24335;&#20256;&#36882;&#25968;&#25454;
-s --silent Silent mode
-b name=data &#20174;&#26381;&#21153;&#22120;&#21709;&#24212;set-cookie&#24471;&#21040;&#20540;&#65292;&#36820;&#22238;&#32473;&#26381;&#21153;&#22120;
-w &lt;format&gt; &#26174;&#31034;&#30456;&#24212;&#30340;&#25351;&#23450;&#30340;&#25253;&#25991;&#20449;&#24687;&#65292;&#22914;&#65306;%{http_code}&#65292;%{remote_ip}&#31561;
-m, --max-time &lt;time&gt; &#20801;&#35768;&#26368;&#22823;&#20256;&#36755;&#26102;&#38388;</span>
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#curl -I http://www.163.com
HTTP/1.1 403 Forbidden
Date: Thu, 12 Dec 2019 01:18:11 GMT
Content-Type: text/html
Content-Length: 234
Connection: keep-alive
Server: web cache
Expires: Thu, 12 Dec 2019 01:18:11 GMT
X-Ser: BC14_lt-tianjin-tianjin-3-cache-3
Cache-Control: no-cache,no-store,private
cdn-user-ip: 123.118.223.243
cdn-ip: 125.39.21.14
X-Cache-Remote: HIT
cdn-source: baishan

[root@centos8 ~]#curl -I -A ie10 http://www.163.com
HTTP/1.1 200 OK
Date: Thu, 12 Dec 2019 01:19:30 GMT
Content-Type: text/html; <span style="color: #a0522d;">charset</span>=GBK
Connection: keep-alive
Expires: Thu, 12 Dec 2019 01:20:45 GMT
Server: nginx
Cache-Control: no-cache,no-store,private
Age: 5
Vary: Accept-Encoding
X-Ser: BC20_dx-lt-yd-fujian-xiamen-8-cache-2, BC57_dx-lt-yd-fujian-xiamen-8-
cache-2, BC5_lt-tianjin-tianjin-3-cache-3, BC13_lt-tianjin-tianjin-3-cache-3
cdn-user-ip: 123.118.223.243
cdn-ip: 125.39.21.13
X-Cache-Remote: HIT
cdn-source: baishan

[root@centos6 ~]#curl -H <span style="color: #8b2252;">"user-agent: firefox"</span> 192.168.100.8
</pre>
</div>

<p>
范例：利用curl 获取响应码和远程主机IP
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@ubuntu ~]#curl -s -I -m10 -o /dev/null -w %{http_code} http://www.baidu.com/
200
[root@ubuntu ~]#curl -s -I -m10 -o /dev/null -w %{remote_ip} http://cicin.com/
58.87.87.99
[root@centos8 ~]#curl -s -I -m10 -o /dev/null -w %{local_ip} http://cicin.com/
10.0.0.8
[root@centos8 ~]#curl -s -I -m10 -o /dev/null -w %{local_port}  http://cicin.com/
45304
[root@centos8 ~]#curl -s -I -m10 -o /dev/null -w %{remote_port} http://cicin.com/
80
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a0b8aa96-25f8-4c8c-b9a4-72ffe707d539" class="outline-3">
<h3 id="h:a0b8aa96-25f8-4c8c-b9a4-72ffe707d539">httpie</h3>
<div class="outline-text-3" id="text-h:a0b8aa96-25f8-4c8c-b9a4-72ffe707d539">
<p>
HTTPie 工具是现代的 HTTP 命令行客户端，它能通过命令行界面与 Web
服务进行交互。它提供一个简单的 http
命令，允许使用简单而自然的语法发送任意的 HTTP 请求，并会显示彩色的输出
</p>

<p>
HTTPie 能用于测试、调试及与 HTTP 服务器交互。
</p>

<p>
主要特点：
</p>

<ul class="org-ul">
<li>具表达力的和直观语法</li>
<li>格式化的及彩色化的终端输出</li>
<li>内置 JSON 支持</li>
<li>表单和文件上传</li>
<li>HTTPS、代理和认证</li>
<li>任意请求数据</li>
<li>自定义头部</li>
<li>持久化会话</li>
<li>类似 wget 的下载</li>
<li>支持 Python 2.7 和 3.x</li>
</ul>

<p>
官方网站：<a href="https://httpie.org">https://httpie.org</a>
</p>

<p>
安装：基于EPEL（CentOS 8 目前还不支持）
</p>

<div class="org-src-container">
<pre class="src src-sh">yum install httpie
</pre>
</div>

<p>
范例：查看帮助
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@Centos7 ~]#http --help
usage: http [--json] [--form] [--pretty {all,colors,format,none}]
            [--style STYLE] [--print WHAT] [--headers] [--body] [--verbose]
            [--all] [--history-print WHAT] [--stream] [--output FILE]
            [--download] [--continue]
            [--session SESSION_NAME_OR_PATH | --session-read-only SESSION_NAME_OR_PATH]
            [--auth USER[:PASS]] [--auth-type {basic,digest}]
            [--proxy PROTOCOL:PROXY_URL] [--follow]
            [--max-redirects MAX_REDIRECTS] [--timeout SECONDS]
            [--check-status] [--verify VERIFY]
            [--ssl {ssl2.3,ssl3,tls1,tls1.1,tls1.2}] [--cert CERT]
            [--cert-key CERT_KEY] [--ignore-stdin] [--help] [--version]
            [--traceback] [--debug]
            [METHOD] URL [REQUEST_ITEM [REQUEST_ITEM ...]]
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26174;&#31034;&#20449;&#24687;&#65288;&#21253;&#21547;&#21709;&#24212;&#22836;200&#65289;
</span>http www.ciciedu.com

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26174;&#31034;&#35814;&#32454;&#30340;&#35831;&#27714;&#65288;&#21253;&#21547;&#35831;&#27714;&#21644;&#36820;&#22238;&#22836;200&#65289;
</span>http -v www.ciciedu.com

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#26174;&#31034;Header
</span>http -h www.ciciedu.com
http --head www.ciciedu.com
http --header www.ciciedu.com
http --headers www.ciciedu.com

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#26174;&#31034;Body
</span>http -b www.ciciedu.com
http --body ciciedu.com

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#36733;&#25991;&#20214;
</span>http -d www.ciciedu.com

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#27169;&#25311;&#25552;&#20132;&#34920;&#21333;
</span>http -f POST www.ciciedu.com <span style="color: #a0522d;">username</span>=<span style="color: #8b2252;">'wang'</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35831;&#27714;&#21024;&#38500;&#30340;&#26041;&#27861;
</span>http DELETE www.ciciedu.com

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20256;&#36882;JSON&#25968;&#25454;&#35831;&#27714;(&#40664;&#35748;&#23601;&#26159;JSON&#25968;&#25454;&#35831;&#27714;)
</span>http PUT www.ciciedu.com <span style="color: #a0522d;">username</span>=<span style="color: #8b2252;">'wang'</span> <span style="color: #a0522d;">password</span>=<span style="color: #8b2252;">'ciciedu'</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;JSON&#25968;&#25454;&#23384;&#22312;&#19981;&#26159;&#23383;&#31526;&#20018;&#21017;&#29992;:=&#20998;&#38548;&#65292;&#20363;&#22914;
</span>http PUT www.ciciedu.com <span style="color: #a0522d;">username</span>=<span style="color: #8b2252;">'wang'</span> <span style="color: #a0522d;">password</span>=<span style="color: #8b2252;">'ciciedu'</span> age:=30 a:=true
streets:=<span style="color: #8b2252;">'["a", "b"]'</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#27169;&#25311;Form&#30340;Post&#35831;&#27714;, Content-Type: application/x-www-form-urlencoded;
</span><span style="color: #a0522d;">charset</span>=utf-8
http --form POST www.ciciedu.com <span style="color: #a0522d;">username</span>=<span style="color: #8b2252;">'wang'</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#27169;&#25311;Form&#30340;&#19978;&#20256;, Content-Type: multipart/form-data
</span>http -f POST www.ciciedu.com/jobs <span style="color: #a0522d;">username</span>=<span style="color: #8b2252;">'wang'</span> file@~/test.pdf

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;&#35831;&#27714;&#22836;, &#20351;&#29992;:&#20998;&#38548;
</span>http www.ciciedu.com User-Agent:ciciedu-agent/1.0 <span style="color: #8b2252;">'Cookie:a=b;b=c'</span>
Referer:http://www.google.com/

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35748;&#35777;
</span>http -a username:password www.ciciedu.com
http -A basic -a username:password www.ciciedu.com

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992;http&#20195;&#29702;
</span>http --proxy=http:http://172.16.0.100:8081 proxy.ciciedu.com
http --proxy=http:http://user:pass@172.16.0.100:8081 proxy.ciciedu.com
http --proxy=https:http://172.16.0.100:8118 proxy.ciciedu.com
http --proxy=https:http://user:pass@172.16.0.100:8118 proxy.ciciedu.com
</pre>
</div>


<figure id="orgadb93ff">
<img src="./images/20200706233746760.png" alt="20200706233746760.png">

</figure>

<p>
范例：查看信息及响应头
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#http 192.168.8.8/test.html
HTTP/1.1 200 OK
Accept-Ranges: bytes
Connection: Keep-Alive
Content-Length: 30
Content-Type: text/html; <span style="color: #a0522d;">charset</span>=UTF-8
Date: Thu, 07 Nov 2019 09:09:34 GMT
ETag: <span style="color: #8b2252;">"1e-596be05bc9a34"</span>
Keep-Alive: <span style="color: #a0522d;">timeout</span>=5, <span style="color: #a0522d;">max</span>=100
Last-Modified: Thu, 07 Nov 2019 09:09:27 GMT
Server: Apache/2.4.37 (centos)

&lt;strong&gt;&#39532;&#21733;&#25945;&#32946;&lt;/strong&gt;
</pre>
</div>

<p>
范例：查看请示和响应头部及信息
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#http -v 192.168.8.8/test.html
GET /test.html HTTP/1.1
Accept: */*
Accept-Encoding: gzip, deflate
Connection: keep-alive
Host: 192.168.8.8
User-Agent: HTTPie/0.9.4

HTTP/1.1 200 OK
Accept-Ranges: bytes
Connection: Keep-Alive
Content-Length: 30
Content-Type: text/html; <span style="color: #a0522d;">charset</span>=UTF-8
Date: Thu, 07 Nov 2019 09:09:39 GMT
ETag: <span style="color: #8b2252;">"1e-596be05bc9a34"</span>
Keep-Alive: <span style="color: #a0522d;">timeout</span>=5, <span style="color: #a0522d;">max</span>=100
Last-Modified: Thu, 07 Nov 2019 09:09:27 GMT
Server: Apache/2.4.37 (centos)

&lt;strong&gt;&#39532;&#21733;&#25945;&#32946;&lt;/strong&gt;
</pre>
</div>

<p>
范例：查看响应报文头部
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#http HEAD http://www.ciciedu.com
HTTP/1.1 200 OK
Connection: keep-alive
Content-Encoding: gzip
Content-Type: text/html; <span style="color: #a0522d;">charset</span>=UTF-8
Date: Thu, 07 Nov 2019 08:09:49 GMT
Link: <a href="http://www.ciciedu.com/wp-json/">&lt;http://www.ciciedu.com/wp-json/&gt;</a>; <span style="color: #a0522d;">rel</span>=<span style="color: #8b2252;">"https://api.w.org/"</span>
Link: <a href="http://www.ciciedu.com/">&lt;http://www.ciciedu.com/&gt;</a>; <span style="color: #a0522d;">rel</span>=shortlink
Server: Tengine
Vary: Accept-Encoding
Vary: Accept-Encoding, Cookie
</pre>
</div>

<p>
范例： 查看请求和响应报文头部
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#http -p Hh http://www.ciciedu.com
GET / HTTP/1.1
Accept: */*
Accept-Encoding: gzip, deflate
Connection: keep-alive
Host: www.ciciedu.com
User-Agent: HTTPie/0.9.4

HTTP/1.1 200 OK
Cache-Control: max-age=3, must-revalidate
Connection: keep-alive
Content-Encoding: gzip
Content-Type: text/html; <span style="color: #a0522d;">charset</span>=UTF-8
Date: Thu, 07 Nov 2019 03:44:14 GMT
Server: Tengine
Transfer-Encoding: chunked
Vary: Accept-Encoding
Vary: Accept-Encoding, Cookie
</pre>
</div>

<p>
范例：指定请求头部的首部字段
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#http -p H http://www.ciciedu.com User-Agent:wangtest
Referer:http://www.baidu.com
GET / HTTP/1.1
Accept: */*
Accept-Encoding: gzip, deflate
Connection: keep-alive
Host: www.ciciedu.com
Referer: http://www.baidu.com
User-Agent: wangtest
</pre>
</div>

<p>
范例：下载资源
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;1
</span>[root@centos7 ~]#http http://www.ciciedu.com/wpcontent/uploads/2018/12/2018122312035677.png &gt; logo.png
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;2
</span>[root@centos7 ~]#file logo.png
logo.png: PNG image data, 411 x 127, 8-bit/color RGBA, non-interlaced
[root@centos7 ~]#http --download http://www.ciciedu.com/wpcontent/uploads/2018/12/2018122312035677.png
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: max-age=604800
Connection: keep-alive
Content-Length: 8983
Content-Type: image/png
Date: Thu, 07 Nov 2019 08:20:44 GMT
ETag: <span style="color: #8b2252;">"5c1f79ac-2317"</span>
Expires: Thu, 14 Nov 2019 08:20:44 GMT
Last-Modified: Sun, 23 Dec 2018 12:03:56 GMT
Server: Tengine
Vary: Accept-Encoding

Downloading 8.77 kB to <span style="color: #8b2252;">"2018122312035677.png"</span>
Done. 8.77 kB<span style="color: #a020f0;"> in</span> 0.00091s (9.46 MB/s)
</pre>
</div>

<p>
范例：用POST方法提交json格式的数据
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#http http://www.ciciedu.com <span style="color: #a0522d;">user</span>=wang <span style="color: #a0522d;">password</span>=ciciedu
</pre>
</div>


<figure id="org3c5c41f">
<img src="./images/20200706182059394.png" alt="20200706182059394.png">

</figure>

<p>
范例：用POST方法，指交表单数据
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#http -f POST http://www.ciciedu.com <span style="color: #a0522d;">user</span>=wang <span style="color: #a0522d;">password</span>=ciciedu
</pre>
</div>


<figure id="org7011824">
<img src="./images/20200706182108508.png" alt="20200706182108508.png">

</figure>
</div>
</div>
<div id="outline-container-h:7c34faa2-d072-4de8-b4b5-6e3924a983c4" class="outline-3">
<h3 id="h:7c34faa2-d072-4de8-b4b5-6e3924a983c4">压力测试工具</h3>
<div class="outline-text-3" id="text-h:7c34faa2-d072-4de8-b4b5-6e3924a983c4">
<p>
httpd的压力测试工具：
</p>

<ul class="org-ul">
<li>ab, webbench, http_load, seige</li>
<li>Jmeter 开源</li>
<li>Loadrunner 商业，有相关认证</li>
<li>tcpcopy：网易，复制生产环境中的真实请求，并将之保存</li>
</ul>

<p>
ab 来自httpd-tools包
</p>

<p>
命令格式
</p>

<div class="org-src-container">
<pre class="src src-sh">ab [OPTIONS] URL
</pre>
</div>

<p>
常见选项
</p>

<p>
-n：总请求数
</p>

<p>
-c：模拟的并发数
</p>

<p>
-k：以持久连接模式测试
</p>

<p>
说明：并发数高于1024时，需要用 ulimit &#x2013;n # 调整能打开的文件数
</p>
</div>
</div>
<div id="outline-container-h:8df40b1a-191f-42bd-9c32-9c67718f505d" class="outline-3">
<h3 id="h:8df40b1a-191f-42bd-9c32-9c67718f505d">httpd自带的工具程序</h3>
<div class="outline-text-3" id="text-h:8df40b1a-191f-42bd-9c32-9c67718f505d">
<p>
htpasswd：basic认证基于文件实现时，用到的账号密码文件生成工具
</p>

<p>
apachectl：httpd自带的服务控制脚本，支持start和stop
</p>

<p>
rotatelogs：日志滚动工具
</p>

<div class="org-src-container">
<pre class="src src-sh">access.log --&gt;
   access.log, access.1.log --&gt;
      access.log, acccess.1.log, access.2.log
</pre>
</div>



<p>
摘要：本文介绍LAMP架构
</p>

<p>
[toc]
</p>
</div>
</div>
</section>
<section id="outline-container-h:4ee11918-bdbb-439d-a154-883b9e850bbb" class="outline-2">
<h2 id="h:4ee11918-bdbb-439d-a154-883b9e850bbb">实现LAMP架构</h2>
<div class="outline-text-2" id="text-h:4ee11918-bdbb-439d-a154-883b9e850bbb">
<p>
本章内容
</p>
<ul class="org-ul">
<li><b>LAMP介绍</b></li>
<li><b>PHP配置</b></li>
<li><b>实现LAMP应用数据库管理系统phpMyadmin</b></li>
<li><b>实现LAMP应用博客系统wordpress</b></li>
<li><b>实现LAMP应用论坛系统Discuz!</b></li>
<li><b>实现LAMP应用PowerDNS</b></li>
<li><b>opcache等PHP加速器</b></li>
<li><b>PHP-FPM模式</b></li>
<li><b>源码编译安装实现LAMP</b></li>
</ul>
</div>
<div id="outline-container-h:a5e2870a-040d-43df-8f80-0cc966922235" class="outline-3">
<h3 id="h:a5e2870a-040d-43df-8f80-0cc966922235">LAMP介绍</h3>
<div class="outline-text-3" id="text-h:a5e2870a-040d-43df-8f80-0cc966922235">
</div>
<div id="outline-container-h:c19e32e6-37f7-4d78-b196-c32e7325487e" class="outline-4">
<h4 id="h:c19e32e6-37f7-4d78-b196-c32e7325487e">动态资源与语言</h4>
<div class="outline-text-4" id="text-h:c19e32e6-37f7-4d78-b196-c32e7325487e">
<p>
*WEB 资源类型*：
</p>

<ul class="org-ul">
<li>静态资源：原始形式与响应内容一致，在客户端浏览器执行</li>
<li>动态资源：原始形式通常为程序文件，需要在服务器端执行之后，将执行结果返回给客户端</li>
</ul>

<p>
注意：静态和动态的区别，不在于网页是否能动态变化，而在于服务端的页面文件和客户端得到页面文件是否一致
</p>

<p>
范例：静态资源
</p>

<div class="org-src-container">
<pre class="src src-javascript">#&#23458;&#25143;&#31471;&#20027;&#26426;&#29616;&#22312;&#30340;&#26102;&#38388;:
vim /<span style="color: #a020f0;">var</span>/www/html/test.html
&lt;script type=<span style="color: #8b2252;">"text/javascript"</span>&gt;
document.write(<span style="color: #a020f0;">new</span> <span style="color: #228b22;">Date</span>());
&lt;/script&gt;
</pre>
</div>


<figure id="org5b0e6b8">
<img src="./images/20200710083241321.png" alt="20200710083241321.png">

</figure>


<figure id="orgea89089">
<img src="./images/20200710083252145.png" alt="20200710083252145.png">

</figure>

<p>
<b>WEB 相关语言</b>
</p>

<p>
客户端技术： html，javascript，css
</p>

<p>
服务器端技术：php，python，javascript（Node.js），jsp，asp，Perl、Ruby
</p>
</div>
</div>
<div id="outline-container-h:7352551d-16b9-47b4-9e05-91958f5314c4" class="outline-4">
<h4 id="h:7352551d-16b9-47b4-9e05-91958f5314c4">LAMP架构组成</h4>
<div class="outline-text-4" id="text-h:7352551d-16b9-47b4-9e05-91958f5314c4">

<figure id="org92b03ad">
<img src="./images/20200710083333886.png" alt="20200710083333886.png">

</figure>

<p>
LAM(M)P：
</p>

<ul class="org-ul">
<li>L：linux</li>
<li>A：apache (httpd)</li>
<li>M：mysql, mariadb</li>
<li>P：php, perl, python</li>
</ul>


<figure id="org7d3575b">
<img src="./images/20200710083438689.png" alt="20200710083438689.png">

</figure>
</div>
</div>
<div id="outline-container-h:76ec4b9b-e2ca-4a9a-b60a-53f4f088d64a" class="outline-4">
<h4 id="h:76ec4b9b-e2ca-4a9a-b60a-53f4f088d64a">CGI和fastcgi</h4>
<div class="outline-text-4" id="text-h:76ec4b9b-e2ca-4a9a-b60a-53f4f088d64a">
</div>
<div id="outline-container-h:410ff47d-b1f7-4d60-8532-2e08d7760c25" class="outline-5">
<h5 id="h:410ff47d-b1f7-4d60-8532-2e08d7760c25">CGI</h5>
<div class="outline-text-5" id="text-h:410ff47d-b1f7-4d60-8532-2e08d7760c25">
<p>
CGI：Common Gateway Interface 公共网关接口
</p>

<p>
CGI
在2000年或更早的时候用得比较多，以前web服务器一般只处理静态的请求，如果碰到一个动态请求怎么办呢？web服务器会根据这次请求的内容，然后会
fork 一个新进程来运行外部的 C
程序或者bash,perl脚本等，这个进程会把处理完的数据返回给web服务器，最后web服务器把内容发送给用户，刚才fork的进程也随之退出。
如果下次用户还请求改动态脚本，那么web服务器又再次fork一个新进程，周而复始的进行。
</p>

<p>
CGI
可以让一个客户端，从网页浏览器通过http服务器向执行在网络服务器上的程序传输数据；CGI描述了客户端和服务器程序之间传输的一种标准
</p>

<p>
<b>请求流程</b> ：
</p>

<p>
Client &#x2013; (http协议) &#x2013;&gt; httpd &#x2013; (cgi协议) &#x2013;&gt; application server
(program file) &#x2013; (mysql协议) &#x2013;&gt; mysql
</p>

<p>
范例：httpd 利用CGI运行shell脚本
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#vim /etc/httpd/conf/httpd.conf
...&#30465;&#30053;...
&lt;directory /data/script&gt;
require all granted
&lt;/directory&gt;
&lt;IfModule alias_module&gt;
...&#30465;&#30053;...
<span style="color: #b22222;">#</span><span style="color: #b22222;">ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
</span>ScriptAlias /sh/ <span style="color: #8b2252;">"/data/script/"</span>   <span style="color: #b22222;">#</span><span style="color: #b22222;">/sh/&#26159;/data/script/&#30340;&#21035;&#21517;
</span>&lt;/IfModule&gt;
&lt;directory /data/script&gt;
require all granted
&lt;/directory&gt;
...&#30465;&#30053;...

[root@centos8 ~]#cat /data/script/cgi.sh
<span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/bash
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span>cat &lt;&lt; EOF<span style="color: #ffa54f;">
Content-Type: text/html     #&#21709;&#24212;&#25253;&#25991;&#30340;&#20869;&#23481;

&lt;pre&gt;
My username is: $(id -un)
My id is: $(id -u)

My shell settings are:
$(set)

My environment variables are:
$(env)

Here is the file in /etc:
$(ls -l /etc/redhat-release )
$( cat /etc/redhat-release )
&lt;/pre&gt;
EOF
</span>[root@centos8 ~]#chmod +x /data/script/cgi.sh
[root@centos8 ~]#ll /data/script/cgi.sh
-rwxr-xr-x 1 root root 269 Dec 21 21:08 /data/script/cgi.sh

[root@centos8 ~]#curl http://10.0.0.8/sh/cgi.sh
&lt;pre&gt;
My username is: apache
My id is: 48

My shell settings are:
<span style="color: #a0522d;">BASH</span>=/bin/bash
<span style="color: #a0522d;">BASHOPTS</span>=cmdhist:complete_fullquote:extquote:force_fignore:hostcomplete:interact
ive_comments:progcomp:promptvars:sourcepath
<span style="color: #a0522d;">BASH_ALIASES</span>=()
<span style="color: #a0522d;">BASH_ARGC</span>=()
<span style="color: #a0522d;">BASH_ARGV</span>=()
<span style="color: #a0522d;">BASH_CMDS</span>=()
<span style="color: #a0522d;">BASH_LINENO</span>=([0]=<span style="color: #8b2252;">"0"</span>)
<span style="color: #a0522d;">BASH_SOURCE</span>=([0]=<span style="color: #8b2252;">"/data/script/cgi.sh"</span>)
<span style="color: #a0522d;">BASH_VERSINFO</span>=([0]=<span style="color: #8b2252;">"4"</span> [1]=<span style="color: #8b2252;">"4"</span> [2]=<span style="color: #8b2252;">"19"</span> [3]=<span style="color: #8b2252;">"1"</span> [4]=<span style="color: #8b2252;">"release"</span> [5]=<span style="color: #8b2252;">"x86_64-
redhat-linux-gnu"</span>)
<span style="color: #a0522d;">BASH_VERSION</span>=<span style="color: #8b2252;">'4.4.19(1)-release'</span>
<span style="color: #a0522d;">CONTEXT_DOCUMENT_ROOT</span>=/data/script/
<span style="color: #a0522d;">CONTEXT_PREFIX</span>=/sh/
<span style="color: #a0522d;">DIRSTACK</span>=()
<span style="color: #a0522d;">DOCUMENT_ROOT</span>=/var/www/html
<span style="color: #a0522d;">EUID</span>=48
<span style="color: #a0522d;">GATEWAY_INTERFACE</span>=CGI/1.1
<span style="color: #a0522d;">GROUPS</span>=()
<span style="color: #a0522d;">HOSTNAME</span>=centos8.localdomain
<span style="color: #a0522d;">HOSTTYPE</span>=x86_64
<span style="color: #a0522d;">HTTP_ACCEPT</span>=<span style="color: #8b2252;">'*/*'</span>
<span style="color: #a0522d;">HTTP_HOST</span>=10.0.0.8
<span style="color: #a0522d;">HTTP_USER_AGENT</span>=curl/7.61.1
<span style="color: #a0522d;">IFS</span>=$<span style="color: #8b2252;">' \t\n'</span>
<span style="color: #a0522d;">MACHTYPE</span>=x86_64-redhat-linux-gnu
<span style="color: #a0522d;">OPTERR</span>=1
<span style="color: #a0522d;">OPTIND</span>=1
<span style="color: #a0522d;">OSTYPE</span>=linux-gnu
<span style="color: #a0522d;">PATH</span>=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
<span style="color: #a0522d;">PPID</span>=11692
<span style="color: #a0522d;">PS4</span>=<span style="color: #8b2252;">'+ '</span>
<span style="color: #a0522d;">PWD</span>=/data/script
<span style="color: #a0522d;">QUERY_STRING</span>=
<span style="color: #a0522d;">REMOTE_ADDR</span>=10.0.0.8
<span style="color: #a0522d;">REMOTE_PORT</span>=56396
<span style="color: #a0522d;">REQUEST_METHOD</span>=GET
<span style="color: #a0522d;">REQUEST_SCHEME</span>=http
<span style="color: #a0522d;">REQUEST_URI</span>=/sh/cgi.sh
<span style="color: #a0522d;">SCRIPT_FILENAME</span>=/data/script/cgi.sh
<span style="color: #a0522d;">SCRIPT_NAME</span>=/sh/cgi.sh
<span style="color: #a0522d;">SERVER_ADDR</span>=10.0.0.8
<span style="color: #a0522d;">SERVER_ADMIN</span>=root@localhost
<span style="color: #a0522d;">SERVER_NAME</span>=10.0.0.8
<span style="color: #a0522d;">SERVER_PORT</span>=80
<span style="color: #a0522d;">SERVER_PROTOCOL</span>=HTTP/1.1
<span style="color: #a0522d;">SERVER_SIGNATURE</span>=
<span style="color: #a0522d;">SERVER_SOFTWARE</span>=<span style="color: #8b2252;">'Apache/2.4.37 (centos)'</span>
<span style="color: #a0522d;">SHELL</span>=/sbin/nologin
<span style="color: #a0522d;">SHELLOPTS</span>=braceexpand:hashall:interactive-comments
<span style="color: #a0522d;">SHLVL</span>=1
<span style="color: #a0522d;">TERM</span>=dumb
<span style="color: #a0522d;">UID</span>=48
<span style="color: #a0522d;">UNIQUE_ID</span>=Xf4ZhJSefdICWmRjEggE1wAAAAg
<span style="color: #a0522d;">_</span>=/bin/bash

My environment variables are:
<span style="color: #a0522d;">HTTP_HOST</span>=10.0.0.8
<span style="color: #a0522d;">CONTEXT_DOCUMENT_ROOT</span>=/data/script/
<span style="color: #a0522d;">HTTP_USER_AGENT</span>=curl/7.61.1
<span style="color: #a0522d;">SERVER_ADMIN</span>=root@localhost
<span style="color: #a0522d;">CONTEXT_PREFIX</span>=/sh/
<span style="color: #a0522d;">SERVER_PORT</span>=80
<span style="color: #a0522d;">SERVER_NAME</span>=10.0.0.8
<span style="color: #a0522d;">QUERY_STRING</span>=
<span style="color: #a0522d;">SCRIPT_FILENAME</span>=/data/script/cgi.sh
<span style="color: #a0522d;">PWD</span>=/data/script
<span style="color: #a0522d;">HTTP_ACCEPT</span>=*/*
<span style="color: #a0522d;">REQUEST_METHOD</span>=GET
<span style="color: #a0522d;">SERVER_SIGNATURE</span>=
<span style="color: #a0522d;">SCRIPT_NAME</span>=/sh/cgi.sh
<span style="color: #a0522d;">REMOTE_PORT</span>=56396
<span style="color: #a0522d;">UNIQUE_ID</span>=Xf4ZhJSefdICWmRjEggE1wAAAAg
<span style="color: #a0522d;">DOCUMENT_ROOT</span>=/var/www/html
<span style="color: #a0522d;">SHLVL</span>=1
<span style="color: #a0522d;">SERVER_PROTOCOL</span>=HTTP/1.1
<span style="color: #a0522d;">REQUEST_URI</span>=/sh/cgi.sh
<span style="color: #a0522d;">PATH</span>=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
<span style="color: #a0522d;">SERVER_ADDR</span>=10.0.0.8
<span style="color: #a0522d;">GATEWAY_INTERFACE</span>=CGI/1.1
<span style="color: #a0522d;">REQUEST_SCHEME</span>=http
<span style="color: #a0522d;">REMOTE_ADDR</span>=10.0.0.8
<span style="color: #a0522d;">SERVER_SOFTWARE</span>=Apache/2.4.37 (centos)
<span style="color: #a0522d;">_</span>=/usr/bin/env

Here is the file<span style="color: #a020f0;"> in</span> /etc:
lrwxrwxrwx. 1 root root 14 Aug 14 14:42 /etc/redhat-release -&gt; centos-release
CentOS Linux release 8.0.1905 (Core)
&lt;/pre&gt;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35266;&#23519;&#38169;&#35823;&#26085;&#24535;
</span>[root@centos8 ~]#tail /var/log/httpd/error_log

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;cgi.sh&#26368;&#21518;&#21152;&#19968;&#34892;sleep 100
</span>[root@centos8 ~]#vim /data/script/cgi.sh
[root@centos8 ~]#tail -3 /data/script/cgi.sh
&lt;/pre&gt;
EOF
rm -rf /data/script
sleep 100

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20877;&#27425;&#36816;&#34892;&#21518;&#65292;&#21487;&#20197;&#35266;&#23519;&#21040;&#19979;&#38754;&#36827;&#31243;&#26641;
</span>[root@centos8 ~]#curl http://10.0.0.8/sh/cgi.sh
</pre>
</div>


<figure id="orgad444f2">
<img src="./images/20200710083511850.png" alt="20200710083511850.png">

</figure>

<p>
如果多次访问,可以看到开启了多个子进程
</p>


<figure id="orgc4aee38">
<img src="./images/20200710083526608.png" alt="20200710083526608.png">

</figure>
</div>
</div>
<div id="outline-container-h:28497813-34a5-461d-a5d0-6ffe718c8172" class="outline-5">
<h5 id="h:28497813-34a5-461d-a5d0-6ffe718c8172">fastcgi</h5>
<div class="outline-text-5" id="text-h:28497813-34a5-461d-a5d0-6ffe718c8172">
<p>
fastcgi的方式是，web服务器收到一个请求时，不会重新fork一个进程（因为这个进程在web服务器启动时就开启了，而且不会退出），web服务器直接把内容传递给这个进程（进程间通信，但fastcgi使用了别的方式，tcp方式通信），这个进程收到请求后进行处理，把结果返回给web服务器，最后自己接着等待下一个请求的到来，而不是退出
</p>

<p>
<b>请求流程</b> ：
</p>

<p>
Client &#x2013; (http协议) &#x2013;&gt; httpd &#x2013; (fastcgi协议) &#x2013;&gt; fastcgi服务器 &#x2013;(mysql协议) &#x2013;&gt; mysql
</p>
</div>
</div>
<div id="outline-container-h:c404b450-1fc6-41fa-8247-975c22bf615a" class="outline-5">
<h5 id="h:c404b450-1fc6-41fa-8247-975c22bf615a">CGI和fastcgi 比较</h5>
<div class="outline-text-5" id="text-h:c404b450-1fc6-41fa-8247-975c22bf615a">
<p>
CGI: 兼职, 一次性的过河拆迁式服务
</p>

<p>
FASTCGI: 专职,全周期的持续式服务
</p>


<figure id="org59e2066">
<img src="./images/2020071008371217.png" alt="2020071008371217.png">

</figure>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">名称</th>
<th scope="col" class="org-left">在web服务器方面</th>
<th scope="col" class="org-left">在对数据进行处理的进程方面</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">cgi</td>
<td class="org-left">fork一个新的进程进行处理</td>
<td class="org-left">读取参数，处理数据，然后就结束生命期</td>
</tr>

<tr>
<td class="org-left">fastcgi</td>
<td class="org-left">用tcp方式跟远程机子上的进程或本地进程建立连接</td>
<td class="org-left">要开启TCP端口，进入循环，等待数据的到来，处理数据</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-h:e41e207f-1a46-427a-9e50-945081df3fe6" class="outline-4">
<h4 id="h:e41e207f-1a46-427a-9e50-945081df3fe6">PHP</h4>
<div class="outline-text-4" id="text-h:e41e207f-1a46-427a-9e50-945081df3fe6">
</div>
<div id="outline-container-h:ed40c273-7197-4b1a-b7b0-4bed78169711" class="outline-5">
<h5 id="h:ed40c273-7197-4b1a-b7b0-4bed78169711">PHP 简介</h5>
<div class="outline-text-5" id="text-h:ed40c273-7197-4b1a-b7b0-4bed78169711">
<p>
PHP官网：<a href="http://www.php.net/">http://www.php.net/</a>
</p>

<p>
PHP是通用服务器端脚本编程语言，*主要用于web开发实现动态web页面*，也是最早实现将脚本嵌入HTML源码文档中的服务器端脚本语言之一。同时，php还提供了一个命令行接口，因此，其也可以在大多数系统上作为一个独立的shell来使用
</p>

<p>
Rasmus Lerdorf于1994年开始开发PHP，最初是一组被Rasmus
Lerdorf称作“Personal Home Page Tool” 的Perl脚本，
可以用于显示作者的简历并记录用户对其网站的访问。后来，Rasmus Lerdorf
使用 C语言将这些Perl脚本重写为CGI程序，还为其增加了运行Web
forms的能力以及与数据库交互的特性，并将其重命名为“Personal Home
Page/Forms
Interpreter”或“PHP/FI”。此时，PHP/FI已经可以用于开发简单的动态web程序了，这即PHP1.0。1995年6月，Rasmus
Lerdorf把它的PHP发布于comp.infosystems.www.authoring.cgi
Usenet讨论组，从此PHP开始走进人们的视野。1997年，其2.0版本发布
</p>

<p>
1997年，两名以色列程序员Zeev Suraski和Andi
Gutmans重写的PHP的分析器(parser)成为PHP发展到3.0的基础，而且从此将PHP重命名为PHP:
Hypertext
Preprocessor。此后，这两名程序员开始重写整个PHP核心，并于1999年发布了Zend
Engine 1.0，这也意味着PHP 4.0的诞生。2004年7月，Zend Engine
2.0发布，由此也将PHP带入了PHP
5时代。PHP5包含了许多重要的新特性，如增强的面向对象编程的支持、支持PDO(PHP
Data Objects)扩展机制以及一系列对PHP性能的改进
</p>

<p>
Zend
Engine是开源的、PHP脚本语言的解释器，它最早是由以色列理工学院(Technion)的学生Andi
Gutmans和Zeev
Suraski所开发，Zend也正是此二人名字的合称。后来两人联合创立了Zend
Technologies公司
</p>

<p>
Zend Engine 1.0于1999年随PHP
4发布，由C语言开发且经过高度优化，并能够做为PHP的后端模块使用。Zend
Engine为PHP提供了内存和资源管理的功能以及其它的一些标准服务，其高性能、可靠性和可扩展性在促进PHP成为一种流行的语言方面发挥了重要作用
</p>

<p>
Zend
Engine的出现将PHP代码的处理过程分成了两个阶段：首先是分析PHP代码并将其转换为称作Zend
opcode的二进制格式opcode(类似Java的字节码)，并将其存储于内存中；第二阶段是使用Zend
Engine去执行这些转换后的Opcode
</p>

<p>
<b>php各种版本官方支持时间：</b>
</p>

<p>
<a href="https://www.php.net/supported-versions.php">https://www.php.net/supported-versions.php</a>
</p>


<figure id="org1abd813">
<img src="./images/20200710083800165.png" alt="20200710083800165.png">

</figure>
</div>
</div>
<div id="outline-container-h:c3e67a4b-2c50-42d7-9329-2d4af0f8f923" class="outline-5">
<h5 id="h:c3e67a4b-2c50-42d7-9329-2d4af0f8f923">PHP的Opcode语言</h5>
<div class="outline-text-5" id="text-h:c3e67a4b-2c50-42d7-9329-2d4af0f8f923">
<p>
Opcode是一种PHP脚本编译后的中间语言，类似于Java的ByteCode,或者.NET的MSL
</p>

<p>
PHP的语言引擎Zend执行PHP脚本代码一般会经过如下4个步骤
</p>

<p>
1、Scanning 词法分析,将PHP代码转换为语言片段(Tokens)
</p>

<p>
2、Parsing 语义分析,将Tokens转换成简单而有意义的表达式
</p>

<p>
3、Compilation 将表达式编译成Opcode
</p>

<p>
4、Execution 顺次执行Opcode，每次一条，从而实现PHP脚本的功能
</p>

<p>
即：扫描&#x2013;&gt;分析&#x2013;&gt;编译&#x2013;&gt;执行
</p>
</div>
</div>
<div id="outline-container-h:91bd6e82-b90b-45e8-b117-702f8a1af204" class="outline-5">
<h5 id="h:91bd6e82-b90b-45e8-b117-702f8a1af204">php配置</h5>
<div class="outline-text-5" id="text-h:91bd6e82-b90b-45e8-b117-702f8a1af204">
<p>
php 的配置文件：/etc/php.ini, /etc/php.d/*.ini
</p>

<p>
配置文件在php解释器启动时被读取
</p>

<p>
对配置文件的修改生效方法
</p>

<ul class="org-ul">
<li>Modules：重启httpd服务</li>
<li>FastCGI：重启php-fpm服务</li>
</ul>

<p>
*/etc/php.ini配置文件格式*：
</p>

<div class="org-src-container">
<pre class="src src-sh">[foo]&#65306;Section Header
<span style="color: #a0522d;">directive</span> = value 
</pre>
</div>

<p>
注释符：
</p>

<ul class="org-ul">
<li>以#开头，纯粹的注释信息</li>
<li>以 ; 开头，用于注释可启用的directive</li>
</ul>

<p>
提示：较新的版本中，已经完全使用 “ ; ” 进行注释
</p>

<p>
*php.ini 配置参考文档*：
</p>

<p>
php.ini的核心配置选项文档： <a href="http://php.net/manual/zh/ini.core.php">http://php.net/manual/zh/ini.core.php</a>
</p>

<p>
php.ini配置选项列表：<a href="http://php.net/manual/zh/ini.list.php">http://php.net/manual/zh/ini.list.php</a>
</p>

<p>
<b>php常见设置：</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #a0522d;">expose_php</span> = On <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21709;&#24212;&#25253;&#25991;&#26174;&#31034;&#39318;&#37096;&#23383;&#27573;x-powered-by: PHP/x.y.z&#65292;&#26292;&#38706;php&#29256;&#26412;&#65292;&#24314;&#35758;&#20026;off
</span><span style="color: #a0522d;">max_execution_time</span>= 30 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26368;&#38271;&#25191;&#34892;&#26102;&#38388;30s
</span><span style="color: #a0522d;">memory_limit</span>=128M <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#20135;&#19981;&#22815;&#65292;&#21487;&#35843;&#22823;
</span><span style="color: #a0522d;">display_errors</span>=off <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35843;&#35797;&#20351;&#29992;&#65292;&#19981;&#35201;&#25171;&#24320;&#65292;&#21542;&#21017;&#21487;&#33021;&#26292;&#38706;&#37325;&#35201;&#20449;&#24687;
</span><span style="color: #a0522d;">display_startup_errors</span>=off <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24314;&#35758;&#20851;&#38381;
</span><span style="color: #a0522d;">post_max_size</span>=8M <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26368;&#22823;&#19978;&#20256;&#25968;&#25454;&#22823;&#23567;&#65292;&#29983;&#20135;&#21487;&#33021;&#35843;&#22823;&#65292;&#27604;&#19979;&#38754;&#39033;&#22823;
</span><span style="color: #a0522d;">upload_max_filesize</span> =2M <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26368;&#22823;&#19978;&#20256;&#25991;&#20214;&#65292;&#29983;&#20135;&#21487;&#33021;&#35201;&#35843;&#22823;
</span><span style="color: #a0522d;">max_file_uploads</span> = 20 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21516;&#26102;&#19978;&#20256;&#26368;&#22810;&#25991;&#20214;&#25968;
</span>date.timezone =Asia/Shanghai <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450;&#26102;&#21306;
</span><span style="color: #a0522d;">short_open_tag</span>=on <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24320;&#21551;&#30701;&#26631;&#31614;,&#22914;: &lt;? phpinfo();?&gt;</span>
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#yum -y install httpd php
[root@centos7 ~]#systemctl start httpd
[root@centos7 ~]#cat /var/www/html/test.php
&lt;?php
<span style="color: #0000ff;">phpinfo</span>();
?&gt;

[root@centos7 ~]#cat /var/www/html/session.php
&lt;?php
<span style="color: #0000ff;">session_start</span>();
<span style="color: #483d8b;">echo</span> session_id();
?&gt;

[root@centos6 ~]#curl -I 10.0.0.7/test.php
HTTP/1.1 200 OK
date: Thu, 02 Apr 2020 04:02:57 GMT
server: Apache/2.4.6 (CentOS) PHP/5.4.16
x-powered-by: PHP/5.4.16 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26292;&#38706;PHP&#29256;&#26412;&#20449;&#24687;
</span>content-type: text/html; <span style="color: #a0522d;">charset</span>=UTF-8
cache-control: private

[root@centos7 ~]#vim /etc/php.ini
<span style="color: #a0522d;">expose_php</span> = Off
[root@centos7 ~]#systemctl restart httpd

[root@centos6 ~]#curl -I 10.0.0.7/test.php
HTTP/1.1 200 OK
date: Thu, 02 Apr 2020 04:03:59 GMT
server: Apache/2.4.6 (CentOS)
content-type: text/html; <span style="color: #a0522d;">charset</span>=UTF-8
cache-control: private

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#20250;&#35805;&#20449;&#24687;
</span>[root@centos6 ~]#curl http://10.0.0.7/session.php
9eun59j4a7j9f115cfr7dl14c2
[root@centos6 ~]#curl http://10.0.0.7/session.php
6tknsvrnn1lqgt9j3t9lue19p7

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#29983;&#25104;&#30340;&#20250;&#35805;&#25991;&#20214;
</span>[root@centos7 ~]#ll -d /var/lib/php/session    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38656;&#35201;&#19968;&#23450;&#30340;&#26435;&#38480;
</span>drwxrwx--- 2 root apache 6 Apr 1 12:11 /var/lib/php/session    
[root@centos7 ~]#ll /var/lib/php/session
total 0
-rw------- 1 apache apache 0 Jun 29 14:46 sess_6tknsvrnn1lqgt9j3t9lue19p7
-rw------- 1 apache apache 0 Jun 29 14:43 sess_9eun59j4a7j9f115cfr7dl14c2
</pre>
</div>
</div>
</div>
<div id="outline-container-h:e9212390-9904-4f48-bc53-35e69126eb7d" class="outline-5">
<h5 id="h:e9212390-9904-4f48-bc53-35e69126eb7d">PHP语言格式</h5>
<div class="outline-text-5" id="text-h:e9212390-9904-4f48-bc53-35e69126eb7d">
<p>
php语言有两种使用格式：
</p>

<p>
<b>格式 1</b>
</p>

<div class="org-src-container">
<pre class="src src-php">&lt;?php
    echo "&lt;h1&gt;Hello world!&lt;/h1&gt;"
?&gt;
</pre>
</div>

<p>
<b>格式 2</b>
</p>

<div class="org-src-container">
<pre class="src src-php">&lt;h1&gt;
    &lt;?php echo "Hello world!" ?&gt;
&lt;/h1&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6483684e-ec76-4bed-a8c1-4267542568b3" class="outline-5">
<h5 id="h:6483684e-ec76-4bed-a8c1-4267542568b3">php测试代码</h5>
<div class="outline-text-5" id="text-h:6483684e-ec76-4bed-a8c1-4267542568b3">
<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]# cat /var/www/html/phpinfo.php
&lt;?php
    <span style="color: #483d8b;">echo</span> date(<span style="color: #8b2252;">"Y/m/d H:i:s"</span>);
    phpinfo();
?&gt;
[root@centos8 ~]#curl 127.0.0.1/phpinfo.php

[root@centos8 ~]#cat ./phpinfo.php
<span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/php
</span>&lt;?php
<span style="color: #0000ff;">phpinfo</span>();
?&gt;
[root@centos8 ~]#chmod +x ./phpinfo.php
[root@centos8 ~]#./phpinfo.php
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:5c88b6b5-0334-40d7-8007-cd216d7becaf" class="outline-4">
<h4 id="h:5c88b6b5-0334-40d7-8007-cd216d7becaf">LAMP实现方式</h4>
<div class="outline-text-4" id="text-h:5c88b6b5-0334-40d7-8007-cd216d7becaf">
<p>
httpd
接收用户的web请求；静态资源则直接响应；动态资源为php脚本，对此类资源的请求将交由php来运行
</p>

<p>
<b>httpd与php结合的方式</b>
</p>

<ul class="org-ul">
<li>modules ：将php编译成为httpd的模块libphp5.so，只有prefork 模式才支持</li>
<li>FastCGI</li>
</ul>

<p>
<b>LAMP架构实现</b>
</p>

<ul class="org-ul">
<li><p>
静态资源：
</p>

<p>
Client &#x2013; http &#x2013;&gt; httpd
</p></li>

<li><p>
动态资源：
</p>

<p>
Client &#x2013; http &#x2013;&gt; httpd &#x2013;&gt; libphp5.so () &#x2013; mysql &#x2013;&gt; MySQL server<br>
Client &#x2013; http &#x2013;&gt; httpd &#x2013;&gt;fastcgi&#x2013; mysql &#x2013;&gt; MySQL server
</p></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:9b75b62f-c19b-4bf1-8ea6-dc35dc1dc5d8" class="outline-3">
<h3 id="h:9b75b62f-c19b-4bf1-8ea6-dc35dc1dc5d8">实现LAMP</h3>
<div class="outline-text-3" id="text-h:9b75b62f-c19b-4bf1-8ea6-dc35dc1dc5d8">
</div>
<div id="outline-container-h:e78fd958-7511-4ea6-b286-44b527b89123" class="outline-4">
<h4 id="h:e78fd958-7511-4ea6-b286-44b527b89123">利用rpm包实现LAMP安装部署</h4>
<div class="outline-text-4" id="text-h:e78fd958-7511-4ea6-b286-44b527b89123">
<p>
CentOS 8
</p>

<p>
Module 模块方式
</p>

<div class="org-src-container">
<pre class="src src-sh">dnf install httpd mariadb-server php php-mysqlnd
</pre>
</div>

<p>
FastCGI 方式
</p>

<div class="org-src-container">
<pre class="src src-sh">dnf install httpd mariadb-server php-fpm php-mysqlnd
</pre>
</div>

<p>
CentOS 7<br>
Module 模块方式
</p>

<div class="org-src-container">
<pre class="src src-sh">yum install httpd mariadb-server php php-mysql
</pre>
</div>

<p>
FastCGI 方式
</p>

<div class="org-src-container">
<pre class="src src-sh">yum install httpd php-fpm php-mysql mariadb-server
</pre>
</div>

<p>
CentOS 6：
</p>

<p>
Module 模块方式
</p>

<div class="org-src-container">
<pre class="src src-sh">yum install httpd, php, php-mysql, mysql-server
</pre>
</div>

<p>
FastCGI方式：默认不支持
</p>

<p>
注意：基于module实现，httpd 需要 使用prefork模型
</p>
</div>
</div>
<div id="outline-container-h:dc15ef58-b2a9-41a4-b8fc-8ab5eb3449d8" class="outline-4">
<h4 id="h:dc15ef58-b2a9-41a4-b8fc-8ab5eb3449d8">PHP连接MySQL的方式</h4>
<div class="outline-text-4" id="text-h:dc15ef58-b2a9-41a4-b8fc-8ab5eb3449d8">
</div>
<div id="outline-container-h:3e5b7154-9d30-4138-8985-f17492d2e580" class="outline-5">
<h5 id="h:3e5b7154-9d30-4138-8985-f17492d2e580">使用mysql扩展连接数据库</h5>
<div class="outline-text-5" id="text-h:3e5b7154-9d30-4138-8985-f17492d2e580">
<p>
使用mysql扩展模块mysql.so连接数据，此方式已经在php 7 版后淘汰
</p>

<p>
范例：php使用mysql扩展连接数据库的测试代码
</p>

<div class="org-src-container">
<pre class="src src-php">&lt;?php
$conn = mysql_connect('mysqlserver','username','password');
if ($conn)
    echo "OK";
else
    echo "Failure";
    #echo mysql_error();
    mysql_close();
?&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d98d2b46-1a8e-48fe-b5f1-899869ca5ba9" class="outline-5">
<h5 id="h:d98d2b46-1a8e-48fe-b5f1-899869ca5ba9">使用mysqli扩展连接数据库</h5>
<div class="outline-text-5" id="text-h:d98d2b46-1a8e-48fe-b5f1-899869ca5ba9">
<p>
使用mysqli扩展模块mysqli.so连接数据，此方式只能连接MySQL数据库，不支持其它数据库
</p>

<p>
范例：php使用mysqli扩展连接数据库的测试代码
</p>

<div class="org-src-container">
<pre class="src src-php">&lt;?php
$mysqli=new mysqli("mysqlserver", "username", "password");
if(mysqli_connect_errno()){
    echo "Failure";
    $mysqli=null;
    exit;
}
echo "OK";
$mysqli-&gt;close();
?&gt;
</pre>
</div>
</div>
<ul class="org-ul">
<li><a id="h:be483ce0-6429-4c67-850b-d89ddcc3a78e"></a>使用PDO(PHP Data Object)扩展连接数据库<br>
<div class="outline-text-6" id="text-h:be483ce0-6429-4c67-850b-d89ddcc3a78e">
<p>
使用PDO扩展模块pdo_mysql.so连接数据库，此方式可以支持连接MySQL，Oracle等多种数据库
</p>

<p>
范例：php使用pdo扩展连接数据库的测试代码1
</p>

<div class="org-src-container">
<pre class="src src-php">&lt;?php
$dsn='mysql:host=mysqlhost;port=3306;dbname=mysql';
$username='root';
$passwd='cici';
$dbh=new PDO($dsn,$username,$passwd);
var_dump($dbh);
?&gt;
</pre>
</div>

<p>
范例：php使用pdo扩展连接数据库的测试代码2
</p>

<div class="org-src-container">
<pre class="src src-php">&lt;?php
try {
$user='root';
$pass='cici';
$dbh = new PDO('mysql:host=mysqlhost;port=3306;dbname=mysql', $user, $pass);
foreach($dbh-&gt;query('SELECT user,host from user') as $row) {
print_r($row);
}
$dbh = null;
} catch (PDOException $e) {
print "Error!: " . $e-&gt;getMessage() . "&lt;br/&gt;";
die();
}
?&gt;
</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-h:d3f02d72-a14e-43d4-993d-d1ae487c7423" class="outline-4">
<h4 id="h:d3f02d72-a14e-43d4-993d-d1ae487c7423">实现LAMP实战案例</h4>
<div class="outline-text-4" id="text-h:d3f02d72-a14e-43d4-993d-d1ae487c7423">
<p>
范例：CentOS 8
默认使用factcgi模式，可以按下面步骤修改为httpd的模块方式（不建议）
</p>

<div class="org-src-container">
<pre class="src src-php">[root@centos8 ~]#dnf -y install httpd php php-mysqlnd mariadb-server

#修改为prefork模式支持httpd 模块方式
[root@centos8 ~]#vim /etc/httpd/conf.modules.d/00-mpm.conf
LoadModule mpm_prefork_module modules/mod_mpm_prefork.so

#LoadModule mpm_worker_module modules/mod_mpm_worker.so
#LoadModule mpm_event_module modules/mod_mpm_event.so

#CentOS 8的php 默认是factcgi模式 ，修改为httpd模块方式，此步非必须，是可选做
[root@centos8 html]#vim /etc/httpd/conf.d/php.conf
#&lt;IfModule !mod_php5.c&gt;
# &lt;IfModule !mod_php7.c&gt;
# # Enable http authorization headers
# SetEnvIfNoCase ^Authorization$ "(.+)" HTTP_AUTHORIZATION=$1
#
# &lt;FilesMatch \.(php|phar)$&gt;
# SetHandler "proxy:unix:/run/php-fpm/www.sock|fcgi://localhost"
# &lt;/FilesMatch&gt;
# &lt;/IfModule&gt;
#&lt;/IfModule&gt;

[root@centos8 ~]#vim /var/www/html/lamp.php
[root@centos8 ~]#cat /var/www/html/lamp.php
&lt;?php
try {
$user='root';
$pass='';
$dbh = new PDO('mysql:host=localhost;dbname=mysql', $user, $pass);
foreach($dbh-&gt;query('SELECT user,host from user') as $row) {
print_r($row);
}
$dbh = null;
} catch (PDOException $e) {
print "Error!: " . $e-&gt;getMessage() . "&lt;br/&gt;";
die();
}
phpinfo();
?&gt;
[root@centos8 ~]#systemctl start httpd mariadb
</pre>
</div>

<p>
打开chrome浏览器，访问 <a href="http://httpd服务器ip/lamp.php">http://httpd服务器ip/lamp.php</a>
可以看到如下页面，说明LAMP 搭建成功
</p>


<figure id="org9333b00">
<img src="./images/2020071008390276.png" alt="2020071008390276.png">

</figure>
</div>
</div>
</div>
<div id="outline-container-h:bf05667f-e646-44bb-b895-6b1ebd62e1fd" class="outline-3">
<h3 id="h:bf05667f-e646-44bb-b895-6b1ebd62e1fd">常见LAMP应用实现</h3>
<div class="outline-text-3" id="text-h:bf05667f-e646-44bb-b895-6b1ebd62e1fd">
</div>
<div id="outline-container-h:75a0b6d2-4ad8-4f62-b274-783bd43e4e70" class="outline-4">
<h4 id="h:75a0b6d2-4ad8-4f62-b274-783bd43e4e70">常见LAMP应用介绍</h4>
<div class="outline-text-4" id="text-h:75a0b6d2-4ad8-4f62-b274-783bd43e4e70">
<ul class="org-ul">
<li>PhpMyAdmin是一个以PHP为基础，以Web-Base方式架构在网站主机上的MySQL的数据库管理工具，让管理者可用Web接口管理MySQL数据库，官网：<a href="https://www.phpmyadmin.net/">https://www.phpmyadmin.net/</a></li>
<li>WordPress是一种使用PHP语言开发的博客平台，用户可以在支持PHP和MySQL数据库的服务器上架设属于自己的网站。也可把
WordPress当作一个内容管理系统（CMS）来使用，官网：<a href="https://cn.wordpress.org/">https://cn.wordpress.org/</a></li>
<li>PHPWind是2003年发布了PHPWind的前身版本ofstar，并发展成为包含BBS、CMS、博客、SNS等一系列程序的通用型建站软件,
于2008年加入阿里巴巴集团，官网：<a href="https://www.phpwind.net/">https://www.phpwind.net/</a></li>
<li>Crossday Discuz! Board（简称
Discuz!）是一套通用的社区论坛软件系统。自2001年6月面世以来，是覆盖率最大的论坛软件系统之一。2010年8月23日与腾讯达成收购协议，官网：<a href="https://www.discuz.net/">https://www.discuz.net/</a></li>
<li>PowerDNS
是一个跨平台的开源DNS服务组件，它是高性能的域名服务器，除了支持普通的BIND配置文件，PowerDNS还可从MySQL,Oracle,PostgreSQL等的数据库读取数据。PowerDNS安装了Poweradmin(基于php实现)，能实现Web管理DNS记录，非常方便</li>
<li>ECShop是一款B2C独立网店系统，适合企业及个人快速构建个性化网上商店。系统是基于PHP语言及MYSQL数据库构架开发的跨平台开源程序。2006年6月，ECShop推出第一个版本1.0</li>
</ul>
</div>
</div>
<div id="outline-container-h:d0225b7f-a1de-4526-b4e2-e29b8a3e2f78" class="outline-4">
<h4 id="h:d0225b7f-a1de-4526-b4e2-e29b8a3e2f78">实现 phpMyadmin应用部署</h4>
<div class="outline-text-4" id="text-h:d0225b7f-a1de-4526-b4e2-e29b8a3e2f78">

<figure id="org4e187c7">
<img src="./images/20200710083950600.png" alt="20200710083950600.png">

</figure>


<figure id="org5f6a9a6">
<img src="./images/20200710084008863.png" alt="20200710084008863.png">

</figure>

<p>
范例：CentOS 8 部署 phpMyAdmin-5.0.1
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#yum -y install httpd mariadb-server php php-mysqlnd php-json
[root@centos8 ~]#systemctl start httpd mariadb
[root@centos8 ~]#mysql_secure_installation
[root@centos8 ~]#unzip phpMyAdmin-5.0.1-all-languages.zip
[root@centos8 ~]#mv phpMyAdmin-5.0.1-all-languages /var/www/html/pma

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#20986;&#38169;&#65292;&#21487;&#20197;&#26597;&#30475;&#26085;&#24535;
</span>[root@centos8 ~]#tail /var/log/php-fpm/www-error.log

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27983;&#35272;&#22120;&#35775;&#38382;http://LAMP&#26381;bash&#21153;&#22120;IP/pma/</span>
</pre>
</div>

<p>
范例：CentOS 7 利用清华Yum源安装php 7.4 部署 phpMyAdmin-5.0.2
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#yum -y install https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm
[root@centos7 ~]#yum -y install httpd php74-php php74-php-mbstring php74-phpmysqlnd mariadb-server unzip

[root@centos7 ~]#systemctl enable --now httpd mariadb
[root@centos7 ~]#mysqladmin password cici

[root@centos7 ~]#wget https://files.phpmyadmin.net/phpMyAdmin/5.0.2/phpMyAdmin-5.0.2-all-languages.zip
[root@centos7 ~]#unzip phpMyAdmin-5.0.2-all-languages.zip
[root@centos7 ~]#mv phpMyAdmin-5.0.2-all-languages/ /var/www/html/pma
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27983;&#35272;&#22120;&#35775;&#38382;http://LAMP&#26381;&#21153;&#22120;IP/pma/</span>
</pre>
</div>

<p>
范例：CentOS 7 利用清华Yum源安装php 7.2 部署 phpMyAdmin-5.0.1
</p>

<div class="org-src-container">
<pre class="src src-sh">yum -y install https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remirelease-7.rpm
yum -y install httpd php72-php php72-php-mbstring php72-php-mysqlnd mariadb-server
systemctl start httpd mariadb
wget https://files.phpmyadmin.net/phpMyAdmin/5.0.1/phpMyAdmin-5.0.1-alllanguages.zip

yum install unzip -y
unzip phpMyAdmin-5.0.1-all-languages.zip
<span style="color: #483d8b;">cd</span> phpMyAdmin-5.0.1-all-languages/
mv phpMyAdmin-5.0.1-all-languages /var/www/html/pma

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622;mysql&#30340;root&#23494;&#30721;&#65292;phpMyadmin&#19981;&#20801;&#35768;&#31354;&#23494;&#30721;&#30331;&#24405;
</span>mysql_secure_installation

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27983;&#35272;&#22120;&#35775;&#38382;http://LAMP&#26381;&#21153;&#22120;IP/pma/</span>
</pre>
</div>

<p>
范例：CentOS 7 利用RPM包部署phpMyadmin4.4
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#yum -y install httpd mariadb-server php php-mysql
[root@centos7 ~]#systemctl start mariadb
[root@centos7 ~]#mysql_secure_installation
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#19979;&#36733;&#65306;https://www.phpmyadmin.net/downloads/
</span>[root@centos7 ~]#unzip phpMyAdmin-4.4.15.10-all-languages.zip
[root@centos7 ~]#mv phpMyAdmin-4.4.15.10-all-languages /var/www/html/phpmyadmin
[root@centos7 ~]#cd /var/www/html/phpmyadmin/
[root@centos7 ~]#cp config.sample.inc.php config.inc.php
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;mysql &#26381;&#21153;&#22120;&#21644;phpmyadmin&#19981;&#22312;&#21516;&#19968;&#21488;&#20027;&#26426;&#65292;&#36824;&#38656;&#35201;&#20462;&#25913;&#20197;&#19979;&#35774;&#32622;
</span>[root@centos7 ~]#vim config.inc.php
$<span style="color: #a0522d;">cfg</span>[<span style="color: #8b2252;">'Servers'</span>][$<span style="color: #a0522d;">i</span>][<span style="color: #8b2252;">'host'</span>] = <span style="color: #8b2252;">'mysqlserverIP'</span>;

[root@centos7 ~]#yum -y install php-mbstring
[root@centos7 ~]#systemctl start httpd
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27983;&#35272;&#22120;&#35775;&#38382;:http://LAMP&#26381;&#21153;&#22120;IP/phpmyadmin,&#36755;&#20837;root&#21450;&#21475;&#20196;&#21363;&#21487;&#30331;&#24405;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c215a697-743c-46ed-9cbd-405e7d805cfe" class="outline-4">
<h4 id="h:c215a697-743c-46ed-9cbd-405e7d805cfe">实现 wordpress 应用部署</h4>
<div class="outline-text-4" id="text-h:c215a697-743c-46ed-9cbd-405e7d805cfe">
<p>
<a href="./images/format,png">./images/format,png</a>
</p>

<p>
范例：CentOS 8 利用RPM包部署 wordpress
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#dnf -y install httpd php php-json php-mysqlnd mariadb-server
[root@centos8 ~]#systemctl enable --now httpd mariadb

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;&#25968;&#25454;&#24211;&#21644;&#36134;&#21495;
</span>[root@centos8 ~]#mysql
MariaDB [(none)]&gt; create database wordpress;
MariaDB [(none)]&gt; grant all on wordpress.* to wordpress@<span style="color: #8b2252;">'localhost'</span> identified by <span style="color: #8b2252;">'cici'</span>;
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25110;&#32773;
</span>[root@centos8 ~]#mysql -e <span style="color: #8b2252;">'create database wordpress;grant all on *.* to wordpress@"10.0.0.%" identified by "cici"'</span>

[root@centos8 ~]#wget https://cn.wordpress.org/latest-zh_CN.zip
[root@centos8 ~]#tar xvf wordpress-5.4.2-zh_CN.tar.gz
[root@centos8 ~]#mv wordpress/* /var/www/html/

[root@centos8 ~]#chown -R apache.apache /var/www/html/
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25110;&#32773;
</span>[root@centos8 ~]#setfacl -Rm u:apache:rwx /var/www/html/wp-content/

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27983;&#35272;&#22120;&#35775;&#38382;
</span>http://LAMP&#26381;&#21153;&#22120;/wordpress
</pre>
</div>


<figure id="org9ccd4f3">
<img src="./images/20200710084444337.png" alt="20200710084444337.png">

</figure>


<figure id="org51dd763">
<img src="./images/20200710084507567.png" alt="20200710084507567.png">

</figure>


<figure id="org0c374bd">
<img src="./images/20200710084516183.png" alt="20200710084516183.png">

</figure>


<figure id="org6690db2">
<img src="./images/20200710084528665.png" alt="20200710084528665.png">

</figure>


<figure id="org43e1902">
<img src="./images/20200710084539700.png" alt="20200710084539700.png">

</figure>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#20840;&#21152;&#22266;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#27983;&#35272;&#22120;&#35775;&#38382;https://api.wordpress.org/secret-key/1.1/salt/&#65292;&#26367;&#20195;&#19979;&#38754;wp-config.php&#20869;&#23481;
</span>[root@centos8 ~]#vim /var/www/html/wp-config.php
</pre>
</div>


<figure id="org8a9da3c">
<img src="./images/20200710084617602.png" alt="20200710084617602.png">

</figure>

<p>
范例：CentOS 7 利用RPM包部署wordpress
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#19979;&#36733;&#23448;&#32593;&#22320;&#22336;&#65306;https://cn.wordpress.org/
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#35299;&#21387;&#32553;WordPress&#21338;&#23458;&#31243;&#24207;&#21040;&#32593;&#39029;&#31449;&#28857;&#30446;&#24405;&#19979;
</span>unzip wordpress-5.1.1-zh_CN.zip
mv wordpress /var/www/html/
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26032;&#24314;wpdb&#24211;&#21644;wpuser&#29992;&#25143;
</span>mysql&gt; create database wpdb;
mysql&gt; grant all on wpdb.* to wpuser@<span style="color: #8b2252;">'%'</span> identified by <span style="color: #8b2252;">"wppass"</span>;
setfacl &#8211;R &#8211;m u:apache:rwx /var/www/html/wordpress/
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25110;&#32773;chown &#8211;R apache.apache /var/www/html/wordpress
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#24320;http://LAMP&#26381;&#21153;&#22120;IP/wordpress&#36827;&#34892;&#39029;&#38754;&#23433;&#35013;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b3a9cf37-9655-48b4-be42-896e81dfc171" class="outline-4">
<h4 id="h:b3a9cf37-9655-48b4-be42-896e81dfc171">实现 Discuz！应用部署</h4>
<div class="outline-text-4" id="text-h:b3a9cf37-9655-48b4-be42-896e81dfc171">

<figure id="org6122f49">
<img src="./images/20200710084634777.png" alt="20200710084634777.png">

</figure>

<p>
范例：CentOS 8 利用RPM包部署Discuz！
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#dnf -y install httpd php php-xml php-mysqlnd mariadb-server
[root@centos8 ~]#unzip Discuz_X3.4_SC_UTF8&#12304;20191201&#12305;.zip
[root@centos8 ~]#mv upload/ /var/www/html/forum
[root@centos8 ~]#chown -R apache.apache /var/www/html/forum
[root@centos8 ~]#mysql
MariaDB [ultrax]&gt; create database ultrax;
MariaDB [ultrax]&gt; grant all on ultrax.* to ultrax@<span style="color: #8b2252;">'localhost'</span> identified by <span style="color: #8b2252;">'cici'</span>;
</pre>
</div>


<figure id="orga11f230">
<img src="./images/20200710084713602.png" alt="20200710084713602.png">

</figure>


<figure id="org0ccaf60">
<img src="./images/20200710084726167.png" alt="20200710084726167.png">

</figure>


<figure id="orgea2cd25">
<img src="./images/20200710085434582.png" alt="20200710085434582.png">

</figure>


<figure id="orgc386fc9">
<img src="./images/20200710085444208.png" alt="20200710085444208.png">

</figure>


<figure id="org7dd764a">
<img src="./images/20200710085559520.png" alt="20200710085559520.png">

</figure>


<figure id="orgfd8e4e0">
<img src="./images/20200710090315228.png" alt="20200710090315228.png">

</figure>


<figure id="org74b5655">
<img src="./images/20200710090329549.png" alt="20200710090329549.png">

</figure>

<p>
范例：CentOS 7 利用RPM包部署Discuz！
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23448;&#32593;&#65306;http://www.discuz.net
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#19979;&#36733;&#28304;&#30721;&#65306;
</span>wget http://download.comsenz.com/DiscuzX/3.3/Discuz_X3.3_SC_UTF8.zip
unzip Discuz_X3.3_SC_UTF8.zip
mv upload/ /var/www/html/forum
setfacl -R -m u:apache:rwx /var/www/html/forum
mysql&gt;create database discuz;
mysql&gt;grant all on discuz.* to discuz@<span style="color: #8b2252;">'172.16.0.%&#8217;identified by"cici";
&#23433;&#35013;&#21521;&#23548;&#65306;http://localhost/forum</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:00b3c0cd-8a4d-434e-b80f-b89fa0730074" class="outline-4">
<h4 id="h:00b3c0cd-8a4d-434e-b80f-b89fa0730074">实现 PowerDNS 应用部署</h4>
<div class="outline-text-4" id="text-h:00b3c0cd-8a4d-434e-b80f-b89fa0730074">

<figure id="orgd498324">
<img src="./images/20200710090439501.png" alt="20200710090439501.png">

</figure>

<p>
PowerDNS
是一个跨平台的开源DNS服务组件，PowerDNS为DNS数据提供纯文本文件或第三方数据库（如MySQL，PostgreSQL，Microsoft
SQL
Server，Oracle或Sybase）中存储的数据。PowerDNS同时有Windows和Linux/Unix的版本。
PowerDNS在Windows下可以使用
Access的mdb文件记录DNS信息，而在Linux/Unix下则常使用MySQL来记录DNS信息。
</p>

<p>
Poweradmin 是为 PowerDNS 服务器的提供基于PHP语言实现的 Web 界面的DNS
管理工具。此工具支持 PowerDNS 的主要功能。
</p>

<p>
PowerDNS官网：<a href="https://www.powerdns.com/">https://www.powerdns.com/</a>
</p>

<p>
PowerDNS文档：<a href="https://doc.powerdns.com/">https://doc.powerdns.com/</a>
</p>

<p>
Poweradmin官网：<a href="http://www.poweradmin.org/">http://www.poweradmin.org/</a>
</p>


<figure id="org7a0981a">
<img src="./images/20200710090502215.png" alt="20200710090502215.png">

</figure>

<p>
<b>范例：CentOS 8
利用RPM包部署PowerDNS(目前20200311，不支持powerdns，缺少相关php包)</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#yum install -y pdns pdns-backend-mysql mariadb-server
[root@centos8 ~]#systemctl start mariadb
[root@centos8 ~]#mysql &lt; pdns.sql
[root@centos8 ~]#vim /etc/pdns/pdns.conf
<span style="color: #a0522d;">launch</span>=gmysql
gmysql-host=localhost
gmysql-port=3306
gmysql-dbname=powerdns
gmysql-user=powerdns
gmysql-password=cici

[root@centos8 ~]#grep -Ev <span style="color: #8b2252;">"^#|^$"</span> /etc/pdns/pdns.conf
<span style="color: #a0522d;">launch</span>=gmysql <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#27492;&#34892;
</span>gmysql-host=localhost <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;&#19979;&#34892;&#26159;&#22686;&#21152;
</span>gmysql-port=3306
gmysql-dbname=powerdns
gmysql-user=powerdns
gmysql-password=cici
<span style="color: #a0522d;">setgid</span>=pdns <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;&#19979;&#20004;&#34892;&#19981;&#21464;
</span><span style="color: #a0522d;">setuid</span>=pdns

[root@centos8 ~]#systemctl enable --now pdns
[root@centos8 ~]#ss -ntlpu |grep pdns_server
udp UNCONN 0 0 0.0.0.0:53 0.0.0.0:*
users:((<span style="color: #8b2252;">"pdns_server"</span>,<span style="color: #a0522d;">pid</span>=3073,<span style="color: #a0522d;">fd</span>=9))
udp UNCONN 0 0 [::]:53 [::]:*
users:((<span style="color: #8b2252;">"pdns_server"</span>,<span style="color: #a0522d;">pid</span>=3073,<span style="color: #a0522d;">fd</span>=10))
tcp LISTEN 0 128 0.0.0.0:53 0.0.0.0:*
users:((<span style="color: #8b2252;">"pdns_server"</span>,<span style="color: #a0522d;">pid</span>=3073,<span style="color: #a0522d;">fd</span>=11))
tcp LISTEN 0 128 [::]:53 [::]:*
users:((<span style="color: #8b2252;">"pdns_server"</span>,<span style="color: #a0522d;">pid</span>=3073,<span style="color: #a0522d;">fd</span>=12))
[root@centos8 ~]#yum -y install httpd php php-devel php-gd php-ldap php-mysqlnd php-odbc php-pear php-xml php-xmlrpc php-mhash gettext
[root@centos8 ~]#systemctl restart httpd
</pre>
</div>


<figure id="org9feb8f4">
<img src="./images/20200710090512419.png" alt="20200710090512419.png">

</figure>

<p>
<b>范例：CentOS 7 利用RPM包部署PowerDNS</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#21253;&#65306;&#22522;&#20110;EPEL&#28304;
</span>[root@centos7 ~]#yum install -y pdns pdns-backend-mysql mariadb-server
[root@centos7 ~]#rpm -ql pdns
/etc/pdns
/etc/pdns/pdns.conf
/usr/bin/pdns_control
/usr/bin/pdns_zone2ldap
/usr/bin/pdnsutil
/usr/bin/zone2json
/usr/bin/zone2sql
/usr/lib/systemd/system/pdns.service
/usr/lib/systemd/system/pdns@.service
/usr/lib64/pdns
/usr/lib64/pdns/libbindbackend.so
/usr/sbin/pdns_server
/usr/share/doc/pdns-4.1.11
/usr/share/doc/pdns-4.1.11/README
/usr/share/licenses/pdns-4.1.11
/usr/share/licenses/pdns-4.1.11/COPYING
/usr/share/man/man1/pdns_control.1.gz
/usr/share/man/man1/pdns_server.1.gz
/usr/share/man/man1/pdns_zone2ldap.1.gz
/usr/share/man/man1/pdnsutil.1.gz
/usr/share/man/man1/zone2json.1.gz
/usr/share/man/man1/zone2sql.1.gz

[root@centos7 ~]#systemctl enable --now mariadb

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;mariadb&#20013;&#30340;&#25968;&#25454;&#24211;&#65292;&#34920;&#21644;&#29992;&#25143;
</span>[root@centos7 ~]#mysql
MariaDB [(none)]&gt; CREATE DATABASE powerdns;
MariaDB [(none)]&gt; GRANT ALL ON powerdns.* TO <span style="color: #8b2252;">'powerdns'</span>@<span style="color: #8b2252;">'localhost'</span> IDENTIFIED BY <span style="color: #8b2252;">'cici'</span>;
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;powerdns&#25968;&#25454;&#24211;&#20013;&#30340;&#34920;&#65292;&#21442;&#30475;&#19979;&#38754;&#25991;&#26723;&#23454;&#29616;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">https://doc.powerdns.com/md/authoritative/backend-generic-mysql/
</span>
use powerdns;

CREATE TABLE domains (
  id                    INT AUTO_INCREMENT,
  name                  VARCHAR(255) NOT NULL,
  master                VARCHAR(128) DEFAULT NULL,
  last_check            INT DEFAULT NULL,
  <span style="color: #483d8b;">type</span>                  VARCHAR(6) NOT NULL,
  notified_serial       INT DEFAULT NULL,
  account               VARCHAR(40) DEFAULT NULL,
  PRIMARY KEY (id)
) <span style="color: #a0522d;">Engine</span>=InnoDB;

CREATE UNIQUE INDEX name_index ON domains(name);


CREATE TABLE records (
  id                    BIGINT AUTO_INCREMENT,
  domain_id             INT DEFAULT NULL,
  name                  VARCHAR(255) DEFAULT NULL,
  <span style="color: #483d8b;">type</span>                  VARCHAR(10) DEFAULT NULL,
  content               VARCHAR(64000) DEFAULT NULL,
  ttl                   INT DEFAULT NULL,
  prio                  INT DEFAULT NULL,
  change_date           INT DEFAULT NULL,
  disabled              TINYINT(1) DEFAULT 0,
  ordername             VARCHAR(255) BINARY DEFAULT NULL,
  auth                  TINYINT(1) DEFAULT 1,
  PRIMARY KEY (id)
) <span style="color: #a0522d;">Engine</span>=InnoDB;

CREATE INDEX nametype_index ON records(name,type);
CREATE INDEX domain_id ON records(domain_id);
CREATE INDEX recordorder ON records (domain_id, ordername);


CREATE TABLE supermasters (
  ip                    VARCHAR(64) NOT NULL,
  nameserver            VARCHAR(255) NOT NULL,
  account               VARCHAR(40) NOT NULL,
  PRIMARY KEY (ip, nameserver)
) <span style="color: #a0522d;">Engine</span>=InnoDB;


CREATE TABLE comments (
  id                    INT AUTO_INCREMENT,
  domain_id             INT NOT NULL,
  name                  VARCHAR(255) NOT NULL,
  <span style="color: #483d8b;">type</span>                  VARCHAR(10) NOT NULL,
  modified_at           INT NOT NULL,
  account               VARCHAR(40) NOT NULL,
  comment               VARCHAR(64000) NOT NULL,
  PRIMARY KEY (id)
) <span style="color: #a0522d;">Engine</span>=InnoDB;

CREATE INDEX comments_domain_id_idx ON comments (domain_id);
CREATE INDEX comments_name_type_idx ON comments (name, type);
CREATE INDEX comments_order_idx ON comments (domain_id, modified_at);


CREATE TABLE domainmetadata (
  id                    INT AUTO_INCREMENT,
  domain_id             INT NOT NULL,
  kind                  VARCHAR(32),
  content               TEXT,
  PRIMARY KEY (id)
) <span style="color: #a0522d;">Engine</span>=InnoDB;

CREATE INDEX domainmetadata_idx ON domainmetadata (domain_id, kind);


CREATE TABLE cryptokeys (
  id                    INT AUTO_INCREMENT,
  domain_id             INT NOT NULL,
  flags                 INT NOT NULL,
  active                BOOL,
  content               TEXT,
  PRIMARY KEY(id)
) <span style="color: #a0522d;">Engine</span>=InnoDB;

CREATE INDEX domainidindex ON cryptokeys(domain_id);


CREATE TABLE tsigkeys (
  id                    INT AUTO_INCREMENT,
  name                  VARCHAR(255),
  algorithm             VARCHAR(50),
  secret                VARCHAR(255),
  PRIMARY KEY (id)
) <span style="color: #a0522d;">Engine</span>=InnoDB;

CREATE UNIQUE INDEX namealgoindex ON tsigkeys(name, algorithm);

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37197;&#32622;PowerDNS&#20351;&#29992;mariadb&#20316;&#20026;&#21518;&#21488;&#25968;&#25454;&#23384;&#20648;
</span>[root@centos7 ~]#vim /etc/pdns/pdns.conf&#65292;<span style="color: #a0522d;">&#26597;&#25214;&#21040;&#21253;&#21547;launch</span>= &#30340;&#34892;&#65292;&#20462;&#25913;&#24182;&#28155;&#21152;&#19979;&#38754;&#30340;&#20869;&#23481;
<span style="color: #a0522d;">launch</span>=gmysql <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#27492;&#34892;
</span>gmysql-host=localhost <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;&#19979;&#34892;&#26159;&#22686;&#21152;&#30340;
</span>gmysql-port=3306
gmysql-dbname=powerdns
gmysql-user=powerdns
gmysql-password=cici

[root@centos7 ~]#grep -Ev <span style="color: #8b2252;">"^#|^$"</span> /etc/pdns/pdns.conf
<span style="color: #a0522d;">launch</span>=gmysql
gmysql-host=localhost
gmysql-port=3306
gmysql-dbname=powerdns
gmysql-user=powerdns
gmysql-password=cici
<span style="color: #a0522d;">setgid</span>=pdns
<span style="color: #a0522d;">setuid</span>=pdns

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#21160;&#26381;&#21153;
</span>[root@centos7 ~]#systemctl enable --now pdns
[root@Centos7 ~]#ss -ntlu
Netid  State      Recv-Q Send-Q                          Local Address:Port                                         Peer Address:Port                                
udp    UNCONN     0      0                                           *:53                                                      *:*                                                
udp    UNCONN     0      0                                        [::]:53                                                   [::]:*                                   
tcp    LISTEN     0      128                                         *:53                                                      *:*                  
tcp    LISTEN     0      128                                         *:22                                                      *:*                  
tcp    LISTEN     0      50                                          *:3306                                                    *:*                                   
tcp    LISTEN     0      128                                      [::]:53                                                   [::]:*                  
tcp    LISTEN     0      128                                      [::]:22                                                   [::]:*                  
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;httpd&#21644;php&#30456;&#20851;&#21253;
</span>[root@centos7 ~]#yum -y install httpd php php-devel php-gd php-mcrypt php-imap php-ldap php-mysql php-odbc php-pear php-xml php-xmlrpc php-mbstring php-mhash gettext

[root@centos7 ~]#systemctl enable --now httpd
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#19979;&#36733;poweradmin&#31243;&#24207;&#65292;&#24182;&#35299;&#21387;&#32553;&#21040;&#30456;&#24212;&#30446;&#24405;
</span>[root@centos7 ~]#wget http://downloads.sourceforge.net/project/poweradmin/poweradmin-2.1.7.tgz
[root@centos7 ~]#tar xvf poweradmin-2.1.7.tgz -C /var/www/html
[root@centos7 ~]#cd /var/www/html
[root@centos7 ~]#mv poweradmin-2.1.7 poweradmin
</pre>
</div>

<p>
访问下面地址，启动PowerAdmin的网页安装向导：
</p>

<div class="org-src-container">
<pre class="src src-sh">http://powerdns&#26381;&#21153;&#22120;IP/poweradmin/install/
</pre>
</div>


<figure id="org6188cd0">
<img src="./images/2020071009064166.png" alt="2020071009064166.png">

</figure>


<figure id="org024c574">
<img src="./images/20200710090655685.png" alt="20200710090655685.png">

</figure>

<p>
提供先前配置的数据库详情，同时为Poweradmin设置管理员密码
</p>


<figure id="org0fafe0f">
<img src="./images/20200710090703828.png" alt="20200710090703828.png">

</figure>

<p>
为Poweradmin创建一个受限用户
</p>

<p>
说明：
</p>

<p>
Username：PowerAdmin用户名
</p>

<p>
Password：上述用户的密码
</p>

<p>
Hostmaster：当创建SOA记录指定默认主机管理员
</p>

<p>
Primary nameserver：主域名服务器
</p>

<p>
Secondary namesever:辅域名服务器
</p>


<figure id="orgecd47b2">
<img src="./images/20200710090715483.png" alt="20200710090715483.png">

</figure>

<p>
按照下面页面说明，在数据库中创建用户并授权
</p>

<div class="org-src-container">
<pre class="src src-sh">MariaDB [(none)]&gt;GRANT SELECT, INSERT, UPDATE, DELETE ON powerdns.* TO
<span style="color: #8b2252;">'poweradmin'</span>@<span style="color: #8b2252;">'localhost&#8216; IDENTIFIED BY '</span>cici<span style="color: #8b2252;">';</span>
</pre>
</div>


<figure id="orgb70ca8a">
<img src="./images/20200710090727763.png" alt="20200710090727763.png">

</figure>

<p>
按下面页面说明，创建config.in.php文件内容
</p>

<div class="org-src-container">
<pre class="src src-sh">vim /var/www/html/poweradmin/inc/config.inc.php
</pre>
</div>


<figure id="org94cc559">
<img src="./images/20200710090737758.png" alt="20200710090737758.png">

</figure>

<p>
安装完毕后
</p>


<figure id="org458fbb7">
<img src="./images/20200710090749208.png" alt="20200710090749208.png">

</figure>

<p>
删除install目录
</p>

<div class="org-src-container">
<pre class="src src-sh">rm -rf /var/www/html/poweradmin/install/
</pre>
</div>

<p>
登录 <a href="http://powerdns服务器ip/poweradmin/">http://powerdns服务器ip/poweradmin/</a>
</p>

<p>
username：admin
</p>

<p>
password：cici 参看第step 3
</p>


<figure id="orgd0a0c19">
<img src="./images/20200710090800343.png" alt="20200710090800343.png">

</figure>

<p>
<img src="./images/20200710090810116.png" alt="20200710090810116.png">
添加一条记录<br>
<img src="./images/20200710090819802.png" alt="20200710090819802.png">
<img src="./images/2020071009082947.png" alt="2020071009082947.png">
<img src="./images/20200710090839615.png" alt="20200710090839615.png">
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#cat /etc/resolv.conf
<span style="color: #b22222;"># </span><span style="color: #b22222;">Generated by NetworkManager
</span>search cuiqinghe.com
nameserver 180.76.76.76
nameserver 10.0.0.17
</pre>
</div>


<figure id="org3ec4658">
<img src="./images/2020071009085257.png" alt="2020071009085257.png">

</figure>

<p>
论坛每秒只能处理30多个请求，性能较差，可以考虑使用加速器
</p>


<figure id="org7e80269">
<img src="./images/2020071009090781.png" alt="2020071009090781.png">

</figure>
</div>
</div>
</div>
<div id="outline-container-h:2a241b5d-82a8-4342-b042-4a91b826f550" class="outline-3">
<h3 id="h:2a241b5d-82a8-4342-b042-4a91b826f550">php的加速器</h3>
<div class="outline-text-3" id="text-h:2a241b5d-82a8-4342-b042-4a91b826f550">
<p>
php的加速器：基于PHP的特殊扩展机制如opcode缓存扩展也可以将opcode缓存于php的共享内存中，从而可以让同一段代码的后续重复执行时跳过编译阶段以提高性能。这些加速器并非真正提高了opcode的运行速度，而仅是通过分析opcode后并将它们重新排列以达到快速执行的目的
</p>
</div>
<div id="outline-container-h:c332d5ef-3e9c-48a0-ab28-2b1186b1d24d" class="outline-4">
<h4 id="h:c332d5ef-3e9c-48a0-ab28-2b1186b1d24d">常见的第三方php加速器</h4>
<div class="outline-text-4" id="text-h:c332d5ef-3e9c-48a0-ab28-2b1186b1d24d">
<p>
1、APC (Alternative PHP Cache) 淘汰
</p>

<p>
遵循PHP License的开源框架，PHP opcode缓存加速器，目前的版本不适用于PHP5.4
</p>

<p>
项目地址：<a href="http://pecl.php.net/package/APC">http://pecl.php.net/package/APC</a>
</p>

<p>
2、eAccelerator 淘汰
</p>

<p>
源于Turck MMCache，早期的版本包含了一个PHP encoder和PHP
loader，目前encoder已经不在持。项目地址 ：<a href="http://eaccelerator.net/">http://eaccelerator.net/</a>
</p>

<p>
3、XCache 淘汰
</p>

<p>
快速而且稳定的PHP
opcode缓存，经过严格测试且被大量用于生产环境。项目地址：<a href="http://xcache.lighttpd.net/">http://xcache.lighttpd.net/</a>,收录EPEL源
</p>

<p>
4、Zend Optimizer和Zend Guard Loader
</p>

<p>
Zend Optimizer并非一个opcode加速器，它是由Zend
Technologies为PHP5.2及以前的版本提供的一个免费、闭源的PHP扩展，其能够运行由Zend
Guard生成的加密的PHP代码或模糊代码。 而Zend Guard
Loader则是专为PHP5.3提供的类似于Zend
Optimizer功能的扩展。项目地址<a href="http://www.zend.com/en/products/guard/runtime-decoders">http://www.zend.com/en/products/guard/runtime-decoders</a>
</p>

<p>
5、NuSphere PhpExpress
</p>

<p>
NuSphere的一款开源PHP加速器，它支持装载通过NuSphere PHP
Encoder编码的PHP程序文件，并能够实现对常规PHP文件的执行加速。项目地址，<a href="http://www.nusphere.com/products/phpexpress.htm">http://www.nusphere.com/products/phpexpress.htm</a>
</p>
</div>
</div>
<div id="outline-container-h:9f62b0ef-1d2e-49c6-9fdf-80e64b18d390" class="outline-4">
<h4 id="h:9f62b0ef-1d2e-49c6-9fdf-80e64b18d390">实现 xcache 加速 php 5.X</h4>
<div class="outline-text-4" id="text-h:9f62b0ef-1d2e-49c6-9fdf-80e64b18d390">
<p>
编译php-xcache加速访问，支持php 5.6版以下
</p>

<p>
官网：<a href="http://xcache.lighttpd.net/wiki/ReleaseArchive">http://xcache.lighttpd.net/wiki/ReleaseArchive</a>
</p>

<p>
案例：CentOS 7上安装清华源的php56，并编译安装 xcache加速
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#yum -install https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm
[root@centos7 ~]#yum -y install php56-php php56-php-mysqlnd mariadb-server
[root@centos7 ~]#systemctl enable --now httpd mariadb
Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service
to /usr/lib/systemd/system/httpd.service.
Created symlink from /etc/systemd/system/multi-user.target.wants/mariadb.service
to /usr/lib/systemd/system/mariadb.service.
[root@centos7 ~]#mysql
MariaDB [(none)]&gt; create database wordpress;
MariaDB [(none)]&gt; grant all on wordpress.* to wordpress@<span style="color: #8b2252;">'localhost'</span> identified by <span style="color: #8b2252;">'cici'</span>;
[root@centos7 ~]#tar xvf wordpress-5.3.2-zh_CN.tar.gz -C /var/www/html
[root@centos7 ~]#cd /var/www/html
[root@centos7 ~]#chown -R apache.apache wordpress/
[root@centos8 ~]#ab -c 10 -n 100 http://10.0.0.7/wordpress/
......
Requests per second: 3.16 [#/sec] (mean)
......

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#32534;&#35793;xcache
</span>[root@centos7 ~]#yum -y install gcc php56-php-devel
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#19979;&#36733;&#24182;&#35299;&#21387;&#32553;xcache-3.2.0.tar.bz2
</span>[root@centos7 ~]#tar xf xcache-3.2.0.tar.gz
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#32534;&#35793;&#29615;&#22659;
</span>[root@centos7 ~]#cd xcache-3.2.0/
[root@centos7 xcache-3.2.0]#/opt/remi/php56/root/usr/bin/phpize
Configuring for:
PHP Api Version:        20131106
Zend Module Api No:     20131226
Zend Extension Api No:  220131226
[root@centos7 xcache-3.2.0]#./configure --enable-xcache --with-phpconfig=/opt/remi/php56/root/usr/bin/php-config
[root@centos7 xcache-3.2.0]#make &amp;&amp; make install
...&#30465;&#30053;...
Installing shared extensions: /opt/remi/php56/root/usr/lib64/php/modules/

[root@centos7 xcache-3.2.0]#cat xcache.ini &gt;&gt; /opt/remi/php56/root/etc/php.ini
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;base&#28304;&#20013;&#25191;&#34892;&#21363;&#21487;cp xcache.ini /etc/php.d/
</span>[root@centos7 ~]#systemctl restart httpd.service

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27979;&#35797;&#24615;&#33021;&#65292;&#22823;&#27010;&#25552;&#21319;&#19968;&#20493;&#36895;&#24230;
</span>[root@centos8 ~]#ab -c10 -n 100 http://LAMP&#26381;&#21153;&#22120;/wordpress
Requests per second: 7.26 [#/sec] (mean)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:fa1c838d-004f-4283-9f92-b5c1827d5133" class="outline-4">
<h4 id="h:fa1c838d-004f-4283-9f92-b5c1827d5133">opcache加速php 7.X</h4>
<div class="outline-text-4" id="text-h:fa1c838d-004f-4283-9f92-b5c1827d5133">
<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#dnf install php-opcache
[root@centos8 ~]#cat /etc/php.ini
[opcache]
<span style="color: #a0522d;">zend_extension</span>=opcache.so
opcache.enable=1

[root@centos8 ~]#systemctl restart php-fpm
</pre>
</div>

<p>
<b>范例：CentOS 8 实现opache 加速</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#dnf -y install httpd php php-mysqlnd mariadb-server php-opcache php-json
[root@centos8 ~]#rpm -ql php-opcache
/etc/php.d/10-opcache.ini
/etc/php.d/opcache-default.blacklist
/usr/lib/.build-id
/usr/lib/.build-id/71
/usr/lib/.build-id/71/55ebb00f7ebcab9d708c1d5c7b7e634cce259c
/usr/lib64/php/modules/opcache.so
[root@centos8 ~]#grep opcache /etc/php.d/10-opcache.ini
<span style="color: #a0522d;">zend_extension</span>=opcache
opcache.enable=1
...&#30465;&#30053;...

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21152;&#36895;&#21069;,&#40664;&#35748;&#21551;&#29992;,&#20808;&#31105;&#29992;&#21152;&#36895;
</span>[root@centos8 ~]#vim /etc/php.d/10-opcache.ini
opcache.enable=0
[root@centos8 ~]#systemctl restart php-fpm
[root@centos7 ~]#ab -c 10 -n 100 http://10.0.0.8/wordpress/
......
Requests per second: 32.21 [#/sec] (mean)
......

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#29992;&#21152;&#36895;
</span>[root@centos8 ~]#vim /etc/php.d/10-opcache.ini
opcache.enable=1
[root@centos8 ~]#systemctl restart php-fpm

<span style="color: #b22222;">##</span><span style="color: #b22222;">&#21152;&#36895;&#21518;
</span>[root@centos7 ~]#ab -c 10 -n 100 http://10.0.0.8/wordpress/
......
Requests per second: 105.53 [#/sec] (mean)......
</pre>
</div>


<figure id="orge26147c">
<img src="./images/20200710091002549.png" alt="20200710091002549.png">

</figure>
</div>
</div>
</div>
<div id="outline-container-h:7834f166-b7f7-4102-803a-7517d8966590" class="outline-3">
<h3 id="h:7834f166-b7f7-4102-803a-7517d8966590">php-fpm 模式实现LAMP</h3>
<div class="outline-text-3" id="text-h:7834f166-b7f7-4102-803a-7517d8966590">
</div>
<div id="outline-container-h:7eb329ec-ce46-4e9c-87bb-990c149d2bc9" class="outline-4">
<h4 id="h:7eb329ec-ce46-4e9c-87bb-990c149d2bc9">实现php-fpm(PHP FastCGI Process Manager)模式</h4>
<div class="outline-text-4" id="text-h:7eb329ec-ce46-4e9c-87bb-990c149d2bc9">
<p>
对于php请求，httpd可以用模块和fastcgi两种方式实现动态程序的支持。
</p>

<p>
fastcgi模式：php处理请求，不再由http服务器自身进行管理，http服务器把http协议转化为factcgi协议，通过socket发送给fastcgi专用进程处理php程序
</p>

<p>
从稳定性上看,fastcgi是以独立的进程池运行来程序，如果单独一个进程死掉,系统可以很轻易的丢弃,然后重新分配新的进程来运行逻辑。从安全性上看,fastcgi和http的server完全独立,
fastcgi怎么down也不会把server搞垮。
</p>

<p>
从性能上看,fastcgi把动态逻辑的处理从http
server中分离出来,大负荷的IO处理还是留给宿主server,这样hpttd
server可以一心一意作IO,对于一个普通的动态网页来说,逻辑处理可能只有一小部分,大量的图片等静态IO处理完全不需要逻辑程序的参与。从扩展性上讲,fastcgi是一个中立的技术标准,完全可以支持任何语言写的处理程序，如php,java,python等。而php-fpm就是用来支持php的fastcgi服务器。
</p>

<p>
<b>各种OS版本对fastcgi的支持</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">CentOS 8: &#40664;&#35748;&#20351;&#29992;fpm&#27169;&#24335;
    httpd-2.4&#65306;&#40664;&#35748;rpm&#21253;&#25903;&#25345;fcgi&#27169;&#22359;
    php&#21253;&#40664;&#35748;&#20351;&#29992;fpm&#27169;&#24335;
    php-fpm&#21253;&#65306;&#19987;&#29992;&#20110;&#23558;php&#36816;&#34892;&#20110;fpm&#27169;&#24335;

CentOS 7&#65306;
    httpd-2.4&#65306;&#40664;&#35748;rpm&#21253;&#25903;&#25345;fcgi&#27169;&#22359; 
    php-fpm&#21253;&#65306;&#19987;&#29992;&#20110;&#23558;php&#36816;&#34892;&#20110;fpm&#27169;&#24335;

CentOS 6&#65306;
    PHP-5.3.2&#20043;&#21069;&#65306;&#40664;&#35748;&#19981;&#25903;&#25345;fpm&#26426;&#21046;&#65307;&#38656;&#35201;&#33258;&#34892;&#25171;&#34917;&#19969;&#24182;&#32534;&#35793;&#23433;&#35013;
    httpd-2.2&#65306;&#40664;&#35748;&#19981;&#25903;&#25345;fcgi&#21327;&#35758;&#65292;&#38656;&#35201;&#33258;&#34892;&#32534;&#35793;&#27492;&#27169;&#22359;
    &#35299;&#20915;&#26041;&#26696;&#65306;&#32534;&#35793;&#23433;&#35013;httpd-2.4, php-5.3.3+
</pre>
</div>
</div>
</div>
<div id="outline-container-h:22a23065-db26-4403-b931-5d3c90cf7111" class="outline-4">
<h4 id="h:22a23065-db26-4403-b931-5d3c90cf7111">安装php-fpm</h4>
<div class="outline-text-4" id="text-h:22a23065-db26-4403-b931-5d3c90cf7111">
<p>
CentOS 8 安装php-fpm
</p>

<div class="org-src-container">
<pre class="src src-sh">dnf -y install php-fpm
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25110;&#32773;
</span>dnf -y install php
</pre>
</div>

<p>
CentOS 7 安装php-fpm
</p>

<p>
BASE源安装PHP-FPM
</p>

<div class="org-src-container">
<pre class="src src-sh">yum install php-fpm
</pre>
</div>

<p>
清华大学yum源安装较新版的PHP-FPM（依赖EPEL源）
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#37197;&#32622;yum&#28304;
</span>[root@centos7 ~]#yum install https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;php-fpm5.6&#29256;
</span>[root@centos7 ~]#yum install php56-php-fpm php56-php-mysql

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;php-fpm7.3&#29256;
</span>[root@centos7 ~]#yum install php73-php-fpm php73-php-mysql
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6dd3304c-62ac-424b-8dbf-aed79f065105" class="outline-4">
<h4 id="h:6dd3304c-62ac-424b-8dbf-aed79f065105">配置php-fpm</h4>
<div class="outline-text-4" id="text-h:6dd3304c-62ac-424b-8dbf-aed79f065105">
<p>
查看php-fpm所对应的配置文件
</p>

<div class="org-src-container">
<pre class="src src-sh">rpm -ql php-fpm
/usr/lib/systemd/system/php-fpm.service
/etc/logrotate.d/php-fpm
/etc/php-fpm.conf
/etc/php-fpm.d
/etc/php-fpm.d/www.conf
/etc/sysconfig/php-fpm
/run/php-fpm
</pre>
</div>

<p>
*php-fpm 主要配置文件*：
</p>

<ul class="org-ul">
<li>/etc/php-fpm.conf</li>
<li>/etc/php-fpm.d/*.conf</li>
</ul>

<p>
<b>官方文档</b> ：
</p>

<p>
<a href="http://php.net/manual/zh/install.fpm.configuration.php">http://php.net/manual/zh/install.fpm.configuration.php</a>
</p>

<p>
<b>PHP-FPM常见配置</b>
</p>

<ul class="org-ul">
<li>daemonize = no //是否将程序运行在后台</li>

<li>listen = 127.0.0.1:9000 //FPM 监听地址</li>

<li><p>
listen = /var/run/php.sock //UDF模式使用,指定生成的unix
socket文件的路径
</p>

<p>
注意:Unix Domain Socket (UDS) support added in httpd-2.4.7
</p>

<p>
<a href="http://httpd.apache.org/docs/2.4/mod/mod_proxy.html#proxypass">http://httpd.apache.org/docs/2.4/mod/mod_proxy.html#proxypass</a>
</p></li>

<li>listen.owner = apache //UDF模式使用,指定生成的unix socket文件的所有者</li>

<li>listen.group = apache //UDF模式使用,指定生成的unix socket文件的所属组</li>

<li>listen.mode= 0666 //UDF模式使用，,指定生成的unix socket文件的权限</li>

<li>listen.acl_users = apache,nginx //指定用户访问unix
socket文件，listen.owner 和listen.group将无效</li>

<li>listen.backlog = -1 //等待队列的长度 -1表示无限制</li>

<li>listen.allowed_clients = 127.0.0.1 //仅允许哪些WEB主机访问</li>

<li>pm = dynamic|static //static 固定数量的子进程，
//dynamic子进程数据以动态模式管理</li>

<li>pm.max_childen //static 固定数量的子进程</li>

<li>pm.start_servers</li>

<li>pm.min_spare_servers</li>

<li>pm.max_spare_servers</li>

<li>pm.max_requests = 500</li>

<li>php_value[session.save_handler] = files</li>

<li>php_value[session.save_path] = /var/lib/php/session
//设置session存放位置</li>
</ul>

<p>
<b>session目录</b>
</p>

<p>
确保运行php-fpm进程的用户对session目录有读写权限
</p>

<div class="org-src-container">
<pre class="src src-sh">mkdir /var/lib/php/session
chown apache.apache /var/lib/php/session
</pre>
</div>

<p>
<b>启动PHP-FPM</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">systemctl start php-fpm
</pre>
</div>

<p>
<b>启用php-fpm的访问日志</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#vim /etc/php-fpm.d/www.conf
access.log = /var/log/php-fpm/access.log
[root@centos8 ~]#systemctl restart php-fpm
</pre>
</div>

<p>
<b>范例：php-fpm配置生产案例</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">cat /etc/php-fpm.d/www.conf
[www]
<span style="color: #a0522d;">listen</span> = 127.0.0.1:9000 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30417;&#21548;&#22320;&#22336;&#21450;IP
</span>listen.allowed_clients = 127.0.0.1 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20801;&#35768;&#23458;&#25143;&#31471;&#20174;&#21738;&#20010;&#28304;IP&#22320;&#22336;&#35775;&#38382;&#65292;&#35201;&#20801;&#35768;&#25152;&#26377;&#34892;&#39318;&#21152; ;&#27880;&#37322;&#21363;&#21487;
</span><span style="color: #a0522d;">user</span> = apache <span style="color: #b22222;">#</span><span style="color: #b22222;">php-fpm&#21551;&#21160;&#30340;&#29992;&#25143;&#21644;&#32452;&#65292;&#20250;&#28041;&#21450;&#21040;&#21518;&#26399;&#25991;&#20214;&#30340;&#26435;&#38480;&#38382;&#39064;
</span><span style="color: #a0522d;">group</span> = apache
<span style="color: #a0522d;">pm</span> = dynamic <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21160;&#24577;&#27169;&#24335;&#36827;&#31243;&#31649;&#29702;
</span>pm.max_children = 500 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38745;&#24577;&#26041;&#24335;&#19979;&#24320;&#21551;&#30340;php-fpm&#36827;&#31243;&#25968;&#37327;&#65292;&#22312;&#21160;&#24577;&#26041;&#24335;&#19979;&#20182;&#38480;&#23450;php-fpm&#30340;&#26368;&#22823;&#36827;&#31243;&#25968;
</span>pm.start_servers = 100 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21160;&#24577;&#27169;&#24335;&#19979;&#21021;&#22987;&#36827;&#31243;&#25968;&#65292;&#24517;&#39035;&#22823;&#20110;&#31561;&#20110;pm.min_spare_servers&#21644;&#23567;&#20110;&#31561;&#20110;pm.max_children&#30340;&#20540;&#12290;
</span>pm.min_spare_servers = 100 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26368;&#23567;&#31354;&#38386;&#36827;&#31243;&#25968;
</span>pm.max_spare_servers = 200 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26368;&#22823;&#31354;&#38386;&#36827;&#31243;&#25968;
</span>pm.max_requests = 500000 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36827;&#31243;&#32047;&#35745;&#35831;&#27714;&#22238;&#25910;&#20540;&#65292;&#20250;&#37325;&#21551;
</span>pm.status_path = /fpm_status <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29366;&#24577;&#35775;&#38382;URL
</span>ping.path = /ping <span style="color: #b22222;">#</span><span style="color: #b22222;">ping&#35775;&#38382;&#21160;&#22320;&#22336;
</span>ping.response = ping-pong <span style="color: #b22222;">#</span><span style="color: #b22222;">ping&#36820;&#22238;&#20540;
</span><span style="color: #a0522d;">slowlog</span> = /var/log/php-fpm/www-slow.log <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24930;&#26085;&#24535;&#36335;&#24452;
</span><span style="color: #a0522d;">php_admin_value</span>[error_log] = /var/log/php-fpm/www-error.log <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38169;&#35823;&#26085;&#24535;
</span><span style="color: #a0522d;">php_admin_flag</span>[log_errors] = on
<span style="color: #a0522d;">php_value</span>[session.save_handler] = files <span style="color: #b22222;">#</span><span style="color: #b22222;">phpsession&#20445;&#23384;&#26041;&#24335;&#21450;&#36335;&#24452;
</span><span style="color: #a0522d;">php_value</span>[session.save_path] = /var/lib/php/session <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#26102;&#20351;&#29992;file&#20445;&#23384;session&#30340;&#25991;&#20214;&#36335;&#24452;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:f127df1e-1147-4b8e-a286-a34f37e37cd1" class="outline-4">
<h4 id="h:f127df1e-1147-4b8e-a286-a34f37e37cd1">配置httpd 支持 fastcgi</h4>
<div class="outline-text-4" id="text-h:f127df1e-1147-4b8e-a286-a34f37e37cd1">
<p>
注意：在HTTPD服务器上必须启用proxy_fcgi_module模块，才能充当php-fpm客户端
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#dnf -y install httpd php-fpm
[root@centos8 ~]#httpd -M |grep fcgi
AH00558: httpd: Could not reliably determine the server<span style="color: #8b2252;">'s fully qualified domain name, using centos8.localdomain. Set the '</span>ServerName<span style="color: #8b2252;">' directive globally to suppress this message
proxy_fcgi_module (shared)
[root@centos8 ~]#cat /etc/httpd/conf.modules.d/00-proxy.conf
# This file configures all the proxy modules:
LoadModule proxy_module modules/mod_proxy.so
LoadModule lbmethod_bybusyness_module modules/mod_lbmethod_bybusyness.so
LoadModule lbmethod_byrequests_module modules/mod_lbmethod_byrequests.so
LoadModule lbmethod_bytraffic_module modules/mod_lbmethod_bytraffic.so
LoadModule lbmethod_heartbeat_module modules/mod_lbmethod_heartbeat.so
LoadModule proxy_ajp_module modules/mod_proxy_ajp.so
LoadModule proxy_balancer_module modules/mod_proxy_balancer.so
LoadModule proxy_connect_module modules/mod_proxy_connect.so
LoadModule proxy_express_module modules/mod_proxy_express.so
LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so
LoadModule proxy_fdpass_module modules/mod_proxy_fdpass.so
LoadModule proxy_ftp_module modules/mod_proxy_ftp.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule proxy_hcheck_module modules/mod_proxy_hcheck.so
LoadModule proxy_scgi_module modules/mod_proxy_scgi.so
LoadModule proxy_uwsgi_module modules/mod_proxy_uwsgi.so
LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so</span>
</pre>
</div>

<p>
创建httpd的配置文件 /etc/httpd/conf.d/fcgi.conf ，内容如下
</p>

<div class="org-src-container">
<pre class="src src-sh">DirectoryIndex index.php
ProxyRequests Off
ProxyPassMatch ^/(.*<span style="color: #8b2252;">\.</span>php)$ fcgi://php-fpm&#26381;&#21153;&#22120;IP:9000/var/www/html/$<span style="color: #a0522d;">1</span>
ProxyPassMatch ^/(fpm_status|ping) fcgi://127.0.0.1:9000
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;&#19978;&#24320;&#21551;FCGI&#21453;&#21521;&#20195;&#29702;,&#8220;^/&#8221;&#36825;&#22788;&#30340;&#8221;/&#8220;&#30456;&#23545;&#20110;&#21518;&#38754;&#30340;/var/www/html&#32780;&#35328;&#65292;&#21518;&#38754;&#30340;$1&#26159;&#25351;&#21069;&#38754;&#30340;/(.*.php)</span>
</pre>
</div>

<p>
说明：
</p>

<p>
如果php-fpm和httpd在同一台主机，也可以用 UDS（unix domain socket）方式
</p>

<div class="org-src-container">
<pre class="src src-sh">ProxyPassMatch ^/(.*<span style="color: #8b2252;">\.</span>php)$
unix:/var/run/php.sock|fcgi://localhost/app/httpd24/htdocs/$<span style="color: #a0522d;">1</span>
</pre>
</div>

<p>
参看：<a href="http://httpd.apache.org/docs/2.4/mod/mod_proxy_fcgi.html">http://httpd.apache.org/docs/2.4/mod/mod_proxy_fcgi.html</a>
</p>
</div>
<div id="outline-container-h:805a6eea-02ad-44da-94a0-2344f7e8901e" class="outline-5">
<h5 id="h:805a6eea-02ad-44da-94a0-2344f7e8901e">实战案例：虚拟主机配置支持FCGI</h5>
<div class="outline-text-5" id="text-h:805a6eea-02ad-44da-94a0-2344f7e8901e">
<div class="org-src-container">
<pre class="src src-sh">vim /etc/httpd/conf.d/vhosts.conf
DirectoryIndex index.php
&lt;VirtualHost *:80&gt;
    ServerName www.cici.net
    DocumentRoot /apps/vhosts/cici.net
    ProxyRequests Off
    ProxyPassMatch ^/(.*<span style="color: #8b2252;">\.</span>php)$
fcgi://127.0.0.1:9000/apps/vhosts/cici.net/$<span style="color: #a0522d;">1</span>
    ProxyPassMatch ^/(fpm_status|ping) fcgi://127.0.0.1:9000
    &lt;Directory <span style="color: #8b2252;">"/apps/vhosts/cici.net"</span>&gt;
        Options None
        AllowOverride None
        Require all granted
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:3c1428fb-e09e-462a-96ce-9be79fa55017" class="outline-5">
<h5 id="h:3c1428fb-e09e-462a-96ce-9be79fa55017">实战案例：CentOS 7 利用yum安装基于PHP-FPM模式的LAMP</h5>
<div class="outline-text-5" id="text-h:3c1428fb-e09e-462a-96ce-9be79fa55017">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;httpd&#21644;php-fpm&#21253;
</span>[root@centos7 ~]#yum install httpd php-fpm
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;Httpd mod_fcgi&#27169;&#22359;&#26159;&#21542;&#21152;&#36733;
</span>httpd -M | grep fcgi
<span style="color: #0000ff;">proxy_fcgi_module</span> (shared)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#28155;&#21152;FCGI&#30340;&#37197;&#32622;&#25991;&#20214;
</span>DirectoryIndex index.php
ProxyRequests off //&#26159;&#21542;&#24320;&#21551;&#27491;&#21521;&#20195;&#29702;
ProxyPassMatch ^/(.*<span style="color: #8b2252;">\.</span>php)$ fcgi://127.0.0.1:9000/var/www/html/$<span style="color: #a0522d;">1</span>
ProxyPassMatch ^/(fpm_status|ping) fcgi://127.0.0.1:9000

[root@centos7 ~]#systemctl start httpd php-fpm
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6ba34eee-8501-4728-b1f9-b60d9f4fa05d" class="outline-5">
<h5 id="h:6ba34eee-8501-4728-b1f9-b60d9f4fa05d">实战案例：CentOS 7 利用清华yum源实现PHP-FPM的UDS模式</h5>
<div class="outline-text-5" id="text-h:6ba34eee-8501-4728-b1f9-b60d9f4fa05d">
<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#yum install https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm
[root@centos7 ~]#yum install httpd php74-php-fpm -y
[root@centos7 ~]#vim /etc/opt/remi/php74/php-fpm.d/www.conf
<span style="color: #a0522d;">listen</span> = /var/run/php.sock
listen.owner = apache
listen.group = apache
listen.mode = 0660
pm.status_path = /fpm_status
ping.path = /ping

[root@centos7 ~]#vim /etc/httpd/conf.d/fcgi.conf
DirectoryIndex index.php
ProxyRequests Off
<span style="color: #b22222;">#</span><span style="color: #b22222;">ProxyPassMatch ^/(.*\.php)$ fcgi://10.0.0.17:9000/data/html/$1
</span>ProxyPassMatch ^/(.*<span style="color: #8b2252;">\.</span>php)$
unix:/var/run/php.sock|fcgi://localhost/var/www/html/$<span style="color: #a0522d;">1</span>
ProxyPassMatch ^/(fpm_status|ping) unix:/var/run/php.sock|fcgi://localhost

[root@centos7 ~]#systemctl restart httpd php74-php-fpm.service
[root@centos7 ~]#curl http://127.0.0.1/ping
pong[root@centos7 ~]#curl http://127.0.0.1/fpm_status
pool:                   www
process manager:        dynamic
start time:             11/Mar/2020:11:43:56 +0800
start since:            488
accepted conn:          8
listen queue:           0
max listen queue:       0
listen queue len:       0
idle processes:         4
active processes:       1
total processes:        5
max active processes:   1
max children reached:   0
slow requests:          0
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c1585b3a-7dc9-4a5a-a301-7430a08332e4" class="outline-5">
<h5 id="h:c1585b3a-7dc9-4a5a-a301-7430a08332e4">实战案例：CentOS 8上实现PHP-FPM状态页</h5>
<div class="outline-text-5" id="text-h:c1585b3a-7dc9-4a5a-a301-7430a08332e4">
<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#dnf -y install httpd php-fpm

[root@centos8 ~]#vim /etc/php-fpm.d/www.conf
pm.status_path = /fpm_status
ping.path = /ping

[root@centos8 ~]#vim /etc/httpd/conf.d/php.conf
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22686;&#21152;#######&#20043;&#38388;&#20869;&#23481;
</span>&lt;IfModule !mod_php5.c&gt;
  &lt;IfModule !mod_php7.c&gt;
    <span style="color: #b22222;"># </span><span style="color: #b22222;">Enable http authorization headers
</span>    SetEnvIfNoCase ^Authorization$ <span style="color: #8b2252;">"(.+)"</span> <span style="color: #a0522d;">HTTP_AUTHORIZATION</span>=$<span style="color: #a0522d;">1</span>

    &lt;FilesMatch <span style="color: #8b2252;">\.</span>(php|phar)$&gt;
        SetHandler <span style="color: #8b2252;">"proxy:unix:/run/php-fpm/www.sock|fcgi://localhost"</span>
    &lt;/FilesMatch&gt;
    <span style="color: #b22222;">#######</span><span style="color: #b22222;">
</span>    &lt;Locationmatch /(fpm_status|ping) &gt;
        SetHandler <span style="color: #8b2252;">"proxy:unix:/run/php-fpm/www.sock|fcgi://localhost"</span>
    &lt;/locationmatch&gt;
    <span style="color: #b22222;">#######</span><span style="color: #b22222;">
</span>  &lt;/IfModule&gt;
&lt;/IfModule&gt;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:10d40a5b-ea87-4631-94d7-b6acef66453a" class="outline-4">
<h4 id="h:10d40a5b-ea87-4631-94d7-b6acef66453a">综合实战案例</h4>
<div class="outline-text-4" id="text-h:10d40a5b-ea87-4631-94d7-b6acef66453a">
</div>
<div id="outline-container-h:772461c8-d0ea-45a6-8195-63c9d521ea9a" class="outline-5">
<h5 id="h:772461c8-d0ea-45a6-8195-63c9d521ea9a">目标</h5>
<div class="outline-text-5" id="text-h:772461c8-d0ea-45a6-8195-63c9d521ea9a">
<p>
利用清华yum源，安装php7.4+wordpress5.4.2+opcache+event模式
</p>
</div>
</div>
<div id="outline-container-h:ea9d46ce-0af7-4f35-8aa9-b74d149781d3" class="outline-5">
<h5 id="h:ea9d46ce-0af7-4f35-8aa9-b74d149781d3">环境准备</h5>
<div class="outline-text-5" id="text-h:ea9d46ce-0af7-4f35-8aa9-b74d149781d3">
<p>
两台主机
</p>

<div class="org-src-container">
<pre class="src src-sh">&#19968;&#21488; apache + php7.4
b&#19968;&#21488; mariadb
</pre>
</div>
</div>
</div>
<div id="outline-container-h:cb7d7853-ac17-4831-84dc-d9324bb8fcf6" class="outline-5">
<h5 id="h:cb7d7853-ac17-4831-84dc-d9324bb8fcf6">步骤</h5>
<div class="outline-text-5" id="text-h:cb7d7853-ac17-4831-84dc-d9324bb8fcf6">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;httpd 2.4 &#21644; php 7.4 &#30456;&#20851;&#21253;
</span>yum install -y https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm
yum install -y httpd php74-php-fpm php74-php-mysqlnd php74-php-opcache

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37197;&#32622;php&#20026;UDS&#27169;&#24335;
</span>vi /etc/opt/remi/php74/php-fpm.d/www.conf
<span style="color: #a0522d;">listen</span>=/var/run/php.sock
listen.owner = apache
listen.group = apache
listen.mode = 0660

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37197;&#32622;httpd &#25903;&#25345; php &#30340;fastcgi&#27169;&#24335;
</span>vim /etc/httpd/conf.d/test.conf
DirectoryIndex index.php
ProxyRequests Off
ProxyPassMatch ^/(.*<span style="color: #8b2252;">\.</span>php)$
unix:/var/run/php.sock|fcgi://localhost/var/www/html/$<span style="color: #a0522d;">1</span>

systemctl start httpd php74-php-fpm.service

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;wordpress&#31243;&#24207;&#25991;&#20214;
</span>mkdir /data/
unzip wordpress-5.4.2-zh_CN.zip
mv wordpress/ /var/www/html/
setfacl &#8211;R &#8211;m u:apache:rwx /var/www/html/wordpress/
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25110;&#32773;chown &#8211;R apache.apache /var/www/html/wordpress
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;&#21478;&#19968;&#21488;&#20027;&#26426;&#19978;&#23433;&#35013;mariadb
</span>yum install mariadb-server
systemctl start mariadb
mysql -uroot
mysql&gt; create database wordpress;
mysql&gt; grant all on wordpress.* to wpuser@<span style="color: #8b2252;">'10.0.0.%'</span> identified by <span style="color: #8b2252;">"cici"</span>;
mysql&gt; flush privileges;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#24320;&#27983;&#35272;&#22120;&#35775;&#38382; http://httpd&#26381;&#21153;&#22120;IP/wordpress&#65292;&#36827;&#34892;&#21021;&#22987;&#21270;&#21644;&#23433;&#35013;</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:928e2599-91d5-4417-838b-b62c49ae5823" class="outline-3">
<h3 id="h:928e2599-91d5-4417-838b-b62c49ae5823">编译安装php</h3>
<div class="outline-text-3" id="text-h:928e2599-91d5-4417-838b-b62c49ae5823">
</div>
<div id="outline-container-h:52589d4f-503f-4990-abcf-0f58b0ef0eda" class="outline-4">
<h4 id="h:52589d4f-503f-4990-abcf-0f58b0ef0eda">编译安装 httpd 模块方式的php5.6</h4>
<div class="outline-text-4" id="text-h:52589d4f-503f-4990-abcf-0f58b0ef0eda">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#30456;&#20851;&#21253;&#65292;&#20381;&#36182;epel&#28304;
</span>yum install gcc make libxml2-devel bzip2-devel libmcrypt-devel

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#35793;&#23433;&#35013;php
</span>tar xvf php-5.6.30.tar.bz2
<span style="color: #483d8b;">cd</span> php-5.6.30
./configure --prefix=/apps/php <span style="color: #8b2252;">\</span>
--with-mysql=/usr/local/mysql <span style="color: #8b2252;">\</span>
--with-openssl <span style="color: #8b2252;">\</span>
--with-mysqli=/usr/local/mysql/bin/mysql_config <span style="color: #8b2252;">\</span>
--enable-mbstring <span style="color: #8b2252;">\</span>
--with-png-dir <span style="color: #8b2252;">\</span>
--with-jpeg-dir <span style="color: #8b2252;">\</span>
--with-freetype-dir <span style="color: #8b2252;">\</span>
--with-zlib <span style="color: #8b2252;">\</span>
--with-libxml-dir=/usr <span style="color: #8b2252;">\</span>
--enable-xml <span style="color: #8b2252;">\</span>
--enable-sockets <span style="color: #8b2252;">\</span>
--with-apxs2=/app/httpd24/bin/apxs <span style="color: #8b2252;">\</span>
--with-mcrypt <span style="color: #8b2252;">\</span>
--with-config-file-path=/etc <span style="color: #8b2252;">\</span>
--with-config-file-scan-dir=/etc/php.d <span style="color: #8b2252;">\</span>
--with-bz2

make -j 4 &amp;&amp; make install

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;php&#30340;&#37197;&#32622;&#25991;&#20214;
</span><span style="color: #483d8b;">cd</span> php-5.6.30
cp php.ini-production /etc/php.ini

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;httpd&#37197;&#32622;&#25991;&#20214;&#25903;&#25345;php
</span>vim /etc/httpd24/conf/httpd.conf
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#19979;&#38754;&#21152;&#20108;&#34892;
</span>AddType application/x-httpd-php .php
AddType application/x-httpd-php-source .phps

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23450;&#20301;&#33267;DirectoryIndex index.html&#65292; &#20462;&#25913;&#20026;
</span>DirectoryIndex index.php index.html

apachectl restart
</pre>
</div>
</div>
</div>
<div id="outline-container-h:93553f7b-ce0a-4797-a21f-3f11db5dfaf5" class="outline-4">
<h4 id="h:93553f7b-ce0a-4797-a21f-3f11db5dfaf5">编译安装 httpd 模块方式的 php 7.3</h4>
<div class="outline-text-4" id="text-h:93553f7b-ce0a-4797-a21f-3f11db5dfaf5">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#30456;&#20851;&#21253;, &#20381;&#36182;epel&#28304;
</span>yum install gcc make libxml2-devel bzip2-devel libmcrypt-devel

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#35793;&#23433;&#35013;php 7.3
</span>tar xvf php-7.3.10.tar.xz
<span style="color: #483d8b;">cd</span> php-7.3.10/
./configure <span style="color: #8b2252;">\</span>
--prefix=/apps/php <span style="color: #8b2252;">\</span>
--enable-mysqlnd <span style="color: #8b2252;">\</span>
--with-mysqli=mysqlnd <span style="color: #8b2252;">\</span>
--with-openssl <span style="color: #8b2252;">\</span>
--with-pdo-mysql=mysqlnd <span style="color: #8b2252;">\</span>
--enable-mbstring <span style="color: #8b2252;">\</span>
--with-freetype-dir <span style="color: #8b2252;">\</span>
--with-jpeg-dir <span style="color: #8b2252;">\</span>
--with-png-dir <span style="color: #8b2252;">\</span>
--with-zlib <span style="color: #8b2252;">\</span>
--with-libxml-dir=/usr <span style="color: #8b2252;">\</span>
--enable-xml <span style="color: #8b2252;">\</span>
--enable-sockets <span style="color: #8b2252;">\</span>
--with-apxs2=/app/httpd24/bin/apxs <span style="color: #8b2252;">\</span>
--with-config-file-path=/etc <span style="color: #8b2252;">\</span>
--with-config-file-scan-dir=/etc/php.d <span style="color: #8b2252;">\</span>
--enable-maintainer-zts <span style="color: #8b2252;">\</span>
--disable-fileinfo

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35828;&#26126;&#65306;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">--enable-maintainer-zts &#20165;&#38024;&#23545;mpm&#20026;event&#21644;worker&#30340;&#24773;&#20917;,&#32534;&#35793;&#25104;zts&#27169;&#22359;,&#22914;&#26524;&#26159;prefork&#21017;&#19981;&#38656;&#35201;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">php-7.0 &#20197;&#19978;&#29256;&#26412;&#20351;&#29992;--enable-mysqlnd --with-mysqli=mysqlnd &#65292;&#21407;--with-mysql&#19981;&#20877;&#25903;&#25345;
</span>
make -j 4 &amp;&amp; make install

cp php.ini-production /etc/php.ini

vim /etc/httpd24/httpd.conf
&#22312;&#25991;&#20214;&#23614;&#37096;&#21152;&#20004;&#34892;
AddType application/x-httpd-php .php
AddType application/x-httpd-php-source .phps
&#20462;&#25913;&#19979;&#38754;&#34892;
&lt;IfModule dir_module&gt;
    DirectoryIndex index.php index.html
&lt;/IfModule&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:7bcb9e69-fead-4da4-ad4e-bda4cc9a3c70" class="outline-4">
<h4 id="h:7bcb9e69-fead-4da4-ad4e-bda4cc9a3c70">编译安装 fastcgi 方式的php 7.4</h4>
<div class="outline-text-4" id="text-h:7bcb9e69-fead-4da4-ad4e-bda4cc9a3c70">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#30456;&#20851;&#21253;&#65292;&#20381;&#36182;EPEL&#28304;
</span>yum install gcc libxml2-devel bzip2-devel libmcrypt-devel sqlite-devel oniguruma-devel

tar xvf php-7.4.3.tar.xz
<span style="color: #483d8b;">cd</span> php-7.4.3/

./configure <span style="color: #8b2252;">\</span>
--prefix=/apps/php74 <span style="color: #8b2252;">\</span>
--enable-mysqlnd <span style="color: #8b2252;">\</span>
--with-mysqli=mysqlnd <span style="color: #8b2252;">\</span>
--with-pdo-mysql=mysqlnd <span style="color: #8b2252;">\</span>
--with-openssl <span style="color: #8b2252;">\</span>
--with-zlib <span style="color: #8b2252;">\</span>
--with-config-file-path=/etc <span style="color: #8b2252;">\</span>
--with-config-file-scan-dir=/etc/php.d <span style="color: #8b2252;">\</span>
--enable-mbstring <span style="color: #8b2252;">\</span>
--enable-xml <span style="color: #8b2252;">\</span>
--enable-sockets <span style="color: #8b2252;">\</span>
--enable-fpm <span style="color: #8b2252;">\</span>
--enable-maintainer-zts <span style="color: #8b2252;">\</span>
--disable-fileinfo

make &amp;&amp; make install
</pre>
</div>
</div>
</div>
<div id="outline-container-h:5f9a9442-a6f6-4daf-bc2a-2c85c176b63a" class="outline-4">
<h4 id="h:5f9a9442-a6f6-4daf-bc2a-2c85c176b63a">编译安装 fastcgi 方式的php 7.3</h4>
<div class="outline-text-4" id="text-h:5f9a9442-a6f6-4daf-bc2a-2c85c176b63a">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#30456;&#20851;&#21253;&#65292;&#20381;&#36182;EPEL&#28304;
</span>yum install gcc make libxml2-devel bzip2-devel libmcrypt-devel

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#35793;&#23433;&#35013; php 7.3
</span>tar xvf php-7.3.10.tar.bz2
<span style="color: #483d8b;">cd</span> php-7.3.10/
./configure --prefix=/apps/php <span style="color: #8b2252;">\</span>
--enable-mysqlnd <span style="color: #8b2252;">\</span>
--with-mysqli=mysqlnd <span style="color: #8b2252;">\</span>
--with-pdo-mysql=mysqlnd <span style="color: #8b2252;">\</span>
--with-openssl <span style="color: #8b2252;">\</span>
--with-freetype-dir <span style="color: #8b2252;">\</span>
--with-jpeg-dir <span style="color: #8b2252;">\</span>
--with-png-dir <span style="color: #8b2252;">\</span>
--with-zlib <span style="color: #8b2252;">\</span>
--with-libxml-dir=/usr <span style="color: #8b2252;">\</span>
--with-config-file-path=/etc <span style="color: #8b2252;">\</span>
--with-config-file-scan-dir=/etc/php.d <span style="color: #8b2252;">\</span>
--enable-mbstring <span style="color: #8b2252;">\</span>
--enable-xml <span style="color: #8b2252;">\</span>
--enable-sockets <span style="color: #8b2252;">\</span>
--enable-fpm <span style="color: #8b2252;">\</span>
--enable-maintainer-zts <span style="color: #8b2252;">\</span>
--disable-fileinfo
make &amp;&amp; make install

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;php&#30340;&#37197;&#32622;&#25991;&#20214;
</span><span style="color: #483d8b;">cd</span> php-7.3.10/
cp php.ini-production /etc/php.ini
<span style="color: #483d8b;">cd</span> /apps/php/etc
cp php-fpm.conf.default php-fpm.conf
cp php-fpm.d/www.conf.default php-fpm.d/www.conf

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;php-fpm&#21551;&#21160;&#33050;&#26412;&#25110;service unit&#25991;&#20214;
</span>cp sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm
chmod +x /etc/init.d/php-fpm
chkconfig --add php-fpm
chkconfig php-fpm on
service php-fpm start

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25110;&#32773;
</span>cp sapi/fpm/php-fpm.service /usr/lib/systemd/system/
systemctl daemon-reload
systemctl start php-fpm

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37197;&#32622;httpd&#25903;&#25345;php-fpm
</span>vim /apps/httpd24/conf/httpd.conf
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21462;&#28040;&#19979;&#38754;&#20004;&#34892;&#30340;&#27880;&#37322;
</span>LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#19979;&#38754;&#34892;
</span>&lt;IfModule dir_module&gt;
    DirectoryIndex index.php index.html
&lt;/IfModule&gt;
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21152;&#19979;&#38754;&#22235;&#34892;
</span>AddType application/x-httpd-php .php
AddType application/x-httpd-php-source .phps
ProxyRequests Off
ProxyPassMatch ^/(.*.php) fcgi://127.0.0.1:9000/var/www/html/$<span style="color: #a0522d;">1</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25903;&#25345;opcache&#21152;&#36895;
</span>vim /etc/php.ini
[opcache]
<span style="color: #a0522d;">zend_extension</span>=opcache.so
    opcache.enable=1
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:3e04e6db-1e44-4938-a89f-8fccccecdbb3" class="outline-3">
<h3 id="h:3e04e6db-1e44-4938-a89f-8fccccecdbb3">实战案例</h3>
<div class="outline-text-3" id="text-h:3e04e6db-1e44-4938-a89f-8fccccecdbb3">
</div>
<div id="outline-container-h:3010e178-b9b9-4f5c-8f72-1acc0a89403d" class="outline-4">
<h4 id="h:3010e178-b9b9-4f5c-8f72-1acc0a89403d">实战案例1: 编译安装基于HTTPD模块的LAMP架构应用</h4>
<div class="outline-text-4" id="text-h:3010e178-b9b9-4f5c-8f72-1acc0a89403d">
</div>
<div id="outline-container-h:9d577a06-bb95-45b6-b724-1c9131b0e310" class="outline-5">
<h5 id="h:9d577a06-bb95-45b6-b724-1c9131b0e310">目标</h5>
<div class="outline-text-5" id="text-h:9d577a06-bb95-45b6-b724-1c9131b0e310">
<p>
实现CentOS 7 编译安装基于httpd 模块方式的LAMP
</p>
</div>
</div>
<div id="outline-container-h:3d09fc97-afd6-44f9-a1aa-3ddc5c25921c" class="outline-5">
<h5 id="h:3d09fc97-afd6-44f9-a1aa-3ddc5c25921c">环境准备</h5>
<div class="outline-text-5" id="text-h:3d09fc97-afd6-44f9-a1aa-3ddc5c25921c">
<p>
两台主机：
</p>

<ul class="org-ul">
<li>一台主机：httpd+php(模块方式)</li>
<li>一台主机：mariadb 服务器</li>
</ul>

<p>
软件版本：
</p>

<ul class="org-ul">
<li>mariadb-10.2.27-linux-x86_64.tar.gz 通用二进制格式</li>
<li>apr-1.7.0.tar.bz2</li>
<li>apr-util-1.6.1.tar.bz2</li>
<li>httpd-2.4.41.tar.gz</li>
<li>php-7.3.10.tar.xz</li>
<li>wordpress-5.2.3-zh_CN.zip</li>
</ul>
</div>
</div>
<div id="outline-container-h:19d714a4-9caa-4eb5-942f-9957e2d9092d" class="outline-5">
<h5 id="h:19d714a4-9caa-4eb5-942f-9957e2d9092d">实现步骤</h5>
<div class="outline-text-5" id="text-h:19d714a4-9caa-4eb5-942f-9957e2d9092d">
<p>
<b>7.1.3.1 二进制安装mariadb</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">useradd -r -s /sbin/nologin mysql
tar xvf mariadb-10.2.27-linux-x86_64.tar.gz -C /usr/local
<span style="color: #483d8b;">cd</span> /usr/local
ls -sv mariadb-10.2.27-linux-x86_64 mysql
<span style="color: #483d8b;">cd</span> mysql
chown -R root.root ./*
mkdir /data/mysql -p
chown -R mysql.mysql /data/mysql
mkdir /etc/mysql
cp support-files/my-huge.cnf /etc/mysql/my.cnf
vim /etc/mysql/my.cnf
[mysqld]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21152;&#19977;&#34892;
</span><span style="color: #a0522d;">datadir</span> =/data/mysql
<span style="color: #a0522d;">skip_name_resolve</span> = ON

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;PATH&#21464;&#37327;
</span>vim /etc/profile.d/lamp.sh
<span style="color: #a0522d;">PATH</span>=/usr/local/mysql/bin/:$<span style="color: #a0522d;">PATH</span>
. /etc/profile.d/lamp.sh

<span style="color: #483d8b;">cd</span> /usr/local/mysql;scripts/mysql_install_db --user=mysql --datadir=/data/mysql
cp support-files/mysql.server /etc/rc.d/init.d/mysqld
chkconfig --add mysqld
service mysqld start

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;wordpress&#24212;&#29992;&#20934;&#22791;&#25968;&#25454;&#24211;&#21644;&#29992;&#25143;
</span>mysql
mysql&gt; create database wordpress;
mysql&gt; grant all on wordpress.* to wpuser@<span style="color: #8b2252;">'192.168.8.%'</span> identified by <span style="color: #8b2252;">"wppass"</span>;
</pre>
</div>

<p>
<b>7.1.3.2 编译安装httpd-2.4</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">useradd -r -s /sbin/nologin apache
yum install gcc pcre-devel openssl-devel expat-devel
tar xvf apr-1.7.0.tar.bz2
tar xvf apr-util-1.6.1.tar.bz2
tar xf httpd-2.4.41.tar.gz
mv apr-1.7.0 httpd-2.4.41/srclib/apr
mv apr-util-1.6.1 httpd-2.4.41/srclib/apr-uti
<span style="color: #483d8b;">cd</span> httpd-2.4.41/

./configure --prefix=/apps/httpd24 <span style="color: #8b2252;">\</span>
    --enable-so <span style="color: #8b2252;">\</span>
    --enable-ssl <span style="color: #8b2252;">\</span>
    --enable-cgi <span style="color: #8b2252;">\</span>
    --enable-rewrite <span style="color: #8b2252;">\</span>
    --with-zlib <span style="color: #8b2252;">\</span>
    --with-pcre <span style="color: #8b2252;">\</span>
    --enable-modules=most <span style="color: #8b2252;">\</span>
    --enable-mpms-shared=all <span style="color: #8b2252;">\</span>
    --with-mpm=prefork <span style="color: #8b2252;">\</span>
    --with-included-apr
make -j 4 &amp;&amp; make install

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37197;&#32622;PATH&#21464;&#37327;
</span>vim /etc/profile.d/lamp.sh
<span style="color: #a0522d;">PATH</span>=/usr/local/mysql/bin/:/app/httpd24/bin:$<span style="color: #a0522d;">PATH</span>

. /etc/profile.d/lamp.sh

vim /app/httpd24/conf/httpd
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#19979;&#38754;&#20004;&#34892;
</span>user apache
group apache

apachectl start
</pre>
</div>

<p>
<b>7.1.3.3 编译安装httpd模块方式 php-7.3</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#30456;&#20851;&#21253;,&#20381;&#36182;EPEL&#28304;
</span>yum install gcc libxml2-devel bzip2-devel libmcrypt-devel

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#35793;&#23433;&#35013;php
</span>tar xvf php-7.3.10.tar.xz
<span style="color: #483d8b;">cd</span> php-7.3.10/

./configure <span style="color: #8b2252;">\</span>
--prefix=/apps/php <span style="color: #8b2252;">\ </span>   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#36335;&#24452;
</span>--enable-mysqlnd <span style="color: #8b2252;">\ </span>     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#29992;&#36830;&#25509;&#25968;&#25454;&#24211;&#30340;&#27169;&#22359;
</span>--with-mysqli=mysqlnd <span style="color: #8b2252;">\</span>
--with-openssl <span style="color: #8b2252;">\</span>
--with-pdo-mysql=mysqlnd <span style="color: #8b2252;">\</span>
--enable-mbstring <span style="color: #8b2252;">\</span>
--with-freetype-dir <span style="color: #8b2252;">\</span>
--with-jpeg-dir <span style="color: #8b2252;">\</span>
--with-png-dir <span style="color: #8b2252;">\</span>
--with-zlib <span style="color: #8b2252;">\</span>
--with-libxml-dir=/usr <span style="color: #8b2252;">\</span>
--enable-xml <span style="color: #8b2252;">\</span>
--enable-sockets <span style="color: #8b2252;">\</span>
--with-apxs2=/app/httpd24/bin/apxs <span style="color: #8b2252;">\ </span>  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#29992;php&#30340;&#27169;&#22359;&#26041;&#24335;
</span>--with-config-file-path=/etc <span style="color: #8b2252;">\</span>
--with-config-file-scan-dir=/etc/php.d <span style="color: #8b2252;">\</span>
--enable-maintainer-zts <span style="color: #8b2252;">\</span>
--disable-fileinfo

make -j 4 &amp;&amp; make install

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;php&#25552;&#20379;&#37197;&#32622;&#25991;&#20214;&#65292;php.ini-production&#26159;&#27169;&#26495;&#25991;&#20214;
</span>cp php.ini-production /etc/php.ini
</pre>
</div>

<p>
<b>7.1.3.4 编辑apache配置文件支持php</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">vim /etc/httpd24/conf/httpd.conf
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#19979;&#38754;&#21152;&#20108;&#34892;&#65292;&#25903;&#25345;php&#21518;&#32512;&#65292;.phps&#30340;&#21518;&#32512;&#65288;&#19981;&#21152;&#20063;&#34892;&#65289;
</span>AddType application/x-httpd-php .php
AddType application/x-httpd-php-source .phps

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23450;&#20301;&#33267;DirectoryIndex index.html&#65292; &#20462;&#25913;&#20026;
</span>DirectoryIndex index.php index.html   <span style="color: #b22222;">#</span><span style="color: #b22222;">index.php&#35843;&#21040;&#31532;&#19968;&#20010;
</span>
apachectl restart
</pre>
</div>

<p>
<b>7.1.3.6 部署wordpress</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">unzip wordpress-5.2.3-zh_CN.zip
mv wordpress /var/www/html
setfacl &#8211;R &#8211;m u:apache:rwx /var/www/html/wordpress/
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25110;&#32773;chown &#8211;R apache.apache /var/www/html/wordpress
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#24320;http://LAMP&#26381;&#21153;&#22120;IP/wordpress&#36827;&#34892;&#39029;&#38754;&#23433;&#35013;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:eab82c1a-d11b-4a31-b40b-6290639140b6" class="outline-4">
<h4 id="h:eab82c1a-d11b-4a31-b40b-6290639140b6">实战案例2: 编译安装基于 FASTCGI 模式LAMP架构应用（重点）</h4>
<div class="outline-text-4" id="text-h:eab82c1a-d11b-4a31-b40b-6290639140b6">
</div>
<div id="outline-container-h:e1ec9b59-b9df-4ce6-8707-54ba518a550c" class="outline-5">
<h5 id="h:e1ec9b59-b9df-4ce6-8707-54ba518a550c">目标</h5>
<div class="outline-text-5" id="text-h:e1ec9b59-b9df-4ce6-8707-54ba518a550c">
<p>
实现CentOS 7 编译安装基于 <b>fastcgi</b>
模式的多虚拟主机的wordpress和discuz的LAMP架构
</p>

<p>
建议写成playbook
</p>
</div>
</div>
<div id="outline-container-h:c3a81fb9-b324-4fbe-b947-95a7b07baacc" class="outline-5">
<h5 id="h:c3a81fb9-b324-4fbe-b947-95a7b07baacc">环境准备</h5>
<div class="outline-text-5" id="text-h:c3a81fb9-b324-4fbe-b947-95a7b07baacc">
<p>
两台主机：
</p>

<ul class="org-ul">
<li>一台主机：httpd+php(fastcgi模式)</li>
<li>一台主机：mariadb 服务器</li>
</ul>

<p>
软件版本：
</p>

<ul class="org-ul">
<li>CentOS 7.8</li>
<li>mariadb-10.2.27-linux-x86_64.tar.gz 通用二进制格式</li>
<li>apr-1.7.0.tar.bz2</li>
<li>apr-util-1.6.1.tar.bz2</li>
<li>httpd-2.4.43.tar.gz</li>
<li>php-7.4.7.tar.xz 或 php-7.3.10.tar.bz2</li>
<li>wordpress-5.4.2-zh_CN.tar.gz</li>
<li>Discuz_X3.4_SC_UTF8【20191201】.zip</li>
</ul>
</div>
</div>
<div id="outline-container-h:6a2ff891-1c16-4f84-8b47-4461ed771a75" class="outline-5">
<h5 id="h:6a2ff891-1c16-4f84-8b47-4461ed771a75">实现步骤</h5>
<div class="outline-text-5" id="text-h:6a2ff891-1c16-4f84-8b47-4461ed771a75">
<p>
<b>7.2.3.1 二进制安装mariadb</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">useradd -r -s /sbin/nologin mysql
tar xvf mariadb-10.2.27-linux-x86_64.tar.gz -C /usr/local
<span style="color: #483d8b;">cd</span> /usr/local
ln -sv mariadb-10.2.27-linux-x86_64 mysql
<span style="color: #483d8b;">cd</span> mysql
chown -R root.root ./*
mkdir /data/mysql -p
chown -R mysql.mysql /data/mysql
mkdir /etc/mysql
cp support-files/my-huge.cnf /etc/mysql/my.cnf
vim /etc/mysql/my.cnf
[mysqld]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21152;&#19979;&#38754;&#34892;
</span><span style="color: #a0522d;">datadir</span> =/data/mysql
<span style="color: #a0522d;">skip_name_resolve</span> = ON

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;PATH&#21464;&#37327;
</span>vim /etc/profile.d/lamp.sh
<span style="color: #a0522d;">PATH</span>=/usr/local/mysql/bin/:$<span style="color: #a0522d;">PATH</span>
. /etc/profile.d/lamp.sh

yum install libaio -y
<span style="color: #483d8b;">cd</span> /usr/local/mysql;scripts/mysql_install_db --user=mysql --datadir=/data/mysql
cp support-files/mysql.server /etc/rc.d/init.d/mysqld
chkconfig --add mysqld
service mysqld start

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;wordprss&#21644;discuz&#24212;&#29992;&#20934;&#22791;&#25968;&#25454;&#24211;&#21644;&#29992;&#25143;&#24080;&#21495;
</span>mysql -uroot
mysql&gt; create database wordpress;
mysql&gt; create database discuz;
mysql&gt; grant all on wordpress.* to wpuser@<span style="color: #8b2252;">'10.0.0.%'</span> identified by <span style="color: #8b2252;">"wppass"</span>;
mysql&gt; grant all on discuz.* to discuz@<span style="color: #8b2252;">'10.0.0.%'</span> identified by <span style="color: #8b2252;">'dispass'</span>;
</pre>
</div>


<figure id="orge8f06ef">
<img src="./images/20200710091126525.png" alt="20200710091126525.png">

</figure>

<p>
注意：mysql数据库不能和mariadb一样同时创建用户和授权
</p>

<p>
<b>7.2.3.2 编译安装 httpd 2.4</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#30456;&#20851;&#21253;
</span>yum install gcc pcre-devel openssl-devel expat-devel -y

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#35793;&#23433;&#35013;httpd
</span>tar xvf apr-1.7.0.tar.bz2
tar xvf apr-util-1.6.1.tar.bz2
tar xf httpd-2.4.43.tar.gz
mv apr-1.7.0 httpd-2.4.43/srclib/apr
mv apr-util-1.6.1 httpd-2.4.43/srclib/apr-util

<span style="color: #483d8b;">cd</span> httpd-2.4.43/
./configure <span style="color: #8b2252;">\</span>
--prefix=/apps/httpd24 <span style="color: #8b2252;">\</span>
--enable-so <span style="color: #8b2252;">\</span>
--enable-ssl <span style="color: #8b2252;">\</span>
--enable-cgi <span style="color: #8b2252;">\</span>
--enable-rewrite <span style="color: #8b2252;">\</span>
--with-zlib <span style="color: #8b2252;">\</span>
--with-pcre <span style="color: #8b2252;">\</span>
--with-included-apr <span style="color: #8b2252;">\</span>
--enable-modules=most <span style="color: #8b2252;">\</span>
--enable-mpms-shared=all <span style="color: #8b2252;">\</span>
--with-mpm=event

make &amp;&amp; make install

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;PATH&#21464;&#37327;
</span>vim /etc/profile.d/lamp.sh
<span style="color: #a0522d;">PATH</span>=/apps/httpd24/bin:$<span style="color: #a0522d;">PATH</span>
. /etc/profile.d/lamp.sh

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;&#21644;&#37197;&#32622;&#29992;&#25143;&#21644;&#32452;
</span>useradd -s /sbin/nologin -r -u 88 apache
vim /apps/httpd24/conf/httpd.conf
user apache
group apache

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#20026;event&#27169;&#24335;,&#32534;&#35793;&#26102;&#24050;&#25351;&#23450;&#65292;&#27492;&#39033;&#19981;&#20877;&#38656;&#20462;&#25913;&#65292;&#21487;&#36873;&#39033;
</span>vim /apps/httpd24/conf/httpd.conf
LoadModule mpm_event_module modules/mod_mpm_event.so

<span style="color: #b22222;">#</span><span style="color: #b22222;">LoadModule mpm_prefork_module modules/mod_mpm_prefork.so
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">LoadModule mpm_worker_module modules/mod_mpm_worker.so
</span>
httpd -M |grep mpm
<span style="color: #0000ff;">mpm_event_module</span> (shared)

apachectl start

[root@centos7 ~]#vim /usr/lib/systemd/system/httpd.service
[Unit]
<span style="color: #a0522d;">Description</span>=The Apache HTTP Server
<span style="color: #a0522d;">After</span>=network.target remote-fs.target nss-lookup.target
<span style="color: #a0522d;">Documentation</span>=man:httpd(8)
<span style="color: #a0522d;">Documentation</span>=man:apachectl(8)
[Service]
<span style="color: #a0522d;">Type</span>=forking
<span style="color: #b22222;">#</span><span style="color: #b22222;">EnvironmentFile=/etc/sysconfig/httpd
</span><span style="color: #a0522d;">ExecStart</span>=/apps/httpd24/bin/apachectl start
<span style="color: #b22222;">#</span><span style="color: #b22222;">ExecStart=/apps/httpd24/bin/httpd $OPTIONS -k start
</span><span style="color: #a0522d;">ExecReload</span>=/apps/httpd24/bin/apachectl graceful
<span style="color: #b22222;">#</span><span style="color: #b22222;">ExecReload=/apps/httpd24/bin/httpd $OPTIONS -k graceful
</span><span style="color: #a0522d;">ExecStop</span>=/apps/httpd24/bin/apachectl stop
<span style="color: #a0522d;">KillSignal</span>=SIGCONT
<span style="color: #a0522d;">PrivateTmp</span>=true
[Install]
<span style="color: #a0522d;">WantedBy</span>=multi-user.target
</pre>
</div>

<p>
<b>7.2.3.3 编译安装 fastcgi 方式的 php 7.4</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#30456;&#20851;&#21253;,&#20381;&#36182;EPEL&#28304;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">php 7.4 &#30456;&#20851;&#21253;
</span>yum -y install gcc libxml2-devel bzip2-devel libmcrypt-devel sqlite-devel oniguruma-devel
<span style="color: #b22222;">#</span><span style="color: #b22222;">php 7.3 &#30456;&#20851;&#21253;
</span>yum -y install gcc libxml2-devel bzip2-devel libmcrypt-devel

<span style="color: #b22222;">#</span><span style="color: #b22222;">php7.4 &#32534;&#35793;
</span>tar xvf php-7.4.7.tar.xz
<span style="color: #483d8b;">cd</span> php-7.4.7/

./configure <span style="color: #8b2252;">\</span>
--prefix=/apps/php74 <span style="color: #8b2252;">\</span>
--enable-mysqlnd <span style="color: #8b2252;">\</span>
--with-mysqli=mysqlnd <span style="color: #8b2252;">\</span>
--with-pdo-mysql=mysqlnd <span style="color: #8b2252;">\</span>
--with-openssl <span style="color: #8b2252;">\</span>
--with-zlib <span style="color: #8b2252;">\</span>
--with-config-file-path=/etc <span style="color: #8b2252;">\</span>
--with-config-file-scan-dir=/etc/php.d <span style="color: #8b2252;">\</span>
--enable-mbstring <span style="color: #8b2252;">\</span>
--enable-xml <span style="color: #8b2252;">\</span>
--enable-sockets <span style="color: #8b2252;">\</span>
--enable-fpm <span style="color: #8b2252;">\</span>
--enable-maintainer-zts <span style="color: #8b2252;">\</span>
--disable-fileinfo

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#35793;&#23433;&#35013;php 7.3
</span>tar xvf php-7.3.10.tar.bz2
<span style="color: #483d8b;">cd</span> php-7.3.10

./configure --prefix=/apps/php73 <span style="color: #8b2252;">\</span>
--enable-mysqlnd <span style="color: #8b2252;">\</span>
--with-mysqli=mysqlnd <span style="color: #8b2252;">\</span>
--with-pdo-mysql=mysqlnd <span style="color: #8b2252;">\</span>
--with-openssl <span style="color: #8b2252;">\</span>
--with-freetype-dir <span style="color: #8b2252;">\</span>
--with-jpeg-dir <span style="color: #8b2252;">\</span>
--with-png-dir <span style="color: #8b2252;">\</span>
--with-zlib <span style="color: #8b2252;">\</span>
--with-libxml-dir=/usr <span style="color: #8b2252;">\</span>
--with-config-file-path=/etc <span style="color: #8b2252;">\</span>
--with-config-file-scan-dir=/etc/php.d <span style="color: #8b2252;">\</span>
--enable-mbstring <span style="color: #8b2252;">\</span>
--enable-xml <span style="color: #8b2252;">\</span>
--enable-sockets <span style="color: #8b2252;">\</span>
--enable-fpm <span style="color: #8b2252;">\</span>
--enable-maintainer-zts <span style="color: #8b2252;">\</span>
--disable-fileinfo

make -j 4 &amp;&amp; make install
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;PATH&#21464;&#37327;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">php7.4
</span>vim /etc/profile.d/lamp.sh
<span style="color: #a0522d;">PATH</span>=/apps/php74/bin:/apps/httpd24/bin:$<span style="color: #a0522d;">PATH</span>
. /etc/profile.d/lamp.sh

<span style="color: #b22222;">#</span><span style="color: #b22222;">php7.3
</span>vim /etc/profile.d/lamp.sh
<span style="color: #a0522d;">PATH</span>=/apps/php73/bin:/apps/httpd24/bin:$<span style="color: #a0522d;">PATH</span>
. /etc/profile.d/lamp.sh

[root@Centos7 ~]#php --version
PHP 7.4.7 (cli) (built: Jul  2 2020 09:10:59) ( ZTS )
<span style="color: #0000ff;">Copyright</span> (c) The PHP Group
Zend Engine v3.4.0, Copyright (c) Zend Technologies

[root@websrv ~]#/apps/php73/bin/php --version
PHP 7.3.12 (cli) (built: Dec 14 2019 10:20:40) ( ZTS )
<span style="color: #0000ff;">Copyright</span> (c) 1997-2018 The PHP Group
Zend Engine v3.3.12, Copyright (c) 1998-2018 Zend Technologies

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;php&#37197;&#32622;&#25991;&#20214;&#21644;&#21551;&#21160;&#25991;&#20214;
</span>cp php.ini-production /etc/php.ini
cp sapi/fpm/php-fpm.service /usr/lib/systemd/system/   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27169;&#26495;&#25991;&#20214;&#25335;&#36125;
</span><span style="color: #483d8b;">cd</span> /apps/php74/etc
cp php-fpm.conf.default php-fpm.conf
<span style="color: #483d8b;">cd</span> php-fpm.d/
cp www.conf.default www.conf

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#36827;&#31243;&#25152;&#26377;&#32773;
</span>vim /apps/php74/etc/php-fpm.d/www.conf
user apache
group apache
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25903;&#25345;status&#21644;ping&#39029;&#38754;&#65288;&#38656;&#35201;&#35774;&#32622;&#23433;&#20840;&#31574;&#30053;&#65292;&#19981;&#33021;&#35753;&#20219;&#20309;&#20154;&#37117;&#35775;&#38382;&#65289;
</span>pm.status_path = /fpm_status
ping.path = /ping

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25903;&#25345;opcache&#21152;&#36895;
</span>mkdir /etc/php.d/
vim /etc/php.d/opcache.ini
[opcache]
<span style="color: #a0522d;">zend_extension</span>=opcache.so
opcache.enable=1

systemctl daemon-reload
systemctl status php-fpm.service
systemctl enable --now php-fpm.service
</pre>
</div>

<p>
<b>7.2.3.4 修改配置httpd 支持php-fpm</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">vim /apps/httpd24/conf/httpd.conf
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21462;&#28040;&#19979;&#38754;&#20004;&#34892;&#30340;&#27880;&#37322;&#65288;apache&#30456;&#24403;&#20110;&#21453;&#21521;&#20195;&#29702;&#65289;
</span>LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#19979;&#38754;&#34892;
</span>&lt;IfModule dir_module&gt;
DirectoryIndex index.php index.html
&lt;/IfModule&gt;
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21152;&#19979;&#38754;&#19977;&#34892;
</span>AddType application/x-httpd-php .php
<span style="color: #b22222;">#</span><span style="color: #b22222;">AddType application/x-httpd-php-source .phps
</span>ProxyRequests Off

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23454;&#29616;&#31532;&#19968;&#20010;&#34394;&#25311;&#20027;&#26426;
</span>&lt;virtualhost *:80&gt;
servername blog.cici.org
documentroot /data/wordpress
&lt;directory /data/wordpress&gt;
require all granted
&lt;/directory&gt;
ProxyPassMatch ^/(.*<span style="color: #8b2252;">\.</span>php)$ fcgi://127.0.0.1:9000/data/wordpress/$<span style="color: #a0522d;">1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23454;&#29616;status&#21644;ping&#39029;&#38754;
</span>ProxyPassMatch ^/(fpm_status|ping)$ fcgi://127.0.0.1:9000/$<span style="color: #a0522d;">1</span>
CustomLog <span style="color: #8b2252;">"logs/access_wordpress_log"</span> common
&lt;/virtualhost&gt;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31532;&#20108;&#20010;&#34394;&#25311;&#20027;&#26426;
</span>&lt;virtualhost *:80&gt;
servername forum.cici.org
documentroot /data/discuz
&lt;directory /data/discuz/&gt;
require all granted
&lt;/directory&gt;
ProxyPassMatch ^/(.*<span style="color: #8b2252;">\.</span>php)$ fcgi://127.0.0.1:9000/data/discuz/$<span style="color: #a0522d;">1</span>
CustomLog <span style="color: #8b2252;">"logs/access_discuz_log"</span> common
&lt;/virtualhost&gt;

apachectl restart
</pre>
</div>

<p>
<b>7.2.3.5 准备wordpress和discuz! 相关文件</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;wordpress&#31243;&#24207;&#25991;&#20214;
</span>mkdir /data/
tar xvf wordpress-5.4.2-zh_CN.tar.gz
mv wordpress/ /data
setfacl &#8211;R &#8211;m u:apache:rwx /data/wordpress/
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25110;&#32773;chown &#8211;R apache.apache /data/wordpress
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;discuz!&#31243;&#24207;&#25991;&#20214;
</span>unzip Discuz_X3.4_SC_UTF8&#12304;20191201&#12305;.zip
mv DiscuzX/upload/ /data/discuz
setfacl -R -m u:apache:rwx /data/discuz/
</pre>
</div>

<p>
<b>7.2.3.5 测试访问</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">vim /etc/hosts
10.0.0.7 blog.cici.org forum.cici.org
</pre>
</div>

<p>
打开浏览器访问 <a href="http://wordpress.cici.net">http://wordpress.cici.net</a> 和<a href="http://discuz.cici.net">http://discuz.cici.net</a>
分别进行初始化和安装
</p>

<p>
<b>7.2.3.6 修改成UDS模式</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">vim /apps/php/etc/php-fpm.d/www.conf
;<span style="color: #a0522d;">listen</span> = 127.0.0.1:9000
<span style="color: #a0522d;">listen</span> = /run/php-fpm.sock
listen.owner = apache
listen.group = apache
listen.mode = 0660

systemctl restart php-fpm

ll /run/php-fpm.sock
srw-rw---- 1 apache apache 0 Dec 14 11:11 /run/php-fpm.sock

vim /apps/httpd24/conf/httpd.conf
&lt;virtualhost *:80&gt;
servername blog.cici.org
documentroot /data/wordpress
&lt;directory /data/wordpress&gt;
require all granted
&lt;/directory&gt;
<span style="color: #b22222;">#</span><span style="color: #b22222;">ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9000/data/wordpress/$1
</span>ProxyPassMatch ^/(.*<span style="color: #8b2252;">\.</span>php)$ <span style="color: #8b2252;">"unix:/run/php-fpm.sock|fcgi://localhost/data/wordpress/"</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">ProxyPassMatch ^/(status|ping)$ fcgi://127.0.0.1:9000/$1
</span>ProxyPassMatch ^/(status|ping)$ <span style="color: #8b2252;">"unix:/run/php-fpm.sock|fcgi://localhost/"</span>
CustomLog <span style="color: #8b2252;">"logs/access_wordpress_log"</span> common
&lt;/virtualhost&gt;

&lt;virtualhost *:80&gt;
servername forum.cici.org
documentroot /data/wordpress
&lt;directory /data/wordpress&gt;
require all granted
&lt;/directory&gt;
<span style="color: #b22222;">#</span><span style="color: #b22222;">ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9000/data/discuz/$1
</span>ProxyPassMatch ^/(.*<span style="color: #8b2252;">\.</span>php)$ <span style="color: #8b2252;">"unix:/run/php-fpm.sock|fcgi://localhost/data/discuz/"</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">ProxyPassMatch ^/(status|ping)$ fcgi://127.0.0.1:9000/$1
</span>ProxyPassMatch ^/(status|ping)$ <span style="color: #8b2252;">"unix:/run/php-fpm.sock|fcgi://localhost/"</span>
CustomLog <span style="color: #8b2252;">"logs/access_discuz_log"</span> common
&lt;/virtualhost&gt;

systemctl restart httpd
</pre>
</div>
</div>
</div>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>打赏</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>© 2025 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
<!--
<script type="text/javascript" src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/bootstrap@5.2.1/dist/js/bootstrap.min.js"></script>
<div id="back-to-top" class=""><svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg></div>
-->
</div>
</body>
</html>
