<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linux: 自动化-系统部署pxe-cobbler</title>
<meta name="generator" content="Org Mode" />
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<!-- from -->
<!--
<style>#back-to-top{background:#000;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;bottom:20px;-webkit-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);-moz-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);box-shadow:0 2px 5px 0 rgba(0,0,0,.26);color:#fff;cursor:pointer;display:block;height:56px;opacity:1;outline:0;position:fixed;right:20px;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-transition:bottom .2s,opacity .2s;-o-transition:bottom .2s,opacity .2s;-moz-transition:bottom .2s,opacity .2s;transition:bottom .2s,opacity .2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:56px;z-index:1}#back-to-top svg{display:block;fill:currentColor;height:24px;margin:16px auto 0;width:24px}#back-to-top.hidden{bottom:-56px;opacity:0}</style>
-->
<link rel="stylesheet" href="/static/aandds.com/css/main.css">
<link rel="stylesheet" href="/static/aandds.com/css/drollery.min.css">
<script type="text/javascript" src="/static/aandds.com/js/main.js"></script>
<!--
<script id="MathJax-script" async="" src="/static/aandds.com/js/mathjax.js"></script>

<script type="text/javascript" src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
-->
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Linux: 自动化-系统部署pxe-cobbler</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:fb688712-b338-4bad-8496-93e6d79d36bb">运维自动化-01-系统部署</a>
<ul>
<li><a href="#h:47a9319f-321c-4f92-bc34-d1665e962662">1 系统安装过程</a>
<ul>
<li><a href="#h:2d85a143-ccab-4b6f-99a5-5692121d5c49">1.1 运维自动化发展历程及技术应用</a></li>
<li><a href="#h:fd1adb9b-f1a5-4b56-b9fe-4b181de65000">1.2 系统安装过程</a>
<ul>
<li><a href="#h:bc23699d-6df3-4531-a711-3ad172e737ff">1.2.1 Linux安装光盘的安装相关文件</a></li>
<li><a href="#h:e3c2bc64-c14e-4a2b-8706-e93744cff493">1.2.2 安装菜单的内核参数</a></li>
<li><a href="#h:397010b6-414b-496b-ae69-595954c3d8f5">1.2.3 anaconda安装向导</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:dba54f22-b52d-4912-a16d-df77f1318eef">2 自动安装的应答文件</a>
<ul>
<li><a href="#h:6dd94417-806d-4344-8a1b-5aa80d574fba">2.1 kickstart文件使用过程</a></li>
<li><a href="#h:59104365-2884-4af9-b212-478e5079bde9">2.2 kickstart文件的格式</a>
<ul>
<li><a href="#h:9ef3c4c0-b7b6-4c5e-9822-9e657dc93baa">2.2.1 Kickstart文件格式官方说明</a></li>
<li><a href="#h:4ddbfc66-5e4f-40b5-bebb-fb42eeecf5b2">2.2.2 kickstart文件格式说明</a></li>
</ul>
</li>
<li><a href="#h:bc46f333-7599-4f52-9f52-92ee022113ad">2.3 kickstart文件创建</a></li>
</ul>
</li>
<li><a href="#h:eed3d000-c9a2-4494-83f6-aa6fbb1815fb">3 制作引导光盘和U盘</a></li>
<li><a href="#h:8ef73af5-1c84-4683-9c32-e3f1dae2921e">4 实现DHCP服务</a>
<ul>
<li><a href="#h:a334ebfb-88d4-4942-9d8d-1f8e6d0ae094">4.1 DHCP工作原理</a></li>
<li><a href="#h:15c65f05-fc0c-46d8-bd0b-2b36b566b604">4.2 DHCP实现</a>
<ul>
<li><a href="#h:f4cf7a43-3ef0-4a3c-a81a-9d687bd1ce55">4.2.1 DHCP相关文件组成</a></li>
<li><a href="#h:a5525092-82fa-471c-8aef-7057960a7ba5">4.2.2 DHCP服务器配置文件</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:49fc7f5a-d072-4a10-a665-7d1b46582c1f">5 实现TFTP服务</a>
<ul>
<li><a href="#h:d2644526-aecb-4245-9f1b-3a3897c4c31d">5.1 TFTP介绍</a></li>
<li><a href="#h:f85805e1-4448-4813-98d2-663717d5e5fd">5.2 安装和使用TFTP</a></li>
</ul>
</li>
<li><a href="#h:5d0555ce-164e-4d27-84e5-d5df6c104c95">6 利用 PXE 实现自动化系统部署</a>
<ul>
<li><a href="#h:f2f79349-fb53-4ca0-ad6d-cfd3d411a98a">6.1 PXE介绍</a></li>
<li><a href="#h:e19967b1-627c-4835-a527-1f5a797d1b4d">6.2 利用PXE实现自动化安装流程</a></li>
<li><a href="#h:35e0793c-58b7-4cf4-ad0a-d5a0c574c3e7">6.3 在CentOS 6 上实现PXE自动化安装CentOS</a></li>
<li><a href="#h:d14d2da4-a17b-4edd-bcef-e141bc39f7ae">6.4 在CentOS7 上实现PXE自动化安装CentOS</a></li>
<li><a href="#h:7c4af5a1-3add-442c-b338-9435272266df">6.5 在 CentOS 8 上实现PXE自动化安装 CentOS 6,7,8</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:9bd0e18c-49a8-42c6-905e-7ddf60e9fc74">利用cobbler实现自动化安装</a>
<ul>
<li><a href="#h:846ee33b-1663-48cd-8282-339cffc02394">1 Cobbler简介</a></li>
<li><a href="#h:2224e0bc-3fed-4a1b-a528-2b6c463b77c9">2 Cobbler的相关服务</a></li>
<li><a href="#h:c910981f-0ea3-49eb-935d-d89655a9130d">3 Cobbler的工作原理</a></li>
<li><a href="#h:67c359c0-d6aa-4df6-b455-276cf1384384">4 安装Cobbler及其相关的服务和组件</a></li>
<li><a href="#h:3e22b740-f396-4710-bef5-463b0a175a33">5 Cobbler配置文件及各目录情况</a>
<ul>
<li><a href="#h:f1c290da-6013-4cd2-99f5-2a3ce8826311">5.1 配置文件</a></li>
<li><a href="#h:2241da51-0e27-4fac-8dcb-357b4053aaa4">5.2 数据目录</a></li>
<li><a href="#h:7f012b20-4f09-4620-8f52-567760f824f0">5.3 镜像目录</a></li>
<li><a href="#h:cc8dcbdb-3b69-45f9-8b5c-6d6bcd51b895">5.4 日志目录</a></li>
</ul>
</li>
<li><a href="#h:9a797a3f-944d-4806-9899-ea5943093313">6 配置及启动cobblerd服务</a></li>
<li><a href="#h:e5800cf0-86ad-48c0-99cd-38fe6177a9ef">7 cobbler命令用法</a></li>
<li><a href="#h:413ba53d-f098-4f57-bc3c-fca5dd01251e">8 将linux发行版导入到cobbler在httpd服务的文件夹下</a></li>
<li><a href="#h:1c59a9b5-5531-4013-87a6-09285faa2b44">9 配置linux发行版和关联相应的ks文件</a></li>
<li><a href="#h:0abb53cc-5e08-4708-816d-57f3279d0fe7">10 启动菜单优化</a></li>
<li><a href="#h:49f6ab7b-7fc5-4168-9223-b31900303ee7">11 基于web界面来管理配置cobbler</a>
<ul>
<li><a href="#h:a1b4da20-e469-48cb-bdd4-38bf3771e981">11.1 安装cobbler-web</a></li>
<li><a href="#h:85975a46-85e3-4f01-b7e4-57c1bcbe3507">11.2 访问web界面</a></li>
<li><a href="#h:42523b01-08ea-45d4-82de-3c373a9b8a02">11.3 WEB的登录认证方式</a></li>
</ul>
</li>
<li><a href="#h:2b24fa7f-4f89-4c73-9902-45b43ebd69c0">12 Trouble Shooting</a>
<ul>
<li><a href="#h:241e2c1d-6ae2-485d-9a77-d44e868097ef">12.1 故障1</a></li>
<li><a href="#h:26742ff5-5406-4f7b-8225-84014a73649d">12.2 故障2</a></li>
<li><a href="#h:0a8f2722-277a-4e21-b12c-369805f89287">12.3 故障3</a></li>
</ul>
</li>
<li><a href="#h:6f9c7473-9754-4873-83f5-5e0eb0513b83">13 实战案例：CentOS 7 基于cobbler实现系统的自动化安装</a>
<ul>
<li><a href="#h:bde958da-d25a-47a2-9286-e1ee278a72af">13.1 环境准备</a></li>
<li><a href="#h:d709cba2-c95f-48fa-8573-5a2c42d21e9a">13.2 安装相关包并启动服务</a></li>
<li><a href="#h:12d669b7-19e8-4280-a13e-2878e80fbe98">13.3 修改cobbler相关的配置</a></li>
<li><a href="#h:d0a8b869-d191-4d90-af58-49e534e868eb">13.4 实现dhcp服务</a></li>
<li><a href="#h:74b1cba7-cc2c-4fbf-84a1-6a3354ee0569">13.5 下载启动的相关文件</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:8dd009d5-7057-45e1-94e2-9e78c0ec2c3e">TASK COMPLETE <b>*</b></a></li>
<li><a href="#h:60fc76b4-72de-46c8-b5e0-62c2b22ee00e">TASK COMPLETE <b>*</b></a>
<ul>
<li>
<ul>
<li><a href="#h:2abea07d-83b9-4a42-b169-b81e47fbad22">13.6 修改菜单的标题信息(可选)</a></li>
<li><a href="#h:fffac2d3-bf31-470b-956b-a8077015674d">13.7 导入CentOS系统的安装文件，生成相应的YUM源</a></li>
<li><a href="#h:f0d14607-c88b-4919-a349-bd97dd133034">13.8 准备 kickstart文件,并关联至指定的YUM源</a></li>
<li><a href="#h:6ed8a4c5-215c-4124-91aa-bb410a52b649">13.9 测试客户端基于Cobbler实现自动安装</a></li>
<li><a href="#h:3fcc8058-99d5-4a37-b704-1c17c20c7590">13.10 支持UEFI安装</a></li>
<li><a href="#h:40e18527-a8a2-4f9d-886f-8e79a63e4207">13.11 实现cobbler 的web管理</a></li>
<li><a href="#h:20309237-041c-469d-a5b5-9180e165ee1c">13.12 创建cobbler的自定义的web用户</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../../index.html">Linux</a></li>
</ul>
<section id="outline-container-h:fb688712-b338-4bad-8496-93e6d79d36bb" class="outline-2">
<h2 id="h:fb688712-b338-4bad-8496-93e6d79d36bb">运维自动化-01-系统部署</h2>
<div class="outline-text-2" id="text-h:fb688712-b338-4bad-8496-93e6d79d36bb">
<p>
内容概述
</p>

<ul class="org-ul">
<li>系统安装过程和配置anaconda</li>
<li>制作自动化安装系统的应答文件</li>
<li>制作引导光盘</li>
<li>DHCP服务</li>
<li>TFTP服务</li>
<li>利用PXE实现自动化的系统部署</li>
<li>利用cobbler实现自动化的系统部署</li>
</ul>
</div>
<div id="outline-container-h:47a9319f-321c-4f92-bc34-d1665e962662" class="outline-3">
<h3 id="h:47a9319f-321c-4f92-bc34-d1665e962662">1 系统安装过程</h3>
<div class="outline-text-3" id="text-h:47a9319f-321c-4f92-bc34-d1665e962662">
</div>
<div id="outline-container-h:2d85a143-ccab-4b6f-99a5-5692121d5c49" class="outline-4">
<h4 id="h:2d85a143-ccab-4b6f-99a5-5692121d5c49">1.1 运维自动化发展历程及技术应用</h4>
<div class="outline-text-4" id="text-h:2d85a143-ccab-4b6f-99a5-5692121d5c49">

<figure id="org5ea761b">
<img src="images/image-20210122110934695.png" alt="image-20210122110934695.png">

</figure>
</div>
</div>
<div id="outline-container-h:fd1adb9b-f1a5-4b56-b9fe-4b181de65000" class="outline-4">
<h4 id="h:fd1adb9b-f1a5-4b56-b9fe-4b181de65000">1.2 系统安装过程</h4>
<div class="outline-text-4" id="text-h:fd1adb9b-f1a5-4b56-b9fe-4b181de65000">
<p>
Linux的安装过程如下：
</p>

<ul class="org-ul">
<li>加载boot loader</li>
<li>加载启动安装菜单</li>
<li>加载内核和initrd文件</li>
<li>加载根系统</li>
<li>运行anaconda的安装向导</li>
</ul>
</div>
<div id="outline-container-h:bc23699d-6df3-4531-a711-3ad172e737ff" class="outline-5">
<h5 id="h:bc23699d-6df3-4531-a711-3ad172e737ff">1.2.1 Linux安装光盘的安装相关文件</h5>
<div class="outline-text-5" id="text-h:bc23699d-6df3-4531-a711-3ad172e737ff">
<p>
在系统光盘的isolinux目录下有和安装相关的文件
</p>

<ul class="org-ul">
<li>boot.cat: 相当于grub的第一阶段</li>
<li>isolinux.bin：光盘引导程序，在mkisofs的选项中需要明确给出文件路径，这个文件属于SYSLINUX项目</li>
<li>isolinux.cfg：启动菜单的配置文件，当光盘启动后（即运行isolinux.bin），会自动去找isolinux.cfg文件</li>
<li>vesamenu.c32：是光盘启动后的启动菜单图形界面，也属于SYSLINUX项目，menu.c32提供纯文本的菜单</li>
<li>memtest：内存检测程序</li>
<li>splash.png：光盘启动菜单界面的背景图</li>
<li>vmlinuz：是内核映像</li>
<li>initrd.img：ramfs文件</li>
</ul>
</div>
</div>
<div id="outline-container-h:e3c2bc64-c14e-4a2b-8706-e93744cff493" class="outline-5">
<h5 id="h:e3c2bc64-c14e-4a2b-8706-e93744cff493">1.2.2 安装菜单的内核参数</h5>
<div class="outline-text-5" id="text-h:e3c2bc64-c14e-4a2b-8706-e93744cff493">
<p>
安装光盘的启动菜单配置文件：isolinux/isolinux.cfg中设置相关的内核加载参数，实现不同的安装过程
</p>

<p>
<b>isolinux.cfg文件中每个安装对应菜单选项</b> ：
</p>
<ul class="org-ul">
<li>加载内核：isolinuz/vmlinuz</li>
<li>向内核传递参数：append initrd=initrd.img 参数设置</li>
</ul>

<p>
<b>指定内核参数方法</b>
</p>

<ul class="org-ul">
<li>在启动菜单界面，选中一项安装方法，按tab键,在后面增加参数</li>
<li>在启动菜单界面，任意选中一项安装方法，按ESC键：boot: linux 参数设置</li>
</ul>

<p>
<b>常见的内核参数</b> ：
</p>

<ul class="org-ul">
<li>text：默认启动GUI安装接口，可以指定文本方式的安装界面</li>
<li>rescue：进入救援模式</li>
<li>inst.repo=path：指定安装源文件的路径，可以是以下格式
<ul class="org-ul">
<li><p>
Centos 6
</p>

<p>
DVD drive <code>repo=cdrom :device</code>
</p>

<p>
Hard Drive <code>repo=hd:device/path</code>
</p>

<p>
HTTP Server <code>repo=http://host/path</code>
</p>

<p>
HTTPS Server <code>repo=https://host/path</code>
</p>

<p>
FTP Server <code>repo=ftp://username:password@host/path</code>
</p>

<p>
NFS Server <code>repo=nfs:server:/path</code>
</p>

<p>
ISO images on an NFS Server <code>repo=nfsiso:server:/path</code>
</p></li>

<li><p>
Centos 7
</p>

<p>
Any CD/DVD drive <code>inst.repo=cdrom</code>
</p>

<p>
Hard Drive <code>inst.repo=hd:device:/path</code>
</p>

<p>
HTTP Server <code>inst.repo=http://host/path</code>
</p>

<p>
HTTPS Server <code>inst.repo=https://host/path</code>
</p>

<p>
FTP Server <code>inst.repo=ftp://username:password@host/path</code>
</p>

<p>
NFS Server <code>inst.repo=nfs:[options:]server:/path</code>
</p></li>
</ul></li>

<li>askmethod：选择安装源文件的获取方法，提供了光盘，本地硬盘，NFS，FTP，HTTP多种安装源，此项Centos
7 以后版已废弃</li>
<li>ks=path:
指定自动化安装应答文件路径，如：initrd=initrd.img inst.ks=<a href="http://192.168.8.8/ksdir/ks8.cfg">http://192.168.8.8/ksdir/ks8.cfg</a></li>

<li><p>
ip= : 指定IP地址信息
</p>

<p>
ip=method，method 可以为dhcp
</p>

<p>
ip=interface:method 指定特定接口
</p>

<p>
ip=ip::gateway:netmask:hostname:interface:none 静态IP
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:397010b6-414b-496b-ae69-595954c3d8f5" class="outline-5">
<h5 id="h:397010b6-414b-496b-ae69-595954c3d8f5">1.2.3 anaconda安装向导</h5>
<div class="outline-text-5" id="text-h:397010b6-414b-496b-ae69-595954c3d8f5">
<p>
anaconda是Linux系统安装程序,可以提供两种风格的安装界面
</p>
<ul class="org-ul">
<li>gui：图形窗口</li>
<li>tui: 基于图形库curses的文本窗口</li>
</ul>

<p>
<b>anaconda工作过程</b>
</p>

<ul class="org-ul">
<li>安装过程使用的语言</li>
<li>键盘类型</li>
<li>时区和时间</li>
<li>安装源文件路径</li>
<li>选定要安装的程序包</li>
<li>安装目标存储设备及分区设置
<ul class="org-ul">
<li><p>
Basic Storage：本地磁盘
</p>

<p>
特殊设备：iSCSI
</p></li>
</ul></li>
<li>KDUMP功能</li>
<li>设定主机名和配置网络接口</li>
<li>安全策略</li>
<li>管理员密码</li>
<li>创建一个普通用户</li>
</ul>

<p>
<b>anaconda的配置方式</b> ：
</p>

<ul class="org-ul">
<li>交互式配置方式</li>
<li><p>
通过读取事先给定的配置文件自动完成配置，加内核参数：ks=/path实现指明kickstart文件的位置，各种路径格式如下：
</p>

<p>
DVD drive: <code>ks=cdrom:/PATH/TO/KICKSTART_FILE</code>
</p>

<p>
Hard drive: <code>ks=hd:device:/directory/KICKSTART_FILE</code>
</p>

<p>
HTTP server: <code>ks=http://host:port/path/to/KICKSTART_FILE</code>
</p>

<p>
FTP server: <code>ks=ftp://host:port/path/to/KICKSTART_FILE</code>
</p>

<p>
HTTPS server: <code>ks=https://host:port/path/to/KICKSTART_FILE</code>
</p>

<p>
NFS <code>server:ks=nfs:host:/path/to/KICKSTART_FILE</code>
</p></li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-h:dba54f22-b52d-4912-a16d-df77f1318eef" class="outline-3">
<h3 id="h:dba54f22-b52d-4912-a16d-df77f1318eef">2 自动安装的应答文件</h3>
<div class="outline-text-3" id="text-h:dba54f22-b52d-4912-a16d-df77f1318eef">
<p>
实现自动安装前，需要制作对应的安装应答文件，称为kickstart文件，用于保存安装过程需要指定的选项。
</p>
</div>
<div id="outline-container-h:6dd94417-806d-4344-8a1b-5aa80d574fba" class="outline-4">
<h4 id="h:6dd94417-806d-4344-8a1b-5aa80d574fba">2.1 kickstart文件使用过程</h4>
<div class="outline-text-4" id="text-h:6dd94417-806d-4344-8a1b-5aa80d574fba">
<ol class="org-ol">
<li>Create a Kickstart file.</li>
<li>Make the Kickstart file available on removable media, a hard drive or
a network location.</li>
<li>Create boot media, which will be used to begin the installation.</li>
<li>Make the installation source available.</li>
<li>Start the Kickstart installation.</li>
</ol>
</div>
</div>
<div id="outline-container-h:59104365-2884-4af9-b212-478e5079bde9" class="outline-4">
<h4 id="h:59104365-2884-4af9-b212-478e5079bde9">2.2 kickstart文件的格式</h4>
<div class="outline-text-4" id="text-h:59104365-2884-4af9-b212-478e5079bde9">
</div>
<div id="outline-container-h:9ef3c4c0-b7b6-4c5e-9822-9e657dc93baa" class="outline-5">
<h5 id="h:9ef3c4c0-b7b6-4c5e-9822-9e657dc93baa">2.2.1 Kickstart文件格式官方说明</h5>
<div class="outline-text-5" id="text-h:9ef3c4c0-b7b6-4c5e-9822-9e657dc93baa">
<p>
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_an_advanced_rhel_installation/index">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_an_advanced_rhel_installation/index</a>
</p>

<p>
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/installation_guide/sect-kickstart-syntax">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/installation_guide/sect-kickstart-syntax</a>
</p>

<p>
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/installation_guide/s1-kickstart2-options">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/installation_guide/s1-kickstart2-options</a>
</p>
</div>
</div>
<div id="outline-container-h:4ddbfc66-5e4f-40b5-bebb-fb42eeecf5b2" class="outline-5">
<h5 id="h:4ddbfc66-5e4f-40b5-bebb-fb42eeecf5b2">2.2.2 kickstart文件格式说明</h5>
<div class="outline-text-5" id="text-h:4ddbfc66-5e4f-40b5-bebb-fb42eeecf5b2">
<p>
kickstart文件主要包括三个部分：命令段，程序包段，脚本段
</p>

<ul class="org-ul">
<li>命令段：指明各种安装前配置，如键盘类型等</li>
</ul>

<p>
命令段中的常见命令：
</p>

<div class="org-src-container">
<pre class="src src-sh">keyboard: &#35774;&#23450;&#38190;&#30424;&#31867;&#22411;
lang: &#35821;&#35328;&#31867;&#22411;
zerombr&#65306;&#28165;&#38500;mbr
clearpart&#65306;&#28165;&#38500;&#20998;&#21306;
part: &#21019;&#24314;&#20998;&#21306;
rootpw: &#25351;&#26126;root&#30340;&#23494;&#30721;
timezone: &#26102;&#21306;
text: &#25991;&#26412;&#23433;&#35013;&#30028;&#38754;
network:&#25351;&#23450;&#32593;&#32476;&#35774;&#32622;
firewall&#65306;&#35774;&#32622;&#38450;&#28779;&#22681;&#35774;&#32622;
selinux&#65306;&#35774;&#32622;selinux&#35774;&#32622;
reboot&#65306;&#23433;&#35013;&#23436;&#33258;&#21160;&#37325;&#21551;
user&#65306;&#23433;&#35013;&#23436;&#25104;&#21518;&#20026;&#31995;&#32479;&#21019;&#24314;&#26032;&#29992;&#25143;
url: &#25351;&#26126;&#23433;&#35013;&#28304;
</pre>
</div>

<ul class="org-ul">
<li>程序包段：指明要安装的程序包组或程序包，不安装的程序包等</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">%packages
@^environment group&#65306; &#25351;&#23450;&#29615;&#22659;&#21253;&#32452;&#65292;&#22914;&#65306;@^minimal-environment
@group_name
package
-package
%end
</pre>
</div>

<ul class="org-ul">
<li>脚本段：</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">%pre: &#23433;&#35013;&#21069;&#33050;&#26412;
%post: &#23433;&#35013;&#21518;&#33050;&#26412;
</pre>
</div>

<p>
注意：
</p>

<ul class="org-ul">
<li>CentOS 8,7,6 不同版本的kickstart文件格式不尽相同，不可混用</li>
<li>%addon, %packages, %onerror, %pre 、 %post
必须以%end结束，否则安装失败</li>
</ul>

<p>
范例：CentOS 8 的最小化安装kickstart文件
</p>

<div class="org-src-container">
<pre class="src src-sh">ignoredisk --only-use=sda
zerombr
text
reboot
clearpart --all --initlabel
selinux --disabled
firewall --disabled
url --url=http://10.0.0.8/centos/8/os/x86_64/
keyboard --vckeymap=us --xlayouts=<span style="color: #8b2252;">'us'</span>
lang en_US.UTF-8
network --bootproto=dhcp --device=ens160 --ipv6=auto --activate
network --hostname=centos8.me.com
rootpw --iscrypted
$<span style="color: #a0522d;">6</span>$<span style="color: #a0522d;">j9YhzDUnQVnxaAk8</span>$<span style="color: #a0522d;">qv7rkMcPAEbV5yvwsP666DXWYadd3jYjkA9fpxAo9qYotjGGBUclCGoP1TRvgHBpqgc5n0RypMsPTQnVDcpO01</span>
firstboot --enable
skipx
services --disabled=<span style="color: #8b2252;">"chronyd"</span>
timezone Asia/Shanghai --isUtc --nontp
user --name=wang --
<span style="color: #a0522d;">password</span>=6oUfb/02CWfLb5l8f$<span style="color: #a0522d;">sgEZeR7c7DpqfpmFDH6huSmDbW1XQNR4qKl2EPns</span>.gOXqlnAIgv9p
TogtFVaDtEpMOC.SWXKYqxfVtd9MCwxb1 --iscrypted --gecos=<span style="color: #8b2252;">"wang"</span>
part / --fstype=<span style="color: #8b2252;">"xfs"</span> --ondisk=sda --size=102400
part /data --fstype=<span style="color: #8b2252;">"xfs"</span> --ondisk=sda --size=51200
part swap --fstype=<span style="color: #8b2252;">"swap"</span> --ondisk=sda --size=2048
part /boot --fstype=<span style="color: #8b2252;">"ext4"</span> --ondisk=sda --size=1024
%packages
@^minimal-environment
kexec-tools
%end
%addon com_redhat_kdump --enable --reserve-mb=<span style="color: #8b2252;">'auto'</span>
%end
%anaconda
pwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty
pwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok
pwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty
%end

%post
useradd tester
<span style="color: #483d8b;">echo</span> me | passwd --stdin tester &amp;&gt; /dev/null
%end
</pre>
</div>

<p>
范例：CentOS 7 的最小化安装kickstart文件
</p>

<div class="org-src-container">
<pre class="src src-sh">install
xconfig --startxonboot
keyboard --vckeymap=us --xlayouts=<span style="color: #8b2252;">'us'</span>
rootpw --iscrypted $<span style="color: #a0522d;">1</span>$<span style="color: #a0522d;">bpNEv8S5</span>$<span style="color: #a0522d;">lK</span>.CjNkf.YCpFPHskSNiN0
url --url=<span style="color: #8b2252;">"http://10.0.0.8/centos/7/os/x86_64"</span>
lang en_US
auth --useshadow --passalgo=sha512
text
firstboot --enable
selinux --disabled
skipx
services --disabled=<span style="color: #8b2252;">"chronyd"</span>
ignoredisk --only-use=sda
firewall --disabled
network --bootproto=dhcp --device=ens33
reboot
timezone Asia/Shanghai --nontp
bootloader --append=<span style="color: #8b2252;">"crashkernel=auto"</span> --location=mbr --boot-drive=sda
zerombr
clearpart --all --initlabel
part swap --fstype=<span style="color: #8b2252;">"swap"</span> --ondisk=sda --size=3072
part / --fstype=<span style="color: #8b2252;">"xfs"</span> --ondisk=sda --size=51200
part /boot --fstype=<span style="color: #8b2252;">"xfs"</span> --ondisk=sda --size=1024
part /data --fstype=<span style="color: #8b2252;">"xfs"</span> --ondisk=sda --size=30720
%post
useradd wang
%end

%packages
@^minimal
vim-enhanced
%end
</pre>
</div>

<p>
范例：CentOS 6 的最小化安装kickstart文件
</p>

<div class="org-src-container">
<pre class="src src-sh">install
text
reboot
url --url=http://10.0.0.8/centos/6/os/x86_64/
lang en_US.UTF-8
keyboard us
network --onboot yes --device eth0 --bootproto dhcp --noipv6
rootpw --iscrypted
$<span style="color: #a0522d;">6</span>$<span style="color: #a0522d;">b6C5mM</span>/BwOMBoK8H$<span style="color: #a0522d;">cYZFrHoNlOL0iDsxOTRhwnWJ3yfFmf7mRJBOxEqGoI56UMrT8J7qlrGwX7tSnOf7wKxYR2hAvAREILDgOgsFe1</span>
firewall --disabled
authconfig --enableshadow --passalgo=sha512
selinux --disabled
timezone Asia/Shanghai
bootloader --location=mbr --driveorder=sda --append=<span style="color: #8b2252;">"crashkernel=auto rhgb</span>
<span style="color: #8b2252;">quiet"</span>
zerombr
clearpart --all --initlabel
part /boot --fstype=ext4 --size=1024
part / --fstype=ext4 --size=50000
part /data --fstype=ext4 --size=30000
part swap --size=2048

%packages
@core
@server-policy
@workstation-policy
autofs
vim-enhanced
%end

%post
useradd wang
<span style="color: #483d8b;">echo</span> me | passwd --stdin wang &amp;&gt; /dev/null
mkdir /etc/yum.repos.d/bak
mv /etc/yum.repos.d/* /etc/yum.repos.d/bak
cat &gt; /etc/yum.repos.d/base.repo &lt;&lt;EOF
<span style="color: #ffa54f;">[base]</span>
<span style="color: #ffa54f;">name=base</span>
<span style="color: #ffa54f;">baseurl=file:///misc/cd</span>
<span style="color: #ffa54f;">gpgcheck=0</span>
<span style="color: #ffa54f;">EOF</span>
%end
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:bc46f333-7599-4f52-9f52-92ee022113ad" class="outline-4">
<h4 id="h:bc46f333-7599-4f52-9f52-92ee022113ad">2.3 kickstart文件创建</h4>
<div class="outline-text-4" id="text-h:bc46f333-7599-4f52-9f52-92ee022113ad">
<p>
<b>创建kickstart文件的方式</b>
</p>

<ul class="org-ul">
<li>可使用创建工具：system-config-kickstart ，注意：此方法 CentOS 8
不再支持</li>
<li>依据某模板修改并生成新配置，CentOS安装完后，会自动参考当前系统的安装过程，生成一个kickstart文件
/root/anaconda-ks.cfg</li>
</ul>

<p>
<b>检查ks文件的语法错误：</b>
</p>

<p>
使用 ksvalidator 工具可以检查kickstart的文件格式是否有语法错误，来自于
pykickstart 包
</p>

<p>
格式：
</p>

<div class="org-src-container">
<pre class="src src-sh">ksvalidator /PATH/TO/KICKSTART_FILE
</pre>
</div>

<p>
范例：使用 system-config-kickstart 一边来看看生成的 kickstart
配置文件，我们一页一页观察
</p>

<p>
1.Basic Configuration
</p>


<figure id="org6c8830e">
<img src="images/image-20210122142459011.png" alt="image-20210122142459011.png">

</figure>

<p>
配置文件如下
</p>

<div class="org-src-container">
<pre class="src src-sh">&#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9474;#Basic Configuration
&#9474;========================================================
&#9474;#<span style="color: #a0522d;">platform</span>=x86, AMD64, or Intel EM64T
&#9474;#Default Language&#40664;&#35748;&#35821;&#35328;
&#9474;lang en_US
&#9474;# Keyboard &#38190;&#30424;
&#9474;keyboard <span style="color: #8b2252;">'us'</span>
&#9474;# timezone &#26102;&#21306;(&#21246;&#36873;&#20102;<span style="color: #8b2252;">"Use UTC clock"</span> &#20250;&#36861;&#21152;[--isUtc])
&#9474;timezone Asia/Shanghai
&#9474;# Root password
&#9474;rootpw --iscrypted $<span style="color: #a0522d;">1</span>$<span style="color: #a0522d;">DBk7xfJp</span>$<span style="color: #a0522d;">Agxd303XUAfRKIf7gB8DG</span>/
&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
&#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9474;#Advanced Configuration
&#9474;&#21246;&#36873;&#23601;&#26377;&#65292;&#19981;&#21246;&#27809;&#26377;
&#9474;========================================================
&#9474;# Reboot after installation
&#9474;reboot
&#9474;# Use text mode install
&#9474;text
&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
</pre>
</div>

<p>
2 Installation Method <img src="images/image-20210122142656193.png" alt="image-20210122142656193.png">
</p>

<p>
配置文件如下
</p>

<div class="org-src-container">
<pre class="src src-sh">&#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9474;#Installation Method
&#9474;========================================================
&#9474;# Install OS instead of upgrade
&#9474;install
&#9474;# Upgrade existing installation
&#9474;upgrade
&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
&#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9474;#Installation source
&#9474;&#36873;&#20102;&#21738;&#39033;&#23601;&#20889;&#21738;&#39033;
&#9474;========================================================
&#9474;# Use CDROM installation media
&#9474;cdrom
&#9474;# Use NFS installation media
&#9474;nfs --server=&#26381;&#21153;&#22120; --dir=&#30446;&#24405;
&#9474;# Use network installation
&#9474;url --url=<span style="color: #8b2252;">"ftp://&#29992;&#25143;&#21517;:&#23494;&#30721;@&#26381;&#21153;&#22120;/&#30446;&#24405;"</span>
&#9474;# Use network installation
&#9474;url --url=<span style="color: #8b2252;">"http://&#26381;&#21153;&#22120;/&#30446;&#24405;"</span>
&#9474;# Use hard drive installation media
&#9474;harddrive --dir=&#30446;&#24405; --partition=&#20998;&#21306;
&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
</pre>
</div>

<p>
3.Boot Loader Options
</p>


<figure id="org3f67fc7">
<img src="images/image-20210122142725025.png" alt="image-20210122142725025.png">

</figure>

<p>
配置文件如下
</p>

<div class="org-src-container">
<pre class="src src-sh">&#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9474;#Installation Method&amp;GRUB options&amp;Install Options
&#9474;=================================================================
&#9474; &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9474; &#9474; &#36873;&#25321;&#20102;Do not install a boot loader &#9474;
&#9474; &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
&#9474; <span style="color: #b22222;"># </span><span style="color: #b22222;">System bootloader configuration</span>
&#9474; bootloader --location=none
&#9474;
&#9474; &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9474; &#9474; &#36873;&#25321;&#20102;install new boot loader &#9474;
&#9474; &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
&#9474; bootloader --append=<span style="color: #8b2252;">"ker"</span> --location=mbr --password=<span style="color: #8b2252;">"123"</span>
&#9474;#append&#26159;&#20869;&#26680;&#21442;&#25968;&#65292;location&#26159;bootloader&#23433;&#35013;&#20301;&#32622;&#65292;password&#26159;GRUB&#23494;&#30721;
&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
</pre>
</div>

<p>
4.Partition Information
</p>


<figure id="orgfe11acb">
<img src="images/image-20210122142815101.png" alt="image-20210122142815101.png">

</figure>

<p>
配置文件如下
</p>

<div class="org-src-container">
<pre class="src src-sh">&#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9474;# Master Boot Record
&#9474;#Master Boot Record&#36873;&#25321;&#20102;clear... &#21542;&#21017;&#23601;&#27809;&#26377;
&#9474;======================================================
&#9474;# Clear the Master Boot Record
&#9474;zerombr
&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
&#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9474;# Partitions&amp;Disk Label
&#9474;======================================================
&#9474;# Partition clearing information
&#9474;clearpart --linux --initlabel
&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
&#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9474;# Layout &#20998;&#21306;
&#9474;part &#25346;&#36733;&#28857; --fstype=&#25991;&#20214;&#31995;&#32479; --size=&#22823;&#23567;(&#21333;&#20301;M)
&#9474;======================================================
&#9474;# Disk partitioning information
&#9474;part / --fstype=<span style="color: #8b2252;">"xfs"</span> --size=10240
&#9474;part /boot --fstype=<span style="color: #8b2252;">"ext4"</span> --size=1024
&#9474;part swap --fstype=<span style="color: #8b2252;">"swap"</span> --size=2048
&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
</pre>
</div>

<p>
5.Network Configuration
</p>


<figure id="org622958c">
<img src="images/image-20210122142833471.png" alt="image-20210122142833471.png">

</figure>

<p>
配置文件如下
</p>

<div class="org-src-container">
<pre class="src src-sh">&#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9474;# Network Configuration
&#9474;Centos7&#22914;&#26524;&#35201;&#20889;eth0,&#35201;&#21152;&#20869;&#26680;&#21442;&#25968;net.ifnames=0
&#9474;======================================================
&#9474;# Network information
&#9474;network --bootproto=dhcp --device=eth0
&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
</pre>
</div>

<p>
6.Authentication
</p>


<figure id="org70cf9c0">
<img src="images/image-20210122142849164.png" alt="image-20210122142849164.png">

</figure>

<p>
配置文件如下
</p>

<div class="org-src-container">
<pre class="src src-sh">&#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9474;# Authentication
&#9474;&#22914;&#26524;&#21246;&#36873;Enable Fingerprint reader&#21017;&#36861;&#21152;&#21442;&#25968; --enablefingerprint
&#9474;===============================================================
&#9474;# System authorization information
&#9474;auth --useshadow --passalgo=md5
&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
</pre>
</div>

<p>
7.Firewall Configuration
</p>


<figure id="org0348238">
<img src="images/image-20210122142906445.png" alt="image-20210122142906445.png">

</figure>

<p>
配置文件如下
</p>

<div class="org-src-container">
<pre class="src src-sh">&#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9474;# Firewall Configuration
&#9474;===============================================================
&#9474;# SELinux configuration
&#9474;selinux --disabled&#25110;permissive&#25110;enforcing
&#9474; &#9474;
<span style="color: #b22222;"># </span><span style="color: #b22222;">Firewall configuration</span>
&#9474;firewall --disabled&#25110;enabled
&#9474;#&#22914;&#26524;&#26159;enable,&#21487;&#20197;&#22312;&#36861;&#21152;&#65306;--http --ftp --telnet --smtp --ssh
&#9474;#&#36824;&#21487;&#20197;&#36861;&#21152;&#31471;&#21475;&#65306;--port=555:tcp,444:udp
&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
</pre>
</div>

<p>
8.Display Configuration
</p>


<figure id="org6abeddc">
<img src="images/image-20210122142922060.png" alt="image-20210122142922060.png">

</figure>

<p>
配置文件如下
</p>

<div class="org-src-container">
<pre class="src src-sh">&#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9474;# Display Configuration
&#9474;===============================================================
&#9474;&#22914;&#26524;&#36873;&#20102;&#23433;&#35013;&#22270;&#24418;&#30028;&#38754;&#65292;&#23601;&#27809;&#26377;&#19979;&#38754;&#36825;&#21477;&#35805;
&#9474;# Do not configure the X Window System
&#9474;skipx
&#9474;# Run the Setup Agent on first boot
&#9474;firstboot --enable&#25110;disable
&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
</pre>
</div>

<p>
9.Package Selection
</p>


<figure id="org61b2c73">
<img src="images/image-20210122142935508.png" alt="image-20210122142935508.png">

</figure>

<p>
如果你的界面是什么都没有，那么需要把你现使用的yum仓库配置文件改一下
</p>

<div class="org-src-container">
<pre class="src src-sh">[root]#vim /etc/yum.repos.d/***.repo
[development]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25226;&#21407;&#26469;"[]"&#20869;&#30340;&#20869;&#23481;&#25913;&#25104;development&#23601;&#21487;&#20197;&#20102;&#65292;&#20854;&#23427;&#19981;&#21464;</span>
</pre>
</div>

<p>
配置文件如下
</p>

<div class="org-src-container">
<pre class="src src-sh">%packages
@development
-byacc
-cscope
-ctags
-diffstat
-doxygen
-elfutils
-gcc-gfortran
-git
-indent
-intltool
-patchutils
-rcs
-subversion
-swig
-systemtap
%end
</pre>
</div>

<p>
10.Pre-Installation Script
</p>


<figure id="orga92f1af">
<img src="images/image-20210122142958430.png" alt="image-20210122142958430.png">

</figure>

<p>
配置文件如下
</p>

<div class="org-src-container">
<pre class="src src-sh">%pre
i am pre
%end
</pre>
</div>

<p>
11.Post-Installation Script
</p>


<figure id="orgadf53bf">
<img src="images/image-20210122143015649.png" alt="image-20210122143015649.png">

</figure>

<p>
配置文件如下
</p>

<div class="org-src-container">
<pre class="src src-sh">%post --nochroot
i am post
%end
</pre>
</div>

<p>
12.以上system-config-kickstart 执行后最终生成的kickstart文件如下
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">platform=x86, AMD64, or Intel EM64T</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">version=DEVEL</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Install OS instead of upgrade</span>
install
<span style="color: #b22222;"># </span><span style="color: #b22222;">Keyboard layouts</span>
keyboard <span style="color: #8b2252;">'us'</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Root password</span>
rootpw --iscrypted $<span style="color: #a0522d;">1</span>$<span style="color: #a0522d;">2</span>TeoFGRN$<span style="color: #a0522d;">EeykyMirEiMIya57QmbG71</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Use network installation</span>
url --url=<span style="color: #8b2252;">"http://192.168.100.7/Centos/7/os/x86_64"</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">System language</span>
lang zh_CN
<span style="color: #b22222;"># </span><span style="color: #b22222;">System authorization information</span>
auth --useshadow --passalgo=sha512
<span style="color: #b22222;"># </span><span style="color: #b22222;">Use text mode install</span>
text
<span style="color: #b22222;"># </span><span style="color: #b22222;">Run the Setup Agent on first boot</span>
firstboot --enable
<span style="color: #b22222;"># </span><span style="color: #b22222;">SELinux configuration</span>
selinux --disabled
<span style="color: #b22222;"># </span><span style="color: #b22222;">Do not configure the X Window System</span>
skipx

<span style="color: #b22222;"># </span><span style="color: #b22222;">Firewall configuration</span>
firewall --disabled
<span style="color: #b22222;"># </span><span style="color: #b22222;">Network information</span>
network --bootproto=dhcp --device=eth0
<span style="color: #b22222;"># </span><span style="color: #b22222;">Reboot after installation</span>
reboot
<span style="color: #b22222;"># </span><span style="color: #b22222;">System timezone</span>
timezone Asia/Shanghai
<span style="color: #b22222;"># </span><span style="color: #b22222;">System bootloader configuration</span>
bootloader --append=<span style="color: #8b2252;">"net.ifnames=0"</span> --location=mbr
<span style="color: #b22222;"># </span><span style="color: #b22222;">Clear the Master Boot Record</span>
zerombr
<span style="color: #b22222;"># </span><span style="color: #b22222;">Partition clearing information</span>
clearpart --all --initlabel
<span style="color: #b22222;"># </span><span style="color: #b22222;">Disk partitioning information</span>
part /boot --fstype=<span style="color: #8b2252;">"ext4"</span> --size=2048
part / --fstype=<span style="color: #8b2252;">"xfs"</span> --size=10240
part swap --fstype=<span style="color: #8b2252;">"swap"</span> --size=2048

%pre
i am pre
%end

%post --nochroot
i am post
%end

%packages
@development
-byacc
-cscope
-ctags
-diffstat
-doxygen
-elfutils
-gcc-gfortran
-git
-indent
-intltool
-patchutils
-rcs
-subversion
-swig
-systemtap
%end
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:eed3d000-c9a2-4494-83f6-aa6fbb1815fb" class="outline-3">
<h3 id="h:eed3d000-c9a2-4494-83f6-aa6fbb1815fb">3 制作引导光盘和U盘</h3>
<div class="outline-text-3" id="text-h:eed3d000-c9a2-4494-83f6-aa6fbb1815fb">
<p>
可以将定制安装光盘，并结合kickstart实现基于光盘启动的半自动化安装
</p>

<p>
<b>实现过程</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#mkdir &#8211;pv /data/myiso
[root@centos8 ~]#cp -r /mnt/isolinux/ /data/myiso/
[root@centos8 ~]#tree /data/myiso/
/data/myiso/
&#9492;&#9472;&#9472; isolinux
    &#9500;&#9472;&#9472; boot.cat
    &#9500;&#9472;&#9472; boot.msg
    &#9500;&#9472;&#9472; grub.conf
    &#9500;&#9472;&#9472; initrd.img
    &#9500;&#9472;&#9472; isolinux.bin
    &#9500;&#9472;&#9472; isolinux.cfg
    &#9500;&#9472;&#9472; ldlinux.c32
    &#9500;&#9472;&#9472; libcom32.c32
    &#9500;&#9472;&#9472; libutil.c32
    &#9500;&#9472;&#9472; memtest
    &#9500;&#9472;&#9472; splash.png
    &#9500;&#9472;&#9472; TRANS.TBL
    &#9500;&#9472;&#9472; vesamenu.c32
    &#9492;&#9472;&#9472; vmlinuz

1 directory, 14 files

[root@centos8 ~]#vim /data/myiso/isolinux/isolinux.cfg
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;1&#65306;&#24212;&#31572;&#26041;&#20214;&#25918;&#22312;ISO&#25991;&#20214;&#37324;</span>
label linux
  menu label ^Auto Install CentOS Linux 8
  kernel vmlinuz
  <span style="color: #a0522d;">initrd</span>=initrd.img text <span style="color: #a0522d;">ks</span>=cdrom:/myks.cfg

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;2&#65306;&#24212;&#31572;&#26041;&#20214;&#25918;&#22312;http&#26381;&#21153;&#22120;&#19978;</span>
label linux
  menu label ^Auto Install CentOS Linux 8
  kernel vmlinuz
  append <span style="color: #a0522d;">initrd</span>=initrd.img quiet <span style="color: #a0522d;">ks</span>=http://10.0.0.8/ksdir/centos8.cfg
label rescue
  menu label ^Rescue a CentOS Linux system
  kernel vmlinuz
  append <span style="color: #a0522d;">initrd</span>=initrd.img inst.repo=http://10.0.0.8/centos/8 rescue quiet
label local
  menu default
  menu label Boot from ^local drive
  localboot 0xffff

[root@centos8 ~]#cp /root/myks.cfg /data/myiso/
[root@centos8 ~]#dnf -y install mkisofs
[root@centos8 ~]#mkisofs -R -J -T -v --no-emul-boot --boot-load-size 4 --bootinfo-table -V <span style="color: #8b2252;">"CentOS 8.0 x86_64 boot"</span> -b isolinux/isolinux.bin -c isolinux/boot.cat -o /root/boot.iso /data/myiso/
&#27880;&#24847;&#65306;&#20197;&#19978;&#30456;&#23545;&#36335;&#24452;&#37117;&#26159;&#30456;&#23545;&#20110;&#20809;&#30424;&#30340;&#26681;&#65292;&#21644;&#24037;&#20316;&#30446;&#24405;&#26080;&#20851;
</pre>
</div>

<p>
<b>mkisofs选项说明</b>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">[OPTION]</th>
<th scope="col" class="org-left">意义</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">-o</td>
<td class="org-left">指定映像文件的名称。</td>
</tr>

<tr>
<td class="org-left">-b</td>
<td class="org-left">指定在制作可开机光盘时所需的开机映像文件。</td>
</tr>

<tr>
<td class="org-left">-c</td>
<td class="org-left">制作可开机光盘时，会将开机映像文件中的</td>
</tr>

<tr>
<td class="org-left">no-eltorito-catalog</td>
<td class="org-left">全部内容作成一个文件。</td>
</tr>

<tr>
<td class="org-left">-no-emul-boot</td>
<td class="org-left">非模拟模式启动。</td>
</tr>

<tr>
<td class="org-left">-boot-load-size 4</td>
<td class="org-left">设置载入部分的数量</td>
</tr>

<tr>
<td class="org-left">-boot-info-table</td>
<td class="org-left">在启动的图像中现实信息</td>
</tr>

<tr>
<td class="org-left">-R 或 -rock</td>
<td class="org-left">使用 Rock RidgeExtensions</td>
</tr>

<tr>
<td class="org-left">-J 或 -joliet</td>
<td class="org-left">使用 Joliet 格式的目录与文件名称</td>
</tr>

<tr>
<td class="org-left">-v 或 -verbose</td>
<td class="org-left">执行时显示详细的信息</td>
</tr>

<tr>
<td class="org-left">-T 或 -translationtable</td>
<td class="org-left">建立文件名的转换表，适于不支持 Rock Ridge Extensions 的系统上</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-h:8ef73af5-1c84-4683-9c32-e3f1dae2921e" class="outline-3">
<h3 id="h:8ef73af5-1c84-4683-9c32-e3f1dae2921e">4 实现DHCP服务</h3>
<div class="outline-text-3" id="text-h:8ef73af5-1c84-4683-9c32-e3f1dae2921e">
<p>
主机获取网络配置可以通过两种方式：
</p>

<ul class="org-ul">
<li>静态指定</li>
<li>动态获取:
<ul class="org-ul">
<li>bootp：boot protocol MAC与IP一一静态对应</li>
<li>dhcp：增强的bootp，支持静态和动态</li>
</ul></li>
</ul>
</div>
<div id="outline-container-h:a334ebfb-88d4-4942-9d8d-1f8e6d0ae094" class="outline-4">
<h4 id="h:a334ebfb-88d4-4942-9d8d-1f8e6d0ae094">4.1 DHCP工作原理</h4>
<div class="outline-text-4" id="text-h:a334ebfb-88d4-4942-9d8d-1f8e6d0ae094">
<p>
DHCP: Dynamic Host Configuration Protocol，动态主机配置协议，UDP协议，C/S模式，dhcp
</p>

<p>
server：67/udp,dhcpv4c client :68/udp，dhcpv6 client：546/udp
</p>

<p>
主要用途：
</p>

<ul class="org-ul">
<li>用于内部网络和网络服务供应商自动分配IP地址给用户</li>
<li>用于内部网络管理员作为对所有电脑作集中管理的手段</li>
<li>自动化安装系统</li>
<li>解决IPV4资源不足问题</li>
</ul>

<p>
<b>共有八种报文</b>
</p>


<figure id="org03e1cc1">
<img src="images/image-20210122143110059.png" alt="image-20210122143110059.png">

</figure>

<ul class="org-ul">
<li>DHCP DISCOVER：客户端到服务器</li>
<li>DHCP OFFER ：服务器到客户端</li>
<li>DHCP REQUEST：客户端到服务器</li>
<li>DHCP ACK ：服务器到客户端</li>
<li>DHCP NAK：服务器到客户端,通知用户无法分配合适的IP地址</li>
<li>DHCP DECLINE ：客户端到服务器，指示地址已被使用</li>
<li>DHCP RELEASE：客户端到服务器，放弃网络地址和取消剩余的租约时间</li>
<li>DHCP INFORM：客户端到服务器,
客户端如果需要从DHCP服务器端获取更为详细的配置信息，则发送Inform报文向服务器进行请求，极少用到</li>
</ul>

<p>
<b>DHCP服务续租</b>
</p>

<ul class="org-ul">
<li>50%：租赁时间达到50%时来续租，刚向DHCP服务器发向新的DHCPREQUEST请求。如果dhcp服务没有拒绝的理由，则回应DHCPACK信息。当DHCP客户端收到该应答信息后，就重新开始新的租用周期</li>
<li>87.5%：如果之前DHCP Server没有回应续租请求，等到租约期的7/8时，主机会再发送一次广播请求</li>
</ul>

<p>
<b>同网段多DHCP服务</b>
</p>

<ul class="org-ul">
<li>DHCP服务必须基于本地</li>
<li>先到先得的原则</li>
</ul>

<p>
<b>跨网段</b>
</p>

<ul class="org-ul">
<li>RFC 1542 Compliant Routers</li>
<li>dhcp relay agent: 中继代理</li>
</ul>

<p>
<b>相关协议</b>
</p>

<ul class="org-ul">
<li>arp</li>
<li>rarp</li>
</ul>

<p>
<b>租期：</b>
</p>

<p>
长租期：IP相对稳定，网络资源消耗较少，但是浪费IP资源
</p>

<p>
短租期：IP相对不稳定，网络资源消耗较多，但是IP资源可以充分利用，可以实现较少IP为较多的主机服务
</p>
</div>
</div>
<div id="outline-container-h:15c65f05-fc0c-46d8-bd0b-2b36b566b604" class="outline-4">
<h4 id="h:15c65f05-fc0c-46d8-bd0b-2b36b566b604">4.2 DHCP实现</h4>
<div class="outline-text-4" id="text-h:15c65f05-fc0c-46d8-bd0b-2b36b566b604">
<p>
注意：*实现DHCP服务前，先将网络已有DHCP服务，如：mware中的DHCP关闭，访止冲突*
</p>

<p>
DHCP服务的实现软件：
</p>

<ul class="org-ul">
<li>dhcp（CentOS 7 之前版本） 或 dhcp-server（CentOS 8 中的包名）</li>
<li>dnsmasq：小型服务软件，可以提供dhcp和dns功能</li>
</ul>
</div>
<div id="outline-container-h:f4cf7a43-3ef0-4a3c-a81a-9d687bd1ce55" class="outline-5">
<h5 id="h:f4cf7a43-3ef0-4a3c-a81a-9d687bd1ce55">4.2.1 DHCP相关文件组成</h5>
<div class="outline-text-5" id="text-h:f4cf7a43-3ef0-4a3c-a81a-9d687bd1ce55">
<p>
<b>dhcp-server 包文件组成</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">/usr/sbin/dhcpd dhcp&#26381;&#21153;&#20027;&#31243;&#24207;
/etc/dhcp/dhcpd.conf dhcp&#26381;&#21153;&#37197;&#32622;&#25991;&#20214;
/usr/share/doc/dhcp-server/dhcpd.conf.example <span style="color: #b22222;">#</span><span style="color: #b22222;">dhcp&#26381;&#21153;&#37197;&#32622;&#33539;&#20363;&#25991;&#20214;</span>
/usr/lib/systemd/system/dhcpd.service <span style="color: #b22222;">#</span><span style="color: #b22222;">dhcp&#26381;&#21153;service&#25991;&#20214;</span>
/var/lib/dhcpd/dhcpd.leases &#22320;&#22336;&#20998;&#37197;&#35760;&#24405;
</pre>
</div>

<p>
<b>dhcp-client客户端包</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">/usr/sbin/dhclient <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23458;&#25143;&#31471;&#31243;&#24207;</span>
/var/lib/dhclient <span style="color: #b22222;">#</span><span style="color: #b22222;">&#33258;&#21160;&#33719;&#21462;&#30340;IP&#20449;&#24687;</span>
</pre>
</div>

<p>
<b>windows 工具</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">ipconfig /release <span style="color: #b22222;">#</span><span style="color: #b22222;">&#37322;&#25918;DHCP&#33719;&#21462;&#30340;IP&#65292;&#37325;&#26032;&#30003;&#35831;IP</span>
ipconfig/renew <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21047;&#26032;&#31199;&#32422;&#65292;&#32493;&#32422;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a5525092-82fa-471c-8aef-7057960a7ba5" class="outline-5">
<h5 id="h:a5525092-82fa-471c-8aef-7057960a7ba5">4.2.2 DHCP服务器配置文件</h5>
<div class="outline-text-5" id="text-h:a5525092-82fa-471c-8aef-7057960a7ba5">
<p>
帮助参考：man 5 dhcpd.conf
</p>

<p>
/etc/dhcp/dhcpd.conf 格式
</p>

<div class="org-src-container">
<pre class="src src-sh">&#20840;&#23616;&#37197;&#32622;
subnet {
...
}
host {
...
}
</pre>
</div>

<p>
检查语法命令：service dhcpd configtest （CentOS 6 之前版本支持）
</p>

<p>
范例：dhcpd.conf
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#grep -v <span style="color: #8b2252;">"#"</span> /etc/dhcp/dhcpd.conf
option domain-name <span style="color: #8b2252;">"me.org"</span>;
option domain-name-servers 180.76.76.76, 223.6.6.6;
default-lease-time 600;
max-lease-time 7200;
log-facility local7;
subnet 10.0.0.0 netmask 255.255.255.0 {
    range 10.0.0.10 10.0.0.100;
    range 10.0.0.110 10.0.0.200;
    option routers 10.0.0.2;
    next-server 10.0.0.8;
    filename <span style="color: #8b2252;">"pxelinux.0"</span>;
}

host testclient {
  hardware ethernet 00:0c:29:33:b4:1a;
  fixed-address 10.0.0.106;
  default-lease-time 86400;
  max-lease-time 864000;
  option routers 10.0.0.254;
  option domain-name-servers 114.114.114.114,8.8.8.8 ;
  option domain-name <span style="color: #8b2252;">"me.net"</span>;

}
</pre>
</div>

<p>
<b>DHCP配置文件其它配置选项</b> ：
</p>

<ul class="org-ul">
<li>next-server：提供引导文件的服务器IP地址</li>
<li>filename: 指明引导文件名称</li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">subnet 10.0.0.0 netmask 255.255.255.0 {
  range 10.0.0.100 10.0.0.200;
  option routers 10.0.0.2;
  next-server 10.0.0.8;  <span style="color: #b22222;">#</span><span style="color: #b22222;">TFTP&#26381;&#21153;&#22120;&#22320;&#22336;</span>
  filename <span style="color: #8b2252;">"pxelinux.0"</span>; <span style="color: #b22222;">#</span><span style="color: #b22222;">bootloader&#21551;&#21160;&#25991;&#20214;&#30340;&#21517;&#31216;</span>
}
</pre>
</div>

<p>
范例：dhcp 客户端申请地址的过程
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#dhclient -d
Internet Systems Consortium DHCP Client 4.2.5
Copyright 2004-2013 Internet Systems Consortium.
All rights reserved.
For info, please visit https://www.isc.org/software/dhcp/

Listening on LPF/eth0/00:0c:29:01:f9:48
Sending on LPF/eth0/00:0c:29:01:f9:48
Sending on Socket/fallback
DHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 8 (<span style="color: #a0522d;">xid</span>=0x4147178b)
DHCPREQUEST on eth0 to 255.255.255.255 port 67 (<span style="color: #a0522d;">xid</span>=0x4147178b)
DHCPOFFER from 10.0.0.8
DHCPACK from 10.0.0.8 (<span style="color: #a0522d;">xid</span>=0x4147178b)
bound to 10.0.0.100 -- renewal<span style="color: #a020f0;"> in</span> 32740 seconds.

<span style="color: #b22222;">#</span><span style="color: #b22222;">DHCP&#23458;&#25143;&#31471;&#30340;&#26085;&#24535;</span>
[root@centos7 ~]#ls /var/lib/dhclient/
dhclient.leases
[root@centos7 ~]#cat /var/lib/dhclient/dhclient.leases
lease {
  interface <span style="color: #8b2252;">"eth0"</span>;
  fixed-address 10.0.0.100;
  option subnet-mask 255.255.255.0;
  option routers 10.0.0.2;
  option dhcp-lease-time 86400;
  option dhcp-message-type 5;
  option domain-name-servers 180.76.76.76,223.5.5.5,223.6.6.6;
  option dhcp-server-identifier 10.0.0.8;
  option domain-name <span style="color: #8b2252;">"me.com"</span>;
  renew 3 2020/05/27 16:18:15;
  rebind 4 2020/05/28 04:12:33;
  expire 4 2020/05/28 07:12:33;
}


<span style="color: #b22222;">#</span><span style="color: #b22222;">DHCP&#26381;&#21153;&#22120;&#30340;&#26085;&#24535;</span>
[root@centos8 ~]#tail -f /var/lib/dhcpd/dhcpd.leases
<span style="color: #b22222;"># </span><span style="color: #b22222;">The format of this file is documented in the dhcpd.leases(5) manual page.</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">This lease file was written by isc-dhcp-4.3.6</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">authoring-byte-order entry is generated, DO NOT DELETE</span>
authoring-byte-order little-endian;

server-duid <span style="color: #8b2252;">"\000\001\000\001&amp;`\315\277\000\014)?s\225"</span>;

lease 10.0.0.100 {
  starts 3 2020/05/27 07:12:33;
  ends 4 2020/05/28 07:12:33;
  cltt 3 2020/05/27 07:12:33;
  binding state active;
  next binding state free;
  rewind binding state free;
  hardware ethernet 00:0c:29:01:f9:48;
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:49fc7f5a-d072-4a10-a665-7d1b46582c1f" class="outline-3">
<h3 id="h:49fc7f5a-d072-4a10-a665-7d1b46582c1f">5 实现TFTP服务</h3>
<div class="outline-text-3" id="text-h:49fc7f5a-d072-4a10-a665-7d1b46582c1f">
</div>
<div id="outline-container-h:d2644526-aecb-4245-9f1b-3a3897c4c31d" class="outline-4">
<h4 id="h:d2644526-aecb-4245-9f1b-3a3897c4c31d">5.1 TFTP介绍</h4>
<div class="outline-text-4" id="text-h:d2644526-aecb-4245-9f1b-3a3897c4c31d">
<p>
TFTP：Trivial File Transfer Protocol
，是一种用于传输文件的简单高级协议，是文件传输协议（FTP）的简化版本。用来传输比文件传输协议（FTP）更易于使用但功能较少的文件
</p>

<p>
TFTP和FTP的区别
</p>
<ol class="org-ol">
<li><p>
安全性区别
</p>

<p>
FTP支持登录安全，具有适当的身份验证和加密协议，在建立连接期间需要与FTP身份验证通信
</p>

<p>
TFTP是一种开放协议，缺乏安全性，没有加密机制，与TFTP通信时不需要认证
</p></li>

<li><p>
传输层协议的区别
</p>

<p>
FTP使用TCP作为传输层协议，TFTP使用UDP作为传输层协议
</p></li>

<li><p>
使用端口的区别
</p>

<p>
FTP使用2个端口：TCP端口21，是个侦听端口；TCP端口20或更高TCP端口1024以上用于源连接
</p>

<p>
TFTP仅使用一个具有停止和等待模式的端口：端口：69/udp
</p></li>

<li><p>
RFC的区别
</p>

<p>
FTP是基于RFC 959文档，带有其他RFC涵盖安全措施；TFTP基于RFC 1350文档
</p></li>

<li><p>
执行命令的区别
</p>

<p>
FTP有许多可以执行的命令（get，put，ls，dir，lcd）并且可以列出目录等
</p>

<p>
TFTP只有5个指令可以执行（rrq，wrq，data，ack，error）
</p></li>
</ol>
</div>
</div>
<div id="outline-container-h:f85805e1-4448-4813-98d2-663717d5e5fd" class="outline-4">
<h4 id="h:f85805e1-4448-4813-98d2-663717d5e5fd">5.2 安装和使用TFTP</h4>
<div class="outline-text-4" id="text-h:f85805e1-4448-4813-98d2-663717d5e5fd">
<p>
*安装包*：
</p>

<ul class="org-ul">
<li>tftp-server #服务器包</li>
<li>tftp #客户端包</li>
</ul>

<p>
范例：安装并使用tftp下载文件
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;tftp&#26381;&#21153;&#22120;&#21253;</span>
[root@centos8 ~]#dnf install tftp-server -y
[root@centos8 ~]#rpm -ql tftp-server
/usr/lib/.build-id
/usr/lib/.build-id/8c
/usr/lib/.build-id/8c/6921a9fb21d66da4fb299d516bce9ee6afea34
/usr/lib/systemd/system/tftp.service   <span style="color: #b22222;">#</span><span style="color: #b22222;">tftp service&#25991;&#20214;</span>
/usr/lib/systemd/system/tftp.socket    <span style="color: #b22222;">#</span><span style="color: #b22222;">tftp socket&#25991;&#20214;</span>
/usr/sbin/in.tftpd                     <span style="color: #b22222;">#</span><span style="color: #b22222;">tftp&#20027;&#31243;&#24207;</span>
/usr/share/doc/tftp-server
/usr/share/doc/tftp-server/CHANGES
/usr/share/doc/tftp-server/README
/usr/share/doc/tftp-server/README.security
/usr/share/man/man8/in.tftpd.8.gz
/usr/share/man/man8/tftpd.8.gz
/var/lib/tftpboot                      <span style="color: #b22222;">#</span><span style="color: #b22222;">TFTP&#26381;&#21153;&#25968;&#25454;&#30446;&#24405;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#21160;&#26381;&#21153;</span>
[root@centos8 ~]#systemctl enable --now tftp.service
Created symlink /etc/systemd/system/sockets.target.wants/tftp.socket &#8594;
/usr/lib/systemd/system/tftp.socket.

[root@centos8 ~]#ss -nulp|grep tftp
UNCONN    0      0                  *:69                    *:*
users:((<span style="color: #8b2252;">"in.tftpd"</span>,<span style="color: #a0522d;">pid</span>=10100,<span style="color: #a0522d;">fd</span>=0),(<span style="color: #8b2252;">"systemd"</span>,<span style="color: #a0522d;">pid</span>=1,<span style="color: #a0522d;">fd</span>=32))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;&#27979;&#35797;&#25991;&#20214;</span>
[root@centos8 ~]#cp /etc/fstab /var/lib/tftpboot/f1.txt
[root@centos8 ~]#mkdir /var/lib/tftpboot/dir
[root@centos8 ~]#cp /etc/password /var/lib/tftpboot/dir/f2.txt

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;tftp&#23458;&#25143;&#31471;&#21253;</span>
[root@centos7 ~]#yum -y install tftp
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23458;&#25143;&#31471;&#36890;&#36807;tftp&#27979;&#35797;&#19979;&#36733;&#25991;&#20214;</span>
[root@centos7 ~]#tftp 10.0.0.8
tftp&gt; ls
?Invalid command
tftp&gt; help
tftp-hpa 5.2
Commands may be abbreviated. Commands are:

connect     connect to remote tftp
mode        set file transfer mode
put         send file
get         receive file
quit        exit tftp
verbose     toggle verbose mode
trace       toggle packet tracing
literal     toggle literal mode, ignore <span style="color: #8b2252;">':'</span><span style="color: #a020f0;"> in</span> file name
status      show current status
binary      set mode to octet
ascii       set mode to netascii
rexmt       set per-packet transmission timeout
timeout     set total retransmission timeout
?           print help information
<span style="color: #483d8b;">help</span>        print help information
tftp&gt; get f1.txt
tftp&gt; get dir/f2.txt
tftp&gt; quit
[root@centos7 ~]#ls
anaconda-ks.cfg f1.txt f2.txt

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;&#19979;&#22312;tftp&#26381;&#21153;&#22120;&#25191;&#34892;&#65292;&#24403;&#29992;&#25143;&#19979;&#36733;&#25991;&#20214;&#21518;&#65292;&#21487;&#20197;&#35266;&#23519;&#21040;&#26381;&#21153;&#22120;&#31471;&#33258;&#21160;&#25171;&#24320;in.tftpd&#20027;&#31243;&#24207;</span>
[root@centos8 tftpboot]#ps aux|grep in.tftp
root        1276  0.0  0.2  14912  1720 ?       Ss   12:03   0:00
/usr/sbin/in.tftpd -s /var/lib/tftpboot
root        1282  0.0  0.1  12108  960 pts/0    R+   12:04   0:00 grep --color=auto in.tftp
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:5d0555ce-164e-4d27-84e5-d5df6c104c95" class="outline-3">
<h3 id="h:5d0555ce-164e-4d27-84e5-d5df6c104c95">6 利用 PXE 实现自动化系统部署</h3>
<div class="outline-text-3" id="text-h:5d0555ce-164e-4d27-84e5-d5df6c104c95">
</div>
<div id="outline-container-h:f2f79349-fb53-4ca0-ad6d-cfd3d411a98a" class="outline-4">
<h4 id="h:f2f79349-fb53-4ca0-ad6d-cfd3d411a98a">6.1 PXE介绍</h4>
<div class="outline-text-4" id="text-h:f2f79349-fb53-4ca0-ad6d-cfd3d411a98a">
<p>
PXE：Preboot Excution Environment，预启动执行环境，是由Intel公司研发，
基于Client/Server的网络模式，支持远程主机通过网络从远端服务器下载映像，
并由此支持通过网络启动操作系统，可以引导和安装Windows，linux等多种操作
系统
</p>

<p>
<b>PXE启动工作原理</b>
</p>


<figure id="org624718b">
<img src="images/image-20210122143233179.png" alt="image-20210122143233179.png">

</figure>
</div>
</div>
<div id="outline-container-h:e19967b1-627c-4835-a527-1f5a797d1b4d" class="outline-4">
<h4 id="h:e19967b1-627c-4835-a527-1f5a797d1b4d">6.2 利用PXE实现自动化安装流程</h4>
<div class="outline-text-4" id="text-h:e19967b1-627c-4835-a527-1f5a797d1b4d">

<figure id="org1b076c5">
<img src="images/image-20210122143252551.png" alt="image-20210122143252551.png">

</figure>

<ol class="org-ol">
<li>Client向PXE
Server上的DHCP发送IP地址请求消息，DHCP检测Client是否合法（主要是检测Client的网卡MAC地址），如果合法则返回Client的IP地址，同时将启动文件pxelinux.0的所在TFTP服务器地址信息一并传送给Client</li>
<li>Client向TFTP服务器发送获取pxelinux.0请求消息，TFTP服务器接收到消息之后，向Client发送pxelinux.0大小信息，试探Client是否满意，当TFTP收到Client发回的同意大小信息之后，正式向Client发送pxelinux.0</li>
<li>Client执行接收到的pxelinux.0文件，并利用此文件启动</li>
<li>Client向TFTP 服务器发送请求针对本机的配置信息文件（在TFTP
服务器的pxelinux.cfg目录下），TFTP服务器将启动菜单配置文件发回Client，继而Client根据启动菜单配置文件执行后续操作</li>
<li>Client根据启动菜单配置文件里的信息，向TFTP发送Linux内核和initrd文件请求信息，TFTP接收到消息之后将内核和initrd文件发送给Client</li>
<li>Client向TFTP发送根文件请求信息，TFTP接收到消息之后返回Linux根文件系统</li>
<li>Client启动Linux内核,加载相关的内核参数</li>
<li>Client通过内核参数下载kickstart文件，并根据kickstart文件里的安装信息，下载安装源文件进行自动化安装</li>
</ol>

<p>
*UEFI 客户端的安装文档*：
</p>

<p>
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_an_advanced_rhel_installation/preparing-for-a-network-install_installing-rhel-as-an-experienced-user#configuring-a-tftp-server-for-uefi-based-clients_preparing-for-a-network-install">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_an_advanced_rhel_installation/preparing-for-a-network-install_installing-rhel-as-an-experienced-user#configuring-a-tftp-server-for-uefi-based-clients_preparing-for-a-network-install</a>
</p>
</div>
</div>
<div id="outline-container-h:35e0793c-58b7-4cf4-ad0a-d5a0c574c3e7" class="outline-4">
<h4 id="h:35e0793c-58b7-4cf4-ad0a-d5a0c574c3e7">6.3 在CentOS 6 上实现PXE自动化安装CentOS</h4>
<div class="outline-text-4" id="text-h:35e0793c-58b7-4cf4-ad0a-d5a0c574c3e7">
<p>
<b>6.3.1 安装前准备</b>
</p>

<p>
关闭防火墙和SELINUX，DHCP服务器静态IP
</p>

<p>
网络要求：关闭Vmware软件中的DHCP服务
</p>

<p>
<b>6.3.2 安装相关软件包并启动</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#yum install dhcp httpd tftp-server syslinux
[root@centos6 ~]#chkconfig tftp on
[root@centos6 ~]#chkconfig httpd on
[root@centos6 ~]#chkconfig dhcpd on
[root@centos6 ~]#service httpd start
[root@centos6 ~]#service xneted start
</pre>
</div>

<p>
<b>6.3.3 准备yum 源和相关目录</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#mkdir -pv /var/www/html/centos/6/os/x86_64
[root@centos6 ~]#mount /dev/sr0 /var/www/html/centos/6/os/x86_64
</pre>
</div>

<p>
<b>6.3.4 准备kickstart文件</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#mkdir /var/www/html/ks/
[root@centos6 ~]#vim /var/www/html/centos/ks/centos6.cfg
[root@centos6 ~]#grep -vE <span style="color: #8b2252;">'^#|^$'</span> /var/www/html/centos/ks/centos6.cfg
install
text
reboot
url --url=http://10.0.0.100/centos/6/os/x86_64/
lang en_US.UTF-8
keyboard us
network --onboot yes --device eth0 --bootproto dhcp --noipv6
rootpw --iscrypted
$<span style="color: #a0522d;">6</span>$<span style="color: #a0522d;">b6C5mM</span>/BwOMBoK8H$<span style="color: #a0522d;">cYZFrHoNlOL0iDsxOTRhwnWJ3yfFmf7mRJBOxEqGoI56UMrT8J7qlrGwX7tS</span>
nOf7wKxYR2hAvAREILDgOgsFe1
firewall --disabled
authconfig --enableshadow --passalgo=sha512
selinux --disabled
timezone Asia/Shanghai
bootloader --location=mbr --driveorder=sda --append=<span style="color: #8b2252;">"crashkernel=auto rhgb</span>
<span style="color: #8b2252;">quiet"</span>
zerombr
clearpart --all --initlabel
part /boot --fstype=ext4 --size=1024
part / --fstype=ext4 --size=50000
part /data --fstype=ext4 --size=30000
part swap --size=2048
%packages
@core
@server-policy
@workstation-policy
autofs
vim-enhanced
%end
%post
useradd wang
<span style="color: #483d8b;">echo</span> me | passwd --stdin wang &amp;&gt; /dev/null
mkdir /etc/yum.repos.d/bak
mv /etc/yum.repos.d/* /etc/yum.repos.d/bak
cat &gt; /etc/yum.repos.d/base.repo &lt;&lt;EOF
<span style="color: #ffa54f;">[base]</span>
<span style="color: #ffa54f;">name=base</span>
<span style="color: #ffa54f;">baseurl=file:///misc/cd</span>
<span style="color: #ffa54f;">gpgcheck=0</span>
<span style="color: #ffa54f;">EOF</span>
%end
</pre>
</div>

<p>
<b>6.3.5 配置DHCP服务</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#cp /usr/share/doc/dhcp-4.1.1/dhcpd.conf.sample
/etc/dhcp/dhcpd.conf
[root@centos6 ~]#vim /etc/dhcp/dhcpd.conf
[root@centos6 ~]#cat /etc/dhcp/dhcpd.conf
option domain-name <span style="color: #8b2252;">"example.com"</span>;
option domain-name-servers 10.0.0.1;
subnet 10.0.0.0 netmask 255.255.255.0 {
    range 10.0.0.1 10.0.0.200;
    option routers 10.0.0.1;
    filename <span style="color: #8b2252;">"pxelinux.0"</span>;
    next-server 10.0.0.100;
}
[root@centos6 ~]#service dhcpd start
</pre>
</div>

<p>
<b>6.3.6 准备PXE启动相关文件</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#mkdir /var/lib/tftpboot/pxelinux.cfg/
[root@centos6 ~]#cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/
[root@centos6 ~]#cd /misc/cd/images/pxeboot/
[root@centos6 ~]#cp vmlinuz initrd.img /var/lib/tftpboot
[root@centos6 ~]#Cd /misc/cd/isolinux/
[root@centos6 ~]#cp boot.msg vesamenu.c32 splash.jpg /var/lib/tftpboot
[root@centos6 ~]#cp /misc/cd/isolinux/isolinux.cfg
/var/lib/tftpboot/pxelinux.cfg/default
[root@centos6 ~]#tree /var/lib/tftpboot/
/var/lib/tftpboot/
&#9500;&#9472;&#9472; boot.msg
&#9500;&#9472;&#9472; initrd.img
&#9500;&#9472;&#9472; pxelinux.0
&#9500;&#9472;&#9472; pxelinux.cfg
&#9474; &#9492;&#9472;&#9472; default
&#9500;&#9472;&#9472; splash.jpg
&#9500;&#9472;&#9472; vesamenu.c32
&#9492;&#9472;&#9472; vmlinuz

1 directory, 7 files
</pre>
</div>

<p>
<b>6.3.7 准备启动菜单文件</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#vim /var/lib/tftpboot/pxelinux.cfg/default
default vesamenu.c32 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450;&#33756;&#21333;&#39118;&#26684;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">prompt 1</span>
timeout 600?
display boot.msg?
menu background splash.jpg
menu title Welcome to wang CentOS 6
menu color border 0 <span style="color: #b22222;">#</span><span style="color: #b22222;">ffffffff #00000000</span>
menu color sel 7 <span style="color: #b22222;">#</span><span style="color: #b22222;">ffffffff #ff000000</span>
menu color title 0 <span style="color: #b22222;">#</span><span style="color: #b22222;">ffffffff #00000000</span>
menu color tabmsg 0 <span style="color: #b22222;">#</span><span style="color: #b22222;">ffffffff #00000000</span>
menu color unsel 0 <span style="color: #b22222;">#</span><span style="color: #b22222;">ffffffff #00000000</span>
menu color hotsel 0 <span style="color: #b22222;">#</span><span style="color: #b22222;">ff000000 #ffffffff</span>
menu color hotkey 7 <span style="color: #b22222;">#</span><span style="color: #b22222;">ffffffff #ff000000</span>
menu color scrollbar 0 <span style="color: #b22222;">#</span><span style="color: #b22222;">ffffffff #00000000?</span>
label auto
  menu label ^Automatic Install Centos6
  kernel vmlinuz
  append <span style="color: #a0522d;">initrd</span>=initrd.img <span style="color: #a0522d;">ks</span>=http://10.0.0.100/ks/centos6.cfg
label manual
  menu label ^Manual Install Centos
  kernel vmlinuz
  append <span style="color: #a0522d;">initrd</span>=initrd.img inst.repo=http://10.0.0.100/centos/6/isos/x86_64/
label local
  menu default
  menu label Boot from ^local drive
  localboot 0xffff
</pre>
</div>

<p>
<b>6.3.8 测试客户端基于PXE实现自动安装</b>
</p>

<p>
新准备一台主机，设置网卡引导，可看到看启动菜单，并实现自动安装
</p>
</div>
</div>
<div id="outline-container-h:d14d2da4-a17b-4edd-bcef-e141bc39f7ae" class="outline-4">
<h4 id="h:d14d2da4-a17b-4edd-bcef-e141bc39f7ae">6.4 在CentOS7 上实现PXE自动化安装CentOS</h4>
<div class="outline-text-4" id="text-h:d14d2da4-a17b-4edd-bcef-e141bc39f7ae">
<p>
<b>6.4.1 安装前准备</b>
</p>

<p>
关闭防火墙和SELINUX，DHCP服务器静态IP
</p>

<p>
网络要求：关闭Vmware软件中的DHCP服务
</p>

<p>
<b>6.4.2 安装相关软件包并启动服务</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#yum -y install httpd tftp-server dhcp syslinux system-configkickstart
[root@centos7 ~]#systemctl enable --now httpd tftp dhcpd
</pre>
</div>

<p>
注意：由于dhcp还没有配置，此时还无法立即启动
</p>

<p>
<b>6.4.3 准备yum源和相关目录</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#mkdir -pv /var/www/html/centos/7/os/x86_64
[root@centos7 ~]#mount /dev/sr0 /var/www/html/centos/7/os/x86_64
</pre>
</div>

<p>
<b>6.4.4 准备kickstart文件</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#mkdir /var/www/html/ks/
[root@centos7 ~]#vim /var/www/html/ks/centos7.cfg
[root@centos7 ~]#grep -vE <span style="color: #8b2252;">'^#|^$'</span> /var/www/html/ks/centos7.cfg
install
xconfig --startxonboot
keyboard --vckeymap=us --xlayouts=<span style="color: #8b2252;">'us'</span>
rootpw --iscrypted $<span style="color: #a0522d;">1</span>$<span style="color: #a0522d;">bpNEv8S5</span>$<span style="color: #a0522d;">lK</span>.CjNkf.YCpFPHskSNiN0
url --url=<span style="color: #8b2252;">"http://10.0.0.100/centos/7/os/x86_64"</span>
lang en_US
auth --useshadow --passalgo=sha512
text
firstboot --enable
selinux --disabled
skipx
services --disabled=<span style="color: #8b2252;">"chronyd"</span>
ignoredisk --only-use=sda
firewall --disabled
network --bootproto=dhcp --device=ens33
reboot
timezone Asia/Shanghai --nontp
bootloader --append=<span style="color: #8b2252;">"crashkernel=auto"</span> --location=mbr --boot-drive=sda
zerombr
clearpart --all --initlabel
part swap --fstype=<span style="color: #8b2252;">"swap"</span> --ondisk=sda --size=3072
part / --fstype=<span style="color: #8b2252;">"xfs"</span> --ondisk=sda --size=51200
part /boot --fstype=<span style="color: #8b2252;">"xfs"</span> --ondisk=sda --size=1024
part /data --fstype=<span style="color: #8b2252;">"xfs"</span> --ondisk=sda --size=30720
%post
useradd wang
%end
%packages
@core
%end
</pre>
</div>

<p>
<b>6.4.5 配置DHCP服务</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#vim /etc/dhcp/dhcpd.conf
option domain-name <span style="color: #8b2252;">"example.com"</span>;
default-lease-time 600;
max-lease-time 7200;
subnet 10.0.0.0 netmask 255.255.255.0 {
    range 10.0.0.1 10.0.0.200;
    option routers 10.0.0.1;
    next-server 10.0.0.100;
    filename <span style="color: #8b2252;">"pxelinux.0"</span>;
}
[root@centos7 ~]#systemctl start dhcpd
</pre>
</div>

<p>
<b>6.4.6 准备PXE启动相关文件</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#mkdir /var/lib/tftpboot/pxelinux.cfg/
[root@centos7 ~]#cp /usr/share/syslinux/{pxelinux.0,menu.c32} /var/lib/tftpboot/
[root@centos7 ~]#cp /misc/cd/isolinux/{vmlinuz,initrd.img} /var/lib/tftpboot/
[root@centos7 ~]#cp /misc/cd/isolinux/isolinux.cfg /var/lib/tftpboot/pxelinux.cfg/default

&#26368;&#32456;&#30446;&#24405;&#25991;&#20214;&#21015;&#34920;&#22914;&#19979;&#65306;
/var/lib/tftpboot/
&#9500;&#9472;&#9472; initrd.img
&#9500;&#9472;&#9472; menu.c32
&#9500;&#9472;&#9472; pxelinux.0
&#9500;&#9472;&#9472; pxelinux.cfg
&#9474; &#9492;&#9472;&#9472; default
&#9492;&#9472;&#9472; vmlinuz
</pre>
</div>

<p>
<b>6.4.7 准备启动菜单</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#Vim /var/lib/tftpboot/pxelinux.cfg/default
default menu.c32
timeout 600
menu title PXE INSTALL MENU
label auto
  menu label ^Auto Install CentOS 7
  kernel vmlinuz
  append <span style="color: #a0522d;">initrd</span>=initrd.img <span style="color: #a0522d;">ks</span>=http://10.0.0.100/ks/centos7.cfg
label manual
  menu label ^Manual Install CentOS 7
  kernel vmlinuz
  append <span style="color: #a0522d;">initrd</span>=initrd.img inst.repo=http://10.0.0.100/centos/7/os/x86_64
label local
  menu default
  menu label ^Boot from local drive
  localboot 0xffff
</pre>
</div>

<p>
<b>6.4.8 测试客户端基于PXE实现自动安装</b>
</p>

<p>
新准备一台主机，设置网卡引导，可看到看启动菜单，并实现自动安装
</p>
</div>
</div>
<div id="outline-container-h:7c4af5a1-3add-442c-b338-9435272266df" class="outline-4">
<h4 id="h:7c4af5a1-3add-442c-b338-9435272266df">6.5 在 CentOS 8 上实现PXE自动化安装 CentOS 6,7,8</h4>
<div class="outline-text-4" id="text-h:7c4af5a1-3add-442c-b338-9435272266df">
<p>
<b>6.5.1 安装前准备</b>
</p>

<p>
关闭防火墙和SELINUX，DHCP服务器静态IP
</p>

<p>
网络要求：关闭Vmware软件中的DHCP服务，基于NAT模式
</p>

<p>
注意：*CentOS 7，8使用 1G 内存会提示空间不足，建议2G*
</p>

<p>
<b>6.5.2 安装相关软件包并启动</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#dnf -y install dhcp-server tftp-server httpd syslinux-nonlinux
[root@centos8 ~]#systemctl enable --now httpd tftp dhcpd
</pre>
</div>

<p>
<b>6.5.3 配置DHCP服务</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cp /usr/share/doc/dhcp-server/dhcpd.conf.example
/etc/dhcp/dhcpd.conf
[root@centos8 ~]#vim /etc/dhcp/dhcpd.conf
option domain-name <span style="color: #8b2252;">"example.com"</span>;
option domain-name-servers 180.76.76.76,223.6.6.6;
default-lease-time 600;
max-lease-time 7200;
log-facility local7;
subnet 10.0.0.0 netmask 255.255.255.0 {
  range 10.0.0.1 10.0.0.200;
  option routers 10.0.0.1;
  next-server 10.0.0.100;
  filename <span style="color: #8b2252;">"pxelinux.0"</span>;
}

[root@centos8 ~]#systemctl start dhcpd
</pre>
</div>

<p>
<b>6.5.4 准备yum 源和相关目录</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#mkdir -pv /var/www/html/centos/{6,7,8}/os/x86_64/
[root@centos8 ~]#mount /dev/sr0 /var/www/html/centos/6/os/x86_64/
[root@centos8 ~]#mount /dev/sr1 /var/www/html/centos/7/os/x86_64/
[root@centos8 ~]#mount /dev/sr2 /var/www/html/centos/8/os/x86_64/
</pre>
</div>

<p>
<b>6.5.5 准备kickstart文件</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#mkdir /var/www/html/ks/
[root@centos8 ~]#vim /var/www/html/ks/centos6.cfg <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20869;&#23481;&#21442;&#30475;6.3.4</span>
[root@centos8 ~]#vim /var/www/html/ks/centos7.cfg <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20869;&#23481;&#21442;&#30475;6.4.4</span>
[root@centos8 ~]#vim /var/www/html/ks/centos8.cfg
[root@centos8 ~]#grep -Ev <span style="color: #8b2252;">" (#|)"</span> /var/www/html/ks/centos8.cfg
ignoredisk --only-use=sda
zerombr
text
reboot
clearpart --all --initlabel
selinux --disabled
firewall --disabled
url --url=http://10.0.0.100/centos/8/os/x86_64/
keyboard --vckeymap=us --xlayouts=<span style="color: #8b2252;">'us'</span>
lang en_US.UTF-8
network --bootproto=dhcp --device=ens160 --ipv6=auto --activate
network --hostname=centos8.me.com
rootpw --iscrypted
$<span style="color: #a0522d;">6</span>$<span style="color: #a0522d;">j9YhzDUnQVnxaAk8</span>$<span style="color: #a0522d;">qv7rkMcPAEbV5yvwsP666DXWYadd3jYjkA9fpxAo9qYotjGGBUclCGoP1TRv</span>
gHBpqgc5n0RypMsPTQnVDcpO01
firstboot --enable
skipx
services --disabled=<span style="color: #8b2252;">"chronyd"</span>
timezone Asia/Shanghai --isUtc --nontp
user --name=wang --
<span style="color: #a0522d;">password</span>=6oUfb/02CWfLb5l8f$<span style="color: #a0522d;">sgEZeR7c7DpqfpmFDH6huSmDbW1XQNR4qKl2EPns</span>.gOXqlnAIgv9p
TogtFVaDtEpMOC.SWXKYqxfVtd9MCwxb1 --iscrypted --gecos=<span style="color: #8b2252;">"wang"</span>
part / --fstype=<span style="color: #8b2252;">"xfs"</span> --ondisk=sda --size=102400
part /data --fstype=<span style="color: #8b2252;">"xfs"</span> --ondisk=sda --size=51200
part swap --fstype=<span style="color: #8b2252;">"swap"</span> --ondisk=sda --size=2048
part /boot --fstype=<span style="color: #8b2252;">"ext4"</span> --ondisk=sda --size=1024
%packages
@^minimal-environment
kexec-tools
%end
%addon com_redhat_kdump --enable --reserve-mb=<span style="color: #8b2252;">'auto'</span>
%end
%anaconda
pwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty
pwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok
pwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty
%end
</pre>
</div>

<p>
<b>6.5.6 准备PXE启动相关文件</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#mkdir /var/lib/tftpboot/centos{6,7,8}
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;CentOS6&#65292;7&#65292;8&#21508;&#33258;&#30340;&#20869;&#26680;&#30456;&#20851;&#25991;&#20214;</span>
[root@centos8 ~]#cp /var/www/html/centos/6/os/x86_64/isolinux/{vmlinuz,initrd.img} /var/lib/tftpboot/centos6
[root@centos8 ~]#cp /var/www/html/centos/7/os/x86_64/isolinux/{vmlinuz,initrd.img} /var/lib/tftpboot/centos7
[root@centos8 ~]#cp /var/www/html/centos/8/os/x86_64/isolinux/{vmlinuz,initrd.img} /var/lib/tftpboot/centos8
[root@centos8 ~]#cp /usr/share/syslinux/{pxelinux.0,menu.c32} /var/lib/tftpboot/

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;&#19979;&#19977;&#20010;&#25991;&#20214;&#26159;CentOS8&#23433;&#35013;&#25152;&#24517;&#39035;&#25991;&#20214;&#65292;CentOS6&#65292;7&#21017;&#19981;&#38656;&#35201;</span>
[root@centos8 ~]#cp /var/www/html/centos/8/os/x86_64/isolinux/{ldlinux.c32,libcom32.c32,libutil.c32} /var/lib/tftpboot/

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#23433;&#35013;&#33756;&#21333;&#25991;&#20214;</span>
[root@centos8 ~]#mkdir /var/lib/tftpboot/pxelinux.cfg/
[root@centos8 ~]#cp /var/www/html/centos/8/os/x86_64/isolinux/isolinux.cfg /var/lib/tftpboot/pxelinux.cfg/default

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26368;&#32456;&#30446;&#24405;&#32467;&#26500;&#22914;&#19979;</span>
[root@centos8 ~]#tree /var/lib/tftpboot
<span style="color: #483d8b;">.</span>
&#9500;&#9472;&#9472; centos6
&#9474; &#9500;&#9472;&#9472; initrd.img
&#9474; &#9492;&#9472;&#9472; vmlinuz
&#9500;&#9472;&#9472; centos7
&#9474; &#9500;&#9472;&#9472; initrd.img
&#9474; &#9492;&#9472;&#9472; vmlinuz
&#9500;&#9472;&#9472; centos8
&#9474; &#9500;&#9472;&#9472; initrd.img
&#9474; &#9492;&#9472;&#9472; vmlinuz
&#9500;&#9472;&#9472; ldlinux.c32
&#9500;&#9472;&#9472; libcom32.c32
&#9500;&#9472;&#9472; libutil.c32
&#9500;&#9472;&#9472; menu.c32
&#9500;&#9472;&#9472; pxelinux.0
&#9492;&#9472;&#9472; pxelinux.cfg
&#9492;&#9472;&#9472; default

4 directories, 12 files
</pre>
</div>

<p>
<b>6.5.7 准备启动菜单文件</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#vim /var/lib/tftpboot/pxelinux.cfg/default
default menu.c32
timeout 600
menu title Install CentOS Linux

label linux8
  menu label Auto Install CentOS Linux ^8
  kernel centos8/vmlinuz
  append <span style="color: #a0522d;">initrd</span>=centos8/initrd.img <span style="color: #a0522d;">ks</span>=http://10.0.0.100/ks/centos8.cfg

label linux7
  menu label Auto Install CentOS Linux ^7
  kernel centos7/vmlinuz
  append <span style="color: #a0522d;">initrd</span>=centos7/initrd.img <span style="color: #a0522d;">ks</span>=http://10.0.0.100/ks/centos7.cfg

label linux6
  menu label Auto Install CentOS Linux ^6
  kernel centos6/vmlinuz
  append <span style="color: #a0522d;">initrd</span>=centos6/initrd.img <span style="color: #a0522d;">ks</span>=http://10.0.0.100/ks/centos6.cfg

label manual
  menu label ^Manual Install CentOS Linux 8.0
  kernel centos8/vmlinuz
  append <span style="color: #a0522d;">initrd</span>=centos8/initrd.img
inst.repo=http://10.0.0.100/centos/8/os/x86_64/

label rescue
  menu label ^Rescue a CentOS Linux system 8
  kernel centos8/vmlinuz
  append <span style="color: #a0522d;">initrd</span>=centos8/initrd.img
inst.repo=http://10.0.0.100/centos/8/os/x86_64/ rescue

label local
  menu default
  menu label Boot from ^local drive
  localboot 0xffff
</pre>
</div>

<p>
<b>6.5.8 测试客户端基于PXE实现自动安装</b>
</p>

<p>
新准备一台主机，设置网卡引导，可看到看启动菜单，并实现自动安装
</p>

<p>
注意：VMware workstation 对于不同的CentOS
版本，生成的虚拟机的硬件并不兼容
</p>


<figure id="orgb653c28">
<img src="images/image-20210122143404491.png" alt="image-20210122143404491.png">

</figure>


<figure id="org39b165f">
<img src="images/image-20210122143425770.png" alt="image-20210122143425770.png">

</figure>


<figure id="org7adfd44">
<img src="images/image-20210122143443239.png" alt="image-20210122143443239.png">

</figure>


<figure id="orga85e2f6">
<img src="images/image-20210122143456477.png" alt="image-20210122143456477.png">

</figure>


<figure id="orgbe1d20e">
<img src="images/image-20210122143512605.png" alt="image-20210122143512605.png">

</figure>


<figure id="org654aa8a">
<img src="images/image-20210122143521660.png" alt="image-20210122143521660.png">

</figure>


<figure id="orgc3380a9">
<img src="images/image-20210122143528254.png" alt="image-20210122143528254.png">

</figure>
</div>
</div>
</div>
</section>
<section id="outline-container-h:9bd0e18c-49a8-42c6-905e-7ddf60e9fc74" class="outline-2">
<h2 id="h:9bd0e18c-49a8-42c6-905e-7ddf60e9fc74">利用cobbler实现自动化安装</h2>
<div class="outline-text-2" id="text-h:9bd0e18c-49a8-42c6-905e-7ddf60e9fc74">
</div>
<div id="outline-container-h:846ee33b-1663-48cd-8282-339cffc02394" class="outline-3">
<h3 id="h:846ee33b-1663-48cd-8282-339cffc02394">1 Cobbler简介</h3>
<div class="outline-text-3" id="text-h:846ee33b-1663-48cd-8282-339cffc02394">
<ul class="org-ul">
<li>Cobbler是一款Linux生态的自动化运维工具，基于Python2开发，用于自动化
批量部署安装操作系统；其提供基于CLI的管理方式和WEB配置界面，其中WEB
配置界面是基于Python2和Django框架开发。另外，cobbler还提供了API，方
便二次开发。Cobbler属于C/S模型(客户端/服务器模型)</li>
<li>Cobbler主要用于快速网络安装linux操作系统，支持众多的Linux发行版如：Red
Hat、Fedora、CentOS、Debian、Ubuntu和SuSE等，甚至支持windows的安装</li>
<li>Cobbler实质是PXE的二次封装，将多种安装参数封装到一起，并提供统一的管理方法</li>
</ul>
</div>
</div>
<div id="outline-container-h:2224e0bc-3fed-4a1b-a528-2b6c463b77c9" class="outline-3">
<h3 id="h:2224e0bc-3fed-4a1b-a528-2b6c463b77c9">2 Cobbler的相关服务</h3>
<div class="outline-text-3" id="text-h:2224e0bc-3fed-4a1b-a528-2b6c463b77c9">
<ul class="org-ul">
<li>使用Cobbler安装系统需要一台专门提供各种服务的服务器，提供的服务包括
(HTTP/FTP/NFS,TFTP,DHCP),也可以将这几个服务分别部署到不同服务器。事
实上在实际应用中，总是将不同的服务分别部署到专门的服务器。</li>
<li>Cobbler是在HTTP、TFTP、DHCP等各种服务的基础上进行相关操作的，实际安
装的大体过程类似于基于PXE的网络安装:客户端(裸机)开机使用网卡引导启动，
其请求DHCP分配一个地址后从TFTP服务器获取启动文件,加载到客户端本地内
存中运行，并显示出可安装的系统列表；在人为的选定安装的操作系统类型后,客
服端会到HTTP服务器下载相应的系统安装文件并执行自动安装</li>
</ul>
</div>
</div>
<div id="outline-container-h:c910981f-0ea3-49eb-935d-d89655a9130d" class="outline-3">
<h3 id="h:c910981f-0ea3-49eb-935d-d89655a9130d">3 Cobbler的工作原理</h3>
<div class="outline-text-3" id="text-h:c910981f-0ea3-49eb-935d-d89655a9130d">

<figure id="org22f412d">
<img src="images/image-20210122163035806.png" alt="image-20210122163035806.png">

</figure>

<ul class="org-ul">
<li>client裸机配置了从网络启动后，开机后会广播包请求DHCP服务器（cobbler
server）发送其分配好的一个IP</li>
<li>DHCP服务器（cobbler server）收到请求后发送responese，包括其ip地址</li>
<li>client裸机拿到ip后再向cobbler server发送请求OS引导文件的请求</li>
<li>cobbler server告诉裸机OS引导文件的名字和TFTP server的ip和port</li>
<li>client裸机通过上面告知的TFTP server地址通信，下载引导文件</li>
<li>client裸机执行执行该引导文件，确定加载信息，选择要安装的os，期间会再向cobbler
server请求kickstart文件和os image</li>
<li>cobbler server发送请求的kickstart和os iamge</li>
<li>client裸机加载kickstart文件</li>
<li>client裸机接收os image，安装该os image</li>
</ul>
</div>
</div>
<div id="outline-container-h:67c359c0-d6aa-4df6-b455-276cf1384384" class="outline-3">
<h3 id="h:67c359c0-d6aa-4df6-b455-276cf1384384">4 安装Cobbler及其相关的服务和组件</h3>
<div class="outline-text-3" id="text-h:67c359c0-d6aa-4df6-b455-276cf1384384">
<p>
Cobbler所依赖的服务包括HTTPD,TFTP,DHCP等，如果有web界面要求，还需要安装相关的组件<br>
CentOS 8目前还没有提供Cobbler相关包
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#yum install dhcp cobbler cobbler-web pykickstart
[root@centos7 ~]#systemctl enable --now cobbler httpd tftp dhcpd
</pre>
</div>

<p>
相关包说明：
</p>

<ul class="org-ul">
<li>httpd：提供yum源，并配合cobbler-web使得cobbler可以通过web网页界面进行配置管理</li>
<li>tftp-server：提供启动和菜单等相关文件网络下载功能</li>
<li>cobbler-web : 提供基于web的cobbler管理界面</li>
<li>pykickstart.noarch : 基于python的管理kickstart文件的库</li>
</ul>

<p>
说明：
</p>

<ul class="org-ul">
<li>Cobbler依赖于epel源，在安装cobbler之前需要配置epel源</li>
<li>在安装cobbler时会自因为依赖而安装httpd,tftp-server相关包</li>
</ul>
</div>
</div>
<div id="outline-container-h:3e22b740-f396-4710-bef5-463b0a175a33" class="outline-3">
<h3 id="h:3e22b740-f396-4710-bef5-463b0a175a33">5 Cobbler配置文件及各目录情况</h3>
<div class="outline-text-3" id="text-h:3e22b740-f396-4710-bef5-463b0a175a33">
</div>
<div id="outline-container-h:f1c290da-6013-4cd2-99f5-2a3ce8826311" class="outline-4">
<h4 id="h:f1c290da-6013-4cd2-99f5-2a3ce8826311">5.1 配置文件</h4>
<div class="outline-text-4" id="text-h:f1c290da-6013-4cd2-99f5-2a3ce8826311">
<div class="org-src-container">
<pre class="src src-sh">/etc/cobbler/settings       <span style="color: #b22222;">#</span><span style="color: #b22222;">cobbler &#20027;&#37197;&#32622;&#25991;&#20214;</span>
/etc/cobbler/iso/         <span style="color: #b22222;">#</span><span style="color: #b22222;">iso&#27169;&#26495;&#37197;&#32622;&#25991;&#20214;</span>
/etc/cobbler/pxe        <span style="color: #b22222;">#</span><span style="color: #b22222;">pxe&#27169;&#26495;&#25991;&#20214;</span>
/etc/cobbler/power        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30005;&#28304;&#37197;&#32622;&#25991;&#20214;</span>
/etc/cobbler/user.conf      <span style="color: #b22222;">#</span><span style="color: #b22222;">web&#26381;&#21153;&#25480;&#26435;&#37197;&#32622;&#25991;&#20214;</span>
/etc/cobbler/users.digest     <span style="color: #b22222;">#</span><span style="color: #b22222;">web&#35775;&#38382;&#30340;&#29992;&#25143;&#21517;&#23494;&#30721;&#37197;&#32622;&#25991;&#20214;</span>
/etc/cobbler/dhcp.template    <span style="color: #b22222;">#</span><span style="color: #b22222;">dhcp&#26381;&#21153;&#22120;&#30340;&#30340;&#37197;&#32622;&#27169;&#26495;</span>
/etc/cobbler/dnsmasq.template   <span style="color: #b22222;">#</span><span style="color: #b22222;">dns&#26381;&#21153;&#22120;&#30340;&#37197;&#32622;&#27169;&#26495;</span>
/etc/cobbler/tftpd.template   <span style="color: #b22222;">#</span><span style="color: #b22222;">tftp&#26381;&#21153;&#30340;&#37197;&#32622;&#27169;&#26495;</span>
/etc/cobbler/modules.conf       <span style="color: #b22222;">#</span><span style="color: #b22222;">cobbler&#27169;&#22359;&#30340;&#37197;&#32622;&#25991;&#20214; </span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:2241da51-0e27-4fac-8dcb-357b4053aaa4" class="outline-4">
<h4 id="h:2241da51-0e27-4fac-8dcb-357b4053aaa4">5.2 数据目录</h4>
<div class="outline-text-4" id="text-h:2241da51-0e27-4fac-8dcb-357b4053aaa4">
<div class="org-src-container">
<pre class="src src-sh">/var/lib/cobbler/config/   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#20110;&#23384;&#25918;distros&#65292;system&#65292;profiles &#31561;&#20449;&#24687;&#30340;&#37197;&#32622;&#25991;&#20214;</span>
/var/lib/cobbler/triggers/   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#20110;&#23384;&#25918;&#29992;&#25143;&#23450;&#20041;&#30340;cobbler&#21629;&#20196;</span>
/var/lib/cobbler/kickstarts/ <span style="color: #b22222;"># </span><span style="color: #b22222;">&#40664;&#35748;&#23384;&#25918;kickstart&#25991;&#20214;</span>
/var/lib/cobbler/loaders/    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23384;&#25918;&#21508;&#31181;&#24341;&#23548;&#31243;&#24207;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:7f012b20-4f09-4620-8f52-567760f824f0" class="outline-4">
<h4 id="h:7f012b20-4f09-4620-8f52-567760f824f0">5.3 镜像目录</h4>
<div class="outline-text-4" id="text-h:7f012b20-4f09-4620-8f52-567760f824f0">
<div class="org-src-container">
<pre class="src src-sh">/var/www/cobbler/ks_mirror/   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23548;&#20837;&#30340;&#21457;&#34892;&#29256;&#31995;&#32479;&#30340;&#25152;&#26377;&#25968;&#25454;</span>
/var/www/cobbler/images/    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23548;&#20837;&#21457;&#34892;&#29256;kernel&#21644;initrd&#38236;&#20687;&#29992;&#20110;&#36828;&#31243;&#32593;&#32476;&#21551;&#21160;</span>
/var/www/cobbler/repo_mirror/   <span style="color: #b22222;">#</span><span style="color: #b22222;">yum &#20179;&#24211;&#23384;&#20648;&#30446;&#24405;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:cc8dcbdb-3b69-45f9-8b5c-6d6bcd51b895" class="outline-4">
<h4 id="h:cc8dcbdb-3b69-45f9-8b5c-6d6bcd51b895">5.4 日志目录</h4>
<div class="outline-text-4" id="text-h:cc8dcbdb-3b69-45f9-8b5c-6d6bcd51b895">
<div class="org-src-container">
<pre class="src src-sh">/var/log/cobbler/installing  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23458;&#25143;&#31471;&#23433;&#35013;&#26085;&#24535;</span>
/var/log/cobbler/cobbler.log <span style="color: #b22222;">#</span><span style="color: #b22222;">cobbler&#26085;&#24535;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:9a797a3f-944d-4806-9899-ea5943093313" class="outline-3">
<h3 id="h:9a797a3f-944d-4806-9899-ea5943093313">6 配置及启动cobblerd服务</h3>
<div class="outline-text-3" id="text-h:9a797a3f-944d-4806-9899-ea5943093313">
<p>
检测cobbler的运行环境,并根据提示逐步配置cobbler
</p>

<div class="org-src-container">
<pre class="src src-sh">cobbler check
The following are potential configuration items that you may want to fix:

1 : The <span style="color: #8b2252;">'server'</span> field<span style="color: #a020f0;"> in</span> /etc/cobbler/settings must be set to something other
than localhost, or kickstarting features will not work. This should be a
resolvable hostname or IP for the boot server as reachable by all machines that
will use it.
2 : For PXE to be functional, the <span style="color: #8b2252;">'next_server'</span> field<span style="color: #a020f0;"> in</span> /etc/cobbler/settings
must be set to something other than 127.0.0.1, and should match the IP of the
boot server on the PXE network.
3 : change <span style="color: #8b2252;">'disable'</span> to <span style="color: #8b2252;">'no'</span><span style="color: #a020f0;"> in</span> /etc/xinetd.d/tftp
4 : Some network boot-loaders are missing from /var/lib/cobbler/loaders, you may
run <span style="color: #8b2252;">'cobbler get-loaders'</span> to download them, or, if you only want to handle
x86/x86_64 netbooting, you may ensure that you have installed a *recent* version
of the syslinux package installed and can ignore this message entirely. Files
<span style="color: #a020f0;">in</span> this directory, should you want to support all architectures, should include
pxelinux.0, menu.c32, elilo.efi, and yaboot. The <span style="color: #8b2252;">'cobbler get-loaders'</span> command
is the easiest way to resolve these requirements.
5 : enable and start rsyncd.service with systemctl
6 : debmirror package is not installed, it will be required to manage debian
deployments and repositories
7 : ksvalidator was not found, install pykickstart
8 : The default password used by the sample templates for newly installed
<span style="color: #0000ff;">machines</span> (default_password_crypted<span style="color: #a020f0;"> in</span> /etc/cobbler/settings) is still set to
<span style="color: #8b2252;">'cobbler'</span> and should be changed, try: <span style="color: #8b2252;">"openssl passwd -1 -salt 'random-phrasehere' 'your-password-here'"</span> to generate new one
9 : fencing tools were not found, and are required to use the (optional) power
management features. install cman or fence-agents to use them

Restart cobblerd and then run <span style="color: #8b2252;">'cobbler sync'</span> to apply changes.

1.&#26356;&#25913;/etc/xinetd.d/tftp&#37197;&#32622;&#25991;&#20214;
vim /etc/xinetd.d/tftp
disable = yes --&gt; disable = no
systemctl restart xinetd
2.&#32852;&#32593;&#19979;&#36733;boot&#24341;&#23548;&#31243;&#24207;&#25991;&#20214;
cobbler get-loaders
3.&#27809;&#26377;&#32593;&#32476;&#24773;&#20917;&#19979;&#25335;&#36125;&#21551;&#21160;&#25991;&#20214;&#21040;TFTP&#26381;&#21153;&#25991;&#20214;&#22841;
cp -a /usr/share/syslinux/{pxelinux.0,menu.c32} /var/lib/tftpboot
4.&#26356;&#25913;/etc/cobbler/settings&#37197;&#32622;&#25991;&#20214;&#30340;server&#39033;&#20026;&#25552;&#20379;cobblerd&#26381;&#21153;&#30340;&#20027;&#26426;&#22320;&#22336;,&#20063;&#23601;&#26159;&#26412;&#26426;&#22320;&#22336;
sed -nri <span style="color: #8b2252;">'s#server:127.0.0.1#server:192.168.100.100#'</span> /etc/cobbler/settings
&#26356;&#25913;&#21518;&#30340;&#25972;&#34892;&#20869;&#23481;:server:192.168.100.100
5.&#26356;&#25913;/etc/cobbler/settings&#37197;&#32622;&#25991;&#20214;&#30340;next_server&#39033;&#65292;&#25351;&#26126;tftp&#26381;&#21153;&#22120;&#22320;&#22336;&#65292;&#20351;&#24471;&#23458;&#25143;&#31471;&#33021;&#22815;&#25214;&#21040;TFTP&#26381;&#21153;&#22120;
sed -i <span style="color: #8b2252;">'s/next_server: 127.0.0.1/next_server: 192.168.100.100/'</span> /etc/cobbler/settings
&#26356;&#25913;&#21518;&#30340;&#25972;&#34892;&#20869;&#23481;:next_server:192.168.100.100
6.&#37197;&#32622;&#30456;&#24212;&#30340;&#36873;&#39033;&#26469;&#20351;&#29992;cobbler&#31649;&#29702;dhcp&#26381;&#21153;&#21644;tftp&#26381;&#21153;
manage_dhcp&#65306;1
manage_tftpd&#65306;1
7.pxe_just_once&#36873;&#39033;&#65292;&#35813;&#36873;&#39033;&#32622;1&#34920;&#31034;&#22312;pxe&#23433;&#35013;&#22359;&#32467;&#26463;&#26102;&#22312;cobbler&#31995;&#32479;&#20013;&#20570;&#30456;&#24212;&#30340;&#35760;&#24405;&#65292;&#36825;&#26679;&#20250;&#36991;&#20813;
&#22914;&#26524;&#23458;&#25143;&#26426;&#30340;BIOS&#36873;&#39033;&#20013;PXE&#21551;&#21160;&#22788;&#20110;&#31532;&#19968;&#20301;&#23548;&#33268;&#30340;&#24490;&#29615;&#37325;&#21551;&#65307;&#22914;&#26524;&#31532;&#19968;&#20010;&#21551;&#21160;&#30828;&#20214;&#19981;&#26159;PXE&#21551;&#21160;&#37027;&#23601;&#32622;0&#12290;
pxe_just_once&#65306;1

&#37197;&#32622;&#23436;&#25104;&#21518;&#37325;&#21551;
systemctl restart cobblerd
</pre>
</div>
</div>
</div>
<div id="outline-container-h:e5800cf0-86ad-48c0-99cd-38fe6177a9ef" class="outline-3">
<h3 id="h:e5800cf0-86ad-48c0-99cd-38fe6177a9ef">7 cobbler命令用法</h3>
<div class="outline-text-3" id="text-h:e5800cf0-86ad-48c0-99cd-38fe6177a9ef">
<p>
可以使用下面的方式得到使用帮助
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@Centos7 ~]#cobbler
usage
=====
cobbler &lt;distro|profile|system|repo|image|mgmtclass|package|file&gt; ... 
        [add|edit|copy|getks*|list|remove|rename|report] [options|--help]
cobbler &lt;aclsetup|buildiso|import|list|replicate|report|reposync|sync|validateks|version|signature|get-loaders|hardlink&gt; [options|--help]

[root@centos7 ~]#cobbler distro --help
usage
=====
cobbler distro add
cobbler distro copy
cobbler distro edit
cobbler distro find
cobbler distro list
cobbler distro remove
cobbler distro rename
cobbler distro report

[root@Centos7 ~]#cobbler distro add --help
Usage: cobbler [options]

Options:
  -h, --help            show this help message and exit
  --name=NAME           Name (Ex: Fedora-11-i386)
  --ctime=CTIME         
  --mtime=MTIME         
  --uid=UID
...&#30465;&#30053;...
</pre>
</div>

<p>
常见用法：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#20986;&#24403;&#21069;&#23548;&#20837;&#30340;linux&#21457;&#34892;&#29256;&#26465;&#30446;</span>
cobbler distro list
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25253;&#21578;&#24403;&#21069;&#25152;&#26377;&#30340;linux&#21457;&#34892;&#29256;&#35814;&#32454;&#20449;&#24687;</span>
cobbler distro report

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23548;&#20837;&#31995;&#32479;&#28304;&#25991;&#20214;&#29983;&#25104;&#20179;&#24211;</span>
cobbler import --name=centos-8.0-x86_64 --path=/mnt --arch=x86_64

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;linux&#21457;&#34892;&#29256;&#31995;&#32479;&#38236;&#20687;&#19982;&#20854;&#23545;&#24212;&#30340;ks&#25991;&#20214;&#24314;&#31435;&#20851;&#32852;</span>
cobbler profile --name=centos7 --distro=centos7-x86_64 --
<span style="color: #a0522d;">kickstart</span>=/var/lib/cobbler/kickstarts/ks7.cfg
</pre>
</div>
</div>
</div>
<div id="outline-container-h:413ba53d-f098-4f57-bc3c-fca5dd01251e" class="outline-3">
<h3 id="h:413ba53d-f098-4f57-bc3c-fca5dd01251e">8 将linux发行版导入到cobbler在httpd服务的文件夹下</h3>
<div class="outline-text-3" id="text-h:413ba53d-f098-4f57-bc3c-fca5dd01251e">
<p>
cobbler将系统yum源文件存放在 /var/www/cobbler/ks_mirror目录下
</p>

<div class="org-src-container">
<pre class="src src-sh">cobbler import --name=centos6 --path=/var/www/html/centos/6/isos/x86_64/ --arch=x86_64
cobbler import --name=centos7 --path=/var/www/html/centos/7/isos/x86_64/ --arch=x86_64
cobbler import --name=centos8 --path=/var/www/html/centos/8/isos/x86_64/ --arch=x86_64
</pre>
</div>

<p>
导入后重启并同步
</p>

<div class="org-src-container">
<pre class="src src-sh">systemctl restart cobblerd
cobbler sync
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#du -sh /var/www/cobbler/ks_mirror/*
11G /var/www/cobbler/ks_mirror/centos-7.7-x86_64
7.2G /var/www/cobbler/ks_mirror/centos-8.1-x86_64
12K /var/www/cobbler/ks_mirror/config
</pre>
</div>
</div>
</div>
<div id="outline-container-h:1c59a9b5-5531-4013-87a6-09285faa2b44" class="outline-3">
<h3 id="h:1c59a9b5-5531-4013-87a6-09285faa2b44">9 配置linux发行版和关联相应的ks文件</h3>
<div class="outline-text-3" id="text-h:1c59a9b5-5531-4013-87a6-09285faa2b44">
<p>
拷贝事先准备好的ks文件至/var/lib/cobbler/kickstarts目录下
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#cp /var/www/html/ks/centos{6,7,8}.ks
/var/lib/cobbler/kickstarts
</pre>
</div>

<p>
将linux发行版系统镜像与其对应的ks文件建立关联
</p>

<div class="org-src-container">
<pre class="src src-sh">cobbler profile --name=centos6 --distro=centos6-x86_64 --kickstart=/var/lib/cobbler/kickstarts/centos6.cfg
cobbler profile --name=centos7 --distro=centos7-x86_64 --kickstart=/var/lib/cobbler/kickstarts/centos7.cfg
cobbler profile --name=centos8 --distro=centos8-x86_64 --kickstart=/var/lib/cobbler/kickstarts/centos8.cfg
</pre>
</div>

<p>
注意，在导入distro时，cobbler会自动生成distro条目，这些并未和ks文件关联，可以使用
</p>

<div class="org-src-container">
<pre class="src src-sh">cobbler profile remove --name=PROFILE_NAME
</pre>
</div>

<p>
删除后，再关联ks文件。
</p>

<p>
建立关联后重启并同步
</p>

<div class="org-src-container">
<pre class="src src-sh">systemctl restart cobblerd
cobbler sync
</pre>
</div>

<p>
查看详细信息
</p>

<div class="org-src-container">
<pre class="src src-sh">cobbler report
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@Centos7 ~]#cobbler report
distros:
==========
Name                           : centos-8.1-x86_64
Architecture                   : x86_64
TFTP Boot Files                : {}
Breed                          : redhat
Comment                        : 
Fetchable Files                : {}
Initrd                         : /var/www/cobbler/ks_mirror/centos-8.1-x86_64/images/pxeboot/initrd.img
Kernel                         : /var/www/cobbler/ks_mirror/centos-8.1-x86_64/images/pxeboot/vmlinuz
Kernel Options                 : {}
Kernel Options (Post Install)  : {}
Kickstart Metadata             : {<span style="color: #8b2252;">'tree'</span>: <span style="color: #8b2252;">'http://@@http_server@@/cblr/links/centos-8.1-x86_64'</span>}
Management Classes             : []
OS Version                     : rhel8
Owners                         : [<span style="color: #8b2252;">'admin'</span>]
Red Hat Management Key         : &lt;&lt;inherit&gt;&gt;
<span style="color: #ffa54f;">Red Hat Management Server      : &lt;&lt;inherit&gt;&gt;</span>
<span style="color: #ffa54f;">Template Files                 : {}</span>

<span style="color: #ffa54f;">Name                           : centos-6.10-x86_64</span>
<span style="color: #ffa54f;">Architecture                   : x86_64</span>
<span style="color: #ffa54f;">TFTP Boot Files                : {}</span>
<span style="color: #ffa54f;">Breed                          : redhat</span>
<span style="color: #ffa54f;">Comment                        : </span>
<span style="color: #ffa54f;">Fetchable Files                : {}</span>
<span style="color: #ffa54f;">Initrd                         : /var/www/cobbler/ks_mirror/centos-6.10-x86_64/images/pxeboot/initrd.img</span>
<span style="color: #ffa54f;">Kernel                         : /var/www/cobbler/ks_mirror/centos-6.10-x86_64/images/pxeboot/vmlinuz</span>
<span style="color: #ffa54f;">Kernel Options                 : {}</span>
<span style="color: #ffa54f;">Kernel Options (Post Install)  : {}</span>
<span style="color: #ffa54f;">Kickstart Metadata             : {'tree': 'http://@@http_server@@/cblr/links/centos-6.10-x86_64'}</span>
<span style="color: #ffa54f;">Management Classes             : []</span>
<span style="color: #ffa54f;">OS Version                     : rhel6</span>
<span style="color: #ffa54f;">Owners                         : ['admin']</span>
<span style="color: #ffa54f;">Red Hat Management Key         : &lt;&lt;inherit&gt;&gt;</span>
<span style="color: #ffa54f;">Red Hat Management Server      : &lt;&lt;inherit&gt;&gt;</span>
<span style="color: #ffa54f;">Template Files                 : {}</span>


<span style="color: #ffa54f;">profiles:</span>
<span style="color: #ffa54f;">==========</span>
<span style="color: #ffa54f;">Name                           : CentOS-8.1_test</span>
<span style="color: #ffa54f;">TFTP Boot Files                : {}</span>
<span style="color: #ffa54f;">Comment                        : </span>
<span style="color: #ffa54f;">DHCP Tag                       : default</span>
<span style="color: #ffa54f;">Distribution                   : CentOS-8.1-x86_64</span>
<span style="color: #ffa54f;">Enable gPXE?                   : 0</span>
<span style="color: #ffa54f;">Enable PXE Menu?               : 1</span>
<span style="color: #ffa54f;">Fetchable Files                : {}</span>
<span style="color: #ffa54f;">Kernel Options                 : {}</span>
<span style="color: #ffa54f;">Kernel Options (Post Install)  : {}</span>
<span style="color: #ffa54f;">Kickstart                      : /var/lib/cobbler/kickstarts/centos8.cfg</span>
<span style="color: #ffa54f;">Kickstart Metadata             : {}</span>
<span style="color: #ffa54f;">Management Classes             : []</span>
<span style="color: #ffa54f;">Management Parameters          : &lt;&lt;inherit&gt;&gt;</span>
<span style="color: #ffa54f;">Name Servers                   : []</span>
<span style="color: #ffa54f;">Name Servers Search Path       : []</span>
<span style="color: #ffa54f;">Owners                         : ['admin']</span>
<span style="color: #ffa54f;">Parent Profile                 : </span>
<span style="color: #ffa54f;">Internal proxy                 : </span>
<span style="color: #ffa54f;">Red Hat Management Key         : &lt;&lt;inherit&gt;&gt;</span>
<span style="color: #ffa54f;">Red Hat Management Server      : &lt;&lt;inherit&gt;&gt;</span>
<span style="color: #ffa54f;">Repos                          : []</span>
<span style="color: #ffa54f;">Server Override                : &lt;&lt;inherit&gt;&gt;</span>
<span style="color: #ffa54f;">Template Files                 : {}</span>
<span style="color: #ffa54f;">Virt Auto Boot                 : 1</span>
<span style="color: #ffa54f;">Virt Bridge                    : xenbr0</span>
<span style="color: #ffa54f;">Virt CPUs                      : 1</span>
<span style="color: #ffa54f;">Virt Disk Driver Type          : raw</span>
<span style="color: #ffa54f;">Virt File Size(GB)             : 5</span>
<span style="color: #ffa54f;">Virt Path                      : </span>
<span style="color: #ffa54f;">Virt RAM (MB)                  : 512</span>
<span style="color: #ffa54f;">Virt Type                      : xenpv</span>

<span style="color: #ffa54f;">Name                           : centos-8.1-x86_64</span>
<span style="color: #ffa54f;">TFTP Boot Files                : {}</span>
<span style="color: #ffa54f;">Comment                        : </span>
<span style="color: #ffa54f;">DHCP Tag                       : default</span>
<span style="color: #ffa54f;">Distribution                   : centos-8.1-x86_64</span>
<span style="color: #ffa54f;">Enable gPXE?                   : 0</span>
<span style="color: #ffa54f;">Enable PXE Menu?               : 1</span>
<span style="color: #ffa54f;">Fetchable Files                : {}</span>
<span style="color: #ffa54f;">Kernel Options                 : {}</span>
<span style="color: #ffa54f;">Kernel Options (Post Install)  : {}</span>
<span style="color: #ffa54f;">Kickstart                      : /var/lib/cobbler/kickstarts/sample_end.ks</span>
<span style="color: #ffa54f;">Kickstart Metadata             : {}</span>
<span style="color: #ffa54f;">Management Classes             : []</span>
<span style="color: #ffa54f;">Management Parameters          : &lt;&lt;inherit&gt;&gt;</span>
<span style="color: #ffa54f;">Name Servers                   : []</span>
<span style="color: #ffa54f;">Name Servers Search Path       : []</span>
<span style="color: #ffa54f;">Owners                         : ['admin']</span>
<span style="color: #ffa54f;">Parent Profile                 : </span>
<span style="color: #ffa54f;">Internal proxy                 : </span>
<span style="color: #ffa54f;">Red Hat Management Key         : &lt;&lt;inherit&gt;&gt;</span>
<span style="color: #ffa54f;">Red Hat Management Server      : &lt;&lt;inherit&gt;&gt;</span>
<span style="color: #ffa54f;">Repos                          : []</span>
<span style="color: #ffa54f;">Server Override                : &lt;&lt;inherit&gt;&gt;</span>
<span style="color: #ffa54f;">Template Files                 : {}</span>
<span style="color: #ffa54f;">Virt Auto Boot                 : 1</span>
<span style="color: #ffa54f;">Virt Bridge                    : xenbr0</span>
<span style="color: #ffa54f;">Virt CPUs                      : 1</span>
<span style="color: #ffa54f;">Virt Disk Driver Type          : raw</span>
<span style="color: #ffa54f;">Virt File Size(GB)             : 5</span>
<span style="color: #ffa54f;">Virt Path                      : </span>
<span style="color: #ffa54f;">Virt RAM (MB)                  : 512</span>
<span style="color: #ffa54f;">Virt Type                      : kvm</span>

<span style="color: #ffa54f;">Name                           : centos-6.10-x86_64</span>
<span style="color: #ffa54f;">TFTP Boot Files                : {}</span>
<span style="color: #ffa54f;">Comment                        : </span>
<span style="color: #ffa54f;">DHCP Tag                       : default</span>
<span style="color: #ffa54f;">Distribution                   : centos-6.10-x86_64</span>
<span style="color: #ffa54f;">Enable gPXE?                   : 0</span>
<span style="color: #ffa54f;">Enable PXE Menu?               : 1</span>
<span style="color: #ffa54f;">Fetchable Files                : {}</span>
<span style="color: #ffa54f;">Kernel Options                 : {}</span>
<span style="color: #ffa54f;">Kernel Options (Post Install)  : {}</span>
<span style="color: #ffa54f;">Kickstart                      : /var/lib/cobbler/kickstarts/sample_end.ks</span>
<span style="color: #ffa54f;">Kickstart Metadata             : {}</span>
<span style="color: #ffa54f;">Management Classes             : []</span>
<span style="color: #ffa54f;">Management Parameters          : &lt;&lt;inherit&gt;&gt;</span>
<span style="color: #ffa54f;">Name Servers                   : []</span>
<span style="color: #ffa54f;">Name Servers Search Path       : []</span>
<span style="color: #ffa54f;">Owners                         : ['admin']</span>
<span style="color: #ffa54f;">Parent Profile                 : </span>
<span style="color: #ffa54f;">Internal proxy                 : </span>
<span style="color: #ffa54f;">Red Hat Management Key         : &lt;&lt;inherit&gt;&gt;</span>
<span style="color: #ffa54f;">Red Hat Management Server      : &lt;&lt;inherit&gt;&gt;</span>
<span style="color: #ffa54f;">Repos                          : []</span>
<span style="color: #ffa54f;">Server Override                : &lt;&lt;inherit&gt;&gt;</span>
<span style="color: #ffa54f;">Template Files                 : {}</span>
<span style="color: #ffa54f;">Virt Auto Boot                 : 1</span>
<span style="color: #ffa54f;">Virt Bridge                    : xenbr0</span>
<span style="color: #ffa54f;">Virt CPUs                      : 1</span>
<span style="color: #ffa54f;">Virt Disk Driver Type          : raw</span>
<span style="color: #ffa54f;">Virt File Size(GB)             : 5</span>
<span style="color: #ffa54f;">Virt Path                      : </span>
<span style="color: #ffa54f;">Virt RAM (MB)                  : 512</span>
<span style="color: #ffa54f;">Virt Type                      : kvm</span>


<span style="color: #ffa54f;">systems:</span>
<span style="color: #ffa54f;">==========</span>

<span style="color: #ffa54f;">repos:</span>
<span style="color: #ffa54f;">==========</span>

<span style="color: #ffa54f;">images:</span>
<span style="color: #ffa54f;">==========</span>

<span style="color: #ffa54f;">mgmtclasses:</span>
<span style="color: #ffa54f;">==========</span>

<span style="color: #ffa54f;">packages:</span>
<span style="color: #ffa54f;">==========</span>

<span style="color: #ffa54f;">files:</span>
<span style="color: #ffa54f;">==========</span>
</pre>
</div>

<p>
上面信息中有一行如下：
</p>

<div class="org-src-container">
<pre class="src src-sh">Kickstart Metadata      :  {<span style="color: #8b2252;">'tree'</span>:<span style="color: #8b2252;">'http://@@http_server@@/cblr/links/centos-8.1-x86_64'</span>}
</pre>
</div>

<p>
该行的定义在文件/var/www/cobbler/ks_mirror/config/centos8-x86_64.repo
中是cobbler自己定义安装源路径的特有语法规定的，因此可以在ks文件中指定
安装源时直接指定为$tree变量。
</p>

<div class="org-src-container">
<pre class="src src-sh">url --url=$<span style="color: #a0522d;">tree</span>
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#vim /var/www/cobbler/ks_mirror/config/centos8-x86_64.repo
[core-0]
<span style="color: #a0522d;">name</span>=core-0
<span style="color: #a0522d;">baseurl</span>=http://@@http_server@@/cobbler/ks_mirror/centos8-x86_64/AppStream
<span style="color: #a0522d;">enabled</span>=1
<span style="color: #a0522d;">gpgcheck</span>=0
<span style="color: #a0522d;">priority</span>=$<span style="color: #a0522d;">yum_distro_priority</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:0abb53cc-5e08-4708-816d-57f3279d0fe7" class="outline-3">
<h3 id="h:0abb53cc-5e08-4708-816d-57f3279d0fe7">10 启动菜单优化</h3>
<div class="outline-text-3" id="text-h:0abb53cc-5e08-4708-816d-57f3279d0fe7">
<p>
修改/etc/cobbler/pxe/pxedefault.template模板文件，重启同步
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@Centos7 ~]#vim /etc/cobbler/pxe/pxedefault.template
DEFAULT menu
PROMPT 0
MENU TITLE Cobbler | http://www.cuiqinghe.com/   <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33258;&#23450;&#20041;&#39033;</span>
TIMEOUT 200
TOTALTIMEOUT 6000
ONTIMEOUT $<span style="color: #a0522d;">pxe_timeout_profile</span>

LABEL local
        MENU LABEL (<span style="color: #483d8b;">local</span>)   <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33258;&#23450;&#20041;&#39033;1</span>
        MENU DEFAULT
        LOCALBOOT -1

$<span style="color: #a0522d;">pxe_menu_items</span>

MENU end
[root@centos7 ~]#systemctl restart cobblerd
[root@centos7 ~]#cobbler sync
</pre>
</div>

<p>
重启同步后cobbler更新文件/var/lib/tftpboot/pxelinux.cfg/default
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#vim /var/lib/tftpboot/pxelinux.cfg/default
DEFAULT menu
PROMPT 0
MENU TITLE Welcome! | www.cicin.com
TIMEOUT 200
TOTALTIMEOUT 6000
ONTIMEOUT local

LABEL local
    MENU LABEL (<span style="color: #483d8b;">local</span> installation)
    MENU DEFAULT
    LOCALBOOT -1
LABEL Install_centos6
    kernel /images/centos6-x86_64/vmlinuz
    MENU LABEL Install_centos6
    append <span style="color: #a0522d;">initrd</span>=/images/centos6-x86_64/initrd.img <span style="color: #a0522d;">ksdevice</span>=bootif <span style="color: #a0522d;">lang</span>=
kssendmac text <span style="color: #a0522d;">ks</span>=http://192.168.100.100/cblr/svc/op/ks/profile/Install_centos6
    ipappend 2

LABEL Install_centos7
    kernel /images/centos7-x86_64/vmlinuz
    MENU LABEL Install_centos7
    append <span style="color: #a0522d;">initrd</span>=/images/centos7-x86_64/initrd.img <span style="color: #a0522d;">ksdevice</span>=bootif <span style="color: #a0522d;">lang</span>=
kssendmac text <span style="color: #a0522d;">ks</span>=http://192.168.100.100/cblr/svc/op/ks/profile/Install_centos7
    ipappend 2

LABEL Install_centos8
    kernel /images/centos8-x86_64/vmlinuz
    MENU LABEL Install_centos8
    append <span style="color: #a0522d;">initrd</span>=/images/centos8-x86_64/initrd.img <span style="color: #a0522d;">ksdevice</span>=bootif <span style="color: #a0522d;">lang</span>=
kssendmac text <span style="color: #a0522d;">ks</span>=http://192.168.100.100/cblr/svc/op/ks/profile/Install_centos8
    ipappend 2
MENU end
</pre>
</div>
</div>
</div>
<div id="outline-container-h:49f6ab7b-7fc5-4168-9223-b31900303ee7" class="outline-3">
<h3 id="h:49f6ab7b-7fc5-4168-9223-b31900303ee7">11 基于web界面来管理配置cobbler</h3>
<div class="outline-text-3" id="text-h:49f6ab7b-7fc5-4168-9223-b31900303ee7">
</div>
<div id="outline-container-h:a1b4da20-e469-48cb-bdd4-38bf3771e981" class="outline-4">
<h4 id="h:a1b4da20-e469-48cb-bdd4-38bf3771e981">11.1 安装cobbler-web</h4>
<div class="outline-text-4" id="text-h:a1b4da20-e469-48cb-bdd4-38bf3771e981">
<div class="org-src-container">
<pre class="src src-sh">yum install cobbler-web<span style="color: #ff00ff;">`</span>
<span style="color: #ff00ff;">systemctl restart httpd</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:85975a46-85e3-4f01-b7e4-57c1bcbe3507" class="outline-4">
<h4 id="h:85975a46-85e3-4f01-b7e4-57c1bcbe3507">11.2 访问web界面</h4>
<div class="outline-text-4" id="text-h:85975a46-85e3-4f01-b7e4-57c1bcbe3507">
<p>
用浏览器访问：<a href="https://cobblerserver/cobbler_web">https://cobblerserver/cobbler_web</a>
</p>

<p>
cobbler-web界面的默认账号，用户名：cobbler 密码:cobbler
</p>

<p>
cobbler访问图示
</p>


<figure id="org997189f">
<img src="images/image-20210122163721339.png" alt="image-20210122163721339.png">

</figure>


<figure id="org295ee3b">
<img src="images/image-20210122163744513.png" alt="image-20210122163744513.png">

</figure>


<figure id="org58576d9">
<img src="images/image-20210122163809074.png" alt="image-20210122163809074.png">

</figure>


<figure id="org605eb50">
<img src="images/image-20210122163835033.png" alt="image-20210122163835033.png">

</figure>

<p>
默认账户密码都是:cobbler
</p>
</div>
</div>
<div id="outline-container-h:42523b01-08ea-45d4-82de-3c373a9b8a02" class="outline-4">
<h4 id="h:42523b01-08ea-45d4-82de-3c373a9b8a02">11.3 WEB的登录认证方式</h4>
<div class="outline-text-4" id="text-h:42523b01-08ea-45d4-82de-3c373a9b8a02">
<p>
认证方法配置文件：/etc/cobbler/modules.conf
</p>

<p>
支持多种认证方法：
</p>

<ul class="org-ul">
<li>authn_configfile，此为默认的认证方法</li>
<li>authn_pam</li>
</ul>

<p>
<b>使用authn_configfile模块认证cobbler_web用户</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">vim /etc/cobbler/modules.conf
[authentication]
<span style="color: #a0522d;">module</span>=authn_configfile
</pre>
</div>

<p>
创建其认证文件/etc/cobbler/users.digest，并添加所需的用户
</p>

<div class="org-src-container">
<pre class="src src-sh">htdigest -c /etc/cobbler/users.digest Cobbler admin
</pre>
</div>

<p>
使用已有用户文件，在其中添加新用户
</p>

<div class="org-src-container">
<pre class="src src-sh">htdigest /etc/cobbler/users.digest Cobbler admin2
</pre>
</div>

<p>
注意：
</p>

<ul class="org-ul">
<li>使用“-c”选项用于创建用户文件，如果文件已存在，将覆盖原文件</li>
<li>cobbler_web的realm只能为Cobbler</li>
</ul>

<p>
<b>使用authn_pam模块认证cobbler_web用户</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">vim /etc/cobbler/modules.conf
[authentication]
module = authn_pam

systemctl restart cobblerd
</pre>
</div>

<p>
创建cobbler用户：
</p>

<div class="org-src-container">
<pre class="src src-sh">useradd -s /sbin/nologin cobbleruser
<span style="color: #483d8b;">echo</span> me | passwd --stdin cobbleruser
vim /etc/cobbler/users.conf
[admins]
admin = <span style="color: #8b2252;">"cobbleruser"</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:2b24fa7f-4f89-4c73-9902-45b43ebd69c0" class="outline-3">
<h3 id="h:2b24fa7f-4f89-4c73-9902-45b43ebd69c0">12 Trouble Shooting</h3>
<div class="outline-text-3" id="text-h:2b24fa7f-4f89-4c73-9902-45b43ebd69c0">
</div>
<div id="outline-container-h:241e2c1d-6ae2-485d-9a77-d44e868097ef" class="outline-4">
<h4 id="h:241e2c1d-6ae2-485d-9a77-d44e868097ef">12.1 故障1</h4>
<div class="outline-text-4" id="text-h:241e2c1d-6ae2-485d-9a77-d44e868097ef">

<figure id="orgd0d4fef">
<img src="images/image-20210122163858789.png" alt="image-20210122163858789.png">

</figure>

<p>
这种情况是ks文件中的安装源路径出错,改为如下：
</p>

<pre class="example" id="orge7cbf35">
centos6: url \--url=http://httpserver/ksdir/ks.cfg 或者 url \--url=$tree
centos7: url \--url=http://httpserver/ksdir/ks.cfg 或者 url \--url=$tree
centos8: url \--url=http://httpserver/ksdir/ks.cfg 或者 url \--url=$tree
</pre>
</div>
</div>
<div id="outline-container-h:26742ff5-5406-4f7b-8225-84014a73649d" class="outline-4">
<h4 id="h:26742ff5-5406-4f7b-8225-84014a73649d">12.2 故障2</h4>
<div class="outline-text-4" id="text-h:26742ff5-5406-4f7b-8225-84014a73649d">

<figure id="org173c923">
<img src="images/image-20210122163924515.png" alt="image-20210122163924515.png">

</figure>

<p>
这种情况是因为在安装配置cobbler时httpd服务一直在运行中，没有正确的为cobbler提供服务，因此重启httpd服务就ok了systemctl restart httpd
</p>
</div>
</div>
<div id="outline-container-h:0a8f2722-277a-4e21-b12c-369805f89287" class="outline-4">
<h4 id="h:0a8f2722-277a-4e21-b12c-369805f89287">12.3 故障3</h4>
<div class="outline-text-4" id="text-h:0a8f2722-277a-4e21-b12c-369805f89287">
<p>
httpd服务运行中安装cobbler-web包后无法访问<a href="https://cobblerserver/cobbler-web">https://cobblerserver/cobbler-web</a>管理界面
</p>

<p>
yum源更新后的Django版本和cobbler不兼容，更新cobbler
2.8.5新版后，此故障已修复
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#25552;&#31034;&#22914;&#26524;&#26080;&#27861;&#25171;&#24320;web&#39029;&#38754;&#65292;&#21487;&#20197;&#25191;&#34892;&#38754;&#25805;&#20316;</span>
[root@centos7 ~]#yum install python2-pip
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#25351;&#23450;&#29256;&#26412;&#30340;Django</span>
[root@centos7 ~]#pip install <span style="color: #a0522d;">Django</span>==1.8.17
[root@centos7 ~]#systemctl restart httpd
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:6f9c7473-9754-4873-83f5-5e0eb0513b83" class="outline-3">
<h3 id="h:6f9c7473-9754-4873-83f5-5e0eb0513b83">13 实战案例：CentOS 7 基于cobbler实现系统的自动化安装</h3>
<div class="outline-text-3" id="text-h:6f9c7473-9754-4873-83f5-5e0eb0513b83">
</div>
<div id="outline-container-h:bde958da-d25a-47a2-9286-e1ee278a72af" class="outline-4">
<h4 id="h:bde958da-d25a-47a2-9286-e1ee278a72af">13.1 环境准备</h4>
<div class="outline-text-4" id="text-h:bde958da-d25a-47a2-9286-e1ee278a72af">
<p>
两台主机
</p>

<p>
一台主机：CentOS 7 充当 Cobbler，http，dhcp，tftp服务器，并关闭防火墙和SELinux
</p>

<p>
一台主机：充当测试机，用于实现自动化安装Linux系统
</p>

<p>
网络要求：关闭Vmware软件中的NAT模式中的DHCP服务，两个主机网卡基于NAT模式
</p>
</div>
</div>
<div id="outline-container-h:d709cba2-c95f-48fa-8573-5a2c42d21e9a" class="outline-4">
<h4 id="h:d709cba2-c95f-48fa-8573-5a2c42d21e9a">13.2 安装相关包并启动服务</h4>
<div class="outline-text-4" id="text-h:d709cba2-c95f-48fa-8573-5a2c42d21e9a">
<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#yum install cobbler dhcp -y
[root@centos7 ~]#systemctl enable --now cobblerd httpd tftp dhcpd
</pre>
</div>
</div>
</div>
<div id="outline-container-h:12d669b7-19e8-4280-a13e-2878e80fbe98" class="outline-4">
<h4 id="h:12d669b7-19e8-4280-a13e-2878e80fbe98">13.3 修改cobbler相关的配置</h4>
<div class="outline-text-4" id="text-h:12d669b7-19e8-4280-a13e-2878e80fbe98">
<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#cobbler check
The following are potential configuration items that you may want to fix:

1 : The <span style="color: #8b2252;">'server'</span> field<span style="color: #a020f0;"> in</span> /etc/cobbler/settings must be set to something other
than localhost, or kickstarting features will not work. This should be a
resolvable hostname or IP for the boot server as reachable by all machines that
will use it.
2 : For PXE to be functional, the <span style="color: #8b2252;">'next_server'</span> field<span style="color: #a020f0;"> in</span> /etc/cobbler/settings
must be set to something other than 127.0.0.1, and should match the IP of the
boot server on the PXE network.
3 : change <span style="color: #8b2252;">'disable'</span> to <span style="color: #8b2252;">'no'</span><span style="color: #a020f0;"> in</span> /etc/xinetd.d/tftp
4 : Some network boot-loaders are missing from /var/lib/cobbler/loaders, you may
run <span style="color: #8b2252;">'cobbler get-loaders'</span> to download them, or, if you only want to handle
x86/x86_64 netbooting, you may ensure that you have installed a *recent* version
of the syslinux package installed and can ignore this message entirely. Files
<span style="color: #a020f0;">in</span> this directory, should you want to support all architectures, should include
pxelinux.0, menu.c32, elilo.efi, and yaboot. The <span style="color: #8b2252;">'cobbler get-loaders'</span> command
is the easiest way to resolve these requirements.
5 : enable and start rsyncd.service with systemctl
6 : debmirror package is not installed, it will be required to manage debian
deployments and repositories
7 : ksvalidator was not found, install pykickstart
8 : The default password used by the sample templates for newly installed
<span style="color: #0000ff;">machines</span> (default_password_crypted<span style="color: #a020f0;"> in</span> /etc/cobbler/settings) is still set to
<span style="color: #8b2252;">'cobbler'</span> and should be changed, try: <span style="color: #8b2252;">"openssl passwd -1 -salt 'random-phrasehere' 'your-password-here'"</span> to generate new one
9 : fencing tools were not found, and are required to use the (optional) power
management features. install cman or fence-agents to use them

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#26032;&#23494;&#30721;&#65292;&#40664;&#35748;&#23433;&#35013;&#22909;&#30340;&#31995;&#32479;root&#23494;&#30721;&#20026;cobbler</span>
[root@centos7 ~]#openssl passwd -1 <span style="color: #8b2252;">'me'</span>
$<span style="color: #a0522d;">1</span>$<span style="color: #a0522d;">1</span>spuisnh$<span style="color: #a0522d;">j34LNmyTQWs3l6xKxCZY60</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26681;&#25454;&#20197;&#19978;&#25552;&#31034;&#65292;&#21482;&#38656;&#35201;&#20570;1&#65292;2&#65292;8&#36825;&#19977;&#39033;&#21363;&#21487;&#65292;&#20462;&#25913;&#19979;&#38754;&#22235;&#34892;</span>
[root@centos7 ~]#vim /etc/cobbler/settings
default_password_crypted: <span style="color: #8b2252;">"$1$1spuisnh$j34LNmyTQWs3l6xKxCZY60"</span>
next_server&#65306;&lt; tftp&#26381;&#21153;&#22120;&#30340; IP &#22320;&#22336;&gt;
server&#65306;&lt;cobbler&#26381;&#21153;&#22120;&#30340; IP &#22320;&#22336;&gt;
manage_dhcp&#65306;1 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622;&#20026;1&#65292;&#34920;&#31034;&#36890;&#36807;cobbler&#29983;&#25104;dhcpd.conf&#37197;&#32622;&#25991;&#20214;</span>

[root@centos7 ~]#systemctl restart cobblerd
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d0a8b869-d191-4d90-af58-49e534e868eb" class="outline-4">
<h4 id="h:d0a8b869-d191-4d90-af58-49e534e868eb">13.4 实现dhcp服务</h4>
<div class="outline-text-4" id="text-h:d0a8b869-d191-4d90-af58-49e534e868eb">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;dhcp&#30340;&#27169;&#29256;&#25991;&#20214;&#19979;&#38754;&#30340;&#34892;&#65292;&#29992;&#26469;&#29983;&#25104;dhcp&#30340;&#37197;&#32622;&#25991;&#20214;</span>
[root@centos7 ~]#vim /etc/cobbler/dhcp.template
subnet 192.168.100.0 netmask 255.255.255.0 {
  option routers        192.168.100.1;
  option domain-name-servers  180.76.76.76,223.6.6.6;
  option subnet-mask      255.255.255.0;
  range dynamic-bootp     192.168.100.1 192.168.100.200;

[root@centos7 ~]#cobbler sync
[root@centos7 ~]#systemctl start dhcpd
</pre>
</div>
</div>
</div>
<div id="outline-container-h:74b1cba7-cc2c-4fbf-84a1-6a3354ee0569" class="outline-4">
<h4 id="h:74b1cba7-cc2c-4fbf-84a1-6a3354ee0569">13.5 下载启动的相关文件</h4>
<div class="outline-text-4" id="text-h:74b1cba7-cc2c-4fbf-84a1-6a3354ee0569">
<p>
#+begin_src sh
[root@centos7 ~]#cobbler get-loaders
task started: 2020-02-10_163111_get_loaders
task started (id=Download Bootloader Content, time=Mon Feb 10 16:31:11 2020)
downloading <a href="https://cobbler.github.io/loaders/README">https://cobbler.github.io/loaders/README</a> to /var/lib/cobbler/loaders/README
downloading <a href="https://cobbler.github.io/loaders/COPYING.elilo">https://cobbler.github.io/loaders/COPYING.elilo</a> to /var/lib/cobbler/loaders/COPYING.elilo
downloading <a href="https://cobbler.github.io/loaders/COPYING.yaboot">https://cobbler.github.io/loaders/COPYING.yaboot</a> to /var/lib/cobbler/loaders/COPYING.yaboot
downloading <a href="https://cobbler.github.io/loaders/COPYING.syslinux">https://cobbler.github.io/loaders/COPYING.syslinux</a> to /var/lib/cobbler/loaders/COPYING.syslinux
downloading <a href="https://cobbler.github.io/loaders/elilo-3.8-ia64.efi">https://cobbler.github.io/loaders/elilo-3.8-ia64.efi</a> to
/var/lib/cobbler/loaders/elilo-ia64.efi
downloading <a href="https://cobbler.github.io/loaders/yaboot-1.3.17">https://cobbler.github.io/loaders/yaboot-1.3.17</a> to
/var/lib/cobbler/loaders/yaboot
downloading <a href="https://cobbler.github.io/loaders/pxelinux.0-3.86">https://cobbler.github.io/loaders/pxelinux.0-3.86</a> to
/var/lib/cobbler/loaders/pxelinux.0
downloading <a href="https://cobbler.github.io/loaders/menu.c32-3.86">https://cobbler.github.io/loaders/menu.c32-3.86</a> to
/var/lib/cobbler/loaders/menu.c32
downloading <a href="https://cobbler.github.io/loaders/grub-0.97-x86.efi">https://cobbler.github.io/loaders/grub-0.97-x86.efi</a> to
/var/lib/cobbler/loaders/grub-x86.efi
downloading <a href="https://cobbler.github.io/loaders/grub-0.97-x86_64.efi">https://cobbler.github.io/loaders/grub-0.97-x86_64.efi</a> to
/var/lib/cobbler/loaders/grub-x86_64.efi
</p>
</div>
</div>
</div>
</section>
<section id="outline-container-h:8dd009d5-7057-45e1-94e2-9e78c0ec2c3e" class="outline-2">
<h2 id="h:8dd009d5-7057-45e1-94e2-9e78c0ec2c3e">TASK COMPLETE <b>*</b></h2>
<div class="outline-text-2" id="text-h:8dd009d5-7057-45e1-94e2-9e78c0ec2c3e">
<p>
[root@centos7 ~]#ls /var/lib/cobbler/loaders
COPYING.elilo COPYING.yaboot grub-x86_64.efi menu.c32 README
COPYING.syslinux elilo-ia64.efi grub-x86.efi pxelinux.0 yaboot
</p>

<p>
[root@centos7 ~]#tree <i>var/lib/tftpboot</i>
<i>var/lib/tftpboot</i>
├── boot
├── etc
├── grub
├── images
├── images2
├── ppc
├── pxelinux.cfg
└── s390x
</p>

<p>
8 directories, 0 files
[root@centos7 ~]#cobbler sync
task started: 2020-02-10_163219_sync
task started (id=Sync, time=Mon Feb 10 16:32:19 2020)
running pre-sync triggers
cleaning trees
removing: /var/lib/tftpboot/grub/images
copying bootloaders
trying hardlink /var/lib/cobbler/loaders/pxelinux.0 -&gt;
/var/lib/tftpboot/pxelinux.0
trying hardlink /var/lib/cobbler/loaders/menu.c32 -&gt; /var/lib/tftpboot/menu.c32
trying hardlink /var/lib/cobbler/loaders/yaboot -&gt; /var/lib/tftpboot/yaboot
trying hardlink /usr/share/syslinux/memdisk -&gt; /var/lib/tftpboot/memdisk
trying hardlink /var/lib/cobbler/loaders/grub-x86.efi -&gt;
/var/lib/tftpboot/grub/grub-x86.efi
trying hardlink /var/lib/cobbler/loaders/grub-x86_64.efi -&gt;
/var/lib/tftpboot/grub/grub-x86_64.efi
copying distros to tftpboot
copying images
generating PXE configuration files
generating PXE menu structure
rendering TFTPD files
generating /etc/xinetd.d/tftp
cleaning link caches
running post-sync triggers
running python triggers from /var/lib/cobbler/triggers/sync/post/*
running python trigger cobbler.modules.sync_post_restart_services
running shell triggers from /var/lib/cobbler/triggers/sync/post/*
running python triggers from /var/lib/cobbler/triggers/change/*
running python trigger cobbler.modules.manage_genders
running python trigger cobbler.modules.scm_track
running shell triggers from /var/lib/cobbler/triggers/change/*
</p>
</div>
</section>
<section id="outline-container-h:60fc76b4-72de-46c8-b5e0-62c2b22ee00e" class="outline-2">
<h2 id="h:60fc76b4-72de-46c8-b5e0-62c2b22ee00e">TASK COMPLETE <b>*</b></h2>
<div class="outline-text-2" id="text-h:60fc76b4-72de-46c8-b5e0-62c2b22ee00e">
<p>
[root@centos7 ~]#tree <i>var/lib/tftpboot</i>
<i>var/lib/tftpboot</i>
├── boot
│ └── grub
│ └── menu.lst
├── etc
├── grub
│ ├── efidefault
│ ├── grub-x86_64.efi
│ ├── grub-x86.efi
│ └── images -&gt; ../images
├── images
├── images2
├── memdisk
├── menu.c32
├── ppc
├── pxelinux.0
├── pxelinux.cfg
│ └── default
├── s390x
│ └── profile_list
└── yaboot
</p>

<p>
10 directories, 10 files
#+end_src
</p>
</div>
<div id="outline-container-h:2abea07d-83b9-4a42-b169-b81e47fbad22" class="outline-4">
<h4 id="h:2abea07d-83b9-4a42-b169-b81e47fbad22">13.6 修改菜单的标题信息(可选)</h4>
<div class="outline-text-4" id="text-h:2abea07d-83b9-4a42-b169-b81e47fbad22">
<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#vim /etc/cobbler/pxe/pxedefault.template
MENU TITLE Cobbler | http://www.cuiqinghe.com/

[root@centos7 ~]#cobbler sync
[root@centos7 ~]#cat /var/lib/tftpboot/pxelinux.cfg/default
DEFAULT menu
PROMPT 0
MENU TITLE Cobbler | http://www.me.com/ <span style="color: #b22222;">#</span><span style="color: #b22222;">&#40664;&#35748;&#20026;&#65306;http://cobbler.github.io/</span>
TIMEOUT 200
TOTALTIMEOUT 6000
ONTIMEOUT local

LABEL local
    MENU LABEL (<span style="color: #483d8b;">local</span>)
    MENU DEFAULT
    LOCALBOOT -1

MENU end

[root@centos7 ~]#cobbler sync
</pre>
</div>
</div>
</div>
<div id="outline-container-h:fffac2d3-bf31-470b-956b-a8077015674d" class="outline-4">
<h4 id="h:fffac2d3-bf31-470b-956b-a8077015674d">13.7 导入CentOS系统的安装文件，生成相应的YUM源</h4>
<div class="outline-text-4" id="text-h:fffac2d3-bf31-470b-956b-a8077015674d">
<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#cobbler import --name=centos-8.1-x86_64 --path=/misc/cd --arch=x86_64
[root@centos7 ~]#mount /dev/sr1 /mnt
mount: /dev/sr1 is write-protected, mounting read-only
[root@centos7 ~]#cobbler import --name=centos-7.7-x86_64 --path=/mnt --arch=x86_64
[root@centos7 ~]#du -sh /var/www/cobbler/ks_mirror/*
11G /var/www/cobbler/ks_mirror/centos-7.7-x86_64
7.2G /var/www/cobbler/ks_mirror/centos-8.1-x86_64
12K /var/www/cobbler/ks_mirror/config
[root@centos7 ~]#cobbler distro list
centos-7.7-x86_64
centos-8.1-x86_64

[root@centos7 ~]#cobbler profile list
centos-7.7-x86_64
centos-8.1-x86_64

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#40664;&#35748;&#29983;&#25104;&#30340;&#26159;&#26368;&#23567;&#21270;&#23433;&#35013;</span>
</pre>
</div>


<figure id="org2723f75">
<img src="images/image-20210122164013278.png" alt="image-20210122164013278.png">

</figure>
</div>
</div>
<div id="outline-container-h:f0d14607-c88b-4919-a349-bd97dd133034" class="outline-4">
<h4 id="h:f0d14607-c88b-4919-a349-bd97dd133034">13.8 准备 kickstart文件,并关联至指定的YUM源</h4>
<div class="outline-text-4" id="text-h:f0d14607-c88b-4919-a349-bd97dd133034">
<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#vim /var/lib/cobbler/kickstarts/centos8.cfg
[root@centos7 ~]#cat /var/lib/cobbler/kickstarts/centos8.cfg
ignoredisk --only-use=sda
zerombr
text
reboot
clearpart --all --initlabel
selinux --disabled
firewall --disabled
url --url=$<span style="color: #a0522d;">tree</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27880;&#24847;&#27492;&#34892;&#24517;&#39035;&#25351;&#23450;</span>
keyboard --vckeymap=us --xlayouts=<span style="color: #8b2252;">'us'</span>
lang en_US.UTF-8
network --bootproto=dhcp --device=ens160 --ipv6=auto --activate
network --hostname=centos8.me.com
rootpw --iscrypted
$<span style="color: #a0522d;">6</span>$<span style="color: #a0522d;">nOPs5JTMlP4mhQeW</span>$<span style="color: #a0522d;">R</span>/o62B6SXAh3RR.zrZ3U0X4xYX9/u5nSLrR/vqCB6kdO2XFfMk2a4yAgrHJQ
pXK/e4jzRb0jiLBv2nFMXaBjB/
firstboot --enable
skipx
services --disabled=<span style="color: #8b2252;">"chronyd"</span>
timezone Asia/Shanghai --isUtc --nontp
user --name=wang --
<span style="color: #a0522d;">password</span>=$<span style="color: #a0522d;">6</span>$<span style="color: #a0522d;">oUfb</span>/02CWfLb5l8f$<span style="color: #a0522d;">sgEZeR7c7DpqfpmFDH6huSmDbW1XQNR4qKl2EPns</span>.gOXqlnAIgv
9pTogtFVaDtEpMOC.SWXKYqxfVtd9MCwxb1 --iscrypted --gecos=<span style="color: #8b2252;">"wang"</span>
part / --fstype=<span style="color: #8b2252;">"xfs"</span> --ondisk=sda --size=102400
part /data --fstype=<span style="color: #8b2252;">"xfs"</span> --ondisk=sda --size=51200
part swap --fstype=<span style="color: #8b2252;">"swap"</span> --ondisk=sda --size=2048
part /boot --fstype=<span style="color: #8b2252;">"ext4"</span> --ondisk=sda --size=1024
%packages
@^minimal-environment
kexec-tools
%end
%addon com_redhat_kdump --enable --reserve-mb=<span style="color: #8b2252;">'auto'</span>
%end
%anaconda
pwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty
pwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok
pwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty
%end

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;kickstart&#25991;&#20214;&#65292;&#20851;&#32852;&#25351;&#23450;&#30340;YUM&#28304;&#21644;&#29983;&#25104;&#33756;&#21333;&#21015;&#34920;</span>
[root@centos7 ~]#cobbler profile add --name=CentOS-8.1_test --distro=CentOS-8.1-x86_64 --kickstart=/var/lib/cobbler/kickstarts/centos8.cfg
[root@centos7 ~]#cobbler profile add --name=CentOS-7.7_test --distro=CentOS-7.7-x86_64 --kickstart=/var/lib/cobbler/kickstarts/centos7.cfg

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500;&#40664;&#35748;&#29983;&#25104;&#30340;&#33756;&#21333;</span>
[root@centos7 ~]#cobbler profile remove --name=centos-8.1-x86_64
[root@centos7 ~]#cobbler profile remove --name=centos-7.7-x86_64
[root@centos7 ~]#cobbler profile list
CentOS-7.7_test
CentOS-8.1_test

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500;&#40664;&#35748;&#30340;&#33756;&#21333;&#21015;&#34920;</span>
[root@centos7 ~]#cobbler profile remove --name=CentOS8.0-x86_64
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6ed8a4c5-215c-4124-91aa-bb410a52b649" class="outline-4">
<h4 id="h:6ed8a4c5-215c-4124-91aa-bb410a52b649">13.9 测试客户端基于Cobbler实现自动安装</h4>
<div class="outline-text-4" id="text-h:6ed8a4c5-215c-4124-91aa-bb410a52b649">

<figure id="org718373d">
<img src="images/image-20210122164032051.png" alt="image-20210122164032051.png">

</figure>
</div>
</div>
<div id="outline-container-h:3fcc8058-99d5-4a37-b704-1c17c20c7590" class="outline-4">
<h4 id="h:3fcc8058-99d5-4a37-b704-1c17c20c7590">13.10 支持UEFI安装</h4>
<div class="outline-text-4" id="text-h:3fcc8058-99d5-4a37-b704-1c17c20c7590">
<p>
<b>注意：CentOS6的虚拟机不支持UEFI</b>
</p>

<p>
修改文件设置时间，默认不显示菜单
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#27169;&#29256;&#25991;&#20214;</span>
[root@Centos7 ~]#vim /etc/cobbler/pxe/efidefault.template 
[root@Centos7 ~]#cat /etc/cobbler/pxe/efidefault.template
<span style="color: #a0522d;">default</span>=0
<span style="color: #a0522d;">timeout</span>=60

$<span style="color: #a0522d;">grub_menu_items</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#27169;&#29256;&#29983;&#25928;</span>
[root@Centos7 ~]#cobbler sync

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#39564;&#35777;&#29983;&#25928;</span>
[root@Centos7 ~]#head -n 2 /var/lib/tftpboot/grub/efidefault 
<span style="color: #a0522d;">default</span>=0
<span style="color: #a0522d;">timeout</span>=60
</pre>
</div>

<p>
设置客户端的启动使用UEFI <img src="images/image-20210122164052729.png" alt="image-20210122164052729.png">
</p>

<p>
启动客户机可以看到面界面
</p>

<p>
<img src="images/image-20210122164116443.png" alt="image-20210122164116443.png"> 选择对应的菜单进行自动安装
<img src="images/image-20210122164139752.png" alt="image-20210122164139752.png">
</p>


<figure id="org8b8e1f7">
<img src="images/image-20210122164151628.png" alt="image-20210122164151628.png">

</figure>


<figure id="orgd3a189c">
<img src="images/image-20210122164210619.png" alt="image-20210122164210619.png">

</figure>


<figure id="orgb373cd6">
<img src="images/image-20210122164334382.png" alt="image-20210122164334382.png">

</figure>
</div>
</div>
<div id="outline-container-h:40e18527-a8a2-4f9d-886f-8e79a63e4207" class="outline-4">
<h4 id="h:40e18527-a8a2-4f9d-886f-8e79a63e4207">13.11 实现cobbler 的web管理</h4>
<div class="outline-text-4" id="text-h:40e18527-a8a2-4f9d-886f-8e79a63e4207">
<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#yum -y install cobbler-web
[root@centos7 ~]#systemctl restart httpd
</pre>
</div>

<p>
通过浏览器访问下面地址： <a href="https://cobblerserver/cobbler_web">https://cobblerserver/cobbler_web</a>
</p>


<figure id="org5183dce">
<img src="images/image-20210122164518524.png" alt="image-20210122164518524.png">

</figure>

<p>
用户名：cobbler，默认密码：cobbler
</p>
</div>
</div>
<div id="outline-container-h:20309237-041c-469d-a5b5-9180e165ee1c" class="outline-4">
<h4 id="h:20309237-041c-469d-a5b5-9180e165ee1c">13.12 创建cobbler的自定义的web用户</h4>
<div class="outline-text-4" id="text-h:20309237-041c-469d-a5b5-9180e165ee1c">
<div class="org-src-container">
<pre class="src src-sh">[root@Centos7 ~]#cat /etc/cobbler/users.digest 
cobbler:Cobbler:a2d6bae81669d707b72c0bd9806e01f3
[root@Centos7 ~]#htdigest -c /etc/cobbler/users.digest Cobbler admin
Adding password for admin<span style="color: #a020f0;"> in</span> realm Cobbler.
New password: 
Re-type new password: 
[root@Centos7 ~]#cat /etc/cobbler/users.digest 
admin:Cobbler:4887b371b26ba94f869506d1655ad46f
3
[root@Centos7 ~]#htdigest  /etc/cobbler/users.digest Cobbler admin2
Adding user admin2<span style="color: #a020f0;"> in</span> realm Cobbler
New password: 
Re-type new password: 
[root@Centos7 ~]#cat /etc/cobbler/users.digest 
admin:Cobbler:4887b371b26ba94f869506d1655ad46f
3
admin2:Cobbler:4d98c803029c18a65aa5fcf12c56b517
</pre>
</div>

<p>
使用上面命令创建的用户登录web界面
</p>


<figure id="org688287e">
<img src="images/image-20210122164555471.png" alt="image-20210122164555471.png">

</figure>

<p>
登录成功后，可以看到下面界面
</p>


<figure id="orgce65bd3">
<img src="images/image-20210122164609166.png" alt="image-20210122164609166.png">

</figure>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>打赏</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>© 2025 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
<!--
<script type="text/javascript" src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/bootstrap@5.2.1/dist/js/bootstrap.min.js"></script>
<div id="back-to-top" class=""><svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg></div>
-->
</div>
</body>
</html>
