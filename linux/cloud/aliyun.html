<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linux: é˜¿é‡Œäº‘ä½¿ç”¨</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/font.css"/>
<link rel="stylesheet" type="text/css" href="/static/drollery.e825b870.css"/>
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<header id="preamble" class="status">
<header class="{className}" data-astro-cid-3ef6ksr2>
  <div class=header-branding data-astro-cid-g2lrb5xm>
      <span class=header-text data-astro-cid-g2lrb5xm>
          <span class=dropcap data-astro-cid-g2lrb5xm aria-hidden=true>
              <span class=actual data-astro-cid-g2lrb5xm>J</span>
              <span class=rest data-astro-cid-g2lrb5xm>asper Hsu</span>
              <span class=period data-astro-cid-g2lrb5xm>.</span>
          </span>
          <span class=sr-only data-astro-cid-g2lrb5xm>Drollery</span>
      </span>
      <img alt="Medieval drollery of a knight on a horse" class=spring decoding=async height=250 loading=lazy src=/images/knight-horse.a96eee7d_Z1WCOYs.webp width=68 data-astro-cid-g2lrb5xm>
  </div>

  <nav data-astro-cid-pux6a34n>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/jcodelog.html class=nobracket data-astro-cid-pux6a34n>æŠ€æœ¯</a>
      <span class=flower2 data-astro-cid-pux6a34n>K</span>
      <a href=/reading/index.html class=nobracket data-astro-cid-pux6a34n>é˜…è¯»</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
      <a href=/lisp/jasper-emacs.html class=nobracket data-astro-cid-pux6a34n>æˆ‘çš„Emacsé…ç½®</a>
      <span class=flower2 data-astro-cid-pux6a34n>L</span>
      <a href=/link/index.html class=nobracket data-astro-cid-pux6a34n>å‹é“¾</a>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/about.html class=nobracket data-astro-cid-pux6a34n>å…³äº</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
  </nav>


  <div class="container" data-astro-cid-3ef6ksr2>
    <p class="info" data-astro-cid-3ef6ksr2>
              ğŸ† æ¬¢è¿æ¥åˆ°æœ¬ç«™ï¼š
              <a href="https://xuchangwei.com/">https://xuchangwei.com/</a>ã€‚
              <strong>å¸Œæœ›è¿™é‡Œæœ‰ä½ æ„Ÿå…´è¶£çš„å†…å®¹</strong>ã€‚
            </p>
  </div>
  <div id=borderArtWrapper class="tt1" data-astro-cid-5hce7sga data-turbo-permanent>
      <script>
          var man, shakeCount = 0, noSound = new Audio("/audio/effects/no.m4a"), screamSound = new Audio("/audio/effects/scream.m4a");
          function animateManShakeHandler() {
              man.removeEventListener("animationend", animateManShakeHandler, !1),
              shakeCount += 1,
              man.classList.remove("shakeMan")
          }
          function animateManFallHandler() {
              man.removeEventListener("animationend", animateManFallHandler, !1),
              man.classList.add("hide")
          }
          function animateMan() {
              man = man ?? document.getElementById("borderMan"),
              3 === shakeCount ? (man.classList.add("fallMan"),
              screamSound.play(),
              man.addEventListener("animationend", animateManFallHandler, !1)) : (man.classList.add("shakeMan"),
              noSound.play(),
              man.addEventListener("animationend", animateManShakeHandler, !1))
          }
      </script>
      <div class=borderArt data-astro-cid-5dda5nwp id=articleBorder>
          <img alt="flowery border with man falling" decoding=async height=620 loading=lazy src=/images/border-vines-no-man.b7d246cc_DRxSe.webp width=909 class=border data-astro-cid-5dda5nwp>
          <div class=fallWrapper data-astro-cid-5dda5nwp>
              <img alt="flowery border with man falling" decoding=async height=292 loading=lazy src=/images/man-no-vines.247a3187_Z2ioXNM.webp width=98 class=man data-astro-cid-5dda5nwp id=borderMan onclick=animateMan()>
          </div>
      </div>
  </div>
</header>
</header>
<main class="container" id="content" class="content">
<header>
<h1 class="title">Linux: é˜¿é‡Œäº‘ä½¿ç”¨</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:0000c3e4-1750-49e4-b2ea-f630132f7bb6">kernel</a></li>
<li><a href="#h:38e60e4e-1f69-4f72-a73e-9444d3688188">ECS</a>
<ul>
<li><a href="#h:d15075fe-d5e2-4fc1-8a4b-624c189bce38">ç£ç›˜æ‰©å®¹</a>
<ul>
<li><a href="#h:66e2ec12-1190-4b0b-815c-244ba66cfb13">AWS EC2 æ›´æ¢ç³»ç»Ÿç›˜æ¡ˆä¾‹</a></li>
</ul>
</li>
<li><a href="#h:b28d3214-bf27-4638-9368-4fc4c7d0c5b4">å¿«ç…§</a></li>
<li><a href="#h:75b6da24-e73e-4cfc-a8ab-1f8590ef7774">ç³»ç»Ÿæ•‘æ´</a></li>
</ul>
</li>
<li><a href="#h:ec0cf84d-6a64-449c-bf2b-4c8d575825c2">SLB</a></li>
<li><a href="#h:68550704-8745-4a17-abb1-372e222c5e24">ç½‘ç»œäº’é€š</a>
<ul>
<li><a href="#h:72f842d6-c271-4b4c-8287-1b018177cce9">å…¬å¸ä¸é˜¿é‡Œæ–°åŠ å¡äº’é€š vpn-ipsec</a></li>
<li><a href="#h:e656902e-b1d3-4b4d-9bd4-d47d0cded1db">é˜¿é‡Œæ–°åŠ å¡æœºæˆ¿VPCä¸é˜¿é‡ŒååŒ—2æœºæˆ¿VPCç½‘ç»œäº’é€š-é«˜é€Ÿé€šé“</a></li>
<li><a href="#h:f10042f9-5249-47ba-a1db-d33e6bb1c18a">é˜¿é‡Œæ–°åŠ å¡æœºæˆ¿VPCä¸é˜¿é‡ŒååŒ—2æœºæˆ¿VPCç½‘ç»œäº’é€š-vpn-ipsecä¸´æ—¶æ–¹æ¡ˆ</a></li>
<li><a href="#h:862229a2-be97-49d4-8218-12070382d8cd">é˜¿é‡Œäº‘vpcä¸äºšé©¬é€Švpcäº’é€š-vpn</a></li>
</ul>
</li>
<li><a href="#h:91dbdadb-e61e-4de4-bf90-202c2b815ab6">OSS</a>
<ul>
<li><a href="#h:b203d2f6-379d-4294-b589-1b8e492e974e">è§£å†»è½¬æ¢æ–‡ä»¶ç±»å‹</a></li>
<li><a href="#h:eb28fad8-869e-455b-84c6-14c410b47bb3">ossfsæ–‡ä»¶æŒ‚è½½</a></li>
<li><a href="#h:12490673-62e7-4b75-b8f9-58bd31945f2e">OSS è®¿é—®æˆæƒ</a></li>
<li><a href="#h:4e546697-19c8-4fde-8909-386b7f72593e">nodejs +OSS STS</a></li>
<li><a href="#h:6efbb9e2-adcb-44c7-a96c-2c724d121250">ossè·¨åŸŸ</a></li>
<li><a href="#h:2908f3e6-9c81-415a-8385-56006488f39b">è…¾è®¯-COS</a></li>
<li><a href="#h:0260d36c-8893-4eed-ba6b-86104b42ab19">aws-s3</a></li>
</ul>
</li>
<li><a href="#h:bebc4ee8-f5de-443f-96c5-fb5ff96afb93">NAS</a></li>
<li><a href="#h:974c8b8e-db89-4349-abdb-91c182655e5f">çŸ­ä¿¡æœåŠ¡</a></li>
<li><a href="#h:d2700a10-479e-470b-ba71-daec5d458fca">CDN</a>
<ul>
<li><a href="#h:8d14bc95-ab69-4f7c-9f23-af02e9ec22f5">æœåŠ¡ç®¡ç†</a></li>
<li><a href="#h:b1cb9050-79b0-44ca-bc83-9e6836dabf93">cndå¸¸ç”¨é…ç½®</a>
<ul>
<li><a href="#h:d68efa88-37b9-45b4-8eb9-0bf789e7bf27">CDNå‚å•†å“åº”æ£€æµ‹</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:8d3c1307-d936-4f78-a0e2-e1d55419cf77">RAM</a>
<ul>
<li><a href="#h:a8fbf19e-7927-45ac-a9c0-643215d54b88">RAM-OSS</a></li>
<li><a href="#h:42014010-683b-49ea-8871-6651ed9114d4">RAM-RDS</a></li>
<li><a href="#h:dd0f97f3-ca45-4e79-b99a-a04399d6dd99">RAM-CDN</a></li>
<li><a href="#h:e0f691e7-c5f4-47e7-adf6-c6712a86819b">RAM-STS</a></li>
</ul>
</li>
<li><a href="#h:eddc6945-5566-41f2-8d98-f62780b32b74">SLSæ—¥å¿—</a>
<ul>
<li><a href="#h:e8f745f9-ebc6-4c54-bafe-ed8881b9d210">æŸ¥è¯¢SQL</a></li>
<li><a href="#h:7efbf2f1-7607-4e3f-a736-e93fb447efef">æ•°æ®åŠ å·¥</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../index.html">Linux</a></li>
</ul>
<section id="outline-container-h:0000c3e4-1750-49e4-b2ea-f630132f7bb6" class="outline-2">
<h2 id="h:0000c3e4-1750-49e4-b2ea-f630132f7bb6">kernel</h2>
<div class="outline-text-2" id="text-h:0000c3e4-1750-49e4-b2ea-f630132f7bb6">
<p>
<a href="https://gitlab.com/gitlab-org/charts/gitlab/">https://gitlab.com/gitlab-org/charts/gitlab/</a>
</p>


<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">cpu&#21152;&#36895;</span>
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"cpupower frequency-set -g performance"</span> &gt;&gt; /etc/rc.local
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"echo 1 &gt; /proc/sys/net/ipv4/vs/ignore_no_rs_error"</span> &gt;&gt; /etc/rc.loal
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"echo 1 &gt; /proc/vm/fast_slub_nr_free"</span> &gt;&gt; /etc/rc.local
<span style="color: #483d8b;">echo</span> 1 &gt; /proc/sys/vm/fast_slub_nr-free;
<span style="color: #483d8b;">echo</span> 1 &gt; /proc/sys/net/ipv4/vs/ignore_no_rs_error

cpupower frequency-set -g performance
</pre>
</div>
</div>
</section>
<section id="outline-container-h:38e60e4e-1f69-4f72-a73e-9444d3688188" class="outline-2">
<h2 id="h:38e60e4e-1f69-4f72-a73e-9444d3688188">ECS</h2>
<div class="outline-text-2" id="text-h:38e60e4e-1f69-4f72-a73e-9444d3688188">
</div>
<div id="outline-container-h:d15075fe-d5e2-4fc1-8a4b-624c189bce38" class="outline-3">
<h3 id="h:d15075fe-d5e2-4fc1-8a4b-624c189bce38">ç£ç›˜æ‰©å®¹</h3>
<div class="outline-text-3" id="text-h:d15075fe-d5e2-4fc1-8a4b-624c189bce38">
<p>
<b>1. æ‰©å®¹äº‘ç›˜ï¼ˆLinuxç³»ç»Ÿï¼‰</b>
</p>

<p>
å‚è€ƒï¼š<a href="https://help.aliyun.com/document_detail/44986.html?spm=a2c4g.11174283.6.836.d94352fe9MVzl3">https://help.aliyun.com/document_detail/44986.html?spm=a2c4g.11174283.6.836.d94352fe9MVzl3</a>
</p>

<p>
å‡†å¤‡
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#38236;&#20687;&#25991;&#20214;&#28155;&#21152;200G&#65292;&#19981;&#33021;&#26377;&#24555;&#29031;</span>
qemu-img resize haproxy-clone.qcow2 +200G
qemu-img info haproxy-clone.qcow2
</pre>
</div>

<p>
æ­¥éª¤ä¸€ï¼šåˆ›å»ºå¿«ç…§
</p>

<p>
æ­¥éª¤ä¸‰ï¼šæŸ¥çœ‹äº‘ç›˜åˆ†åŒºæƒ…å†µ
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">1. &#36828;&#31243;&#30331;&#24405;ECS&#23454;&#20363;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">2. &#36816;&#34892;&#21629;&#20196;fdisk -lu&#26597;&#30475;&#23454;&#20363;&#30340;&#20113;&#30424;&#24773;&#20917;</span>
[root@zentao01 ~]# fdisk -lu
Disk /dev/vda: 322.1 GB, 322122547200 bytes, 

   Device Boot      Start         End      Blocks   Id  System
/dev/vda1   *        2048   209715199   104856576   83  Linux

<span style="color: #b22222;">#</span><span style="color: #b22222;">System&#21462;&#20540;Linux&#34920;&#31034;&#20026;MBR&#20998;&#21306;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">System&#21462;&#20540;GPT&#34920;&#31034;&#20026;GPT&#20998;&#21306;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">3. &#36816;&#34892;&#21629;&#20196;blkid&#30830;&#35748;&#24050;&#26377;&#20998;&#21306;&#30340;&#25991;&#20214;&#31995;&#32479;&#31867;&#22411;&#12290;</span>
[root@zentao01 ~]# blkid
/dev/vda1: <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"7becd1b9-80e8-438c-9dd8-2985c6f5be36"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"xfs"</span> 
</pre>
</div>

<p>
æ­¥éª¤å››ï¼šæ‰©å®¹åˆ†åŒº
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">1. &#36828;&#31243;&#30331;&#24405;ECS&#23454;&#20363;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">2. &#23433;&#35013;gdisk&#24037;&#20855;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#24744;&#30340;&#20998;&#21306;&#20026;GPT&#26684;&#24335;&#65292;&#24517;&#39035;&#25191;&#34892;&#27492;&#27493;&#39588;&#65307;&#22914;&#26524;&#24744;&#30340;&#20998;&#21306;&#20026;MBR&#26684;&#24335;&#65292;&#35831;&#36339;&#36807;&#27492;&#27493;&#39588;</span>

yum install gdisk -y

<span style="color: #b22222;">#</span><span style="color: #b22222;">3. &#36816;&#34892;&#21629;&#20196;growpart /dev/vda 1&#25193;&#23481;&#20998;&#21306;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;growpart&#24037;&#20855;&#21644;resize2fs&#24037;&#20855;</span>
yum install -y cloud-utils-growpart  
yum install -y xfsprogs
[root@zentao01 ~]# growpart /dev/vda 1
CHANGED: <span style="color: #a0522d;">partition</span>=1 <span style="color: #a0522d;">start</span>=2048 old: <span style="color: #a0522d;">size</span>=209713152 <span style="color: #a0522d;">end</span>=209715200 new: <span style="color: #a0522d;">size</span>=629143519 <span style="color: #a0522d;">end</span>=629145567
</pre>
</div>

<p>
æŠ¥é”™
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@jenkins ~]# growpart /dev/vda 1
NOCHANGE: partition 1 could only be grown by -33 [<span style="color: #a0522d;">fudge</span>=2048]
</pre>
</div>

<p>
è§£å†³ï¼šç£ç›˜é‡æ–°æŒ‚è½½æˆ–è€…é‡å¯è™šæ‹Ÿæœºå®ä¾‹
</p>

<p>
æ­¥éª¤äº”ï¼šæ‰©å®¹æ–‡ä»¶ç³»ç»Ÿ
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">1. &#36828;&#31243;&#30331;&#24405;ECS&#23454;&#20363;&#12290;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2. &#26681;&#25454;&#26597;&#35810;&#30340;&#25991;&#20214;&#31995;&#32479;&#31867;&#22411;&#65292;&#25193;&#23481;&#25991;&#20214;&#31995;&#32479;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25193;&#23481;ext*&#65288;&#20363;&#22914;ext4&#65289;&#25991;&#20214;&#31995;&#32479;&#65306;&#36816;&#34892;&#21629;&#20196;resize2fs /dev/vda1&#25193;&#23481;&#25991;&#20214;&#31995;&#32479;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25193;&#23481;&#31995;&#32479;&#30424;/dev/vda1&#30340;&#25991;&#20214;&#31995;&#32479;</span>
resize2fs /dev/vda1

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25193;&#23481;&#25968;&#25454;&#30424;/dev/vdb1&#30340;&#25991;&#20214;&#31995;&#32479;</span>
e2fsck -f /dev/vdb1     //&#24378;&#21046;&#26816;&#26597;&#25991;&#20214;&#31995;&#32479;
resize2fs /dev/vdb1


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25193;&#23481;&#23481;xfs&#25991;&#20214;&#31995;&#32479;&#65306;&#36816;&#34892;&#21629;&#20196;xfs_growfs /media/vdc&#25193;&#23481;&#25991;&#20214;&#31995;&#32479;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35828;&#26126;&#160;/media/vdc&#20026;/dev/vdc1&#30340;&#25346;&#36733;&#28857;&#65292;&#24744;&#38656;&#35201;&#26681;&#25454;&#23454;&#38469;&#24773;&#20917;&#20462;&#25913;&#12290;</span>
xfs_growfs  /

<span style="color: #b22222;">#</span><span style="color: #b22222;">3. &#36816;&#34892;&#21629;&#20196;df -Th&#26816;&#26597;&#25193;&#23481;&#21518;&#32467;&#26524;</span>
[root@zentao01 ~]# df -Th
Filesystem     Type      Size  Used Avail Use% Mounted on
/dev/vda1      xfs       300G  1.7G  299G   1% /
devtmpfs       devtmpfs  2.0G     0  2.0G   0% /dev
</pre>
</div>

<p>
èŒƒä¾‹ï¼šlinux ext4æ‰©å®¹ï¼Œé€‚åˆäºäº‘ä¸Šå®ä¾‹ã€KVM
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#38236;&#20687;&#25991;&#20214;&#28155;&#21152;200G&#65292;&#19981;&#33021;&#26377;&#24555;&#29031;</span>
qemu-img resize haproxy-clone.qcow2 +200G
qemu-img info haproxy-clone.qcow2

yum install gdisk cloud-utils-growpart -y
fdisk -lu
growpart /dev/vdb 1
resize2fs  /dev/vdb1 <span style="color: #b22222;"># </span><span style="color: #b22222;">xfs&#25191;&#34892; xfs_growfs  /dev/vdb</span>
df -Th
</pre>
</div>
<p>
<b>2. æ‰©å±•åˆ†åŒºå’Œæ–‡ä»¶ç³»ç»Ÿ_Linuxæ•°æ®ç›˜</b>
</p>

<p>
å‚è€ƒ:<a href="https://help.aliyun.com/document_detail/25452.html?spm=a2c4g.11186623.2.26.69d35bb8fAu3sA#section-gg7-ilv-h3j">https://help.aliyun.com/document_detail/25452.html?spm=a2c4g.11186623.2.26.69d35bb8fAu3sA#section-gg7-ilv-h3j</a>
</p>
</div>
<div id="outline-container-h:66e2ec12-1190-4b0b-815c-244ba66cfb13" class="outline-4">
<h4 id="h:66e2ec12-1190-4b0b-815c-244ba66cfb13">AWS EC2 æ›´æ¢ç³»ç»Ÿç›˜æ¡ˆä¾‹</h4>
<div class="outline-text-4" id="text-h:66e2ec12-1190-4b0b-815c-244ba66cfb13">
<p>
ä¸»é¢˜ï¼šrummy è¯»åŸŸåä¿®æ”¹æŒ‡å‘åŠ rummy 215 ç£ç›˜æ›´æ¢ç³»ç»Ÿæ‰©å®¹
</p>

<p>
èƒŒæ™¯ï¼š
</p>

<p>
rummy ä¸€å° mysql ä»åº“ 172.21.89.215 æ ¹ç£ç›˜æ€¥éœ€æ‰©å®¹
215 å®ä¾‹åªæœ‰ä¸€ä¸ª 2T ç³»ç»Ÿç›˜ï¼Œç³»ç»Ÿç›˜åšäº† MBR åˆ†åŒºï¼Œä½¿ç”¨ç‡ 94%
MBR å¼•å¯¼ç›˜å®¹é‡ä¸Šé™ 2 T ï¼Œæ— æ³•åº”å¯¹åæœŸæ•°æ®å¢é•¿ã€‚
</p>

<p>
éœ€æ±‚ï¼š
</p>

<p>
rummy è¯»åŸŸåä¿®æ”¹æŒ‡å‘åŠ rummy 215 ç£ç›˜æ›´æ¢ç³»ç»Ÿæ‰©å®¹
</p>

<p>
æ“ä½œæ­¥éª¤ï¼š
</p>

<p>
1ã€rummy è¯»åŸŸåï¼šdb-reader.xxx.com
</p>

<p>
åŸŸåæŒ‡å‘ï¼š 89.215  &#x2014;&gt; 89.84 å¯¹åº”çš„ NLB
</p>

<p>
æ—§ï¼šP1-a10b8a96e9eddfcd.elb.ap-south-1.amazonaws.com
</p>

<p>
æ–°ï¼šPa10b8a96e9eddfcd.elb.ap-south-1.amazonaws.com
</p>

<p>
2ã€172.21.89.215 æ•°æ®ç›®å½•æ‰©å®¹
</p>

<p>
å‡†å¤‡ç³»ç»Ÿç›˜ï¼šæ–° ec2
</p>
<ol class="org-ol">
<li>ä½¿ç”¨ AMI PFGC-DB-Common-Image æ–°å»º ec2ï¼Œç³»ç»Ÿç›˜200G XFS</li>
<li>å…³æœºï¼Œæ ¹å·åˆ†ç¦»ï¼Œè®°å½•å·id vol-018401235208e553b</li>
<li>æ–° ec2 å®ä¾‹åˆ é™¤</li>
</ol>

<p>
æ›´æ¢ç³»ç»Ÿç›˜ï¼š215 ä»åº“ ec2
</p>
<ol class="org-ol">
<li>å…³æœº, æ ¹å·åˆ†ç¦»ï¼Œè®°å½•å·id i-015fdd06360774689ï¼Œå®ä¾‹id i-015fdd06360774689</li>
<li>é™„åŠ å·ï¼Œé€‰æ‹©æ–°å· /dev/sda1</li>
<li>å¼€æœº</li>
<li><p>
é™„åŠ å·ï¼Œé€‰æ‹©æ—§æ ¹å· /dev/xvdf
</p>

<p>
æŒ‚è½½ä½¿ç”¨ï¼šmount -t xfs -o nouuid /dev/xvdf1 /data1
</p>

<p>
ps: 2ä¸ªå·çš„uuidä¸€æ ·ï¼Œä¿®æ”¹/etc/fstab ä½¿ç”¨è®¾å¤‡ååŒºåˆ†æŒ‚è½½
</p></li>

<li>å¯åŠ¨ mysql</li>
<li>åç»­ï¼šæ–°å¢æ•°æ®å· NTï¼Œgptåˆ†åŒºæŒ‚è½½</li>
</ol>

<p>
å‡†å¤‡æ•°æ®ç›˜ï¼šgp3 å·
</p>
<ol class="org-ol">
<li>åˆ›å»º 3T å·ï¼Œå·id vol-0c41d6db13107f3d0</li>
<li>é™„åŠ å·åˆ° 215 æœºå™¨ä¸Š /dev/sdgï¼Œæ­¤è¿‡ç¨‹æ— éœ€åœæœº</li>
<li><p>
åˆå§‹åŒ–å·å¹¶æŒ‚è½½å·ï¼Œåˆå§‹åŒ–ä¸º xfs æ–‡ä»¶ç³»ç»Ÿå¹¶æŒ‚è½½åˆ° /data1
</p>

<p>
sudo mkfs -t xfs /dev/nvme2n1
</p></li>

<li>æ·»åŠ  mysql æœåŠ¡å®ä¾‹åŒæ­¥ä¸»åº“æ•°æ®</li>
</ol>

<p>
æ“ä½œï¼šSRE, DBA
</p>

<p>
é‡åˆ°çš„é—®é¢˜ï¼š
</p>

<ol class="org-ol">
<li>å¦‚æœæ—¶åŒºä¸å¯¹ï¼Œä¿®æ”¹æ—¶åŒºä¸ºå°åº¦åŒº</li>
</ol>
<div class="org-src-container">
<pre class="src src-sh">ln -sf /usr/share/zoneinfo/Asia/Calcutta /etc/localtime
date -R
</pre>
</div>

<ol class="org-ol">
<li>æŒ‚è½½å·ä¸æ˜¾ç¤º</li>
</ol>

<p>
éœ€è¦æŠŠè¿™å°æœåŠ¡å™¨çš„ / ç›®å½•æŒ‚åœ¨åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šï¼Œå†å†™å¯†é’¥
</p>

<p>
åœ¨å…¶ä»–æœåŠ¡å™¨ä¸ŠæŒ‚è½½ï¼Œæœ‰æ—¶å€™ mount æŒ‚è½½ä¸ä¸Šï¼Œéœ€è¦åŠ å‚æ•° -o nouuid
</p>

<div class="org-src-container">
<pre class="src src-sh">mount -t xfs -o nouuid /dev/xvdf1 /data1
</pre>
</div>

<ol class="org-ol">
<li>å…³æœºä¼šæ”¶åˆ°æŠ¥è­¦</li>
</ol>
<div class="org-src-container">
<pre class="src src-sh">Time: 2022-01-13 06:40:46
Alert:  Rummy mysql_slave  172.21.89.215:9104 is down
Value: 0.00s

Time: 2022-01-13 06:44:16
Alert: Rummy_nodes Rummy DB   172.21.89.215:9100  down for more than 2 minutes.
Value: 0.00
</pre>
</div>

<p>
å‚è€ƒæ–‡æ¡£ï¼š
</p>

<p>
<a href="https://aws.amazon.com/cn/premiumsupport/knowledge-center/ec2-ubuntu-convert-mbr-to-gpt/">https://aws.amazon.com/cn/premiumsupport/knowledge-center/ec2-ubuntu-convert-mbr-to-gpt/</a>
</p>
</div>
</div>
</div>
<div id="outline-container-h:b28d3214-bf27-4638-9368-4fc4c7d0c5b4" class="outline-3">
<h3 id="h:b28d3214-bf27-4638-9368-4fc4c7d0c5b4">å¿«ç…§</h3>
<div class="outline-text-3" id="text-h:b28d3214-bf27-4638-9368-4fc4c7d0c5b4">
<p>
ä¼˜åŒ–æˆæœ¬ï¼šè´­ä¹°é¢„ä»˜è´¹å­˜å‚¨åŒ…ã€‚
</p>


<figure id="org2d14355">
<img src="./images/image-20210421142831950.png" alt="image-20210421142831950.png">

</figure>

<p>
å¿«ç…§æ•°æ®ç‹¬ç«‹å­˜å‚¨ï¼Œå­˜å‚¨è´¹ç”¨å¯ä½¿ç”¨OSSæ ‡å‡†ï¼ˆLRSï¼‰å­˜å‚¨åŒ…æŠµæ‰£ã€‚å½“æ‚¨è´­ä¹°äº†OSSæ ‡å‡†ï¼ˆLRSï¼‰å­˜å‚¨åŒ…åï¼Œåœ¨æœ‰æ•ˆæœŸå†…ï¼Œå­˜å‚¨åŒ…ä¼šè‡ªåŠ¨æŒ‰å®¹é‡æŠµæ‰£å¿«ç…§è´¹ç”¨ã€‚
</p>
</div>
</div>
<div id="outline-container-h:75b6da24-e73e-4cfc-a8ab-1f8590ef7774" class="outline-3">
<h3 id="h:75b6da24-e73e-4cfc-a8ab-1f8590ef7774">ç³»ç»Ÿæ•‘æ´</h3>
<div class="outline-text-3" id="text-h:75b6da24-e73e-4cfc-a8ab-1f8590ef7774">
<p>
aws ec2
</p>

<p>
I executed yum -y update, disconnected in the middle, restarting the machine can't start
</p>

<p>
æ‚¨å¯ä»¥ä»æœ€è¿‘çš„å¤‡ä»½ä¸­æ¢å¤ï¼Œæˆ–è€…æ‚¨éœ€è¦è¿›è¡Œæ•…éšœæ’é™¤å’Œä¿®å¤ã€‚ ä»å¤‡ä»½æ¢å¤æ›´å¿«æ›´å®¹æ˜“ï¼Œä½†å…¶ä»–é€‰é¡¹ä¹Ÿå¯ä»¥å·¥ä½œ
</p>

<p>
æ‚¨ä¸ºæ­¤å®ä¾‹æ‹¥æœ‰çš„å¸æˆ·å’Œå”¯ä¸€å¤‡ä»½æ˜¯ä» 2021 å¹´ 9 æœˆ 29 æ—¥å¼€å§‹çš„ã€‚æˆ‘è®¤ä¸ºé‚£å¤ªè¿œäº†
</p>

<p>
æ•‘æ´æ¨¡å¼
</p>
<ol class="org-ol">
<li>é¦–å…ˆï¼Œè¯·åœ¨ ap-south-1b å¯ç”¨åŒºå¯åŠ¨ä¸€ä¸ªæ•‘æ´å®ä¾‹ï¼Œä½¿ç”¨ Amazon Linux 2 çš„ t2.micro ç±»å‹ã€‚æ³¨æ„ç½‘ç»œã€å®‰å…¨ç»„ä¿æŒä¸€è‡´ã€‚</li>
<li>åœæ­¢æŸåçš„å®ä¾‹å¹¶åˆ†ç¦»æ ¹å·ã€‚ç„¶åæŒ‚è½½ä¼šæ•‘æ´å®ä¾‹ä¸Šã€‚</li>
<li>åœ¨æ•‘æ´å®ä¾‹æ‰§è¡Œå¦‚ä¸‹æ“ä½œ</li>
</ol>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#30830;&#35748;&#22351;&#21367;&#24050;&#38468;&#21152;&#21040;&#25937;&#25588;&#23454;&#20363;</span>
10:50:20 AM jasper.xu: [root@ip-172-21-38-206 data]# lsblk
NAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
xvda    202:0    0    8G  0 disk
&#9492;&#9472;xvda1 202:1    0    8G  0 part /
xvdf    202:80   0  100G  0 disk
&#9492;&#9472;xvdf1 202:81   0  100G  0 part /data

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25346;&#36733;</span>
mkdir /mnt/old
mount -t xfs -o nouuid /dev/xvdf1 /mnt/old
cat /mnt/old/etc/fstab
11:32:16 AM jasper.xu: <span style="color: #a0522d;">UUID</span>=eaadd3f0-e151-4950-a4ba-49ae6f413224 /                       xfs     defaults        0 0

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312;&#25937;&#25588;&#23454;&#20363;&#26681;&#30446;&#24405;&#20013;</span>
<span style="color: #483d8b;">cd</span> /
<span style="color: #a020f0;">for</span> i<span style="color: #a020f0;"> in</span> dev proc sys run; <span style="color: #a020f0;">do</span> mount -o bind /$<span style="color: #a0522d;">i</span> /mnt/old/$<span style="color: #a0522d;">i</span>; <span style="color: #a020f0;">done</span>
chroot /mnt/old   <span style="color: #b22222;">#</span><span style="color: #b22222;">uname -r &#23558;&#21453;&#26144;&#25937;&#25588;&#23454;&#20363;&#20013;&#30340;&#20869;&#26680;</span>
grub2-mkconfig -o /boot/grub2/grub.cfg
sed -i <span style="color: #8b2252;">'s/GRUB_DEFAULT=0/GRUB_DEFAULT=saved/g'</span> /etc/default/grub
[root@ip-172-21-38-206 /]# sudo grub2-mkconfig -o /boot/grub2/grub.cfg
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-3.10.0-1160.53.1.el7.x86_64
Found linux image: /boot/vmlinuz-3.10.0-862.14.4.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-862.14.4.el7.x86_64.img
Found linux image: /boot/vmlinuz-3.10.0-862.2.3.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-862.2.3.el7.x86_64.img
Found linux image: /boot/vmlinuz-0-rescue-5b3e73494c0f9aac8764a045f4a3a8f5
Found initrd image: /boot/initramfs-0-rescue-5b3e73494c0f9aac8764a045f4a3a8f5.img

grub2-set-default 1

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21368;&#36733;&#21367;</span>
<span style="color: #a020f0;">for</span> i<span style="color: #a020f0;"> in</span> dev proc sys run; <span style="color: #a020f0;">do</span> sudo umount /mnt/old/$<span style="color: #a0522d;">i</span>; <span style="color: #a020f0;">done</span>
</pre>
</div>

<ol class="org-ol">
<li>è¯·ç«‹å³ä»æ•‘æ´å®ä¾‹ä¸­åˆ†ç¦»æ­¤å·ï¼Œé™„åŠ åˆ°æ‚¨çš„æ—§å®ä¾‹å¹¶å¯åŠ¨å®ä¾‹</li>
</ol>

<p>
start succesful  kernel 3.10.0-862.14.4.el7.x86_64
</p>

<ol class="org-ol">
<li>å‡çº§å†…æ ¸</li>
</ol>

<div class="org-src-container">
<pre class="src src-sh">sudo rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org 
rpm -Uvh https://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm 
yum list available --disablerepo=<span style="color: #8b2252;">'*'</span> --enablerepo=elrepo-kernel
elrepo-release.noarch                                                                                 7.0-5.el7.elrepo                                                                         elrepo-kernel
kernel-lt.x86_64                                                                                      5.4.181-1.el7.elrepo                                                                     elrepo-kernel

sudo yum --enablerepo=elrepo-kernel install kernel-lt
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#39318;&#20808;&#26597;&#30475;&#24403;&#21069;&#31995;&#32479;&#26377;&#20960;&#20010;&#20869;&#26680;&#12290;&#27604;&#22914;&#65306;</span>
cat /boot/grub2/grub.cfg |grep menuentry 
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#40664;&#35748;&#30340;&#21551;&#21160;&#20869;&#26680;</span>
grub2-set-default <span style="color: #8b2252;">"CentOS Linux (5.4.181-1.el7.elrepo.x86_64) 7 (Core)"</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#39564;&#35777;&#26159;&#21542;&#20462;&#25913;&#25104;&#21151;</span>
grub2-editenv list
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#37325;&#21551;&#26426;&#22120;&#35266;&#23519;</span>
reboot
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:ec0cf84d-6a64-449c-bf2b-4c8d575825c2" class="outline-2">
<h2 id="h:ec0cf84d-6a64-449c-bf2b-4c8d575825c2">SLB</h2>
<div class="outline-text-2" id="text-h:ec0cf84d-6a64-449c-bf2b-4c8d575825c2">
<p>
<b>å®ä¾‹ç±»å‹å¯¹åº”ç›‘æ§æŒ‡æ ‡</b>
</p>

<p>
SLBï¼š æœ€å¤§è¿æ¥æ•°ï¼ˆç§’ï¼‰    æ¯ç§’æ–°å»ºè¿æ¥æ•°ï¼ˆCPSï¼‰    æ¯ç§’æŸ¥è¯¢æ•°ï¼ˆQPSï¼‰
</p>

<p>
ç›‘æ§ï¼šæ¯ç§’æœ€å¤§å¹¶å‘è¿æ¥æ•°  æ¯ç§’æ–°å»ºè¿æ¥æ•°
</p>

<p>
ä¸ƒå±‚æ‰æœ‰QPSçš„æ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯æ¯ç§’å¯ä»¥å®Œæˆçš„HTTP/HTTPSçš„æŸ¥è¯¢ï¼ˆè¯·æ±‚ï¼‰çš„æ•°é‡ã€‚å½“è¯·æ±‚é€Ÿç‡è¶…è¿‡è§„æ ¼æ‰€å®šä¹‰çš„æ¯ç§’æŸ¥è¯¢æ•°æ—¶ï¼Œæ–°å»ºè¿æ¥è¯·æ±‚å°†è¢«ä¸¢å¼ƒã€‚å¯¹åº”ç›‘æ§è§æˆªå›¾ï¼š
</p>


<p>
1.æœ€å¤§å¹¶å‘è¿æ¥æ•°å¯¹åº”SLBå®ä¾‹è§„åˆ™ä¸­æœ€å¤§è¿æ¥æ•°,æ´»è·ƒè¿æ¥æ•°æŒ‡establishedçŠ¶æ€çš„è¿æ¥ï¼Œéæ´»è·ƒè¿æ¥æŒ‡é™¤äº†establishedçŠ¶æ€çš„è¿æ¥ã€‚
</p>

<p>
2.ä¸ƒå±‚æ‰æœ‰QPSçš„æ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯æ¯ç§’å¯ä»¥å®Œæˆçš„HTTP/HTTPSçš„æŸ¥è¯¢ï¼ˆè¯·æ±‚ï¼‰çš„æ•°é‡ã€‚å½“è¯·æ±‚é€Ÿç‡è¶…è¿‡è§„æ ¼æ‰€å®šä¹‰çš„æ¯ç§’æŸ¥è¯¢æ•°æ—¶ï¼Œæ–°å»ºè¿æ¥è¯·æ±‚å°†è¢«ä¸¢å¼ƒã€‚å¯¹åº”ç›‘æ§è§æˆªå›¾
</p>

<p>
3.å¯¹äº4å±‚ç›‘å¬ç«¯å£ï¼Œä¸Šé™æŒ‡æ ‡åªæœ‰æœ€å¤§è¿æ¥æ•° æ¯ç§’æ–°å»ºè¿æ¥æ•°ï¼ˆCPS)
</p>

<p>
å’±ä»¬slbæ˜¯4å±‚çš„4wå¤šæ˜¯ç¬¬ç§’æœ€å¤§è¿æ¥æ•°æ—¢æœ€å¤§å¹¶å‘æ•°ï¼ŒQpsæ˜¯æ¯ç§’æŸ¥è¯¢æ•°å±äº7å±‚åè®®
</p>
</div>
</section>
<section id="outline-container-h:68550704-8745-4a17-abb1-372e222c5e24" class="outline-2">
<h2 id="h:68550704-8745-4a17-abb1-372e222c5e24">ç½‘ç»œäº’é€š</h2>
<div class="outline-text-2" id="text-h:68550704-8745-4a17-abb1-372e222c5e24">
</div>
<div id="outline-container-h:72f842d6-c271-4b4c-8287-1b018177cce9" class="outline-3">
<h3 id="h:72f842d6-c271-4b4c-8287-1b018177cce9">å…¬å¸ä¸é˜¿é‡Œæ–°åŠ å¡äº’é€š vpn-ipsec</h3>
<div class="outline-text-3" id="text-h:72f842d6-c271-4b4c-8287-1b018177cce9">
<p>
å‚è€ƒæ•™ç¨‹ï¼š<a href="https://help.aliyun.com/document_detail/65279.html?spm=a2c4g.11186623.6.552.3c94466aIf33LR">https://help.aliyun.com/document_detail/65279.html?spm=a2c4g.11186623.6.552.3c94466aIf33LR</a>
</p>


<figure id="org6123397">
<img src="./images/image-20210315171448865.png" alt="image-20210315171448865.png">

</figure>

<ul class="org-ul">
<li>åˆ›å»ºVPNç½‘å…³ï¼šæ–°åŠ çš„VPCå…¬ç½‘VPN</li>
<li>åˆ›å»ºç”¨æˆ·ç½‘å…³ï¼šå…¬å¸æœ¬åœ°ç½‘å…³çš„ä¿¡æ¯</li>
<li>åˆ›å»ºIPsecè¿æ¥ï¼šVPNç½‘å…³å’Œç”¨æˆ·ç½‘å…³å»ºç«‹è¿æ¥åçš„VPNé€šé“ã€‚</li>
</ul>

<pre class="example" id="orgb1a2b25">
{
  "LocalSubnet": "10.0.0.0/14",
  "RemoteSubnet": "10.18.0.0/16",
  "IpsecConfig": {
    "IpsecPfs": "group1",
    "IpsecEncAlg": "des",
    "IpsecAuthAlg": "sha1",
    "IpsecLifetime": 86400
  },
  "Local": "211.103.135.97",
  "Remote": "161.117.252.191",
  "IkeConfig": {
    "IkeAuthAlg": "sha1",
    "LocalId": "211.103.135.97",
    "IkeEncAlg": "des",
    "IkeVersion": "ikev1",
    "IkeMode": "main",
    "IkeLifetime": 86400,
    "RemoteId": "161.117.252.191",
    "Psk": "123456",
    "IkePfs": "group1"
  }
}
</pre>

<ul class="org-ul">
<li>é…ç½®æœ¬åœ°ç½‘å…³ï¼šæœ¬åœ°VPNç½‘å…³è®¾å¤‡ä¸­åŠ è½½é˜¿é‡Œäº‘VPNç½‘å…³çš„é…ç½®ã€‚å…¬å¸ç”±ITä¸­å¿ƒäººå‘˜åœ¨è·¯ç”±H3Cä¸Šè®¾ç½®</li>
<li>é…ç½®VPNç½‘å…³è·¯ç”±ï¼šåœ¨VPNç½‘å…³ä¸­é…ç½®ç­–ç•¥è·¯ç”±è¡¨ï¼Œå¹¶å‘å¸ƒåˆ°VPCè·¯ç”±è¡¨ä¸­ã€‚æºé˜¿é‡Œæ–°åŠ å¡VPC10.18.0.0/16ï¼Œç›®æ ‡ç½‘æ®µå…¬å¸10.0.0.0/14</li>
</ul>


<figure id="org00798fb">
<img src="./images/vpn.png" alt="vpn.png">

</figure>

<ul class="org-ul">
<li>æµ‹è¯•è®¿é—®</li>
</ul>

<p>
ç™»å½•åˆ°é˜¿é‡Œäº‘VPCå†…ä¸€å°æ— å…¬ç½‘IPçš„ECSå®ä¾‹ï¼Œé€šè¿‡pingæœ¬åœ°IDCå†…ä¸€å°æœåŠ¡å™¨çš„ç§ç½‘IPåœ°å€ï¼ŒéªŒè¯é€šä¿¡æ˜¯å¦æ­£å¸¸ã€‚
</p>
</div>
</div>
<div id="outline-container-h:e656902e-b1d3-4b4d-9bd4-d47d0cded1db" class="outline-3">
<h3 id="h:e656902e-b1d3-4b4d-9bd4-d47d0cded1db">é˜¿é‡Œæ–°åŠ å¡æœºæˆ¿VPCä¸é˜¿é‡ŒååŒ—2æœºæˆ¿VPCç½‘ç»œäº’é€š-é«˜é€Ÿé€šé“</h3>
<div class="outline-text-3" id="text-h:e656902e-b1d3-4b4d-9bd4-d47d0cded1db">
<ol class="org-ol">
<li>å¼€é€šäº‘ä¼ä¸šäº‘</li>
<li>å°†2ä¸ªæœºæˆ¿æœºçš„vpcåŠ å…¥åˆ°äº‘ä¼ä¸šç½‘</li>
<li>è´­ä¹°è·¨å¢ƒå¸¦å®½åŒ…ã€‚æ³¨æ„è¿™ä¸ªéœ€è¦å‘é˜¿é‡Œæäº¤ä¼ä¸šå®¡æŸ¥ã€‚</li>
<li>è·¨åœ°åŸŸäº’é€šå¸¦å®½ç®¡ç†ã€‚é€‰æ‹©ååŒ—ä¸æ–°åŠ å¡äº’é€šå¸¦å®½ã€‚</li>
<li>é…ç½®äº’é€šç½‘æ®µ</li>
</ol>

<p>
éœ€è¦åœ¨æ–°åŠ å¡ä¾§å…¥åœ°åŸŸç½‘å…³ï¼Œå…ˆåšå…è®¸åŒ—äº¬vpcå®ä¾‹ï¼Œåªå…è®¸ç²¾ç¡®åŒ¹é…10.16.205.0/24ï¼›ç„¶åå†åšæ‹’ç»åŒ—äº¬vpcå®ä¾‹ï¼Œæ¨¡ç³ŠåŒ¹é…vpcçš„å¤§ç½‘æ®µ10.16.0.0/16ã€‚å¦‚æœä¸åŒvpcåº”è¯¥ä½ æºå®ä¾‹IDè¡¨å†åŠ éœ€è¦æ¨¡ç³Šæ‹’ç»çš„vpcå®ä¾‹ã€‚
</p>


<figure id="orgeab9fd2">
<img src="./images/vpn1.png" alt="vpn1.png">

</figure>
</div>
</div>
<div id="outline-container-h:f10042f9-5249-47ba-a1db-d33e6bb1c18a" class="outline-3">
<h3 id="h:f10042f9-5249-47ba-a1db-d33e6bb1c18a">é˜¿é‡Œæ–°åŠ å¡æœºæˆ¿VPCä¸é˜¿é‡ŒååŒ—2æœºæˆ¿VPCç½‘ç»œäº’é€š-vpn-ipsecä¸´æ—¶æ–¹æ¡ˆ</h3>
<div class="outline-text-3" id="text-h:f10042f9-5249-47ba-a1db-d33e6bb1c18a">
<p>
åˆ†åˆ«åœ¨æ–°åŠ å¡ä¸ååŒ—2æœºæˆ¿åˆ›å»ºvpn-ipsecï¼Œæ³¨æ„è¿™é‡Œçš„ç”¨æˆ·ç½‘å…³æ˜¯å¯¹ç«¯çš„ç½‘å…³åœ°å€ï¼Œå³æ–°åŠ å¡ç”¨æˆ·ç½‘å…³é…ç½®ä¸ºååŒ—2 SNATå‡ºå£ipï¼ŒååŒ—2ç”¨æˆ·ç½‘å…³é…ç½®ä¸º æ–°åŠ å¡ SNATå‡ºå£ipï¼Œ
</p>
</div>
</div>
<div id="outline-container-h:862229a2-be97-49d4-8218-12070382d8cd" class="outline-3">
<h3 id="h:862229a2-be97-49d4-8218-12070382d8cd">é˜¿é‡Œäº‘vpcä¸äºšé©¬é€Švpcäº’é€š-vpn</h3>
<div class="outline-text-3" id="text-h:862229a2-be97-49d4-8218-12070382d8cd">
<p>
<b>é˜¿é‡Œäº‘</b>
</p>

<ul class="org-ul">
<li><p>
åˆ›å»ºVPNç½‘å…³ï¼šæ–°åŠ å¡VPCå…¬ç½‘VPN
</p>

<p>
47.94.150.81
</p></li>
</ul>

<p>
<b>äºšé©¬é€Š</b>
</p>

<ul class="org-ul">
<li>åˆ›å»ºå®¢æˆ·ç½‘å…³ï¼šipä¸ºé˜¿é‡Œäº‘vpnç½‘å…³ip</li>
</ul>


<figure id="org9244f89">
<img src="./images/image-20210315171622515.png" alt="image-20210315171622515.png">

</figure>

<p>
47.94.150.81
</p>

<ul class="org-ul">
<li>åˆ›å»ºç§æœ‰ç½‘å…³ï¼šåˆ›å»ºå¥½åä¸vpcç»‘å®š</li>
<li>åˆ›å»ºç«™ç‚¹åˆ°ç«™ç‚¹VPNè¿æ¥ï¼š</li>
</ul>

<p>
VPNè¿æ¥ä¸­çš„é…ç½®
</p>

<p>
1.è·¯ç”±é€‰é¡¹ä¸­ä½¿ç”¨é™æ€IPå‰ç¼€ï¼Œè¿™é‡Œå¡«å†™è¦äº’é€šçš„é˜¿é‡ŒVPCç½‘æ®µ
</p>


<figure id="orgdd840ff">
<img src="./images/image-20210315171641729.png" alt="image-20210315171641729.png">

</figure>

<p>
å…¶å®ƒé»˜è®¤å³å¯
</p>

<p>
2.åˆ›å»ºå¥½åå¯åœ¨Tunnel Stateçœ‹åˆ°å¤–é¢ipåœ°å€ï¼Œé€‰é¡¹å…¶ä¸­ä¸€ä¸ªåšä¸ºé˜¿é‡Œäº‘çš„ç”¨æˆ·ç½‘å…³
</p>


<figure id="orgb1f0f90">
<img src="./images/image-20210315171654657.png" alt="image-20210315171654657.png">

</figure>

<p>
è¿™é‡Œ13.250.188.18
</p>

<p>
3.åœ¨VPNè¿æ¥é¡µé¢ä¸Šç‚¹å‡»â€œä¸‹è½½é…ç½®â€ï¼Œè·å–åŒæ–¹ä¸€è‡´çš„é€šä¿¡è®¤è¯é…ç½®
</p>


<figure id="orgc4d798f">
<img src="./images/image-20210315171728033.png" alt="image-20210315171728033.png">

</figure>

<pre class="example" id="org037eb94">
ike proposal 200
  encryption-algorithm aes-cbc
  authentication-method pre-share
  dh group2
  sa duration 28800
  authentication-algorithm sha
quit

...
ike peer peervpn1
  remote-address 13.250.188.18
  pre-shared-key jAlnufeIfGG6nK5FWODmLfdAy2Omqdtr
  exchange-mode main
  proposal 200
  dpd dpdvpn1
quit

...
psec transform-set ipsec-prop-vpn1 
  encapsulation-mode tunnel
  esp encryption-algorithm aes-cbc-128
  esp authentication-algorithm sha1
quit
....
ipsec profile ipsecvpn1
  ike-peer peervpn1		
  pfs dh-group2
  sa duration time-based 3600
  transform-set ipsec-prop-vpn1
quit
</pre>

<p>
<b>é˜¿é‡Œäº‘</b>
</p>

<ul class="org-ul">
<li>åˆ›å»ºç”¨æˆ·ç½‘å…³ï¼šäºšé©¬é€Šç½‘å…³çš„ä¿¡æ¯</li>
</ul>

<p>
13.250.188.18
</p>

<ul class="org-ul">
<li>åˆ›å»ºIPsecè¿æ¥ï¼šVPNç½‘å…³å’Œç”¨æˆ·ç½‘å…³å»ºç«‹è¿æ¥åçš„VPNé€šé“ã€‚</li>
</ul>

<pre class="example" id="orgc8cdd95">
{
  "LocalSubnet": "0.0.0.0/0",
  "RemoteSubnet": "0.0.0.0/0",
  "IpsecConfig": {
    "IpsecPfs": "group2",
    "IpsecEncAlg": "aes",
    "IpsecAuthAlg": "sha1",
    "IpsecLifetime": 3600
  },
  "Local": "13.250.188.18",
  "Remote": "47.94.150.81",
  "IkeConfig": {
    "IkeAuthAlg": "sha1",
    "LocalId": "13.250.188.18",
    "IkeEncAlg": "aes",
    "IkeVersion": "ikev1",
    "IkeMode": "main",
    "IkeLifetime": 28800,
    "RemoteId": "47.94.150.81",
    "Psk": "jAlnufeIfGG6nK5FWODmLfdAy2Omqdtr",
    "IkePfs": "group2"
  }
}
</pre>

<ul class="org-ul">
<li>é…ç½®VPNç½‘å…³è·¯ç”±ï¼šåœ¨VPNç½‘å…³ä¸­é…ç½®ç›®æ ‡è·¯ç”±ï¼Œå¹¶å‘å¸ƒåˆ°VPCè·¯ç”±è¡¨ä¸­ã€‚</li>
</ul>


<figure id="orgb9ab90f">
<img src="./images/image-20210315171747160.png" alt="image-20210315171747160.png">

</figure>

<p>
ç›®æ ‡è·¯ç”±ï¼šäºšé©¬é€Šç½‘æ®µ
</p>
</div>
</div>
</section>
<section id="outline-container-h:91dbdadb-e61e-4de4-bf90-202c2b815ab6" class="outline-2">
<h2 id="h:91dbdadb-e61e-4de4-bf90-202c2b815ab6">OSS</h2>
<div class="outline-text-2" id="text-h:91dbdadb-e61e-4de4-bf90-202c2b815ab6">
<p>
<b>å¦‚ä½•é€‰ç”¨NASã€OSSå’ŒEBS</b>
</p>

<p>
æœ¬æ–‡ä»‹ç»é˜¿é‡Œäº‘æ–‡ä»¶å­˜å‚¨NASä¸é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨OSSã€é˜¿é‡Œäº‘å—å­˜å‚¨EBSçš„åŒºåˆ«ï¼Œå¸®åŠ©æ‚¨æ›´å¥½åœ°é€‰ç”¨é˜¿é‡Œäº‘æ–‡ä»¶å­˜å‚¨NASã€‚
</p>

<p>
æ–‡ä»¶å­˜å‚¨NASæä¾›ç®€å•ã€å¯ä¼¸ç¼©å¼¹æ€§çš„å…±äº«æ–‡ä»¶å­˜å‚¨ï¼Œé…åˆäº‘æœåŠ¡å™¨ECSå¼¹æ€§è®¡ç®—æœåŠ¡æ„å»ºä¸šåŠ¡ç³»ç»Ÿã€‚ å½“æ‚¨é€‰æ‹©ä½¿ç”¨æ–‡ä»¶å­˜å‚¨NASã€å¯¹è±¡å­˜å‚¨OSSæˆ–å—å­˜å‚¨EBSéƒ¨ç½²åº”ç”¨ç¨‹åºæ—¶ï¼Œéœ€è¦è€ƒè™‘è¯¸å¤šå› ç´ ã€‚æœ¬æ–‡ä»‹ç»æ–‡ä»¶å­˜å‚¨NASä¸å¯¹è±¡å­˜å‚¨OSSã€å—å­˜å‚¨EBSçš„åŒºåˆ«ï¼Œå¸®åŠ©æ‚¨æ›´å¥½åœ°è¿›è¡Œé€‰æ‹©ã€‚
</p>


<figure id="org8d6ba43">
<img src="./images/image-20210315141920570.png" alt="image-20210315141920570.png">

</figure>

<p>
æ–‡ä»¶å­˜å‚¨NASå’Œå¯¹è±¡å­˜å‚¨OSSæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ
</p>

<p>
æ–‡ä»¶å­˜å‚¨NASå’Œå¯¹è±¡å­˜å‚¨OSSçš„ä¸»è¦åŒºåˆ«ï¼šæ‚¨æ— éœ€ä¿®æ”¹åº”ç”¨ï¼Œå³å¯ç›´æ¥åƒè®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸€æ ·è®¿é—®æ–‡ä»¶å­˜å‚¨NASã€‚æ–‡ä»¶å­˜å‚¨NASæä¾›é«˜ååå’Œé«˜IOPSçš„åŒæ—¶æ”¯æŒæ–‡ä»¶çš„éšæœºè¯»å†™å’Œåœ¨çº¿ä¿®æ”¹ã€‚
</p>

<p>
å¯¹è±¡å­˜å‚¨OSSæ˜¯æ¯”è¾ƒæ–°çš„å­˜å‚¨ç±»å‹ï¼Œç›¸å¯¹äºæ–‡ä»¶å­˜å‚¨ç›®å½•æ ‘çš„ç»„ç»‡å½¢å¼ï¼Œå¯¹è±¡å­˜å‚¨OSSé‡‡ç”¨æ‰å¹³çš„æ–‡ä»¶ç»„ç»‡å½¢å¼ï¼Œé‡‡ç”¨RESTFul APIæ¥å£è®¿é—®ï¼Œä¸æ”¯æŒæ–‡ä»¶éšæœºè¯»å†™ï¼Œä¸»è¦é€‚ç”¨äºäº’è”ç½‘æ¶æ„çš„æµ·é‡æ•°æ®çš„ä¸Šä¼ ä¸‹è½½å’Œåˆ†å‘ã€‚
</p>

<p>
æ–‡ä»¶å­˜å‚¨NASå’Œå—å­˜å‚¨EBSæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ
</p>

<p>
æ–‡ä»¶å­˜å‚¨NASç›¸å¯¹äºå—å­˜å‚¨EBSçš„ä¸»è¦åŒºåˆ«ï¼šæ–‡ä»¶å­˜å‚¨NASå¯ä»¥åŒæ—¶æ”¯æŒä¸Šåƒä¸ªECSå®¢æˆ·ç«¯åŒæ—¶å…±äº«è®¿é—®ï¼Œæä¾›é«˜ååé‡ã€‚
</p>

<p>
å—å­˜å‚¨EBSæ˜¯è£¸ç£ç›˜ï¼ŒæŒ‚è½½åˆ°ECSåä¸èƒ½è¢«æ“ä½œç³»ç»Ÿåº”ç”¨ç›´æ¥è®¿é—®ï¼Œéœ€è¦æ ¼å¼åŒ–æˆæ–‡ä»¶ç³»ç»Ÿï¼ˆext3ã€ext4ã€NTFSç­‰ï¼‰åæ‰èƒ½è¢«è®¿é—®ã€‚å—å­˜å‚¨EBSçš„ä¼˜åŠ¿æ˜¯æ€§èƒ½é«˜ã€æ—¶å»¶ä½ï¼Œé€‚åˆäºOLTPæ•°æ®åº“ã€NoSQLæ•°æ®åº“ç­‰IOå¯†é›†å‹çš„é«˜æ€§èƒ½ã€ä½æ—¶å»¶åº”ç”¨å·¥ä½œè´Ÿè½½ã€‚ä½†æ˜¯å—å­˜å‚¨EBSæ— æ³•å®¹é‡å¼¹æ€§æ‰©å±•ï¼Œå•ç›˜æœ€å¤§åªèƒ½32TBï¼Œå¹¶ä¸”å¯¹å…±äº«è®¿é—®çš„æ”¯æŒæœ‰é™ï¼Œéœ€è¦é…åˆç±»Oracle RACã€WSFC Windowsæ•…éšœè½¬ç§»é›†ç¾¤ç­‰é›†ç¾¤ç®¡ç†è½¯ä»¶æ‰èƒ½è¿›è¡Œå…±äº«è®¿é—®ã€‚å› æ­¤ï¼Œå—å­˜å‚¨EBSä¸»è¦è¿˜æ˜¯é’ˆå¯¹å•ECSçš„é«˜æ€§èƒ½ï¼Œä½æ—¶å»¶çš„å­˜å‚¨äº§å“ã€‚
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">å­˜å‚¨äº§å“</td>
<td class="org-left">æ—¶å»¶</td>
<td class="org-left">åå</td>
<td class="org-left">è®¿é—®æ¨¡å¼</td>
</tr>

<tr>
<td class="org-left">æ–‡ä»¶å­˜å‚¨NAS</td>
<td class="org-left">ä½æ—¶å»¶ï¼ˆæ¯«ç§’çº§ï¼‰</td>
<td class="org-left">æ•°ç™¾Gbps</td>
<td class="org-left">ä¸Šåƒä¸ªECSé€šè¿‡POSIXæ¥å£å¹¶å‘è®¿é—®ï¼Œéšæœºè¯»å†™</td>
</tr>

<tr>
<td class="org-left">å¯¹è±¡å­˜å‚¨OSS</td>
<td class="org-left">è¾ƒä½æ—¶å»¶ï¼ˆå‡ åæ¯«ç§’çº§ï¼‰</td>
<td class="org-left">æ•°ç™¾Gbps</td>
<td class="org-left">æ•°ç™¾ä¸‡å®¢æˆ·ç«¯é€šè¿‡WEBå¹¶å‘ï¼Œè¿½åŠ å†™</td>
</tr>

<tr>
<td class="org-left">å—å­˜å‚¨EBS</td>
<td class="org-left">æä½æ—¶å»¶ï¼ˆå¾®ç§’çº§ï¼‰</td>
<td class="org-left">æ•°åGbps</td>
<td class="org-left">å•ECSé€šè¿‡POSIXæ¥å£è®¿é—®ï¼Œéšæœºè¯»å†™</td>
</tr>
</tbody>
</table>
</div>
<div id="outline-container-h:b203d2f6-379d-4294-b589-1b8e492e974e" class="outline-3">
<h3 id="h:b203d2f6-379d-4294-b589-1b8e492e974e">è§£å†»è½¬æ¢æ–‡ä»¶ç±»å‹</h3>
<div class="outline-text-3" id="text-h:b203d2f6-379d-4294-b589-1b8e492e974e">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#  </span><span style="color: #b22222;">cat oss_changefile.sh </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/env bash</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">1&#12289;&#35299;&#20923;&#36164;&#28304; </span>
./ossutil64 restore oss://cici-result-video/ -r  -f
sleep 300
<span style="color: #b22222;">#</span><span style="color: #b22222;">2&#12289;&#26356;&#26032;set-meta&#20540;&#65292;&#36825;&#20010;&#26159;&#26356;&#26032;&#26080;&#35770;&#26159;&#24402;&#26723;&#36824;&#26159;&#20302;&#39057;&#65292;&#37117;&#36716;&#25442;&#25104;&#26631;&#20934;</span>
./ossutil64 set-meta oss://cici-result-video/ -r X-Oss-Storage-Class:Standard --update  -j 5000 --retry-times 3 --loglevel=debug 
</pre>
</div>
</div>
</div>
<div id="outline-container-h:eb28fad8-869e-455b-84c6-14c410b47bb3" class="outline-3">
<h3 id="h:eb28fad8-869e-455b-84c6-14c410b47bb3">ossfsæ–‡ä»¶æŒ‚è½½</h3>
<div class="outline-text-3" id="text-h:eb28fad8-869e-455b-84c6-14c410b47bb3">
<p>
å‚è€ƒï¼š
<a href="https://help.aliyun.com/document_detail/32196.html?spm=5176.product31815.6.1041.uGNIMY">https://help.aliyun.com/document_detail/32196.html?spm=5176.product31815.6.1041.uGNIMY</a>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#19979;&#36733;&#23433;&#35013;&#21253;</span>
wget http://gosspublic.alicdn.com/ossfs/ossfs_1.80.6_centos7.0_x86_64.rpm
yum localinstall ossfs_1.80.6_centos7.0_x86_64.rpm  -y

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37197;&#32622;&#36134;&#21495;&#35775;&#38382;&#20449;&#24687;</span>
cat &lt;&lt;\EOF&gt; /etc/passwd-ossfs 
<span style="color: #ffa54f;">cici-log-backup:LTxx5G:iJsmWZxxSvgz</span>
<span style="color: #ffa54f;">EOF</span>
chmod 640 /etc/passwd-ossfs


<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;Bucket&#25346;&#36733;&#21040;&#25351;&#23450;&#30446;&#24405;</span>
mkdir /OSS
/usr/local/bin/ossfs cici-log-backup /OSS -ourl=oss-cn-beijing-internal.aliyuncs.com -o allow_other -oumask=002

df -h

<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">'/usr/local/bin/ossfs cici-log-backup /OSS -ourl=oss-cn-beijing-internal.aliyuncs.com -o allow_other -oumask=002'</span>  &gt;&gt; /etc/rc.local

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25346;&#36733;&#27492; bucket:</span>
fusermount -u /tmp/ossfs
</pre>
</div>
</div>
</div>
<div id="outline-container-h:12490673-62e7-4b75-b8f9-58bd31945f2e" class="outline-3">
<h3 id="h:12490673-62e7-4b75-b8f9-58bd31945f2e">OSS è®¿é—®æˆæƒ</h3>
<div class="outline-text-3" id="text-h:12490673-62e7-4b75-b8f9-58bd31945f2e">
<p>
åªå¯¹åä¸º hdzy çš„osså­˜å‚¨ä¸­zone/answer/ å’Œ book_photo_path/ ç›®å½•æœ‰ä¸Šä¼ è¯»æƒé™ï¼Œæ²¡æœ‰åˆ é™¤æƒé™
</p>

<p>
æ³¨æ„å‰åé¡ºåº
</p>
<div class="org-src-container">
<pre class="src src-sh">{
  <span style="color: #8b2252;">"Version"</span>: <span style="color: #8b2252;">"1"</span>,
  <span style="color: #8b2252;">"Statement"</span>: [
    {
      <span style="color: #8b2252;">"Effect"</span>: <span style="color: #8b2252;">"Allow"</span>,
      <span style="color: #8b2252;">"Action"</span>: [
        <span style="color: #8b2252;">"oss:ListBuckets"</span>,
        <span style="color: #8b2252;">"oss:GetBucketAcl"</span>
      ],
      <span style="color: #8b2252;">"Resource"</span>: [
        <span style="color: #8b2252;">"acs:oss:*:*:*"</span>
      ]
    },
    {
      <span style="color: #8b2252;">"Effect"</span>: <span style="color: #8b2252;">"Allow"</span>,
      <span style="color: #8b2252;">"Action"</span>: [
        <span style="color: #8b2252;">"oss:Get*"</span>,
    <span style="color: #8b2252;">"oss:Put*"</span>,
      ],
      <span style="color: #8b2252;">"Resource"</span>: [
        <span style="color: #8b2252;">"acs:oss:*:*:hdzy/zone/answer/*"</span>
      ]
    },
    {
      <span style="color: #8b2252;">"Effect"</span>: <span style="color: #8b2252;">"Allow"</span>,
      <span style="color: #8b2252;">"Action"</span>: [
        <span style="color: #8b2252;">"oss:ListObjects"</span>
      ],
      <span style="color: #8b2252;">"Resource"</span>: [
        <span style="color: #8b2252;">"acs:oss:*:*:hdzy"</span>
      ],
      <span style="color: #8b2252;">"Condition"</span>: {
        <span style="color: #8b2252;">"oss:Delimiter"</span>:<span style="color: #8b2252;">"/"</span>,
        <span style="color: #8b2252;">"StringLike"</span>: {
          <span style="color: #8b2252;">"oss:Prefix"</span>: [
            <span style="color: #8b2252;">""</span>,
            <span style="color: #8b2252;">"zone/"</span>,
            <span style="color: #8b2252;">"zone/answer/*"</span>
          ]
        }
      }
    }
  ]
}
</pre>
</div>


<p>
OSS è®¿é—®æ§åˆ¶
</p>

<p>
1.æˆæƒ RAM ç”¨æˆ·å®Œå…¨ç®¡ç†æŸä¸ª Bucket: myphotos çš„æƒé™ã€‚
</p>

<div class="org-src-container">
<pre class="src src-sh">{
    <span style="color: #8b2252;">"Version"</span>: <span style="color: #8b2252;">"1"</span>,
    <span style="color: #8b2252;">"Statement"</span>: [
        {
            <span style="color: #8b2252;">"Effect"</span>: <span style="color: #8b2252;">"Allow"</span>,
            <span style="color: #8b2252;">"Action"</span>: <span style="color: #8b2252;">"oss:*"</span>,
            <span style="color: #8b2252;">"Resource"</span>: [
                <span style="color: #8b2252;">"acs:oss:*:*:myphotos"</span>,
                <span style="color: #8b2252;">"acs:oss:*:*:myphotos/*"</span>
            ]
        }
    ]
}


2&#65306;&#25480;&#26435; RAM &#29992;&#25143;&#21015;&#20986;&#24182;&#35835;&#21462;&#19968;&#20010; Bucket &#20013;&#30340;&#36164;&#28304;&#12290;
{
    <span style="color: #8b2252;">"Version"</span>: <span style="color: #8b2252;">"1"</span>,
    <span style="color: #8b2252;">"Statement"</span>: [
        {
            <span style="color: #8b2252;">"Effect"</span>: <span style="color: #8b2252;">"Allow"</span>,
            <span style="color: #8b2252;">"Action"</span>: [<span style="color: #8b2252;">"oss:ListObjects"</span>,<span style="color: #8b2252;">"oss:GetObject"</span>],
            <span style="color: #8b2252;">"Resource"</span>: [
                <span style="color: #8b2252;">"acs:oss:*:*:myphotos"</span>,
                <span style="color: #8b2252;">"acs:oss:*:*:myphotos/*"</span>
                ]
        }
    ]
}
</pre>
</div>

<p>
æŸå…¬å¸
</p>

<pre class="example" id="org8e61a57">
{
    "Version": "1",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "oss:ListParts",
                "oss:AbortMultipartUpload",
                "oss:PutObject",
                "oss:GetObject",
                "oss:listObjects",
                "oss:GetBucketReferer",
                "oss:SetBucketReferer",
                "oss:DeleteBucket",
                "oss:CreateBucket",
                "oss:GetBucketAcl"
            ],
            "Resource": [
                "acs:oss:*:*:xjp-cici-app",
                "acs:oss:*:*:xjp-cici-app/*"
            ]
        }
    ]
}
</pre>


<p>
1.åªè®¿é—®å’Œç¼–å†™bucket ï¼š mfs-source ä¸­çš„å•ä¸ªç›®å½•
</p>

<p>
åœ¨RAMä¸­é…ç½®æƒé™ç­–ç•¥
</p>

<pre class="example" id="org7a29d05">
{
  "Version": "1",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListBuckets"
      ],
      "Resource": [
        "acs:oss:*:*:*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListObjects"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source"
      ],
      "Condition": {
        "StringLike": {
          "oss:Delimiter": "/",
          "oss:Prefix": [
            "",
            "BackendEditor/*"
          ]
        }
      }
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListObjects"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source"
      ],
      "Condition": {
        "StringLike": {
          "oss:Prefix": [
            "BackendEditor/*"
          ]
        }
      }
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:*"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source/BackendEditor/*"
      ]
    }
  ]
}
</pre>

<p>
2.bukectä¸Šä¼ æŸ¥çœ‹æƒé™ 
</p>

<pre class="example" id="org1a7a3a0">
{
  "Version": "1",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListBuckets",
        "oss:GetBucketAcl"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source",
        "acs:oss:*:*:mfs-source/*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:Get*",
        "oss:Put*"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source",
        "acs:oss:*:*:mfs-source/*"
      ]
    }
  ]
}
</pre>


<p>
3.æ•°æ®åº“å®¡è®¡æƒé™
</p>

<pre class="example" id="orgdb49d2d">
{
  "Statement": [
    {
      "Action": "rds:DescribeSQLLogRecords",
      "Effect": "Allow",
      "Resource": "acs:rds:*:*:dbinstance/rdsjmlwvi81yzyaypa1gb"
    },
    {
      "Action": "rds:DescribeSQLLogRecords",
      "Effect": "Allow",
      "Resource": "*"
    }
  ],
  "Version": "1"
}
</pre>


<p>
4.æ•°æ®åº“æƒé™
</p>

<pre class="example" id="orgff10ae8">
{
  "Version": "1",
  "Statement": [
    {
      "Action": "rds:*",
      "Resource": "acs:rds:*:*:*",
      "Effect": "Allow"
    },
    {
      "Action": "dms:LoginDatabase",
      "Resource": "acs:rds:*:*:dbinstance/rm-bp1o4v71t63p433f2",
      "Effect": "Allow"
    }
  ]
}
</pre>
</div>
</div>
<div id="outline-container-h:4e546697-19c8-4fde-8909-386b7f72593e" class="outline-3">
<h3 id="h:4e546697-19c8-4fde-8909-386b7f72593e">nodejs +OSS STS</h3>
<div class="outline-text-3" id="text-h:4e546697-19c8-4fde-8909-386b7f72593e">
<p>
nodejså®‰è£…
</p>

<pre class="example" id="org58ef03e">
wget https://nodejs.org/dist/v6.10.0/node-v6.10.0-linux-x64.tar.xz
tar xvf node-v6.10.0-linux-x64.tar.xz
ln -sv node-v6.10.0-linux-x64 node

cat &gt;/etc/profile.d/node.sh&lt;&lt;\EOF
export NODE_HOME=/usr/local/node
export PATH=$PATH:$NODE_HOME/bin
export NODE_PATH=$NODE_HOME/lib/node_modules
EOF
source /etc/profile
node  -v

#è®¾ç½® æ·˜å®é•œåƒæº
npm config set registry https://registry.npm.taobao.org

#æŸ¥çœ‹ ä½¿ç”¨çš„ é•œåƒæº
npm config get registry

#å®‰è£… æ·˜å®é•œåƒæº
npm install -g cnpm --registry=https://registry.npm.taobao.org
</pre>

<p>
A simple app server using STS
</p>

<p>
App Serverä¸€èˆ¬ä½œä¸ºä¸€ä¸ªä¼ä¸šçš„åº”ç”¨æœåŠ¡å™¨ï¼Œå®ƒç®¡ç†ç€OSSçš„ AccessKeyId/AccessKeySecretï¼ŒæœåŠ¡äºä¼—å¤šçš„å®¢æˆ·ç«¯ã€‚å½“å®¢æˆ·ç«¯ï¼ˆç§»åŠ¨ç«¯ /Web/Clientç­‰ï¼‰éœ€è¦è®¿é—®OSSæ—¶ï¼Œå®ƒä»¬å‘App Serverè¯·æ±‚ä¸€ä¸ªä¸´æ—¶çš„tokenï¼Œå¹¶ åˆ©ç”¨è¿™ä¸ªtokenä»OSSä¸‹è½½æˆ–è€…å‘OSSä¸Šä¼ æ–‡ä»¶ã€‚
</p>

<p>
App Serverå¯ä»¥å®ç°æ›´å¤æ‚çš„ç­–ç•¥ï¼Œä¸ºä¸åŒçš„å®¢æˆ·ç«¯æä¾›ä¸åŒæƒé™çš„tokenï¼Œéš” ç¦»ä¸åŒçš„å®¢æˆ·ç«¯çš„å­˜å‚¨è·¯å¾„ç­‰ã€‚
</p>

<p>
ä½¿ç”¨å‚è€ƒï¼š<a href="https://help.aliyun.com/document_detail/oss/practice/ram_guide_dir/no_user_accout.html">https://help.aliyun.com/document_detail/oss/practice/ram_guide_dir/no_user_accout.html</a>
</p>

<p>
Run
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">Checkout code</span>
git clone https://github.com/rockuw/node-sts-app-server.git
<span style="color: #483d8b;">cd</span> node-sts-app-server

<span style="color: #b22222;">#</span><span style="color: #b22222;">Install dependencies</span>
npm install

<span style="color: #b22222;">#</span><span style="color: #b22222;">Start server</span>
node index.js

<span style="color: #b22222;">#</span><span style="color: #b22222;">Open in your browser</span>
http://localhost:3000/


vim config.json
{
  <span style="color: #8b2252;">"AccessKeyId"</span> : <span style="color: #8b2252;">"Lxxx"</span>,
  <span style="color: #8b2252;">"AccessKeySecret"</span> : <span style="color: #8b2252;">"IJ8N4S"</span>,
  <span style="color: #8b2252;">"RoleArn"</span> : <span style="color: #8b2252;">"acs:ram::1253088:role/aliyunosstokengeneratorrole"</span>,
  <span style="color: #8b2252;">"TokenExpireTime"</span> : <span style="color: #8b2252;">"900"</span>,
  <span style="color: #8b2252;">"PolicyFile"</span>: <span style="color: #8b2252;">"policy/all_policy.txt"</span>
}
</pre>
</div>


<p>
äº‘æœåŠ¡å™¨ ECS Nodejs é€š è¿‡forever è®¾ç½®åå°è¿è¡ŒåŠ Nodejs é“¾æ¥ MySQL RDS
</p>

<p>
Nodejs åº”ç”¨é€šè¿‡ forever è®¾ç½®åå°è¿è¡Œ
</p>

<p>
é»˜è®¤å¯ä»¥é€šè¿‡ node app.js å¯åŠ¨ nodejs åº”ç”¨ï¼Œå¦‚æœé€€å‡º ssh è¿æ¥ï¼Œåº”ç”¨ä¹Ÿä¼šé€€å‡ºã€‚
</p>

<p>
å¯ä»¥ä½¿ç”¨ Forever æ¥ç®¡ç†å¯åŠ¨ nodejs åº”ç”¨ï¼ŒForever å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ª nodejs çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œèƒ½å¤Ÿå¯åŠ¨ï¼Œåœæ­¢ï¼Œé‡å¯æˆ‘ä»¬çš„ app åº”ç”¨
</p>

<p>
å¦‚åŒå®˜æ–¹çš„æè¿°
</p>

<p>
A simple CLI tool for ensuring that a given script runs continuously (i.e. forever).// ä¸€ä¸ªç”¨æ¥æŒç»­ï¼ˆæˆ–è€…è¯´æ°¸è¿œï¼‰è¿è¡Œä¸€ä¸ªç»™å®šè„šæœ¬çš„ç®€å•çš„å‘½ä»¤è¡Œå·¥å…·
</p>

<div class="org-src-container">
<pre class="src src-sh">&#23433;&#35013;
sudo npm install forever -g <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35760;&#24471;&#21152;-g&#65292;forever&#35201;&#27714;&#23433;&#35013;&#21040;&#20840;&#23616;&#29615;&#22659;&#19979;</span>

&#21551;&#21160;
forever start app.js
forever start -o out.log -e err.log app.js     <span style="color: #b22222;">#</span><span style="color: #b22222;">-o &#26159; console &#36755;&#20986;&#30340;&#26085;&#24535;&#65292;-e &#26159; console.error &#26085;&#24535;</span>
forever list <span style="color: #b22222;">##</span><span style="color: #b22222;">&#26174;&#31034;&#25152;&#26377;&#36816;&#34892;&#30340;&#26381;&#21153;</span>
</pre>
</div>

<p>
å¼€æœºè‡ªå¯åŠ¨å¯ä»¥æ·»åŠ åˆ° /etc/rc.local é‡Œ
</p>

<p>
å¸¸è§çš„å‚æ•°é…ç½®
</p>
<pre class="example" id="org627d279">
-m MAX: è¿è¡ŒæŒ‡å®šè„šæœ¬çš„æ¬¡æ•°
-l LOGFILE: è¾“å‡ºæ—¥å¿—åˆ°LOGFILE
-o OUTFILE: è¾“å‡ºæ§åˆ¶å°ä¿¡æ¯åˆ°OUTFILE
-e ERRFILE: è¾“å‡ºæ§åˆ¶å°é”™è¯¯åœ¨ERRFILE
-p PATH: æ ¹ç›®å½•
-c COMMAND: æ‰§è¡Œå‘½ä»¤ï¼Œé»˜è®¤æ˜¯node
-a, â€“append: åˆå¹¶æ—¥å¿—
-f, â€“fifo: æµå¼æ—¥å¿—è¾“å‡º
-n, â€“number: æ—¥å¿—æ‰“å°è¡Œæ•°
â€“pidFile: pidæ–‡ä»¶
â€“sourceDir: æºä»£ç ç›®å½•
â€“minUptime: æœ€å°spinnæ›´æ–°æ—¶é—´(ms)
â€“spinSleepTime: ä¸¤æ¬¡spiné—´éš”æ—¶é—´
â€“colors: æ§åˆ¶å°è¾“å‡ºç€è‰²
â€“plain: â€“no-colorsçš„åˆ«åï¼Œæ§åˆ¶å°è¾“å‡ºæ— è‰²
-d, â€“debug: debugæ¨¡å¼
-v, â€“verbose: æ‰“å°è¯¦ç»†è¾“å‡º
-s, â€“silent: ä¸æ‰“å°æ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯
-w, â€“watch: ç›‘æ§æ–‡ä»¶æ”¹å˜
â€“watchDirectory: ç›‘æ§é¡¶çº§ç›®å½•
â€“watchIgnore: é€šè¿‡æ¨¡å¼åŒ¹é…å¿½ç•¥ç›‘æ§
--workingDir     The working directory in which SCRIPT will execute
-h, â€“help: å‘½ä»¤è¡Œå¸®åŠ©ä¿¡æ¯
</pre>

<p>
3ç§å®ˆæŠ¤è¿›ç¨‹ä½¿ç”¨åœºåˆä¸å®Œå…¨ä¸€æ ·ã€‚
</p>

<p>
supervisor æ˜¯å¼€å‘ç¯å¢ƒç”¨ã€‚
</p>

<p>
forever ç®¡ç†å¤šä¸ªç«™ç‚¹ï¼Œæ¯ä¸ªç«™è®¿é—®é‡ä¸å¤§ï¼Œä¸éœ€è¦ç›‘æ§ã€‚
</p>

<p>
pm2 ç½‘ç«™è®¿é—®é‡æ¯”è¾ƒå¤§ï¼Œéœ€è¦å®Œæ•´çš„ç›‘æ§ç•Œé¢ã€‚
</p>




<p>
å¯åŠ¨è„šæœ¬ 
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@web04-hd-13083 ~]# cat /etc/init.d/node
<span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/bash</span>
<span style="color: #b22222;">### </span><span style="color: #b22222;">BEGIN INIT INFO</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Provides:       </span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Required-Start:   $all</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Required-Stop:     $all</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Default-Start:     2 3 4 5</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Default-Stop:   0 1 6</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Short-Description: Start daemon at boot time</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Description:     Enable service provided by daemon.</span>
<span style="color: #b22222;">### </span><span style="color: #b22222;">END INIT INFO</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">chkconfig: 345 88 08</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">description: Forever for Node.js</span>

<span style="color: #a0522d;">DEAMON</span>=/usr/local/node-sts-app-server/index.js   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#37324;&#38656;&#35201;&#22635;&#20889;&#20320;&#33258;&#24049;&#30340;Node&#39033;&#30446;&#30340;&#21551;&#21160;&#33050;&#26412;&#25991;&#20214;</span>
<span style="color: #a0522d;">LOG</span>=/usr/local/node-sts-app-server/log/node.log  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#36873;&#65292;&#26085;&#24535;&#25991;&#20214;&#30446;&#24405;</span>
<span style="color: #a0522d;">PID</span>=/usr/local/node-sts-app-server/pid  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24517;&#22635;&#20869;&#23481;&#65292;&#29992;&#20110;&#35760;&#24405;forever&#30340;&#36827;&#31243;&#21495;</span>
<span style="color: #a0522d;">WORKDIR</span>=/usr/local/node-sts-app-server
<span style="color: #a0522d;">USER</span>=operator1
<span style="color: #b22222;">#</span><span style="color: #b22222;">export PATH=$PATH:/usr/local/bin  #&#22312;&#36825;&#37324;&#25351;&#23450;&#19968;&#19979;Node&#30340;&#21487;&#25191;&#34892;&#31243;&#24207;&#23433;&#35013;&#30446;&#24405;&#65292;&#25105;&#30340;&#26159;/usr/local/bin</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">export NODE_PATH=$NODE_PATH:/usr/local/node-sts-app-server/node_modules  #&#36825;&#37324;&#26159;Node&#31867;&#24211;&#30340;&#36335;&#24452;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#24448;&#19979;&#30340;&#20869;&#23481;&#23601;&#19981;&#29992;&#20462;&#25913;&#20102;</span>

<span style="color: #a0522d;">node</span>=node
<span style="color: #a0522d;">forever</span>=forever

<span style="color: #a020f0;">case</span> <span style="color: #8b2252;">"$1"</span><span style="color: #a020f0;"> in</span>
    start)
       /bin/su -l operator1 -c  <span style="color: #8b2252;">"$forever start -l $LOG -a --workingDir=$WORKDIR  --pidFile $PID  $DEAMON"</span>
        ;;
    stop)
        $<span style="color: #a0522d;">forever</span> stop --pidFile $<span style="color: #a0522d;">PID</span> $<span style="color: #a0522d;">DEAMON</span>
        ;;
    stopall)
        $<span style="color: #a0522d;">forever</span> stopall --pidFile $<span style="color: #a0522d;">PID</span>
        ;;
    restartall)
        $<span style="color: #a0522d;">forever</span> restartall --pidFile $<span style="color: #a0522d;">PID</span>
        ;;
    reload|restart)
        /bin/su -l operator1 -c  <span style="color: #8b2252;">"$forever restart -l $LOG --pidFile $PID -a --workingDir=$WORKDIR  $DEAMON"</span>
        ;;
    list)
        $<span style="color: #a0522d;">forever</span> list
        ;;
    *)
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Usage: /etc.init.d/node {start|stop|restart|reload|stopall|restartall|list}"</span>
        <span style="color: #a020f0;">exit</span> 1
        ;;
<span style="color: #a020f0;">esac</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35775;&#38382;&#26435;&#38480;</span>
chown -R operator1.operator1 node-sts-app-server/
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6efbb9e2-adcb-44c7-a96c-2c724d121250" class="outline-3">
<h3 id="h:6efbb9e2-adcb-44c7-a96c-2c724d121250">ossè·¨åŸŸ</h3>
<div class="outline-text-3" id="text-h:6efbb9e2-adcb-44c7-a96c-2c724d121250">
<p>
<a href="https://help.aliyun.com/document_detail/31870.html?spm=5176.11065259.1996646101.searchclickresult.1d762eadmmqkJN">https://help.aliyun.com/document_detail/31870.html?spm=5176.11065259.1996646101.searchclickresult.1d762eadmmqkJN</a>
</p>

<pre class="example" id="org2d65da7">
* Access-Control-Allow-Origin æŒ‡å®šå…è®¸çš„è·¨åŸŸè¯·æ±‚çš„æ¥æºã€‚ *
  è¯´æ˜ æ‚¨å¯ä»¥å¡«å†™*è¡¨ç¤ºå…¨éƒ¨åŸŸåï¼›ä¹Ÿå¯ä»¥å¡«å†™å®Œæ•´åŸŸåï¼Œä¾‹å¦‚www.aliyun.comã€‚
* Access-Control-Allow-Headers  æŒ‡å®šå…è®¸çš„è·¨åŸŸè¯·æ±‚çš„å­—æ®µã€‚ X-Custom-Header
* Access-Control-Allow-Methods  æŒ‡å®šå…è®¸çš„è·¨åŸŸè¯·æ±‚æ–¹æ³•ã€‚  POSTã€GET
  è¯´æ˜ å¦‚æœæ‚¨éœ€è¦åŒæ—¶æ·»åŠ POSTå’ŒGETï¼Œè¯·ä½¿ç”¨è‹±æ–‡é€—å·ï¼ˆ,ï¼‰éš”å¼€ã€‚
* Access-Control-Max-Age  æŒ‡å®šå®¢æˆ·ç«¯ç¨‹åºå¯¹ç‰¹å®šèµ„æºçš„é¢„å–è¯·æ±‚è¿”å›ç»“æœçš„ç¼“å­˜æ—¶é—´ã€‚ 600
* Access-Control-Expose-Headers æŒ‡å®šå…è®¸è®¿é—®çš„è‡ªå®šä¹‰å¤´ä¿¡æ¯ã€‚  Content-Length
</pre>


<figure id="orgb82562b">
<img src="./images/image-20210315172556424.png" alt="image-20210315172556424.png">

</figure>

<pre class="example" id="org7db16c7">
*
GET,POST,PUT,DELETE,HEAD
*
ETag
x-oss-request-id
</pre>

<p>
ä½¿ç”¨ curl æµ‹è¯•å­˜å‚¨æ¡¶ CORS é…ç½®æ˜¯å¦æ­£ç¡®ï¼š
</p>
<div class="org-src-container">
<pre class="src src-sh">curl -I -v -L -H <span style="color: #8b2252;">'origin: &lt;&#36328;&#22495;&#35831;&#27714;&#30340;&#26469;&#28304;&#22495;&#21517;&gt;'</span> &lt;s3&#36164;&#28304;&#22320;&#22336;&gt;
</pre>
</div>

<p>
å¦‚æœå“åº”å¤´ä¸­æœ‰å¦‚ä¸‹è¯·æ±‚å¤´ï¼Œåˆ™è¡¨ç¤ºé…ç½®æ­£ç¡®ï¼š
</p>
<pre class="example" id="orge18d1b0">
Access-Control-Allow-Origin: &lt;curl è¯·æ±‚æ—¶ -H å‚æ•°æŒ‡å®šçš„å€¼&gt;
Access-Control-Allow-Methods: &lt;s3 å­˜å‚¨æ¡¶ CORS é…ç½®æŒ‡å®šçš„è¯·æ±‚æ–¹æ³•&gt;
</pre>
</div>
</div>
<div id="outline-container-h:2908f3e6-9c81-415a-8385-56006488f39b" class="outline-3">
<h3 id="h:2908f3e6-9c81-415a-8385-56006488f39b">è…¾è®¯-COS</h3>
<div class="outline-text-3" id="text-h:2908f3e6-9c81-415a-8385-56006488f39b">
<p>
#è·¨åŸŸ*
</p>

<p>
cdnæ·»åŠ è·¨åŸŸé…ç½®åï¼Œå¦‚æœè¿˜æœ‰è·¨åŸŸçš„é—®é¢˜ï¼Œå¯èƒ½å°±æ˜¯å¯¹åº”çš„cosæ¡¶æ²¡æœ‰æ·»åŠ è·¨åŸŸé…ç½®
</p>

<p>
æœç´¢æ¡†æœç´¢æ¡¶åï¼Œç‚¹å‡»è¿›å…¥è¯¦æƒ…é¡µé¢ï¼Œåœ¨å®‰å…¨ç®¡ç†ä¸­é€‰æ‹©è·¨åŸŸè®¿é—®COESè®¾ç½®ï¼Œæ·»åŠ é…ç½®
</p>


<figure id="org4728c9d">
<img src="./images/image-20210719111815345.png" alt="image-20210719111815345.png">

</figure>
</div>
</div>
<div id="outline-container-h:0260d36c-8893-4eed-ba6b-86104b42ab19" class="outline-3">
<h3 id="h:0260d36c-8893-4eed-ba6b-86104b42ab19">aws-s3</h3>
<div class="outline-text-3" id="text-h:0260d36c-8893-4eed-ba6b-86104b42ab19">
<p>
å‚è€ƒï¼š<a href="https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/enabling-cors-examples.html">https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/enabling-cors-examples.html</a>
</p>

<p>
s3 &#x2013;&gt; æƒé™ &#x2013;&gt; è·¨æºèµ„æºå…±äº«(CORS)
</p>

<pre class="example" id="orgb9c7457">
[
    {
        "AllowedHeaders": [
            "*"
        ],
        "AllowedMethods": [
            "GET"
        ],
        "AllowedOrigins": [
            "https://*.cici.com"
        ],
        "ExposeHeaders": []
    }
]
</pre>
</div>
</div>
</section>
<section id="outline-container-h:bebc4ee8-f5de-443f-96c5-fb5ff96afb93" class="outline-2">
<h2 id="h:bebc4ee8-f5de-443f-96c5-fb5ff96afb93">NAS</h2>
<div class="outline-text-2" id="text-h:bebc4ee8-f5de-443f-96c5-fb5ff96afb93">
<p>
åˆ›å»ºNASåˆ›å»ºæŒ‚è½½ç‚¹
</p>

<pre class="example" id="org3f545e5">
#å®‰è£…NFSå®¢æˆ·ç«¯
yum install -y nfs-utils
# æé«˜åŒæ—¶å‘èµ·çš„NFSè¯·æ±‚æ•°é‡
sudo echo "options sunrpc tcp_slot_table_entries=128" &gt;&gt;  /etc/modprobe.d/sunrpc.conf 
sudo echo "options sunrpc tcp_max_slot_table_entries=128" &gt;&gt;  /etc/modprobe.d/sunrpc.conf

#æŒ‚è½½NFSæ–‡ä»¶ç³»ç»Ÿ
ç¼–è¾‘ï¼š/etc/fstab
1b3d14be74-dux60.cn-beijing.nas.aliyuncs.com:/172.18.30.140  /iyunwen/resource/    nfs4   vers=4.0,minorversion=0,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,_netdev,noresvport 0 0

mount -a

#æ³¨æ„172.18.30.140ç›®å½•æå‰åˆ›å»ºå¥½
# mount -t nfs -o vers=4,minorversion=0,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport 1b3d14be74-dux60.cn-beijing.nas.aliyuncs.com:/  /home/suoper/share
# cd /home/suoper/share/
# mkdir 172.18.30.140
# umount /home/suoper/share
</pre>
</div>
</section>
<section id="outline-container-h:974c8b8e-db89-4349-abdb-91c182655e5f" class="outline-2">
<h2 id="h:974c8b8e-db89-4349-abdb-91c182655e5f">çŸ­ä¿¡æœåŠ¡</h2>
<div class="outline-text-2" id="text-h:974c8b8e-db89-4349-abdb-91c182655e5f">
<p>
<b>è°ƒç”¨SendSmså‘é€çŸ­ä¿¡</b>
</p>

<p>
æ¨¡ç‰ˆåç§°ï¼šæ•°æ®ç³»ç»Ÿæ“ä½œé€šçŸ¥
</p>

<p>
æ¨¡ç‰ˆCODEï¼šSMS_190282220
</p>

<p>
æ¨¡æ¿å†…å®¹ï¼š`${userName}è´¦å·åœ¨ \({time} è¿›è¡Œäº†"\){operateType}"æ“ä½œï¼Œæ¶‰åŠåˆ°æ•°æ®è¡Œæ•°ï¼ˆ${rawNumber}ï¼‰ï¼Œè¯·å…³æ³¨`ã€‚
</p>

<p>
---------&#x2013;&#x2014;ä»£ç æ ·ä¾‹
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/usr/bin/env python</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">coding=utf-8</span>

<span style="color: #a020f0;">from</span> aliyunsdkcore.client <span style="color: #a020f0;">import</span> AcsClient
<span style="color: #a020f0;">from</span> aliyunsdkcore.request <span style="color: #a020f0;">import</span> CommonRequest
<span style="color: #a0522d;">client</span> = AcsClient(<span style="color: #8b2252;">'&lt;accessKeyId&gt;'</span>, <span style="color: #8b2252;">'&lt;accessSecret&gt;'</span>, <span style="color: #8b2252;">'cn-hangzhou'</span>)

<span style="color: #a0522d;">request</span> = CommonRequest()
request.set_accept_format(<span style="color: #8b2252;">'json'</span>)
request.set_domain(<span style="color: #8b2252;">'dysmsapi.aliyuncs.com'</span>)
request.set_method(<span style="color: #8b2252;">'POST'</span>)
request.set_protocol_type(<span style="color: #8b2252;">'https'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">https | http</span>
request.set_version(<span style="color: #8b2252;">'2017-05-25'</span>)
request.set_action_name(<span style="color: #8b2252;">'SendSms'</span>)

request.add_query_param(<span style="color: #8b2252;">'RegionId'</span>, <span style="color: #8b2252;">"cn-hangzhou"</span>)
request.add_query_param(<span style="color: #8b2252;">'PhoneNumbers'</span>, <span style="color: #8b2252;">"135224xx"</span>)
request.add_query_param(<span style="color: #8b2252;">'SignName'</span>, <span style="color: #8b2252;">"xcw"</span>)
request.add_query_param(<span style="color: #8b2252;">'TemplateCode'</span>, <span style="color: #8b2252;">"SMS_190282220"</span>)
request.add_query_param(<span style="color: #8b2252;">'TemplateParam'</span>, <span style="color: #8b2252;">"{\"userName\":\"xuchangwei\",\"time\":\"2020-05-16 15:01:00\",\"operateType\":\"&#25968;&#25454;&#31995;&#32479;\",\"rawNumber\":\"1000\"}"</span>)

<span style="color: #a0522d;">response</span> = client.do_action(request)
<span style="color: #b22222;"># </span><span style="color: #b22222;">python2:  print(response) </span>
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">str</span>(response, encoding = <span style="color: #8b2252;">'utf-8'</span>))
</pre>
</div>


<p>
<b>è°ƒç”¨SendBatchSmsæ¥å£æ‰¹é‡å‘é€çŸ­ä¿¡</b>
</p>

<p>
APIè°ƒç”¨è®¿é—®è®¤è¯ï¼š
</p>

<p>
AcxxxsKey ID: LTA
</p>

<p>
accxxxsSecret: ah5P
</p>

<p>
ç­¾åï¼šxcw
</p>

<p>
æ¨¡ç‰ˆCODEï¼šSMS_190282079
</p>

<p>
æ¨¡æ¿å†…å®¹ï¼š`é€šçŸ¥ï¼š\({name}æ­£åœ¨è¿›è¡Œå‡çº§ç»´æŠ¤ï¼Œå•†å“\){payContent}ï¼Œæ‚¨æš‚æ—¶æ— æ³•è¿›è¡Œ\({payType}ï¼Œé¢„è®¡\){time}ä¹‹å‰æ¢å¤`ã€‚
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">import</span> <span style="color: #008b8b;">com</span>.<span style="color: #008b8b;">aliyuncs</span>.<span style="color: #228b22;">CommonRequest</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">com</span>.<span style="color: #008b8b;">aliyuncs</span>.<span style="color: #228b22;">CommonResponse</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">com</span>.<span style="color: #008b8b;">aliyuncs</span>.<span style="color: #228b22;">DefaultAcsClient</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">com</span>.<span style="color: #008b8b;">aliyuncs</span>.<span style="color: #228b22;">IAcsClient</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">com</span>.<span style="color: #008b8b;">aliyuncs</span>.<span style="color: #008b8b;">exceptions</span>.<span style="color: #228b22;">ClientException</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">com</span>.<span style="color: #008b8b;">aliyuncs</span>.<span style="color: #008b8b;">exceptions</span>.<span style="color: #228b22;">ServerException</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">com</span>.<span style="color: #008b8b;">aliyuncs</span>.<span style="color: #008b8b;">http</span>.<span style="color: #228b22;">MethodType</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">com</span>.<span style="color: #008b8b;">aliyuncs</span>.<span style="color: #008b8b;">profile</span>.<span style="color: #228b22;">DefaultProfile</span>;
<span style="color: #b22222;">/*</span>
<span style="color: #b22222;">pom.xml</span>
<span style="color: #b22222;">&lt;dependency&gt;</span>
<span style="color: #b22222;">  &lt;groupId&gt;com.aliyun&lt;/groupId&gt;</span>
<span style="color: #b22222;">  &lt;artifactId&gt;aliyun-java-sdk-core&lt;/artifactId&gt;</span>
<span style="color: #b22222;">  &lt;version&gt;4.5.0&lt;/version&gt;</span>
<span style="color: #b22222;">&lt;/dependency&gt;</span>
<span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">SendBatchSms</span> {
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">main</span>(<span style="color: #228b22;">String</span>[] <span style="color: #a0522d;">args</span>) {
        <span style="color: #228b22;">DefaultProfile</span> <span style="color: #a0522d;">profile</span> = DefaultProfile.getProfile(<span style="color: #8b2252;">"cn-hangzhou"</span>, <span style="color: #8b2252;">"&lt;accxxssKeyId&gt;"</span>, <span style="color: #8b2252;">"&lt;accxxsSecret&gt;"</span>);
        <span style="color: #228b22;">IAcsClient</span> <span style="color: #a0522d;">client</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">DefaultAcsClient</span>(profile);

        <span style="color: #228b22;">CommonRequest</span> <span style="color: #a0522d;">request</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">CommonRequest</span>();
        request.setSysMethod(<span style="color: #008b8b;">MethodType</span>.POST);
        request.setSysDomain(<span style="color: #8b2252;">"dysmsapi.aliyuncs.com"</span>);
        request.setSysVersion(<span style="color: #8b2252;">"2017-05-25"</span>);
        request.setSysAction(<span style="color: #8b2252;">"SendBatchSms"</span>);
        request.putQueryParameter(<span style="color: #8b2252;">"RegionId"</span>, <span style="color: #8b2252;">"cn-hangzhou"</span>);
        request.putQueryParameter(<span style="color: #8b2252;">"PhoneNumberJson"</span>, <span style="color: #8b2252;">"[\"13522xx\",\"1871026xx\"]"</span>);
        request.putQueryParameter(<span style="color: #8b2252;">"SignNameJson"</span>, <span style="color: #8b2252;">"[\"xcw\",\"xcw\"]"</span>);
        request.putQueryParameter(<span style="color: #8b2252;">"TemplateCode"</span>, <span style="color: #8b2252;">"SMS_190282079"</span>);
        request.putQueryParameter(<span style="color: #8b2252;">"TemplateParamJson"</span>, <span style="color: #8b2252;">"[{\"name\":\"&#38134;&#34892;&#31995;&#32479;\",\"payContent\":\"&#26242;&#20572;&#25903;&#20184;&#19994;&#21153;\",\"payType\":\"&#20184;&#27454;\",\"time\":\"2020-05-14\"},{\"name\":\"&#38134;&#34892;&#31995;&#32479;\",\"payContent\":\"&#26242;&#20572;&#25903;&#20184;&#19994;&#21153;\",\"payType\":\"&#20184;&#27454;\",\"time\":\"2020-05-14\"}]"</span>);
        <span style="color: #a020f0;">try</span> {
            <span style="color: #228b22;">CommonResponse</span> <span style="color: #a0522d;">response</span> = client.getCommonResponse(request);
            System.out.println(response.getData());
        } <span style="color: #a020f0;">catch</span> (ServerException e) {
            e.printStackTrace();
        } <span style="color: #a020f0;">catch</span> (ClientException e) {
            e.printStackTrace();
        }
    }
}
</pre>
</div>
</div>
</section>
<section id="outline-container-h:d2700a10-479e-470b-ba71-daec5d458fca" class="outline-2">
<h2 id="h:d2700a10-479e-470b-ba71-daec5d458fca">CDN</h2>
<div class="outline-text-2" id="text-h:d2700a10-479e-470b-ba71-daec5d458fca">
</div>
<div id="outline-container-h:8d14bc95-ab69-4f7c-9f23-af02e9ec22f5" class="outline-3">
<h3 id="h:8d14bc95-ab69-4f7c-9f23-af02e9ec22f5">æœåŠ¡ç®¡ç†</h3>
<div class="outline-text-3" id="text-h:8d14bc95-ab69-4f7c-9f23-af02e9ec22f5">
<p>
<b>åˆ·æ–°é¢„çƒ­</b>
</p>

<p>
CDNæä¾›çš„èµ„æºçš„åˆ·æ–°å’Œé¢„çƒ­åŠŸèƒ½çš„æ¦‚å¿µå¦‚ä¸‹ï¼š
</p>

<ul class="org-ul">
<li>åˆ·æ–°åŠŸèƒ½æ˜¯æŒ‡æäº¤URLåˆ·æ–°æˆ–ç›®å½•åˆ·æ–°è¯·æ±‚åï¼ŒCDNèŠ‚ç‚¹çš„ç¼“å­˜å†…å®¹å°†ä¼šè¢«å¼ºåˆ¶è¿‡æœŸï¼Œå½“æ‚¨å‘CDNèŠ‚ç‚¹è¯·æ±‚èµ„æºæ—¶ï¼ŒCDNä¼šç›´æ¥å›æºç«™è·å–å¯¹åº”çš„èµ„æºè¿”å›ç»™æ‚¨ï¼Œå¹¶å°†å…¶ç¼“å­˜ã€‚åˆ·æ–°åŠŸèƒ½ä¼šé™ä½ç¼“å­˜å‘½ä¸­ç‡ã€‚</li>
<li>é¢„çƒ­åŠŸèƒ½æ˜¯æŒ‡æäº¤URLé¢„çƒ­è¯·æ±‚åï¼Œæºç«™å°†ä¼šä¸»åŠ¨å°†å¯¹åº”çš„èµ„æºç¼“å­˜åˆ°CDNèŠ‚ç‚¹ï¼Œå½“æ‚¨é¦–æ¬¡è¯·æ±‚æ—¶ï¼Œå°±èƒ½ç›´æ¥ä»CDNèŠ‚ç‚¹ç¼“å­˜ä¸­è·å–åˆ°æœ€æ–°çš„è¯·æ±‚èµ„æºï¼Œæ— éœ€å†å›æºç«™è·å–ã€‚é¢„çƒ­åŠŸèƒ½ä¼šæé«˜ç¼“å­˜å‘½ä¸­ç‡ã€‚</li>
</ul>


<figure id="org7d8dd53">
<img src="./images/image-20210129151922025.png" alt="image-20210129151922025.png">

</figure>

<p>
æ³¨æ„ï¼š <code>å¦‚æœä¿®æ”¹äº†æºæ–‡ä»¶ éœ€è¦å…ˆæ‰§è¡Œurlåˆ·æ–° å…ˆæ¸…é™¤ç¼“å­˜é…ç½®ï¼Œå†æ“ä½œurlé¢„çƒ­</code>
</p>

<p>
<b>æ‰‹åŠ¨åˆ·æ–°</b>
</p>

<p>
æ“ä½œ
</p>

<ol class="org-ol">
<li>ç™»å½•[CDNæ§åˆ¶å°](<a href="https://cdn.console.aliyun.com/">https://cdn.console.aliyun.com/</a>)ã€‚</li>
<li>åœ¨å·¦ä¾§å¯¼èˆªæ ï¼Œå•å‡» <b>åˆ·æ–°é¢„çƒ­</b> ã€‚</li>
<li>åœ¨ <b>åˆ·æ–°ç¼“å­˜</b> é¡µç­¾ï¼Œæ‚¨å¯ä»¥æ ¹æ®æ‰€éœ€ï¼Œé…ç½®åˆ·æ–°æˆ–é¢„çƒ­ä¿¡æ¯</li>
</ol>


<figure id="orgc6e3fd8">
<img src="./images/image-20210129152210973.png" alt="image-20210129152210973.png">

</figure>


<p>
<b>OSSå¼€å§‹åŸŸåè‡ªåŠ¨åˆ·æ–°</b>
</p>


<figure id="org529e613">
<img src="./images/image-20210315173021036.png" alt="image-20210315173021036.png">

</figure>

<p>
è‡ªåŠ¨åˆ·æ–°è„šæœ¬
</p>

<p>
RAMè®¿é—®ç­–ç•¥
</p>

<pre class="example" id="org9469696">
{
    "Version": "1",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "cdn:PushObjectCache",
                "cdn:RefreshObjectCaches"
            ],
            "Resource": "acs:cdn:*:*:*",
            "Condition": {
                "IpAddress": {
                    "acs:SourceIp": [
                        "211.103.135.96/29",
                        "172.28.30.56",
                        "123.57.87.183"
                    ]
                }
            }
        }
    ]
}
</pre>

<p>
<a href="https://help.aliyun.com/document_detail/151829.html?spm=5176.10695662.1996646101.searchclickresult.5aea25a1CxcObd">https://help.aliyun.com/document_detail/151829.html?spm=5176.10695662.1996646101.searchclickresult.5aea25a1CxcObd</a>
</p>


<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#20381;&#36182;</span>
pip install aliyun-python-sdk-core
pip install aliyun-python-sdk-cdn

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33050;&#26412;</span>
cat &lt;&lt;\EOF &gt; /data/ops/Refresh.py 
<span style="color: #ffa54f;">#!/usr/bin/env python</span>
<span style="color: #ffa54f;">#coding=utf-8</span>
<span style="color: #ffa54f;"># __author__ = 'hanli.zyb'</span>

<span style="color: #ffa54f;">'''Check Package'''</span>

<span style="color: #ffa54f;">try:</span>
<span style="color: #ffa54f;"> import os, sys, getopt, time, json</span>
<span style="color: #ffa54f;"> from aliyunsdkcore.client import AcsClient</span>
<span style="color: #ffa54f;"> from aliyunsdkcore.acs_exception.exceptions import ClientException</span>
<span style="color: #ffa54f;"> from aliyunsdkcore.acs_exception.exceptions import ServerException</span>
<span style="color: #ffa54f;"> from aliyunsdkcdn.request.v20180510.RefreshObjectCachesRequest import RefreshObjectCachesRequest</span>
<span style="color: #ffa54f;"> from aliyunsdkcdn.request.v20180510.PushObjectCacheRequest import PushObjectCacheRequest</span>
<span style="color: #ffa54f;"> from aliyunsdkcdn.request.v20180510.DescribeRefreshTasksRequest import DescribeRefreshTasksRequest</span>
<span style="color: #ffa54f;"> from aliyunsdkcdn.request.v20180510.DescribeRefreshQuotaRequest import DescribeRefreshQuotaRequest</span>
<span style="color: #ffa54f;">except:</span>
<span style="color: #ffa54f;"> sys.exit("[Error] Please pip install aliyun-python-sdk-cdn and aliyun-java-sdk-core &#65292;please install now......")</span>

<span style="color: #ffa54f;">reload(sys)</span>
<span style="color: #ffa54f;">sys.setdefaultencoding('utf8')</span>

<span style="color: #ffa54f;">class Refresh(object):</span>

<span style="color: #ffa54f;">  '''init func'''</span>

<span style="color: #ffa54f;">  def __init__(self):</span>

<span style="color: #ffa54f;">   self.lists = []</span>
<span style="color: #ffa54f;">   self.param = {}</span>

<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  &#25551;&#36848;&#65306;&#35843;&#24230;&#30340;&#20027;&#20989;&#25968;</span>
<span style="color: #ffa54f;">  resP&#65306;&#26816;&#27979;&#20837;&#21442;&#32467;&#26524;&#65292;&#22914;&#26524;&#31867;&#22411;&#19981;&#26159; bool &#35828;&#26126;&#26377;&#25253;&#38169;</span>
<span style="color: #ffa54f;">  '''</span>

<span style="color: #ffa54f;">  def main(self,argv):</span>
<span style="color: #ffa54f;">    if len(argv) &lt; 1 :</span>
<span style="color: #ffa54f;">      sys.exit("\nusage: " + sys.argv[0] + " -h ")</span>
<span style="color: #ffa54f;">    try:</span>
<span style="color: #ffa54f;">      opts,args = getopt.getopt(argv,"hi:k:n:r:t:a:o:")</span>
<span style="color: #ffa54f;">    except Exception as e :</span>
<span style="color: #ffa54f;">      sys.exit("\nusage: " + sys.argv[0] + " -h ")</span>

<span style="color: #ffa54f;">    for opt,arg in opts:</span>
<span style="color: #ffa54f;">      if opt == '-h':</span>
<span style="color: #ffa54f;">        self.helps()</span>
<span style="color: #ffa54f;">        sys.exit()</span>
<span style="color: #ffa54f;">      elif opt == '-i':</span>
<span style="color: #ffa54f;">        self.param['-i'] = arg</span>
<span style="color: #ffa54f;">      elif opt == '-k':</span>
<span style="color: #ffa54f;">        self.param['-k'] = arg</span>
<span style="color: #ffa54f;">      elif opt == '-r':</span>
<span style="color: #ffa54f;">        self.param['-r'] = arg</span>
<span style="color: #ffa54f;">      elif opt == '-t':</span>
<span style="color: #ffa54f;">        self.param['-t'] = arg</span>
<span style="color: #ffa54f;">      elif opt == '-a':</span>
<span style="color: #ffa54f;">        self.param['-a'] = arg </span>
<span style="color: #ffa54f;">      elif opt == '-o':</span>
<span style="color: #ffa54f;">        self.param['-o'] = arg</span>
<span style="color: #ffa54f;">      elif opt == '-n':</span>
<span style="color: #ffa54f;">        self.param['-n'] = arg</span>
<span style="color: #ffa54f;">      else:</span>
<span style="color: #ffa54f;">        sys.exit("\nusage: " + sys.argv[0] + " -h ")</span>

<span style="color: #ffa54f;">    resP = self.doCheck(self.param)</span>
<span style="color: #ffa54f;">    if not isinstance(resP,bool): sys.exit(resP)</span>

<span style="color: #ffa54f;">    try:</span>
<span style="color: #ffa54f;">      #client = AcsClient(self.param['-i'], self.param['-k'], 'cn-hangzhou')</span>
<span style="color: #ffa54f;">      client = AcsClient('LTAI4xxfeqRNNitV', 'YpmiExxFnaCrlZ', 'cn-hangzhou')</span>
<span style="color: #ffa54f;">    except NameError:</span>
<span style="color: #ffa54f;">      sys.exit("[Error]: SDK module not detected")</span>

<span style="color: #ffa54f;">    for g in self.doProd(self.param):</span>
<span style="color: #ffa54f;">      self.lists = []</span>
<span style="color: #ffa54f;">      self.doRefresh(''.join(g),self.param['-t'],client)</span>

<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  &#25551;&#36848;&#65306;&#26816;&#27979;&#20837;&#21442;&#25968;</span>
<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  def doCheck(self,param):</span>

<span style="color: #ffa54f;">    try:</span>
<span style="color: #ffa54f;">      #for key1 in ('-i','-k','-r','-t'):</span>
<span style="color: #ffa54f;">      for key1 in ('-r','-t'):</span>
<span style="color: #ffa54f;">        if not key1 in param.keys():</span>
<span style="color: #ffa54f;">          return "[Error]: {0} Must be by parameter".format(key1)</span>

<span style="color: #ffa54f;">      try:</span>
<span style="color: #ffa54f;">        if not param.has_key('-n'):</span>
<span style="color: #ffa54f;">          self.param['-n'] = 50</span>
<span style="color: #ffa54f;">        if not (abs(int(param['-n'])) &lt;= 100 and abs(int(param['-n'])) &gt; 0):</span>
<span style="color: #ffa54f;">          return "[Error]: 0 &lt; -n &lt;= 100"</span>
<span style="color: #ffa54f;">        else:</span>
<span style="color: #ffa54f;">          self.param['-n'] = int(param['-n'])</span>
<span style="color: #ffa54f;">      except ValueError as e:</span>
<span style="color: #ffa54f;">        return "[Error]: -n Must be int Type ,{0}".format(str(e))</span>

<span style="color: #ffa54f;">      if not param['-t'] in ("push","clear"): return "[Error]: taskType Error"</span>
<span style="color: #ffa54f;">      if param.has_key('-a') and param.has_key('-o'): return "[Error]: -a and -o cannot exist at same time"</span>

<span style="color: #ffa54f;">      if param.has_key('-a'):</span>
<span style="color: #ffa54f;">          if not param['-a'] in ("domestic","overseas"): </span>
<span style="color: #ffa54f;">            return "[Error]: Area value Error"</span>
<span style="color: #ffa54f;">          if param['-t'] == 'clear':</span>
<span style="color: #ffa54f;">            return "[Error]: -t must be push and 'clear' -o use together"</span>

<span style="color: #ffa54f;">      if param.has_key('-o'):</span>
<span style="color: #ffa54f;">          if not param['-o'] in ("File","Directory"):</span>
<span style="color: #ffa54f;">            return "[Error]: ObjectType value Error"</span>
<span style="color: #ffa54f;">          if param['-t'] == 'push':</span>
<span style="color: #ffa54f;">            return "[Error]: -t must be clear and 'push' -a use together"</span>

<span style="color: #ffa54f;">    except KeyError as e:</span>
<span style="color: #ffa54f;">       return "[Error]: Parameter {0} error".format(str(e))</span>
<span style="color: #ffa54f;">    return True</span>

<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  &#25551;&#36848;&#65306;&#29983;&#25104;&#22120;&#20999;&#20998;&#25991;&#20214;&#65292;&#23545;&#27599;&#34892;&#25991;&#20214;&#36827;&#34892;&#22788;&#29702; '\n'</span>
<span style="color: #ffa54f;">  gop&#65306;&#27599;&#27425;&#35835;&#21462; URL &#25968;&#37327;</span>
<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  def doProd(self,params):</span>
<span style="color: #ffa54f;">    gop = params['-n']</span>
<span style="color: #ffa54f;">    mins = 1</span>
<span style="color: #ffa54f;">    maxs = gop</span>

<span style="color: #ffa54f;">    #with open(params['-r'], "r") as f:</span>
<span style="color: #ffa54f;">    #  for line in f.readlines():</span>
<span style="color: #ffa54f;">    #    if mins != maxs:</span>
<span style="color: #ffa54f;">    #     line = line.strip("\n") + "\n"</span>
<span style="color: #ffa54f;">    #    else:</span>
<span style="color: #ffa54f;">    #     line = line.strip("\n")</span>
<span style="color: #ffa54f;">    #    self.lists.append(line)</span>
<span style="color: #ffa54f;">    #    if mins &gt;= maxs:</span>
<span style="color: #ffa54f;">    #     yield self.lists</span>
<span style="color: #ffa54f;">    #     mins = maxs</span>
<span style="color: #ffa54f;">    #     maxs = gop + maxs -1</span>
<span style="color: #ffa54f;">    #    else:</span>
<span style="color: #ffa54f;">    #     mins += 1</span>
<span style="color: #ffa54f;">    #  print self.lists</span>
<span style="color: #ffa54f;">    #  if len(self.lists) &gt; 0: yield self.lists</span>
<span style="color: #ffa54f;">    self.lists.append(params['-r'])</span>
<span style="color: #ffa54f;">    if len(self.lists) &gt; 0: yield self.lists</span>


<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  &#25551;&#36848;&#65306;&#21047;&#26032;/&#39044;&#28909;&#20219;&#21153;</span>
<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  def doRefresh(self,lists,types,client):</span>
<span style="color: #ffa54f;">    try:</span>
<span style="color: #ffa54f;">      if types == 'clear':</span>
<span style="color: #ffa54f;">        taskID = 'RefreshTaskId'</span>
<span style="color: #ffa54f;">        request = RefreshObjectCachesRequest()</span>
<span style="color: #ffa54f;">        if self.param.has_key('-o'):</span>
<span style="color: #ffa54f;">          request.set_ObjectType(self.param['-o'])</span>
<span style="color: #ffa54f;">      elif types == 'push':</span>
<span style="color: #ffa54f;">        taskID = 'PushTaskId'</span>
<span style="color: #ffa54f;">        request = PushObjectCacheRequest()</span>
<span style="color: #ffa54f;">        if self.param.has_key('-a'):</span>
<span style="color: #ffa54f;">          request.set_Area(self.param['-a'])</span>

<span style="color: #ffa54f;">      taskreq = DescribeRefreshTasksRequest()</span>
<span style="color: #ffa54f;">      request.set_accept_format('json')</span>
<span style="color: #ffa54f;">      request.set_ObjectPath(lists)</span>
<span style="color: #ffa54f;">      response = json.loads(client.do_action_with_exception(request))</span>
<span style="color: #ffa54f;">      print(response)</span>

<span style="color: #ffa54f;">      while True:</span>
<span style="color: #ffa54f;">        count = 0</span>
<span style="color: #ffa54f;">        taskreq.set_accept_format('json')</span>
<span style="color: #ffa54f;">        print(response[taskID].split(","))</span>
<span style="color: #ffa54f;">        for id in response[taskID].split(","):</span>
<span style="color: #ffa54f;">            #taskreq.set_TaskId(int(response[taskID]))</span>
<span style="color: #ffa54f;">            taskreq.set_TaskId(int(id))</span>
<span style="color: #ffa54f;">            taskresp = json.loads(client.do_action_with_exception(taskreq))</span>
<span style="color: #ffa54f;">            #print("[" + response[taskID] + "]" + "is doing... ...")</span>
<span style="color: #ffa54f;">            print("[" + id + "]" + "URL&#21047;&#26032;&#20013;... ...")</span>
<span style="color: #ffa54f;">            for t in taskresp['Tasks']['CDNTask']:</span>
<span style="color: #ffa54f;">              if t['Status'] != 'Complete':</span>
<span style="color: #ffa54f;">                count += 1</span>
<span style="color: #ffa54f;">            time.sleep(5)</span>
<span style="color: #ffa54f;">        if count == 0:</span>
<span style="color: #ffa54f;">          break</span>
<span style="color: #ffa54f;">        else:</span>
<span style="color: #ffa54f;">          continue</span>
<span style="color: #ffa54f;">    except Exception as e:</span>
<span style="color: #ffa54f;">      sys.exit("[Error]" + str(e))</span>

<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  &#25551;&#36848;&#65306;&#24110;&#21161;&#20449;&#24687;</span>
<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  def helps(self):</span>
<span style="color: #ffa54f;">    print("\nscript options explain: \</span>
<span style="color: #ffa54f;">            \n\t -i &lt;AcxxssKey&gt;                  &#35775;&#38382;&#38463;&#37324;&#20113;&#20973;&#35777;&#65292;&#35775;&#38382;&#25511;&#21046;&#21488;&#19978;&#21487;&#20197;&#33719;&#24471;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t -k &lt;AccxxKeySecret&gt;            &#35775;&#38382;&#38463;&#37324;&#20113;&#23494;&#38053;&#65292;&#35775;&#38382;&#25511;&#21046;&#21488;&#19978;&#21487;&#20197;&#33719;&#24471;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t -r &lt;filename&gt;                   &#25991;&#20214;&#21517;&#31216;&#65292;&#27599;&#34892;&#19968;&#26465; URL&#65292;&#26377;&#29305;&#27530;&#23383;&#31526;&#20808;&#20570; URLencode&#65292;&#20197; http/https &#24320;&#22836;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t -t &lt;taskType&gt;                   &#20219;&#21153;&#31867;&#22411; clear &#21047;&#26032;&#65292;push &#39044;&#28909;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t -n [int,[..100]]                &#21487;&#36873;&#39033;&#65292;&#27599;&#27425;&#25805;&#20316;&#25991;&#20214;&#25968;&#37327;&#65292;&#20570;&#22810; 100 &#26465;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t -a [String,&lt;domestic|overseas&gt;  &#21487;&#36873;&#39033;&#65292;&#39044;&#28909;&#33539;&#22260;&#65292;&#19981;&#20256;&#26159;&#40664;&#35748;&#26159;&#20840;&#29699;&#65307;\</span>
<span style="color: #ffa54f;">            \n\t    domestic                     &#20165;&#20013;&#22269;&#22823;&#38470;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t    overseas                     &#20840;&#29699;&#65288;&#19981;&#21253;&#21547;&#20013;&#22269;&#22823;&#38470;&#65289;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t -o [String,&lt;File|Directory&gt;]    &#21487;&#36873;&#39033;&#65292;&#21047;&#26032;&#30340;&#31867;&#22411;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t    File                         &#25991;&#20214;&#21047;&#26032;&#65288;&#40664;&#35748;&#20540;&#65289;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t    Directory                    &#30446;&#24405;&#21047;&#26032;")</span>
<span style="color: #ffa54f;">#TODO &#20837;&#21475;</span>

<span style="color: #ffa54f;">if __name__ == '__main__':</span>
<span style="color: #ffa54f;">  fun = Refresh()</span>
<span style="color: #ffa54f;">  fun.main(sys.argv[1:])</span>

<span style="color: #ffa54f;">EOF</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">python /data/ops/Refresh.py -r https://new-teacher.cici.com/ -t clear </span>
{u<span style="color: #8b2252;">'RefreshTaskId'</span>: u<span style="color: #8b2252;">'10542101638'</span>, u<span style="color: #8b2252;">'RequestId'</span>: u<span style="color: #8b2252;">'DFC3A1FC-C896-4B4B-8B79-0C81886A249C'</span>}
[u<span style="color: #8b2252;">'10542101638'</span>]
[10542101638]is doing... ...
[u<span style="color: #8b2252;">'10542101638'</span>]
[10542101638]is doing... ...
</pre>
</div>

<p>
```
</p>
</div>
</div>
<div id="outline-container-h:b1cb9050-79b0-44ca-bc83-9e6836dabf93" class="outline-3">
<h3 id="h:b1cb9050-79b0-44ca-bc83-9e6836dabf93">cndå¸¸ç”¨é…ç½®</h3>
<div class="outline-text-3" id="text-h:b1cb9050-79b0-44ca-bc83-9e6836dabf93">
<p>
<b>ç¼“å­˜é…ç½®</b>
</p>


<figure id="org9a7f6e6">
<img src="./images/image-20210315172416613.png" alt="image-20210315172416613.png">

</figure>

<pre class="example" id="orge789ac3">
bmp,jpg,png,tif,gif,pcx,tga,exif,fpx,svg,psd,cdr,pcd,dxf,ufo,eps,ai,raw,WMF,webp,mp4,wav
</pre>

<p>
<b>å›æº</b>
</p>

<p>
å›æº-å¼€å¯é˜¿é‡Œäº‘OSSç§æœ‰Bucketå›æº
</p>

<p>
å›æº-è¿‡æ»¤å‚æ•°
</p>

<p>
<a href="https://help.aliyun.com/document_detail/27128.html?spm=5176.11065259.1996646101.searchclickresult.41437200joImMZ">https://help.aliyun.com/document_detail/27128.html?spm=5176.11065259.1996646101.searchclickresult.41437200joImMZ</a>
</p>

<p>
è¿‡æ»¤å‚æ•°åŒ…æ‹¬ è¿‡æ»¤å‚æ•°å’Œå¿½ç•¥å‚æ•°è¿™ä¸¤ä¸ªåŠŸèƒ½ã€‚
</p>

<pre class="example" id="org887cdd8">
* ä¿ç•™è¿‡æ»¤å‚æ•°ï¼šä¿ç•™æŒ‡å®šå‚æ•°ï¼Œå¤šä¸ªå‚æ•°ä¹‹é—´ç”¨è‹±æ–‡é€—å·éš”å¼€ï¼ŒæœªæŒ‡å®šçš„å‚æ•°å°†ä¸ä¼šè¢«ä¿ç•™ã€‚
* å¿½ç•¥å‚æ•°ï¼šåˆ é™¤æŒ‡å®šå‚æ•°ï¼Œå¤šä¸ªå‚æ•°ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ï¼Œå‰©ä½™å‚æ•°å°†ä¸ä¼šè¢«å¿½ç•¥ã€‚
</pre>


<figure id="orgeaab6f1">
<img src="./images/image-20210315172455863.png" alt="image-20210315172455863.png">

</figure>

<p>
<b>æ¦‚å¿µè·¨åŸŸ</b>
</p>

<p>
è¢«è®¿é—®çš„ä¸€ç«¯è®¾ç½®è·¨åŸŸã€‚å¦‚å‰ç«¯é¡µé¢åŠ äº†cndä¸­çš„å›¾ç‰‡åœ°å€ï¼Œé‚£ä¹ˆè¢«è®¿é—®ç«¯cndå°±è¦è®¾ç½®è·¨åŸŸ
</p>

<pre class="example" id="org5b4d14f">
access-control-allow-origin: * æˆ–è€…http://ts-game.cici.com
Access-Control-Allow-Methods: GET,POST,OPTIONS
</pre>


<p>
è·¨åŸŸèµ„æºå…±äº«ï¼ˆCross-Origin Resource Sharingï¼ŒCORSï¼‰ç®€ç§°è·¨åŸŸè®¿é—®ï¼Œæ˜¯HTML5æä¾›çš„æ ‡å‡†è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼Œå…è®¸Webåº”ç”¨æœåŠ¡å™¨è¿›è¡Œè·¨åŸŸè®¿é—®æ§åˆ¶ï¼Œä½¿å¾—è·¨åŸŸæ•°æ®ä¼ è¾“å¾—ä»¥å®‰å…¨è¿›è¡Œã€‚
</p>

<p>
èƒŒæ™¯ä¿¡æ¯
</p>

<p>
è·¨åŸŸè®¿é—®æ˜¯æµè§ˆå™¨å‡ºäºå®‰å…¨è€ƒè™‘è€Œè®¾ç½®çš„ä¸€ä¸ªé™åˆ¶ï¼Œå³åŒæºç­–ç•¥ã€‚å½“Aã€Bä¸¤ä¸ªç½‘ç«™å±äºä¸åŒåŸŸæ—¶ï¼Œæ¥è‡ªäºAç½‘ç«™é¡µé¢ä¸­çš„JavaScriptä»£ç è®¿é—®Bç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨ä¼šæ‹’ç»è¯¥è®¿é—®ã€‚
</p>

<p>
ä¾‹å¦‚å½“è¿è¡Œåœ¨åŒä¸€ä¸ªæµè§ˆå™¨ä¸Šçš„ä¸åŒæ¥æºï¼Œä¾‹å¦‚www.example.comå’Œwww.test.comè¯·æ±‚åŒä¸€è·¨åŸŸèµ„æºæ—¶ï¼Œè‹¥www.example.comçš„è¯·æ±‚å…ˆåˆ°è¾¾æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°†è¯·æ±‚çš„èµ„æºå¸¦ä¸ŠAccess-Control-Allow-Originçš„Headerï¼Œå¹¶è¿”å›ç»™www.example.comçš„ç”¨æˆ·ã€‚æ­¤æ—¶www.test.comä¹Ÿå‘èµ·äº†è¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šå°†ç¼“å­˜çš„ä¸Šä¸€æ¬¡è¯·æ±‚å“åº”è¿”å›ç»™ç”¨æˆ·ï¼ŒHeaderçš„å†…å®¹å’ŒCORSçš„è¦æ±‚ä¸åŒ¹é…ï¼Œå¯¼è‡´www.test.comè¯·æ±‚å¤±è´¥ã€‚
</p>

<p>
åŒæºç­–ç•¥é™åˆ¶ä»ä¸€ä¸ªæºåŠ è½½çš„æ–‡æ¡£æˆ–è„šæœ¬ä¸å¦ä¸€ä¸ªæºçš„èµ„æºè¿›è¡Œäº¤äº’çš„æ–¹å¼ï¼Œæ˜¯ç”¨äºéš”ç¦»æ½œåœ¨æ¶æ„æ–‡ä»¶çš„å…³é”®å®‰å…¨æœºåˆ¶ã€‚åŒåè®®ã€åŒåŸŸåï¼ˆæˆ– IPï¼‰ã€ä»¥åŠåŒç«¯å£è§†ä¸ºåŒä¸€ä¸ªåŸŸã€‚ä¸¤ä¸ªé¡µé¢çš„åè®®ã€åŸŸåå’Œç«¯å£ï¼ˆè‹¥æŒ‡å®šäº†ç«¯å£ï¼‰ç›¸åŒï¼Œåˆ™è§†ä¸ºåŒæºã€‚å¦‚ä¸‹è¡¨ç»™å‡ºäº†ç›¸å¯¹<a href="http://www.aliyun.com/org/test.html%E7%9A%84%E5%90%8C%E6%BA%90%E6%A3%80%E6%B5%8B%E7%A4%BA%E4%BE%8B%EF%BC%9A">http://www.aliyun.com/org/test.html%E7%9A%84%E5%90%8C%E6%BA%90%E6%A3%80%E6%B5%8B%E7%A4%BA%E4%BE%8B%EF%BC%9A</a>
</p>


<figure id="org9d0d0dd">
<img src="./images/image-20210315172509631.png" alt="image-20210315172509631.png">

</figure>

<pre class="example" id="org02d456b">
* Access-Control-Allow-Origin æŒ‡å®šå…è®¸çš„è·¨åŸŸè¯·æ±‚çš„æ¥æºã€‚ *
è¯´æ˜ æ‚¨å¯ä»¥å¡«å†™*è¡¨ç¤ºå…¨éƒ¨åŸŸåï¼›ä¹Ÿå¯ä»¥å¡«å†™å®Œæ•´åŸŸåï¼Œä¾‹å¦‚www.aliyun.comã€‚
* Access-Control-Allow-Headers  æŒ‡å®šå…è®¸çš„è·¨åŸŸè¯·æ±‚çš„å­—æ®µã€‚ X-Custom-Header
* Access-Control-Allow-Methods  æŒ‡å®šå…è®¸çš„è·¨åŸŸè¯·æ±‚æ–¹æ³•ã€‚  POSTã€GET
è¯´æ˜ å¦‚æœæ‚¨éœ€è¦åŒæ—¶æ·»åŠ POSTå’ŒGETï¼Œè¯·ä½¿ç”¨è‹±æ–‡é€—å·ï¼ˆ,ï¼‰éš”å¼€ã€‚
* Access-Control-Max-Age  æŒ‡å®šå®¢æˆ·ç«¯ç¨‹åºå¯¹ç‰¹å®šèµ„æºçš„é¢„å–è¯·æ±‚è¿”å›ç»“æœçš„ç¼“å­˜æ—¶é—´ã€‚ 600
* Access-Control-Expose-Headers æŒ‡å®šå…è®¸è®¿é—®çš„è‡ªå®šä¹‰å¤´ä¿¡æ¯ã€‚  Content-Length
</pre>

<p>
<b>cdn</b>
</p>

<p>
<a href="https://help.aliyun.com/document_detail/27137.html?spm=5176.11785003.0.dexternal.7b0b142f3ou3vv">https://help.aliyun.com/document_detail/27137.html?spm=5176.11785003.0.dexternal.7b0b142f3ou3vv</a>
</p>

<p>
ç™»å½•CDNæ§åˆ¶å°&#x2013;&gt;åœ¨å·¦ä¾§å¯¼èˆªæ ï¼Œå•å‡»åŸŸåç®¡ç†&#x2013;&gt;åœ¨åŸŸåç®¡ç†é¡µé¢ï¼Œå•å‡»ç›®æ ‡åŸŸåå¯¹åº”çš„ç®¡ç†
</p>

<p>
åœ¨æŒ‡å®šåŸŸåçš„å·¦ä¾§å¯¼èˆªæ ï¼Œå•å‡»ç¼“å­˜é…ç½® &#x2013;&gt; å•å‡»ç¼“å­˜HTTPå“åº”å¤´ &#x2013;&gt; åœ¨ç¼“å­˜HTTPå“åº”å¤´é¡µç­¾ï¼Œå•å‡»æ·»åŠ ã€‚
</p>

<pre class="example" id="org5cc9405">
Access-Control-Allow-Origin *
Access-Control-Allow-Methods GET,POST,PUT,DELETE,HEAD
#æ³¨æ„ â€œæ˜¯å¦å…è®¸é‡å¤â€é€‰ä¸é‡å¤
</pre>


<figure id="org7c1b0af">
<img src="./images/image-20210315172534369.png" alt="image-20210315172534369.png">

</figure>

<p>
<b>k8sè·¨åŸŸ</b>
</p>

<pre class="example" id="org64b03ea">
nginx.ingress.kubernetes.io/cors-allow-credentials: "true"
nginx.ingress.kubernetes.io/cors-allow-headers: '*'
nginx.ingress.kubernetes.io/cors-allow-methods: PUT,GET,POST,OPTIONS
nginx.ingress.kubernetes.io/cors-allow-origin: http://test-admin.d.rrinner.cn   ï¼ˆ æŒ‡å®šåŸŸåï¼‰
nginx.ingress.kubernetes.io/enable-cors: "true"
</pre>


<p>
<b>oss</b>
</p>

<p>
<a href="https://help.aliyun.com/document_detail/31870.html?spm=5176.11065259.1996646101.searchclickresult.1d762eadmmqkJN">https://help.aliyun.com/document_detail/31870.html?spm=5176.11065259.1996646101.searchclickresult.1d762eadmmqkJN</a>
</p>


<figure id="org838a81a">
<img src="./images/image-20210315172556424.png" alt="image-20210315172556424.png">

</figure>

<pre class="example" id="org33d094d">
*
GET,POST,PUT,DELETE,HEAD
*
ETag
x-oss-request-id
</pre>



<p>
<b>è¯ä¹¦åˆ°æœŸæ—¶é—´</b>
</p>

<p>
httpså…è´¹è¯ä¹¦è‡ªåŠ¨ç»­ç­¾ï¼Œåœ¨åˆ°æœŸå‰4å¤©è‡ªåŠ¨ç»­ç­¾
</p>

<p>
<b>é—®é¢˜æ’æŸ¥å·¥å…·</b>
</p>

<p>
1ã€è®¿é—®å¼‚å¸¸æ—¶é—´ç‚¹ã€å¿…è¦ã€‘
</p>

<p>
2ã€å…·ä½“è®¿é—®å¼‚å¸¸çš„URLã€å¿…è¦ã€‘ï¼›
</p>

<p>
2ã€è®¿é—®CDNçš„èŠ‚ç‚¹IPï¼Œæ‚¨å¯ä»¥é€šè¿‡pingåŠ é€ŸåŸŸåå¾—åˆ°ã€ç”¨æˆ·å®¢æˆ·ç«¯ç¯å¢ƒå…è®¸å¯æä¾›ã€‘ï¼›
</p>

<p>
3ã€è¯·æä¾›ä¸‹æŠ¥éšœç”¨æˆ·å®¢æˆ·ç«¯çš„IPå’ŒDNSä¿¡æ¯ï¼Œå®¢æˆ·ç«¯æµè§ˆå™¨ç›´æ¥è®¿é—®<a href="https://cdn.dns-detect.alicdn.com/https/doc.html">https://cdn.dns-detect.alicdn.com/https/doc.html</a> å¹¶æˆªå›¾å³å¯ã€å¿…è¦ã€‘ï¼›
</p>

<p>
4ã€ç”¨æˆ·å®¢æˆ·ç«¯è®¿é—®çš„æŠ¥é”™ä¿¡æ¯å’Œæˆªå›¾ã€å¿…è¦ã€‘ï¼›
</p>

<p>
5ã€é€šè¿‡æµè§ˆå™¨æŒ‰F12å¼€å‘è€…æ¨¡å¼ä¸­çš„networkæ ‡ç­¾é¡µä¸­æŸ¥çœ‹åˆ°ï¼ŒåŒ…æ‹¬requestã€responseå¤´ä¿¡æ¯ï¼Œå¹¶ä¸”å¸®å¿™è·å–headerå¤´responseå¤´ä¿¡æ¯ä¸­â€œEagleId: 7d4cf79f16183882838401048e â€è¿™ä¸ªå­—æ®µï¼›viaä¸­vcache7.cn3181ä»£è¡¨ä¸€ç»„CDNç¼“å­˜èŠ‚ç‚¹ã€ç”¨æˆ·å®¢æˆ·ç«¯ç¯å¢ƒå…è®¸å¯æä¾›ã€‘ï¼›
</p>

<p>
6ã€æ”¶é›†åŸŸåè§£æä¿¡æ¯ï¼Œæµè§ˆå™¨è®¿é—®å¹¶æˆªå›¾ <a href="http://dns.alidns.com/resolve?name">http://dns.alidns.com/resolve?name</a>= è¯·å¡«å†™æŠ¥éšœåŸŸå ã€ç”¨æˆ·å®¢æˆ·ç«¯ç¯å¢ƒå…è®¸å¯æä¾›ã€‘ï¼›
</p>


<figure id="org97bd3e7">
<img src="./images/image-20210423140835661.png" alt="image-20210423140835661.png">

</figure>

<p>
ç™½å±é—®é¢˜æ˜¯è¿™æ ·çš„ï¼Œæœ‰ä¸¤ä¸ªæ€è·¯ï¼Œä¸€ä¸ªæ˜¯ç”¨æˆ·ä¾§æ²¡æœ‰è®¿é—®åˆ°cdnèŠ‚ç‚¹ä¸Šï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œæœ‰å¯èƒ½æ˜¯è¢«åŠ«æŒï¼›å¦ä¸€ä¸ªæ˜¯å¦‚æœè®¿é—®åˆ°cdnèŠ‚ç‚¹ä¸Šï¼Œè®¿é—®åˆ°çš„æ˜¯å“ªä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘è¿™è¾¹éœ€è¦æ ¹æ®èŠ‚ç‚¹ipå®šä½å½“æ—¶çš„ç›‘æ§æ˜¯å¦æœ‰é—®é¢˜ï¼Œæ˜¯å¦éœ€è¦è°ƒæ•´è°ƒåº¦è¦†ç›–ã€‚
</p>
</div>
<div id="outline-container-h:d68efa88-37b9-45b4-8eb9-0bf789e7bf27" class="outline-4">
<h4 id="h:d68efa88-37b9-45b4-8eb9-0bf789e7bf27">CDNå‚å•†å“åº”æ£€æµ‹</h4>
<div class="outline-text-4" id="text-h:d68efa88-37b9-45b4-8eb9-0bf789e7bf27">
<p>
<a href="https://www.uptrends.com/">https://www.uptrends.com/</a>
</p>
</div>
</div>
</div>
</section>
<section id="outline-container-h:8d3c1307-d936-4f78-a0e2-e1d55419cf77" class="outline-2">
<h2 id="h:8d3c1307-d936-4f78-a0e2-e1d55419cf77">RAM</h2>
<div class="outline-text-2" id="text-h:8d3c1307-d936-4f78-a0e2-e1d55419cf77">
<p>
è®¿é—®æ§åˆ¶
</p>
</div>
<div id="outline-container-h:a8fbf19e-7927-45ac-a9c0-643215d54b88" class="outline-3">
<h3 id="h:a8fbf19e-7927-45ac-a9c0-643215d54b88">RAM-OSS</h3>
<div class="outline-text-3" id="text-h:a8fbf19e-7927-45ac-a9c0-643215d54b88">
<p>
åªå¯¹åä¸º hdzy çš„osså­˜å‚¨ä¸­zone/answer/ å’Œ book_photo_path/ ç›®å½•æœ‰ä¸Šä¼ è¯»æƒé™ï¼Œæ²¡æœ‰åˆ é™¤æƒé™
</p>

<p>
æ³¨æ„å‰åé¡ºåº
</p>

<pre class="example" id="org138b45f">
{
  "Version": "1",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListBuckets",
        "oss:GetBucketAcl"
      ],
      "Resource": [
        "acs:oss:*:*:*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:Get*",
    "oss:Put*",
      ],
      "Resource": [
        "acs:oss:*:*:hdzy/zone/answer/*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListObjects"
      ],
      "Resource": [
        "acs:oss:*:*:hdzy"
      ],
      "Condition": {
        "oss:Delimiter":"/",
        "StringLike": {
          "oss:Prefix": [
            "",
            "zone/",
            "zone/answer/*"
          ]
        }
      }
    }
  ]
}
</pre>



<p>
OSS è®¿é—®æ§åˆ¶
</p>

<p>
1.æˆæƒ RAM ç”¨æˆ·å®Œå…¨ç®¡ç†æŸä¸ª Bucket: myphotos çš„æƒé™ã€‚
</p>

<pre class="example" id="orgbba7285">
{
    "Version": "1",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": "oss:*",
            "Resource": [
                "acs:oss:*:*:myphotos",
                "acs:oss:*:*:myphotos/*"
            ]
        }
    ]
}
</pre>


<p>
2.æˆæƒ RAM ç”¨æˆ·åˆ—å‡ºå¹¶è¯»å–ä¸€ä¸ª Bucket ä¸­çš„èµ„æºã€‚
</p>

<pre class="example" id="orgfe74fba">
{
    "Version": "1",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": ["oss:ListObjects","oss:GetObject"],
            "Resource": [
                "acs:oss:*:*:myphotos",
                "acs:oss:*:*:myphotos/*"
                ]
        }
    ]
}
</pre>

<p>
æŸå…¬å¸
</p>

<pre class="example" id="org42dcf03">
{
    "Version": "1",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "oss:ListParts",
                "oss:AbortMultipartUpload",
                "oss:PutObject",
                "oss:GetObject",
                "oss:listObjects",
                "oss:GetBucketReferer",
                "oss:SetBucketReferer",
                "oss:DeleteBucket",
                "oss:CreateBucket",
                "oss:GetBucketAcl"
            ],
            "Resource": [
                "acs:oss:*:*:xjp-tope365-app",
                "acs:oss:*:*:xjp-tope365-app/*"
            ]
        }
    ]
}
</pre>


<p>
1.åªè®¿é—®å’Œç¼–å†™bucket ï¼š mfs-source ä¸­çš„å•ä¸ªç›®å½•
    åœ¨RAMä¸­é…ç½®æƒé™ç­–ç•¥
</p>

<pre class="example" id="org6dafe46">
{
  "Version": "1",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListBuckets"
      ],
      "Resource": [
        "acs:oss:*:*:*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListObjects"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source"
      ],
      "Condition": {
        "StringLike": {
          "oss:Delimiter": "/",
          "oss:Prefix": [
            "",
            "BackendEditor/*"
          ]
        }
      }
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListObjects"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source"
      ],
      "Condition": {
        "StringLike": {
          "oss:Prefix": [
            "BackendEditor/*"
          ]
        }
      }
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:*"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source/BackendEditor/*"
      ]
    }
  ]
}
</pre>

<p>
2.bukectä¸Šä¼ æŸ¥çœ‹æƒé™ 
</p>

<pre class="example" id="orgf581d79">
{
  "Version": "1",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListBuckets",
        "oss:GetBucketAcl"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source",
        "acs:oss:*:*:mfs-source/*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:Get*",
        "oss:Put*"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source",
        "acs:oss:*:*:mfs-source/*"
      ]
    }
  ]
}
</pre>
</div>
</div>
<div id="outline-container-h:42014010-683b-49ea-8871-6651ed9114d4" class="outline-3">
<h3 id="h:42014010-683b-49ea-8871-6651ed9114d4">RAM-RDS</h3>
<div class="outline-text-3" id="text-h:42014010-683b-49ea-8871-6651ed9114d4">
<p>
æ•°æ®åº“å®¡è®¡æƒé™
</p>

<pre class="example" id="org32d4a1c">
{
  "Statement": [
    {
      "Action": "rds:DescribeSQLLogRecords",
      "Effect": "Allow",
      "Resource": "acs:rds:*:*:dbinstance/rdsjmlwvi81yzyaypa1gb"
    },
    {
      "Action": "rds:DescribeSQLLogRecords",
      "Effect": "Allow",
      "Resource": "*"
    }
  ],
  "Version": "1"
}
</pre>


<p>
æ•°æ®åº“æƒé™
</p>

<pre class="example" id="orgae46125">
{
  "Version": "1",
  "Statement": [
    {
      "Action": "rds:*",
      "Resource": "acs:rds:*:*:*",
      "Effect": "Allow"
    },
    {
      "Action": "dms:LoginDatabase",
      "Resource": "acs:rds:*:*:dbinstance/rm-bp1o4v71t63p433f2",
      "Effect": "Allow"
    }
  ]
}
</pre>



<p>
<b>RDSå•å®ä¾‹æˆæƒ</b>
</p>

<p>
RDSå•å®ä¾‹æˆæƒ(æ ‡ç­¾æ–¹å¼)
</p>

<p>
<a href="https://help.aliyun.com/document_detail/95252.html?spm=5176.11065259.1996646101.searchclickresult.ce1b473f50Zjxi">https://help.aliyun.com/document_detail/95252.html?spm=5176.11065259.1996646101.searchclickresult.ce1b473f50Zjxi</a>
</p>

<p>
```bash
</p>
<pre class="example" id="orgbe41fe2">
{
  "Statement": [
    {
      "Action": "rds:*",
      "Effect": "Allow",
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "rds:ResourceTag/k": "haibao"
        }
      }
    },
    {
      "Action": "rds:DescribeTag*",
      "Effect": "Allow",
      "Resource": "*"
    },
    {
      "Action": "dms:LoginDatabase",
      "Resource": "acs:rds:*:*:dbinstance/rm-rm-hp31i9h07g1ay3r7s",
      "Effect": "Allow"
    }
  ],
  "Version": "1"
}
</pre>

<p>
ä»¥ä¸‹èƒ½çœ‹åˆ°æ‰€æœ‰çš„RDSï¼Œä½†åªèƒ½æ“ä½œè‡ªå·±æƒé™çš„RDS
</p>

<p>
<a href="https://help.aliyun.com/knowledge_detail/58932.html?spm=a2c4g.11186623.6.708.5b0966edJGHwuv">https://help.aliyun.com/knowledge_detail/58932.html?spm=a2c4g.11186623.6.708.5b0966edJGHwuv</a>
</p>

<p>
è¯´æ˜ æˆäºˆè¯¥ç­–ç•¥çš„RAMç”¨æˆ·æ˜¯å¯ä»¥åˆ—å‡ºæ‰€æœ‰çš„RDSå®ä¾‹ï¼Œä½†åªèƒ½æ“ä½œï¼ˆæ¯”å¦‚DeleteDBInstanceæ“ä½œï¼‰å…¶ä¸­çš„ä¸¤å°ã€‚ç›®å‰ï¼Œä¸æ”¯æŒRAMç”¨æˆ·ä»…ä»…æŸ¥çœ‹è‡ªå·±æœ‰è®¿é—®æƒé™çš„RDSå®ä¾‹ã€‚
</p>

<p>
RAMè®¿é—®æ§åˆ¶ä¸­è®¾ç½®ç»„ç®¡ç†å‘˜
</p>

<p>
RAMæƒé™æ¦‚è¿°:<a href="https://help.aliyun.com/document_detail/102666.html?spm=a2c4g.11186623.6.730.67e736a9bjc2CK">https://help.aliyun.com/document_detail/102666.html?spm=a2c4g.11186623.6.730.67e736a9bjc2CK</a>
</p>

<pre class="example" id="org3555f8c">
{
    "Version": "1",
    "Statement": [
        {
            "Action": [
                "ram:Get*",
                "ram:List*",
                "ram:GenerateCredentialReport"
            ],
            "Resource": "*",
            "Effect": "Allow"
        },
        {
            "Action": [
                "ram:AddUserToGroup",
                "ram:RemoveUserFromGroup",
                "ram:ListUsersForGroup",
                "ram:UpdateGroup",
                "ram:ListGroupsForUser"
            ],
            "Resource": [
                "acs:ram:*:*:group/sa-test",
                "acs:ram:*:*:user/*"
            ],
            "Effect": "Allow"
        }
    ]
}
</pre>

<p>
æ³¨æ„ï¼šuserååŠ *ï¼Œè¡¨ç¤ºè¦åŠ å“ªäº›äººåˆ°ç»„å†…ã€‚
</p>



<p>
æƒé™è®°å½•
</p>

<p>
Aliyun-denyDeleteAccess
</p>

<pre class="example" id="org805c7d6">
{
    "Version": "1",
    "Statement": [
        {
            "Effect": "Deny",
            "Action": [
                "ecs:Delete*",
                "ecs:ModifyInstanceAutoReleaseTime",
                "slb:DeleteLoadBalancer",
                "vpc:DeleteVpc",
                "vpc:DeleteVSwitch",
                "vpc:DeleteRouteEntry",
                "vpc:DeleteRouteTable",
                "vpc:ReleaseEipAddress",
                "vpc:DeletePhysicalConnection",
                "vpc:DeleteRouterInterface",
                "vpc:DeleteVirtualBorderRouter",
                "vpc:DeleteBgpGroup",
                "vpc:DeleteBgpPeer",
                "vpc:DeleteNatGateway",
                "vpc:RemoveBandwidthPackageIps",
                "vpc:DeleteBandwidthPackage",
                "vpc:DeleteVpnGateway",
                "vpc:DeleteCustomerGateway",
                "vpc:DeleteVpnConnection",
                "rds:DeleteDBInstance",
                "rds:DeleteDatabase",
                "kvstore:DeleteInstance",
                "oss:DeleteBucket",
                "oss:DeleteBucketEncryption",
                "oss:DeleteObject",
                "oss:DeleteMultipleObjects",
                "cdn:DeleteCdnDomain",
                "ram:CreateAccessKey",
                "ram:DeleteAccessKey",
                "ram:DeleteVirtualMFADevice",
                "ram:DeleteUser",
                "ram:DeleteGroup",
                "ram:DeleteRole",
                "ram:DeletePolicy",
                "ram:CreatePolicyVersion",
                "ram:DeletePolicyVersion",
                "ram:SetDefaultPolicyVersion"
            ],
            "Resource": "*"
        },
        {
            "Effect": "Deny",
            "Action": [
                "ram:AttachPolicyToUser",
                "ram:AttachPolicyToGroup",
                "ram:AttachPolicyToRole"
            ],
            "Resource": [
                "acs:ram:*:*:*"
            ]
        },
        {
            "Effect": "Deny",
            "Action": [
                "ram:DetachPolicyFromUser",
                "ram:DetachPolicyFromGroup",
                "ram:DetachPolicyFromRole"
            ],
            "Resource": [
                "acs:ram:*:*:*"
            ]
        }
    ]
}
</pre>

<p>
ç»„æƒé™ä¸­ã€‚åªè¦fullæƒé™åœ¨ï¼Œdenyå°±å¤±æ•ˆäº†
</p>



<p>
aliyunRAM-SAadmin
</p>

<pre class="example" id="orgcfa961a">
{
    "Version": "1",
    "Statement": [
        {
            "Action": [
                "ram:Create*",
                "ram:Get*",
                "ram:List*",
                "ram:GenerateCredentialReport"
            ],
            "Resource": "*",
            "Effect": "Allow"
        },
        {
            "Action": [
                "ram:AddUserToGroup",
                "ram:RemoveUserFromGroup",
                "ram:ListUsersForGroup",
                "ram:UpdateGroup",
                "ram:ListGroupsForUser"
            ],
            "Resource": [
                "acs:ram:*:*:group/*",
                "acs:ram:*:*:user/*"
            ],
            "Effect": "Allow"
        },
        {
            "Action": [
                "ram:AddUserToGroup",
                "ram:RemoveUserFromGroup",
                "ram:ListUsersForGroup",
                "ram:UpdateGroup",
                "ram:ListGroupsForUser"
            ],
            "Resource": [
                "acs:ram:*:*:group/dba"
            ],
            "Effect": "Deny"
        }
    ]
}
</pre>


<figure id="org40374bb">
<img src="./images/image-20210315170220943.png" alt="image-20210315170220943.png">

</figure>


<figure id="org05bd48e">
<img src="./images/image-20210315170238892.png" alt="image-20210315170238892.png">

</figure>


<figure id="org135dec0">
<img src="./images/image-20210315170301260.png" alt="image-20210315170301260.png">

</figure>


<figure id="org04c2e79">
<img src="./images/image-20210315170313702.png" alt="image-20210315170313702.png">

</figure>
</div>
</div>
<div id="outline-container-h:dd0f97f3-ca45-4e79-b99a-a04399d6dd99" class="outline-3">
<h3 id="h:dd0f97f3-ca45-4e79-b99a-a04399d6dd99">RAM-CDN</h3>
<div class="outline-text-3" id="text-h:dd0f97f3-ca45-4e79-b99a-a04399d6dd99">
<p>
èŒƒä¾‹ï¼šåˆ·æ–°cdnï¼Œç™½åå•ipæœ‰æ“ä½œæƒé™
</p>

<pre class="example" id="org69e7fe0">
{
    "Version": "1",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "cdn:PushObjectCache",
                "cdn:RefreshObjectCaches"
            ],
            "Resource": "acs:cdn:*:*:*",
            "Condition": {
                "IpAddress": {
                    "acs:SourceIp": [
                        "211.103.135.96/29",
                        "123.57.87.183",
                        "47.241.25.157",
                        "39.107.102.36"
                    ]
                }
            }
        }
    ]
}
</pre>
</div>
</div>
<div id="outline-container-h:e0f691e7-c5f4-47e7-adf6-c6712a86819b" class="outline-3">
<h3 id="h:e0f691e7-c5f4-47e7-adf6-c6712a86819b">RAM-STS</h3>
<div class="outline-text-3" id="text-h:e0f691e7-c5f4-47e7-adf6-c6712a86819b">
<p>
ä¸´æ—¶æˆæƒ
</p>

<p>
1.ramä¸­åˆ›å»ºstsæ¥å£è°ƒç”¨è´¦å·
</p>

<p>
2.åˆ›å»ºè‡ªå®šä¹‰æˆæƒç­–ç•¥
</p>

<p>
åˆ›å»ºæƒé™ç­–ç•¥oss-access
</p>

<pre class="example" id="orgdb95e6e">
{
    "Version": "1",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "oss:ListParts",
                "oss:AbortMultipartUpload",
                "oss:PutObject",
                "oss:GetObject",
                "oss:listObjects",
                "oss:GetBucketReferer",
                "oss:SetBucketReferer",
                "oss:GetBucketAcl"
            ],
            "Resource": [
                "acs:oss:*:*:dev-operation-activity",
                "acs:oss:*:*:dev-operation-activity/*"
            ]
        }
    ]
}
</pre>

<p>
3.åˆ›å»ºRAMè§’è‰²å¹¶å…³è”æƒé™ç­–ç•¥
</p>

<p>
åˆ›å»ºRAMè§’è‰²abc-stsæ·»åŠ æƒé™oss-accessï¼Œè®°ä½ARNä¿¡æ¯ã€‚
</p>

<p>
4.è´¦å·æˆæƒ
</p>

<p>
æ·»åŠ stsè°ƒç”¨æƒé™å’Œoss-accessæƒé™
</p>

<p>
5.æ¥å£è°ƒç”¨
</p>

<p>
è°ƒç”¨æ—¶ä½¿ç”¨ARNä¿¡æ¯
</p>
</div>
</div>
</section>
<section id="outline-container-h:eddc6945-5566-41f2-8d98-f62780b32b74" class="outline-2">
<h2 id="h:eddc6945-5566-41f2-8d98-f62780b32b74">SLSæ—¥å¿—</h2>
<div class="outline-text-2" id="text-h:eddc6945-5566-41f2-8d98-f62780b32b74">
</div>
<div id="outline-container-h:e8f745f9-ebc6-4c54-bafe-ed8881b9d210" class="outline-3">
<h3 id="h:e8f745f9-ebc6-4c54-bafe-ed8881b9d210">æŸ¥è¯¢SQL</h3>
<div class="outline-text-3" id="text-h:e8f745f9-ebc6-4c54-bafe-ed8881b9d210">
<p>
èŒƒä¾‹ï¼šæŠ¥é”™ç»Ÿè®¡
</p>

<pre class="example" id="org0d815a9">
{"status":"200","header":"{\"x-forwarded-scheme\":\"http\"}","body":"{\"errorType\":1}","__time__":"1740581992"}
</pre>

<div class="org-src-container">
<pre class="src src-sh">body.errorType: * and not (body.message: <span style="color: #8b2252;">'4001'</span> or body.sub1:<span style="color: #8b2252;">'4001'</span>)  | SELECT
  <span style="color: #8b2252;">"body.errorType"</span> AS <span style="color: #8b2252;">"errorType"</span>,
  COUNT(*) AS cnt,(
    CASE
      WHEN <span style="color: #8b2252;">"body.errorType"</span> = 1 THEN <span style="color: #8b2252;">'&#24402;&#22240;&#20449;&#24687;&#19978;&#25253;'</span>
      WHEN <span style="color: #8b2252;">"body.errorType"</span> = 2 THEN <span style="color: #8b2252;">'&#25773;&#25918;&#22120;&#25253;&#38169;'</span>
      WHEN <span style="color: #8b2252;">"body.errorType"</span> = 4 THEN <span style="color: #8b2252;">'&#23433;&#21331;-&#35895;&#27468;&#25903;&#20184;&#24322;&#24120;'</span>
      WHEN <span style="color: #8b2252;">"body.errorType"</span> = 5 THEN <span style="color: #8b2252;">'IOS-&#33529;&#26524;&#25903;&#20184;&#24322;&#24120;'</span>
      WHEN <span style="color: #8b2252;">"body.errorType"</span> = 11 THEN <span style="color: #8b2252;">'&#30331;&#24405;&#25509;&#21475;&#25253;&#38169;'</span>
      WHEN <span style="color: #8b2252;">"body.errorType"</span> = 13 THEN <span style="color: #8b2252;">'&#23458;&#25143;&#31471;&#23849;&#28291;'</span>
      WHEN <span style="color: #8b2252;">"body.errorType"</span> = 14 THEN <span style="color: #8b2252;">'&#24191;&#21578;&#21152;&#36733;/&#25773;&#25918;&#22833;&#36133;'</span>
      ELSE <span style="color: #8b2252;">'&#26410;&#30693;&#24322;&#24120;&#65292;&#35831;&#25490;&#26597;'</span>
    END
  ) AS <span style="color: #8b2252;">"errorDesc"</span>
FROM  <span style="color: #8b2252;">"error-push"</span>
GROUP BY
  <span style="color: #8b2252;">"errorType"</span>
order by
  cnt
</pre>
</div>

<p>
èŒƒä¾‹ï¼šæŒ‰å¤©ç»Ÿè®¡
</p>
<div class="org-src-container">
<pre class="src src-sh">(* and body.errorType:2 and body.errorInfo : <span style="color: #8b2252;">"\"errMsg\":\"&#20986;&#38382;&#39064;&#21862;\""</span>)| SELECT date_trunc(<span style="color: #8b2252;">'day'</span>, from_unixtime(__time__)) AS t, COUNT(*) AS count FROM log GROUP BY t ORDER BY t ASC
</pre>
</div>
</div>
</div>
<div id="outline-container-h:7efbf2f1-7607-4e3f-a736-e93fb447efef" class="outline-3">
<h3 id="h:7efbf2f1-7607-4e3f-a736-e93fb447efef">æ•°æ®åŠ å·¥</h3>
<div class="outline-text-3" id="text-h:7efbf2f1-7607-4e3f-a736-e93fb447efef">
<p>
SPLè¯­æ³•ï¼š<a href="https://help.aliyun.com/zh/sls/user-guide/spl-overview/">https://help.aliyun.com/zh/sls/user-guide/spl-overview/</a>
</p>

<p>
åŸå§‹æ—¥å¿—
</p>
<pre class="example" id="org1ee1375">
{"status":"200","header":"{\"client-id\":\"746\"}","body":"{\"errorType\":2,\"errorInfo\":{\"error\":\"{\\\"errMsg\\\":\\\"MEDIA_ERR_NETWORK(-11101,11022102)\\\"}\"}}","__time__":"1740582886"}
{"status":"200","header":"{\"client-id\":\"42\"}","body":"{\"errorType\":2,\"errorInfo\":{\"errMsg\":\"FFmpegDemuxer: open context failed\",\"errNo\":10401}}","__time__":"1740582870"}
</pre>

<div class="org-src-container">
<pre class="src src-sh">*
|extend <span style="color: #a0522d;">errorType</span>=json_extract(body, <span style="color: #8b2252;">'$.errorType'</span>)
-- |where json_format(errorType) !=<span style="color: #8b2252;">'2'</span>
|extend <span style="color: #8b2252;">"client-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.client-id'</span>)
|extend <span style="color: #8b2252;">"user-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.user-id'</span>)
|extend <span style="color: #8b2252;">"sub-user-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.sub-user-id'</span>)
|extend <span style="color: #8b2252;">"product-user-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.product-user-id'</span>)
|extend <span style="color: #8b2252;">"app-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.app-id'</span>)
|extend <span style="color: #8b2252;">"batch-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.batch-id'</span>)
|extend <span style="color: #8b2252;">"spread-channel-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.spread-channel-id'</span>)
|extend <span style="color: #8b2252;">"compilations-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.compilations-id'</span>)
|extend <span style="color: #8b2252;">"chain-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.chain-id'</span>)
-- &#26102;&#38388;time
|extend <span style="color: #a0522d;">ts</span>=cast(__time__ as INTEGER) |extend <span style="color: #a0522d;">time</span>=date_format(ts+28800, <span style="color: #8b2252;">'%Y-%m-%d %H:%i'</span>)
-- errorDetail : &#26377;errorInfo&#30340;&#30452;&#25509;&#20351;&#29992;,    &#26377;videoUrl &#30452;&#25509;&#36171;&#20540;
|extend <span style="color: #a0522d;">errorDetail1</span>=json_extract(body, <span style="color: #8b2252;">'$.errorInfo'</span>) |extend <span style="color: #a0522d;">errorDetail1</span>=COALESCE(json_format(errorDetail1), <span style="color: #8b2252;">''</span>) 
|extend <span style="color: #a0522d;">errorDetail2</span>=json_extract(body, <span style="color: #8b2252;">'$.videoUrl'</span>) |extend <span style="color: #a0522d;">errorDetail2</span>=COALESCE(json_format(errorDetail2), <span style="color: #8b2252;">''</span>)
|extend <span style="color: #a0522d;">errorDetail</span>=concat(errorDetail1, <span style="color: #8b2252;">''</span>, errorDetail2) 
-- errorTag:  &#26377;errMsg&#30452;&#25509;&#20351;&#29992; , &#26377;errorInfo&#30340;, &#21462;&#20854;&#20013;&#30340; errMsg
|extend <span style="color: #a0522d;">errorTag1</span>=json_extract(body, <span style="color: #8b2252;">'$.errMsg'</span>) |extend <span style="color: #a0522d;">errorTag1</span>=COALESCE(json_format(errorTag1), <span style="color: #8b2252;">''</span>) 
-- |extend <span style="color: #a0522d;">errorTag2</span>=json_extract(body, <span style="color: #8b2252;">'$.errorInfo'</span>) |extend <span style="color: #a0522d;">errorTag2</span>=COALESCE(json_format(errorTag2), <span style="color: #8b2252;">''</span>) 
|extend <span style="color: #a0522d;">t2</span>=json_format(json_extract(body, <span style="color: #8b2252;">'$.errorInfo'</span>)) 
| extend <span style="color: #a0522d;">errorTag2</span>=regexp_extract(t2, <span style="color: #8b2252;">'\"errMsg\\":\\"(.+?)\\"'</span>, 1)  |extend <span style="color: #a0522d;">errorTag2</span>=COALESCE(errorTag2, <span style="color: #8b2252;">''</span>) 
| extend <span style="color: #a0522d;">errorTag3</span>=regexp_extract(t2, <span style="color: #8b2252;">'errMsg":"(.+?)"'</span>, 1)  |extend <span style="color: #a0522d;">errorTag3</span>=COALESCE(errorTag3, <span style="color: #8b2252;">''</span>) 
--|extend <span style="color: #a0522d;">errorTag_2</span>=regexp_extract(body, <span style="color: #8b2252;">'\\"errMsg\\":\\"(.+?)\\"'</span>,1)
|extend <span style="color: #a0522d;">errorTag</span>=concat(errorTag1, <span style="color: #8b2252;">''</span>, errorTag2, errorTag3) 
-- errorNo:  &#21462;errorInfo&#37324;&#30340;errNo. &#27809;&#26377;&#30340;&#35805;&#33258;&#24049;&#33258;&#24049;&#39030;&#19968;&#20010;&#19968;&#20010;3&#20301;&#25968;&#23383;
|extend <span style="color: #a0522d;">errorNo1</span>=regexp_extract(t2, <span style="color: #8b2252;">'\"errNo\\":\\"(.+?)\\"'</span>, 1)  |extend <span style="color: #a0522d;">errorNo1</span>=COALESCE(errorNo1, <span style="color: #8b2252;">''</span>) 
|extend <span style="color: #a0522d;">errorNo2</span>=regexp_extract(t2, <span style="color: #8b2252;">'errNo":(\d+)'</span>, 1)  |extend <span style="color: #a0522d;">errorNo2</span>=COALESCE(errorNo2, <span style="color: #8b2252;">''</span>) 
|extend <span style="color: #a0522d;">errorNo3</span>=concat(errorNo1, <span style="color: #8b2252;">''</span>, errorNo2) | parse-regexp errorNo3, <span style="color: #8b2252;">'(\S+)'</span> as errorNo | extend <span style="color: #a0522d;">errorNo</span>=COALESCE(errorNo, <span style="color: #8b2252;">'999'</span>)
|project errorType, errorTag, errorNo, errorDetail, <span style="color: #8b2252;">"client-id"</span>, <span style="color: #8b2252;">"user-id"</span>, <span style="color: #8b2252;">"sub-user-id"</span>, <span style="color: #8b2252;">"product-user-id"</span>, <span style="color: #8b2252;">"app-id"</span>, <span style="color: #8b2252;">"batch-id"</span>, <span style="color: #8b2252;">"spread-channel-id"</span>, <span style="color: #8b2252;">"compilations-id"</span>, <span style="color: #8b2252;">"chain-id"</span>, time;
</pre>
</div>
</div>
</div>
</section>
</main class="container">
<footer id="postamble" class="status">
<footer data-astro-cid-sz7xmlte data-turbo-permanent id=rootFooter>
    <script>
        const shuffle = e => e.map((e => ({
            v: e,
            sort: Math.random()
        }))).sort(( (e, o) => e.sort - o.sort)).map(( ({v: e}) => e));
        var songList = ["barbie-girl--stantough", "blue-da-ba-dee--cornelius-link", "hips-dont-lie--stantough", "i-want-it-that-way--stantough", "seven-nation-army--stantough", "smooth-criminal--stantough"]
          , songOrder = songOrder ?? shuffle(songList).map((e => `/audio/music/${e}.opus`))
          , song = new Audio(songOrder[0])
          , nextSong = new Audio(songOrder[1])
          , songIndex = 2
          , musicWrapper = void 0
          , arrow = void 0
          , notes = void 0;
        song.addEventListener("ended", next);
        const toggle = () => song.paused ? play() : pause();
        function play() {
            song.play(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.add("shakeManHorse"),
            notes.classList.remove("hideNotes")
        }
        function pause() {
            song.pause(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.remove("shakeManHorse"),
            notes.classList.add("hideNotes")
        }
        function next() {
            song = nextSong,
            play(),
            songIndex === songOrder.length && (songIndex = 0),
            nextSong = new Audio(songOrder[songIndex]),
            songIndex += 1
        }
        function skip() {
            pause(),
            (arrow = arrow || document.getElementById("musicArrow")).classList.add("shootArrow");
            new Audio("/audio/effects/ohno.m4a").play(),
            arrow.addEventListener("animationend", arrowShootHandler, !1)
        }
        function arrowShootHandler() {
            arrow.removeEventListener("animationend", arrowShootHandler, !1),
            arrow.classList.remove("shootArrow");
            new Audio("/audio/effects/heythathurt.m4a").play(),
            next()
        }
    </script>
    <div id=musicPlayer data-astro-cid-q7a5pyro>
        <button class=skip data-astro-cid-q7a5pyro onclick=skip() title="Skip song">
            <div id=skipWrapper data-astro-cid-q7a5pyro>
                <img alt="Medieval drollery of a man/snail/bat/monkey shooting an arrow" class=archer decoding=async height=334 loading=lazy src=/images/archer-no-arrow.448ccd8b_Z1KfRYq.webp width=226 data-astro-cid-q7a5pyro>
                <img alt="Arrow for archer" class="arrow complete" decoding=async height=23 loading=lazy src=/images/no-archer-full-arrow.87aa9971_Z2qL2KO.webp width=141 data-astro-cid-q7a5pyro id=musicArrow>
            </div>
        </button>
        <button class=playPause data-astro-cid-q7a5pyro onclick=toggle() title="Play/pause song">
            <div id=musicWrapper data-astro-cid-q7a5pyro>
                <div class=hideNotes id=notesWrapper data-astro-cid-q7a5pyro>
                    <div class=lyreNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                    <div class=fluteNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                </div>
                <img alt="Medieval drollery of a man/horse playing a lyre and a horn" class=manHorse decoding=async height=665 loading=lazy src=/images/man-horse-band.e3a2efcf_q8FCa.webp width=531 data-astro-cid-q7a5pyro>
            </div>
        </button>
    </div>
    <hr data-astro-cid-sz7xmlte>
    <div class=salutation data-astro-cid-gdmrbrho>
        <p data-astro-cid-gdmrbrho>
            <span class=flower2 data-astro-cid-gdmrbrho>A</span>
            <span class=smallcap data-astro-cid-gdmrbrho>pax vobiscum</span>
            <span class="flower2 wiggle" data-astro-cid-gdmrbrho id=leaf>a</span>
        </p>
    </div>
    <script>
        function animateLeafBlownHandler() {
            leaf.removeEventListener("animationend", animateLeafBlownHandler, !1),
            leaf.classList.remove("blownAway"),
            leaf.classList.add("wiggle")
        }
        function animateLeaf() {
            leaf = leaf ?? document.getElementById("leaf"),
            leaf.classList.remove("wiggle"),
            leaf.classList.add("blownAway"),
            leaf.addEventListener("animationend", animateLeafBlownHandler, !1)
        }
        document.getElementById("leaf").onclick = animateLeaf
    </script>


    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>æ‰“èµ</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Â© 2024 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
</footer>
</footer>
</body>
</html>
