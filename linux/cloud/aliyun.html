<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linux: 阿里云使用</title>
<meta name="generator" content="Org Mode" />
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<!-- from -->
<!--
<style>#back-to-top{background:#000;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;bottom:20px;-webkit-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);-moz-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);box-shadow:0 2px 5px 0 rgba(0,0,0,.26);color:#fff;cursor:pointer;display:block;height:56px;opacity:1;outline:0;position:fixed;right:20px;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-transition:bottom .2s,opacity .2s;-o-transition:bottom .2s,opacity .2s;-moz-transition:bottom .2s,opacity .2s;transition:bottom .2s,opacity .2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:56px;z-index:1}#back-to-top svg{display:block;fill:currentColor;height:24px;margin:16px auto 0;width:24px}#back-to-top.hidden{bottom:-56px;opacity:0}</style>
-->
<link rel="stylesheet" href="/static/aandds.com/css/main.css">
<link rel="stylesheet" href="/static/aandds.com/css/drollery.min.css">
<script type="text/javascript" src="/static/aandds.com/js/main.js"></script>
<!--
<script id="MathJax-script" async="" src="/static/aandds.com/js/mathjax.js"></script>

<script type="text/javascript" src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
-->
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Linux: 阿里云使用</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:0000c3e4-1750-49e4-b2ea-f630132f7bb6">kernel</a></li>
<li><a href="#h:38e60e4e-1f69-4f72-a73e-9444d3688188">ECS</a>
<ul>
<li><a href="#h:d15075fe-d5e2-4fc1-8a4b-624c189bce38">磁盘扩容</a>
<ul>
<li><a href="#h:66e2ec12-1190-4b0b-815c-244ba66cfb13">AWS EC2 更换系统盘案例</a></li>
</ul>
</li>
<li><a href="#h:b28d3214-bf27-4638-9368-4fc4c7d0c5b4">快照</a></li>
<li><a href="#h:75b6da24-e73e-4cfc-a8ab-1f8590ef7774">系统救援</a></li>
</ul>
</li>
<li><a href="#h:ec0cf84d-6a64-449c-bf2b-4c8d575825c2">SLB</a></li>
<li><a href="#h:68550704-8745-4a17-abb1-372e222c5e24">网络互通</a>
<ul>
<li><a href="#h:72f842d6-c271-4b4c-8287-1b018177cce9">公司与阿里新加坡互通 vpn-ipsec</a></li>
<li><a href="#h:e656902e-b1d3-4b4d-9bd4-d47d0cded1db">阿里新加坡机房VPC与阿里华北2机房VPC网络互通-高速通道</a></li>
<li><a href="#h:f10042f9-5249-47ba-a1db-d33e6bb1c18a">阿里新加坡机房VPC与阿里华北2机房VPC网络互通-vpn-ipsec临时方案</a></li>
<li><a href="#h:862229a2-be97-49d4-8218-12070382d8cd">阿里云vpc与亚马逊vpc互通-vpn</a></li>
</ul>
</li>
<li><a href="#h:91dbdadb-e61e-4de4-bf90-202c2b815ab6">OSS</a>
<ul>
<li><a href="#h:b203d2f6-379d-4294-b589-1b8e492e974e">解冻转换文件类型</a></li>
<li><a href="#h:eb28fad8-869e-455b-84c6-14c410b47bb3">ossfs文件挂载</a></li>
<li><a href="#h:12490673-62e7-4b75-b8f9-58bd31945f2e">OSS 访问授权</a></li>
<li><a href="#h:4e546697-19c8-4fde-8909-386b7f72593e">nodejs +OSS STS</a></li>
<li><a href="#h:6efbb9e2-adcb-44c7-a96c-2c724d121250">oss跨域</a></li>
<li><a href="#h:2908f3e6-9c81-415a-8385-56006488f39b">腾讯-COS</a></li>
<li><a href="#h:0260d36c-8893-4eed-ba6b-86104b42ab19">aws-s3</a></li>
</ul>
</li>
<li><a href="#h:bebc4ee8-f5de-443f-96c5-fb5ff96afb93">NAS</a></li>
<li><a href="#h:974c8b8e-db89-4349-abdb-91c182655e5f">短信服务</a></li>
<li><a href="#h:d2700a10-479e-470b-ba71-daec5d458fca">CDN</a>
<ul>
<li><a href="#h:8d14bc95-ab69-4f7c-9f23-af02e9ec22f5">服务管理</a></li>
<li><a href="#h:b1cb9050-79b0-44ca-bc83-9e6836dabf93">cnd常用配置</a>
<ul>
<li><a href="#h:d68efa88-37b9-45b4-8eb9-0bf789e7bf27">CDN厂商响应检测</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:8d3c1307-d936-4f78-a0e2-e1d55419cf77">RAM</a>
<ul>
<li><a href="#h:a8fbf19e-7927-45ac-a9c0-643215d54b88">RAM-OSS</a></li>
<li><a href="#h:42014010-683b-49ea-8871-6651ed9114d4">RAM-RDS</a></li>
<li><a href="#h:dd0f97f3-ca45-4e79-b99a-a04399d6dd99">RAM-CDN</a></li>
<li><a href="#h:e0f691e7-c5f4-47e7-adf6-c6712a86819b">RAM-STS</a></li>
<li><a href="#h:5f1deb61-17ce-43ff-ad5b-127909ce9103">RAM-SLS</a></li>
<li><a href="#h:85020ccf-82cf-449c-9a0d-5adc7390072a">RAM-自定义-certd</a></li>
</ul>
</li>
<li><a href="#h:eddc6945-5566-41f2-8d98-f62780b32b74">SLS日志</a>
<ul>
<li><a href="#h:e8f745f9-ebc6-4c54-bafe-ed8881b9d210">查询SQL</a></li>
<li><a href="#h:7efbf2f1-7607-4e3f-a736-e93fb447efef">数据加工</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../index.html">Linux</a></li>
</ul>
<section id="outline-container-h:0000c3e4-1750-49e4-b2ea-f630132f7bb6" class="outline-2">
<h2 id="h:0000c3e4-1750-49e4-b2ea-f630132f7bb6">kernel</h2>
<div class="outline-text-2" id="text-h:0000c3e4-1750-49e4-b2ea-f630132f7bb6">
<p>
<a href="https://gitlab.com/gitlab-org/charts/gitlab/">https://gitlab.com/gitlab-org/charts/gitlab/</a>
</p>


<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">cpu&#21152;&#36895;</span>
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"cpupower frequency-set -g performance"</span> &gt;&gt; /etc/rc.local
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"echo 1 &gt; /proc/sys/net/ipv4/vs/ignore_no_rs_error"</span> &gt;&gt; /etc/rc.loal
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"echo 1 &gt; /proc/vm/fast_slub_nr_free"</span> &gt;&gt; /etc/rc.local
<span style="color: #483d8b;">echo</span> 1 &gt; /proc/sys/vm/fast_slub_nr-free;
<span style="color: #483d8b;">echo</span> 1 &gt; /proc/sys/net/ipv4/vs/ignore_no_rs_error

cpupower frequency-set -g performance
</pre>
</div>
</div>
</section>
<section id="outline-container-h:38e60e4e-1f69-4f72-a73e-9444d3688188" class="outline-2">
<h2 id="h:38e60e4e-1f69-4f72-a73e-9444d3688188">ECS</h2>
<div class="outline-text-2" id="text-h:38e60e4e-1f69-4f72-a73e-9444d3688188">
</div>
<div id="outline-container-h:d15075fe-d5e2-4fc1-8a4b-624c189bce38" class="outline-3">
<h3 id="h:d15075fe-d5e2-4fc1-8a4b-624c189bce38">磁盘扩容</h3>
<div class="outline-text-3" id="text-h:d15075fe-d5e2-4fc1-8a4b-624c189bce38">
<p>
<b>1. 扩容云盘（Linux系统）</b>
</p>

<p>
参考：<a href="https://help.aliyun.com/document_detail/44986.html?spm=a2c4g.11174283.6.836.d94352fe9MVzl3">https://help.aliyun.com/document_detail/44986.html?spm=a2c4g.11174283.6.836.d94352fe9MVzl3</a>
</p>

<p>
准备
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#38236;&#20687;&#25991;&#20214;&#28155;&#21152;200G&#65292;&#19981;&#33021;&#26377;&#24555;&#29031;</span>
qemu-img resize haproxy-clone.qcow2 +200G
qemu-img info haproxy-clone.qcow2
</pre>
</div>

<p>
步骤一：创建快照
</p>

<p>
步骤三：查看云盘分区情况
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">1. &#36828;&#31243;&#30331;&#24405;ECS&#23454;&#20363;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">2. &#36816;&#34892;&#21629;&#20196;fdisk -lu&#26597;&#30475;&#23454;&#20363;&#30340;&#20113;&#30424;&#24773;&#20917;</span>
[root@zentao01 ~]# fdisk -lu
Disk /dev/vda: 322.1 GB, 322122547200 bytes, 

   Device Boot      Start         End      Blocks   Id  System
/dev/vda1   *        2048   209715199   104856576   83  Linux

<span style="color: #b22222;">#</span><span style="color: #b22222;">System&#21462;&#20540;Linux&#34920;&#31034;&#20026;MBR&#20998;&#21306;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">System&#21462;&#20540;GPT&#34920;&#31034;&#20026;GPT&#20998;&#21306;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">3. &#36816;&#34892;&#21629;&#20196;blkid&#30830;&#35748;&#24050;&#26377;&#20998;&#21306;&#30340;&#25991;&#20214;&#31995;&#32479;&#31867;&#22411;&#12290;</span>
[root@zentao01 ~]# blkid
/dev/vda1: <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"7becd1b9-80e8-438c-9dd8-2985c6f5be36"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"xfs"</span> 
</pre>
</div>

<p>
步骤四：扩容分区
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">1. &#36828;&#31243;&#30331;&#24405;ECS&#23454;&#20363;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">2. &#23433;&#35013;gdisk&#24037;&#20855;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#24744;&#30340;&#20998;&#21306;&#20026;GPT&#26684;&#24335;&#65292;&#24517;&#39035;&#25191;&#34892;&#27492;&#27493;&#39588;&#65307;&#22914;&#26524;&#24744;&#30340;&#20998;&#21306;&#20026;MBR&#26684;&#24335;&#65292;&#35831;&#36339;&#36807;&#27492;&#27493;&#39588;</span>

yum install gdisk -y

<span style="color: #b22222;">#</span><span style="color: #b22222;">3. &#36816;&#34892;&#21629;&#20196;growpart /dev/vda 1&#25193;&#23481;&#20998;&#21306;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;growpart&#24037;&#20855;&#21644;resize2fs&#24037;&#20855;</span>
yum install -y cloud-utils-growpart  
yum install -y xfsprogs
[root@zentao01 ~]# growpart /dev/vda 1
CHANGED: <span style="color: #a0522d;">partition</span>=1 <span style="color: #a0522d;">start</span>=2048 old: <span style="color: #a0522d;">size</span>=209713152 <span style="color: #a0522d;">end</span>=209715200 new: <span style="color: #a0522d;">size</span>=629143519 <span style="color: #a0522d;">end</span>=629145567
</pre>
</div>

<p>
报错
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@jenkins ~]# growpart /dev/vda 1
NOCHANGE: partition 1 could only be grown by -33 [<span style="color: #a0522d;">fudge</span>=2048]
</pre>
</div>

<p>
解决：磁盘重新挂载或者重启虚拟机实例
</p>

<p>
步骤五：扩容文件系统
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">1. &#36828;&#31243;&#30331;&#24405;ECS&#23454;&#20363;&#12290;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2. &#26681;&#25454;&#26597;&#35810;&#30340;&#25991;&#20214;&#31995;&#32479;&#31867;&#22411;&#65292;&#25193;&#23481;&#25991;&#20214;&#31995;&#32479;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25193;&#23481;ext*&#65288;&#20363;&#22914;ext4&#65289;&#25991;&#20214;&#31995;&#32479;&#65306;&#36816;&#34892;&#21629;&#20196;resize2fs /dev/vda1&#25193;&#23481;&#25991;&#20214;&#31995;&#32479;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25193;&#23481;&#31995;&#32479;&#30424;/dev/vda1&#30340;&#25991;&#20214;&#31995;&#32479;</span>
resize2fs /dev/vda1

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25193;&#23481;&#25968;&#25454;&#30424;/dev/vdb1&#30340;&#25991;&#20214;&#31995;&#32479;</span>
e2fsck -f /dev/vdb1     //&#24378;&#21046;&#26816;&#26597;&#25991;&#20214;&#31995;&#32479;
resize2fs /dev/vdb1


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25193;&#23481;&#23481;xfs&#25991;&#20214;&#31995;&#32479;&#65306;&#36816;&#34892;&#21629;&#20196;xfs_growfs /media/vdc&#25193;&#23481;&#25991;&#20214;&#31995;&#32479;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35828;&#26126;&#160;/media/vdc&#20026;/dev/vdc1&#30340;&#25346;&#36733;&#28857;&#65292;&#24744;&#38656;&#35201;&#26681;&#25454;&#23454;&#38469;&#24773;&#20917;&#20462;&#25913;&#12290;</span>
xfs_growfs  /

<span style="color: #b22222;">#</span><span style="color: #b22222;">3. &#36816;&#34892;&#21629;&#20196;df -Th&#26816;&#26597;&#25193;&#23481;&#21518;&#32467;&#26524;</span>
[root@zentao01 ~]# df -Th
Filesystem     Type      Size  Used Avail Use% Mounted on
/dev/vda1      xfs       300G  1.7G  299G   1% /
devtmpfs       devtmpfs  2.0G     0  2.0G   0% /dev
</pre>
</div>

<p>
范例：linux ext4扩容，适合于云上实例、KVM
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#38236;&#20687;&#25991;&#20214;&#28155;&#21152;200G&#65292;&#19981;&#33021;&#26377;&#24555;&#29031;</span>
qemu-img resize haproxy-clone.qcow2 +200G
qemu-img info haproxy-clone.qcow2

yum install gdisk cloud-utils-growpart -y
fdisk -lu
growpart /dev/vdb 1
resize2fs  /dev/vdb1 <span style="color: #b22222;"># </span><span style="color: #b22222;">xfs&#25191;&#34892; xfs_growfs  /dev/vdb</span>
df -Th
</pre>
</div>
<p>
<b>2. 扩展分区和文件系统_Linux数据盘</b>
</p>

<p>
参考:<a href="https://help.aliyun.com/document_detail/25452.html?spm=a2c4g.11186623.2.26.69d35bb8fAu3sA#section-gg7-ilv-h3j">https://help.aliyun.com/document_detail/25452.html?spm=a2c4g.11186623.2.26.69d35bb8fAu3sA#section-gg7-ilv-h3j</a>
</p>
</div>
<div id="outline-container-h:66e2ec12-1190-4b0b-815c-244ba66cfb13" class="outline-4">
<h4 id="h:66e2ec12-1190-4b0b-815c-244ba66cfb13">AWS EC2 更换系统盘案例</h4>
<div class="outline-text-4" id="text-h:66e2ec12-1190-4b0b-815c-244ba66cfb13">
<p>
主题：rummy 读域名修改指向及 rummy 215 磁盘更换系统扩容
</p>

<p>
背景：
</p>

<p>
rummy 一台 mysql 从库 172.21.89.215 根磁盘急需扩容
215 实例只有一个 2T 系统盘，系统盘做了 MBR 分区，使用率 94%
MBR 引导盘容量上限 2 T ，无法应对后期数据增长。
</p>

<p>
需求：
</p>

<p>
rummy 读域名修改指向及 rummy 215 磁盘更换系统扩容
</p>

<p>
操作步骤：
</p>

<p>
1、rummy 读域名：db-reader.xxx.com
</p>

<p>
域名指向： 89.215  &#x2014;&gt; 89.84 对应的 NLB
</p>

<p>
旧：P1-a10b8a96e9eddfcd.elb.ap-south-1.amazonaws.com
</p>

<p>
新：Pa10b8a96e9eddfcd.elb.ap-south-1.amazonaws.com
</p>

<p>
2、172.21.89.215 数据目录扩容
</p>

<p>
准备系统盘：新 ec2
</p>
<ol class="org-ol">
<li>使用 AMI PFGC-DB-Common-Image 新建 ec2，系统盘200G XFS</li>
<li>关机，根卷分离，记录卷id vol-018401235208e553b</li>
<li>新 ec2 实例删除</li>
</ol>

<p>
更换系统盘：215 从库 ec2
</p>
<ol class="org-ol">
<li>关机, 根卷分离，记录卷id i-015fdd06360774689，实例id i-015fdd06360774689</li>
<li>附加卷，选择新卷 /dev/sda1</li>
<li>开机</li>
<li><p>
附加卷，选择旧根卷 /dev/xvdf
</p>

<p>
挂载使用：mount -t xfs -o nouuid /dev/xvdf1 /data1
</p>

<p>
ps: 2个卷的uuid一样，修改/etc/fstab 使用设备名区分挂载
</p></li>

<li>启动 mysql</li>
<li>后续：新增数据卷 NT，gpt分区挂载</li>
</ol>

<p>
准备数据盘：gp3 卷
</p>
<ol class="org-ol">
<li>创建 3T 卷，卷id vol-0c41d6db13107f3d0</li>
<li>附加卷到 215 机器上 /dev/sdg，此过程无需停机</li>
<li><p>
初始化卷并挂载卷，初始化为 xfs 文件系统并挂载到 /data1
</p>

<p>
sudo mkfs -t xfs /dev/nvme2n1
</p></li>

<li>添加 mysql 服务实例同步主库数据</li>
</ol>

<p>
操作：SRE, DBA
</p>

<p>
遇到的问题：
</p>

<ol class="org-ol">
<li>如果时区不对，修改时区为印度区</li>
</ol>
<div class="org-src-container">
<pre class="src src-sh">ln -sf /usr/share/zoneinfo/Asia/Calcutta /etc/localtime
date -R
</pre>
</div>

<ol class="org-ol">
<li>挂载卷不显示</li>
</ol>

<p>
需要把这台服务器的 / 目录挂在到其他服务器上，再写密钥
</p>

<p>
在其他服务器上挂载，有时候 mount 挂载不上，需要加参数 -o nouuid
</p>

<div class="org-src-container">
<pre class="src src-sh">mount -t xfs -o nouuid /dev/xvdf1 /data1
</pre>
</div>

<ol class="org-ol">
<li>关机会收到报警</li>
</ol>
<div class="org-src-container">
<pre class="src src-sh">Time: 2022-01-13 06:40:46
Alert:  Rummy mysql_slave  172.21.89.215:9104 is down
Value: 0.00s

Time: 2022-01-13 06:44:16
Alert: Rummy_nodes Rummy DB   172.21.89.215:9100  down for more than 2 minutes.
Value: 0.00
</pre>
</div>

<p>
参考文档：
</p>

<p>
<a href="https://aws.amazon.com/cn/premiumsupport/knowledge-center/ec2-ubuntu-convert-mbr-to-gpt/">https://aws.amazon.com/cn/premiumsupport/knowledge-center/ec2-ubuntu-convert-mbr-to-gpt/</a>
</p>
</div>
</div>
</div>
<div id="outline-container-h:b28d3214-bf27-4638-9368-4fc4c7d0c5b4" class="outline-3">
<h3 id="h:b28d3214-bf27-4638-9368-4fc4c7d0c5b4">快照</h3>
<div class="outline-text-3" id="text-h:b28d3214-bf27-4638-9368-4fc4c7d0c5b4">
<p>
优化成本：购买预付费存储包。
</p>


<figure id="org306bba1">
<img src="./images/image-20210421142831950.png" alt="image-20210421142831950.png">

</figure>

<p>
快照数据独立存储，存储费用可使用OSS标准（LRS）存储包抵扣。当您购买了OSS标准（LRS）存储包后，在有效期内，存储包会自动按容量抵扣快照费用。
</p>
</div>
</div>
<div id="outline-container-h:75b6da24-e73e-4cfc-a8ab-1f8590ef7774" class="outline-3">
<h3 id="h:75b6da24-e73e-4cfc-a8ab-1f8590ef7774">系统救援</h3>
<div class="outline-text-3" id="text-h:75b6da24-e73e-4cfc-a8ab-1f8590ef7774">
<p>
aws ec2
</p>

<p>
I executed yum -y update, disconnected in the middle, restarting the machine can't start
</p>

<p>
您可以从最近的备份中恢复，或者您需要进行故障排除和修复。 从备份恢复更快更容易，但其他选项也可以工作
</p>

<p>
您为此实例拥有的帐户和唯一备份是从 2021 年 9 月 29 日开始的。我认为那太远了
</p>

<p>
救援模式
</p>
<ol class="org-ol">
<li>首先，请在 ap-south-1b 可用区启动一个救援实例，使用 Amazon Linux 2 的 t2.micro 类型。注意网络、安全组保持一致。</li>
<li>停止损坏的实例并分离根卷。然后挂载会救援实例上。</li>
<li>在救援实例执行如下操作</li>
</ol>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#30830;&#35748;&#22351;&#21367;&#24050;&#38468;&#21152;&#21040;&#25937;&#25588;&#23454;&#20363;</span>
10:50:20 AM jasper.xu: [root@ip-172-21-38-206 data]# lsblk
NAME    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
xvda    202:0    0    8G  0 disk
&#9492;&#9472;xvda1 202:1    0    8G  0 part /
xvdf    202:80   0  100G  0 disk
&#9492;&#9472;xvdf1 202:81   0  100G  0 part /data

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25346;&#36733;</span>
mkdir /mnt/old
mount -t xfs -o nouuid /dev/xvdf1 /mnt/old
cat /mnt/old/etc/fstab
11:32:16 AM jasper.xu: <span style="color: #a0522d;">UUID</span>=eaadd3f0-e151-4950-a4ba-49ae6f413224 /                       xfs     defaults        0 0

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312;&#25937;&#25588;&#23454;&#20363;&#26681;&#30446;&#24405;&#20013;</span>
<span style="color: #483d8b;">cd</span> /
<span style="color: #a020f0;">for</span> i<span style="color: #a020f0;"> in</span> dev proc sys run; <span style="color: #a020f0;">do</span> mount -o bind /$<span style="color: #a0522d;">i</span> /mnt/old/$<span style="color: #a0522d;">i</span>; <span style="color: #a020f0;">done</span>
chroot /mnt/old   <span style="color: #b22222;">#</span><span style="color: #b22222;">uname -r &#23558;&#21453;&#26144;&#25937;&#25588;&#23454;&#20363;&#20013;&#30340;&#20869;&#26680;</span>
grub2-mkconfig -o /boot/grub2/grub.cfg
sed -i <span style="color: #8b2252;">'s/GRUB_DEFAULT=0/GRUB_DEFAULT=saved/g'</span> /etc/default/grub
[root@ip-172-21-38-206 /]# sudo grub2-mkconfig -o /boot/grub2/grub.cfg
Generating grub configuration file ...
Found linux image: /boot/vmlinuz-3.10.0-1160.53.1.el7.x86_64
Found linux image: /boot/vmlinuz-3.10.0-862.14.4.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-862.14.4.el7.x86_64.img
Found linux image: /boot/vmlinuz-3.10.0-862.2.3.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-862.2.3.el7.x86_64.img
Found linux image: /boot/vmlinuz-0-rescue-5b3e73494c0f9aac8764a045f4a3a8f5
Found initrd image: /boot/initramfs-0-rescue-5b3e73494c0f9aac8764a045f4a3a8f5.img

grub2-set-default 1

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21368;&#36733;&#21367;</span>
<span style="color: #a020f0;">for</span> i<span style="color: #a020f0;"> in</span> dev proc sys run; <span style="color: #a020f0;">do</span> sudo umount /mnt/old/$<span style="color: #a0522d;">i</span>; <span style="color: #a020f0;">done</span>
</pre>
</div>

<ol class="org-ol">
<li>请立即从救援实例中分离此卷，附加到您的旧实例并启动实例</li>
</ol>

<p>
start succesful  kernel 3.10.0-862.14.4.el7.x86_64
</p>

<ol class="org-ol">
<li>升级内核</li>
</ol>

<div class="org-src-container">
<pre class="src src-sh">sudo rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org 
rpm -Uvh https://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm 
yum list available --disablerepo=<span style="color: #8b2252;">'*'</span> --enablerepo=elrepo-kernel
elrepo-release.noarch                                                                                 7.0-5.el7.elrepo                                                                         elrepo-kernel
kernel-lt.x86_64                                                                                      5.4.181-1.el7.elrepo                                                                     elrepo-kernel

sudo yum --enablerepo=elrepo-kernel install kernel-lt
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#39318;&#20808;&#26597;&#30475;&#24403;&#21069;&#31995;&#32479;&#26377;&#20960;&#20010;&#20869;&#26680;&#12290;&#27604;&#22914;&#65306;</span>
cat /boot/grub2/grub.cfg |grep menuentry 
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#40664;&#35748;&#30340;&#21551;&#21160;&#20869;&#26680;</span>
grub2-set-default <span style="color: #8b2252;">"CentOS Linux (5.4.181-1.el7.elrepo.x86_64) 7 (Core)"</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#39564;&#35777;&#26159;&#21542;&#20462;&#25913;&#25104;&#21151;</span>
grub2-editenv list
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#37325;&#21551;&#26426;&#22120;&#35266;&#23519;</span>
reboot
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:ec0cf84d-6a64-449c-bf2b-4c8d575825c2" class="outline-2">
<h2 id="h:ec0cf84d-6a64-449c-bf2b-4c8d575825c2">SLB</h2>
<div class="outline-text-2" id="text-h:ec0cf84d-6a64-449c-bf2b-4c8d575825c2">
<p>
<b>实例类型对应监控指标</b>
</p>

<p>
SLB： 最大连接数（秒）    每秒新建连接数（CPS）    每秒查询数（QPS）
</p>

<p>
监控：每秒最大并发连接数  每秒新建连接数
</p>

<p>
七层才有QPS的概念，指的是每秒可以完成的HTTP/HTTPS的查询（请求）的数量。当请求速率超过规格所定义的每秒查询数时，新建连接请求将被丢弃。对应监控见截图：
</p>


<p>
1.最大并发连接数对应SLB实例规则中最大连接数,活跃连接数指established状态的连接，非活跃连接指除了established状态的连接。
</p>

<p>
2.七层才有QPS的概念，指的是每秒可以完成的HTTP/HTTPS的查询（请求）的数量。当请求速率超过规格所定义的每秒查询数时，新建连接请求将被丢弃。对应监控见截图
</p>

<p>
3.对于4层监听端口，上限指标只有最大连接数 每秒新建连接数（CPS)
</p>

<p>
咱们slb是4层的4w多是第秒最大连接数既最大并发数，Qps是每秒查询数属于7层协议
</p>
</div>
</section>
<section id="outline-container-h:68550704-8745-4a17-abb1-372e222c5e24" class="outline-2">
<h2 id="h:68550704-8745-4a17-abb1-372e222c5e24">网络互通</h2>
<div class="outline-text-2" id="text-h:68550704-8745-4a17-abb1-372e222c5e24">
</div>
<div id="outline-container-h:72f842d6-c271-4b4c-8287-1b018177cce9" class="outline-3">
<h3 id="h:72f842d6-c271-4b4c-8287-1b018177cce9">公司与阿里新加坡互通 vpn-ipsec</h3>
<div class="outline-text-3" id="text-h:72f842d6-c271-4b4c-8287-1b018177cce9">
<p>
参考教程：<a href="https://help.aliyun.com/document_detail/65279.html?spm=a2c4g.11186623.6.552.3c94466aIf33LR">https://help.aliyun.com/document_detail/65279.html?spm=a2c4g.11186623.6.552.3c94466aIf33LR</a>
</p>


<figure id="org16400cf">
<img src="./images/image-20210315171448865.png" alt="image-20210315171448865.png">

</figure>

<ul class="org-ul">
<li>创建VPN网关：新加的VPC公网VPN</li>
<li>创建用户网关：公司本地网关的信息</li>
<li>创建IPsec连接：VPN网关和用户网关建立连接后的VPN通道。</li>
</ul>

<pre class="example" id="org8d07301">
{
  "LocalSubnet": "10.0.0.0/14",
  "RemoteSubnet": "10.18.0.0/16",
  "IpsecConfig": {
    "IpsecPfs": "group1",
    "IpsecEncAlg": "des",
    "IpsecAuthAlg": "sha1",
    "IpsecLifetime": 86400
  },
  "Local": "211.103.135.97",
  "Remote": "161.117.252.191",
  "IkeConfig": {
    "IkeAuthAlg": "sha1",
    "LocalId": "211.103.135.97",
    "IkeEncAlg": "des",
    "IkeVersion": "ikev1",
    "IkeMode": "main",
    "IkeLifetime": 86400,
    "RemoteId": "161.117.252.191",
    "Psk": "123456",
    "IkePfs": "group1"
  }
}
</pre>

<ul class="org-ul">
<li>配置本地网关：本地VPN网关设备中加载阿里云VPN网关的配置。公司由IT中心人员在路由H3C上设置</li>
<li>配置VPN网关路由：在VPN网关中配置策略路由表，并发布到VPC路由表中。源阿里新加坡VPC10.18.0.0/16，目标网段公司10.0.0.0/14</li>
</ul>


<figure id="orgcfe5113">
<img src="./images/vpn.png" alt="vpn.png">

</figure>

<ul class="org-ul">
<li>测试访问</li>
</ul>

<p>
登录到阿里云VPC内一台无公网IP的ECS实例，通过ping本地IDC内一台服务器的私网IP地址，验证通信是否正常。
</p>
</div>
</div>
<div id="outline-container-h:e656902e-b1d3-4b4d-9bd4-d47d0cded1db" class="outline-3">
<h3 id="h:e656902e-b1d3-4b4d-9bd4-d47d0cded1db">阿里新加坡机房VPC与阿里华北2机房VPC网络互通-高速通道</h3>
<div class="outline-text-3" id="text-h:e656902e-b1d3-4b4d-9bd4-d47d0cded1db">
<ol class="org-ol">
<li>开通云企业云</li>
<li>将2个机房机的vpc加入到云企业网</li>
<li>购买跨境带宽包。注意这个需要向阿里提交企业审查。</li>
<li>跨地域互通带宽管理。选择华北与新加坡互通带宽。</li>
<li>配置互通网段</li>
</ol>

<p>
需要在新加坡侧入地域网关，先做允许北京vpc实例，只允许精确匹配10.16.205.0/24；然后再做拒绝北京vpc实例，模糊匹配vpc的大网段10.16.0.0/16。如果不同vpc应该你源实例ID表再加需要模糊拒绝的vpc实例。
</p>


<figure id="org4878ce0">
<img src="./images/vpn1.png" alt="vpn1.png">

</figure>
</div>
</div>
<div id="outline-container-h:f10042f9-5249-47ba-a1db-d33e6bb1c18a" class="outline-3">
<h3 id="h:f10042f9-5249-47ba-a1db-d33e6bb1c18a">阿里新加坡机房VPC与阿里华北2机房VPC网络互通-vpn-ipsec临时方案</h3>
<div class="outline-text-3" id="text-h:f10042f9-5249-47ba-a1db-d33e6bb1c18a">
<p>
分别在新加坡与华北2机房创建vpn-ipsec，注意这里的用户网关是对端的网关地址，即新加坡用户网关配置为华北2 SNAT出口ip，华北2用户网关配置为 新加坡 SNAT出口ip，
</p>
</div>
</div>
<div id="outline-container-h:862229a2-be97-49d4-8218-12070382d8cd" class="outline-3">
<h3 id="h:862229a2-be97-49d4-8218-12070382d8cd">阿里云vpc与亚马逊vpc互通-vpn</h3>
<div class="outline-text-3" id="text-h:862229a2-be97-49d4-8218-12070382d8cd">
<p>
<b>阿里云</b>
</p>

<ul class="org-ul">
<li><p>
创建VPN网关：新加坡VPC公网VPN
</p>

<p>
47.94.150.81
</p></li>
</ul>

<p>
<b>亚马逊</b>
</p>

<ul class="org-ul">
<li>创建客户网关：ip为阿里云vpn网关ip</li>
</ul>


<figure id="org1d440b8">
<img src="./images/image-20210315171622515.png" alt="image-20210315171622515.png">

</figure>

<p>
47.94.150.81
</p>

<ul class="org-ul">
<li>创建私有网关：创建好后与vpc绑定</li>
<li>创建站点到站点VPN连接：</li>
</ul>

<p>
VPN连接中的配置
</p>

<p>
1.路由选项中使用静态IP前缀，这里填写要互通的阿里VPC网段
</p>


<figure id="org7cd1794">
<img src="./images/image-20210315171641729.png" alt="image-20210315171641729.png">

</figure>

<p>
其它默认即可
</p>

<p>
2.创建好后可在Tunnel State看到外面ip地址，选项其中一个做为阿里云的用户网关
</p>


<figure id="org9e19c7c">
<img src="./images/image-20210315171654657.png" alt="image-20210315171654657.png">

</figure>

<p>
这里13.250.188.18
</p>

<p>
3.在VPN连接页面上点击“下载配置”，获取双方一致的通信认证配置
</p>


<figure id="org563fcb5">
<img src="./images/image-20210315171728033.png" alt="image-20210315171728033.png">

</figure>

<pre class="example" id="org5487bd8">
ike proposal 200
  encryption-algorithm aes-cbc
  authentication-method pre-share
  dh group2
  sa duration 28800
  authentication-algorithm sha
quit

...
ike peer peervpn1
  remote-address 13.250.188.18
  pre-shared-key jAlnufeIfGG6nK5FWODmLfdAy2Omqdtr
  exchange-mode main
  proposal 200
  dpd dpdvpn1
quit

...
psec transform-set ipsec-prop-vpn1 
  encapsulation-mode tunnel
  esp encryption-algorithm aes-cbc-128
  esp authentication-algorithm sha1
quit
....
ipsec profile ipsecvpn1
  ike-peer peervpn1		
  pfs dh-group2
  sa duration time-based 3600
  transform-set ipsec-prop-vpn1
quit
</pre>

<p>
<b>阿里云</b>
</p>

<ul class="org-ul">
<li>创建用户网关：亚马逊网关的信息</li>
</ul>

<p>
13.250.188.18
</p>

<ul class="org-ul">
<li>创建IPsec连接：VPN网关和用户网关建立连接后的VPN通道。</li>
</ul>

<pre class="example" id="org5c4b1ac">
{
  "LocalSubnet": "0.0.0.0/0",
  "RemoteSubnet": "0.0.0.0/0",
  "IpsecConfig": {
    "IpsecPfs": "group2",
    "IpsecEncAlg": "aes",
    "IpsecAuthAlg": "sha1",
    "IpsecLifetime": 3600
  },
  "Local": "13.250.188.18",
  "Remote": "47.94.150.81",
  "IkeConfig": {
    "IkeAuthAlg": "sha1",
    "LocalId": "13.250.188.18",
    "IkeEncAlg": "aes",
    "IkeVersion": "ikev1",
    "IkeMode": "main",
    "IkeLifetime": 28800,
    "RemoteId": "47.94.150.81",
    "Psk": "jAlnufeIfGG6nK5FWODmLfdAy2Omqdtr",
    "IkePfs": "group2"
  }
}
</pre>

<ul class="org-ul">
<li>配置VPN网关路由：在VPN网关中配置目标路由，并发布到VPC路由表中。</li>
</ul>


<figure id="org68fdcd3">
<img src="./images/image-20210315171747160.png" alt="image-20210315171747160.png">

</figure>

<p>
目标路由：亚马逊网段
</p>
</div>
</div>
</section>
<section id="outline-container-h:91dbdadb-e61e-4de4-bf90-202c2b815ab6" class="outline-2">
<h2 id="h:91dbdadb-e61e-4de4-bf90-202c2b815ab6">OSS</h2>
<div class="outline-text-2" id="text-h:91dbdadb-e61e-4de4-bf90-202c2b815ab6">
<p>
<b>如何选用NAS、OSS和EBS</b>
</p>

<p>
本文介绍阿里云文件存储NAS与阿里云对象存储OSS、阿里云块存储EBS的区别，帮助您更好地选用阿里云文件存储NAS。
</p>

<p>
文件存储NAS提供简单、可伸缩弹性的共享文件存储，配合云服务器ECS弹性计算服务构建业务系统。 当您选择使用文件存储NAS、对象存储OSS或块存储EBS部署应用程序时，需要考虑诸多因素。本文介绍文件存储NAS与对象存储OSS、块存储EBS的区别，帮助您更好地进行选择。
</p>


<figure id="orgbabbbcc">
<img src="./images/image-20210315141920570.png" alt="image-20210315141920570.png">

</figure>

<p>
文件存储NAS和对象存储OSS有什么不同？
</p>

<p>
文件存储NAS和对象存储OSS的主要区别：您无需修改应用，即可直接像访问本地文件系统一样访问文件存储NAS。文件存储NAS提供高吞吐和高IOPS的同时支持文件的随机读写和在线修改。
</p>

<p>
对象存储OSS是比较新的存储类型，相对于文件存储目录树的组织形式，对象存储OSS采用扁平的文件组织形式，采用RESTFul API接口访问，不支持文件随机读写，主要适用于互联网架构的海量数据的上传下载和分发。
</p>

<p>
文件存储NAS和块存储EBS有什么不同？
</p>

<p>
文件存储NAS相对于块存储EBS的主要区别：文件存储NAS可以同时支持上千个ECS客户端同时共享访问，提供高吞吐量。
</p>

<p>
块存储EBS是裸磁盘，挂载到ECS后不能被操作系统应用直接访问，需要格式化成文件系统（ext3、ext4、NTFS等）后才能被访问。块存储EBS的优势是性能高、时延低，适合于OLTP数据库、NoSQL数据库等IO密集型的高性能、低时延应用工作负载。但是块存储EBS无法容量弹性扩展，单盘最大只能32TB，并且对共享访问的支持有限，需要配合类Oracle RAC、WSFC Windows故障转移集群等集群管理软件才能进行共享访问。因此，块存储EBS主要还是针对单ECS的高性能，低时延的存储产品。
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">存储产品</td>
<td class="org-left">时延</td>
<td class="org-left">吞吐</td>
<td class="org-left">访问模式</td>
</tr>

<tr>
<td class="org-left">文件存储NAS</td>
<td class="org-left">低时延（毫秒级）</td>
<td class="org-left">数百Gbps</td>
<td class="org-left">上千个ECS通过POSIX接口并发访问，随机读写</td>
</tr>

<tr>
<td class="org-left">对象存储OSS</td>
<td class="org-left">较低时延（几十毫秒级）</td>
<td class="org-left">数百Gbps</td>
<td class="org-left">数百万客户端通过WEB并发，追加写</td>
</tr>

<tr>
<td class="org-left">块存储EBS</td>
<td class="org-left">极低时延（微秒级）</td>
<td class="org-left">数十Gbps</td>
<td class="org-left">单ECS通过POSIX接口访问，随机读写</td>
</tr>
</tbody>
</table>
</div>
<div id="outline-container-h:b203d2f6-379d-4294-b589-1b8e492e974e" class="outline-3">
<h3 id="h:b203d2f6-379d-4294-b589-1b8e492e974e">解冻转换文件类型</h3>
<div class="outline-text-3" id="text-h:b203d2f6-379d-4294-b589-1b8e492e974e">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#  </span><span style="color: #b22222;">cat oss_changefile.sh </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/env bash</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">1&#12289;&#35299;&#20923;&#36164;&#28304; </span>
./ossutil64 restore oss://cici-result-video/ -r  -f
sleep 300
<span style="color: #b22222;">#</span><span style="color: #b22222;">2&#12289;&#26356;&#26032;set-meta&#20540;&#65292;&#36825;&#20010;&#26159;&#26356;&#26032;&#26080;&#35770;&#26159;&#24402;&#26723;&#36824;&#26159;&#20302;&#39057;&#65292;&#37117;&#36716;&#25442;&#25104;&#26631;&#20934;</span>
./ossutil64 set-meta oss://cici-result-video/ -r X-Oss-Storage-Class:Standard --update  -j 5000 --retry-times 3 --loglevel=debug 
</pre>
</div>
</div>
</div>
<div id="outline-container-h:eb28fad8-869e-455b-84c6-14c410b47bb3" class="outline-3">
<h3 id="h:eb28fad8-869e-455b-84c6-14c410b47bb3">ossfs文件挂载</h3>
<div class="outline-text-3" id="text-h:eb28fad8-869e-455b-84c6-14c410b47bb3">
<p>
参考：
<a href="https://help.aliyun.com/document_detail/32196.html?spm=5176.product31815.6.1041.uGNIMY">https://help.aliyun.com/document_detail/32196.html?spm=5176.product31815.6.1041.uGNIMY</a>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#19979;&#36733;&#23433;&#35013;&#21253;</span>
wget http://gosspublic.alicdn.com/ossfs/ossfs_1.80.6_centos7.0_x86_64.rpm
yum localinstall ossfs_1.80.6_centos7.0_x86_64.rpm  -y

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37197;&#32622;&#36134;&#21495;&#35775;&#38382;&#20449;&#24687;</span>
cat &lt;&lt;\EOF&gt; /etc/passwd-ossfs 
<span style="color: #ffa54f;">cici-log-backup:LTxx5G:iJsmWZxxSvgz</span>
<span style="color: #ffa54f;">EOF</span>
chmod 640 /etc/passwd-ossfs


<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;Bucket&#25346;&#36733;&#21040;&#25351;&#23450;&#30446;&#24405;</span>
mkdir /OSS
/usr/local/bin/ossfs cici-log-backup /OSS -ourl=oss-cn-beijing-internal.aliyuncs.com -o allow_other -oumask=002

df -h

<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">'/usr/local/bin/ossfs cici-log-backup /OSS -ourl=oss-cn-beijing-internal.aliyuncs.com -o allow_other -oumask=002'</span>  &gt;&gt; /etc/rc.local

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25346;&#36733;&#27492; bucket:</span>
fusermount -u /tmp/ossfs
</pre>
</div>
</div>
</div>
<div id="outline-container-h:12490673-62e7-4b75-b8f9-58bd31945f2e" class="outline-3">
<h3 id="h:12490673-62e7-4b75-b8f9-58bd31945f2e">OSS 访问授权</h3>
<div class="outline-text-3" id="text-h:12490673-62e7-4b75-b8f9-58bd31945f2e">
<p>
只对名为 hdzy 的oss存储中zone/answer/ 和 book_photo_path/ 目录有上传读权限，没有删除权限
</p>

<p>
注意前后顺序
</p>
<div class="org-src-container">
<pre class="src src-sh">{
  <span style="color: #8b2252;">"Version"</span>: <span style="color: #8b2252;">"1"</span>,
  <span style="color: #8b2252;">"Statement"</span>: [
    {
      <span style="color: #8b2252;">"Effect"</span>: <span style="color: #8b2252;">"Allow"</span>,
      <span style="color: #8b2252;">"Action"</span>: [
        <span style="color: #8b2252;">"oss:ListBuckets"</span>,
        <span style="color: #8b2252;">"oss:GetBucketAcl"</span>
      ],
      <span style="color: #8b2252;">"Resource"</span>: [
        <span style="color: #8b2252;">"acs:oss:*:*:*"</span>
      ]
    },
    {
      <span style="color: #8b2252;">"Effect"</span>: <span style="color: #8b2252;">"Allow"</span>,
      <span style="color: #8b2252;">"Action"</span>: [
        <span style="color: #8b2252;">"oss:Get*"</span>,
    <span style="color: #8b2252;">"oss:Put*"</span>,
      ],
      <span style="color: #8b2252;">"Resource"</span>: [
        <span style="color: #8b2252;">"acs:oss:*:*:hdzy/zone/answer/*"</span>
      ]
    },
    {
      <span style="color: #8b2252;">"Effect"</span>: <span style="color: #8b2252;">"Allow"</span>,
      <span style="color: #8b2252;">"Action"</span>: [
        <span style="color: #8b2252;">"oss:ListObjects"</span>
      ],
      <span style="color: #8b2252;">"Resource"</span>: [
        <span style="color: #8b2252;">"acs:oss:*:*:hdzy"</span>
      ],
      <span style="color: #8b2252;">"Condition"</span>: {
        <span style="color: #8b2252;">"oss:Delimiter"</span>:<span style="color: #8b2252;">"/"</span>,
        <span style="color: #8b2252;">"StringLike"</span>: {
          <span style="color: #8b2252;">"oss:Prefix"</span>: [
            <span style="color: #8b2252;">""</span>,
            <span style="color: #8b2252;">"zone/"</span>,
            <span style="color: #8b2252;">"zone/answer/*"</span>
          ]
        }
      }
    }
  ]
}
</pre>
</div>


<p>
OSS 访问控制
</p>

<p>
1.授权 RAM 用户完全管理某个 Bucket: myphotos 的权限。
</p>

<div class="org-src-container">
<pre class="src src-sh">{
    <span style="color: #8b2252;">"Version"</span>: <span style="color: #8b2252;">"1"</span>,
    <span style="color: #8b2252;">"Statement"</span>: [
        {
            <span style="color: #8b2252;">"Effect"</span>: <span style="color: #8b2252;">"Allow"</span>,
            <span style="color: #8b2252;">"Action"</span>: <span style="color: #8b2252;">"oss:*"</span>,
            <span style="color: #8b2252;">"Resource"</span>: [
                <span style="color: #8b2252;">"acs:oss:*:*:myphotos"</span>,
                <span style="color: #8b2252;">"acs:oss:*:*:myphotos/*"</span>
            ]
        }
    ]
}


2&#65306;&#25480;&#26435; RAM &#29992;&#25143;&#21015;&#20986;&#24182;&#35835;&#21462;&#19968;&#20010; Bucket &#20013;&#30340;&#36164;&#28304;&#12290;
{
    <span style="color: #8b2252;">"Version"</span>: <span style="color: #8b2252;">"1"</span>,
    <span style="color: #8b2252;">"Statement"</span>: [
        {
            <span style="color: #8b2252;">"Effect"</span>: <span style="color: #8b2252;">"Allow"</span>,
            <span style="color: #8b2252;">"Action"</span>: [<span style="color: #8b2252;">"oss:ListObjects"</span>,<span style="color: #8b2252;">"oss:GetObject"</span>],
            <span style="color: #8b2252;">"Resource"</span>: [
                <span style="color: #8b2252;">"acs:oss:*:*:myphotos"</span>,
                <span style="color: #8b2252;">"acs:oss:*:*:myphotos/*"</span>
                ]
        }
    ]
}
</pre>
</div>

<p>
某公司
</p>

<pre class="example" id="org0287d48">
{
    "Version": "1",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "oss:ListParts",
                "oss:AbortMultipartUpload",
                "oss:PutObject",
                "oss:GetObject",
                "oss:listObjects",
                "oss:GetBucketReferer",
                "oss:SetBucketReferer",
                "oss:DeleteBucket",
                "oss:CreateBucket",
                "oss:GetBucketAcl"
            ],
            "Resource": [
                "acs:oss:*:*:xjp-cici-app",
                "acs:oss:*:*:xjp-cici-app/*"
            ]
        }
    ]
}
</pre>


<p>
1.只访问和编写bucket ： mfs-source 中的单个目录
</p>

<p>
在RAM中配置权限策略
</p>

<pre class="example" id="org9593dfd">
{
  "Version": "1",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListBuckets"
      ],
      "Resource": [
        "acs:oss:*:*:*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListObjects"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source"
      ],
      "Condition": {
        "StringLike": {
          "oss:Delimiter": "/",
          "oss:Prefix": [
            "",
            "BackendEditor/*"
          ]
        }
      }
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListObjects"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source"
      ],
      "Condition": {
        "StringLike": {
          "oss:Prefix": [
            "BackendEditor/*"
          ]
        }
      }
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:*"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source/BackendEditor/*"
      ]
    }
  ]
}
</pre>

<p>
2.bukect上传查看权限 
</p>

<pre class="example" id="orge7aec57">
{
  "Version": "1",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListBuckets",
        "oss:GetBucketAcl"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source",
        "acs:oss:*:*:mfs-source/*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:Get*",
        "oss:Put*"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source",
        "acs:oss:*:*:mfs-source/*"
      ]
    }
  ]
}
</pre>


<p>
3.数据库审计权限
</p>

<pre class="example" id="org31f4e08">
{
  "Statement": [
    {
      "Action": "rds:DescribeSQLLogRecords",
      "Effect": "Allow",
      "Resource": "acs:rds:*:*:dbinstance/rdsjmlwvi81yzyaypa1gb"
    },
    {
      "Action": "rds:DescribeSQLLogRecords",
      "Effect": "Allow",
      "Resource": "*"
    }
  ],
  "Version": "1"
}
</pre>


<p>
4.数据库权限
</p>

<pre class="example" id="org578eecf">
{
  "Version": "1",
  "Statement": [
    {
      "Action": "rds:*",
      "Resource": "acs:rds:*:*:*",
      "Effect": "Allow"
    },
    {
      "Action": "dms:LoginDatabase",
      "Resource": "acs:rds:*:*:dbinstance/rm-bp1o4v71t63p433f2",
      "Effect": "Allow"
    }
  ]
}
</pre>
</div>
</div>
<div id="outline-container-h:4e546697-19c8-4fde-8909-386b7f72593e" class="outline-3">
<h3 id="h:4e546697-19c8-4fde-8909-386b7f72593e">nodejs +OSS STS</h3>
<div class="outline-text-3" id="text-h:4e546697-19c8-4fde-8909-386b7f72593e">
<p>
nodejs安装
</p>

<pre class="example" id="orgddd49e9">
wget https://nodejs.org/dist/v6.10.0/node-v6.10.0-linux-x64.tar.xz
tar xvf node-v6.10.0-linux-x64.tar.xz
ln -sv node-v6.10.0-linux-x64 node

cat &gt;/etc/profile.d/node.sh&lt;&lt;\EOF
export NODE_HOME=/usr/local/node
export PATH=$PATH:$NODE_HOME/bin
export NODE_PATH=$NODE_HOME/lib/node_modules
EOF
source /etc/profile
node  -v

#设置 淘宝镜像源
npm config set registry https://registry.npm.taobao.org

#查看 使用的 镜像源
npm config get registry

#安装 淘宝镜像源
npm install -g cnpm --registry=https://registry.npm.taobao.org
</pre>

<p>
A simple app server using STS
</p>

<p>
App Server一般作为一个企业的应用服务器，它管理着OSS的 AccessKeyId/AccessKeySecret，服务于众多的客户端。当客户端（移动端 /Web/Client等）需要访问OSS时，它们向App Server请求一个临时的token，并 利用这个token从OSS下载或者向OSS上传文件。
</p>

<p>
App Server可以实现更复杂的策略，为不同的客户端提供不同权限的token，隔 离不同的客户端的存储路径等。
</p>

<p>
使用参考：<a href="https://help.aliyun.com/document_detail/oss/practice/ram_guide_dir/no_user_accout.html">https://help.aliyun.com/document_detail/oss/practice/ram_guide_dir/no_user_accout.html</a>
</p>

<p>
Run
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">Checkout code</span>
git clone https://github.com/rockuw/node-sts-app-server.git
<span style="color: #483d8b;">cd</span> node-sts-app-server

<span style="color: #b22222;">#</span><span style="color: #b22222;">Install dependencies</span>
npm install

<span style="color: #b22222;">#</span><span style="color: #b22222;">Start server</span>
node index.js

<span style="color: #b22222;">#</span><span style="color: #b22222;">Open in your browser</span>
http://localhost:3000/


vim config.json
{
  <span style="color: #8b2252;">"AccessKeyId"</span> : <span style="color: #8b2252;">"Lxxx"</span>,
  <span style="color: #8b2252;">"AccessKeySecret"</span> : <span style="color: #8b2252;">"IJ8N4S"</span>,
  <span style="color: #8b2252;">"RoleArn"</span> : <span style="color: #8b2252;">"acs:ram::1253088:role/aliyunosstokengeneratorrole"</span>,
  <span style="color: #8b2252;">"TokenExpireTime"</span> : <span style="color: #8b2252;">"900"</span>,
  <span style="color: #8b2252;">"PolicyFile"</span>: <span style="color: #8b2252;">"policy/all_policy.txt"</span>
}
</pre>
</div>


<p>
云服务器 ECS Nodejs 通 过forever 设置后台运行及 Nodejs 链接 MySQL RDS
</p>

<p>
Nodejs 应用通过 forever 设置后台运行
</p>

<p>
默认可以通过 node app.js 启动 nodejs 应用，如果退出 ssh 连接，应用也会退出。
</p>

<p>
可以使用 Forever 来管理启动 nodejs 应用，Forever 可以看做是一个 nodejs 的守护进程，能够启动，停止，重启我们的 app 应用
</p>

<p>
如同官方的描述
</p>

<p>
A simple CLI tool for ensuring that a given script runs continuously (i.e. forever).// 一个用来持续（或者说永远）运行一个给定脚本的简单的命令行工具
</p>

<div class="org-src-container">
<pre class="src src-sh">&#23433;&#35013;
sudo npm install forever -g <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35760;&#24471;&#21152;-g&#65292;forever&#35201;&#27714;&#23433;&#35013;&#21040;&#20840;&#23616;&#29615;&#22659;&#19979;</span>

&#21551;&#21160;
forever start app.js
forever start -o out.log -e err.log app.js     <span style="color: #b22222;">#</span><span style="color: #b22222;">-o &#26159; console &#36755;&#20986;&#30340;&#26085;&#24535;&#65292;-e &#26159; console.error &#26085;&#24535;</span>
forever list <span style="color: #b22222;">##</span><span style="color: #b22222;">&#26174;&#31034;&#25152;&#26377;&#36816;&#34892;&#30340;&#26381;&#21153;</span>
</pre>
</div>

<p>
开机自启动可以添加到 /etc/rc.local 里
</p>

<p>
常见的参数配置
</p>
<pre class="example" id="org7bc0c9f">
-m MAX: 运行指定脚本的次数
-l LOGFILE: 输出日志到LOGFILE
-o OUTFILE: 输出控制台信息到OUTFILE
-e ERRFILE: 输出控制台错误在ERRFILE
-p PATH: 根目录
-c COMMAND: 执行命令，默认是node
-a, –append: 合并日志
-f, –fifo: 流式日志输出
-n, –number: 日志打印行数
–pidFile: pid文件
–sourceDir: 源代码目录
–minUptime: 最小spinn更新时间(ms)
–spinSleepTime: 两次spin间隔时间
–colors: 控制台输出着色
–plain: –no-colors的别名，控制台输出无色
-d, –debug: debug模式
-v, –verbose: 打印详细输出
-s, –silent: 不打印日志和错误信息
-w, –watch: 监控文件改变
–watchDirectory: 监控顶级目录
–watchIgnore: 通过模式匹配忽略监控
--workingDir     The working directory in which SCRIPT will execute
-h, –help: 命令行帮助信息
</pre>

<p>
3种守护进程使用场合不完全一样。
</p>

<p>
supervisor 是开发环境用。
</p>

<p>
forever 管理多个站点，每个站访问量不大，不需要监控。
</p>

<p>
pm2 网站访问量比较大，需要完整的监控界面。
</p>




<p>
启动脚本 
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@web04-hd-13083 ~]# cat /etc/init.d/node
<span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/bash</span>
<span style="color: #b22222;">### </span><span style="color: #b22222;">BEGIN INIT INFO</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Provides:       </span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Required-Start:   $all</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Required-Stop:     $all</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Default-Start:     2 3 4 5</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Default-Stop:   0 1 6</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Short-Description: Start daemon at boot time</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Description:     Enable service provided by daemon.</span>
<span style="color: #b22222;">### </span><span style="color: #b22222;">END INIT INFO</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">chkconfig: 345 88 08</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">description: Forever for Node.js</span>

<span style="color: #a0522d;">DEAMON</span>=/usr/local/node-sts-app-server/index.js   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#37324;&#38656;&#35201;&#22635;&#20889;&#20320;&#33258;&#24049;&#30340;Node&#39033;&#30446;&#30340;&#21551;&#21160;&#33050;&#26412;&#25991;&#20214;</span>
<span style="color: #a0522d;">LOG</span>=/usr/local/node-sts-app-server/log/node.log  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#36873;&#65292;&#26085;&#24535;&#25991;&#20214;&#30446;&#24405;</span>
<span style="color: #a0522d;">PID</span>=/usr/local/node-sts-app-server/pid  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24517;&#22635;&#20869;&#23481;&#65292;&#29992;&#20110;&#35760;&#24405;forever&#30340;&#36827;&#31243;&#21495;</span>
<span style="color: #a0522d;">WORKDIR</span>=/usr/local/node-sts-app-server
<span style="color: #a0522d;">USER</span>=operator1
<span style="color: #b22222;">#</span><span style="color: #b22222;">export PATH=$PATH:/usr/local/bin  #&#22312;&#36825;&#37324;&#25351;&#23450;&#19968;&#19979;Node&#30340;&#21487;&#25191;&#34892;&#31243;&#24207;&#23433;&#35013;&#30446;&#24405;&#65292;&#25105;&#30340;&#26159;/usr/local/bin</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">export NODE_PATH=$NODE_PATH:/usr/local/node-sts-app-server/node_modules  #&#36825;&#37324;&#26159;Node&#31867;&#24211;&#30340;&#36335;&#24452;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#24448;&#19979;&#30340;&#20869;&#23481;&#23601;&#19981;&#29992;&#20462;&#25913;&#20102;</span>

<span style="color: #a0522d;">node</span>=node
<span style="color: #a0522d;">forever</span>=forever

<span style="color: #a020f0;">case</span> <span style="color: #8b2252;">"$1"</span><span style="color: #a020f0;"> in</span>
    start)
       /bin/su -l operator1 -c  <span style="color: #8b2252;">"$forever start -l $LOG -a --workingDir=$WORKDIR  --pidFile $PID  $DEAMON"</span>
        ;;
    stop)
        $<span style="color: #a0522d;">forever</span> stop --pidFile $<span style="color: #a0522d;">PID</span> $<span style="color: #a0522d;">DEAMON</span>
        ;;
    stopall)
        $<span style="color: #a0522d;">forever</span> stopall --pidFile $<span style="color: #a0522d;">PID</span>
        ;;
    restartall)
        $<span style="color: #a0522d;">forever</span> restartall --pidFile $<span style="color: #a0522d;">PID</span>
        ;;
    reload|restart)
        /bin/su -l operator1 -c  <span style="color: #8b2252;">"$forever restart -l $LOG --pidFile $PID -a --workingDir=$WORKDIR  $DEAMON"</span>
        ;;
    list)
        $<span style="color: #a0522d;">forever</span> list
        ;;
    *)
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Usage: /etc.init.d/node {start|stop|restart|reload|stopall|restartall|list}"</span>
        <span style="color: #a020f0;">exit</span> 1
        ;;
<span style="color: #a020f0;">esac</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35775;&#38382;&#26435;&#38480;</span>
chown -R operator1.operator1 node-sts-app-server/
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6efbb9e2-adcb-44c7-a96c-2c724d121250" class="outline-3">
<h3 id="h:6efbb9e2-adcb-44c7-a96c-2c724d121250">oss跨域</h3>
<div class="outline-text-3" id="text-h:6efbb9e2-adcb-44c7-a96c-2c724d121250">
<p>
<a href="https://help.aliyun.com/document_detail/31870.html?spm=5176.11065259.1996646101.searchclickresult.1d762eadmmqkJN">https://help.aliyun.com/document_detail/31870.html?spm=5176.11065259.1996646101.searchclickresult.1d762eadmmqkJN</a>
</p>

<pre class="example" id="orgd0047aa">
* Access-Control-Allow-Origin 指定允许的跨域请求的来源。 *
  说明 您可以填写*表示全部域名；也可以填写完整域名，例如www.aliyun.com。
* Access-Control-Allow-Headers  指定允许的跨域请求的字段。 X-Custom-Header
* Access-Control-Allow-Methods  指定允许的跨域请求方法。  POST、GET
  说明 如果您需要同时添加POST和GET，请使用英文逗号（,）隔开。
* Access-Control-Max-Age  指定客户端程序对特定资源的预取请求返回结果的缓存时间。 600
* Access-Control-Expose-Headers 指定允许访问的自定义头信息。  Content-Length
</pre>


<figure id="org47e2416">
<img src="./images/image-20210315172556424.png" alt="image-20210315172556424.png">

</figure>

<pre class="example" id="orge09b457">
*
GET,POST,PUT,DELETE,HEAD
*
ETag
x-oss-request-id
</pre>

<p>
使用 curl 测试存储桶 CORS 配置是否正确：
</p>
<div class="org-src-container">
<pre class="src src-sh">curl -I -v -L -H <span style="color: #8b2252;">'origin: &lt;&#36328;&#22495;&#35831;&#27714;&#30340;&#26469;&#28304;&#22495;&#21517;&gt;'</span> &lt;s3&#36164;&#28304;&#22320;&#22336;&gt;
</pre>
</div>

<p>
如果响应头中有如下请求头，则表示配置正确：
</p>
<pre class="example" id="orgda32773">
Access-Control-Allow-Origin: &lt;curl 请求时 -H 参数指定的值&gt;
Access-Control-Allow-Methods: &lt;s3 存储桶 CORS 配置指定的请求方法&gt;
</pre>
</div>
</div>
<div id="outline-container-h:2908f3e6-9c81-415a-8385-56006488f39b" class="outline-3">
<h3 id="h:2908f3e6-9c81-415a-8385-56006488f39b">腾讯-COS</h3>
<div class="outline-text-3" id="text-h:2908f3e6-9c81-415a-8385-56006488f39b">
<p>
#跨域*
</p>

<p>
cdn添加跨域配置后，如果还有跨域的问题，可能就是对应的cos桶没有添加跨域配置
</p>

<p>
搜索框搜索桶名，点击进入详情页面，在安全管理中选择跨域访问COES设置，添加配置
</p>


<figure id="orga7d04f4">
<img src="./images/image-20210719111815345.png" alt="image-20210719111815345.png">

</figure>
</div>
</div>
<div id="outline-container-h:0260d36c-8893-4eed-ba6b-86104b42ab19" class="outline-3">
<h3 id="h:0260d36c-8893-4eed-ba6b-86104b42ab19">aws-s3</h3>
<div class="outline-text-3" id="text-h:0260d36c-8893-4eed-ba6b-86104b42ab19">
<p>
参考：<a href="https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/enabling-cors-examples.html">https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/enabling-cors-examples.html</a>
</p>

<p>
s3 &#x2013;&gt; 权限 &#x2013;&gt; 跨源资源共享(CORS)
</p>

<pre class="example" id="orge1b5f6a">
[
    {
        "AllowedHeaders": [
            "*"
        ],
        "AllowedMethods": [
            "GET"
        ],
        "AllowedOrigins": [
            "https://*.cici.com"
        ],
        "ExposeHeaders": []
    }
]
</pre>
</div>
</div>
</section>
<section id="outline-container-h:bebc4ee8-f5de-443f-96c5-fb5ff96afb93" class="outline-2">
<h2 id="h:bebc4ee8-f5de-443f-96c5-fb5ff96afb93">NAS</h2>
<div class="outline-text-2" id="text-h:bebc4ee8-f5de-443f-96c5-fb5ff96afb93">
<p>
创建NAS创建挂载点
</p>

<pre class="example" id="org2f7edbf">
#安装NFS客户端
yum install -y nfs-utils
# 提高同时发起的NFS请求数量
sudo echo "options sunrpc tcp_slot_table_entries=128" &gt;&gt;  /etc/modprobe.d/sunrpc.conf 
sudo echo "options sunrpc tcp_max_slot_table_entries=128" &gt;&gt;  /etc/modprobe.d/sunrpc.conf

#挂载NFS文件系统
编辑：/etc/fstab
1b3d14be74-dux60.cn-beijing.nas.aliyuncs.com:/172.18.30.140  /iyunwen/resource/    nfs4   vers=4.0,minorversion=0,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,_netdev,noresvport 0 0

mount -a

#注意172.18.30.140目录提前创建好
# mount -t nfs -o vers=4,minorversion=0,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport 1b3d14be74-dux60.cn-beijing.nas.aliyuncs.com:/  /home/suoper/share
# cd /home/suoper/share/
# mkdir 172.18.30.140
# umount /home/suoper/share
</pre>
</div>
</section>
<section id="outline-container-h:974c8b8e-db89-4349-abdb-91c182655e5f" class="outline-2">
<h2 id="h:974c8b8e-db89-4349-abdb-91c182655e5f">短信服务</h2>
<div class="outline-text-2" id="text-h:974c8b8e-db89-4349-abdb-91c182655e5f">
<p>
<b>调用SendSms发送短信</b>
</p>

<p>
模版名称：数据系统操作通知
</p>

<p>
模版CODE：SMS_190282220
</p>

<p>
模板内容：`${userName}账号在 \({time} 进行了"\){operateType}"操作，涉及到数据行数（${rawNumber}），请关注`。
</p>

<p>
---------&#x2013;&#x2014;代码样例
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/usr/bin/env python</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">coding=utf-8</span>

<span style="color: #a020f0;">from</span> aliyunsdkcore.client <span style="color: #a020f0;">import</span> AcsClient
<span style="color: #a020f0;">from</span> aliyunsdkcore.request <span style="color: #a020f0;">import</span> CommonRequest
<span style="color: #a0522d;">client</span> = AcsClient(<span style="color: #8b2252;">'&lt;accessKeyId&gt;'</span>, <span style="color: #8b2252;">'&lt;accessSecret&gt;'</span>, <span style="color: #8b2252;">'cn-hangzhou'</span>)

<span style="color: #a0522d;">request</span> = CommonRequest()
request.set_accept_format(<span style="color: #8b2252;">'json'</span>)
request.set_domain(<span style="color: #8b2252;">'dysmsapi.aliyuncs.com'</span>)
request.set_method(<span style="color: #8b2252;">'POST'</span>)
request.set_protocol_type(<span style="color: #8b2252;">'https'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">https | http</span>
request.set_version(<span style="color: #8b2252;">'2017-05-25'</span>)
request.set_action_name(<span style="color: #8b2252;">'SendSms'</span>)

request.add_query_param(<span style="color: #8b2252;">'RegionId'</span>, <span style="color: #8b2252;">"cn-hangzhou"</span>)
request.add_query_param(<span style="color: #8b2252;">'PhoneNumbers'</span>, <span style="color: #8b2252;">"135224xx"</span>)
request.add_query_param(<span style="color: #8b2252;">'SignName'</span>, <span style="color: #8b2252;">"xcw"</span>)
request.add_query_param(<span style="color: #8b2252;">'TemplateCode'</span>, <span style="color: #8b2252;">"SMS_190282220"</span>)
request.add_query_param(<span style="color: #8b2252;">'TemplateParam'</span>, <span style="color: #8b2252;">"{\"userName\":\"xuchangwei\",\"time\":\"2020-05-16 15:01:00\",\"operateType\":\"&#25968;&#25454;&#31995;&#32479;\",\"rawNumber\":\"1000\"}"</span>)

<span style="color: #a0522d;">response</span> = client.do_action(request)
<span style="color: #b22222;"># </span><span style="color: #b22222;">python2:  print(response) </span>
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">str</span>(response, encoding = <span style="color: #8b2252;">'utf-8'</span>))
</pre>
</div>


<p>
<b>调用SendBatchSms接口批量发送短信</b>
</p>

<p>
API调用访问认证：
</p>

<p>
AcxxxsKey ID: LTA
</p>

<p>
accxxxsSecret: ah5P
</p>

<p>
签名：xcw
</p>

<p>
模版CODE：SMS_190282079
</p>

<p>
模板内容：`通知：\({name}正在进行升级维护，商品\){payContent}，您暂时无法进行\({payType}，预计\){time}之前恢复`。
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">import</span> <span style="color: #008b8b;">com</span>.<span style="color: #008b8b;">aliyuncs</span>.<span style="color: #228b22;">CommonRequest</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">com</span>.<span style="color: #008b8b;">aliyuncs</span>.<span style="color: #228b22;">CommonResponse</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">com</span>.<span style="color: #008b8b;">aliyuncs</span>.<span style="color: #228b22;">DefaultAcsClient</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">com</span>.<span style="color: #008b8b;">aliyuncs</span>.<span style="color: #228b22;">IAcsClient</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">com</span>.<span style="color: #008b8b;">aliyuncs</span>.<span style="color: #008b8b;">exceptions</span>.<span style="color: #228b22;">ClientException</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">com</span>.<span style="color: #008b8b;">aliyuncs</span>.<span style="color: #008b8b;">exceptions</span>.<span style="color: #228b22;">ServerException</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">com</span>.<span style="color: #008b8b;">aliyuncs</span>.<span style="color: #008b8b;">http</span>.<span style="color: #228b22;">MethodType</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">com</span>.<span style="color: #008b8b;">aliyuncs</span>.<span style="color: #008b8b;">profile</span>.<span style="color: #228b22;">DefaultProfile</span>;
<span style="color: #b22222;">/*</span>
<span style="color: #b22222;">pom.xml</span>
<span style="color: #b22222;">&lt;dependency&gt;</span>
<span style="color: #b22222;">  &lt;groupId&gt;com.aliyun&lt;/groupId&gt;</span>
<span style="color: #b22222;">  &lt;artifactId&gt;aliyun-java-sdk-core&lt;/artifactId&gt;</span>
<span style="color: #b22222;">  &lt;version&gt;4.5.0&lt;/version&gt;</span>
<span style="color: #b22222;">&lt;/dependency&gt;</span>
<span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">SendBatchSms</span> {
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">main</span>(<span style="color: #228b22;">String</span>[] <span style="color: #a0522d;">args</span>) {
        <span style="color: #228b22;">DefaultProfile</span> <span style="color: #a0522d;">profile</span> = DefaultProfile.getProfile(<span style="color: #8b2252;">"cn-hangzhou"</span>, <span style="color: #8b2252;">"&lt;accxxssKeyId&gt;"</span>, <span style="color: #8b2252;">"&lt;accxxsSecret&gt;"</span>);
        <span style="color: #228b22;">IAcsClient</span> <span style="color: #a0522d;">client</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">DefaultAcsClient</span>(profile);

        <span style="color: #228b22;">CommonRequest</span> <span style="color: #a0522d;">request</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">CommonRequest</span>();
        request.setSysMethod(<span style="color: #008b8b;">MethodType</span>.POST);
        request.setSysDomain(<span style="color: #8b2252;">"dysmsapi.aliyuncs.com"</span>);
        request.setSysVersion(<span style="color: #8b2252;">"2017-05-25"</span>);
        request.setSysAction(<span style="color: #8b2252;">"SendBatchSms"</span>);
        request.putQueryParameter(<span style="color: #8b2252;">"RegionId"</span>, <span style="color: #8b2252;">"cn-hangzhou"</span>);
        request.putQueryParameter(<span style="color: #8b2252;">"PhoneNumberJson"</span>, <span style="color: #8b2252;">"[\"13522xx\",\"1871026xx\"]"</span>);
        request.putQueryParameter(<span style="color: #8b2252;">"SignNameJson"</span>, <span style="color: #8b2252;">"[\"xcw\",\"xcw\"]"</span>);
        request.putQueryParameter(<span style="color: #8b2252;">"TemplateCode"</span>, <span style="color: #8b2252;">"SMS_190282079"</span>);
        request.putQueryParameter(<span style="color: #8b2252;">"TemplateParamJson"</span>, <span style="color: #8b2252;">"[{\"name\":\"&#38134;&#34892;&#31995;&#32479;\",\"payContent\":\"&#26242;&#20572;&#25903;&#20184;&#19994;&#21153;\",\"payType\":\"&#20184;&#27454;\",\"time\":\"2020-05-14\"},{\"name\":\"&#38134;&#34892;&#31995;&#32479;\",\"payContent\":\"&#26242;&#20572;&#25903;&#20184;&#19994;&#21153;\",\"payType\":\"&#20184;&#27454;\",\"time\":\"2020-05-14\"}]"</span>);
        <span style="color: #a020f0;">try</span> {
            <span style="color: #228b22;">CommonResponse</span> <span style="color: #a0522d;">response</span> = client.getCommonResponse(request);
            System.out.println(response.getData());
        } <span style="color: #a020f0;">catch</span> (ServerException e) {
            e.printStackTrace();
        } <span style="color: #a020f0;">catch</span> (ClientException e) {
            e.printStackTrace();
        }
    }
}
</pre>
</div>
</div>
</section>
<section id="outline-container-h:d2700a10-479e-470b-ba71-daec5d458fca" class="outline-2">
<h2 id="h:d2700a10-479e-470b-ba71-daec5d458fca">CDN</h2>
<div class="outline-text-2" id="text-h:d2700a10-479e-470b-ba71-daec5d458fca">
</div>
<div id="outline-container-h:8d14bc95-ab69-4f7c-9f23-af02e9ec22f5" class="outline-3">
<h3 id="h:8d14bc95-ab69-4f7c-9f23-af02e9ec22f5">服务管理</h3>
<div class="outline-text-3" id="text-h:8d14bc95-ab69-4f7c-9f23-af02e9ec22f5">
<p>
<b>刷新预热</b>
</p>

<p>
CDN提供的资源的刷新和预热功能的概念如下：
</p>

<ul class="org-ul">
<li>刷新功能是指提交URL刷新或目录刷新请求后，CDN节点的缓存内容将会被强制过期，当您向CDN节点请求资源时，CDN会直接回源站获取对应的资源返回给您，并将其缓存。刷新功能会降低缓存命中率。</li>
<li>预热功能是指提交URL预热请求后，源站将会主动将对应的资源缓存到CDN节点，当您首次请求时，就能直接从CDN节点缓存中获取到最新的请求资源，无需再回源站获取。预热功能会提高缓存命中率。</li>
</ul>


<figure id="orgd7f0f4e">
<img src="./images/image-20210129151922025.png" alt="image-20210129151922025.png">

</figure>

<p>
注意： <code>如果修改了源文件 需要先执行url刷新 先清除缓存配置，再操作url预热</code>
</p>

<p>
<b>手动刷新</b>
</p>

<p>
操作
</p>

<ol class="org-ol">
<li>登录[CDN控制台](<a href="https://cdn.console.aliyun.com/">https://cdn.console.aliyun.com/</a>)。</li>
<li>在左侧导航栏，单击 <b>刷新预热</b> 。</li>
<li>在 <b>刷新缓存</b> 页签，您可以根据所需，配置刷新或预热信息</li>
</ol>


<figure id="orgdbcddd3">
<img src="./images/image-20210129152210973.png" alt="image-20210129152210973.png">

</figure>


<p>
<b>OSS开始域名自动刷新</b>
</p>


<figure id="org5ad82c1">
<img src="./images/image-20210315173021036.png" alt="image-20210315173021036.png">

</figure>

<p>
自动刷新脚本
</p>

<p>
RAM访问策略
</p>

<pre class="example" id="org4225207">
{
    "Version": "1",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "cdn:PushObjectCache",
                "cdn:RefreshObjectCaches"
            ],
            "Resource": "acs:cdn:*:*:*",
            "Condition": {
                "IpAddress": {
                    "acs:SourceIp": [
                        "211.103.135.96/29",
                        "172.28.30.56",
                        "123.57.87.183"
                    ]
                }
            }
        }
    ]
}
</pre>

<p>
<a href="https://help.aliyun.com/document_detail/151829.html?spm=5176.10695662.1996646101.searchclickresult.5aea25a1CxcObd">https://help.aliyun.com/document_detail/151829.html?spm=5176.10695662.1996646101.searchclickresult.5aea25a1CxcObd</a>
</p>


<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#20381;&#36182;</span>
pip install aliyun-python-sdk-core
pip install aliyun-python-sdk-cdn

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33050;&#26412;</span>
cat &lt;&lt;\EOF &gt; /data/ops/Refresh.py 
<span style="color: #ffa54f;">#!/usr/bin/env python</span>
<span style="color: #ffa54f;">#coding=utf-8</span>
<span style="color: #ffa54f;"># __author__ = 'hanli.zyb'</span>

<span style="color: #ffa54f;">'''Check Package'''</span>

<span style="color: #ffa54f;">try:</span>
<span style="color: #ffa54f;"> import os, sys, getopt, time, json</span>
<span style="color: #ffa54f;"> from aliyunsdkcore.client import AcsClient</span>
<span style="color: #ffa54f;"> from aliyunsdkcore.acs_exception.exceptions import ClientException</span>
<span style="color: #ffa54f;"> from aliyunsdkcore.acs_exception.exceptions import ServerException</span>
<span style="color: #ffa54f;"> from aliyunsdkcdn.request.v20180510.RefreshObjectCachesRequest import RefreshObjectCachesRequest</span>
<span style="color: #ffa54f;"> from aliyunsdkcdn.request.v20180510.PushObjectCacheRequest import PushObjectCacheRequest</span>
<span style="color: #ffa54f;"> from aliyunsdkcdn.request.v20180510.DescribeRefreshTasksRequest import DescribeRefreshTasksRequest</span>
<span style="color: #ffa54f;"> from aliyunsdkcdn.request.v20180510.DescribeRefreshQuotaRequest import DescribeRefreshQuotaRequest</span>
<span style="color: #ffa54f;">except:</span>
<span style="color: #ffa54f;"> sys.exit("[Error] Please pip install aliyun-python-sdk-cdn and aliyun-java-sdk-core &#65292;please install now......")</span>

<span style="color: #ffa54f;">reload(sys)</span>
<span style="color: #ffa54f;">sys.setdefaultencoding('utf8')</span>

<span style="color: #ffa54f;">class Refresh(object):</span>

<span style="color: #ffa54f;">  '''init func'''</span>

<span style="color: #ffa54f;">  def __init__(self):</span>

<span style="color: #ffa54f;">   self.lists = []</span>
<span style="color: #ffa54f;">   self.param = {}</span>

<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  &#25551;&#36848;&#65306;&#35843;&#24230;&#30340;&#20027;&#20989;&#25968;</span>
<span style="color: #ffa54f;">  resP&#65306;&#26816;&#27979;&#20837;&#21442;&#32467;&#26524;&#65292;&#22914;&#26524;&#31867;&#22411;&#19981;&#26159; bool &#35828;&#26126;&#26377;&#25253;&#38169;</span>
<span style="color: #ffa54f;">  '''</span>

<span style="color: #ffa54f;">  def main(self,argv):</span>
<span style="color: #ffa54f;">    if len(argv) &lt; 1 :</span>
<span style="color: #ffa54f;">      sys.exit("\nusage: " + sys.argv[0] + " -h ")</span>
<span style="color: #ffa54f;">    try:</span>
<span style="color: #ffa54f;">      opts,args = getopt.getopt(argv,"hi:k:n:r:t:a:o:")</span>
<span style="color: #ffa54f;">    except Exception as e :</span>
<span style="color: #ffa54f;">      sys.exit("\nusage: " + sys.argv[0] + " -h ")</span>

<span style="color: #ffa54f;">    for opt,arg in opts:</span>
<span style="color: #ffa54f;">      if opt == '-h':</span>
<span style="color: #ffa54f;">        self.helps()</span>
<span style="color: #ffa54f;">        sys.exit()</span>
<span style="color: #ffa54f;">      elif opt == '-i':</span>
<span style="color: #ffa54f;">        self.param['-i'] = arg</span>
<span style="color: #ffa54f;">      elif opt == '-k':</span>
<span style="color: #ffa54f;">        self.param['-k'] = arg</span>
<span style="color: #ffa54f;">      elif opt == '-r':</span>
<span style="color: #ffa54f;">        self.param['-r'] = arg</span>
<span style="color: #ffa54f;">      elif opt == '-t':</span>
<span style="color: #ffa54f;">        self.param['-t'] = arg</span>
<span style="color: #ffa54f;">      elif opt == '-a':</span>
<span style="color: #ffa54f;">        self.param['-a'] = arg </span>
<span style="color: #ffa54f;">      elif opt == '-o':</span>
<span style="color: #ffa54f;">        self.param['-o'] = arg</span>
<span style="color: #ffa54f;">      elif opt == '-n':</span>
<span style="color: #ffa54f;">        self.param['-n'] = arg</span>
<span style="color: #ffa54f;">      else:</span>
<span style="color: #ffa54f;">        sys.exit("\nusage: " + sys.argv[0] + " -h ")</span>

<span style="color: #ffa54f;">    resP = self.doCheck(self.param)</span>
<span style="color: #ffa54f;">    if not isinstance(resP,bool): sys.exit(resP)</span>

<span style="color: #ffa54f;">    try:</span>
<span style="color: #ffa54f;">      #client = AcsClient(self.param['-i'], self.param['-k'], 'cn-hangzhou')</span>
<span style="color: #ffa54f;">      client = AcsClient('XXXq', 'XXXXlZ', 'cn-hangzhou')</span>
<span style="color: #ffa54f;">    except NameError:</span>
<span style="color: #ffa54f;">      sys.exit("[Error]: SDK module not detected")</span>

<span style="color: #ffa54f;">    for g in self.doProd(self.param):</span>
<span style="color: #ffa54f;">      self.lists = []</span>
<span style="color: #ffa54f;">      self.doRefresh(''.join(g),self.param['-t'],client)</span>

<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  &#25551;&#36848;&#65306;&#26816;&#27979;&#20837;&#21442;&#25968;</span>
<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  def doCheck(self,param):</span>

<span style="color: #ffa54f;">    try:</span>
<span style="color: #ffa54f;">      #for key1 in ('-i','-k','-r','-t'):</span>
<span style="color: #ffa54f;">      for key1 in ('-r','-t'):</span>
<span style="color: #ffa54f;">        if not key1 in param.keys():</span>
<span style="color: #ffa54f;">          return "[Error]: {0} Must be by parameter".format(key1)</span>

<span style="color: #ffa54f;">      try:</span>
<span style="color: #ffa54f;">        if not param.has_key('-n'):</span>
<span style="color: #ffa54f;">          self.param['-n'] = 50</span>
<span style="color: #ffa54f;">        if not (abs(int(param['-n'])) &lt;= 100 and abs(int(param['-n'])) &gt; 0):</span>
<span style="color: #ffa54f;">          return "[Error]: 0 &lt; -n &lt;= 100"</span>
<span style="color: #ffa54f;">        else:</span>
<span style="color: #ffa54f;">          self.param['-n'] = int(param['-n'])</span>
<span style="color: #ffa54f;">      except ValueError as e:</span>
<span style="color: #ffa54f;">        return "[Error]: -n Must be int Type ,{0}".format(str(e))</span>

<span style="color: #ffa54f;">      if not param['-t'] in ("push","clear"): return "[Error]: taskType Error"</span>
<span style="color: #ffa54f;">      if param.has_key('-a') and param.has_key('-o'): return "[Error]: -a and -o cannot exist at same time"</span>

<span style="color: #ffa54f;">      if param.has_key('-a'):</span>
<span style="color: #ffa54f;">          if not param['-a'] in ("domestic","overseas"): </span>
<span style="color: #ffa54f;">            return "[Error]: Area value Error"</span>
<span style="color: #ffa54f;">          if param['-t'] == 'clear':</span>
<span style="color: #ffa54f;">            return "[Error]: -t must be push and 'clear' -o use together"</span>

<span style="color: #ffa54f;">      if param.has_key('-o'):</span>
<span style="color: #ffa54f;">          if not param['-o'] in ("File","Directory"):</span>
<span style="color: #ffa54f;">            return "[Error]: ObjectType value Error"</span>
<span style="color: #ffa54f;">          if param['-t'] == 'push':</span>
<span style="color: #ffa54f;">            return "[Error]: -t must be clear and 'push' -a use together"</span>

<span style="color: #ffa54f;">    except KeyError as e:</span>
<span style="color: #ffa54f;">       return "[Error]: Parameter {0} error".format(str(e))</span>
<span style="color: #ffa54f;">    return True</span>

<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  &#25551;&#36848;&#65306;&#29983;&#25104;&#22120;&#20999;&#20998;&#25991;&#20214;&#65292;&#23545;&#27599;&#34892;&#25991;&#20214;&#36827;&#34892;&#22788;&#29702; '\n'</span>
<span style="color: #ffa54f;">  gop&#65306;&#27599;&#27425;&#35835;&#21462; URL &#25968;&#37327;</span>
<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  def doProd(self,params):</span>
<span style="color: #ffa54f;">    gop = params['-n']</span>
<span style="color: #ffa54f;">    mins = 1</span>
<span style="color: #ffa54f;">    maxs = gop</span>

<span style="color: #ffa54f;">    #with open(params['-r'], "r") as f:</span>
<span style="color: #ffa54f;">    #  for line in f.readlines():</span>
<span style="color: #ffa54f;">    #    if mins != maxs:</span>
<span style="color: #ffa54f;">    #     line = line.strip("\n") + "\n"</span>
<span style="color: #ffa54f;">    #    else:</span>
<span style="color: #ffa54f;">    #     line = line.strip("\n")</span>
<span style="color: #ffa54f;">    #    self.lists.append(line)</span>
<span style="color: #ffa54f;">    #    if mins &gt;= maxs:</span>
<span style="color: #ffa54f;">    #     yield self.lists</span>
<span style="color: #ffa54f;">    #     mins = maxs</span>
<span style="color: #ffa54f;">    #     maxs = gop + maxs -1</span>
<span style="color: #ffa54f;">    #    else:</span>
<span style="color: #ffa54f;">    #     mins += 1</span>
<span style="color: #ffa54f;">    #  print self.lists</span>
<span style="color: #ffa54f;">    #  if len(self.lists) &gt; 0: yield self.lists</span>
<span style="color: #ffa54f;">    self.lists.append(params['-r'])</span>
<span style="color: #ffa54f;">    if len(self.lists) &gt; 0: yield self.lists</span>


<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  &#25551;&#36848;&#65306;&#21047;&#26032;/&#39044;&#28909;&#20219;&#21153;</span>
<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  def doRefresh(self,lists,types,client):</span>
<span style="color: #ffa54f;">    try:</span>
<span style="color: #ffa54f;">      if types == 'clear':</span>
<span style="color: #ffa54f;">        taskID = 'RefreshTaskId'</span>
<span style="color: #ffa54f;">        request = RefreshObjectCachesRequest()</span>
<span style="color: #ffa54f;">        if self.param.has_key('-o'):</span>
<span style="color: #ffa54f;">          request.set_ObjectType(self.param['-o'])</span>
<span style="color: #ffa54f;">      elif types == 'push':</span>
<span style="color: #ffa54f;">        taskID = 'PushTaskId'</span>
<span style="color: #ffa54f;">        request = PushObjectCacheRequest()</span>
<span style="color: #ffa54f;">        if self.param.has_key('-a'):</span>
<span style="color: #ffa54f;">          request.set_Area(self.param['-a'])</span>

<span style="color: #ffa54f;">      taskreq = DescribeRefreshTasksRequest()</span>
<span style="color: #ffa54f;">      request.set_accept_format('json')</span>
<span style="color: #ffa54f;">      request.set_ObjectPath(lists)</span>
<span style="color: #ffa54f;">      response = json.loads(client.do_action_with_exception(request))</span>
<span style="color: #ffa54f;">      print(response)</span>

<span style="color: #ffa54f;">      while True:</span>
<span style="color: #ffa54f;">        count = 0</span>
<span style="color: #ffa54f;">        taskreq.set_accept_format('json')</span>
<span style="color: #ffa54f;">        print(response[taskID].split(","))</span>
<span style="color: #ffa54f;">        for id in response[taskID].split(","):</span>
<span style="color: #ffa54f;">            #taskreq.set_TaskId(int(response[taskID]))</span>
<span style="color: #ffa54f;">            taskreq.set_TaskId(int(id))</span>
<span style="color: #ffa54f;">            taskresp = json.loads(client.do_action_with_exception(taskreq))</span>
<span style="color: #ffa54f;">            #print("[" + response[taskID] + "]" + "is doing... ...")</span>
<span style="color: #ffa54f;">            print("[" + id + "]" + "URL&#21047;&#26032;&#20013;... ...")</span>
<span style="color: #ffa54f;">            for t in taskresp['Tasks']['CDNTask']:</span>
<span style="color: #ffa54f;">              if t['Status'] != 'Complete':</span>
<span style="color: #ffa54f;">                count += 1</span>
<span style="color: #ffa54f;">            time.sleep(5)</span>
<span style="color: #ffa54f;">        if count == 0:</span>
<span style="color: #ffa54f;">          break</span>
<span style="color: #ffa54f;">        else:</span>
<span style="color: #ffa54f;">          continue</span>
<span style="color: #ffa54f;">    except Exception as e:</span>
<span style="color: #ffa54f;">      sys.exit("[Error]" + str(e))</span>

<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  &#25551;&#36848;&#65306;&#24110;&#21161;&#20449;&#24687;</span>
<span style="color: #ffa54f;">  '''</span>
<span style="color: #ffa54f;">  def helps(self):</span>
<span style="color: #ffa54f;">    print("\nscript options explain: \</span>
<span style="color: #ffa54f;">            \n\t -i &lt;AcxxssKey&gt;                  &#35775;&#38382;&#38463;&#37324;&#20113;&#20973;&#35777;&#65292;&#35775;&#38382;&#25511;&#21046;&#21488;&#19978;&#21487;&#20197;&#33719;&#24471;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t -k &lt;AccxxKeySecret&gt;            &#35775;&#38382;&#38463;&#37324;&#20113;&#23494;&#38053;&#65292;&#35775;&#38382;&#25511;&#21046;&#21488;&#19978;&#21487;&#20197;&#33719;&#24471;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t -r &lt;filename&gt;                   &#25991;&#20214;&#21517;&#31216;&#65292;&#27599;&#34892;&#19968;&#26465; URL&#65292;&#26377;&#29305;&#27530;&#23383;&#31526;&#20808;&#20570; URLencode&#65292;&#20197; http/https &#24320;&#22836;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t -t &lt;taskType&gt;                   &#20219;&#21153;&#31867;&#22411; clear &#21047;&#26032;&#65292;push &#39044;&#28909;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t -n [int,[..100]]                &#21487;&#36873;&#39033;&#65292;&#27599;&#27425;&#25805;&#20316;&#25991;&#20214;&#25968;&#37327;&#65292;&#20570;&#22810; 100 &#26465;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t -a [String,&lt;domestic|overseas&gt;  &#21487;&#36873;&#39033;&#65292;&#39044;&#28909;&#33539;&#22260;&#65292;&#19981;&#20256;&#26159;&#40664;&#35748;&#26159;&#20840;&#29699;&#65307;\</span>
<span style="color: #ffa54f;">            \n\t    domestic                     &#20165;&#20013;&#22269;&#22823;&#38470;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t    overseas                     &#20840;&#29699;&#65288;&#19981;&#21253;&#21547;&#20013;&#22269;&#22823;&#38470;&#65289;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t -o [String,&lt;File|Directory&gt;]    &#21487;&#36873;&#39033;&#65292;&#21047;&#26032;&#30340;&#31867;&#22411;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t    File                         &#25991;&#20214;&#21047;&#26032;&#65288;&#40664;&#35748;&#20540;&#65289;&#65307; \</span>
<span style="color: #ffa54f;">            \n\t    Directory                    &#30446;&#24405;&#21047;&#26032;")</span>
<span style="color: #ffa54f;">#TODO &#20837;&#21475;</span>

<span style="color: #ffa54f;">if __name__ == '__main__':</span>
<span style="color: #ffa54f;">  fun = Refresh()</span>
<span style="color: #ffa54f;">  fun.main(sys.argv[1:])</span>

<span style="color: #ffa54f;">EOF</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">python /data/ops/Refresh.py -r https://new-teacher.cici.com/ -t clear </span>
{u<span style="color: #8b2252;">'RefreshTaskId'</span>: u<span style="color: #8b2252;">'10542101638'</span>, u<span style="color: #8b2252;">'RequestId'</span>: u<span style="color: #8b2252;">'DFC3A1FC-C896-4B4B-8B79-0C81886A249C'</span>}
[u<span style="color: #8b2252;">'10542101638'</span>]
[10542101638]is doing... ...
[u<span style="color: #8b2252;">'10542101638'</span>]
[10542101638]is doing... ...
</pre>
</div>

<p>
```
</p>
</div>
</div>
<div id="outline-container-h:b1cb9050-79b0-44ca-bc83-9e6836dabf93" class="outline-3">
<h3 id="h:b1cb9050-79b0-44ca-bc83-9e6836dabf93">cnd常用配置</h3>
<div class="outline-text-3" id="text-h:b1cb9050-79b0-44ca-bc83-9e6836dabf93">
<p>
<b>缓存配置</b>
</p>


<figure id="org73ce3c0">
<img src="./images/image-20210315172416613.png" alt="image-20210315172416613.png">

</figure>

<pre class="example" id="orge012649">
bmp,jpg,png,tif,gif,pcx,tga,exif,fpx,svg,psd,cdr,pcd,dxf,ufo,eps,ai,raw,WMF,webp,mp4,wav
</pre>

<p>
<b>回源</b>
</p>

<p>
回源-开启阿里云OSS私有Bucket回源
</p>

<p>
回源-过滤参数
</p>

<p>
<a href="https://help.aliyun.com/document_detail/27128.html?spm=5176.11065259.1996646101.searchclickresult.41437200joImMZ">https://help.aliyun.com/document_detail/27128.html?spm=5176.11065259.1996646101.searchclickresult.41437200joImMZ</a>
</p>

<p>
过滤参数包括 过滤参数和忽略参数这两个功能。
</p>

<pre class="example" id="org0b4130e">
* 保留过滤参数：保留指定参数，多个参数之间用英文逗号隔开，未指定的参数将不会被保留。
* 忽略参数：删除指定参数，多个参数之间用空格隔开，剩余参数将不会被忽略。
</pre>


<figure id="org34b932c">
<img src="./images/image-20210315172455863.png" alt="image-20210315172455863.png">

</figure>

<p>
<b>概念跨域</b>
</p>

<p>
被访问的一端设置跨域。如前端页面加了cnd中的图片地址，那么被访问端cnd就要设置跨域
</p>

<pre class="example" id="org9b41d3e">
access-control-allow-origin: * 或者http://ts-game.cici.com
Access-Control-Allow-Methods: GET,POST,OPTIONS
</pre>


<p>
跨域资源共享（Cross-Origin Resource Sharing，CORS）简称跨域访问，是HTML5提供的标准跨域解决方案，允许Web应用服务器进行跨域访问控制，使得跨域数据传输得以安全进行。
</p>

<p>
背景信息
</p>

<p>
跨域访问是浏览器出于安全考虑而设置的一个限制，即同源策略。当A、B两个网站属于不同域时，来自于A网站页面中的JavaScript代码访问B网站时，浏览器会拒绝该访问。
</p>

<p>
例如当运行在同一个浏览器上的不同来源，例如www.example.com和www.test.com请求同一跨域资源时，若www.example.com的请求先到达服务器，服务器将请求的资源带上Access-Control-Allow-Origin的Header，并返回给www.example.com的用户。此时www.test.com也发起了请求，浏览器会将缓存的上一次请求响应返回给用户，Header的内容和CORS的要求不匹配，导致www.test.com请求失败。
</p>

<p>
同源策略限制从一个源加载的文档或脚本与另一个源的资源进行交互的方式，是用于隔离潜在恶意文件的关键安全机制。同协议、同域名（或 IP）、以及同端口视为同一个域。两个页面的协议、域名和端口（若指定了端口）相同，则视为同源。如下表给出了相对<a href="http://www.aliyun.com/org/test.html%E7%9A%84%E5%90%8C%E6%BA%90%E6%A3%80%E6%B5%8B%E7%A4%BA%E4%BE%8B%EF%BC%9A">http://www.aliyun.com/org/test.html%E7%9A%84%E5%90%8C%E6%BA%90%E6%A3%80%E6%B5%8B%E7%A4%BA%E4%BE%8B%EF%BC%9A</a>
</p>


<figure id="orge0003fa">
<img src="./images/image-20210315172509631.png" alt="image-20210315172509631.png">

</figure>

<pre class="example" id="org1d0e038">
* Access-Control-Allow-Origin 指定允许的跨域请求的来源。 *
说明 您可以填写*表示全部域名；也可以填写完整域名，例如www.aliyun.com。
* Access-Control-Allow-Headers  指定允许的跨域请求的字段。 X-Custom-Header
* Access-Control-Allow-Methods  指定允许的跨域请求方法。  POST、GET
说明 如果您需要同时添加POST和GET，请使用英文逗号（,）隔开。
* Access-Control-Max-Age  指定客户端程序对特定资源的预取请求返回结果的缓存时间。 600
* Access-Control-Expose-Headers 指定允许访问的自定义头信息。  Content-Length
</pre>

<p>
<b>cdn</b>
</p>

<p>
<a href="https://help.aliyun.com/document_detail/27137.html?spm=5176.11785003.0.dexternal.7b0b142f3ou3vv">https://help.aliyun.com/document_detail/27137.html?spm=5176.11785003.0.dexternal.7b0b142f3ou3vv</a>
</p>

<p>
登录CDN控制台&#x2013;&gt;在左侧导航栏，单击域名管理&#x2013;&gt;在域名管理页面，单击目标域名对应的管理
</p>

<p>
在指定域名的左侧导航栏，单击缓存配置 &#x2013;&gt; 单击缓存HTTP响应头 &#x2013;&gt; 在缓存HTTP响应头页签，单击添加。
</p>

<pre class="example" id="org63a96d7">
Access-Control-Allow-Origin *
Access-Control-Allow-Methods GET,POST,PUT,DELETE,HEAD
#注意 “是否允许重复”选不重复
</pre>


<figure id="org14113e5">
<img src="./images/image-20210315172534369.png" alt="image-20210315172534369.png">

</figure>

<p>
<b>k8s跨域</b>
</p>

<pre class="example" id="org0278af0">
nginx.ingress.kubernetes.io/cors-allow-credentials: "true"
nginx.ingress.kubernetes.io/cors-allow-headers: '*'
nginx.ingress.kubernetes.io/cors-allow-methods: PUT,GET,POST,OPTIONS
nginx.ingress.kubernetes.io/cors-allow-origin: http://test-admin.d.rrinner.cn   （ 指定域名）
nginx.ingress.kubernetes.io/enable-cors: "true"
</pre>


<p>
<b>oss</b>
</p>

<p>
<a href="https://help.aliyun.com/document_detail/31870.html?spm=5176.11065259.1996646101.searchclickresult.1d762eadmmqkJN">https://help.aliyun.com/document_detail/31870.html?spm=5176.11065259.1996646101.searchclickresult.1d762eadmmqkJN</a>
</p>


<figure id="org5947f43">
<img src="./images/image-20210315172556424.png" alt="image-20210315172556424.png">

</figure>

<pre class="example" id="orgd0ee8fa">
*
GET,POST,PUT,DELETE,HEAD
*
ETag
x-oss-request-id
</pre>



<p>
<b>证书到期时间</b>
</p>

<p>
https免费证书自动续签，在到期前4天自动续签
</p>

<p>
<b>问题排查工具</b>
</p>

<p>
1、访问异常时间点【必要】
</p>

<p>
2、具体访问异常的URL【必要】；
</p>

<p>
2、访问CDN的节点IP，您可以通过ping加速域名得到【用户客户端环境允许可提供】；
</p>

<p>
3、请提供下报障用户客户端的IP和DNS信息，客户端浏览器直接访问<a href="https://cdn.dns-detect.alicdn.com/https/doc.html">https://cdn.dns-detect.alicdn.com/https/doc.html</a> 并截图即可【必要】；
</p>

<p>
4、用户客户端访问的报错信息和截图【必要】；
</p>

<p>
5、通过浏览器按F12开发者模式中的network标签页中查看到，包括request、response头信息，并且帮忙获取header头response头信息中“EagleId: 7d4cf79f16183882838401048e ”这个字段；via中vcache7.cn3181代表一组CDN缓存节点【用户客户端环境允许可提供】；
</p>

<p>
6、收集域名解析信息，浏览器访问并截图 <a href="http://dns.alidns.com/resolve?name">http://dns.alidns.com/resolve?name</a>= 请填写报障域名 【用户客户端环境允许可提供】；
</p>


<figure id="org84956fb">
<img src="./images/image-20210423140835661.png" alt="image-20210423140835661.png">

</figure>

<p>
白屏问题是这样的，有两个思路，一个是用户侧没有访问到cdn节点上，如果没有的话，有可能是被劫持；另一个是如果访问到cdn节点上，访问到的是哪一个节点，我这边需要根据节点ip定位当时的监控是否有问题，是否需要调整调度覆盖。
</p>
</div>
<div id="outline-container-h:d68efa88-37b9-45b4-8eb9-0bf789e7bf27" class="outline-4">
<h4 id="h:d68efa88-37b9-45b4-8eb9-0bf789e7bf27">CDN厂商响应检测</h4>
<div class="outline-text-4" id="text-h:d68efa88-37b9-45b4-8eb9-0bf789e7bf27">
<p>
<a href="https://www.uptrends.com/">https://www.uptrends.com/</a>
</p>
</div>
</div>
</div>
</section>
<section id="outline-container-h:8d3c1307-d936-4f78-a0e2-e1d55419cf77" class="outline-2">
<h2 id="h:8d3c1307-d936-4f78-a0e2-e1d55419cf77">RAM</h2>
<div class="outline-text-2" id="text-h:8d3c1307-d936-4f78-a0e2-e1d55419cf77">
<p>
访问控制
</p>
</div>
<div id="outline-container-h:a8fbf19e-7927-45ac-a9c0-643215d54b88" class="outline-3">
<h3 id="h:a8fbf19e-7927-45ac-a9c0-643215d54b88">RAM-OSS</h3>
<div class="outline-text-3" id="text-h:a8fbf19e-7927-45ac-a9c0-643215d54b88">
<p>
只对名为 hdzy 的oss存储中zone/answer/ 和 book_photo_path/ 目录有上传读权限，没有删除权限
</p>

<p>
注意前后顺序
</p>

<pre class="example" id="org4b3d987">
{
  "Version": "1",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListBuckets",
        "oss:GetBucketAcl"
      ],
      "Resource": [
        "acs:oss:*:*:*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:Get*",
    "oss:Put*",
      ],
      "Resource": [
        "acs:oss:*:*:hdzy/zone/answer/*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListObjects"
      ],
      "Resource": [
        "acs:oss:*:*:hdzy"
      ],
      "Condition": {
        "oss:Delimiter":"/",
        "StringLike": {
          "oss:Prefix": [
            "",
            "zone/",
            "zone/answer/*"
          ]
        }
      }
    }
  ]
}
</pre>



<p>
OSS 访问控制
</p>

<p>
1.授权 RAM 用户完全管理某个 Bucket: myphotos 的权限。
</p>

<pre class="example" id="org8977a2f">
{
    "Version": "1",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": "oss:*",
            "Resource": [
                "acs:oss:*:*:myphotos",
                "acs:oss:*:*:myphotos/*"
            ]
        }
    ]
}
</pre>


<p>
2.授权 RAM 用户列出并读取一个 Bucket 中的资源。
</p>

<pre class="example" id="orgbb7b543">
{
    "Version": "1",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": ["oss:ListObjects","oss:GetObject"],
            "Resource": [
                "acs:oss:*:*:myphotos",
                "acs:oss:*:*:myphotos/*"
                ]
        }
    ]
}
</pre>

<p>
某公司
</p>

<pre class="example" id="orga52d816">
{
    "Version": "1",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "oss:ListParts",
                "oss:AbortMultipartUpload",
                "oss:PutObject",
                "oss:GetObject",
                "oss:listObjects",
                "oss:GetBucketReferer",
                "oss:SetBucketReferer",
                "oss:DeleteBucket",
                "oss:CreateBucket",
                "oss:GetBucketAcl"
            ],
            "Resource": [
                "acs:oss:*:*:xjp-tope365-app",
                "acs:oss:*:*:xjp-tope365-app/*"
            ]
        }
    ]
}
</pre>


<p>
1.只访问和编写bucket ： mfs-source 中的单个目录
    在RAM中配置权限策略
</p>

<pre class="example" id="orgbd5695d">
{
  "Version": "1",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListBuckets"
      ],
      "Resource": [
        "acs:oss:*:*:*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListObjects"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source"
      ],
      "Condition": {
        "StringLike": {
          "oss:Delimiter": "/",
          "oss:Prefix": [
            "",
            "BackendEditor/*"
          ]
        }
      }
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListObjects"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source"
      ],
      "Condition": {
        "StringLike": {
          "oss:Prefix": [
            "BackendEditor/*"
          ]
        }
      }
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:*"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source/BackendEditor/*"
      ]
    }
  ]
}
</pre>

<p>
2.bukect上传查看权限 
</p>

<pre class="example" id="org637af7c">
{
  "Version": "1",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "oss:ListBuckets",
        "oss:GetBucketAcl"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source",
        "acs:oss:*:*:mfs-source/*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "oss:Get*",
        "oss:Put*"
      ],
      "Resource": [
        "acs:oss:*:*:mfs-source",
        "acs:oss:*:*:mfs-source/*"
      ]
    }
  ]
}
</pre>
</div>
</div>
<div id="outline-container-h:42014010-683b-49ea-8871-6651ed9114d4" class="outline-3">
<h3 id="h:42014010-683b-49ea-8871-6651ed9114d4">RAM-RDS</h3>
<div class="outline-text-3" id="text-h:42014010-683b-49ea-8871-6651ed9114d4">
<p>
数据库审计权限
</p>

<pre class="example" id="org8f654d1">
{
  "Statement": [
    {
      "Action": "rds:DescribeSQLLogRecords",
      "Effect": "Allow",
      "Resource": "acs:rds:*:*:dbinstance/rdsjmlwvi81yzyaypa1gb"
    },
    {
      "Action": "rds:DescribeSQLLogRecords",
      "Effect": "Allow",
      "Resource": "*"
    }
  ],
  "Version": "1"
}
</pre>


<p>
数据库权限
</p>

<pre class="example" id="orgcb1b442">
{
  "Version": "1",
  "Statement": [
    {
      "Action": "rds:*",
      "Resource": "acs:rds:*:*:*",
      "Effect": "Allow"
    },
    {
      "Action": "dms:LoginDatabase",
      "Resource": "acs:rds:*:*:dbinstance/rm-bp1o4v71t63p433f2",
      "Effect": "Allow"
    }
  ]
}
</pre>



<p>
<b>RDS单实例授权</b>
</p>

<p>
RDS单实例授权(标签方式)
</p>

<p>
<a href="https://help.aliyun.com/document_detail/95252.html?spm=5176.11065259.1996646101.searchclickresult.ce1b473f50Zjxi">https://help.aliyun.com/document_detail/95252.html?spm=5176.11065259.1996646101.searchclickresult.ce1b473f50Zjxi</a>
</p>

<p>
```bash
</p>
<pre class="example" id="org228c691">
{
  "Statement": [
    {
      "Action": "rds:*",
      "Effect": "Allow",
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "rds:ResourceTag/k": "haibao"
        }
      }
    },
    {
      "Action": "rds:DescribeTag*",
      "Effect": "Allow",
      "Resource": "*"
    },
    {
      "Action": "dms:LoginDatabase",
      "Resource": "acs:rds:*:*:dbinstance/rm-rm-hp31i9h07g1ay3r7s",
      "Effect": "Allow"
    }
  ],
  "Version": "1"
}
</pre>

<p>
以下能看到所有的RDS，但只能操作自己权限的RDS
</p>

<p>
<a href="https://help.aliyun.com/knowledge_detail/58932.html?spm=a2c4g.11186623.6.708.5b0966edJGHwuv">https://help.aliyun.com/knowledge_detail/58932.html?spm=a2c4g.11186623.6.708.5b0966edJGHwuv</a>
</p>

<p>
说明 授予该策略的RAM用户是可以列出所有的RDS实例，但只能操作（比如DeleteDBInstance操作）其中的两台。目前，不支持RAM用户仅仅查看自己有访问权限的RDS实例。
</p>

<p>
RAM访问控制中设置组管理员
</p>

<p>
RAM权限概述:<a href="https://help.aliyun.com/document_detail/102666.html?spm=a2c4g.11186623.6.730.67e736a9bjc2CK">https://help.aliyun.com/document_detail/102666.html?spm=a2c4g.11186623.6.730.67e736a9bjc2CK</a>
</p>

<pre class="example" id="org67a8f3a">
{
    "Version": "1",
    "Statement": [
        {
            "Action": [
                "ram:Get*",
                "ram:List*",
                "ram:GenerateCredentialReport"
            ],
            "Resource": "*",
            "Effect": "Allow"
        },
        {
            "Action": [
                "ram:AddUserToGroup",
                "ram:RemoveUserFromGroup",
                "ram:ListUsersForGroup",
                "ram:UpdateGroup",
                "ram:ListGroupsForUser"
            ],
            "Resource": [
                "acs:ram:*:*:group/sa-test",
                "acs:ram:*:*:user/*"
            ],
            "Effect": "Allow"
        }
    ]
}
</pre>

<p>
注意：user后加*，表示要加哪些人到组内。
</p>



<p>
权限记录
</p>

<p>
Aliyun-denyDeleteAccess
</p>

<pre class="example" id="org3664b01">
{
    "Version": "1",
    "Statement": [
        {
            "Effect": "Deny",
            "Action": [
                "ecs:Delete*",
                "ecs:ModifyInstanceAutoReleaseTime",
                "slb:DeleteLoadBalancer",
                "vpc:DeleteVpc",
                "vpc:DeleteVSwitch",
                "vpc:DeleteRouteEntry",
                "vpc:DeleteRouteTable",
                "vpc:ReleaseEipAddress",
                "vpc:DeletePhysicalConnection",
                "vpc:DeleteRouterInterface",
                "vpc:DeleteVirtualBorderRouter",
                "vpc:DeleteBgpGroup",
                "vpc:DeleteBgpPeer",
                "vpc:DeleteNatGateway",
                "vpc:RemoveBandwidthPackageIps",
                "vpc:DeleteBandwidthPackage",
                "vpc:DeleteVpnGateway",
                "vpc:DeleteCustomerGateway",
                "vpc:DeleteVpnConnection",
                "rds:DeleteDBInstance",
                "rds:DeleteDatabase",
                "kvstore:DeleteInstance",
                "oss:DeleteBucket",
                "oss:DeleteBucketEncryption",
                "oss:DeleteObject",
                "oss:DeleteMultipleObjects",
                "cdn:DeleteCdnDomain",
                "ram:CreateAccessKey",
                "ram:DeleteAccessKey",
                "ram:DeleteVirtualMFADevice",
                "ram:DeleteUser",
                "ram:DeleteGroup",
                "ram:DeleteRole",
                "ram:DeletePolicy",
                "ram:CreatePolicyVersion",
                "ram:DeletePolicyVersion",
                "ram:SetDefaultPolicyVersion"
            ],
            "Resource": "*"
        },
        {
            "Effect": "Deny",
            "Action": [
                "ram:AttachPolicyToUser",
                "ram:AttachPolicyToGroup",
                "ram:AttachPolicyToRole"
            ],
            "Resource": [
                "acs:ram:*:*:*"
            ]
        },
        {
            "Effect": "Deny",
            "Action": [
                "ram:DetachPolicyFromUser",
                "ram:DetachPolicyFromGroup",
                "ram:DetachPolicyFromRole"
            ],
            "Resource": [
                "acs:ram:*:*:*"
            ]
        }
    ]
}
</pre>

<p>
组权限中。只要full权限在，deny就失效了
</p>



<p>
aliyunRAM-SAadmin
</p>

<pre class="example" id="org558bfb1">
{
    "Version": "1",
    "Statement": [
        {
            "Action": [
                "ram:Create*",
                "ram:Get*",
                "ram:List*",
                "ram:GenerateCredentialReport"
            ],
            "Resource": "*",
            "Effect": "Allow"
        },
        {
            "Action": [
                "ram:AddUserToGroup",
                "ram:RemoveUserFromGroup",
                "ram:ListUsersForGroup",
                "ram:UpdateGroup",
                "ram:ListGroupsForUser"
            ],
            "Resource": [
                "acs:ram:*:*:group/*",
                "acs:ram:*:*:user/*"
            ],
            "Effect": "Allow"
        },
        {
            "Action": [
                "ram:AddUserToGroup",
                "ram:RemoveUserFromGroup",
                "ram:ListUsersForGroup",
                "ram:UpdateGroup",
                "ram:ListGroupsForUser"
            ],
            "Resource": [
                "acs:ram:*:*:group/dba"
            ],
            "Effect": "Deny"
        }
    ]
}
</pre>


<figure id="orge801f04">
<img src="./images/image-20210315170220943.png" alt="image-20210315170220943.png">

</figure>


<figure id="orgcf0e80c">
<img src="./images/image-20210315170238892.png" alt="image-20210315170238892.png">

</figure>


<figure id="orgdfe8799">
<img src="./images/image-20210315170301260.png" alt="image-20210315170301260.png">

</figure>


<figure id="org8159efd">
<img src="./images/image-20210315170313702.png" alt="image-20210315170313702.png">

</figure>
</div>
</div>
<div id="outline-container-h:dd0f97f3-ca45-4e79-b99a-a04399d6dd99" class="outline-3">
<h3 id="h:dd0f97f3-ca45-4e79-b99a-a04399d6dd99">RAM-CDN</h3>
<div class="outline-text-3" id="text-h:dd0f97f3-ca45-4e79-b99a-a04399d6dd99">
<p>
范例：刷新cdn，白名单ip有操作权限
</p>

<pre class="example" id="orgf0f3c1f">
{
    "Version": "1",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "cdn:PushObjectCache",
                "cdn:RefreshObjectCaches"
            ],
            "Resource": "acs:cdn:*:*:*",
            "Condition": {
                "IpAddress": {
                    "acs:SourceIp": [
                        "211.103.135.96/29",
                        "123.57.87.183",
                        "47.241.25.157",
                        "39.107.102.36"
                    ]
                }
            }
        }
    ]
}
</pre>
</div>
</div>
<div id="outline-container-h:e0f691e7-c5f4-47e7-adf6-c6712a86819b" class="outline-3">
<h3 id="h:e0f691e7-c5f4-47e7-adf6-c6712a86819b">RAM-STS</h3>
<div class="outline-text-3" id="text-h:e0f691e7-c5f4-47e7-adf6-c6712a86819b">
<p>
临时授权
</p>

<p>
1.ram中创建sts接口调用账号
</p>

<p>
2.创建自定义授权策略
</p>

<p>
创建权限策略oss-access
</p>

<pre class="example" id="orgba2114f">
{
    "Version": "1",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "oss:ListParts",
                "oss:AbortMultipartUpload",
                "oss:PutObject",
                "oss:GetObject",
                "oss:listObjects",
                "oss:GetBucketReferer",
                "oss:SetBucketReferer",
                "oss:GetBucketAcl"
            ],
            "Resource": [
                "acs:oss:*:*:dev-operation-activity",
                "acs:oss:*:*:dev-operation-activity/*"
            ]
        }
    ]
}
</pre>

<p>
3.创建RAM角色并关联权限策略
</p>

<p>
创建RAM角色abc-sts添加权限oss-access，记住ARN信息。
</p>

<p>
4.账号授权
</p>

<p>
添加sts调用权限和oss-access权限
</p>

<p>
5.接口调用
</p>

<p>
调用时使用ARN信息
</p>
</div>
</div>
<div id="outline-container-h:5f1deb61-17ce-43ff-ad5b-127909ce9103" class="outline-3">
<h3 id="h:5f1deb61-17ce-43ff-ad5b-127909ce9103">RAM-SLS</h3>
<div class="outline-text-3" id="text-h:5f1deb61-17ce-43ff-ad5b-127909ce9103">
<p>
用户指定logstore, 编辑仪表盘
</p>
<div class="org-src-container">
<pre class="src src-sh">{
  <span style="color: #8b2252;">"Version"</span>: <span style="color: #8b2252;">"1"</span>,
  <span style="color: #8b2252;">"Statement"</span>: [
    {
      <span style="color: #8b2252;">"Action"</span>: <span style="color: #8b2252;">"log:ListProject"</span>,
      <span style="color: #8b2252;">"Resource"</span>: <span style="color: #8b2252;">"acs:log:*:*:project/*"</span>,
      <span style="color: #8b2252;">"Effect"</span>: <span style="color: #8b2252;">"Allow"</span>
    },
    {
      <span style="color: #8b2252;">"Effect"</span>: <span style="color: #8b2252;">"Allow"</span>,
      <span style="color: #8b2252;">"Action"</span>: <span style="color: #8b2252;">"log:List*"</span>,
      <span style="color: #8b2252;">"Resource"</span>: [
        <span style="color: #8b2252;">"acs:log:cn-beijing:&lt;accountID&gt;:project/&lt;&#25351;&#23450;&#30340;Project&#21517;&#31216;&gt;/*"</span>,
        <span style="color: #8b2252;">"acs:log:cn-beijing:&lt;accountID&gt;:project/&lt;&#25351;&#23450;&#30340;Project&#21517;&#31216;2&gt;/*"</span>
      ]
    },
    {
      <span style="color: #8b2252;">"Effect"</span>: <span style="color: #8b2252;">"Allow"</span>,
      <span style="color: #8b2252;">"Action"</span>: <span style="color: #8b2252;">"log:Get*"</span>,
      <span style="color: #8b2252;">"Resource"</span>: [
        <span style="color: #8b2252;">"acs:log:cn-beijing:&lt;accountID&gt;:project/&lt;&#25351;&#23450;&#30340;Project&#21517;&#31216;&gt;/logstore/&lt;&#25351;&#23450;&#30340;Logstore&#21517;&#31216;&gt;"</span>,
        <span style="color: #8b2252;">"acs:log:cn-beijing:&lt;accountID&gt;:project/&lt;&#25351;&#23450;&#30340;Project&#21517;&#31216;2&gt;/logstore&lt;&#25351;&#23450;&#30340;Logstore&#21517;&#31216;2&gt;"</span>
      ]
    },
    {
      <span style="color: #8b2252;">"Effect"</span>: <span style="color: #8b2252;">"Allow"</span>,
      <span style="color: #8b2252;">"Action"</span>: <span style="color: #8b2252;">"log:*"</span>,
      <span style="color: #8b2252;">"Resource"</span>: [
        <span style="color: #8b2252;">"acs:log:cn-beijing:&lt;accountID&gt;:project/&lt;&#25351;&#23450;&#30340;Project&#21517;&#31216;&gt;/dashboard/*"</span>,
        <span style="color: #8b2252;">"acs:log:cn-beijing:&lt;accountID&gt;:project/&lt;&#25351;&#23450;&#30340;Project&#21517;&#31216;2&gt;/dashboard/*"</span>
      ]
    }
  ]
}
</pre>
</div>
</div>
</div>
<div id="outline-container-h:85020ccf-82cf-449c-9a0d-5adc7390072a" class="outline-3">
<h3 id="h:85020ccf-82cf-449c-9a0d-5adc7390072a">RAM-自定义-certd</h3>
<div class="outline-text-3" id="text-h:85020ccf-82cf-449c-9a0d-5adc7390072a">
<p>
<a href="https://github.com/certd/certd">certd</a>是开源的证书管理平台。对所在机器做名名单
</p>

<div class="org-src-container">
<pre class="src src-sh">{
  <span style="color: #8b2252;">"Version"</span>: <span style="color: #8b2252;">"1"</span>,
  <span style="color: #8b2252;">"Statement"</span>: [
    {
      <span style="color: #8b2252;">"Effect"</span>: <span style="color: #8b2252;">"Allow"</span>,
      <span style="color: #8b2252;">"Action"</span>: [
        <span style="color: #8b2252;">"slb:Describe*"</span>,
        <span style="color: #8b2252;">"slb:SetCACertificateName"</span>,
        <span style="color: #8b2252;">"slb:SetDomainExtensionAttribute"</span>,
        <span style="color: #8b2252;">"slb:SetServerCertificateName"</span>,
        <span style="color: #8b2252;">"slb:UploadCACertificate"</span>,
        <span style="color: #8b2252;">"slb:UploadServerCertificate"</span>,
        <span style="color: #8b2252;">"slb:DeleteCACertificate"</span>,
        <span style="color: #8b2252;">"slb:SetLoadBalancerHTTPSListenerAttribute"</span>
      ],
      <span style="color: #8b2252;">"Resource"</span>: <span style="color: #8b2252;">"*"</span>,
      <span style="color: #8b2252;">"Condition"</span>: {
        <span style="color: #8b2252;">"IpAddress"</span>: {
          <span style="color: #8b2252;">"acs:SourceIp"</span>: [
            <span style="color: #8b2252;">"&#26426;&#22120;&#20869;&#32593;IP"</span>
          ]
        }
      }
    },
    {
      <span style="color: #8b2252;">"Effect"</span>: <span style="color: #8b2252;">"Allow"</span>,
      <span style="color: #8b2252;">"Action"</span>: [
        <span style="color: #8b2252;">"yundun-cert:Describe*"</span>,
        <span style="color: #8b2252;">"yundun-cert:Get*"</span>,
        <span style="color: #8b2252;">"yundun-cert:List*"</span>,
        <span style="color: #8b2252;">"yundun-cert:UploadUserCertificate"</span>,
        <span style="color: #8b2252;">"yundun-cert:UploadCertificate"</span>
      ],
      <span style="color: #8b2252;">"Resource"</span>: <span style="color: #8b2252;">"*"</span>,
      <span style="color: #8b2252;">"Condition"</span>: {
        <span style="color: #8b2252;">"IpAddress"</span>: {
          <span style="color: #8b2252;">"acs:SourceIp"</span>: [
            <span style="color: #8b2252;">"&#26426;&#22120;&#20844;&#32593;&#20986;&#21475;IP"</span>
          ]
        }
      }
    },
    {
      <span style="color: #8b2252;">"Effect"</span>: <span style="color: #8b2252;">"Allow"</span>,
      <span style="color: #8b2252;">"Action"</span>: [
        <span style="color: #8b2252;">"alb:ListLoadBalancers"</span>,
        <span style="color: #8b2252;">"alb:ListListeners"</span>,
        <span style="color: #8b2252;">"alb:ListListenerCertificates"</span>,
        <span style="color: #8b2252;">"alb:AssociateAdditionalCertificatesWithListener"</span>,
        <span style="color: #8b2252;">"alb:DissociateAdditionalCertificatesFromListener"</span>,
        <span style="color: #8b2252;">"alb:UpdateListenerAttribute"</span>
      ],
      <span style="color: #8b2252;">"Resource"</span>: <span style="color: #8b2252;">"*"</span>,
      <span style="color: #8b2252;">"Condition"</span>: {
        <span style="color: #8b2252;">"IpAddress"</span>: {
          <span style="color: #8b2252;">"acs:SourceIp"</span>: [
            <span style="color: #8b2252;">"&#26426;&#22120;&#20844;&#32593;&#20986;&#21475;IP"</span>
          ]
        }
      }
    }
  ]
}
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:eddc6945-5566-41f2-8d98-f62780b32b74" class="outline-2">
<h2 id="h:eddc6945-5566-41f2-8d98-f62780b32b74">SLS日志</h2>
<div class="outline-text-2" id="text-h:eddc6945-5566-41f2-8d98-f62780b32b74">
</div>
<div id="outline-container-h:e8f745f9-ebc6-4c54-bafe-ed8881b9d210" class="outline-3">
<h3 id="h:e8f745f9-ebc6-4c54-bafe-ed8881b9d210">查询SQL</h3>
<div class="outline-text-3" id="text-h:e8f745f9-ebc6-4c54-bafe-ed8881b9d210">
<p>
范例：报错统计
</p>

<pre class="example" id="org156d38a">
{"status":"200","header":"{\"x-forwarded-scheme\":\"http\"}","body":"{\"errorType\":1}","__time__":"1740581992"}
</pre>

<div class="org-src-container">
<pre class="src src-sh">body.errorType: * and not (body.message: <span style="color: #8b2252;">'4001'</span> or body.sub1:<span style="color: #8b2252;">'4001'</span>)  | SELECT
  <span style="color: #8b2252;">"body.errorType"</span> AS <span style="color: #8b2252;">"errorType"</span>,
  COUNT(*) AS cnt,(
    CASE
      WHEN <span style="color: #8b2252;">"body.errorType"</span> = 1 THEN <span style="color: #8b2252;">'&#24402;&#22240;&#20449;&#24687;&#19978;&#25253;'</span>
      WHEN <span style="color: #8b2252;">"body.errorType"</span> = 2 THEN <span style="color: #8b2252;">'&#25773;&#25918;&#22120;&#25253;&#38169;'</span>
      WHEN <span style="color: #8b2252;">"body.errorType"</span> = 4 THEN <span style="color: #8b2252;">'&#23433;&#21331;-&#35895;&#27468;&#25903;&#20184;&#24322;&#24120;'</span>
      WHEN <span style="color: #8b2252;">"body.errorType"</span> = 5 THEN <span style="color: #8b2252;">'IOS-&#33529;&#26524;&#25903;&#20184;&#24322;&#24120;'</span>
      WHEN <span style="color: #8b2252;">"body.errorType"</span> = 11 THEN <span style="color: #8b2252;">'&#30331;&#24405;&#25509;&#21475;&#25253;&#38169;'</span>
      WHEN <span style="color: #8b2252;">"body.errorType"</span> = 13 THEN <span style="color: #8b2252;">'&#23458;&#25143;&#31471;&#23849;&#28291;'</span>
      WHEN <span style="color: #8b2252;">"body.errorType"</span> = 14 THEN <span style="color: #8b2252;">'&#24191;&#21578;&#21152;&#36733;/&#25773;&#25918;&#22833;&#36133;'</span>
      ELSE <span style="color: #8b2252;">'&#26410;&#30693;&#24322;&#24120;&#65292;&#35831;&#25490;&#26597;'</span>
    END
  ) AS <span style="color: #8b2252;">"errorDesc"</span>
FROM  <span style="color: #8b2252;">"error-push"</span>
GROUP BY
  <span style="color: #8b2252;">"errorType"</span>
order by
  cnt
</pre>
</div>

<p>
范例：按天统计
</p>
<div class="org-src-container">
<pre class="src src-sh">(* and body.errorType:2 and body.errorInfo : <span style="color: #8b2252;">"\"errMsg\":\"&#20986;&#38382;&#39064;&#21862;\""</span>)| SELECT date_trunc(<span style="color: #8b2252;">'day'</span>, from_unixtime(__time__)) AS t, COUNT(*) AS count FROM log GROUP BY t ORDER BY t ASC
</pre>
</div>
</div>
</div>
<div id="outline-container-h:7efbf2f1-7607-4e3f-a736-e93fb447efef" class="outline-3">
<h3 id="h:7efbf2f1-7607-4e3f-a736-e93fb447efef">数据加工</h3>
<div class="outline-text-3" id="text-h:7efbf2f1-7607-4e3f-a736-e93fb447efef">
<p>
SPL语法：<a href="https://help.aliyun.com/zh/sls/user-guide/spl-overview/">https://help.aliyun.com/zh/sls/user-guide/spl-overview/</a>
</p>

<p>
原始日志
</p>
<pre class="example" id="org714409b">
{"status":"200","header":"{\"client-id\":\"746\"}","body":"{\"errorType\":2,\"errorInfo\":{\"error\":\"{\\\"errMsg\\\":\\\"MEDIA_ERR_NETWORK(-11101,11022102)\\\"}\"}}","__time__":"1740582886"}
{"status":"200","header":"{\"client-id\":\"42\"}","body":"{\"errorType\":2,\"errorInfo\":{\"errMsg\":\"FFmpegDemuxer: open context failed\",\"errNo\":10401}}","__time__":"1740582870"}
</pre>

<div class="org-src-container">
<pre class="src src-sh">*
|extend <span style="color: #a0522d;">errorType</span>=json_extract(body, <span style="color: #8b2252;">'$.errorType'</span>)
-- |where json_format(errorType) !=<span style="color: #8b2252;">'2'</span>
|extend <span style="color: #8b2252;">"client-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.client-id'</span>)
|extend <span style="color: #8b2252;">"user-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.user-id'</span>)
|extend <span style="color: #8b2252;">"sub-user-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.sub-user-id'</span>)
|extend <span style="color: #8b2252;">"product-user-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.product-user-id'</span>)
|extend <span style="color: #8b2252;">"app-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.app-id'</span>)
|extend <span style="color: #8b2252;">"batch-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.batch-id'</span>)
|extend <span style="color: #8b2252;">"spread-channel-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.spread-channel-id'</span>)
|extend <span style="color: #8b2252;">"compilations-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.compilations-id'</span>)
|extend <span style="color: #8b2252;">"chain-id"</span>=json_extract(header, <span style="color: #8b2252;">'$.chain-id'</span>)
-- &#26102;&#38388;time
|extend <span style="color: #a0522d;">ts</span>=cast(__time__ as INTEGER) |extend <span style="color: #a0522d;">time</span>=date_format(ts+28800, <span style="color: #8b2252;">'%Y-%m-%d %H:%i'</span>)
-- errorDetail : &#26377;errorInfo&#30340;&#30452;&#25509;&#20351;&#29992;,    &#26377;videoUrl &#30452;&#25509;&#36171;&#20540;
|extend <span style="color: #a0522d;">errorDetail1</span>=json_extract(body, <span style="color: #8b2252;">'$.errorInfo'</span>) |extend <span style="color: #a0522d;">errorDetail1</span>=COALESCE(json_format(errorDetail1), <span style="color: #8b2252;">''</span>) 
|extend <span style="color: #a0522d;">errorDetail2</span>=json_extract(body, <span style="color: #8b2252;">'$.videoUrl'</span>) |extend <span style="color: #a0522d;">errorDetail2</span>=COALESCE(json_format(errorDetail2), <span style="color: #8b2252;">''</span>)
|extend <span style="color: #a0522d;">errorDetail</span>=concat(errorDetail1, <span style="color: #8b2252;">''</span>, errorDetail2) 
-- errorTag:  &#26377;errMsg&#30452;&#25509;&#20351;&#29992; , &#26377;errorInfo&#30340;, &#21462;&#20854;&#20013;&#30340; errMsg
|extend <span style="color: #a0522d;">errorTag1</span>=json_extract(body, <span style="color: #8b2252;">'$.errMsg'</span>) |extend <span style="color: #a0522d;">errorTag1</span>=COALESCE(json_format(errorTag1), <span style="color: #8b2252;">''</span>) 
-- |extend <span style="color: #a0522d;">errorTag2</span>=json_extract(body, <span style="color: #8b2252;">'$.errorInfo'</span>) |extend <span style="color: #a0522d;">errorTag2</span>=COALESCE(json_format(errorTag2), <span style="color: #8b2252;">''</span>) 
|extend <span style="color: #a0522d;">t2</span>=json_format(json_extract(body, <span style="color: #8b2252;">'$.errorInfo'</span>)) 
| extend <span style="color: #a0522d;">errorTag2</span>=regexp_extract(t2, <span style="color: #8b2252;">'\"errMsg\\":\\"(.+?)\\"'</span>, 1)  |extend <span style="color: #a0522d;">errorTag2</span>=COALESCE(errorTag2, <span style="color: #8b2252;">''</span>) 
| extend <span style="color: #a0522d;">errorTag3</span>=regexp_extract(t2, <span style="color: #8b2252;">'errMsg":"(.+?)"'</span>, 1)  |extend <span style="color: #a0522d;">errorTag3</span>=COALESCE(errorTag3, <span style="color: #8b2252;">''</span>) 
--|extend <span style="color: #a0522d;">errorTag_2</span>=regexp_extract(body, <span style="color: #8b2252;">'\\"errMsg\\":\\"(.+?)\\"'</span>,1)
|extend <span style="color: #a0522d;">errorTag</span>=concat(errorTag1, <span style="color: #8b2252;">''</span>, errorTag2, errorTag3) 
-- errorNo:  &#21462;errorInfo&#37324;&#30340;errNo. &#27809;&#26377;&#30340;&#35805;&#33258;&#24049;&#33258;&#24049;&#39030;&#19968;&#20010;&#19968;&#20010;3&#20301;&#25968;&#23383;
|extend <span style="color: #a0522d;">errorNo1</span>=regexp_extract(t2, <span style="color: #8b2252;">'\"errNo\\":\\"(.+?)\\"'</span>, 1)  |extend <span style="color: #a0522d;">errorNo1</span>=COALESCE(errorNo1, <span style="color: #8b2252;">''</span>) 
|extend <span style="color: #a0522d;">errorNo2</span>=regexp_extract(t2, <span style="color: #8b2252;">'errNo":(\d+)'</span>, 1)  |extend <span style="color: #a0522d;">errorNo2</span>=COALESCE(errorNo2, <span style="color: #8b2252;">''</span>) 
|extend <span style="color: #a0522d;">errorNo3</span>=concat(errorNo1, <span style="color: #8b2252;">''</span>, errorNo2) | parse-regexp errorNo3, <span style="color: #8b2252;">'(\S+)'</span> as errorNo | extend <span style="color: #a0522d;">errorNo</span>=COALESCE(errorNo, <span style="color: #8b2252;">'999'</span>)
|project errorType, errorTag, errorNo, errorDetail, <span style="color: #8b2252;">"client-id"</span>, <span style="color: #8b2252;">"user-id"</span>, <span style="color: #8b2252;">"sub-user-id"</span>, <span style="color: #8b2252;">"product-user-id"</span>, <span style="color: #8b2252;">"app-id"</span>, <span style="color: #8b2252;">"batch-id"</span>, <span style="color: #8b2252;">"spread-channel-id"</span>, <span style="color: #8b2252;">"compilations-id"</span>, <span style="color: #8b2252;">"chain-id"</span>, time;
</pre>
</div>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>打赏</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>© 2025 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
<!--
<script type="text/javascript" src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/bootstrap@5.2.1/dist/js/bootstrap.min.js"></script>
<div id="back-to-top" class=""><svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg></div>
-->
</div>
</body>
</html>
