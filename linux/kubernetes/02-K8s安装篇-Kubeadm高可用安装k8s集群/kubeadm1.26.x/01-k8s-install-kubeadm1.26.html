<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kubernetes: k8s-å®‰è£…ç¯‡-kueadm-1.26</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/font.css"/>
<link rel="stylesheet" type="text/css" href="/static/drollery.e825b870.css"/>
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
</head>
<body>
<header id="preamble" class="status">
<header class="{className}" data-astro-cid-3ef6ksr2>
  <div class=header-branding data-astro-cid-g2lrb5xm>
      <span class=header-text data-astro-cid-g2lrb5xm>
          <span class=dropcap data-astro-cid-g2lrb5xm aria-hidden=true>
              <span class=actual data-astro-cid-g2lrb5xm>J</span>
              <span class=rest data-astro-cid-g2lrb5xm>asper Hsu</span>
              <span class=period data-astro-cid-g2lrb5xm>.</span>
          </span>
          <span class=sr-only data-astro-cid-g2lrb5xm>Drollery</span>
      </span>
      <img alt="Medieval drollery of a knight on a horse" class=spring decoding=async height=250 loading=lazy src=/images/knight-horse.a96eee7d_Z1WCOYs.webp width=68 data-astro-cid-g2lrb5xm>
  </div>

  <nav data-astro-cid-pux6a34n>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/jcodelog.html class=nobracket data-astro-cid-pux6a34n>æŠ€æœ¯</a>
      <span class=flower2 data-astro-cid-pux6a34n>K</span>
      <a href=/reading/index.html class=nobracket data-astro-cid-pux6a34n>é˜…è¯»</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
      <a href=/archives.html class=nobracket data-astro-cid-pux6a34n>å½’æ¡£</a>
      <span class=flower2 data-astro-cid-pux6a34n>L</span>
      <a href=/link/index.html class=nobracket data-astro-cid-pux6a34n>å‹é“¾</a>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/about.html class=nobracket data-astro-cid-pux6a34n>å…³äº</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
  </nav>


  <div class="container" data-astro-cid-3ef6ksr2>
    <p class="info" data-astro-cid-3ef6ksr2>
              ğŸ† æ¬¢è¿æ¥åˆ°æœ¬ç«™ï¼š
              <a href="https://xuchangwei.com/">https://xuchangwei.com/</a>ã€‚
              <strong>å¸Œæœ›è¿™é‡Œæœ‰ä½ æ„Ÿå…´è¶£çš„å†…å®¹</strong>ã€‚
            </p>
  </div>
  <div id=borderArtWrapper class="tt1" data-astro-cid-5hce7sga data-turbo-permanent>
      <script>
          var man, shakeCount = 0, noSound = new Audio("/audio/effects/no.m4a"), screamSound = new Audio("/audio/effects/scream.m4a");
          function animateManShakeHandler() {
              man.removeEventListener("animationend", animateManShakeHandler, !1),
              shakeCount += 1,
              man.classList.remove("shakeMan")
          }
          function animateManFallHandler() {
              man.removeEventListener("animationend", animateManFallHandler, !1),
              man.classList.add("hide")
          }
          function animateMan() {
              man = man ?? document.getElementById("borderMan"),
              3 === shakeCount ? (man.classList.add("fallMan"),
              screamSound.play(),
              man.addEventListener("animationend", animateManFallHandler, !1)) : (man.classList.add("shakeMan"),
              noSound.play(),
              man.addEventListener("animationend", animateManShakeHandler, !1))
          }
      </script>
      <div class=borderArt data-astro-cid-5dda5nwp id=articleBorder>
          <img alt="flowery border with man falling" decoding=async height=620 loading=lazy src=/images/border-vines-no-man.b7d246cc_DRxSe.webp width=909 class=border data-astro-cid-5dda5nwp>
          <div class=fallWrapper data-astro-cid-5dda5nwp>
              <img alt="flowery border with man falling" decoding=async height=292 loading=lazy src=/images/man-no-vines.247a3187_Z2ioXNM.webp width=98 class=man data-astro-cid-5dda5nwp id=borderMan onclick=animateMan()>
          </div>
      </div>
  </div>
</header>
</header>
<main class="container" id="content" class="content">
<header>
<h1 class="title">Kubernetes: k8s-å®‰è£…ç¯‡-kueadm-1.26</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:547b4f5c-fd62-4a1f-93f2-c0bdc13fc269">å®‰è£…å‰å¿…è¯»</a>
<ul>
<li><a href="#h:bade6137-ef1d-412d-b3aa-b3ca2b7e5fc9">ç½‘æ®µåˆ’åˆ†</a></li>
</ul>
</li>
<li><a href="#h:d2964f65-72be-4c3b-b564-125cf6e22dca">å®‰è£…åŠä¼˜åŒ–éƒ¨åˆ†</a>
<ul>
<li><a href="#h:e1965fe3-a78b-432a-a0c3-207c439d8f85">é«˜å¯ç”¨Kubernetesé›†ç¾¤è§„åˆ’</a></li>
<li><a href="#h:6dbc4586-2e2e-43c6-b676-75c316a1b351">åŸºæœ¬ç¯å¢ƒé…ç½®</a></li>
<li><a href="#h:c76c5e5a-b226-4262-a02a-1c57589a8a5b">å†…æ ¸å‡çº§</a></li>
<li><a href="#h:e6df0c63-f665-4b6a-a49c-61b4073f5dc9">k8s ç»„ä»¶å’Œ runtime å®‰è£…</a>
<ul>
<li><a href="#h:d71f041f-250b-4459-9f08-132c40505a98">Containerd ä½œä¸º Runtime</a></li>
<li><a href="#h:6fb0bd42-6b14-4a3a-9e57-c6570a0c6a6e">Docker ä½œä¸º Runtime ï¼ˆç‰ˆæœ¬å°äº 1.24ï¼‰</a></li>
<li><a href="#h:31474281-9c84-4e14-99a6-c1f2bd741f6a">å®‰è£…k8sç»„ä»¶</a></li>
</ul>
</li>
<li><a href="#h:30640a70-34c2-4e49-bc60-7ab000e509b7">é«˜å¯ç”¨ç»„ä»¶å®‰è£…</a></li>
</ul>
</li>
<li><a href="#h:ec12062f-68eb-4b04-8833-2edd72d936b5">é›†ç¾¤å»ºç«‹éƒ¨åˆ†</a>
<ul>
<li><a href="#h:05ce7887-a24c-47db-a03b-6944fe20dfa5">é›†ç¾¤åˆå§‹åŒ–</a>
<ul>
<li><a href="#h:4e2afd45-6d9c-49e1-ab7f-170ffc410611">kubeadm å‘½ä»¤ä½¿ç”¨</a></li>
<li><a href="#h:8459c629-b142-43a1-9db8-fb123646c0c7">kubeadm init å‘½ä»¤ç®€ä»‹</a></li>
<li><a href="#h:10a34219-ecbf-4307-9819-3197cd660ea6">é«˜å¯ç”¨ master åˆå§‹åŒ–</a></li>
</ul>
</li>
<li><a href="#h:3e5773ea-b8d7-45a0-8596-2cd2f595158b">é«˜å¯ç”¨Master</a>
<ul>
<li><a href="#h:7711fe4b-3916-43e2-aaf3-0018d9a71bf5">token è¿‡æœŸå¤„ç†</a></li>
</ul>
</li>
<li><a href="#h:7e6ce312-429c-4991-820e-37ed40f5b234">æ·»åŠ NodeèŠ‚ç‚¹</a>
<ul>
<li><a href="#h:fad58a69-70dd-43bc-9654-741226b45332">k8s å®‰è£…å¤±è´¥æ•…éšœæ’æŸ¥</a></li>
</ul>
</li>
<li><a href="#h:defb103a-7c80-46e6-b274-872135fe041d">å®‰è£…ç½‘ç»œæ’ä»¶</a>
<ul>
<li><a href="#h:dbe105b9-d0a2-4c28-8b1b-3b47c0edb386">Flannel</a></li>
<li><a href="#h:c5be9576-68b4-497f-8522-b8200fcfca1b">Calicoå®‰è£…</a></li>
<li><a href="#h:5391ef18-5eb2-4a24-81d7-4f5eeed16b90">weave</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:d3df78dc-ede4-4033-8410-8b755a08e493">Addons å®‰è£…</a>
<ul>
<li><a href="#h:6a7f1118-dfdd-4ae7-9784-0c28c67ed707">Metrics Serveréƒ¨ç½²</a></li>
<li><a href="#h:dee36232-69a1-4b9d-b257-3ed126c67045">Dashboardéƒ¨ç½²</a>
<ul>
<li><a href="#h:21e82620-2357-4d59-9b45-b29fd0cc3d22">å¼€å¯è‡ªåŠ¨ç”ŸæˆTokenï¼ˆ1.24ç‰ˆæœ¬ä¸Šå¿…åšï¼‰</a></li>
<li><a href="#h:05cb790c-92df-424a-a3bb-aec07f3668ad">å®‰è£…æŒ‡å®šç‰ˆæœ¬ dashboard</a></li>
<li><a href="#h:74e9f102-f096-4362-870b-aebfb272c81b">å®‰è£…æœ€æ–°ç‰ˆ</a></li>
<li><a href="#h:f2f505b0-689f-4bc7-8ac8-47ff0671f247">ç™»å½•dashboard</a></li>
<li><a href="#h:4b3aa559-88a7-41e0-84ca-6e978c07e578">dashboardçš„å¦ä¸€ç§é€‰æ‹©</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:7239c867-fe95-49e4-ad97-78862adb1563">æ”¶å°¾å·¥ä½œ</a>
<ul>
<li><a href="#h:fcda1230-1f4a-46bc-83ed-2da4cf0d1b39">ä¸€äº›å¿…é¡»çš„é…ç½®æ›´æ”¹</a></li>
<li><a href="#h:739033d5-1c6a-4b43-b750-378cb34ae156">æ³¨æ„äº‹é¡¹</a></li>
<li><a href="#h:a4b8287b-e1f0-4a76-8651-121b261a6273">é›†ç¾¤æ£€æµ‹</a></li>
<li><a href="#h:e95f990c-63ec-4d6e-95b7-4025a17487ca">åˆ é™¤é›†ç¾¤</a></li>
<li><a href="#h:a6a25d02-e454-4664-a352-2d4452b0af06">kubeadm è¯ä¹¦æ›´æ–°</a>
<ul>
<li><a href="#h:54aaad72-6794-4141-afda-04d8f36e4f88">æ›´æ–°ä¸€å¹´</a></li>
<li><a href="#h:4d59fc88-cb69-4cb8-b2cc-a523b99051e2">æ›´æ–°ä¸º 99 å¹´</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../../index.html">Kubernetes</a><br></li>
</ul>
<section id="outline-container-h:547b4f5c-fd62-4a1f-93f2-c0bdc13fc269" class="outline-2">
<h2 id="h:547b4f5c-fd62-4a1f-93f2-c0bdc13fc269">å®‰è£…å‰å¿…è¯»</h2>
<div class="outline-text-2" id="text-h:547b4f5c-fd62-4a1f-93f2-c0bdc13fc269">
<p>
è¯·ä¸è¦ä½¿ç”¨å¸¦ä¸­æ–‡çš„æœåŠ¡å™¨å’Œå…‹éš†çš„è™šæ‹Ÿæœº<br>
ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨äºŒè¿›åˆ¶å®‰è£…æ–¹å¼ã€‚<br>
è¯·å°†è¯¥æ–‡æ¡£å¤åˆ¶ä¸€ä»½ï¼Œç„¶åè¿›è¡Œæ›´æ”¹å®‰è£…ã€‚<br>
æ–‡æ¡£ä¸­çš„IPåœ°å€è¯·ç»Ÿä¸€æ›¿æ¢ï¼Œä¸è¦ä¸€ä¸ªä¸€ä¸ªæ›¿æ¢<br>
</p>
</div>
<div id="outline-container-h:bade6137-ef1d-412d-b3aa-b3ca2b7e5fc9" class="outline-3">
<h3 id="h:bade6137-ef1d-412d-b3aa-b3ca2b7e5fc9">ç½‘æ®µåˆ’åˆ†</h3>
<div class="outline-text-3" id="text-h:bade6137-ef1d-412d-b3aa-b3ca2b7e5fc9">
<p>
é›†ç¾¤å®‰è£…æ—¶ä¼šæ¶‰åŠåˆ°ä¸‰ä¸ªç½‘æ®µï¼š<br>
</p>
<ul class="org-ul">
<li>å®¿ä¸»æœºç½‘æ®µï¼šå°±æ˜¯å®‰è£…k8sçš„æœåŠ¡å™¨<br></li>
<li>Podç½‘æ®µï¼šk8s Podçš„ç½‘æ®µï¼Œç›¸å½“äºå®¹å™¨çš„IP<br></li>
<li>Serviceç½‘æ®µï¼šk8s serviceç½‘æ®µï¼Œserviceç”¨äºé›†ç¾¤å®¹å™¨é€šä¿¡ã€‚<br></li>
</ul>

<p>
ä¸€èˆ¬serviceç½‘æ®µä¼šè®¾ç½®ä¸º10.96.0.0/12<br>
Podç½‘æ®µä¼šè®¾ç½®æˆ10.244.0.0/12æˆ–è€…172.16.0.1/12<br>
å®¿ä¸»æœºç½‘æ®µå¯èƒ½æ˜¯192.168.0.0/24<br>
</p>

<p>
éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸‰ä¸ªç½‘æ®µä¸èƒ½æœ‰ä»»ä½•äº¤å‰ã€‚<br>
æ¯”å¦‚å¦‚æœå®¿ä¸»æœºçš„IPæ˜¯10.105.0.x<br>
é‚£ä¹ˆserviceç½‘æ®µå°±ä¸èƒ½æ˜¯10.96.0.0/12ï¼Œå› ä¸º10.96.0.0/12ç½‘æ®µå¯ç”¨IPæ˜¯ï¼š<br>
10.96.0.1 ~ 10.111.255.255<br>
æ‰€ä»¥10.105æ˜¯åœ¨è¿™ä¸ªèŒƒå›´ä¹‹å†…çš„ï¼Œå±äºç½‘ç»œäº¤å‰ï¼Œæ­¤æ—¶serviceç½‘æ®µéœ€è¦æ›´æ¢ï¼Œ<br>
å¯ä»¥æ›´æ”¹ä¸º192.168.0.0/16ç½‘æ®µï¼ˆæ³¨æ„å¦‚æœserviceç½‘æ®µæ˜¯192.168å¼€å¤´çš„å­ç½‘æ©ç æœ€å¥½ä¸è¦æ˜¯12ï¼Œæœ€å¥½ä¸º16ï¼Œå› ä¸ºå­ç½‘æ©ç æ˜¯12ä»–çš„èµ·å§‹IPä¸º192.160.0.1 ä¸æ˜¯192.168.0.1ï¼‰ã€‚<br>
åŒæ ·çš„é“ç†ï¼ŒæŠ€æœ¯åˆ«çš„ç½‘æ®µä¹Ÿä¸èƒ½é‡å¤ã€‚å¯ä»¥é€šè¿‡<a href="http://tools.jb51.net/aideddesign/ip_net_calc/%E8%AE%A1%E7%AE%97">http://tools.jb51.net/aideddesign/ip_net_calc/%E8%AE%A1%E7%AE%97</a>ã€‚<br>
</p>

<p>
æ‰€ä»¥ä¸€èˆ¬çš„æ¨èæ˜¯ï¼Œç›´æ¥ç¬¬ä¸€ä¸ªå¼€å¤´çš„å°±ä¸è¦é‡å¤ï¼Œæ¯”å¦‚ä½ çš„å®¿ä¸»æœºæ˜¯192å¼€å¤´çš„ï¼Œé‚£ä¹ˆä½ çš„serviceå¯ä»¥æ˜¯10.96.0.0/12.<br>
å¦‚æœä½ çš„å®¿ä¸»æœºæ˜¯10å¼€å¤´çš„ï¼Œå°±ç›´æ¥æŠŠserviceçš„ç½‘æ®µæ”¹æˆ192.168.0.0/16<br>
å¦‚æœä½ çš„å®¿ä¸»æœºæ˜¯172å¼€å¤´çš„ï¼Œå°±ç›´æ¥æŠŠpodç½‘æ®µæ”¹æˆ192.168.0.0/12<br>
</p>

<p>
æ³¨æ„æ­é…ï¼Œå‡ä¸º10ç½‘æ®µã€172ç½‘æ®µã€192ç½‘æ®µçš„æ­é…ï¼Œç¬¬ä¸€ä¸ªå¼€å¤´æ•°å­—ä¸ä¸€æ ·å°±å…å»äº†ç½‘æ®µå†²çªçš„å¯èƒ½æ€§ï¼Œä¹Ÿå¯ä»¥å‡å»è®¡ç®—çš„æ­¥éª¤ã€‚<br>
</p>



<p>
å®‰è£…åŠä¼˜åŒ–éƒ¨åˆ†<br>
</p>

<ul class="org-ul">
<li>åŸºæœ¬ç¯å¢ƒé…ç½®åŠä¼˜åŒ–<br></li>
<li>å®‰è£… Runtime<br></li>
<li>Kubeadm &amp; kubelet<br></li>
<li>é«˜å¯ç”¨å®ç°<br></li>
</ul>

<p>
é›†ç¾¤å»ºç«‹éƒ¨åˆ†<br>
</p>

<ul class="org-ul">
<li>Master èŠ‚ç‚¹åˆå§‹åŒ–<br></li>
<li>Node èŠ‚ç‚¹é…ç½®<br></li>
<li>CNI æ’ä»¶å®‰è£…<br></li>
</ul>

<p>
Addons å®‰è£…<br>
</p>

<ul class="org-ul">
<li>Metrics Server<br></li>
<li>Dashboard<br></li>
<li>&#x2026;<br></li>
</ul>

<p>
æ”¶å°¾å·¥ä½œ<br>
</p>

<ul class="org-ul">
<li>é›†ç¾¤å¯ç”¨æ€§éªŒè¯<br></li>
<li>ç”Ÿäº§å¿…å¤‡é…ç½®<br></li>
</ul>
</div>
</div>
</section>
<section id="outline-container-h:d2964f65-72be-4c3b-b564-125cf6e22dca" class="outline-2">
<h2 id="h:d2964f65-72be-4c3b-b564-125cf6e22dca">å®‰è£…åŠä¼˜åŒ–éƒ¨åˆ†</h2>
<div class="outline-text-2" id="text-h:d2964f65-72be-4c3b-b564-125cf6e22dca">
<p>
é›†ç¾¤ç½‘æ®µåˆ’åˆ†<br>
</p>

<ul class="org-ul">
<li>ä¸»æœºèŠ‚ç‚¹ç½‘æ®µ 192.168.1.0/24<br></li>
<li>Service ç½‘æ®µ 10.96.0.0/16<br></li>
<li>Pod ç½‘æ®µ 10.244.0.0/16<br></li>
</ul>

<p>
é›†ç¾¤èµ„æºé…ç½®<br>
</p>

<ul class="org-ul">
<li>Master èŠ‚ç‚¹ 2C2G * 3<br></li>
<li>Node èŠ‚ç‚¹ 2C2G * 2<br></li>
</ul>
</div>
<div id="outline-container-h:e1965fe3-a78b-432a-a0c3-207c439d8f85" class="outline-3">
<h3 id="h:e1965fe3-a78b-432a-a0c3-207c439d8f85">é«˜å¯ç”¨Kubernetesé›†ç¾¤è§„åˆ’</h3>
<div class="outline-text-3" id="text-h:e1965fe3-a78b-432a-a0c3-207c439d8f85">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-right">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">ä¸»æœºå</td>
<td class="org-right">IPåœ°å€</td>
<td class="org-left">è§’è‰²</td>
<td class="org-left">é…ç½®</td>
</tr>

<tr>
<td class="org-left">:------&#x2013;&#x2014;:</td>
<td class="org-right">:------&#x2013;&#x2014;:</td>
<td class="org-left">:----------&#x2013;&#x2014;:</td>
<td class="org-left">:-&#x2013;&#x2014;:</td>
</tr>

<tr>
<td class="org-left">k8s-master01</td>
<td class="org-right">192.168.0.107</td>
<td class="org-left">Master</td>
<td class="org-left">2C2G 40G</td>
</tr>

<tr>
<td class="org-left">k8s-master02</td>
<td class="org-right">192.168.0.108</td>
<td class="org-left">Master</td>
<td class="org-left">2C2G 40G</td>
</tr>

<tr>
<td class="org-left">k8s-master03</td>
<td class="org-right">192.168.0.109</td>
<td class="org-left">Master</td>
<td class="org-left">2C2G 40G</td>
</tr>

<tr>
<td class="org-left">k8s-master-lb</td>
<td class="org-right">192.168.0.236</td>
<td class="org-left">keepalivedè™šæ‹Ÿ IP</td>
<td class="org-left">2C2G 40G</td>
</tr>

<tr>
<td class="org-left">k8s-node01</td>
<td class="org-right">192.168.0.110</td>
<td class="org-left">Node-1</td>
<td class="org-left">2C2G 40G</td>
</tr>

<tr>
<td class="org-left">k8s-node02</td>
<td class="org-right">192.168.0.111</td>
<td class="org-left">Node-2</td>
<td class="org-left">2C2G 40G</td>
</tr>
</tbody>
</table>


<p>
è¯·ç»Ÿä¸€æ›¿æ¢è¿™äº›ç½‘æ®µï¼ŒPodç½‘æ®µå’Œserviceå’Œå®¿ä¸»æœºç½‘æ®µä¸è¦é‡å¤ï¼ï¼ï¼<br>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">ä¿¡æ¯</td>
<td class="org-left">å¤‡æ³¨</td>
</tr>

<tr>
<td class="org-left">:----&#x2013;&#x2014;:</td>
<td class="org-left">:-------&#x2013;&#x2014;:</td>
</tr>

<tr>
<td class="org-left">ç³»ç»Ÿç‰ˆæœ¬</td>
<td class="org-left">CentOS 7.9</td>
</tr>

<tr>
<td class="org-left">Dockerç‰ˆæœ¬</td>
<td class="org-left">20.10.x</td>
</tr>

<tr>
<td class="org-left">K8sç‰ˆæœ¬</td>
<td class="org-left">1.20.x</td>
</tr>

<tr>
<td class="org-left">Podç½‘æ®µ</td>
<td class="org-left">172.168.0.0/12</td>
</tr>

<tr>
<td class="org-left">Serviceç½‘æ®µ</td>
<td class="org-left">10.96.0.0/12</td>
</tr>
</tbody>
</table>


<p>
è¯´æ˜ï¼š<br>
</p>
<ul class="org-ul">
<li>å®¿ä¸»æœºç½‘æ®µã€K8s Serviceç½‘æ®µã€Podç½‘æ®µä¸èƒ½é‡å¤.<br></li>
<li>ä¸è¦ä½¿ç”¨ä¸­æ–‡çš„ç¯å¢ƒï¼Œè¿˜æœ‰ä¸è¦å…‹éš†çš„è™šæ‹Ÿæœºã€‚ç”Ÿäº§ç¯å¢ƒï¼Œä½¿ç”¨äºŒè¿›åˆ¶å®‰è£…ã€‚<br></li>
<li>VIPï¼ˆè™šæ‹ŸIPï¼‰ä¸è¦å’Œå…¬å¸å†…ç½‘IPé‡å¤ï¼Œé¦–å…ˆå»pingä¸€ä¸‹ï¼Œä¸é€šæ‰å¯ç”¨ã€‚VIPéœ€è¦å’Œä¸»æœºåœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ï¼<br></li>
</ul>
</div>
</div>
<div id="outline-container-h:6dbc4586-2e2e-43c6-b676-75c316a1b351" class="outline-3">
<h3 id="h:6dbc4586-2e2e-43c6-b676-75c316a1b351">åŸºæœ¬ç¯å¢ƒé…ç½®</h3>
<div class="outline-text-3" id="text-h:6dbc4586-2e2e-43c6-b676-75c316a1b351">
<p>
Kubeadm å®‰è£…æ–¹å¼è‡ª1.14ç‰ˆæœ¬ä»¥åï¼Œå®‰è£…æ–¹æ³•å‡ ä¹æ²¡æœ‰ä»»ä½•å˜åŒ–ï¼Œæ­¤æ–‡æ¡£å¯ä»¥å°è¯•å®‰è£…æœ€æ–°çš„k8sé›†ç¾¤ï¼Œcentosé‡‡ç”¨çš„æ˜¯7.xç‰ˆæœ¬ã€‚<br>
</p>

<p>
k8så®˜ç½‘ï¼š<a href="https://kubernetes.io/docs/setup/">https://kubernetes.io/docs/setup/</a><br>
</p>

<p>
æœ€æ–°ç‰ˆæœ¬é«˜å¯ç”¨å®‰è£…ï¼š<a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/high-availability/">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/high-availability/</a><br>
</p>


<p>
æ‰€æœ‰èŠ‚ç‚¹é…ç½®hosts,ä¿®æ”¹ /etc/hosts å¦‚ä¸‹ï¼š<br>
ä¸»è¦ä¸ºäº†å‘åŒ…æ–¹ä¾¿ï¼Œä¸é…ç½®ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 ~]# cat /etc/hosts  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#28155;&#21152;&#22914;&#19979;</span>
192.168.0.107 k8s-master01
192.168.0.108 k8s-master02
192.168.0.109 k8s-master03
192.168.0.236 k8s-master-lb <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#19981;&#26159;&#39640;&#21487;&#29992;&#38598;&#32676;&#65292;&#35813;IP&#20026;Master01&#30340;IP</span>
192.168.0.110 k8s-node01
192.168.0.111 k8s-node02
</pre>
</div>

<p>
yumæºé…ç½®<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo
yum install -y yum-utils device-mapper-persistent-data lvm2
yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
<span style="color: #ffa54f;">[kubernetes]</span>
<span style="color: #ffa54f;">name=Kubernetes</span>
<span style="color: #ffa54f;">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span>
<span style="color: #ffa54f;">enabled=1</span>
<span style="color: #ffa54f;">gpgcheck=1</span>
<span style="color: #ffa54f;">repo_gpgcheck=1</span>
<span style="color: #ffa54f;">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span>
<span style="color: #ffa54f;">EOF</span>
sed -i -e <span style="color: #8b2252;">'/mirrors.cloud.aliyuncs.com/d'</span> -e <span style="color: #8b2252;">'/mirrors.aliyuncs.com/d'</span> /etc/yum.repos.d/CentOS-Base.repo
</pre>
</div>

<p>
å¿…å¤‡å·¥å…·å®‰è£…<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">yum install wget jq psmisc vim net-tools telnet yum-utils device-mapper-persistent-data lvm2 git -y
</pre>
</div>

<p>
æ‰€æœ‰èŠ‚ç‚¹å…³é—­é˜²ç«å¢™ã€selinuxã€dnsmasqã€swapã€‚æœåŠ¡å™¨é…ç½®å¦‚ä¸‹ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">systemctl disable --now firewalld 
systemctl disable --now dnsmasq
systemctl disable --now NetworkManager <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20844;&#26377;&#20113;&#19981;&#35201;&#20851;&#38381;</span>

setenforce 0
sed -i <span style="color: #8b2252;">'s#SELINUX=enforcing#SELINUX=disabled#g'</span> /etc/sysconfig/selinux
sed -i <span style="color: #8b2252;">'s#SELINUX=enforcing#SELINUX=disabled#g'</span> /etc/selinux/config
</pre>
</div>

<p>
å…³é—­swapåˆ†åŒº<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">swapoff -a &amp;&amp; sysctl -w vm.swappiness=0
sed -ri <span style="color: #8b2252;">'/^[^#]*swap/s@^@#@'</span> /etc/fstab
</pre>
</div>

<p>
å®‰è£…ntpdate<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">rpm -ivh http://mirrors.wlnmp.com/centos/wlnmp-release-centos.noarch.rpm
yum install ntpdate -y
</pre>
</div>

<p>
æ‰€æœ‰èŠ‚ç‚¹åŒæ­¥æ—¶é—´ã€‚æ—¶é—´åŒæ­¥é…ç½®å¦‚ä¸‹ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">'Asia/Shanghai'</span> &gt;/etc/timezone
ntpdate time2.aliyun.com
</pre>
</div>

<p>
åŠ å…¥åˆ°crontab<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">*/5 * * * * ntpdate time2.aliyun.com
</pre>
</div>

<p>
æ‰€æœ‰èŠ‚ç‚¹é…ç½®limitï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #483d8b;">ulimit</span> -SHn 65535

vim /etc/security/limits.conf
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26411;&#23614;&#28155;&#21152;&#22914;&#19979;&#20869;&#23481;</span>
- oft nofile 655360
- hard nofile 131072
- soft nproc 655350
- hard nproc 655350
- soft memlock unlimited
- hard memlock unlimited
</pre>
</div>



<p>
Master01èŠ‚ç‚¹å…å¯†é’¥ç™»å½•å…¶ä»–èŠ‚ç‚¹ï¼š<br>
ä¸»è¦æ˜¯æ–¹ä¾¿ä¼ åŒ…ï¼Œå¯åšå¯ä¸åš<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">ssh-keygen -t rsa
<span style="color: #a020f0;">for</span> i<span style="color: #a020f0;"> in</span> k8s-master01 k8s-master02 k8s-master03 k8s-node01 k8s-node02;<span style="color: #a020f0;">do</span> ssh-copy-id -i .ssh/id_rsa.pub $<span style="color: #a0522d;">i</span>;<span style="color: #a020f0;">done</span>
</pre>
</div>

<p>
ä¸‹è½½å®‰è£…æ‰€æœ‰çš„æºç æ–‡ä»¶ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #483d8b;">cd</span> /root/ ; git clone https://github.com/dotbalo/k8s-ha-install.git
</pre>
</div>

<p>
æ‰€æœ‰èŠ‚ç‚¹å‡çº§ç³»ç»Ÿå¹¶é‡å¯ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">yum update -y --exclude=kernel*  &amp;&amp; reboot

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;&#23433;&#35013;&#30340;&#29256;&#26412;</span>
[root@k8s-master01 ~]# cat /etc/redhat-release
CentOS Linux release 7.9.2009 (Core)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c76c5e5a-b226-4262-a02a-1c57589a8a5b" class="outline-3">
<h3 id="h:c76c5e5a-b226-4262-a02a-1c57589a8a5b">å†…æ ¸å‡çº§</h3>
<div class="outline-text-3" id="text-h:c76c5e5a-b226-4262-a02a-1c57589a8a5b">
<p>
centos7 éœ€è¦å‡çº§å†…æ ¸è‡³4.18+ï¼Œ æœ¬åœ°ç¥ç»çš„ç‰ˆæœ¬ä¸º4.19<br>
</p>

<p>
åœ¨Master01èŠ‚ç‚¹ä¸‹è½½å†…æ ¸<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #483d8b;">cd</span> /root
wget http://193.49.22.109/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-devel-4.19.12-1.el7.elrepo.x86_64.rpm
wget http://193.49.22.109/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-4.19.12-1.el7.elrepo.x86_64.rpm
</pre>
</div>

<p>
åœ¨master01æ‹·è´åˆ°å…¶ä»–èŠ‚ç‚¹<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #a020f0;">for</span> i<span style="color: #a020f0;"> in</span> k8s-master01 k8s-master02 k8s-master03 k8s-node01 k8s-node02; <span style="color: #a020f0;">do</span> scp kernel-ml-devel-4.19.12-1.el7.elrepo.x86_64.rpm kernel-ml-4.19.12-1.el7.elrepo.x86_64.rpm $<span style="color: #a0522d;">i</span>:/root/ ; <span style="color: #a020f0;">done</span>
</pre>
</div>

<p>
æ‰€æœ‰èŠ‚ç‚¹å®‰è£…å†…æ ¸<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #483d8b;">cd</span> /root/ &amp;&amp; yum localinstall -y kernel-ml*
</pre>
</div>

<p>
æ‰€æœ‰èŠ‚ç‚¹æ›´æ”¹å†…æ ¸å¯åŠ¨é¡ºåº<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">grub2-set-default 0 &amp;&amp; grub2-mkconfig -o /etc/grub2.cfg

grubby --args=<span style="color: #8b2252;">"user_namespace.enable=1"</span> --update-kernel=<span style="color: #8b2252;">"$(grubby --default-kernel)"</span>
</pre>
</div>

<p>
æ£€æŸ¥é»˜è®¤å†…æ ¸æ˜¯ä¸æ˜¯4.19<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 ~]# grubby --default-kernel
/boot/vmlinuz-4.19.12-1.el7.elrepo.x86_64
</pre>
</div>

<p>
æ‰€æœ‰èŠ‚ç‚¹é‡å¯ï¼Œç„¶åæ£€æŸ¥å†…æ ¸æ˜¯ä¸æ˜¯4.19<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 ~]# uname -a
</pre>
</div>

<p>
<b><b>å…¶å®å‚è€ƒ</b></b><br>
</p>

<p>
æœ¬åœ°åŒ…å®‰è£…<br>
</p>

<p>
å®‰è£…åŒ…rpm : <a href="https://www.kernel.org/">https://www.kernel.org/</a> å’Œ<a href="https://elrepo.org/linux/kernel/el7/x86_64/">https://elrepo.org/linux/kernel/el7/x86_64/</a><br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;">#</span><span style="color: #b22222;">kernel-ml-5.13.8-1.el7.elrepo.x86_64.rpm</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">kernel-ml-devel-5.13.8-1.el7.elrepo.x86_64.rpm</span>

yum localinstall -y kernel-ml*
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26356;&#25913;&#20869;&#26680;&#39034;&#24207;&#65306;</span>
grub2-set-default  0 &amp;&amp; grub2-mkconfig -o /etc/grub2.cfg 
grubby --args=<span style="color: #8b2252;">"user_namespace.enable=1"</span> --update-kernel=<span style="color: #8b2252;">"$(grubby --default-kernel)"</span> &amp;&amp; reboot

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#24320;&#26426;&#21518;&#26597;&#30475;&#20869;&#26680;&#26159;&#19981;&#26159;&#26368;&#26032;&#30340;</span>
grubby --default-kernel
</pre>
</div>

<p>
yumå®‰è£…<br>
</p>

<p>
åˆ©ç”¨elrepoæºåœ¨CentOS 7 å®‰è£…æ–°ç‰ˆå†…æ ¸<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#24403;&#21069;&#21457;&#34892;&#29256;&#21644;&#20869;&#26680;</span>
cat /etc/redhat-release
uname -r
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#29992; ELRepo &#20179;&#24211;</span>
yum install https://www.elrepo.org/elrepo-release-7.0-4.el7.elrepo.noarch.rpm
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#21487;&#29992;&#20869;&#26680;&#21253;</span>
yum --disablerepo=<span style="color: #8b2252;">"*"</span> --enablerepo=<span style="color: #8b2252;">"elrepo-kernel"</span> repolist
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#26368;&#26032;&#20869;&#26680;</span>
yum --enablerepo=elrepo-kernel install -y kernel-ml kernel-ml-devel
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#24050;&#23433;&#35013;&#30340;&#20869;&#26680;</span>
[root@k8s-master01 ~]# awk -F<span style="color: #8b2252;">\'</span> <span style="color: #8b2252;">'$1=="menuentry " {print i++ " : " $2}'</span> /etc/grub2.cfg
0 : CentOS Linux (5.1.14-1.el7.elrepo.x86_64) 7 (Core)
1 : CentOS Linux (3.10.0-957.el7.x86_64) 7 (Core)
2 : CentOS Linux (0-rescue-8d615a05e5de49a08ca0e56b285958f7) 7 (Core)
**&#35774;&#32622;&#21551;&#21160;&#20869;&#26680;&#65292;&#21363;&#23601;&#26159;&#32534;&#21495;&#20026;0&#30340;&#37027;&#20010;
<span style="color: #b22222;">#</span><span style="color: #b22222;">grub2-set-default 0</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">sed -i 's/saved/0/g'  /etc/default/grub</span>
**&#20851;&#38381;NUMA
<span style="color: #b22222;">#</span><span style="color: #b22222;">sed -i 's/quiet/quiet numa=off/g' /etc/default/grub</span>
**&#37325;&#26032;&#29983;&#25104;grub2&#37197;&#32622;&#25991;&#20214;
<span style="color: #b22222;">#</span><span style="color: #b22222;">grub2-mkconfig -o /boot/grub2/grub.cfg</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26356;&#25913;&#20869;&#26680;&#39034;&#24207;&#65306;</span>
grub2-set-default  0 &amp;&amp; grub2-mkconfig -o /etc/grub2.cfg 
grubby --args=<span style="color: #8b2252;">"user_namespace.enable=1"</span> --update-kernel=<span style="color: #8b2252;">"$(grubby --default-kernel)"</span> &amp;&amp; reboot

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#24320;&#26426;&#21518;&#26597;&#30475;&#20869;&#26680;</span>
grubby --default-kernel
</pre>
</div>



<p>
<b><b>æ‰€æœ‰èŠ‚ç‚¹å®‰è£…ipvsadm</b></b>   <br>
</p>

<p>
é»˜è®¤æƒ…å†µä¸‹ï¼ŒKube-proxyå°†åœ¨kubeadméƒ¨ç½²çš„é›†ç¾¤ä¸­ä»¥iptablesæ¨¡å¼è¿è¡Œ<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">yum install ipvsadm ipset sysstat conntrack libseccomp -y
</pre>
</div>

<p>
æ‰€æœ‰èŠ‚ç‚¹é…ç½®ipvsæ¨¡å—, åœ¨å†…æ ¸4.19+ç‰ˆæœ¬ nf_conntrack_ipv4 å·²ç»ä¿®æ”¹ä¸º nf_conntrackï¼Œ 4.18 ä»¥ä¸‹ä½¿ç”¨ nf_conntrack_ipv4 å³å¯<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">modprobe -- ip_vs
modprobe -- ip_vs_rr
modprobe -- ip_vs_wrr
modprobe -- ip_vs_sh
modprobe -- nf_conntrack

vim /etc/modules-load.d/ipvs.conf 
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21152;&#20837;&#20197;&#19979;&#20869;&#23481;</span>
ip_vs
ip_vs_lc
ip_vs_wlc
ip_vs_rr
ip_vs_wrr
ip_vs_lblc
ip_vs_lblcr
ip_vs_dh
ip_vs_sh
ip_vs_fo
ip_vs_nq
ip_vs_sed
ip_vs_ftp
ip_vs_sh
nf_conntrack
ip_tables
ip_set
xt_set
ipt_set
ipt_rpfilter
ipt_REJECT
ipip
</pre>
</div>

<p>
ç„¶åæ‰§è¡Œ<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">systemctl enable --now systemd-modules-load.service <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24320;&#26426;&#33258;&#21551;&#21160;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26816;&#26597;&#26159;&#21542;&#21152;&#36733;</span>
lsmod | grep -e ip_vs -e nf_conntrack
</pre>
</div>



<p>
**å¼€å¯ä¸€äº›k8sé›†ç¾¤ä¸­å¿…é¡»çš„å†…æ ¸å‚æ•°**ï¼Œæ‰€æœ‰èŠ‚ç‚¹é…ç½®k8så†…æ ¸<br>
</p>

<p>
ç›®å‰å¯¹ipv6æ”¯æŒä¸æ€ä¹ˆå¥½ï¼Œæ‰€ä»¥é‡Œé¢ä¹Ÿå…³é—­ipv6äº†<br>
</p>

<p>
k8sä¸€å®šè¦å¼€å¯`net.ipv4.ip_forward = 1`è·¯ç”±è½¬å‘<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s-sysctl.conf
<span style="color: #ffa54f;">#---add k8s---</span>
<span style="color: #ffa54f;">net.ipv4.ip_forward = 1</span>
<span style="color: #ffa54f;">net.netfilter.nf_conntrack_max = 2310720</span>
<span style="color: #ffa54f;">fs.inotify.max_user_watches=89100</span>
<span style="color: #ffa54f;">fs.may_detach_mounts = 1</span>
<span style="color: #ffa54f;">fs.file-max = 52706963</span>
<span style="color: #ffa54f;">fs.nr_open = 52706963</span>

<span style="color: #ffa54f;"># &#35299;&#20915; k8s service &#21516;&#33410;&#28857;&#36890;&#20449;&#38382;&#39064;</span>
<span style="color: #ffa54f;">net.bridge.bridge-nf-call-ip6tables = 1</span>
<span style="color: #ffa54f;">net.bridge.bridge-nf-call-iptables = 1</span>


<span style="color: #ffa54f;">#&#31105;&#27490;&#20351;&#29992; swap &#31354;&#38388;&#65292;&#21482;&#26377;&#24403;&#31995;&#32479; OOM &#26102;&#25165;&#20801;&#35768;&#20351;&#29992;&#23427;</span>
<span style="color: #ffa54f;">vm.swappiness=0</span>
<span style="color: #ffa54f;">vm.panic_on_oom=0  # &#24320;&#21551; OOM</span>
<span style="color: #ffa54f;">vm.overcommit_memory=1 # &#19981;&#26816;&#26597;&#29289;&#29702;&#20869;&#23384;&#26159;&#21542;&#22815;&#29992;</span>

<span style="color: #ffa54f;"># kube-proxy&#20351;&#29992;ipvs&#30340;&#35805;&#20026;&#20102;&#38450;&#27490;timeout&#38656;&#35201;&#35774;&#32622;&#19979;tcp&#21442;&#25968;</span>
<span style="color: #ffa54f;"># https://github.com/moby/moby/issues/31208 </span>
<span style="color: #ffa54f;"># ipvsadm -l --timout</span>
<span style="color: #ffa54f;"># &#20462;&#22797;ipvs&#27169;&#24335;&#19979;&#38271;&#36830;&#25509;timeout&#38382;&#39064; &#23567;&#20110;900&#21363;&#21487;</span>
<span style="color: #ffa54f;">net.ipv4.tcp_keepalive_time = 600</span>
<span style="color: #ffa54f;">net.ipv4.tcp_keepalive_probes = 3</span>
<span style="color: #ffa54f;">net.ipv4.tcp_keepalive_intvl =15</span>

<span style="color: #ffa54f;">net.ipv4.conf.all.arp_announce = 2</span>
<span style="color: #ffa54f;">net.ipv4.tcp_max_tw_buckets = 50000</span>
<span style="color: #ffa54f;">net.ipv4.tcp_tw_reuse = 1</span>
<span style="color: #ffa54f;">net.ipv4.tcp_max_orphans = 327680</span>
<span style="color: #ffa54f;">net.ipv4.tcp_orphan_retries = 3</span>
<span style="color: #ffa54f;">net.ipv4.tcp_syncookies = 1</span>
<span style="color: #ffa54f;">net.ipv4.tcp_max_syn_backlog = 16384</span>
<span style="color: #ffa54f;">net.ipv4.ip_conntrack_max = 65536</span>
<span style="color: #ffa54f;">net.ipv4.tcp_synack_retries = 2</span>
<span style="color: #ffa54f;">net.ipv4.tcp_timestamps = 0</span>
<span style="color: #ffa54f;">net.core.somaxconn = 16384</span>

<span style="color: #ffa54f;">net.ipv6.conf.all.disable_ipv6 = 1</span>
<span style="color: #ffa54f;">net.ipv6.conf.default.disable_ipv6 = 1</span>
<span style="color: #ffa54f;">net.ipv6.conf.lo.disable_ipv6 = 1</span>
<span style="color: #ffa54f;">net.ipv4.neigh.default.gc_stale_time = 120</span>
<span style="color: #ffa54f;">net.ipv4.conf.all.rp_filter = 0</span>
<span style="color: #ffa54f;">net.ipv4.conf.default.rp_filter = 0</span>
<span style="color: #ffa54f;">net.ipv4.conf.default.arp_announce = 2</span>
<span style="color: #ffa54f;">net.ipv4.conf.lo.arp_announce = 2</span>
<span style="color: #ffa54f;">EOF</span>

sysctl --system
</pre>
</div>

<p>
æ‰€æœ‰èŠ‚ç‚¹é‡å¯,  æ£€æŸ¥æ˜¯å¦åŠ è½½<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">reboot
lsmod | grep --color=auto -e ip_vs -e nf_conntrack
</pre>
</div>

<p>
å¯ç”¨ `bridge-nf-call-iptables` è¿™ä¸ªå†…æ ¸å‚æ•° (ç½®ä¸º 1)ï¼Œè¡¨ç¤º bridge è®¾å¤‡åœ¨äºŒå±‚è½¬å‘æ—¶ä¹Ÿå»è°ƒç”¨ iptables é…ç½®çš„ä¸‰å±‚è§„åˆ™ (åŒ…å« conntrack)ï¼Œæ‰€ä»¥å¼€å¯è¿™ä¸ªå‚æ•°å°±èƒ½å¤Ÿè§£å†³ä¸Šè¿° Service åŒèŠ‚ç‚¹é€šä¿¡é—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨ Kubernetes ç¯å¢ƒä¸­ï¼Œå¤§å¤šéƒ½è¦æ±‚å¼€å¯ `bridge-nf-call-iptables` çš„åŸå› ã€‚å‚è€ƒ<a href="https://imroc.cc/post/202105/why-enable-bridge-nf-call-iptables/">https://imroc.cc/post/202105/why-enable-bridge-nf-call-iptables/</a><br>
</p>
</div>
</div>
<div id="outline-container-h:e6df0c63-f665-4b6a-a49c-61b4073f5dc9" class="outline-3">
<h3 id="h:e6df0c63-f665-4b6a-a49c-61b4073f5dc9">k8s ç»„ä»¶å’Œ runtime å®‰è£…</h3>
<div class="outline-text-3" id="text-h:e6df0c63-f665-4b6a-a49c-61b4073f5dc9">
<p>
å¦‚æœå®‰è£…çš„ç‰ˆæœ¬ä½äº1.24ï¼Œé€‰æ‹©Dockerå’ŒContainerdå‡å¯ï¼Œé«˜äº1.24é€‰æ‹©Containerdä½œä¸ºRuntimeã€‚<br>
</p>
</div>
<div id="outline-container-h:d71f041f-250b-4459-9f08-132c40505a98" class="outline-4">
<h4 id="h:d71f041f-250b-4459-9f08-132c40505a98">Containerd ä½œä¸º Runtime</h4>
<div class="outline-text-4" id="text-h:d71f041f-250b-4459-9f08-132c40505a98">
<p>
æ‰€æœ‰èŠ‚ç‚¹å®‰è£…docker-ce-20.10ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">yum install docker-ce-20.10.* docker-ce-cli-20.10.* -y
</pre>
</div>

<p>
å¯ä»¥æ— éœ€å¯åŠ¨Dockerï¼Œåªéœ€è¦é…ç½®å’Œå¯åŠ¨Containerdå³å¯ã€‚<br>
é¦–å…ˆé…ç½®Containerdæ‰€éœ€çš„æ¨¡å—ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/containerd.conf</span>
overlay
br_netfilter
EOF
</pre>
</div>
<p>
æ‰€æœ‰èŠ‚ç‚¹åŠ è½½æ¨¡å—ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">modprobe -- overlay</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">modprobe -- br_netfilter</span>
</pre>
</div>
<p>
æ‰€æœ‰èŠ‚ç‚¹ï¼Œé…ç½®Containerdæ‰€éœ€çš„å†…æ ¸ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf</span>
net.bridge.bridge-nf-call-iptables  = 1
net.ipv4.ip_forward                 = 1
net.bridge.bridge-nf-call-ip6tables = 1
EOF
</pre>
</div>
<p>
æ‰€æœ‰èŠ‚ç‚¹åŠ è½½å†…æ ¸ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">sysctl --system</span>
</pre>
</div>
<p>
æ‰€æœ‰èŠ‚ç‚¹é…ç½®Containerdçš„é…ç½®æ–‡ä»¶ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">mkdir -p /etc/containerd</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">containerd config default | tee /etc/containerd/config.toml</span>
</pre>
</div>

<p>
æ‰€æœ‰èŠ‚ç‚¹å°†Containerdçš„Cgroupæ”¹ä¸ºSystemdï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">vim /etc/containerd/config.toml</span>
</pre>
</div>
<p>
æ‰¾åˆ°containerd.runtimes.runc.optionsï¼Œä¸‹ä¸€è¡Œæ·»åŠ SystemdCgroup = trueï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>
</p>

<p>
æ‰€æœ‰èŠ‚ç‚¹å°†sandbox_imageçš„Pauseé•œåƒæ”¹æˆç¬¦åˆè‡ªå·±ç‰ˆæœ¬çš„åœ°å€registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.6ï¼š<br>
</p>

<p>
æ‰€æœ‰èŠ‚ç‚¹å¯åŠ¨Containerdï¼Œå¹¶é…ç½®å¼€æœºè‡ªå¯åŠ¨ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">systemctl daemon-reload</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">systemctl enable --now containerd</span>
</pre>
</div>
<p>
æ‰€æœ‰èŠ‚ç‚¹é…ç½®crictlå®¢æˆ·ç«¯è¿æ¥çš„è¿è¡Œæ—¶ä½ç½®ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">cat &gt; /etc/crictl.yaml &lt;&lt;EOF</span>
runtime-endpoint: unix:///run/containerd/containerd.sock
image-endpoint: unix:///run/containerd/containerd.sock
timeout: 10
debug: false
EOF
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6fb0bd42-6b14-4a3a-9e57-c6570a0c6a6e" class="outline-4">
<h4 id="h:6fb0bd42-6b14-4a3a-9e57-c6570a0c6a6e">Docker ä½œä¸º Runtime ï¼ˆç‰ˆæœ¬å°äº 1.24ï¼‰</h4>
<div class="outline-text-4" id="text-h:6fb0bd42-6b14-4a3a-9e57-c6570a0c6a6e">
<div class="org-src-container">
<pre class="src src-shell">yum install docker-ce-20.10.* docker-ce-cli-20.10.* -y
</pre>
</div>

<p>
<b><b>æ¸©é¦¨æç¤º</b></b><br>
</p>

<p>
ç”±äºæ–°ç‰ˆkubelet å»ºè®®ä½¿ç”¨systemdï¼Œæ‰€ä»¥å¯ä»¥æŠŠ docker çš„ CgroupDriver æ”¹æˆsystemd<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"> mkdir /etc/docker
cat &gt; /etc/docker/daemon.json &lt;&lt;EOF
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">  "exec-opts": ["native.cgroupdriver=systemd"]</span>
<span style="color: #ffa54f;">}</span>
<span style="color: #ffa54f;">EOF</span>
</pre>
</div>

<p>
æ‰€æœ‰èŠ‚ç‚¹è®¾ç½®å¼€æœºè‡ªå¯åŠ¨Docker<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">systemctl daemon-reload &amp;&amp; systemctl enable --now docker
</pre>
</div>
</div>
</div>
<div id="outline-container-h:31474281-9c84-4e14-99a6-c1f2bd741f6a" class="outline-4">
<h4 id="h:31474281-9c84-4e14-99a6-c1f2bd741f6a">å®‰è£…k8sç»„ä»¶</h4>
<div class="outline-text-4" id="text-h:31474281-9c84-4e14-99a6-c1f2bd741f6a">
<p>
é¦–å…ˆåœ¨Master01èŠ‚ç‚¹æŸ¥çœ‹æœ€æ–°çš„Kubernetesç‰ˆæœ¬æ˜¯å¤šå°‘ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">yum list kubeadm.x86_64 --showduplicates | sort -r
</pre>
</div>

<p>
æ‰€æœ‰èŠ‚ç‚¹å®‰è£…æœ€æ–°ç‰ˆæœ¬kubeadm<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">yum install -y kubelet kubeadm kubectl
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450;&#29256;&#26412; yum install kubeadm-1.23* kubelet-1.23* kubectl-1.23* -y</span>
</pre>
</div>

<p>
é»˜è®¤é…ç½®çš„pauseé•œåƒä½¿ç”¨ gcr.io ä»“åº“ï¼Œå›½å†…å¯èƒ½æ— æ³•è®¿é—®ï¼Œæ‰€ä»¥è¿™é‡Œé…ç½® Kubelet ä½¿ç”¨é˜¿é‡Œäº‘çš„ pause é•œåƒï¼Œä½¿ç”¨ Containerd å¯è·³è¿‡è¿™æ­¥ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">cat &gt;/etc/sysconfig/kubelet&lt;&lt;EOF
<span style="color: #ffa54f;">KUBELET_EXTRA_ARGS="--pod-infra-container-image=registry.cn-6</span>
<span style="color: #ffa54f;">hangzhou.aliyuncs.com/google_containers/pause:3.6"</span>
<span style="color: #ffa54f;">EOF</span>
</pre>
</div>

<p>
å¦‚æœé€‰æ‹©çš„æ˜¯Containerdä½œä¸ºçš„Runtimeï¼Œéœ€è¦æ›´æ”¹Kubeletçš„é…ç½®ä½¿ç”¨Containerdä½œä¸ºRuntimeï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">cat &gt;/etc/sysconfig/kubelet&lt;&lt;EOF
<span style="color: #ffa54f;">KUBELET_KUBEADM_ARGS="--container-runtime=remote --runtime-request-timeout=15m --container-runtime-endpoint=unix:///run/containerd/containerd.sock"</span>
<span style="color: #ffa54f;">EOF</span>
</pre>
</div>

<p>
è®¾ç½®Kubeletå¼€æœºè‡ªå¯åŠ¨<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">systemctl daemon-reload
systemctl enable --now kubelet
</pre>
</div>

<p>
ç”±äºè¿˜æœªåˆå§‹åŒ–ï¼Œæ²¡æœ‰kubeletçš„é…ç½®æ–‡ä»¶ï¼Œæ­¤æ—¶kubeletæ— æ³•å¯åŠ¨ï¼Œæ— éœ€ç®¡ç†<br>
</p>
</div>
</div>
</div>
<div id="outline-container-h:30640a70-34c2-4e49-bc60-7ab000e509b7" class="outline-3">
<h3 id="h:30640a70-34c2-4e49-bc60-7ab000e509b7">é«˜å¯ç”¨ç»„ä»¶å®‰è£…</h3>
<div class="outline-text-3" id="text-h:30640a70-34c2-4e49-bc60-7ab000e509b7">
<p>
ï¼ˆæ³¨æ„ï¼šå¦‚æœä¸æ˜¯é«˜å¯ç”¨é›†ç¾¤ï¼Œhaproxyå’Œkeepalivedæ— éœ€å®‰è£…ï¼‰<br>
</p>

<p>
å…¬æœ‰äº‘è¦ç”¨å…¬æœ‰äº‘è‡ªå¸¦çš„è´Ÿè½½å‡è¡¡ï¼Œæ¯”å¦‚é˜¿é‡Œäº‘çš„SLBï¼Œè…¾è®¯äº‘çš„ELBï¼Œç”¨æ¥æ›¿ä»£haproxyå’Œkeepalivedï¼Œå› ä¸ºå…¬æœ‰äº‘å¤§éƒ¨åˆ†éƒ½æ˜¯ä¸æ”¯æŒkeepalivedçš„ï¼Œå¦å¤–å¦‚æœç”¨é˜¿é‡Œäº‘çš„è¯ï¼Œkubectlæ§åˆ¶ç«¯ä¸èƒ½æ”¾åœ¨masterèŠ‚ç‚¹ï¼Œæ¨èä½¿ç”¨è…¾è®¯äº‘ï¼Œå› ä¸ºé˜¿é‡Œäº‘çš„slbæœ‰å›ç¯çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯slbä»£ç†çš„æœåŠ¡å™¨ä¸èƒ½åå‘è®¿é—®SLBï¼Œä½†æ˜¯è…¾è®¯äº‘ä¿®å¤äº†è¿™ä¸ªé—®é¢˜ã€‚<br>
</p>

<p>
æ‰€æœ‰MasterèŠ‚ç‚¹é€šè¿‡yumå®‰è£…HAProxyå’ŒKeepAlivedï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">yum install keepalived haproxy -y
</pre>
</div>

<p>
æ‰€æœ‰MasterèŠ‚ç‚¹é…ç½®HAProxyï¼ˆè¯¦ç»†é…ç½®å‚è€ƒHAProxyæ–‡æ¡£ï¼Œæ‰€æœ‰MasterèŠ‚ç‚¹çš„HAProxyé…ç½®ç›¸åŒï¼‰ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 etc]# mkdir /etc/haproxy
[root@k8s-master01 etc]# vim /etc/haproxy/haproxy.cfg 
global
  maxconn  2000
  ulimit-n  16384
  <span style="color: #483d8b;">log</span>  127.0.0.1 local0 err
  stats timeout 30s

defaults
  <span style="color: #483d8b;">log</span> global
  mode  http
  option  httplog
  timeout connect 5000
  timeout client  50000
  timeout server  50000
  timeout http-request 15s
  timeout http-keep-alive 15s

frontend monitor-in
  bind *:33305
  mode http
  option httplog
  monitor-uri /monitor

frontend k8s-master
  bind 0.0.0.0:16443
  bind 127.0.0.1:16443
  mode tcp
  option tcplog
  tcp-request inspect-delay 5s
  default_backend k8s-master

backend k8s-master
  mode tcp
  option tcplog
  option tcp-check
  balance roundrobin
  default-server inter 10s downinter 5s rise 2 fall 2 slowstart 60s maxconn 250 maxqueue 256 weight 100
  <span style="color: #b22222;"># </span><span style="color: #b22222;">3 &#20010; master &#33410;&#28857; ip</span>
  server k8s-master01   192.168.0.107:6443  check
  server k8s-master02   192.168.0.108:6443  check
  server k8s-master03   192.168.0.109:6443  check
</pre>
</div>

<p>
æ‰€æœ‰MasterèŠ‚ç‚¹é…ç½®KeepAlivedï¼Œé…ç½®ä¸ä¸€æ ·ï¼Œæ³¨æ„åŒºåˆ†<br>
</p>

<ul class="org-ul">
<li>ç½‘å¡åç§° interface<br></li>
<li>mcast_src_ip åœ°å€<br></li>
<li>virtual_ipaddress è™šæ‹Ÿ vip åœ°å€ï¼Œä¸ä¸»æœºåœ¨åŒä¸€ç½‘æ®µå†…<br></li>
<li>æ³¨æ„æ¯ä¸ªèŠ‚ç‚¹çš„IPå’Œç½‘å¡ï¼ˆinterfaceå‚æ•°ï¼‰<br></li>
</ul>



<p>
Master01èŠ‚ç‚¹çš„é…ç½®ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 etc]# mkdir /etc/keepalived

[root@k8s-master01 ~]# vim /etc/keepalived/keepalived.conf 
! Configuration File for keepalived
global_defs {
    router_id LVS_DEVEL
script_user root
    enable_script_security
}
vrrp_script chk_apiserver {
    script <span style="color: #8b2252;">"/etc/keepalived/check_apiserver.sh"</span>
    interval 5
    weight -5
    fall 2  
rise 1
}
vrrp_instance VI_1 {
    state MASTER
    interface ens33
    mcast_src_ip 192.168.0.107
    virtual_router_id 51
    priority 101
    advert_int 2
    authentication {
        auth_type PASS
        auth_pass K8SHA_KA_AUTH
    }
    virtual_ipaddress {
        192.168.0.236
    }
    track_script {
       chk_apiserver
    }
}
</pre>
</div>

<p>
Master02èŠ‚ç‚¹çš„é…ç½®ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">! Configuration File for keepalived
global_defs {
    router_id LVS_DEVEL
script_user root
    enable_script_security
}
vrrp_script chk_apiserver {
    script <span style="color: #8b2252;">"/etc/keepalived/check_apiserver.sh"</span>
   interval 5
    weight -5
    fall 2  
rise 1
}
vrrp_instance VI_1 {
    state BACKUP
    interface ens33
    mcast_src_ip 192.168.0.108
    virtual_router_id 51
    priority 100
    advert_int 2
    authentication {
        auth_type PASS
        auth_pass K8SHA_KA_AUTH
    }
    virtual_ipaddress {
        192.168.0.236
    }
    track_script {
       chk_apiserver
    }
}
</pre>
</div>

<p>
Master03èŠ‚ç‚¹çš„é…ç½®ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">! Configuration File for keepalived
global_defs {
    router_id LVS_DEVEL
script_user root
    enable_script_security
}
vrrp_script chk_apiserver {
    script <span style="color: #8b2252;">"/etc/keepalived/check_apiserver.sh"</span>
 interval 5
    weight -5
    fall 2  
rise 1
}
vrrp_instance VI_1 {
    state BACKUP
    interface ens33
    mcast_src_ip 192.168.0.109
    virtual_router_id 51
    priority 100
    advert_int 2
    authentication {
        auth_type PASS
        auth_pass K8SHA_KA_AUTH
    }
    virtual_ipaddress {
        192.168.0.236
    }
    track_script {
       chk_apiserver
    }
}
</pre>
</div>



<p>
æ‰€æœ‰masterèŠ‚ç‚¹ï¼Œé…ç½®KeepAlivedå¥åº·æ£€æŸ¥æ–‡ä»¶ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 keepalived]# cat /etc/keepalived/check_apiserver.sh 
<span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/bash</span>

<span style="color: #a0522d;">err</span>=0
<span style="color: #a020f0;">for</span> k<span style="color: #a020f0;"> in</span> $(seq 1 3)
<span style="color: #a020f0;">do</span>
    <span style="color: #a0522d;">check_code</span>=$(pgrep haproxy)
    <span style="color: #a020f0;">if</span> [[ $<span style="color: #a0522d;">check_code</span> == <span style="color: #8b2252;">""</span> ]]; <span style="color: #a020f0;">then</span>
        <span style="color: #a0522d;">err</span>=$(expr $<span style="color: #a0522d;">err</span> + 1)
        sleep 1
        <span style="color: #a020f0;">continue</span>
    <span style="color: #a020f0;">else</span>
        <span style="color: #a0522d;">err</span>=0
        <span style="color: #a020f0;">break</span>
    <span style="color: #a020f0;">fi</span>
<span style="color: #a020f0;">done</span>

<span style="color: #a020f0;">if</span> [[ $<span style="color: #a0522d;">err</span> != <span style="color: #8b2252;">"0"</span> ]]; <span style="color: #a020f0;">then</span>
    <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"systemctl stop keepalived"</span>
    /usr/bin/systemctl stop keepalived
    <span style="color: #a020f0;">exit</span> 1
<span style="color: #a020f0;">else</span>
    <span style="color: #a020f0;">exit</span> 0
<span style="color: #a020f0;">fi</span>


chmod +x /etc/keepalived/check_apiserver.sh
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21551;&#21160;haproxy&#21644;keepalived</span>
[root@k8s-master01 keepalived]# systemctl daemon-reload
[root@k8s-master01 keepalived]# systemctl enable --now haproxy
[root@k8s-master01 keepalived]# systemctl enable --now keepalived
</pre>
</div>

<p>
æµ‹è¯•VIP<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 ~]# ping 192.168.0.236 -c 4
PING 192.168.0.236 (192.168.0.236) 56(84) bytes of data.
64 bytes from 192.168.0.236: <span style="color: #a0522d;">icmp_seq</span>=1 <span style="color: #a0522d;">ttl</span>=64 <span style="color: #a0522d;">time</span>=0.464 ms
64 bytes from 192.168.0.236: <span style="color: #a0522d;">icmp_seq</span>=2 <span style="color: #a0522d;">ttl</span>=64 <span style="color: #a0522d;">time</span>=0.063 ms
64 bytes from 192.168.0.236: <span style="color: #a0522d;">icmp_seq</span>=3 <span style="color: #a0522d;">ttl</span>=64 <span style="color: #a0522d;">time</span>=0.062 ms
64 bytes from 192.168.0.236: <span style="color: #a0522d;">icmp_seq</span>=4 <span style="color: #a0522d;">ttl</span>=64 <span style="color: #a0522d;">time</span>=0.063 ms

telnet 192.168.0.236 16443
Escape character is <span style="color: #8b2252;">'^]'</span>.
Connection closed by foreign host.
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26085;&#24535;&#26597;&#30475;</span>
tail -f /var/log/messages
</pre>
</div>

<p>
å¦‚æœpingä¸é€šä¸”telnetæ²¡æœ‰å‡ºç° ] ï¼Œåˆ™è®¤ä¸ºVIPä¸å¯ä»¥ï¼Œä¸å¯åœ¨ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œéœ€è¦æ’æŸ¥keepalivedçš„é—®é¢˜ï¼Œæ¯”å¦‚é˜²ç«å¢™å’Œselinuxï¼Œhaproxyå’Œkeepalivedçš„çŠ¶æ€ï¼Œç›‘å¬ç«¯å£ç­‰<br>
</p>

<p>
æ‰€æœ‰èŠ‚ç‚¹æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€å¿…é¡»ä¸ºdisableå’Œinactiveï¼šsystemctl status firewalld<br>
</p>

<p>
æ‰€æœ‰èŠ‚ç‚¹æŸ¥çœ‹selinuxçŠ¶æ€ï¼Œå¿…é¡»ä¸ºdisableï¼šgetenforce<br>
</p>

<p>
masterèŠ‚ç‚¹æŸ¥çœ‹haproxyå’ŒkeepalivedçŠ¶æ€ï¼šsystemctl status keepalived haproxy<br>
</p>

<p>
masterèŠ‚ç‚¹æŸ¥çœ‹ç›‘å¬ç«¯å£ï¼šnetstat -lntp<br>
</p>
</div>
</div>
</section>
<section id="outline-container-h:ec12062f-68eb-4b04-8833-2edd72d936b5" class="outline-2">
<h2 id="h:ec12062f-68eb-4b04-8833-2edd72d936b5">é›†ç¾¤å»ºç«‹éƒ¨åˆ†</h2>
<div class="outline-text-2" id="text-h:ec12062f-68eb-4b04-8833-2edd72d936b5">
</div>
<div id="outline-container-h:05ce7887-a24c-47db-a03b-6944fe20dfa5" class="outline-3">
<h3 id="h:05ce7887-a24c-47db-a03b-6944fe20dfa5">é›†ç¾¤åˆå§‹åŒ–</h3>
<div class="outline-text-3" id="text-h:05ce7887-a24c-47db-a03b-6944fe20dfa5">
<p>
å®˜æ–¹åˆå§‹åŒ–æ–‡æ¡£ï¼š<br>
</p>

<p>
<a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/high-availability/">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/high-availability/</a><br>
</p>
</div>
<div id="outline-container-h:4e2afd45-6d9c-49e1-ab7f-170ffc410611" class="outline-4">
<h4 id="h:4e2afd45-6d9c-49e1-ab7f-170ffc410611">kubeadm å‘½ä»¤ä½¿ç”¨</h4>
<div class="outline-text-4" id="text-h:4e2afd45-6d9c-49e1-ab7f-170ffc410611">
<div class="org-src-container">
<pre class="src src-shell">Available Commands:
    alpha <span style="color: #b22222;">#</span><span style="color: #b22222;">kubeadm &#22788;&#20110;&#27979;&#35797;&#38454;&#27573;&#30340;&#21629;&#20196;</span>
    completion <span style="color: #b22222;">#</span><span style="color: #b22222;">bash &#21629;&#20196;&#34917;&#20840;&#65292;&#38656;&#35201;&#23433;&#35013; bash-completion</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">mkdir /data/scripts -p</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">kubeadm completion bash &gt; /data/scripts/kubeadm_completion.sh</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">source /data/scripts/kubeadm_completion.sh</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">vim /etc/profile #&#28155;&#21152;&#20869;&#23481;</span>
        <span style="color: #483d8b;">source</span> /data/scripts/kubeadm_completion.sh
    config <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31649;&#29702; kubeadm &#38598;&#32676;&#30340;&#37197;&#32622;&#65292;&#35813;&#37197;&#32622;&#20445;&#30041;&#22312;&#38598;&#32676;&#30340; ConfigMap &#20013;</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">kubeadm config print init-defaults</span>
    help Help about any command
    init    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#21160;&#19968;&#20010; Kubernetes &#20027;&#33410;&#28857;</span>
    join    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#33410;&#28857;&#21152;&#20837;&#21040;&#24050;&#32463;&#23384;&#22312;&#30340; k8s master</span>
    reset   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36824;&#21407;&#20351;&#29992; kubeadm init &#25110;&#32773; kubeadm join &#23545;&#31995;&#32479;&#20135;&#29983;&#30340;&#29615;&#22659;&#21464;&#21270;&#12290;&#28165;&#31354;&#33410;&#28857;&#25968;&#25454;</span>
    token   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31649;&#29702; token</span>
    upgrade <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21319;&#32423; k8s &#29256;&#26412;</span>
    version <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#29256;&#26412;&#20449;&#24687;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:8459c629-b142-43a1-9db8-fb123646c0c7" class="outline-4">
<h4 id="h:8459c629-b142-43a1-9db8-fb123646c0c7">kubeadm init å‘½ä»¤ç®€ä»‹</h4>
<div class="outline-text-4" id="text-h:8459c629-b142-43a1-9db8-fb123646c0c7">
<p>
å‘½ä»¤ä½¿ç”¨ï¼š<br>
<a href="https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/">https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/</a><br>
</p>

<p>
é›†ç¾¤åˆå§‹åŒ–ï¼š<br>
<a href="https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-init/">https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-init/</a><br>
</p>

<div class="org-src-container">
<pre class="src src-shell">root@docker-k8s-node1:~# kubeadm init --help
--apiserver-advertise-address string    <span style="color: #b22222;">#</span><span style="color: #b22222;">K8S API Server &#23558;&#35201;&#30417;&#21548;&#30340;&#30417;&#21548;&#30340;&#26412;&#26426; IP</span>
--apiserver-bind-port int32             <span style="color: #b22222;">#</span><span style="color: #b22222;">API Server &#32465;&#23450;&#30340;&#31471;&#21475;,&#40664;&#35748;&#20026; 6443</span>

--apiserver-cert-extra-sans stringSlice <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#36873;&#30340;&#35777;&#20070;&#39069;&#22806;&#20449;&#24687;&#65292;&#29992;&#20110;&#25351;&#23450; API Server &#30340;&#26381;&#21153;&#22120;&#35777;&#20070;&#12290;&#21487;&#20197;&#26159; IP &#22320;&#22336;&#20063;&#21487;&#20197;&#26159; DNS &#21517;&#31216;&#12290;</span>
--cert-dir string                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35777;&#20070;&#30340;&#23384;&#20648;&#36335;&#24452;&#65292;&#32570;&#30465;&#36335;&#24452;&#20026; /etc/kubernetes/pki</span>
--certificate-key string                <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23450;&#20041;&#19968;&#20010;&#29992;&#20110;&#21152;&#23494; kubeadm-certs Secret &#20013;&#30340;&#25511;&#21046;&#24179;&#21488;&#35777;&#20070;&#30340;&#23494;&#38053;</span>
--config string <span style="color: #b22222;">#</span><span style="color: #b22222;">kubeadm                #&#37197;&#32622;&#25991;&#20214;&#30340;&#36335;&#24452;</span>
--control-plane-endpoint string         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;&#25511;&#21046;&#24179;&#21488;&#25351;&#23450;&#19968;&#20010;&#31283;&#23450;&#30340; IP &#22320;&#22336;&#25110; DNS &#21517;&#31216;&#65292;&#21363;&#37197;&#32622;&#19968;&#20010;&#21487;&#20197;&#38271;&#26399;&#20351;&#29992;&#20999;&#26159;&#39640;&#21487;&#29992;&#30340; VIP &#25110;&#32773;&#22495;&#21517;&#65292;</span>
                                        k8s&#22810;master &#39640;&#21487;&#29992;&#22522;&#20110;&#27492;&#21442;&#25968;&#23454;&#29616;
--cri-socket string                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35201;&#36830;&#25509;&#30340; CRI(&#23481;&#22120;&#36816;&#34892;&#26102;&#25509;&#21475;&#65292;Container Runtime Interface, &#31616;&#31216; CRI)&#22871;&#25509;&#23383;&#30340;&#36335;&#24452;&#65292;&#22914;&#26524;&#20026;&#31354;&#65292;&#21017; kubeadm </span>
                                        &#23558;&#23581;&#35797;&#33258;&#21160;&#26816;&#27979;&#27492;&#20540;&#65292;<span style="color: #8b2252;">"&#20165;&#24403;&#23433;&#35013;&#20102;&#22810;&#20010; CRI &#25110;&#20855;&#26377;&#38750;&#26631;&#20934; CRI &#25554;&#27133;&#26102;&#65292;&#25165;&#20351;&#29992;&#27492;&#36873;&#39033;"</span>
--dry-run                               <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#35201;&#24212;&#29992;&#20219;&#20309;&#26356;&#25913;&#65292;&#21482;&#26159;&#36755;&#20986;&#23558;&#35201;&#25191;&#34892;&#30340;&#25805;&#20316;&#65292;&#20854;&#23454;&#23601;&#26159;&#27979;&#35797;&#36816;&#34892;&#12290;</span>
--experimental-kustomize string         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#20110;&#23384;&#20648; kustomize &#20026;&#38745;&#24577; pod &#28165;&#21333;&#25152;&#25552;&#20379;&#30340;&#34917;&#19969;&#30340;&#36335;&#24452;&#12290;</span>
--feature-gates string                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#32452;&#29992;&#26469;&#25551;&#36848;&#21508;&#31181;&#21151;&#33021;&#29305;&#24615;&#30340;&#38190;&#20540;&#65288;key=value&#65289;&#23545;&#65292;&#36873;&#39033;&#26159;&#65306;IPv6DualStack=true|false (ALPHA - default=false)</span>
--ignore-preflight-errors strings       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#24573;&#30053;&#26816;&#26597;&#36807;&#31243; &#20013;&#20986;&#29616;&#30340;&#38169;&#35823;&#20449;&#24687;&#65292;&#27604;&#22914;&#24573;&#30053; swap&#65292;&#22914;&#26524;&#20026; all &#23601;&#24573;&#30053;&#25152;&#26377;</span>
--image-repository string               <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622;&#19968;&#20010;&#38236;&#20687;&#20179;&#24211;&#65292;&#40664;&#35748;&#20026; k8s.gcr.io</span>
--kubernetes-version string             <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450;&#23433;&#35013; k8s &#29256;&#26412;&#65292;&#40664;&#35748;&#20026; stable-1</span>
--node-name string                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450; node &#33410;&#28857;&#21517;&#31216;</span>
--pod-network-cidr                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622; pod ip &#22320;&#22336;&#33539;&#22260;</span>
--service-cidr                          <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622; service &#32593;&#32476;&#22320;&#22336;&#33539;&#22260;&#65292;&#40664;&#35748;&#20540;&#65306;"10.96.0.0/12"</span>
--service-dns-domain string             <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622; k8s&#20869;&#37096;&#22495;&#21517;&#65292;&#40664;&#35748;&#20026; cluster.local&#65292;&#20250;&#26377;&#30456;&#24212;&#30340; DNS &#26381;&#21153;(kube-dns/coredns)&#35299;&#26512;&#29983;&#25104;&#30340;&#22495;&#21517;&#35760;&#24405;&#12290;&#21487;&#20197;&#25442;&#25104;&#20844;&#21496;&#20869;&#37096;&#20351;&#29992;&#30340;&#22495;&#21517;&#65292;&#22914;me.local</span>
--skip-certificate-key-print            <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#25171;&#21360;&#29992;&#20110;&#21152;&#23494;&#30340;key &#20449;&#24687;</span>
--skip-phases strings                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35201;&#36339;&#36807;&#21738;&#20123;&#38454;&#27573;</span>
--skip-token-print                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36339;&#36807;&#25171;&#21360; token &#20449;&#24687;</span>
--token                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450; token</span>
--token-ttl                             <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450; token &#36807;&#26399;&#26102;&#38388;&#65292;&#40664;&#35748;&#20026; 24 &#23567;&#26102;&#65292;0 &#20026;&#27704;&#19981;&#36807;&#26399;</span>
--upload-certs                          <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26356;&#26032;&#35777;&#20070;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20840;&#23616;&#21487;&#36873;&#39033;&#65306;</span>
--add-dir-header                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#20026; true&#65292;&#22312;&#26085;&#24535;&#22836;&#37096;&#28155;&#21152;&#26085;&#24535;&#30446;&#24405;</span>
--log-file string                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#19981;&#20026;&#31354;&#65292;&#23558;&#20351;&#29992;&#27492;&#26085;&#24535;&#25991;&#20214;</span>
--log-file-max-size uint                <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622;&#26085;&#24535;&#25991;&#20214;&#30340;&#26368;&#22823;&#22823;&#23567;&#65292;&#21333;&#20301;&#20026;&#20806;&#65292;&#40664;&#35748;&#20026; 1800 &#20806;&#65292;0 &#20026;&#27809;&#26377;&#38480;&#21046;</span>
--rootfs                                <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23487;&#20027;&#26426;&#30340;&#26681;&#36335;&#24452;&#65292;&#20063;&#23601;&#26159;&#32477;&#23545;&#36335;&#24452;</span>
--skip-headers                          <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#20026; true&#65292;&#22312; log &#26085;&#24535;&#37324;&#38754;&#19981;&#26174;&#31034;&#26631;&#39064;&#21069;&#32512;</span>
--skip-log-headers                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#20026; true&#65292;&#22312; log &#26085;&#24535;&#37324;&#37324;&#19981;&#26174;&#31034;&#26631;&#39064;</span>
</pre>
</div>

<p>
éªŒè¯å‰ å½“å‰ kubeadm ç‰ˆæœ¬<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">kubeadm version #&#26597;&#30475;&#24403;&#21069; kubeadm &#29256;&#26412;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">kubeadm version</span>
kubeadm version: &amp;version.Info{Major:<span style="color: #8b2252;">"1"</span>, Minor:<span style="color: #8b2252;">"17"</span>, GitVersion:<span style="color: #8b2252;">"v1.23.3"</span>,
</pre>
</div>

<p>
å‡†å¤‡é•œåƒï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#23433;&#35013;&#25351;&#23450;&#29256;&#26412; k8s &#38656;&#35201;&#30340;&#38236;&#20687;&#26377;&#21738;&#20123;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">kubeadm config images list --kubernetes-version v1.23.3</span>
k8s.gcr.io/kube-apiserver:
k8s.gcr.io/kube-controller-manager:
k8s.gcr.io/kube-scheduler:
k8s.gcr.io/kube-proxy:
k8s.gcr.io/pause: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;&#27599;&#20010;pod&#23553;&#35013;&#19968;&#20010;&#24213;&#23618;&#30340;&#32593;&#32476;</span>
k8s.gcr.io/etcd:
k8s.gcr.io/coredns/coredns:
</pre>
</div>
</div>
</div>
<div id="outline-container-h:10a34219-ecbf-4307-9819-3197cd660ea6" class="outline-4">
<h4 id="h:10a34219-ecbf-4307-9819-3197cd660ea6">é«˜å¯ç”¨ master åˆå§‹åŒ–</h4>
<div class="outline-text-4" id="text-h:10a34219-ecbf-4307-9819-3197cd660ea6">
<p>
Master01èŠ‚ç‚¹åˆ›å»ºnew.yamlé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š<br>
</p>

<p>
ä»¥ä¸‹æ–‡ä»¶å†…å®¹ï¼Œå®¿ä¸»æœºç½‘æ®µã€podSubnetç½‘æ®µã€serviceSubnetç½‘æ®µä¸èƒ½é‡å¤<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">kubeadm config print init-defaults &gt; kubeadm-config.yaml <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#40664;&#35748;&#37197;&#32622;&#36755;&#20986;&#33267;&#25991;&#20214;</span>
vim kubeadm-config.yaml
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">apiVersion: kubeadm.k8s.io/v1beta2
bootstrapTokens:
- groups:
  - system:bootstrappers:kubeadm:default-node-token
  token: 7t2weq.bjbawausm0jaxury <span style="color: #b22222;"># </span><span style="color: #b22222;">token&#65292;&#31532;&#20108;&#22825;&#21487;&#33021;&#36807;&#26399;&#65292;&#21518;&#38754;&#20171;&#32461;&#38450;&#27490;&#36807;&#26399;</span>
  ttl: 24h0m0s
  usages:
  - signing
  - authentication
kind: InitConfiguration
localAPIEndpoint:
  advertiseAddress: 192.168.0.107 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26412;&#22320;&#30417;&#21548;&#22320;&#22336;</span>
  bindPort: 6443
nodeRegistration:
  <span style="color: #b22222;"># </span><span style="color: #b22222;">criSocket: /var/run/dockershim.sock  # &#22914;&#26524;&#26159;Docker&#20316;&#20026;Runtime&#37197;&#32622;&#27492;&#39033;</span>
  criSocket: unix:///var/run/containerd/containerd.sock <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#26159;Containerd&#20316;&#20026;Runtime&#37197;&#32622;&#27492;&#39033;</span>
  name: k8s-master01
  taints:               <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23481;&#24525;&#65292;&#19981;&#21487;&#35843;&#24230;</span>
  - effect: NoSchedule
    key: node-role.kubernetes.io/control-plane
---
apiServer:
  certSANs:
  - 192.168.0.236 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35777;&#20070;&#39041;&#21457;&#32473;&#35841;&#65292; &#25913;&#25104; vip &#25110;&#32773;&#26159;&#20844;&#26377;&#20113;&#36127;&#36733;&#22343;&#34913;&#22320;&#22336;</span>
  timeoutForControlPlane: 4m0s
apiVersion: kubeadm.k8s.io/v1beta2
certificatesDir: /etc/kubernetes/pki
clusterName: kubernetes
controlPlaneEndpoint: 192.168.0.236:16443 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22522;&#20110; VIP &#30340; Endpoint</span>
controllerManager: {}
dns:
  <span style="color: #483d8b;">type</span>: CoreDNS
etcd:
  <span style="color: #483d8b;">local</span>:
    dataDir: /var/lib/etcd
imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38236;&#20687;&#24211;</span>
kind: ClusterConfiguration
kubernetesVersion: v1.26.0 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26356;&#25913;&#27492;&#22788;&#30340;&#29256;&#26412;&#21495;&#21644;kubeadm version&#19968;&#33268;</span>
networking:                <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32593;&#32476;&#20449;&#24687;</span>
  dnsDomain: cluster.local
  podSubnet: 172.16.0.0/12
  serviceSubnet: 10.96.0.0/12
scheduler: {}
</pre>
</div>

<p>
<b><b>æ³¨æ„ï¼Œå¦‚æœä¸æ˜¯é«˜å¯ç”¨é›†ç¾¤ï¼Œ192.168.0.236:16443æ”¹ä¸ºmaster01çš„åœ°å€ï¼Œ16443æ”¹ä¸ºapiserverçš„ç«¯å£ï¼Œé»˜è®¤æ˜¯6443ï¼Œæ³¨æ„æ›´æ”¹kubernetesVersionçš„å€¼å’Œè‡ªå·±æœåŠ¡å™¨kubeadmçš„ç‰ˆæœ¬ä¸€è‡´ï¼škubeadm version</b></b><br>
</p>

<p>
æ›´æ–°kubeadmæ–‡ä»¶<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">kubeadm config migrate --old-config kubeadm-config.yaml --new-config new.yaml
</pre>
</div>

<p>
å°†new.yamlæ–‡ä»¶å¤åˆ¶åˆ°å…¶ä»–masterèŠ‚ç‚¹ï¼Œä¹‹åæ‰€æœ‰MasterèŠ‚ç‚¹æå‰ä¸‹è½½é•œåƒï¼Œå¯ä»¥èŠ‚çœåˆå§‹åŒ–æ—¶é—´ï¼ˆå…¶ä»–èŠ‚ç‚¹ä¸éœ€è¦æ›´æ”¹ä»»ä½•é…ç½®ï¼ŒåŒ…æ‹¬IPåœ°å€ä¹Ÿä¸éœ€è¦æ›´æ”¹ï¼Œåªæ˜¯ç”¨æ¥ä¸‹è½½é•œåƒçš„ï¼‰ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #a020f0;">for</span> i<span style="color: #a020f0;"> in</span> k8s-master02 k8s-master03; <span style="color: #a020f0;">do</span> scp new.yaml $<span style="color: #a0522d;">i</span>:/root/; <span style="color: #a020f0;">done</span>
kubeadm config images pull --config /root/new.yaml 
</pre>
</div>

<p>
æ‰€æœ‰èŠ‚ç‚¹è®¾ç½®å¼€æœºè‡ªå¯åŠ¨kubelet<br>
</p>

<p>
#+end_src<br>
systemctl enable &#x2013;now kubelet # å¦‚æœå¯åŠ¨å¤±è´¥æ— éœ€ç®¡ç†ï¼Œåˆå§‹åŒ–æˆåŠŸä»¥åå³å¯å¯åŠ¨<br>
#+end_src<br>
</p>

<p>
Master01èŠ‚ç‚¹åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–ä»¥åä¼šåœ¨/etc/kubernetesç›®å½•ä¸‹ç”Ÿæˆå¯¹åº”çš„è¯ä¹¦å’Œé…ç½®æ–‡ä»¶ï¼Œä¹‹åå…¶ä»–MasterèŠ‚ç‚¹åŠ å…¥Master01å³å¯ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">kubeadm init --config /root/new.yaml  --upload-certs
</pre>
</div>

<p>
å¦‚æœåˆå§‹åŒ–å¤±è´¥ï¼Œé‡ç½®åå†æ¬¡åˆå§‹åŒ–ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼ˆæ²¡æœ‰å¤±è´¥ä¸è¦æ‰§è¡Œï¼‰ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">kubeadm reset -f ; ipvsadm --clear  ; rm -rf ~/.kube
</pre>
</div>

<p>
åˆå§‹åŒ–æˆåŠŸä»¥åï¼Œä¼šäº§ç”ŸTokenå€¼ï¼Œç”¨äºå…¶ä»–èŠ‚ç‚¹åŠ å…¥æ—¶ä½¿ç”¨ï¼Œå› æ­¤è¦è®°å½•ä¸‹åˆå§‹åŒ–æˆåŠŸç”Ÿæˆçš„tokenå€¼ï¼ˆä»¤ç‰Œå€¼ï¼‰ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $<span style="color: #a0522d;">HOME</span>/.kube
  sudo cp -i /etc/kubernetes/admin.conf $<span style="color: #a0522d;">HOME</span>/.kube/config
  sudo chown $(id -u):$(id -g) $<span style="color: #a0522d;">HOME</span>/.kube/config

Alternatively, if you are the root user, you can run:

  <span style="color: #483d8b;">export</span> <span style="color: #a0522d;">KUBECONFIG</span>=/etc/kubernetes/admin.conf

You should now deploy a pod network to the cluster.
Run <span style="color: #8b2252;">"kubectl apply -f [podnetwork].yaml"</span> with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

You can now join any number of the control-plane node running the following command on each as root:

  kubeadm join 192.168.0.236:16443 --token 7t2weq.bjbawausm0jaxury <span style="color: #8b2252;">\</span>
    --discovery-token-ca-cert-hash sha256:8c92ecb336be2b9372851a9af2c7ca1f7f60c12c68f6ffe1eb513791a1b8a908 <span style="color: #8b2252;">\</span>
    --control-plane --certificate-key ac2854de93aaabdf6dc440322d4846fc230b290c818c32d6ea2e500fc930b0aa

Please note that the certificate-key gives access to cluster sensitive data, keep it secret!
As a safeguard, uploaded-certs will be deleted<span style="color: #a020f0;"> in</span> two hours; If necessary, you can use
<span style="color: #8b2252;">"kubeadm init phase upload-certs --upload-certs"</span> to reload certs afterward.

Then you can join any number of worker nodes by running the following on each as root:

kubeadm join 192.168.0.236:16443 --token 7t2weq.bjbawausm0jaxury <span style="color: #8b2252;">\</span>
    --discovery-token-ca-cert-hash sha256:8c92ecb336be2b9372851a9af2c7ca1f7f60c12c68f6ffe1eb513791a1b8a908
</pre>
</div>

<p>
Master01èŠ‚ç‚¹é…ç½®ç¯å¢ƒå˜é‡ï¼Œç”¨äºè®¿é—®Kubernetesé›†ç¾¤ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">cat &lt;&lt;EOF &gt;&gt; /root/.bashrc
<span style="color: #ffa54f;">export KUBECONFIG=/etc/kubernetes/admin.conf</span>
<span style="color: #ffa54f;">EOF</span>
<span style="color: #483d8b;">source</span> /root/.bashrc
</pre>
</div>

<p>
æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"> [root@k8s-master01 ~]# kubectl get nodes
NAME           STATUS     ROLES                  AGE   VERSION
k8s-master01   NotReady   control-plane,master   74s   v1.20.0
<span style="color: #b22222;"># </span><span style="color: #b22222;">kubectl get svc</span>
</pre>
</div>

<p>
é‡‡ç”¨åˆå§‹åŒ–å®‰è£…æ–¹å¼ï¼Œæ‰€æœ‰çš„ç³»ç»Ÿç»„ä»¶å‡ä»¥å®¹å™¨çš„æ–¹å¼è¿è¡Œå¹¶ä¸”åœ¨kube-systemå‘½åç©ºé—´å†…ï¼Œæ­¤æ—¶å¯ä»¥æŸ¥çœ‹PodçŠ¶æ€ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 ~]# kubectl get pods -n kube-system -o wide
NAME                                   READY     STATUS    RESTARTS   AGE       IP              NODE
coredns-777d78ff6f-kstsz               0/1       Pending   0          14m       &lt;none&gt;          &lt;none&gt;
coredns-777d78ff6f-rlfr5               0/1       Pending   0          14m       &lt;none&gt;          &lt;none&gt;
etcd-k8s-master01                      1/1       Running   0          14m       192.168.0.107   k8s-master01
kube-apiserver-k8s-master01            1/1       Running   0          13m       192.168.0.107   k8s-master01
kube-controller-manager-k8s-master01   1/1       Running   0          13m       192.168.0.107   k8s-master01
kube-proxy-8d4qc                       1/1       Running   0          14m       192.168.0.107   k8s-master01
kube-scheduler-k8s-master01            1/1       Running   0          13m       192.168.0.107   k8s-master01
</pre>
</div>

<p>
å¢åŠ å‘½ä»¤æç¤º<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">yum install -y bash-completion
<span style="color: #483d8b;">source</span> /usr/share/bash-completion/bash_completion
<span style="color: #483d8b;">source</span> &lt;(kubectl completion bash)
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"source &lt;(kubectl completion bash)"</span> &gt;&gt; ~/.bashrc
</pre>
</div>

<p>
<b><b>kubeadm init åˆ›å»º k8s é›†ç¾¤æµç¨‹</b></b> <a href="https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-init/">https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-init/</a><br>
</p>
</div>
</div>
</div>
<div id="outline-container-h:3e5773ea-b8d7-45a0-8596-2cd2f595158b" class="outline-3">
<h3 id="h:3e5773ea-b8d7-45a0-8596-2cd2f595158b">é«˜å¯ç”¨Master</h3>
<div class="outline-text-3" id="text-h:3e5773ea-b8d7-45a0-8596-2cd2f595158b">
<p>
åˆå§‹åŒ–å…¶ä»–masteråŠ å…¥é›†ç¾¤, master02, 03åŠ ä¸Š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">kubeadm join 192.168.0.236:16443 --token 7t2weq.bjbawausm0jaxury <span style="color: #8b2252;">\</span>
    --discovery-token-ca-cert-hash sha256:8c92ecb336be2b9372851a9af2c7ca1f7f60c12c68f6ffe1eb513791a1b8a908 <span style="color: #8b2252;">\</span>
    --control-plane --certificate-key ac2854de93aaabdf6dc440322d4846fc230b290c818c32d6ea2e500fc930b0aa
</pre>
</div>
</div>
<div id="outline-container-h:7711fe4b-3916-43e2-aaf3-0018d9a71bf5" class="outline-4">
<h4 id="h:7711fe4b-3916-43e2-aaf3-0018d9a71bf5">token è¿‡æœŸå¤„ç†</h4>
<div class="outline-text-4" id="text-h:7711fe4b-3916-43e2-aaf3-0018d9a71bf5">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">Token&#36807;&#26399;&#21518;&#29983;&#25104;&#26032;&#30340;token&#65306;</span>
[root@k8s-master01 ~]# kubeadm token create --print-join-command
kubeadm join 192.168.1.236:16443 --token 8k8qzk.d43ed9gfgw1st3xi     --discovery-token-ca-cert-hash sha256:3aa4cf3c52c1956cb86d2911fe0f6b8898bfa43c06966b2f1095e5000a00d1a4 

<span style="color: #b22222;"># </span><span style="color: #b22222;">Master&#38656;&#35201;&#29983;&#25104;--certificate-key</span>
[root@k8s-master01 ~]# kubeadm init phase upload-certs  --upload-certs
[upload-certs] Storing the certificates<span style="color: #a020f0;"> in</span> Secret <span style="color: #8b2252;">"kubeadm-certs"</span><span style="color: #a020f0;"> in</span> the <span style="color: #8b2252;">"kube-system"</span> Namespace
[upload-certs] Using certificate key:
43c5695789c0dc4433f480a05683d55887e836b71b452b407138d8dd54cad937
</pre>
</div>


<p>
æŸ¥çœ‹ token è¿‡æœŸæ—¶é—´<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26816;&#26597;&#21021;&#22987;&#38598;&#32676;&#26102;&#30340;&#37197;&#32622;&#25991;&#20214;&#65292;&#25214;&#21040; token: 7t2weq.bjbawausm0jaxury</span>
<span style="color: #a0522d;">secret</span>=$(kubectl get secret -n kube-system|grep bootstrap |grep 7t2weq | awk <span style="color: #8b2252;">'{print $1}'</span>)
kubectl get secret $<span style="color: #a0522d;">secret</span> -o json | jq -r <span style="color: #8b2252;">'.data["expiration"]'</span> | base64 -d
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:7e6ce312-429c-4991-820e-37ed40f5b234" class="outline-3">
<h3 id="h:7e6ce312-429c-4991-820e-37ed40f5b234">æ·»åŠ NodeèŠ‚ç‚¹</h3>
<div class="outline-text-3" id="text-h:7e6ce312-429c-4991-820e-37ed40f5b234">
<div class="org-src-container">
<pre class="src src-shell">kubeadm join 192.168.0.236:16443 --token 7t2weq.bjbawausm0jaxury <span style="color: #8b2252;">\</span>
    --discovery-token-ca-cert-hash sha256:8c92ecb336be2b9372851a9af2c7ca1f7f60c12c68f6ffe1eb513791a1b8a908
</pre>
</div>

<p>
æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01]# kubectl  get node
NAME           STATUS     ROLES                  AGE     VERSION
k8s-master01   NotReady   control-plane,master   8m53s   v1.20.0
k8s-master02   NotReady   control-plane,master   2m25s   v1.20.0
k8s-master03   NotReady   control-plane,master   31s     v1.20.0
k8s-node01     NotReady   &lt;none&gt;                 32s     v1.20.0
k8s-node02     NotReady   &lt;none&gt;                 88s     v1.20.0
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31227;&#38500;&#33410;&#28857;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">kubectl drain blog-k8s-n0</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">kubectl delete node blog-k8s-n0</span>
</pre>
</div>

<p>
åœ¨æ²¡å®‰è£…ç½‘ç»œç»„ä»¶æ—¶ï¼ŒèŠ‚ç‚¹çŠ¶æ€éƒ½æ˜¯noreadyçš„<br>
</p>
</div>
<div id="outline-container-h:fad58a69-70dd-43bc-9654-741226b45332" class="outline-4">
<h4 id="h:fad58a69-70dd-43bc-9654-741226b45332">k8s å®‰è£…å¤±è´¥æ•…éšœæ’æŸ¥</h4>
<div class="outline-text-4" id="text-h:fad58a69-70dd-43bc-9654-741226b45332">
<p>
å¦‚æœ kubeletæ— æ³•å¯åŠ¨<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">systemctl stop containerd kubelet
rm -fr /etc/kubernetes
rm -fr /var/lib/containerd /var/lib/kubelet <span style="color: #b22222;"># </span><span style="color: #b22222;">umount /var/lib/kubelet/pods/xxx</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#37325;&#26032;&#37197;&#32622;&#33410;&#28857; Containerd &#30340;&#37197;&#32622;&#25991;&#20214;</span>
systemctl daemon-reload
systemctl restart containerd
systemctl restart kubelet
tail /var/log/message
<span style="color: #b22222;"># </span><span style="color: #b22222;">kubeadmin join ....</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:defb103a-7c80-46e6-b274-872135fe041d" class="outline-3">
<h3 id="h:defb103a-7c80-46e6-b274-872135fe041d">å®‰è£…ç½‘ç»œæ’ä»¶</h3>
<div class="outline-text-3" id="text-h:defb103a-7c80-46e6-b274-872135fe041d">
<p>
flannelã€calicoã€weave é€‰å…¶ä¸€å®‰è£…ï¼Œæ¨è calico<br>
</p>

<p>
calico æ”¯æŒç½‘ç»œç­–ç•¥ï¼Œflannel ä¸æ”¯æŒ<br>
</p>
</div>
<div id="outline-container-h:dbe105b9-d0a2-4c28-8b1b-3b47c0edb386" class="outline-4">
<h4 id="h:dbe105b9-d0a2-4c28-8b1b-3b47c0edb386">Flannel</h4>
<div class="outline-text-4" id="text-h:dbe105b9-d0a2-4c28-8b1b-3b47c0edb386">
<p>
æ³¨æ„ï¼š`kubeadm init` æ—¶è®¾ç½®çš„æ˜¯`&#x2013;pod-network-cidr=172.16.0.0/12`  é»˜è®¤æ˜¯ `&#x2013;pod-network-cidr=10.244.0.0/16`ï¼Œæ‰€ä»¥è¦ä¿®æ”¹ä¸€ä¸‹æ–‡ä»¶å†…å®¹ï¼Œä¿®æ”¹æˆè‡ªå·±çš„ã€‚<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;">#</span><span style="color: #b22222;">https://github.com/coreos/flannel/</span>
kubectl apply -f kube-flannel.yml
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c5be9576-68b4-497f-8522-b8200fcfca1b" class="outline-4">
<h4 id="h:c5be9576-68b4-497f-8522-b8200fcfca1b">Calicoå®‰è£…</h4>
<div class="outline-text-4" id="text-h:c5be9576-68b4-497f-8522-b8200fcfca1b">
<p>
ä»¥ä¸‹æ­¥éª¤åªåœ¨master01æ‰§è¡Œ<br>
</p>

<p>
æ³¨æ„ï¼šéœ€è¦ `kubeadm init` æ—¶è®¾ç½® `&#x2013;pod-network-cidr=172.16.0.0/12`<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">kubectl apply -f https://docs.projectcalico.org/v3.1/getting-started/kubernetes/installation/hosted/rbac-kdd.yaml
kubectl apply -f https://docs.projectcalico.org/v3.1/getting-started/kubernetes/installation/hosted/kubernetes-datastore/calico-networking/1.7/calico.yaml
</pre>
</div>

<p>
æˆ–è€…ä½¿ç”¨åˆ«äººåšå¥½çš„<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #483d8b;">cd</span> /root/k8s-ha-install &amp;&amp; git checkout manual-installation-v1.26.x &amp;&amp; <span style="color: #483d8b;">cd</span> calico/
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;Pod&#32593;&#27573;</span>
<span style="color: #a0522d;">POD_SUBNET</span>=<span style="color: #ff00ff;">`cat /etc/kubernetes/manifests/kube-controller-manager.yaml | grep cluster-cidr= | awk -F= '{print $NF}'`</span>

sed -i <span style="color: #8b2252;">"s#POD_CIDR#${POD_SUBNET}#g"</span> calico.yaml
kubectl apply -f calico.yaml

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#38236;&#20687;&#22320;&#22336;&#25442;&#20026;&#22269;&#20869;&#30340;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#20135;&#29615;&#22659;&#24314;&#35758;&#25226;&#38236;&#20687;&#25918;&#21040;&#20844;&#21496;&#20869;&#37096;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">grep -Po 'image:\s+\K\S+' calico-etcd.yaml </span>
</pre>
</div>



<p>
æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ (<b><b>éœ€ç­‰å¾…å‡ åˆ†é’Ÿ</b></b>)<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 dashboard]# kubectl  get po -n kube-system   
NAME                                       READY   STATUS    RESTARTS   AGE
calico-kube-controllers-5f6d4b864b-khq4h   1/1     Running   0          13m
calico-node-5tvxh                          1/1     Running   0          13m
calico-node-kffn7                          1/1     Running   0          13m
calico-node-lltfs                          1/1     Running   0          13m
calico-node-nhgn8                          1/1     Running   0          13m
coredns-54d67798b7-8w5hd                   1/1     Running   0          117m
coredns-54d67798b7-vb2ll                   1/1     Running   0          117m
etcd-k8s-master01                          1/1     Running   0          117m
etcd-k8s-master02                          1/1     Running   0          104m
kube-apiserver-k8s-master01                1/1     Running   0          117m
kube-apiserver-k8s-master02                1/1     Running   0          104m
kube-controller-manager-k8s-master01       1/1     Running   1          117m
kube-controller-manager-k8s-master02       1/1     Running   0          104m
kube-proxy-5bws8                           1/1     Running   0          117m
kube-proxy-pbqjc                           1/1     Running   0          104m
kube-proxy-tpwbt                           1/1     Running   0          86m
kube-proxy-vbpc5                           1/1     Running   0          86m
kube-scheduler-k8s-master01                1/1     Running   1          117m
kube-scheduler-k8s-master02                1/1     Running   0          104m
metrics-server-545b8b99c6-hkgnz            1/1     Running   0          2m38s
</pre>
</div>
</div>
</div>
<div id="outline-container-h:5391ef18-5eb2-4a24-81d7-4f5eeed16b90" class="outline-4">
<h4 id="h:5391ef18-5eb2-4a24-81d7-4f5eeed16b90">weave</h4>
<div class="outline-text-4" id="text-h:5391ef18-5eb2-4a24-81d7-4f5eeed16b90">
<div class="org-src-container">
<pre class="src src-sh">sysctl net.bridge.bridge-nf-call-iptables=1
kubectl apply -f <span style="color: #8b2252;">"https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\n')"</span>
</pre>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-h:d3df78dc-ede4-4033-8410-8b755a08e493" class="outline-2">
<h2 id="h:d3df78dc-ede4-4033-8410-8b755a08e493">Addons å®‰è£…</h2>
<div class="outline-text-2" id="text-h:d3df78dc-ede4-4033-8410-8b755a08e493">
<ul class="org-ul">
<li>metrics serverï¼šæŸ¥çœ‹ä¸»æœºã€pod çš„å†…å­˜ã€CPUçš„ä½¿ç”¨é‡<br></li>
<li>Dashboardï¼šå›¾å½¢åŒ–é›†ç¾¤ç®¡ç†ç•Œé¢<br></li>
</ul>
</div>
<div id="outline-container-h:6a7f1118-dfdd-4ae7-9784-0c28c67ed707" class="outline-3">
<h3 id="h:6a7f1118-dfdd-4ae7-9784-0c28c67ed707">Metrics Serveréƒ¨ç½²</h3>
<div class="outline-text-3" id="text-h:6a7f1118-dfdd-4ae7-9784-0c28c67ed707">
<p>
åœ¨æ–°ç‰ˆçš„Kubernetesä¸­ç³»ç»Ÿèµ„æºçš„é‡‡é›†å‡ä½¿ç”¨Metrics-serverï¼Œå¯ä»¥é€šè¿‡Metricsé‡‡é›†èŠ‚ç‚¹å’ŒPodçš„å†…å­˜ã€ç£ç›˜ã€CPUå’Œç½‘ç»œçš„ä½¿ç”¨ç‡ã€‚<br>
å°†Master01èŠ‚ç‚¹çš„front-proxy-ca.crtå¤åˆ¶åˆ°æ‰€æœ‰NodeèŠ‚ç‚¹<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">scp /etc/kubernetes/pki/front-proxy-ca.crt k8s-node01:/etc/kubernetes/pki/front-proxy-ca.crt
scp /etc/kubernetes/pki/front-proxy-ca.crt k8s-node(&#20854;&#20182;&#33410;&#28857;&#33258;&#34892;&#25335;&#36125;):/etc/kubernetes/pki/front-proxy-ca.crt
</pre>
</div>

<p>
å®‰è£…metrics server<br>
</p>

<p>
google: kubernetes metrics server<br>
</p>

<ul class="org-ul">
<li><a href="https://github.com/kubernetes-sigs/metrics-server">https://github.com/kubernetes-sigs/metrics-server</a><br></li>
</ul>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">High Availability</span>
kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/high-availability-1.21+.yaml
</pre>
</div>

<p>
æˆ–è€…ä½¿ç”¨å…¶ä»–äººçš„å®‰è£…ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #483d8b;">cd</span> /root/k8s-ha-install/kubeadm-metrics-server

<span style="color: #b22222;"># </span><span style="color: #b22222;">kubectl  create -f comp.yaml </span>
serviceaccount/metrics-server created
clusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader created
clusterrole.rbac.authorization.k8s.io/system:metrics-server created
rolebinding.rbac.authorization.k8s.io/metrics-server-auth-reader created
clusterrolebinding.rbac.authorization.k8s.io/metrics-server:system:auth-delegator created
clusterrolebinding.rbac.authorization.k8s.io/system:metrics-server created
service/metrics-server created
deployment.apps/metrics-server created
apiservice.apiregistration.k8s.io/v1beta1.metrics.k8s.io created
</pre>
</div>

<p>
ç­‰å¾…kube-systemå‘½ä»¤ç©ºé—´ä¸‹çš„Podå…¨éƒ¨å¯åŠ¨åï¼ŒæŸ¥çœ‹çŠ¶æ€<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">kubectl get po -n kube-system -l k8s-app=metrics-server
&#21464;&#25104;1/1     Running&#21518;

[root@k8s-master01 metrics-server-0.4.x-kubeadm]# kubectl  top node
NAME           CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%   
k8s-master01   109m         2%     1296Mi          33%       
k8s-master02   99m          2%     1124Mi          29%       
k8s-master03   104m         2%     1082Mi          28%       
k8s-node01     55m          1%     761Mi           19%       
k8s-node02     53m          1%     663Mi           17%

<span style="color: #b22222;"># </span><span style="color: #b22222;">kubectl top po -A</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:dee36232-69a1-4b9d-b257-3ed126c67045" class="outline-3">
<h3 id="h:dee36232-69a1-4b9d-b257-3ed126c67045">Dashboardéƒ¨ç½²</h3>
<div class="outline-text-3" id="text-h:dee36232-69a1-4b9d-b257-3ed126c67045">
<p>
Dashboardç”¨äºå±•ç¤ºé›†ç¾¤ä¸­çš„å„ç±»èµ„æºï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡Dashboardå®æ—¶æŸ¥çœ‹Podçš„æ—¥å¿—å’Œåœ¨å®¹å™¨ä¸­æ‰§è¡Œä¸€äº›å‘½ä»¤ç­‰ã€‚<br>
</p>
</div>
<div id="outline-container-h:21e82620-2357-4d59-9b45-b29fd0cc3d22" class="outline-4">
<h4 id="h:21e82620-2357-4d59-9b45-b29fd0cc3d22">å¼€å¯è‡ªåŠ¨ç”ŸæˆTokenï¼ˆ1.24ç‰ˆæœ¬ä¸Šå¿…åšï¼‰</h4>
<div class="outline-text-4" id="text-h:21e82620-2357-4d59-9b45-b29fd0cc3d22">
<p>
å¦‚æœå®‰è£…çš„K8sç‰ˆæœ¬ä»¥ä¸Šæ˜¯1.24ä»¥ä¸Šçš„ï¼ˆåŒ…å«1.24ï¼‰ï¼Œå…³é—­äº†è‡ªåŠ¨ç”Ÿäº§ token çš„é…ç½®ï¼Œéœ€è¦ä¿®æ”¹apiserverçš„ä»¥ä¸‹é…ç½®ï¼š<br>
æ‰€æœ‰masterèŠ‚ç‚¹ä¿®æ”¹apiserveré…ç½®ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">vim /etc/kubernetes/manifests/kube-apiserver.yaml
</pre>
</div>
<p>
ç„¶ååœ¨è¿™ä¸ªæ–‡ä»¶çš„commandå‚æ•°çš„ç¬¬äºŒè¡Œï¼Œæ·»åŠ  `&#x2013;feature-gates=LegacyServiceAccountTokenNoAutoGeneration=false` (å¦‚æœæœ‰feature-gateså‚æ•°ï¼Œç›´æ¥åœ¨åé¢æ·»åŠ  `LegacyServiceAccountTokenNoAutoGeneration=false` å³å¯).<br>
åŒæ ·çš„æ–¹å¼ä¿®æ”¹controller-manager<br>
ä¹‹åé‡å¯kubeletï¼Œç„¶åå®‰è£…dashboardå³å¯<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">systemctl restart kubelet
</pre>
</div>
</div>
</div>
<div id="outline-container-h:05cb790c-92df-424a-a3bb-aec07f3668ad" class="outline-4">
<h4 id="h:05cb790c-92df-424a-a3bb-aec07f3668ad">å®‰è£…æŒ‡å®šç‰ˆæœ¬ dashboard</h4>
<div class="outline-text-4" id="text-h:05cb790c-92df-424a-a3bb-aec07f3668ad">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #483d8b;">cd</span> /root/k8s-ha-install/dashboard/

[root@k8s-master01 dashboard]# kubectl  create -f .
serviceaccount/admin-user created
clusterrolebinding.rbac.authorization.k8s.io/admin-user created
namespace/kubernetes-dashboard created
serviceaccount/kubernetes-dashboard created
service/kubernetes-dashboard created
secret/kubernetes-dashboard-certs created
secret/kubernetes-dashboard-csrf created
secret/kubernetes-dashboard-key-holder created
configmap/kubernetes-dashboard-settings created
role.rbac.authorization.k8s.io/kubernetes-dashboard created
clusterrole.rbac.authorization.k8s.io/kubernetes-dashboard created
rolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created
clusterrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created
deployment.apps/kubernetes-dashboard created
service/dashboard-metrics-scraper created
deployment.apps/dashboard-metrics-scraper created
</pre>
</div>
</div>
</div>
<div id="outline-container-h:74e9f102-f096-4362-870b-aebfb272c81b" class="outline-4">
<h4 id="h:74e9f102-f096-4362-870b-aebfb272c81b">å®‰è£…æœ€æ–°ç‰ˆ</h4>
<div class="outline-text-4" id="text-h:74e9f102-f096-4362-870b-aebfb272c81b">
<p>
å®˜æ–¹GitHubåœ°å€ï¼š<a href="https://github.com/kubernetes/dashboard">https://github.com/kubernetes/dashboard</a><br>
å¯ä»¥åœ¨å®˜æ–¹dashboardæŸ¥çœ‹åˆ°æœ€æ–°ç‰ˆdashboard<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.5.0/aio/deploy/recommended.yaml
</pre>
</div>

<p>
2.5.0 ä»¥å…·ä½“ç‰ˆæœ¬å·ä¸ºå‡†<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">vim admin.yaml

apiVersion: v1
kind: ServiceAccount
metadata:
  name: admin-user
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding 
metadata: 
  name: admin-user
  annotations:
    rbac.authorization.kubernetes.io/autoupdate: <span style="color: #8b2252;">"true"</span>
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: admin-user
  namespace: kube-system

<span style="color: #b22222;"># </span><span style="color: #b22222;">kubectl apply -f admin.yaml -n kube-system  </span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:f2f505b0-689f-4bc7-8ac8-47ff0671f247" class="outline-4">
<h4 id="h:f2f505b0-689f-4bc7-8ac8-47ff0671f247">ç™»å½•dashboard</h4>
<div class="outline-text-4" id="text-h:f2f505b0-689f-4bc7-8ac8-47ff0671f247">
<p>
åœ¨è°·æ­Œæµè§ˆå™¨ï¼ˆChromeï¼‰å¯åŠ¨å¿«æ·æ–¹å¼æ–‡ä»¶ä¸­åŠ å…¥å¯åŠ¨å‚æ•°ï¼Œç”¨äºè§£å†³æ— æ³•è®¿é—®Dashboardçš„é—®é¢˜ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312;&#26368;&#21518;&#38754;&#21152;</span>
--test-type --ignore-certificate-errors
</pre>
</div>

<p>
æ›´æ”¹dashboardçš„svcä¸ºNodePortï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">kubectl edit svc kubernetes-dashboard -n kubernetes-dashboard
</pre>
</div>
<p>
å°†ClusterIPæ›´æ”¹ä¸ºNodePortï¼ˆå¦‚æœå·²ç»ä¸ºNodePortå¿½ç•¥æ­¤æ­¥éª¤)ï¼š<br>
</p>

<p>
æŸ¥çœ‹ç«¯å£å·ï¼š<br>
#+end_src<br>
kubectl get svc kubernetes-dashboard -n kubernetes-dashboard<br>
#+end_src<br>
</p>

<p>
æ ¹æ®è‡ªå·±çš„å®ä¾‹ç«¯å£å·ï¼Œé€šè¿‡ä»»æ„å®‰è£…äº†kube-proxyçš„å®¿ä¸»æœºæˆ–è€…VIPçš„IP+ç«¯å£å³å¯è®¿é—®åˆ°dashboardï¼š<br>
è®¿é—®Dashboardï¼š[<a href="https://192.168.0.236:18282">https://192.168.0.236:18282</a>](<a href="https://192.168.0.236:18282/">https://192.168.0.236:18282/</a>)ï¼ˆè¯·æ›´æ”¹18282ä¸ºè‡ªå·±çš„ç«¯å£ï¼‰ï¼Œé€‰æ‹©ç™»å½•æ–¹å¼ä¸ºä»¤ç‰Œï¼ˆå³tokenæ–¹å¼)<br>
</p>

<p>
æŸ¥çœ‹tokenå€¼ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 1.1.1]# kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk <span style="color: #8b2252;">'{print $1}'</span>)
token:  xxxxxx
</pre>
</div>

<p>
å°†tokenå€¼è¾“å…¥åˆ°ä»¤ç‰Œåï¼Œå•å‡»ç™»å½•å³å¯è®¿é—®Dashboard<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;&#25152;&#26377;&#23481;&#22120;&#29366;&#24577;</span>
[root@k8s-master01 dashboard]# kubectl get po -A
NAMESPACE              NAME                                         READY   STATUS    RESTARTS   AGE
kube-system            calico-kube-controllers-5f6d4b864b-khq4h     1/1     Running   0          16m
kube-system            calico-node-5tvxh                            1/1     Running   0          16m
kube-system            calico-node-kffn7                            1/1     Running   0          16m
kube-system            calico-node-lltfs                            1/1     Running   0          16m
kube-system            calico-node-nhgn8                            1/1     Running   0          16m
kube-system            coredns-54d67798b7-8w5hd                     1/1     Running   0          121m
kube-system            coredns-54d67798b7-vb2ll                     1/1     Running   0          121m
kube-system            etcd-k8s-master01                            1/1     Running   0          121m
kube-system            etcd-k8s-master02                            1/1     Running   0          107m
kube-system            kube-apiserver-k8s-master01                  1/1     Running   0          121m
kube-system            kube-apiserver-k8s-master02                  1/1     Running   0          107m
kube-system            kube-controller-manager-k8s-master01         1/1     Running   1          121m
kube-system            kube-controller-manager-k8s-master02         1/1     Running   0          107m
kube-system            kube-proxy-5bws8                             1/1     Running   0          121m
kube-system            kube-proxy-pbqjc                             1/1     Running   0          107m
kube-system            kube-proxy-tpwbt                             1/1     Running   0          90m
kube-system            kube-proxy-vbpc5                             1/1     Running   0          90m
kube-system            kube-scheduler-k8s-master01                  1/1     Running   1          121m
kube-system            kube-scheduler-k8s-master02                  1/1     Running   0          107m
kube-system            metrics-server-545b8b99c6-hkgnz              1/1     Running   0          6m25s
kubernetes-dashboard   dashboard-metrics-scraper-7645f69d8c-hftvd   1/1     Running   0          2m31s
kubernetes-dashboard   kubernetes-dashboard-78cb679857-zksm9        1/1     Running   0          2m32s
</pre>
</div>

<p>
æ›´æ”¹dashboardçš„svcä¸ºNodePort<br>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;type&#30340;ClusterIP&#26356;&#25913;&#20026;NodePort&#65288;&#22914;&#26524;&#24050;&#32463;&#20026;NodePort&#24573;&#30053;&#27492;&#27493;&#39588;&#65289;&#65306;</span>
[root@k8s-master01 dashboard]# kubectl edit svc kubernetes-dashboard -n kubernetes-dashboard
<span style="color: #483d8b;">type</span>: NodePort
</pre>
</div>
</div>
</div>
<div id="outline-container-h:4b3aa559-88a7-41e0-84ca-6e978c07e578" class="outline-4">
<h4 id="h:4b3aa559-88a7-41e0-84ca-6e978c07e578">dashboardçš„å¦ä¸€ç§é€‰æ‹©</h4>
<div class="outline-text-4" id="text-h:4b3aa559-88a7-41e0-84ca-6e978c07e578">
<p>
www.kuboard.cn<br>
</p>

<p>
<a href="https://www.kuboard.cn/install/v3/install-in-k8s.html#%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4">https://www.kuboard.cn/install/v3/install-in-k8s.html#%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4</a><br>
</p>
</div>
</div>
</div>
</section>
<section id="outline-container-h:7239c867-fe95-49e4-ad97-78862adb1563" class="outline-2">
<h2 id="h:7239c867-fe95-49e4-ad97-78862adb1563">æ”¶å°¾å·¥ä½œ</h2>
<div class="outline-text-2" id="text-h:7239c867-fe95-49e4-ad97-78862adb1563">
</div>
<div id="outline-container-h:fcda1230-1f4a-46bc-83ed-2da4cf0d1b39" class="outline-3">
<h3 id="h:fcda1230-1f4a-46bc-83ed-2da4cf0d1b39">ä¸€äº›å¿…é¡»çš„é…ç½®æ›´æ”¹</h3>
<div class="outline-text-3" id="text-h:fcda1230-1f4a-46bc-83ed-2da4cf0d1b39">
<p>
å°† Kube-proxy æ”¹ä¸ºipvsæ¨¡å¼ï¼Œå› ä¸ºåœ¨åˆå§‹åŒ–é›†ç¾¤çš„æ—¶å€™æ³¨é‡Šäº† ipvsé…ç½®ï¼Œæ‰€ä»¥éœ€è¦è‡ªè¡Œä¿®æ”¹ä¸€ä¸‹ï¼š<br>
</p>

<p>
åœ¨master01èŠ‚ç‚¹æ‰§è¡Œ<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;&#21407;&#26469;&#30340;mode&#27169;&#24335;</span>
[root@k8s-master01 ~]# curl 127.0.0.1:10249/proxyMode
iptables

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;</span>
[root@k8s-master01 ~]# kubectl edit cm kube-proxy -n kube-system
mode: <span style="color: #8b2252;">"ipvs"</span>  <span style="color: #b22222;"># </span><span style="color: #b22222;">44&#34892;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26356;&#26032;Kube-Proxy&#30340;Pod</span>
[root@k8s-master01 ~]# kubectl patch daemonset kube-proxy -p <span style="color: #8b2252;">"{\"spec\":{\"template\":{\"metadata\":{\"annotations\":{\"date\":\"`date +'%s'`\"}}}}}"</span> -n kube-system
daemonset.apps/kube-proxy patched

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20877;&#27425;&#26597;&#30475;mode&#27169;&#24335;</span>
[root@k8s-master01 ~]# curl 127.0.0.1:10249/proxyMode
ipvs
</pre>
</div>
</div>
</div>
<div id="outline-container-h:739033d5-1c6a-4b43-b750-378cb34ae156" class="outline-3">
<h3 id="h:739033d5-1c6a-4b43-b750-378cb34ae156">æ³¨æ„äº‹é¡¹</h3>
<div class="outline-text-3" id="text-h:739033d5-1c6a-4b43-b750-378cb34ae156">
<p>
æ³¨æ„ï¼škubeadmå®‰è£…çš„é›†ç¾¤ï¼Œè¯ä¹¦æœ‰æ•ˆæœŸé»˜è®¤æ˜¯ä¸€å¹´ã€‚masterèŠ‚ç‚¹çš„kube-apiserverã€kube-schedulerã€kube-controller-managerã€etcdéƒ½æ˜¯ä»¥å®¹å™¨è¿è¡Œçš„ã€‚å¯ä»¥é€šè¿‡kubectl get po -n kube-systemæŸ¥çœ‹ã€‚<br>
</p>

<p>
å¯åŠ¨å’ŒäºŒè¿›åˆ¶ä¸åŒçš„æ˜¯ï¼Œkubeletçš„é…ç½®æ–‡ä»¶åœ¨/etc/sysconfig/kubeletå’Œ/var/lib/kubelet/config.yaml<br>
</p>

<p>
å…¶ä»–ç»„ä»¶çš„é…ç½®æ–‡ä»¶åœ¨/etc/Kubernetes/manifestsç›®å½•ä¸‹ï¼Œæ¯”å¦‚kube-apiserver.yamlï¼Œè¯¥yamlæ–‡ä»¶æ›´æ”¹åï¼Œkubeletä¼šè‡ªåŠ¨åˆ·æ–°é…ç½®ï¼Œä¹Ÿå°±æ˜¯ä¼šé‡å¯podã€‚ä¸èƒ½å†æ¬¡åˆ›å»ºè¯¥æ–‡ä»¶ã€‚å¦‚æœä¸æƒ³ç­‰å¯é‡å¯ kubelet<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">systemctl restart kubelet
</pre>
</div>

<p>
kube-proxyçš„é…ç½®åœ¨kube-systemå‘½åç©ºé—´ä¸‹çš„configmapä¸­ï¼Œå¯ä»¥é€šè¿‡<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">kubectl edit cm kube-proxy -n kube-system
</pre>
</div>

<p>
è¿›è¡Œæ›´æ”¹ï¼Œæ›´æ”¹å®Œæˆåï¼Œå¯ä»¥é€šè¿‡patché‡å¯kube-proxy<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">kubectl patch daemonset kube-proxy -p <span style="color: #8b2252;">"{\"spec\":{\"template\":{\"metadata\":{\"annotations\":{\"date\":\"`date +'%s'`\"}}}}}"</span> -n kube-system
</pre>
</div>

<p>
Kubeadmå®‰è£…åï¼ŒmasterèŠ‚ç‚¹é»˜è®¤ä¸å…è®¸éƒ¨ç½²podï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ‰“å¼€ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;Taints&#65306;</span>
[root@k8s-master01 ~]# kubectl describe node -l node-role.kubernetes.io/master= | grep Taints
Taints:             node-role.kubernetes.io/master:NoSchedule
Taints:             node-role.kubernetes.io/master:NoSchedule
Taints:       node-role.kubernetes.io/master:NoSchedule

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21024;&#38500;Taint&#65306;</span>
[root@k8s-master01 ~]# kubectl taint node -l node-role.kubernetes.io/master node-role.kubernetes.io/master:NoSchedule-
node/k8s-master01 untainted
node/k8s-master02 untainted
node/k8s-master03 untainted

[root@k8s-master01 ~]# kubectl describe node -l node-role.kubernetes.io/master= | grep Taints
Taints:       &lt;none&gt;
Taints:       &lt;none&gt;
Taints:       &lt;none&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a4b8287b-e1f0-4a76-8651-121b261a6273" class="outline-3">
<h3 id="h:a4b8287b-e1f0-4a76-8651-121b261a6273">é›†ç¾¤æ£€æµ‹</h3>
<div class="outline-text-3" id="text-h:a4b8287b-e1f0-4a76-8651-121b261a6273">
<div class="org-src-container">
<pre class="src src-shell">kubectl get po --al-namespaces

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#30417;&#25511;&#25968;&#25454;</span>
kubectl top po -n kube-system

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#32593;&#32476;</span>
kubectl get svc  <span style="color: #b22222;"># </span><span style="color: #b22222;">k8s&#30340;svc&#19968;&#33324;&#20026; servic ip &#27573;&#30340;&#31532;&#19968;&#20010; ip</span>
kubectl get svc -n kube-system <span style="color: #b22222;"># </span><span style="color: #b22222;">coredns &#19968;&#33324;&#20026; cluster ip &#30340;&#31532; 10 &#20010; ip</span>

telnet 10.96.0.1 443
telnet 10.96.0.10 53

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#39564;&#35777;&#36328;&#26381;&#21153;&#22120;&#35775;&#38382; pod &#26159;&#21542;&#36890;</span>
kubectl get po --all-namespaces -owide

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#28982;&#21518;&#20854;&#20182;&#33410;&#28857;&#21435;&#35775;&#38382;</span>
ping 172.168.32.130

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#39564;&#35777;pod&#20043;&#38388;&#26159;&#21542;&#36890;</span>
kubectl get po --all-namespaces -owide
kubectl exec -it calico-node-qxs56 -n kube-system -- sh <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36827;&#20837;&#23481;&#22120;&#20869;&#35775;&#38382;</span>
ping 172.168.32.130

<span style="color: #b22222;"># </span><span style="color: #b22222;">dashboard</span>
kubectl get po -n kubernetes-dashboard
kubectl get svc -n kubernetes-dashboard

kubectl edit svc  kubernetes-dashboard -n kubernetes-dashboard
<span style="color: #483d8b;">type</span>: NodePort <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#20026; NodePort</span>
kubectl get po -n kubernetes-dashboard
https://192.168.0.107:32534 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27983;&#35272;&#22120;&#35775;&#38382;</span>


</pre>
</div>
</div>
</div>
<div id="outline-container-h:e95f990c-63ec-4d6e-95b7-4025a17487ca" class="outline-3">
<h3 id="h:e95f990c-63ec-4d6e-95b7-4025a17487ca">åˆ é™¤é›†ç¾¤</h3>
<div class="outline-text-3" id="text-h:e95f990c-63ec-4d6e-95b7-4025a17487ca">
<div class="org-src-container">
<pre class="src src-shell">systemctl stop containerd kubelet
rm -fr /etc/kubernetes
rm -f /var/lib/containerd /var/lib/kubelet
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a6a25d02-e454-4664-a352-2d4452b0af06" class="outline-3">
<h3 id="h:a6a25d02-e454-4664-a352-2d4452b0af06">kubeadm è¯ä¹¦æ›´æ–°</h3>
<div class="outline-text-3" id="text-h:a6a25d02-e454-4664-a352-2d4452b0af06">
<p>
<a href="https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-certs/">https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/kubeadm-certs/</a><br>
</p>

<p>
ä½¿ç”¨kubeadmåˆ›å»ºçš„é›†ç¾¤é»˜è®¤è¯ä¹¦æœ‰æ•ˆæœŸä¸º1å¹´ï¼Œæ‰€ä»¥è¦åŠæ—¶æ›´æ–°è¯ä¹¦ã€‚æˆ–è€…é‡æ–°ç¼–è¯‘æºç æ¥è®¾ç½®è¯ä¹¦æ—¶é—´<br>
</p>

<p>
ç”Ÿäº§ç¯å¢ƒæ¨èä¸€å¹´æ›´æ–°ä¸€æ¬¡ kubernetes ç‰ˆæœ¬ã€‚<br>
</p>
</div>
<div id="outline-container-h:54aaad72-6794-4141-afda-04d8f36e4f88" class="outline-4">
<h4 id="h:54aaad72-6794-4141-afda-04d8f36e4f88">æ›´æ–°ä¸€å¹´</h4>
<div class="outline-text-4" id="text-h:54aaad72-6794-4141-afda-04d8f36e4f88">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26816;&#26597; kubeadm &#31649;&#29702;&#30340;&#26412;&#22320; PKI &#20013;&#35777;&#20070;&#30340;&#21040;&#26399;&#26102;&#38388;</span>
kubeadm certs check-expiration 

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26816;&#26597;&#35777;&#20070;&#36807;&#26399;&#26102;&#38388;</span>
kubeadm alpha certs check-expiration

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26356;&#26032;&#35777;&#20070;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22791;&#20221;&#38598;&#32676;&#37197;&#32622;</span>
kubectl -n kube-system get cm kubeadm-config -o yaml &gt; kubeadm-config.yaml
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26356;&#26032;&#35777;&#20070;</span>
kubeadm alpha certs renew all

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20877;&#27425;&#26816;&#26597;&#35777;&#20070;</span>
kubeadm alpha certs check-expiration

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37325;&#21551; kubelet &#26381;&#21153;</span>
systemctl restart kubelet
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26356;&#26032;&#37197;&#32622;</span>
cp /etc/kubernetes/admin.conf ~/.kube/config
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#39564;&#35777;&#38598;&#32676;</span>
kubectl get node
</pre>
</div>
</div>
</div>
<div id="outline-container-h:4d59fc88-cb69-4cb8-b2cc-a523b99051e2" class="outline-4">
<h4 id="h:4d59fc88-cb69-4cb8-b2cc-a523b99051e2">æ›´æ–°ä¸º 99 å¹´</h4>
<div class="outline-text-4" id="text-h:4d59fc88-cb69-4cb8-b2cc-a523b99051e2">
<p>
ä¿®æ”¹æºç <br>
</p>

<div class="org-src-container">
<pre class="src src-shell">kubeadm version
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#36733;&#28304;&#30721;&#65292;&#20999;&#25442;&#38598;&#32676;&#19968;&#33268;&#30340;&#29256;&#26412;</span>
git clone https://gitee.com/mirrors/kubernetes.git 
git checkout v1.26.0
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#37325;&#26032;&#32534;&#35793;</span>
docker run -it --rm -v <span style="color: #ff00ff;">`pwd`</span>:/go/src/ registry.cn-beijing.aliyuncs.com/dotbalo/golang:kubeadm bash
<span style="color: #483d8b;">cd</span> /go/src
go env -w <span style="color: #a0522d;">GOPROXY</span>=https://goproxy.cn,direct
go env -w <span style="color: #a0522d;">GOSUMDB</span>=off
grep <span style="color: #8b2252;">"365"</span> cmd/kubeadm/app/constants/constants.go
sed -i <span style="color: #8b2252;">'s@365@365 * 100@g'</span> cmd/kubeadm/app/constants/constants.go
grep <span style="color: #8b2252;">'365'</span>  cmd/kubeadm/app/constants/constants.go
mkdir -p _output/
chmod 777 -R _output/
make <span style="color: #a0522d;">WHAT</span>=cmd/kubeadm
cp _output/bin/kubeadm ./kubeadm

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26356;&#26032;&#35777;&#20070;&#65292;&#21508;&#20010; mater &#33410;&#28857;&#25805;&#20316;</span>
cp ./kubeadm /opt/
/opt/kubeadm verson
/opt/kubeadm certs renew all
kubeadm certs check-expiration
systemctl restart kubelet
</pre>
</div>
</div>
</div>
</div>
</section>
</main class="container">
<footer id="postamble" class="status">
<footer data-astro-cid-sz7xmlte data-turbo-permanent id=rootFooter>
    <script>
        const shuffle = e => e.map((e => ({
            v: e,
            sort: Math.random()
        }))).sort(( (e, o) => e.sort - o.sort)).map(( ({v: e}) => e));
        var songList = ["barbie-girl--stantough", "blue-da-ba-dee--cornelius-link", "hips-dont-lie--stantough", "i-want-it-that-way--stantough", "seven-nation-army--stantough", "smooth-criminal--stantough"]
          , songOrder = songOrder ?? shuffle(songList).map((e => `/audio/music/${e}.opus`))
          , song = new Audio(songOrder[0])
          , nextSong = new Audio(songOrder[1])
          , songIndex = 2
          , musicWrapper = void 0
          , arrow = void 0
          , notes = void 0;
        song.addEventListener("ended", next);
        const toggle = () => song.paused ? play() : pause();
        function play() {
            song.play(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.add("shakeManHorse"),
            notes.classList.remove("hideNotes")
        }
        function pause() {
            song.pause(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.remove("shakeManHorse"),
            notes.classList.add("hideNotes")
        }
        function next() {
            song = nextSong,
            play(),
            songIndex === songOrder.length && (songIndex = 0),
            nextSong = new Audio(songOrder[songIndex]),
            songIndex += 1
        }
        function skip() {
            pause(),
            (arrow = arrow || document.getElementById("musicArrow")).classList.add("shootArrow");
            new Audio("/audio/effects/ohno.m4a").play(),
            arrow.addEventListener("animationend", arrowShootHandler, !1)
        }
        function arrowShootHandler() {
            arrow.removeEventListener("animationend", arrowShootHandler, !1),
            arrow.classList.remove("shootArrow");
            new Audio("/audio/effects/heythathurt.m4a").play(),
            next()
        }
    </script>
    <div id=musicPlayer data-astro-cid-q7a5pyro>
        <button class=skip data-astro-cid-q7a5pyro onclick=skip() title="Skip song">
            <div id=skipWrapper data-astro-cid-q7a5pyro>
                <img alt="Medieval drollery of a man/snail/bat/monkey shooting an arrow" class=archer decoding=async height=334 loading=lazy src=/images/archer-no-arrow.448ccd8b_Z1KfRYq.webp width=226 data-astro-cid-q7a5pyro>
                <img alt="Arrow for archer" class="arrow complete" decoding=async height=23 loading=lazy src=/images/no-archer-full-arrow.87aa9971_Z2qL2KO.webp width=141 data-astro-cid-q7a5pyro id=musicArrow>
            </div>
        </button>
        <button class=playPause data-astro-cid-q7a5pyro onclick=toggle() title="Play/pause song">
            <div id=musicWrapper data-astro-cid-q7a5pyro>
                <div class=hideNotes id=notesWrapper data-astro-cid-q7a5pyro>
                    <div class=lyreNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                    <div class=fluteNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                </div>
                <img alt="Medieval drollery of a man/horse playing a lyre and a horn" class=manHorse decoding=async height=665 loading=lazy src=/images/man-horse-band.e3a2efcf_q8FCa.webp width=531 data-astro-cid-q7a5pyro>
            </div>
        </button>
    </div>
    <hr data-astro-cid-sz7xmlte>
    <div class=salutation data-astro-cid-gdmrbrho>
        <p data-astro-cid-gdmrbrho>
            <span class=flower2 data-astro-cid-gdmrbrho>A</span>
            <span class=smallcap data-astro-cid-gdmrbrho>pax vobiscum</span>
            <span class="flower2 wiggle" data-astro-cid-gdmrbrho id=leaf>a</span>
        </p>
    </div>
    <script>
        function animateLeafBlownHandler() {
            leaf.removeEventListener("animationend", animateLeafBlownHandler, !1),
            leaf.classList.remove("blownAway"),
            leaf.classList.add("wiggle")
        }
        function animateLeaf() {
            leaf = leaf ?? document.getElementById("leaf"),
            leaf.classList.remove("wiggle"),
            leaf.classList.add("blownAway"),
            leaf.addEventListener("animationend", animateLeafBlownHandler, !1)
        }
        document.getElementById("leaf").onclick = animateLeaf
    </script>


    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>æ‰“èµ</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Â© 2024 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
</footer>
</footer>
</body>
</html>
