<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kubernetes: k8s é«˜çº§ç¯‡-äº‘åŸç”Ÿå­˜å‚¨åŠå­˜å‚¨è¿›é˜¶</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/font.css"/>
<link rel="stylesheet" type="text/css" href="/static/drollery.e825b870.css"/>
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
</head>
<body>
<header id="preamble" class="status">
<header class="{className}" data-astro-cid-3ef6ksr2>
  <div class=header-branding data-astro-cid-g2lrb5xm>
      <span class=header-text data-astro-cid-g2lrb5xm>
          <span class=dropcap data-astro-cid-g2lrb5xm aria-hidden=true>
              <span class=actual data-astro-cid-g2lrb5xm>J</span>
              <span class=rest data-astro-cid-g2lrb5xm>asper Hsu</span>
              <span class=period data-astro-cid-g2lrb5xm>.</span>
          </span>
          <span class=sr-only data-astro-cid-g2lrb5xm>Drollery</span>
      </span>
      <img alt="Medieval drollery of a knight on a horse" class=spring decoding=async height=250 loading=lazy src=/images/knight-horse.a96eee7d_Z1WCOYs.webp width=68 data-astro-cid-g2lrb5xm>
  </div>

  <nav data-astro-cid-pux6a34n>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/jcodelog.html class=nobracket data-astro-cid-pux6a34n>æŠ€æœ¯</a>
      <span class=flower2 data-astro-cid-pux6a34n>K</span>
      <a href=/reading/index.html class=nobracket data-astro-cid-pux6a34n>é˜…è¯»</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
      <a href=/lisp/jasper-emacs.html class=nobracket data-astro-cid-pux6a34n>æˆ‘çš„Emacsé…ç½®</a>
      <span class=flower2 data-astro-cid-pux6a34n>L</span>
      <a href=/link/index.html class=nobracket data-astro-cid-pux6a34n>å‹é“¾</a>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/about.html class=nobracket data-astro-cid-pux6a34n>å…³äº</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
  </nav>


  <div class="container" data-astro-cid-3ef6ksr2>
    <p class="info" data-astro-cid-3ef6ksr2>
              ğŸ† æ¬¢è¿æ¥åˆ°æœ¬ç«™ï¼š
              <a href="https://xuchangwei.com/">https://xuchangwei.com/</a>ã€‚
              <strong>å¸Œæœ›è¿™é‡Œæœ‰ä½ æ„Ÿå…´è¶£çš„å†…å®¹</strong>ã€‚
            </p>
  </div>
  <div id=borderArtWrapper class="tt1" data-astro-cid-5hce7sga data-turbo-permanent>
      <script>
          var man, shakeCount = 0, noSound = new Audio("/audio/effects/no.m4a"), screamSound = new Audio("/audio/effects/scream.m4a");
          function animateManShakeHandler() {
              man.removeEventListener("animationend", animateManShakeHandler, !1),
              shakeCount += 1,
              man.classList.remove("shakeMan")
          }
          function animateManFallHandler() {
              man.removeEventListener("animationend", animateManFallHandler, !1),
              man.classList.add("hide")
          }
          function animateMan() {
              man = man ?? document.getElementById("borderMan"),
              3 === shakeCount ? (man.classList.add("fallMan"),
              screamSound.play(),
              man.addEventListener("animationend", animateManFallHandler, !1)) : (man.classList.add("shakeMan"),
              noSound.play(),
              man.addEventListener("animationend", animateManShakeHandler, !1))
          }
      </script>
      <div class=borderArt data-astro-cid-5dda5nwp id=articleBorder>
          <img alt="flowery border with man falling" decoding=async height=620 loading=lazy src=/images/border-vines-no-man.b7d246cc_DRxSe.webp width=909 class=border data-astro-cid-5dda5nwp>
          <div class=fallWrapper data-astro-cid-5dda5nwp>
              <img alt="flowery border with man falling" decoding=async height=292 loading=lazy src=/images/man-no-vines.247a3187_Z2ioXNM.webp width=98 class=man data-astro-cid-5dda5nwp id=borderMan onclick=animateMan()>
          </div>
      </div>
  </div>
</header>
</header>
<main class="container" id="content" class="content">
<header>
<h1 class="title">Kubernetes: k8s é«˜çº§ç¯‡-äº‘åŸç”Ÿå­˜å‚¨åŠå­˜å‚¨è¿›é˜¶</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org61f3605">äº‘åŸç”Ÿå­˜å‚¨åŠå­˜å‚¨è¿›é˜¶</a>
<ul>
<li><a href="#orge6ac0a1">äº‘åŸç”Ÿå­˜å‚¨</a>
<ul>
<li><a href="#orgb6fa781">ä»€ä¹ˆæ˜¯ StorageClass å’Œ CSI</a>
<ul>
<li><a href="#org7a0697e">Volume å›é¡¾</a></li>
<li><a href="#org4a0c804">åŠ¨æ€å­˜å‚¨</a></li>
</ul>
</li>
<li><a href="#org6fff0d4">ä»€ä¹ˆæ˜¯Rookï¼Ÿ</a></li>
<li><a href="#org372d9ac">Rook æ¶æ„</a></li>
<li><a href="#org15a55f5">éƒ¨ç½² Rook</a>
<ul>
<li><a href="#org8cd6d75">Rookå®‰è£…æ³¨æ„äº‹é¡¹</a></li>
<li><a href="#org9795717">å®éªŒç¯å¢ƒæœ€ä½é…ç½®</a></li>
<li><a href="#org3df16a7">éƒ¨ç½²Rook</a></li>
</ul>
</li>
<li><a href="#orgd207b23">ä½¿ç”¨ Rook æ­å»º Ceph é›†ç¾¤</a>
<ul>
<li><a href="#org46782ed">é…ç½®æ›´æ”¹</a></li>
<li><a href="#orgc34adcc">åˆ›å»ºCephé›†ç¾¤</a></li>
<li><a href="#org79cf81e">å®‰è£…ceph snapshotæ§åˆ¶å™¨</a></li>
</ul>
</li>
<li><a href="#org55b4fee">Ceph Dashboard å’Œå®¢æˆ·ç«¯å·¥å…·å®‰è£…</a>
<ul>
<li><a href="#orge3cc9ec">å®‰è£…cephå®¢æˆ·ç«¯å·¥å…·</a></li>
<li><a href="#org943495e">Ceph dashboard</a></li>
</ul>
</li>
<li><a href="#org1d91918">StorageClassåŠ¨æ€å­˜å‚¨-å—å­˜å‚¨</a>
<ul>
<li><a href="#org63c73c1">åˆ›å»ºStorageClasså’Œcephçš„å­˜å‚¨æ± </a></li>
<li><a href="#org6344ddf">æŒ‚è½½æµ‹è¯•-PVCç”³è¯·åŠ¨æ€PV</a></li>
<li><a href="#orga9a891a">StatefulSet volumeClaimTemplatesåŠ¨æ€å­˜å‚¨</a></li>
</ul>
</li>
<li><a href="#orge2ba87c">StorageClassåŠ¨æ€å­˜å‚¨-æ–‡ä»¶å…±äº«å‹å­˜å‚¨</a>
<ul>
<li><a href="#orgd32c2c9">åˆ›å»ºå…±äº«ç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿ</a></li>
<li><a href="#orgb5dc824">åˆ›å»ºå…±äº«ç±»å‹æ–‡ä»¶ç³»ç»Ÿçš„StorageClass</a></li>
<li><a href="#org2cda529">æ–‡ä»¶å…±äº«å‹å­˜å‚¨ä½¿ç”¨ç¤ºä¾‹</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgb9fbc31">å­˜å‚¨è¿›é˜¶</a>
<ul>
<li><a href="#org242af64">PVCåœ¨çº¿æ‰©å®¹</a>
<ul>
<li><a href="#orgc1c664d">æ‰©å®¹æ–‡ä»¶å…±äº«å‹PVC</a></li>
<li><a href="#org25521ad">æ‰©å®¹å—å­˜å‚¨</a></li>
</ul>
</li>
<li><a href="#org8999a08">PVC å¿«ç…§</a>
<ul>
<li><a href="#org4c8557d">å—å­˜å‚¨å¿«ç…§</a></li>
</ul>
</li>
<li><a href="#org50b9994">PVC æ•°æ®å›æ»š</a>
<ul>
<li><a href="#org1dd1917">æ–‡ä»¶å…±äº«ç±»å‹å¿«ç…§</a></li>
</ul>
</li>
<li><a href="#org66bbcce">PVCå…‹éš†</a></li>
<li><a href="#orge3826fe">Rook Cephé›†ç¾¤æ¸…ç†</a></li>
</ul>
</li>
<li><a href="#orga47362e">ceph åˆ›å»ºå’Œåˆ é™¤osd</a>
<ul>
<li><a href="#orgdc178ba">æ¦‚è¿°</a></li>
<li><a href="#org0c17528">åˆ›å»ºosd</a></li>
<li><a href="#org4eb8a70">åˆ é™¤osd</a></li>
</ul>
</li>
<li><a href="#org5a9c175">ceph_dashboard</a>
<ul>
<li><a href="#orgc59b6fb">dashboard</a>
<ul>
<li><a href="#orga74018c">å®‰è£…dashboardæ¨¡å—è½¯ä»¶åŒ…</a></li>
<li><a href="#org57b3812">å¯ç”¨dashboard</a></li>
<li><a href="#org9bde53f">é…ç½®dashboard</a></li>
<li><a href="#orgb39dfe0">ä¿®æ”¹è¯ä¹¦æˆ–è€…ä¿®æ”¹é…ç½®ä»¥åéœ€è¦é‡å¯dashboardæ¨¡å—æ¥ç”Ÿæ•ˆã€‚</a></li>
<li><a href="#org6f12ea6">ä¿®æ”¹dashboardç›‘å¬çš„ç«¯å£</a></li>
<li><a href="#org337f47c">ä¸ºdashboardæ·»åŠ `rgw`çš„ç®¡ç†å‡­æ®</a></li>
<li><a href="#org7c443fb">ç™»å½•</a></li>
</ul>
</li>
<li><a href="#org0ada7c8">å¯ç”¨Prometheusç›‘æ§æ¥å£</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../index.html">Kubernetes</a><br></li>
</ul>
<section id="outline-container-org61f3605" class="outline-2">
<h2 id="org61f3605">äº‘åŸç”Ÿå­˜å‚¨åŠå­˜å‚¨è¿›é˜¶</h2>
<div class="outline-text-2" id="text-org61f3605">
</div>
<div id="outline-container-orge6ac0a1" class="outline-3">
<h3 id="orge6ac0a1">äº‘åŸç”Ÿå­˜å‚¨</h3>
<div class="outline-text-3" id="text-orge6ac0a1">
</div>
<div id="outline-container-orgb6fa781" class="outline-4">
<h4 id="orgb6fa781">ä»€ä¹ˆæ˜¯ StorageClass å’Œ CSI</h4>
<div class="outline-text-4" id="text-orgb6fa781">
</div>
<div id="outline-container-org7a0697e" class="outline-5">
<h5 id="org7a0697e">Volume å›é¡¾</h5>
<div class="outline-text-5" id="text-org7a0697e">
<div class="org-src-container">
<pre class="src src-yaml">volumes:
- name: share-volume
  emptyDir: {}
  #medium: Memory
- name: timezone
  hostPath:
  path: /etc/timezone
  type: File
- name: nfs-volume
  nfs:
  server: 192.168.0.204
  path: /data/nfs/test-dp
</pre>
</div>

<p>
è¿˜æ˜¯æ¯”è¾ƒå¤æ‚ï¼Œä¸ºäº†é™ä½å¤æ‚åº¦å¼•ç”¨äº† PV/PVCã€‚é—ç•™äº†åŠ¨æ€å­˜å‚¨ StorageClass éƒ¨åˆ†ã€‚<br>
</p>


<figure id="orga3da91b">
<img src="./images/Snipaste_2022-09-15_23-05-56.png" alt="Snipaste_2022-09-15_23-05-56.png"><br>

</figure>

<p>
é›†ç¾¤çš„è§„æ¨¡å¾ˆå¤§çš„æ—¶å€™ï¼Œç®¡ç† pv ä¹Ÿæ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼ŒåŒ…æ‹¬åˆ›å»ºã€æ‰©å®¹ã€åˆ é™¤ã€å¿«ç…§ç­‰ã€‚<br>
</p>
</div>
</div>
<div id="outline-container-org4a0c804" class="outline-5">
<h5 id="org4a0c804">åŠ¨æ€å­˜å‚¨</h5>
<div class="outline-text-5" id="text-org4a0c804">
<p>
StorageClassï¼šå­˜å‚¨ç±»ï¼Œç”±K8sç®¡ç†å‘˜åˆ›å»ºï¼Œç”¨äºåŠ¨æ€PVçš„ç®¡ç†ï¼Œå¯ä»¥é“¾æ¥è‡³ä¸åŒçš„åç«¯å­˜å‚¨ï¼Œæ¯”å¦‚Cephã€GlusterFSç­‰ã€‚ä¹‹åå¯¹å­˜å‚¨çš„è¯·æ±‚å¯ä»¥æŒ‡å‘StorageClassï¼Œç„¶åStorageClassä¼šè‡ªåŠ¨çš„åˆ›å»ºã€åˆ é™¤PVã€‚<br>
</p>

<p>
å®ç°æ–¹å¼ï¼š<br>
</p>
<ul class="org-ul">
<li>in-tree: å†…ç½®äºK8sæ ¸å¿ƒä»£ç ï¼Œå¯¹äºå­˜å‚¨çš„ç®¡ç†ï¼Œéƒ½éœ€è¦ç¼–å†™ç›¸åº”çš„ä»£ç ã€‚<br></li>
<li>out-of-treeï¼šç”±å­˜å‚¨å‚å•†æä¾›ä¸€ä¸ªé©±åŠ¨ï¼ˆCSIæˆ–Flex Volumeï¼‰ï¼Œå®‰è£…åˆ°K8sé›†ç¾¤ï¼Œç„¶åStorageClassåªéœ€è¦é…ç½®è¯¥é©±åŠ¨å³å¯ï¼Œé©±åŠ¨å™¨ä¼šä»£æ›¿StorageClassç®¡ç†å­˜å‚¨ã€‚<br></li>
</ul>

<p>
å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://kubernetes.io/docs/concepts/storage/storage-classes/">https://kubernetes.io/docs/concepts/storage/storage-classes/</a><br>
</p>
</div>
</div>
</div>
<div id="outline-container-org6fff0d4" class="outline-4">
<h4 id="org6fff0d4">ä»€ä¹ˆæ˜¯Rookï¼Ÿ</h4>
<div class="outline-text-4" id="text-org6fff0d4">
<p>
Rook æ˜¯ä¸€ä¸ªè‡ªæˆ‘ç®¡ç†çš„åˆ†å¸ƒå¼å­˜å‚¨ç¼–æ’ç³»ç»Ÿï¼Œå®ƒæœ¬èº«å¹¶ä¸æ˜¯å­˜å‚¨ç³»ç»Ÿï¼Œåœ¨å­˜å‚¨å’Œ k8s ä¹‹å‰æ­å»ºäº†ä¸€ä¸ªæ¡¥æ¢ï¼Œä½¿å­˜å‚¨ç³»ç»Ÿçš„æ­å»ºæˆ–è€…ç»´æŠ¤å˜å¾—ç‰¹åˆ«ç®€å•ï¼ŒRook å°†åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿè½¬å˜ä¸ºè‡ªæˆ‘ç®¡ç†ã€è‡ªæˆ‘æ‰©å±•ã€è‡ªæˆ‘ä¿®å¤çš„å­˜å‚¨æœåŠ¡ã€‚å®ƒè®©ä¸€äº›å­˜å‚¨çš„æ“ä½œï¼Œæ¯”å¦‚éƒ¨ç½²ã€é…ç½®ã€æ‰©å®¹ã€å‡çº§ã€è¿ç§»ã€ç¾éš¾æ¢å¤ã€ç›‘è§†å’Œèµ„æºç®¡ç†å˜å¾—è‡ªåŠ¨åŒ–ï¼Œæ— éœ€äººå·¥å¤„ç†ã€‚å¹¶ä¸” Rook æ”¯æŒ CSIï¼Œå¯ä»¥åˆ©ç”¨ CSI åšä¸€äº› PVC çš„å¿«ç…§ã€æ‰©å®¹ã€å…‹éš†ç­‰æ“ä½œã€‚<br>
</p>

<p>
<a href="https://rook.io/">https://rook.io/</a><br>
</p>
</div>
</div>
<div id="outline-container-org372d9ac" class="outline-4">
<h4 id="org372d9ac">Rook æ¶æ„</h4>
<div class="outline-text-4" id="text-org372d9ac">

<figure id="org1903846">
<img src="./images/Snipaste_2022-10-09_18-17-26.png" alt="Snipaste_2022-10-09_18-17-26.png"><br>

</figure>

<p>
Rookç”±Operatorå’ŒClusterä¸¤éƒ¨åˆ†ç»„æˆï¼š<br>
</p>

<p>
Operatorï¼šç”±ä¸€äº›CRDå’Œä¸€ä¸ªAll in oneé•œåƒæ„æˆï¼ŒåŒ…å«åŒ…å«å¯åŠ¨å’Œç›‘æ§å­˜å‚¨ç³»ç»Ÿçš„æ‰€æœ‰åŠŸèƒ½ã€‚ä¸»è¦ç”¨äºæœ‰çŠ¶æ€çš„æœåŠ¡ï¼Œæˆ–è€…ç”¨äºæ¯”è¾ƒå¤æ‚åº”ç”¨çš„ç®¡ç†ã€‚<br>
Clusterï¼šè´Ÿè´£åˆ›å»ºCRDå¯¹è±¡ï¼ŒæŒ‡å®šç›¸å…³å‚æ•°ï¼ŒåŒ…æ‹¬cephé•œåƒã€å…ƒæ•°æ®æŒä¹…åŒ–ä½ç½®ã€ç£ç›˜ä½ç½®ã€dashboardç­‰ç­‰â€¦<br>
</p>

<p>
Rook:<br>
</p>
<ul class="org-ul">
<li>Agent: åœ¨æ¯ä¸ªå­˜å‚¨èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œç”¨äºé…ç½®ä¸€ä¸ªFlexVolumeæ’ä»¶ï¼Œå’Œk8sçš„å­˜å‚¨å·è¿›è¡Œé›†æˆã€‚æŒ‚è½½ç½‘ç»œå­˜å‚¨ã€åŠ è½½å­˜å‚¨å·ã€æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿã€‚<br></li>
<li>Discover: ç”¨äºæ£€æµ‹è¿æ¥åˆ°å­˜å‚¨èŠ‚ç‚¹ä¸Šçš„è®¾å¤‡ã€‚<br></li>
</ul>

<p>
Ceph:<br>
</p>
<ul class="org-ul">
<li>OSD: ç›´æ¥è¿æ¥æ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹çš„ç‰©ç†ç£ç›˜æˆ–è€…æ˜¯ç›®å½•ã€‚é›†ç¾¤çš„å‰¯æœ¬æ•°ï¼Œé«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ã€‚<br></li>
<li>Mon: é›†ç¾¤ç›‘æ§ï¼Œæ‰€æœ‰é›†ç¾¤çš„èŠ‚ç‚¹éƒ½ä¼šå‘Monæ±‡æŠ¥ï¼Œä»–è®°å½•äº†é›†ç¾¤çš„æ‹“æ‰‘ä»¥åŠæ•°æ®å­˜å‚¨ä½ç½®çš„ä¿¡æ¯ã€‚<br></li>
<li>MDS: å…ƒæ•°æ®æœåŠ¡å™¨ï¼Œè´Ÿè´£è·Ÿè¸ªæ–‡ä»¶å±‚æ¬¡ç»“æ„å¹¶å­˜å‚¨Cephå…ƒæ•°æ®ã€‚å¦‚æœç”¨çš„æ˜¯å¯¹è±¡å­˜å‚¨ã€å—å­˜å‚¨å°±ä¸ç”¨ mds äº†ã€‚<br></li>
<li>RGW: restful API æ¥å£<br></li>
<li>MGR: æä¾›é¢å¤–çš„ç›‘æ§å’Œç•Œé¢ã€‚<br></li>
</ul>


<figure id="org39ddc3e">
<img src="./images/image-20210601145255027.png" alt="image-20210601145255027.png"><br>

</figure>
</div>
</div>
<div id="outline-container-org15a55f5" class="outline-4">
<h4 id="org15a55f5">éƒ¨ç½² Rook</h4>
<div class="outline-text-4" id="text-org15a55f5">
</div>
<div id="outline-container-org8cd6d75" class="outline-5">
<h5 id="org8cd6d75">Rookå®‰è£…æ³¨æ„äº‹é¡¹</h5>
<div class="outline-text-5" id="text-org8cd6d75">
<ul class="org-ul">
<li>K8sé›†ç¾¤è‡³å°‘äº”ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å†…å­˜ä¸ä½äº5Gï¼ŒCPUä¸ä½äº2æ ¸<br></li>
<li>è‡³å°‘æœ‰ä¸‰ä¸ªå­˜å‚¨èŠ‚ç‚¹ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘æœ‰ä¸€ä¸ªè£¸ç›˜<br></li>
<li>K8sé›†ç¾¤æ‰€æœ‰çš„èŠ‚ç‚¹æ—¶é—´å¿…é¡»ä¸€è‡´<br></li>
</ul>

<p>
Rookå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://rook.io/docs/rook/v1.9/ceph-quickstart.html">https://rook.io/docs/rook/v1.9/ceph-quickstart.html</a><br>
</p>
</div>
</div>
<div id="outline-container-org9795717" class="outline-5">
<h5 id="org9795717">å®éªŒç¯å¢ƒæœ€ä½é…ç½®</h5>
<div class="outline-text-5" id="text-org9795717">
<ul class="org-ul">
<li>åšè¿™ä¸ªå®éªŒéœ€è¦é«˜é…ç½®ï¼Œæ¯ä¸ªèŠ‚ç‚¹é…ç½®ä¸èƒ½ä½äº**2æ ¸4G**<br></li>
<li>k8s 1.19ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¿«ç…§åŠŸèƒ½éœ€è¦å•ç‹¬å®‰è£…snapshotæ§åˆ¶å™¨<br></li>
<li>rookçš„ç‰ˆæœ¬å¤§äº1.3ï¼Œä¸è¦ä½¿ç”¨ç›®å½•åˆ›å»ºé›†ç¾¤ï¼Œè¦ä½¿ç”¨å•ç‹¬çš„è£¸ç›˜è¿›è¡Œåˆ›å»ºï¼Œä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç£ç›˜ï¼ŒæŒ‚è½½åˆ°å®¿ä¸»æœºï¼Œä¸è¿›è¡Œæ ¼å¼åŒ–ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚å¯¹äºçš„ç£ç›˜èŠ‚ç‚¹é…ç½®å¦‚ä¸‹<br></li>
</ul>

<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 ~]# fdisk -l   

Disk /dev/sda: 42.9 GB, 42949672960 bytes, 83886080 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x000d76eb

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *        2048     2099199     1048576   83  Linux
/dev/sda2         2099200    83886079    40893440   8e  Linux LVM

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26032;&#30340;&#30913;&#30424;</span>
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
</pre>
</div>
</div>
</div>
<div id="outline-container-org3df16a7" class="outline-5">
<h5 id="org3df16a7">éƒ¨ç½²Rook</h5>
<div class="outline-text-5" id="text-org3df16a7">
<p>
ä¸‹è½½Rookå®‰è£…æ–‡ä»¶ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 app]# git clone --single-branch --branch v1.5.3 https://github.com/rook/rook.git
</pre>
</div>

<p>
é…ç½®æ›´æ”¹ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 app]# cd rook/cluster/examples/kubernetes/ceph
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;Rook CSI&#38236;&#20687;&#22320;&#22336;&#65292;&#21407;&#26412;&#30340;&#22320;&#22336;&#21487;&#33021;&#26159;gcr&#30340;&#38236;&#20687;&#65292;&#20294;&#26159;gcr&#30340;&#38236;&#20687;&#26080;&#27861;&#34987;&#22269;&#20869;&#35775;&#38382;&#65292;&#25152;&#20197;&#38656;&#35201;&#21516;&#27493;gcr&#30340;&#38236;&#20687;&#21040;&#38463;&#37324;&#20113;&#38236;&#20687;&#20179;&#24211;&#65292;&#25991;&#26723;&#29256;&#26412;&#24050;&#32463;&#20026;&#22823;&#23478;&#23436;&#25104;&#21516;&#27493;&#65292;&#21487;&#20197;&#30452;&#25509;&#20462;&#25913;&#22914;&#19979;&#65306;</span>
[root@k8s-master01 ceph]# vim operator.yaml

<span style="color: #b22222;">#</span><span style="color: #b22222;">47-52&#34892;&#26356;&#25913;&#20026;&#65306;</span>
ROOK_CSI_CEPH_IMAGE: <span style="color: #8b2252;">"quay.io/cephcsi/cephcsi:v3.1.2"</span>
ROOK_CSI_REGISTRAR_IMAGE: <span style="color: #8b2252;">"registry.cn-beijing.aliyuncs.com/dotbalo/csi-node-driver-registrar:v2.0.1"</span>
ROOK_CSI_RESIZER_IMAGE: <span style="color: #8b2252;">"registry.cn-beijing.aliyuncs.com/dotbalo/csi-resizer:v1.0.0"</span>
ROOK_CSI_PROVISIONER_IMAGE: <span style="color: #8b2252;">"registry.cn-beijing.aliyuncs.com/dotbalo/csi-provisioner:v2.0.0"</span>
ROOK_CSI_SNAPSHOTTER_IMAGE: <span style="color: #8b2252;">"registry.cn-beijing.aliyuncs.com/dotbalo/csi-snapshotter:v3.0.0"</span>
ROOK_CSI_ATTACHER_IMAGE: <span style="color: #8b2252;">"registry.cn-beijing.aliyuncs.com/dotbalo/csi-attacher:v3.0.0"</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#26159;&#20854;&#20182;&#29256;&#26412;&#65292;&#38656;&#35201;&#33258;&#34892;&#21516;&#27493;&#65292;&#21516;&#27493;&#26041;&#27861;&#21487;&#20197;&#22312;&#32593;&#19978;&#25214;&#21040;&#30456;&#20851;&#25991;&#31456;&#12290;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36824;&#26159;operator&#25991;&#20214;&#65292;&#26032;&#29256;&#26412;rook&#40664;&#35748;&#20851;&#38381;&#20102;&#33258;&#21160;&#21457;&#29616;&#30913;&#30424;&#65292;&#21487;&#20197;&#25214;&#21040;ROOK_ENABLE_DISCOVERY_DAEMON&#25913;&#25104;true&#21363;&#21487;&#65306;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">ROOK_ENABLE_DISCOVERY_DAEMON&#25913;&#25104;true&#21363;&#21487;&#65306;</span>
- name: ROOK_ENABLE_DISCOVERY_DAEMON
          value: <span style="color: #8b2252;">"true"</span>
</pre>
</div>

<p>
éƒ¨ç½²rookï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">1&#12289;&#36827;&#21040;/rook/cluster/examples/kubernetes/ceph&#30446;&#24405;</span>
[root@k8s-master01 ceph]# pwd
/app/rook/cluster/examples/kubernetes/ceph

<span style="color: #b22222;"># </span><span style="color: #b22222;">2&#12289;&#37096;&#32626;</span>
[root@k8s-master01 ceph]# kubectl create -f crds.yaml -f common.yaml -f operator.yaml

<span style="color: #b22222;"># </span><span style="color: #b22222;">3&#12289;&#31561;&#24453;operator&#23481;&#22120;&#21644;discover&#23481;&#22120;&#21551;&#21160;&#65288;&#20840;&#37096;&#21464;&#25104;1/1  Running &#25165;&#21487;&#20197;&#21019;&#24314;Ceph&#38598;&#32676;&#65289;</span>
[root@k8s-master01 ceph]# kubectl get pod  -n rook-ceph -owide
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd207b23" class="outline-4">
<h4 id="orgd207b23">ä½¿ç”¨ Rook æ­å»º Ceph é›†ç¾¤</h4>
<div class="outline-text-4" id="text-orgd207b23">
<p>
ceph ç”Ÿäº§ç¯å¢ƒæœ‰æ¡ä»¶çš„è¯å»ºè®®ç”¨åŸç”Ÿå®‰è£…ï¼Œä¸å»ºè®®éƒ¨ç½²åœ¨ k8s å†…éƒ¨ã€‚<br>
</p>
</div>
<div id="outline-container-org46782ed" class="outline-5">
<h5 id="org46782ed">é…ç½®æ›´æ”¹</h5>
<div class="outline-text-5" id="text-org46782ed">
<p>
<b>ä¸»è¦æ›´æ”¹çš„æ˜¯osdèŠ‚ç‚¹æ‰€åœ¨çš„ä½ç½®</b><br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 ceph]# vim cluster.yaml 
<span style="color: #b22222;"># </span><span style="color: #b22222;">1&#12289;&#26356;&#25913;storage&#65288;&#33258;&#24049;&#25351;&#23450;&#20351;&#29992;&#30913;&#30424;&#30340;&#33410;&#28857;&#65289;</span>
***
&#21407;&#37197;&#32622;:
  storage: <span style="color: #b22222;"># </span><span style="color: #b22222;">cluster level storage configuration and selection</span>
    useAllNodes: true
    useAllDevices: true
&#26356;&#25913;&#20026;:
  storage: <span style="color: #b22222;"># </span><span style="color: #b22222;">cluster level storage configuration and selection</span>
    useAllNodes: false  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26159;&#21542;&#20351;&#29992;&#25152;&#26377;&#33410;&#28857;&#24403; osd</span>
    useAllDevices: false <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26159;&#21542;&#20351;&#29992;&#32553;&#20027;&#26426;&#19978;&#25152;&#26377;&#30340;&#30913;&#30424;</span>
***
     - name: <span style="color: #8b2252;">"k8s-master03"</span>
       devices:
       - name: <span style="color: #8b2252;">"sdb"</span>
     - name: <span style="color: #8b2252;">"k8s-node01"</span>
       devices:
       - name: <span style="color: #8b2252;">"sdb"</span>
     - name: <span style="color: #8b2252;">"k8s-node02"</span>
       devices:
       - name: <span style="color: #8b2252;">"sdb"</span>
***
</pre>
</div>


<figure id="orga6cff9f">
<img src="https://img2020.cnblogs.com/blog/1876212/202103/1876212-20210316000835378-373823316.png" alt="1876212-20210316000835378-373823316.png"><br>

</figure>

<p>
<b>æ³¨æ„ï¼šæ–°ç‰ˆå¿…é¡»é‡‡ç”¨è£¸ç›˜ï¼Œå³æœªæ ¼å¼åŒ–çš„ç£ç›˜ã€‚å…¶ä¸­k8s-master03 k8s-node01 node02æœ‰æ–°åŠ çš„ä¸€ä¸ªç£ç›˜ï¼Œå¯ä»¥é€šè¿‡lsblk -fæŸ¥çœ‹æ–°æ·»åŠ çš„ç£ç›˜åç§°ã€‚å»ºè®®æœ€å°‘ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œå¦åˆ™åé¢çš„è¯•éªŒå¯èƒ½ä¼šå‡ºç°é—®é¢˜</b><br>
</p>
</div>
</div>
<div id="outline-container-orgc34adcc" class="outline-5">
<h5 id="orgc34adcc">åˆ›å»ºCephé›†ç¾¤</h5>
<div class="outline-text-5" id="text-orgc34adcc">
<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 ceph]# kubectl create -f cluster.yaml
cephcluster.ceph.rook.io/rook-ceph created

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#23436;&#25104;&#21518;&#65292;&#21487;&#20197;&#26597;&#30475;pod&#30340;&#29366;&#24577;</span>
[root@k8s-master01 ceph]# kubectl -n rook-ceph get pod
</pre>
</div>
</div>
</div>
<div id="outline-container-org79cf81e" class="outline-5">
<h5 id="org79cf81e">å®‰è£…ceph snapshotæ§åˆ¶å™¨</h5>
<div class="outline-text-5" id="text-org79cf81e">
<p>
k8s 1.19ç‰ˆæœ¬ä»¥ä¸Šéœ€è¦å•ç‹¬å®‰è£…snapshotæ§åˆ¶å™¨ï¼Œæ‰èƒ½å®Œæˆpvcçš„å¿«ç…§åŠŸèƒ½ï¼Œæ‰€ä»¥åœ¨æ­¤æå‰å®‰è£…ä¸‹ï¼Œå¦‚æœæ˜¯1.19ä»¥ä¸‹ç‰ˆæœ¬ï¼Œä¸éœ€è¦å•ç‹¬å®‰è£…ã€‚<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">1&#12289;snapshot&#25511;&#21046;&#22120;&#30340;&#37096;&#32626;&#22312;&#38598;&#32676;&#23433;&#35013;&#26102;&#30340;k8s-ha-install&#39033;&#30446;&#20013;&#65292;&#38656;&#35201;&#20999;&#25442;&#21040;1.20.x&#20998;&#25903;</span>
[root@k8s-master01 ~]# cd /root/k8s-ha-install/
[root@k8s-master01 k8s-ha-install]# git checkout manual-installation-v1.20.x

<span style="color: #b22222;"># </span><span style="color: #b22222;">2&#12289;&#21019;&#24314;snapshot controller</span>
[root@k8s-master01 k8s-ha-install]# kubectl create -f snapshotter/ -n kube-system

<span style="color: #b22222;"># </span><span style="color: #b22222;">3&#12289;&#26597;&#30475;snapshot controller&#29366;&#24577;</span>
[root@k8s-master01 k8s-ha-install]# kubectl  get po -n kube-system -l <span style="color: #a0522d;">app</span>=snapshot-controller
NAME                    READY   STATUS    RESTARTS   AGE
snapshot-controller-0   1/1     Running   0          15s
</pre>
</div>

<p>
å…·ä½“æ–‡æ¡£ï¼š<a href="https://rook.io/docs/rook/v1.5/ceph-csi-snapshot.html">https://rook.io/docs/rook/v1.5/ceph-csi-snapshot.html</a><br>
</p>
</div>
</div>
</div>
<div id="outline-container-org55b4fee" class="outline-4">
<h4 id="org55b4fee">Ceph Dashboard å’Œå®¢æˆ·ç«¯å·¥å…·å®‰è£…</h4>
<div class="outline-text-4" id="text-org55b4fee">
</div>
<div id="outline-container-orge3cc9ec" class="outline-5">
<h5 id="orge3cc9ec">å®‰è£…cephå®¢æˆ·ç«¯å·¥å…·</h5>
<div class="outline-text-5" id="text-orge3cc9ec">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">1&#12289;&#23433;&#35013;</span>
[root@k8s-master01 ceph]# pwd
/app/rook/cluster/examples/kubernetes/ceph
[root@k8s-master01 ceph]# kubectl  create -f toolbox.yaml -n rook-ceph
deployment.apps/rook-ceph-tools created

<span style="color: #b22222;"># </span><span style="color: #b22222;">2&#12289;&#24453;&#23481;&#22120;Running&#21518;&#65292;&#21363;&#21487;&#25191;&#34892;&#30456;&#20851;&#21629;&#20196;</span>
[root@k8s-master01 ceph]# kubectl  get po -n rook-ceph -l <span style="color: #a0522d;">app</span>=rook-ceph-tools
NAME                               READY   STATUS    RESTARTS   AGE
rook-ceph-tools-6f7467bb4d-r9vqx   1/1     Running   0          31s

<span style="color: #b22222;"># </span><span style="color: #b22222;">3&#12289;&#25191;&#34892;&#21629;&#20196;ceph status</span>
[root@k8s-master01 ceph]# kubectl -n rook-ceph exec -it deploy/rook-ceph-tools -- bash
[root@rook-ceph-tools-6f7467bb4d-r9vqx /]# ceph status
  cluster:
    id:     83c11641-ca98-4054-b2e7-422e942befe6
    health: HEALTH_OK

  services:
    mon: 1 daemons, quorum a (age 43m)
    mgr: a(active, since 13m)
    osd: 3 osds: 3 up (since 18m), 3<span style="color: #a020f0;"> in</span> (since 44m)

  data:
    pools:   1 pools, 1 pgs
    objects: 0 objects, 0 B
    usage:   3.0 GiB used, 27 GiB / 30 GiB avail
    pgs:     1 active+clean

<span style="color: #b22222;"># </span><span style="color: #b22222;">4&#12289;&#25191;&#34892;&#21629;&#20196; </span>
[root@rook-ceph-tools-6f7467bb4d-r9vqx /]# ceph osd status
ID  HOST           USED  AVAIL  WR OPS  WR DATA  RD OPS  RD DATA  STATE      
 0  k8s-master03  1028M  9207M      0        0       0        0   exists,up  
 1  k8s-node01    1028M  9207M      0        0       0        0   exists,up  
 2  k8s-node02    1028M  9207M      0        0       0        0   exists,up 

<span style="color: #b22222;"># </span><span style="color: #b22222;">5&#12289;&#25191;&#34892;&#21629;&#20196;-&#26597;&#30475;&#29366;&#24577;</span>
[root@rook-ceph-tools-6f7467bb4d-r9vqx /]# ceph df
--- RAW STORAGE ---
CLASS  SIZE    AVAIL   USED    RAW USED  %RAW USED
hdd    30 GiB  27 GiB  14 MiB   3.0 GiB      10.05
TOTAL  30 GiB  27 GiB  14 MiB   3.0 GiB      10.05

--- POOLS ---
POOL                   ID  STORED  OBJECTS  USED  %USED  MAX AVAIL
device_health_metrics   1     0 B        0   0 B      0    8.5 GiB
</pre>
</div>
</div>
</div>
<div id="outline-container-org943495e" class="outline-5">
<h5 id="org943495e">Ceph dashboard</h5>
<div class="outline-text-5" id="text-org943495e">
</div>
<ul class="org-ul">
<li><a id="org1401f12"></a>æš´éœ²æœåŠ¡<br>
<div class="outline-text-6" id="text-org1401f12">
<p>
1ã€é»˜è®¤æƒ…å†µä¸‹ï¼Œceph dashboardæ˜¯æ‰“å¼€çš„ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ceph dashboardçš„service<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">
[root@k8s-master01 ceph]# kubectl -n rook-ceph get service rook-ceph-mgr-dashboard
NAME                      TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)    AGE
rook-ceph-mgr-dashboard   ClusterIP   10.97.5.123   &lt;none&gt;        8443/TCP   47m
</pre>
</div>

<p>
2ã€å¯ä»¥ä¸¤ç§æ–¹å¼è®¿é—®ï¼š<br>
</p>
<ul class="org-ul">
<li>å°†è¯¥serviceæ”¹ä¸ºNodePort<br></li>
<li>é€šè¿‡ingressä»£ç†<br></li>
</ul>

<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 ceph]# kubectl -n rook-ceph edit service rook-ceph-mgr-dashboard
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26356;&#25913;type&#31867;&#22411;&#21363;&#21487;</span>
<span style="color: #483d8b;">type</span>: NodePort

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35775;&#38382;&#12289;&#20219;&#24847;&#33410;&#28857;ip:port&#35775;&#38382;&#21363;&#21487;</span>
[root@k8s-master01 ceph]# kubectl -n rook-ceph get service rook-ceph-mgr-dashboard
NAME                      TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)          AGE
rook-ceph-mgr-dashboard   NodePort   10.97.5.123   &lt;none&gt;        8443:32202/TCP   49m
</pre>
</div>


<figure id="orgf9af3ed">
<img src="https://img2020.cnblogs.com/blog/1876212/202103/1876212-20210316000906458-1575569425.png" alt="1876212-20210316000906458-1575569425.png"><br>

</figure>


<p>
3ã€ç™»å½•ã€è´¦å·ä¸ºadminï¼ŒæŸ¥çœ‹å¯†ç <br>
</p>
<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 ~]# kubectl -n rook-ceph get secret rook-ceph-dashboard-password -o <span style="color: #a0522d;">jsonpath</span>=<span style="color: #8b2252;">"{['data']['password']}"</span> | base64 --decode &amp;&amp; <span style="color: #483d8b;">echo</span>
@}g<span style="color: #8b2252;">"P{-FVe9yb]-AV/&gt;3</span>
</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-org1d91918" class="outline-4">
<h4 id="org1d91918">StorageClassåŠ¨æ€å­˜å‚¨-å—å­˜å‚¨</h4>
<div class="outline-text-4" id="text-org1d91918">
<p>
å—å­˜å‚¨ä¸€èˆ¬ç”¨äºä¸€ä¸ªPodæŒ‚è½½ä¸€å—å­˜å‚¨ä½¿ç”¨ï¼Œç›¸å½“äºä¸€ä¸ªæœåŠ¡å™¨æ–°æŒ‚äº†ä¸€ä¸ªç›˜ï¼Œåªç»™ä¸€ä¸ªåº”ç”¨ä½¿ç”¨ã€‚<br>
</p>

<p>
å‚è€ƒæ–‡æ¡£ï¼š<a href="https://rook.io/docs/rook/v1.6/ceph-block.html">https://rook.io/docs/rook/v1.6/ceph-block.html</a><br>
</p>
</div>
<div id="outline-container-org63c73c1" class="outline-5">
<h5 id="org63c73c1">åˆ›å»ºStorageClasså’Œcephçš„å­˜å‚¨æ± </h5>
<div class="outline-text-5" id="text-org63c73c1">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">1&#12289;&#21019;&#24314;&#25991;&#20214;</span>
[root@k8s-master01 ~]# cd /app/rook/cluster/examples/kubernetes/ceph/
[root@k8s-master01 ceph]# vim storageclass.yaml
apiVersion: ceph.rook.io/v1
kind: CephBlockPool
metadata:
  name: replicapool
  namespace: rook-ceph
spec:
  failureDomain: host
  replicated:
    size: 3
---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
   name: rook-ceph-block
<span style="color: #b22222;"># </span><span style="color: #b22222;">Change "rook-ceph" provisioner prefix to match the operator namespace if needed</span>
provisioner: rook-ceph.rbd.csi.ceph.com
parameters:
    <span style="color: #b22222;"># </span><span style="color: #b22222;">clusterID is the namespace where the rook cluster is running</span>
    clusterID: rook-ceph
    <span style="color: #b22222;"># </span><span style="color: #b22222;">Ceph pool into which the RBD image shall be created</span>
    pool: replicapool

    imageFormat: <span style="color: #8b2252;">"2"</span>
    imageFeatures: layering
    csi.storage.k8s.io/provisioner-secret-name: rook-csi-rbd-provisioner
    csi.storage.k8s.io/provisioner-secret-namespace: rook-ceph
    csi.storage.k8s.io/controller-expand-secret-name: rook-csi-rbd-provisioner
    csi.storage.k8s.io/controller-expand-secret-namespace: rook-ceph
    csi.storage.k8s.io/node-stage-secret-name: rook-csi-rbd-node
    csi.storage.k8s.io/node-stage-secret-namespace: rook-ceph
    csi.storage.k8s.io/fstype: ext4

<span style="color: #b22222;"># </span><span style="color: #b22222;">Delete the rbd volume when a PVC is deleted</span>
reclaimPolicy: Delete

<span style="color: #b22222;"># </span><span style="color: #b22222;">2&#12289;&#21019;&#24314;&#22359;</span>
[root@k8s-master01 ceph]# kubectl create -f storageclass.yaml
cephblockpool.ceph.rook.io/replicapool created
storageclass.storage.k8s.io/rook-ceph-block created

<span style="color: #b22222;"># </span><span style="color: #b22222;">3&#12289;&#26597;&#30475;&#29366;&#24577;</span>
[root@k8s-master01 ceph]# kubectl get CephBlockPool -n rook-ceph
NAME          AGE
replicapool   2m14s
[root@k8s-master01 ceph]# kubectl  get sc
NAME              PROVISIONER                  RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
rook-ceph-block   rook-ceph.rbd.csi.ceph.com   Delete          Immediate           false                  2m47s
</pre>
</div>
</div>
<ul class="org-ul">
<li><a id="orgfc416b1"></a>æ­¤æ—¶å¯ä»¥åœ¨ceph dashboardæŸ¥çœ‹åˆ°æ”¹Poolï¼Œå¦‚æœæ²¡æœ‰æ˜¾ç¤ºè¯´æ˜æ²¡æœ‰åˆ›å»ºæˆåŠŸ<br>
<div class="outline-text-6" id="text-orgfc416b1">

<figure id="org1047599">
<img src="https://img2020.cnblogs.com/blog/1876212/202103/1876212-20210316000927745-2078751520.png" alt="1876212-20210316000927745-2078751520.png"><br>

</figure>
</div>
</li>
</ul>
</div>
<div id="outline-container-org6344ddf" class="outline-5">
<h5 id="org6344ddf">æŒ‚è½½æµ‹è¯•-PVCç”³è¯·åŠ¨æ€PV</h5>
<div class="outline-text-5" id="text-org6344ddf">
<p>
#+end_src<br>
åˆ›å»ºä¸€ä¸ªMySQLæœåŠ¡<br>
[root@k8s-master01 kubernetes]# pwd<br>
/app/rook/cluster/examples/kubernetes<br>
[root@k8s-master01 kubernetes]# kubectl create -f mysql.yaml<br>
[root@k8s-master01 kubernetes]# kubectl create -f wordpress.yaml<br>
</p>

<p>
[root@k8s-master01 kubernetes]# kubectl get svc wordpress<br>
NAME        TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE<br>
wordpress   LoadBalancer   10.109.161.119   &lt;pending&gt;     80:32301/TCP   3m57s<br>
#+end_src<br>
</p>

<p>
è¯¥æ–‡ä»¶æœ‰ä¸€æ®µpvcçš„é…ç½®<br>
</p>


<figure id="org9f4f36f">
<img src="https://img2020.cnblogs.com/blog/1876212/202103/1876212-20210316000944056-2027170856.png" alt="1876212-20210316000944056-2027170856.png"><br>

</figure>

<p>
pvcä¼šè¿æ¥åˆšæ‰åˆ›å»ºçš„storageClassï¼Œç„¶ååŠ¨æ€åˆ›å»ºpvï¼Œç„¶åè¿æ¥åˆ°cephåˆ›å»ºå¯¹åº”çš„å­˜å‚¨<br>
</p>

<p>
ä¹‹ååˆ›å»ºpvcåªéœ€è¦æŒ‡å®šstorageClassNameä¸ºåˆšæ‰åˆ›å»ºçš„StorageClassåç§°å³å¯è¿æ¥åˆ°rookçš„cephã€‚å¦‚æœæ˜¯statefulsetï¼Œåªéœ€è¦å°†volumeTemplateClaimé‡Œé¢çš„Claimåç§°æ”¹ä¸ºStorageClassåç§°å³å¯åŠ¨æ€åˆ›å»ºPodï¼Œå…·ä½“è¯·å¬è§†é¢‘ã€‚<br>
</p>

<p>
å…¶ä¸­MySQL deploymentçš„volumesé…ç½®æŒ‚è½½äº†è¯¥pvcï¼š<br>
</p>


<figure id="org3591c72">
<img src="https://img2020.cnblogs.com/blog/1876212/202103/1876212-20210316000956428-1487749740.png" alt="1876212-20210316000956428-1487749740.png"><br>

</figure>

<p>
claimNameä¸ºpvcçš„åç§°<br>
</p>

<p>
å› ä¸ºMySQLçš„æ•°æ®ä¸èƒ½å¤šä¸ªMySQLå®ä¾‹è¿æ¥åŒä¸€ä¸ªå­˜å‚¨ï¼Œæ‰€ä»¥ä¸€èˆ¬åªèƒ½ç”¨å—å­˜å‚¨ã€‚ç›¸å½“äºæ–°åŠ äº†ä¸€å—ç›˜ç»™MySQLä½¿ç”¨ã€‚<br>
</p>

<p>
åˆ›å»ºå®Œæˆåå¯ä»¥æŸ¥çœ‹åˆ›å»ºçš„pvcå’Œpv<br>
</p>

<p>
#+end_src shell<br>
[root@k8s-master01 kubernetes]# kubectl get pv<br>
NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                    STORAGECLASS      REASON   AGE<br>
pvc-1843c13e-09cb-46c6-9dd8-5f54a834681b   20Gi       RWO            Delete           Bound    default/mysql-pv-claim   rook-ceph-block            65m<br>
[root@k8s-master01 kubernetes]# kubectl get pvc<br>
NAME               STATUS    VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS      AGE<br>
mysql-pv-claim     Bound     pvc-1843c13e-09cb-46c6-9dd8-5f54a834681b   20Gi       RWO            rook-ceph-block   66m<br>
#+end_src<br>
</p>

<p>
æ­¤æ—¶åœ¨ceph dashboardä¸Šé¢ä¹Ÿå¯ä»¥æŸ¥çœ‹åˆ°å¯¹åº”çš„image<br>
</p>


<figure id="orgcc0a29f">
<img src="https://img2020.cnblogs.com/blog/1876212/202103/1876212-20210316001019585-1427726751.png" alt="1876212-20210316001019585-1427726751.png"><br>

</figure>
</div>
</div>
<div id="outline-container-orga9a891a" class="outline-5">
<h5 id="orga9a891a">StatefulSet volumeClaimTemplatesåŠ¨æ€å­˜å‚¨</h5>
<div class="outline-text-5" id="text-orga9a891a">
<p>
<a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/</a><br>
</p>

<p>
é€šè¿‡ä¸€ä¸ªæ¨¡æ¿ `volumeClaimTemplates`ä¸ºæ¯ä¸ª pod åˆ›å»ºä¸€ä¸ª pvcã€‚<br>
</p>
</div>
</div>
</div>
<div id="outline-container-orge2ba87c" class="outline-4">
<h4 id="orge2ba87c">StorageClassåŠ¨æ€å­˜å‚¨-æ–‡ä»¶å…±äº«å‹å­˜å‚¨</h4>
<div class="outline-text-4" id="text-orge2ba87c">
<p>
å…±äº«æ–‡ä»¶ç³»ç»Ÿä¸€èˆ¬ç”¨äºå¤šä¸ªPodå…±äº«ä¸€ä¸ªå­˜å‚¨<br>
</p>

<p>
å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://rook.io/docs/rook/v1.6/ceph-filesystem.html">https://rook.io/docs/rook/v1.6/ceph-filesystem.html</a><br>
</p>

<p>
é»˜è®¤æƒ…å†µä¸‹ï¼Œåªèƒ½ä½¿ç”¨Rookåˆ›å»ºä¸€ä¸ªå…±äº«æ–‡ä»¶ç³»ç»Ÿã€‚Cephä¸­çš„å¤šæ–‡ä»¶ç³»ç»Ÿæ”¯æŒä»è¢«è®¤ä¸ºæ˜¯å®éªŒæ€§çš„ï¼Œå¯ä»¥ä½¿ç”¨ä¸­`ROOK_ALLOW_MULTIPLE_FILESYSTEMS`å®šä¹‰çš„ç¯å¢ƒå˜é‡å¯ç”¨`operator.yaml`ã€‚<br>
</p>
</div>
<div id="outline-container-orgd32c2c9" class="outline-5">
<h5 id="orgd32c2c9">åˆ›å»ºå…±äº«ç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿ</h5>
<div class="outline-text-5" id="text-orgd32c2c9">
<p>
é€šè¿‡ä¸º`CephFilesystem`CRDä¸­çš„å…ƒæ•°æ®æ± ï¼Œæ•°æ®æ± å’Œå…ƒæ•°æ®æœåŠ¡å™¨æŒ‡å®šæ‰€éœ€çš„è®¾ç½®æ¥åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 kubernetes]# pwd
/app/rook/cluster/examples/kubernetes
[root@k8s-master01 kubernetes]# vim filesystem.yaml
apiVersion: ceph.rook.io/v1
kind: CephFilesystem
metadata:
  name: myfs
  namespace: rook-ceph
spec:
  metadataPool:   <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21407;&#25968;&#25454;&#21103;&#26412;&#25968;</span>
    replicated:
      size: 3
  dataPools:      <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25968;&#25454;&#21103;&#26412;&#25968;</span>
    - replicated:
        size: 3
  preserveFilesystemOnDelete: true
  metadataServer: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21407;&#25968;&#25454;&#26381;&#21153;&#21103;&#26412;&#25968;</span>
    activeCount: 1
    activeStandby: true  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21551;&#20102;&#20010;&#20174;&#33410;&#28857;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;</span>
[root@k8s-master01 kubernetes]# kubectl create -f filesystem.yaml
cephfilesystem.ceph.rook.io/myfs created

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;&#65292;&#19968;&#20010;&#20027;&#65292;&#19968;&#20010;&#22791;</span>
[root@k8s-master01 kubernetes]# kubectl -n rook-ceph get pod -l <span style="color: #a0522d;">app</span>=rook-ceph-mds
NAME                                    READY   STATUS    RESTARTS   AGE
rook-ceph-mds-myfs-a-5d8547c74d-vfvx2   1/1     Running   0          90s
rook-ceph-mds-myfs-b-766d84d7cb-wj7nd   1/1     Running   0          87s
</pre>
</div>
</div>
<ul class="org-ul">
<li><a id="orgc07d986"></a>ä¹Ÿå¯ä»¥åœ¨ceph dashboardä¸Šé¢æŸ¥çœ‹çŠ¶æ€<br>
<div class="outline-text-6" id="text-orgc07d986">

<figure id="orga84eca9">
<img src="https://img2020.cnblogs.com/blog/1876212/202103/1876212-20210316001034634-1043707680.png" alt="1876212-20210316001034634-1043707680.png"><br>

</figure>
</div>
</li>
</ul>
</div>
<div id="outline-container-orgb5dc824" class="outline-5">
<h5 id="orgb5dc824">åˆ›å»ºå…±äº«ç±»å‹æ–‡ä»¶ç³»ç»Ÿçš„StorageClass</h5>
<div class="outline-text-5" id="text-orgb5dc824">
<div class="org-src-container">
<pre class="src src-shell">&#23448;&#32593;&#65306;https://rook.io/docs/rook/v1.5/ceph-filesystem.html
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: rook-cephfs
<span style="color: #b22222;"># </span><span style="color: #b22222;">Change "rook-ceph" provisioner prefix to match the operator namespace if needed</span>
provisioner: rook-ceph.cephfs.csi.ceph.com
parameters:
  <span style="color: #b22222;"># </span><span style="color: #b22222;">clusterID is the namespace where operator is deployed.</span>
  clusterID: rook-ceph

  <span style="color: #b22222;"># </span><span style="color: #b22222;">CephFS filesystem name into which the volume shall be created</span>
  fsName: myfs

  <span style="color: #b22222;"># </span><span style="color: #b22222;">Ceph pool into which the volume shall be created</span>
  <span style="color: #b22222;"># </span><span style="color: #b22222;">Required for provisionVolume: "true"</span>
  pool: myfs-data0

  <span style="color: #b22222;"># </span><span style="color: #b22222;">Root path of an existing CephFS volume</span>
  <span style="color: #b22222;"># </span><span style="color: #b22222;">Required for provisionVolume: "false"</span>
  <span style="color: #b22222;"># </span><span style="color: #b22222;">rootPath: /absolute/path</span>

  <span style="color: #b22222;"># </span><span style="color: #b22222;">The secrets contain Ceph admin credentials. These are generated automatically by the operator</span>
  <span style="color: #b22222;"># </span><span style="color: #b22222;">in the same namespace as the cluster.</span>
  csi.storage.k8s.io/provisioner-secret-name: rook-csi-cephfs-provisioner
  csi.storage.k8s.io/provisioner-secret-namespace: rook-ceph
  csi.storage.k8s.io/controller-expand-secret-name: rook-csi-cephfs-provisioner
  csi.storage.k8s.io/controller-expand-secret-namespace: rook-ceph
  csi.storage.k8s.io/node-stage-secret-name: rook-csi-cephfs-node
  csi.storage.k8s.io/node-stage-secret-namespace: rook-ceph

reclaimPolicy: Delete
</pre>
</div>
</div>
</div>
<div id="outline-container-org2cda529" class="outline-5">
<h5 id="org2cda529">æ–‡ä»¶å…±äº«å‹å­˜å‚¨ä½¿ç”¨ç¤ºä¾‹</h5>
<div class="outline-text-5" id="text-org2cda529">
<p>
nginx<br>
</p>
<div class="org-src-container">
<pre class="src src-yaml">apiVersion: v1
kind: Service
metadata:
  name: nginx
  labels:
    app: nginx
spec:
  ports:
  - port: 80
    name: web
  selector:
    app: nginx
  type: ClusterIP
---
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: nginx-share-pvc
spec:
  storageClassName: rook-cephfs 
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 1Gi
---
apiVersion: apps/v1
kind: Deployment 
metadata:
  name: web
spec:
  selector:
    matchLabels:
      app: nginx # has to match .spec.template.metadata.labels
  replicas: 3 # by default is 1
  template:
    metadata:
      labels:
        app: nginx # has to match .spec.selector.matchLabels
    spec:
      containers:
      - name: nginx
        image: nginx 
        imagePullPolicy: IfNotPresent
        ports:
        - containerPort: 80
          name: web
        volumeMounts:
        - name: www
          mountPath: /usr/share/nginx/html
      volumes:
        - name: www
          persistentVolumeClaim:
            claimName: nginx-share-pvc
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb9fbc31" class="outline-3">
<h3 id="orgb9fbc31">å­˜å‚¨è¿›é˜¶</h3>
<div class="outline-text-3" id="text-orgb9fbc31">
</div>
<div id="outline-container-org242af64" class="outline-4">
<h4 id="org242af64">PVCåœ¨çº¿æ‰©å®¹</h4>
<div class="outline-text-4" id="text-org242af64">
<p>
æ–‡ä»¶å…±äº«ç±»å‹çš„PVCæ‰©å®¹éœ€è¦k8s 1.15+<br>
å—å­˜å‚¨ç±»å‹çš„PVCæ‰©å®¹éœ€è¦k8s 1.16+<br>
PVCæ‰©å®¹éœ€è¦å¼€å¯ExpandCSIVolumesï¼Œæ–°ç‰ˆæœ¬çš„k8så·²ç»é»˜è®¤æ‰“å¼€äº†è¿™ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥æŸ¥çœ‹è‡ªå·±çš„k8sç‰ˆæœ¬æ˜¯å¦å·²ç»é»˜è®¤æ‰“å¼€äº†è¯¥åŠŸèƒ½ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 kubernetes]# kube-apiserver -h |grep ExpandCSIVolumes 
<span style="color: #a0522d;">ExpandCSIVolumes</span>=true|false (BETA - <span style="color: #a0522d;">default</span>=true)
</pre>
</div>

<p>
å¦‚æœdefaultä¸ºtrueå°±ä¸éœ€è¦æ‰“å¼€æ­¤åŠŸèƒ½ï¼Œå¦‚æœdefaultä¸ºfalseï¼Œéœ€è¦å¼€å¯è¯¥åŠŸèƒ½ã€‚<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">$ kubectl get sc gp3 -oyaml
allowVolumeExpansion: true
</pre>
</div>
</div>
<div id="outline-container-orgc1c664d" class="outline-5">
<h5 id="orgc1c664d">æ‰©å®¹æ–‡ä»¶å…±äº«å‹PVC</h5>
<div class="outline-text-5" id="text-orgc1c664d">
<p>
å°†å¤§å°ä¿®æ”¹ä¸º2Giï¼Œä¹‹å‰æ˜¯1Gi.<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl  edit pvc cephfs-pvc -n kube-system

requests:
  storage: 2Gi
</pre>
</div>

<p>
æŸ¥çœ‹å®¹å™¨å†…æ˜¯å¦å·²ç»å®Œæˆæ‰©å®¹ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl  exec -ti kube-registry-66d4c7bf47-46bpq -n kube-system -- df -Th | grep <span style="color: #8b2252;">"/var/lib/registry"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org25521ad" class="outline-5">
<h5 id="org25521ad">æ‰©å®¹å—å­˜å‚¨</h5>
<div class="outline-text-5" id="text-org25521ad">
<p>
æ‰©å®¹æ­¥éª¤ç±»ä¼¼ï¼Œæ‰¾åˆ°PVCï¼Œç›´æ¥editå³å¯<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl  edit pvc mysql-pv-claim
</pre>
</div>
<p>
ä¹Ÿå¯ä»¥çœ‹åˆ°ceph dashboardçš„imageä¹Ÿå®Œæˆäº†æ‰©å®¹ï¼Œä½†æ˜¯pvcå’Œpodé‡Œé¢çš„çŠ¶æ€ä¼šæœ‰å»¶è¿Ÿï¼Œå¤§æ¦‚ç­‰å¾…5-10åˆ†é’Ÿåï¼Œå³å¯å®Œæˆæ‰©å®¹ï¼š<br>
</p>
</div>
</div>
</div>
<div id="outline-container-org8999a08" class="outline-4">
<h4 id="org8999a08">PVC å¿«ç…§</h4>
<div class="outline-text-4" id="text-org8999a08">
<p>
æ³¨æ„ï¼šPVCå¿«ç…§åŠŸèƒ½éœ€è¦k8s 1.17+<br>
</p>
</div>
<div id="outline-container-org4c8557d" class="outline-5">
<h5 id="org4c8557d">å—å­˜å‚¨å¿«ç…§</h5>
<div class="outline-text-5" id="text-org4c8557d">
</div>
<ul class="org-ul">
<li><a id="org6c1139b"></a>åˆ›å»º snapshotClass<br>
<div class="outline-text-6" id="text-org6c1139b">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">pwd</span>
/root/rook/cluster/examples/kubernetes/ceph/csi/rbd
<span style="color: #b22222;"># </span><span style="color: #b22222;">kubectl create -f snapshotclass.yaml </span>
</pre>
</div>
</div>
</li>
<li><a id="org80fede3"></a>åˆ›å»ºå¿«ç…§<br>
<div class="outline-text-6" id="text-org80fede3">
<p>
ä¿®æ”¹snapshot.yamlæ–‡ä»¶çš„source pvcä¸ºåˆ›å»ºçš„MySQL pvc<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshot
metadata:
  name: new-snapshot-test
spec:
  volumeSnapshotClassName: csi-hostpath-snapclass
  <span style="color: #483d8b;">source</span>:
    persistentVolumeClaimName: pvc-test

kubectl get volumesnapshot
</pre>
</div>
<p>
persistentVolumeClaimName æ˜¯ PersistentVolumeClaim æ•°æ®æºå¯¹å¿«ç…§çš„åç§°ã€‚ è¿™ä¸ªå­—æ®µæ˜¯åŠ¨æ€åˆ¶å¤‡å¿«ç…§ä¸­çš„å¿…å¡«å­—æ®µã€‚<br>
</p>

<p>
å·å¿«ç…§å¯ä»¥é€šè¿‡æŒ‡å®š VolumeSnapshotClass ä½¿ç”¨ volumeSnapshotClassName å±æ€§æ¥è¯·æ±‚ç‰¹å®šç±»ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé‚£ä¹ˆä½¿ç”¨é»˜è®¤ç±»ï¼ˆå¦‚æœæœ‰ï¼‰<br>
</p>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-org50b9994" class="outline-4">
<h4 id="org50b9994">PVC æ•°æ®å›æ»š</h4>
<div class="outline-text-4" id="text-org50b9994">
</div>
<ul class="org-ul">
<li><a id="org199e9ab"></a>æŒ‡å®šå¿«ç…§åˆ›å»ºPVC<br>
<div class="outline-text-6" id="text-org199e9ab">
<p>
å¦‚æœæƒ³è¦åˆ›å»ºä¸€ä¸ªå…·æœ‰æŸä¸ªæ•°æ®çš„PVCï¼Œå¯ä»¥ä»æŸä¸ªå¿«ç…§æ¢å¤ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 rbd]# cat pvc-restore.yaml 
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: rbd-pvc-restore
spec:
  storageClassName: rook-ceph-block
  dataSource:
    name: rbd-pvc-snapshot
    kind: VolumeSnapshot
    apiGroup: snapshot.storage.k8s.io
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 3Gi
[root@k8s-master01 rbd]# kubectl create -f pvc-restore.yaml 
persistentvolumeclaim/rbd-pvc-restore created
</pre>
</div>

<p>
æ³¨æ„ï¼šdataSourceä¸ºå¿«ç…§åç§°ï¼ŒstorageClassNameä¸ºæ–°å»ºpvcçš„storageClassï¼Œstorageçš„å¤§å°ä¸èƒ½ä½äºåŸpvcçš„å¤§å°<br>
</p>
</div>
</li>
<li><a id="org0a8fc75"></a>8.1.4 æ•°æ®æ ¡éªŒ<br>
<div class="outline-text-6" id="text-org0a8fc75">
<p>
åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼ŒæŒ‚è½½è¯¥PVCï¼ŒæŸ¥çœ‹æ˜¯å¦å«æœ‰ä¹‹å‰çš„æ–‡ä»¶ï¼š<br>
</p>
</div>
</li>
</ul>
<div id="outline-container-org1dd1917" class="outline-5">
<h5 id="org1dd1917">æ–‡ä»¶å…±äº«ç±»å‹å¿«ç…§</h5>
<div class="outline-text-5" id="text-org1dd1917">
<p>
æ“ä½œæ­¥éª¤å’Œå—å­˜å‚¨ç±»å‹æ— åŒºåˆ«ï¼Œå¯ä»¥å‚è€ƒï¼š<br>
<a href="https://rook.io/docs/rook/v1.6/ceph-csi-snapshot.html#cephfs-snapshots">https://rook.io/docs/rook/v1.6/ceph-csi-snapshot.html#cephfs-snapshots</a><br>
</p>
</div>
</div>
</div>
<div id="outline-container-org66bbcce" class="outline-4">
<h4 id="org66bbcce">PVCå…‹éš†</h4>
<div class="outline-text-4" id="text-org66bbcce">
<div class="org-src-container">
<pre class="src src-shell">[root@k8s-master01 rbd]# pwd
/root/rook/cluster/examples/kubernetes/ceph/csi/rbd
[root@k8s-master01 rbd]# cat pvc-clone.yaml 
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: rbd-pvc-clone
spec:
  storageClassName: rook-ceph-block
  dataSource:
    name: mysql-pv-claim
    kind: PersistentVolumeClaim
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 3Gi
[root@k8s-master01 rbd]# kubectl create -f pvc-clone.yaml 
persistentvolumeclaim/rbd-pvc-clone created
[root@k8s-master01 rbd]# kubectl  get pvc
NAME             STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS      AGE
mysql-pv-claim   Bound    pvc-fd8b9860-c0d4-4797-8e1d-1fab880bc9fc   3Gi        RWO            rook-ceph-block   110m
rbd-pvc-clone    Bound    pvc-6dda14c9-9d98-41e6-9d92-9d4ea382c614   3Gi        RWO            rook-ceph-block   4s
</pre>
</div>

<p>
éœ€è¦æ³¨æ„çš„æ˜¯pvc-clone.yamlçš„dataSourceçš„nameæ˜¯è¢«å…‹éš†çš„pvcåç§°ï¼Œåœ¨æ­¤æ˜¯mysql-pv-claimï¼ŒstorageClassNameä¸ºæ–°å»ºpvcçš„storageClassåç§°ï¼Œstorageä¸èƒ½å°äºä¹‹å‰pvcçš„å¤§å°ã€‚<br>
</p>
</div>
</div>
<div id="outline-container-orge3826fe" class="outline-4">
<h4 id="orge3826fe">Rook Cephé›†ç¾¤æ¸…ç†</h4>
<div class="outline-text-4" id="text-orge3826fe">
<p>
å¦‚æœRookè¦ç»§ç»­ä½¿ç”¨ï¼Œå¯ä»¥åªæ¸…ç†åˆ›å»ºçš„deployã€podã€pvcå³å¯ã€‚ä¹‹åå¯ä»¥ç›´æ¥æŠ•å…¥ä½¿ç”¨<br>
</p>

<p>
æ•°æ®æ¸…ç†æ­¥éª¤ï¼š<br>
1.é¦–å…ˆæ¸…ç†æŒ‚è½½äº†PVCå’ŒPodï¼Œå¯èƒ½éœ€è¦æ¸…ç†å•ç‹¬åˆ›å»ºçš„Podå’ŒDeploymentæˆ–è€…æ˜¯å…¶ä»–çš„é«˜çº§èµ„æº<br>
2.ä¹‹åæ¸…ç†PVCï¼Œæ¸…ç†æ‰æ‰€æœ‰é€šè¿‡ceph StorageClassåˆ›å»ºçš„PVCåï¼Œæœ€å¥½æ£€æŸ¥ä¸‹PVæ˜¯å¦è¢«æ¸…ç†<br>
3.ä¹‹åæ¸…ç†å¿«ç…§ï¼škubectl delete volumesnapshot XXXXXXXX<br>
4.ä¹‹åæ¸…ç†åˆ›å»ºçš„Poolï¼ŒåŒ…æ‹¬å—å­˜å‚¨å’Œæ–‡ä»¶å­˜å‚¨<br>
a)kubectl delete -n rook-ceph cephblockpool replicapool<br>
b)kubectl delete -n rook-ceph cephfilesystem myfs<br>
5.æ¸…ç†StorageClassï¼škubectl delete sc rook-ceph-block  rook-cephfs<br>
6.æ¸…ç†Cephé›†ç¾¤ï¼škubectl -n rook-ceph delete cephcluster rook-ceph<br>
7.åˆ é™¤Rookèµ„æºï¼š<br>
a)kubectl delete -f operator.yaml<br>
b)kubectl delete -f common.yaml<br>
c)kubectl delete -f crds.yaml<br>
8.å¦‚æœå¡ä½éœ€è¦å‚è€ƒRookçš„troubleshooting<br>
a)<a href="https://rook.io/docs/rook/v1.6/ceph-teardown.html#troubleshooting">https://rook.io/docs/rook/v1.6/ceph-teardown.html#troubleshooting</a><br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #a020f0;">for</span> CRD<span style="color: #a020f0;"> in</span> $(<span style="color: #ff00ff;">kubectl get crd -n rook-ceph | awk '/ceph.rook.io/ {print $1}'</span>); <span style="color: #a020f0;">do</span>     kubectl get -n rook-ceph <span style="color: #8b2252;">"$CRD"</span> -o name |     xargs -I {} kubectl patch {} --type merge -p <span style="color: #8b2252;">'{"metadata":{"finalizers": [null]}}'</span> -n rook-ceph; <span style="color: #a020f0;">done</span>
</pre>
</div>

<p>
9.æ¸…ç†æ•°æ®ç›®å½•å’Œç£ç›˜<br>
å‚è€ƒé“¾æ¥ï¼š<a href="https://rook.io/docs/rook/v1.6/ceph-teardown.html#delete-the-data-on-hosts">https://rook.io/docs/rook/v1.6/ceph-teardown.html#delete-the-data-on-hosts</a><br>
</p>


<p>
å‚è€ƒé“¾æ¥ï¼š<a href="https://rook.io/docs/rook/v1.6/ceph-teardown.html">https://rook.io/docs/rook/v1.6/ceph-teardown.html</a><br>
</p>
</div>
</div>
</div>
<div id="outline-container-orga47362e" class="outline-3">
<h3 id="orga47362e">ceph åˆ›å»ºå’Œåˆ é™¤osd</h3>
<div class="outline-text-3" id="text-orga47362e">
</div>
<div id="outline-container-orgdc178ba" class="outline-4">
<h4 id="orgdc178ba">æ¦‚è¿°</h4>
<div class="outline-text-4" id="text-orgdc178ba">
<p>
æœ¬æ¬¡ä¸»è¦æ˜¯ä½¿ç”¨ceph-deployå·¥å…·å’Œä½¿ç”¨cephçš„ç›¸å…³å‘½ä»¤å®ç°åœ¨ä¸»æœºä¸ŠæŒ‡å®šç£ç›˜åˆ›å»ºå’Œåˆ é™¤osdï¼Œæœ¬æ¬¡ä»¥ä¸»æœº172.16.1.96(ä¸»æœºåhadoop96)ä¸ºä¾‹ï¼Œæ­¤ä¸»æœºç³»ç»Ÿç›˜ä¸º/dev/sda, å…¶ä»–ç›˜æœ‰/dev/sdbã€/dev/sdcå’Œ/dev/sddï¼Œè¿™å‡ ä¸ªç›˜éƒ½æ˜¯è£¸ç£ç›˜ï¼Œç›®çš„æ˜¯ä½¿ç”¨è¿™å‡ ä¸ªç›˜çš„ç»„åˆåˆ›å»ºosdã€‚<br>
</p>

<p>
ç£ç›˜æƒ…å†µå¦‚ä¸‹å›¾ï¼š<br>
</p>


<figure id="org0185764">
<img src="https://images2015.cnblogs.com/blog/783788/201609/783788-20160904175239521-1686946267.png" alt="783788-20160904175239521-1686946267.png"><br>

</figure>
</div>
</div>
<div id="outline-container-org0c17528" class="outline-4">
<h4 id="org0c17528">åˆ›å»ºosd</h4>
<div class="outline-text-4" id="text-org0c17528">
<p>
ä½¿ç”¨ceph-deploy(å·¥å…·å®‰è£…åœ¨hadoop95ä¸Š)åˆ›å»ºosdï¼Œè¿™é‡Œåˆ›å»ºä¸¤ä¸ªosdï¼Œå…¶ä¸­ä¸€ä¸ªæ•°æ®å’Œæ—¥å¿—åœ¨åŒä¸€ä¸ªç£ç›˜ä¸Šï¼Œå¦å¤–çš„osdæ—¥å¿—è¢«ç‹¬ç«‹åˆ°å¦ä¸€ä¸ªç›˜ã€‚<br>
</p>

<p>
1ï¼‰æ•°æ®å’Œæ—¥å¿—åœ¨åŒä¸€ä¸ªç£ç›˜ä¸Š<br>
</p>

<p>
æ‰§è¡Œceph-deploy osd create hadoop96:/dev/sdb,ç„¶ååœ¨hadoop96ä¸ŠæŸ¥çœ‹å¦‚ä¸‹å›¾ï¼š<br>
</p>


<figure id="org74f474f">
<img src="https://images2015.cnblogs.com/blog/783788/201609/783788-20160904175317242-282324371.png" alt="783788-20160904175317242-282324371.png"><br>

</figure>

<p>
è¿›å…¥/var/lib/ceph/osd/ceph-4ç›®å½•æŸ¥çœ‹<br>
<img src="https://images2015.cnblogs.com/blog/783788/201609/783788-20160904175437232-1469720757.png" alt="783788-20160904175437232-1469720757.png"><br>
</p>

<p>
å¦‚ä¸Šå›¾å¯çŸ¥æ—¥å¿—ç›®å½•è¢«é“¾æ¥åˆ°/dev/disk/by-partuuid/17f23e99-13dc-4a15-827b-745213c5c3ddï¼Œæˆ‘ä»¬æŸ¥çœ‹/dev/disk/by-partuuid/17f23e99-13dc-4a15-827b-745213c5c3ddï¼Œå¦‚ä¸‹å›¾ï¼š<br>
<img src="https://images2015.cnblogs.com/blog/783788/201609/783788-20160904175501843-1020885679.png" alt="783788-20160904175501843-1020885679.png"><br>
</p>

<p>
è¯´æ˜/dev/sdb2è¢«ä½œä¸ºæ—¥å¿—çš„åˆ†åŒºä½¿ç”¨ï¼Œæ‰€ä»¥æ–°åˆ›å»ºçš„osd.4é»˜è®¤æ•°æ®å’Œæ—¥å¿—éƒ½åœ¨åŒä¸€ä¸ªç£ç›˜/dev/sdbä¸Šä¸åŒåˆ†åŒºã€‚<br>
</p>

<p>
2ï¼‰osdæ—¥å¿—è¢«ç‹¬ç«‹åˆ°å¦ä¸€ä¸ªç›˜<br>
</p>

<p>
æ‰§è¡Œceph-deploy osd create hadoop96:/dev/sdc:/dev/sdd,ç„¶ååœ¨hadoop96ä¸ŠæŸ¥çœ‹å¦‚ä¸‹å›¾ï¼š<br>
</p>


<figure id="org56bac0a">
<img src="https://images2015.cnblogs.com/blog/783788/201609/783788-20160904175523110-976061614.png" alt="783788-20160904175523110-976061614.png"><br>

</figure>

<p>
è¿›å…¥/var/lib/ceph/osd/ceph-5ç›®å½•æŸ¥çœ‹<br>
</p>


<figure id="org900dc8d">
<img src="https://images2015.cnblogs.com/blog/783788/201609/783788-20160904175544503-1729354002.png" alt="783788-20160904175544503-1729354002.png"><br>

</figure>

<p>
å¦‚ä¸Šå›¾å¯çŸ¥æ—¥å¿—ç›®å½•è¢«é“¾æ¥åˆ°/dev/disk/by-partuuid/96eb886f-4095-4cb4-90fc-2976a8869cc1ï¼Œæˆ‘ä»¬æŸ¥çœ‹/dev/disk/by-partuuid/96eb886f-4095-4cb4-90fc-2976a8869cc1ï¼Œå¦‚ä¸‹å›¾ï¼š<br>
</p>


<figure id="orge3ac4fc">
<img src="https://images2015.cnblogs.com/blog/783788/201609/783788-20160904175608801-540347639.png" alt="783788-20160904175608801-540347639.png"><br>

</figure>

<p>
è¯´æ˜/dev/sdd1è¢«ä½œä¸ºæ—¥å¿—çš„åˆ†åŒºä½¿ç”¨ï¼Œæ‰€ä»¥æ–°åˆ›å»ºçš„osd.5æ•°æ®åœ¨/dev/sdc1ï¼Œè€Œæ—¥å¿—åˆ™ç‹¬ç«‹åœ¨å¦ä¸€ä¸ªç£ç›˜çš„åˆ†åŒº/dev/sdd1ã€‚<br>
</p>
</div>
</div>
<div id="outline-container-org4eb8a70" class="outline-4">
<h4 id="org4eb8a70">åˆ é™¤osd</h4>
<div class="outline-text-4" id="text-org4eb8a70">
<p>
åˆ é™¤ä¸Šé¢åˆ›å»ºçš„osdã€‚<br>
</p>

<p>
1ï¼‰æ•°æ®å’Œæ—¥å¿—åœ¨åŒä¸€ä¸ªç£ç›˜ä¸Šçš„osd<br>
</p>

<p>
å°†osd.4è¸¢å‡ºé›†ç¾¤ï¼Œæ‰§è¡Œceph osd out 4<br>
</p>


<figure id="orgf8c42f9">
<img src="https://images2015.cnblogs.com/blog/783788/201609/783788-20160904175639381-848421704.png" alt="783788-20160904175639381-848421704.png"><br>

</figure>

<p>
åœæ­¢æ­¤osdè¿›ç¨‹ï¼Œæ‰§è¡Œsystemctl stop [ceph-osd@4](<a href="mailto:ceph-osd@4">mailto:ceph-osd@4</a>)<br>
</p>


<figure id="org6fbc5ce">
<img src="https://images2015.cnblogs.com/blog/783788/201609/783788-20160904175703008-870995157.png" alt="783788-20160904175703008-870995157.png"><br>

</figure>

<p>
ç„¶åæ‰§è¡Œï¼šceph osd crush remove osd.4,æ­¤æ—¶osd.4å·²ç»ä¸å†osd treeä¸­äº†<br>
</p>


<figure id="org7cbea62">
<img src="https://images2015.cnblogs.com/blog/783788/201609/783788-20160904175731541-537365184.png" alt="783788-20160904175731541-537365184.png"><br>

</figure>

<p>
æ‰§è¡Œceph auth del osd.4 å’Œ ceph osd rm 4, æ­¤æ—¶åˆ é™¤æˆåŠŸä½†æ˜¯åŸæ¥çš„æ•°æ®å’Œæ—¥å¿—ç›®å½•è¿˜åœ¨ï¼Œä¹Ÿå°±æ˜¯æ•°æ®è¿˜åœ¨<br>
</p>


<figure id="org36f7d34">
<img src="https://images2015.cnblogs.com/blog/783788/201609/783788-20160904175756215-41672508.png" alt="783788-20160904175756215-41672508.png"><br>

</figure>

<p>
æ­¤æ—¶æˆ‘ä»¬å°†/dev/sdb1ç£ç›˜umount,ç„¶åå°†ç£ç›˜è¿›è¡Œæ“¦é™¤é‚£ä¹ˆæ•°æ®å°±ä¼šè¢«å®Œå…¨åˆ é™¤äº†ï¼Œæ‰§è¡Œumount /dev/sdb,ç„¶åæ‰§è¡Œceph-disk zap /dev/sdb<br>
</p>


<figure id="orga8b1bcd">
<img src="https://images2015.cnblogs.com/blog/783788/201609/783788-20160904175817248-1475982247.png" alt="783788-20160904175817248-1475982247.png"><br>

</figure>

<p>
è¿™æ—¶/dev/sdbåˆæˆä¸ºè£¸ç£ç›˜äº†ï¼Œä¹Ÿå°±ç›¸å½“äºå½»åº•åˆ é™¤äº†osd.4ã€‚<br>
</p>

<p>
2)åˆ é™¤æ—¥å¿—è¢«ç‹¬ç«‹åˆ°å¦ä¸€ä¸ªç›˜çš„osd<br>
</p>

<p>
æ‰§è¡Œæ­¥éª¤å’Œä¹‹å‰ç±»ä¼¼ã€‚<br>
</p>

<p>
å°†osd.5è¸¢å‡ºé›†ç¾¤ï¼Œæ‰§è¡Œceph osd out 5<br>
</p>


<figure id="orgebb253d">
<img src="https://images2015.cnblogs.com/blog/783788/201609/783788-20160904175841937-1715352757.png" alt="783788-20160904175841937-1715352757.png"><br>

</figure>

<p>
åœæ­¢æ­¤osdè¿›ç¨‹ï¼Œæ‰§è¡Œsystemctl stop [ceph-osd@](<a href="mailto:ceph-osd@4">mailto:ceph-osd@4</a>)5<br>
</p>


<figure id="org3f85327">
<img src="https://images2015.cnblogs.com/blog/783788/201609/783788-20160904175900704-1637160662.png" alt="783788-20160904175900704-1637160662.png"><br>

</figure>

<p>
ç„¶åæ‰§è¡Œï¼šceph osd crush remove osd.5,æ­¤æ—¶osd.5å·²ç»ä¸å†osd treeä¸­äº†<br>
</p>


<figure id="org8be90cd">
<img src="https://images2015.cnblogs.com/blog/783788/201609/783788-20160904175920893-487280110.png" alt="783788-20160904175920893-487280110.png"><br>

</figure>

<p>
æ‰§è¡Œceph auth del osd.5å’Œ ceph osd rm 5, æ­¤æ—¶åˆ é™¤æˆåŠŸä½†æ˜¯åŸæ¥çš„æ•°æ®å’Œæ—¥å¿—ç›®å½•è¿˜åœ¨ï¼Œä¹Ÿå°±æ˜¯æ•°æ®è¿˜åœ¨<br>
</p>


<figure id="org2016b21">
<img src="https://images2015.cnblogs.com/blog/783788/201609/783788-20160904175942176-1122923600.png" alt="783788-20160904175942176-1122923600.png"><br>

</figure>

<p>
æ­¤æ—¶æˆ‘ä»¬å°†/dev/sdc1ç£ç›˜umount,ç„¶åå°†ç£ç›˜è¿›è¡Œæ“¦é™¤é‚£ä¹ˆæ•°æ®å°±ä¼šè¢«å®Œå…¨åˆ é™¤äº†ï¼Œæ‰§è¡Œumount /dev/sdc1,ç„¶åæ‰§è¡Œceph-disk zap /dev/sdc<br>
</p>


<figure id="org40cdab1">
<img src="https://images2015.cnblogs.com/blog/783788/201609/783788-20160904180002427-751498531.png" alt="783788-20160904180002427-751498531.png"><br>

</figure>

<p>
è¿™æ—¶/dev/sdcåˆæˆä¸ºè£¸ç£ç›˜äº†ï¼Œä¹Ÿå°±ç›¸å½“äºå½»åº•åˆ é™¤äº†osd.5ï¼Œä½†æ˜¯åŸæ¥ä½œä¸ºæ—¥å¿—çš„åˆ†åŒº/dev/sdd1è¿˜åœ¨ï¼Œæ­¤æ—¶å¦‚æœsddæœ‰å¤šä¸ªåˆ†åŒºä½œä¸ºå…¶ä»–osdçš„æ—¥å¿—åˆ†åŒºé‚£ä¹ˆå°±ä¸èƒ½æ“¦é™¤/dev/sddç›˜ï¼Œä½†æ˜¯æ­¤æ—¶/dev/sdd1åˆ†åŒºå·²ç»æ²¡æœ‰è¢«osdä½¿ç”¨äº†æ‰€ä»¥å†åˆ›å»ºosdæ—¶è¦è®°å¾—å†åˆ©ç”¨ï¼Œç›®å‰æˆ‘è§‰å¾—åªèƒ½è¿™æ ·ã€‚<br>
</p>
</div>
</div>
</div>
<div id="outline-container-org5a9c175" class="outline-3">
<h3 id="org5a9c175">ceph_dashboard</h3>
<div class="outline-text-3" id="text-org5a9c175">
<p>
phä»ªè¡¨æ¿æ˜¯åŸºäºWebçš„å†…ç½®Cephç®¡ç†å’Œç›‘è§†åº”ç”¨ç¨‹åºï¼Œç”¨äºç®¡ç†é›†ç¾¤çš„å„ä¸ªæ–¹é¢å’Œå¯¹è±¡ã€‚å®ƒä½œä¸ºCeph Managerå®ˆæŠ¤ç¨‹åºçš„æ¨¡å—å®ç°ã€‚<br>
ä»Luminouså¼€å§‹ï¼ŒCeph æä¾›äº†åŸç”Ÿçš„DashboardåŠŸèƒ½ï¼Œé€šè¿‡Dashboardå¯ä»¥è·å–Cephé›†ç¾¤çš„å„ç§åŸºæœ¬çŠ¶æ€ä¿¡æ¯ï¼Œè€Œä¸”ç»è¿‡ä¸æ–­æ›´æ–°ï¼Œç°åœ¨å·²ç»æœ‰äº†å„ç§ç®¡ç†åŠŸèƒ½ã€‚<br>
</p>
</div>
<div id="outline-container-orgc59b6fb" class="outline-4">
<h4 id="orgc59b6fb">dashboard</h4>
<div class="outline-text-4" id="text-orgc59b6fb">
</div>
<div id="outline-container-orga74018c" class="outline-5">
<h5 id="orga74018c">å®‰è£…dashboardæ¨¡å—è½¯ä»¶åŒ…</h5>
<div class="outline-text-5" id="text-orga74018c">
<p>
`dashboard`ä½œä¸º`mgr`çš„æ¨¡å—å­˜åœ¨ï¼Œéœ€è¦å®‰è£…ä¸€ä¸‹æ¨¡å—çš„è½¯ä»¶åŒ…ã€‚<br>
</p>

<p>
åŒ…çš„åå­—å«åš: `ceph-mgr-dashboard`, ä½¿ç”¨cephçš„yumæºå®‰è£…å°±å¯ä»¥ã€‚<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">yum install ceph-mgr-dashboard -y
</pre>
</div>

<p>
æ‰€æœ‰`mgr`èŠ‚ç‚¹éƒ½éœ€è¦å®‰è£…ï¼Œä¸ç„¶åœ¨å¯ç”¨dashboardæ¨¡å—çš„æ—¶å€™ä¼šæŠ¥é”™:<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@cephnode1 ~]# ceph mgr module enable dashboardError ENOENT: all mgr daemons<span style="color: #a020f0;"> do</span> not support module <span style="color: #8b2252;">'dashboard'</span>, pass --force to force enablement
</pre>
</div>
</div>
</div>
<div id="outline-container-org57b3812" class="outline-5">
<h5 id="org57b3812">å¯ç”¨dashboard</h5>
<div class="outline-text-5" id="text-org57b3812">
<p>
å¯ä»¥ä½¿ç”¨`ceph mgr module ls` æŸ¥çœ‹ä¸€ä¸‹æ¨¡å—åˆ—è¡¨ã€‚è¿™ä¸ªåˆ—è¡¨è·Ÿå®‰æ²¡å®‰è£…`ceph-mgr-dashboard`æ²¡å…³ç³»ã€‚<br>
</p>

<p>
å¯ä»¥çœ‹åˆ°å¯ç”¨çš„æ¨¡å—é‡Œæ²¡æœ‰dashboard:<br>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8b2252;">"enabled_modules"</span>: [        <span style="color: #8b2252;">"iostat"</span>,        <span style="color: #8b2252;">"pg_autoscaler"</span>,        <span style="color: #8b2252;">"restful"</span>    ],
</pre>
</div>

<p>
æ‰§è¡Œ`ceph mgr module enable dashboard`æ¥å¯ç”¨dashboardã€‚<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@cephnode1 ~]# ceph mgr module enable dashboard
</pre>
</div>

<p>
å¯ç”¨ä»¥åå°±ä¼šæœ‰ç›‘å¬ç«¯å£äº†ï¼Œé»˜è®¤æ˜¯`8443`ã€‚<br>
</p>
</div>
</div>
<div id="outline-container-org9bde53f" class="outline-5">
<h5 id="org9bde53f">é…ç½®dashboard</h5>
<div class="outline-text-5" id="text-org9bde53f">
<p>
æä¾›è¯ä¹¦<br>
</p>

<p>
é»˜è®¤æƒ…å†µä¸‹ï¼Œdashboardæä¾›httpsè®¿é—®ã€‚æ‰€ä»¥éœ€è¦è¯ä¹¦ã€‚<br>
æœ‰ä¸‰ç§æ–¹å¼ï¼š<br>
ä¸€æ˜¯ä½¿ç”¨ceph dashboardç”Ÿæˆè‡ªç­¾åè¯ä¹¦ã€‚<br>
äºŒæ˜¯æŒ‡å®šæä¾›çš„è¯ä¹¦ã€‚<br>
ä¸‰æ˜¯ä¸ä½¿ç”¨httpsã€‚<br>
</p>

<ol class="org-ol">
<li>ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼š<br></li>
</ol>

<div class="org-src-container">
<pre class="src src-shell">[root@cephnode1 ~]# ceph dashboard create-self-signed-certSelf-signed certificate created
</pre>
</div>

<ol class="org-ol">
<li>æŒ‡å®šè¯ä¹¦<br></li>
</ol>

<div class="org-src-container">
<pre class="src src-shell">$ ceph dashboard set-ssl-certificate -i dashboard.crt$ ceph dashboard set-ssl-certificate-key -i dashboard.key
</pre>
</div>

<ol class="org-ol">
<li>å–æ¶ˆhttps<br></li>
</ol>

<div class="org-src-container">
<pre class="src src-shell">ceph config set mgr mgr/dashboard/ssl false
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb39dfe0" class="outline-5">
<h5 id="orgb39dfe0">ä¿®æ”¹è¯ä¹¦æˆ–è€…ä¿®æ”¹é…ç½®ä»¥åéœ€è¦é‡å¯dashboardæ¨¡å—æ¥ç”Ÿæ•ˆã€‚</h5>
<div class="outline-text-5" id="text-orgb39dfe0">
<div class="org-src-container">
<pre class="src src-shell">$ ceph mgr module disable dashboard$ ceph mgr module enable dashboard
</pre>
</div>
</div>
</div>
<div id="outline-container-org6f12ea6" class="outline-5">
<h5 id="org6f12ea6">ä¿®æ”¹dashboardç›‘å¬çš„ç«¯å£</h5>
<div class="outline-text-5" id="text-org6f12ea6">
<p>
é»˜è®¤æƒ…å†µä¸‹ï¼Œç›‘å¬æ‰€æœ‰åœ°å€çš„`8443`æˆ–`8080`<br>
</p>

<p>
ä¿®æ”¹ç›‘å¬çš„åœ°å€ä¸ç«¯å£ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">$ ceph config set mgr mgr/dashboard/server_addr $<span style="color: #a0522d;">IP</span>$ ceph config set mgr mgr/dashboard/server_port $<span style="color: #a0522d;">PORT</span>$ ceph config set mgr mgr/dashboard/ssl_server_port $<span style="color: #a0522d;">PORT</span>
</pre>
</div>

<p>
å¦‚ï¼Œä¿®æ”¹httpsç«¯å£ä¸º8843ã€‚<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@cephnode1 ~]# ceph config set mgr mgr/dashboard/ssl_server_port 8843# &#37325;&#21551;&#27169;&#22359;&#29983;&#25928;&#65292;&#21487;&#20197;&#30475;&#19968;&#19979;&#30417;&#21548;&#30340;&#31471;&#21475;&#26377;&#27809;&#26377;&#21464;&#21270;&#12290;[root@cephnode1 ~]# ceph mgr module disable dashboard[root@cephnode1 ~]# ceph mgr module enable dashboard
</pre>
</div>

<p>
ç™»å½•ç”¨æˆ·<br>
</p>

<p>
ä¸ºäº†èƒ½å¤Ÿç™»å½•ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªç”¨æˆ·å¸æˆ·å¹¶å°†å…¶ä¸è‡³å°‘ä¸€ä¸ªè§’è‰²ç›¸å…³è”ï¼Œ dashboardæä¾›äº†ä¸€ç»„å¯ä»¥ä½¿ç”¨çš„é¢„å®šä¹‰ç³»ç»Ÿè§’è‰²ã€‚å¦‚`administrator`è¡¨ç¤ºç®¡ç†å‘˜ã€‚<br>
</p>

<p>
è¦åˆ›å»ºå…·æœ‰ç®¡ç†å‘˜è§’è‰²çš„ç”¨æˆ·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">$ ceph dashboard ac-user-create &lt;username&gt; &lt;password&gt; administrator
</pre>
</div>

<p>
å¦‚ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@cephnode1 ~]# ceph dashboard ac-user-create mydashboard abcdefg administrator{<span style="color: #8b2252;">"username"</span>: <span style="color: #8b2252;">"mydashboard"</span>, <span style="color: #8b2252;">"lastUpdate"</span>: 1584676335, <span style="color: #8b2252;">"name"</span>: null, <span style="color: #8b2252;">"roles"</span>: [<span style="color: #8b2252;">"administrator"</span>], <span style="color: #8b2252;">"password"</span>: <span style="color: #8b2252;">"$2b$12$uNxxDZgdrlCZwfQZlLwgL.L0F9aKSYznqnyfX2Lc3BBDqhZDEv9wC"</span>, <span style="color: #8b2252;">"email"</span>: null}
</pre>
</div>

<p>
ç°åœ¨dashboardå°±å·²ç»å¯ä»¥è®¿é—®äº†ã€‚åªæ˜¯å…¶ä¸­çš„`rgw`ç®¡ç†çš„åŠŸèƒ½è¿˜ä¸å¯ä»¥ç”¨ã€‚<br>
æˆ‘è¿™é‡ŒæŒ‰ä¸‹é¢çš„æ­¥éª¤éƒ½åšå®Œï¼Œè¿˜æœ‰å®˜ç½‘æåˆ°çš„ä¸€äº›å…¶ä»–ç‚¹ï¼Œæœ€åè¿˜æ˜¯ä¸èƒ½ç®¡ç†`rgw`ï¼Œæš‚æ—¶è¿˜ä¸çŸ¥é“æ€ä¹ˆå›äº‹ã€‚<br>
</p>
</div>
</div>
<div id="outline-container-org337f47c" class="outline-5">
<h5 id="org337f47c">ä¸ºdashboardæ·»åŠ `rgw`çš„ç®¡ç†å‡­æ®</h5>
<div class="outline-text-5" id="text-org337f47c">
<p>
å› ä¸º`rgw`æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç»„ä»¶ï¼Œ`dashboard`ä¸èƒ½ç›´æ¥ç®¡ç†ï¼Œéœ€è¦åˆ›å»ºå‡­æ®è®©`dashboard`æœ‰æƒé™ç®¡ç†`rgw`ã€‚<br>
å¦‚æœä¸éœ€è¦dashboardç®¡ç†`rgw`ï¼Œè¿™ä¸€æ­¥å¯ä»¥è·³è¿‡ã€‚<br>
</p>

<p>
&gt; è¦ä½¿ç”¨dashboardç®¡ç†rgwçš„åŠŸèƒ½ï¼Œéœ€è¦æä¾›å¯ç”¨äº†`system`æ ‡å¿—çš„ç”¨æˆ·å‡­æ®ã€‚<br>
</p>

<p>
å¦‚æœæœ‰ç”¨æˆ·ï¼Œä½¿ç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤è·å–å‡­æ®ä¿¡æ¯ã€‚<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">radosgw-admin user info --uid=&lt;user_id&gt;
</pre>
</div>

<p>
æ²¡æœ‰åˆ™éœ€è¦åˆ›å»ºã€‚<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">$ radosgw-admin user create --uid=&lt;user_id&gt; --display-name=&lt;display_name&gt; <span style="color: #8b2252;">\ </span>   --system
</pre>
</div>

<p>
å¦‚ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">[root@cephnode1 ~]# radosgw-admin user create --uid=dashboard --display-name=dashboard{    <span style="color: #8b2252;">"user_id"</span>: <span style="color: #8b2252;">"dashboard"</span>,    <span style="color: #8b2252;">"display_name"</span>: <span style="color: #8b2252;">"dashboard"</span>,    <span style="color: #8b2252;">"email"</span>: <span style="color: #8b2252;">""</span>,    <span style="color: #8b2252;">"suspended"</span>: 0,    <span style="color: #8b2252;">"max_buckets"</span>: 1000,    <span style="color: #8b2252;">"subusers"</span>: [],    <span style="color: #8b2252;">"keys"</span>: [        {            <span style="color: #8b2252;">"user"</span>: <span style="color: #8b2252;">"dashboard"</span>,            <span style="color: #8b2252;">"access_key"</span>: <span style="color: #8b2252;">"MOEG3CY0LEB8JETFFA5Z"</span>,            <span style="color: #8b2252;">"secret_key"</span>: <span style="color: #8b2252;">"DaJBFSnyV9CgEBkRTEpYn9Tk391IppOkgybRx0wu"</span>        }    ],    <span style="color: #8b2252;">"swift_keys"</span>: [],    <span style="color: #8b2252;">"caps"</span>: [],
</pre>
</div>

<p>
è®°ä¸‹æ˜¾ç¤ºçš„`access_key`ä¸`secret_key`<br>
</p>

<p>
æœ€åï¼Œå‘dashboardæä¾›å‡­æ®ï¼Œä»¥ä¾¿è®©å®ƒå¯ä»¥è¿æ¥`rgw`ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">$ ceph dashboard set-rgw-api-access-key &lt;access_key&gt;$ ceph dashboard set-rgw-api-secret-key &lt;secret_key&gt;
</pre>
</div>

<p>
å¦‚ï¼š<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@cephnode1 ~]# ceph dashboard set-rgw-api-access-key MOEG3CY0LEB8JETFFA5ZOption RGW_API_ACCESS_KEY updated[root@cephnode1 ~]# ceph dashboard set-rgw-api-secret-key DaJBFSnyV9CgEBkRTEpYn9Tk391IppOkgybRx0wuOption RGW_API_SECRET_KEY updated
</pre>
</div>
</div>
</div>
<div id="outline-container-org7c443fb" class="outline-5">
<h5 id="org7c443fb">ç™»å½•</h5>
<div class="outline-text-5" id="text-org7c443fb">
<p>
æŸ¥çœ‹mgrä¸­çš„æœåŠ¡<br>
</p>

<p>
å¯ä»¥ä½¿ç”¨`ceph mgr services` æŸ¥çœ‹mgrä¸­æä¾›çš„æœåŠ¡ã€‚å¯ä»¥ç¡®å®šdashboardçš„ç™»å½•åœ°å€ä¸ç«¯å£ã€‚<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@cephnode1 ~]# ceph mgr services{    <span style="color: #8b2252;">"dashboard"</span>: <span style="color: #8b2252;">"https://cephnode1:8843/"</span>}[root@cephnode1 ~]#
</pre>
</div>

<p>
æœ€å<br>
</p>

<p>
æ‰“å¼€ç½‘å€ç™»å½•<br>
<img src="https://www.yxingxing.net/upload/2020/3/image-b50d28e43ee54a09b9c3994638d8790c.png" alt="image-b50d28e43ee54a09b9c3994638d8790c.png"><br>
<img src="https://www.yxingxing.net/upload/2020/3/image-b50d28e43ee54a09b9c3994638d8790c.png" alt="image-b50d28e43ee54a09b9c3994638d8790c.png"><br>
</p>


<figure id="org66c90b1">
<img src="https://www.yxingxing.net/upload/2020/3/image-f73acbd702fb47739761efd94cbc6828.png" alt="image-f73acbd702fb47739761efd94cbc6828.png"><br>

</figure>

<p>
æˆ‘è¿™é‡Œèƒ½å¤Ÿç™»å½•ï¼Œä½†æ˜¯Object Gateway(rgw)è®¿é—®è¿˜æ˜¯æœ‰é—®é¢˜ã€‚<br>
</p>

<p>
å…¶ä»–çš„dashhboardå‘½ä»¤å¯ä»¥é€šè¿‡`ceph dashboard &#x2013;help`æŸ¥çœ‹ã€‚<br>
</p>
</div>
</div>
</div>
<div id="outline-container-org0ada7c8" class="outline-4">
<h4 id="org0ada7c8">å¯ç”¨Prometheusç›‘æ§æ¥å£</h4>
<div class="outline-text-4" id="text-org0ada7c8">
<p>
å°±æ˜¯æš´éœ²å‡ºå»ä¸€ä¸ªmetricsæ¥å£ï¼Œè®©prometheusä½¿ç”¨ã€‚<br>
å¯ç”¨prometheusæ¨¡å—å°±è¡Œã€‚<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">[root@cephnode1 ~]# ceph mgr module enable prometheus
</pre>
</div>

<p>
ç«¯å£`9283` å°±å¯ä»¥ç›´æ¥è®¿é—®äº†ã€‚<br>
</p>

<p>
è¿™é‡Œå°±æ˜¯ç®€å•æä¸€ä¸‹ï¼Œ è‡³äºprometheusä¸grafanaçš„é…ç½®å°±ç•¥è¿‡äº†ã€‚<br>
</p>
</div>
</div>
</div>
</section>
</main class="container">
<footer id="postamble" class="status">
<footer data-astro-cid-sz7xmlte data-turbo-permanent id=rootFooter>
    <script>
        const shuffle = e => e.map((e => ({
            v: e,
            sort: Math.random()
        }))).sort(( (e, o) => e.sort - o.sort)).map(( ({v: e}) => e));
        var songList = ["barbie-girl--stantough", "blue-da-ba-dee--cornelius-link", "hips-dont-lie--stantough", "i-want-it-that-way--stantough", "seven-nation-army--stantough", "smooth-criminal--stantough"]
          , songOrder = songOrder ?? shuffle(songList).map((e => `/audio/music/${e}.opus`))
          , song = new Audio(songOrder[0])
          , nextSong = new Audio(songOrder[1])
          , songIndex = 2
          , musicWrapper = void 0
          , arrow = void 0
          , notes = void 0;
        song.addEventListener("ended", next);
        const toggle = () => song.paused ? play() : pause();
        function play() {
            song.play(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.add("shakeManHorse"),
            notes.classList.remove("hideNotes")
        }
        function pause() {
            song.pause(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.remove("shakeManHorse"),
            notes.classList.add("hideNotes")
        }
        function next() {
            song = nextSong,
            play(),
            songIndex === songOrder.length && (songIndex = 0),
            nextSong = new Audio(songOrder[songIndex]),
            songIndex += 1
        }
        function skip() {
            pause(),
            (arrow = arrow || document.getElementById("musicArrow")).classList.add("shootArrow");
            new Audio("/audio/effects/ohno.m4a").play(),
            arrow.addEventListener("animationend", arrowShootHandler, !1)
        }
        function arrowShootHandler() {
            arrow.removeEventListener("animationend", arrowShootHandler, !1),
            arrow.classList.remove("shootArrow");
            new Audio("/audio/effects/heythathurt.m4a").play(),
            next()
        }
    </script>
    <div id=musicPlayer data-astro-cid-q7a5pyro>
        <button class=skip data-astro-cid-q7a5pyro onclick=skip() title="Skip song">
            <div id=skipWrapper data-astro-cid-q7a5pyro>
                <img alt="Medieval drollery of a man/snail/bat/monkey shooting an arrow" class=archer decoding=async height=334 loading=lazy src=/images/archer-no-arrow.448ccd8b_Z1KfRYq.webp width=226 data-astro-cid-q7a5pyro>
                <img alt="Arrow for archer" class="arrow complete" decoding=async height=23 loading=lazy src=/images/no-archer-full-arrow.87aa9971_Z2qL2KO.webp width=141 data-astro-cid-q7a5pyro id=musicArrow>
            </div>
        </button>
        <button class=playPause data-astro-cid-q7a5pyro onclick=toggle() title="Play/pause song">
            <div id=musicWrapper data-astro-cid-q7a5pyro>
                <div class=hideNotes id=notesWrapper data-astro-cid-q7a5pyro>
                    <div class=lyreNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                    <div class=fluteNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                </div>
                <img alt="Medieval drollery of a man/horse playing a lyre and a horn" class=manHorse decoding=async height=665 loading=lazy src=/images/man-horse-band.e3a2efcf_q8FCa.webp width=531 data-astro-cid-q7a5pyro>
            </div>
        </button>
    </div>
    <hr data-astro-cid-sz7xmlte>
    <div class=salutation data-astro-cid-gdmrbrho>
        <p data-astro-cid-gdmrbrho>
            <span class=flower2 data-astro-cid-gdmrbrho>A</span>
            <span class=smallcap data-astro-cid-gdmrbrho>pax vobiscum</span>
            <span class="flower2 wiggle" data-astro-cid-gdmrbrho id=leaf>a</span>
        </p>
    </div>
    <script>
        function animateLeafBlownHandler() {
            leaf.removeEventListener("animationend", animateLeafBlownHandler, !1),
            leaf.classList.remove("blownAway"),
            leaf.classList.add("wiggle")
        }
        function animateLeaf() {
            leaf = leaf ?? document.getElementById("leaf"),
            leaf.classList.remove("wiggle"),
            leaf.classList.add("blownAway"),
            leaf.addEventListener("animationend", animateLeafBlownHandler, !1)
        }
        document.getElementById("leaf").onclick = animateLeaf
    </script>


    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>æ‰“èµ</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Â© 2024 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
</footer>
</footer>
</body>
</html>
