<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kubernetes: 07-k8s-æ‹“å±•-æœåŠ¡ç½‘ç»œ</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/font.css"/>
<link rel="stylesheet" type="text/css" href="/static/drollery.e825b870.css"/>
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<header id="preamble" class="status">
<header class="{className}" data-astro-cid-3ef6ksr2>
  <div class=header-branding data-astro-cid-g2lrb5xm>
      <span class=header-text data-astro-cid-g2lrb5xm>
          <span class=dropcap data-astro-cid-g2lrb5xm aria-hidden=true>
              <span class=actual data-astro-cid-g2lrb5xm>J</span>
              <span class=rest data-astro-cid-g2lrb5xm>asper Hsu</span>
              <span class=period data-astro-cid-g2lrb5xm>.</span>
          </span>
          <span class=sr-only data-astro-cid-g2lrb5xm>Drollery</span>
      </span>
      <img alt="Medieval drollery of a knight on a horse" class=spring decoding=async height=250 loading=lazy src=/images/knight-horse.a96eee7d_Z1WCOYs.webp width=68 data-astro-cid-g2lrb5xm>
  </div>

  <nav data-astro-cid-pux6a34n>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/jcodelog.html class=nobracket data-astro-cid-pux6a34n>æŠ€æœ¯</a>
      <span class=flower2 data-astro-cid-pux6a34n>K</span>
      <a href=/reading/index.html class=nobracket data-astro-cid-pux6a34n>é˜…è¯»</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
      <a href=/lisp/jasper-emacs.html class=nobracket data-astro-cid-pux6a34n>æˆ‘çš„Emacsé…ç½®</a>
      <span class=flower2 data-astro-cid-pux6a34n>L</span>
      <a href=/link/index.html class=nobracket data-astro-cid-pux6a34n>å‹é“¾</a>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/about.html class=nobracket data-astro-cid-pux6a34n>å…³äº</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
  </nav>


  <div class="container" data-astro-cid-3ef6ksr2>
    <p class="info" data-astro-cid-3ef6ksr2>
              ğŸ† æ¬¢è¿æ¥åˆ°æœ¬ç«™ï¼š
              <a href="https://xuchangwei.com/">https://xuchangwei.com/</a>ã€‚
              <strong>å¸Œæœ›è¿™é‡Œæœ‰ä½ æ„Ÿå…´è¶£çš„å†…å®¹</strong>ã€‚
            </p>
  </div>
  <div id=borderArtWrapper class="tt1" data-astro-cid-5hce7sga data-turbo-permanent>
      <script>
          var man, shakeCount = 0, noSound = new Audio("/audio/effects/no.m4a"), screamSound = new Audio("/audio/effects/scream.m4a");
          function animateManShakeHandler() {
              man.removeEventListener("animationend", animateManShakeHandler, !1),
              shakeCount += 1,
              man.classList.remove("shakeMan")
          }
          function animateManFallHandler() {
              man.removeEventListener("animationend", animateManFallHandler, !1),
              man.classList.add("hide")
          }
          function animateMan() {
              man = man ?? document.getElementById("borderMan"),
              3 === shakeCount ? (man.classList.add("fallMan"),
              screamSound.play(),
              man.addEventListener("animationend", animateManFallHandler, !1)) : (man.classList.add("shakeMan"),
              noSound.play(),
              man.addEventListener("animationend", animateManShakeHandler, !1))
          }
      </script>
      <div class=borderArt data-astro-cid-5dda5nwp id=articleBorder>
          <img alt="flowery border with man falling" decoding=async height=620 loading=lazy src=/images/border-vines-no-man.b7d246cc_DRxSe.webp width=909 class=border data-astro-cid-5dda5nwp>
          <div class=fallWrapper data-astro-cid-5dda5nwp>
              <img alt="flowery border with man falling" decoding=async height=292 loading=lazy src=/images/man-no-vines.247a3187_Z2ioXNM.webp width=98 class=man data-astro-cid-5dda5nwp id=borderMan onclick=animateMan()>
          </div>
      </div>
  </div>
</header>
</header>
<main class="container" id="content" class="content">
<header>
<h1 class="title">Kubernetes: 07-k8s-æ‹“å±•-æœåŠ¡ç½‘ç»œ</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org82626f7">æœåŠ¡ç½‘æ ¼å‰ä¸–ä»Šç”Ÿ</a>
<ul>
<li><a href="#org4ff8aa9">åº”ç”¨æ¶æ„æ¼”å˜å†ç¨‹</a></li>
<li><a href="#orged156aa">å¾®æœåŠ¡å¸¦æ¥çš„é—®</a></li>
<li><a href="#org29c0af5">æœåŠ¡ç½‘ç»œåº”è¿è€Œç”Ÿ</a>
<ul>
<li><a href="#orge216123">SpringCloud / Nacos å¹¶éæ˜¯å®Œå…¨ä¹‹ç­–</a></li>
<li><a href="#org784c602">æœåŠ¡ç½‘ç»œåº”è¿è€Œç”Ÿ</a></li>
<li><a href="#org174df06">ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘ç»œ</a>
<ul>
<li><a href="#org6f3f225">æœåŠ¡ç½‘æ ¼åŠŸèƒ½</a></li>
<li><a href="#org5655265">æœåŠ¡ç½‘æ ¼äº§å“</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org638015a">æœåŠ¡ç½‘æ ¼ Istio</a>
<ul>
<li><a href="#org46babc1">Istio æ¶æ„</a>
<ul>
<li><a href="#org676a26e">Istio æ•°æ®å¹³é¢-Envoy</a></li>
<li><a href="#org83c1382">Istio æ§åˆ¶å¹³é¢-Istiod</a></li>
</ul>
</li>
<li><a href="#orgb1079ba">Istio æ ¸å¿ƒèµ„æº</a>
<ul>
<li><a href="#orge491ac6">Istio ä¸œè¥¿æµé‡ç®¡ç†-VirtualService</a>
<ul>
<li><a href="#org9de16bb">VirtualService é…ç½®ç¤ºä¾‹</a></li>
</ul>
</li>
<li><a href="#org9532afd">Istio ç»†ç²’åº¦æµé‡ç®¡ç†-DestinationRule</a>
<ul>
<li><a href="#orga8dd600">DestinationRule é…ç½®åˆ†æ</a></li>
</ul>
</li>
<li><a href="#orga6259ae">Istio å—åŒ—æµé‡ç®¡ç†-Gateway</a>
<ul>
<li><a href="#orgcf76355">Gateway é…ç½®åˆ†æ</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc89288a">æœåŠ¡ç½‘æ ¼ Istio å®‰è£…åŠé¡¹ç›®å‘å¸ƒ</a>
<ul>
<li><a href="#orgcdc5291">Istio å®‰è£…</a>
<ul>
<li><a href="#org2cbc4c2">å®‰è£…æ³¨æ„äº‹é¡¹</a></li>
<li><a href="#org8dfc91e">ä½¿ç”¨ Operator éƒ¨ç½² istio</a></li>
<li><a href="#org5c880dc">é…ç½®è‡ªåŠ¨æ³¨å…¥</a></li>
<li><a href="#org575720f">å¯è§†åŒ–å·¥å…· kiali</a></li>
<li><a href="#org114d44c">prometheus å’Œ grafana</a></li>
</ul>
</li>
<li><a href="#orgca778f3">Istio æµé‡æ²»ç†</a>
<ul>
<li><a href="#orgba7e154">éƒ¨ç½²æµ‹è¯•ç”¨ä¾‹</a>
<ul>
<li><a href="#org9c41e57">BookInfo ä»‹ç»</a></li>
<li><a href="#orge2cccaf">éƒ¨ç½² bookinfo</a></li>
<li><a href="#org72781fe">ä½¿ç”¨ kiali è¿›è¡Œæµé‡ç›‘æµ‹</a></li>
</ul>
</li>
<li><a href="#org42eb322">IngressGateway å‘å¸ƒæœåŠ¡åŸç†</a></li>
<li><a href="#orgd7268cc">Istio å®ç°ç°åº¦éƒ¨ç½²</a>
<ul>
<li><a href="#org6adf102">ä¸»æµå‘å¸ƒæ–¹æ¡ˆ</a></li>
<li><a href="#org937c083">istio å†…å¦‚ä½•å®ç°ç°åº¦å‘å¸ƒ</a></li>
<li><a href="#orgb7618eb">ä½¿ç”¨ kiali å›¾å½¢åŒ–ç®¡ç†å¾®æœåŠ¡æµé‡</a></li>
</ul>
</li>
<li><a href="#org8e88cff">Istio å®ç° AB æµ‹è¯•</a></li>
<li><a href="#org80195b6">Istio åœ°å€é‡å†™å’Œé‡å†™å‘</a>
<ul>
<li><a href="#org16943d4">æ–°æ—§åœ°å€æ›¿æ¢</a></li>
<li><a href="#org6c3b637">å‰åç«¯åˆ†ç¦»-rewrite å®è·µ</a></li>
</ul>
</li>
<li><a href="#org0f913c5">Istio è´Ÿè½½å‡è¡¡ç®—æ³•</a></li>
<li><a href="#org6bdaac9">Istio ç†”æ–­-å¹¶å‘æ•°è¿æ¥é™åˆ¶</a></li>
<li><a href="#org874143e">Istio æ•…éšœå¤„ç†</a>
<ul>
<li><a href="#org69adcff">Istio æ³¨å…¥å»¶è¿Ÿæ•…éšœ</a></li>
<li><a href="#org209c1c8">Istio æ³¨å…¥ä¸­æ–­æ•…éšœ</a></li>
<li><a href="#orga206426">Istio å¿«é€Ÿè¶…æ—¶é…ç½®</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../index.html">Kubernetes</a><br></li>
</ul>
<section id="outline-container-org82626f7" class="outline-2">
<h2 id="org82626f7">æœåŠ¡ç½‘æ ¼å‰ä¸–ä»Šç”Ÿ</h2>
<div class="outline-text-2" id="text-org82626f7">
</div>
<div id="outline-container-org4ff8aa9" class="outline-3">
<h3 id="org4ff8aa9">åº”ç”¨æ¶æ„æ¼”å˜å†ç¨‹</h3>
<div class="outline-text-3" id="text-org4ff8aa9">
<ul class="org-ul">
<li>å•ä½“åº”ç”¨<br>
<ul class="org-ul">
<li>é€€æ¬¾ã€ç™»å½•ã€ä¸‹å•<br></li>
<li>å¯¹æŸä¸ªéå…³é”®éƒ¨åˆ†æ›´æ–°å½±å“å…¨å±€<br></li>
</ul></li>
<li>å¾®æœåŠ¡<br>
<ul class="org-ul">
<li>æ³¨å†Œã€ç™»å½•ã€ä¸‹å•ã€é€€æ¬¾<br></li>
</ul></li>
<li>å‡½æ•°<br>
<ul class="org-ul">
<li>å¾®æœåŠ¡å†æ‹†åˆ†<br></li>
<li>delete ToDo, addToDo, updateToDo, listToDo, getToDo<br></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orged156aa" class="outline-3">
<h3 id="orged156aa">å¾®æœåŠ¡å¸¦æ¥çš„é—®</h3>
<div class="outline-text-3" id="text-orged156aa">
<p>
<b>å•ä½“åº”ç”¨åˆ°å¾®æœåŠ¡å¸¦æ¥çš„é—®é¢˜</b><br>
æŠŠå•ä½“åº”ç”¨æ‹†åˆ†æˆå¾ˆå¤šçš„å°æ¨¡å—æˆ–è€…å°åº”ç”¨ï¼Œå¸¦æ¥çš„é—®é¢˜<br>
</p>
<ul class="org-ul">
<li>ç½‘ç»œé—®é¢˜<br>
<ul class="org-ul">
<li>æŒ‚æ‰ã€å“åº”æ…¢<br></li>
</ul></li>
<li>å®‰å…¨æ€§é—®é¢˜<br></li>
</ul>
</div>
</div>
<div id="outline-container-org29c0af5" class="outline-3">
<h3 id="org29c0af5">æœåŠ¡ç½‘ç»œåº”è¿è€Œç”Ÿ</h3>
<div class="outline-text-3" id="text-org29c0af5">
</div>
<div id="outline-container-orge216123" class="outline-4">
<h4 id="orge216123">SpringCloud / Nacos å¹¶éæ˜¯å®Œå…¨ä¹‹ç­–</h4>
<div class="outline-text-4" id="text-orge216123">
<p>
springcloud æ˜¯ java è¯­è¨€ï¼›æ³¨å†Œè¡¨åŒæ­¥æ˜¯æœ‰æ—¶é—´çš„é—´éš”çš„ï¼Œè¦ä¿è¯ä¸‹çº¿ pod ip åŠæ—¶é€šçŸ¥ä¸‹çº¿ã€‚<br>
ç½‘ç»œåŠŸèƒ½ä»£ç è¿˜æ˜¯éœ€è¦å¼€å‘äººå‘˜ç»´æŠ¤ï¼ˆè´Ÿè½½å‡è¡¡ã€æœåŠ¡å‘ç°ã€ç†”æ–­é™çº§ã€åŠ¨æ€è·¯ç”±ã€é”™è¯¯é‡è¯•ã€å®‰å…¨é€šä¿¡ç­‰ï¼‰ï¼Œåº”è¯¥åªå…³å¿ƒä¸šåŠ¡é€»è¾‘ã€‚<br>
</p>
</div>
</div>
<div id="outline-container-org784c602" class="outline-4">
<h4 id="org784c602">æœåŠ¡ç½‘ç»œåº”è¿è€Œç”Ÿ</h4>
<div class="outline-text-4" id="text-org784c602">
<p>
æŠŠä¸šåŠ¡é€»è¾‘å’Œç½‘ç»œåŠŸèƒ½çš„ä»£ç æ‹†åˆ†å¼€ï¼Œä¸šåŠ¡é€»è¾‘å¼€å‘äººå‘˜ç®¡ç†ï¼Œç½‘ç»œåŠŸèƒ½ç”±æœåŠ¡ç½‘ç»œç®¡ç†ã€‚<br>
</p>

<p>
æœåŠ¡ç½‘ç»œæ˜¯åœ¨å¾®æœåŠ¡çš„åŸºç¡€ä¸ŠåŠ äº†ä¸€å±‚ä»£ç†ã€‚<br>
</p>
</div>
</div>
<div id="outline-container-org174df06" class="outline-4">
<h4 id="org174df06">ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘ç»œ</h4>
<div class="outline-text-4" id="text-org174df06">
<p>
Service Mesh (æœåŠ¡ç½‘æ ¼) æ˜¯ç”± buoyant å…¬å¸çš„ ceo willian morgan å‘èµ·ï¼Œç›®æ ‡ä¸ºè§£å†³æœåŠ¡ä¹‹é—´å¤æ‚çš„é“¾è·¯å…³ç³»ã€‚<br>
Service Mesh å°†ç¨‹åºå¼€å‘çš„ç½‘ç»œåŠŸèƒ½å’Œç¨‹åºæœ¬èº«è§£è€¦ï¼Œç½‘ç»œåŠŸèƒ½ä¸‹æ²‰åˆ°åŸºç¡€æ¶æ„ï¼Œç”±æœåŠ¡ç½‘ç»œå®ç°æœåŠ¡ä¹‹é—´çš„è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ï¼Œå¹¶ä¸”é™¤ç½‘ç»œåŠŸèƒ½å¤–ï¼Œä¹Ÿæä¾›äº†å…¶å®ƒæ›´é«˜çº§çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å…¨é“¾è·¯åŠ å¯†ã€ç›‘æ§ã€é“¾è·¯è¿½è¸ªç­‰ã€‚<br>
</p>
</div>
<div id="outline-container-org6f3f225" class="outline-5">
<h5 id="org6f3f225">æœåŠ¡ç½‘æ ¼åŠŸèƒ½</h5>
<div class="outline-text-5" id="text-org6f3f225">
<ul class="org-ul">
<li>è´Ÿè½½å‡è¡¡<br></li>
<li>æœåŠ¡å‘å¸ƒ<br></li>
<li>ç†”æ–­é™çº§<br></li>
<li>åŠ¨æ€è·¯ç”±<br></li>
<li>æ•…éšœæ³¨å…¥<br></li>
<li>é”™è¯¯é‡è¯• ï¼ˆå­˜åœ¨å¹‚ç­‰æ€§é—®é¢˜ï¼Œå¦‚ aè¯·æ±‚ bï¼Œb å·²ç»åœ¨å¤„ç†äº†è¿”å›504è¶…æ—¶ï¼Œaå†è°ƒ b å°±å­˜åœ¨å¹‚ç­‰é—®é¢˜ï¼Œå……å€¼åœºæ™¯ï¼‰<br></li>
<li>å®‰å…¨é€šä¿¡<br></li>
<li>è¯­è¨€æ— å…³<br></li>
</ul>
</div>
</div>
<div id="outline-container-org5655265" class="outline-5">
<h5 id="org5655265">æœåŠ¡ç½‘æ ¼äº§å“</h5>
<div class="outline-text-5" id="text-org5655265">
<ul class="org-ul">
<li>Linkerd<br></li>
</ul>
<p>
Buoyant å…¬å¸åœ¨ 2016å¹´ç‡å…ˆå¼€æºçš„é«˜æ€§èƒ½ç½‘ç»œä»£ç†ç¨‹åºï¼Œå®ƒçš„å‡ºç°æ ‡å¿—ç€ Service Mesh æ—¶ä»£å¼€å§‹<br>
</p>
<ul class="org-ul">
<li>Envoy<br></li>
</ul>
<p>
åŒ Linkerd ä¸€æ ·ï¼ŒEnvoy ä¹Ÿæ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„ç½‘ç»œä»£ç†ç¨‹åºï¼Œä¸ºäº‘åŸç”Ÿåº”ç”¨è€Œè®¾è®¡<br>
</p>
<ul class="org-ul">
<li>Istio<br></li>
</ul>
<p>
Istio å— google, ibm, Lyft åŠ RedHat å…¬å¸çš„å¤§åŠ›æ”¯æŒå’Œæ¨å¹¿ï¼Œäº2017å¹´5æœˆåº•å‘å¸ƒï¼Œåº•å±‚ä¸º envoy<br>
</p>
<ul class="org-ul">
<li>Conduit<br></li>
</ul>
<p>
2017å¹´12æœˆå‘å¸ƒï¼Œæ˜¯ buoyant å…¬å¸çš„ç¬¬äºŒæ¬¾ Service Mesh äº§å“ï¼Œæ ¹æ® Linkerd åœ¨ç”Ÿäº§çº¿ä¸Šçš„å®é™…ä½¿ç”¨ç»éªŒè€Œè®¾è®¡ï¼Œå¹¶ä»¥æœ€å°å¤æ‚æ€§ä½œä¸ºè®¾è®¡åŸºç¡€ã€‚<br>
</p>
<ul class="org-ul">
<li>Kuma<br></li>
</ul>
<p>
ç”± kong å¼€å‘å¹¶æä¾›æ”¯æŒï¼Œä¸€ä¸ªé€šç”¨çš„ç°ä»£æœåŠ¡ç½‘æ ¼æ§åˆ¶å¹³é¢ï¼ŒåŸºäº envoy æ„å»ºã€‚kuma é«˜æ•ˆçš„æ•°æ®å¹³é¢å’Œå…ˆè¿›çš„æ§åˆ¶å¹³é¢ï¼Œæå¤§åœ°é™ä½äº†å„å›¢é˜Ÿä½¿ç”¨çš„éš¾åº¦ã€‚<br>
</p>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-org638015a" class="outline-2">
<h2 id="org638015a">æœåŠ¡ç½‘æ ¼ Istio</h2>
<div class="outline-text-2" id="text-org638015a">
</div>
<div id="outline-container-org46babc1" class="outline-3">
<h3 id="org46babc1">Istio æ¶æ„</h3>
<div class="outline-text-3" id="text-org46babc1">
<p>
Istio mesh<br>
</p>
<ul class="org-ul">
<li>Data plane<br>
<ul class="org-ul">
<li>Pod sidecar: proxy<br></li>
</ul></li>
<li>Control plane<br>
<ul class="org-ul">
<li>Istiod: Pilot, Citadel, Galley ç»„ä»¶<br></li>
</ul></li>
<li>æµé‡<br>
<ul class="org-ul">
<li>Ingress gateway å…¥å£æµé‡<br></li>
<li>Egress gateway å‡ºå£æµé‡<br></li>
</ul></li>
</ul>

<p>
åˆ† 2 å±‚æ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢ã€‚æ§åˆ¶å±‚é¢æ˜¯å¯¹é…ç½®è¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œé…ç½®å¯ä»¥åˆ†å‘åˆ°ä¸åŒçš„æ•°æ®<br>
å±‚é¢ï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½ä¼š sidecar proxyï¼Œproxy æ˜¯ istio çš„è¯å°±æ˜¯ envoyã€‚ istios å³èƒ½ç®¡ç†ä¸œè¥¿æµé‡å³æœåŠ¡ä¹‹é—´çš„æµé‡ï¼Œä¹Ÿèƒ½ç®¡ç†å—åŒ—æµé‡å³å‡ºå…¥å£æµé‡<br>
</p>
</div>
<div id="outline-container-org676a26e" class="outline-4">
<h4 id="org676a26e">Istio æ•°æ®å¹³é¢-Envoy</h4>
<div class="outline-text-4" id="text-org676a26e">
<p>
Pod<br>
</p>
<ul class="org-ul">
<li>åº”ç”¨å®¹å™¨<br></li>
<li>Envoy å®¹å™¨<br></li>
</ul>

<p>
istio çš„æ•°æ®å¹³é¢ä½¿ç”¨çš„æ˜¯ envoyï¼ŒEnvoy æ˜¯ä»¥ c++ å¼€å‘çš„é«˜æ€§èƒ½ä»£ç†ï¼Œç”¨äºè°ƒè§£æœåŠ¡ç½‘ç»œä¸­æ‰€æœ‰æœåŠ¡çš„æ‰€æœ‰å…¥ç«™å’Œå‡ºç«™æµé‡ã€‚envoy ä»£ç†æ˜¯å”¯ä¸€ä¸€ä¸ªä¸æ•°æ®å¹³é¢æµé‡äº¤äº’çš„ istio ç»„ä»¶ã€‚<br>
</p>

<p>
åŠŸèƒ½ï¼š<br>
</p>
<ul class="org-ul">
<li>åŠ¨æ€æœåŠ¡å‘å¸ƒ<br></li>
<li>è´Ÿè½½å‡è¡¡<br></li>
<li>HTTP/2 &amp; gRPC ä»£ç†<br></li>
<li>ç†”æ–­å™¨<br></li>
<li>å¥åº·æ£€æŸ¥ã€åŸºäºç™¾åˆ†æ¯”æµé‡åˆ†æçš„ç°åº¦å‘å¸ƒ<br></li>
<li>æ•…éšœæ³¨å…¥<br></li>
<li>ä¸°å¯Œçš„åº¦é‡æŒ‡æ ‡<br></li>
</ul>
</div>
</div>
<div id="outline-container-org83c1382" class="outline-4">
<h4 id="org83c1382">Istio æ§åˆ¶å¹³é¢-Istiod</h4>
<div class="outline-text-4" id="text-org83c1382">
<p>
Istiod ä¸º Istio çš„æ§åˆ¶å¹³é¢ï¼Œæä¾›æœåŠ¡å‘å¸ƒã€é…ç½®ã€è¯ä¹¦ç®¡ç†ã€åŠ å¯†é€šä¿¡å’Œè®¤è¯ã€‚æ—©æœŸçš„ Istio æ§åˆ¶å¹³å°æ²¡æœ‰ istiod è¿™ä¸ªå®¹å™¨ï¼Œè€Œæ˜¯ç”± Mixer(æ–°ç‰ˆæœ¬å·²åºŸå¼ƒ)ã€Pilotã€Citadel å…±åŒç»„æˆï¼Œåæ¥ä¸ºäº†ç®€åŒ– istio çš„æ¶æ„ï¼Œå°†å…¶åˆå¹¶ä¸º istiodï¼Œæ‰€ä»¥å¯¹äºæ–°ç‰ˆæœ¬çš„ Istio(v1.5+)ï¼Œéƒ¨ç½²åä»…èƒ½çœ‹åˆ° istiod ä¸€ä¸ª podã€‚<br>
</p>

<ul class="org-ul">
<li>Pilot: ä¸º Envoy Sidecar æä¾›æœåŠ¡å‘ç°çš„åŠŸèƒ½ï¼Œä¸ºæ™ºèƒ½è·¯ç”±ï¼ˆä¾‹å¦‚ A/B æµ‹è¯•ã€é‡‘ä¸å…´é›€éƒ¨ç½²ç­‰ï¼‰å’Œå¼¹æ€§ï¼ˆè¶…æ—¶ã€é‡è¯•ã€ç†”æ–­å™¨ç­‰ï¼‰æä¾›æµé‡ç®¡ç†åŠŸèƒ½ã€‚<br></li>
<li>Citadelï¼šé€šè¿‡å†…ç½®èº«ä»½å’Œå‡­è¯ç®¡ç†å¯ä»¥æä¾›å¼ºå¤§çš„æœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„æœ€ç»ˆèº«ä»½éªŒè¯ï¼Œå¯ä»¥ç”¨äºå‡çº§æœåŠ¡ç½‘ç»œä¸­æœªåŠ å¯†çš„æµé‡ã€‚ä½†æˆ‘ä»¬ä¸€èˆ¬ä¼šé›†æˆç¬¬ä¸‰æ–¹ç»„ä»¶æ¥åšç”¨æˆ·éªŒè¯å¦‚ OPA<br></li>
<li>Galleyï¼šè´Ÿè´£é…ç½®ç®¡ç†çš„ç»„ä»¶ï¼Œç”¨äºéªŒè¯é…ç½®ä¿¡æ¯çš„æ ¼å¼å’Œæ­£ç¡®æ€§ã€‚Galley ä½¿ç”¨ç½‘æ ¼é…ç½®åè®®ï¼ˆ Mesh Configuration Protocolï¼‰å’Œå…¶å®ƒç»„ä»¶è¿›è¡Œé…ç½®äº¤äº’ã€‚<br></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgb1079ba" class="outline-3">
<h3 id="orgb1079ba">Istio æ ¸å¿ƒèµ„æº</h3>
<div class="outline-text-3" id="text-orgb1079ba">
<p>
kubernetes æœ€ç»ˆç”Ÿæˆçš„æ˜¯å®¹å™¨ï¼Œç®¡ç†çš„æ˜¯ Podã€‚<br>
</p>

<p>
å’Œ kubernetest ä¸€æ · istio ä¸­æ ¸å¿ƒèµ„æº VirtualServiceï¼ˆVSï¼‰ã€DestinationRuleï¼ˆDRï¼‰ã€Gatewayï¼ˆGWï¼‰ æœ€ç»ˆç”Ÿæˆçš„å°±æ˜¯ envoy é…ç½®ã€‚<br>
</p>
</div>
<div id="outline-container-orge491ac6" class="outline-4">
<h4 id="orge491ac6">Istio ä¸œè¥¿æµé‡ç®¡ç†-VirtualService</h4>
<div class="outline-text-4" id="text-orge491ac6">
<p>
ç®€å•ç†è§£å°±æ˜¯å’Œ service åœ¨ä¸€ä¸ªå±‚é¢ã€‚<br>
</p>

<p>
k8s ä¸­çš„ service ä¹Ÿæ˜¯å®ç°ä¸œè¥¿æµé‡ç®¡ç†ï¼Œåªæœ‰ç®€å•çš„è½®è¯¢åŠŸèƒ½<br>
k8s Service<br>
</p>
<ul class="org-ul">
<li>Pod<br></li>
<li>Pod<br></li>
</ul>

<p>
VirtualServiceï¼šVirtualServiceï¼ˆè™šæ‹ŸæœåŠ¡ï¼‰åŸºäº Istio å’Œå¯¹åº”å¹³å°æä¾›çš„åŸºæœ¬è¿é€šæ€§å’ŒæœåŠ¡å‘ç°èƒ½åŠ›ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°å¯¹åº”çš„ç›®æ ‡ã€‚æ¯ä¸€ä¸ª VirtualService åŒ…å«ä¸€ç»„è·¯ç”±è§„åˆ™ï¼ŒIstio å°†æ¯ä¸ªè¯·æ±‚æ ¹æ®è·¯ç”±åŒ¹é…åˆ°æŒ‡å®šçš„ç›®æ ‡åœ°å€ã€‚<br>
</p>

<p>
exmapel-users<br>
</p>
<ul class="org-ul">
<li>Pod: deployment V1 ç‰ˆæœ¬ï¼Œå¯é…ç½®ç™¾åˆ†æ¯”æµé‡<br></li>
<li>Pod: deployment V2 ç‰ˆæœ¬ï¼Œå¯é…ç½®ç™¾åˆ†æ¯”æµé‡<br></li>
</ul>
</div>
<div id="outline-container-org9de16bb" class="outline-5">
<h5 id="org9de16bb">VirtualService é…ç½®ç¤ºä¾‹</h5>
<div class="outline-text-5" id="text-org9de16bb">

<figure id="orgcb4483c">
<img src="./images/Snipaste_2022-08-24_11-19-36.png" alt="Snipaste_2022-08-24_11-19-36.png"><br>

</figure>

<div class="org-src-container">
<pre class="src src-yaml">apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: reviews-route
spec:
  hosts:
  - reviews.prod.svc.cluster.local
  http:
  - name: "reviews-v2-routes"
    match:
    - uri:
        prefix: "/wpcatalog"
    - uri:
        prefix: "/consumercatalog"
    rewrite:
      uri: "/newcatalog"
    route:
    - destination:
        host: reviews.prod.svc.cluster.local
        subset: v2
  - name: "reviews-v1-route"
    route:
    - destination:
        host: reviews.prod.svc.cluster.local
        subset: v1
</pre>
</div>

<ul class="org-ul">
<li>apiVersionï¼šå¯¹åº” API ç‰ˆæœ¬<br></li>
<li>kindï¼šèµ„æºç±»å‹<br></li>
<li>metadataï¼šå…ƒæ•°æ®ã€‚å¯ kubernetes èµ„æºç±»ä¼¼ï¼Œå¯ä»¥å®šä¹‰ annotationsã€labelsã€nameã€namespace ç­‰ï¼›<br></li>
<li>metadata.nameï¼š VirtualService çš„åç§°<br></li>
<li>specï¼šå…³äº VirtualService çš„å®šä¹‰<br></li>
<li>spec.hostsï¼šVirtualService çš„ä¸»æœºï¼Œå³ç”¨æˆ·æŒ‡å®šçš„ç›®æ ‡æˆ–è·¯ç”±è§„åˆ™çš„ç›®æ ‡ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚æ—¶ä½¿ç”¨çš„ä¸€ä¸ªæˆ–å¤šä¸ªåœ°å€ã€‚<br></li>
<li>spec.httpï¼šè·¯ç”±è§„åˆ™é…ç½®ï¼Œç”¨æ¥æŒ‡å®šæµé‡çš„è·¯ç”±è¡Œä¸ºï¼Œé€šè¿‡è¯¥å¤„çš„é…ç½®å°† HTTP/1.1ã€HTTP2 å’Œ gRPC ç­‰æµé‡å‘é€åˆ° hosts å­—æ®µæŒ‡å®šçš„ç›®æ ‡<br></li>
<li>spec.http[].matchï¼šè·¯ç”±è§„åˆ™çš„æ¡ä»¶ï¼Œå¯ä»¥æ ¹æ®ä¸€äº›æ¡ä»¶åˆ¶å®šæ›´åŠ ç»†ç²’åº¦çš„è·¯ç”±ã€‚<br></li>
<li>routeï¼šè·¯ç”±è§„åˆ™ï¼Œdestination å­—æ®µæŒ‡å®šäº†ç¬¦åˆæ­¤æ¡ä»¶çš„æµé‡å®é™…ç›®æ ‡åœ°å€ã€‚<br></li>
</ul>


<p>
æ›´å¤šå‚è€ƒå®˜ç½‘ï¼š<a href="https://istio.io/latest/docs/reference/config/networking/virtual-service/">https://istio.io/latest/docs/reference/config/networking/virtual-service/</a><br>
</p>
</div>
</div>
</div>
<div id="outline-container-org9532afd" class="outline-4">
<h4 id="org9532afd">Istio ç»†ç²’åº¦æµé‡ç®¡ç†-DestinationRule</h4>
<div class="outline-text-4" id="text-org9532afd">
<p>
ç®€å•ç†è§£å°±æ˜¯å’Œ pod åœ¨ä¸€ä¸ªå±‚é¢ã€‚<br>
</p>

<p>
ç±»ä¼¼äºç»™ pod å®šä¹‰ä¸åŒæ ‡ç­¾ã€‚<br>
</p>

<p>
DestinationRuleï¼šDestinationRuleï¼ˆç›®æ ‡è§„åˆ™ï¼‰ç”¨äºåç«¯çœŸå®çš„æœåŠ¡å†åšè¿›ä¸€æ­¥åˆ’åˆ†ã€‚<br>
</p>

<p>
exmaple-Service: app=paycenter<br>
</p>
<ul class="org-ul">
<li>Deployment V1: pod: app=paycenter, version=v1<br></li>
<li>Deployment V2: pod: app=paycenter, version=v2<br></li>
</ul>

<p>
DR<br>
</p>
<ul class="org-ul">
<li>å…·æœ‰ app=paycenter å’Œ version=v1 æ ‡ç­¾çš„ podï¼Œå½’ä¸º v1 ç‰ˆæœ¬ã€‚<br></li>
<li>å…·æœ‰ app=paycenter å’Œ version=v2 æ ‡ç­¾çš„ podï¼Œå½’ä¸º v2 ç‰ˆæœ¬ã€‚<br></li>
</ul>
</div>
<div id="outline-container-orga8dd600" class="outline-5">
<h5 id="orga8dd600">DestinationRule é…ç½®åˆ†æ</h5>
<div class="outline-text-5" id="text-orga8dd600">

<figure id="orgdba8dd8">
<img src="./images/Snipaste_2022-08-24_14-29-58.png" alt="Snipaste_2022-08-24_14-29-58.png"><br>

</figure>

<div class="org-src-container">
<pre class="src src-yaml">apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: reviews-destination
spec:
  host: reviews.prod.svc.cluster.local
  subsets:
  - name: v1
    labels:
      version: v1
  - name: v2
    labels:
      version: v2
</pre>
</div>

<ul class="org-ul">
<li>apiVersionï¼šå¯¹åº” API ç‰ˆæœ¬<br></li>
<li>kindï¼šèµ„æºç±»å‹<br></li>
<li>metadataï¼šå…ƒæ•°æ®ã€‚å¯ kubernetes èµ„æºç±»ä¼¼ï¼Œå¯ä»¥å®šä¹‰ annotationsã€labelsã€nameã€namespace ç­‰ï¼›<br></li>
<li>metadata.nameï¼š DestinationRule çš„åç§°<br></li>
<li>specï¼šå…³äº DestinationRule çš„å®šä¹‰<br></li>
<li>spec.hostï¼šDestinationRule çš„ä¸»æœºï¼Œå³ç”¨æˆ·æŒ‡å®šçš„ç›®æ ‡æˆ–è·¯ç”±è§„åˆ™çš„ç›®æ ‡ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚æ—¶ä½¿ç”¨çš„åœ°å€ã€‚<br></li>
<li>spec.subnetsï¼šç‰ˆæœ¬åˆ’åˆ†ï¼Œå¯ä»¥å°† pod åˆ’åˆ†ä¸ºä¸åŒçš„ç‰ˆæœ¬ï¼Œè¿›è¡Œç»†ç²’åº¦çš„è·¯ç”±ç®¡æ§ã€‚<br></li>
</ul>


<p>
å®˜æ–¹å‚è€ƒï¼š<a href="https://istio.io/latest/docs/reference/config/networking/destination-rule/">https://istio.io/latest/docs/reference/config/networking/destination-rule/</a><br>
</p>
</div>
</div>
</div>
<div id="outline-container-orga6259ae" class="outline-4">
<h4 id="orga6259ae">Istio å—åŒ—æµé‡ç®¡ç†-Gateway</h4>
<div class="outline-text-4" id="text-orga6259ae">
<p>
Gatewayï¼šIstio ç½‘å…³åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨ Gateway åœ¨ç½‘æ ¼æœ€å¤–å±‚æ¥æ”¶ HTTP/TCP æµé‡ï¼Œå¹¶å°†æµé‡è½¬å‘åˆ°ç½‘æ ¼å†…çš„æŸä¸ªæœåŠ¡ã€‚åŒæ—¶æ”¯æŒå‡ºå£æµé‡çš„ç®¡æ§ï¼Œå¯ä»¥å°†å‡ºå£çš„æµé‡å›ºå®šä» EgressGateway çš„æœåŠ¡ä¸­ä»£ç†å‡ºå»ã€‚<br>
</p>

<p>
k8s<br>
</p>
<ul class="org-ul">
<li>Istio System<br>
<ul class="org-ul">
<li>IngressGateway  ç®¡ç†å…¥å£æµé‡<br></li>
<li>EgressGateway  ç®¡ç†å‡ºå£æµé‡<br></li>
</ul></li>
<li>Application<br>
<ul class="org-ul">
<li>APP<br></li>
<li>APP<br></li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #0000ff;">            </span><span style="color: #0000ff;">|                              |</span>
<span style="color: #0000ff;">            </span><span style="color: #0000ff;">|                              |</span>
<span style="color: #0000ff;">+------+------------------------------+--------+</span>
<span style="color: #0000ff;">|+-----+---------+                   +-----+-------+|</span>
<span style="color: #0000ff;">||IngressGateway |              |Egres|Gateway||</span>
<span style="color: #0000ff;">|+-----+---------+--------------+-----+-------+|</span>
<span style="color: #0000ff;">|      |                              |        |</span>
<span style="color: #0000ff;">|      +------------------------------+        |</span>
<span style="color: #0000ff;">+------+------------------------------+--------+</span>
<span style="color: #0000ff;">            </span><span style="color: #0000ff;">|+--------------------------+  |</span>
<span style="color: #0000ff; text-decoration: line-through;">+------++</span><span style="color: #0000ff;">--------------------------+--+--------+</span>
<span style="color: #0000ff;">| +---------+                +--------+---+    |</span>
<span style="color: #0000ff;">| |  APP    |                |    APP     |    |</span>
<span style="color: #0000ff;">| +---------+                +------------+    |</span>
<span style="color: #0000ff;">|               Application                    |</span>
<span style="color: #0000ff;">+----------------------------------------------+</span>
</pre>
</div>
</div>
<div id="outline-container-orgcf76355" class="outline-5">
<h5 id="orgcf76355">Gateway é…ç½®åˆ†æ</h5>
<div class="outline-text-5" id="text-orgcf76355">

<figure id="org73ff3d6">
<img src="./images/Snipaste_2022-08-24_15-35-34.png" alt="Snipaste_2022-08-24_15-35-34.png"><br>

</figure>

<p>
ä¸€èˆ¬ä¼šé…ç½®ä¸»æœºåæˆ–è€…æ˜¯è¯ä¹¦çš„é…ç½®æˆ–è€…æ˜¯ç«¯å£çš„é…ç½®ï¼Œé¡¹ç›®æ¯”è¾ƒå¤šå¯ä»¥æ‹†åˆ†æˆå¤šä¸ª gatewayã€‚<br>
</p>

<div class="org-src-container">
<pre class="src src-shell">apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: ext-host-gwy
spec:
  selector:
    app: my-gateway-controller
  servers:
  - port:
      number: 443
      name: https
      protocol: HTTPS
    hosts:
    - ext-host.example.com
    tls:
      mode: SIMPLE
      credentialName: ext-host-cert
</pre>
</div>

<p>
VS å’Œ gateway è¿›è¡Œç»‘å®š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: virtual-svc
spec:
  hosts:
  - ext-host.example.com
  gateways:
  - ext-host-gwy <span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;gateway namespace&gt;/&lt;gateway name&gt; &#22914;&#26524;&#30465;&#30053;&#27492;&#23383;&#27573;&#65292;&#23558;&#20351;&#29992;&#40664;&#35748;&#32593;&#20851;&#65288;mesh&#65289;</span>
</pre>
</div>

<p>
å®˜æ–¹å‚è€ƒï¼š<a href="https://istio.io/latest/docs/concepts/traffic-management/#gateway-example">https://istio.io/latest/docs/concepts/traffic-management/#gateway-example</a><br>
<a href="https://istio.io/latest/docs/reference/config/networking/gateway/">https://istio.io/latest/docs/reference/config/networking/gateway/</a><br>
</p>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-orgc89288a" class="outline-2">
<h2 id="orgc89288a">æœåŠ¡ç½‘æ ¼ Istio å®‰è£…åŠé¡¹ç›®å‘å¸ƒ</h2>
<div class="outline-text-2" id="text-orgc89288a">
</div>
<div id="outline-container-orgcdc5291" class="outline-3">
<h3 id="orgcdc5291">Istio å®‰è£…</h3>
<div class="outline-text-3" id="text-orgcdc5291">
</div>
<div id="outline-container-org2cbc4c2" class="outline-4">
<h4 id="org2cbc4c2">å®‰è£…æ³¨æ„äº‹é¡¹</h4>
<div class="outline-text-4" id="text-org2cbc4c2">
<p>
<a href="https://istio.io/latest/docs/setup/install/">https://istio.io/latest/docs/setup/install/</a><br>
</p>

<p>
æ¨èç”¨ operator å®‰è£…<br>
</p>

<p>
æ”¯æŒç‰ˆæœ¬ä¸ k8s<br>
<a href="https://istio.io/latest/docs/releases/supported-releases/#support-status-of-istio-releases">https://istio.io/latest/docs/releases/supported-releases/#support-status-of-istio-releases</a><br>
</p>
</div>
</div>
<div id="outline-container-org8dfc91e" class="outline-4">
<h4 id="org8dfc91e">ä½¿ç”¨ Operator éƒ¨ç½² istio</h4>
<div class="outline-text-4" id="text-org8dfc91e">
<p>
ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/istio/istio/releases/">https://github.com/istio/istio/releases/</a><br>
</p>

<p>
å®‰è£… istioctl å®¢æˆ·ç«¯<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">curl -L -o istio-1.14.3-linux-amd64.tar.gz  https://github.com/istio/istio/releases/download/1.14.3/istio-1.14.3-linux-amd64.tar.gz
<span style="color: #b22222;">#</span><span style="color: #b22222;">curl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.14.5 TARGET_ARCH=x86_64 sh -</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35299;&#21387;&#21518;&#65292;&#23558; istio &#30340;&#23458;&#25143;&#31471;&#24037;&#20855; istioctl &#31227;&#21160;&#21040; /usr/local/bin &#30446;&#24405;&#19979;</span>
tar xf istio-1.14.3-linux-amd64.tar.gz
mv istio-1.14.3/bin/istioctl /usr/local/bin/
istioctl version

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21629;&#20196;&#34917;&#20840;</span>
cp tools/istioctl.bash ~/
<span style="color: #483d8b;">source</span> ~/.bash_profile
</pre>
</div>

<p>
æ¥ä¸‹æ¥å®‰è£… istio çš„ operatorï¼Œå¯ä»¥ä½¿ç”¨ istioctl ä¸€é”®éƒ¨ç½²<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">istioctl operator init
</pre>
</div>

<p>
å‡ºç° Installation complete åï¼ŒæŸ¥çœ‹ pod æ˜¯å¦æ­£å¸¸ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl get po -n istio-operator
</pre>
</div>

<p>
ä¹‹åé€šè¿‡å®šä¹‰ IstioOperator èµ„æºï¼Œåœ¨ kubernetes ä¸­å®‰è£… Istio:<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl apply -f - &lt;&lt;EOF
<span style="color: #ffa54f;">apiVersion: install.istio.io/v1alpha1</span>
<span style="color: #ffa54f;">kind: IstioOperator</span>
<span style="color: #ffa54f;">metadata:</span>
<span style="color: #ffa54f;">  namespace: istio-system</span>
<span style="color: #ffa54f;">  name: example-istiocontrolplane</span>
<span style="color: #ffa54f;">spec:</span>
<span style="color: #ffa54f;">  profile: default</span>
<span style="color: #ffa54f;">  components: # &#33258;&#23450;&#20041;&#32452;&#20214;&#37197;&#32622;</span>
<span style="color: #ffa54f;">    ingressGateways: # &#33258;&#23450;&#20041; ingressGateway &#37197;&#32622;</span>
<span style="color: #ffa54f;">      - name: istio-ingressgateway</span>
<span style="color: #ffa54f;">        enabled: true #  &#24320;&#21551; ingressgateway</span>
<span style="color: #ffa54f;">        k8s:          # &#33258;&#23450;&#20041; ingressgateway &#30340; kubernetes &#37197;&#32622;</span>
<span style="color: #ffa54f;">          service:    # &#23558; Service &#31867;&#22411;&#25913;&#20026; nodePort&#65292;&#40664;&#35748;&#26159; loadbalancer &#31867;&#22411;</span>
<span style="color: #ffa54f;">            type: NodePort</span>
<span style="color: #ffa54f;">            ports:</span>
<span style="color: #ffa54f;">            - port: 15020</span>
<span style="color: #ffa54f;">              nodePort: 30520</span>
<span style="color: #ffa54f;">              name: status-port</span>
<span style="color: #ffa54f;">            - port: 80 # &#27969;&#37327;&#20837;&#21475; 80 &#31471;&#21475;&#26144;&#23556;&#21040; nodePort &#30340; 30080&#65292;&#20043;&#21518;&#36890;&#36807;&#33410;&#28857; IP+30080 &#21363;&#21487;&#35775;&#38382; Istio &#26381;&#21153;</span>
<span style="color: #ffa54f;">              nodePort: 30080</span>
<span style="color: #ffa54f;">              name: http2</span>
<span style="color: #ffa54f;">              targetPort: 8080</span>
<span style="color: #ffa54f;">            - port: 443</span>
<span style="color: #ffa54f;">              nodePort: 30443</span>
<span style="color: #ffa54f;">              name: https</span>
<span style="color: #ffa54f;">              targetPort: 8443</span>
<span style="color: #ffa54f;">EOF</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">istioctl  manifest apply -f istio-operator.yaml</span>
</pre>
</div>

<ul class="org-ul">
<li>profileï¼šæ ¹æ®IstioOperator APIçš„é»˜è®¤è®¾ç½®å¯ç”¨ç»„ä»¶ã€‚å»ºè®®å°†æ­¤é…ç½®æ–‡ä»¶ç”¨äºç”Ÿäº§éƒ¨ç½²å’Œå¤šé›†ç¾¤ç½‘æ ¼ä¸­çš„ä¸»é›†ç¾¤ã€‚é€šè¿‡è¿è¡Œistioctl profile dumpå‘½ä»¤ï¼Œå¯ä»¥æ˜¾ç¤ºé»˜è®¤è®¾ç½®ã€‚<a href="https://istio.io/latest/docs/setup/additional-setup/config-profiles/">https://istio.io/latest/docs/setup/additional-setup/config-profiles/</a><br></li>
</ul>

<p>
å®˜æ–¹æ–‡æ¡£ IstioOperatorï¼š<a href="https://istio.io/latest/docs/reference/config/istio.operator.v1alpha1/">https://istio.io/latest/docs/reference/config/istio.operator.v1alpha1/</a><br>
</p>

<p>
æŸ¥çœ‹ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl get svc,po -n istio-sytem
</pre>
</div>
<p>
ç­‰å¾…å…¨éƒ¨å®‰è£…å®Œæˆï¼Œ istio core ã€isitodã€ingress gateways<br>
</p>
</div>
</div>
<div id="outline-container-org5c880dc" class="outline-4">
<h4 id="org5c880dc">é…ç½®è‡ªåŠ¨æ³¨å…¥</h4>
<div class="outline-text-4" id="text-org5c880dc">
<p>
ä¿®æ”¹ APIserver çš„é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ  MutatingAdmissionWebhook, ValidatingAdmissionWebhookï¼ˆå¦‚æœ kubernetes å¤§äº 1.16 é»˜è®¤å·²ç»å¼€å¯ï¼‰ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">vim /etc/kubernetes/manifests/kube-apiserver.yaml <span style="color: #b22222;">#  </span><span style="color: #b22222;">&#20108;&#36827;&#21046;&#23433;&#35013;&#26041;&#24335;&#38656;&#35201;&#25214;&#21040; APIserver &#30340; Service &#25991;&#20214;</span>
- --enable-admission-plugins=MutatingAdmissionWebhook, ValidatingAdmissionWebhook <span style="color: #b22222;">#  </span><span style="color: #b22222;">&#36861;&#21152;&#36825;&#20004;&#39033;</span>
</pre>
</div>

<p>
æ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªæµ‹è¯•çš„ namespaceï¼Œå¹¶æ·»åŠ ä¸€ä¸ª istio-injection=enabled çš„æ ‡ç­¾ï¼Œä¹‹ååœ¨è¯¥ namespace ä¸‹åˆ›å»ºçš„ pod å°±ä¼šè‡ªåŠ¨æ³¨å…¥ istio çš„ proxy<br>
</p>

<p>
åˆ›å»º namespace å¹¶æ·»åŠ  label:<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl create ns istio-test
kubectl lable namespace istio-test istio-injection=enabled
</pre>
</div>

<p>
åˆ‡æ¢ç›®å½•è‡³ istio çš„å®‰è£…åŒ…ï¼Œç„¶ååˆ›å»ºæµ‹è¯•åº”ç”¨ï¼Œæ­¤æ—¶åˆ›å»ºçš„ pod ä¼šè¢«è‡ªåŠ¨æ³¨å…¥ä¸€ä¸ª istio-proxy å®¹å™¨ã€‚<br>
</p>
</div>
</div>
<div id="outline-container-org575720f" class="outline-4">
<h4 id="org575720f">å¯è§†åŒ–å·¥å…· kiali</h4>
<div class="outline-text-4" id="text-org575720f">
<p>
Kiali ä¸º istio æä¾›äº†å¯è§†åŒ–çš„ç•Œé¢ï¼Œå¯ä»¥ kaili ä¸Šè¿›è¡Œè§‚æµ‹æµé‡çš„èµ°å‘ã€è°ƒç”¨é“¾ï¼ŒåŒæ—¶è¿˜å¯ä»¥ä½¿ç”¨ kiali è¿›è¡Œé…ç½®ç®¡ç†ï¼Œç»™ç”¨æˆ·å¸¦æ¥äº†å¾ˆå¥½çš„ä½“éªŒã€‚<br>
</p>

<p>
æ¥ä¸‹æ¥åœ¨  kubernetes ä¸­å®‰è£… kiali å·¥å…·ï¼Œé¦–å…ˆè¿›å…¥åˆ° istio çš„å®‰è£…åŒ…ç›®å½•ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl create -f samples/addons/kiali.yaml
</pre>
</div>

<p>
æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl get po,svc -n istio-system -l <span style="color: #a0522d;">app</span>=kiali
</pre>
</div>

<p>
é…ç½® ingress æˆ–è€… service æ”¹ä¸º nodePort å°±å¯ä»¥è®¿é—® kiali æœåŠ¡ã€‚<br>
</p>

<p>
åœ¨ graph é¡µé¢å¯ä»¥çœ‹åˆ°åº”ç”¨çš„æµé‡ä¿¡æ¯ã€‚<br>
</p>

<p>
é™¤äº† kiali ä¹‹å¤–ï¼Œè¿˜éœ€è¦ä¸€ä¸ªé“¾è·¯è¿½è¸ªå·¥å…·ï¼Œå®‰è£…è¯¥å·¥å…·å¯ä»¥åœ¨ kiali çš„ workload é¡µé¢ï¼ŒæŸ¥çœ‹æŸä¸ªæœåŠ¡çš„ Traces ä¿¡æ¯ã€‚ç›´æ¥å®‰è£…å³å¯ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl create -f samples/addons/jaeger.yaml
</pre>
</div>
</div>
</div>
<div id="outline-container-org114d44c" class="outline-4">
<h4 id="org114d44c">prometheus å’Œ grafana</h4>
<div class="outline-text-4" id="text-org114d44c">
<p>
Istio é»˜è®¤æš´éœ²äº†å¾ˆå¤šç›‘æ§æŒ‡æ ‡ï¼Œæ¯”å¦‚è¯·æ±‚æ•°é‡ç»Ÿè®¡ã€è¯·æ±‚æŒç»­æ—¶é—´ä»¥åŠ Service å’Œå·¥ä½œè´Ÿè½½çš„æŒ‡æ ‡ï¼Œè¿™äº›æŒ‡æ ‡å¯ä»¥ä½¿ç”¨ prometheus è¿›è¡Œæ”¶é›†ï¼Œgrafana è¿›è¡Œå±•ç¤ºã€‚<br>
</p>

<p>
Istio å†…ç½®äº† prometheus å’Œ grafana çš„å®‰è£…æ–‡ä»¶ï¼Œç›´æ¥å®‰è£…å³å¯ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨å¤–ç½®çš„ï¼‰ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl create -f samples/addons/prometheus.yaml -f samples/addons/grafana.yaml
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgca778f3" class="outline-3">
<h3 id="orgca778f3">Istio æµé‡æ²»ç†</h3>
<div class="outline-text-3" id="text-orgca778f3">
</div>
<div id="outline-container-orgba7e154" class="outline-4">
<h4 id="orgba7e154">éƒ¨ç½²æµ‹è¯•ç”¨ä¾‹</h4>
<div class="outline-text-4" id="text-orgba7e154">
</div>
<div id="outline-container-org9c41e57" class="outline-5">
<h5 id="org9c41e57">BookInfo ä»‹ç»</h5>
<div class="outline-text-5" id="text-org9c41e57">
<p>
<a href="https://istio.io/latest/docs/examples/bookinfo/">https://istio.io/latest/docs/examples/bookinfo/</a><br>
</p>

<ul class="org-ul">
<li>productpage: productpage å¾®æœåŠ¡ä¼šè°ƒç”¨ details å’Œ reviews ä¸¤ä¸ªå¾®æœåŠ¡ï¼Œç”¨æ¥ç”Ÿæˆé¡µé¢ã€‚<br></li>
<li>detailsï¼šåŒ…å«äº†å›¾ä¹¦çš„ä¿¡æ¯<br></li>
<li>reviewsï¼šåŒ…å«äº†å›¾ä¹¦ç›¸å…³çš„è¯„è®ºï¼Œå®ƒè¿˜ä¼šè°ƒç”¨ ratings å¾®æœåŠ¡ï¼›<br></li>
<li>ratings:ï¼šåŒ…å«äº†ç”±å›¾ä¹¦è¯„ä»·ç»„æˆçš„è¯„çº§ä¿¡æ¯ã€‚<br></li>
</ul>

<p>
é™¤äº†ä¸Šè¿°å¤–ï¼Œreviews å¾®æœåŠ¡è¿˜åˆ†ä¸ºäº† 3 ä¸ªç‰ˆæœ¬ï¼š<br>
</p>
<ul class="org-ul">
<li>v1ç‰ˆæœ¬ï¼šä¸ä¼šè°ƒç”¨ ratings æœåŠ¡ï¼Œå³ä¸ä¼šåœ¨é¡µé¢æ˜¾ç¤ºä¹¦çš„è¯„åˆ†ï¼›<br></li>
<li>v2ç‰ˆæœ¬ï¼šä¼šè°ƒç”¨ ratings æœåŠ¡ï¼Œå¹¶ä½¿ç”¨ 1 åˆ° 5 ä¸ªé»‘è‰²æ˜Ÿå½¢å›¾æ ‡æ¥æ˜¾ç¤ºè¯„åˆ†ä¿¡æ¯ï¼›<br></li>
<li>v3ç‰ˆæœ¬ï¼šä¼šè°ƒç”¨ ratings æœåŠ¡ï¼Œå¹¶ä½¿ç”¨ 1 åˆ° 5 ä¸ªçº¢è‰²æ˜Ÿå½¢å›¾æ ‡æ¥æ˜¾ç¤ºè¯„åˆ†ä¿¡æ¯ï¼›<br></li>
</ul>
</div>
</div>
<div id="outline-container-orge2cccaf" class="outline-5">
<h5 id="orge2cccaf">éƒ¨ç½² bookinfo</h5>
<div class="outline-text-5" id="text-orge2cccaf">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#21517;&#31216;&#31354;&#38388;</span>
kubectl create ns bookinfo

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33258;&#21160;&#27880;&#20837; proxy</span>
kubectl label namespace bookinfo istio-injection=enabled

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#37096;&#32626; bookinfo</span>
kubectl apply -f samples/bookinfo/platform/kube/bookinfo.yaml -n bookinfo

kubectl get po,svc -n istio-system
</pre>
</div>

<p>
è¦ç¡®è®¤ Bookinfo åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œï¼Œè¯·é€šè¿‡æ¥è‡ªæŸä¸ª pod çš„ curl å‘½ä»¤å‘å®ƒå‘é€è¯·æ±‚ï¼Œä¾‹å¦‚æ¥è‡ª ratings<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl exec <span style="color: #8b2252;">"$(</span><span style="color: #ff00ff;">kubectl get pod -l app=ratings -o jsonpath='{.items[0].metadata.name}'</span><span style="color: #8b2252;">)"</span> -c ratings -- curl -sS productpage:9080/productpage | grep -o <span style="color: #8b2252;">"&lt;title&gt;.*&lt;/title&gt;"</span>

&lt;title&gt;Simple Bookstore App&lt;/title&gt;
</pre>
</div>

<p>
æ¥ä¸‹æ¥åˆ›å»º Istio çš„ Gateway å’Œ VirtualService å®ç°åŸŸåè®¿é—® bookinfo é¡¹ç›®ã€‚<br>
</p>

<p>
é¦–å…ˆåˆ›å»º Gatewayï¼Œå‡è®¾åŸŸåæ˜¯ bookinfo.kubeasy.comã€‚gateway é…ç½®å¦‚ä¸‹ ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">cat  samples/bookinfo/networking/bookinfo-gateway.yaml
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: bookinfo-gateway
spec:
  selector:
    istio: ingressgateway <span style="color: #b22222;"># </span><span style="color: #b22222;">use istio default controller</span>
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - <span style="color: #8b2252;">"*.kubeasy.com"</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21457;&#24067;&#22495;&#21517;&#65292;&#21482;&#20889; * &#20195;&#34920;&#25509;&#25910;&#20840;&#37096;&#27969;&#37327;&#65292;&#29983;&#20135;&#29615;&#22659;&#24314;&#35774;&#19968;&#20010;&#39033;&#30446;&#19968;&#20010; gateway</span>
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: bookinfo
spec:
  hosts:
  - <span style="color: #8b2252;">"bookinfo.kubeasy.com"</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25512;&#33616;&#20889; * </span>
  gateways:
  - bookinfo-gateway
  http:
  - match:
    - uri:
        exact: /productpage
    - uri:
        prefix: /static
    - uri:
        exact: /login
    - uri:
        exact: /logout
    - uri:
        prefix: /api/v1/products
    route:
    - destination:
        host: productpage
        port:
          number: 9080
</pre>
</div>
</div>
</div>
<div id="outline-container-org72781fe" class="outline-5">
<h5 id="org72781fe">ä½¿ç”¨ kiali è¿›è¡Œæµé‡ç›‘æµ‹</h5>
<div class="outline-text-5" id="text-org72781fe">
<p>
Graph å¯ä»¥çœ‹åˆ°å¾®æœåŠ¡ä¹‹é—´çš„è°ƒç”¨å…³ç³»ã€‚ç‚¹æŸä¸ªæœåŠ¡å¯ä»¥çœ‹åˆ°æµé‡ä¿¡æ¯ç­‰ã€‚<br>
</p>
</div>
</div>
</div>
<div id="outline-container-org42eb322" class="outline-4">
<h4 id="org42eb322">IngressGateway å‘å¸ƒæœåŠ¡åŸç†</h4>
<div class="outline-text-4" id="text-org42eb322">
<p>
ä½¿ç”¨åŸŸåå‘å¸ƒæœåŠ¡ï¼š<br>
</p>
<ul class="org-ul">
<li>Ingress Controller(ingress-nginx) &#x2013;&gt; Service &#x2013;&gt; Pod<br></li>
<li>Ingress Gateway(istio) &#x2013;&gt; VirtualService( Gateway binding &#x2013;&gt; Service ) &#x2013;&gt; Pod<br></li>
</ul>
</div>
</div>
<div id="outline-container-orgd7268cc" class="outline-4">
<h4 id="orgd7268cc">Istio å®ç°ç°åº¦éƒ¨ç½²</h4>
<div class="outline-text-4" id="text-orgd7268cc">
<p>
æ¢¯åº¦çš„æ–¹å¼ç»™ä¸åŒç‰ˆæœ¬åˆ†é…æµé‡ç™¾åˆ†æ¯”<br>
</p>

<p>
ç”¨æµ‹è¯•ç”¨ä¾‹æ¨¡æ‹Ÿç”Ÿäº§æƒ…å†µï¼ŒæŠŠ v2, v3 å…ˆå…³é—­<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl scale deploy --replicas=0 reviews-v2 reviews-v3 -n bookinfo
</pre>
</div>
</div>
<div id="outline-container-org6adf102" class="outline-5">
<h5 id="org6adf102">ä¸»æµå‘å¸ƒæ–¹æ¡ˆ</h5>
<div class="outline-text-5" id="text-org6adf102">
<ul class="org-ul">
<li>ä¸»æµå‘å¸ƒæ–¹æ¡ˆ<br>
<ul class="org-ul">
<li>è“ç»¿å‘å¸ƒ<br></li>
<li>æ»šåŠ¨å‘å¸ƒ<br></li>
<li>ç°åº¦å‘å¸ƒ<br></li>
<li>A/B Test<br></li>
</ul></li>
</ul>

<p>
æ»šåŠ¨å‘å¸ƒï¼š<br>
æ¯æ¬¡åªå‡çº§ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡ï¼Œå‡çº§å®ŒæˆååŠ å…¥ç”Ÿäº§ç¯å¢ƒï¼Œä¸æ–­æ‰§è¡Œè¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°é›†ç¾¤ä¸­çš„å…¨éƒ¨æ—§ç‰ˆå‡çº§æ–°ç‰ˆæœ¬ã€‚Kubernetesçš„é»˜è®¤å‘å¸ƒç­–ç•¥ï¼Œæ›¿æ¢ç”Ÿäº§çš„é•œåƒã€‚<br>
</p>
<ul class="org-ul">
<li>ç‰¹ç‚¹:<br>
<ul class="org-ul">
<li>ç”¨æˆ·æ— æ„ŸçŸ¥ï¼Œå¹³æ»‘è¿‡æ¸¡<br></li>
</ul></li>
<li>ç¼ºç‚¹ï¼š<br>
<ul class="org-ul">
<li>éƒ¨ç½²å‘¨æœŸé•¿<br></li>
<li>å‘å¸ƒç­–ç•¥å¤æ‚<br></li>
<li>ä¸æ˜“å›æ»š<br></li>
<li>æœ‰å½±å“èŒƒå›´è¾ƒå¤§<br></li>
</ul></li>
</ul>


<p>
ç°åº¦å‘å¸ƒï¼š<br>
åªå‡çº§éƒ¨åˆ†æœåŠ¡ï¼Œå³è®©ä¸€éƒ¨åˆ†ç”¨æˆ·ç»§ç»­ç”¨è€ç‰ˆæœ¬ï¼Œä¸€éƒ¨åˆ†ç”¨æˆ·å¼€å§‹ç”¨æ–°ç‰ˆæœ¬ï¼Œå¦‚æœç”¨æˆ·å¯¹æ–°ç‰ˆæœ¬æ²¡æœ‰ä»€ä¹ˆ æ„è§ï¼Œé‚£ä¹ˆé€æ­¥æ‰©å¤§èŒƒå›´ï¼ŒæŠŠæ‰€æœ‰ç”¨æˆ·éƒ½è¿ç§»åˆ°æ–°ç‰ˆ æœ¬ä¸Šé¢æ¥ã€‚å¦‚ï¼Œç”Ÿäº§æ˜¯ v1 ç‰ˆæœ¬ï¼Œ åˆ‡éƒ¨åˆ†æµé‡åˆ° v2 æ–°ç‰ˆæœ¬ï¼Œåªå½±å“éƒ¨åˆ†ç”¨æˆ·ï¼Œæ²¡é—®é¢˜ååˆ‡ 100%  æµé‡ï¼Œv1 ä¸‹çº¿ã€‚<br>
</p>
<ul class="org-ul">
<li>ç‰¹ç‚¹ï¼š<br>
<ul class="org-ul">
<li>ä¿è¯ç³»ç»Ÿæ•´ä½“ç¨³å®šæ€§<br></li>
<li>ç”¨æˆ·æ— æ„ŸçŸ¥ï¼Œå¹³æ»‘è¿‡æ¸¡<br></li>
</ul></li>
<li>ç¼ºç‚¹ï¼š<br>
<ul class="org-ul">
<li>è‡ªåŠ¨åŒ–è¦æ±‚é«˜<br></li>
</ul></li>
</ul>

<p>
é‡‘ä¸é›€å‘å¸ƒï¼š<br>
</p>

<p>
è“ç»¿å‘å¸ƒï¼š<br>
é¡¹ç›®é€»è¾‘ä¸Šåˆ†ä¸ºABç»„ï¼Œä¸Šçº¿æ–°ç‰ˆæœ¬ï¼Œ100%  æµé‡åˆ‡åˆ°æ–°ç‰ˆæœ¬ï¼Œæœ‰é—®é¢˜å†åˆ‡å›å»ã€‚<br>
</p>
<ul class="org-ul">
<li>ç‰¹ç‚¹:<br>
<ul class="org-ul">
<li>ç­–ç•¥ç®€å•<br></li>
<li>å‡çº§/å›æ»šé€Ÿåº¦å¿«<br></li>
<li>ç”¨æˆ·æ— æ„ŸçŸ¥ï¼Œå¹³æ»‘è¿‡æ¸¡<br></li>
</ul></li>
<li>ç¼ºç‚¹ï¼š<br>
<ul class="org-ul">
<li>éœ€è¦ä¸¤å€ä»¥ä¸ŠæœåŠ¡å™¨èµ„æº<br></li>
<li>çŸ­æ—¶é—´å†…æµªè´¹ä¸€å®šèµ„æºæˆæœ¬<br></li>
<li>æœ‰é—®é¢˜å½±å“èŒƒå›´å¤§<br></li>
</ul></li>
</ul>

<p>
A/B Testï¼š<br>
ç°åº¦å‘å¸ƒçš„ä¸€ç§æ–¹å¼ï¼Œä¸»è¦å¯¹ç‰¹å®šç”¨æˆ·é‡‡æ ·åï¼Œå¯¹æ”¶ é›†åˆ°çš„åé¦ˆæ•°æ®åšç›¸å…³å¯¹æ¯”ï¼Œç„¶åæ ¹æ®æ¯”å¯¹ç»“æœä½œå‡ºå†³ç­–ã€‚ç”¨æ¥æµ‹è¯•åº”ç”¨åŠŸèƒ½è¡¨ç°çš„æ–¹æ³•, ä¾§é‡åº”ç”¨çš„å¯ç”¨æ€§ï¼Œå—æ¬¢è¿ç¨‹åº¦ç­‰ï¼Œæœ€åå†³å®šæ˜¯å¦å‡çº§ã€‚<br>
</p>
</div>
</div>
<div id="outline-container-org937c083" class="outline-5">
<h5 id="org937c083">istio å†…å¦‚ä½•å®ç°ç°åº¦å‘å¸ƒ</h5>
<div class="outline-text-5" id="text-org937c083">
<p>
å®šä¹‰å¾®æœåŠ¡çš„æ ‡ç­¾ï¼Œå±äºå“ªä¸ªé¡¹ç›®ã€å‰åç«¯ã€åç§°ã€ç‰ˆæœ¬<br>
</p>

<ul class="org-ul">
<li>Serviceï¼šapp=xxx<br></li>
<li>Deploymentï¼šç‰ˆæœ¬æ ‡ç­¾<br>
<ul class="org-ul">
<li>Podï¼šapp=xxx, version=v1<br></li>
<li>Podï¼šapp=xxx, version=v2<br></li>
</ul></li>
</ul>

<p>
ä½¿ç”¨ VS åšæ‹¦æˆªæ¥æ§åˆ¶æµé‡ã€‚<br>
VirtualService<br>
</p>
<ul class="org-ul">
<li>subnet: v1<br></li>
<li>subnet: v2<br></li>
</ul>

<p>
æ­¥éª¤ï¼š<br>
</p>
<ul class="org-ul">
<li>ä½¿ç”¨ DR åˆ’åˆ† subnet<br>
<ul class="org-ul">
<li>å…·æœ‰ version=v1 æ ‡ç­¾çš„åˆ’åˆ† subnet=v1ï¼›å…·æœ‰ version=v2 æ ‡ç­¾çš„åˆ’åˆ† subnet=v2<br></li>
</ul></li>
<li>ä½¿ç”¨ VS å°†æµé‡å¯¼å‘æ—§ç‰ˆæœ¬<br></li>
<li>éƒ¨ç½²æ–°ç‰ˆæœ¬<br></li>
<li>ä½¿ç”¨ VS åˆ‡æ¢æµé‡<br></li>
</ul>


<p>
æ­¥éª¤1-åˆ›å»º DR åˆ’åˆ† subnetï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">vim reviews-dr.yaml
---
apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: reviews
spec:
  host: reviews
  subsets:
  - name: v1
    labels:
      version: v1 <span style="color: #b22222;"># </span><span style="color: #b22222;">subnet v1 &#25351;&#21521;&#20855;&#26377; version=v1 &#30340; pod</span>
  - name: v2
    labels:
      version: v2 <span style="color: #b22222;"># </span><span style="color: #b22222;">subnet v2 &#25351;&#21521;&#20855;&#26377; version=v2 &#30340; pod</span>
  - name: v3
    labels:
      version: v3 <span style="color: #b22222;"># </span><span style="color: #b22222;">subnet v3 &#25351;&#21521;&#20855;&#26377; version=v3 &#30340; pod</span>


kubectl create -f reviews-dr.yaml -n bookinfo

kubectl get dr -n bookinfo
</pre>
</div>

<p>
æ­¥éª¤2-åˆ›å»º VS å°†æµé‡å¯¼å‘æ—§ç‰ˆæœ¬:<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">vim reviews-v1-all.yaml
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: reviews
spec:
  hosts:
    - reviews
  http:
  - route:
    - destination:
        host: reviews
        subset: v1 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;&#27969;&#37327;&#25351;&#21521; v1</span>

kubectl create -f reviews-v1-all.yaml -n bookinfo
</pre>
</div>
<p>
å†æ¬¡åˆ·æ–°æµè§ˆå™¨ï¼Œä¸å†è¯„åˆ†<br>
</p>

<p>
æ­¥éª¤3-éƒ¨ç½²æ–°ç‰ˆæœ¬ï¼š<br>
å¯åŠ¨æ–°ç‰ˆæœ¬ v2<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl scale deploy --replicas=1 reviews-v2 -n bookinfo
</pre>
</div>


<p>
æ­¥éª¤4-ä½¿ç”¨ VS åˆ‡æ¢æµé‡ï¼š<br>
æ¥ä¸‹æ¥ä¿®æ”¹ virtualServiceï¼Œå°† 20% æµé‡å¯¼å‘ v2 ç‰ˆæœ¬ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">vim reviews-20v2-80v1.yaml
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: reviews
spec:
  hosts:
    - reviews
  http:
  - route:
    - destination:
        host: reviews
        subset: v1 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558; 80% &#27969;&#37327;&#25351;&#21521; v1</span>
      weight: 80   <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#38656;&#35201;&#37197;&#32622;&#19968;&#20010; weight &#21442;&#25968;&#21363;&#21487;</span>
    - destination:
        host: reviews
        subset: v2 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558; 20% &#27969;&#37327;&#25351;&#21521; v2</span>
      weight: 20

kubectl replace -f reviews-20v2-80v1.yaml -n bookinfo
</pre>
</div>

<p>
æ²¡é—®é¢˜åï¼ŒæŠŠæ‰€æœ‰æµé‡æ¥å…¥åˆ° v2ï¼Œåˆ é™¤ dr ä¸­çš„ v1ï¼Œv1 pod å¯ä»¥åˆ é™¤ã€‚<br>
</p>
</div>
</div>
<div id="outline-container-orgb7618eb" class="outline-5">
<h5 id="orgb7618eb">ä½¿ç”¨ kiali å›¾å½¢åŒ–ç®¡ç†å¾®æœåŠ¡æµé‡</h5>
<div class="outline-text-5" id="text-orgb7618eb">
<p>
ä¸æ¨èä½¿ç”¨ã€‚<br>
</p>

<p>
ä½¿ç”¨ä¹‹å‰éœ€è¦æŠŠæ‰‹åŠ¨åˆ›å»ºçš„ vs\dr åˆ é™¤ï¼Œä¸ç„¶æ— æ³•åœ¨å›¾å½¢ç•Œé¢ä¿®æ”¹ã€‚<br>
</p>


<p>
Service ä¸­é€‰æ‹© reviewsï¼Œåœ¨ Actions ä¸­é€‰æ‹© Traffic Shifting å¯ç›´æ¥ä¿®æ”¹æµé‡ï¼Œé»˜è®¤æ˜¯å¹³å‡åˆ†é…çš„æµé‡ã€‚ä¿®æ”¹å®Œæˆåä¼šè‡ªåŠ¨åˆ›å»º VS å’Œ DRã€‚<br>
</p>
</div>
</div>
</div>
<div id="outline-container-org8e88cff" class="outline-4">
<h4 id="org8e88cff">Istio å®ç° AB æµ‹è¯•</h4>
<div class="outline-text-4" id="text-org8e88cff">
<p>
åŒ¹é…ä¸åŒç±»å‹çš„ç”¨æˆ·ï¼Œå¦‚å†…éƒ¨å’Œå¤–éƒ¨ç”¨æˆ·<br>
</p>

<p>
ç¡®è®¤ DR ä¸­æœ‰ v3ç‰ˆæœ¬ã€‚<br>
å¯åŠ¨ v3ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl scale deploy --replicas=1 reviews-v3 -n bookinfo
</pre>
</div>

<p>
å†æ¬¡ä¿®æ”¹ reviews çš„ virtualServiceï¼Œå°†å†…éƒ¨ç”¨æˆ· jason æŒ‡å‘ v3ï¼Œå¤–éƒ¨ç”¨æˆ·ä¾æ—§ä½¿ç”¨ v2 ç‰ˆæœ¬ã€‚<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">vim reviews-jasonv3.yaml
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: reviews
spec:
  hosts:
  - reviews
  http:
  - match:
    - headers:         <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21305;&#37197;&#35831;&#27714;&#22836;</span>
        end-user:      <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21305;&#37197;&#35831;&#27714;&#22836;&#30340; key &#20026; end-user</span>
          exact: jason <span style="color: #b22222;"># </span><span style="color: #b22222;">value &#20026; jason</span>
    route:
    - destination:
        host: reviews
        subset: v3     <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21305;&#37197;&#21040; end-user=jason &#36335;&#30001;&#33267; v3 &#29256;&#26412;</span>
  - route:
    - destination:
        host: reviews
        subset: v2


kubectl replace -f reviews-jasonv3.yaml -n bookinfo
</pre>
</div>
<p>
æµè§ˆå™¨ä¸­ Sign in ç™»å½• jason ç”¨æˆ·éªŒè¯ã€‚<br>
</p>

<p>
å®˜æ–¹ match åŒ¹é…æ–‡æ¡£ï¼š<a href="https://istio.io/latest/docs/reference/config/networking/virtual-service/#HTTPMatchRequest">https://istio.io/latest/docs/reference/config/networking/virtual-service/#HTTPMatchRequest</a><br>
</p>
</div>
</div>
<div id="outline-container-org80195b6" class="outline-4">
<h4 id="org80195b6">Istio åœ°å€é‡å†™å’Œé‡å†™å‘</h4>
<div class="outline-text-4" id="text-org80195b6">
</div>
<div id="outline-container-org16943d4" class="outline-5">
<h5 id="org16943d4">æ–°æ—§åœ°å€æ›¿æ¢</h5>
<div class="outline-text-5" id="text-org16943d4">
<p>
æ¯”å¦‚å°† bookinfo.kubeasy.com/gxï¼Œ301é‡å®šå‘è·³è½¬åˆ° baidu.com/gx<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl edit vs bookinfo -n bookinfo

  - match:
    - uri:
      prefix: /gx  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21305;&#37197; /gx</span>
    redirect:
      uri: /gx
      authority: baidu.com <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36339;&#36716;&#22495;&#21517;</span>
</pre>
</div>

<p>
å‚è€ƒï¼š<a href="https://istio.io/latest/docs/reference/config/networking/virtual-service/#HTTPRedirect">https://istio.io/latest/docs/reference/config/networking/virtual-service/#HTTPRedirect</a><br>
</p>
</div>
</div>
<div id="outline-container-org6c3b637" class="outline-5">
<h5 id="org6c3b637">å‰åç«¯åˆ†ç¦»-rewrite å®è·µ</h5>
<div class="outline-text-5" id="text-org6c3b637">
<p>
istio åœ°å€é‡å†™é…ç½®æ–¹å¼å’Œ é‡å®šå‘ç±»ä¼¼ï¼Œå‡å¦‚å°† / é‡å†™ä¸º /productpageï¼Œé…ç½®å¦‚ä¸‹ ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl edit vs bookinfo -n bookinfo

  - match:
    - uri:
        exact: / <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21305;&#37197;&#26681;&#36335;&#24452;</span>
    rewrite:
      uri: /productpage <span style="color: #b22222;"># </span><span style="color: #b22222;">&#37325;&#20889;&#20026; /productpage</span>
    route:
    - destination:
        host: productpage
        port:
          number: 9080
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org0f913c5" class="outline-4">
<h4 id="org0f913c5">Istio è´Ÿè½½å‡è¡¡ç®—æ³•</h4>
<div class="outline-text-4" id="text-org0f913c5">
<p>
Istio åŸç”Ÿæ”¯æŒå¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œæ¯”å¦‚ ROUND_BOBINã€LEAST_CONNã€RANDOM ç­‰ã€‚<br>
å‡å¦‚ä¸€ä¸ªåº”ç”¨å­˜åœ¨å¤šä¸ªå‰¯æœ¬ï¼ˆPodï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šè¿°ç®—æ³•å¯¹å¤šä¸ª pod è¿›è¡Œå®šåˆ¶åŒ–çš„è´Ÿè½½å‡è¡¡é…ç½®ã€‚<br>
</p>

<p>
æ¯ç§è´Ÿè½½å‡è¡¡çš„ç­–ç•¥å¦‚ä¸‹ ï¼š<br>
</p>
<ul class="org-ul">
<li>ROUND_BOBINï¼šé»˜è®¤ï¼Œè½®è¯¢ç®—æ³•ï¼Œå°†è¯·æ±‚ä¾æ¬¡åˆ†é…ç»™æ¯ä¸€ä¸ªå®ä¾‹ã€‚<br></li>
<li>LEAST_CONNï¼šæœ€å°è¿æ¥æ•°ï¼Œéšæœºé€‰æ‹©ä¸¤ä¸ªå¥åº·å®ä¾‹ï¼Œå°†è¯·æ±‚åˆ†é…æˆä¸¤ä¸ªä¸­è¿æ¥æ•°æœ€å°‘çš„é‚£ä¸ªï¼›<br></li>
<li>RANDOMï¼šéšæœºç®—æ³•ï¼Œå°†è¯·æ±‚éšæœºåˆ†é…ç»™å…¶ä¸­ä¸€ä¸ªå®ä¾‹ï¼›<br></li>
<li>PASSTHROUGHï¼šå°†è¿æ¥è½¬å‘åˆ°è°ƒç”¨è€…è¯·æ±‚çš„åŸå§‹ IP  åœ°å€ï¼Œè€Œä¸è¿›è¡Œä»»ä½•å½¢å¼çš„è´Ÿè½½å¹³è¡¡ï¼Œç›®å‰ä¸æ¨èä½¿ç”¨ã€‚<br></li>
</ul>

<p>
é¦–å…ˆè®¿é—®å¤šæ¬¡ bookinfo çš„é¦–é¡µï¼Œä¹‹åè§‚çœ‹ kiali ä¸­ reviews çš„æµé‡åˆ†é…ã€‚<br>
</p>

<p>
æ›´æ”¹ç®—æ³•<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl edit dr reviews -nbookinfo
...
spec:
  host: reviews
  trafficPolicy:     <span style="color: #b22222;"># </span><span style="color: #b22222;">&#28155;&#21152;&#36335;&#30001;&#31574;&#30053;&#65292;&#22312; spec &#19979;&#23545;&#25152;&#26377;&#30340; subnet &#29983;&#25928;&#65292;&#20063;&#21487;&#20197;&#22312; subnet &#20013;&#37197;&#32622;</span>
    loadBalancer:    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#37197;&#32622;&#36127;&#36733;&#22343;&#34913;</span>
      simple: RANDOM <span style="color: #b22222;"># </span><span style="color: #b22222;">&#31574;&#30053;&#20026; RANDOM</span>
</pre>
</div>

<p>
<a href="https://istio.io/latest/docs/reference/config/networking/destination-rule/#LoadBalancerSettings-SimpleLB">https://istio.io/latest/docs/reference/config/networking/destination-rule/#LoadBalancerSettings-SimpleLB</a><br>
</p>
</div>
</div>
<div id="outline-container-org6bdaac9" class="outline-4">
<h4 id="org6bdaac9">Istio ç†”æ–­-å¹¶å‘æ•°è¿æ¥é™åˆ¶</h4>
<div class="outline-text-4" id="text-org6bdaac9">
<p>
å‡è®¾å¯¹ ratings è¿›è¡Œç†”æ–­ï¼Œå¸Œæœ›åœ¨å¹¶å‘è¯·æ±‚æ•°è¶…è¿‡ 3ï¼Œå¹¶ä¸”å­˜åœ¨ 1 ä¸ªä»¥ä¸Šçš„å¾…å¤„ç†è¯·æ±‚ï¼Œå°±è§¦å‘ç†”æ–­ï¼Œæ­¤æ—¶å¯ä»¥é…ç½® ratings çš„ DestinationRule å¦‚ä¸‹ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">vim ratings-dr.yaml


apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: ratings
  namespace: bookinfo
spec:
  host: ratings
  trafficPolicy:    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#37197;&#32622;&#22312; subsets &#32423;&#21035;</span>
    connectionPool: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36830;&#25509;&#27744;&#37197;&#32622;&#65292;&#21487;&#20197;&#21333;&#29420;&#20351;&#29992;&#38480;&#21046;&#31243;&#24207;&#30340;&#24182;&#21457;&#25968;</span>
      tcp:
        maxConnections: 3     <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26368;&#22823;&#24182;&#21457;&#25968;&#20026; 3</span>
        connectTimeout: 30ms
      http:
        http1MaxPendingRequests: 1 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26368;&#22823;&#30340;&#24453;&#22788;&#29702;&#35831;&#27714;</span>
        maxRequestsPerConnection: 1 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#20010;&#35831;&#27714;&#26368;&#22823;&#30340;&#38142;&#25509;&#25968;</span>
    outlierDetection:         <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29076;&#26029;&#25506;&#27979;&#37197;&#32622;</span>
      consecutive5xxErrors: 1 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#36830;&#32493;&#20986;&#29616;&#30340;&#38169;&#35823;&#36229;&#36807; 1 &#27425;&#65292;&#23601;&#20250;&#29076;&#26029;</span>
      interval: 10s           <span style="color: #b22222;"># </span><span style="color: #b22222;">&#31532; 10 &#31186;&#25506;&#27979;&#19968;&#27425;&#21518;&#31471;&#23454;&#20363;</span>
      baseEjectionTime: 3m    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29076;&#26029;&#26102;&#38388;</span>
      maxEjectionPercent: 100 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#34987;&#29076;&#26029;&#23454;&#20363;&#26368;&#22823;&#30334;&#20998;&#27604;&#65292;&#40664;&#35748; 10%</span>
  subsets:
  - name: v1
    labels:
      version: v1 <span style="color: #b22222;"># </span><span style="color: #b22222;">subnet v1 &#25351;&#21521;&#20855;&#26377; version=v1 &#30340; pod</span>
</pre>
</div>

<p>
ä¿å­˜é€€å‡ºåï¼Œéƒ¨ç½²å‹æµ‹å·¥å…· fortioï¼Œç”¨äºå¯¹å®¹å™¨ä¸šåŠ¡è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl -n bookinfo apply -f samples/httpbin/sample-client/fortio-deploy.yaml
</pre>
</div>

<p>
ç­‰å¾… fortio å®¹å™¨å¯åŠ¨åï¼Œè·å– fortrio å®¹å™¨ id:<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #a0522d;">FORTIO_POD</span>=$(<span style="color: #ff00ff;">kubectl get pod -n bookinfo | grep fortio | awk '{print $1}'</span>)
<span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">FORTIO_POD</span>
</pre>
</div>

<p>
å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰çŠ¶æ€ç ä¸º 200ï¼Œå³è¿æ¥æˆåŠŸï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl exec -it $<span style="color: #a0522d;">FORTIO_POD</span> -n bookinfo -- fortio load -curl http://ratings:9080/ratings/0
</pre>
</div>

<p>
æ¥ä¸‹æ¥æ›´æ”¹ä¸ºä¸¤ä¸ªå¹¶å‘è¿æ¥`-c 2`ï¼Œå‘é€ 20 è¯·æ±‚ `-n 20`:<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl exec -it $<span style="color: #a0522d;">FORTIO_POD</span> -n bookinfo -- fortio load -c 2 -gps 0 -n 20-curl http://ratings:9080/ratings/0 | grep Code
</pre>
</div>

<p>
å¯ä»¥çœ‹åˆ° 503 çš„ç»“æœä¸º 5ï¼Œè¯´æ˜è§¦å‘äº†ç†”æ–­ã€‚æé«˜å¹¶å‘é‡ï¼Œå¯ä»¥çœ‹åˆ°æ•…éšœç‡æ›´é«˜ã€‚<br>
æœ€åæŸ¥çœ‹ fortio è¯·æ±‚è®°å½•ï¼ˆupstream_rq_pending_overflow è¡¨ç¤ºç†”æ–­æ¬¡æ•°ï¼‰ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">kubectl -n bookinfo exec -it  $<span style="color: #a0522d;">FORTIO_POD</span> -c istio-proxy -- sh -c <span style="color: #8b2252;">'curl localhost:15000/stats'</span> | grep ratings |grep pending_overflow
</pre>
</div>
</div>
</div>
<div id="outline-container-org874143e" class="outline-4">
<h4 id="org874143e">Istio æ•…éšœå¤„ç†</h4>
<div class="outline-text-4" id="text-org874143e">
</div>
<div id="outline-container-org69adcff" class="outline-5">
<h5 id="org69adcff">Istio æ³¨å…¥å»¶è¿Ÿæ•…éšœ</h5>
<div class="outline-text-5" id="text-org69adcff">
<p>
é¦–å…ˆä¸æ·»åŠ ä»»ä½•å»¶è¿Ÿï¼Œçœ‹ä¸€ä¸‹è®¿é—®é€Ÿåº¦å¦‚ä½•ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;">#  </span><span style="color: #b22222;">&#21019;&#24314;&#19968;&#20010;&#29992;&#20110;&#27979;&#35797;&#30340;&#24037;&#20855;</span>
kubectl run -it -n bookinfo debug-tools --image=registry.cn-beijing.aliyuncs.com/dotbalo/debug-tools
) <span style="color: #a020f0;">time</span> curl -I -s details:9080
</pre>
</div>

<p>
æ³¨å…¥æ•…éšœ<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">vim details-delay.yaml
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: details
  namespace: bookinfo
spec:
  hosts:
  - details
  http:
  - fault:             <span style="color: #b22222;"># </span><span style="color: #b22222;">&#28155;&#21152;&#19968;&#20010;&#38169;&#35823;</span>
      delay:           <span style="color: #b22222;"># </span><span style="color: #b22222;">&#28155;&#21152;&#31867;&#22411;&#20026; delay &#30340;&#25925;&#38556;</span>
        fixedDelay: 5s <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27880;&#20837;&#30340;&#24310;&#36831;&#26102;&#38388;</span>
        percentage:    <span style="color: #b22222;">#  </span><span style="color: #b22222;">&#25925;&#38556;&#27880;&#20837;&#30340;&#30334;&#20998;&#27604;</span>
          value: 100   <span style="color: #b22222;">#  </span><span style="color: #b22222;">&#23545;&#25152;&#26377;&#35831;&#27714;&#27880;&#20837;&#25925;&#38556;</span>
    route:
    - destination:
        host: details
        subset: v1

kubectl create -f details-delay.yaml -n bookinfo
</pre>
</div>

<p>
å†æ¬¡è¿›è¡Œæµ‹è¯•ï¼Œè¿”å›æ—¶é—´å·²ç»è¾¾åˆ°äº† 5 ç§’ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">) <span style="color: #a020f0;">time</span> curl -I -s details:9080
</pre>
</div>
</div>
</div>
<div id="outline-container-org209c1c8" class="outline-5">
<h5 id="org209c1c8">Istio æ³¨å…¥ä¸­æ–­æ•…éšœ</h5>
<div class="outline-text-5" id="text-org209c1c8">
<p>
ä¸­æ–­æ•…éšœæ³¨å…¥åªéœ€è¦å°† fault çš„ delay æ›´æ”¹ä¸º abort å³å¯ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">vim details-abort.yaml
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: details
  namespace: bookinfo
spec:
  hosts:
  - details
  http:
  - fault:             <span style="color: #b22222;"># </span><span style="color: #b22222;">&#28155;&#21152;&#19968;&#20010;&#38169;&#35823;</span>
      abort:           <span style="color: #b22222;"># </span><span style="color: #b22222;">&#28155;&#21152;&#31867;&#22411;&#20026; abort &#30340;&#25925;&#38556;</span>
        httpStatus: 400 <span style="color: #b22222;">#  </span><span style="color: #b22222;">&#25925;&#38556;&#29366;&#24577;&#30721;</span>
        percentage:    <span style="color: #b22222;">#  </span><span style="color: #b22222;">&#25925;&#38556;&#27880;&#20837;&#30340;&#30334;&#20998;&#27604;</span>
          value: 100   <span style="color: #b22222;">#  </span><span style="color: #b22222;">&#23545;&#25152;&#26377;&#35831;&#27714;&#27880;&#20837;&#25925;&#38556;</span>
    route:
    - destination:
        host: details
        subset: v1

kubectl replace -f details-delay.yaml -n bookinfo
</pre>
</div>

<p>
å†æ¬¡è¿›è¡Œæµ‹è¯•ï¼Œè¿”å› 400 é”™è¯¯ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">) <span style="color: #a020f0;">time</span> curl -I -s details:9080
</pre>
</div>
</div>
</div>
<div id="outline-container-orga206426" class="outline-5">
<h5 id="orga206426">Istio å¿«é€Ÿè¶…æ—¶é…ç½®</h5>
<div class="outline-text-5" id="text-orga206426">
<p>
ä¸æƒ³å› ä¸ºä¸€ä¸ªè¯„åˆ†ç³»ç»Ÿå¯¼è‡´æ•´ä¸ªè®¿é—®æ…¢<br>
</p>

<p>
é¦–å…ˆå‘ ratings æœåŠ¡æ³¨å…¥ä¸€ä¸ª 5 ç§’çš„å»¶è¿Ÿæ¨¡æ‹Ÿ ratings æœåŠ¡å“åº”æ¯”è¾ƒæ…¢ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">vim ratings-delay.yaml
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: ratings-delay
  namespace: bookinfo
spec:
  hosts:
  - ratings
  http:
  - fault:             <span style="color: #b22222;"># </span><span style="color: #b22222;">&#28155;&#21152;&#19968;&#20010;&#38169;&#35823;</span>
      delay:           <span style="color: #b22222;"># </span><span style="color: #b22222;">&#28155;&#21152;&#31867;&#22411;&#20026; delay &#30340;&#25925;&#38556;</span>
        fixedDelay: 5s <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27880;&#20837;&#30340;&#24310;&#36831;&#26102;&#38388;</span>
        percentage:    <span style="color: #b22222;">#  </span><span style="color: #b22222;">&#25925;&#38556;&#27880;&#20837;&#30340;&#30334;&#20998;&#27604;</span>
          value: 100   <span style="color: #b22222;">#  </span><span style="color: #b22222;">&#23545;&#25152;&#26377;&#35831;&#27714;&#27880;&#20837;&#25925;&#38556;</span>
    route:
    - destination:
        host: ratings

kubectl create -f ratings-delay.yaml
</pre>
</div>

<p>
è®¿é—®æµ‹è¯•ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell">) <span style="color: #a020f0;">time</span> curl -I -s ratings:9080
</pre>
</div>

<p>
æ­¤æ—¶åœ¨æµè§ˆå™¨è®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°æ•´ä¸ªé¡µé¢éƒ½å˜å¾—ç¼“æ…¢ã€‚æ¥ä¸‹æ¥å‘ reviews æœåŠ¡é…ç½®ä¸€ä¸ª 1 ç§’è¶…æ—¶ï¼Œå› ä¸ºæ˜¯ reviews æœåŠ¡è°ƒç”¨çš„ ratings æœåŠ¡ï¼š<br>
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#32534;&#36753;&#24403;&#21069; reviews &#30340; VS</span>
kubectl edit vs reviews -n bookinfo
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: reviews
spec:
  hosts:
  - reviews
  http:
  - match:
    - headers:         <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21305;&#37197;&#35831;&#27714;&#22836;</span>
        end-user:      <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21305;&#37197;&#35831;&#27714;&#22836;&#30340; key &#20026; end-user</span>
          exact: jason <span style="color: #b22222;"># </span><span style="color: #b22222;">value &#20026; jason</span>
    route:
    - destination:
        host: reviews
        subset: v3     <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21305;&#37197;&#21040; end-user=jason &#36335;&#30001;&#33267; v3 &#29256;&#26412;</span>
    timeout: 1s <span style="color: #b22222;"># </span><span style="color: #b22222;">&#28155;&#21152;&#36229;&#26102;&#65292;&#26102;&#38388;&#20026; 1 &#31186;</span>
  - route:
    - destination:
        host: reviews
        subset: v2
</pre>
</div>

<p>
é‡æ–°ç¼–è¾‘åï¼Œå†æ¬¡ä½¿ç”¨æµè§ˆå™¨æµ‹è¯•ï¼Œæœªç™»å½•ç”¨æˆ·å¤§æ¦‚ä¼šæœ‰ 5 ç§’ä»¥ä¸Šçš„å»¶è¿Ÿï¼Œè€Œç™»å½•ç”¨æˆ·ä¸º jason çš„ï¼Œå¯ä»¥å¾ˆå¿«å°±èƒ½æ‰“å¼€é¡µé¢ã€‚<br>
</p>
</div>
</div>
</div>
</div>
</section>
</main class="container">
<footer id="postamble" class="status">
<footer data-astro-cid-sz7xmlte data-turbo-permanent id=rootFooter>
    <script>
        const shuffle = e => e.map((e => ({
            v: e,
            sort: Math.random()
        }))).sort(( (e, o) => e.sort - o.sort)).map(( ({v: e}) => e));
        var songList = ["barbie-girl--stantough", "blue-da-ba-dee--cornelius-link", "hips-dont-lie--stantough", "i-want-it-that-way--stantough", "seven-nation-army--stantough", "smooth-criminal--stantough"]
          , songOrder = songOrder ?? shuffle(songList).map((e => `/audio/music/${e}.opus`))
          , song = new Audio(songOrder[0])
          , nextSong = new Audio(songOrder[1])
          , songIndex = 2
          , musicWrapper = void 0
          , arrow = void 0
          , notes = void 0;
        song.addEventListener("ended", next);
        const toggle = () => song.paused ? play() : pause();
        function play() {
            song.play(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.add("shakeManHorse"),
            notes.classList.remove("hideNotes")
        }
        function pause() {
            song.pause(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.remove("shakeManHorse"),
            notes.classList.add("hideNotes")
        }
        function next() {
            song = nextSong,
            play(),
            songIndex === songOrder.length && (songIndex = 0),
            nextSong = new Audio(songOrder[songIndex]),
            songIndex += 1
        }
        function skip() {
            pause(),
            (arrow = arrow || document.getElementById("musicArrow")).classList.add("shootArrow");
            new Audio("/audio/effects/ohno.m4a").play(),
            arrow.addEventListener("animationend", arrowShootHandler, !1)
        }
        function arrowShootHandler() {
            arrow.removeEventListener("animationend", arrowShootHandler, !1),
            arrow.classList.remove("shootArrow");
            new Audio("/audio/effects/heythathurt.m4a").play(),
            next()
        }
    </script>
    <div id=musicPlayer data-astro-cid-q7a5pyro>
        <button class=skip data-astro-cid-q7a5pyro onclick=skip() title="Skip song">
            <div id=skipWrapper data-astro-cid-q7a5pyro>
                <img alt="Medieval drollery of a man/snail/bat/monkey shooting an arrow" class=archer decoding=async height=334 loading=lazy src=/images/archer-no-arrow.448ccd8b_Z1KfRYq.webp width=226 data-astro-cid-q7a5pyro>
                <img alt="Arrow for archer" class="arrow complete" decoding=async height=23 loading=lazy src=/images/no-archer-full-arrow.87aa9971_Z2qL2KO.webp width=141 data-astro-cid-q7a5pyro id=musicArrow>
            </div>
        </button>
        <button class=playPause data-astro-cid-q7a5pyro onclick=toggle() title="Play/pause song">
            <div id=musicWrapper data-astro-cid-q7a5pyro>
                <div class=hideNotes id=notesWrapper data-astro-cid-q7a5pyro>
                    <div class=lyreNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                    <div class=fluteNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                </div>
                <img alt="Medieval drollery of a man/horse playing a lyre and a horn" class=manHorse decoding=async height=665 loading=lazy src=/images/man-horse-band.e3a2efcf_q8FCa.webp width=531 data-astro-cid-q7a5pyro>
            </div>
        </button>
    </div>
    <hr data-astro-cid-sz7xmlte>
    <div class=salutation data-astro-cid-gdmrbrho>
        <p data-astro-cid-gdmrbrho>
            <span class=flower2 data-astro-cid-gdmrbrho>A</span>
            <span class=smallcap data-astro-cid-gdmrbrho>pax vobiscum</span>
            <span class="flower2 wiggle" data-astro-cid-gdmrbrho id=leaf>a</span>
        </p>
    </div>
    <script>
        function animateLeafBlownHandler() {
            leaf.removeEventListener("animationend", animateLeafBlownHandler, !1),
            leaf.classList.remove("blownAway"),
            leaf.classList.add("wiggle")
        }
        function animateLeaf() {
            leaf = leaf ?? document.getElementById("leaf"),
            leaf.classList.remove("wiggle"),
            leaf.classList.add("blownAway"),
            leaf.addEventListener("animationend", animateLeafBlownHandler, !1)
        }
        document.getElementById("leaf").onclick = animateLeaf
    </script>


    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>æ‰“èµ</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Â© 2024 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
</footer>
</footer>
</body>
</html>
