<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linux: Linux文本处理工具和正则表达式</title>
<meta name="generator" content="Org Mode" />
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<!-- from -->
<!--
<style>#back-to-top{background:#000;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;bottom:20px;-webkit-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);-moz-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);box-shadow:0 2px 5px 0 rgba(0,0,0,.26);color:#fff;cursor:pointer;display:block;height:56px;opacity:1;outline:0;position:fixed;right:20px;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-transition:bottom .2s,opacity .2s;-o-transition:bottom .2s,opacity .2s;-moz-transition:bottom .2s,opacity .2s;transition:bottom .2s,opacity .2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:56px;z-index:1}#back-to-top svg{display:block;fill:currentColor;height:24px;margin:16px auto 0;width:24px}#back-to-top.hidden{bottom:-56px;opacity:0}</style>
-->
<link rel="stylesheet" href="/static/distro-htmlize.css">
<link rel="stylesheet" href="/static/aandds.com/css/main.css">
<link rel="stylesheet" href="/static/aandds.com/css/drollery.min.css">
<script type="text/javascript" src="/static/aandds.com/js/main.js"></script>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Linux: Linux文本处理工具和正则表达式</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:70d11cb8-8708-4916-b5ed-d1fa83259ef3">文本编辑工具之神VIM</a></li>
<li><a href="#h:a90abb7c-9db4-4b1f-aeb1-9a7c5f215cf1">文本常见处理工具</a>
<ul>
<li><a href="#h:bc51fdfd-46a7-4df6-bfd9-e99115eef887">文件内容查看命令</a>
<ul>
<li><a href="#h:19330c6a-7039-4d2c-96f2-d7ef788f7bbb">查看文本文件内容</a>
<ul>
<li><a href="#h:6f157e98-8cdc-4849-a5eb-b21a1a92f237">cat</a></li>
<li><a href="#h:4253557c-ac0b-483a-a359-44f4a784cab2">nl</a></li>
<li><a href="#h:43127cb4-c3df-4fa5-965c-91e67595de40">tac</a></li>
<li><a href="#h:98d04dce-db33-4b8c-ae26-f526133ef5e2">rev</a></li>
</ul>
</li>
<li><a href="#h:0a283806-ae71-4e2d-be35-9f6874214298">查看非文本文件内容</a>
<ul>
<li><a href="#h:a0bdabec-4487-4d20-b95e-6b28a385b4dc">hexdump</a></li>
<li><a href="#h:8026cdf1-7d54-427a-acbb-0393a991b03c">od</a></li>
<li><a href="#h:61f7cc8d-9125-4ebb-bbfa-cda9a675698b">xxd</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:f1656fb3-492d-42ba-928f-5708a8c3437e">分页查看文件内容</a>
<ul>
<li><a href="#h:3c258c6e-1493-4f10-9d87-2acd178d905c">more</a></li>
<li><a href="#h:57079271-facc-41d7-8a01-36bfa097b5fc">less</a></li>
</ul>
</li>
<li><a href="#h:f7949d1a-b7c7-47c7-8018-016d1362814e">显示文本前或后行内容</a>
<ul>
<li><a href="#h:131dc721-0906-425f-bb79-7697116e705f">head</a></li>
<li><a href="#h:11fdd8c8-2c5f-4cd3-81c4-44731646653f">tail</a></li>
</ul>
</li>
<li><a href="#h:6632b664-a35b-4012-824a-f706f46d4908">按列抽取文本cut</a></li>
<li><a href="#h:17f701a9-2b99-4ac8-8f8d-c126445c1f30">字符转换命令： tr, col, join, paste</a>
<ul>
<li><a href="#h:335874fc-514d-44e4-9128-74d809e3762b">转换和删除字符tr</a></li>
<li><a href="#h:d826b8ab-9951-41b9-b9b4-65e83a6c3cf7">col</a></li>
<li><a href="#h:52ead11e-a5eb-4400-a5d7-a71348e88e0d">多文件数据合并join</a></li>
<li><a href="#h:61043ddb-3564-4c4d-9d29-e808471cad66">多个文件合并paste</a></li>
<li><a href="#h:907a7309-4f1f-4fa7-a347-41ac97134c7b">文本流格式化为多列输出column</a></li>
<li><a href="#h:4fe9f1a8-aa47-436c-8381-76d2c451b35b">转换文件字符集编码iconv</a></li>
</ul>
</li>
<li><a href="#h:a26d70f6-56c6-4110-8762-177749dcafe9">分割命令： split</a></li>
<li><a href="#h:f2d11901-058a-4324-b421-4d4ca96bb2a3">分析文本的工具</a>
<ul>
<li><a href="#h:3087dd42-146c-4726-8548-44e09b86d5f7">收集文本统计数据wc</a></li>
<li><a href="#h:7007405e-5772-4874-b5ef-9ed476def4a3">文本排序sort</a></li>
<li><a href="#h:c93ae04a-b31a-4369-84da-61ea205da931">去重uniq</a></li>
<li><a href="#h:b4f14745-7103-44e3-99a5-c23186dd324d">统计代码行数cloc</a></li>
<li><a href="#h:20091fcb-d854-472c-ab05-626013984690">比较文件</a>
<ul>
<li><a href="#h:ec21b649-8966-45d1-8efb-659c5b8cd51f">diff</a></li>
<li><a href="#h:70cb695d-6544-460d-805b-33cecb8e4be9">patch</a></li>
<li><a href="#h:3d052250-0d79-411b-b940-3b5b5d3031a8">二进制文件的不同 cmp</a></li>
<li><a href="#h:cef5110a-31c5-4937-875d-33159edd56b3">comm比较文件取集合</a></li>
</ul>
</li>
<li><a href="#h:62fc6575-046e-40ef-81c1-058a545ed427">json文件分析jq</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:f101eef7-f24c-405e-9cc9-4d40a61ba924">正则表达式</a>
<ul>
<li><a href="#h:58562c6b-529e-4f2b-ac86-599d68a637f3">基本正则表达式元字符</a>
<ul>
<li><a href="#h:081be6ea-a706-4f07-8f1e-a5a5a8c204bc">元字符</a></li>
<li><a href="#h:ac084252-e922-45b5-bbae-7a372dbece05">中括号</a></li>
<li><a href="#h:503c912a-8466-493d-b64f-4b9f386ff9d6">字符类</a></li>
<li><a href="#h:7b6c68c5-a1e3-45ea-8e5e-7e8b670edf3c">反斜线序列</a></li>
<li><a href="#h:9589c9e7-00f7-4761-9dcf-eb1430872333">分组捕获和反向引用</a>
<ul>
<li><a href="#h:05c0ed3a-9389-4471-811b-b30545dd97f9">分组</a></li>
</ul>
</li>
<li><a href="#h:746c0951-918e-4ae2-bf0b-953b7274b767">或者</a></li>
</ul>
</li>
<li><a href="#h:079dc060-e0ec-45e9-9766-18ab08eee9b8">基本正则表达式与扩展正则表达式</a>
<ul>
<li><a href="#h:01367717-c17f-4a72-99fe-8b6426d4fe2d">字符匹配元字符</a></li>
<li><a href="#h:854abb7a-70e0-4f7b-8ff3-11a8d100410f">次数匹配</a></li>
<li><a href="#h:6ec6141c-09a7-45ef-b286-8dc703db406b">位置锚定</a></li>
<li><a href="#h:ef494e68-e31c-43e3-98e7-e717d6da66bd">分组其它</a></li>
</ul>
</li>
<li><a href="#h:a719b9e4-1ff3-48fe-b315-97331284c06b">Perl正则表达式超详细教程</a>
<ul>
<li><a href="#h:5ad9bb01-d312-44bb-b782-d00186c02fae">学perl正则必备的一点基本语法</a></li>
<li><a href="#h:e15f23e9-af42-4a89-9548-e65acaccd7af">perl如何使用正则进行匹配</a></li>
<li><a href="#h:dd69c6c9-dc51-407c-ac10-52fe697a2aef">perl支持的正则</a>
<ul>
<li><a href="#h:63ae938d-961f-4255-8f27-2d154fcd12be">模式匹配修饰符</a></li>
<li><a href="#h:77f34eb0-ccdd-4427-97ab-c32e7176471c">范围模式匹配修饰符(?imsx-imsx:pattern)</a></li>
<li><a href="#h:6b0d3137-5842-4635-8ec8-4784b2ea08ae">perl支持的反斜线序列</a></li>
<li><a href="#h:61376ab1-d21e-48c0-be11-1da47fca0fab">贪婪匹配、非贪婪匹配、占有优先匹配</a></li>
<li><a href="#h:2621ad54-b51c-45d4-a3d2-63232934beba">perl的分组捕获和分组引用</a></li>
<li><a href="#h:f5d908cc-7138-4a32-bde1-5fa5fe4350c2">环视锚定(断言)</a></li>
<li><a href="#h:e0859264-62af-4112-8e1a-7b39cabc3c5a">\Q&#x2026;\E</a></li>
</ul>
</li>
<li><a href="#h:493838d5-ac4a-4579-ac53-117d69da255b">qr//创建正则对象</a></li>
</ul>
</li>
<li><a href="#h:e434eaf8-d7be-4a73-a104-dc8564d0a1f0">引擎选项</a>
<ul>
<li><a href="#h:4d6ea5ec-819f-4099-8eab-c0e890adde2a">匹配范例</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:5c8deae3-a8b3-4a3a-9ce4-29a9d9f6bdb2">文本处理三剑客</a>
<ul>
<li><a href="#h:57a1c4cb-314c-4ee9-b6ae-30fe057df04a">文本处理三剑客之 grep</a>
<ul>
<li><a href="#h:00fee694-6056-44dd-9e0e-365be6b31f8a">匹配中文</a></li>
<li><a href="#h:1d530be4-3dcb-41ca-98ee-1e1273b34f4a">rg</a></li>
</ul>
</li>
<li><a href="#h:00eb27fd-d142-46ea-bf47-cbe2beac358b">文本处理三剑客之 sed</a>
<ul>
<li><a href="#h:6f10afc3-f395-4f9a-9b3a-7b777d15bc3b">工作原理</a></li>
<li><a href="#h:eb4916ae-7aad-49d0-8914-c1a90dde075b">sed 基本用法</a></li>
<li><a href="#h:f11b26ca-74f9-43db-9e79-d398ed3fe42e">sed 高级用法</a>
<ul>
<li><a href="#h:8443a947-13b9-46f7-b84d-12e82b9bd4a8">运行sed脚本</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:6c78e418-2e17-4f19-9533-3a1732045d57">文本处理三剑客之 awk</a>
<ul>
<li><a href="#h:26067d29-6c5b-4ac7-b90e-742ed5c73124">awk 工作原理和基本用法说明</a></li>
<li><a href="#h:651d5fb4-2329-4e17-b375-33cab31ad010">动作 print</a></li>
<li><a href="#h:410d13ba-f572-422d-821a-dc467b6d927c">awk变量</a></li>
<li><a href="#h:0550fd59-cb4e-4ed3-967e-3116e4b0d11b">动作 printf</a></li>
<li><a href="#h:0c9fc8eb-9b81-4ecb-95fc-ea30fcb5aa8f">操作符</a></li>
<li><a href="#h:2ac2a1da-7c39-4d4a-801c-68c3b8401190">模式PATTERN</a></li>
<li><a href="#h:46cce902-486e-4776-91d1-d18e44baa8d6">条件判断 if-else</a></li>
<li><a href="#h:d3d01ea0-6fd8-4cf4-bf98-f37f5f845586">switch语句</a></li>
<li><a href="#h:8ad055e7-0d8e-43c8-a0d6-f1e979e7067f">循环while</a></li>
<li><a href="#h:1e0aa331-b8fb-46dd-bd2f-9b698cdfc535">循环 do-while</a></li>
<li><a href="#h:78143b8d-a2c5-440d-b639-0e83e64f7124">循环for</a></li>
<li><a href="#h:3ec30f2d-1eda-4c48-b0c9-87be8d2cb96e">continue和break</a></li>
<li><a href="#h:cc9a4d32-4866-436a-9b65-760d3ae77e69">next</a></li>
<li><a href="#h:eea0edc1-873e-4b01-a547-598157b9197a">数组</a></li>
<li><a href="#h:490ccd2b-5e02-48a0-b916-b2c93eb5a786">awk函数</a>
<ul>
<li><a href="#h:89b3484c-93bb-4c7e-b113-dc61406a7392">常见内置函数</a></li>
<li><a href="#h:fcc115c1-565b-45af-8359-a6080636723c">自定义函数</a></li>
</ul>
</li>
<li><a href="#h:f24d1b74-e72a-43f6-b69e-5633a0f29d87">awk脚本</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="./../index.html">Linux</a></li>
</ul>


<p>
摘要：本文介绍Linux文本处理工具和正则表达式
</p>

<p>
内容概述
</p>

<ul class="org-ul">
<li>文本编辑工具VIM</li>
<li>各种文本工具</li>
<li>基本正则表达式和扩展正则表达式</li>
<li>文本处理三剑客之grep</li>
<li>文本处理三剑客之sed</li>
<li>文本处理三剑客之awk</li>
</ul>
<section id="outline-container-h:70d11cb8-8708-4916-b5ed-d1fa83259ef3" class="outline-2">
<h2 id="h:70d11cb8-8708-4916-b5ed-d1fa83259ef3"><a href="#h:70d11cb8-8708-4916-b5ed-d1fa83259ef3">文本编辑工具之神VIM</a></h2>
<div class="outline-text-2" id="text-h:70d11cb8-8708-4916-b5ed-d1fa83259ef3">
<p>
<a href="./05-vim.html">vim</a>
</p>
</div>
</section>
<section id="outline-container-h:a90abb7c-9db4-4b1f-aeb1-9a7c5f215cf1" class="outline-2">
<h2 id="h:a90abb7c-9db4-4b1f-aeb1-9a7c5f215cf1"><a href="#h:a90abb7c-9db4-4b1f-aeb1-9a7c5f215cf1">文本常见处理工具</a></h2>
<div class="outline-text-2" id="text-h:a90abb7c-9db4-4b1f-aeb1-9a7c5f215cf1">
</div>
<div id="outline-container-h:bc51fdfd-46a7-4df6-bfd9-e99115eef887" class="outline-3">
<h3 id="h:bc51fdfd-46a7-4df6-bfd9-e99115eef887"><a href="#h:bc51fdfd-46a7-4df6-bfd9-e99115eef887">文件内容查看命令</a></h3>
<div class="outline-text-3" id="text-h:bc51fdfd-46a7-4df6-bfd9-e99115eef887">
</div>
<div id="outline-container-h:19330c6a-7039-4d2c-96f2-d7ef788f7bbb" class="outline-4">
<h4 id="h:19330c6a-7039-4d2c-96f2-d7ef788f7bbb"><a href="#h:19330c6a-7039-4d2c-96f2-d7ef788f7bbb">查看文本文件内容</a></h4>
<div class="outline-text-4" id="text-h:19330c6a-7039-4d2c-96f2-d7ef788f7bbb">
</div>
<div id="outline-container-h:6f157e98-8cdc-4849-a5eb-b21a1a92f237" class="outline-5">
<h5 id="h:6f157e98-8cdc-4849-a5eb-b21a1a92f237"><a href="#h:6f157e98-8cdc-4849-a5eb-b21a1a92f237">cat</a></h5>
<div class="outline-text-5" id="text-h:6f157e98-8cdc-4849-a5eb-b21a1a92f237">
<p>
cat 可以查看文本内容 格式： cat [OPTION]&#x2026; [FILE]&#x2026;
</p>

<p>
常见选项
</p>

<div class="org-src-container">
<pre class="src src-sh">-E&#65306;&#26174;&#31034;&#34892;&#32467;&#26463;&#31526;$
-A&#65306;&#26174;&#31034;&#25152;&#26377;&#25511;&#21046;&#31526;
-n&#65306;&#23545;&#26174;&#31034;&#20986;&#30340;&#27599;&#19968;&#34892;&#36827;&#34892;&#32534;&#21495;
-b&#65306;&#38750;&#31354;&#34892;&#32534;&#21495;
-s&#65306;&#21387;&#32553;&#36830;&#32493;&#30340;&#31354;&#34892;&#25104;&#19968;&#34892;
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat -A /data/fa.txt
a  b$
c $
d^Ib^Ic$
[root@centos8 ~]#cat /data/fa.txt
a  b
c
d    b    c
[root@centos8 ~]#cat /data/fb.txt
a
b
c
[root@centos8 ~]#hexdump -C /data/fb.txt
00000000 61 0d 0a 62 0d 0a 63 0d 0a            |a..b..c..|
00000009
[root@centos8 ~]#cat -A /data/fb.txt
a^M$
b^M$
c^M$
[root@centos8 ~]#file /data/fb.txt
/data/fb.txt: ASCII text, with CRLF line terminators
</pre>
</div>
</div>
</div>
<div id="outline-container-h:4253557c-ac0b-483a-a359-44f4a784cab2" class="outline-5">
<h5 id="h:4253557c-ac0b-483a-a359-44f4a784cab2"><a href="#h:4253557c-ac0b-483a-a359-44f4a784cab2">nl</a></h5>
<div class="outline-text-5" id="text-h:4253557c-ac0b-483a-a359-44f4a784cab2">
<p>
显示行号，相当于cat -b 选项与参数：
</p>

<pre class="example" id="org703be13">
-b  ：指定行号指定的方式，主要有两种：
      -b a ：表示不论是否为空行，也同样列出行号(类似 cat -n)；
      -b t ：如果有空行，空的那一行不要列出行号(默认值)；
-n  ：列出行号表示的方法，主要有三种：
      -n ln ：行号在萤幕的最左方显示；
      -n rn ：行号在自己栏位的最右方显示，且不加 0 ；
      -n rz ：行号在自己栏位的最右方显示，且加 0 ；
-w  ：行号栏位的占用的位数。
</pre>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /data/f1.txt
a
b
c
d
e
f
g
h
[root@centos8 ~]#nl /data/f1.txt
  1 a
  2 b
  3 c
  4 d
  5 e
  6 f
  7 g
  8 h
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">[root@www ~]# nl -b a -n rz -w 3 /etc/issue
001     CentOS release 5.3 (Final)
002     Kernel \r on an \m
003
<span class="org-comment-delimiter"># </span><span class="org-comment">&#21464;&#25104;&#20165;&#26377; 3 &#20301;&#25968;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:43127cb4-c3df-4fa5-965c-91e67595de40" class="outline-5">
<h5 id="h:43127cb4-c3df-4fa5-965c-91e67595de40"><a href="#h:43127cb4-c3df-4fa5-965c-91e67595de40">tac</a></h5>
<div class="outline-text-5" id="text-h:43127cb4-c3df-4fa5-965c-91e67595de40">
<p>
逆向显示文本内容
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /data/fa.txt
1
2
3
4
5
[root@centos8 ~]#tac /data/fa.txt
5
4
3
2
1
[root@centos8 ~]#tac
a
bb
ccc &#25353;ctrl+d
ccc
bb
a
[root@centos8 ~]#seq 10 |tac
10
9
8
7
6
5
4
3
2
1
</pre>
</div>
</div>
</div>
<div id="outline-container-h:98d04dce-db33-4b8c-ae26-f526133ef5e2" class="outline-5">
<h5 id="h:98d04dce-db33-4b8c-ae26-f526133ef5e2"><a href="#h:98d04dce-db33-4b8c-ae26-f526133ef5e2">rev</a></h5>
<div class="outline-text-5" id="text-h:98d04dce-db33-4b8c-ae26-f526133ef5e2">
<p>
将同一行的内容逆向显示
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /data/fa.txt
1 2 3 4 5
a b c
[root@centos8 ~]#tac /data/fa.txt
a b c
1 2 3 4 5
[root@centos8 ~]#rev /data/fa.txt
5 4 3 2 1
c b a
[root@centos8 ~]#rev
abcdef
fedcba
[root@centos8 ~]#echo {1..10} |rev
01 9 8 7 6 5 4 3 2 1
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:0a283806-ae71-4e2d-be35-9f6874214298" class="outline-4">
<h4 id="h:0a283806-ae71-4e2d-be35-9f6874214298"><a href="#h:0a283806-ae71-4e2d-be35-9f6874214298">查看非文本文件内容</a></h4>
<div class="outline-text-4" id="text-h:0a283806-ae71-4e2d-be35-9f6874214298">
</div>
<div id="outline-container-h:a0bdabec-4487-4d20-b95e-6b28a385b4dc" class="outline-5">
<h5 id="h:a0bdabec-4487-4d20-b95e-6b28a385b4dc"><a href="#h:a0bdabec-4487-4d20-b95e-6b28a385b4dc">hexdump</a></h5>
<div class="outline-text-5" id="text-h:a0bdabec-4487-4d20-b95e-6b28a385b4dc">
<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">hexdump -C -n 512 /dev/sda
00000000 eb 63 90 10 8e d0 bc 00 b0 b8 00 00 8e d8 8e c0 |.c..............|

<span class="org-builtin">echo</span> {a..z} | tr -d <span class="org-string">' '</span>|hexdump -C
00000000 61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f 70 |abcdefghijklmnop|
00000010 71 72 73 74 75 76 77 78 79 7a 0a         |qrstuvwxyz.|
0000001b
</pre>
</div>

<p>
hexdump:查看一些二进制文件的内容，比如二进制文件中包含的某些字符串。可
以将二进制文件转换为ASCII、10进制、16进制或8进制进行查看。
</p>

<div class="org-src-container">
<pre class="src src-sh">-b &#27599;&#19968;&#23383;&#33410;&#20197;&#20843;&#36827;&#21046;&#26174;&#31034;&#65292;&#19968;&#34892;&#20849;16&#20010;&#23383;&#33410;&#65292;&#19968;&#34892;&#24320;&#22987;&#20197;&#21313;&#20845;&#36827;&#21046;&#26174;&#31034;&#20559;&#31227;&#20540;&#65307;
        0000000 177 105 114 106 002 001 001 000 000 000 000 000 000 000 000 000
-c &#27599;&#19968;&#23383;&#33410;&#20197;ASCII&#23383;&#31526;&#26174;&#31034;&#65292;&#20854;&#20313;&#21516;&#19978;&#65307;
        0000000 177  E  L  F 002 001 001  \0  \0  \0  \0  \0  \0  \0  \0  \0
-C &#27599;&#19968;&#23383;&#33410;&#20197;16&#36827;&#21046;&#26174;&#31034;&#65292;&#19968;&#34892;&#20849;16&#20010;&#23383;&#33410;&#65292;&#23614;&#37096;&#38468;&#21152;16&#20010;&#30456;&#24212;&#30340;ASCII&#23383;&#31526;&#65307;
          00000000  7f 45 4c 46 02 01 01 00  00 00 00 00 00 00 00 00  |.ELF............|
-n &#21482;&#35299;&#37322;&#25351;&#23450;&#38271;&#24230;&#23383;&#33410;
        &#21333;&#20301;&#65306;&#40664;&#35748;&#21313;&#36827;&#21046;&#65292;0x&#25110;0X&#24320;&#22836;&#21017;&#20026;16&#36827;&#21046;&#65292;0&#24320;&#22836;&#21017;&#20026;8&#36827;&#21046;&#12290;&#40664;&#35748;&#20026;&#23383;&#33410;&#65292;b&#21017;&#20026;512&#23383;&#33410;&#65292;k&#21017;&#20026;1024&#23383;&#33410;&#65292;m&#21017;&#20026;1048576&#23383;&#33410;
-d &#21452;&#23383;&#33410;&#21313;&#36827;&#21046;&#26174;&#31034;
-o &#21452;&#23383;&#33410;&#20843;&#36827;&#21046;&#26174;&#31034;
-v &#21435;&#38500;&#20013;&#38388;&#26174;&#31034;&#30340;&#8220;*&#8221;&#23383;&#31526;
-x &#21452;&#23383;&#33410;&#21313;&#20845;&#36827;&#21046;&#26174;&#31034;
-e &#26684;&#24335;&#21270;&#21442;&#25968;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:8026cdf1-7d54-427a-acbb-0393a991b03c" class="outline-5">
<h5 id="h:8026cdf1-7d54-427a-acbb-0393a991b03c"><a href="#h:8026cdf1-7d54-427a-acbb-0393a991b03c">od</a></h5>
<div class="outline-text-5" id="text-h:8026cdf1-7d54-427a-acbb-0393a991b03c">
<p>
od 即 dump files in octal and other formats
</p>

<ul class="org-ul">
<li>-A：指定地址基数，od命令的输出最左侧的1列为偏移量。默认的偏移量使用8
进制，可以使用-A进行修改。

<ul class="org-ul">
<li>-A参数，指定偏移量显示方式。参数有：d:十进制；o：八进制；x：十六进
制；n不显示偏移量这一列。</li>
</ul></li>

<li><p>
-t：选择输出格式。格式为：-t [acdfoux][size].
</p>

<p>
acdfoux:
</p>
<div class="org-src-container">
<pre class="src src-sh">a&#65306;&#27599;&#20010;ASCII&#30721;&#23545;&#24212;&#30340;&#21517;&#23383;&#12290;
b&#65306;&#29992;&#20843;&#36827;&#21046;&#23383;&#33410;&#34920;&#31034;&#30340;&#23383;&#31526;&#23545;&#24212;&#30340;ASCII&#30721;&#20540;
d&#65306;&#26377;&#31526;&#21495;&#25968;&#20540;&#65292;SIZE&#20010;&#23383;&#33410;
f&#65306;&#28014;&#28857;&#25968;&#65292;SIZE&#20010;&#23383;&#33410;
o&#65306;&#20843;&#36827;&#21046;&#25968;&#65292;SIZE&#20010;&#23383;&#33410;
u&#65306;&#26080;&#31526;&#21495;&#25968;&#20540;&#65292;SIZE&#20010;&#23383;&#33410;
x&#65306;&#21313;&#20845;&#36827;&#21046;&#25968;&#65292;size&#20010;&#23383;&#33410;
</pre>
</div>

<p>
size:
</p>
<div class="org-src-container">
<pre class="src src-sh">&#27880;&#24847;&#65306;&#36825;&#37324;&#30340;SIZE&#26159;&#19968;&#20010;&#25968;&#20540;&#25110;&#32773;&#26159;&#19968;&#20010;&#23383;&#27597;&#12290;&#23383;&#27597;&#30340;&#33539;&#22260;&#20026;&#65306;[CSILFD]&#12290;&#23545;
&#20110; &#38750;f&#31867;&#22411;&#30340;&#65292;&#19968;&#33324;&#36873;&#25321;CSIL&#12290;&#20854;&#20013;

<span class="org-function-name">C&#34920;&#31034;sizeof</span>(char)
<span class="org-function-name">S&#34920;&#31034;sizeof</span>(short)
<span class="org-function-name">I&#34920;&#31034;sizeof</span>(int)
<span class="org-function-name">L&#34920;&#31034;sizeof</span>(long)

&#22914;&#26524;&#31867;&#22411;&#20026;f&#65292;sizeof&#21487;&#20197;&#26159;F&#25110;&#32773;&#26159;D&#65292;&#20998;&#21035;&#34920;&#31034;sizeof(float)&#25110;&#32773;sizeof(double).
</pre>
</div></li>
</ul>

<p>
可以使用传统的格式：分别为：
</p>

<div class="org-src-container">
<pre class="src src-sh">-a:&#31561;&#20215;&#20110; -t a.&#34920;&#31034;ASCII&#30721;&#30340;&#21517;&#23383;
-b&#65306;&#31561;&#20215;&#20110;-t o1,&#36873;&#25321;&#21333;&#23383;&#33410;&#65292;&#24182;&#19988;&#25353;&#29031;3&#20010;&#25968;&#20540;&#20301;&#30340;&#20843;&#36827;&#21046;&#25968;&#36827;&#34892;&#35299;&#37322;
-c&#65306;&#31561;&#20215;&#20110;-t c&#65292;&#36873;&#25321;ASCII&#30721;&#23383;&#31526;&#25110;&#32773;&#26159;&#36716;&#20041;&#23383;&#31526;
-d&#65306;&#31561;&#20215;&#20110;-t u2&#65306;&#36873;&#25321;&#26080;&#31526;&#21495;2&#23383;&#33410;&#21333;&#20301;
-f&#65306;&#31561;&#20215;&#20110;-t fF&#65292;&#36873;&#25321;&#21333;&#31934;&#24230;&#28014;&#28857;&#25968;
-i&#65306;&#31561;&#20215;&#20110;-t dI&#65292;&#36873;&#25321;&#21313;&#36827;&#21046;&#25972;&#22411;
-l&#65306;&#31561;&#20215;&#20110;-t dL&#65292;&#36873;&#25321;&#21313;&#36827;&#21046;&#38271;&#25972;&#22411;
-o:&#31561;&#20215;&#20110;-t o2&#65292;&#36873;&#25321;&#20004;&#20010;&#23383;&#33410;&#30340;&#21333;&#20803;&#24182;&#25353;&#29031;&#20843;&#36827;&#21046;&#36827;&#34892;&#35299;&#37322;
-s:&#31561;&#20215;&#20110;-t d2,&#36873;&#25321;&#20004;&#23383;&#33410;&#21333;&#20803;&#24182;&#25353;&#29031;&#21313;&#36827;&#21046;&#35299;&#37322;
-x&#65306;&#31561;&#20215;&#20110;-t x2&#65292;&#36873;&#25321;&#20004;&#20010;&#23383;&#33410;&#21333;&#20803;&#65292;&#24182;&#20316;&#21313;&#20845;&#36827;&#21046;&#35299;&#37322;
</pre>
</div>


<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#echo {a..z} | tr -d <span class="org-string">' '</span>|od -t x  <span class="org-comment-delimiter"># </span><span class="org-comment">16&#36827;&#21046;&#26174;&#31034;
</span>0000000 64636261 68676665 6c6b6a69 706f6e6d
0000020 74737271 78777675 000a7a79
0000033
[root@centos8 ~]#echo {a..z} | tr -d <span class="org-string">' '</span>|od -t x1  <span class="org-comment-delimiter"># </span><span class="org-comment">16&#36827;&#21046;&#26174;&#31034;&#20013;&#38388;&#38548;&#24320;
</span>0000000 61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f 70
0000020 71 72 73 74 75 76 77 78 79 7a 0a
0000033
[root@centos8 ~]#echo {a..z} | tr -d <span class="org-string">' '</span>|od -t x1z  <span class="org-comment-delimiter"># </span><span class="org-comment">16&#36827;&#21046;&#26174;&#31034;&#20013;&#38388;&#38548;&#24320;&#65292;&#23383;&#27597;&#26174;&#31034;&#22312;&#21491;&#20391;
</span>0000000 61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f 70 &gt;abcdefghijklmnop&lt;
0000020 71 72 73 74 75 76 77 78 79 7a 0a         &gt;qrstuvwxyz.&lt;
0000033
</pre>
</div>

<p>
其他选项
</p>
<div class="org-src-container">
<pre class="src src-sh">[jasper@jasper-vm ~]$ od --help 
&#29992;&#27861;&#65306;od [&#36873;&#39033;]... [&#25991;&#20214;]...
&#12288;&#25110;&#65306;od [-abcdfilosx]... [&#25991;&#20214;] [[+]&#20559;&#31227;&#37327;[.][b]]
&#12288;&#25110;&#65306;od --traditional [&#36873;&#39033;]... [&#25991;&#20214;] [[+]&#20559;&#31227;&#37327;[.][b] [+][&#26631;&#31614;][.][b]]

&#20197;&#26080;&#27495;&#20041;&#30340;&#34920;&#31034;&#26041;&#24335;&#23558; &lt;&#25991;&#20214;&gt; &#36755;&#20986;&#33267;&#26631;&#20934;&#36755;&#20986;&#65292;&#40664;&#35748;&#20026;&#20843;&#36827;&#21046;&#23383;&#33410;&#24418;&#24335;&#12290;
&#22914;&#26524;&#25351;&#23450;&#20102;&#22810;&#20110;&#19968;&#20010; &lt;&#25991;&#20214;&gt;&#65292;&#21017;&#23558;&#23427;&#20204;&#25353;&#29031;&#21015;&#20986;&#30340;&#39034;&#24207;&#36830;&#25509;&#36215;&#26469;&#20316;&#20026;&#36755;&#20837;&#12290;

&#22914;&#26524;&#27809;&#26377;&#25351;&#23450; &lt;&#25991;&#20214;&gt;&#65292;&#25110;&#32773; &lt;&#25991;&#20214;&gt; &#20026; <span class="org-string">"-"</span>&#65292;&#21017;&#20174;&#26631;&#20934;&#36755;&#20837;&#35835;&#21462;&#12290;

&#22914;&#26524;&#31532;&#19968;&#20010;&#21644;&#31532;&#20108;&#20010;&#35843;&#29992;&#26684;&#24335;&#37117;&#31526;&#21512;&#65292;&#21017;&#22312;&#26368;&#21518;&#19968;&#20010;&#25805;&#20316;&#23545;&#35937;&#20197; <span class="org-string">"+"</span> &#25110;&#32773;&#25968;&#23383;
&#65288;&#24403;&#26377;&#20004;&#20010;&#25805;&#20316;&#23545;&#35937;&#26102;&#65289;&#24320;&#22836;&#30340;&#24773;&#20917;&#19979;&#65292;&#20351;&#29992;&#31532;&#20108;&#31181;&#26684;&#24335;&#12290;&lt;&#20559;&#31227;&#37327;&gt; &#20316;&#20026;&#25805;&#20316;
&#23545;&#35937;&#26102;&#65292;&#31561;&#20215;&#20110; <span class="org-string">"-j &#20559;&#31227;&#37327;"</span>&#12290;&lt;&#26631;&#31614;&gt; &#26159;&#25152;&#25171;&#21360;&#30340;&#31532;&#19968;&#20010;&#23383;&#33410;&#30340;&#20266;&#22320;&#22336;&#65292;&#38543;&#30528;
&#36716;&#20648;&#36807;&#31243;&#30340;&#36827;&#34892;&#32780;&#36882;&#22686;&#12290;&lt;&#20559;&#31227;&#37327;&gt; &#21644; &lt;&#26631;&#31614;&gt; &#22914;&#26524;&#20896;&#20197; <span class="org-string">"0x"</span> &#25110; <span class="org-string">"0X"</span> &#21069;&#32512;&#21017;
&#34920;&#31034;&#21313;&#20845;&#36827;&#21046;&#25968;&#65307;&#21518;&#32512; <span class="org-string">"."</span> &#20195;&#34920;&#20843;&#36827;&#21046;&#25968;&#65292;&#21518;&#32512; <span class="org-string">"b"</span> &#34920;&#31034;&#20056;&#20197; 512&#12290;

&#38271;&#36873;&#39033;&#30340;&#24517;&#36873;&#21442;&#25968;&#23545;&#20110;&#30701;&#36873;&#39033;&#20063;&#26159;&#24517;&#36873;&#30340;&#12290;
  -A, --address-radix=&#22522;&#25968;    &#25351;&#23450;&#25991;&#20214;&#20559;&#31227;&#37327;&#30340;&#36755;&#20986;&#26684;&#24335;&#65307;&#36825;&#37324;&#32473;&#20986;&#30340; &lt;&#22522;&#25968;&gt;
                                &#26159; [doxn] &#20854;&#20013;&#20043;&#19968;&#65292;&#20998;&#21035;&#20195;&#34920;&#21313;&#36827;&#21046;&#12289;&#20843;&#36827;&#21046;&#12289;
                                &#21313;&#20845;&#36827;&#21046;&#21644;&#26080;&#22522;&#25968;
      --endian={big|little}   &#25353;&#29031;&#25351;&#23450;&#30340;&#23383;&#33410;&#24207;&#20132;&#25442;&#36755;&#20837;&#23383;&#33410;
  -j, --skip-bytes=&#23383;&#33410;&#25968;     &#22788;&#29702;&#21069;&#20808;&#36339;&#36807; &lt;&#23383;&#33410;&#25968;&gt; &#20010;&#36755;&#20837;&#23383;&#33410;
  -N, --read-bytes=&#23383;&#33410;&#25968;     &#26368;&#22810;&#35835;&#21462; &lt;&#23383;&#33410;&#25968;&gt; &#20010;&#36755;&#20837;&#30340;&#23383;&#33410;
  -S &#23383;&#33410;&#25968;, --strings[=&#23383;&#33410;&#25968;]  &#20165;&#26174;&#31034;&#33267;&#23569;&#21253;&#21547; &lt;&#23383;&#33410;&#25968;&gt;&#65288;&#40664;&#35748;&#20026; 3&#65289;&#20010;
                                   &#21487;&#25171;&#21360;&#23383;&#31526;&#30340;&#12289;&#20197; NUL &#32467;&#23614;&#30340;&#23383;&#31526;&#20018;
  -t, --format=&#31867;&#22411;           &#36873;&#25321;&#19968;&#20010;&#25110;&#22810;&#20010;&#36755;&#20986;&#26684;&#24335;
  -v, --output-duplicates     &#19981;&#20351;&#29992; <span class="org-string">"*"</span> &#23383;&#31526;&#20195;&#26367;&#34987;&#30465;&#30053;&#30340;&#34892;
  -w[&#23383;&#33410;&#25968;], --width[=&#23383;&#33410;&#25968;]  &#27599;&#19968;&#34892;&#36755;&#20986; &lt;&#23383;&#33410;&#25968;&gt; &#20010;&#23383;&#33410;&#65307;
                                  &#22914;&#26410;&#25351;&#23450; &lt;&#23383;&#33410;&#25968;&gt;&#65292;&#21017;&#40664;&#35748;&#20026; 32
      --traditional           &#25509;&#21463;&#20197;&#19978;&#36848;&#31532;&#19977;&#31181;&#26684;&#24335;&#25552;&#20379;&#30340;&#21442;&#25968;
      --help        &#26174;&#31034;&#27492;&#24110;&#21161;&#20449;&#24687;&#24182;&#36864;&#20986;
      --version     &#26174;&#31034;&#29256;&#26412;&#20449;&#24687;&#24182;&#36864;&#20986;


&#20256;&#32479;&#30340;&#26684;&#24335;&#35828;&#26126;&#31526;&#21487;&#20197;&#28151;&#21512;&#20351;&#29992;&#65292;&#19981;&#21516;&#30340;&#26684;&#24335;&#21487;&#20197;&#32047;&#21152;&#65306;
  -a   &#21363; -t a&#65292; &#36755;&#20986;&#23383;&#31526;&#30340;&#21517;&#31216;&#65292;&#24573;&#30053;&#26368;&#39640;&#20301;
  -b   &#21363; -t o1&#65292;&#36755;&#20986;&#20843;&#36827;&#21046;&#23383;&#33410;
  -c   &#21363; -t c&#65292; &#36755;&#20986;&#21487;&#25171;&#21360;&#23383;&#31526;&#25110;&#32773;&#20351;&#29992;&#21453;&#26012;&#26464;&#36716;&#20041;
  -d   &#21363; -t u2&#65292;&#36755;&#20986;&#26080;&#31526;&#21495;&#21313;&#36827;&#21046;&#25968;&#65292;&#20004;&#20010;&#23383;&#33410;&#20026;&#19968;&#20010;&#36755;&#20986;&#21333;&#20301;
  -f   &#21363; -t fF&#65292;&#36755;&#20986;&#28014;&#28857;&#25968;
  -i   &#21363; -t dl&#65292;&#36755;&#20986;&#21313;&#36827;&#21046;&#25972;&#22411; (int)
  -l   &#21363; -t dL&#65292;&#36755;&#20986;&#21313;&#36827;&#21046;&#38271;&#25972;&#22411; (long)
  -o   &#21363; -t o2&#65292;&#36755;&#20986;&#20843;&#36827;&#21046;&#25968;&#65292;&#20004;&#20010;&#23383;&#33410;&#20026;&#19968;&#20010;&#36755;&#20986;&#21333;&#20301;
  -s   &#21363; -t d2&#65292;&#36755;&#20986;&#21313;&#36827;&#21046;&#25968;&#65292;&#20004;&#20010;&#23383;&#33410;&#20026;&#19968;&#20010;&#36755;&#20986;&#21333;&#20301;
  -x   &#21363; -t x2&#65292;&#36755;&#20986;&#21313;&#20845;&#36827;&#21046;&#25968;&#65292;&#20004;&#20010;&#23383;&#33410;&#20026;&#19968;&#20010;&#36755;&#20986;&#21333;&#20301;


&lt;&#31867;&#22411;&gt; &#26159;&#30001;&#19979;&#38754;&#19968;&#31181;&#25110;&#22810;&#31181;&#35828;&#26126;&#31526;&#32452;&#25104;&#30340;&#65306;
  a          &#23383;&#31526;&#21517;&#31216;&#65292;&#24573;&#30053;&#26368;&#39640;&#20301;
  c          &#21487;&#25171;&#21360;&#23383;&#31526;&#25110;&#32773;&#20351;&#29992;&#21453;&#26012;&#26464;&#36716;&#20041;
  d[&#22823;&#23567;]    &#26377;&#31526;&#21495;&#21313;&#36827;&#21046;&#25968;&#65292;&#27599;&#20010;&#25972;&#25968;&#21344; &lt;&#22823;&#23567;&gt; &#20010;&#23383;&#33410;
  f[&#22823;&#23567;]    &#28014;&#28857;&#25968;&#65292;&#27599;&#20010;&#28014;&#28857;&#25968;&#21344; &lt;&#22823;&#23567;&gt; &#20010;&#23383;&#33410;
  o[&#22823;&#23567;]    &#20843;&#36827;&#21046;&#25968;&#65292;&#27599;&#20010;&#25972;&#25968;&#21344; &lt;&#22823;&#23567;&gt; &#20010;&#23383;&#33410;
  u[&#22823;&#23567;]    &#26080;&#31526;&#21495;&#21313;&#36827;&#21046;&#25968;&#65292;&#27599;&#20010;&#25972;&#25968;&#21344; &lt;&#22823;&#23567;&gt; &#20010;&#23383;&#33410;
  x[&#22823;&#23567;]    &#21313;&#20845;&#36827;&#21046;&#25968;&#65292;&#27599;&#20010;&#25972;&#25968;&#21344; &lt;&#22823;&#23567;&gt; &#20010;&#23383;&#33410;

&lt;&#22823;&#23567;&gt; &#26159;&#19968;&#20010;&#25968;&#23383;&#12290;&#22914;&#26524; &lt;&#31867;&#22411;&gt; &#26159; [doux] &#20043;&#19968;&#65292;&lt;&#22823;&#23567;&gt; &#20063;&#21487;&#20197;&#26159;&#65306;
C &#20195;&#34920; sizeof(char)&#12289;S &#20195;&#34920; sizeof(short)&#12289;I &#20195;&#34920; sizeof(int)&#65292;
&#25110; L &#20195;&#34920; sizeof(long)&#12290;&#22914;&#26524; &lt;&#31867;&#22411;&gt; &#26159; f&#65292;&lt;&#22823;&#23567;&gt; &#20063;&#21487;&#20197;&#26159;&#65306;
B &#20195;&#34920; Brain 16 &#20301;&#28014;&#28857;&#12289;H &#20195;&#34920;&#21322;&#31934;&#24230;&#28014;&#28857;&#12289;F &#20195;&#34920; sizeof(float)&#12289;
D &#20195;&#34920; sizeof(double)&#65292;&#25110; L &#20195;&#34920; sizeof(long double)&#12290;

&#22312;&#20219;&#20309;&#31867;&#22411;&#21518;&#38754;&#21152;&#19978; <span class="org-string">"z"</span> &#21518;&#32512;&#65292;&#23558;&#20250;&#22312;&#27599;&#20010;&#36755;&#20986;&#34892;&#30340;&#26411;&#23614;&#26174;&#31034;&#21487;&#25171;&#21360;&#23383;&#31526;&#12290;


&#22914;&#26524; &lt;&#23383;&#33410;&#25968;&gt; &#26377; <span class="org-string">"0x"</span> &#25110; <span class="org-string">"0X"</span> &#21069;&#32512;&#65292;&#21017;&#23558;&#20854;&#35270;&#20026;&#21313;&#20845;&#36827;&#21046;&#25968;&#12290;
&lt;&#23383;&#33410;&#25968;&gt; &#21487;&#20197;&#26377;&#20056;&#25968;&#21518;&#32512;&#65306;
  b    512
  KB   1000
  K    1024
  MB   1000*1000
  M    1024*1024
G&#12289;T&#12289;P&#12289;E&#12289;Z&#12289;Y&#12289;R&#12289;Q &#20197;&#27492;&#31867;&#25512;&#12290;
&#20063;&#21487;&#20197;&#20351;&#29992;&#20108;&#36827;&#21046;&#21069;&#32512;&#65306;<span class="org-variable-name">KiB</span>=K&#12289;<span class="org-variable-name">MiB</span>=M&#65292;&#20197;&#27492;&#31867;&#25512;&#12290;

GNU coreutils &#22312;&#32447;&#24110;&#21161;&#65306;<a href="https://www.gnu.org/software/coreutils/&gt;
&#35831;&#21521; &lt;http://translationproject.org/team/zh_CN.html&gt; &#25253;&#21578;&#20219;&#20309;&#32763;&#35793;&#38169;&#35823;
&#23436;&#25972;&#25991;&#26723; &lt;https://www.gnu.org/software/coreutils/od">&lt;https://www.gnu.org/software/coreutils/&gt;
&#35831;&#21521; &lt;http://translationproject.org/team/zh_CN.html&gt; &#25253;&#21578;&#20219;&#20309;&#32763;&#35793;&#38169;&#35823;
&#23436;&#25972;&#25991;&#26723; &lt;https://www.gnu.org/software/coreutils/od&gt;</a>
&#25110;&#32773;&#22312;&#26412;&#22320;&#20351;&#29992;&#65306;info <span class="org-string">'(coreutils) od invocation'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:61f7cc8d-9125-4ebb-bbfa-cda9a675698b" class="outline-5">
<h5 id="h:61f7cc8d-9125-4ebb-bbfa-cda9a675698b"><a href="#h:61f7cc8d-9125-4ebb-bbfa-cda9a675698b">xxd</a></h5>
<div class="outline-text-5" id="text-h:61f7cc8d-9125-4ebb-bbfa-cda9a675698b">
<p>
<a href="https://manpages.debian.org/unstable/manpages-zh/xxd.1.zh_CN.html">xxd文档</a>
</p>

<p>
用于使用二进制或十六进制格式显示文件内容，可以将指定文件或标准输入以十
六进制转储,也可以把十六进制转储转换成原来的二进制形式。
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">echo</span> {a..z} | tr -d <span class="org-string">' '</span>|xxd
0000000: 6162 6364 6566 6768 696a 6b6c 6d6e 6f70 abcdefghijklmnop
0000010: 7172 7374 7576 7778 797a 0a       qrstuvwxyz.
</pre>
</div>

<p>
xxd 的输出主要是三个部分：左边的地址区域，中间的 hex dump
，和右边的原始内容
</p>

<ul class="org-ul">
<li>左边显示的地址，当然也是十六进制的。默认的话一行 dump
16个字节，所以地址正好加 0x10</li>
<li>中间是经过 hex dump 后以十六进制显示的文件内容。注意到这个文件是 ascii
编码的，所以所有的字节的值都不大于 0xff</li>
<li>右边则是原文内容，如果是一些非文本文件，遇到不可打印的字符时候xxd
会输出 . 作为代替</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">-ps &#21442;&#25968;&#65306;&#20197; postscript&#30340;&#36830;&#32493;16&#36827;&#21046;&#36716;&#20648;&#36755;&#20986;&#65292;&#20063;&#21483;&#20570;&#32431;16&#36827;&#21046;&#36716;&#20648;&#12290;
-b&#21442;&#25968;&#65306;&#20197;2&#36827;&#21046;&#23383;&#31526;&#20018;&#24418;&#24335;&#36755;&#20986;&#12290;
-r&#21442;&#25968;&#65306;&#36870;&#21521;&#36716;&#25442;&#12290;&#23558;16&#36827;&#21046;&#23383;&#31526;&#20018;&#34920;&#31034;&#36716;&#20026;&#23454;&#38469;&#30340;&#25968;&#65306;

-g: &#20960;&#20010;&#23383;&#33410;&#32452;&#25104;&#19968;&#32452;
-c: &#27599;&#34892;&#36755;&#20986;&#22810;&#23569;&#20010;&#23383;&#33410;
-i&#65306;&#23558;&#25991;&#20214;&#20869;&#23481;&#36755;&#20986;&#25104; c&#30340;&#19968;&#20010;&#25968;&#32452;&#26684;&#24335;
-l : &#36755;&#20986;&#20960;&#20010;&#23383;&#33410;&#21518;&#32467;&#26463;
-p -plain&#65306;&#20197;&#19968;&#20010;&#25972;&#22359;&#36755;&#20986;&#25152;&#26377;&#30340;hex&#65292; &#19981;&#20351;&#29992;&#31354;&#26684;&#36827;&#34892;&#20998;&#21106;
-s [+][-]seek &#65306; &#20174;&#31532;&#20960;&#20010;&#23383;&#31526;&#24320;&#22987;
-u : &#36755;&#20986;&#37319;&#29992;&#22823;&#20889;
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">xxd -a -c 12 -g 1 -l 512 -s +0x200 [inputfile]
&#12304;&#33258;&#21160;&#36339;&#36807;&#31354;&#30333;&#12305;&#12304;&#27599;&#34892;&#26174;&#31034;12&#23383;&#33410;&#12305;&#12304;&#19968;&#20010;&#23383;&#33410;&#19968;&#22359;&#12305;&#12304;&#26174;&#31034;512&#23383;&#33410;&#20869;&#23481;&#12305;&#12304;&#20174;0x200&#24320;&#22987;&#12305;&#12304;&#36755;&#20837;&#25991;&#20214;&#12305;
</pre>
</div>

<p>
范例16进制字符转换
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">&#23558;&#23383;&#31526;&#20018;&#36716;&#25442;&#20026; 16 &#36827;&#21046;&#26684;&#24335;&#65306;
</span><span class="org-builtin">echo</span> -n <span class="org-string">"string"</span> | xxd -p

<span class="org-comment-delimiter"># </span><span class="org-comment">echo -n "~" | xxd -p
</span>7e


<span class="org-comment-delimiter"># </span><span class="org-comment">&#23558; 16 &#36827;&#21046;&#26684;&#24335;&#30340;&#23383;&#31526;&#20018;&#36716;&#25442;&#20026;&#23383;&#31526;&#20018;&#65306;
</span><span class="org-builtin">echo</span> -n <span class="org-string">"48656c6c6f20576f726c64"</span> | xxd -r -p

mysql&gt; select 0x7e;
+------+
| 0x7e |
+------+
| ~    |
</pre>
</div>

<p>
url编码是十六进制的形如%E6%9C%8D%E5%8A%A1%E5的字符串 编码的两种方式
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">echo</span> <span class="org-string">'&#25163;&#26426;'</span> | tr -d <span class="org-string">'\n'</span> | xxd -plain | sed <span class="org-string">'s/\(..\)/%\1/g'</span>
<span class="org-builtin">echo</span> <span class="org-string">'&#25163;&#26426;'</span> |tr -d <span class="org-string">'\n'</span> |od -An -tx1|tr <span class="org-string">' '</span> %

&#20854;&#23454;&#25105;&#20204;&#32463;&#24120;&#29992;&#30340; curl &#30340; --data-urlencode &#36873;&#39033;&#21363;&#21487;&#23454;&#29616; urlencode &#32534;&#30721;&#65306;
june@~ 23:58:38&gt;
curl -v -L -G --data-urlencode <span class="org-string">'wd=&#25163;&#26426;'</span> <span class="org-string">"http://www.baidu.com/s"</span>

&#35299;&#30721;
<span class="org-variable-name">url</span>=<span class="org-string">"&#35201;&#35299;&#30721;&#30340;URL&#22320;&#22336;"</span>
printf $(<span class="org-builtin">echo</span> -n $<span class="org-variable-name">url</span> | sed <span class="org-string">'s/\\/\\\\/g;s/\(%\)\([0-9a-fA-F][0-9a-fA-F]\)/\\x\2/g'</span>)<span class="org-string">"\n"</span>
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[admin@middle-ware ~]$ echo <span class="org-string">'&#25163;&#26426;'</span> | tr -d <span class="org-string">'\n'</span> | xxd -plain | sed <span class="org-string">'s/\(..\)/%\1/g'</span>
%e6%89%8b%e6%9c%ba
[admin@middle-ware ~]$ echo <span class="org-string">'&#25163;&#26426;'</span> |tr -d <span class="org-string">'\n'</span> |od -An -tx1|tr <span class="org-string">' '</span> %
%e6%89%8b%e6%9c%ba
[admin@middle-ware ~]$ <span class="org-variable-name">url</span>=<span class="org-string">'%e6%89%8b%e6%9c%ba'</span>
[admin@middle-ware ~]$ printf $(<span class="org-builtin">echo</span> -n $<span class="org-variable-name">url</span> | sed <span class="org-string">'s/\\/\\\\/g;s/\(%\)\([0-9a-fA-F][0-9a-fA-F]\)/\\x\2/g'</span>)<span class="org-string">"\n"</span>
&#25163;&#26426;
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:f1656fb3-492d-42ba-928f-5708a8c3437e" class="outline-3">
<h3 id="h:f1656fb3-492d-42ba-928f-5708a8c3437e"><a href="#h:f1656fb3-492d-42ba-928f-5708a8c3437e">分页查看文件内容</a></h3>
<div class="outline-text-3" id="text-h:f1656fb3-492d-42ba-928f-5708a8c3437e">
</div>
<div id="outline-container-h:3c258c6e-1493-4f10-9d87-2acd178d905c" class="outline-4">
<h4 id="h:3c258c6e-1493-4f10-9d87-2acd178d905c"><a href="#h:3c258c6e-1493-4f10-9d87-2acd178d905c">more</a></h4>
<div class="outline-text-4" id="text-h:3c258c6e-1493-4f10-9d87-2acd178d905c">
<p>
可以实现分页查看文件，可以配合管道实现输出信息的分页 格式 more
[OPTIONS&#x2026;] FILE&#x2026;
</p>

<p>
选项： -d: 显示翻页及退出提示
</p>

<p>
less 也可以实现分页查看文件或STDIN输出
</p>

<p>
查看时有用的命令包括：
</p>
<ul class="org-ul">
<li><code>/文本</code> 搜索文本。n/N 跳到下一个 或 上一个匹配</li>
</ul>
</div>
</div>
<div id="outline-container-h:57079271-facc-41d7-8a01-36bfa097b5fc" class="outline-4">
<h4 id="h:57079271-facc-41d7-8a01-36bfa097b5fc"><a href="#h:57079271-facc-41d7-8a01-36bfa097b5fc">less</a></h4>
<div class="outline-text-4" id="text-h:57079271-facc-41d7-8a01-36bfa097b5fc">
<p>
less 命令是man命令使用的分页器 范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /etc/init.d/functions |less
<span class="org-comment-delimiter"># </span><span class="org-comment">-*-Shell-script-*-
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-comment-delimiter"># </span><span class="org-comment">functions This file contains functions to be used by most or all
</span><span class="org-comment-delimiter">#    </span><span class="org-comment">shell scripts in the /etc/init.d directory.
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-variable-name">TEXTDOMAIN</span>=initscripts
<span class="org-comment-delimiter"># </span><span class="org-comment">Make sure umask is sane
</span><span class="org-builtin">umask</span> 022
<span class="org-comment-delimiter"># </span><span class="org-comment">Set up a default search path.
</span><span class="org-variable-name">PATH</span>=<span class="org-string">"/sbin:/usr/sbin:/bin:/usr/bin"</span>
<span class="org-builtin">export</span> PATH
...&#30465;&#30053;...
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:f7949d1a-b7c7-47c7-8018-016d1362814e" class="outline-3">
<h3 id="h:f7949d1a-b7c7-47c7-8018-016d1362814e"><a href="#h:f7949d1a-b7c7-47c7-8018-016d1362814e">显示文本前或后行内容</a></h3>
<div class="outline-text-3" id="text-h:f7949d1a-b7c7-47c7-8018-016d1362814e">
</div>
<div id="outline-container-h:131dc721-0906-425f-bb79-7697116e705f" class="outline-4">
<h4 id="h:131dc721-0906-425f-bb79-7697116e705f"><a href="#h:131dc721-0906-425f-bb79-7697116e705f">head</a></h4>
<div class="outline-text-4" id="text-h:131dc721-0906-425f-bb79-7697116e705f">
<p>
可以显示文件或标准输入的前面行
</p>

<p>
格式： head [OPTION]&#x2026; [FILE]&#x2026;
</p>

<p>
选项：
</p>
<div class="org-src-container">
<pre class="src src-sh">-c <span class="org-comment-delimiter"># </span><span class="org-comment">&#25351;&#23450;&#33719;&#21462;&#21069;#&#23383;&#33410;
</span>-n <span class="org-comment-delimiter"># </span><span class="org-comment">&#25351;&#23450;&#33719;&#21462;&#21069;#&#34892;
</span>-# &#21516;&#19978;
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#head -n 3 /etc/passwd
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin

[root@centos8 ~]#head -3 /etc/passwd
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin

[root@centos8 ~]#echo a&#25105;b | head -c4
a&#25105;[root@centos8 ~]#

[root@centos8 ~]#cat /dev/urandom | tr -dc <span class="org-string">'[:alnum:]'</span>| head -c10
G755MlZatW[root@centos8 ~]#cat /dev/urandom | tr -dc <span class="org-string">'[:alnum:]'</span>| head -c10
ASsax6DeBz[root@centos8 ~]#cat /dev/urandom | tr -dc <span class="org-string">'[:alnum:]'</span>| head -c10 |tee pass.txt | passwd --stdin me
Changing password for user me.
passwd: all authentication tokens updated successfully.
[root@centos8 ~]#cat pass.txt
AGT952Essg[root@centos8 ~]#su - wang
[wang@centos8 ~]$<span class="org-variable-name">su</span> - me
Password:

[root@centos8 ~]#cat /data/f1.txt
1
2
3
4
5
6
7
8
9
10
[root@centos8 ~]#head -n -3 /data/f1.txt
1
2
3
4
5
6
7
[root@centos8 ~]#
</pre>
</div>
</div>
</div>
<div id="outline-container-h:11fdd8c8-2c5f-4cd3-81c4-44731646653f" class="outline-4">
<h4 id="h:11fdd8c8-2c5f-4cd3-81c4-44731646653f"><a href="#h:11fdd8c8-2c5f-4cd3-81c4-44731646653f">tail</a></h4>
<div class="outline-text-4" id="text-h:11fdd8c8-2c5f-4cd3-81c4-44731646653f">
<p>
tail 和head 相反，查看文件或标准输入的倒数行
</p>

<p>
格式： tail [OPTION]&#x2026; [FILE]&#x2026;
</p>

<div class="org-src-container">
<pre class="src src-sh">-c <span class="org-comment-delimiter"># </span><span class="org-comment">&#25351;&#23450;&#33719;&#21462;&#21518;#&#23383;&#33410;
</span>-n <span class="org-comment-delimiter"># </span><span class="org-comment">&#25351;&#23450;&#33719;&#21462;&#21518;#&#34892;
</span>-# &#21516;&#19978;
-f &#36319;&#36394;&#26174;&#31034;&#25991;&#20214;fd&#26032;&#36861;&#21152;&#30340;&#20869;&#23481;,&#24120;&#29992;&#26085;&#24535;&#30417;&#25511;&#65292;&#30456;&#24403;&#20110; --follow=descriptor,&#24403;&#25991;&#20214;&#21024;&#38500;&#20877;&#26032;&#24314;&#21516;&#21517;&#25991;&#20214;,&#23558;&#26080;&#27861;&#32487;&#32493;&#36319;&#36394;&#25991;&#20214;
-F &#36319;&#36394;&#25991;&#20214;&#21517;&#65292;&#30456;&#24403;&#20110;--follow=name --retry&#65292;&#24403;&#25991;&#20214;&#21024;&#38500;&#20877;&#26032;&#24314;&#21516;&#21517;&#25991;&#20214;,&#23558;&#21487;&#20197;&#32487;&#32493;&#36319;&#36394;&#25991;&#20214;
tailf &#31867;&#20284; tail &#8211;f&#65292;&#24403;&#25991;&#20214;&#19981;&#22686;&#38271;&#26102;&#24182;&#19981;&#35775;&#38382;&#25991;&#20214;

&#27880;&#24847;&#65306;#&#21495;&#21069;&#38754;&#21487;&#20351;&#29992;&#27491;&#36127;&#21495;&#65292;&#34920;&#31034;&#35813;&#20559;&#31227;&#20174;&#39030;&#37096;&#36824;&#26159;&#20174;&#23614;&#37096;&#24320;&#22987;&#35745;&#31639;&#12290;&#22914;+2&#34920;&#31034;&#20174;&#31532;2&#34892;&#21040;&#23614;&#34892;&#65292;-2&#34920;&#31034;&#20174;&#20498;&#25968;&#31532;2&#34892;&#21040;&#23614;&#34892;&#12290;
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat  /data/f1.txt
1
2
3
4
5
6
7
8
9
10
[root@centos8 ~]#tail -n 3 /data/f1.txt
8
9
10
[root@centos8 ~]#tail -n +3 /data/f1.txt
3
4
5
6
7
8
9
10
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#tail -3 /var/log/messages
Dec 20 09:49:01 centos8 dbus-daemon[952]: [system] Successfully activated
service <span class="org-string">'net.reactivated.Fprint'</span>
Dec 20 09:49:01 centos8 systemd[1]: Started Fingerprint Authentication Daemon.
Dec 20 09:49:13 centos8 su[6887]: (to cici) root on pts/0
[root@centos8 ~]#tail -f /var/log/messages
&#12290;&#12290;&#12290;
  727 B/s | 1.5 kB   00:02
Dec 20 08:47:12 centos8 dnf[1465]: Metadata cache created.
Dec 20 08:47:12 centos8 systemd[1]: Started dnf makecache.

<span class="org-comment-delimiter">#</span><span class="org-comment">&#21482;&#26597;&#30475;&#26368;&#26032;&#21457;&#29983;&#30340;&#26085;&#24535;
</span>[root@centos8 ~]#tail -fn0 /var/log/messages
[root@centos8 ~]#tail -0f /var/log/messages
[root@centos8 data]#ifconfig | head -2 | tail -1
   inet 10.0.0.8 netmask 255.255.255.0 broadcast 10.0.0.255
</pre>
</div>

<p>
tail拓展：
</p>

<p>
选项
</p>

<div class="org-src-container">
<pre class="src src-sh">--retry : &#21363;&#20351;tail&#24320;&#22987;&#26102;&#23601;&#19981;&#33021;&#35775;&#38382;&#25110;&#32773;&#22312;tail&#36816;&#34892;&#21518;&#19981;&#33021;&#35775;&#38382;,&#20063;&#20173;&#28982;&#19981;&#20572;&#22320;&#23581;&#35797;&#25171;&#24320;&#25991;&#20214;. -- &#21482;&#19982;-f&#21512;&#29992;&#26102;&#26377;&#29992;
-F : same as --follow=name --retry&#65292;&#21363;-f --retry
--max-unchanged-stats=N
-q : &#19981;&#26174;&#31034;&#22788;&#29702;&#20449;&#24687;
-v : &#26174;&#31034;&#35814;&#32454;&#30340;&#22788;&#29702;&#20449;&#24687;
-c&lt;&#25968;&#30446;&gt; : &#26174;&#31034;&#30340;&#23383;&#33410;&#25968;
-n&lt;&#34892;&#25968;&gt; : &#26174;&#31034;&#34892;&#25968;&#160;&#160;***
--pid=PID : &#19982;-f&#21512;&#29992;,&#34920;&#31034;&#22312;&#36827;&#31243;ID,PID&#27515;&#25481;&#20043;&#21518;&#32467;&#26463;.
-q, --quiet, --silent : &#20174;&#19981;&#36755;&#20986;&#32473;&#20986;&#25991;&#20214;&#21517;&#30340;&#39318;&#37096;
-s, --sleep-interval=S : &#19982;-f&#21512;&#29992;,&#34920;&#31034;&#22312;&#27599;&#27425;&#21453;&#22797;&#30340;&#38388;&#38548;&#20241;&#30496;S&#31186;
</pre>
</div>

<p>
<b>tail 断点续传</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@nginx01 ~]# tail -n +$(tail -n1 /root/n) -F /root/ip.txt 2&gt;&amp;1 | awk <span class="org-string">'ARGIND==1{i=$0;next}{i++;if($0~/^tail/){i=0};print $0;print i &gt; "/root/n";fflush("")}'</span> /root/n -
</pre>
</div>

<p>
如，flume日志收集中设置断点收集
</p>

<div class="org-src-container">
<pre class="src src-sh">a1.sources.r1.type = exec
a1.sources.r1.shell = /bin/bash -c
a1.sources.r1.command = tail -n +$(tail -n1 /home/hadoop/flume_read/m) -F /home/hadoop/student.txt | awk <span class="org-string">'ARGIND==1{i=$0;next}{i++;if($0~/^tail/){i=0};print
$0;print i &gt;&gt; "/home/hadoop/flume_read/m";fflush("")}'</span> /home/hadoop/flume_read/m -

&#35299;&#37322;&#65306;
ARGC        The number of command line arguments (does not include
                   options to gawk, or the program source).   &#21629;&#20196;&#34892;&#21442;&#25968;&#30340;&#20010;&#25968;
ARGIND      The index<span class="org-keyword"> in</span> ARGV of the current file being processed. &#21629;&#20196;&#34892;&#20013;&#25991;&#20214;&#24207;&#21495;
ARGV        Array of command line arguments. The array is indexed
                   from 0 to ARGC - 1. Dynamically changing the contents
                   of ARGV can control the files used for data. &#21629;&#20196;&#34892;&#21442;&#25968;&#25968;&#32452;
&#22823;&#20307;&#31867;&#20284;&#20110;C&#35821;&#35328; int main(int argc,char *argv[])
</pre>
</div>

<p>
我要比较a和b两个文件； 
</p>

<div class="org-src-container">
<pre class="src src-sh">a b
1 1
qw 2
qq d
123 cd
</pre>
</div>

<p>
我怎么才能列出b文件中完全不包含a文件的行？？
</p>

<div class="org-src-container">
<pre class="src src-sh">&#35299;&#31572;&#65306; awk <span class="org-string">'ARGIND==1 {a[$0]} ARGIND&gt;1&amp;&amp;!($0 in a) {print $0}'</span> a b
&#25110;&#32773;&#65306; awk <span class="org-string">'NR==FNR {a[$0]} NR&gt;FNR&amp;&amp;!($0 in a) {print $0}'</span> a b
&#20195;&#30721;&#35299;&#37322;&#65306;
<span class="org-variable-name">ARGIND</span>==1{a[$<span class="org-variable-name">0</span>]}
<span class="org-comment-delimiter">#</span><span class="org-comment">ARGIND==1 &#21028;&#26029;&#26159;&#21542;&#27491;&#22312;&#22788;&#29702;&#31532;&#19968;&#20010;&#25991;&#20214;&#65292;&#26412;&#20363;&#20026;&#25991;&#20214;a
</span><span class="org-comment-delimiter"># </span><span class="org-comment">{a[$0]} &#21021;&#22987;&#21270;&#65288;&#25110;&#21483;&#20570;&#23450;&#20041;&#65289;a[$0]
</span>ARGIND&gt;1&amp;&amp;<span class="org-negation-char">!</span>($<span class="org-variable-name">0</span><span class="org-keyword"> in</span> a){<span class="org-builtin">print</span> $<span class="org-variable-name">0</span>}
<span class="org-comment-delimiter">#</span><span class="org-comment">ARGIND&gt;1 &#21028;&#26029;&#26159;&#21542;&#22312;&#22788;&#29702;&#31532;&#20108;&#20010;&#25110;&#31532;n&#20010;&#25991;&#20214;&#65292;&#26412;&#20363;&#21482;&#26377;&#19968;&#20010;&#25991;&#20214;b
</span><span class="org-comment-delimiter">#</span><span class="org-comment">&#24182;&#19988;&#21028;&#26029;a[$0]&#26159;&#21542;&#26410;&#23450;&#20041;&#65292;&#28982;&#21518;&#25171;&#21360;$0
</span>

fflush&#20989;&#25968;&#29992;&#20197;&#21047;&#26032;&#36755;&#20986;&#32531;&#20914;&#21306;&#65292;&#22914;&#26524;&#27809;&#26377;&#21442;&#25968;&#65292;&#23601;&#21047;&#26032;&#26631;&#20934;&#36755;&#20986;&#30340;&#32531;&#20914;&#21306;&#65292;&#22914;&#26524;&#20197;&#31354;&#23383;&#31526;&#20018;&#20026;&#21442;&#25968;&#65292;&#22914;fflush(<span class="org-string">""</span>),&#21017;&#21047;&#26032;&#25152;&#26377;&#25991;&#20214;&#21644;&#31649;&#36947;&#30340;&#36755;&#20986;&#32531;&#20914;&#21306;&#12290;
&#36825;&#37324;&#30340;fflush&#26159;&#21521;n&#25991;&#20214;&#20013;&#20889;&#20837;
</pre>
</div>

<p>
参考：flume中的断点续传 <a href="http://blog.csdn.net/smallboy2011/article/details/73163664">http://blog.csdn.net/smallboy2011/article/details/73163664</a>
</p>


<figure id="org830b2e5">
<img src="././images/image-20210216002359744.png" alt="image-20210216002359744.png" width="50%">

</figure>
</div>
</div>
</div>
<div id="outline-container-h:6632b664-a35b-4012-824a-f706f46d4908" class="outline-3">
<h3 id="h:6632b664-a35b-4012-824a-f706f46d4908"><a href="#h:6632b664-a35b-4012-824a-f706f46d4908">按列抽取文本cut</a></h3>
<div class="outline-text-3" id="text-h:6632b664-a35b-4012-824a-f706f46d4908">
<p>
cut 命令可以提取文本文件或STDIN数据的指定列
</p>

<p>
格式 cut [OPTION]&#x2026; [FILE]&#x2026;
</p>

<p>
选项
</p>

<div class="org-src-container">
<pre class="src src-sh">-d DELIMITER: &#25351;&#26126;&#20998;&#38548;&#31526;&#65292;&#40664;&#35748;tab
-f FILEDS:
   <span class="org-comment-delimiter">#</span><span class="org-comment">: &#31532;#&#20010;&#23383;&#27573;,&#20363;&#22914;:3
</span>   <span class="org-comment-delimiter">#</span><span class="org-comment">,#[,#]&#65306;&#31163;&#25955;&#30340;&#22810;&#20010;&#23383;&#27573;&#65292;&#20363;&#22914;:1,3,6
</span>   <span class="org-comment-delimiter">#</span><span class="org-comment">-#&#65306;&#36830;&#32493;&#30340;&#22810;&#20010;&#23383;&#27573;, &#20363;&#22914;:1-6
</span>   &#28151;&#21512;&#20351;&#29992;&#65306;1-3,7
-c &#25353;&#23383;&#31526;&#20999;&#21106;
--output-delimiter=STRING&#25351;&#23450;&#36755;&#20986;&#20998;&#38548;&#31526;
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cut -d: -f1,3-4,7 /etc/passwd
[root@centos8 ~]#ifconfig |head -n2 |tail -n1|cut -d<span class="org-string">" "</span> -f10
10.0.0.8
[root@centos8 ~]#ifconfig |head -n2 |tail -n1|tr -s <span class="org-string">" "</span> |cut -d <span class="org-string">" "</span> -f3
10.0.0.8
[root@centos8 ~]#df | tr -s <span class="org-string">' '</span>|cut -d<span class="org-string">' '</span> -f5 |tr -dc <span class="org-string">"[0-9\n]"</span>
0
0
1
0
5
1
15
1
[root@centos8 ~]#df | tr -s <span class="org-string">' '</span> % |cut -d% -f5 |tr -d <span class="org-string">'[:alpha:]'</span>
0
0
1
0
5
1
15
1
[root@centos8 ~]#df | cut -c44-46 |tr -d <span class="org-string">'[:alpha:]'</span>
 0
 0
 1
 0
 5
 1
15
 1
[root@centos8 ~]#cut -d: -f1,3,7 --output-delimiter=<span class="org-string">"---"</span> /etc/passwd
root---0---/bin/bash
bin---1---/sbin/nologin
daemon---2---/sbin/nologin

cat /etc/passwd | cut -d: -f7
cut -c2-5 /usr/share/dict/words

[root@centos8 ~]#df|tr -s <span class="org-string">' '</span> |cut -d<span class="org-string">' '</span> -f5 |tr -d %
[root@centos8 ~]#df|tr -s <span class="org-string">' '</span> <span class="org-string">'%'</span>|cut -d% -f5
Use
0
0
2
0
3
1
15
0
100
</pre>
</div>
</div>
</div>
<div id="outline-container-h:17f701a9-2b99-4ac8-8f8d-c126445c1f30" class="outline-3">
<h3 id="h:17f701a9-2b99-4ac8-8f8d-c126445c1f30"><a href="#h:17f701a9-2b99-4ac8-8f8d-c126445c1f30">字符转换命令： tr, col, join, paste</a></h3>
<div class="outline-text-3" id="text-h:17f701a9-2b99-4ac8-8f8d-c126445c1f30">
</div>
<div id="outline-container-h:335874fc-514d-44e4-9128-74d809e3762b" class="outline-4">
<h4 id="h:335874fc-514d-44e4-9128-74d809e3762b"><a href="#h:335874fc-514d-44e4-9128-74d809e3762b">转换和删除字符tr</a></h4>
<div class="outline-text-4" id="text-h:335874fc-514d-44e4-9128-74d809e3762b">
<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#35813;&#21629;&#20196;&#20250;&#25226;/etc/issue&#20013;&#30340;&#23567;&#20889;&#23383;&#31526;&#37117;&#36716;&#25442;&#25104;&#22823;&#20889;&#23383;&#31526;
</span>tr <span class="org-string">'a-z'</span> <span class="org-string">'A-Z'</span>&lt; /etc/issue

<span class="org-comment-delimiter">#</span><span class="org-comment">&#21024;&#38500;fstab&#25991;&#20214;&#20013;&#30340;&#25152;&#26377;abc&#20013;&#20219;&#24847;&#23383;&#31526;
</span>tr &#8211;d abc &lt; /etc/fstab

<span class="org-comment-delimiter"># </span><span class="org-comment">&#21462;&#25351;&#23450;&#23383;&#31526;&#65292;&#21482;&#26174;&#31034;20&#20010;
</span>tr -dc <span class="org-string">'#@%a-z0-9'</span> &lt; /dev/urandom |head -c 20
</pre>
</div>

<p>
IO重定向细讲
</p>
</div>
</div>
<div id="outline-container-h:d826b8ab-9951-41b9-b9b4-65e83a6c3cf7" class="outline-4">
<h4 id="h:d826b8ab-9951-41b9-b9b4-65e83a6c3cf7"><a href="#h:d826b8ab-9951-41b9-b9b4-65e83a6c3cf7">col</a></h4>
<div class="outline-text-4" id="text-h:d826b8ab-9951-41b9-b9b4-65e83a6c3cf7">
<p>
格式
</p>

<div class="org-src-container">
<pre class="src src-sh">col [-xb]
</pre>
</div>

<p>
选项与参数：
</p>

<div class="org-src-container">
<pre class="src src-sh">-x  &#65306;&#23558; tab &#38190;&#36716;&#25442;&#25104;&#23545;&#31561;&#30340;&#31354;&#26684;&#38190;
-b  &#65306;&#22312;&#25991;&#23383;&#20869;&#26377;&#21453;&#26012;&#26464; (/) &#26102;&#65292;&#20165;&#20445;&#30041;&#21453;&#26012;&#26464;&#26368;&#21518;&#25509;&#30340;&#37027;&#20010;&#23383;&#31526;
</pre>
</div>

<p>
范例：利用 cat -A 显示出所有特殊按键，最后以 col 将 [tab] 转成空白
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@www ~]# cat -A /etc/man.config  <span class="org-comment-delimiter"># </span><span class="org-comment">&#27492;&#26102;&#20250;&#30475;&#21040;&#24456;&#22810; ^I &#30340;&#31526;&#21495;&#65292;&#37027;&#23601;&#26159; tab
</span>[root@www ~]# cat /etc/man.config | col -x | cat -A | more
</pre>
</div>

<p>
范例：将 col 的 man page 转存成为 /root/col.man 的纯文本档
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@www ~]# man col &gt; /root/col.man
[root@www ~]# vi /root/col.man
<span class="org-function-name">COL</span>(1)          BSD General Commands Manual               COL(1)

N^HNA^HAM^HME^HE
     c^Hco^Hol^Hl - filter reverse line feeds from input

S^HSY^HYN^HNO^HOP^HPS^HSI^HIS^HS
     c^Hco^Hol^Hl [-^H-b^Hbf^Hfp^Hpx^Hx] [-^H-l^Hl _^Hn_^Hu_^Hm]
<span class="org-comment-delimiter"># </span><span class="org-comment">&#30001;&#20110; man page &#20869;&#26377;&#20123;&#29305;&#27530;&#25353;&#38062;&#20250;&#29992;&#26469;&#20316;&#20026;&#31867;&#20284;&#29305;&#27530;&#25353;&#38190;&#19982;&#39068;&#33394;&#26174;&#31034;&#65292;
</span><span class="org-comment-delimiter"># </span><span class="org-comment">&#25152;&#20197;&#36825;&#20010;&#25991;&#20214;&#20869;&#23601;&#20250;&#20986;&#29616;&#22914;&#19978;&#25152;&#31034;&#30340;&#19968;&#22534;&#24618;&#24322;&#23383;&#31526;(&#26377; ^ &#30340;)
</span>
[root@www ~]# man col | col -b &gt; /root/col.man
</pre>
</div>
</div>
</div>
<div id="outline-container-h:52ead11e-a5eb-4400-a5d7-a71348e88e0d" class="outline-4">
<h4 id="h:52ead11e-a5eb-4400-a5d7-a71348e88e0d"><a href="#h:52ead11e-a5eb-4400-a5d7-a71348e88e0d">多文件数据合并join</a></h4>
<div class="outline-text-4" id="text-h:52ead11e-a5eb-4400-a5d7-a71348e88e0d">
<p>
两个文件之间的数据 格式
</p>

<div class="org-src-container">
<pre class="src src-sh">join [-ti12] file1 file2
</pre>
</div>

<p>
选项与参数：
</p>

<div class="org-src-container">
<pre class="src src-sh">-t  &#65306;join &#40664;&#35748;&#20197;&#31354;&#26684;&#31526;&#20998;&#38548;&#25968;&#25454;&#65292;&#24182;&#19988;&#27604;&#23545;&#12302;&#31532;&#19968;&#20010;&#23383;&#27573;&#12303;&#30340;&#25968;&#25454;&#65292;&#22914;&#26524;&#20004;&#20010;&#25991;&#20214;&#30456;&#21516;&#65292;&#21017;&#23558;&#20004;&#31508;&#25968;&#25454;&#32852;&#25104;&#19968;&#34892;&#65292;&#19988;&#31532;&#19968;&#20010;&#23383;&#27573;&#25918;&#22312;&#31532;&#19968;&#20010;&#65281;
-i  &#65306;&#24573;&#30053;&#22823;&#23567;&#20889;&#30340;&#24046;&#24322;&#65307;
-1  &#65306;&#36825;&#20010;&#26159;&#25968;&#23383;&#30340; 1 &#65292;&#20195;&#34920;&#12302;&#31532;&#19968;&#20010;&#25991;&#20214;&#35201;&#29992;&#37027;&#20010;&#23383;&#27573;&#26469;&#20998;&#26512;&#12303;&#30340;&#24847;&#24605;&#65307;
-2  &#65306;&#20195;&#34920;&#12302;&#31532;&#20108;&#20010;&#25991;&#20214;&#35201;&#29992;&#37027;&#20010;&#23383;&#27573;&#26469;&#20998;&#26512;&#12303;&#30340;&#24847;&#24605;&#12290;
</pre>
</div>

<p>
范例：用 root 的身份，将 /etc/passwd 与 /etc/shadow 相关数据整合成一栏
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@www ~]# head -n 3 /etc/passwd /etc/shadow
==&gt; /etc/passwd &lt;==
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin

==&gt; /etc/shadow &lt;==
root:$<span class="org-variable-name">1</span>$/3AQpE5e$<span class="org-variable-name">y9A</span>/D0bh6rElAs:14120:0:99999:7:::
bin:*:14126:0:99999:7:::
daemon:*:14126:0:99999:7:::
<span class="org-comment-delimiter"># </span><span class="org-comment">&#30001;&#36755;&#20986;&#30340;&#25968;&#25454;&#21487;&#20197;&#21457;&#29616;&#36825;&#20004;&#20010;&#25991;&#20214;&#30340;&#26368;&#24038;&#36793;&#23383;&#27573;&#37117;&#26159;&#36134;&#21495;&#65281;&#19988;&#20197; : &#20998;&#38548;
</span>
[root@www ~]# join -t <span class="org-string">':'</span> /etc/passwd /etc/shadow
root:x:0:0:root:/root:/bin/bash:$<span class="org-variable-name">1</span>$/3AQpE5e$<span class="org-variable-name">y9A</span>/D0bh6rElAs:14120:0:99999:7:::
bin:x:1:1:bin:/bin:/sbin/nologin:*:14126:0:99999:7:::
daemon:x:2:2:daemon:/sbin:/sbin/nologin:*:14126:0:99999:7:::
<span class="org-comment-delimiter"># </span><span class="org-comment">&#36879;&#36807;&#19978;&#38754;&#36825;&#20010;&#21160;&#20316;&#65292;&#25105;&#20204;&#21487;&#20197;&#23558;&#20004;&#20010;&#25991;&#20214;&#31532;&#19968;&#23383;&#27573;&#30456;&#21516;&#32773;&#25972;&#21512;&#25104;&#19968;&#34892;&#65281;
</span><span class="org-comment-delimiter"># </span><span class="org-comment">&#31532;&#20108;&#20010;&#25991;&#20214;&#30340;&#30456;&#21516;&#23383;&#27573;&#24182;&#19981;&#20250;&#26174;&#31034;(&#22240;&#20026;&#24050;&#32463;&#22312;&#31532;&#19968;&#34892;&#20102;&#65281;)</span>
</pre>
</div>

<p>
范例：将/etc/passwd 第四个字段 GID ，那个 GID 记录在/etc/group
当中的第三个字段，将两个文件整合
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@www ~]# head -n 3 /etc/passwd /etc/group
==&gt; /etc/passwd &lt;==
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin

==&gt; /etc/group &lt;==
root:x:0:root
bin:x:1:root,bin,daemon
daemon:x:2:root,bin,daemon
<span class="org-comment-delimiter"># </span><span class="org-comment">&#20174;&#19978;&#38754;&#21487;&#20197;&#30475;&#21040;&#65292;&#30830;&#23454;&#26377;&#30456;&#21516;&#30340;&#37096;&#20998;&#21908;&#65281;&#36214;&#32039;&#26469;&#25972;&#21512;&#19968;&#19979;&#65281;
</span>
[root@www ~]# join -t <span class="org-string">':'</span> -1 4 /etc/passwd -2 3 /etc/group
0:root:x:0:root:/root:/bin/bash:root:x:root
1:bin:x:1:bin:/bin:/sbin/nologin:bin:x:root,bin,daemon
2:daemon:x:2:daemon:/sbin:/sbin/nologin:daemon:x:root,bin,daemon
<span class="org-comment-delimiter"># </span><span class="org-comment">&#21516;&#26679;&#30340;&#65292;&#30456;&#21516;&#30340;&#23383;&#27573;&#37096;&#20998;&#34987;&#31227;&#21160;&#21040;&#26368;&#21069;&#38754;&#20102;&#65281;&#25152;&#20197;&#31532;&#20108;&#20010;&#25991;&#20214;&#30340;&#20869;&#23481;&#23601;&#27809;&#20877;&#26174;&#31034;&#12290;</span>
</pre>
</div>

<p>
此外，需要特别注意的是，在使用 join之前，你所需要处理的文件应该要事先
经过排序 (sort) 处理！否则有些比对的项目会被略过呢！特别注意了！
</p>
</div>
</div>
<div id="outline-container-h:61043ddb-3564-4c4d-9d29-e808471cad66" class="outline-4">
<h4 id="h:61043ddb-3564-4c4d-9d29-e808471cad66"><a href="#h:61043ddb-3564-4c4d-9d29-e808471cad66">多个文件合并paste</a></h4>
<div class="outline-text-4" id="text-h:61043ddb-3564-4c4d-9d29-e808471cad66">
<p>
paste 合并多个文件同行号的列到一行
</p>

<p>
这个 paste 就要比 join简单多了！相对于 join 必须要比对两个文件的数据相
关性， paste就直接『将两行贴在一起，且中间以 [tab] 键隔开』而已
</p>

<p>
格式
</p>

<div class="org-src-container">
<pre class="src src-sh">paste [OPTION]... [FILE]...
</pre>
</div>

<p>
选项
</p>

<div class="org-src-container">
<pre class="src src-sh">-d &#20998;&#38548;&#31526;&#65306;&#25351;&#23450;&#20998;&#38548;&#31526;&#65292;&#40664;&#35748;&#29992;TAB
-s : &#25152;&#26377;&#34892;&#21512;&#25104;&#19968;&#34892;&#26174;&#31034;

paste file1 file2 &#21512;&#24182;&#20004;&#20010;&#25991;&#20214;&#25110;&#20004;&#26639;&#30340;&#20869;&#23481;
paste -d&#160;<span class="org-string">'+'</span>&#160;file1 file2 &#21512;&#24182;&#20004;&#20010;&#25991;&#20214;&#25110;&#20004;&#26639;&#30340;&#20869;&#23481;&#65292;&#20013;&#38388;&#29992;<span class="org-string">"+"</span>&#21306;&#20998;
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">&#22914;&#26524;&#20998;&#38548;&#31526;&#20889;&#22810;&#20010;&#65292;&#21017;&#20250;&#20998;&#20808;&#21518;&#39034;&#24207;&#20381;&#27425;&#25918;&#20986;&#20998;&#38548;&#31526;
[root@ct8-ts1 master]# paste -s  num2.txt
1    1    2    2    3    3
[root@ct8-ts1 master]# paste -s -d <span class="org-string">'=\n'</span> num2.txt
<span class="org-variable-name">1</span>=1
<span class="org-variable-name">2</span>=2
<span class="org-variable-name">3</span>=3
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat alpha.log
a
b
c
d
e
f
g
h
[root@centos8 ~]#cat seq.log
1
2
3
4
5
[root@centos8 ~]#cat alpha.log seq.log
a
b
c
d
e
f
g
h
1
2
3
4
5
[root@centos8 ~]#paste alpha.log seq.log
a 1
b 2
c 3
d 4
e 5
f
g
h

[root@centos8 ~]#paste -d<span class="org-string">":"</span> alpha.log seq.log <span class="org-comment-delimiter">#</span><span class="org-comment">&#20004;&#26639;&#30340;&#20869;&#23481;&#65292;&#20013;&#38388;&#29992;":"&#21306;&#20998;
</span>a:1
b:2
c:3
d:4
e:5
f:
g:
h:
[root@centos8 ~]#paste -s seq.log
1 2 3 4 5
[root@centos8 ~]#paste -s alpha.log
a b c d e f g h
[root@centos8 ~]#paste -s alpha.log seq.log
a b c d e f g h
1 2 3 4 5

[root@centos8 ~]#cat title.txt
ceo
coo
cto
[root@centos8 ~]#cat emp.txt
me
zhang
wang
xu
[root@centos8 ~]#paste title.txt emp.txt
ceo me
coo zhang
cto wang
    xu
[root@centos8 ~]#paste -s title.txt emp.txt
ceo coo cto
me zhang wang xu

sed -ri <span class="org-string">'$r '</span>&lt;( paste -d <span class="org-string">''</span> &lt;(seq -f <span class="org-string">'IP.%g = '</span> 2 $[${#<span class="org-variable-name">MasterArray</span>[@]}+1]) &lt;(xargs -n1&lt;&lt;&lt;${<span class="org-variable-name">MasterArray</span>[@]} | sort) ) ~/k8s-manual-files/04-tls/openssl.cnf
</pre>
</div>
</div>
</div>
<div id="outline-container-h:907a7309-4f1f-4fa7-a347-41ac97134c7b" class="outline-4">
<h4 id="h:907a7309-4f1f-4fa7-a347-41ac97134c7b"><a href="#h:907a7309-4f1f-4fa7-a347-41ac97134c7b">文本流格式化为多列输出column</a></h4>
<div class="outline-text-4" id="text-h:907a7309-4f1f-4fa7-a347-41ac97134c7b">
<p>
它特别适用于将文本文件的内容以整齐的列格式显示，使得数据更加易于阅读
</p>

<p>
常用选项
</p>
<pre class="example" id="org0bc2da6">
-t：输出表格格式，自动对齐列。
-c：连续输出，不跳到下一页。
-s：指定分隔符，默认是制表符（tab），可以是任何字符。
-x：使用空格作为分隔符。
-p：使用行首和行尾的分隔符。
-o : 列与列之间的分隔符
</pre>

<p>
范例：输出一个类似表格的输出格式
</p>
<div class="org-src-container">
<pre class="src src-sh">cat&lt;&lt;EOF&gt; a.log <span class="org-sh-heredoc">
name age city
Alice 30 New York
Bob 25 Los Angeles
Carol 35 Chicago
EOF
</span>
bin]# column -t -o <span class="org-string">'| '</span> a.log 
name | age| city   | 
Alice| 30 | New    | York
Bob  | 25 | Los    | Angeles
Carol| 35 | Chicago| 
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">vmstat 1 4 |column -t 
<span class="org-comment-delimiter">#</span><span class="org-comment">&#23637;&#31034;&#20869;&#23481;
</span>procs  -----------memory----------  ---swap--  -----io----  -system--  ------cpu-----
<span class="org-builtin">r</span>      b                            swpd       free         buff       cache           si  so  bi   bo  <span class="org-keyword"> in</span>     cs     us  sy  id  wa  st
2      0                            0          12184500     33532      1404544         0   0   2    36   0      0      6   3   92  0   0
2      0                            0          12162792     33544      1405456         0   0   140  440  30221  41481  33  5   62  0   0
2      0                            0          12162060     33544      1405880         0   0   32   420  28039  38302  32  5   64  0   0
3      0                            0          12137168     33544      1406340         0   0   96   0    31062  38257  30  5   65  0   0
</pre>
</div>
</div>
</div>
<div id="outline-container-h:4fe9f1a8-aa47-436c-8381-76d2c451b35b" class="outline-4">
<h4 id="h:4fe9f1a8-aa47-436c-8381-76d2c451b35b"><a href="#h:4fe9f1a8-aa47-436c-8381-76d2c451b35b">转换文件字符集编码iconv</a></h4>
<div class="outline-text-4" id="text-h:4fe9f1a8-aa47-436c-8381-76d2c451b35b">
<p>
iconv [选项&#x2026;] [文件&#x2026;]
</p>

<p>
选项可:
</p>

<div class="org-src-container">
<pre class="src src-sh">&#36755;&#20837;/&#36755;&#20986;&#26684;&#24335;&#35268;&#33539;&#65306;
-f, --from-code=&#21517;&#31216; &#21407;&#22987;&#25991;&#26412;&#32534;&#30721;
-t, --to-code=&#21517;&#31216; &#36755;&#20986;&#32534;&#30721;

&#20449;&#24687;&#65306;
-l, --list &#21015;&#20030;&#25152;&#26377;&#24050;&#30693;&#30340;&#23383;&#31526;&#38598;

&#36755;&#20986;&#25511;&#21046;&#65306;
-c &#20174;&#36755;&#20986;&#20013;&#24573;&#30053;&#26080;&#25928;&#30340;&#23383;&#31526;
-o, --output=FILE &#36755;&#20986;&#25991;&#20214;
-s, --silent &#20851;&#38381;&#35686;&#21578;
--verbose &#25171;&#21360;&#36827;&#24230;&#20449;&#24687;
</pre>
</div>

<p>
范例：转换文件字符集编码
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#26174;&#31034;&#25903;&#25345;&#23383;&#31526;&#38598;&#32534;&#30721;&#21015;&#34920;
</span>[root@centos8 ~]#iconv -l

<span class="org-comment-delimiter">#</span><span class="org-comment">windows10&#19978;&#25991;&#26412;&#40664;&#35748;&#30340;&#32534;&#30721;ANSI&#65288;GB2312&#65289;
</span>[root@centos8 data]#file windows.txt
windows.txt: ISO-8859 text, with no line terminators

[root@centos8 data]#echo $<span class="org-variable-name">LANG</span>
en_US.UTF-8

<span class="org-comment-delimiter">#</span><span class="org-comment">&#40664;&#35748;&#22312;linux&#26080;&#27861;&#27491;&#24120;&#26174;&#31034;&#25991;&#26412;&#20869;&#23481;
</span>[root@centos8 data]#cat windows11.txt
&#9618;&#9618;&#9618;&#9618;&#9618;&#9618;[root@centos8 data]#

<span class="org-comment-delimiter">#</span><span class="org-comment">&#23558;windows10&#19978;&#25991;&#26412;&#40664;&#35748;&#30340;&#32534;&#30721;ANSI&#65288;GB2312&#65289;&#36716;&#25442;&#25104;UTF-8
</span>[root@centos8 data]#iconv -f gb2312 windows.txt -o windows1.txt
[root@centos8 data]#cat windows1.txt
abc[root@centos8 data]#ll windows1.txt
-rw-r--r-- 1 root root 12 Mar 23 10:13 windows1.txt
[root@centos8 data]#file windows1.txt
windows1.txt: UTF-8 Unicode text, with no line terminators

<span class="org-comment-delimiter">#</span><span class="org-comment">&#23558;UTF-8&#36716;&#25442;&#25104;windows10&#19978;&#25991;&#26412;&#40664;&#35748;&#30340;&#32534;&#30721;ANSI&#65288;GB2312&#65289;
</span>[root@centos8 data]#iconv -f utf8 -t gb2312 windows1.txt -o windows11.txt
[root@centos8 data]#file windows11.txt
windows11.txt: ISO-8859 text, with no line terminators
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#23558;windows10&#19978;&#25991;&#26412;&#40664;&#35748;&#30340;&#32534;&#30721;ANSI&#65288;GB2312&#65289;&#36716;&#25442;&#25104;UTF-8
</span>[15:34:50 root@centos8 ~]#iconv -f gb2312 win.txt -o win2.txt
[15:34:50 root@centos8 ~]#file linux.txt
linux.txt: ASCII text
[15:34:31 root@centos8 ~]#file windows.txt
windows.txt: ASCII text, with CRLF line terminators
<span class="org-comment-delimiter">#</span><span class="org-comment">&#23558;windows&#30340;&#25991;&#26412;&#26684;&#24335;&#36716;&#25442;&#25104;Linux&#30340;&#25991;&#26412;&#26684;&#24335;
</span>[15:35:26 root@centos8 ~]#dos2unix windows.txt
dos2unix: converting file windows.txt to Unix format...
[15:36:00 root@centos8 ~]#file windows.txt
windows.txt: ASCII text
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:a26d70f6-56c6-4110-8762-177749dcafe9" class="outline-3">
<h3 id="h:a26d70f6-56c6-4110-8762-177749dcafe9"><a href="#h:a26d70f6-56c6-4110-8762-177749dcafe9">分割命令： split</a></h3>
<div class="outline-text-3" id="text-h:a26d70f6-56c6-4110-8762-177749dcafe9">
<p>
常用选项
</p>

<div class="org-src-container">
<pre class="src src-sh">-a : &#25351;&#23450;&#21518;&#32512;&#38271;&#24230;
-b : &#27599;&#20010;&#25991;&#20214;&#22810;&#23569;&#23383;&#33410;
-d : &#20351;&#29992;&#25968;&#23383;&#21518;&#32512;&#32780;&#19981;&#26159;&#23383;&#27597;
-l : &#25351;&#23450;&#27599;&#20010;&#25991;&#20214;&#30340;&#34892;&#25968;
--verbose
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">split -l 138000 -d  archive.txt  tmp/archive- --verbose
</pre>
</div>
</div>
</div>
<div id="outline-container-h:f2d11901-058a-4324-b421-4d4ca96bb2a3" class="outline-3">
<h3 id="h:f2d11901-058a-4324-b421-4d4ca96bb2a3"><a href="#h:f2d11901-058a-4324-b421-4d4ca96bb2a3">分析文本的工具</a></h3>
<div class="outline-text-3" id="text-h:f2d11901-058a-4324-b421-4d4ca96bb2a3">
<p>
文本数据统计：wc 整理文本：sort 比较文件：diff和patch
</p>
</div>
<div id="outline-container-h:3087dd42-146c-4726-8548-44e09b86d5f7" class="outline-4">
<h4 id="h:3087dd42-146c-4726-8548-44e09b86d5f7"><a href="#h:3087dd42-146c-4726-8548-44e09b86d5f7">收集文本统计数据wc</a></h4>
<div class="outline-text-4" id="text-h:3087dd42-146c-4726-8548-44e09b86d5f7">
<p>
wc 命令可用于统计文件的行总数、单词总数、字节总数和字符总数
</p>

<p>
可以对文件或STDIN中的数据统计
</p>

<p>
常用选项
</p>
<div class="org-src-container">
<pre class="src src-sh">-l &#21482;&#35745;&#25968;&#34892;&#25968;
-w &#21482;&#35745;&#25968;&#21333;&#35789;&#24635;&#25968;
-c &#21482;&#35745;&#25968;&#23383;&#33410;&#24635;&#25968;
-m &#21482;&#35745;&#25968;&#23383;&#31526;&#24635;&#25968;
-L &#26174;&#31034;&#25991;&#20214;&#20013;&#26368;&#38271;&#34892;&#30340;&#38271;&#24230;
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">wc story.txt
39   237   1901 story.txt
&#34892;&#25968;  &#21333;&#35789;&#25968;  &#23383;&#33410;&#25968;

[root@centos8 ~]#ll title.txt
-rw-r--r-- 1 root root 30 Dec 20 11:05 title.txt
[root@centos8 ~]#ll title1.txt
-rw-r--r-- 1 root root 28 Dec 20 11:06 title1.txt
[root@centos8 ~]#cat title.txt
ceo cici
coo zhang
cto &#32769;&#29579;
[root@centos8 ~]#cat title1.txt
ceo zzzz
coo zhang
cto wang
[root@centos8 ~]#wc title.txt
3  6 30 title.txt
[root@centos8 ~]#wc title1.txt
3  6 28 title1.txt

[root@centos8 ~]#wc -l title.txt
3 title.txt
[root@centos8 ~]#cat title.txt | wc -l
3

[root@centos8 ~]#df | tail -n $(<span class="org-builtin">echo</span> <span class="org-sh-quoted-exec">`df | wc -l`</span>-1|bc)
devtmpfs      910220    0   910220  0% /dev
tmpfs       924728    0   924728  0% /dev/shm
tmpfs       924728   9224   915504  1% /run
tmpfs       924728    0   924728  0% /sys/fs/cgroup
/dev/sda2    104806400 4836160  99970240  5% /
/dev/sda3    52403200  398580  52004620  1% /data
/dev/sda1     999320  131764   798744  15% /boot
tmpfs       184944    4   184940  1% /run/user/0
</pre>
</div>
</div>
</div>
<div id="outline-container-h:7007405e-5772-4874-b5ef-9ed476def4a3" class="outline-4">
<h4 id="h:7007405e-5772-4874-b5ef-9ed476def4a3"><a href="#h:7007405e-5772-4874-b5ef-9ed476def4a3">文本排序sort</a></h4>
<div class="outline-text-4" id="text-h:7007405e-5772-4874-b5ef-9ed476def4a3">
<p>
官方文档：<a href="https://www.gnu.org/software/coreutils/manual/html_node/sort-invocation.html#sort-invocation">https://www.gnu.org/software/coreutils/manual/html_node/sort-invocation.html#sort-invocation</a>
</p>

<p>
把整理过的文本显示在STDOUT，不改变原始文件 格式： sort [options] file(s)
</p>

<p>
常用选项
</p>
<div class="org-src-container">
<pre class="src src-sh">-r &#25191;&#34892;&#21453;&#26041;&#21521;&#65288;&#30001;&#19978;&#33267;&#19979;&#65289;&#25972;&#29702;
-R &#38543;&#26426;&#25490;&#24207;
-n &#25191;&#34892;&#25353;&#25968;&#23383;&#22823;&#23567;&#25972;&#29702;
-f &#36873;&#39033;&#24573;&#30053;&#65288;fold&#65289;&#23383;&#31526;&#20018;&#20013;&#30340;&#23383;&#31526;&#22823;&#23567;&#20889;
-c &#27979;&#35797;&#25991;&#20214;&#26159;&#21542;&#24050;&#32463;&#20998;&#31867;&#12290;
-m &#21512;&#24182;&#20004;&#20010;&#20998;&#31867;&#25991;&#20214;&#12290; -m &#21512;&#24182;&#20004;&#20010;&#20998;&#31867;&#25991;&#20214;&#12290;
-u &#36873;&#39033;&#65288;&#29420;&#29305;&#65292;unique&#65289;&#65292;&#21512;&#24182;&#37325;&#22797;&#39033;&#65292;&#21363;&#21435;&#37325;
-o &#23384;&#20648;sort&#32467;&#26524;&#30340;&#36755;&#20986;&#25991;&#20214;&#21517;&#12290;

-b &#65306;&#24573;&#30053;&#26368;&#21069;&#38754;&#30340;&#31354;&#26684;&#31526;&#37096;&#20998;&#65307;
-t c &#36873;&#39033;&#20351;&#29992;c&#20570;&#20026;&#23383;&#27573;&#30028;&#23450;&#31526;
-k pos1[,pos2] <span class="org-comment-delimiter">#</span><span class="org-comment">&#25351;&#23450;&#19968;&#20010;&#30001;&#34892;&#20013;&#30340;&#37096;&#20998;&#32452;&#25104;&#30340;&#25490;&#24207;&#23383;&#27573; &#20174; pos1 &#21644; pos2&#65288;&#25110;&#34892;&#23614;&#65292;&#22914;&#26524;&#30465;&#30053; pos2&#65289;&#65292; &#21253;&#21547; &#12290;
</span>pos &#25351;&#23450;&#23383;&#27573;&#32534;&#21495;&#65288;&#20174; 1 &#24320;&#22987;&#65289;&#65292;&#23383;&#27573;&#20043;&#38388;&#30001;&#31354;&#30333;&#23383;&#31526;&#20998;&#38548;&#65292;&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;
&#36825;&#20123;&#31354;&#30333;&#23383;&#31526;&#21253;&#21547;&#22312;&#27599;&#20010;&#23383;&#27573;&#30340;&#24320;&#22987;&#22788;&#12290;&#35201;&#35843;&#25972;&#31354;&#30333;&#23383;&#31526;&#30340;&#22788;&#29702;&#26041;&#24335;&#65292;&#35831;&#21442;&#38405; -b &#36873;&#39033;&#21644; -t &#36873;&#39033;

&#27599;&#20010; pos &#30340;&#24418;&#24335;&#20026;&#8216; f[.c][opts] &#8217;
&#20854;&#20013; f &#26159;&#20351;&#29992;&#23383;&#27573;&#30340;&#32534;&#21495;&#65292;&#32780; c &#26159;&#35745;&#25968; &#20174;&#23383;&#27573;&#24320;&#22836;&#33719;&#21462;&#31532;&#19968;&#20010;&#23383;&#31526;&#12290;&#23383;&#27573;&#21644;
&#23383;&#31526; &#20301;&#32622;&#20174;1&#24320;&#22987;&#32534;&#21495;&#65307;&#23383;&#31526;&#20301;&#32622;&#20174;0&#24320;&#22987; pos2 &#34920;&#31034;&#23383;&#27573;&#30340;&#26368;&#21518;&#19968;&#20010;&#23383;&#31526;&#12290;&#22914;
&#26524;&#20174; pos1 &#20013;&#30465;&#30053;&#20102; &#8216; .c &#8217;&#65292;&#21017;&#40664;&#35748;&#20026; 1&#65288;&#23383;&#27573;&#30340;&#24320;&#22987;&#22788;&#65289;&#65307;&#22914;&#26524;&#20174; pos2
&#20013;&#30465;&#30053;&#20102;&#65292;&#21017;&#40664;&#35748;&#20026; 0&#65288;&#23383;&#27573;&#30340;&#26411;&#23614;&#65289;&#12290; opts &#26159;&#25490;&#24207;&#36873;&#39033;&#65292;&#20801;&#35768;&#26681;&#25454;&#19981;&#21516;&#30340;&#35268;
&#21017;&#23545;&#21333;&#20010;&#38190;&#36827;&#34892;&#25490;&#24207;&#65307;&#35814;&#32454;&#20449;&#24687;&#35831;&#35265;&#19979;&#25991;&#12290;&#38190;&#21487;&#20197;&#36328;&#36234;&#22810;&#20010;&#23383;&#27573;&#12290;

&#31034;&#20363;&#65306;&#35201;&#22312;&#31532;&#20108;&#20010;&#23383;&#27573;&#19978;&#25490;&#24207;&#65292;&#35831;&#20351;&#29992;--key=2,2 &#65288; -k 2,2 &#65289;&#12290;&#26377;&#20851;&#38190;&#21644;&#26356;&#22810;
&#31034;&#20363;&#30340;&#35828;&#26126;&#65292;&#35831;&#21442;&#38405;&#19979;&#25991;&#12290;&#36824;&#21487;&#20197;&#26597;&#30475;--debug &#36873;&#39033;&#65292;&#20197;&#24110;&#21161;&#30830;&#23450;&#27491;&#22312;&#20351;&#29992;&#30340;&#34892;
&#37096;&#20998;&#12290;
</pre>
</div>

<p>
其它选项
</p>
<div class="org-src-container">
<pre class="src src-sh">-M &#65306;&#20197;&#26376;&#20221;&#30340;&#21517;&#23383;&#26469;&#25490;&#24207;&#65292;&#20363;&#22914; JAN, DEC &#31561;&#31561;&#30340;&#25490;&#24207;&#26041;&#27861;&#65307;
-T DIRECTORY &#20351;&#29992;DIRECTORY&#20316;&#20026;&#20020;&#26102;&#25991;&#20214;,&#32780;&#19981;&#26159;$<span class="org-variable-name">TMPDIR&#25110;&#32773;</span>/tmp
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 data]#cut -d: -f1,3 /etc/passwd|sort -t: -k2 -nr |head -n3
nobody:65534
xiaoming:1002
me:1001
<span class="org-comment-delimiter">#</span><span class="org-comment">&#32479;&#35745;&#26085;&#24535;&#35775;&#38382;&#37327;
</span>[root@centos8 data]#cut -d<span class="org-string">" "</span> -f1 /var/log/nginx/access_log |sort -u|wc -l
201
</pre>
</div>

<p>
注意：
</p>
<ol class="org-ol">
<li>ASCII码表中的升序排序</li>
<li>默认不是比较数字大小</li>
<li>逐个字符的ASCII码大小比较排序</li>
</ol>

<p>
如：合并
</p>

<div class="org-src-container">
<pre class="src src-sh">sort  -m -k 1 -T /ops/swap -o ${<span class="org-variable-name">local_path</span>}/${<span class="org-builtin">log</span>}  ${<span class="org-variable-name">local_path</span>}/${<span class="org-builtin">log</span>}_*
</pre>
</div>

<p>
范例：统计分区利用率
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#df
Filesystem   1K-blocks  Used Available Use% Mounted on
devtmpfs     391676    0  391676  0% /dev
tmpfs       408092    0  408092  0% /dev/shm
tmpfs       408092  5816  402276  2% /run
tmpfs       408092    0  408092  0% /sys/fs/cgroup
/dev/sda2   104806400 2259416 102546984  3% /
/dev/sda3    52403200 398608 52004592  1% /data
/dev/sda1     999320 130848  799660 15% /boot
tmpfs       81616    0   81616  0% /run/user/0
/dev/sr0     7377866 7377866     0 100% /misc/cd

<span class="org-comment-delimiter">#</span><span class="org-comment">&#26597;&#30475;&#20998;&#21306;&#21033;&#29992;&#29575;&#26368;&#39640;&#20540;
</span>[root@centos8 ~]#df| tr -s <span class="org-string">' '</span> <span class="org-string">'%'</span>|cut -d% -f5|sort -nr|head -1
100
[root@centos8 ~]#df | tr -s <span class="org-string">" "</span> %|cut -d% -f5|tr -d <span class="org-string">'[:alpha:]'</span> | sort
0
0
0
1
1
1
15
5
[root@centos8 ~]#df | tr -s <span class="org-string">" "</span> %|cut -d% -f5|tr -d <span class="org-string">'[:alpha:]'</span> | sort -n
0
0
0
1
1
1
5
15
[root@centos8 ~]#df | tr -s <span class="org-string">" "</span> %|cut -d% -f5|tr -d <span class="org-string">'[:alpha:]'</span> | sort -n |tail -n1
15
[root@centos8 ~]#df | tr -s <span class="org-string">" "</span> %|cut -d% -f5|tr -d <span class="org-string">'[:alpha:]'</span> | sort -nr
15
5
1
1
1
0
0
0
[root@centos8 ~]#df | tr -s <span class="org-string">" "</span> %|cut -d% -f5|tr -d <span class="org-string">'[:alpha:]'</span> | sort -nr|head -n1
15
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">sort file1 file2 &#25490;&#24207;&#20004;&#20010;&#25991;&#20214;&#30340;&#20869;&#23481;
sort file1 file2 | uniq &#21462;&#20986;&#20004;&#20010;&#25991;&#20214;&#30340;&#24182;&#38598;(&#37325;&#22797;&#30340;&#34892;&#21482;&#20445;&#30041;&#19968;&#20221;)
sort file1 file2 | uniq -u &#21024;&#38500;&#20132;&#38598;&#65292;&#30041;&#19979;&#20854;&#20182;&#30340;&#34892;
sort file1 file2 | uniq -d &#21462;&#20986;&#20004;&#20010;&#25991;&#20214;&#30340;&#20132;&#38598;(&#21482;&#30041;&#19979;&#21516;&#26102;&#23384;&#22312;&#20110;&#20004;&#20010;&#25991;&#20214;&#20013;&#30340;&#25991;&#20214;)
</pre>
</div>


<p>
<b>详细解释</b>
</p>

<p>
下面是文件video的清单，包含了上个季度家电商场的租金情况。各域为：
</p>

<p>
(1)名称，(2)供货区代码，(3)本季度租金,(4)本年租金。
</p>

<p>
域分隔符为冒号，为此对此例需使用‘-t’选项。文件如下：
</p>
<div class="org-src-container">
<pre class="src src-sh">cat &lt;&lt;\EOF&gt; video<span class="org-sh-heredoc">
Boys in Company C       :HK     :192    :2192
Alien                   :HK     :119    :1982
The Hill                :KL     :63     :2972
Aliens                  :HK     :532    :4892
Star Wars               :HK     :301    :4102
A Few Good Men :KL      :445    :5851
Toy Story               :HK     :239    :3972
EOF</span>
</pre>
</div>

<p>
sort字段的参照方式：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">-t &#40664;&#35748;&#31354;&#26684;&#21046;&#34920;&#31526;&#20026;&#23383;&#27573;&#20998;&#38548;
</span>&#23383;&#27573;1                   &#23383;&#27573;2   &#23383;&#27573;3    &#23383;&#27573;3  
Boys<span class="org-keyword"> in</span> Company C       :HK     :192    :2192
Alien                   :HK     :119    :1982
The Hill                :KL     :63     :2972
Aliens                  :HK     :532    :4892
Star Wars               :HK     :301    :4102
A Few Good Men          :KL     :445    :5851
Toy Story               :HK     :239    :3972
</pre>
</div>

<p>
文件是否已分类
</p>
<ul class="org-ul">
<li>怎样分辨文件是否已分类？如果只有30行，看看就知道了，但如果是400行呢，使用sort -c查看sort文件是否按某种顺序分类。</li>
<li>没有任何错误提示，返回提示符表明已分类。然而如果测试成功，返回一个信息行会更好。</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">[root@grafana .jasper]# sort -c video 
sort: video:2: disorder: Alien                   :HK     :119    :1982

<span class="org-comment-delimiter">#</span><span class="org-comment">&#32467;&#26524;&#26174;&#31034;&#26410;&#20998;&#31867;&#65292;&#29616;&#22312;&#23558;video&#20998;&#31867;&#65292;&#24182;&#23384;&#20026;2.video
</span>[root@grafana .jasper]# sort -t: video &gt;2.video
[root@grafana .jasper]# sort -c 2.video 
[root@grafana .jasper]# 
</pre>
</div>

<p>
在不符合 POSIX 1003.1-2001 标准的系统上， sort 支持传统的以零为起始的
语法 <code>+pos1 [-pos2]</code> 来指定排序键。如果 y 存在或不存在，则传统命令
<code>sort +a.x -b.y</code> 等同于 <code>sort -k a+1.x+1,b</code> 。 否则它等同于 <code>sort -k a+1.x+1,b+1.y</code>
</p>

<div class="org-src-container">
<pre class="src src-sh">sort -t: -k[field_start[type][,field_end[type]]] video              

sort -t: -k2,2 -k1,1 video
&#23383;&#27573;&#20998;&#38548;&#31526;: -t: &#34920;&#31034;&#29992;&#20882;&#21495; : &#20998;&#38548;&#23383;&#27573;&#12290;
&#20027;&#25490;&#24207;&#38190;: -k2,2 &#34920;&#31034;&#20165;&#20197;&#31532; 2 &#20010;&#23383;&#27573;&#20316;&#20026;&#20027;&#38190;&#65288;&#20174;&#31532; 2 &#20010;&#23383;&#27573;&#24320;&#22987;&#65292;&#21040;&#31532; 2 &#20010;&#23383;&#27573;&#32467;&#26463;&#65289;&#12290;
&#27425;&#25490;&#24207;&#38190;: -k1,1 &#34920;&#31034;&#20165;&#20197;&#31532; 1 &#20010;&#23383;&#27573;&#20316;&#20026;&#27425;&#38190;&#12290;
&#25490;&#24207;&#35268;&#21017;: &#40664;&#35748;&#25353;&#23383;&#20856;&#24207;&#65288;&#23383;&#31526;&#20018;&#27604;&#36739;&#65289;&#25490;&#24207;&#12290;
[root@grafana .jasper]# sort -t: -k2,2 -k1,1 video
Alien                   :HK     :119    :1982
Aliens                  :HK     :532    :4892
Boys<span class="org-keyword"> in</span> Company C       :HK     :192    :2192
Star Wars               :HK     :301    :4102
Toy Story               :HK     :239    :3972
The Hill                :KL     :63     :2972
A Few Good Men :KL      :445    :5851

sort -t: -k2 -k1,1 video
&#20027;&#25490;&#24207;&#38190;: -k2 &#26410;&#25351;&#23450;&#32467;&#26463;&#23383;&#27573;&#65292;&#40664;&#35748;&#20174;&#31532; 2 &#20010;&#23383;&#27573;&#24320;&#22987;&#21040;&#34892;&#23614;&#12290;
&#27425;&#25490;&#24207;&#38190;: -k1,1 &#21516;&#19978;&#12290;
&#25490;&#24207;&#35268;&#21017;: &#40664;&#35748;&#23383;&#20856;&#24207;&#12290;
[root@grafana .jasper]# sort -t: -k2 -k1,1 video
Alien                   :HK     :119    :1982
Boys<span class="org-keyword"> in</span> Company C       :HK     :192    :2192
Toy Story               :HK     :239    :3972
Star Wars               :HK     :301    :4102
Aliens                  :HK     :532    :4892
A Few Good Men :KL      :445    :5851
The Hill                :KL     :63     :2972


sort -t: -k2,2n -k3.3,3.4 video
&#20027;&#25490;&#24207;&#38190;: -k2,2n &#34920;&#31034;&#20197;&#31532; 2 &#20010;&#23383;&#27573;&#20316;&#20026;&#20027;&#38190;&#65292;&#24182;&#25353;&#25968;&#20540;&#65288;n&#65289;&#25490;&#24207;&#12290;
&#27425;&#25490;&#24207;&#38190;: -k3.3,3.4 &#34920;&#31034;&#20197;&#31532; 3 &#20010;&#23383;&#27573;&#30340;&#31532; 3 &#21040;&#31532; 4 &#20010;&#23383;&#31526;&#20316;&#20026;&#27425;&#38190;&#12290;
&#25490;&#24207;&#35268;&#21017;:
&#20027;&#38190;&#25353;&#25968;&#20540;&#22823;&#23567;&#25490;&#24207;&#12290;
&#27425;&#38190;&#25353;&#23383;&#31526;&#20018;&#23383;&#20856;&#24207;&#25490;&#24207;&#65292;&#20294;&#20165;&#25130;&#21462;&#31532; 3 &#20010;&#23383;&#27573;&#30340;&#31532; 3-4 &#20010;&#23383;&#31526;&#12290;
[root@grafana .jasper]# sort -t: -k2,2n -k3.3,3.4 video
The Hill                :KL     :63     :2972
Star Wars               :HK     :301    :4102
Aliens                  :HK     :532    :4892
Boys<span class="org-keyword"> in</span> Company C       :HK     :192    :2192
A Few Good Men :KL      :445    :5851
Alien                   :HK     :119    :1982
Toy Story               :HK     :239    :3972
</pre>
</div>

<p>
面试题：有两个文件，a.txt与b.txt，合并两个文件，并输出时确保每个数字也
唯一
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">a.txt&#20013;&#30340;&#27599;&#19968;&#20010;&#25968;&#23383;&#22312;&#26412;&#25991;&#20214;&#21807;&#19968;
</span>200
100
34556
23
...

<span class="org-comment-delimiter">#</span><span class="org-comment">b.txt&#20013;&#30340;&#27599;&#19968;&#20010;&#25968;&#23383;&#22312;&#26412;&#25991;&#20214;&#21807;&#19968;
</span>123
43
200
3321
...

<span class="org-comment-delimiter">#</span><span class="org-comment">&#23601;&#26159;&#23558;&#20004;&#20010;&#25991;&#20214;&#21512;&#24182;&#21518;&#37325;&#22797;&#30340;&#34892;&#21435;&#38500;&#65292;&#19981;&#20445;&#30041;
</span>100
345563
123
43
3321
...
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c93ae04a-b31a-4369-84da-61ea205da931" class="outline-4">
<h4 id="h:c93ae04a-b31a-4369-84da-61ea205da931"><a href="#h:c93ae04a-b31a-4369-84da-61ea205da931">去重uniq</a></h4>
<div class="outline-text-4" id="text-h:c93ae04a-b31a-4369-84da-61ea205da931">
<p>
uniq命令从输入中删除前后相接的重复的行
</p>

<p>
格式： uniq [OPTION]&#x2026; [FILE]&#x2026;
</p>

<p>
常见选项：
</p>

<div class="org-src-container">
<pre class="src src-sh">-c: &#26174;&#31034;&#27599;&#34892;&#37325;&#22797;&#20986;&#29616;&#30340;&#27425;&#25968;
-d: &#20165;&#26174;&#31034;&#37325;&#22797;&#36807;&#30340;&#34892;
-u: &#20165;&#26174;&#31034;&#19981;&#26366;&#37325;&#22797;&#30340;&#34892;
</pre>
</div>

<p>
uniq常和sort 命令一起配合使用：
</p>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">sort userlist.txt | uniq -c
</pre>
</div>

<p>
范例：统计日志访问量最多的请求
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 data]#cut -d<span class="org-string">" "</span> -f1 access_log |sort |uniq -c|sort -nr |head -3
 4870 172.20.116.228
 3429 172.20.116.208
 2834 172.20.0.222
[root@centos8 data]#lastb -f btmp-34 | tr -s <span class="org-string">' '</span> |cut -d <span class="org-string">' '</span> -f3|sort |uniq -c
|sort -nr | head -3
 86294 58.218.92.37
 43148 58.218.92.26
 18036 112.85.42.201
</pre>
</div>

<p>
范例：并发连接最多的远程主机IP
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#ss -nt|tail -n+2 |tr -s <span class="org-string">' '</span> : |cut -d: -f6|sort|uniq -c|sort -nr |head -n2
  7 10.0.0.1
  2 10.0.0.7
</pre>
</div>

<p>
范例：取两个文件的相同和不同的行
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 data]#cat test1.txt
a
b
1
c
[root@centos8 data]#cat test2.txt
b
e
f
c
1
2
<span class="org-comment-delimiter">#</span><span class="org-comment">&#21462;&#25991;&#20214;&#30340;&#20849;&#21516;&#34892;
</span>[root@centos8 data]#cat test1.txt test2.txt | sort |uniq -d
1
b
c
<span class="org-comment-delimiter">#</span><span class="org-comment">&#21462;&#25991;&#20214;&#30340;&#19981;&#21516;&#34892;
</span>[root@centos8 data]#cat test1.txt test2.txt | sort |uniq -u
2
a
e
f
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b4f14745-7103-44e3-99a5-c23186dd324d" class="outline-4">
<h4 id="h:b4f14745-7103-44e3-99a5-c23186dd324d"><a href="#h:b4f14745-7103-44e3-99a5-c23186dd324d">统计代码行数cloc</a></h4>
<div class="outline-text-4" id="text-h:b4f14745-7103-44e3-99a5-c23186dd324d">
<p>
Cloc (opens new window)是一款使用 Perl语言开发的开源代码统计工具，支持
多平台使用、多语言识别，能够计算指定目标文件或文件夹中的文件数（files）、
空白行数（blank）、注释行数（comment）和代码行数（code）。
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Mac &#31995;&#32479;&#23433;&#35013;
</span>$ brew install cloc

<span class="org-comment-delimiter"># </span><span class="org-comment">Vue &#24037;&#31243;&#20195;&#30721;&#32479;&#35745;
</span>$ cloc ./ --exclude-dir=node_modules
</pre>
</div>

<p>
常用命令:
</p>

<ul class="org-ul">
<li>cloc ./ 统计当前文件夹代码量</li>
<li>cloc ./ &#x2013;exclude-dir=目录名
统计排除当前目录下的某个文件夹的代码量，多个文件使用,分隔</li>
<li>cloc -by-file 文件后缀名 统计特定文件的代码量</li>
</ul>
</div>
</div>
<div id="outline-container-h:20091fcb-d854-472c-ab05-626013984690" class="outline-4">
<h4 id="h:20091fcb-d854-472c-ab05-626013984690"><a href="#h:20091fcb-d854-472c-ab05-626013984690">比较文件</a></h4>
<div class="outline-text-4" id="text-h:20091fcb-d854-472c-ab05-626013984690">
</div>
<div id="outline-container-h:ec21b649-8966-45d1-8efb-659c5b8cd51f" class="outline-5">
<h5 id="h:ec21b649-8966-45d1-8efb-659c5b8cd51f"><a href="#h:ec21b649-8966-45d1-8efb-659c5b8cd51f">diff</a></h5>
<div class="outline-text-5" id="text-h:ec21b649-8966-45d1-8efb-659c5b8cd51f">
<p>
diff是Unix系统的一个很重要的工具程序。它用来比较两个文本文件的差异，是
代码版本管理的核心工具之一。其用法非常简单：
</p>

<div class="org-src-container">
<pre class="src src-sh">diff &lt;&#21464;&#21160;&#21069;&#30340;&#25991;&#20214;&gt; &lt;&#21464;&#21160;&#21518;&#30340;&#25991;&#20214;&gt;
</pre>
</div>

<p>
由于历史原因，diff有三种格式：
</p>

<ul class="org-ul">
<li>正常格式（normal diff）</li>
<li>上下文格式（context diff）=-c=</li>
<li>合并格式（unified diff）=-u=</li>
</ul>

<p>
<b>1、正常格式的diff</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">diff file1 file2
</span>
[root@centos8 ~]#cat f1.txt <span class="org-comment-delimiter"># </span><span class="org-comment">&#21464;&#21160;&#21069;&#30340;&#25991;&#20214;
</span>me
zhang
wang
xu
[root@centos8 ~]#cat f2.txt <span class="org-comment-delimiter"># </span><span class="org-comment">&#21464;&#21160;&#21518;&#30340;&#25991;&#20214;
</span>mu
zir
wang
xu
shi

[root@centos8 ~]#diff f1.txt f2.txt
1,2c1,2
&lt; me
&lt; zhang
---
&gt; me
&gt; zir
4a5
&gt; shi
</pre>
</div>

<p>
显示结果中: 第一行: 一个提示，用来说明变动位置。
</p>

<p>
它分成三个部分：
</p>

<ul class="org-ul">
<li>前面的数字：表示file1的第n行有变化；</li>
<li>中间的变动的模式： c: (change)内容改变，a: (addition)"增加", d:
(deletion)删除；</li>
</ul>

<p>
缺点：显示结果太简单
</p>

<p>
<b>2、上下文格式的diff</b>
</p>

<p>
上个世纪80年代初，加州大学伯克利分校推出BSD版本的Unix时，觉得diff的显
示结果太简单，最好加入上下文，便于了解发生的变动。因此，推出了上下文格
式的diff。它的使用方法是加入-c选项（即context）。
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">diff -c f1 f2
</span>
[root@centos8 ~]# diff -c f1.txt  f2.txt
** f1.txt  2021-04-21 17:11:13.651012923 +0800
--- f2.txt  2021-04-21 17:11:22.927070433 +0800
***************
** 1,4 ****
<span class="org-negation-char">!</span> me
<span class="org-negation-char">!</span> zhang
  wang
  xu
--- 1,5 ----
<span class="org-negation-char">!</span> mu
<span class="org-negation-char">!</span> zir
  wang
  xu
+ shi
</pre>
</div>

<p>
结果分成四个部分。
</p>

<ul class="org-ul">
<li>第一部分：两行，显示两个文件的基本情况：文件名和时间信息，“***"表示
变动前的文件，"&#x2014;“表示变动后的文件。</li>
<li>第二部分：15个星号，将文件的基本情况与变动内容分割开。</li>
<li>第三部分：显示变动前的文件，即file1。另外，文件内容的每一行最前面，
还有一个标记位。如果为空，表示该行无变化；如果是感叹号（!），表示该
行有改动；如果是减号（-），表示该行被删除；如果是加号（+），表示该行
为新增。</li>
<li>第四部分：显示变动后的文件，即file2。</li>
</ul>

<p>
缺点：将显示大量重复的内容，很浪费空间
</p>

<p>
<b>3、合并格式的diff</b>
</p>

<p>
如果两个文件相似度很高，那么上下文格式的diff，将显示大量重复的内容，很浪费空间。1990年，GNU
diff率先推出了”合并格式”的diff，将f1和f2的上下文合并在一起显示。
它的使用方法是加入u参数（代表unified）。
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#diff -u f1.txt f2.txt
--- f1.txt 2019-12-13 21:31:30.892775671 +0800
+++ f2.txt 2019-12-13 22:00:14.373677728 +0800
@@ -1,4 +1,5 @@
-me
-zhang
+mu
+zir
wang
xu
+shi
</pre>
</div>

<p>
其结果
</p>

<ul class="org-ul">
<li>第一部分：文件的基本信息。"&#x2014;"表示变动前的文件，"<del>+</del>"表示变动后的文件。</li>
<li>第二部分：变动的位置用两个@作为起首和结束。</li>
<li>第三部分是变动的具体内容。除了有变动的那些行以外，也是上下文各显示3
行。它将两个文件的上下文，合并显示在一起，所以叫做”合并格式”。每一
行最前面的标志位，空表示无变动，减号表示第一个文件删除的行，加号表示
第二个文件新增的行。</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">&#25171;&#34917;&#19969;
</span>[root@centos8 ~]#diff -u f1.txt f2.txt &gt; f.patch
[root@centos8 ~]#rm -f f2.txt
[root@centos8 ~]#patch -b f1.txt f.patch
patching file f1.txt
[root@centos8 ~]#cat f1.txt
mu
zir
wang
xu
shi
[root@centos8 ~]#cat f1.txt.orig
me
zhang
wang
xu
</pre>
</div>

<p>
注明第5行有区别（改变）
</p>

<p>
复制对文件改变patch diff
</p>

<p>
命令的输出被保存在一种叫做“补丁”的文件中
</p>

<p>
使用 -u选项来输出“统一的（unified）”diff格式文件，最适用于补丁文件
</p>

<p>
范例：进程替换比较两个 curl 响应
</p>

<div class="org-src-container">
<pre class="src src-sh">diff -aNur &lt;(curl -s httpbin.org/get) &lt;(curl -s httpbin.org/get)
--- /dev/fd/63  2022-10-18 16:02:18.633005560 +0800
+++ /dev/fd/62  2022-10-18 16:02:18.633005560 +0800
@@ -4,7 +4,7 @@
     <span class="org-string">"Accept"</span>: <span class="org-string">"*/*"</span>,
     <span class="org-string">"Host"</span>: <span class="org-string">"httpbin.org"</span>,
     <span class="org-string">"User-Agent"</span>: <span class="org-string">"curl/7.68.0"</span>,
-    <span class="org-string">"X-Amzn-Trace-Id"</span>: <span class="org-string">"Root=1-634e5d8b-1eb31b42468a62f11ca13683"</span>
+    <span class="org-string">"X-Amzn-Trace-Id"</span>: <span class="org-string">"Root=1-634e5d8b-3d27e89e310ea9fb56e8c0a8"</span>
   },
</pre>
</div>
</div>
</div>
<div id="outline-container-h:70cb695d-6544-460d-805b-33cecb8e4be9" class="outline-5">
<h5 id="h:70cb695d-6544-460d-805b-33cecb8e4be9"><a href="#h:70cb695d-6544-460d-805b-33cecb8e4be9">patch</a></h5>
<div class="outline-text-5" id="text-h:70cb695d-6544-460d-805b-33cecb8e4be9">
<p>
patch 复制在其它文件中进行的改变（要谨慎使用）
</p>

<p>
适用 -b 选项来自动备份改变了的文件
</p>

<p>
常用选项：
</p>

<ul class="org-ul">
<li>-i : 打补丁</li>
<li>-R : 还原补丁</li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">diff -u foo.conf foo2.conf &gt; foo.patch
patch -b foo.conf foo.patch
</pre>
</div>
</div>
</div>
<div id="outline-container-h:3d052250-0d79-411b-b940-3b5b5d3031a8" class="outline-5">
<h5 id="h:3d052250-0d79-411b-b940-3b5b5d3031a8"><a href="#h:3d052250-0d79-411b-b940-3b5b5d3031a8">二进制文件的不同 cmp</a></h5>
<div class="outline-text-5" id="text-h:3d052250-0d79-411b-b940-3b5b5d3031a8">
<p>
范例：查看二进制文件的不同
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 data]#ll /usr/bin/dir /usr/bin/ls
-rwxr-xr-x. 1 root root 166448 May 12  2019 /usr/bin/dir
-rwxr-xr-x. 1 root root 166448 May 12  2019 /usr/bin/ls
[root@centos8 data]#ll /usr/bin/dir /usr/bin/ls -i
201839444 -rwxr-xr-x. 1 root root 166448 May 12  2019 /usr/bin/dir
201839465 -rwxr-xr-x. 1 root root 166448 May 12  2019 /usr/bin/ls
[root@centos8 data]#diff /usr/bin/dir /usr/bin/ls
Binary files /usr/bin/dir and /usr/bin/ls differ

[root@centos8 ~]#cmp /bin/dir /bin/ls
/bin/dir /bin/ls differ: byte 737, line 2
[root@centos8 ~]#hexdump -s 730 -Cn 7 /bin/dir
000002da  00 00 47 4e 55 00 b0               |..GNU..|
000002e1
[root@centos8 ~]#hexdump -s 730 -Cn 7 /bin/ls
000002da  00 00 47 4e 55 00 93               |..GNU..|
000002e1
</pre>
</div>
</div>
</div>
<div id="outline-container-h:cef5110a-31c5-4937-875d-33159edd56b3" class="outline-5">
<h5 id="h:cef5110a-31c5-4937-875d-33159edd56b3"><a href="#h:cef5110a-31c5-4937-875d-33159edd56b3">comm比较文件取集合</a></h5>
<div class="outline-text-5" id="text-h:cef5110a-31c5-4937-875d-33159edd56b3">
<p>
comm命令用于比较两个已排序的文件，并输出它们的交集、差集和并集。
</p>

<div class="org-src-container">
<pre class="src src-sh">comm [option]... file1 file2
&#20854;&#20013;&#65292;option&#34920;&#31034;&#36873;&#39033;&#65292;file1&#21644;file2&#34920;&#31034;&#35201;&#27604;&#36739;&#30340;&#20004;&#20010;&#25991;&#20214;&#12290;&#24120;&#29992;&#36873;&#39033;&#21253;&#25324;&#65306;
-1&#65306;&#21482;&#36755;&#20986;file1&#20013;&#26377;&#32780;file2&#20013;&#27809;&#26377;&#30340;&#34892;&#12290;
-2&#65306;&#21482;&#36755;&#20986;file2&#20013;&#26377;&#32780;file1&#20013;&#27809;&#26377;&#30340;&#34892;&#12290;
-3&#65306;&#21482;&#36755;&#20986;file1&#21644;file2&#20013;&#37117;&#23384;&#22312;&#30340;&#34892;&#12290;
-i&#65306;&#22312;&#27604;&#36739;&#26102;&#24573;&#30053;&#22823;&#23567;&#20889;&#12290;
-u&#65306;&#23558;&#25152;&#26377;&#19981;&#21516;&#30340;&#34892;&#37117;&#36755;&#20986;&#12290;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">comm&#160;-1&#160;file1 file2 &#27604;&#36739;&#20004;&#20010;&#25991;&#20214;&#30340;&#20869;&#23481;&#21482;&#21024;&#38500;&#160;<span class="org-string">'file1'</span>&#160;&#25152;&#21253;&#21547;&#30340;&#20869;&#23481;
comm&#160;-2&#160;file1 file2 &#27604;&#36739;&#20004;&#20010;&#25991;&#20214;&#30340;&#20869;&#23481;&#21482;&#21024;&#38500;&#160;<span class="org-string">'file2'</span>&#160;&#25152;&#21253;&#21547;&#30340;&#20869;&#23481;
comm&#160;-3&#160;file1 file2 &#27604;&#36739;&#20004;&#20010;&#25991;&#20214;&#30340;&#20869;&#23481;&#21482;&#21024;&#38500;&#20004;&#20010;&#25991;&#20214;&#20849;&#26377;&#30340;&#37096;&#20998;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:62fc6575-046e-40ef-81c1-058a545ed427" class="outline-4">
<h4 id="h:62fc6575-046e-40ef-81c1-058a545ed427"><a href="#h:62fc6575-046e-40ef-81c1-058a545ed427">json文件分析jq</a></h4>
<div class="outline-text-4" id="text-h:62fc6575-046e-40ef-81c1-058a545ed427">
<p>
jq使用 jq是一个命令行处理json的工具。
</p>

<p>
现在大部分交互的数据格式都是以json的形式，不管是写一些监控脚本或者平时
使用，都是一个比较方便的工具，本文总结下一些基本用法，包括格式化数据，
过滤，排序等常用功能。
</p>

<p>
1.安装使用
</p>

<div class="org-src-container">
<pre class="src src-sh">yum install -y epel-release
yum install -y jq
</pre>
</div>

<p>
2.格式化输出
</p>

<p>
默认pretty输出，如果需要压缩，使用-c选项
</p>

<div class="org-src-container">
<pre class="src src-sh">cat &gt;me.json &lt;&lt;\EOF<span class="org-sh-heredoc">
{"username":"henry","age":25,"email":"xxx@gmail.com","blog":"http://thoreauz.com","hobby":["music","writing","photography"],"education":{"school":"MIT","degree":"Master"}}
EOF
</span>
[root@agent01 learn]# cat me.json |jq .
{
  <span class="org-string">"username"</span>: <span class="org-string">"henry"</span>,
  <span class="org-string">"age"</span>: 25,
  <span class="org-string">"email"</span>: <span class="org-string">"xxx@gmail.com"</span>,
  <span class="org-string">"blog"</span>: <span class="org-string">"http://thoreauz.com"</span>,
  <span class="org-string">"hobby"</span>: [
    <span class="org-string">"music"</span>,
    <span class="org-string">"writing"</span>,
    <span class="org-string">"photography"</span>
  ],
  <span class="org-string">"education"</span>: {
    <span class="org-string">"school"</span>: <span class="org-string">"MIT"</span>,
    <span class="org-string">"degree"</span>: <span class="org-string">"Master"</span>
  }
}
</pre>
</div>

<p>
3.过滤
</p>

<p>
使用.foo,选择对象的foo字段，.foo?和前者一样，但出错时不输出出错信息。
</p>

<div class="org-src-container">
<pre class="src src-sh">cat jqtest.json |jq .email

&#36807;&#28388;&#23383;&#27573;
$ echo <span class="org-string">'{"name":"wxnacy", "id": 1, "age": 23}'</span> | jq <span class="org-string">'{"name", "id"}'</span>
{
  <span class="org-string">"name"</span>: <span class="org-string">"wxnacy"</span>,
  <span class="org-string">"id"</span>: 1
}
</pre>
</div>

<p>
3.1 使用逗号获取多个值
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@agent01 learn]# jq <span class="org-string">'.email, .age'</span> me.json
<span class="org-string">"xxx@gmail.com"</span>
25
</pre>
</div>

<p>
3.2 数组
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@agent01 learn]# cat me.json | jq .hobby[1]
<span class="org-string">"writing"</span>
</pre>
</div>

<p>
3.3 数据分片
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@agent01 learn]# cat me.json | jq .hobby[:2]
[
  <span class="org-string">"music"</span>,
  <span class="org-string">"writing"</span>
]
</pre>
</div>

<p>
3.4 数组遍历
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@agent01 learn]# echo <span class="org-string">"{\"a\": 1, \"b\": 2}"</span>|jq <span class="org-string">'.[]'</span>
1
2

[root@agent01 learn]# echo <span class="org-string">'[{"name":"JSON", "good":true}, {"name":"XML", "good":false}]'</span> | jq <span class="org-string">'.[] | .name'</span>
<span class="org-string">"JSON"</span>
<span class="org-string">"XML"</span>
</pre>
</div>

<p>
前面的示例严格说是获取特定字段，如果想做更细致的过滤可以使用select函数。
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@agent01 learn]# cat me.json | jq -r <span class="org-string">'.education | select(.school == "MIT")'</span>
{
  <span class="org-string">"school"</span>: <span class="org-string">"MIT"</span>,
  <span class="org-string">"degree"</span>: <span class="org-string">"Master"</span>
}
</pre>
</div>

<p>
4.构造新对象
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@agent01 learn]# cat me.json | jq <span class="org-string">'.|{"name": .username, "like": .hobby[1]}'</span>
{
  <span class="org-string">"name"</span>: <span class="org-string">"henry"</span>,
  <span class="org-string">"like"</span>: <span class="org-string">"writing"</span>
}
</pre>
</div>

<p>
5.高级用法 5.1 map函数
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@agent01 learn]# echo <span class="org-string">"[1,2,3,4]"</span>| jq  <span class="org-string">'map(select(.&gt;2))'</span> -c
[3,4]
</pre>
</div>

<p>
5.2 Reduce函数
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@agent01 learn]# echo <span class="org-string">'[0,1,2,3,4,5,6,7,8,9]'</span> | jq <span class="org-string">'reduce .[] as $n ([]; if ($n%2==0) then . else . + [$n] end)'</span> -c
[1,3,5,7,9]
</pre>
</div>

<p>
从示例中看到了很多用法，reduce遍历，定义变量$n，可以使用
if-elif-else-end，添加数据+[]。
</p>

<p>
总之，他就像awk一样是个小型的编程语言，可以自定义函数，具有I/O和Stream，
几乎能实现自己想要的任何json处理。
</p>

<p>
参考文档：
</p>
<ul class="org-ul">
<li><a href="https://stedolan.github.io/jq/manual/">https://stedolan.github.io/jq/manual/</a></li>
<li><a href="https://jqplay.org/">https://jqplay.org/</a></li>
</ul>

<p>
范例：k8s pod统计
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">&#21015;&#20986;&#23646;&#20110;&#29305;&#23450;RC&#30340;Pod&#21517;&#31216;
</span><span class="org-comment-delimiter">#</span><span class="org-comment">jq&#21629;&#20196;&#23545;&#20110;&#22797;&#26434;&#30340;json&#36335;&#24452;&#36716;&#25442;&#24456;&#26377;&#29992;, &#26356;&#22810;&#35814;&#24773;https://stedolan.github.io/jq/
</span><span class="org-variable-name">sel</span>=${<span class="org-variable-name">$</span>(kubectl get rc my-rc --output=json | jq -j <span class="org-string">'.spec.selector | to_entries | .[] | "\(.key)=\(.value),"'</span>)%?}
<span class="org-builtin">echo</span> $(kubectl get pods --selector=$<span class="org-variable-name">sel</span> --output=<span class="org-variable-name">jsonpath</span>={.items..metadata.name})

<span class="org-comment-delimiter"># </span><span class="org-comment">&#26174;&#31034;&#25152;&#26377;pod&#65288;&#25110;&#20219;&#20309;&#20854;&#20182;&#25903;&#25345;&#26631;&#31614;&#30340;Kubernetes&#23545;&#35937;&#65289;&#30340;&#26631;&#31614;
</span><span class="org-comment-delimiter"># </span><span class="org-comment">Also uses "jq"
</span><span class="org-keyword">for</span> item<span class="org-keyword"> in</span> $( kubectl get pod --output=name); <span class="org-keyword">do</span> printf <span class="org-string">"Labels for %s\n"</span> <span class="org-string">"$item"</span> | grep --color -E <span class="org-string">'[^/]+$'</span> &amp;&amp; kubectl get <span class="org-string">"$item"</span> --output=json | jq -r -S <span class="org-string">'.metadata.labels | to_entries | .[] | " \(.key)=\(.value)"'</span> 2&gt;/dev/null; printf <span class="org-string">"\n"</span>; <span class="org-keyword">done</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">&#21015;&#20986;&#24403;&#21069;pod&#27491;&#22312;&#20351;&#29992;&#30340;&#25152;&#26377;secert
</span>kubectl get pods -o json | jq <span class="org-string">'.items[].spec.containers[].env[]?.valueFrom.secretKeyRef.name'</span> | grep -v null | sort | uniq


<span class="org-comment-delimiter"># </span><span class="org-comment">&#21015;&#20986;pod&#36164;&#28304;&#37197;&#32622;
</span>kubectl get deploy -n general-components -o <span class="org-variable-name">jsonpath</span>=<span class="org-string">'{range .items[*]}{@.spec.replicas},{range @.spec.template.spec.containers[*]}{@.name},{@.resources.requests.cpu}C/{@.resources.requests.memory},{@.readinessProbe.httpGet.path},{@.readinessProbe.httpGet.port}{"\n"}{end}{end}'</span>|sort -t <span class="org-string">','</span>  -k 2 |sed <span class="org-string">'1i&#21103;&#26412;&#25968;,&#39033;&#30446;,&#21333;&#33410;&#28857;&#36164;&#28304;,&#20581;&#24247;&#22320;&#22336;,&#31471;&#21475;'</span> &gt;general-components.csv

kubectl get deploy -n english-prod -o <span class="org-variable-name">jsonpath</span>=<span class="org-string">'{range .items[*]}{@.spec.replicas},{range @.spec.template.spec.containers[*]}{@.name},{@.resources.requests.cpu}C/{@.resources.requests.memory},{@.readinessProbe.httpGet.path},{@.readinessProbe.httpGet.port}{"\n"}{end}{end}'</span>|sort -t <span class="org-string">','</span>  -k 2 |sed <span class="org-string">'1i&#21103;&#26412;&#25968;,&#39033;&#30446;,&#21333;&#33410;&#28857;&#36164;&#28304;,&#20581;&#24247;&#22320;&#22336;,&#31471;&#21475;'</span> |awk -F<span class="org-string">','</span> <span class="org-string">'{printf"%s %40-s %20-s %10-s\n",$1,$2,$3,$4}'</span>
</pre>
</div>

<p>
范例：kafka topic容量
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">topic&#27599;&#20010;&#20998;&#21306;&#30340;&#23481;&#37327;
</span>/usr/hdp/3.1.0.0-78/kafka/bin/kafka-log-dirs.sh --describe --bootstrap-server 172.18.41.174:9092|grep <span class="org-string">'^{'</span> |jq <span class="org-string">'{a:.brokers[]|.logDirs[]|.partitions[]|{"partition","size"}}|.a'</span>
/usr/hdp/3.1.0.0-78/kafka/bin/kafka-log-dirs.sh --describe --bootstrap-server 172.18.41.174:9092|grep <span class="org-string">'^{'</span>   | jq <span class="org-string">'[ ..|.partition?,.size?]'</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">topic&#27599;&#20010;&#20998;&#21306;&#30340;&#23481;&#37327;&#25490;&#24207;
</span>/usr/hdp/3.1.0.0-78/kafka/bin/kafka-log-dirs.sh --describe --bootstrap-server 172.18.41.174:9092|grep <span class="org-string">'^{'</span>   | jq <span class="org-string">'[ ..|.partition?,.size?]'</span> |tr <span class="org-string">','</span> <span class="org-string">' '</span>|grep -vE <span class="org-string">'\[|\]|null'</span>|awk <span class="org-string">'BEGIN{t=0}{if ($1 ~ "[a-zA-Z]") {t =$1}else{print t":"$1} }'</span> |awk -F: <span class="org-string">'{num[$1]=$2}END{for(n in num)print n":"num[n]}'</span>|sort -t: -nr -k1

/usr/hdp/3.1.0.0-78/kafka/bin/kafka-log-dirs.sh --describe --bootstrap-server 172.18.41.174:9092|grep <span class="org-string">'^{'</span>   | jq <span class="org-string">'[ ..|.partition?,.size?]'</span> |tr <span class="org-string">','</span> <span class="org-string">' '</span>|grep -vE <span class="org-string">'\[|\]|null'</span>|awk <span class="org-string">'BEGIN{t=0}{if ($1 ~ "[a-zA-Z]") {t =$1}else{print t":"$1} }'</span> |awk -F: <span class="org-string">'{num[$1]=$2}END{for(n in num)print n":"num[n]/1024/1024/1024"g"}'</span>|sort -t: -nr -k2|grep -E <span class="org-string">'xymember|yzuser|box|rainbowbridge|yzcrm'</span>
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">echo '&#26597;&#35810;&#29992;&#30340;github,GFW&#21407;&#22240;&#21487;&#33021;&#20250;&#27604;&#36739;&#20037;,&#35831;&#30830;&#20445;&#33021;&#35775;&#38382;&#21040;github'
</span>curl -sX GET https://api.github.com/repos/zhangguanzhang/${<span class="org-variable-name">repository</span>}/contents/$<span class="org-variable-name">img_name</span>?<span class="org-variable-name">ref</span>=develop | <span class="org-sh-escaped-newline">\</span>
    jq -r <span class="org-string">'length as $len | if $len ==2 then .message elif $len ==12 then .name else .[].name  end'</span>
</pre>
</div>

<p>
练习
</p>
<ul class="org-ul">
<li>找出ifconfig "网卡名" 命令结果中本机的IPv4地址</li>
<li>查出分区空间使用率的最大百分比值</li>
<li>查出用户UID最大值的用户名、UID及shell类型</li>
<li>查出/tmp的权限，以数字方式显示</li>
<li>统计当前连接本机的每个远程主机IP的连接数，并按从大到小排序</li>
</ul>
</div>
</div>
</div>
</section>
<section id="outline-container-h:f101eef7-f24c-405e-9cc9-4d40a61ba924" class="outline-2">
<h2 id="h:f101eef7-f24c-405e-9cc9-4d40a61ba924"><a href="#h:f101eef7-f24c-405e-9cc9-4d40a61ba924">正则表达式</a></h2>
<div class="outline-text-2" id="text-h:f101eef7-f24c-405e-9cc9-4d40a61ba924">
<p>
REGEXP： Regular Expressions，由一类特殊字符及文本字符所编写的模式，其
中有些字符（元字符）不表示字符字面意义，而表示控制或通配的功能，类似于
增强版的通配符功能，但与通配符不同，通配符功能是用来处理文件名，而正则
表达式是处理文本内容中字符
</p>

<p>
正则表达式被很多程序和开发语言所广泛支持：vim, less,grep,sed,awk,
nginx,mysql 等
</p>

<p>
正则表达式分两类：
</p>

<ul class="org-ul">
<li>基本正则表达式：BRE</li>
<li>扩展正则表达式：ERE</li>
</ul>

<p>
正则表达式引擎：
</p>

<p>
采用不同算法，检查处理正则表达式的软件模块，如：PCRE（Perl Compatible
RegularExpressions）
</p>

<p>
正则表达式的元字符分类：字符匹配、匹配次数、位置锚定、分组
</p>

<p>
帮助：man 7 regex
参考
</p>
<ul class="org-ul">
<li>正则表达式30分钟入门教程 <a href="https://www.w3cschool.cn/regex_rmjc/">https://www.w3cschool.cn/regex_rmjc/</a></li>
<li>perl文官正则: <a href="https://perldoc.perl.org/perlre">https://perldoc.perl.org/perlre</a></li>
<li>grep 中正则: <a href="https://www.gnu.org/software/grep/manual/grep.html#Regular-Expressions">https://www.gnu.org/software/grep/manual/grep.html#Regular-Expressions</a></li>
<li>python re正则表达式: <a href="https://docs.python.org/zh-cn/3/library/re.html">https://docs.python.org/zh-cn/3/library/re.html</a></li>
<li>Microsoft
<ul class="org-ul">
<li>.NET正则: <a href="https://learn.microsoft.com/en-us/dotnet/standard/base-types/regular-expressions">https://learn.microsoft.com/en-us/dotnet/standard/base-types/regular-expressions</a></li>
<li>visual studio ide 正则: <a href="https://learn.microsoft.com/en-us/visualstudio/ide/using-regular-expressions-in-visual-studio?view=vs-2022">https://learn.microsoft.com/en-us/visualstudio/ide/using-regular-expressions-in-visual-studio?view=vs-2022</a></li>
</ul></li>
<li>基础正则表达式: <a href="https://www.cnblogs.com/f-ck-need-u/p/9621130.html">https://www.cnblogs.com/f-ck-need-u/p/9621130.html</a></li>
<li>Perl正则表达式超详细教程: <a href="https://www.cnblogs.com/f-ck-need-u/p/9648439.html">https://www.cnblogs.com/f-ck-need-u/p/9648439.html</a></li>
</ul>

<p>
测试：
</p>
<ul class="org-ul">
<li>正则测试工具RegEx Tester: <a href="https://sourceforge.net/projects/regextester/">https://sourceforge.net/projects/regextester/</a></li>
<li>在线测试：<a href="https://regextester.github.io/">https://regextester.github.io/</a></li>
</ul>
</div>
<div id="outline-container-h:58562c6b-529e-4f2b-ac86-599d68a637f3" class="outline-3">
<h3 id="h:58562c6b-529e-4f2b-ac86-599d68a637f3"><a href="#h:58562c6b-529e-4f2b-ac86-599d68a637f3">基本正则表达式元字符</a></h3>
<div class="outline-text-3" id="text-h:58562c6b-529e-4f2b-ac86-599d68a637f3">
</div>
<div id="outline-container-h:081be6ea-a706-4f07-8f1e-a5a5a8c204bc" class="outline-4">
<h4 id="h:081be6ea-a706-4f07-8f1e-a5a5a8c204bc"><a href="#h:081be6ea-a706-4f07-8f1e-a5a5a8c204bc">元字符</a></h4>
<div class="outline-text-4" id="text-h:081be6ea-a706-4f07-8f1e-a5a5a8c204bc">
<div class="org-src-container">
<pre class="src src-sh">.&#65306;&#21305;&#37197;&#20219;&#24847;&#21333;&#20010;&#23383;&#31526;&#65292;&#21487;&#20197;&#26159;&#19968;&#20010;&#27721;&#23383;&#12290;&#20294;&#19981;&#33021;&#21305;&#37197;&#25442;&#34892;&#31526; \n&#12290;&#20013;&#25324;&#21495;[]&#20013;&#30340;.&#28857;&#34920;&#31034;&#28857;&#23383;&#31526; 
*&#65306;&#21305;&#37197;&#21069;&#38754;&#37027;&#20010;&#23383;&#31526;0&#25110;&#22810;&#27425;
?&#65306;&#21305;&#37197;&#21069;&#38754;&#37027;&#20010;&#23383;&#31526;0&#25110;&#19968;&#27425;&#65292;&#21363;:&#21487;&#26377;&#21487;&#26080;
+&#65306;&#21305;&#37197;&#21069;&#38754;&#37027;&#20010;&#23383;&#31526;1&#27425;&#20197;&#19978;&#65292;&#21363;:&#32943;&#23450;&#26377;&#65292;&gt;=1
{n}: &#21305;&#37197;&#21069;&#38754;&#30340;&#23383;&#31526;n&#27425;
{n,}: &#21305;&#37197;&#21069;&#38754;&#30340;&#23383;&#31526;&#33267;&#23569;n&#27425;
{,n}: &#21305;&#37197;&#21069;&#38754;&#30340;&#23383;&#31526;&#33267;&#22810;n&#27425;,&lt;=n
{n,m}: &#21305;&#37197;&#21069;&#38754;&#30340;&#23383;&#31526;&#33267;&#23569;m&#27425;&#65292;&#33267;&#22810;n&#27425;

&#38170;&#23450;&#65306;&#38170;&#23450;&#30340;&#24847;&#24605;&#26159;&#21305;&#37197;&#20301;&#32622;&#65292;&#32780;&#38750;&#21305;&#37197;&#23383;&#31526;&#23454;&#20307;
  ^&#65306;&#21305;&#37197;&#34892;&#39318;&#20301;&#32622;&#65292;&#27880;&#24847;&#21305;&#37197;&#30340;&#26159;&#20301;&#32622;&#65292;&#19981;&#26159;&#23383;&#31526;
  $&#65306;&#21305;&#37197;&#34892;&#23614;&#20301;&#32622;&#65292;&#27880;&#24847;&#21305;&#37197;&#30340;&#26159;&#20301;&#32622;&#65292;&#19981;&#26159;&#23383;&#31526;

&#29305;&#27530;&#19988;&#24120;&#29992;&#30340;&#30340;&#32452;&#21512;&#27491;&#21017;&#34920;&#36798;&#24335;&#65306;
^$&#65306;&#23427;&#34920;&#31034;&#21305;&#37197;&#31354;&#34892;
.*&#65306;&#21305;&#37197;&#20219;&#24847;&#38271;&#24230;&#30340;&#20219;&#24847;&#23383;&#31526;&#65292;&#20294;&#19981;&#33021;&#21305;&#37197;&#25442;&#34892;&#31526;&#12290;&#30495;&#27491;&#30340;&#21305;&#37197;&#20219;&#24847;&#38271;&#24230;&#30340;&#20219;&#24847;&#23383;&#31526;&#65292;&#35265;&#19979;&#38754;


[]  &#21305;&#37197;&#25351;&#23450;&#33539;&#22260;&#20869;&#30340;&#20219;&#24847;&#21333;&#20010;&#23383;&#31526;&#65292;&#31034;&#20363;&#65306;[wang]  [0-9]  [a-z]  [a-zA-Z]  [.]&#28857;&#25918;&#22312;&#20013;&#25324;&#21495;&#20869;&#34920;&#31034;.&#28857;&#65292;&#22806;&#38754;&#21017;&#26159;&#20195;&#34920;&#20219;&#24847;&#19968;&#20010;&#23383;&#31526;
[^] &#21305;&#37197;&#25351;&#23450;&#33539;&#22260;&#22806;&#30340;&#20219;&#24847;&#21333;&#20010;&#23383;&#31526;,&#31034;&#20363;&#65306;[^wang]
</pre>
</div>

<p>
需要解释清楚的是这些量词(也就是上面匹配的次数元字符)的特殊性：当使用了
匹配多次的量词时(如匹配3-5次的 <code>{3,5}</code> )，且量词前面的字符有多种可能性
(如中括号序列 <code>[abc]</code> )，那么量词的次数可以作用于任一字符。有些不好理解，
但看示例就知道了：
</p>

<div class="org-src-container">
<pre class="src src-sh">[abc]{3,5}     <span class="org-comment-delimiter"># </span><span class="org-comment">&#34920;&#31034;abc&#20219;&#24847;&#23383;&#31526;&#37117;&#21487;&#20197;&#20986;&#29616;&#65292;&#27604;&#22914;&#20840;&#26159;a&#65292;&#25110;&#32773;ab&#21516;&#26102;&#20986;&#29616;&#65292;&#20294;&#24635;&#30340;&#20986;&#29616;&#27425;&#25968;&#20026;3-5&#27425;
</span>.*          <span class="org-comment-delimiter"># </span><span class="org-comment">&#34920;&#31034;&#20219;&#19968;&#23383;&#31526;(&#38500;&#25442;&#34892;&#31526;)&#65292;&#21487;&#20197;&#20219;&#24847;&#20986;&#29616;&#20219;&#24847;&#27425;&#25968;&#65292;&#23427;&#19981;&#34920;&#31034;a&#20043;&#21518;&#23601;&#24517;&#39035;&#20840;&#26159;a
</span>.+          <span class="org-comment-delimiter"># </span><span class="org-comment">&#34920;&#31034;&#20219;&#19968;&#23383;&#31526;(&#38500;&#25442;&#34892;&#31526;)&#65292;&#21487;&#20197;&#20219;&#24847;&#20986;&#29616;&#33267;&#23569;&#19968;&#27425;&#65292;&#23427;&#19981;&#34920;&#31034;a&#20043;&#21518;&#23601;&#24517;&#39035;&#20840;&#26159;a</span>
</pre>
</div>

<p>
另外， <code>.</code> 无法匹配换行符。可能你不太理解为什么需要匹配换行符，它主要用在：
</p>

<ol class="org-ol">
<li>多行模式。例如sed的多行模式下，要跨行匹配需要手动指定”\n“，如
<code>/^a.*\nb.*/</code></li>
<li>明确指定了行分隔符为非”\n“的情况。例如awk可以使用RS变量指定输入行分隔符</li>
</ol>

<p>
范例：点
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#ls /etc/ | grep <span class="org-string">'rc[.0-6]'</span>  <span class="org-comment-delimiter"># </span><span class="org-comment">&#28857;&#25918;&#22312;&#20013;&#25324;&#21495;&#20869;&#34920;&#31034;.&#28857;&#65292;&#22806;&#38754;&#21017;&#26159;&#20195;&#34920;&#20219;&#24847;&#19968;&#20010;&#23383;&#31526;
</span>rc0.d
rc1.d
rc2.d
rc3.d
rc4.d
rc5.d
rc6.d
rc.d
rc.local
[root@centos8 ~]#ls /etc/ | grep <span class="org-string">'rc[.0-6].'</span>
rc0.d
rc1.d
rc2.d
rc3.d
rc4.d
rc5.d
rc6.d
rc.d
rc.local
[root@centos8 ~]#ls /etc/ | grep <span class="org-string">'rc[.0-6]\.'</span>
rc0.d
rc1.d
rc2.d
rc3.d
rc4.d
rc5.d
rc6.d
</pre>
</div>

<p>
范例: 匹配次数
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@middle-ware ~]# echo google |grep <span class="org-string">'go*gle'</span>
google
[root@middle-ware ~]# echo ggle |grep <span class="org-string">'go*gle'</span>   <span class="org-comment-delimiter"># </span><span class="org-comment">*&#21069;&#38754;&#30340;&#23383;&#31526;&#20219;&#24847;&#27425;&#65292;&#21253;&#21547;0&#27425;&#65292;&#25152;&#20197;&#28385;&#36275;
</span>ggle
[root@middle-ware ~]# echo goooogle |grep <span class="org-string">'go*gle'</span>
goooogle
[root@middle-ware ~]# echo ggle |grep <span class="org-string">'g.*gle'</span>
ggle
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#echo /etc/ |grep <span class="org-string">"/etc/\?"</span>
/etc/
[root@centos8 ~]#echo /etc |grep <span class="org-string">"/etc/\?"</span>
/etc
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ac084252-e922-45b5-bbae-7a372dbece05" class="outline-4">
<h4 id="h:ac084252-e922-45b5-bbae-7a372dbece05"><a href="#h:ac084252-e922-45b5-bbae-7a372dbece05">中括号</a></h4>
<div class="outline-text-4" id="text-h:ac084252-e922-45b5-bbae-7a372dbece05">
<p>
中括号表示的是匹配任意一个，一般它和字符集的排序规则有关，不同工具采取的排序规则可能也不一样。
</p>

<div class="org-src-container">
<pre class="src src-sh">[]  &#21305;&#37197;&#25351;&#23450;&#33539;&#22260;&#20869;&#30340;&#20219;&#24847;&#21333;&#20010;&#23383;&#31526;&#65292;&#31034;&#20363;&#65306;[wang]  [0-9]  [a-z]  [a-zA-Z]  [.]&#28857;&#25918;&#22312;&#20013;&#25324;&#21495;&#20869;&#34920;&#31034;.&#28857;&#65292;&#22806;&#38754;&#21017;&#26159;&#20195;&#34920;&#20219;&#24847;&#19968;&#20010;&#23383;&#31526;
[^] &#21305;&#37197;&#25351;&#23450;&#33539;&#22260;&#22806;&#30340;&#20219;&#24847;&#21333;&#20010;&#23383;&#31526;,&#31034;&#20363;&#65306;[^wang]
[abcd...]&#65306;&#21305;&#37197;&#20013;&#25324;&#21495;&#20869;&#30340;&#20219;&#24847;&#19968;&#20010;&#23383;&#31526;
[^abcd...]&#65306;&#25298;&#32477;&#21305;&#37197;&#20013;&#25324;&#21495;&#20869;&#30340;&#20219;&#24847;&#23383;&#31526;
[a-z]&#65306;&#21305;&#37197;a&#21040;z&#38388;&#20219;&#24847;&#19968;&#20010;&#23383;&#31526;&#65292;
[A-Z]&#65306;&#21305;&#37197;A&#21040;Z&#38388;&#20219;&#24847;&#19968;&#20010;&#23383;&#31526;
[0-9]&#65306;&#21305;&#37197;0&#21040;9&#20043;&#38388;&#20219;&#24847;&#19968;&#20010;&#25968;&#23383;

&#24120;&#29992;&#32452;&#21512;&#65306;
[a-zA-Z0-9] : &#21305;&#37197;aA&#21040;zZ&#12289;0&#21040;9&#20043;&#38388;&#20219;&#24847;&#19968;&#20010;&#12290;&#22914;[abcxyz]&#34920;&#31034;&#20174;abcxyz&#20013;&#21305;&#37197;&#20219;&#24847;&#19968;&#20010;&#23383;&#31526;
</pre>
</div>

<p>
关于字母的排序：
</p>

<ul class="org-ul">
<li>perl中，A-Z排在a的前面，所以[A-z]表示所有大小写字母</li>
<li>grep中，A-Z排在z的后面，所以[a-Z]表示所有大小写字母</li>
<li>还有些工具中，大小写的排序规则是aAbBcC&#x2026;zZ，所以[a-C]表示aAbBcC共6个字母</li>
</ul>
</div>
</div>
<div id="outline-container-h:503c912a-8466-493d-b64f-4b9f386ff9d6" class="outline-4">
<h4 id="h:503c912a-8466-493d-b64f-4b9f386ff9d6"><a href="#h:503c912a-8466-493d-b64f-4b9f386ff9d6">字符类</a></h4>
<div class="outline-text-4" id="text-h:503c912a-8466-493d-b64f-4b9f386ff9d6">
<p>
是专门命名的中括号序列；除了字符类，还有等价类、排序类，但基本用不上，只用字符类。
</p>

<div class="org-src-container">
<pre class="src src-sh">[:alpha:]&#65306;&#21305;&#37197;&#23383;&#27597;(&#38463;&#39069;&#20799;&#21457;&#65292;&#31561;&#20215;&#20110;[a-zA-Z]
[:digit:]&#65306;&#21305;&#37197;&#25968;&#23383;&#65292;&#31561;&#20215;&#20110;[0-9]
[:xdigit:]&#65306;&#21305;&#37197;&#21313;&#20845;&#36827;&#21046;&#25968;&#65292;&#31561;&#20215;&#20110;[0-9a-fA-F]
[:upper:]&#65306;&#21305;&#37197;&#22823;&#20889;&#23383;&#27597;(&#38463;&#22369;&#20799;&#39069;)&#65292;&#31561;&#20215;&#20110;[A-Z]
[:lower:]&#65306;&#21305;&#37197;&#23567;&#20889;&#23383;&#27597;(&#36335;&#25105;&#39069;)&#65292;&#31561;&#20215;&#20110;[a-z]
[:alnum:]&#65306;&#21305;&#37197;&#25968;&#23383;&#25110;&#23383;&#27597;&#65292;&#31561;&#20215;&#20110;[0-9a-zA-Z]
[:blank:]&#65306;&#21305;&#37197;&#31354;&#30333;&#65292;&#21253;&#25324;&#31354;&#26684;&#21644;&#21046;&#34920;&#31526;
[:space:]&#65306;&#21305;&#37197;&#31354;&#26684;&#65292;&#21253;&#25324;&#26032;&#34892;&#12289;&#31354;&#26684;&#12289;&#21046;&#34920;&#31526;&#12289;&#25442;&#34892;&#31526;&#12289;&#22238;&#36710;&#31526;&#31561;&#21508;&#31181;&#31867;&#22411;&#30340;&#31354;&#30333;
[:punct:]&#65306;&#21305;&#37197;&#25152;&#26377;&#26631;&#28857;&#31526;&#21495;(&#24597;&#21487;&#29305;&#12290;&#21253;&#25324;&#65306;! <span class="org-string">' " ` # $ % &amp; ( ) * + , . - _ / : ; &lt; = &gt; ? @ [ \ ] ^ { | } ~
[:graph:]&#65306;&#38750;&#31354;&#23383;&#31526;&#12290;&#32472;&#22270;&#31867;&#12290;&#21253;&#25324;&#65306;&#22823;&#23567;&#20889;&#23383;&#27597;&#12289;&#25968;&#23383;&#21644;&#26631;&#28857;&#31526;&#21495;&#12290;&#31561;&#20215;&#20110;[:alnum:]+[:punct:]
[:print:]&#65306;&#38750;&#31354;&#23383;&#31526;&#65288;&#21253;&#25324;&#31354;&#26684;&#65289;&#12290;&#25171;&#21360;&#23383;&#31526;&#31867;&#12290;&#21253;&#25324;&#65306;&#22823;&#23567;&#20889;&#23383;&#27597;&#12289;&#25968;&#23383;&#12289;&#26631;&#28857;&#31526;&#21495;&#21644;&#31354;&#26684;&#12290;&#31561;&#20215;&#20110;[:alnum:]+[:punct:]+space
[:cntrl:]&#65306;&#25511;&#21046;&#23383;&#31526;&#31867;&#12290;&#22312;ASCII&#20013;&#65292;&#36825;&#20123;&#23383;&#31526;&#30340;&#20843;&#36827;&#21046;&#20195;&#30721;&#20174;000&#21040;037&#65292;&#36824;&#21253;&#25324;177(DEL)&#12290;&#20195;&#34920;&#38190;&#30424;&#19978;&#30340;&#25511;&#21046;&#38190;&#65292;&#21253;&#25324; CR, LF, TAB, Del ..&#31561;
[:blank:]: &#31354;&#30333;&#23383;&#31526;&#65306;&#31354;&#26684;&#21644;&#21046;&#34920;&#31526;</span>
</pre>
</div>

<pre class="example" id="org0933476">
需要注意的是，通常字符类在真正使用过程中，会再加上一个中括号，例如 [[:alpha:]] 。

之所以如此，是因为这些字符类只是一种命名好的字符集合。

例如 [:lower:] 对应的字符集合是a-z，而不是 [a-z] ，所以要想让其表示这些命名字符类中的任一字符，需要再加上一层括号 [[:lower:]]，它才等价于[a-z]。

可能会更有助于理解使用字符类的时候为什么要加两个中括号的例子是[^[:lower:]]，它表示不包含任何小写字母。
</pre>
</div>
</div>
<div id="outline-container-h:7b6c68c5-a1e3-45ea-8e5e-7e8b670edf3c" class="outline-4">
<h4 id="h:7b6c68c5-a1e3-45ea-8e5e-7e8b670edf3c"><a href="#h:7b6c68c5-a1e3-45ea-8e5e-7e8b670edf3c">反斜线序列</a></h4>
<div class="outline-text-4" id="text-h:7b6c68c5-a1e3-45ea-8e5e-7e8b670edf3c">
<p>
不同的工具，同一工具不同的版本，支持的反斜线序列能力不同。以下列出了部
分常见序列。
</p>

<p>
以下所说的单词，一般来说只包含数字、字母和下划线，即 <code>[_0-9a-zA-Z]</code> 。
</p>

<p>
以下几种反斜线序列，基本上所有工具都支持：
</p>

<div class="org-src-container">
<pre class="src src-sh">\b&#65306;&#21305;&#37197;&#21333;&#35789;&#36793;&#30028;&#22788;&#30340;&#31354;&#23383;&#31526;
\B&#65306;&#21305;&#37197;&#38750;&#21333;&#35789;&#36793;&#30028;&#22788;&#30340;&#31354;&#23383;&#31526;
<span class="org-string">\&lt;</span>&#65306;&#21305;&#37197;&#21333;&#35789;&#24320;&#22836;&#22788;&#30340;&#31354;&#23383;&#31526;
<span class="org-string">\&gt;</span>&#65306;&#21305;&#37197;&#21333;&#35789;&#32467;&#23614;&#22788;&#30340;&#31354;&#23383;&#31526;
\w&#65306;&#21305;&#37197;&#21333;&#35789;&#26500;&#25104;&#37096;&#20998;&#65292;&#31561;&#20215;&#20110;[_[:alnum:]]
\W&#65306;&#21305;&#37197;&#38750;&#21333;&#35789;&#26500;&#25104;&#37096;&#20998;&#65292;&#31561;&#20215;&#20110;[^_[:alnum:]]
</pre>
</div>

<p>
以下几种，有些工具不支持，但perl都支持：
</p>

<div class="org-src-container">
<pre class="src src-sh">\s&#65306;&#21305;&#37197;&#31354;&#30333;&#23383;&#31526;&#65292;&#31561;&#20215;&#20110;[[:space:]]
\S&#65306;&#21305;&#37197;&#38750;&#31354;&#30333;&#23383;&#31526;&#65292;&#31561;&#20215;&#20110;[^[:space:]]
\d&#65306;&#21305;&#37197;&#25968;&#23383;&#65292;&#31561;&#20215;&#20110;[0-9]
\D&#65306;&#21305;&#37197;&#38750;&#25968;&#23383;&#65292;&#31561;&#20215;&#20110;[^0-9]
</pre>
</div>

<p>
由于元字符=.=默认无法匹配换行符，所以需要匹配换行符的时候，可以使用特
殊组合 <code>[\d\D]</code> 来替换 <code>.</code> ，换句话说，如果想匹配任意长度的任意字符，
可以换成 <code>[\d\D]*</code> ，当然，前提是必须支持 <code>\d</code> 和 <code>\D</code> 两个反斜线序列。
</p>

<p>
范例：使用正则工具或者在线正则网站测试
</p>
<pre class="example" id="org7d02c2f">
abc xyz
123
中文
</pre>

<div class="org-src-container">
<pre class="src src-sh">. <span class="org-comment-delimiter">#</span><span class="org-comment">&#38750;&#22810;&#34892;&#21644;&#21333;&#34892;&#19979;&#65292;&#40664;&#35748;&#21305;&#37197;&#38500;&#25442;&#34892;&#31526;&#20043;&#22806;&#20219;&#24847;&#19968;&#20010;&#23383;&#31526;
</span>\w\w <span class="org-comment-delimiter">#</span><span class="org-comment">&#21305;&#37197;2&#20010;&#23383;&#31526;
</span>\d <span class="org-comment-delimiter">#</span><span class="org-comment">&#21305;&#37197;1&#20010;&#25968;&#23383;
</span>[abc ] <span class="org-comment-delimiter">#</span><span class="org-comment">&#21305;&#37197;abc&#21644;&#31354;&#26684;&#20013;&#20219;&#24847;&#19968;&#20010;&#23383;&#31526;
</span>[abc\s] <span class="org-comment-delimiter">#</span><span class="org-comment">&#21305;&#37197;abc&#21644;&#31354;&#26684;&#23383;&#31526;&#20013;&#20219;&#24847;&#19968;&#20010;&#23383;&#31526;
</span>\w\s\w <span class="org-comment-delimiter">#</span><span class="org-comment">&#21305;&#37197;c x&#21644;z&#25442;&#34892;1&#21644;3&#25442;&#34892;&#20013;
</span>[\d\s\d] <span class="org-comment-delimiter">#</span><span class="org-comment">&#30456;&#24403;&#20110;[\d\s] &#21305;&#37197;&#25968;&#23383;&#21644;&#31354;&#30333;&#23383;&#31526;&#20013;&#20219;&#24847;&#23383;&#31526;
</span>\b\w\w\b <span class="org-comment-delimiter">#</span><span class="org-comment">&#21363;&#20316;&#35789;&#39318;&#21448;&#20316;&#35789;&#23614;&#65292;&#21305;&#37197;&#20013;&#25991;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:9589c9e7-00f7-4761-9dcf-eb1430872333" class="outline-4">
<h4 id="h:9589c9e7-00f7-4761-9dcf-eb1430872333"><a href="#h:9589c9e7-00f7-4761-9dcf-eb1430872333">分组捕获和反向引用</a></h4>
<div class="outline-text-4" id="text-h:9589c9e7-00f7-4761-9dcf-eb1430872333">
</div>
<div id="outline-container-h:05c0ed3a-9389-4471-811b-b30545dd97f9" class="outline-5">
<h5 id="h:05c0ed3a-9389-4471-811b-b30545dd97f9"><a href="#h:05c0ed3a-9389-4471-811b-b30545dd97f9">分组</a></h5>
<div class="outline-text-5" id="text-h:05c0ed3a-9389-4471-811b-b30545dd97f9">
<p>
分组： <code>()</code> 将多个字符捆绑在一起，当作一个整体处理，如： <code>(root)+</code>
</p>

<p>
后向引用：分组括号中的模式匹配到的内容会被正则表达式引擎记录于内部的变
量中，这些变量的命名方式为: <code>\1, \2, \3, ...</code>
</p>

<p>
\1 表示从左侧起第一个左括号以及与之匹配右括号之间的模式所匹配到的字符
</p>

<p>
基础正则中，使用括号可以对匹配内容进行分组并暂时保存，分组后会有分组编
号，可以使用反斜线加编号 <code>\N</code> 的方式反向引用这些分组。
</p>

<p>
分组编号的方式是从左向右计算括号数，无论如何嵌套，第一个左括号对应的分
组一定是编号1，用 <code>\1</code> 来引用，第二个左括号对应的分组一定是编号2，用
<code>\2</code> 来引用，依此类推。
</p>

<p>
示例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-string">\(</span>string1<span class="org-string">\(</span>string2<span class="org-string">\)\)</span>
\1 &#65306;string1<span class="org-string">\(</span>string2<span class="org-string">\)</span>
\2 &#65306;string2
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">echo</span> <span class="org-string">"abcddefg"</span> | grep -E <span class="org-string">"(.)\1"</span>
</pre>
</div>

<p>
对于只使用基础正则的工具来说，一般都只能引用 <code>\1</code> 到 <code>\9</code> 共9个反向引
用，最多自己额外提供一个所有表示匹配内容的反向引用(例如sed提供的 <code>&amp;</code> )。
对于超出10个的分组，使用基础正则的工具一般来说是无能为力的。
</p>

<p>
再者，基础正则仅仅只是将分组匹配到的内容捕获，在正则操作结束后就丢失。
但对于一门完整编程语言来说，这远远不够，几乎所有编程语言(如
perl/java/python等)都会将正则的分组匹配内容保存为变量，使得可以在正则
结束之后再次引用甚至修改它们。例如上面例子中分组捕获的字母d，如果换成
perl，即使在这个匹配过程结束后，还是可以去引用这段分组。
</p>
</div>
</div>
</div>
<div id="outline-container-h:746c0951-918e-4ae2-bf0b-953b7274b767" class="outline-4">
<h4 id="h:746c0951-918e-4ae2-bf0b-953b7274b767"><a href="#h:746c0951-918e-4ae2-bf0b-953b7274b767">或者</a></h4>
<div class="outline-text-4" id="text-h:746c0951-918e-4ae2-bf0b-953b7274b767">
<div class="org-src-container">
<pre class="src src-sh">pattern1 | pattern2&#65306;&#21305;&#37197;&#31446;&#32447;&#24038;&#36793;&#65292;&#25110;&#32773;&#21305;&#37197;&#31446;&#32447;&#21491;&#36793;&#37117;&#31639;&#21305;&#37197;&#25104;&#21151;
</pre>
</div>

<p>
几点需要说明：
</p>

<ol class="org-ol">
<li>因为竖线元字符的优先级很低，所以 <code>ab|cd</code> 匹配的是”ab”或”cd”，而
不是abd或acd。</li>
<li>成功匹配了左边，就不会再去对右边进行匹配。</li>
<li>反向引用失败问题：竖线将两边的分组隔开，右边的永远无法反向引用左边
的分组</li>
</ol>

<p>
示例：
</p>

<div class="org-src-container">
<pre class="src src-sh">a<span class="org-string">\|</span>b <span class="org-comment-delimiter">#</span><span class="org-comment">a&#25110;b
</span>C<span class="org-string">\|</span>cat <span class="org-comment-delimiter">#</span><span class="org-comment">C&#25110;cat
</span><span class="org-string">\(</span>C<span class="org-string">\|</span>c<span class="org-string">\)</span>at <span class="org-comment-delimiter">#</span><span class="org-comment">Cat&#25110;cat
</span>
&#20004;&#20010;&#21453;&#21521;&#24341;&#29992;&#38382;&#39064;&#30340;&#20856;&#22411;&#20363;&#23376;&#65306;
<span class="org-function-name">&#20363;&#22914;a</span>(.)|b\1&#23558;&#26080;&#27861;&#21305;&#37197;<span class="org-string">"ba"</span>&#65292;&#22240;&#20026;&#35780;&#20272;&#20102;&#24038;&#36793;&#23601;&#19981;&#20250;&#35780;&#20272;&#21491;&#36793;&#12290;
<span class="org-function-name">&#20363;&#22914;</span>([ac])e\1|b([xyz])\2t&#30340;&#24038;&#36793;&#33021;&#21305;&#37197;aea&#25110;cec&#65292;&#20294;&#19981;&#33021;&#21305;&#37197;cea&#25110;aec&#65292;&#21491;&#36793;&#33021;&#21305;&#37197;bxxt&#25110;byyt&#25110;bzzt&#12290;&#20294;&#22914;&#26524;&#23558;\2&#25442;&#25104;\1&#65292;&#21363;([ac])e\1|b([xyz])\1t&#65292;&#23558;&#26080;&#27861;&#21305;&#37197;b[xyz]at&#25110;b[xyz]ct&#65292;&#22240;&#20026;&#31532;&#19968;&#20010;&#20998;&#32452;&#25324;&#21495;&#22312;&#24038;&#36793;&#65292;&#26080;&#27861;&#21442;&#19982;&#21491;&#36793;&#30340;&#27491;&#21017;&#35780;&#20272;&#12290;
</pre>
</div>

<p>
范例：排除空行和#开头的行
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#grep -v <span class="org-string">'^#'</span> /etc/httpd/conf/httpd.conf |grep -v ^$
[root@centos6 ~]#grep -v <span class="org-string">'^#\|^$'</span> /etc/httpd/conf/httpd.conf
[root@centos6 ~]#grep -v <span class="org-string">'^\(#\|$\)'</span> /etc/httpd/conf/httpd.conf
[root@centos6 ~]#grep <span class="org-string">"^[^#]"</span> /etc/httpd/conf/httpd.conf
</pre>
</div>

<p>
正则表达式练习
</p>
<ul class="org-ul">
<li>显示/proc/meminfo文件中以大小s开头的行(要求：使用两种方法)</li>
<li>显示/etc/passwd文件中不以/bin/bash结尾的行</li>
<li>显示用户rpc默认的shell程序 4、找出/etc/passwd中的两位或三位数</li>
<li>显示CentOS7的/etc/grub2.cfg文件中，至少以一个空白字符开头的且后面有非空白字符的行</li>
<li>找出“netstat -tan”命令结果中以LISTEN后跟任意多个空白字符结尾的行</li>
<li>显示CentOS7上所有UID小于1000以内的用户名和UID</li>
<li>添加用户bash、testbash、basher、sh、nologin(其shell为/sbin/nologin),找出/etc/passwd用户名和shell同名的行</li>
<li>利用df和grep，取出磁盘各分区利用率，并从大到小排序</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">1&#12289;&#26174;&#31034;/etc/passwd&#25991;&#20214;&#20013;&#19981;&#20197;/bin/bash&#32467;&#23614;&#30340;&#34892;&#65307; ~]# grep -v <span class="org-string">"/bin/bash$"</span>
/etc/passwd

2&#12289;&#25214;&#20986;/etc/passwd&#25991;&#20214;&#20013;&#30340;&#20004;&#20301;&#25968;&#25110;&#19977;&#20301;&#25968;&#65307; ~]# grep <span class="org-string">"&lt;[[:digit:]]{2,3}&gt;"</span>
/etc/passwd &#25110; grep <span class="org-string">'^&lt;[0-9]{2,3}&gt;'</span> /etc/passwd

3&#12289;&#25214;&#20986;/etc/rc.d/rc.sysinit&#25110;/etc/grub2.cfg&#25991;&#20214;&#20013;&#65292;&#20197;&#33267;&#23569;&#19968;&#20010;&#31354;&#30333;&#23383;&#31526;&#24320;&#22836;&#65292;&#19988;&#21518;&#38754;&#38750;&#31354;&#30333;&#23383;&#31526;&#30340;&#34892;&#65307;
~]# grep <span class="org-string">"[fn:1]+[[fn:2]]"</span> /etc/grub2.cfg

4&#12289;&#25214;&#20986;&#8221;netstat
-tan&#8221;&#21629;&#20196;&#30340;&#32467;&#26524;&#20013;&#20197;&#8221;LISTEN&#8221;&#21518;&#36319;0&#12289;1&#25110;&#22810;&#20010;&#31354;&#30333;&#23383;&#31526;&#32467;&#23614;&#30340;&#34892;&#65307; ~]# netstat
-tan | grep &#8220;LISTEN[[:space:]]*$&#8221;

&#36807;&#28388;&#31354;&#34892;&#21644;&#24320;&#22987;&#20026;#&#24320;&#22987;&#30340;&#34892; grep -Ev <span class="org-string">'^{#|}$'</span> /etc/fstab

&#21482;&#22312;&#30446;&#24405;&#20013;&#25152;&#26377;&#30340;.php&#21644;.html&#25991;&#20214;&#20013;&#36882;&#24402;&#25628;&#32034;&#23383;&#31526;&#8221;main()&#8221;

- grep <span class="org-string">"main()"</span> . -r --include *.{php,html}

&#21482;&#22312;&#30446;&#24405;&#20013;&#25152;&#26377;&#30340;.php&#21644;.html&#25991;&#20214;&#20013;&#36882;&#24402;&#25628;&#32034;&#23383;&#31526;&#8221;main()&#8221;

- grep <span class="org-string">"main()"</span> . -r --include *.{php,html}

&#22312;&#25628;&#32034;&#32467;&#26524;&#20013;&#25490;&#38500;filelist&#25991;&#20214;&#21015;&#34920;&#37324;&#30340;&#25991;&#20214;

- grep <span class="org-string">"main()"</span> . -r --exclude-from filelist

&#25628;&#32034;&#22810;&#20010;&#25991;&#20214;&#24182;&#26597;&#25214;&#21305;&#37197;&#25991;&#26412;&#22312;&#21738;&#20123;&#25991;&#20214;&#20013;

- grep -l <span class="org-string">"root"</span> /etc/fstab /etc/passwd

&#25628;&#32034;&#24320;&#22836;&#19981;&#26159;&#33521;&#25991;&#23383;&#27597;&#30340;&#34892;,&#24182;&#26174;&#31034;&#34892;&#21495;

- grep -n <span class="org-string">'[fn:3]'</span> /etc/fstab

&#26597;&#25214;default&#21644;dev&#20004;&#20010;&#20851;&#38190;&#23383;

- grep -e <span class="org-string">"defaulkt"</span> -e <span class="org-string">"dev"</span> /etc/fstab

&#26597;&#25214;/etc&#30446;&#24405;&#19979;&#65292;&#25152;&#26377;&#21253;&#21547;root&#20851;&#38190;&#23383;&#30340;&#25991;&#20214;&#24182;&#26174;&#31034;&#25991;&#20214;&#36335;&#24452;&#21450;&#25991;&#20214;&#21517;

- grep -lr <span class="org-string">"root"</span> /etc/ | xargs ls -l

&#30417;&#25511;&#26085;&#24535;&#25991;&#26723;&#20013;&#20135;&#29983;Error&#30340;&#34892;&#65292;&#24182;&#21482;&#25171;&#21360;&#21253;&#21547;Error&#30340;&#34892;

- tail -f /var/www/logs/error.log | grep --line-buffered <span class="org-string">"Error"</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:079dc060-e0ec-45e9-9766-18ab08eee9b8" class="outline-3">
<h3 id="h:079dc060-e0ec-45e9-9766-18ab08eee9b8"><a href="#h:079dc060-e0ec-45e9-9766-18ab08eee9b8">基本正则表达式与扩展正则表达式</a></h3>
<div class="outline-text-3" id="text-h:079dc060-e0ec-45e9-9766-18ab08eee9b8">
<p>
在GNU <code>grep</code> 中，基本正则表达式和扩展正则表达式只是同一模式匹配功能的
不同符号。在其他实现中，基本正则表达式通常不如扩展的强大，但有时情况正
则相反。以下说明适用于扩展正则表达式;下面总结了基本正则表达式的差异。
</p>

<p>
<a href="https://www.gnu.org/software/grep/manual/grep.html#Basic-vs-Extended-Regular-Expressions">https://www.gnu.org/software/grep/manual/grep.html#Basic-vs-Extended-Regular-Expressions</a>
</p>

<ul class="org-ul">
<li><code>'?', '+', '{', '|', '(', and ')</code> 基本正则前面要加 <code>\</code></li>
</ul>
</div>
<div id="outline-container-h:01367717-c17f-4a72-99fe-8b6426d4fe2d" class="outline-4">
<h4 id="h:01367717-c17f-4a72-99fe-8b6426d4fe2d"><a href="#h:01367717-c17f-4a72-99fe-8b6426d4fe2d">字符匹配元字符</a></h4>
<div class="outline-text-4" id="text-h:01367717-c17f-4a72-99fe-8b6426d4fe2d">
<p>
基本正则
</p>

<div class="org-src-container">
<pre class="src src-sh">[]  &#21305;&#37197;&#25351;&#23450;&#33539;&#22260;&#20869;&#30340;&#20219;&#24847;&#21333;&#20010;&#23383;&#31526;&#65292;&#31034;&#20363;&#65306;[wang]  [0-9]  [a-z]  [a-zA-Z]  [.]&#28857;&#25918;&#22312;&#20013;&#25324;&#21495;&#20869;&#34920;&#31034;.&#28857;&#65292;&#22806;&#38754;&#21017;&#26159;&#20195;&#34920;&#20219;&#24847;&#19968;&#20010;&#23383;&#31526;
[^] &#21305;&#37197;&#25351;&#23450;&#33539;&#22260;&#22806;&#30340;&#20219;&#24847;&#21333;&#20010;&#23383;&#31526;,&#31034;&#20363;&#65306;[^wang]

&#21305;&#37197;&#25351;&#23450;&#33539;&#22260;&#26377;&#20197;&#19979;&#20960;&#31181;&#65306;
[a-z] : &#21305;&#37197;a&#21040;z&#38388;&#20219;&#24847;&#19968;&#20010;&#23383;&#31526;&#65292;
[A-Z] : &#21305;&#37197;A&#21040;Z&#38388;&#20219;&#24847;&#19968;&#20010;&#23383;&#31526;&#65292;
[0-9] : &#21305;&#37197;0&#21040;9&#20043;&#38388;&#20219;&#24847;&#19968;&#20010;&#25968;&#23383;
[a-zA-Z0-9] : &#21305;&#37197;aA&#21040;zZ&#12289;0&#21040;9&#20043;&#38388;&#20219;&#24847;&#19968;&#20010;&#65292;&#12290;&#22914;[abcxyz]&#34920;&#31034;&#20174;abcxyz&#20013;&#21305;&#37197;&#20219;&#24847;&#19968;&#20010;&#23383;&#31526;
[[:upper:]] :&#25152;&#26377;&#22823;&#20889;&#23383;&#27597;(&#38463;&#22369;&#20799;&#39069;) [A-Z]
[[:lower:]] : &#25152;&#26377;&#23567;&#20889;&#23383;&#27597;(&#36335;&#25105;&#39069;) [a-z]
[[:alpha:]] : &#25152;&#26377;&#23383;&#27597;(&#38463;&#39069;&#20799;&#21457;)  [a-zA-Z]
[[:digit:]] : &#21313;&#36827;&#21046;&#25968;&#23383; [0-9]
[[:alnum:]] : &#25152;&#26377;&#23383;&#27597;&#21644;&#25968;&#23383;(&#22467;&#22885;number)  [0-9a-zA-Z]
[[:space:]] : &#25152;&#26377;&#31354;&#30333;&#23383;&#31526;(&#26032;&#34892;&#65292;&#31354;&#26684;&#65292;&#21046;&#34920;&#31526; )
[[:punct:]] : &#25152;&#26377;&#26631;&#28857;&#31526;&#21495;(&#24597;&#21487;&#29305;)&#65292;<span class="org-string">'! " # $ % &amp; '</span> ( ) * + , - . / : ; &lt; = &gt; ? @ [ <span class="org-string">\ </span>] ^ _ <span class="org-string">' { | } ~'</span>
[[:xdigit:]] :  &#20219;&#20309;16&#36827;&#21046;&#30340;&#25968;&#23383;&#65292;&#30456;&#24403;&#20110;[0-9a-fA-F]

[[:cntrl:]] :  &#20195;&#34920;&#38190;&#30424;&#19978;&#30340;&#25511;&#21046;&#38190;&#65292;&#21253;&#25324; CR, LF, TAB, Del ..&#31561;
[[:graph:]] : &#38750;&#31354;&#23383;&#31526;&#12290;&#38500;&#20102;&#31354;&#30333;&#38190;&#21644; Tab&#38190;&#22806;&#30340;&#20854;&#20182;&#25152;&#26377;&#25353;&#38190;&#65292;&#30456;&#24403;&#20110;<span class="org-string">'[:alnum:]'</span> +<span class="org-string">'[:punct:]'</span>.
[[:print:]] : &#38750;&#31354;&#23383;&#31526;&#65288;&#21253;&#25324;&#31354;&#26684;&#65289;&#12290;&#20195;&#34920;&#20219;&#20309;&#21487;&#34987;&#25171;&#21360;&#23383;&#31526;&#65292;&#30456;&#24403;&#20110;  <span class="org-string">'[:alnum:]'</span>, <span class="org-string">'[:punct:]'</span>, &#21644;space.
[[:ascii:]] :
[[:blank:]] :   &#20195;&#34920;&#31354;&#30333;&#38190;&#19982;TAB&#38190;&#20004;&#32773;
[[:word:]] :

[_[:alnum:]] : &#34920;&#31034;&#38500;&#20102; alnum &#36824;&#22810;&#20102;&#19968;&#20010;&#23383;&#31526; _ &#19979;&#21010;&#32447;
</pre>
</div>

<p>
扩展正则
</p>

<div class="org-src-container">
<pre class="src src-sh">. &#20219;&#24847;&#21333;&#20010;&#23383;&#31526;
[wang] &#25351;&#23450;&#33539;&#22260;&#30340;&#23383;&#31526;
[^wang] &#19981;&#22312;&#25351;&#23450;&#33539;&#22260;&#30340;&#23383;&#31526;
[:alnum:] &#23383;&#27597;&#21644;&#25968;&#23383;
[:alpha:] &#20195;&#34920;&#20219;&#20309;&#33521;&#25991;&#22823;&#23567;&#20889;&#23383;&#31526;&#65292;&#20134;&#21363; A-Z, a-z
[:lower:] &#23567;&#20889;&#23383;&#27597;,&#31034;&#20363;:[[:lower:]],&#30456;&#24403;&#20110;[a-z]
[:upper:] &#22823;&#20889;&#23383;&#27597;
[:blank:] &#31354;&#30333;&#23383;&#31526;&#65288;&#31354;&#26684;&#21644;&#21046;&#34920;&#31526;&#65289;
[:space:] &#27700;&#24179;&#21644;&#22402;&#30452;&#30340;&#31354;&#30333;&#23383;&#31526;&#65288;&#27604;[:blank:]&#21253;&#21547;&#30340;&#33539;&#22260;&#24191;&#65289;
[:cntrl:] &#19981;&#21487;&#25171;&#21360;&#30340;&#25511;&#21046;&#23383;&#31526;&#65288;&#36864;&#26684;&#12289;&#21024;&#38500;&#12289;&#35686;&#38083;...&#65289;
[:digit:] &#21313;&#36827;&#21046;&#25968;&#23383;
[:xdigit:]&#21313;&#20845;&#36827;&#21046;&#25968;&#23383;
[:graph:] &#21487;&#25171;&#21360;&#30340;&#38750;&#31354;&#30333;&#23383;&#31526;
[:print:] &#21487;&#25171;&#21360;&#23383;&#31526;
[:punct:] &#26631;&#28857;&#31526;&#21495;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:854abb7a-70e0-4f7b-8ff3-11a8d100410f" class="outline-4">
<h4 id="h:854abb7a-70e0-4f7b-8ff3-11a8d100410f"><a href="#h:854abb7a-70e0-4f7b-8ff3-11a8d100410f">次数匹配</a></h4>
<div class="outline-text-4" id="text-h:854abb7a-70e0-4f7b-8ff3-11a8d100410f">
<p>
用在要指定次数的字符后面，用于指定前面的字符要出现的次数
</p>

<p>
基本正则
</p>

<div class="org-src-container">
<pre class="src src-sh">* &#21305;&#37197;&#21069;&#38754;&#30340;&#23383;&#31526;&#20219;&#24847;&#27425;&#65292;&#21253;&#25324;0&#27425;&#65292;&#36138;&#23146;&#27169;&#24335;&#65306;&#23613;&#21487;&#33021;&#38271;&#30340;&#21305;&#37197;
.* &#20219;&#24847;&#38271;&#24230;&#30340;&#20219;&#24847;&#23383;&#31526;
<span class="org-string">\?</span> &#21305;&#37197;&#20854;&#21069;&#38754;&#30340;&#23383;&#31526;0&#25110;1&#27425;,&#21363;:&#21487;&#26377;&#21487;&#26080;
<span class="org-string">\+</span> &#21305;&#37197;&#20854;&#21069;&#38754;&#30340;&#23383;&#31526;&#33267;&#23569;1&#27425;,&#21363;:&#32943;&#23450;&#26377;&#65292;&gt;=1
<span class="org-string">\{</span>n<span class="org-string">\}</span> &#21305;&#37197;&#21069;&#38754;&#30340;&#23383;&#31526;n&#27425;
<span class="org-string">\{</span>m,n<span class="org-string">\}</span> &#21305;&#37197;&#21069;&#38754;&#30340;&#23383;&#31526;&#33267;&#23569;m&#27425;&#65292;&#33267;&#22810;n&#27425;
<span class="org-string">\{</span>,n<span class="org-string">\}</span> &#21305;&#37197;&#21069;&#38754;&#30340;&#23383;&#31526;&#33267;&#22810;n&#27425;,&lt;=n
<span class="org-string">\{</span>n,<span class="org-string">\}</span> &#21305;&#37197;&#21069;&#38754;&#30340;&#23383;&#31526;&#33267;&#23569;n&#27425;
</pre>
</div>

<p>
扩展正则
</p>

<div class="org-src-container">
<pre class="src src-sh">*  &#21305;&#37197;&#21069;&#38754;&#23383;&#31526;&#20219;&#24847;&#27425;
? 0&#25110;1&#27425;
+ 1&#27425;&#25110;&#22810;&#27425;
{n} &#21305;&#37197;n&#27425;
{m,n} &#33267;&#23569;m&#65292;&#33267;&#22810;n&#27425;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6ec6141c-09a7-45ef-b286-8dc703db406b" class="outline-4">
<h4 id="h:6ec6141c-09a7-45ef-b286-8dc703db406b"><a href="#h:6ec6141c-09a7-45ef-b286-8dc703db406b">位置锚定</a></h4>
<div class="outline-text-4" id="text-h:6ec6141c-09a7-45ef-b286-8dc703db406b">
<p>
位置锚定可以用于定位出现的位置
</p>

<p>
基本正则
</p>

<div class="org-src-container">
<pre class="src src-sh">a) &#22312;&#34892;&#30340;&#20301;&#32622;&#38170;&#23450;
^ : &#33073;&#23383;&#31526;&#65292;&#34892;&#39318;&#38170;&#23450;&#65307;&#29992;&#20110;&#27169;&#24335;&#30340;&#26368;&#24038;&#20391;&#65307;&#22914;&#65292;&#21305;&#37197;&#34892;&#39318;&#20986;&#29616;root&#65292;grep <span class="org-string">'^root'</span>
$ : &#34892;&#23614;&#38170;&#23450;&#65307;&#29992;&#20110;&#27169;&#24335;&#30340;&#26368;&#21491;&#20391;&#65307;&#22914;&#65292;&#21305;&#37197;&#34892;&#23614;&#20986;&#29616;root&#65292;grep <span class="org-string">'$root'</span>
^PATTERN$&#65306;&#29992;&#27169;&#24335;PATTERN&#26469;&#21305;&#37197;&#25972;&#34892;&#65307;&#22914;&#65292;&#21305;&#37197;&#25972;&#34892;&#21482;&#26377;root&#65292;grep <span class="org-string">'^root$'</span>
    ^$ : &#31354;&#30333;&#34892;&#65307;
    ^[[:space:]]*$ : &#31354;&#34892;&#25110;&#21253;&#21547;&#31354;&#30333;&#23383;&#31526;&#30340;&#34892;&#65307;


b) &#22312;&#21333;&#35789;&#30340;&#20301;&#32622;&#38170;&#23450;
<span class="org-string">\&lt;</span> &#25110; \b : &#35789;&#39318;&#38170;&#23450;&#65292;&#29992;&#20110;&#21333;&#35789;&#27169;&#24335;&#30340;&#24038;&#20391;&#65307;&#22914;&#65292;grep <span class="org-string">"\&lt;word"</span>
<span class="org-string">\&gt;</span> &#25110; \b : &#35789;&#23614;&#38170;&#23450;&#65292;&#29992;&#20110;&#21333;&#35789;&#27169;&#24335;&#30340;&#21491;&#20391;&#65307;&#22914;&#65292;grep <span class="org-string">"word\&gt;"</span>
<span class="org-string">\&lt;</span>PATTERN<span class="org-string">\&gt;</span> : &#21305;&#37197;&#23436;&#25972;&#21333;&#35789;&#65307;&#31934;&#30830;&#38170;&#23450;&#21333;&#35789;&#65307;&#22914;&#65292;grep <span class="org-string">"\&lt;word\&gt;</span>
</pre>
</div>

<p>
扩展正则
</p>

<div class="org-src-container">
<pre class="src src-sh">^ &#34892;&#39318;
$ &#34892;&#23614;
<span class="org-string">\&lt;</span>, \b &#35821;&#39318;
<span class="org-string">\&gt;</span>, \b &#35821;&#23614;
</pre>
</div>

<p>
范例：排除掉空行和#开头的行
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#grep -v <span class="org-string">'^$'</span> /etc/profile|grep -v <span class="org-string">'^#'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ef494e68-e31c-43e3-98e7-e717d6da66bd" class="outline-4">
<h4 id="h:ef494e68-e31c-43e3-98e7-e717d6da66bd"><a href="#h:ef494e68-e31c-43e3-98e7-e717d6da66bd">分组其它</a></h4>
<div class="outline-text-4" id="text-h:ef494e68-e31c-43e3-98e7-e717d6da66bd">
<p>
分组： <code>()</code> 将多个字符捆绑在一起，当作一个整体处理，如： <code>(root)+</code>
</p>


<p>
后向引用：分组括号中的模式匹配到的内容会被正则表达式引擎记录于内部的变
量中，这些变量的命名方式为: <code>\1, \2, \3, ...</code>
</p>

<p>
\1 表示从左侧起第一个左括号以及与之匹配右括号之间的模式所匹配到的字符
</p>

<p>
注意： 后向引用引用前面的分组括号中的模式所匹配字符，而非模式本身
</p>

<p>
基本正则
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-string">\(</span>string1<span class="org-string">\(</span>string2<span class="org-string">\)\)</span>
\1 &#65306;string1<span class="org-string">\(</span>string2<span class="org-string">\)</span>
\2 &#65306;string2


a<span class="org-string">\|</span>b <span class="org-comment-delimiter">#</span><span class="org-comment">a&#25110;b
</span>C<span class="org-string">\|</span>cat <span class="org-comment-delimiter">#</span><span class="org-comment">C&#25110;cat
</span><span class="org-string">\(</span>C<span class="org-string">\|</span>c<span class="org-string">\)</span>at <span class="org-comment-delimiter">#</span><span class="org-comment">Cat&#25110;cat</span>
</pre>
</div>

<p>
扩展正则
</p>

<div class="org-src-container">
<pre class="src src-sh">() &#20998;&#32452;
&#21518;&#21521;&#24341;&#29992;&#65306;\1, \2, ...
| &#25110;&#32773;
a|b <span class="org-comment-delimiter">#</span><span class="org-comment">a&#25110;b
</span>C|cat <span class="org-comment-delimiter">#</span><span class="org-comment">C&#25110;cat
</span>(C|c)at <span class="org-comment-delimiter">#</span><span class="org-comment">Cat&#25110;cat</span>
</pre>
</div>

<p>
vim 扩展模式
</p>

<div class="org-src-container">
<pre class="src src-sh">&#23558;rxxt&#21518;&#21152;&#19978;er  :%s#<span class="org-string">\(</span>r..t<span class="org-string">\)</span>#\1er#g
&#20445;&#30041;&#25991;&#20214;&#38750;#&#21495;&#24320;&#22836;&#30340;&#20854;&#23427;&#23383;&#31526;&#65306;
:%s/^#<span class="org-string">\(</span>.*<span class="org-string">\)</span>/\1/g
&#25110;
:%s/^#//g
</pre>
</div>

<p>
扩展正则表达式练习
</p>
<ul class="org-ul">
<li>显示三个用户root,cici,wang的UID和默认shell</li>
<li>找出/etc/rc.d/init.d/functions文件中行首为某单词(包括下划线)后面跟一个小括号的行</li>
<li>使用egrep取出/etc/rc.d/init.d/functions中其基名</li>
<li>使用egrep取出上面路径的目录名</li>
<li>统计last命令中以root登录的每个主机IP地址登录次数</li>
<li>利用扩展正则表达式分别表示0-9、10-99、100-199、200-249、250-255</li>
<li>显示ifconfig命令结果中所有IPv4地址</li>
<li>将此字符串：welcome to me linux 中的每个字符去重并排序，重复次数多的
排到前面</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">1&#12289;&#25214;&#20986;/proc/meminfo&#25991;&#20214;&#20013;&#65292;&#25152;&#26377;&#20197;&#22823;&#20889;&#25110;&#23567;&#20889;S&#24320;&#22836;&#30340;&#34892;&#65307;&#33267;&#23569;&#26377;&#19977;&#31181;&#23454;&#29616;&#26041;&#24335;&#65307;
grep <span class="org-string">"^[sS]"</span> /proc/meminfo
grep -i <span class="org-string">"^s"</span> /proc/meminfo
grep -E <span class="org-string">"^(s|S)"</span> /proc/meminfo
grep -E <span class="org-string">"^s|^S"</span> /proc/meminfo

2&#12289;&#26174;&#31034;&#24403;&#21069;&#31995;&#32479;&#19978;root&#12289;centos&#25110;&#32773;user1&#29992;&#25143;&#30340;&#30456;&#20851;&#20449;&#24687;&#65307;
~]# grep -E <span class="org-string">"^(root|centos|user1\&gt;)"</span> /etc/passwd

3&#12289;&#25214;&#20986;/etc/rc.d/init.d/functions&#25991;&#20214;&#20013;&#26576;&#21333;&#35789;&#21518;&#36319;&#19968;&#20010;&#23567;&#25324;&#21495;&#30340;&#34892;&#65307;
~]# grep -Eo <span class="org-string">'[_[:alnum:]]+\(\)'</span> /etc/rc.d/init.d/functions
[_[:alnum:]] : &#34920;&#31034;&#38500;&#20102; alnum &#36824;&#22810;&#20102;&#19968;&#20010;&#23383;&#31526; _ &#19979;&#21010;&#32447;

[root@node01 ~]# grep -Eo  <span class="org-string">"[_[:alnum:]]+\(\)"</span> /etc/init.d/functions
<span class="org-function-name">checkpid</span>()
<span class="org-function-name">__pids_pidof</span>()
<span class="org-function-name">is_false</span>()
<span class="org-function-name">apply_sysctl</span>()
... ...


4&#12289;&#20351;&#29992;echo&#21629;&#20196;&#36755;&#20986;&#19968;&#32477;&#23545;&#36335;&#24452;&#65292;&#20351;&#29992;egrep&#21462;&#20986;&#22522;&#21517;&#65307;
<span class="org-builtin">echo</span> <span class="org-string">"/root/ssf/erou/dfjl"</span> | egrep -o <span class="org-string">"\&lt;[[:alpha:]]*\&gt;$"</span>
<span class="org-builtin">echo</span> <span class="org-string">"/root/ssf/erou/dfjl"</span> | grep -Eo <span class="org-string">"[^/]+/?$"</span>   <span class="org-comment-delimiter"># </span><span class="org-comment">&#38170;&#23450;&#34892;&#23614;&#30340;&#38750;&#26012;&#32447;&#23383;&#31526;&#65292;&#34892;&#23614; / &#21487;&#26377;&#21487;&#26080;
</span>
5&#12289;&#25214;&#20986;ifconfig&#21629;&#20196;&#32467;&#26524;&#20013;&#30340;1-255&#20043;&#38388;&#30340;&#25968;&#20540;&#65307;
ifconfig | grep -oE <span class="org-string">"\&lt;([1-9] | [1-9][0-9] | 1[0-9]{2} | 2[0-4][0-9] | 25[0-5])\&gt;"</span>

6&#12289;&#35838;&#22806;&#20316;&#19994;&#65306;&#25214;&#20986;ifconfig&#21629;&#20196;&#32467;&#26524;&#20013;&#30340;IP&#22320;&#22336;&#65307;
[root@node01 ~]# ip -o -4 addr list ens33 | perl -n -e <span class="org-string">'if (m{inet\s([\d\.]+)\/\d+\s}xms) { print $1 }'</span>
172.16.100.6


[root@node01 ~]# ifconfig  | grep -o <span class="org-string">'\([0-9]\{1,3\}\.\)\{3\}[0-9]\{1,3\}'</span>
172.17.0.1
255.255.0.0
0.0.0.0
172.16.100.6
255.255.0.0
172.16.255.255
127.0.0.1
255.0.0.0
[root@node01 ~]# ifconfig | grep -o <span class="org-string">'\b[0-9]\{1,3\}\b\.\b[0-9]\{1,3\}\b\.\b[0-9]\{1,3\}\b\.\b[0-9]\{1,3\}\b'</span>
172.17.0.1
255.255.0.0
0.0.0.0
172.16.100.6
255.255.0.0
172.16.255.255
127.0.0.1
255.0.0.0
[root@node01 ~]# ifconfig  | grep -Po <span class="org-string">'(?&lt;=inet)(.*)(?=net)'</span>
172.17.0.1
172.16.100.6
127.0.0.1

7&#12289;&#28155;&#21152;&#29992;&#25143;bash, testbash, basher&#20197;&#21450;nologin(&#20854;shell&#20026;/sbin/nologin)&#65307;&#32780;&#21518;&#25214;&#20986;/etc/passwd&#25991;&#20214;&#20013;&#29992;&#25143;&#21517;&#21516;shell&#21517;&#30340;&#34892;&#65307;
~]# grep  -E  <span class="org-string">"^([^:]+\&gt;).*\1$"</span>  /etc/passwd
</pre>
</div>

<p>
<b>20个正则表达式</b>
</p>

<p>
正则表达式经常被用于字段或任意字符串的校验，如下面这段校验基本日期格式
的JavaScript代码：
</p>

<div class="org-src-container">
<pre class="src src-sh">var <span class="org-variable-name">reg</span> = /^(<span class="org-string">\\</span>d{1,4})(-|<span class="org-string">\\</span>/)(<span class="org-string">\\</span>d{1,2})<span class="org-string">\\</span>2(<span class="org-string">\\</span>d{1,2})$/;
var <span class="org-variable-name">r</span> = fieldValue.match(reg);
<span class="org-keyword">if</span>(<span class="org-variable-name">r</span>==null)alert(<span class="org-string">'Date format error!'</span>);
</pre>
</div>

<p>
下面是技匠整理的，在前端开发中经常使用到的20个正则表达式。
</p>

<div class="org-src-container">
<pre class="src src-sh">1 . &#26657;&#39564;&#23494;&#30721;&#24378;&#24230;
&#23494;&#30721;&#30340;&#24378;&#24230;&#24517;&#39035;&#26159;&#21253;&#21547;&#22823;&#23567;&#20889;&#23383;&#27597;&#21644;&#25968;&#23383;&#30340;&#32452;&#21512;&#65292;&#19981;&#33021;&#20351;&#29992;&#29305;&#27530;&#23383;&#31526;&#65292;&#38271;&#24230;&#22312;8-10&#20043;&#38388;&#12290;
^(?=.*<span class="org-string">\\</span>d)(?=.*[a-z])(?=.*[A-Z]).{8,10}$

2. &#26657;&#39564;&#20013;&#25991;
&#23383;&#31526;&#20018;&#20165;&#33021;&#26159;&#20013;&#25991;&#12290;
^[<span class="org-string">\\</span>u4e00-<span class="org-string">\\</span>u9fa5]{0,}$

3. &#30001;&#25968;&#23383;&#12289;26&#20010;&#33521;&#25991;&#23383;&#27597;&#25110;&#19979;&#21010;&#32447;&#32452;&#25104;&#30340;&#23383;&#31526;&#20018;
^<span class="org-string">\\</span>w+$
4. &#26657;&#39564;E-Mail &#22320;&#22336;
&#21516;&#23494;&#30721;&#19968;&#26679;&#65292;&#19979;&#38754;&#26159;E-mail&#22320;&#22336;&#21512;&#35268;&#24615;&#30340;&#27491;&#21017;&#26816;&#26597;&#35821;&#21477;&#12290;
[<span class="org-string">\\</span>w!#$%&amp;<span class="org-string">'*+/=?^_`{|}~-]+(?:\\.[\\w!#$%&amp;'</span>*+/=?^_<span class="org-sh-quoted-exec">`{|}~-]+)*@(?:[\\w](?:[\\w-]*[\\w])?\\.)+[\\w](?:[\\w-]*[\\w])?

5. &#26657;&#39564;&#36523;&#20221;&#35777;&#21495;&#30721;
&#19979;&#38754;&#26159;&#36523;&#20221;&#35777;&#21495;&#30721;&#30340;&#27491;&#21017;&#26657;&#39564;&#12290;15 &#25110; 18&#20301;&#12290;
15&#20301;&#65306;
^[1-9]\\d{7}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])\\d{3}$
18&#20301;&#65306;
^[1-9]\\d{5}[1-9]\\d{3}((0\\d)|(1[0-2]))(([0|1|2]\\d)|3[0-1])\\d{3}([0-9]|X)$

6. &#26657;&#39564;&#26085;&#26399;
&#8220;yyyy-mm-dd&#8220; &#26684;&#24335;&#30340;&#26085;&#26399;&#26657;&#39564;&#65292;&#24050;&#32771;&#34385;&#24179;&#38384;&#24180;&#12290;
^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$

7. &#26657;&#39564;&#37329;&#39069;
&#37329;&#39069;&#26657;&#39564;&#65292;&#31934;&#30830;&#21040;2&#20301;&#23567;&#25968;&#12290;
^[0-9]+(.[0-9]{2})?$

8. &#26657;&#39564;&#25163;&#26426;&#21495;
&#19979;&#38754;&#26159;&#22269;&#20869; 13&#12289;15&#12289;18&#24320;&#22836;&#30340;&#25163;&#26426;&#21495;&#27491;&#21017;&#34920;&#36798;&#24335;&#12290;&#65288;&#21487;&#26681;&#25454;&#30446;&#21069;&#22269;&#20869;&#25910;&#38598;&#21495;&#25193;&#23637;&#21069;&#20004;&#20301;&#24320;&#22836;&#21495;&#30721;&#65289;
^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\\d{8}$

9. &#21028;&#26029;IE&#30340;&#29256;&#26412;
IE&#30446;&#21069;&#36824;&#27809;&#34987;&#23436;&#20840;&#21462;&#20195;&#65292;&#24456;&#22810;&#39029;&#38754;&#36824;&#26159;&#38656;&#35201;&#20570;&#29256;&#26412;&#20860;&#23481;&#65292;&#19979;&#38754;&#26159;IE&#29256;&#26412;&#26816;&#26597;&#30340;&#34920;&#36798;&#24335;&#12290;
^.*MSIE [5-8](?:\\.[0-9]+)?(?!.*Trident\\/[5-9]\\.0).*$

10. &#26657;&#39564;IP-v4&#22320;&#22336;
IP4 &#27491;&#21017;&#35821;&#21477;&#12290;
\\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b

11. &#26657;&#39564;IP-v6&#22320;&#22336;
IP6 &#27491;&#21017;&#35821;&#21477;&#12290;
(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))

12. &#26816;&#26597;URL&#30340;&#21069;&#32512;
&#24212;&#29992;&#24320;&#21457;&#20013;&#24456;&#22810;&#26102;&#20505;&#38656;&#35201;&#21306;&#20998;&#35831;&#27714;&#26159;HTTPS&#36824;&#26159;HTTP&#65292;&#36890;&#36807;&#19979;&#38754;&#30340;&#34920;&#36798;&#24335;&#21487;&#20197;&#21462;&#20986;&#19968;&#20010;url&#30340;&#21069;&#32512;&#28982;&#21518;&#20877;&#36923;&#36753;&#21028;&#26029;&#12290;
if (!s.match(/^[a-zA-Z]+:\\/\\//))
{
    s = 'http://' + s;
}

13. &#25552;&#21462;URL&#38142;&#25509;
&#19979;&#38754;&#30340;&#36825;&#20010;&#34920;&#36798;&#24335;&#21487;&#20197;&#31579;&#36873;&#20986;&#19968;&#27573;&#25991;&#26412;&#20013;&#30340;URL&#12290;
^(f|ht){1}(tp|tps):\\/\\/([\\w-]+\\.)+[\\w-]+(\\/[\\w- ./?%&amp;=]*)?

14. &#25991;&#20214;&#36335;&#24452;&#21450;&#25193;&#23637;&#21517;&#26657;&#39564;
&#39564;&#35777;windows&#19979;&#25991;&#20214;&#36335;&#24452;&#21644;&#25193;&#23637;&#21517;&#65288;&#19979;&#38754;&#30340;&#20363;&#23376;&#20013;&#20026;.txt&#25991;&#20214;&#65289;
^([a-zA-Z]\\:|\\\\)\\\\([^\\\\]+\\\\)*[^\\/:*?"&lt;&gt;|]+\\.txt(l)?$

15. &#25552;&#21462;Color Hex Codes
&#26377;&#26102;&#38656;&#35201;&#25277;&#21462;&#32593;&#39029;&#20013;&#30340;&#39068;&#33394;&#20195;&#30721;&#65292;&#21487;&#20197;&#20351;&#29992;&#19979;&#38754;&#30340;&#34920;&#36798;&#24335;&#12290;
^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$

16. &#25552;&#21462;&#32593;&#39029;&#22270;&#29255;
&#20551;&#33509;&#20320;&#24819;&#25552;&#21462;&#32593;&#39029;&#20013;&#25152;&#26377;&#22270;&#29255;&#20449;&#24687;&#65292;&#21487;&#20197;&#21033;&#29992;&#19979;&#38754;&#30340;&#34920;&#36798;&#24335;&#12290;
\\&lt; *[img][^\\\\&gt;]*[src] *= *[\\"\\']{0,1}([^\\"\\'\\ &gt;]*)

17. &#25552;&#21462;&#39029;&#38754;&#36229;&#38142;&#25509;
&#25552;&#21462;html&#20013;&#30340;&#36229;&#38142;&#25509;&#12290;
(&lt;a\\s*(?!.*\\brel=)[^&gt;]*)(href="https?:\\/\\/)((?!(?:(?:www\\.)?'.implode('|(?:www\\.)?', $follow_list).'))[^"]+)"((?!.*\\brel=)[^&gt;]*)(?:[^&gt;]*)&gt;

18. &#26597;&#25214;CSS&#23646;&#24615;
&#36890;&#36807;&#19979;&#38754;&#30340;&#34920;&#36798;&#24335;&#65292;&#21487;&#20197;&#25628;&#32034;&#21040;&#30456;&#21305;&#37197;&#30340;CSS&#23646;&#24615;&#12290;
^\\s*[a-zA-Z\\-]+\\s*[:]{1}\\s[a-zA-Z0-9\\s.#]+[;]{1}

19. &#25277;&#21462;&#27880;&#37322;
&#22914;&#26524;&#20320;&#38656;&#35201;&#31227;&#38500;HMTL&#20013;&#30340;&#27880;&#37322;&#65292;&#21487;&#20197;&#20351;&#29992;&#22914;&#19979;&#30340;&#34920;&#36798;&#24335;&#12290;
&lt;!--(.*?)--&gt;

20. &#21305;&#37197;HTML&#26631;&#31614;
&#36890;&#36807;&#19979;&#38754;&#30340;&#34920;&#36798;&#24335;&#21487;&#20197;&#21305;&#37197;&#20986;HTML&#20013;&#30340;&#26631;&#31614;&#23646;&#24615;&#12290;
&lt;\\/?\\w+((\\s+\\w+(\\s*=\\s*(?:".*?"|'.*?'|[\\^'"&gt;\\s]+))?)+\\s*|\\s*)\\/?&gt;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:a719b9e4-1ff3-48fe-b315-97331284c06b" class="outline-3">
<h3 id="h:a719b9e4-1ff3-48fe-b315-97331284c06b"><a href="#h:a719b9e4-1ff3-48fe-b315-97331284c06b">Perl正则表达式超详细教程</a></h3>
<div class="outline-text-3" id="text-h:a719b9e4-1ff3-48fe-b315-97331284c06b">
<p>
关于基础正则表达式的内容请看上篇。
</p>

<p>
只介绍匹配操作，关于内容替换，因为和学习使用perl正则并无多大关系。
</p>

<p>
以下是perl正则的man文档：
</p>

<ul class="org-ul">
<li>perl正则快速入门：man perlrequick</li>
<li>perl正则教程：man perlretut</li>
<li>perl正则完整文档：man perlre</li>
</ul>
</div>
<div id="outline-container-h:5ad9bb01-d312-44bb-b782-d00186c02fae" class="outline-4">
<h4 id="h:5ad9bb01-d312-44bb-b782-d00186c02fae"><a href="#h:5ad9bb01-d312-44bb-b782-d00186c02fae">学perl正则必备的一点基本语法</a></h4>
<div class="outline-text-4" id="text-h:5ad9bb01-d312-44bb-b782-d00186c02fae">
<p>
新建一个文件作为perl脚本文件，在其首行写上 <code>#!/usr/bin/perl</code> ，它表示用
perl作为本文件的解释器。写入一些perl程序后，再赋予执行权限就可以执行了，
或者直接使用perl命令去调用这个脚本文件，前面的两个过程都可以省略，这和
shell脚本的方式是完全一样的，无非是将bash替换为了perl，想必各位都理解。
</p>

<p>
<b>1.print用来输出信息</b> ，相当于shell中的echo命令，但需要手动输入换行
符”\n“进行换行。
</p>

<p>
例如：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/</span><span class="org-keyword">perl</span><span class="org-comment">
</span>
<span class="org-builtin">print</span> <span class="org-string">"hello world\n"</span>;      <span class="org-comment-delimiter"># </span><span class="org-comment">&#27880;&#24847;&#27599;&#19968;&#21477;&#21518;&#38754;&#37117;&#20351;&#29992;&#20998;&#21495;&#32467;&#23614;</span>
</pre>
</div>

<p>
保存后，执行它(假设脚本文件名为test.pl)：
</p>

<div class="org-src-container">
<pre class="src src-sh">$ chmod +x test.pl
$ perl test.pl
</pre>
</div>

<p>
<b>2.变量赋值</b>
</p>

<p>
perl中的变量可以不用事先声明，可以直接赋值甚至直接引用。注意变量名前面
总是需要加上$符号，无论是赋值的时候还是引用的时候，这和其它语言不太一
样。
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/</span><span class="org-keyword">perl</span><span class="org-comment">
</span>
$<span class="org-variable-name">name</span>=<span class="org-string">"xiaoming"</span>;
$<span class="org-variable-name">age</span>=18;
<span class="org-builtin">print</span> <span class="org-string">"$name $age \n"</span>;
</pre>
</div>

<p>
<b>3.if语句用来判断</b> ，语法格式为：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">if</span>(condition){
    body
}<span class="org-keyword">else</span>{
    body
}
</pre>
</div>

<p>
例如：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">age</span> = 18;
<span class="org-keyword">if</span>($<span class="org-variable-name">age</span> &lt;= 20){
    <span class="org-builtin">print</span> <span class="org-string">"age less than 20\n"</span>;
} <span class="org-keyword">else</span> {
    <span class="org-builtin">print</span> <span class="org-string">"age greate than 20\n"</span>;
}
</pre>
</div>

<p>
<b>4.默认参数变量</b>
</p>

<p>
在perl中，对于需要参数的函数或表达式，但却没有给参数，这是将会使用perl
的默认参数变量 <code>$_</code> 。
</p>

<p>
例如，下面的print本来是需要参数的，但是因为没有给参数，print将输出默认
的参数变量 <code>$_</code> ，也就是输出”abcde”。
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">_</span>=<span class="org-string">"abcde"</span>;
<span class="org-builtin">print</span> ;
</pre>
</div>

<p>
perl中使用 <code>$_</code> 的地方非常多，后文还会出现，不过用到的时候我会解释。
</p>

<p>
<b>5.读取标准输入</b>
</p>

<p>
perl中使用一对尖括号格式的 <code>&lt;STDIN&gt;</code> 来读取来自非文件的标准输入，例如
来自管道的数据，来自输入重定向的数据或者来自键盘的输入。需要注意的是，
<code>&lt;STDIN&gt;</code> 读取的输入会自带换行符，所以print输出的时候不要加上额外的换
行符。
</p>

<p>
例如，在test.pl文件中写入如下内容：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/</span><span class="org-keyword">perl</span><span class="org-comment">
</span>
$<span class="org-variable-name">data</span>=&lt;STDIN&gt;;
<span class="org-builtin">print</span> <span class="org-string">"$data"</span>;
</pre>
</div>

<p>
然后用管道传递一行数据给perl程序：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">echo</span> <span class="org-string">"abcdefg"</span> | perl test.pl
</pre>
</div>

<p>
只是需要注意，将 <code>&lt;STDIN&gt;</code> 赋值给变量时，将只能读取一行(遇到换行符就结
束读取)。例如下面的perl将读取不了”hijklmn”。
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">echo</span> -e <span class="org-string">"abcdefg\nhijklmn"</span> | perl test.pl
</pre>
</div>

<p>
如果想要读取多行标准输入，就不能将其赋值给变量，而是使用foreach来遍历
各行(此处不介绍其它方式)：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">foreach</span> $<span class="org-variable-name">line</span> (&lt;STDIN&gt;){
    <span class="org-builtin">print</span> <span class="org-string">"$line"</span>;
}
</pre>
</div>

<p>
以上就是foreach的语法：
</p>

<ul class="org-ul">
<li>圆括号中的内容是待遍历对象，通常是一个列表，比如上面用 <code>&lt;STDIN&gt;</code> 读
取的多行数据就是一个列表，每一行都是列表中的一个元素；</li>
<li><code>$line</code> 称为控制变量，foreach在每次迭代过程中都会选中一个列表中的元
素赋值给 <code>$line</code> ，例如将读取的每一行都赋值给 <code>$line</code> 。</li>
</ul>

<p>
可以省略 <code>$line</code> ，这时就采用默认的参数变量 <code>$_</code> ，所以以下两个表达式
是等价的：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">foreach</span> (&lt;STDIN&gt;){
    <span class="org-builtin">print</span> <span class="org-string">"$_"</span>;
}

<span class="org-keyword">foreach</span> $<span class="org-variable-name">_</span> (&lt;STDIN&gt;){
    <span class="org-builtin">print</span> <span class="org-string">"$_"</span>;
}
</pre>
</div>

<p>
<b>6.读取文件中的数据</b>
</p>

<p>
正则强大的用处就是处理文本数据，所以必须要说明perl如何读取文件数据来做
正则匹配。
</p>

<p>
我们可以将文件作为perl命令行的参数，perl会使用 <code>&lt;&gt;</code> 去读取这些文件中的内
容。
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">foreach</span> (&lt;&gt;){
    <span class="org-builtin">print</span> <span class="org-string">"$_"</span>;
}
</pre>
</div>

<p>
执行的时候，只要把文件作为perl命令或脚本文件的参数即可：
</p>

<div class="org-src-container">
<pre class="src src-sh">perl test.pl /etc/passwd
</pre>
</div>

<p>
<b>7.去掉行尾分隔符</b>
</p>

<p>
由于 <code>&lt;&gt;</code> 和 <code>&lt;STDIN&gt;</code> 读取文件、读取标准输入的时候总是自带换行符，很
多时候这个自带的换行符都会带来格式问题。所以，有必要在每次读取数据时将
行尾的换行符去掉，使用chomp即可。
</p>

<p>
例如：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">foreach</span> $<span class="org-variable-name">line</span> (&lt;STDIN&gt;) {
    chomp $<span class="org-variable-name">line</span>;
    <span class="org-builtin">print</span> <span class="org-string">"$line read\n"</span>;
}
</pre>
</div>

<p>
以下是执行结果：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">echo -e "xiaoming xiaohong" | perl 26.plx
</span>xiaoming xiaohong read
</pre>
</div>

<p>
如果上面的例子中不加上chomp，那么执行结果将像下面一样：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">echo -e "xiaoming xiaohong" | perl 26.plx
</span>xiaoming xiaohong
 <span class="org-builtin">read</span>
</pre>
</div>

<p>
显然，输出格式和print语句中期待的输出格式不一样。
</p>

<p>
前面说过，可以省略 <code>$line</code> ，让其使用默认的参数变量 <code>$_</code> ，所以可以这
样读取来自perl命令行参数文件的数据：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">foreach</span> (&lt;&gt;) {
    chomp;
    <span class="org-builtin">print</span> <span class="org-string">"$_ read\n"</span>;
}
</pre>
</div>

<p>
<b>8.命令行的操作模式</b>
</p>

<p>
其实就是一行式。perl命令行加上”-e”选项，就能在perl命令行中直接写perl
表达式，例如：
</p>

<div class="org-src-container">
<pre class="src src-dart">echo "xiaohong" | perl -e '$name=&lt;STDIN&gt;;print $name;'
</pre>
</div>

<p>
因为perl最为人所知的就是它应用了各种符号的组合，让人看着怪异无比，而这
些符号放在命令行中很可能会被shell先解析，所以强烈建议”-e”后表达式使
用单引号包围，而不是双引号。
</p>

<p>
更建议，如果可以，不要使用perl命令行的方式，调试起来容易混乱。
</p>
</div>
</div>
<div id="outline-container-h:e15f23e9-af42-4a89-9548-e65acaccd7af" class="outline-4">
<h4 id="h:e15f23e9-af42-4a89-9548-e65acaccd7af"><a href="#h:e15f23e9-af42-4a89-9548-e65acaccd7af">perl如何使用正则进行匹配</a></h4>
<div class="outline-text-4" id="text-h:e15f23e9-af42-4a89-9548-e65acaccd7af">
<p>
使用 <code>=~</code> 符号表示要用右边的正则表达式对左边的数据进行匹配。正则表达式
的书写方式为 <code>m//</code> 。关于 <code>m//</code> ，其中斜线可以替换为其它符号，规则如下：
</p>

<ul class="org-ul">
<li>双斜线可以替换为任意其它对应符号，例如对称的括号类， <code>m()</code> ， <code>m{}</code>
，相同的标点类， <code>m!!</code> ， <code>m%%</code> 等等</li>
<li>只有当m模式采用双斜线的时候，可以省略m字母，即 <code>//</code> 等价于 <code>m//</code></li>
<li>如果正则表达式中出现了和分隔符相同的字符，可以转义表达式中的符号，但
更建议换分隔符，例如 <code>/http:\/\//</code> 转换成 <code>m%http://%</code></li>
</ul>

<p>
所以要匹配内容，有以下两种方式：
</p>

<ul class="org-ul">
<li>方式一：使用 <code>data =~ m/reg/</code> ，可以明确指定要对data对应的内容进行正
则匹配</li>
<li>方式二：直接 <code>/reg/</code> ，因为省略了参数，所以使用默认参数变量，它等价
于 <code>$_ =~ m/reg/</code> ，也就是对 <code>$_</code> 保存的内容进行正则匹配</li>
</ul>

<p>
perl中匹配操作默认返回的是匹配成功与否，成功则返回真，匹配不成功则返回
假。但是当使用了全局匹配修饰符 <code>g</code> ，则返回本次匹配成功的内容。此外，
perl提供了特殊变量允许访问匹配到的内容，甚至匹配内容之前的数据、匹配内
容之后的数据都提供了相关变量以便访问。见下面的示例。
</p>

<p>
例如：
</p>

<p>
<b>1.匹配给定字符串内容</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">name</span> = <span class="org-string">"hello gaoxiaofang"</span>;
<span class="org-keyword">if</span> ($<span class="org-variable-name">name</span> =~ m/gao/){
    <span class="org-builtin">print</span> <span class="org-string">"matched\n"</span>;
}
</pre>
</div>

<p>
或者，直接将字符串拿来匹配：
</p>

<div class="org-src-container">
<pre class="src src-ini">"hello gaoxiaofang" =~ m/gao/;
</pre>
</div>

<p>
<b>2.匹配来自管道的每一行内容，匹配成功的行则输出</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">foreach</span> (&lt;STDIN&gt;){
    chomp;
    <span class="org-keyword">if</span> (/gao/){
        <span class="org-builtin">print</span> <span class="org-string">"$_ was matched 'gao'\n"</span>;
    }
}
</pre>
</div>

<p>
上面使用了默认的参数变量 <code>$_</code> ，它表示foreach迭代的每一行数据；上面还
简写的正则匹配方式 <code>/gao/</code> ，它等价于 <code>$_ =~ m/gao/</code> 。
</p>

<p>
以下是执行结果：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">echo -e "xiaoming gaoxiaofang" | perl 26.plx  
</span>xiaoming gaoxiaofang was matched <span class="org-string">'gao'</span>
</pre>
</div>

<p>
<b>3.匹配文件中每行数据</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">foreach</span> (&lt;&gt;){
    chomp;
    <span class="org-keyword">if</span>(/gao/){
        <span class="org-builtin">print</span> <span class="org-string">"$_ was matched 'gao'\n"</span>;
    }
}
</pre>
</div>

<p>
<b>4.如果想要输出匹配到的内容，可以使用特殊变量 <code>$&amp;</code> 来引用匹配到的内容，
还可以使用 <code>$`</code> 引用匹配前面部分的内容， <code>$'</code> 引用匹配后面部分的内容</b>
</p>

<p>
例如：
</p>

<div class="org-src-container">
<pre class="src src-ini">aAbBcC =~ /bB/
</pre>
</div>

<p>
由于匹配的内容是bB，匹配内容之前的部分是aA，匹配之后的部分是cC，于是可
以看作下面对应关系：
</p>

<div class="org-src-container">
<pre class="src src-sh">(aA)(bB)(cC)
 |    |   |
 $<span class="org-sh-quoted-exec">`   $&amp;  $'</span>
</pre>
</div>

<p>
以下是使用这三个特殊变量的示例：
</p>

<pre class="example" id="orgeac159b">
$name="aAbBcC";
if($name =~ /bB/){
    print "pre match: $` \n";
    print "match: $&amp; \n";
    print "post match: $' \n";
}
</pre>

<p>
需要注意的是，正则中一般都提供全局匹配的功能，perl中使用修饰符 <code>/g</code> 开启。
当开启了全局匹配功能，这3个变量保存的值需要使用循环语句去遍历，否则将
只保存第一次匹配的内容。例如：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">name</span>=<span class="org-string">"aAbBcCbB"</span>;
<span class="org-keyword">if</span>($<span class="org-variable-name">name</span> =~ /bB/g){        <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;&#23436;&#31532;&#19968;&#20010;bB&#23601;&#32467;&#26463;
</span>    <span class="org-builtin">print</span> <span class="org-string">"pre match: $` \n";
    print "match: $&amp; \n";
    print "post match: $' \n";
}

while($name =~ /bB/g){   # &#23558;&#36845;&#20195;&#20004;&#27425;
    print "pre match: $` \n";
    print "match: $&amp; \n";
    print "post match: $' \n";
}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:dd69c6c9-dc51-407c-ac10-52fe697a2aef" class="outline-4">
<h4 id="h:dd69c6c9-dc51-407c-ac10-52fe697a2aef"><a href="#h:dd69c6c9-dc51-407c-ac10-52fe697a2aef">perl支持的正则</a></h4>
<div class="outline-text-4" id="text-h:dd69c6c9-dc51-407c-ac10-52fe697a2aef">
<p>
从这里开始，正式介绍perl支持的正则。
</p>

<p>
出于方便，我全部都直接在perl程序内部定义待匹配的内容，如果想要匹配管道
传递的输入，或者匹配文件数据，请看上文获取操作方法。
</p>

<p>
为了完整性，每一节中我都是先把一大堆的内容列出来做个简单介绍，然后再用
示例解释每个(或某几个)。但perl正则的内容太多，而且很多功能前后关联，所
以如果列出来的内容没有在同一小节内介绍，那么就是在后面需要的地方介绍。
当然，也有些没什么用或者用的很少的功能(比如unicode相关的)，通篇都不会
介绍。
</p>
</div>
<div id="outline-container-h:63ae938d-961f-4255-8f27-2d154fcd12be" class="outline-5">
<h5 id="h:63ae938d-961f-4255-8f27-2d154fcd12be"><a href="#h:63ae938d-961f-4255-8f27-2d154fcd12be">模式匹配修饰符</a></h5>
<div class="outline-text-5" id="text-h:63ae938d-961f-4255-8f27-2d154fcd12be">
<p>
指定模式匹配的修饰符，可以改变正则表达式的匹配行为。例如，下面的i就是
一种修饰符，它让前面的正则REG匹配时忽略大小写。
</p>

<div class="org-src-container">
<pre class="src src-sh">m/REG/i
</pre>
</div>

<p>
perl总共支持以下几种修饰符：msixpodualngc
</p>

<div class="org-src-container">
<pre class="src src-sh">i&#65306;&#21305;&#37197;&#26102;&#24573;&#30053;&#22823;&#23567;&#20889;
g&#65306;&#20840;&#23616;&#21305;&#37197;&#65292;&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;&#27491;&#21017;&#34920;&#36798;&#24335;<span class="org-string">"abc"</span>&#21305;&#37197;<span class="org-string">"abcdabc"</span>&#23383;&#31526;&#20018;&#30340;&#26102;&#20505;&#65292;&#23558;&#20043;&#21305;&#37197;&#24038;&#36793;&#30340;abc&#65292;&#20351;&#29992;g&#23558;&#21305;&#37197;&#20004;&#20010;<span class="org-string">"abc"</span>
c&#65306;&#22312;&#24320;&#21551;g&#30340;&#24773;&#20917;&#19979;&#65292;&#22914;&#26524;&#21305;&#37197;&#22833;&#36133;&#65292;&#23558;&#19981;&#37325;&#32622;&#25628;&#32034;&#20301;&#32622;
m&#65306;&#22810;&#34892;&#21305;&#37197;&#27169;&#24335;
s&#65306;&#35753;.&#21487;&#20197;&#21305;&#37197;&#25442;&#34892;&#31526;<span class="org-string">"\n"</span>&#65292;&#20063;&#23601;&#26159;&#35828;&#35813;&#20462;&#39280;&#31526;&#35753;.&#30495;&#30340;&#21487;&#20197;&#21305;&#37197;&#20219;&#24847;&#23383;&#31526;
x&#65306;&#20801;&#35768;&#27491;&#21017;&#34920;&#36798;&#24335;&#20351;&#29992;&#31354;&#30333;&#31526;&#21495;&#65292;&#20813;&#24471;&#35753;&#25972;&#20010;&#34920;&#36798;&#24335;&#38590;&#35835;&#38590;&#25026;&#65292;&#20294;&#36825;&#26679;&#20250;&#35753;&#21407;&#26412;&#30340;&#31354;&#30333;&#31526;&#21495;&#22833;&#21435;&#24847;&#20041;&#65292;&#36825;&#26159;&#21487;&#20197;&#20351;&#29992;\s&#26469;&#34920;&#31034;&#31354;&#30333;
o&#65306;&#21482;&#32534;&#35793;&#19968;&#27425;&#27491;&#21017;&#34920;&#36798;&#24335;
n&#65306;&#38750;&#25429;&#33719;&#27169;&#24335;
p&#65306;&#20445;&#23384;&#21305;&#37197;&#30340;&#23383;&#31526;&#20018;&#21040;${^PREMATCH}&#12289;${^MATCH}&#12289;${^POSTMATCH}&#20013;&#65292;&#23427;&#20204;&#22312;&#32467;&#26524;&#19978;&#23545;&#24212;$<span class="org-sh-quoted-exec">`&#12289;$&amp;&#21644;$'&#65292;&#20294;&#24615;&#33021;&#19978;&#35201;&#26356;&#22909;
a&#21644;u&#21644;l&#65306;&#20998;&#21035;&#34920;&#31034;&#29992;ASCII&#12289;Unicode&#21644;Locale&#30340;&#26041;&#24335;&#26469;&#35299;&#37322;&#27491;&#21017;&#34920;&#36798;&#24335;&#65292;&#19968;&#33324;&#19981;&#29992;&#32771;&#34385;&#36825;&#20960;&#20010;&#20462;&#39280;&#31526;
d&#65306;&#20351;&#29992;unicode&#25110;&#21407;&#29983;&#23383;&#31526;&#38598;&#65292;&#23601;&#20687;5.12&#21644;&#20043;&#21069;&#37027;&#26679;&#65292;&#20063;&#19981;&#29992;&#32771;&#34385;&#36825;&#20010;&#20462;&#39280;&#31526;</span>
</pre>
</div>

<p>
这些修饰符可以连用，连用时顺序可随意。例如下面两行是等价的行为：全局忽
略大小写的匹配行为。
</p>

<div class="org-src-container">
<pre class="src src-sh">m/REG/ig
m/REG/gi
</pre>
</div>

<p>
上面的修饰符，本节介绍igcmsxpo这几个修饰符，n修饰符在后面分组捕获的地
方解释，auld修饰符和字符集相关，不打算解释。
</p>

<p>
<b>i修饰符：忽略大小写</b>
</p>

<p>
该修饰符使得正则匹配的时候，忽略大小写。
</p>

<pre class="example" id="orgcb90938">
$name="aAbBcC";
if($name =~ m/ab/i){
    print "pre match: $` \n";     # 输出a
    print "match: $&amp; \n";         # 输出Ab
    print "post match: $' \n";    # 输出BcC
}
</pre>

<p>
​<b>g和c修饰符以及\G</b>
</p>

<p>
g修饰符(global)使得正则匹配的时候，对字符串做全局匹配，也就是说，即使
前面匹配成功了，还会继续向后匹配，看是否还能匹配成功。
</p>

<p>
例如，字符串”abcabc”，正则表达式”ab”，在默认情况下(不是全局匹配)该
正则在匹配到第一个ab后就结束了，如果使用了g修饰符，匹配完第一个ab，还
会继续向后匹配，而且正好还能匹配到第二个ab，所以最终有两个ab被匹配成功。
</p>

<p>
要验证多次匹配，需要使用循环遍历的方式，而不能用if语句：
</p>

<pre class="example" id="org8251c8d">
$name="aAbBcCaBc";
while($name =~ m/ab/gi){
    print "pre match: $` \n";
    print "match: $&amp; \n";
    print "post match: $' \n";
}
</pre>


<p>
执行它，将输出如下内容：
</p>

<div class="org-src-container">
<pre class="src src-sh">pre match: a 
match: Ab 
post match: BcCaBc 
pre match: aAbBcC 
match: aB 
post match: c 
</pre>
</div>

<p>
以下内容，如果仅仅只是为了学perl正则，那么可以跳过，因为很难，如果是学
perl语言，那么可以继续看下去。
</p>

<p>
实际上， <b>在开启了g全局匹配后</b> ，perl每次在 <b>成功匹配</b> 的时候都会记下
匹配的字符位移，以便在下次匹配该内容时候，可以从指定位移处继续向后匹配。
每次 <b>匹配成功后</b> 的位移值(pos的位移从0开始算，0位移代表的是第一个字符
左边的位置)，都可以通过pos()函数获取。如果本次匹配导致位移指针重置，
pos将返回undef。
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">name</span>=<span class="org-string">"123ab456"</span>;
$<span class="org-variable-name">name</span> =~ m/\d\d/g;     <span class="org-comment-delimiter"># </span><span class="org-comment">&#31532;&#19968;&#27425;&#21305;&#37197;&#65292;&#21305;&#37197;&#25104;&#21151;&#21518;&#35760;&#19979;&#20301;&#31227;
</span><span class="org-builtin">print</span> <span class="org-string">"matched string: $&amp;, position: "</span>,pos $<span class="org-variable-name">name</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">name</span> =~ m/\d\d/g;     <span class="org-comment-delimiter"># </span><span class="org-comment">&#31532;&#20108;&#27425;&#21305;&#37197;&#65292;&#21305;&#37197;&#25104;&#21151;&#21518;&#35760;&#19979;&#20301;&#31227;
</span><span class="org-builtin">print</span> <span class="org-string">"matched string: $&amp;, position: "</span>,pos $<span class="org-variable-name">name</span>,<span class="org-string">"\n"</span>;
</pre>
</div>

<p>
执行它，将输出如下内容：
</p>

<div class="org-src-container">
<pre class="src src-sh">matched string: 12, position: 2
matched string: 45, position: 7
</pre>
</div>

<p>
由于匹配失败的时候，正则匹配操作会返回假，所以可以作为if或while等的条
件语句。例如，改为while循环多次匹配：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">name</span>=<span class="org-string">"123ab456"</span>;
<span class="org-keyword">while</span>($<span class="org-variable-name">name</span> =~ m/\d\d/g){
    <span class="org-builtin">print</span> <span class="org-string">"matched string: $&amp;, position: "</span>,pos $<span class="org-variable-name">name</span>,<span class="org-string">"\n"</span>;
}
</pre>
</div>

<p>
默认全局匹配情况下，当本次匹配失败，位移指针将重置到起始位置0处，也就
是说，下次匹配将从头开始匹配。例如：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">txt</span>=<span class="org-string">"1234a56"</span>;
$<span class="org-variable-name">txt</span> =~ /\d\d/g;      <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;&#25104;&#21151;&#65306;12&#65292;&#20301;&#31227;&#21521;&#21518;&#31227;&#20004;&#20301;
</span><span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\d\d/g;      <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;&#25104;&#21151;&#65306;34&#65292;&#20301;&#31227;&#21521;&#21518;&#31227;&#20004;&#20301;
</span><span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\d\d\d/g;      <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;&#22833;&#36133;&#65292;&#20301;&#31227;&#25351;&#38024;&#22238;&#21040;0&#22788;&#65292;pos()&#36820;&#22238;undef
</span><span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\d/g;          <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;&#25104;&#21151;&#65306;1&#65292;&#20301;&#31227;&#21521;&#21518;&#31227;1&#20301;
</span><span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
</pre>
</div>

<p>
执行上述程序，将输出：
</p>

<div class="org-src-container">
<pre class="src src-sh">matched 12: 2
matched 34: 4
matched 34: 
matched 1: 1
</pre>
</div>

<p>
如果”g”修饰符下同时使用”c”修饰符，也就是”gc”，它表示全局匹配失败
的时候不重置位移指针。也就是说，本次匹配失败后，位移指针会卡在原处不动，
下次匹配将从这个位置处开始匹配。
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">txt</span>=<span class="org-string">"1234a56"</span>;
$<span class="org-variable-name">txt</span> =~ /\d\d/g;
<span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\d\d/g;
<span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\d\d\d/gc;   <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;&#22833;&#36133;&#65292;$&amp;&#21644;pos()&#20445;&#30041;&#19978;&#19968;&#27425;&#21305;&#37197;&#25104;&#21151;&#30340;&#20869;&#23481;
</span><span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\d/g;        <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;&#25104;&#21151;&#65306;5
</span><span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\d/g;        <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;&#25104;&#21151;&#65306;6
</span><span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\d/gc;        <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;&#22833;&#36133;
</span><span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
</pre>
</div>

<p>
执行上述程序，将输出：
</p>

<div class="org-src-container">
<pre class="src src-sh">matched 12: 2
matched 34: 4
matched 34: 4
matched 5: 6
matched 6: 7
matched 6: 7
</pre>
</div>

<p>
继续上面的问题，如果第三个匹配语句不是 <code>\d\d\d</code> ，而是”\d"，它匹配字母a
的时候也失败，不用c修饰符的时候会重置位移吗？显然是不会。因为它会继续
向后匹配。所以该 <code>\G</code> 登场了。
</p>

<p>
默认全局匹配情况下，匹配时是可以跳过匹配失败的字符继续匹配的：当某个字
符匹配失败，它会后移一位继续去匹配，直到匹配成功或匹配结束。
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">txt</span>=<span class="org-string">"1234ab56"</span>;
$<span class="org-variable-name">txt</span> =~ /\d\d/g;
<span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\d\d/g;
<span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\d/g;       <span class="org-comment-delimiter"># </span><span class="org-comment">&#23383;&#27597;a&#21305;&#37197;&#22833;&#36133;&#65292;&#21518;&#31227;&#19968;&#20301;&#65292;&#23383;&#27597;b&#21305;&#37197;&#22833;&#36133;&#65292;&#21518;&#31227;&#19968;&#20301;&#65292;&#25968;&#20540;5&#21305;&#37197;&#25104;&#21151;
</span><span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\d/g;       <span class="org-comment-delimiter"># </span><span class="org-comment">&#25968;&#20540;6&#21305;&#37197;&#25104;&#21151;
</span><span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
</pre>
</div>

<p>
执行上述程序，将输出：
</p>

<div class="org-src-container">
<pre class="src src-sh">matched 12: 2
matched 34: 4
matched 5: 7
matched 6: 8
</pre>
</div>

<p>
可以指定 <code>\G</code> ，使得本次匹配强制从位移处进行匹配，不允许跳过任何匹配失败的字符。
</p>

<ul class="org-ul">
<li>如果本次 <code>\G</code> 全局匹配成功，位移指针自然会后移</li>
<li>如果本次 <code>\G</code> 全局匹配失败，且没有加上c修饰符，那么位移指针将重置</li>
<li>如果本次 <code>\G</code> 全局匹配失败，且加上了c修饰符，那么位移指针将卡在那不动</li>
</ul>

<p>
例如：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">txt</span>=<span class="org-string">"1234ab56"</span>;
$<span class="org-variable-name">txt</span> =~ /\d\d/g;
<span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\d\d/g;
<span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\G\d/g;     <span class="org-comment-delimiter"># </span><span class="org-comment">&#24378;&#21046;&#20174;&#20301;&#31227;4&#24320;&#22987;&#21305;&#37197;&#65292;&#26080;&#27861;&#21305;&#37197;&#23383;&#27597;a&#65292;&#20294;&#21448;&#19981;&#20801;&#35768;&#36339;&#36807;
</span>                     <span class="org-comment-delimiter"># </span><span class="org-comment">&#25152;&#20197;&#26412;&#27425;\G&#20840;&#23616;&#21305;&#37197;&#22833;&#36133;&#65292;&#30001;&#20110;&#27809;&#26377;&#20462;&#39280;&#31526;c&#65292;&#25351;&#38024;&#37325;&#32622;
</span><span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\G\d/g;     <span class="org-comment-delimiter"># </span><span class="org-comment">&#25351;&#38024;&#22238;&#21040;0&#65292;&#24378;&#21046;&#20174;0&#22788;&#24320;&#22987;&#21305;&#37197;&#65292;&#25968;&#20540;1&#33021;&#21305;&#37197;&#25104;&#21151;
</span><span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
</pre>
</div>

<p>
以下是输出内容：
</p>

<div class="org-src-container">
<pre class="src src-sh">matched 12: 2
matched 34: 4
matched 34: 
matched 1: 1
</pre>
</div>

<p>
如果将上面第三个匹配语句加上修饰符c，甚至后面的语句也都加上 <code>\G</code> 和c修饰
符，那么位移指针将卡在那个位置：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">txt</span>=<span class="org-string">"1234ab56"</span>;
$<span class="org-variable-name">txt</span> =~ /\d\d/g;
<span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\d\d/g;
<span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\G\d/gc;        <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;&#22833;&#36133;&#65292;&#25351;&#38024;&#21345;&#22312;&#21407;&#22320;
</span><span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\G\d/gc;        <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;&#22833;&#36133;&#65292;&#25351;&#38024;&#32487;&#32493;&#21345;&#22312;&#21407;&#22320;
</span><span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
$<span class="org-variable-name">txt</span> =~ /\G\d/gc;        <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;&#22833;&#36133;&#65292;&#25351;&#38024;&#32487;&#32493;&#21345;&#22312;&#21407;&#22320;
</span><span class="org-builtin">print</span> <span class="org-string">"matched $&amp;: "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
</pre>
</div>

<p>
以下是输出结果：
</p>

<div class="org-src-container">
<pre class="src src-sh">matched 12: 2
matched 34: 4
matched 34: 4
matched 34: 4
matched 34: 4
</pre>
</div>

<p>
一般来说，全局匹配都会用循环去多次迭代，和上面一次一次列出匹配表达式不
一样。所以，下面使用while循环的例子来对 <code>\G</code> 和c修饰符稍作解释，其实理
解了上面的内容，在循环中使用 <code>\G</code> 和c修饰符也一样很容易理解。
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">txt</span>=<span class="org-string">"1234ab56"</span>;
<span class="org-keyword">while</span>($<span class="org-variable-name">txt</span> =~ m/\G\d\d/gc){
    <span class="org-builtin">print</span> <span class="org-string">"matched: $&amp;, "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
}
</pre>
</div>

<p>
执行结果：
</p>

<div class="org-src-container">
<pre class="src src-sh">matched: 12, 2
matched: 34, 4
</pre>
</div>

<p>
当第三轮循环匹配到a字母的时候，由于使用了 <code>\G</code> ，导致匹配失败，结束循
环。
</p>

<p>
上面使用c与否是无关紧要的，但如果这个while循环的后面后还有对 <code>$txt</code> 的
匹配，那么使用c修饰符与否就有关系了。例如下面两段程序，返回结果不一样：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">txt</span>=<span class="org-string">"1234ab56"</span>;
<span class="org-keyword">while</span>($<span class="org-variable-name">txt</span> =~ m/\G\d\d/gc){   <span class="org-comment-delimiter"># </span><span class="org-comment">&#20351;&#29992;c&#20462;&#39280;&#31526;
</span>    <span class="org-builtin">print</span> <span class="org-string">"matched: $&amp;, "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
}

$<span class="org-variable-name">txt</span> =~ m/\G\d\d/gc;
<span class="org-builtin">print</span> <span class="org-string">"matched: $&amp;, "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
</pre>
</div>

<p>
和
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">txt</span>=<span class="org-string">"1234ab56"</span>;
<span class="org-keyword">while</span>($<span class="org-variable-name">txt</span> =~ m/\G\d\d/g){   <span class="org-comment-delimiter"># </span><span class="org-comment">&#19981;&#20351;&#29992;c&#20462;&#39280;&#31526;
</span>    <span class="org-builtin">print</span> <span class="org-string">"matched: $&amp;, "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
}

$<span class="org-variable-name">txt</span> =~ m/\G\d\d/gc;
<span class="org-builtin">print</span> <span class="org-string">"matched: $&amp;, "</span>,pos $<span class="org-variable-name">txt</span>,<span class="org-string">"\n"</span>;
</pre>
</div>

<p>
<b>m修饰符：多行匹配模式</b>
</p>

<p>
正则表达式一般都只用来匹配单行数据，但有时候却需要一次性匹配多行。比如
匹配跨行单词、匹配跨行词组，匹配跨行的对称分隔符(如一对括号)。
</p>

<p>
使用m修饰符可以开启多行匹配模式。
</p>

<p>
例如：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">txt</span>=<span class="org-string">"ab\ncd"</span>;
$<span class="org-variable-name">txt</span> =~ /a.*\nc/m;
<span class="org-builtin">print</span> <span class="org-string">"===match start===\n$&amp;\n===match end===\n"</span>;
</pre>
</div>

<p>
执行，将输出：
</p>

<div class="org-src-container">
<pre class="src src-sh">===match <span class="org-variable-name">start</span>===
ab
c
===match <span class="org-variable-name">end</span>===
</pre>
</div>

<p>
关于多行匹配，需要注意的是元字符=.=默认情况下无法匹配换行符。可以使用
 <code>[\d\D]</code> 代替点，也可以开启s修饰符使得 <code>.</code> 能匹配换行符。
</p>

<p>
例如，下面两个匹配输出的结果和上面是一致的。
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">txt</span>=<span class="org-string">"ab\ncd"</span>;
$<span class="org-variable-name">txt</span> =~ /a.*c/ms;
<span class="org-builtin">print</span> <span class="org-string">"===match start===\n$&amp;\n===match end===\n"</span>;

$<span class="org-variable-name">txt</span>=<span class="org-string">"ab\ncd"</span>;
$<span class="org-variable-name">txt</span> =~ /a[\d\D]*c/m;
<span class="org-builtin">print</span> <span class="org-string">"===match start===\n$&amp;\n===match end===\n"</span>;
</pre>
</div>

<p>
<b>s修饰符</b>
</p>

<p>
默认情况下， <code>.</code> 元字符是不能匹配换行符 <code>\n</code> 的，开启了s修饰符功能后，
可以让 <code>.</code> 匹配换行符。正如刚才的那个例子：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">txt</span>=<span class="org-string">"ab\ncd"</span>;
$<span class="org-variable-name">txt</span> =~ /a.*c/m;        <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;&#22833;&#36133;
</span><span class="org-builtin">print</span> <span class="org-string">"===match start===\n$&amp;\n===match end===\n"</span>;

$<span class="org-variable-name">txt</span>=<span class="org-string">"ab\ncd"</span>;
$<span class="org-variable-name">txt</span> =~ /a.*c/ms;       <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;&#25104;&#21151;
</span><span class="org-builtin">print</span> <span class="org-string">"===match start===\n$&amp;\n===match end===\n"</span>;
</pre>
</div>

<p>
<b>x修饰符</b>
</p>

<p>
正则表达式最为人所抱怨的就是它的可读性极差，无论你的正则能力有多强，看
着一大堆乱七八糟的符号组合在一起，都得一个符号一个符号地从左向右读。
</p>

<p>
万幸，perl正则支持表达式的分隔，甚至支持注释，只需加上x修饰符即可。这
时候正则表达式中出现的所有空白符号都不会当作正则的匹配对象，而是直接被
忽略。如果想要匹配空白符号，可以使用 <code>\s</code> 表示，或者将空格使用
<code>\Q...\E</code> 包围。
</p>

<p>
例如，以下4个匹配操作是完全等价的。
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">ans</span>=<span class="org-string">"cat sheep tiger"</span>;
$<span class="org-variable-name">ans</span> =~ /(\w) *(\w) *(\w)/;       <span class="org-comment-delimiter"># </span><span class="org-comment">&#27491;&#24120;&#24773;&#20917;&#19979;&#30340;&#21305;&#37197;&#34920;&#36798;&#24335;
</span>$<span class="org-variable-name">ans</span> =~ /(\w)\s*   (\w)\s*   (\w)/x;
$<span class="org-variable-name">ans</span> = ~ /
        (\w)\s*      <span class="org-comment-delimiter"># </span><span class="org-comment">&#21487;&#20197;&#21152;&#19978;&#26412;&#34892;&#27880;&#37322;&#65306;&#21305;&#37197;&#31532;&#19968;&#20010;&#21333;&#35789;
</span>        (\w)\s*      <span class="org-comment-delimiter"># </span><span class="org-comment">&#21487;&#20197;&#21152;&#19978;&#26412;&#34892;&#27880;&#37322;&#65306;&#21305;&#37197;&#31532;&#20108;&#20010;&#21333;&#35789;
</span>        (\w)         <span class="org-comment-delimiter"># </span><span class="org-comment">&#21487;&#20197;&#21152;&#19978;&#26412;&#34892;&#27880;&#37322;&#65306;&#21305;&#37197;&#31532;&#19977;&#20010;&#21333;&#35789;
</span>        /x;
$<span class="org-variable-name">ans</span> =~ /
         (\w)\Q \E   <span class="org-comment-delimiter"># </span><span class="org-comment">\Q \E&#24378;&#21046;&#23558;&#20013;&#38388;&#30340;&#31354;&#26684;&#24403;&#20316;&#23383;&#38754;&#31526;&#21495;&#34987;&#21305;&#37197;
</span>         (\w)\Q \E
         (\w)
        /x;
</pre>
</div>

<p>
对于稍微复杂一些的正则表达式，常常都会使用x修饰符来增强其可读性，最重
要的是加上注释。这一点真的非常人性化。
</p>

<p>
<b>p修饰符</b>
</p>

<p>
前面说过，通过3个特殊变量 <code>$`</code> 、 <code>$&amp;</code> 和 <code>$'</code> 可以保存匹配内容之前的
内容，匹配内容以及匹配内容之后的内容。但是，只要使用了这3个变量中的任
何一个，后面的所有分组效率都会降低。perl提供了一个p修饰符，能实现完全
相同的功能：
</p>

<div class="org-src-container">
<pre class="src src-sh">${^PREMATCH}    &lt;=&gt;   $<span class="org-sh-quoted-exec">`
${^MATCH}       &lt;=&gt;   $&amp;
${^POSTMATCH}   &lt;=&gt;   $'</span>
</pre>
</div>

<p>
一个例子即可描述：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">ans</span>=<span class="org-string">"cat sheep tiger"</span>;
$<span class="org-variable-name">ans</span> =~ /sheep/p;
<span class="org-builtin">print</span> <span class="org-string">"${^PREMATCH}\n"</span>;     <span class="org-comment-delimiter"># </span><span class="org-comment">&#36755;&#20986;"cat "
</span><span class="org-builtin">print</span> <span class="org-string">"${^MATCH}\n"</span>;        <span class="org-comment-delimiter"># </span><span class="org-comment">&#36755;&#20986;"sheep"
</span><span class="org-builtin">print</span> <span class="org-string">"${^POSTMATCH}\n"</span>;    <span class="org-comment-delimiter"># </span><span class="org-comment">&#36755;&#20986;" tiger"</span>
</pre>
</div>

<p>
<b>o修饰符</b>
</p>

<p>
在较老的perl版本中，如果使用同一个正则表达式做多次匹配，正则引擎将只多
次编译正则表达式。很多时候正则表达式并不会改变，比如循环匹配文件中的行，
这样的多次编译导致性能下降很明显，于是可以使用o修饰符让正则引擎对同一
个正则表达式不重复编译。
</p>

<p>
在perl5.6中，默认情况下对同一正则表达式只编译一次，但同样可以指定o修饰
符，使得即使正则表达式变化了也不要重新编译。
</p>

<p>
一般情况下，可以无视这个修饰符。
</p>
</div>
</div>
<div id="outline-container-h:77f34eb0-ccdd-4427-97ab-c32e7176471c" class="outline-5">
<h5 id="h:77f34eb0-ccdd-4427-97ab-c32e7176471c"><a href="#h:77f34eb0-ccdd-4427-97ab-c32e7176471c">范围模式匹配修饰符(?imsx-imsx:pattern)</a></h5>
<div class="outline-text-5" id="text-h:77f34eb0-ccdd-4427-97ab-c32e7176471c">
<p>
前文介绍的修饰符 <code>adluoimsxpngc</code> 都是放在 <code>m//{FLAG}</code> 的flag处的，放在
这个位置会对整个正则表达式产生影响，所以它的作用范围有点广。
</p>

<p>
例如 <code>m/pattern1 pattern2/i</code> 的i修饰符会影响pattern1和pattern2。
</p>

<p>
perl允许我们定义只在一定范围内生效的修饰符，方式是 <code>(?imsx:pattern)</code>
或 <code>(?-imsx:pattern)</code> 或 <code>(?imsx-imsx:pattern)</code> ，其中加上 <code>-</code> 表示去
除这个修饰符的影响。这里只列出了imsx，因为这几个最常用，其他的修饰符也
一样有效。
</p>

<p>
例如，对于待匹配字符串”Hello world gaoxiaofang”，使用以下几种模式去
匹配的话：
</p>

<p>
<code>/(?i:hello) world/</code>
</p>

<p>
表示匹配hello时，可忽略大小写，但匹配world时仍然区分大小写。所以匹配成功
</p>

<p>
<code>/(?ims:hello.)world/</code>
</p>

<p>
表示可以跨行匹配helloworld，也可以匹配单行的hellosworld，且hello部分忽
略大小写。所以匹配成功
</p>

<p>
<code>/(?i:hello (?-i:world) gaoxiaoFANG)/</code>
</p>

<p>
表示在第二个括号之前，可用忽略大小写进行匹配，但因为第二个括号里指明了
去除i的影响，所以对world的匹配会区分大小写，但是对gaoxiaofang部分的匹
配又不区分大小写。所以匹配成功
</p>

<p>
<code>/(?i:hello (?-i:world) gaoxiao)FANG/</code>
</p>

<p>
和前面的类似，但是将”FANG”放到了括号外，意味着这部分要区分大小写。所
以匹配失败
</p>
</div>
</div>
<div id="outline-container-h:6b0d3137-5842-4635-8ec8-4784b2ea08ae" class="outline-5">
<h5 id="h:6b0d3137-5842-4635-8ec8-4784b2ea08ae"><a href="#h:6b0d3137-5842-4635-8ec8-4784b2ea08ae">perl支持的反斜线序列</a></h5>
<div class="outline-text-5" id="text-h:6b0d3137-5842-4635-8ec8-4784b2ea08ae">
<p>
<b>1.锚定类的反斜线序列</b>
</p>

<p>
所谓锚定，是指它匹配的是位置，而非字符，比如锚定行首的意思是匹配第一个
字母前的空字符。也就是很多人说的”零宽断言(zero-width assertions)“。
</p>

<ul class="org-ul">
<li><code>\b</code> ：匹配单词边界处的空字符</li>
<li><code>\B</code> ：匹配非单词边界处的空字符</li>
<li><code>\&lt;</code> ：匹配单词开头处的空字符</li>
<li><code>\&gt;</code> ：匹配单词结尾处的空字</li>
<li><code>\A</code> ：匹配绝对行首，换句话说，就是输入内容的开头</li>
<li><code>\z</code> ：匹配绝对行尾，换句话说，就是输入内容的绝对尾部</li>
<li><code>\Z</code> ：匹配绝对行尾或绝对行尾换行符前的位置，换句话说，就是输入内容的尾部</li>
<li><code>\G</code> ：强制从位移指针处进行匹配，详细内容见 "g和c修饰符以及\G"</li>
</ul>

<p>
主要解释下 <code>\A \z \Z</code> ，其它的属于基础正则的内容，不多做解释了。
</p>

<p>
<code>\A \z \Z</code> 和 <code>^ $</code> 的区别主要体现在多行模式下。在多行模式下：
</p>

<div class="org-src-container">
<pre class="src src-sh">First Line\nSecond line\n

(^&#21305;&#37197;&#20219;&#24847;&#34892;&#39318;)First Line($<span class="org-variable-name">&#21305;&#37197;&#20219;&#24847;&#34892;&#23614;</span>)\n(^&#21305;&#37197;&#20219;&#24847;&#34892;&#39318;)Second line($<span class="org-variable-name">&#21305;&#37197;&#20219;&#24847;&#34892;&#23614;</span>)\n


(\A&#21305;&#37197;&#25972;&#20010;&#36755;&#20837;&#30340;&#32477;&#23545;&#24320;&#22836;)First Line\nSecond line(\Z&#21305;&#37197;&#25972;&#20010;&#36755;&#20837;&#30340;&#23614;&#37096;&#65292;&#25110;&#32477;&#23545;&#23614;&#37096;&#25442;&#34892;&#31526;&#30340;&#21069;&#38754;)\n(\z&#21305;&#37197;&#25972;&#20010;&#36755;&#20837;&#30340;&#32477;&#23545;&#23614;&#37096;)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">txt</span> = <span class="org-string">"abcd\nABCD\n"</span>;
$<span class="org-variable-name">txt1</span> = <span class="org-string">"abcd\nABCD"</span>;

$<span class="org-variable-name">txt</span> =~ /^ABC*/;   <span class="org-comment-delimiter"># </span><span class="org-comment">&#26080;&#27861;&#21305;&#37197;
</span>$<span class="org-variable-name">txt</span> =~ /^ABC*/m;  <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;
</span>
$<span class="org-variable-name">txt</span> =~ /\Aabc/;   <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;
</span>$<span class="org-variable-name">txt</span> =~ /\Aabc/m;  <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;
</span>$<span class="org-variable-name">txt</span> =~ /\AABC/m;  <span class="org-comment-delimiter"># </span><span class="org-comment">&#26080;&#27861;&#21305;&#37197;
</span>
$<span class="org-variable-name">txt</span> =~ /cd\n$/m;  <span class="org-comment-delimiter"># </span><span class="org-comment">&#19981;&#21305;&#37197;
</span>$<span class="org-variable-name">txt</span> =~ /cd$\n/m;  <span class="org-comment-delimiter"># </span><span class="org-comment">&#19981;&#21305;&#37197;
</span>$<span class="org-variable-name">txt</span> =~ /cd$/m;    <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;
</span>
$<span class="org-variable-name">txt</span> =~ /CD\Z\n/m  <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;
</span>$<span class="org-variable-name">txt</span> =~ /CD\Z\n\Z/m; <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;
</span>$<span class="org-variable-name">txt</span> =~ /CD\n\z/m; <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;
</span>
$<span class="org-variable-name">txt1</span> =~ /CD\Z/m;  <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;
</span>$<span class="org-variable-name">txt1</span> =~ /CD\z/m;  <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">perl -e '$txt = "abcd\nABCD\n"; $txt =~ /CD\Z/m; print "$&amp;"  # &#21305;&#37197;' 
</span>CD
</pre>
</div>

<p>
从上面的 <code>$</code> 匹配示例可知， <code>$</code> 代表的行尾，其实它在有换行符的时候匹
配”\n"，而不是"\n“的前、后，在没有换行符的时候，匹配行尾。
</p>

<p>
<b>2.字符匹配反斜线序列</b>
</p>

<p>
当然，除了以下这几种，还有 <code>\v \V \h \H \R \p \c \X</code> ，这些基本不会用上，所以都不会在本文解释。
</p>

<pre class="example" id="orgbecef54">
- \w：匹配单词构成部分，等价于 [_[:alnum:]]
- \W：匹配非单词构成部分，等价于 [^_[:alnum:]]
- \s：匹配空白字符，等价于 [[:space:]]
- \S：匹配非空白字符，等价于 [^[:space:]]
- \d：匹配数字，等价于 [0-9]
- \D：匹配非数字，等价于[^0-9]
- \N：不匹配换行符，等价于[^\n]。但 \N{NAME}有特殊意义，表示匹配已命名(名为NAME)的unicode字符序列，本文不介绍该特殊用法
</pre>

<p>
由于元字符=.=默认无法匹配换行符，所以需要匹配换行符的时候，可以使用特
殊组合 <code>[\d\D]</code> 或者 <code>(\n|\N)</code> 来替换 <code>.</code> ，换句话说，如果想匹配任意长
度的任意字符，可以换成 <code>[\d\D]*</code> 或者 <code>(\n|\N)*</code> ，当然，前提是必须支
持这3个反斜线序列。
</p>

<p>
之所以不用 <code>[\n\N]</code> 替代元字符 <code>.</code> ，是因为 <code>\N</code> 有特殊意义，不能随意接符号和字母。
</p>

<p>
<b>3.分组引用的反斜线序列</b>
</p>

<ul class="org-ul">
<li><code>\1</code> ：反向引用，其中1可以替换为任意一个正整数，即使超出9，例如
<code>\111</code> 表示匹配第111个分组</li>
<li><code>\g1</code> 或 <code>\g{1}</code> ：也是反向引用，只不过这种写法可以避免歧义，例如
<code>\g{1}11</code> 表示匹配第一个分组内容后两个数字1</li>
<li><code>\g{-1}</code> ：还可以使用负数，表示距离 <code>\g</code> 左边的分组号，也就是相对距
离。例如 <code>(abc)([a-z])\g{-1}</code> 中的 <code>\g</code> 引用的是 <code>[a-z]</code> ，如果-1换
成-2，则引用的 <code>abc</code></li>
<li><code>\g{name}</code> ：引用已命名的分组(命名捕获)，其中name为分组的名称</li>
<li><code>\k&lt;name&gt;</code> ：同上，引用已命名的分组(命名捕获)，其中name为分组的名称</li>
<li><code>\K</code> ：不要将 <code>\K</code> 左边的内容放进 <code>$&amp;</code> 。换句话说， <code>\K</code> 左边的内容
即使匹配成功了，也会重置匹配的位置</li>
</ul>

<p>
<code>\1</code> 表示引用第一个分组， <code>\11</code> 表示引用第11个分组，在基础正则中，是不
支持引用超出9个分组的，但显然perl会将 <code>\11</code> 的第二个1解析为引用，以便
能引用更多分组。
</p>

<p>
同理 <code>\g1</code> 和 <code>\g11</code> ，只是使用 <code>\g</code> 引用的方式可以加上大括号使引用变
得更安全，更易读，且 <code>\g</code> 可以使用负数来表示从右向左相对引用。这样在
<code>\g{-2}</code> 的左边添加新的分组括号时，无须修改引用表达式。
</p>

<p>
此处暂时还没介绍到命名分组，所以 <code>\g{name}</code> 和 <code>\k&lt;name&gt;</code> 留在后面再介绍。
</p>

<p>
<code>\K</code> 表示强制中断前面已完成的匹配。例如 <code>"abc22ABC" =~ /abc\K2.*/;</code> ，
虽然abc三个字母也被匹配，如果没有 <code>\K</code> ，这3个字母将放进 <code>$&amp;</code> 中，但是
<code>\K</code> 使得匹配完abc后立即切断前面的匹配，也就是从c字母后面开始重新匹配，
所以这里匹配的结果是22ABC。
</p>

<p>
再例如， <code>"abc123abcfoo"=~ /(abc)123\K\g1foo/;</code> ，它匹配到123后被切断，
但是分组引用还可以继续引用，所以匹配的结果是”abcfoo”。
</p>
</div>
</div>
<div id="outline-container-h:61376ab1-d21e-48c0-be11-1da47fca0fab" class="outline-5">
<h5 id="h:61376ab1-d21e-48c0-be11-1da47fca0fab"><a href="#h:61376ab1-d21e-48c0-be11-1da47fca0fab">贪婪匹配、非贪婪匹配、占有优先匹配</a></h5>
<div class="outline-text-5" id="text-h:61376ab1-d21e-48c0-be11-1da47fca0fab">
<p>
在基础正则中，那些能匹配多次的量词都会匹配最长内容。这种尽量多匹配的行
为称为”贪婪匹配”(greedy match)。
</p>

<p>
例如字符串”aa1122ccbb”，用正则表达式 <code>a.*c</code> 去匹配这个字符串，其中的
 <code>.*</code> 将直接从第二个字母a开始匹配到最结尾的b，因为从第二个字母a开始到
 最后一个字母b都符合 <code>.*</code> 的匹配模式。再然后，去匹配字母c，但因为已经
 把所有字母匹配完了，只能回退一个字母一个字母地释放，每释放一个就匹配
 一次字母c，发现回退释放到倒数第三个字母就能满足匹配要求，于是这里的
 <code>.*</code> 最终匹配的内容是”a1122cc”。
</p>

<p>
上面涉及到回溯的概念，也就是将那些已经被量词匹配的内容回退释放。
</p>

<p>
上面描述的是贪婪匹配行为，还有非贪婪匹配、占有优先匹配，以下简单描述下
他们的意义：
</p>

<ul class="org-ul">
<li>非贪婪匹配：(lazy match,reluctant)尽可能少地匹配，也叫做懒惰匹配</li>
<li>占有优先匹配：(possessive)占有优先和固化分组是相同的，只要占有了就不
再交换，不允许进行回溯。相关内容见后文”固化分组”</li>
</ul>

<p>
有必要搞清楚这几种匹配模式在匹配机制上的区别：
</p>

<ul class="org-ul">
<li>贪婪匹配：对于那些量词，将一次性从左到右匹配到最大长度，然后再往回回溯释放</li>
<li>非贪婪匹配：对于那些量词，将从左向右逐字符匹配最短长度，然后直接结束
这次的量词匹配行为</li>
<li>占有优先匹配：按照贪婪模式匹配，匹配后内容就锁住，不进行回溯(后文固
化分组有具体示例)</li>
</ul>

<p>
除了上面描述的 <code>*</code> 量词会进行贪婪匹配，其他所有能进行多次匹配的量词可
以选择贪婪匹配模式、非贪婪匹配模式和占有优先匹配模式，只需选择对应的量
词元字符即可。如下：
</p>

<div class="org-src-container">
<pre class="src src-sh">                        (&#37327;&#35789;&#21518;&#21152;&#19978;?)             (&#37327;&#35789;&#21518;&#21152;&#19978;+)
  &#36138;&#23146;&#21305;&#37197;&#37327;&#35789;           &#38750;&#36138;&#23146;&#21305;&#37197;&#37327;&#35789;           &#21344;&#26377;&#20248;&#20808;&#21305;&#37197;&#37327;&#35789;
-----------------------------------------------------------------
      *                    *?                         *+
      ?                    ??                         ?+
      +                    +?                         ++
      {M,}                 {M,}?                      {M,}+
      {M,N}                {M,N}?                     {M,N}+
      {N}                  {N}?                       {N}+
</pre>
</div>

<p>
几点需要说明：
</p>

<ul class="org-ul">
<li>非贪婪匹配时的 <code>{M,}?</code> 和 <code>{M,N}?</code> ，它们是等价的，因为最多只匹配M次</li>
<li>在perl中不支持 <code>{,N}</code> 的模式，所以也没有对应的非贪婪和占有优先匹配模式</li>
<li>关于 <code>{N}</code> 这个量词，由于是精确匹配N次，所以贪婪与否对最终结果无关紧
要，但是却影响匹配时的行为：贪婪匹配最长，需要回溯，非贪婪匹配最短，
不回溯，占有优先匹配最长不回溯。</li>
</ul>

<p>
看以下示例即可理解贪婪和非贪婪匹配的行为：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">str</span>=<span class="org-string">"abc123abc1234"</span>;

<span class="org-comment-delimiter"># </span><span class="org-comment">greedy match
</span><span class="org-keyword">if</span>( $<span class="org-variable-name">str</span> =~ /(a\w*3)/){
    <span class="org-builtin">print</span> <span class="org-string">"$&amp;\n"</span>;       <span class="org-comment-delimiter"># </span><span class="org-comment">abc123abc123
</span>}

<span class="org-comment-delimiter"># </span><span class="org-comment">lazy match
</span><span class="org-keyword">if</span>( $<span class="org-variable-name">str</span> =~ /(a\w*?3)/){
    <span class="org-builtin">print</span> <span class="org-string">"$&amp;\n"</span>;      <span class="org-comment-delimiter"># </span><span class="org-comment">abc123
</span>}
</pre>
</div>

<p>
以下是占有优先匹配模式的示例：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">str</span>=<span class="org-string">"abc123abc1234"</span>;

<span class="org-keyword">if</span>( $<span class="org-variable-name">str</span> =~ /a\w*+/){     <span class="org-comment-delimiter"># </span><span class="org-comment">&#25104;&#21151;
</span>        <span class="org-builtin">print</span> <span class="org-string">"possessive1: $&amp;\n"</span>; <span class="org-comment-delimiter"># </span><span class="org-comment">abc123abc1234
</span>}
<span class="org-keyword">if</span>( $<span class="org-variable-name">str</span> =~ /a\w*+3/){    <span class="org-comment-delimiter"># </span><span class="org-comment">&#22833;&#36133;
</span>        <span class="org-builtin">print</span> <span class="org-string">"possesive2: $&amp;\n"</span>;
}
</pre>
</div>

<p>
所以，在使用占有优先匹配模式时，它后面不应该跟其他表达式，例如 <code>a*+x</code> 永
远匹配不了东西。绝大多数时候都是不会回溯的。但是少数情况下，它并非强制
锁住回溯，这个和正则引擎匹配原理有关，本文不多做解释。
</p>

<p>
另外，固化分组和占有优先并不完全等价，它们只是匹配行为相同：匹配后不回
溯。具体可对比后文对应内容。
</p>
</div>
</div>
<div id="outline-container-h:2621ad54-b51c-45d4-a3d2-63232934beba" class="outline-5">
<h5 id="h:2621ad54-b51c-45d4-a3d2-63232934beba"><a href="#h:2621ad54-b51c-45d4-a3d2-63232934beba">perl的分组捕获和分组引用</a></h5>
<div class="outline-text-5" id="text-h:2621ad54-b51c-45d4-a3d2-63232934beba">
</div>
<ul class="org-ul">
<li><a id="h:300ec17a-4852-44d3-bfa2-f7a948fe3b5a"></a><a href="#h:300ec17a-4852-44d3-bfa2-f7a948fe3b5a">分组的基本应用</a><br>
<div class="outline-text-6" id="text-h:300ec17a-4852-44d3-bfa2-f7a948fe3b5a">
<p>
在基础正则中，使用括号可以对匹配的内容进行分组，这种行为称为分组捕获。
捕获后可以通过 <code>\1</code> 这种反向引用方式去引用(访问)保存在分组中的匹配结果。
</p>

<p>
例如：
</p>

<div class="org-src-container">
<pre class="src src-ini">"abc11ddabc11" =~ /([a-z]*)([0-9]*)dd\1\2/;
</pre>
</div>

<p>
在perl中，还可以使用=\gN=的方式来反向引用分组，这个在上一节”反斜线序
列”中已经解释过了。例如，以下是和上面等价的几种写法：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-string">"abc11ddabc11"</span> =~ /([a-z]*)([0-9]*)dd\g1\g2/;
<span class="org-string">"abc11ddabc11"</span> =~ /([a-z]*)([0-9]*)dd\g{1}\g{2}/;
<span class="org-string">"abc11ddabc11"</span> =~ /([a-z]*)([0-9]*)dd\g{-2}\g{-1}/;
</pre>
</div>

<p>
perl还会把分组的内容放进perl自带的特殊变量 <code>$1,$2,...,$N</code> 中，它们和
<code>\1,\2,...\N</code> 在*匹配成功时*的结果上没有区别，但是 <code>\N</code> 这种类型的反向
引用只在正则匹配中有效，正则匹配结束后就消亡了，而 <code>$N</code> 因为是perl的变
量，即使正则已经退出匹配，也依然可以引用。所以，我们可以使用 <code>$N</code> 的方
式来输出分组匹配的结果：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-string">"abc11ddabc11"</span> =~ /([a-z]*)([0-9]*)dd\1\2/;
<span class="org-builtin">print</span> <span class="org-string">"first group \\1: $1\n"</span>; <span class="org-comment-delimiter">#</span><span class="org-comment">abc
</span><span class="org-builtin">print</span> <span class="org-string">"second group \\2: $2\n"</span>; <span class="org-comment-delimiter">#</span><span class="org-comment">11</span>
</pre>
</div>

<p>
有两点需要注意：
</p>

<ul class="org-ul">
<li>这些分组可能捕获到的是空值(比如那些允许匹配0次的量词)，但是整个匹配
是成功的。这时候引用分组时，得到的结果也将是空值</li>
<li>当分组匹配失败的时候， <code>\1</code> 会在识别括号的时候重置，而$1仍保存上一次分
组成功的值</li>
</ul>

<p>
第一点，示例可知：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-string">"abcde"</span> =~ /([0-9]*)de/;
<span class="org-builtin">print</span> <span class="org-string">"null group: $1\n"</span>;
</pre>
</div>

<p>
第二点，从机制上去分析。 <code>\1</code> 是每个正则匹配都相互独立的，而 <code>$1</code> 则保
存分组捕获成功的值，即使这次值是上次捕获的。
</p>

<p>
正则匹配的操作如果在列表上下文，则保存各个分组捕获的内容。所以，出于方
便，可以通过下面的方式直接将分组捕获的结果赋值给指定变量：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">date</span> = <span class="org-string">"2018-11-22"</span>;

($<span class="org-variable-name">year</span>,$<span class="org-variable-name">mon</span>,$<span class="org-variable-name">day</span>) = ($<span class="org-variable-name">date</span> =~ /(\d{4})-(\d{2})-(\d{2})/);
</pre>
</div>

<p>
这里稍微解释下正则匹配关于分组捕获的匹配过程：
</p>

<p>
例如，匹配表达式 <code>"12abc22abc" =~ /\d(abc)\d\d\1/;</code> ，当正则引擎去匹配
数据时：
</p>

<ol class="org-ol">
<li>首先匹配第一个数字1，发现符合 <code>\d</code> ，于是继续用 <code>(abc)</code> 去匹配字符串，
因为发现了是分组括号，于是会将第二个字符2放进分组，发现不匹配字母a，
于是匹配失败，丢弃这个分组中的内容。</li>
<li>正则引擎继续向后匹配数值2，发现符合 <code>\d</code> ，于是用 <code>(abc)</code> 去匹配字
符串，接着会将第三个字符a放进分组，发现能匹配，继续匹配字符串中的b、
c发现都能匹配，于是分组捕获完成，将其赋值给 <code>$1</code> ，之后就能用 <code>\1</code>
和 <code>$1</code> 去引用这个分组的内容。</li>
<li>后面继续去匹配 <code>\d\d\1</code> ，直到匹配结束。</li>
</ol>

<p>
当然，具体匹配的过程不会真的这么简单，它会有一些优化匹配方式，以上只是
用逻辑去描述匹配的过程。
</p>
</div>
</li>
<li><a id="h:2f132e98-512c-4405-b2e8-a05c67aa825d"></a><a href="#h:2f132e98-512c-4405-b2e8-a05c67aa825d">perl中更强大的分组捕获</a><br>
<div class="outline-text-6" id="text-h:2f132e98-512c-4405-b2e8-a05c67aa825d">
<p>
在perl中，支持的分组捕获更强大、更完整，它除了支持普通分组(也就是直接
用括号的分组)，还支持：
</p>

<ul class="org-ul">
<li>命名捕获 <code>(?&lt;NAME&gt;...)</code> ：捕获后放进一个已分配好名称(即NAME)的分组中，
以后可以使用这个名称来引用这个分组，如 <code>\g{NAME}</code> 引用</li>
<li>匿名捕获 <code>(?:...)</code> ：仅分组，不捕获，所以后面无法再引用这个捕获</li>
<li>固化分组 <code>(?&gt;...)</code> ：一匹配成功就永不交回内容(用回溯的想法理解很容易)</li>
</ul>

<p>
<b>匿名捕获</b>
</p>

<p>
匿名捕获是指仅分组，不捕获。因为不捕获，所以无法使用反向引用，也不会将
分组结果赋值给 <code>$1</code> 这种特殊变量。
</p>

<p>
虽然有了分组捕获功能，就可以实现任何需求，但有时候可以让这种行为变得更
人性化，减少维护力度。
</p>

<p>
例如字符串”xiaofang or xiaoming”，使用模式 <code>/(\w+) or (\w+)/</code> 去捕获，
用 <code>$1</code> 和 <code>$2</code> 分别引用or左右两个单词：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">str</span> = <span class="org-string">"xiaofang or xiaoming"</span>;
<span class="org-keyword">if</span> ($<span class="org-variable-name">str</span> =~ /(\w+) or (\w+)/){
    <span class="org-builtin">print</span> <span class="org-string">"name1: $1, name2: $2\n"</span>; <span class="org-comment-delimiter">#</span><span class="org-comment">name1: xiaofang, name2: xiaoming
</span>}
</pre>
</div>

<p>
但如果需求是中间的关系or也可以换成and，为了同时满足and和or两种需求，使
用模式 <code>/(\w+) (and|or) (\w+)/</code> 去匹配，但是这时引用的序号就得由 <code>$2</code>
变为 <code>$3</code> ：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">str</span> = <span class="org-string">"xiaofang or xiaoming"</span>;
<span class="org-keyword">if</span> ($<span class="org-variable-name">str</span> =~ /(\w+) (or|and) (\w+)/){
    <span class="org-builtin">print</span> <span class="org-string">"name1: $1, name2: $3\n"</span>;
}
</pre>
</div>

<p>
如果使用匿名捕获，对and和or这样无关紧要，却有可能改变匹配行为的内容，
可以将其放进一个无关的分组中。这样不会对原有的其余正则表达式产生任何影
响：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">str</span> = <span class="org-string">"xiaofang or xiaoming"</span>;
<span class="org-keyword">if</span> ($<span class="org-variable-name">str</span> =~ /(\w+) (?:or|and) (\w+)/){
    <span class="org-builtin">print</span> <span class="org-string">"name1: $1, name2: $2\n"</span>;
}
</pre>
</div>

<p>
注意上面仍然使用 <code>$2</code> 引用第三个括号。
</p>

<p>
同样，如果要在正则内部使用反向引用，也一样使用 <code>\2</code> 来引用第三个括号。
</p>

<p>
另外，在前文还介绍过一个 <code>n</code> 修饰符，它也表示非捕获仅分组行为。但它只
对普通分组有效，对命名分组无效。且因为它是修饰符，它会使所有的普通分组
都变成非捕获模式。
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">str</span> = <span class="org-string">"xiaofang or xiaoming"</span>;
<span class="org-keyword">if</span> ($<span class="org-variable-name">str</span> =~ /(\w+) (or|and) (\w+)/n){
    <span class="org-builtin">print</span> <span class="org-string">"name1: $1, name2: $2\n"</span>;
}
</pre>
</div>

<p>
由于上面开启了n修饰符，使得3个普通分组括号都变成非捕获仅分组行为，所以
<code>\1</code> 和 <code>$1</code> 都无法使用。除非正则中使用了命名分组。
</p>

<p>
<b>命名捕获</b>
</p>

<p>
命名捕获是指将捕获到的内容放进分组，这个分组是有名称的分组，所以后面可
以使用分组名去引用已捕获进这个分组的内容。除此之外，和普通分组并无区别。
</p>

<p>
当要进行命名捕获时，使用 <code>(?&lt;NAME&gt;)</code> 的方式替代以前的分组括号 <code>()</code> 即
可。例如，要匹配abc并将其分组，以前普通分组的方式是 <code>(abc)</code> ，如果将其
放进命名为name1的分组中： <code>(?&lt;name1&gt;abc)</code> 。
</p>

<p>
当使用命名捕获的时候，要在正则内部引用这个命名捕获，除了可以使用序号类
的绝对引用(如 <code>\1</code> 或 <code>\g1</code> 或 <code>\g{1}</code> )，还可以使用以下任意一种按名称
引用方式：
</p>

<ul class="org-ul">
<li><code>\g{NAME}</code></li>
<li><code>\k{NAME}</code></li>
<li><code>\k&lt;NAME&gt;</code></li>
<li><code>\k'NAME'</code></li>
</ul>

<p>
如果要在正则外部引用这个命名捕获，除了可以使用序号类的绝对应用(如 <code>$1</code>
)，还可以使用=$+{NAME}=的方式。
</p>

<p>
实际上，后一种引用方式的本质是perl将命名捕获的内容放进了一个名为 <code>%+</code>
的特殊hash类型中，所以可以使用 <code>$+{NAME}</code> 的方式引用，如果你不知道这一
点，那就无视与此相关的内容即可，不过都很简单，一看就懂。
</p>

<p>
例如：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">str</span> = <span class="org-string">"ma xiaofang or ma xiaoming"</span>;
<span class="org-keyword">if</span> ($<span class="org-variable-name">str</span> =~ /
            (?&lt;firstname&gt;\w+)\s  <span class="org-comment-delimiter"># </span><span class="org-comment">firstname -&gt; ma
</span>            (?&lt;name1&gt;\w+)\s      <span class="org-comment-delimiter"># </span><span class="org-comment">name1 -&gt; xiaofang
</span>            (?:or|and)\s      <span class="org-comment-delimiter"># </span><span class="org-comment">group only, no capture
</span>            \g1\s                <span class="org-comment-delimiter"># </span><span class="org-comment">\g1 -&gt; ma
</span>            (?&lt;name2&gt;\w+)        <span class="org-comment-delimiter"># </span><span class="org-comment">name2 -&gt; xiaoming
</span>            /x){
    <span class="org-builtin">print</span> <span class="org-string">"$1\n"</span>;
    <span class="org-builtin">print</span> <span class="org-string">"$2\n"</span>;
    <span class="org-builtin">print</span> <span class="org-string">"$3\n"</span>;
    <span class="org-comment-delimiter"># </span><span class="org-comment">&#25110;&#32773;&#25351;&#23450;&#21517;&#31216;&#26469;&#24341;&#29992;
</span>    <span class="org-builtin">print</span> <span class="org-string">"$+{firstname}\n$+{name1}\n$+{name2}\n"</span>;
}
</pre>
</div>

<p>
其中上述代码中的 <code>\g1</code> 还可以替换为 <code>\1</code> 、 <code>\g{firstname}</code> 、
<code>\k{firstname}</code> 或 <code>\k&lt;firstname&gt;</code> 。
</p>

<p>
通过使用命名捕获，可以无视序号，直接使用名称即可准确引用。
</p>

<p>
<b>固化分组</b>
</p>

<p>
首先 <b>固化分组不是一种分组，所以无法去引用它</b> 。它和”占有优先”匹配模
式(贪婪匹配、惰性匹配、占有优先匹配三种匹配模式，见后文)是等价的除了这
两种称呼，在不同的书、不同的语言里还有一种称呼：原子匹配。
</p>

<p>
它的表示形式类似于分组 <code>(?&gt;)</code> ，所以有些地方将其称呼为”固化分组”。再
次说明，固化分组不是分组，无法进行引用。如果非要将其看作是分组，可以将
其理解为被限定的匿名分组：不捕获，只分组。
</p>

<ol class="org-ol">
<li>按照”占有优先”的字面意义来理解比较容易：只要匹配成功了，就绝不回
溯。</li>
<li>如果按照固化分组的概念来理解，就是将匹配成功的内容放进分组后，将其
固定，不允许进行回溯。但是需要注意，*这里的不回溯是放进分组中的内容
不会回溯给分组外面，而分组内部的内容是可以回溯的*。</li>
</ol>

<p>
如果不知道什么是回溯，看完下面的例子就明白。
</p>

<p>
例如”hello world”可以被 <code>hel.* world</code> 成功匹配，但不能被 <code>hel(?&gt;.*)
world</code> 匹配。因为正常情况下， <code>.*</code> 匹配到所有内容，然后往回释放已匹配
的内容直到释放完空格为止，这种往回释放字符的行为在正则术语中称为”回
溯”。而固化分组后， <code>.*</code> 已匹配后面所有内容，这些内容一经匹配绝不交回，
即无法回溯。
</p>

<p>
但是，如果正则表达式是 <code>hel(?&gt;.* world)</code> ，即将原来分组外面的内容放进
了分组内部，这时在分组内部是会回溯的，也就是说能匹配”hello world”。
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">str</span>=<span class="org-string">"ma long.xi gao xiaofang"</span>;
<span class="org-keyword">if</span>($<span class="org-variable-name">str</span> =~ /ma (?&gt;long.*)/){     <span class="org-comment-delimiter"># </span><span class="org-comment">&#25104;&#21151;
</span>    <span class="org-builtin">print</span> <span class="org-string">"matched\n"</span>;
}

<span class="org-keyword">if</span>($<span class="org-variable-name">str</span> =~ /ma (?&gt;long.*)gao/){   <span class="org-comment-delimiter"># </span><span class="org-comment">&#22833;&#36133;
</span>    <span class="org-builtin">print</span> <span class="org-string">"matched\n"</span>;
}

<span class="org-keyword">if</span>($<span class="org-variable-name">str</span> =~ /ma (?&gt;long.*gao)/){   <span class="org-comment-delimiter"># </span><span class="org-comment">&#25104;&#21151;
</span>    <span class="org-builtin">print</span> <span class="org-string">"matched\n"</span>;
}

<span class="org-keyword">if</span>($<span class="org-variable-name">str</span> =~ /ma (?&gt;long.*g)ao/){   <span class="org-comment-delimiter"># </span><span class="org-comment">&#25104;&#21151;
</span>    <span class="org-builtin">print</span> <span class="org-string">"matched\n"</span>;
}
</pre>
</div>

<p>
固化分组看上去挺简单的，此处也仅介绍了它最简单的形式。但实际上固化分组
很复杂，它涉及了非常复杂的正则引擎匹配原理和回溯机制。如果有兴趣，可以
阅读《精通正则表达式》一书的第四章。
</p>
</div>
</li>
</ul>
</div>
<div id="outline-container-h:f5d908cc-7138-4a32-bde1-5fa5fe4350c2" class="outline-5">
<h5 id="h:f5d908cc-7138-4a32-bde1-5fa5fe4350c2"><a href="#h:f5d908cc-7138-4a32-bde1-5fa5fe4350c2">环视锚定(断言)</a></h5>
<div class="outline-text-5" id="text-h:f5d908cc-7138-4a32-bde1-5fa5fe4350c2">
<p>
"环视"锚定，即lookaround anchor，也称为”零宽断言”，它表示匹配的是位
置，不是字符。
</p>

<pre class="example" id="org8112a02">
- (?=...) 表示从左向右的顺序环视。例如 (?=\d) 表示当前字符的右边是一个数字时就满足条件
- (?!...) 表示顺序环视的取反。如 (?!\d) 表示当前字符的右边不是一个数字时就满足条件
- (?&lt;=...) 表示从右向左的逆序环视。例如 (?&lt;=\d) 表示当前字符的左边是一个数字时就满足条件
- (?&lt;!)...  表示逆序环视的取反。如 (?&lt;!\d) 表示当前字符的左边不是一个数字时就满足条件
</pre>

<p>
关于”环视”锚定，最需要注意的一点是匹配的结果不占用任何字符，它仅仅只是锚定位置。所以断言只是个条件。
</p>

<p>
例如”your name is xiaoming MA”和”your name is longfei MA”。使用
<code>(?=xiaoming)</code> 将能锚定第一个句子中单词”xiaoming”前面的空字符，但它
的匹配结果是”xiaoming”前的空白字符，所以 <code>(?=xiaoming)xiao</code> 才能代
表”xiao”这几个字符串，所以仅对于此处的两个句子， <code>xiao(?=ming)</code> 和
<code>(?=xiaoming)xiao</code> 是等价的。
</p>

<p>
一般为了方便理解，在顺序环视的时候会将匹配内容放在锚定括号的左边(如
<code>xiao(?=xiaoming)</code> )，在逆序环视的时候会将匹配的内容放在锚定括号的右边
(如 <code>(?&lt;=xiao)ming</code> )。
</p>

<p>
另外，无论是哪种锚定，都是从左向右匹配再做回溯的(假设允许回溯)，即使是
逆序环视。
</p>

<p>
例如：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">str</span>=<span class="org-string">"abc123abcc12c34"</span>;

<span class="org-comment-delimiter"># </span><span class="org-comment">&#39034;&#24207;&#29615;&#35270;
</span>$<span class="org-variable-name">str</span> =~ /a.*c(?=\d)/;     <span class="org-comment-delimiter"># </span><span class="org-comment">abc123abcc12c
</span><span class="org-builtin">print</span> <span class="org-string">"$&amp;\n"</span>;

<span class="org-comment-delimiter"># </span><span class="org-comment">&#39034;&#24207;&#21542;&#23450;&#29615;&#35270;
</span>$<span class="org-variable-name">str</span> =~ /a.*c(?!\d)/;     <span class="org-comment-delimiter"># </span><span class="org-comment">abc123abc
</span><span class="org-builtin">print</span> <span class="org-string">"$&amp;\n"</span>;

<span class="org-comment-delimiter"># </span><span class="org-comment">&#36870;&#24207;&#29615;&#35270;&#65292;&#36825;&#37324;&#33021;&#36870;&#24207;&#21305;&#37197;&#25104;&#21151;&#65292;&#38752;&#30340;&#26159;&#38170;&#23450;&#25324;&#21495;&#21518;&#38754;&#30340;c
</span>$<span class="org-variable-name">str</span> =~ /a.*(?&lt;=\d)c/;    <span class="org-comment-delimiter"># </span><span class="org-comment">abc123abcc12c
</span><span class="org-builtin">print</span> <span class="org-string">"$&amp;\n"</span>;

<span class="org-comment-delimiter"># </span><span class="org-comment">&#36870;&#24207;&#21542;&#23450;&#29615;&#35270;
</span>$<span class="org-variable-name">str</span> =~ /a.*(?&lt;!\d)c/;    <span class="org-comment-delimiter"># </span><span class="org-comment">abc123abcc
</span><span class="org-builtin">print</span> <span class="org-string">"$&amp;\n"</span>;
</pre>
</div>

<p>
逆序环视的表达式必须只能表示固定长度的字符串。例如 <code>(?&lt;=word)</code> 或
<code>(?&lt;=word|word)</code> 可以，但 <code>(?&lt;=word?)</code> 不可以，因为 <code>?</code> 匹配0或1长度，
长度不定，它无法对左边是word还是wordx做正确判断。
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">str</span>=<span class="org-string">"hello worlds Gaoxiaofang"</span>;
$<span class="org-variable-name">str</span> =~ /he.*(?&lt;=worlds?) Gao/;         <span class="org-comment-delimiter"># </span><span class="org-comment">&#25253;&#38169;
</span>$<span class="org-variable-name">str</span> =~ /he.*(?&lt;=worlds|world) Gao/;    <span class="org-comment-delimiter"># </span><span class="org-comment">&#25253;&#38169;</span>
</pre>
</div>

<p>
在PCRE中，这种变长的逆序环视锚定可重写为 <code>(?&lt;=word|words)</code> ，但perl中
不允许，因为perl严格要求长度必须固定。
</p>
</div>
</div>
<div id="outline-container-h:e0859264-62af-4112-8e1a-7b39cabc3c5a" class="outline-5">
<h5 id="h:e0859264-62af-4112-8e1a-7b39cabc3c5a"><a href="#h:e0859264-62af-4112-8e1a-7b39cabc3c5a">\Q&#x2026;\E</a></h5>
<div class="outline-text-5" id="text-h:e0859264-62af-4112-8e1a-7b39cabc3c5a">
<p>
perl中的 <code>\Q...\E</code> 用来强制包围一段字符，使得里面的正则符号都当做普通
字符，不会有特殊意义，它是一种非常强的引用。但注意，它无法强制变量的替
换。
</p>

<p>
例如：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">sub</span>=<span class="org-string">"world"</span>;
$<span class="org-variable-name">str</span>=<span class="org-string">"hello worlds gaoxiaofang"</span>;
$<span class="org-variable-name">str</span> =~ /\Q$<span class="org-variable-name">sub</span>\E/;  <span class="org-comment-delimiter"># </span><span class="org-comment">$sub&#20250;&#26367;&#25442;&#65292;&#25152;&#20197;&#21305;&#37197;&#25104;&#21151;world
</span>$<span class="org-variable-name">str</span> =~ /\Q$<span class="org-variable-name">sub</span>.\E/; <span class="org-comment-delimiter"># </span><span class="org-comment">&#20803;&#23383;&#31526;"."&#34987;&#24403;&#20570;&#26222;&#36890;&#30340;&#23383;&#31526;&#65292;&#25152;&#20197;&#26080;&#27861;&#21305;&#37197;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:493838d5-ac4a-4579-ac53-117d69da255b" class="outline-4">
<h4 id="h:493838d5-ac4a-4579-ac53-117d69da255b"><a href="#h:493838d5-ac4a-4579-ac53-117d69da255b">qr//创建正则对象</a></h4>
<div class="outline-text-4" id="text-h:493838d5-ac4a-4579-ac53-117d69da255b">
<p>
因为可以在正则模式中使用变量替换，所以我们可以将正则中的一部分表达式事
先保存在变量中。例如：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">str</span>=<span class="org-string">"hello worlds gaoxiaofang"</span>;
$<span class="org-variable-name">pattern</span>=<span class="org-string">"w.*d"</span>;
$<span class="org-variable-name">str</span> =~ /$<span class="org-variable-name">pattern</span>/;
<span class="org-builtin">print</span> <span class="org-string">"$&amp;\n"</span>;
</pre>
</div>

<p>
但是，这样缺陷很大，在保存正则表达式的变量中存放的特殊字符要防止有特殊
意义。例如，当使用 <code>m//</code> 的方式做匹配分隔符时，不能在变量中保存 <code>/</code> ，
除非转义。
</p>

<p>
perl提供了 <code>qr/pattern/</code> 的功能，它把pattern部分构建成一个正则表达式对
象，然后就可以在正则表达式中直接引用这个对象，更方便的是可以将这个对象
保存到变量中，通过引用变量的方式来引用这个已保存好的正则对象。
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">str</span>=<span class="org-string">"hello worlds gaoxiaofang"</span>;

<span class="org-comment-delimiter"># </span><span class="org-comment">&#30452;&#25509;&#20316;&#20026;&#27491;&#21017;&#34920;&#36798;&#24335;
</span>$<span class="org-variable-name">str</span> =~ qr/w.*d/;
<span class="org-builtin">print</span> <span class="org-string">"$&amp;\n"</span>; <span class="org-comment-delimiter">#</span><span class="org-comment">world
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">&#20445;&#23384;&#20026;&#21464;&#37327;&#65292;&#20877;&#20316;&#20026;&#27491;&#21017;&#34920;&#36798;&#24335;
</span>$<span class="org-variable-name">pattern</span>=qr/w.*d/;
$<span class="org-variable-name">str</span> =~ $<span class="org-variable-name">pattern</span>;    <span class="org-comment-delimiter"># </span><span class="org-comment">(1)
</span>$<span class="org-variable-name">str</span> =~ /$<span class="org-variable-name">pattern</span>/;  <span class="org-comment-delimiter"># </span><span class="org-comment">(2)
</span><span class="org-builtin">print</span> <span class="org-string">"$&amp;\n"</span>; <span class="org-comment-delimiter">#</span><span class="org-comment">world
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">&#20445;&#23384;&#20026;&#21464;&#37327;&#65292;&#20316;&#20026;&#27491;&#21017;&#34920;&#36798;&#24335;&#30340;&#19968;&#37096;&#20998;
</span>$<span class="org-variable-name">pattern</span>=qr/w.*d/;
$<span class="org-variable-name">str</span> =~ /hel.* $<span class="org-variable-name">pattern</span>/;
<span class="org-builtin">print</span> <span class="org-string">"$&amp;\n"</span>; <span class="org-comment-delimiter">#</span><span class="org-comment">hello world</span>
</pre>
</div>

<p>
还允许为这个正则对象设置修饰符，比如忽略大小写的匹配修饰符为i，这样在
真正匹配的时候，就只有这一部分正则对象会忽略大小写，其余部分仍然区分大
小写。
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">str</span>=<span class="org-string">"HELLO wORLDs gaoxiaofang"</span>;

$<span class="org-variable-name">pattern</span>=qr/w.*d/i;         <span class="org-comment-delimiter"># </span><span class="org-comment">&#24573;&#30053;&#22823;&#23567;&#20889;
</span>
$<span class="org-variable-name">str</span> =~ /HEL.* $<span class="org-variable-name">pattern</span>/;   <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;&#25104;&#21151;&#65292;$pattern&#37096;&#20998;&#24573;&#30053;&#22823;&#23567;&#20889;
</span>$<span class="org-variable-name">str</span> =~ /hel.* $<span class="org-variable-name">pattern</span>/;   <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;&#22833;&#36133;
</span>$<span class="org-variable-name">str</span> =~ /hel.* $<span class="org-variable-name">pattern</span>/i;  <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;&#25104;&#21151;&#65292;&#25152;&#26377;&#37117;&#24573;&#30053;&#22823;&#23567;&#20889;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:e434eaf8-d7be-4a73-a104-dc8564d0a1f0" class="outline-3">
<h3 id="h:e434eaf8-d7be-4a73-a104-dc8564d0a1f0"><a href="#h:e434eaf8-d7be-4a73-a104-dc8564d0a1f0">引擎选项</a></h3>
<div class="outline-text-3" id="text-h:e434eaf8-d7be-4a73-a104-dc8564d0a1f0">
<ul class="org-ul">
<li>默认模式：将整个测试字符串看做一个一行的大字符串，.不能代表\n</li>
<li>单行模式：将整个测试字符串看做一个一行的大字符串，.可以匹配\n</li>
<li>多行模式：终于可以把一行大字符串用\n分割成多行，^指的是行首，$行尾，.行为不变</li>
</ul>

<p>
范例
</p>
<div class="org-src-container">
<pre class="src src-sh">so very very sorry
vys ray

v.*y &#21305;&#37197;&#65292;&#25972;&#20010;&#30475;&#20570;&#19968;&#34892;&#65292;&#20174;very &#21040;sorry&#65292;&#36935;&#21040;\n&#19981;&#33021;&#31361;&#30772;&#65292;&#21518;&#38754;&#20877;&#21305;&#37197;vys ray
<span class="org-variable-name">so</span> =very very <span class="org-variable-name">sorry</span>=
=vys <span class="org-variable-name">ray</span>=

v.*y &#21333;&#34892;&#27169;&#24335;&#21305;&#37197;&#65292;&#21487;&#20197;&#31361;&#30772;\n
=very very sooryvys <span class="org-variable-name">ray</span>=

^v.*y &#21333;&#34892;&#27169;&#24335;&#21305;&#37197;&#12290; &#31354;
^v.*y &#40664;&#35748;&#21305;&#37197;&#12290; &#31354;

v.*y &#22810;&#34892;&#27169;&#24335;&#21305;&#37197;
<span class="org-variable-name">so</span> =very very <span class="org-variable-name">sorry</span>=
=vys <span class="org-variable-name">ray</span>=

^v.*y &#22810;&#34892;&#27169;&#24335;&#21305;&#37197;
=vys <span class="org-variable-name">ray</span>=

^v.*y &#21333;&#34892;&#21644;&#22810;&#34892;&#27169;&#24335;&#21305;&#37197;
=vys <span class="org-variable-name">ray</span>=

^v.*y$ &#21333;&#34892;&#27169;&#24335;&#21305;&#37197;&#12290; &#31354;
</pre>
</div>
</div>
<div id="outline-container-h:4d6ea5ec-819f-4099-8eab-c0e890adde2a" class="outline-4">
<h4 id="h:4d6ea5ec-819f-4099-8eab-c0e890adde2a"><a href="#h:4d6ea5ec-819f-4099-8eab-c0e890adde2a">匹配范例</a></h4>
<div class="outline-text-4" id="text-h:4d6ea5ec-819f-4099-8eab-c0e890adde2a">
<p>
java业务日志
</p>
<div class="org-src-container">
<pre class="src src-sh">2025-05-19 11:09:47.441  INFO 8 --- [ XNIO-2 task-36] c.r.a.s.a.impl.SeaAppVersionServiceImpl  82 : APP_VERSION_CACHE <span class="org-variable-name">&#25191;&#34892;&#32791;&#26102;</span>=5ms
2025-05-19 11:02:41.120  INFO 8 --- [nio-1050-exec-2] .r.m.w.s.s.i.UserSignInRecordServiceImpl 162 : signDateasdads:true
2026-01-12 17:08:35.904  INFO 8 --- [ XNIO-2 task-15] com.rl.gateway.filter.LogFilter          : <span class="org-variable-name">doFilter</span>==============<span class="org-variable-name">end</span>================

<span class="org-comment-delimiter">#</span><span class="org-comment">&#22810;&#34892;&#21512;&#24182;
</span>^\d+-\d+-\d+.*

<span class="org-comment-delimiter">#</span><span class="org-comment">&#26085;&#24535;&#26684;&#24335;&#21270;
</span>(\S+ \S+[\d.]+)\s+(\S+)\s+(\d{1,2})\s+---\s+<span class="org-string">\[</span>\s{0,}(.*)?<span class="org-string">\]</span>\s+(\S+)\s+(\d{1,4})?\s+:\s+(.*)

<span class="org-comment-delimiter">#</span><span class="org-comment">&#27880;&#24847;&#22810;&#34892;&#21305;&#37197;&#38382;&#39064;&#12290;&#19981;&#33021;&#36825;&#26679;&#20889;
</span><span class="org-comment-delimiter">#</span><span class="org-comment">(\S+ \S+[\d.]+)\s+(\S+)\s+(\d{1,2})\s+---\s+\[\s{0,}([\s\S]+)?\]\s+(\S+)\s+(\d{1,4})\s+:\s+(.*)
</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">&#21305;&#37197;&#32452;&#21629;&#21517;
</span><span class="org-builtin">time</span>
level
pid
thread-name
logger
line
msg
</pre>
</div>


<figure id="org3ba8dc8">
<img src="././images/img_20250519_113222.png" alt="img_20250519_113222.png" width="50%">

</figure>
</div>
</div>
</div>
</section>
<section id="outline-container-h:5c8deae3-a8b3-4a3a-9ce4-29a9d9f6bdb2" class="outline-2">
<h2 id="h:5c8deae3-a8b3-4a3a-9ce4-29a9d9f6bdb2"><a href="#h:5c8deae3-a8b3-4a3a-9ce4-29a9d9f6bdb2">文本处理三剑客</a></h2>
<div class="outline-text-2" id="text-h:5c8deae3-a8b3-4a3a-9ce4-29a9d9f6bdb2">
<ul class="org-ul">
<li>grep 命令主要对文本的（正则表达式）行基于模式进行过滤</li>
<li>sed：stream editor，文本编辑工具</li>
<li>awk：Linux上的实现gawk，文本报告生成器</li>
</ul>
</div>
<div id="outline-container-h:57a1c4cb-314c-4ee9-b6ae-30fe057df04a" class="outline-3">
<h3 id="h:57a1c4cb-314c-4ee9-b6ae-30fe057df04a"><a href="#h:57a1c4cb-314c-4ee9-b6ae-30fe057df04a">文本处理三剑客之 grep</a></h3>
<div class="outline-text-3" id="text-h:57a1c4cb-314c-4ee9-b6ae-30fe057df04a">
<p>
grep: Global search REgular expression and Print out the line
</p>

<p>
作用：文本搜索工具，根据用户指定的“模式”对目标文本逐行进行匹配检查；
打印匹配到的行
</p>

<p>
模式：由正则表达式字符及文本字符所编写的过滤条件
</p>

<p>
格式： grep [OPTIONS] PATTERN [FILE&#x2026;]
</p>

<p>
常见选项：
</p>

<div class="org-src-container">
<pre class="src src-sh">--color=auto &#23545;&#21305;&#37197;&#21040;&#30340;&#25991;&#26412;&#30528;&#33394;&#26174;&#31034;
-m <span class="org-comment-delimiter"># </span><span class="org-comment">&#21305;&#37197;#&#27425;&#21518;&#20572;&#27490;
</span>-v &#26174;&#31034;&#19981;&#34987;pattern&#21305;&#37197;&#21040;&#30340;&#34892;
-i &#24573;&#30053;&#23383;&#31526;&#22823;&#23567;&#20889;
-n &#26174;&#31034;&#21305;&#37197;&#30340;&#34892;&#21495;
-c &#32479;&#35745;&#21305;&#37197;&#30340;&#34892;&#25968;
-l : &#21482;&#26174;&#31034;&#21305;&#37197;&#21040;&#30340;&#25991;&#20214;&#21517;
-o &#20165;&#26174;&#31034;&#21305;&#37197;&#21040;&#30340;&#23383;&#31526;&#20018;
-o -b : &#26174;&#31034;&#21305;&#37197;&#30340;&#20301;&#32622;
-q &#38745;&#40664;&#27169;&#24335;&#65292;&#19981;&#36755;&#20986;&#20219;&#20309;&#20449;&#24687;
-A <span class="org-comment-delimiter"># </span><span class="org-comment">after, &#21518;#&#34892;
</span>-B <span class="org-comment-delimiter"># </span><span class="org-comment">before, &#21069;#&#34892;
</span>-C <span class="org-comment-delimiter"># </span><span class="org-comment">context, &#21069;&#21518;&#21508;#&#34892;
</span>-e &#23454;&#29616;&#22810;&#20010;&#36873;&#39033;&#38388;&#30340;&#36923;&#36753;or&#20851;&#31995;,&#22914;&#65306;grep &#8211;e &#8216;cat &#8217; -e &#8216;dog&#8217; file
-w &#21305;&#37197;&#25972;&#20010;&#21333;&#35789;
-E &#20351;&#29992;ERE&#65292;&#30456;&#24403;&#20110;egrep
-F &#19981;&#25903;&#25345;&#27491;&#21017;&#34920;&#36798;&#24335;&#65292;&#30456;&#24403;&#20110;fgrep
-f file &#26681;&#25454;&#27169;&#24335;&#25991;&#20214;&#22788;&#29702;
-r &#36882;&#24402;&#30446;&#24405;&#65292;&#20294;&#19981;&#22788;&#29702;&#36719;&#38142;&#25509;
-R &#36882;&#24402;&#30446;&#24405;&#65292;&#20294;&#22788;&#29702;&#36719;&#38142;&#25509;
-s &#22914;&#26524;&#36807;&#28388;&#21040;&#19981;&#26159;&#25991;&#26412;&#25991;&#20214;&#20250;&#25253;&#38169;&#65292;&#21152;&#27492;&#36873;&#39033;&#19981;&#26174;&#31034;&#38169;&#35823;&#20449;&#24687;

--line-buffered  &#27599;&#36755;&#20986;&#19968;&#34892;,&#23601;&#21047;&#26032;&#19968;&#27425;
-P : &#21487;&#20197;&#35753;grep&#20351;&#29992;perl&#30340;&#27491;&#21017;&#34920;&#36798;&#24335;&#35821;&#27861;. &#21305;&#37197;&#20013;&#25991; grep -P <span class="org-string">'[\x{4e00}-\x{9f5a}]'</span> xx.log
</pre>
</div>

<p>
范例：过滤目录，查找隐藏目录用 . 点号，* 星号无法找到隐藏文件
</p>

<div class="org-src-container">
<pre class="src src-sh">grep --exclude-dir=<span class="org-string">".git"</span> --exclude-dir=<span class="org-string">".svn"</span> -rns test .
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">grep root /etc/passwd
grep <span class="org-string">"USER"</span> /etc/passwd
grep <span class="org-string">'USER'</span> /etc/passwd
grep whoami /etc/passwd
</pre>
</div>

<p>
范例：取两个文件的相同行
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /data/f1.txt
a
b
1
c
[root@centos8 ~]#cat /data/f2.txt
b
e
f
c
1
2
[root@centos8 ~]#grep -f /data/f1.txt /data/f2.txt
b
c
1
<span class="org-comment-delimiter">#</span><span class="org-comment">&#21462;&#25991;&#20214;&#30340;&#20849;&#21516;&#34892;
</span>[root@centos8 data]#cat test1.txt test2.txt | sort |uniq -d
1
b
c
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">df | grep <span class="org-string">'^/dev/sd'</span> |tr -s <span class="org-string">' '</span> %|cut -d% -f5|sort -n|tail -1
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#ss -nt | grep <span class="org-string">"^ESTAB"</span> |tr -s <span class="org-string">' '</span> : |cut -d: -f6|sort |uniq -
c|sort -nr|head -n3
   3 10.0.0.1
   1 172.16.4.100
   1 172.16.31.188
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#grep -v <span class="org-string">"^#"</span> /etc/profile | grep -v <span class="org-string">'^$'</span>
[root@centos8 ~]#grep -v <span class="org-string">"^#\|^$"</span> /etc/profile
[root@centos8 ~]#grep -v <span class="org-string">"^\(#\|$\)"</span> /etc/profile
[root@centos8 ~]#grep -Ev <span class="org-string">"^(#|$)"</span> /etc/profile
[root@centos8 ~]#egrep -v <span class="org-string">"^(#|$)"</span> /etc/profile
[root@centos6 ~]#egrep -v <span class="org-string">'^(#|$)'</span> /etc/httpd/conf/httpd.conf
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#grep -o <span class="org-string">'r..t'</span> /etc/passwd
root
root
root
root
r/ft
rypt
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#ifconfig | grep -E <span class="org-string">'[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}'</span>
   inet 10.0.0.8 netmask 255.255.255.0 broadcast 10.0.0.255
   inet 172.16.0.123 netmask 255.255.0.0 broadcast 172.16.255.255
   inet6 fe80::c11e:4792:7e77:12a4 prefixlen 64 scopeid 0x20&lt;link&gt;
   inet 127.0.0.1 netmask 255.0.0.0
[root@centos8 ~]#ifconfig | grep -E <span class="org-string">'([0-9]{1,3}.){3}[0-9]{1,3}'</span>
   inet 10.0.0.8 netmask 255.255.255.0 broadcast 10.0.0.255
   inet 172.16.0.123 netmask 255.255.0.0 broadcast 172.16.255.255
   inet6 fe80::c11e:4792:7e77:12a4 prefixlen 64 scopeid 0x20&lt;link&gt;
   inet 127.0.0.1 netmask 255.0.0.0

[root@centos8 ~]#ifconfig eth0 | grep -Eo <span class="org-string">'([0-9]{1,3}\.){3}[0-9]{1,3}'</span>|head -1
10.0.0.8

[root@centos8 ~]#cat regex.txt
([0-9]{1,3}<span class="org-string">\.</span>){3}[0-9]{1,3}
[root@centos8 ~]#ifconfig | grep -oEf regex.txt
10.0.0.8
255.255.255.0
10.0.0.255
127.0.0.1
255.0.0.0
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#grep -E <span class="org-string">'root|bash'</span> /etc/passwd
root:x:0:0:root:/root:/bin/bash
operator:x:11:0:operator:/root:/sbin/nologin
wang:x:1000:1000:wang:/home/wang:/bin/bash
cici:x:1001:1001::/home/cici:/bin/bash
xiaoming:x:1002:1002::/home/xiaoming:/bin/bash
roob:x:1003:1003::/home/roob:/bin/bash

[root@centos8 ~]#grep -e <span class="org-string">'root'</span> -e <span class="org-string">'bash'</span> /etc/passwd
root:x:0:0:root:/root:/bin/bash
operator:x:11:0:operator:/root:/sbin/nologin
wang:x:1000:1000:wang:/home/wang:/bin/bash
cici:x:1001:1001::/home/cici:/bin/bash
xiaoming:x:1002:1002::/home/xiaoming:/b
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#grep -w root /etc/passwd
root:x:0:0:root:/root:/bin/bash
operator:x:11:0:operator:/root:/sbin/nologin
[root@centos8 ~]#grep <span class="org-string">'\&lt;root\&gt;'</span> /etc/passwd
root:x:0:0:root:/root:/bin/bash
operator:x:11:0:operator:/root:/sbin/nologin
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#grep <span class="org-string">"^\(.*\)\&gt;.*\&lt;\1$"</span> /etc/passwd
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
bash:x:1008:1008::/home/bash:/bin/bash
nologin:x:1011:1011::/home/nologin:/sbin/nologin

[root@centos8 ~]#grep -E <span class="org-string">"^(.*)\&gt;.*\&lt;\1$"</span> /etc/passwd
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
bash:x:1008:1008::/home/bash:/bin/bash
nologin:x:1011:1011::/home/nologin:/sbin/nologin

[root@centos8 ~]#egrep <span class="org-string">"^(.*)\&gt;.*\&lt;\1$"</span> /etc/passwd
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
bash:x:1008:1008::/home/bash:/bin/bash
nologin:x:1011:1011::/home/nologin:/sbin/nologin
</pre>
</div>

<p>
范例：面试题，算出所有人的年龄总和
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /data/nianling.txt
<span class="org-variable-name">xiaoming</span>=20
<span class="org-variable-name">xiaohong</span>=18
<span class="org-variable-name">xiaoqiang</span>=22
[root@centos8 ~]#cut -d<span class="org-string">"="</span> -f2 /data/nianling.txt|tr <span class="org-string">'\n'</span> + | grep -Eo <span class="org-string">".*[0-9]"</span>|bc
60
[root@centos8 ~]#grep -Eo <span class="org-string">"[0-9]+"</span> /data/nianling.txt | tr <span class="org-string">'\n'</span> + | grep -Eo <span class="org-string">".*[0-9]"</span>|bc
60
</pre>
</div>

<p>
fgrep 命令
</p>

<p>
不支持正则表达式元字符；都当作字符本身的意义
</p>

<p>
当无需用到元字符去编写模式时，使用 fgrep性能更好；搜索几十万行、百万行
性能就发挥出来了
</p>

<ul class="org-ul">
<li>-E : 支持使用扩展的正则表达式元字符</li>
<li>-G：支持基本正则表达式</li>
</ul>
</div>
<div id="outline-container-h:00fee694-6056-44dd-9e0e-365be6b31f8a" class="outline-4">
<h4 id="h:00fee694-6056-44dd-9e0e-365be6b31f8a"><a href="#h:00fee694-6056-44dd-9e0e-365be6b31f8a">匹配中文</a></h4>
<div class="outline-text-4" id="text-h:00fee694-6056-44dd-9e0e-365be6b31f8a">
<p>
匹配： grep
</p>

<div class="org-src-container">
<pre class="src src-sh">grep -P <span class="org-string">'[\x{4e00}-\x{9f5a}]'</span> xx.log
rg <span class="org-string">'[\x{4e00}-\x{9f5a}]'</span>  xx.log <span class="org-comment-delimiter"># </span><span class="org-comment">rigrep -l &#26174;&#31034;&#25991;&#20214;
</span>perl -CSD -ne  <span class="org-string">'print if /[\x{4e00}-\x{9fa5}]/'</span> xx.log
</pre>
</div>

<p>
匹配并删除 sed 命令：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">LANG</span>=C sed -i -e <span class="org-string">'s/[\x80-\xFF]//g'</span> -i filename.txt
</pre>
</div>

<p>
该命令中，LANG=C 表示设置字符集为 C 语言标准字符集，可以匹配 ASCII 和
非ASCII 字符。-i 选项表示直接修改源文件，s 命令表示替换操作，
[\x80-\xFF]表示匹配所有非 ASCII 字符，//g 表示删除所有匹配到的字符。
</p>

<p>
perl 命令：
</p>

<div class="org-src-container">
<pre class="src src-sh">perl -CSD -pe <span class="org-string">'s/[\x{4e00}-\x{9fa5}]//g'</span> -i AppConfig.java
</pre>
</div>

<p>
这里的 -CSD 参数告诉 Perl 支持 Unicode 编码，-i 参数表示直接修改原始文件
</p>
</div>
</div>
<div id="outline-container-h:1d530be4-3dcb-41ca-98ee-1e1273b34f4a" class="outline-4">
<h4 id="h:1d530be4-3dcb-41ca-98ee-1e1273b34f4a"><a href="#h:1d530be4-3dcb-41ca-98ee-1e1273b34f4a">rg</a></h4>
<div class="outline-text-4" id="text-h:1d530be4-3dcb-41ca-98ee-1e1273b34f4a">
<p>
<a href="https://github.com/BurntSushi/ripgrep">https://github.com/BurntSushi/ripgrep</a>
</p>

<div class="org-src-container">
<pre class="src src-sh">sudo yum-config-manager --add-repo=https://copr.fedorainfracloud.org/coprs/carlwgeorge/ripgrep/repo/epel-7/carlwgeorge-ripgrep-epel-7.repo
sudo yum install ripgrep
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:00eb27fd-d142-46ea-bf47-cbe2beac358b" class="outline-3">
<h3 id="h:00eb27fd-d142-46ea-bf47-cbe2beac358b"><a href="#h:00eb27fd-d142-46ea-bf47-cbe2beac358b">文本处理三剑客之 sed</a></h3>
<div class="outline-text-3" id="text-h:00eb27fd-d142-46ea-bf47-cbe2beac358b">
</div>
<div id="outline-container-h:6f10afc3-f395-4f9a-9b3a-7b777d15bc3b" class="outline-4">
<h4 id="h:6f10afc3-f395-4f9a-9b3a-7b777d15bc3b"><a href="#h:6f10afc3-f395-4f9a-9b3a-7b777d15bc3b">工作原理</a></h4>
<div class="outline-text-4" id="text-h:6f10afc3-f395-4f9a-9b3a-7b777d15bc3b">
<p>
sed 即 Stream EDitor，和 vi 不同，sed是行编辑器
</p>


<figure id="org7af0935">
<img src="././images/image-20210216003203295.png" alt="image-20210216003203295.png" width="50%">

</figure>


<figure id="org005a00b">
<img src="././images/image-20210216003237510.png" alt="image-20210216003237510.png" width="50%">

</figure>

<p>
Sed是从文件或管道中读取一行，处理一行，输出一行；再读取一行，再处理一
行，再输出一行，直到最后一行。
</p>

<ul class="org-ul">
<li>每当处理一行时，把当前处理的行存储在临时缓冲区中，称为 <code>模式空间
  （PatternSpace）</code> ，接着用sed命令处理缓冲区中的内容，处理完成后，把
缓冲区的内容送往屏幕。</li>
<li>接着处理下一行，这样不断重复，直到文件末尾。一次处理一行的设计模式使
得sed性能很高，sed在读取大文件时不会出现卡顿的现象。</li>
</ul>

<p>
如果使用vi命令打开几十M上百M的文件，明显会出现有卡顿的现象，这是因为vi
命令打开文件是一次性将文件加载到内存，然后再打开。Sed就避免了这种情况，
一行一行的处理，打开速度非常快，执行速度也很快
</p>

<p>
参考网站：&lt;<a href="http://www.gnu.org/software/sed/manual/sed.html">http://www.gnu.org/software/sed/manual/sed.html</a>&gt;
</p>
</div>
</div>
<div id="outline-container-h:eb4916ae-7aad-49d0-8914-c1a90dde075b" class="outline-4">
<h4 id="h:eb4916ae-7aad-49d0-8914-c1a90dde075b"><a href="#h:eb4916ae-7aad-49d0-8914-c1a90dde075b">sed 基本用法</a></h4>
<div class="outline-text-4" id="text-h:eb4916ae-7aad-49d0-8914-c1a90dde075b">
<p>
格式： 
</p>
<div class="org-src-container">
<pre class="src src-sh">sed [option]... <span class="org-string">'script;script;...'</span> inputfile...

&#24120;&#29992;&#36873;&#39033;&#65306;
-n                                   <span class="org-comment-delimiter">#</span><span class="org-comment">&#19981;&#36755;&#20986;&#27169;&#24335;&#31354;&#38388;&#20869;&#23481;&#21040;&#23631;&#24149;&#65292;&#21363;&#19981;&#33258;&#21160;&#25171;&#21360;
</span>-e                                   <span class="org-comment-delimiter">#</span><span class="org-comment">&#22810;&#28857;&#32534;&#36753;&#65292;&#34920;&#31034;&#25110;&#32773;
</span>-f /PATH/SCRIPT_FILE <span class="org-comment-delimiter">#</span><span class="org-comment">&#20174;&#25351;&#23450;&#25991;&#20214;&#20013;&#35835;&#21462;&#32534;&#36753;&#33050;&#26412;
</span>-r, -E                              <span class="org-comment-delimiter">#</span><span class="org-comment">&#20351;&#29992;&#25193;&#23637;&#27491;&#21017;&#34920;&#36798;&#24335;
</span>-i.bak                             <span class="org-comment-delimiter">#</span><span class="org-comment">&#22791;&#20221;&#25991;&#20214;&#24182;&#21407;&#22788;&#32534;&#36753;
</span>-s                                   <span class="org-comment-delimiter">#</span><span class="org-comment">&#23558;&#22810;&#20010;&#25991;&#20214;&#35270;&#20026;&#29420;&#31435;&#25991;&#20214;&#65292;&#32780;&#19981;&#26159;&#21333;&#20010;&#36830;&#32493;&#30340;&#38271;&#25991;&#20214;&#27969;
</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">&#35828;&#26126;
</span>-ir  &#19981;&#25903;&#25345;
-i -r  &#25903;&#25345;
-ri    &#25903;&#25345;
-ni   &#21361;&#38505;&#36873;&#39033;&#65292;&#20250;&#28165;&#31354;&#25991;&#20214;
</pre>
</div>

<p>
<b>script格式：</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-string">'&#22320;&#22336;&#21629;&#20196;'</span>
</pre>
</div>

<p>
<b>地址格式：</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">1. &#19981;&#32473;&#22320;&#22336;&#65306;&#23545;&#20840;&#25991;&#36827;&#34892;&#22788;&#29702;
2. &#21333;&#22320;&#22336;&#65306;
    <span class="org-comment-delimiter">#</span><span class="org-comment">&#65306;&#25351;&#23450;&#30340;&#34892;&#65292;$&#65306;&#26368;&#21518;&#19968;&#34892;
</span>    /pattern/&#65306;&#34987;&#27492;&#22788;&#27169;&#24335;&#25152;&#33021;&#22815;&#21305;&#37197;&#21040;&#30340;&#27599;&#19968;&#34892;
3. &#22320;&#22336;&#33539;&#22260;&#65306;
    <span class="org-comment-delimiter">#</span><span class="org-comment">,#   #&#20174;#&#34892;&#21040;&#31532;#&#34892;&#65292;3&#65292;6 &#20174;&#31532;3&#34892;&#21040;&#31532;6&#34892;
</span>    <span class="org-comment-delimiter">#</span><span class="org-comment">,+#  #&#20174;#&#34892;&#21040;+#&#34892;&#65292;3,+4 &#34920;&#31034;&#20174;3&#34892;&#21040;&#31532;7&#34892;
</span>    /pat1/,/pat2/ &#20174;&#31532;&#19968;&#27425;&#21305;&#37197;&#21040;&#30340;&#27169;&#24335;1&#21040;&#31532;&#20108;&#27425;&#21305;&#37197;&#21040;&#27169;&#24335;2
    <span class="org-comment-delimiter">#</span><span class="org-comment">,/pat/ &#20174;&#26576;&#34892;&#24320;&#22987;&#21040;&#31532;&#19968;&#27425;&#37197;&#21040;&#27169;&#24335;&#30340;&#34892;
</span>4. &#27493;&#36827;&#65306;~
   1~2 &#22855;&#25968;&#34892;&#65307;&#20174;&#31532;&#19968;&#34892;&#24320;&#22987;&#65292;&#27599;&#27425;&#21152;&#20004;&#34892;&#35835;&#21462;
   2~2 &#20598;&#25968;&#34892;&#12290;&#20174;&#31532;&#20108;&#34892;&#24320;&#22987;&#65292;&#27599;&#27425;&#21152;&#20004;&#34892;&#35835;&#21462;
</pre>
</div>

<p>
<b>命令：</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">p                       <span class="org-comment-delimiter">#</span><span class="org-comment">&#25171;&#21360;&#24403;&#21069;&#27169;&#24335;&#31354;&#38388;&#20869;&#23481;&#65292;&#36861;&#21152;&#21040;&#40664;&#35748;&#36755;&#20986;&#20043;&#21518;
</span>Ip                      <span class="org-comment-delimiter">#</span><span class="org-comment">&#24573;&#30053;&#22823;&#23567;&#20889;&#36755;&#20986;
</span>d                       <span class="org-comment-delimiter">#</span><span class="org-comment">&#21024;&#38500;&#27169;&#24335;&#31354;&#38388;&#21305;&#37197;&#30340;&#34892;&#65292;&#24182;&#31435;&#21363;&#21551;&#29992;&#19979;&#19968;&#36718;&#24490;&#29615;
</span>a [<span class="org-string">\]</span>text           <span class="org-comment-delimiter">#</span><span class="org-comment">&#22312;&#25351;&#23450;&#34892;&#21518;&#38754;&#36861;&#21152;&#25991;&#26412;&#65292;&#25903;&#25345;&#20351;&#29992;\n&#23454;&#29616;&#22810;&#34892;&#36861;&#21152;
</span>i [<span class="org-string">\]</span>text            <span class="org-comment-delimiter">#</span><span class="org-comment">&#22312;&#34892;&#21069;&#38754;&#25554;&#20837;&#25991;&#26412;
</span>c [<span class="org-string">\]</span>text           <span class="org-comment-delimiter">#</span><span class="org-comment">&#26367;&#25442;&#34892;&#20026;&#21333;&#34892;&#25110;&#22810;&#34892;&#25991;&#26412;
</span>w /path/file    <span class="org-comment-delimiter">#</span><span class="org-comment">&#20445;&#23384;&#27169;&#24335;&#21305;&#37197;&#30340;&#34892;&#33267;&#25351;&#23450;&#25991;&#20214;
</span><span class="org-builtin">r</span> /path/file     <span class="org-comment-delimiter">#</span><span class="org-comment">&#35835;&#21462;&#25351;&#23450;&#25991;&#20214;&#30340;&#25991;&#26412;&#33267;&#27169;&#24335;&#31354;&#38388;&#20013;&#21305;&#37197;&#21040;&#30340;&#34892;&#21518;
</span>=                    <span class="org-comment-delimiter">#</span><span class="org-comment">&#20026;&#27169;&#24335;&#31354;&#38388;&#20013;&#30340;&#34892;&#25171;&#21360;&#34892;&#21495;
</span><span class="org-negation-char">!</span>                    <span class="org-comment-delimiter">#</span><span class="org-comment">&#27169;&#24335;&#31354;&#38388;&#20013;&#21305;&#37197;&#34892;&#21462;&#21453;&#22788;&#29702;
</span>
s/pattern/string/&#20462;&#39280;&#31526; &#26597;&#25214;&#26367;&#25442;,&#25903;&#25345;&#20351;&#29992;&#20854;&#23427;&#20998;&#38548;&#31526;&#65292;&#21487;&#20197;&#26159;&#20854;&#23427;&#24418;&#24335;&#65306;s@@@&#65292;s###&#26367;&#25442;&#20462;&#39280;&#31526;&#65306;
    &#26367;&#25442;&#20462;&#39280;&#31526;&#65306;
        g&#65306;&#20840;&#23616;&#26367;&#25442;&#65307;
        w /PATH/TO/SOMEFILE&#65306;&#23558;&#26367;&#25442;&#25104;&#21151;&#30340;&#32467;&#26524;&#20445;&#23384;&#33267;&#25351;&#23450;&#25991;&#20214;&#20013;&#65307;
        p&#65306;&#26174;&#31034;&#26367;&#25442;&#25104;&#21151;&#30340;&#34892;&#65307;
        I,i &#24573;&#30053;&#22823;&#23567;&#20889;
    string:
       &amp;&#26159;&#25226;&#21069;&#38754;&#27599;&#19968;&#20010;&#23383;&#31526;&#36827;&#34892;&#26631;&#35760;&#24182;&#36755;&#20986;
       \1 \2 ... &#20998;&#32452;&#21453;&#24341;

{COMMANDS}&#65306;&#21487;&#20197;&#25226;&#22810;&#20010;&#21629;&#20196;&#25324;&#36215;&#26469;&#65292;&#29992;&#26469;&#22788;&#29702;&#21333;&#20010;&#22320;&#22336;&#25110;&#32773;&#22320;&#22336;&#33539;&#22260;&#12290;
      sed -n <span class="org-string">'5,9p;='</span>
      sed -n <span class="org-string">'5,9{p;=}'</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">&#24863;&#21497;&#21495;&#22312;&#23450;&#22336;&#34920;&#36798;&#24335;&#21518;&#65292;&#34920;&#31034;&#23545;&#34892;&#36827;&#34892;&#31579;&#36873;&#12290;&#34920;&#31034;&#28385;&#36275;&#26465;&#20214;&#30340;&#34892;&#19981;&#25191;&#34892;&#21629;&#20196;&#65292;&#20294;&#19981;&#28385;&#36275;&#30340;&#34892;&#20250;&#25191;&#34892;&#12290;
&#24863;&#21497;&#21495;&#22312;&#21629;&#20196;&#30340;&#21069;&#38754;&#65292;&#34920;&#31034;&#28385;&#36275;&#26465;&#20214;&#30340;&#34892;&#19981;&#25191;&#34892;&#35813;&#21629;&#20196;&#65292;&#19988;&#19981;&#28385;&#36275;&#30340;&#34892;&#20063;&#19981;&#25191;&#34892;(&#19981;&#25191;&#34892;&#26159;&#22240;&#20026;&#27809;&#26377;&#34987;&#23450;&#22336;&#34920;&#36798;&#24335;&#21305;&#37197;&#21040;)&#12290;&#36825;&#26159;&#23545;&#27169;&#24335;&#31354;&#38388;&#20013;&#30340;&#34892;&#31579;&#36873;&#35201;&#25191;&#34892;&#30340;&#21629;&#20196;&#12290;
</pre>
</div>

<p>
<b>sed的默认行为：</b>
</p>

<p>
sed模式空间中的内容，默认把一行读进模式空间，如果看到p就打印出来。但
sed有个默认行为，模式空间中的内容即使不作任何操作也会打印出来，再加p就
会又打印一次
</p>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#sed <span class="org-string">''</span>   <span class="org-comment-delimiter"># </span><span class="org-comment">&#40664;&#35748;&#33258;&#21160;&#25171;&#21360;&#65292;&#30456;&#24403;&#20110;cat&#35835;&#20837;&#40664;&#35748;&#26631;&#20934;&#36755;&#20837;
</span>welcome
welcome
to
to

[root@centos8 ~]#sed <span class="org-string">''</span> /etc/issue <span class="org-comment-delimiter"># </span><span class="org-comment">&#40664;&#35748;&#33258;&#21160;&#25171;&#21360;&#65292;&#30456;&#24403;&#20110;cat
</span>\S
Kernel \r on an \m
[root@centos8 ~]#sed <span class="org-string">'p'</span> /etc/issue
\S
\S
Kernel \r on an \m
Kernel \r on an \m

[root@centos8 ~]#sed -n <span class="org-string">''</span> /etc/issue  <span class="org-comment-delimiter"># </span><span class="org-comment">-n &#20851;&#38381;&#33258;&#21160;&#25171;&#21360;
</span>[root@centos8 ~]#sed -n <span class="org-string">'p'</span> /etc/issue
\S
Kernel \r on an \m

[root@centos8 ~]#sed -n <span class="org-string">'1p'</span> /etc/passwd
root:x:0:0:root:/root:/bin/bash

[root@centos8 ~]#ifconfig eth0 | sed <span class="org-string">'2p'</span>
eth0: <span class="org-variable-name">flags</span>=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500
   inet 10.0.0.8 netmask 255.255.255.0 broadcast 10.0.0.255
   inet 10.0.0.8 netmask 255.255.255.0 broadcast 10.0.0.255
   inet6 fe80::20c:29ff:fe45:a8a1 prefixlen 64 scopeid 0x20&lt;link&gt;
   ether 00:0c:29:45:a8:a1 txqueuelen 1000 (Ethernet)
   RX packets 89815 bytes 69267453 (66.0 MiB)
   RX errors 0 dropped 0 overruns 0 frame 0
   TX packets 115634 bytes 79827662 (76.1 MiB)
   TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0

[root@centos8 ~]#ifconfig eth0 | sed -n <span class="org-string">'2p'</span>
   inet 10.0.0.8 netmask 255.255.255.0 broadcast 10.0.0.255

[root@centos8 ~]#sed -n <span class="org-string">'$p'</span> /etc/passwd <span class="org-comment-delimiter"># </span><span class="org-comment">&#25171;&#21360;&#26368;&#21518;&#19968;&#34892;
</span>postfix:x:89:89::/var/spool/postfix:/sbin/nologin

[root@centos8 ~]#ifconfig eth0 |sed -n <span class="org-string">'/netmask/p'</span>
   inet 10.0.0.8 netmask 255.255.255.0 broadcast 10.0.0.255

[root@centos8 ~]#df | sed -n <span class="org-string">'/^\/dev\/sd/p'</span>
/dev/sda2    104806400 4872956  99933444  5% /
/dev/sda3    52403200  398860  52004340  1% /data
/dev/sda1     999320  848568   81940  92% /boot

[root@centos8 ~]#seq 10 | sed -n <span class="org-string">'3,6p'</span>
3
4
5
6

seq 10 | sed -n <span class="org-string">'3,+4p'</span>  <span class="org-comment-delimiter"># </span><span class="org-comment">&#25171;&#21360;&#31532;3&#34892;&#21040;&#31532;7&#34892;
</span>seq 10 | sed -n <span class="org-string">'3,$p'</span> <span class="org-comment-delimiter"># </span><span class="org-comment">&#25171;&#21360;&#31532;3&#34892;&#21040;&#26368;&#21518;&#34892;
</span>seq 10 |sed -n <span class="org-string">'1~2p'</span>  <span class="org-comment-delimiter"># </span><span class="org-comment">&#25171;&#21360;&#22855;&#25968;&#34892;&#12290;&#20174;&#31532;1&#34892;&#38548;2&#34892;&#25171;&#21360;
</span>seq 10 |sed -n <span class="org-string">'2~2p'</span> <span class="org-comment-delimiter"># </span><span class="org-comment">&#25171;&#21360;&#20598;&#25968;&#34892;&#12290;&#20174;&#31532;2&#34892;&#38548;2&#34892;&#25171;&#21360;
</span>seq 10 |sed  <span class="org-string">'1~2d'</span> <span class="org-comment-delimiter"># </span><span class="org-comment">&#25171;&#21360;&#38500;&#22855;&#25968;&#34892;&#12290;
</span>seq 10 |sed  <span class="org-string">'2~2d'</span> <span class="org-comment-delimiter"># </span><span class="org-comment">&#25171;&#21360;&#38500;&#20598;&#25968;&#34892;&#12290;
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">-e &#26469;&#34920;&#31034;&#25110;&#32773;
</span>sed -e <span class="org-string">'2d'</span> -e <span class="org-string">'4d'</span> seq.log <span class="org-comment-delimiter"># </span><span class="org-comment">&#25171;&#21360;&#38500;&#31532;2 &#31532;4&#34892;
</span>sed <span class="org-string">'2d;4d'</span> seq.log <span class="org-comment-delimiter"># </span><span class="org-comment">&#25171;&#21360;&#38500;&#31532;2 &#31532;4&#34892;
</span>
sed -i.orig <span class="org-string">'2d;4d'</span> seq.log <span class="org-comment-delimiter"># </span><span class="org-comment">&#21024;&#38500;&#25991;&#20214;&#31532;2 &#31532;4&#34892;&#65292;&#24182;&#20445;&#23384;&#21407;&#25991;&#20214;&#20026;seq.log.orig
</span>
sed -i  <span class="org-string">'/^listen 9527/a listen 80 \nlisten 8080'</span>  /etc/httpd/conf/httpd.conf
sed -i <span class="org-string">'/^#/d'</span> fstab <span class="org-comment-delimiter">#</span><span class="org-comment">&#21024;&#38500;&#25152;&#26377;&#20197;#&#24320;&#22836;&#30340;&#34892;
</span>sed -n <span class="org-string">'/^#/!p'</span> fstab <span class="org-comment-delimiter">#</span><span class="org-comment">&#21482;&#26174;&#31034;&#38750;#&#24320;&#22836;&#30340;&#34892;
</span>
sed  -n <span class="org-string">'/^[[:digit:]]/p'</span> relax_read_count.log.2017-01-17  |less <span class="org-comment-delimiter">#</span><span class="org-comment">&#21482;&#25171;&#21360;&#20197;&#25968;&#23383;&#24320;&#22836;&#30340;&#34892;
</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">&#20462;&#25913;&#32593;&#21345;&#37197;&#32622;
</span>sed -Ei.bak <span class="org-string">'/^GRUB_CMDLINE_LINUX/s/(.*)(")$/\1 net.ifnames=0\2/'</span> /etc/default/grub
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">sed <span class="org-string">'2p'</span> /etc/passwd
sed  -n <span class="org-string">'2p'</span> /etc/passwd
sed  -n <span class="org-string">'1,4p'</span> /etc/passwd
sed  -n <span class="org-string">'/root/p'</span> /etc/passwd
sed  -n <span class="org-string">'2,/root/p'</span> /etc/passwd &#20174;2&#34892;&#24320;&#22987;
sed  -n <span class="org-string">'/^$/='</span> file &#26174;&#31034;&#31354;&#34892;&#34892;&#21495;
sed -n <span class="org-string">'/./p'</span> a.sh : &#26174;&#31034;&#38750;&#31354;&#34892;&#65292;&#20294;&#23545;&#21046;&#34920;&#31526;&#26080;&#25928;
sed  -n  -e <span class="org-string">'/^$/p'</span> -e <span class="org-string">'/^$/='</span> file
Sed<span class="org-string">'/root/a\superman'</span> /etc/passwd&#34892;&#21518;
sed <span class="org-string">'/root/i\superman'</span> /etc/passwd &#34892;&#21069;
sed <span class="org-string">'/root/c\superman'</span> /etc/passwd &#20195;&#26367;&#34892;
sed <span class="org-string">'/^$/d'</span> file
sed <span class="org-string">'1,10d'</span>  file
nl  /etc/passwd | sed <span class="org-string">'2,5d'</span>
nl  /etc/passwd | sed <span class="org-string">'2a tea'</span>
sed <span class="org-string">'s/test/mytest/g'</span> example
sed -n <span class="org-string">'s/root/&amp;superman/p'</span> /etc/passwd &#21333;&#35789;&#21518;   <span class="org-comment-delimiter"># </span><span class="org-comment">&amp;&#26159;&#25226;&#21069;&#38754;&#27599;&#19968;&#20010;&#23383;&#31526;&#36827;&#34892;&#26631;&#35760;&#24182;&#36755;&#20986;
</span>sed -n <span class="org-string">'s/root/superman&amp;/p'</span> /etc/passwd &#21333;&#35789;&#21069;
sed -e <span class="org-string">'s/dog/cat/'</span> -e <span class="org-string">'s/hi/lo/'</span> pets
sed -n <span class="org-string">'s/^.//gp'</span> /etc/fstab <span class="org-comment-delimiter"># </span><span class="org-comment">&#21024;&#38500;&#25991;&#20214;&#27599;&#34892;&#20013;&#30340;&#31532;&#19968;&#20010;&#23383;&#31526;
</span>sed -nr <span class="org-string">'s/.$//p'</span> /etc/passwd <span class="org-comment-delimiter"># </span><span class="org-comment">&#21024;&#38500;&#25991;&#20214;&#27599;&#34892;&#30340;&#26368;&#21518;&#19968;&#20010;&#23383;&#31526;
</span>sed -i.bak  <span class="org-string">'s/dog/cat/g'</span> pets
</pre>
</div>

<p>
范例：取IP 地址
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#ifconfig eth0 |sed -nr <span class="org-string">"2s/[^0-9]+([0-9.]+).*/\1/p"</span>
10.0.0.8
[root@centos8 ~]#ifconfig eth0 | sed -rn <span class="org-string">'2s/^[^0-9]+([0-9.]+) .*$/\1/p'</span>
10.0.0.8
[root@centos8 ~]#ifconfig eth0 | sed -n <span class="org-string">'2s/^.*inet //p'</span> | sed -n <span class="org-string">'s/
netmask.*//p'</span>
10.0.0.8
[root@centos8 ~]#ifconfig eth0 | sed -n <span class="org-string">'2s/^.*inet //;s/ netmask.*//p'</span>
10.0.0.8
[root@centos8 ~]#ifconfig eth0 | sed -rn <span class="org-string">'2s/(.*inet )([0-9].*)(
netmask.*)/\2/p'</span>
10.0.0.8
</pre>
</div>

<p>
范例：取基名和目录名
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">echo</span> <span class="org-string">"/etc/sysconfig/network-scripts/"</span> |sed -r <span class="org-string">'s#(^/.*/)([^/]+/?)#\2#'</span> &#21462;&#22522;&#21517;
<span class="org-builtin">echo</span> <span class="org-string">"/etc/sysconfig/network-scripts/"</span> |sed -r <span class="org-string">'s#(^/.*/)([^/]+/?)#\1#'</span> &#21462;&#30446;&#24405;
<span class="org-comment-delimiter">#</span><span class="org-comment">&#21462;&#30446;&#24405;&#21517;
</span>[root@centos8 ~]#echo /etc/sysconfig/ | sed -rn <span class="org-string">'s#(.*)/([^/]+)/?#\1#p'</span>
/etc
<span class="org-comment-delimiter">#</span><span class="org-comment">&#21462;&#22522;&#21517;
</span>[root@centos8 ~]#echo /etc/sysconfig/ | sed -rn <span class="org-string">'s#(.*)/([^/]+)/?#\2#p'</span>
sysconfig
</pre>
</div>

<p>
范例：将#开头的行删除#
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#sed -ri.bak <span class="org-string">'/^#/s/^#//'</span> /etc/fstab
</pre>
</div>

<p>
范例：取分区利用率
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#df | sed -nr <span class="org-string">'/^\/dev\/sd/s# .* ([0-9]+)%.*# \1#p'</span>
/dev/sda2 3
/dev/sda5 1
/dev/sda1 14
</pre>
</div>

<p>
范例：修改内核参数
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#sed -nr <span class="org-string">'/^GRUB_CMDLINE_LINUX/s/"$/ net.ifnames=0"/p'</span>
/etc/default/grub
<span class="org-variable-name">GRUB_CMDLINE_LINUX</span>=<span class="org-string">"crashkernel=auto resume=UUID=8363289d-138e-4e4a-abaf-
6e028babc924 rhgb quiet net.ifnames=0"</span>

[root@centos8 ~]#sed -rn <span class="org-string">'/^GRUB_CMDLINE_LINUX=/s@(.*)"$@\1 net.ifnames=0"@p'</span>
/etc/default/grub
<span class="org-variable-name">GRUB_CMDLINE_LINUX</span>=<span class="org-string">"crashkernel=auto resume=UUID=a0efb2bb-8227-4317-a79d-
0a70d515046c rhgb quiet net.ifnames=0"</span>
[root@centos8 ~]#sed -rn <span class="org-string">'/^GRUB_CMDLINE_LINUX=/s@"$@ net.ifnames=0"@p'</span>
/etc/default/grub
<span class="org-variable-name">GRUB_CMDLINE_LINUX</span>=<span class="org-string">"crashkernel=auto resume=UUID=a0efb2bb-8227-4317-a79d-
0a70d515046c rhgb quiet net.ifnames=0 net.ifnames=0"</span>
</pre>
</div>

<p>
范例：修改网卡名称
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#sed -ri <span class="org-string">'/^GRUB_CMDLINE_LINUX=/s@"$@ net.ifnames=0"@'</span> /etc/default/grub

<span class="org-comment-delimiter">#</span><span class="org-comment">centos7,8
</span>[root@centos8 ~]#grub2-mkconfig -o /boot/grub2/grub.cfg
<span class="org-comment-delimiter">#</span><span class="org-comment">ubuntu
</span>[root@ubuntu ~]#grub-mkconfig -o /boot/grub/grub.cfg
</pre>
</div>

<p>
范例：修改配置文件
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#sed  -e <span class="org-string">'/^#&lt;VirtualHost/,/^#&lt;\/VirtualHost&gt;/s@#@@'</span> -e <span class="org-string">'/^#NameVirtualHost/s@#@@'</span> /etc/httpd/conf/httpd.conf
</pre>
</div>

<p>
"|" "(" ")" 等属于正则表达式的POSIX扩展， 在sed里不直接支持需要加转义
字符”" 。 也就是说得这样使用： | ( ) ，支持扩展-r 或 -E
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">echo</span> Welcome to Me | sed <span class="org-string">'s/\w\+/[&amp;]/g'</span>  <span class="org-comment-delimiter">#</span><span class="org-comment">&amp;&#26159;&#25226;&#21069;&#38754;&#27599;&#19968;&#20010;&#23383;&#31526;&#36827;&#34892;&#26631;&#35760;&#24182;&#36755;&#20986;
</span>
[root@localhost ~]# echo Welcome to M | sed <span class="org-string">'s/\w\+/[&amp;]/g'</span>
[Welcome] [to] [M]
</pre>
</div>

<p>
范例：将非#开头的行加#
</p>

<div class="org-src-container">
<pre class="src src-sh">sed -rn <span class="org-string">"s/^[^#]/#&amp;/p"</span>  /etc/fstab  <span class="org-comment-delimiter"># </span><span class="org-comment">&amp;&#26159;&#25226;&#21069;&#38754;&#27599;&#19968;&#20010;&#23383;&#31526;&#36827;&#34892;&#26631;&#35760;&#24182;&#36755;&#20986;
</span>sed -rn <span class="org-string">'s/^[^#](.*)/#\1/p'</span> /etc/fstab
sed -rn <span class="org-string">'/^#/!s@^@#@p'</span> /etc/fstab
</pre>
</div>

<p>
范例：查看配置文件，删除#号头行空白行
</p>

<div class="org-src-container">
<pre class="src src-sh">sed  -r  <span class="org-string">'/^(#|$)/d'</span> /etc/httpd/conf/httpd.conf
sed  -r  <span class="org-string">'/^#|^$/d'</span> /etc/httpd/conf/httpd.conf
</pre>
</div>

<p>
范例：引用变量
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#echo|sed <span class="org-string">"s/^/$RANDOM.rmvb/"</span>
5242.rmvb
[root@centos8 ~]#echo|sed <span class="org-string">'s/^/$RANDOM.rmvb/'</span>
$<span class="org-variable-name">RANDOM</span>.rmvb
[root@centos8 ~]#echo|sed <span class="org-string">'s/^/'''</span>$<span class="org-variable-name">RANDOM</span><span class="org-string">'''.rmvb/'</span>
</pre>
</div>

<p>
范例：/ 变为.
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">/ &#21464;&#20026;.
</span><span class="org-variable-name">REPOSITORY</span>=gcr.io/google_containers
<span class="org-variable-name">interval</span>=.
[root@stor01 ~]# sed <span class="org-string">'s#/#'"$interval"'#g'</span>&lt;&lt;&lt;${<span class="org-variable-name">REPOSITORY</span>%/}/
gcr.io.google_containers.
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">&#32451;&#20064;1&#65306;&#21024;&#38500;/boot/grub/grub2.cfg&#25991;&#20214;&#20013;&#25152;&#26377;&#20197;&#31354;&#30333;&#23383;&#31526;&#24320;&#22836;&#30340;&#34892;&#30340;&#34892;&#39318;&#30340;&#25152;&#26377;&#31354;&#30333;&#23383;&#31526;&#65307;
sed  <span class="org-string">'s@^[[:space:]]\+@@'</span> /etc/grub2.cfg
&#32451;&#20064;2&#65306;&#21024;&#38500;/etc/fstab&#25991;&#20214;&#20013;&#25152;&#26377;&#20197;#&#24320;&#22836;&#30340;&#34892;&#30340;&#34892;&#39318;&#30340;#&#21495;&#21450;#&#21518;&#38754;&#30340;&#25152;&#26377;&#31354;&#30333;&#23383;&#31526;&#65307;
sed  <span class="org-string">'s@^#[[:space:]]*@@'</span>  /etc/fstab
&#32451;&#20064;3&#65306;&#36755;&#20986;&#19968;&#20010;&#32477;&#23545;&#36335;&#24452;&#32473;sed&#21629;&#20196;&#65292;&#21462;&#20986;&#20854;&#30446;&#24405;&#65292;&#20854;&#34892;&#20026;&#31867;&#20284;&#20110;dirname&#65307;
<span class="org-builtin">echo</span> <span class="org-string">"/var/log/messages/"</span> | sed <span class="org-string">'s@[^/]\+/\?$@@'</span>
<span class="org-builtin">echo</span> <span class="org-string">"/var/log/messages"</span> | sed -r <span class="org-string">'s@[^/]+/?$@@'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:f11b26ca-74f9-43db-9e79-d398ed3fe42e" class="outline-4">
<h4 id="h:f11b26ca-74f9-43db-9e79-d398ed3fe42e"><a href="#h:f11b26ca-74f9-43db-9e79-d398ed3fe42e">sed 高级用法</a></h4>
<div class="outline-text-4" id="text-h:f11b26ca-74f9-43db-9e79-d398ed3fe42e">
<p>
sed中除了模式空间，还另外还支持 <code>保持空间（Hold Space）</code> ,利用此空间，
可以将模式空间（PatternSpace）中的数据，临时保存至保持空间，从而后续接
着处理，实现更为强大的功能。
</p>

<p>
常见的高级命令
</p>

<ul class="org-ul">
<li>P 打印模式空间开端至\n内容，并追加到默认输出之前</li>
<li>h 把模式空间中的内容覆盖至保持空间中</li>
<li>H 把模式空间中的内容追加至保持空间中</li>
<li>g 从保持空间取出数据覆盖至模式空间</li>
<li>G 从保持空间取出内容追加至模式空间</li>
<li>x 把模式空间中的内容与保持空间中的内容进行互换</li>
<li>n 读取匹配到的行的下一行覆盖至模式空间</li>
<li>N 读取匹配到的行的下一行追加至模式空间</li>
<li>d 删除模式空间中的行</li>
<li>D 如果模式空间包含换行符，则删除直到第一个换行符的模式空间中的文本，
并不会读取新的输入行，而使用合成的模式空间重新启动循环。如果模式空间
不包含换行符，则会像发出d命令那样启动正常的新循环</li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">sed -n <span class="org-string">'n;p'</span> FILE
sed <span class="org-string">'1!G;h;$!d'</span> FILE
sed &#8216;N;D&#8217;FILE  <span class="org-comment-delimiter"># </span><span class="org-comment">&#26174;&#31034;&#26368;&#21518;&#19968;&#34892;
</span>seq 10 |sed  <span class="org-string">'3h;9G;9!d'</span>
sed <span class="org-string">'$!N;$!D'</span> FILE
sed <span class="org-string">'$!d'</span> FILE
sed &#8216;G&#8217; FILE
sed &#8216;g&#8217; FILE
sed &#8216;/^$/d;G&#8217; FILE
sed <span class="org-string">'n;d'</span> FILE
sed -n <span class="org-string">'1!G;h;$p'</span> FILE

sed  -n  <span class="org-string">'n;p'</span>  FILE&#65306;# &#26174;&#31034;&#20598;&#25968;&#34892;&#65307;
sed  <span class="org-string">'1!G;h;$!d'</span>  FILE&#65306;# &#36870;&#24207;&#26174;&#31034;&#25991;&#20214;&#30340;&#20869;&#23481;&#65307;1!G&#65306;&#31532;1&#34892;&#20445;&#25345;&#31354;&#38388;&#20869;&#23481;&#19981;&#36861;&#21152;&#21040;&#27169;&#24335;&#31354;&#38388;&#65292;h&#65306;&#25226;&#27169;&#24335;&#31354;&#38388;&#20013;&#30340;&#20869;&#23481;&#35206;&#30422;&#33267;&#20445;&#25345;&#31354;&#38388;&#20013;&#65292;$<span class="org-variable-name">!</span>d&#65306;&#38500;&#26368;&#21518;&#19968;&#34892;&#22806;&#30340;&#34892;&#20174;&#27169;&#24335;&#31354;&#38388;&#20013;&#21024;&#38500;
sed  &#8217;$<span class="org-variable-name">!</span>d<span class="org-string">'  FILE&#65306;&#21462;&#20986;&#26368;&#21518;&#19968;&#34892;&#65307;
sed  '</span>$<span class="org-variable-name">!</span>N;$<span class="org-variable-name">!</span>D<span class="org-string">' FILE&#65306;&#21462;&#20986;&#25991;&#20214;&#21518;&#20004;&#34892;&#65307;
sed '</span>/^$/d;G<span class="org-string">' FILE&#65306;&#21024;&#38500;&#21407;&#26377;&#30340;&#25152;&#26377;&#31354;&#30333;&#34892;&#65292;&#32780;&#21518;&#20026;&#25152;&#26377;&#30340;&#38750;&#31354;&#30333;&#34892;&#21518;&#28155;&#21152;&#19968;&#20010;&#31354;&#30333;&#34892;&#65307;
sed  '</span>n;d<span class="org-string">'  FILE&#65306;&#26174;&#31034;&#22855;&#25968;&#34892;&#65307; sed  '</span>N;p<span class="org-string">'
sed '</span>G<span class="org-string">' FILE&#65306;&#22312;&#21407;&#26377;&#30340;&#27599;&#34892;&#21518;&#26041;&#28155;&#21152;&#19968;&#20010;&#31354;&#30333;&#34892;&#65307;</span>
</pre>
</div>


<figure id="org0223812">
<img src="././images/image-20210216003322379.png" alt="image-20210216003322379.png" width="50%">

</figure>

<p>
范例：上下行合并
</p>

<div class="org-src-container">
<pre class="src src-sh">&#26041;&#27861;&#19968;
sed -n <span class="org-string">'{N;s/\n/\t/p}'</span> test.txt
&#26041;&#27861;&#20108;&#65306;
awk <span class="org-string">'{tmp=$0;getline;print tmp"\t"$0}'</span> test.txt

[root@nginx001 ~]# curl -s -u wowotuan:wowotuan 172.16.0.22:8080/v2/apps?<span class="org-variable-name">embed</span>=apps.count|jq  <span class="org-string">'.apps[]|.id ,.instances'</span> |sed -n <span class="org-string">'{N;s/\n/  /p}'</span> |sort -nr -k2
<span class="org-string">"/yuncapital-yzprod"</span>  2
<span class="org-string">"/xyscm-foodsafetyweb-yzprod"</span>  2
<span class="org-string">"/xyscm-cost-reduction-web-yzprod"</span>  2
<span class="org-string">"/jobcenter-yzprod"</span>  2
<span class="org-string">"/dbos-web-yzprod"</span>  2
<span class="org-string">"/xyscm-warehousecenter-yzprod"</span>  1
<span class="org-string">"/xyscm-ub-web-yzprod"</span>  1
<span class="org-string">"/xyscm-taskcenter-yzprod"</span>  1
<span class="org-string">"/xyscm-me-warehousecenter-yzprod"</span>  1
<span class="org-string">"/xyscm-me-erpcenter-yzprod"</span>  1
</pre>
</div>
</div>
<div id="outline-container-h:8443a947-13b9-46f7-b84d-12e82b9bd4a8" class="outline-5">
<h5 id="h:8443a947-13b9-46f7-b84d-12e82b9bd4a8"><a href="#h:8443a947-13b9-46f7-b84d-12e82b9bd4a8">运行sed脚本</a></h5>
<div class="outline-text-5" id="text-h:8443a947-13b9-46f7-b84d-12e82b9bd4a8">
<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Time: 2018-12-09T10:42:25.350158+08:00
</span><span class="org-comment-delimiter"># </span><span class="org-comment">User@Host: miying[miying] @  [10.1.1.9]  Id: 930992
</span><span class="org-comment-delimiter"># </span><span class="org-comment">Query_time: 0.357271  Lock_time: 0.000021 Rows_sent: 1  Rows_examined: 21045
</span>SET <span class="org-variable-name">timestamp</span>=1544323345;
SELECT SUM(duration) FROM <span class="org-sh-quoted-exec">`user_listening_log`</span> WHERE (<span class="org-sh-quoted-exec">`user_account_id`</span>=<span class="org-string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>) AND (<span class="org-sh-quoted-exec">`record_date`</span>=<span class="org-string">'2018-12-09'</span>) AND (<span class="org-sh-quoted-exec">`product_id`</span>=<span class="org-string">'yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy'</span>);
<span class="org-comment-delimiter"># </span><span class="org-comment">Time: 2018-12-09T10:42:25.353119+08:00
</span><span class="org-comment-delimiter"># </span><span class="org-comment">User@Host: miying[miying] @  [10.1.1.9]  Id: 930993
</span><span class="org-comment-delimiter"># </span><span class="org-comment">Query_time: 0.345233  Lock_time: 0.000025 Rows_sent: 1  Rows_examined: 21045
</span>SET <span class="org-variable-name">timestamp</span>=1544323345;
SELECT SUM(duration) FROM <span class="org-sh-quoted-exec">`user_listening_log`</span> WHERE (<span class="org-sh-quoted-exec">`user_account_id`</span>=<span class="org-string">'e359112a3f2c4d968e710e003f7b0a4c'</span>) AND (<span class="org-sh-quoted-exec">`record_date`</span>=<span class="org-string">'2018-12-09'</span>) AND (<span class="org-sh-quoted-exec">`product_id`</span>=<span class="org-string">'yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy'</span>);


&#21462;&#20986;&#26597;&#35810;&#26085;&#24535;&#37324;&#30340;&#26597;&#35810;&#26102;&#38388;&#21644;&#34920;&#12290;&#20063;&#23601;&#26159;&#19978;&#38754;&#26694;&#36215;&#26469;&#30340;&#32418;&#33394;&#26102;&#38388;&#12289;&#40644;&#33394;&#30340;&#34920;&#12290;&#36755;&#20986;&#26684;&#24335;&#20026;<span class="org-string">"0.12121 user_account"</span>&#12290;&#25991;&#20214;&#37324;&#23601;&#19978;&#38754;&#20004;&#31181;&#26684;&#24335;&#12290;
<span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/sed -nf
</span>
/Query_time: /{
    :a
    /FROM/I{
        s|^# Query_time: ([0-9]+<span class="org-string">\.</span>[0-9]+).*FROM \W?([a-zA-Z_]+)\W?.*$|\1 \2|Ip
        d
    }
    N
    ba
}
</pre>
</div>


<figure id="org36d80d2">
<img src="././images/image-20210216003344938.png" alt="image-20210216003344938.png" width="50%">

</figure>


<figure id="org517c441">
<img src="././images/image-20210216003400609.png" alt="image-20210216003400609.png" width="50%">

</figure>


<figure id="org5afc405">
<img src="././images/sed.png" alt="sed.png" width="50%">

</figure>
</div>
</div>
</div>
</div>
<div id="outline-container-h:6c78e418-2e17-4f19-9533-3a1732045d57" class="outline-3">
<h3 id="h:6c78e418-2e17-4f19-9533-3a1732045d57"><a href="#h:6c78e418-2e17-4f19-9533-3a1732045d57">文本处理三剑客之 awk</a></h3>
<div class="outline-text-3" id="text-h:6c78e418-2e17-4f19-9533-3a1732045d57">
</div>
<div id="outline-container-h:26067d29-6c5b-4ac7-b90e-742ed5c73124" class="outline-4">
<h4 id="h:26067d29-6c5b-4ac7-b90e-742ed5c73124"><a href="#h:26067d29-6c5b-4ac7-b90e-742ed5c73124">awk 工作原理和基本用法说明</a></h4>
<div class="outline-text-4" id="text-h:26067d29-6c5b-4ac7-b90e-742ed5c73124">
<p>
awk：Aho, Weinberger, Kernighan采用三个作者的名称首字母简写，报告生成
器，格式化文本输出，GNU/Linux发布的AWK目前由自由软件基金会（FSF）进行
开发和维护，通常也称它为
</p>

<p>
GNU AWK 有多种版本：
</p>

<ul class="org-ul">
<li>AWK：原先来源于 AT &amp; T 实验室的的AWK</li>

<li>NAWK：New awk，AT &amp; T 实验室的AWK的升级版</li>

<li><p>
GAWK：即GNU
AWK。所有的GNU/Linux发布版都自带GAWK，它与AWK和NAWK完全兼容
</p>

<div class="org-src-container">
<pre class="src src-sh">Linux&#19978;awk&#26159;gawk&#30340;&#36830;&#25509;&#25991;&#20214;
[root@centos7 scripts]# which awk
/usr/bin/awk
[root@centos7 scripts]# ls -l /usr/bin/awk
lrwxrwxrwx. 1 root root 4 12&#26376; 10 16:47 /usr/bin/awk -&gt; gawk
[root@centos7 scripts]# man gawk
</pre>
</div></li>
</ul>

<p>
gawk：模式扫描和处理语言，可以实现下面功能
</p>

<ul class="org-ul">
<li>文本处理</li>
<li>输出格式化的文本报表</li>
<li>执行算数运算</li>
<li>执行字符串操作</li>
</ul>

<p>
格式：
</p>

<div class="org-src-container">
<pre class="src src-sh">awk [options]  <span class="org-string">'program'</span> <span class="org-variable-name">var</span>=value  file&#8230;
awk [options]  -f programfile  <span class="org-variable-name">var</span>=value file&#8230;
</pre>
</div>

<p>
说明：
</p>

<p>
program通常是被放在单引号中，并可以由三种部分组成
</p>

<ul class="org-ul">
<li>BEGIN语句块</li>
<li>模式匹配的通用语句块</li>
<li>END语句块</li>
</ul>

<p>
常见选项：
</p>

<ul class="org-ul">
<li>-F "分隔符" 指明输入时用到的字段分隔符，默认的分隔符是若干个连续空白符</li>
<li>-v var=value 变量赋值</li>
</ul>

<p>
<b>Program格式：</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">pattern{action statements;..}
</pre>
</div>

<p>
pattern：决定动作语句何时触发及触发事件，比如：BEGIN,END,正则表达式等
</p>

<p>
action statements：对数据进行处理，放在{}内指明，常见：print, printf
</p>

<p>
<b>awk 工作过程</b>
</p>


<figure id="orgc9427e5">
<img src="././images/image-20210228023558900.png" alt="image-20210228023558900.png">

</figure>

<ul class="org-ul">
<li>第一步：执行BEGIN{action;&#x2026; }语句块中的语句</li>
<li>第二步：从文件或标准输入(stdin)读取一行，然后执行pattern{ action;&#x2026;
}语句块，它逐行扫描文件，从第一行到最后一行重复这个过程，直到文件全
部被读取完毕。</li>
<li>第三步：当读至输入流末尾时，执行END{action;&#x2026;}语句块</li>
</ul>

<p>
BEGIN语句块在awk开始从输入流中读取行之前被执行，这是一个可选的语句块，
比如变量初始化、打印输出表格的表头等语句通常可以写在BEGIN语句块中
</p>

<p>
END语句块在awk从输入流中读取完所有的行之后即被执行，比如打印所有行的分
析结果这类信息汇总都是在END语句块中完成，它也是一个可选语句块
</p>

<p>
pattern语句块中的通用命令是最重要的部分，也是可选的。如果没有提供
pattern语句块，则默认执行{print }，即打印每一个读取到的行，awk读取的每
一行都会执行该语句块
</p>

<p>
<b>分割符、域和记录</b>
</p>

<ul class="org-ul">
<li>由分隔符分隔的字段（列column,域field）标记$1,$2&#x2026;$n称为域标识，$0为
所有域，注意：和shell中变量​$符含义不同</li>
<li>文件的每一行称为记录record</li>
<li>如果省略action，则默认执行 print $0 的操作</li>
</ul>

<p>
<b>常用的action分类</b>
</p>

<ul class="org-ul">
<li>output statements：输出语句print,printf</li>
<li>Expressions：算术，比较表达式等</li>
<li>Compound statements：组合语句</li>
<li>Control statements：控制语句if, while等</li>
<li>input statements控制语句</li>
</ul>

<p>
<b>awk控制语句</b>
</p>

<ul class="org-ul">
<li>{ statements;&#x2026; } 组合语句</li>
<li>if(condition) {statements;&#x2026;}</li>
<li>if(condition) {statements;&#x2026;} else {statements;&#x2026;}</li>
<li>while(conditon) {statments;&#x2026;}</li>
<li>do {statements;&#x2026;} while(condition)</li>
<li>for(expr1;expr2;expr3) {statements;&#x2026;}</li>
<li>break</li>
<li>continue</li>
<li>exit</li>
</ul>
</div>
</div>
<div id="outline-container-h:651d5fb4-2329-4e17-b375-33cab31ad010" class="outline-4">
<h4 id="h:651d5fb4-2329-4e17-b375-33cab31ad010"><a href="#h:651d5fb4-2329-4e17-b375-33cab31ad010">动作 print</a></h4>
<div class="outline-text-4" id="text-h:651d5fb4-2329-4e17-b375-33cab31ad010">
<p>
格式： print item1, item2, &#x2026;
</p>

<p>
说明：
</p>

<ul class="org-ul">
<li>逗号分隔符</li>
<li>输出item可以字符串，也可是数值；当前记录的字段、变量或awk的表达式</li>
<li>如省略item，相当于print $0打印整行</li>
<li>固定字符符需要用“ ” 引起来，而变量和数字不需要</li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'{print "hello,awk"}'</span>
[root@centos8 ~]#seq 10 | awk <span class="org-string">'{print "hello,awk"}'</span>
hello,awk
hello,awk
hello,awk
hello,awk
hello,awk
hello,awk
hello,awk
hello,awk
hello,awk
hello,awk
[root@centos8 ~]#seq 3 | awk <span class="org-string">'{print 2*3}'</span>
6
6
6
[root@centos8 ~]#awk -F: <span class="org-string">'{print "wang"}'</span> /etc/passwd
[root@centos8 ~]#awk -F: <span class="org-string">'{print}'</span> /etc/passwd
[root@centos8 ~]#awk -F: <span class="org-string">'{print $0}'</span> /etc/passwd
[root@centos8 ~]#awk -F: <span class="org-string">'{print $1,$3}'</span> /etc/passwd
[root@centos8 ~]#awk -F: <span class="org-string">'{print $1"\t"$3}'</span> /etc/passwd

[root@centos8 ~]#grep <span class="org-string">"^UUID"</span> /etc/fstab |awk {<span class="org-string">'print $2,$3'</span>}
/ xfs
/boot ext4
/data xfs
swap swap
</pre>
</div>

<p>
面题：取出网站访问量最大的前3个IP
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@VM_0_10_centos logs]# awk <span class="org-string">'{print $1}'</span> nginx.access.log-20200428|sort |
uniq -c |sort -nr|head -3
 5498 122.51.38.20
 2161 117.157.173.214
 953 211.159.177.120
[root@centos8 ~]#awk <span class="org-string">'{print $1}'</span> access_log |sort |uniq -c|sort -nr|head
 4870 172.20.116.228
 3429 172.20.116.208
 2834 172.20.0.222
 2613 172.20.112.14
 2267 172.20.0.227
 2262 172.20.116.179
 2259 172.20.65.65
 1565 172.20.0.76
 1482 172.20.0.200
 1110 172.20.28.145
</pre>
</div>

<p>
面试题：取出分区利用率
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#df | awk <span class="org-string">'{print $1,$5}'</span>
Filesystem Use%
devtmpfs 0%
tmpfs 0%
tmpfs 2%
tmpfs 0%
/dev/sda2 3%
/dev/sda3 1%
/dev/sda1 15%
tmpfs 0%

<span class="org-comment-delimiter">#</span><span class="org-comment">&#20351;&#29992;&#25193;&#23637;&#30340;&#27491;&#21017;&#34920;&#36798;&#24335;
</span>[root@centos8 ~]#df | awk -F<span class="org-string">"[[:space:]]+|%"</span> <span class="org-string">'{print $5}'</span>
Use
0
0
1
0
5
1
92
1
[root@centos8 ~]#df | awk -F<span class="org-string">'[[:space:]]+|%'</span> <span class="org-string">'{print $1,$5}'</span>
Filesystem Use
devtmpfs 0
tmpfs 0
tmpfs 2
tmpfs 0
/dev/sda2 3
/dev/sda3 1
/dev/sda1 15
tmpfs 0

[root@centos8 ~]#df | grep <span class="org-string">"^/dev/sd"</span> | awk -F<span class="org-string">"[[:space:]]+|%"</span> <span class="org-string">'{print $5}'</span>
5
1
92

[root@centos8 ~]#df | grep <span class="org-string">'^/dev/sd'</span>| awk -F<span class="org-string">'[[:space:]]+|%'</span> <span class="org-string">'{print $1,$5}'</span>
/dev/sda2 3
/dev/sda3 1
/dev/sda1 15

[root@centos8 ~]#df | awk -F<span class="org-string">"[[:space:]]+|%"</span> <span class="org-string">'/^\/dev\/sd/{print $5}'</span>
5
1
92
[root@centos8 ~]#df | awk -F<span class="org-string">'[[:space:]]+|%'</span> <span class="org-string">'/^\/dev\/sd/{print $1,$5}'</span>
/dev/sda2 3
/dev/sda3 1
/dev/sda1 15
</pre>
</div>

<p>
面试题：取 ifconfig 输出结果中的IP地址
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#ifconfig eth0 | awk <span class="org-string">'/netmask/{print $2}'</span>
10.0.0.8
[root@centos6 ~]#ifconfig eth0 |awk -F <span class="org-string">" +|:"</span> <span class="org-string">'/Mask/{print $4}'</span>
10.0.0.6
[root@centos8 ~]#ifconfig eth0| sed -rn <span class="org-string">'2s/^[^0-9]+([0-9.]+) .*$/\1/p'</span>
10.0.0.8
[root@centos6 ~]#ifconfig eth0| sed -rn <span class="org-string">'2s/^[^0-9]+([0-9.]+) .*$/\1/p'</span>
10.0.0.6
</pre>
</div>

<p>
面试题：文件host_list.log如下格式，请提取”.me.com”前面的主机名部分并
写入到回到该文件中
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat host_list.log
1 www.me.com
2 blog.me.com
3 study.me.com
4 linux.me.com
5 python.me.com

[root@centos8 ~]#awk -F<span class="org-string">"[ .]"</span> <span class="org-string">'{print $2}'</span> host_list.log
www
blog
study
linux
python
[root@centos8 ~]#awk -F<span class="org-string">"[ .]"</span> <span class="org-string">'{print $2}'</span> host_list.log &gt;&gt; host_list.log
[root@centos8 ~]#cat host_list.log
1 www.me.com
2 blog.me.com
3 study.me.com
4 linux.me.com
5 python.me.com
www
blog
study
linux
python
</pre>
</div>
</div>
</div>
<div id="outline-container-h:410d13ba-f572-422d-821a-dc467b6d927c" class="outline-4">
<h4 id="h:410d13ba-f572-422d-821a-dc467b6d927c"><a href="#h:410d13ba-f572-422d-821a-dc467b6d927c">awk变量</a></h4>
<div class="outline-text-4" id="text-h:410d13ba-f572-422d-821a-dc467b6d927c">
<p>
awk中的变量分为：内置和自定义变量
</p>

<p>
<b>常见的内置变量</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">FS&#65306;input field seperator&#36755;&#20837;&#23383;&#27573;&#20998;&#38548;&#31526;&#65292;&#40664;&#35748;&#20026;&#31354;&#30333;&#23383;&#31526;&#65307;
OFS&#65306;output field seperator&#65292;&#36755;&#20986;&#23383;&#27573;&#20998;&#38548;&#31526;&#65292;&#40664;&#35748;&#20026;&#31354;&#30333;&#23383;&#31526;&#65307;
RS&#65306;input record seperator&#65292;&#36755;&#20837;&#26102;&#30340;&#25442;&#34892;&#31526;&#65307;
ORS&#65306;output record seperator&#65292;&#36755;&#20986;&#26102;&#30340;&#25442;&#34892;&#31526;&#65307;
NF: number of field,&#23383;&#27573;&#25968;&#37327;
NR: number of record&#65292;&#34892;&#25968;
FNR: &#27599;&#19968;&#20010;&#25991;&#20214;&#21333;&#29420;&#35745;&#24405;&#34892;&#25968;
FILENAME: &#24403;&#21069;&#25991;&#20214;&#21517;
ARGC: &#21629;&#20196;&#34892;&#21442;&#25968;&#30340;&#20010;&#25968;
ARGV: &#25968;&#32452;&#65292;&#20445;&#23384;&#20102;&#21629;&#20196;&#34892;&#20013;&#30340;&#21508;&#21442;&#25968;
ARGIND &#21629;&#20196;&#34892;&#20013;&#25991;&#20214;&#24207;&#21495;
</pre>
</div>

<ul class="org-ul">
<li>FS：输入字段分隔符，默认为空白字符,功能相当于 -F</li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">awk -v <span class="org-variable-name">FS</span>=<span class="org-string">':'</span> <span class="org-string">'{print $1,FS,$3}'</span> /etc/passwd
awk -v <span class="org-variable-name">FS</span>=<span class="org-string">":"</span> <span class="org-string">'{print $1FS$3}'</span> /etc/passwd
awk &#8211;F:  <span class="org-string">'{print $1,$3,$7}'</span>  /etc/passwd
<span class="org-variable-name">S</span>=:;awk -v <span class="org-variable-name">FS</span>=$<span class="org-variable-name">S</span> <span class="org-string">'{print $1FS$3}'</span> /etc/passwd

[root@centos8 ~]#awk -v <span class="org-variable-name">FS</span>=<span class="org-string">":"</span> <span class="org-string">'{print $1FS$3}'</span> /etc/passwd |head -n3
root:0
bin:1
daemon:2
[root@centos8 ~]#<span class="org-variable-name">S</span>=:;awk -F$<span class="org-variable-name">S</span>  <span class="org-string">'{print $1,$3}'</span> /etc/passwd|head -n3
root 0
bin 1
daemon 2
[root@centos8 ~]#

<span class="org-comment-delimiter">#</span><span class="org-comment">-F &#21644; FS&#21464;&#37327;&#21151;&#33021;&#19968;&#26679;&#65292;&#21516;&#26102;&#20351;&#29992;&#20250;&#20914;&#31361;
</span>[root@centos8 ~]#awk -v <span class="org-variable-name">FS</span>=<span class="org-string">":"</span> -F<span class="org-string">";"</span> <span class="org-string">'{print $1FS$3}'</span> /etc/passwd |head -n3
root:x:0:0:root:/root:/bin/bash;
bin:x:1:1:bin:/bin:/sbin/nologin;
daemon:x:2:2:daemon:/sbin:/sbin/nologin;
[root@centos8 ~]#awk -F<span class="org-string">";"</span> -v <span class="org-variable-name">FS</span>=<span class="org-string">":"</span> <span class="org-string">'{print $1FS$3}'</span> /etc/passwd |head -n3
root:0
bin:1
daemon:2
[root@centos8 ~]#
</pre>
</div>

<ul class="org-ul">
<li><p>
OFS：输出字段分隔符，默认为空白字符 范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk -v <span class="org-variable-name">FS</span>=<span class="org-string">':'</span>  <span class="org-string">'{print $1,$3,$7}'</span>  /etc/passwd|head -n1
root 0 /bin/bash
[root@centos8 ~]#awk -v <span class="org-variable-name">FS</span>=<span class="org-string">':'</span> -v <span class="org-variable-name">OFS</span>=<span class="org-string">':'</span> <span class="org-string">'{print $1,$3,$7}'</span> /etc/passwd|head -n1
root:0:/bin/bash
</pre>
</div></li>

<li><p>
RS：输入记录record分隔符，指定输入时的换行符 范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">awk -v <span class="org-variable-name">RS</span>=<span class="org-string">' '</span> &#8216;{<span class="org-builtin">print</span> }&#8217; /etc/passwd
</pre>
</div></li>

<li><p>
ORS：输出记录分隔符，输出时用指定符号代替换行符 范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">awk -v <span class="org-variable-name">RS</span>=<span class="org-string">' '</span> -v <span class="org-variable-name">ORS</span>=<span class="org-string">'###'</span> <span class="org-string">'{print $0}'</span> /etc/passwd
</pre>
</div></li>

<li><p>
NF：字段数量 范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#24341;&#29992;&#21464;&#37327;&#26102;&#65292;&#21464;&#37327;&#21069;&#19981;&#38656;&#21152;$
</span>[root@centos8 ~]#awk -F&#65306;<span class="org-string">'{print NF}'</span> /etc/fstab
[root@centos8 ~]#awk -F&#65306;<span class="org-string">'{print $(NF-1)}'</span> /etc/passwd <span class="org-comment-delimiter">#</span><span class="org-comment">$(NF-1) &#26368;&#21518;&#19968;&#21015;&#20943;1
</span>[root@centos8 ~]#ls /misc/cd/BaseOS/Packages/*.rpm |awk -F<span class="org-string">"."</span> <span class="org-string">'{print $(NF-1)}'</span>|sort |uniq -c
389 i686
208 noarch
1060 x86_64
</pre>
</div></li>
</ul>

<p>
面试题：接数最多的前3个IP
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk -F<span class="org-string">" +|:"</span> <span class="org-string">'{print $(NF-2)}'</span> ss.log |sort |uniq -c|sort -nr|head -n3
  12 223.88.255.148
  11 119.250.197.118
  10 183.202.63.36
[root@centos8 ~]#awk -F<span class="org-string">" +|:"</span> <span class="org-string">'/^ESTAB/{print $(NF-2)}'</span> ss.log |sort |uniq -c|sort -nr|head -n3
  12 223.88.255.148
  10 183.202.63.36
  9 117.152.155.119
[root@centos8 ~]#ss -nt |grep <span class="org-string">"^ESTAB"</span> | awk -F<span class="org-string">"[[:space:]]+|:"</span> <span class="org-string">'{print $(NF-2)}'</span>
10.0.0.1
10.0.0.7
10.0.0.1

[root@centos8 ~]#ss -nt |awk -F<span class="org-string">"[[:space:]]+|:"</span> <span class="org-string">'/^ESTAB/{print $(NF-2)}'</span>

[root@centos8 ~]#ss -nt|awk -F: <span class="org-string">'{print $(NF-1)}'</span> |awk <span class="org-string">'/^[0-9]/{print $NF}'</span>|sort |uniq -c |head -n 3
</pre>
</div>

<p>
范例：每十分钟检查将连接数超过100个以上的IP放入黑名单拒绝访问
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat deny_dos.sh
<span class="org-variable-name">LINK</span>=100
<span class="org-keyword">while </span><span class="org-builtin">true</span>;<span class="org-keyword">do</span>
    ss -nt | awk -F<span class="org-string">"[[:space:]]+|:"</span> <span class="org-string">'/^ESTAB/{print $(NF-2)}'</span>|sort |uniq -c|<span class="org-keyword">while </span><span class="org-builtin">read</span> count ip;<span class="org-keyword">do</span>
        <span class="org-keyword">if</span> [ $<span class="org-variable-name">count</span> -gt $<span class="org-variable-name">LINK</span> ];<span class="org-keyword">then</span>
            iptables -A INPUT -s $<span class="org-variable-name">ip</span> -j REJECT
        <span class="org-keyword">fi</span>
    <span class="org-keyword">done</span>
<span class="org-keyword">done</span>

[root@centos8 ~]#chmod +x /root/deny_dos.sh
[root@centos8 ~]#crontab -e
[root@centos8 ~]#crontab -l
*/10 * * * *  /root/deny_dos.sh
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat deny_dos.sh
<span class="org-variable-name">IPLIST</span>=<span class="org-sh-quoted-exec">`awk -F" +|:" '/^ESTAB/{print $(NF-2)}' ss.log |sort |uniq -c|sort -nr|head -3|awk '{print $2}'`</span>
<span class="org-keyword">for</span> ip<span class="org-keyword"> in</span> $<span class="org-variable-name">IPLIST</span>;<span class="org-keyword">do</span>
    iptables -A INPUT -s $<span class="org-variable-name">ip</span> -j REJECT
<span class="org-keyword">done</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
NR：记录的编号，行的数量 范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'{print NR,$0}'</span> /etc/issue /etc/centos-release
1 \S
2 Kernel \r on an \m
3
4 CentOS Linux release 8.1.1911 (Core)
</pre>
</div></li>
</ul>

<p>
范例：取ifconfig输出结果中的IP地址
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#ifconfig eth0 | awk <span class="org-string">'/netmask/{print $2}'</span>
10.0.0.8
[root@centos8 ~]#ifconfig eth0 | awk <span class="org-string">'NR==2{print $2}'</span>
10.0.0.8
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk -F: <span class="org-string">'{print NR}'</span> /etc/passwd
1
2
3
.......
[root@centos8 ~]#awk -F: <span class="org-string">'END{print NR}'</span> /etc/passwd
57
[root@centos8 ~]#awk -F: <span class="org-string">'BEGIN{print NR}'</span> /etc/passwd
0
</pre>
</div>

<ul class="org-ul">
<li><p>
FNR：各文件分别计数，记录的编号 范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">awk <span class="org-string">'{print FNR}'</span> /etc/fstab /etc/inittab
[root@centos8 ~]#awk <span class="org-string">'{print NR,$0}'</span> /etc/issue /etc/redhat-release
1 \S
2 Kernel \r on an \m
3
4 CentOS Linux release 8.0.1905 (Core)

[root@centos8 script40]#awk <span class="org-string">'{print FNR,$0}'</span> /etc/issue /etc/redhat-release
1 \S
2 Kernel \r on an \m
3
1 CentOS Linux release 8.0.1905 (Core)
</pre>
</div></li>

<li>FILENAME：当前文件名</li>
</ul>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'{print FILENAME}'</span> /etc/fstab
[root@centos8 ~]#awk <span class="org-string">'{print FNR,FILENAME,$0}'</span> /etc/issue /etc/redhat-release
1 /etc/issue \S
2 /etc/issue Kernel \r on an \m
3 /etc/issue
1 /etc/redhat-release CentOS Linux release 8.0.1905 (Core)
</pre>
</div>

<ul class="org-ul">
<li><p>
ARGC：命令行参数的个数 范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'{print ARGC}'</span> /etc/issue /etc/redhat-release
3
3
3
3
[root@centos8 ~]#awk <span class="org-string">'BEGIN{print ARGC}'</span> /etc/issue /etc/redhat-release
3
</pre>
</div></li>

<li><p>
ARGV：数组，保存的是命令行所给定的各参数，每一个参数：ARGV[0]，&#x2026;&#x2026;
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'BEGIN{print ARGV[0]}'</span> /etc/issue /etc/redhat-release
awk
[root@centos8 ~]#awk <span class="org-string">'BEGIN{print ARGV[1]}'</span> /etc/issue /etc/redhat-release
/etc/issue
[root@centos8 ~]#awk <span class="org-string">'BEGIN{print ARGV[2]}'</span> /etc/issue /etc/redhat-release
/etc/redhat-release
[root@centos8 ~]#awk <span class="org-string">'BEGIN{print ARGV[3]}'</span> /etc/issue /etc/redhat-release
[root@centos8 ~]#
</pre>
</div></li>

<li><p>
ARGIND 命令行中文件序号
</p>

<p>
范例：2个文件比较
</p></li>
</ul>

<pre class="example" id="orgc055bdf">
我要比较a和b两个文件；
a              b
1              1
qw            2
qq            d
123          cd
我怎么才能列出b文件中完全不包含a文件的行？？

解答： awk 'ARGIND==1 {a[$0]} ARGIND&gt;1&amp;&amp;!($0 in a) {print $0}' a b
或者： awk 'NR==FNR {a[$0]} NR&gt;FNR&amp;&amp;!($0 in a) {print $0}' a b
代码解释：
ARGIND==1{a[$0]}
#ARGIND==1 判断是否正在处理第一个文件，本例为文件a
# {a[$0]} 初始化（或叫做定义）a[$0]
ARGIND&gt;1&amp;&amp;!($0 in a){print $0}
#ARGIND&gt;1 判断是否在处理第二个或第n个文件，本例只有一个文件b
#并且判断a[$0]是否未定义，然后打印$0
</pre>

<p>
范例：处理 2 个文件
</p>

<p>
当awk读取的文件只有两个的时候，比较常用的有两种方法：
</p>

<pre class="example" id="orgd86d5e3">
(1) 一种是 awk 'NR==FNR{...}NR&gt;FNR{...}'  file1 file2   或    awk 'NR==FNR{...}NR!=FNR{...}' file1 file2
(2) 另一种是 awk 'NR==FNR{...;next}{...}' file1 file2

awk 'NR==FNR{...}NR&gt;FNR{...}' file1 file2
# 读入file1的时候，已读入file1的记录数FNR一定等于awk已读入的总记录数NR，因为file1是awk读入的首个文件，故读入file1时执行前一个命令块{...}
# 读入file2的时候，已读入的总记录数NR一定&gt;读入file2的记录数FNR，故读入file2时执行后一个命令块{...}


awk 'NR==FNR{...;next}{...}' file1 file2
# 读入file1时，满足NR==FNR，先执行前一个命令块，但因为其中有next命令，故后一个命令块{...}是不会执行的
# 读入file2时，不满足NR==FNR，前一个命令块{..}不会执行，只执行后一个命令块{...}
</pre>

<p>
当awk处理的文件超过两个时，显然上面那种方法就不适用了。因为读第3个文件
或以上时，也满足NR&gt;FNR (NR!=FNR)，显然无法区分开来，所以就要用到更通用
的方法了：
</p>

<pre class="example" id="org336c64e">
1. ARGIND        # 当前被处理参数标志
awk 'ARGIND==1{...}ARGIND==2{...}ARGIND==3{...}... ' file1 file2 file3 ...

2. ARGV            # 命令行参数数组
awk 'FILENAME==ARGV[1]{...}FILENAME==ARGV[2]{...}FILENAME==ARGV[3]{...}...' file1 file2 file3 ...

3. 把文件名直接加入判断
awk 'FILENAME=="file1"{...}FILENAME=="file2"{...}FILENAME=="file3"{...}...' file1 file2 file3 ...
</pre>

<pre class="example" id="org4d5b098">
[root@app-nginx03 logs]# cat Top_app-nginx03_adverttisement_access_2017-09-12.log.csv
1,-
1,/hdzuoye_advertise/advertise/hadvertiseErrorGetter.do?positionId=2
7,/hdzuoye_advertise/advertise/getCurrentADByPosition.do
38,/hdzuoye_advertise/advertise/getCurrentADByPosition.do?positionId=2&amp;adCount=1
20092415,/hdzuoye_advertise/advertise/addAdvertiseAmountLog.do
[root@app-nginx03 logs]# cat Top_app-nginx02_adverttisement_access_2017-09-12.log.csv
4,-
5,/hdzuoye_advertise/advertise/getCurrentADByPosition.do?positionId=2&amp;adCount=1
1153013,/hdzuoye_advertise/advertise/addAdvertiseAmountLog.do


[root@app-nginx03 logs]# awk  -F\, 'NR==FNR{n[$2]=$1;next} {print n[$2]+$1","$2}' Top_app-nginx02_adverttisement_access_2017-09-12.log.csv Top_app-nginx03_adverttisement_access_2017-09-12.log.csv
5,-
1,/hdzuoye_advertise/advertise/hadvertiseErrorGetter.do?positionId=2
7,/hdzuoye_advertise/advertise/getCurrentADByPosition.do
43,/hdzuoye_advertise/advertise/getCurrentADByPosition.do?positionId=2&amp;adCount=1
21245428,/hdzuoye_advertise/advertise/addAdvertiseAmountLog.do


[root@app-nginx03 logs]# awk  -F\, 'ARGIND==1{n[$2]=$1} ARGIND==2 {print n[$2]+$1","$2}' Top_app-nginx02_adverttisement_access_2017-09-12.log.csv Top_app-nginx03_adverttisement_access_2017-09-12.log.csv
5,-
1,/hdzuoye_advertise/advertise/hadvertiseErrorGetter.do?positionId=2
7,/hdzuoye_advertise/advertise/getCurrentADByPosition.do
43,/hdzuoye_advertise/advertise/getCurrentADByPosition.do?positionId=2&amp;adCount=1
21245428,/hdzuoye_advertise/advertise/addAdvertiseAmountLog.do
</pre>

<p>
<b>自定义变量(区分字符大小写)</b>
</p>

<ul class="org-ul">
<li>-v var=value</li>
<li>在program中直接定义</li>
</ul>

<p>
注意：
</p>

<ul class="org-ul">
<li>引用字段变量是不需要加\(符的，引用字段可以加\)</li>
<li>外部变量需要用引号分离出，使shell能解析</li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">awk  -v <span class="org-variable-name">test</span>=<span class="org-string">'hello gawk'</span> <span class="org-string">'{print test}'</span> /etc/fstab
awk  -v <span class="org-variable-name">test</span>=<span class="org-string">'hello gawk'</span> <span class="org-string">'BEGIN{print test}'</span>
awk  <span class="org-string">'BEGIN{test="hello,gawk";print test}'</span> <span class="org-comment-delimiter"># </span><span class="org-comment">&#20869;&#37096;&#21464;&#37327;&#36171;&#20540;
</span>awk  -F: <span class="org-string">'{sex="male";print $1,sex,age;age=18}'</span> /etc/passwd  <span class="org-comment-delimiter"># </span><span class="org-comment">&#36825;&#37324;&#21464;&#37327;&#26159;&#20808;&#36171;&#20540;&#20877;&#20351;&#29992;&#65292;&#20174;&#31532;&#20108;&#34892;&#25165;&#26377;age&#30340;&#20540;
</span>
cat awkscript
{<span class="org-builtin">print</span> script,$<span class="org-variable-name">1</span>,$<span class="org-variable-name">2</span>}
awk  -F: -f awkscript <span class="org-variable-name">script</span>=<span class="org-string">"awk"</span> /etc/passwd
</pre>
</div>

<p>
范例：引用外部变量
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@ali-bj-prod-web001 conf.d]# <span class="org-variable-name">a</span>=123
[root@ali-bj-prod-web001 conf.d]# awk <span class="org-string">'BEGIN{print a}'</span>

[root@ali-bj-prod-web001 conf.d]# awk <span class="org-string">'BEGIN{print '"$a"'}'</span>
123
[root@ali-bj-prod-web001 conf.d]# awk <span class="org-string">"BEGIN{print "</span>$<span class="org-variable-name">a</span><span class="org-string">"}"</span>
123
[root@ali-bj-prod-web001 conf.d]# awk BEGIN<span class="org-string">\{</span><span class="org-builtin">print</span><span class="org-string">\""$a"\"\}</span>
123

<span class="org-variable-name">user_bili</span>=$(awk <span class="org-string">'BEGIN{printf "%.2f\n", '</span>$<span class="org-variable-name">user_pv</span><span class="org-string">'/'</span>$<span class="org-variable-name">totoal_pv</span><span class="org-string">'*100}'</span> )
</pre>
</div>
</div>
</div>
<div id="outline-container-h:0550fd59-cb4e-4ed3-967e-3116e4b0d11b" class="outline-4">
<h4 id="h:0550fd59-cb4e-4ed3-967e-3116e4b0d11b"><a href="#h:0550fd59-cb4e-4ed3-967e-3116e4b0d11b">动作 printf</a></h4>
<div class="outline-text-4" id="text-h:0550fd59-cb4e-4ed3-967e-3116e4b0d11b">
<p>
printf 可以实现格式化输出
</p>

<p>
格式： printf "FORMAT", item1, item2, &#x2026;
</p>

<p>
说明：
</p>

<ul class="org-ul">
<li>必须指定FORMAT</li>
<li>不会自动换行，需要显式给出换行控制符 \n</li>
<li>FORMAT中需要分别为后面每个item指定格式符</li>
</ul>

<p>
格式符：与item一一对应
</p>

<ul class="org-ul">
<li>%c：显示字符的ASCII码</li>
<li>%d, %i：显示十进制整数</li>
<li>%x %X 无符号以十六进制表示的整数</li>
<li>%o 无符号以八进制表示的整数</li>
<li>%e, %E：显示科学计数法数值</li>
<li>%p 指针的值</li>
<li>%f：显示为浮点数</li>
<li>%g, %G：以科学计数法或浮点形式显示数值</li>
<li>%s：显示字符串</li>
<li>%u：无符号整数</li>
<li>%%：显示%自身</li>
</ul>

<p>
修饰符
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">[.#] &#31532;&#19968;&#20010;&#25968;&#23383;&#25511;&#21046;&#26174;&#31034;&#30340;&#23485;&#24230;&#65307;&#31532;&#20108;&#20010;#&#34920;&#31034;&#23567;&#25968;&#28857;&#21518;&#31934;&#24230;&#65292;&#22914;&#65306;%3.1f
</span>- &#24038;&#23545;&#40784;&#65288;&#40664;&#35748;&#21491;&#23545;&#40784;&#65289; &#22914;&#65306;%-15s
+  &#26174;&#31034;&#25968;&#20540;&#30340;&#27491;&#36127;&#31526;&#21495;  &#22914;&#65306;%+d
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">awk -F:  <span class="org-string">'{printf "%s",$1}'</span> /etc/passwd
awk -F:  <span class="org-string">'{printf "%s\n",$1}'</span> /etc/passwd
awk -F:  <span class="org-string">'{printf "%20s\n",$1}'</span> /etc/passwd
awk -F:  <span class="org-string">'{printf "%-20s\n",$1}'</span> /etc/passwd
awk -F:  <span class="org-string">'{printf "%-20s %10d\n",$1,$3}'</span> /etc/passwd
awk -F:  <span class="org-string">'{printf "Username: %s\n",$1}'</span> /etc/passwd
awk -F:  <span class="org-string">'{printf &#8220;Username: %sUID:%d\n",$1,$3}'</span> /etc/passwd
awk -F:  <span class="org-string">'{printf "Username: %25sUID:%d\n",$1,$3}'</span> /etc/passwd
awk -F:  <span class="org-string">'{printf "Username: %-25sUID:%d\n",$1,$3}'</span> /etc/passwd
</pre>
</div>
</div>
</div>
<div id="outline-container-h:0c9fc8eb-9b81-4ecb-95fc-ea30fcb5aa8f" class="outline-4">
<h4 id="h:0c9fc8eb-9b81-4ecb-95fc-ea30fcb5aa8f"><a href="#h:0c9fc8eb-9b81-4ecb-95fc-ea30fcb5aa8f">操作符</a></h4>
<div class="outline-text-4" id="text-h:0c9fc8eb-9b81-4ecb-95fc-ea30fcb5aa8f">
<p>
1)算术操作符：
</p>

<div class="org-src-container">
<pre class="src src-sh">x+y, x-y, x*y, x/y, x^y, x%y
-x&#65306;&#36716;&#25442;&#20026;&#36127;&#25968;
+x&#65306;&#23558;&#23383;&#31526;&#20018;&#36716;&#25442;&#20026;&#25968;&#20540;
</pre>
</div>

<p>
2)字符串操作符：没有符号的操作符，字符串连接 3)赋值操作符：
</p>

<div class="org-src-container">
<pre class="src src-sh">=, +=, -=, *=, /=, %=, ^=&#65292;++, --
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'BEGIN{i=0;print i++,i}'</span>
0 1
[root@centos8 ~]#awk <span class="org-string">'BEGIN{i=0;print ++i,i}'</span>
1 1
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk -v <span class="org-variable-name">n</span>=0 <span class="org-string">'!n++'</span> /etc/passwd <span class="org-comment-delimiter"># </span><span class="org-comment">&#30495;&#65306;&#32467;&#26524;&#20026;&#38750;0&#20540;&#65292;&#38750;&#31354;&#23383;&#31526;&#20018;&#12290;&#31532;&#19968;&#34892;!n&#20026;!0&#20026;1&#26159;&#30495;&#21017;&#25171;&#21360;&#65292;&#31532;&#20108;&#34892;!n&#20026;!2&#20026;0&#26159;&#20551;&#19981;&#25171;&#21360;&#65292;&#20197;&#27492;&#31867;&#25512;
</span>root:x:0:0:root:/root:/bin/bash

[root@centos8 ~]#awk -v <span class="org-variable-name">n</span>=0 <span class="org-string">'!n++{print n}'</span> /etc/passwd
1
[root@centos8 ~]#awk -v <span class="org-variable-name">n</span>=1 <span class="org-string">'!n++{print n}'</span> /etc/passwd <span class="org-comment-delimiter"># </span><span class="org-comment">&#27704;&#36828;&#20026;&#20551;&#21017;&#19981;&#25171;&#21360;
</span>[root@centos8 ~]#awk -v <span class="org-variable-name">n</span>=0 <span class="org-string">'!++n{print n}'</span> /etc/passwd

[root@centos8 ~]#awk -v <span class="org-variable-name">n</span>=0 <span class="org-string">'!++n'</span> /etc/passwd
[root@centos8 ~]#awk -v <span class="org-variable-name">n</span>=-1 <span class="org-string">'!++n'</span> /etc/passwd
root:x:0:0:root:/root:/bin/bash
</pre>
</div>

<p>
4)比较操作符：
</p>

<div class="org-src-container">
<pre class="src src-sh">==, !=, &gt;, &gt;=, &lt;, &lt;=
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'NR==2'</span> /etc/issue <span class="org-comment-delimiter"># </span><span class="org-comment">&#36825;&#26159;&#38544;&#34255;&#20102;{print $0}
</span>Kernel \r on an \m
[root@centos8 ~]#awk -F: <span class="org-string">'$3&gt;=1000'</span> /etc/passwd
nobody:x:65534:65534:Kernel Overflow User:/:/sbin/nologin
wang:x:1000:1000:wang:/home/wang:/bin/bash
cici:x:1001:1001::/home/cici:/bin/bash
</pre>
</div>

<p>
范例：取奇，偶数行
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#seq 10 | awk <span class="org-string">'NR%2==0'</span>
2
4
6
8
10
[root@centos8 ~]#seq 10 | awk <span class="org-string">'NR%2==1'</span>
1
3
5
7
9
[root@centos8 ~]#seq 10 | awk <span class="org-string">'NR%2!=0'</span>
1
3
5
7
9
</pre>
</div>

<p>
5)模式匹配符：
</p>

<div class="org-src-container">
<pre class="src src-sh">~ &#24038;&#36793;&#26159;&#21542;&#21644;&#21491;&#36793;&#21305;&#37197;&#65292;&#21253;&#21547;&#20851;&#31995;
<span class="org-negation-char">!</span>~ &#26159;&#21542;&#19981;&#21305;&#37197;
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk -F: <span class="org-string">'$0 ~ /root/{print $1}'</span> /etc/passwd
[root@centos8 ~]#awk -F: <span class="org-string">'$0 ~ "^root"{print $1}'</span> /etc/passwd
[root@centos8 ~]#awk <span class="org-string">'$0 !~ /root/'</span>  /etc/passwd
[root@centos8 ~]#awk <span class="org-string">'/root/'</span>  /etc/passwd
[root@centos8 ~]#awk -F: <span class="org-string">'$3==0'</span>   /etc/passwd
[root@centos8 ~]#df | awk -F<span class="org-string">"[[:space:]]+|%"</span> <span class="org-string">'$0 ~ /^\/dev\/sd/{print $5}'</span>
5
1
92

[root@centos8 ~]#ifconfig eth0 | awk <span class="org-string">'NR==2{print $2}'</span>
10.0.0.8

$<span class="org-variable-name">kube_CMD</span> -n $<span class="org-variable-name">namespace</span> get pod |sed <span class="org-string">'1d'</span>|awk <span class="org-string">'$(NF-3)~"0/" &amp;&amp; $NF!~"(^[1-6]m|^[1-60]s)"{print $1}'</span>
</pre>
</div>

<p>
6)逻辑操作符：
</p>

<div class="org-src-container">
<pre class="src src-sh">&#19982;&#65306;&amp;&amp;&#65292;&#24182;&#19988;&#20851;&#31995;
&#25110;&#65306;||&#65292;&#25110;&#32773;&#20851;&#31995;
&#38750;&#65306;!&#65292;&#21462;&#21453;
</pre>
</div>

<p>
范例：！取反
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'BEGIN{print i}'</span>
[root@centos8 ~]#awk <span class="org-string">'BEGIN{print !i}'</span>
1
[root@centos8 ~]#awk -v <span class="org-variable-name">i</span>=10 <span class="org-string">'BEGIN{print !i}'</span>
0
[root@centos8 ~]#awk -v <span class="org-variable-name">i</span>=-3 <span class="org-string">'BEGIN{print !i}'</span>
0
[root@centos8 ~]#awk -v <span class="org-variable-name">i</span>=0 <span class="org-string">'BEGIN{print !i}'</span>
1
[root@centos8 ~]#awk -v <span class="org-variable-name">i</span>=abc <span class="org-string">'BEGIN{print !i}'</span>
0
[root@centos8 ~]#awk -v <span class="org-variable-name">i</span>=<span class="org-string">''</span> <span class="org-string">'BEGIN{print !i}'</span>
1
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">awk -F:  <span class="org-string">'$3&gt;=0 &amp;&amp; $3&lt;=1000 {print $1,$3}'</span> /etc/passwd
awk -F:  <span class="org-string">'$3==0 || $3&gt;=1000 {print $1,$3}'</span> /etc/passwd
awk -F:  <span class="org-string">'!($3==0) {print $1,$3}'</span>   /etc/passwd
awk -F:  <span class="org-string">'!($3&gt;=500) {print $1,$3}'</span> /etc/passwd
</pre>
</div>

<p>
7)条件表达式（三目表达式）
</p>

<div class="org-src-container">
<pre class="src src-sh">selector?if-true-expression:if-false-expression <span class="org-comment-delimiter"># </span><span class="org-comment">selector&#20026;&#30495;&#25191;&#34892;&#31532;&#19968;&#20010;:&#21542;&#21017;&#31532;&#20108;&#20010;</span>
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">awk -F: <span class="org-string">'{$3&gt;=1000?usertype="Common User":usertype="SysUser";printf "%-20s:%12s\n",$1,usertype}'</span>  /etc/passwd
</pre>
</div>
</div>
</div>
<div id="outline-container-h:2ac2a1da-7c39-4d4a-801c-68c3b8401190" class="outline-4">
<h4 id="h:2ac2a1da-7c39-4d4a-801c-68c3b8401190"><a href="#h:2ac2a1da-7c39-4d4a-801c-68c3b8401190">模式PATTERN</a></h4>
<div class="outline-text-4" id="text-h:2ac2a1da-7c39-4d4a-801c-68c3b8401190">
<p>
PATTERN:根据pattern条件，过滤匹配的行，再做处理
</p>

<ol class="org-ol">
<li>如果未指定：空模式，匹配每一行</li>
</ol>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk -F: <span class="org-string">'{print $1,$3}'</span> /etc/passwd
</pre>
</div>

<ol class="org-ol">
<li><code>/regular expression/</code> ：仅处理能够模式匹配到的行，需要用 <code>/ /</code> 括起来</li>
</ol>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk  <span class="org-string">'/^UUID/{print $1}'</span>   /etc/fstab
[root@centos8 ~]#awk  <span class="org-string">'!/^UUID/{print $1}'</span>  /etc/fstab
[root@centos8 ~]#df | awk <span class="org-string">'/^\/dev\/sd/'</span>
/dev/sda2    104806400 4935924  99870476  5% /
/dev/sda3    52403200  398876  52004324  1% /data
/dev/sda1     999320  848572   81936  92% /boot

<span class="org-comment-delimiter"># </span><span class="org-comment">&#22810;&#26465;&#20214;:
</span>awk <span class="org-string">'/^(Sep 9|Sep 10).*(error|fail)/'</span> testfile
</pre>
</div>

<ol class="org-ol">
<li>relational expression: 关系表达式，结果为“真”才会被处理真：结果为
非0值，非空字符串 假：结果为空字符串或0值</li>
</ol>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'!1'</span> /etc/passwd <span class="org-comment-delimiter"># </span><span class="org-comment">!1&#21518;&#38754;&#38544;&#34255;&#20102;{print $0}
</span>[root@centos8 ~]#awk <span class="org-string">'!0'</span> /etc/passwd
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
.......

[root@centos8 ~]#awk <span class="org-string">'1'</span> /etc/issue
\S
Kernel \r on an \m

[root@centos8 ~]#awk <span class="org-string">'0'</span> /etc/issue
[root@centos8 ~]#awk <span class="org-string">'"me"'</span> /etc/issue
\S
Kernel \r on an \m

[root@centos8 ~]#awk <span class="org-string">'""'</span> /etc/issue
[root@centos8 ~]#awk <span class="org-string">'me'</span> /etc/issue
[root@centos8 ~]#awk <span class="org-string">'me'</span> /etc/issue
[root@centos8 ~]#awk -v <span class="org-variable-name">me</span>=wang <span class="org-string">'me'</span> /etc/issue
\S
Kernel \r on an \m

[root@centos8 ~]#awk -v <span class="org-variable-name">me</span>=<span class="org-string">""</span> <span class="org-string">'me'</span> /etc/issue
[root@centos8 ~]#awk -v <span class="org-variable-name">me</span>=<span class="org-string">"0"</span> <span class="org-string">'me'</span> /etc/issue
[root@centos8 ~]#awk -v <span class="org-variable-name">me</span>=0 <span class="org-string">'me'</span> /etc/issue
[root@centos8 ~]#awk <span class="org-string">'"0"'</span> /etc/issue
\S
Kernel \r on an \m

[root@centos8 ~]#awk <span class="org-string">'0'</span> /etc/issue
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">awk  -F:  <span class="org-string">'i=1;j=1{print i,j}'</span> /etc/passwd  <span class="org-comment-delimiter">#</span><span class="org-comment">&#36825;&#37324;i=1&#38544;&#34255;&#20102;{print $0}
</span>
Awk  -F: <span class="org-string">'$3&gt;=1000{print $1,$3}'</span> /etc/passwd
awk  -F: <span class="org-string">'$3&lt;1000{print $1,$3}'</span> /etc/passwd
awk  -F: <span class="org-string">'$NF=="/bin/bash"{print $1,$NF}'</span> /etc/passwd

[root@centos8 ~]#awk -F: <span class="org-string">'$NF=="/bin/bash"{print $1,$NF}'</span> /etc/passwd
root /bin/bash
wang /bin/bash
cici /bin/bash

[root@centos8 ~]#awk -F: <span class="org-string">'$NF ~ /bash$/{print $1,$NF}'</span> /etc/passwd
root /bin/bash
wang /bin/bash
cici /bin/bash
</pre>
</div>

<ol class="org-ol">
<li><p>
oline ranges：行范围
</p>

<p>
不支持直接用行号，但可以使用变量NR间接指定行号 <code>/pat1/,/pat2/</code>
</p>

<p>
不支持直接给出数字格式
</p></li>
</ol>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#seq 10 | awk <span class="org-string">'NR&gt;=3 &amp;&amp; NR&lt;=6'</span>
3
4
5
6

[root@centos8 ~]#awk <span class="org-string">'NR&gt;=3 &amp;&amp; NR&lt;=6{print NR,$0}'</span> /etc/passwd
3 daemon:x:2:2:daemon:/sbin:/sbin/nologin
4 adm:x:3:4:adm:/var/adm:/sbin/nologin
5 lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
6 sync:x:5:0:sync:/sbin:/bin/sync

[root@centos8 ~]#sed -n <span class="org-string">'3,6p'</span> /etc/passwd
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync

[root@centos8 ~]#awk <span class="org-string">'/^bin/,/^adm/'</span> /etc/passwd
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
[root@centos8 ~]#sed -n <span class="org-string">'/^bin/,/^adm/p'</span> /etc/passwd
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
</pre>
</div>

<ol class="org-ol">
<li><p>
BEGIN/END模式
</p>

<p>
BEGIN{}：仅在开始处理文件中的文本之前执行一次
</p>

<p>
END{}：仅在文本处理完成之后执行一次
</p></li>
</ol>

<p>
范例
</p>

<div class="org-src-container">
<pre class="src src-sh">awk -F : <span class="org-string">'BEGIN {print "USER USERID"} {print $1":"$3} END{print "END FILE"}'</span> /etc/passwd
[root@ali-bj-prod-web001 ~]# awk -F : <span class="org-string">'BEGIN {print "USER USERID"} {print $1":"$3} END{print "END FILE"}'</span> /etc/passwd
USER USERID
root:0
... ...
rpc:32
END FILE

awk -F: <span class="org-string">'{print "USER USERID";print $1":"$3} END{print "END FILE"}'</span> /etc/passwd
awk -F: <span class="org-string">'BEGIN{print "USER UID \n--------------- "}{print $1,$3}'</span> /etc/passwd
awk -F: <span class="org-string">'BEGIN{print "USER UID \n--------"}{print $1,$3}END{print "=========="}'</span> /etc/passwd
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">seq 10 | awk  <span class="org-string">'i=0'</span>
seq 10 | awk  <span class="org-string">'i=1'</span>
seq 10 | awk  <span class="org-string">'i=!i'</span>
seq 10 | awk  <span class="org-string">'{i=!i;print i}'</span>
seq 10 | awk  <span class="org-string">'!(i=!i)'</span>
seq 10 | awk -v <span class="org-variable-name">i</span>=1 <span class="org-string">'i=!i'</span>
[root@centos8 ~]#seq 10 | awk  <span class="org-string">'i=0'</span>
[root@centos8 ~]#seq 10 | awk  <span class="org-string">'i=1'</span>
1
2
3
4
5
6
7
8
9
10
[root@centos8 ~]#seq 10 | awk  <span class="org-string">'i=1'</span>
1
2
3
4
5
6
7
8
9
10
[root@centos8 ~]#seq 10 | awk  <span class="org-string">'i=0'</span>
[root@centos8 ~]#seq 10 | awk  <span class="org-string">'i=!i'</span> <span class="org-comment-delimiter"># </span><span class="org-comment">&#22855;&#25968;&#34892;
</span>1
3
5
7
9
[root@centos8 ~]#seq 10 | awk  <span class="org-string">'!(i=!i)'</span> <span class="org-comment-delimiter"># </span><span class="org-comment">&#20598;&#25968;&#34892;
</span>2
4
6
8
10
[root@centos8 ~]#seq 10 | awk -v <span class="org-variable-name">i</span>=1 <span class="org-string">'i=!i'</span>
2
4
6
8
10
[root@centos8 ~]#seq 10 | awk -v <span class="org-variable-name">i</span>=0 <span class="org-string">'i=!i'</span>
1
3
5
7
9
[root@centos8 ~]#seq 10 | awk  <span class="org-string">'{i=!i;print i}'</span>
1
0
1
0
1
0
1
0
1
0
[root@centos8 ~]#
</pre>
</div>
</div>
</div>
<div id="outline-container-h:46cce902-486e-4776-91d1-d18e44baa8d6" class="outline-4">
<h4 id="h:46cce902-486e-4776-91d1-d18e44baa8d6"><a href="#h:46cce902-486e-4776-91d1-d18e44baa8d6">条件判断 if-else</a></h4>
<div class="outline-text-4" id="text-h:46cce902-486e-4776-91d1-d18e44baa8d6">
<p>
语法：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">if</span>(condition)statement <span class="org-comment-delimiter"># </span><span class="org-comment">&#21333;&#20998;&#25903;
</span><span class="org-keyword">if</span>(condition){statement;&#8230;}[else statement] <span class="org-comment-delimiter"># </span><span class="org-comment">&#21452;&#20998;&#25903;
</span><span class="org-keyword">if</span>(condition1){statement1}<span class="org-keyword">else if</span>(condition2){statement2}<span class="org-keyword">else if</span>(condition3){statement3}......else{statementN}  <span class="org-comment-delimiter"># </span><span class="org-comment">&#22810;&#20998;&#25903;</span>
</pre>
</div>

<p>
使用场景：对awk取得的整行或某个字段做条件判断 范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">awk -F: <span class="org-string">'{if($3&gt;=1000)print $1,$3}'</span> /etc/passwd
awk -F: <span class="org-string">'{if($NF=="/bin/bash") print $1}'</span> /etc/passwd
awk <span class="org-string">'{if(NF&gt;5) print $0}'</span> /etc/fstab
awk -F: <span class="org-string">'{if($3&gt;=1000) {printf "Common user: %s\n",$1} else {printf "root or Sysuser: %s\n",$1}}'</span> /etc/passwd
awk -F: <span class="org-string">'{if($3&gt;=1000) printf "Common user: %s\n",$1; else printf "root or Sysuser: %s\n",$1}'</span> /etc/passwd

df -h|awk -F% <span class="org-string">'/^\/dev\/sd/{print $1}'</span>| awk <span class="org-string">'$NF&gt;=80{print $1,$5}'</span> <span class="org-comment-delimiter"># </span><span class="org-comment">&#20998;&#21306;&#21033;&#29992;&#29575;&#22823;&#20110;80%&#25171;&#21360;
</span>df | awk -F<span class="org-string">"[[:space:]]+|%"</span> <span class="org-string">'/^\/dev\/sd/{if($5&gt;80)print $1,$5}'</span>

[root@centos8 ~]#df | awk -F<span class="org-string">' +|%'</span> <span class="org-string">'/^\/dev\/sd/{if($5&gt;=10)print $1,$5}'</span>
/dev/sda1 15

awk <span class="org-string">'BEGIN{ test=100;if(test&gt;90){print "very good"} else if(test&gt;60){ print "good"}else{print "no pass"}}'</span>
</pre>
</div>

<p>
范例：文件上下行比较
</p>

<div class="org-src-container">
<pre class="src src-sh">&#25991;&#20214;&#20869;&#23481;&#65306;
{<span class="org-string">"localTime"</span>:<span class="org-string">"2016-10-25 16:22:00"</span>,<span class="org-string">"protocol"</span>:101599,<span class="org-string">"version"</span>:2.26,<span class="org-string">"appType"</span>:3,<span class="org-string">"timestamp"</span>:1477383720000,<span class="org-string">"uuid"</span>:<span class="org-string">"FDF577D9-1B45-44E3-B2FC-F2BDE4A27C74"</span>,<span class="org-string">"token"</span>:<span class="org-string">"a95b6bbe80b9457a9409420bd3ce8dce"</span>}

[root@ali-bj-prod-web001 conf.d]# echo <span class="org-string">'{"localTime":"2016-10-25 16:22:00","protocol":101599,"version":2.26,"appType":3,"timestamp":1477383720000,"uuid":"FDF577D9-1B45-44E3-B2FC-F2BDE4A27C74","token":"a95b6bbe80b9457a9409420bd3ce8dce"}'</span> |awk -F<span class="org-string">',+|:+'</span> <span class="org-string">'{print $12}'</span>
1477383720000

&#19978;&#19979;&#34892;&#27604;&#36739;
awk -F<span class="org-string">'[,:]+'</span> <span class="org-string">'BEGIN {t=0} {if ($12&gt;t) {t =$12  b+=1} else {num+=1 }} END {print num,b}'</span> logs/verification_log.log
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d3d01ea0-6fd8-4cf4-bf98-f37f5f845586" class="outline-4">
<h4 id="h:d3d01ea0-6fd8-4cf4-bf98-f37f5f845586"><a href="#h:d3d01ea0-6fd8-4cf4-bf98-f37f5f845586">switch语句</a></h4>
<div class="outline-text-4" id="text-h:d3d01ea0-6fd8-4cf4-bf98-f37f5f845586">
<p>
语法：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-function-name">switch</span>(expression) {<span class="org-keyword">case</span> VALUE1 or /REGEXP/: statement1; <span class="org-keyword">case</span> VALUE2 or /REGEXP2/: statement2; ...; default: statementn}
</pre>
</div>
</div>
</div>
<div id="outline-container-h:8ad055e7-0d8e-43c8-a0d6-f1e979e7067f" class="outline-4">
<h4 id="h:8ad055e7-0d8e-43c8-a0d6-f1e979e7067f"><a href="#h:8ad055e7-0d8e-43c8-a0d6-f1e979e7067f">循环while</a></h4>
<div class="outline-text-4" id="text-h:8ad055e7-0d8e-43c8-a0d6-f1e979e7067f">
<p>
语法：
</p>

<pre class="example" id="org6b05184">
while (condition) {statement;…}
</pre>

<p>
条件“真”，进入循环；条件“假”，退出循环 使用场景：
</p>

<ul class="org-ul">
<li>对一行内的多个字段逐一类似处理时使用</li>
<li>对数组中的各元素逐一处理时使用</li>
</ul>

<p>
示例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#20869;&#32622;&#20989;&#25968;length()&#36820;&#22238;&#23383;&#31526;&#25968;&#65292;&#32780;&#38750;&#23383;&#33410;&#25968;
</span>[root@centos8 ~]#awk <span class="org-string">'BEGIN{print length("hello")}'</span>
5
[root@centos8 ~]#awk <span class="org-string">'BEGIN{print length("&#19968;&#26465;&#22909;&#27721;")}'</span>
4
<span class="org-comment-delimiter"># </span><span class="org-comment">&#25171;&#21360;/etc/grub2.cfg&#38750;&#31354;&#26684;&#24320;&#22836;&#21518;&#38754;&#21253;&#21547;linux16&#30340;&#21333;&#35789;&#38271;&#24230;
</span>[root@centos7 ~]#awk <span class="org-string">'/^[[:space:]]*linux16/{i=1;while(i&lt;=NF){print $i,length($i); i++}}'</span> /etc/grub2.cfg
linux16 7
/vmlinuz-3.10.0-1062.el7.x86_64 31
<span class="org-variable-name">root</span>=<span class="org-variable-name">UUID</span>=bebb9244-bbb8-4c69-9249-54a36c75155e 46
ro 2
<span class="org-variable-name">crashkernel</span>=auto 16
rhgb 4
quiet 5
net.ifnames=0 13
linux16 7
/vmlinuz-0-rescue-b12558570741487c9328c996e3265b09 50
<span class="org-variable-name">root</span>=<span class="org-variable-name">UUID</span>=bebb9244-bbb8-4c69-9249-54a36c75155e 46
ro 2
<span class="org-variable-name">crashkernel</span>=auto 16
rhgb 4
quiet 5
net.ifnames=0 13

[root@centos7 ~]#awk <span class="org-string">'/^[[:space:]]*linux16/{i=1;while(i&lt;=NF){if(length($i)&gt;=10){print $i,length($i)}; i++}}'</span> /etc/grub2.cfg
/vmlinuz-3.10.0-1062.el7.x86_64 31
<span class="org-variable-name">root</span>=<span class="org-variable-name">UUID</span>=bebb9244-bbb8-4c69-9249-54a36c75155e 46
<span class="org-variable-name">crashkernel</span>=auto 16
net.ifnames=0 13
/vmlinuz-0-rescue-b12558570741487c9328c996e3265b09 50
<span class="org-variable-name">root</span>=<span class="org-variable-name">UUID</span>=bebb9244-bbb8-4c69-9249-54a36c75155e 46
<span class="org-variable-name">crashkernel</span>=auto 16
net.ifnames=0 13

[root@centos8 ~]#awk <span class="org-string">'BEGIN{ total=0;i=1;while(i&lt;=100){total+=i;i++};print total}'</span>
5050
</pre>
</div>
</div>
</div>
<div id="outline-container-h:1e0aa331-b8fb-46dd-bd2f-9b698cdfc535" class="outline-4">
<h4 id="h:1e0aa331-b8fb-46dd-bd2f-9b698cdfc535"><a href="#h:1e0aa331-b8fb-46dd-bd2f-9b698cdfc535">循环 do-while</a></h4>
<div class="outline-text-4" id="text-h:1e0aa331-b8fb-46dd-bd2f-9b698cdfc535">
<p>
语法：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">do</span> {statement;&#8230;}<span class="org-keyword">while</span>(condition)
</pre>
</div>

<p>
意义：无论真假，至少执行一次循环体
</p>

<p>
do-while循环
</p>

<p>
语法：do {statement;&#x2026;}while(condition)
</p>

<p>
意义：无论真假，至少执行一次循环体 范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'BEGIN{ total=0;i=1;do{ total+=i;i++;}while(i&lt;=100);print total}'</span>
5050
</pre>
</div>
</div>
</div>
<div id="outline-container-h:78143b8d-a2c5-440d-b639-0e83e64f7124" class="outline-4">
<h4 id="h:78143b8d-a2c5-440d-b639-0e83e64f7124"><a href="#h:78143b8d-a2c5-440d-b639-0e83e64f7124">循环for</a></h4>
<div class="outline-text-4" id="text-h:78143b8d-a2c5-440d-b639-0e83e64f7124">
<p>
语法：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">for</span>(expr1;expr2;expr3) {statement;&#8230;}
</pre>
</div>

<p>
常见用法：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">for</span>(variable assignment;condition;iteration process) {for-body}
</pre>
</div>

<p>
特殊用法：能够遍历数组中的元素
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">for</span>(var<span class="org-keyword"> in</span> array) {for-body}
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'BEGIN{total=0;for(i=1;i&lt;=100;i++){total+=i};print total}'</span>
5050
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#awk <span class="org-string">'/^[[:space:]]*linux16/{for(i=1;i&lt;=NF;i++) {print $i,length($i)}}'</span> /etc/grub2.cfg
linux16 7
/vmlinuz-3.10.0-1062.el7.x86_64 31
<span class="org-variable-name">root</span>=<span class="org-variable-name">UUID</span>=bebb9244-bbb8-4c69-9249-54a36c75155e 46
ro 2
<span class="org-variable-name">crashkernel</span>=auto 16
rhgb 4
quiet 5
net.ifnames=0 13
linux16 7
/vmlinuz-0-rescue-b12558570741487c9328c996e3265b09 50
<span class="org-variable-name">root</span>=<span class="org-variable-name">UUID</span>=bebb9244-bbb8-4c69-9249-54a36c75155e 46
ro 2
<span class="org-variable-name">crashkernel</span>=auto 16
rhgb 4
quiet 5
net.ifnames=0 13
</pre>
</div>

<p>
性能比较
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">time</span> (awk <span class="org-string">'BEGIN{ total=0;for(i=0;i&lt;=10000;i++){total+=i;};print total;}'</span>)
<span class="org-builtin">time</span> (<span class="org-variable-name">total</span>=0;<span class="org-keyword">for</span> i<span class="org-keyword"> in</span> {1..10000};<span class="org-keyword">do</span> <span class="org-variable-name">total</span>=$(($<span class="org-variable-name">total</span>+i));<span class="org-keyword">done</span>;<span class="org-builtin">echo</span> $<span class="org-variable-name">total</span>)
<span class="org-builtin">time</span> (<span class="org-keyword">for</span> ((<span class="org-variable-name">i</span>=0;i&lt;=10000;i++));<span class="org-keyword">do </span><span class="org-builtin">let</span> <span class="org-variable-name">total</span>+=i;<span class="org-keyword">done</span>;<span class="org-builtin">echo</span> $<span class="org-variable-name">total</span>)
<span class="org-builtin">time</span> (seq &#8211;s &#8221;+&#8221; 10000|bc)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:3ec30f2d-1eda-4c48-b0c9-87be8d2cb96e" class="outline-4">
<h4 id="h:3ec30f2d-1eda-4c48-b0c9-87be8d2cb96e"><a href="#h:3ec30f2d-1eda-4c48-b0c9-87be8d2cb96e">continue和break</a></h4>
<div class="outline-text-4" id="text-h:3ec30f2d-1eda-4c48-b0c9-87be8d2cb96e">
<p>
continue 中断本次循环 break 中断整个循环 格式：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">continue</span> [n]
<span class="org-keyword">break</span> [n]
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'BEGIN{sum=0;for(i=1;i&lt;=100;i++){if(i%2==0)continue;sum+=i}print sum}'</span>
2500

[root@centos8 ~]#awk <span class="org-string">'BEGIN{sum=0;for(i=1;i&lt;=100;i++){if(i==50)break;sum+=i}print sum}'</span>
1225
</pre>
</div>
</div>
</div>
<div id="outline-container-h:cc9a4d32-4866-436a-9b65-760d3ae77e69" class="outline-4">
<h4 id="h:cc9a4d32-4866-436a-9b65-760d3ae77e69"><a href="#h:cc9a4d32-4866-436a-9b65-760d3ae77e69">next</a></h4>
<div class="outline-text-4" id="text-h:cc9a4d32-4866-436a-9b65-760d3ae77e69">
<p>
next 可以提前结束对本行处理而直接进入下一行处理（awk自身循环） 范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk -F: <span class="org-string">'{if($3%2!=0) next; print $1,$3}'</span> /etc/passwd <span class="org-comment-delimiter"># </span><span class="org-comment">&#21482;&#22788;&#29702;gid&#20598;&#25968;&#30340;&#20869;&#23481;
</span>root 0
daemon 2
lp 4
shutdown 6
mail 8
games 12
ftp 14
nobody 65534
polkitd 998
gluster 996
rtkit 172
rpc 32
chrony 994
saslauth 992
clevis 984
pegasus 66
colord 982
setroubleshoot 980
gdm 42
gnome-initial-setup 978
sshd 74
avahi 70
tcpdump 72
wang 1000
</pre>
</div>
</div>
</div>
<div id="outline-container-h:eea0edc1-873e-4b01-a547-598157b9197a" class="outline-4">
<h4 id="h:eea0edc1-873e-4b01-a547-598157b9197a"><a href="#h:eea0edc1-873e-4b01-a547-598157b9197a">数组</a></h4>
<div class="outline-text-4" id="text-h:eea0edc1-873e-4b01-a547-598157b9197a">
<p>
awk的数组为关联数组 格式
</p>

<div class="org-src-container">
<pre class="src src-sh">array_name[index-expression]
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">weekdays</span>[<span class="org-string">"mon"</span>]=<span class="org-string">"Monday"</span>
</pre>
</div>

<p>
index-expression
</p>

<ul class="org-ul">
<li>利用数组，实现 k/v 功能</li>
<li>可使用任意字符串；字符串要使用双引号括起来</li>
<li>如果某数组元素事先不存在，在引用时，awk会自动创建此元素，并将其值初
始化为“空串”</li>
<li>若要判断数组中是否存在某元素，要使用“index in array”格式进行遍历</li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'BEGIN{weekdays["mon"]="Monday";weekdays["tue"]="Tuesday";print weekdays["mon"]}'</span>
Monday
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">awk <span class="org-string">'!line[$0]++'</span> dupfile  <span class="org-comment-delimiter"># </span><span class="org-comment">&#21435;&#37325;
</span>awk <span class="org-string">'{!line[$0]++;print $0, line[$0]}'</span> dupfile
</pre>
</div>

<p>
范例：判断数组索引是否存在
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]# awk <span class="org-string">'BEGIN{array["i"]="x"; array["j"]="y" ; print "i" inarray, "y" in array }'</span>
1 0
[root@centos8 ~]#awk <span class="org-string">'BEGIN{array["i"]="x"; array["j"]="y" ;if ("i" in array ){print "&#23384;&#22312;"}else{print "&#19981;&#23384;&#22312;"}}'</span>
&#23384;&#22312;
[root@centos8 ~]#awk <span class="org-string">'BEGIN{array["i"]="x"; array["j"]="y" ;if ("abc" in array ){print "&#23384;&#22312;"}else{print "&#19981;&#23384;&#22312;"}}'</span>
&#19981;&#23384;&#22312;
</pre>
</div>

<p>
若要遍历数组中的每个元素，要使用for循环
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">for</span>(var<span class="org-keyword"> in</span> array) {for-body}
</pre>
</div>

<p>
注意：var会遍历array的每个索引
</p>

<p>
范例：遍历数组
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'BEGIN{weekdays["mon"]="Monday";weekdays["tue"]="Tuesday";for(i in weekdays) {print weekdays[i]}}'</span>
Tuesday
Monday
[root@centos8 ~]#awk <span class="org-string">'BEGIN{students[1]="daizong";students[2]="junzong";students[3]="kunzong";for(x in students){print x":"students[x]}}'</span>
1:daizong
2:junzong
3:kunzong

[root@centos8 ~]#awk <span class="org-string">'BEGIN {
a["x"] = "welcome"
a["y"] = "to"
a["z"] = "me"
for (i in a) {
  print i,a[i]
}
}'</span>
x welcome
y to
z me
[root@centos8 ~]#awk -F: <span class="org-string">'{user[$1]=$3}END{for(i in user){print "username:
"i,"uid: "user[i]}}'</span> /etc/passwd
username: adm uid: 3
username: rpc uid: 32
username: dnsmasq uid: 985
username: radvd uid: 75
username: sync uid: 5
username: mail uid: 8
username: exim uid: 93
username: tss uid: 59
username: gluster uid: 996
username: unbound uid: 995
username: halt uid: 7
</pre>
</div>

<p>
范例：显示主机的连接状态出现的次数
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'NR!=1{print $1}'</span> ss.log |sort |uniq -c
  118 ESTAB
   1 FIN-WAIT-1
  11 LAST-ACK

[root@centos8 ~]#cat ss.log | sed -nr <span class="org-string">'1!s/^([^0-9]+) .*/\1/p'</span>|sort |uniq -c
  529 ESTAB
   9 LISTEN
  128 SYN-RECV
  95 TIME-WAIT

[root@centos8 ~]#ss -ant | awk <span class="org-string">'NR!=1{state[$1]++}END{for(i in state){printi,state[i]}}'</span>
SYN-RECV 128
LISTEN 9
ESTAB 529
TIME-WAIT 95

[root@centos8 ~]#netstat -tan | awk <span class="org-string">'/^tcp/{state[$NF]++}END{for(i in state){print i,state[i]}}'</span>
LISTEN 9
SYN_RECV 126
ESTABLISHED 523
FIN_WAIT2 40
</pre>
</div>

<p>
范例：访问日志ip排序
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'{ip[$1]++}END{for(i in ip){print i,ip[i]}}'</span> /var/log/httpd/access_log
172.20.0.200 1482
172.20.21.121 2
172.20.30.91 29
172.16.102.29 864
172.20.0.76 1565
172.20.9.9 15
172.20.1.125 463
172.20.61.11 2
172.20.73.73 198

[root@centos8 ~]#awk <span class="org-string">'{ip[$1]++}END{for(i in ip){print ip[i],i}}'</span> access_log|sort -nr| head -3
4870 172.20.116.228
3429 172.20.116.208
2834 172.20.0.222
[root@centos8 ~]#awk <span class="org-string">'{ip[$1]++}END{for(i in ip){print i,ip[i]}}'</span> access_log|sort -k2 -nr|head -3
172.20.116.228 4870
172.20.116.208 3429
172.20.0.222 2834
</pre>
</div>

<p>
范例：封掉查看访问日志中连接次数超过1000次的IP
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'{ip[$1]++}END{for(i in ip){if(ip[i]&gt;=1000){system("iptables -A INPUT -s "i" -j REJECT")}}}'</span> nginx.access.log-20200428
</pre>
</div>

<p>
范例：多维数组
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'BEGIN{
&gt; array[1][1]=11
&gt; array[1][2]=12
&gt; array[1][3]=13
&gt; array[2][1]=21
&gt; array[2][2]=22
&gt; array[2][3]=23
&gt; for (i in array)
&gt;   for (j in array[i])
&gt;     print array[i][j]
&gt; }'</span>
11
12
13
21
22
23
</pre>
</div>
</div>
</div>
<div id="outline-container-h:490ccd2b-5e02-48a0-b916-b2c93eb5a786" class="outline-4">
<h4 id="h:490ccd2b-5e02-48a0-b916-b2c93eb5a786"><a href="#h:490ccd2b-5e02-48a0-b916-b2c93eb5a786">awk函数</a></h4>
<div class="outline-text-4" id="text-h:490ccd2b-5e02-48a0-b916-b2c93eb5a786">
<p>
awk 的函数分为内置和自定义函数
</p>
</div>
<div id="outline-container-h:89b3484c-93bb-4c7e-b113-dc61406a7392" class="outline-5">
<h5 id="h:89b3484c-93bb-4c7e-b113-dc61406a7392"><a href="#h:89b3484c-93bb-4c7e-b113-dc61406a7392">常见内置函数</a></h5>
<div class="outline-text-5" id="text-h:89b3484c-93bb-4c7e-b113-dc61406a7392">
<p>
<b>数值处理：</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-function-name">rand</span>()&#65306;&#36820;&#22238;0&#21644;1&#20043;&#38388;&#19968;&#20010;&#38543;&#26426;&#25968;
<span class="org-function-name">srand</span>()&#65306;&#37197;&#21512;rand() &#20989;&#25968;,&#29983;&#25104;&#38543;&#26426;&#25968;&#30340;&#31181;&#23376;
<span class="org-function-name">int</span>()&#65306;&#36820;&#22238;&#25972;&#25968;*
</pre>
</div>

<p>
范例：随即数
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk <span class="org-string">'BEGIN{srand();print rand()}'</span>
0.790437
[root@centos8 ~]#awk <span class="org-string">'BEGIN{srand();print rand()}'</span>
0.283736
[root@centos8 ~]#awk <span class="org-string">'BEGIN{srand();print rand()}'</span>
0.948082
[root@centos8 ~]#awk <span class="org-string">'BEGIN{srand();print rand()}'</span>
0.371798

[root@centos8 ~]#awk <span class="org-string">'BEGIN{srand(); for (i=1;i&lt;=10;i++)print int(rand()*100)}'</span>
35
17
35
95
19
15
70
54
46
93
</pre>
</div>

<p>
<b>字符串处理：</b>
</p>

<ul class="org-ul">
<li>length([s])：返回指定字符串的长度</li>
<li>sub(r,s,[t])：对t字符串搜索r表示模式匹配的内容，并将第一个匹配内容替换为s</li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#echo <span class="org-string">"2008:08:08 08:08:08"</span> | awk <span class="org-string">'sub(/:/,"-",$1)'</span>
2008-08:08 08:08:08
[root@centos8 ~]#echo <span class="org-string">"2008:08:08 08:08:08"</span> | awk <span class="org-string">'{sub(/:/,"-",$1);print $0}'</span>
2008-08:08 08:08:08
</pre>
</div>

<p>
gsub(r,s,[t])：对t字符串进行搜索r表示的模式匹配的内容，并全部替换为s所表示的内容
</p>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#echo <span class="org-string">"2008:08:08 08:08:08"</span> | awk <span class="org-string">'gsub(/:/,"-",$0)'</span>
2008-08-08 08-08-08
[root@centos8 ~]#echo <span class="org-string">"2008:08:08 08:08:08"</span> | awk <span class="org-string">'{gsub(/:/,"-",$0);print $0}'</span>
2008-08-08 08-08-08
</pre>
</div>

<p>
split(s,array,[r])：以r为分隔符，切割字符串s，并将切割后的结果保存至
array所表示的数组中，第一个索引值为1,第二个索引值为2,&#x2026;
</p>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#netstat -tn | awk <span class="org-string">'/^tcp/{split($5,ip,":");count[ip[1]]++}END{for(i in count){print i,count[i]}}'</span>
10.0.0.1 1
10.0.0.6 1
10.0.0.7 673

&#38142;&#25509;&#29366;&#24577;&#26816;&#26597;&#65306;
ss -ant | awk <span class="org-string">'{name[$1]++}END{for(n in name)print n,name[n]}'</span>
&#24403;&#21069;&#35775;&#38382;IP
ss -an | awk <span class="org-string">'{split($NF,A,":");a[A[1]]++}END{for(i in a) print i,a[i]}'</span> |grep  <span class="org-string">'^[0-9]'</span> |sort -nr -k2,2
&#32467;&#21512;&#20135;&#21697;
[root@hd-test-all-01 nhd_server]# netstat -n |grep <span class="org-string">'^tcp'</span> |tail -n1
tcp        0      0 ::ffff:192.168.1.150:3306   ::ffff:192.168.1.150:40712  ESTABLISHED
[root@hd-test-all-01 nhd_server]# netstat -n |grep <span class="org-string">'^tcp'</span> |head -n1
tcp        0      0 192.168.1.150:6379          192.168.1.150:46096         ESTABLISHED
[root@hd-test-all-01 nhd_server]# netstat -n | awk <span class="org-string">'/^tcp/ {n=split($(NF-1),array,":"); if(n&lt;=2) IP[array[1]]++; else IP[array[4]]++; stat[$NF]++; ++snum} END {for(i in IP){printf("%-20s %s\n", i, IP[i]); num++}printf("%-20s %s\n","TOTAL_IP",num); for(s in stat)printf("%-20s %s\n",s, stat[s]); printf("%-20s %s\n","TOTAL_LINK",snum);}'</span> |tail -n10
192.168.1.35         1
192.168.1.100        4
192.168.1.26         2
192.168.1.44         30
TOTAL_IP             36
TIME_WAIT            65
CLOSE_WAIT           1
FIN_WAIT2            5
ESTABLISHED          1138

TOTAL_LINK           1209
</pre>
</div>

<p>
system 函数：可以awk中调用shell命令
</p>

<p>
空格是awk中的字符串连接符，如果system中需要使用awk中的变量可以使用空格
分隔，或者说除了awk的变量外其他一律用”“引用起来
</p>

<div class="org-src-container">
<pre class="src src-sh">awk <span class="org-string">'BEGIN{system("hostname")}'</span>
awk <span class="org-string">'BEGIN{score=100; system("echo your score is " score) }'</span>
[root@centos8 ~]#netstat -tn | awk <span class="org-string">'/^tcp/{split($5,ip,":");count[ip[1]]++}END{for(i in count){if(count[i]&gt;=10){system("iptables -A INPUT -s "i" -j REJECT")}}}'</span>
</pre>
</div>

<p>
mktime( YYYY MM DD HH MM SS[ DST]) 生成时间格式
</p>

<p>
strftime([format [, timestamp]]) 格式化时间输出，将时间戳转为时间字符
串 systime()得到时间戳,返回从1970年1月1日开始到当前时间(不计闰年)的整
秒数
</p>

<p>
strftime时间函数
</p>

<div class="org-src-container">
<pre class="src src-sh">%a  &#26143;&#26399;&#20960;&#30340;&#32553;&#20889;(Sun)
%A  &#26143;&#26399;&#20960;&#30340;&#23436;&#25972;&#20889;&#27861;(Sunday)
%b  &#26376;&#21517;&#30340;&#32553;&#20889;(Oct)
%B  &#26376;&#21517;&#30340;&#23436;&#25972;&#20889;&#27861;(October)
%c  &#26412;&#22320;&#26085;&#26399;&#21644;&#26102;&#38388;
%d  &#21313;&#36827;&#21046;&#26085;&#26399;
%D  &#26085;&#26399; 08/20/99
%e  &#26085;&#26399;&#65292;&#22914;&#26524;&#21482;&#26377;&#19968;&#20301;&#20250;&#34917;&#19978;&#19968;&#20010;&#31354;&#26684;
%H  &#29992;&#21313;&#36827;&#21046;&#34920;&#31034;24&#23567;&#26102;&#26684;&#24335;&#30340;&#23567;&#26102;
%I  &#29992;&#21313;&#36827;&#21046;&#34920;&#31034;12&#23567;&#26102;&#26684;&#24335;&#30340;&#23567;&#26102;
%j  &#20174;1&#26376;1&#26085;&#36215;&#19968;&#24180;&#20013;&#30340;&#31532;&#20960;&#22825;
%m  &#21313;&#36827;&#21046;&#34920;&#31034;&#30340;&#26376;&#20221;
%M  &#21313;&#36827;&#21046;&#34920;&#31034;&#30340;&#20998;&#38047;
%p  12&#23567;&#26102;&#34920;&#31034;&#27861;(AM/PM)
%S  &#21313;&#36827;&#21046;&#34920;&#31034;&#30340;&#31186;
%U  &#21313;&#36827;&#21046;&#34920;&#31034;&#30340;&#19968;&#24180;&#20013;&#30340;&#31532;&#20960;&#20010;&#26143;&#26399;(&#26143;&#26399;&#22825;&#20316;&#20026;&#19968;&#20010;&#26143;&#26399;&#30340;&#24320;&#22987;)
%w  &#21313;&#36827;&#21046;&#34920;&#31034;&#30340;&#26143;&#26399;&#20960;(&#26143;&#26399;&#22825;&#26159;0)
%W  &#21313;&#36827;&#21046;&#34920;&#31034;&#30340;&#19968;&#24180;&#20013;&#30340;&#31532;&#20960;&#20010;&#26143;&#26399;(&#26143;&#26399;&#19968;&#20316;&#20026;&#19968;&#20010;&#26143;&#26399;&#30340;&#24320;&#22987;)
%x  &#37325;&#26032;&#35774;&#32622;&#26412;&#22320;&#26085;&#26399;(08/20/99)
%X  &#37325;&#26032;&#35774;&#32622;&#26412;&#22320;&#26102;&#38388;(12&#65306;00&#65306;00)
%y  &#20004;&#20301;&#25968;&#23383;&#34920;&#31034;&#30340;&#24180;(99)
%Y  &#24403;&#21069;&#26376;&#20221;
%Z  &#26102;&#21306;(PDT)
%%  &#30334;&#20998;&#21495;(%)
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]# awk <span class="org-string">'BEGIN{print strftime("%x",systime())}'</span>
2016&#24180;01&#26376;06&#26085;
[root@centos7 ~]# awk <span class="org-string">'BEGIN{print strftime("%x-%X",systime())}'</span>
2016&#24180;01&#26376;06&#26085;-13&#26102;58&#20998;00&#31186;
[root@centos7 ~]# awk <span class="org-string">'BEGIN{print strftime("%y-%m-%d %H:%M:%S",systime())}'</span>
16-01-06 13:59:58

[root@ali-bj-prod-web001 conf.d]# awk <span class="org-string">'BEGIN{tstamp=mktime("2021 02 28 6 12 12");print tstamp;}'</span>
1614463932
[root@ali-bj-prod-web001 conf.d]# awk <span class="org-string">'BEGIN{tstamp=mktime("2021 02 28 6 12 12");print strftime("%c",tstamp);}'</span>
Sun 28 Feb 2021 06:12:12 AM CST
<span class="org-comment-delimiter"># </span><span class="org-comment">&#26102;&#38388;&#24046;
</span>[root@ali-bj-prod-web001 conf.d]# awk <span class="org-string">'BEGIN{tstamp1=mktime("2021 02 28 6 12 12");tstamp2=systime();print tstamp2-tstamp1;}'</span>
87583
</pre>
</div>

<p>
字符串大小写转换tolower(var) toupper(var)
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]# <span class="org-variable-name">name</span>=AbC
[root@centos7 ~]# echo ${<span class="org-variable-name">name</span>^^}
ABC
[root@centos7 ~]# echo ${<span class="org-variable-name">name</span>,,}
abc

[root@centos7 ~]# echo $<span class="org-variable-name">name</span> | tr <span class="org-string">'a-z'</span> <span class="org-string">'A-Z'</span>
ABC

[root@centos7 ~]# awk <span class="org-string">'BEGIN{a="abcDEF";print a}'</span>
abcDEF
[root@centos7 ~]# awk <span class="org-string">'BEGIN{a="abcDEF";print tolower(a)}'</span>
abcdef
[root@centos7 ~]# awk <span class="org-string">'BEGIN{a="abcDEF";print toupper(a)}'</span>
ABCDEF
</pre>
</div>

<p>
刷新输出缓冲区fflush函数
</p>

<p>
范例：
</p>

<pre class="example" id="org133816b">
[root@nginx01 ~]# tail -n +$(tail -n1 /root/n) -F /root/ip.txt 2&gt;&amp;1 | awk 'ARGIND==1{i=$0;next}{i++;if($0~/^tail/){i=0};print $0;print i &gt;&gt; "/root/n";fflush("")}' /root/n -

如，flume日志收集中设置断点收集
a1.sources.r1.type = exec
a1.sources.r1.shell = /bin/bash -c
a1.sources.r1.command = tail -n +$(tail -n1 /home/hadoop/flume_read/m) -F /home/hadoop/student.txt | awk 'ARGIND==1{i=$0;next}{i++;if($0~/^tail/){i=0};print
$0;print i &gt;&gt; "/home/hadoop/flume_read/m";fflush("")}' /home/hadoop/flume_read/m -


fflush函数用以刷新输出缓冲区，如果没有参数，就刷新标准输出的缓冲区，如果以空字符串为参数，如fflush(""),则刷新所有文件和管道的输出缓冲区。
这里的fflush是向n文件中写入
</pre>

<p>
其他参考： linux awk
内置函数详细介绍（实例）<a href="http://blog.chinaunix.net/uid-21505614-id-289434.html">http://blog.chinaunix.net/uid-21505614-id-289434.html</a>
</p>
</div>
</div>
<div id="outline-container-h:fcc115c1-565b-45af-8359-a6080636723c" class="outline-5">
<h5 id="h:fcc115c1-565b-45af-8359-a6080636723c"><a href="#h:fcc115c1-565b-45af-8359-a6080636723c">自定义函数</a></h5>
<div class="outline-text-5" id="text-h:fcc115c1-565b-45af-8359-a6080636723c">
<p>
自定义函数格式：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">function</span> <span class="org-function-name">name</span> ( parameter, parameter, ... ) {
 statements
 <span class="org-keyword">return</span> expression
}
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat func.awk  <span class="org-comment-delimiter"># </span><span class="org-comment">x,y &#20026;&#24418;&#24335;&#21442;&#25968;
</span><span class="org-keyword">function</span> <span class="org-function-name">max</span>(x,y) {
x&gt;y?<span class="org-variable-name">var</span>=x:<span class="org-variable-name">var</span>=y
<span class="org-keyword">return</span> var
}
BEGIN{<span class="org-builtin">print</span> max(a,b)}
[root@centos8 ~]#awk -v <span class="org-variable-name">a</span>=30 -v <span class="org-variable-name">b</span>=20 -f func.awk  <span class="org-comment-delimiter"># </span><span class="org-comment">a,b &#20026;&#23454;&#38469;&#21442;&#25968;
</span>30
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:f24d1b74-e72a-43f6-b69e-5633a0f29d87" class="outline-4">
<h4 id="h:f24d1b74-e72a-43f6-b69e-5633a0f29d87"><a href="#h:f24d1b74-e72a-43f6-b69e-5633a0f29d87">awk脚本</a></h4>
<div class="outline-text-4" id="text-h:f24d1b74-e72a-43f6-b69e-5633a0f29d87">
<p>
将awk程序写成脚本，直接调用或执行 范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat passwd.awk
{<span class="org-keyword">if</span>($<span class="org-variable-name">3</span>&gt;=1000)<span class="org-builtin">print</span> $<span class="org-variable-name">1</span>,$<span class="org-variable-name">3</span>}
[root@centos8 ~]#awk -F: -f passwd.awk /etc/passwd
nobody 65534
wang 1000
me 1001
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat test.awk
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/awk -f
</span><span class="org-comment-delimiter">#</span><span class="org-comment">this is a awk script
</span>{<span class="org-keyword">if</span>($<span class="org-variable-name">3</span>&gt;=1000)<span class="org-builtin">print</span> $<span class="org-variable-name">1</span>,$<span class="org-variable-name">3</span>}
[root@centos8 ~]#chmod +x test.awk
[root@centos8 ~]#./test.awk -F: /etc/passwd
nobody 65534
wang 1000
me 1001
</pre>
</div>

<p>
向awk脚本传递参数 格式：
</p>

<div class="org-src-container">
<pre class="src src-sh">awkfile <span class="org-variable-name">var</span>=value <span class="org-variable-name">var2</span>=value2... Inputfile
</pre>
</div>

<p>
注意：在BEGIN过程中不可用。直到首行输入完成以后，变量才可用。可以通过-v参
数，让awk在执行BEGIN之前得到变量的值。命令行中每一个指定的变量都需要一
个-v参数
</p>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat test2.awk
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/awk -f
</span>{<span class="org-keyword">if</span>($<span class="org-variable-name">3</span> &gt;=min &amp;&amp; $<span class="org-variable-name">3</span>&lt;=max)<span class="org-builtin">print</span> $<span class="org-variable-name">1</span>,$<span class="org-variable-name">3</span>}
[root@centos8 ~]#chmod +x test2.awk
[root@centos8 ~]#./test2.awk -F: <span class="org-variable-name">min</span>=100 <span class="org-variable-name">max</span>=200 /etc/passwd
systemd-resolve 193
rtkit 172
pulse 171
qemu 107
usbmuxd 113
abrt 173
</pre>
</div>

<p>
练习
</p>

<ul class="org-ul">
<li>文件host_list.log如下格式，请提取”.me.com”前面的主机名部分并</li>
</ul>
<p>
写入到回到该文件中
</p>

<div class="org-src-container">
<pre class="src src-sh">1 www.me.com
2 blog.me.com
3 study.me.com
4 linux.me.com
5 python.me.com
......
999 study.me.com
</pre>
</div>

<ul class="org-ul">
<li>统计/etc/fstab文件中每个文件系统类型出现的次数</li>
<li>统计/etc/fstab文件中每个单词出现的次数</li>
<li>提取出字符串Yd$C@M05MB%9&amp;Bdh7dq+YVixp3vpw中的所有数字</li>
<li>有一文件记录了1-100000之间随机的整数共5000个，存储的格式
100,50,35,89&#x2026;请取出其中最大和最小的整数</li>
<li>解决Dos攻击生产案例：根据web日志或者或者网络连接数，监控当某个IP并发
连接数或者短时内PV达到100，即调用防火墙命令封掉对应的IP，监控频率每
隔5分钟。防火墙命令为：iptables -A INPUT -s IP -j REJECT</li>
<li>将以下文件内容中FQDN取出并根据其进行计数从高到低排序</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">http://mail.me.com/index.html
http://www.me.com/test.html
http://study.me.com/index.html
http://blog.me.com/index.html
http://www.me.com/images/logo.jpg
http://blog.me.com/20080102.html
http://www.me.com/images/me.jpg
</pre>
</div>

<p>
参考答案:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#awk -F<span class="org-string">"/"</span> <span class="org-string">'{url[$3]++}END{for(i in url){print url[i],i}}'</span> url.log |sort -nr
3 www.me.com
2 blog.me.com
1 study.me.com
1 mail.me.com
</pre>
</div>

<p>
8、将以下文本以inode为标记，对inode相同的counts进行累加，并且统计出同一inode中，
beginnumber的最小值和endnumber的最大值
</p>

<div class="org-src-container">
<pre class="src src-sh">inode|beginnumber|endnumber|counts|
106|3363120000|3363129999|10000|
106|3368560000|3368579999|20000|
310|3337000000|3337000100|101|
310|3342950000|3342959999|10000|
310|3362120960|3362120961|2|
311|3313460102|3313469999|9898|
311|3313470000|3313499999|30000|
311|3362120962|3362120963|2|
</pre>
</div>

<p>
输出的结果格式为：
</p>

<div class="org-src-container">
<pre class="src src-sh">310|3337000000|3362120961|10103|
311|3313460102|3362120963|39900|
106|3363120000|3368579999|30000|
</pre>
</div>

<p>
范例：高效的日志分析命令
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-comment-delimiter"># </span><span class="org-comment">1. &#24555;&#36895;&#23450;&#20301;&#38169;&#35823;&#26085;&#24535;
</span>grep -E <span class="org-string">"ERROR|WARN|FATAL"</span> /var/log/app.log | tail -100

<span class="org-comment-delimiter"># </span><span class="org-comment">2. &#32479;&#35745;&#38169;&#35823;&#39057;&#29575;
</span>awk <span class="org-string">'/ERROR/ {print $1,$2}'</span> app.log | uniq -c | sort -rn

<span class="org-comment-delimiter"># </span><span class="org-comment">3. &#20998;&#26512;&#35775;&#38382;&#26085;&#24535;
</span><span class="org-comment-delimiter"># </span><span class="org-comment">&#32479;&#35745;&#29366;&#24577;&#30721;&#20998;&#24067;
</span>awk <span class="org-string">'{print $9}'</span> access.log | sort | uniq -c | sort -rn

<span class="org-comment-delimiter"># </span><span class="org-comment">&#32479;&#35745;&#24930;&#35831;&#27714;
</span>awk <span class="org-string">'$NF &gt; 1000 {print $7,$NF}'</span> access.log | sort -k2 -rn | head

<span class="org-comment-delimiter"># </span><span class="org-comment">4. &#23454;&#26102;&#26085;&#24535;&#30417;&#25511;
</span>tail -f /var/log/messages | grep --line-buffered ERROR

<span class="org-comment-delimiter"># </span><span class="org-comment">5. &#22810;&#25991;&#20214;&#26085;&#24535;&#21512;&#24182;&#20998;&#26512;
</span>zcat /var/log/app.log*.gz | grep ERROR | less
</pre>
</div>
</div>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>打赏</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>© 2025 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
<!--
<script type="text/javascript" src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/bootstrap@5.2.1/dist/js/bootstrap.min.js"></script>
<div id="back-to-top" class=""><svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg></div>
-->
</div>
</body>
</html>
