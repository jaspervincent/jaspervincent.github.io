<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linux: ç£ç›˜å­˜å‚¨å’Œæ–‡ä»¶ç³»ç»Ÿç®¡ç†</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/font.css"/>
<link rel="stylesheet" type="text/css" href="/static/drollery.e825b870.css"/>
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
</head>
<body>
<header id="preamble" class="status">
<header class="{className}" data-astro-cid-3ef6ksr2>
  <div class=header-branding data-astro-cid-g2lrb5xm>
      <span class=header-text data-astro-cid-g2lrb5xm>
          <span class=dropcap data-astro-cid-g2lrb5xm aria-hidden=true>
              <span class=actual data-astro-cid-g2lrb5xm>J</span>
              <span class=rest data-astro-cid-g2lrb5xm>asper Hsu</span>
              <span class=period data-astro-cid-g2lrb5xm>.</span>
          </span>
          <span class=sr-only data-astro-cid-g2lrb5xm>Drollery</span>
      </span>
      <img alt="Medieval drollery of a knight on a horse" class=spring decoding=async height=250 loading=lazy src=/images/knight-horse.a96eee7d_Z1WCOYs.webp width=68 data-astro-cid-g2lrb5xm>
  </div>

  <nav data-astro-cid-pux6a34n>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/jcodelog.html class=nobracket data-astro-cid-pux6a34n>æŠ€æœ¯</a>
      <span class=flower2 data-astro-cid-pux6a34n>K</span>
      <a href=/reading/index.html class=nobracket data-astro-cid-pux6a34n>é˜…è¯»</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
      <a href=/archives.html class=nobracket data-astro-cid-pux6a34n>å½’æ¡£</a>
      <span class=flower2 data-astro-cid-pux6a34n>L</span>
      <a href=/link/index.html class=nobracket data-astro-cid-pux6a34n>å‹é“¾</a>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/about.html class=nobracket data-astro-cid-pux6a34n>å…³äº</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
  </nav>


  <div class="container" data-astro-cid-3ef6ksr2>
    <p class="info" data-astro-cid-3ef6ksr2>
              ğŸ† æ¬¢è¿æ¥åˆ°æœ¬ç«™ï¼š
              <a href="https://xuchangwei.com/">https://xuchangwei.com/</a>ã€‚
              <strong>å¸Œæœ›è¿™é‡Œæœ‰ä½ æ„Ÿå…´è¶£çš„å†…å®¹</strong>ã€‚
            </p>
  </div>
  <div id=borderArtWrapper class="tt1" data-astro-cid-5hce7sga data-turbo-permanent>
      <script>
          var man, shakeCount = 0, noSound = new Audio("/audio/effects/no.m4a"), screamSound = new Audio("/audio/effects/scream.m4a");
          function animateManShakeHandler() {
              man.removeEventListener("animationend", animateManShakeHandler, !1),
              shakeCount += 1,
              man.classList.remove("shakeMan")
          }
          function animateManFallHandler() {
              man.removeEventListener("animationend", animateManFallHandler, !1),
              man.classList.add("hide")
          }
          function animateMan() {
              man = man ?? document.getElementById("borderMan"),
              3 === shakeCount ? (man.classList.add("fallMan"),
              screamSound.play(),
              man.addEventListener("animationend", animateManFallHandler, !1)) : (man.classList.add("shakeMan"),
              noSound.play(),
              man.addEventListener("animationend", animateManShakeHandler, !1))
          }
      </script>
      <div class=borderArt data-astro-cid-5dda5nwp id=articleBorder>
          <img alt="flowery border with man falling" decoding=async height=620 loading=lazy src=/images/border-vines-no-man.b7d246cc_DRxSe.webp width=909 class=border data-astro-cid-5dda5nwp>
          <div class=fallWrapper data-astro-cid-5dda5nwp>
              <img alt="flowery border with man falling" decoding=async height=292 loading=lazy src=/images/man-no-vines.247a3187_Z2ioXNM.webp width=98 class=man data-astro-cid-5dda5nwp id=borderMan onclick=animateMan()>
          </div>
      </div>
  </div>
</header>
</header>
<main class="container" id="content" class="content">
<header>
<h1 class="title">Linux: ç£ç›˜å­˜å‚¨å’Œæ–‡ä»¶ç³»ç»Ÿç®¡ç†</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:c357b081-29d5-4c40-b512-2b4a74b34494">ç£ç›˜ç»“æ„</a>
<ul>
<li><a href="#h:c8a471c6-ba88-4b3d-b322-1c6400f8b17b">è®¾å¤‡æ–‡ä»¶</a></li>
<li><a href="#h:4ab63e94-0645-40d1-ba26-a763ed38e068">ç¡¬ç›˜ç±»å‹</a></li>
<li><a href="#h:c20e0bfa-1121-408a-898b-6d5c37227196">æœºæ¢°ç¡¬ç›˜å’Œå›ºæ€ç¡¬ç›˜</a></li>
<li><a href="#h:4a8be231-6a09-4331-94d0-9c5e7074978b">ç¡¬ç›˜å­˜å‚¨æœ¯è¯­</a></li>
</ul>
</li>
<li><a href="#h:4ca4008e-c9b5-4b46-9dc7-9c2113bae262">ç®¡ç†å­˜å‚¨</a>
<ul>
<li><a href="#h:9e2bd0c1-21d6-4ca7-8d54-8451e7ac787d">ç£ç›˜åˆ†åŒº</a>
<ul>
<li><a href="#h:28ebaa3c-505e-4ba1-808c-9aec2771f8e4">ä¸ºä»€ä¹ˆåˆ†åŒº</a></li>
<li><a href="#h:3d1827ec-69f5-4770-9a06-717911832c59">åˆ†åŒºæ–¹å¼</a>
<ul>
<li><a href="#h:649c5210-a646-4550-a6a7-3dab6c9d393f">MBRåˆ†åŒº</a></li>
<li><a href="#h:bbf72e7e-292d-43ce-8106-726733eff049">GPTåˆ†åŒº</a></li>
</ul>
</li>
<li><a href="#h:7621c54c-bfe7-4f2c-ab55-9e4febb30289">BIOSå’ŒUEFI</a></li>
<li><a href="#h:c91dfc83-06a0-4be7-b8e2-70442d7572ce">ç®¡ç†åˆ†åŒº</a>
<ul>
<li><a href="#h:5f9d6e08-dfda-491b-8654-d7d8f1af32ba">åˆ—å‡ºå—è®¾å¤‡ lsblk</a></li>
<li><a href="#h:09cba273-0615-45b6-905c-f05fc7feaa3c">parted å‘½ä»¤</a></li>
<li><a href="#h:6d53ac13-e5e5-4ef7-817b-efa6882d6728">åˆ†åŒºå·¥å…·fdiskå’Œgdisk</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:b3fbddc6-7cdb-4263-b4d2-a2d36c8301bb">æ–‡ä»¶ç³»ç»Ÿ</a>
<ul>
<li><a href="#h:3c131bca-7170-492f-acb2-42982c9137a0">æ–‡ä»¶ç³»ç»Ÿæ¦‚å¿µ</a></li>
<li><a href="#h:a5a0758b-405a-4efb-8f7f-ff9cb367f5b7">æ–‡ä»¶ç³»ç»Ÿç±»å‹</a></li>
<li><a href="#h:408140a8-173d-44ea-a166-f9b6b77d2895">æ–‡ä»¶ç³»ç»Ÿçš„ç»„æˆéƒ¨åˆ†</a></li>
<li><a href="#h:432e0a58-303e-420b-8691-551154f8de43">æ–‡ä»¶ç³»ç»Ÿé€‰æ‹©ç®¡ç†</a>
<ul>
<li><a href="#h:63f2bda1-7472-4755-89e1-9b6e3ee6e585">åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ</a></li>
<li><a href="#h:12595ccb-f7d7-4028-92c1-5727c5d29a85">æŸ¥çœ‹å’Œç®¡ç†åˆ†åŒºä¿¡æ¯</a></li>
<li><a href="#h:88f74429-ec9a-4d55-845b-749c4862fc93">æ–‡ä»¶ç³»ç»Ÿæ£€æµ‹å’Œä¿®å¤</a></li>
<li><a href="#h:57ed1dd5-4d08-4513-9d77-0af1ec131ea9">æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶æ¢å¤</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:fe5371ea-92e7-411e-b933-a5e2531a44f9">æŒ‚è½½</a>
<ul>
<li><a href="#h:9300dc8a-8557-4bcb-924e-9a9886cacf5f">æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿmount</a></li>
<li><a href="#h:698dd5a2-56c6-46ee-bc9e-b969480bbff9">å¸è½½æ–‡ä»¶ç³»ç»Ÿ umount</a></li>
<li><a href="#h:d991921a-dab2-4eb7-9951-ba6f8a4e0b32">æŸ¥çœ‹æŒ‚è½½æƒ…å†µ</a></li>
<li><a href="#h:50d6a75a-f75a-48b0-b540-4a1ea5c5d1bd">æŒä¹…æŒ‚è½½</a></li>
</ul>
</li>
<li><a href="#h:a098f076-559a-4920-b220-8960eb56ecdc">å¤„ç†äº¤æ¢æ–‡ä»¶å’Œåˆ†åŒº</a>
<ul>
<li><a href="#h:7470583d-3528-4316-b425-04624cc37c66">swap ä»‹ç»</a></li>
<li><a href="#h:1b8a44ce-deb5-4e21-a31b-71f26a8ce1c6">äº¤æ¢åˆ†åŒºå®ç°è¿‡ç¨‹</a></li>
<li><a href="#h:f6966f45-4165-419c-94b5-6274d9f00302">swapçš„ä½¿ç”¨ç­–ç•¥</a></li>
</ul>
</li>
<li><a href="#h:2ed19f37-bf19-41df-adba-657193b1f13b">ç§»åŠ¨ä»‹è´¨</a>
<ul>
<li><a href="#h:4da950f8-5acb-4af0-947d-dd90f63a069e">ä½¿ç”¨å…‰ç›˜</a></li>
<li><a href="#h:f755173b-d9fb-4a64-82ce-986a0f53f1c2">USBä»‹è´¨</a>
<ul>
<li><a href="#h:e9a55927-6e9c-41f9-964a-3c5ec441b36d">åˆ¶ä½œUç›˜å¯åŠ¨å®‰è£…CentOS</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:87b6ab89-195e-4106-92f1-8302c0cf7544">ç£ç›˜å¸¸è§å·¥å…·</a>
<ul>
<li><a href="#h:60c75dae-bb03-4e5d-bbd7-0f4e74fe0c11">æ–‡ä»¶ç³»ç»Ÿç©ºé—´å ç”¨ç­‰ä¿¡æ¯çš„æŸ¥çœ‹å·¥å…·df</a></li>
<li><a href="#h:a4448b54-3e98-49fa-9d25-42cd0304ee83">æŸ¥çœ‹æŸç›®å½•æ€»ä½“ç©ºé—´å ç”¨çŠ¶æ€du</a>
<ul>
<li><a href="#h:c8bdfb52-947b-4763-a054-05047366c079">dfå’Œduçš„åŒºåˆ«</a></li>
</ul>
</li>
<li><a href="#h:bbda5d5b-62fe-415f-962d-bd0e74352285">å·¥å…·dd</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:3b73de93-6c86-4841-b593-d3d87883062f">RAID</a>
<ul>
<li><a href="#h:973a4e72-5a73-4da5-aa9f-22ff8accf254">ä»€ä¹ˆæ˜¯RAID</a></li>
<li><a href="#h:c4d07f2a-f0f2-4eab-93fe-e541c4321332">RAIDçº§åˆ«</a>
<ul>
<li><a href="#h:4972c508-54ae-428d-a521-ecc4f8a69909">RAID-0</a></li>
<li><a href="#h:8fee72f6-f628-4dc3-8ad6-fd9611431aa9">RAID-1</a></li>
<li><a href="#h:c7e3333b-9652-4934-b22d-02d4fa14aa55">RAID-4</a></li>
<li><a href="#h:19bb3bf6-bb09-496a-9f44-1a2185859dcc">RAID-5</a></li>
<li><a href="#h:e04af9c1-08c0-4047-a6e9-8c258d1217fc">RAID-6</a></li>
<li><a href="#h:3d1e1314-f915-46bf-a17b-eeee104d4eee">RAID-10</a></li>
<li><a href="#h:874f487b-55ff-4026-9df6-e595606d2d58">RAID-01</a></li>
<li><a href="#h:bb331ab6-e57d-4a56-90ef-0cfff77d807a">RAID-50</a></li>
<li><a href="#h:3ab099aa-4e48-4f25-b5d0-b082380688ca">å…¶å®ƒçº§åˆ«</a></li>
<li><a href="#h:9cebdd7a-3502-49a1-8c2e-cf5fca26e9bb">RAIDæ€»ç»“</a></li>
</ul>
</li>
<li><a href="#h:b5c9b1fe-0384-4288-beb3-880300a070f8">å®ç°è½¯RAID</a></li>
</ul>
</li>
<li><a href="#h:8e7781b7-ad87-44dd-b691-4881da975c8f">é€»è¾‘å·ç®¡ç†å™¨ï¼ˆLVMï¼‰</a>
<ul>
<li><a href="#h:08177873-8507-4d30-9969-6855fee5a55f">LVMä»‹ç»</a></li>
<li><a href="#h:4b14bc2f-7089-44bd-a519-52e46a9de2b2">å®ç°é€»è¾‘å·</a>
<ul>
<li><a href="#h:1da9df56-8298-4a17-b9a5-198cca47f9b8">pvç®¡ç†å·¥å…·</a></li>
<li><a href="#h:dac7283a-62c4-479f-b24a-769a3a65b2a0">vgç®¡ç†å·¥å…·</a></li>
<li><a href="#h:033be43b-3a4f-4637-ba3f-fffddf837009">lvç®¡ç†å·¥å…·</a></li>
<li><a href="#h:a4df6d57-3275-4971-a21d-b427836afa13">æ‰©å±•å’Œç¼©å‡é€»è¾‘å·</a>
<ul>
<li><a href="#h:4bbc1af1-1a91-4d58-8ec9-0485b4fe7f95">åœ¨çº¿æ‰©å±•é€»è¾‘å·</a></li>
<li><a href="#h:8a7ec24b-31a5-4abe-9e9e-829230ab0479">ç¼©å‡é€»è¾‘å·</a></li>
</ul>
</li>
<li><a href="#h:4e31819a-fb68-4c57-bc13-556936e150c5">è·¨ä¸»æœºè¿ç§»å·ç»„</a></li>
</ul>
</li>
<li><a href="#h:c901eab5-6c8d-4d6b-badb-561747abb038">é€»è¾‘å·å¿«ç…§</a>
<ul>
<li><a href="#h:15b6fce9-8786-45f6-9277-d3df139d65e6">é€»è¾‘å·å¿«ç…§åŸç†</a></li>
<li><a href="#h:049936f4-e103-4c0d-87f3-0b0d4da2d63b">å®ç°é€»è¾‘å·å¿«ç…§</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:9ee48b0c-52c9-4385-92c6-7e4a21bf4d47">btrfsæ–‡ä»¶ç³»ç»Ÿç®¡ç†ä¸åº”ç”¨</a>
<ul>
<li><a href="#h:43f03ce8-5345-4d1c-8687-d5f1e2f6a356">Btrfsæ–‡ä»¶ç³»ç»Ÿç®€ä»‹</a></li>
<li><a href="#h:ca088b3f-f2ba-4c18-9a66-0efc6c7174ea">æ ¸å¿ƒç‰¹æ€§</a></li>
<li><a href="#h:ac5edb5c-f06c-41ec-afe1-aa64e5291c77">åˆ›å»º b-tree æ–‡ä»¶ç³»ç»Ÿ</a></li>
<li><a href="#h:35b34bd7-8e74-4621-9c36-a592c768c00e">btrfs æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤</a></li>
<li><a href="#h:16e27007-cf1d-4a6e-a182-4803dd8b7236">è®¾å¤‡ç®¡ç†å‘½ä»¤</a></li>
<li><a href="#h:464f5498-d025-4bcc-a4d4-a7ebb7d1567d">å—ç»„å‡è¡¡ç®¡ç†</a></li>
</ul>
</li>
<li><a href="#h:0b9caad1-b74d-4267-b495-11de46b4d2de">ISOåˆ¶ä½œ</a>
<ul>
<li><a href="#h:04af2fe8-0674-474b-86af-8106ce885a94">å‡†å¤‡å·¥ä½œ</a></li>
<li><a href="#h:b185453f-a697-4e5f-8c24-267fadf124e7">é…ç½®æ–‡ä»¶ä¿®æ”¹</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../../index.html">Linux</a></li>
</ul>


<p>
ç£ç›˜å­˜å‚¨å’Œæ–‡ä»¶ç³»ç»Ÿ
</p>

<p>
å†…å®¹æ¦‚è¿°
</p>
<ul class="org-ul">
<li>ç£ç›˜ç»“æ„</li>
<li>åˆ†åŒºç±»å‹</li>
<li>ç®¡ç†åˆ†åŒº</li>
<li>ç®¡ç†æ–‡ä»¶ç³»ç»Ÿ</li>
<li>æŒ‚è½½è®¾å¤‡</li>
<li>ç®¡ç†swapç©ºé—´</li>
<li>RAIDç®¡ç†</li>
<li>LVMç®¡ç†å’ŒLVMå¿«ç…§</li>
</ul>
<section id="outline-container-h:c357b081-29d5-4c40-b512-2b4a74b34494" class="outline-2">
<h2 id="h:c357b081-29d5-4c40-b512-2b4a74b34494">ç£ç›˜ç»“æ„</h2>
<div class="outline-text-2" id="text-h:c357b081-29d5-4c40-b512-2b4a74b34494">
</div>
<div id="outline-container-h:c8a471c6-ba88-4b3d-b322-1c6400f8b17b" class="outline-3">
<h3 id="h:c8a471c6-ba88-4b3d-b322-1c6400f8b17b">è®¾å¤‡æ–‡ä»¶</h3>
<div class="outline-text-3" id="text-h:c8a471c6-ba88-4b3d-b322-1c6400f8b17b">
<p>
ä¸€åˆ‡çš†æ–‡ä»¶ï¼šopen(), read(), write(), close()
</p>

<p>
è®¾å¤‡æ–‡ä»¶ï¼šå…³è”è‡³ä¸€ä¸ªè®¾å¤‡é©±åŠ¨ç¨‹åºï¼Œè¿›è€Œèƒ½å¤Ÿè·Ÿä¸ä¹‹å¯¹åº”ç¡¬ä»¶è®¾å¤‡è¿›è¡Œé€šä¿¡
</p>

<p>
è®¾å¤‡å·ç ï¼š
</p>

<ul class="org-ul">
<li>ä¸»è®¾å¤‡å·ï¼šmajor number, æ ‡è¯†è®¾å¤‡ç±»å‹</li>
<li>æ¬¡è®¾å¤‡å·ï¼šminor number, æ ‡è¯†åŒä¸€ç±»å‹ä¸‹çš„ä¸åŒè®¾å¤‡</li>
</ul>

<p>
åªè¦ç³»ç»Ÿåˆ¤æ–­ 2ä¸ªæ–‡ä»¶ä¸»è®¾å¤‡å· æ¬¡è®¾å¤‡å·ä¸€æ ·å°±æ˜¯åŒä¸€ä¸ªè®¾å¤‡
</p>

<p>
è®¾å¤‡ç±»å‹ï¼š
</p>

<ul class="org-ul">
<li>å—è®¾å¤‡ï¼šblockï¼Œå­˜å–å•ä½â€å—â€ï¼Œç£ç›˜</li>
<li>å­—ç¬¦è®¾å¤‡ï¼šcharï¼Œå­˜å–å•ä½â€å­—ç¬¦â€ï¼Œé”®ç›˜</li>
</ul>

<p>
ç£ç›˜è®¾å¤‡çš„è®¾å¤‡æ–‡ä»¶å‘½åï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">/dev/DEV_FILE
/dev/sdX           <span style="color: #b22222;">#</span><span style="color: #b22222;">SCSI, SATA, SAS, IDE,USB</span>
/dev/nvme0n#  <span style="color: #b22222;">#</span><span style="color: #b22222;">nvme&#21327;&#35758;&#30828;&#30424;&#65292;&#22914;&#65306;&#31532;&#19968;&#20010;&#30828;&#30424;&#65306;nvme0n1&#65292;&#31532;&#20108;&#20010;&#30828;&#30424;&#65306;nvme0n2</span>
</pre>
</div>

<p>
è™šæ‹Ÿç£ç›˜ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">/dev/vd
/dev/xvd
</pre>
</div>

<p>
ä¸åŒç£ç›˜æ ‡è¯†ï¼ša-z,aa,ab&#x2026;
</p>

<p>
ç¤ºä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">/dev/sda&#65292;/dev/sdb, ...
</pre>
</div>

<p>
åŒä¸€è®¾å¤‡ä¸Šçš„ä¸åŒåˆ†åŒºï¼š1,2, &#x2026;
</p>

<div class="org-src-container">
<pre class="src src-sh">/dev/sda1
/dev/sda5
</pre>
</div>

<p>
èŒƒä¾‹ï¼šåˆ›å»ºè®¾å¤‡æ–‡ä»¶
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#df /boot
Filesystem   1K-blocks  Used Available Use% Mounted on
/dev/sda1     999320 130848   799660  15% /boot
[root@centos8 ~]#ls /boot

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#35201;&#31995;&#32479;&#21028;&#26029; 2&#20010;&#25991;&#20214;&#20027;&#35774;&#22791;&#21495; &#27425;&#35774;&#22791;&#21495;&#19968;&#26679;&#23601;&#26159;&#21516;&#19968;&#20010;&#35774;&#22791;</span>
[root@centos8 ~]#mknod /data/partition-sda1 b 8 1  <span style="color: #b22222;"># </span><span style="color: #b22222;">mknod  &#35774;&#22791;&#36335;&#24452; &#35774;&#22791;&#31867;&#22411; &#20027;&#35201;&#32534;&#21495; &#27425;&#35201;&#32534;&#21495;</span>
[root@centos8 ~]#ll /data/partition-sda1
brw-r--r-- 1 root root 8, 1 Apr 13 09:15 /data/partition-sda1
[root@centos8 ~]#mount /data/partition-sda1 /mnt/
[root@centos8 ~]#ls /mnt

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;&#19968;&#20010;&#21644;zero&#19968;&#26679;&#30340;&#35774;&#22791;&#25991;&#20214;</span>
[root@centos8 ~]#ll /dev/zero
crw-rw-rw- 1 root root 1, 5 Apr 13 08:03 /dev/zero
[root@centos8 ~]#mknod /data/zero c 1 5
[root@centos8 ~]#ll /data/zero
crw-r--r-- 1 root root 1, 5 Apr 13 09:17 /data/zero

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25805;&#20316;&#35774;&#22791;&#25991;&#20214;</span>
root@debian:~# dd <span style="color: #a0522d;">if</span>=/data/zero <span style="color: #a0522d;">of</span>=/data/test1.img <span style="color: #a0522d;">bs</span>=1 <span style="color: #a0522d;">count</span>=10
10+0 records<span style="color: #a020f0;"> in</span>
10+0 records out
10 bytes copied, 0.000680455 s, 14.7 kB/s
root@debian:~# ls -l /data/test1.img 
-rw-r--r-- 1 root root 10 Oct 11 11:10 /data/test1.img
root@debian:~# hexdump -C /data/test1.img 
00000000  00 00 00 00 00 00 00 00  00 00                    |..........|
0000000a
root@debian:~# rm -f /data/zero 
root@debian:~# cp -a /dev/zero  /data/zero  <span style="color: #b22222;">#</span><span style="color: #b22222;">-a &#22797;&#21046;&#25991;&#20214;&#35774;&#22791;&#31867;&#22411;</span>
root@debian:~# ls -l /data/zero 
crw-rw-rw- 1 root root 1, 5 Oct 11 10:56 /data/zero
</pre>
</div>
</div>
</div>
<div id="outline-container-h:4ab63e94-0645-40d1-ba26-a763ed38e068" class="outline-3">
<h3 id="h:4ab63e94-0645-40d1-ba26-a763ed38e068">ç¡¬ç›˜ç±»å‹</h3>
<div class="outline-text-3" id="text-h:4ab63e94-0645-40d1-ba26-a763ed38e068">

<figure id="org5f9b400">
<img src="images/image-20210216020339143.png" alt="image-20210216020339143.png" width="80%">

</figure>

<p>
<b>ç¡¬ç›˜æ¥å£ç±»å‹</b>
</p>

<ul class="org-ul">
<li>IDEï¼š133MB/sï¼Œå¹¶è¡Œæ¥å£ï¼Œæ—©æœŸå®¶ç”¨ç”µè„‘</li>
<li>SCSIï¼š640MB/sï¼Œå¹¶è¡Œæ¥å£ï¼Œæ—©æœŸæœåŠ¡å™¨</li>
<li>SATAï¼š6Gbpsï¼ŒSATAæ•°æ®ç«¯å£ä¸ç”µæºç«¯å£æ˜¯åˆ†å¼€çš„ï¼Œå³éœ€è¦ä¸¤æ¡çº¿ï¼Œä¸€æ¡æ•°æ®çº¿ï¼Œä¸€æ¡ç”µæºçº¿</li>
<li>SASï¼š6Gbpsï¼ŒSASæ˜¯ä¸€æ•´æ¡çº¿ï¼Œæ•°æ®ç«¯å£ä¸ç”µæºç«¯å£æ˜¯ä¸€ä½“åŒ–çš„ï¼ŒSASä¸­æ˜¯åŒ…å«
ä¾›ç”µçº¿çš„ï¼Œè€ŒSATAä¸­ä¸åŒ…å«ä¾›ç”µçº¿ã€‚SATAæ ‡å‡†å…¶å®æ˜¯SASæ ‡å‡†çš„ä¸€ä¸ªå­é›†ï¼ŒäºŒ
è€…å¯å…¼å®¹ï¼ŒSATAç¡¬ç›˜å¯ä»¥æ’å…¥SASä¸»æ¿ä¸Šï¼Œåä¹‹ä¸æˆ</li>
<li>USBï¼š480MB/s</li>
<li>M.2ï¼š</li>
</ul>

<p>
æ³¨æ„ï¼šé€Ÿåº¦ä¸æ˜¯ç”±å•çº¯çš„æ¥å£ç±»å‹å†³å®šï¼Œæ”¯æŒNvmeåè®®ç¡¬ç›˜é€Ÿåº¦æ˜¯æœ€å¿«çš„
</p>

<p>
â€‹<b>æœåŠ¡å™¨ç¡¬ç›˜å¤§å°</b>
</p>

<ul class="org-ul">
<li>LFFï¼š3.5å¯¸ï¼Œä¸€èˆ¬è§åˆ°çš„é‚£ç§å°å¼æœºç¡¬ç›˜çš„å¤§å°</li>
<li>SFFï¼šSmall Form Factor å°å½¢çŠ¶å› æ•°ï¼Œ2.5å¯¸ï¼Œæ³¨æ„ä¸åŒäº2.5å¯¸çš„ç¬”è®°æœ¬ç¡¬ç›˜</li>
</ul>

<p>
Lã€Såˆ†åˆ«æ˜¯å¤§ã€å°çš„æ„æ€ï¼Œç›®å‰æœåŠ¡å™¨æˆ–è€…ç›˜æŸœé‡‡ç”¨sffè§„æ ¼çš„ç¡¬ç›˜ä¸»è¦æ˜¯è€ƒå†…
è™‘å¢å¤§å•ä½å¯†åº¦å†…çš„ç£ç›˜å®¹é‡ã€å¢å¼ºæ•£çƒ­ã€å‡å°åŠŸè€—
</p>
</div>
</div>
<div id="outline-container-h:c20e0bfa-1121-408a-898b-6d5c37227196" class="outline-3">
<h3 id="h:c20e0bfa-1121-408a-898b-6d5c37227196">æœºæ¢°ç¡¬ç›˜å’Œå›ºæ€ç¡¬ç›˜</h3>
<div class="outline-text-3" id="text-h:c20e0bfa-1121-408a-898b-6d5c37227196">
<p>
æœºæ¢°ç¡¬ç›˜ï¼ˆHDDï¼‰ï¼šHard Disk Driveï¼Œå³æ˜¯ä¼ ç»Ÿæ™®é€šç¡¬ç›˜ï¼Œä¸»è¦ç”±ï¼šç›˜ç‰‡ï¼Œç£å¤´ï¼Œ
ç›˜ç‰‡è½¬è½´åŠæ§åˆ¶ç”µæœºï¼Œç£å¤´æ§åˆ¶å™¨ï¼Œæ•°æ®è½¬æ¢å™¨ï¼Œæ¥å£ï¼Œç¼“å­˜ç­‰å‡ ä¸ªéƒ¨åˆ†ç»„æˆã€‚
æœºæ¢°ç¡¬ç›˜ä¸­æ‰€æœ‰çš„ç›˜ç‰‡éƒ½è£…åœ¨ä¸€ä¸ªæ—‹è½¬è½´ä¸Šï¼Œæ¯å¼ ç›˜ç‰‡ä¹‹é—´æ˜¯å¹³è¡Œçš„ï¼Œåœ¨æ¯ä¸ªç›˜
ç‰‡çš„å­˜å‚¨é¢ä¸Šæœ‰ä¸€ä¸ªç£å¤´ï¼Œç£å¤´ä¸ç›˜ç‰‡ä¹‹é—´çš„è·ç¦»æ¯”å¤´å‘ä¸çš„ç›´å¾„è¿˜å°ï¼Œæ‰€æœ‰çš„
ç£å¤´è”åœ¨ä¸€ä¸ªç£å¤´æ§åˆ¶å™¨ä¸Šï¼Œç”±ç£å¤´æ§åˆ¶å™¨è´Ÿè´£å„ä¸ªç£å¤´çš„è¿åŠ¨ã€‚ç£å¤´å¯æ²¿ç›˜ç‰‡
çš„åŠå¾„æ–¹å‘è¿åŠ¨ï¼ŒåŠ ä¸Šç›˜ç‰‡æ¯åˆ†é’Ÿå‡ åƒè½¬çš„é«˜é€Ÿæ—‹è½¬ï¼Œç£å¤´å°±å¯ä»¥å®šä½åœ¨ç›˜ç‰‡çš„
æŒ‡å®šä½ç½®ä¸Šè¿›è¡Œæ•°æ®çš„è¯»å†™æ“ä½œã€‚æ•°æ®é€šè¿‡ç£å¤´ç”±ç”µç£æµæ¥æ”¹å˜ææ€§æ–¹å¼è¢«ç”µç£
æµå†™åˆ°ç£ç›˜ä¸Šï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç›¸åæ–¹å¼è¯»å–ã€‚ç¡¬ç›˜ä¸ºç²¾å¯†è®¾å¤‡ï¼Œè¿›å…¥ç¡¬ç›˜çš„ç©ºæ°”å¿…
é¡»è¿‡æ»¤
</p>

<p>
å›ºæ€ç¡¬ç›˜ï¼ˆSSDï¼‰ï¼šSolid State Driveï¼Œç”¨å›ºæ€ç”µå­å­˜å‚¨èŠ¯ç‰‡é˜µåˆ—è€Œåˆ¶æˆçš„ç¡¬ç›˜ï¼Œ
ç”±æ§åˆ¶å•å…ƒå’Œå­˜å‚¨å•å…ƒï¼ˆFLASHèŠ¯ç‰‡ã€DRAMèŠ¯ç‰‡ï¼‰ç»„æˆã€‚å›ºæ€ç¡¬ç›˜åœ¨æ¥å£çš„è§„èŒƒ
å’Œå®šä¹‰ã€åŠŸèƒ½åŠä½¿ç”¨æ–¹æ³•ä¸Šä¸æ™®é€šç¡¬ç›˜çš„å®Œå…¨ç›¸åŒï¼Œåœ¨äº§å“å¤–å½¢å’Œå°ºå¯¸ä¸Šä¹Ÿä¸æ™®
é€šç¡¬ç›˜ä¸€è‡´ç›¸è¾ƒäºHDDï¼ŒSSDåœ¨é˜²éœ‡æŠ—æ‘”ã€ä¼ è¾“é€Ÿç‡ã€åŠŸè€—ã€é‡é‡ã€å™ªéŸ³ä¸Šæœ‰æ˜æ˜¾
ä¼˜åŠ¿ï¼ŒSSDä¼ è¾“é€Ÿç‡æ€§èƒ½æ˜¯HDDçš„2å€
</p>

<p>
å›ºæ€ä¸­æ”¯æŒNVMeé€šé“åè®®çš„é€Ÿåº¦ç†å¿«
</p>


<figure id="org10a7427">
<img src="images/image-20210216020356031.png" alt="image-20210216020356031.png" width="60%">

</figure>

<p>
ç›¸è¾ƒäºSSDï¼ŒHDDåœ¨ä»·æ ¼ã€å®¹é‡å æœ‰ç»å¯¹ä¼˜åŠ¿
</p>

<p>
ç¡¬ç›˜æœ‰ä»·ï¼Œæ•°æ®æ— ä»·ï¼Œç›®å‰SSDä¸èƒ½å®Œå…¨å–ä»£HHD
</p>

<p>
æœºæ¢°ç¡¬ç›˜ç»“æ„
</p>


<figure id="orgea2a1fb">
<img src="images/image-20210216020412234.png" alt="image-20210216020412234.png" width="80%">

</figure>

<p>
å›ºæ€ç¡¬ç›˜ï¼ˆSSDï¼‰
</p>


<figure id="orgdfedabd">
<img src="images/image-20210216020438055.png" alt="image-20210216020438055.png" width="80%">

</figure>
</div>
</div>
<div id="outline-container-h:4a8be231-6a09-4331-94d0-9c5e7074978b" class="outline-3">
<h3 id="h:4a8be231-6a09-4331-94d0-9c5e7074978b">ç¡¬ç›˜å­˜å‚¨æœ¯è¯­</h3>
<div class="outline-text-3" id="text-h:4a8be231-6a09-4331-94d0-9c5e7074978b">

<figure id="org3130b5f">
<img src="images/image-20210216020449985.png" alt="image-20210216020449985.png" width="60%">

</figure>

<p>
<b>ç¡¬ç›˜å­˜å‚¨æœ¯è¯­ CHS</b>
</p>

<ul class="org-ul">
<li>headï¼šç£å¤´ ç£å¤´æ•°=ç›˜é¢æ•°</li>
<li>trackï¼šç£é“ ç£é“=æŸ±é¢æ•°</li>
<li>sectorï¼šæ‰‡åŒºï¼Œ512bytes</li>
<li>cylinderï¼šæŸ±é¢ 1æŸ±é¢=512 * sectoræ•°/track*headæ•°=512*63*255=7.84M
CentOS 5 ä¹‹å‰ç‰ˆæœ¬ Linux ä»¥æŸ±é¢çš„æ•´æ•°å€åˆ’åˆ†åˆ†åŒºï¼ŒCentOS 6ä¹‹åå¯ä»¥æ”¯æŒ
ä»¥æ‰‡åŒºåˆ’åˆ†åˆ†åŒº</li>
</ul>

<p>
èŒƒä¾‹
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#echo <span style="color: #8b2252;">"scale=2;512*63*255/1024/1024"</span> |bc
7.84

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;CHS</span>
[root@centos6 ~]#fdisk -l /dev/sda  <span style="color: #b22222;"># </span><span style="color: #b22222;">centos6&#36824;&#26159;&#32769;&#30340;&#26041;&#24335;&#65292;&#20197;&#26609;&#38754;&#21010;&#20998;&#20998;&#21306;</span>
Disk /dev/sda: 214.7 GB, 214748364800 bytes
255 heads, 63 sectors/track, 26108 cylinders
<span style="color: #a0522d;">Units</span> = cylinders of 16065 * <span style="color: #a0522d;">512</span> = 8225280 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x0006fc79
 Device Boot   Start     End   Blocks  Id System
/dev/sda1  *      1     131   1048576  83 Linux
Partition 1 does not end on cylinder boundary.
/dev/sda2       131    12879  102400000  83 Linux
/dev/sda3      12879    19253   51200000  83 Linux
/dev/sda4      19253    26109   55065600   5 Extended
/dev/sda5      19254    19515   2097152  82 Linux swap / Solaris

<span style="color: #b22222;"># </span><span style="color: #b22222;">centos7&#24320;&#22987;&#20197;&#25159;&#21306;&#21010;&#20998;&#20998;&#21306;</span>
[root@centos8 ~]#fdisk -u=cylinder -l /dev/sda <span style="color: #b22222;"># </span><span style="color: #b22222;">-u=cylinder  &#26174;&#31034;&#26609;&#38754;&#20449;&#24687;</span>

[root@node01 ~]# fdisk -l
Disk /dev/sda: 10.7 GB, 10737418240 &#23383;&#33410;, 20971520 sectors&#25159;&#21306;   <span style="color: #b22222;"># </span><span style="color: #b22222;">/dev/sda&#35774;&#22791;&#19978;&#19968;&#20849;&#22810;&#23569;&#23383;&#33410;&#12289;&#22810;&#23569;&#25159;&#21306;</span>
<span style="color: #a0522d;">Units</span> = sectors of 1 * <span style="color: #a0522d;">512</span> = 512 bytes <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#19968;&#20010;&#25159;&#21306;&#26159; 512 &#23383;&#33410;</span>
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x000cfd1f   //&#30913;&#30424;&#26631;&#35782;&#31526;

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *        2048     1026047      512000   83  Linux
/dev/sda2         1026048    20971519     9972736   8e  Linux LVM

&#20998;&#21306;&#20449;&#24687;&#35299;&#37322;&#65306;
boot : &#26143;&#21495;&#26631;&#35782;&#24341;&#23548;&#20998;&#21306;&#65306;&#25805;&#20316;&#31995;&#32479;&#22312;&#36825;&#20010;&#20998;&#21306;&#19978;&#35013;&#30528;
start-end : cento6&#26631;&#35782;&#26609;&#38754;&#30340;&#36215;&#22987;&#20301;&#32622;&#65292;centos7&#21017;&#26159;&#26631;&#35782;&#25159;&#21306;&#30340;&#36215;&#22987;&#20301;&#32622;
blocks : &#35774;&#22791;&#19978;&#19968;&#20849;&#22810;&#23569;&#20010;&#22359;&#65292;&#20197;1K&#20026;&#21333;&#20301;
id : &#34920;&#31034;&#20998;&#21306;&#25152;&#22312;&#22330;&#26223;&#31867;&#22411;&#65307;Linux&#27491;&#24120;&#20998;&#21306;&#37117;&#29992;83&#26469;&#34920;&#31034;&#65292;&#25193;&#23637;5,&#20132;&#25442;&#20998;&#21306;82  &#12290; 83&#20026;16&#36827;&#21046;&#30340;&#25968;&#23383;&#65307;
System : &#35299;&#37322;id&#25152;&#23545;&#24212;&#30340;&#24847;&#20041;&#26159;&#20160;&#20040; &#12290;&#20027;&#20998;&#21306;linux&#12289;&#25193;&#23637;&#20998;&#21306;Extended&#12289;Linux LVM

<span style="color: #b22222;"># </span><span style="color: #b22222;">awk 'BEGIN{a=512000;printf "%sgb",a/1024/1024}'</span>
0.488281gb
</pre>
</div>

<p>
èŒƒä¾‹ï¼šè¯†åˆ«SSDå’Œæœºæ¢°ç¡¬ç›˜ç±»å‹
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">1&#34920;&#31034;&#26426;&#26800;&#65292;0&#34920;&#31034;SSD</span>

[root@centos8 ~]#lsblk -d -o name,rota
NAME  ROTA
sda     1
sr0     1
nvme0n1   0
nvme0n2   0

[root@centos8 ~]#ls /sys/block/
nvme0n1 nvme0n2 sda sr0
[root@centos8 ~]#cat /sys/block/*/queue/rotational
0
0
1
1
[root@centos8 ~]#cat /sys/block/sda/queue/rotational
1
[root@centos8 ~]#cat /sys/block/sr0/queue/rotational
1
[root@centos8 ~]#cat /sys/block/nvme0n1/queue/rotational
0
[root@centos8 ~]#cat /sys/block/nvme0n2/queue/rotational
0
</pre>
</div>


<figure id="org158712e">
<img src="images/image-20210216020526867.png" alt="image-20210216020526867.png" width="60%">

</figure>

<p>
<b>åŒºä½è®°å½•ç£ç›˜æ‰‡åŒºç»“æ„ZBRï¼ˆZoned Bit Recordingï¼‰</b>
</p>



<figure id="org009ac43">
<img src="images/image-20210216020540832.png" alt="image-20210216020540832.png" width="60%">

</figure>

<p>
å†…å¤–åˆ†çš„æ‰‡åŒºä¸ªæ•°ä¸ä¸€æ ·
</p>

<p>
<b>CHS</b>
</p>

<ul class="org-ul">
<li>ä¼ ç»Ÿçš„CHSé‡‡ç”¨ 24 bitä½å¯»å€</li>

<li>å…¶ä¸­å‰10ä½è¡¨ç¤ºcylinderï¼Œä¸­é—´8ä½è¡¨ç¤ºheadï¼Œåé¢6ä½è¡¨ç¤ºsector</li>

<li><p>
æœ€å¤§å¯»å€ç©ºé—´ 8 GB
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">echo 2^24*512/1024/1024|bc</span>
8192
</pre>
</div>

<p>
è¿™æ ·ç¡¬ç›˜å®¹é‡å¤ªå°ï¼Œåé¢å°±ç”¨LBAäº†
</p></li>
</ul>

<p>
<b>LBAï¼ˆlogical block addressingï¼‰</b>
</p>

<ul class="org-ul">
<li>LBAæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œé€šè¿‡è½¬æ¢æˆ CHS æ ¼å¼å®Œæˆç£ç›˜å…·ä½“å¯»å€</li>
<li>ATA-1è§„èŒƒä¸­å®šä¹‰äº†28ä½å¯»å€æ¨¡å¼ï¼Œä»¥æ¯æ‰‡åŒº512ä½ç»„æ¥è®¡ç®—ï¼ŒATA-1æ‰€å®šä¹‰çš„
28ä½LBAä¸Šé™è¾¾åˆ°128 GiBã€‚2002å¹´ATA-6è§„èŒƒé‡‡ç”¨48ä½LBAï¼ŒåŒæ ·ä»¥æ¯æ‰‡åŒº512
ä½ç»„è®¡ç®—å®¹é‡ä¸Šé™å¯è¾¾128Petabytes</li>
</ul>

<p>
ç”±äºCHSå¯»å€æ–¹å¼çš„å¯»å€ç©ºé—´åœ¨å¤§æ¦‚8GBä»¥å†…ï¼Œæ‰€ä»¥åœ¨ç£ç›˜å®¹é‡å°äºå¤§æ¦‚8GBæ—¶ï¼Œ
å¯ä»¥ä½¿ç”¨CHSå¯»å€æ–¹å¼æˆ–æ˜¯LBAå¯»å€æ–¹å¼ï¼›åœ¨ç£ç›˜å®¹é‡å¤§äºå¤§æ¦‚8GBæ—¶ï¼Œåˆ™åªèƒ½ä½¿
ç”¨LBAå¯»å€æ–¹å¼
</p>

<p>
<b>ç¡¬ç›˜è¯»æ•°æ®å¿«æ…¢å› ç´ </b>
</p>

<ol class="org-ol">
<li>è¯¢é“æ—¶é—´</li>
<li>æ—‹è½¬æ—¶é—´ã€‚ç¬¬1ä¸ªæ•°æ®åˆ°ç¬¬2ä¸ªæ•°æ®ç£å¤´è½¬åŠ¨</li>
<li>è¯»å†™æ—¶é—´</li>
</ol>

<p>
ç£ç›˜è½¬é€Ÿè¶Šå¿«ï¼Œè¯»æ•°æ®èŠ±æ—¶é—´å°±è¶Šå°‘
</p>

<p>
å°æŠ€å·§ï¼šæ•°æ®æ”¾åœ¨ç£ç›˜å¤–åœˆæ›´å¿«ï¼Œç¼–å·è¶Šå°æ˜¯å¤–åœˆè¶Šå¤§æ˜¯é‡Œåœˆã€‚é‚£ä¹ˆsda1æ¯”sda5
è¯»å–æ•°æ®é€Ÿåº¦è¦å¿«ã€‚å›ºæ€ç¡¬ç›˜æ²¡æœ‰æœºæ¢°ç§»åŠ¨çš„è¿‡ç¨‹ä¸å­˜åœ¨è¿™ä¸ªæƒ…å†µã€‚
</p>


<figure id="orgd4982b7">
<img src="images/image-20210216020556795.png" alt="image-20210216020556795.png">

</figure>

<p>
æœºæ¢°ç¡¬ç›˜æ•°æ®å¯æ¢å¤ç‡æ¯”å›ºæ€å¥½ï¼Œå›ºæ€ç¡¬ä»¶åäº†æ•°æ®å¯èƒ½å®Œå…¨ä¸¢å¤±ã€‚
</p>
</div>
</div>
</section>
<section id="outline-container-h:4ca4008e-c9b5-4b46-9dc7-9c2113bae262" class="outline-2">
<h2 id="h:4ca4008e-c9b5-4b46-9dc7-9c2113bae262">ç®¡ç†å­˜å‚¨</h2>
<div class="outline-text-2" id="text-h:4ca4008e-c9b5-4b46-9dc7-9c2113bae262">
<p>
ä½¿ç”¨ç£ç›˜ç©ºé—´è¿‡ç¨‹
</p>

<ol class="org-ol">
<li>è®¾å¤‡åˆ†åŒº</li>
<li>åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ</li>
<li>æŒ‚è½½æ–°çš„æ–‡ä»¶ç³»ç»Ÿ</li>
</ol>
</div>
<div id="outline-container-h:9e2bd0c1-21d6-4ca7-8d54-8451e7ac787d" class="outline-3">
<h3 id="h:9e2bd0c1-21d6-4ca7-8d54-8451e7ac787d">ç£ç›˜åˆ†åŒº</h3>
<div class="outline-text-3" id="text-h:9e2bd0c1-21d6-4ca7-8d54-8451e7ac787d">
</div>
<div id="outline-container-h:28ebaa3c-505e-4ba1-808c-9aec2771f8e4" class="outline-4">
<h4 id="h:28ebaa3c-505e-4ba1-808c-9aec2771f8e4">ä¸ºä»€ä¹ˆåˆ†åŒº</h4>
<div class="outline-text-4" id="text-h:28ebaa3c-505e-4ba1-808c-9aec2771f8e4">
<ul class="org-ul">
<li>ä¼˜åŒ–I/Oæ€§èƒ½</li>
<li>å®ç°ç£ç›˜ç©ºé—´é…é¢é™åˆ¶</li>
<li>æé«˜ä¿®å¤é€Ÿåº¦</li>
<li>éš”ç¦»ç³»ç»Ÿå’Œç¨‹åº</li>
<li>å®‰è£…å¤šä¸ªOS</li>
<li>é‡‡ç”¨ä¸åŒæ–‡ä»¶ç³»ç»Ÿ</li>
</ul>
</div>
</div>
<div id="outline-container-h:3d1827ec-69f5-4770-9a06-717911832c59" class="outline-4">
<h4 id="h:3d1827ec-69f5-4770-9a06-717911832c59">åˆ†åŒºæ–¹å¼</h4>
<div class="outline-text-4" id="text-h:3d1827ec-69f5-4770-9a06-717911832c59">
<p>
ä¸¤ç§åˆ†åŒºæ–¹å¼ï¼šMBRï¼ŒGPT
</p>
</div>
<div id="outline-container-h:649c5210-a646-4550-a6a7-3dab6c9d393f" class="outline-5">
<h5 id="h:649c5210-a646-4550-a6a7-3dab6c9d393f">MBRåˆ†åŒº</h5>
<div class="outline-text-5" id="text-h:649c5210-a646-4550-a6a7-3dab6c9d393f">
<p>
MBRï¼šMaster Boot Recordï¼Œ1982å¹´ï¼Œä½¿ç”¨32ä½è¡¨ç¤ºæ‰‡åŒºæ•°ï¼Œåˆ†åŒºä¸è¶…è¿‡2T
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">echo 2^32*512/1024/1024/1024|bc</span>
2048
</pre>
</div>

<p>
åˆ’åˆ†åˆ†åŒºçš„å•ä½ï¼š
</p>

<ul class="org-ul">
<li>CentOS 5 ä¹‹å‰æŒ‰æ•´æŸ±é¢åˆ’åˆ†</li>
<li>CentOS 6 ç‰ˆæœ¬åå¯ä»¥æŒ‰Sectoråˆ’åˆ†</li>
</ul>

<p>
0ç£é“0æ‰‡åŒºï¼š512bytes
</p>

<ul class="org-ul">
<li>446bytes: boot loader</li>
<li>64bytesï¼šåˆ†åŒºè¡¨ï¼Œå…¶ä¸­æ¯16bytesæ ‡è¯†ä¸€ä¸ªåˆ†åŒºï¼Œå› æ­¤åªèƒ½å­˜æ”¾4ä¸ªåˆ†åŒºä¿¡æ¯</li>
<li>2bytes: 55AA æ ‡è¯†ä½ï¼Œè¡¨ç¤ºç¡¬ç›˜æ˜¯æœ‰åˆ†åŒºçš„</li>
</ul>

<p>
MBRåˆ†åŒºä¸­ä¸€å—ç¡¬ç›˜æœ€å¤šæœ‰4ä¸ªä¸»åˆ†åŒºï¼Œä¹Ÿå¯ä»¥3ä¸»åˆ†åŒº+1æ‰©å±•(Nä¸ªé€»è¾‘åˆ†åŒº)
</p>

<p>
MBRåˆ†åŒºï¼šä¸»å’Œæ‰©å±•åˆ†åŒºå¯¹åº”çš„1&#x2013;4ï¼Œ/dev/sda3ï¼Œé€»è¾‘åˆ†åŒºä»5å¼€å§‹ï¼Œ/dev/sda5
</p>

<p>
MBRåˆ†åŒºç»“æ„
</p>


<figure id="org5b80ed1">
<img src="images/image-20210216020614182.png" alt="image-20210216020614182.png" width="90%">

</figure>

<ul class="org-ul">
<li>ä¸€ä¸ªå­—èŠ‚ = 8ä½ï¼ˆ8ä¸ªäºŒè¿›åˆ¶ä½ï¼‰ 1Byte = 8bitï¼›</li>
<li>ä¸€ä¸ªåå…­è¿›åˆ¶ = 4ä¸ªäºŒè¿›åˆ¶ä½</li>
<li>ä¸€ä¸ªå­—èŠ‚ = 2ä¸ªåå…­è¿›åˆ¶</li>
</ul>


<div class="org-src-container">
<pre class="src src-sh">[root@proxy ~]# hexdump -C -n 512 /dev/xvda <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;&#30913;&#30424;MBR&#20998;&#21306;&#20449;&#24687;</span>
00000000  eb 63 90 10 8e d0 bc 00  b0 b8 00 00 8e d8 8e c0  |.c..............|
00000010  fb be 00 7c bf 00 06 b9  00 02 f3 a4 ea 21 06 00  |...|.........!..|
......
000001a0  b4 0e cd 10 ac 3c 00 75  f4 c3 00 00 00 00 00 00  |.....&lt;.u........|
000001b0  00 00 00 00 00 00 00 00  0e 05 0b 00 00 00 80 20  |............... |
000001c0  21 00 83 fe ff ff 00 08  00 00 df f7 ff 04 00 00  |!...............|
000001d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000001f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 55 aa  |..............U.|
00000200
</pre>
</div>


<figure id="org447a157">
<img src="images/image-20210216020715868.png" alt="image-20210216020715868.png" width="60%">

<figcaption><span class="figure-number">Figure 1: </span>image-20210216020715868</figcaption>
</figure>

<p>
ç¡¬ç›˜ä¸»å¼•å¯¼è®°å½•MBRç”±4ä¸ªéƒ¨åˆ†ç»„æˆ
</p>

<ul class="org-ul">
<li>ä¸»å¼•å¯¼ç¨‹åºï¼ˆåç§»åœ°å€0000H&#x2013;0088Hï¼‰ï¼Œå®ƒè´Ÿè´£ä»æ´»åŠ¨åˆ†åŒºä¸­è£…è½½ï¼Œå¹¶è¿è¡Œç³»
ç»Ÿå¼•å¯¼ç¨‹åº</li>
<li>å‡ºé”™ä¿¡æ¯æ•°æ®åŒºï¼Œåç§»åœ°å€0089H&#x2013;00E1Hä¸ºå‡ºé”™ä¿¡æ¯ï¼Œ00E2H&#x2013;01BDHå…¨ä¸º0å­—èŠ‚</li>
<li>åˆ†åŒºè¡¨ï¼ˆDPT,Disk Partition Tableï¼‰å«4ä¸ªåˆ†åŒºé¡¹ï¼Œåç§»åœ°å€01BEH&#x2013;01FDH,
æ¯ä¸ªåˆ†åŒºè¡¨é¡¹é•¿16ä¸ªå­—èŠ‚ï¼Œå…±64å­—èŠ‚ä¸ºåˆ†åŒºé¡¹1ã€åˆ†åŒºé¡¹2ã€åˆ†åŒºé¡¹3ã€åˆ†åŒºé¡¹4</li>
<li>ç»“æŸæ ‡å¿—å­—ï¼Œåç§»åœ°å€01FE&#x2013;01FFçš„2ä¸ªå­—èŠ‚å€¼ä¸ºç»“æŸæ ‡å¿—55AA</li>
</ul>

<p>
MBRä¸­DPTç»“æ„
</p>


<figure id="org1ef5ebb">
<img src="images/image-20210216020731810.png" alt="image-20210216020731810.png" width="80%">

</figure>

<p>
èŒƒä¾‹: å¤‡ä»½MBRçš„åˆ†åŒºè¡¨,å¹¶ç ´ååæ¢å¤
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#22791;&#20221;MBR&#20998;&#21306;&#34920;</span>
dd <span style="color: #a0522d;">if</span>=/dev/sda <span style="color: #a0522d;">of</span>=/data/dpt.img <span style="color: #a0522d;">bs</span>=1 <span style="color: #a0522d;">count</span>=64 <span style="color: #a0522d;">skip</span>=446 <span style="color: #b22222;"># </span><span style="color: #b22222;">skip&#36339;&#36807;&#28304;&#21069;446&#20010;&#23383;&#33410;&#65292;&#21482;&#22791;&#20221;&#20998;&#21306;&#34920;</span>
cp /data/dpt.img 10.0.0.102:~
hexdump -C /data/dpt.img <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20197;16&#36827;&#21046;&#26597;&#30475;&#25991;&#20214;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#30772;&#22351;MBR&#20998;&#21306;&#34920;</span>
[root@centos8 ~]#dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/dev/sda <span style="color: #a0522d;">bs</span>=1 <span style="color: #a0522d;">count</span>=64 <span style="color: #a0522d;">seek</span>=446 <span style="color: #b22222;"># </span><span style="color: #b22222;">seek &#30446;&#26631;&#30340;&#21069;446&#20010;&#23383;&#33410;&#36339;&#36807;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26080;&#27861;&#21551;&#21160;</span>
[root@centos8 ~]#reboot

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#20809;&#30424;&#21551;&#21160;,&#36827;&#20837;rescue mode,&#36873;&#31532;3&#39033;skip to shell</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37197;&#32622;&#32593;&#32476;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">ifconfig ens160 10.0.0.8/24</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">ip a a 10.0.0.8/24 dev/ens160</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">scp 10.0.0.102:/root/dpt.img .</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#24674;&#22797;MBR&#20998;&#21306;&#34920;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">dd if=dpt.img of=/dev/sda bs=1 seek=446</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">exit</span>
</pre>
</div>

<p>
é—®é¢˜ï¼šåˆ©ç”¨åˆ†åŒºç­–ç•¥ç›¸åŒçš„å¦ä¸€å°ä¸»æœºçš„åˆ†åŒºè¡¨æ¥è¿˜åŸå’Œæ¢å¤å½“å‰ä¸»æœºç ´ç¯çš„åˆ†åŒºè¡¨ï¼Ÿ
</p>
</div>
</div>
<div id="outline-container-h:bbf72e7e-292d-43ce-8106-726733eff049" class="outline-5">
<h5 id="h:bbf72e7e-292d-43ce-8106-726733eff049">GPTåˆ†åŒº</h5>
<div class="outline-text-5" id="text-h:bbf72e7e-292d-43ce-8106-726733eff049">
<p>
GPTï¼šGUIDï¼ˆGlobals Unique Identifiersï¼‰ partition tableæ”¯æŒ128ä¸ªåˆ†åŒºï¼Œ
ä½¿ç”¨64ä½ï¼Œæ”¯æŒ8Zï¼ˆ512Byte/block ï¼‰64Z ï¼ˆ 4096Byte/blockï¼‰
</p>

<p>
ä½¿ç”¨128ä½UUID(Universally Unique Identifier) è¡¨ç¤ºç£ç›˜å’Œåˆ†åŒº
GPTåˆ†åŒºè¡¨è‡ªåŠ¨å¤‡ä»½åœ¨å¤´å’Œå°¾ä¸¤ä»½ï¼Œå¹¶æœ‰CRCæ ¡éªŒä½
</p>

<p>
UEFI (Unified Extensible Firmware Interface
ç»Ÿä¸€å¯æ‰©å±•å›ºä»¶æ¥å£)ç¡¬ä»¶æ”¯æŒGPTï¼Œä½¿å¾—æ“ä½œç³»ç»Ÿå¯ä»¥å¯åŠ¨
</p>

<p>
<b>GPTåˆ†åŒºç»“æ„</b>
</p>


<figure id="orge23487d">
<img src="images/image-20210216020756367.png" alt="image-20210216020756367.png" width="80%">

</figure>

<p>
windows ä¸­æŸ¥çœ‹åˆ†åŒºç±»å‹ï¼Œâ€œæˆ‘çš„ç”µè„‘â€å³é”®ç®¡ç†&#x2013;&gt;â€œç£ç›˜ç®¡ç†â€&#x2013;&gt;ä»»æ„åˆ†åŒºå³é”®â€å±æ€§â€&#x2013;&gt;å·"ç£ç›˜åˆ†åŒºå½¢å¼"
</p>

<p>
GPTåˆ†åŒºç»“æ„åˆ†ä¸º4ä¸ªåŒºåŸŸï¼š
</p>

<ul class="org-ul">
<li>GPTå¤´</li>
<li>åˆ†åŒºè¡¨</li>
<li>GPTåˆ†åŒº</li>
<li>å¤‡ä»½åŒºåŸŸ</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:7621c54c-bfe7-4f2c-ab55-9e4febb30289" class="outline-4">
<h4 id="h:7621c54c-bfe7-4f2c-ab55-9e4febb30289">BIOSå’ŒUEFI</h4>
<div class="outline-text-4" id="text-h:7621c54c-bfe7-4f2c-ab55-9e4febb30289">
<p>
BIOSæ˜¯å›ºåŒ–åœ¨ç”µè„‘ä¸»æ¿ä¸Šçš„ç¨‹åºï¼Œä¸»è¦ç”¨äºå¼€æœºç³»ç»Ÿè‡ªæ£€å’Œå¼•å¯¼æ“ä½œç³»ç»Ÿã€‚ç›®å‰
æ–°å¼çš„ç”µè„‘åŸºæœ¬ä¸Šéƒ½æ˜¯UEFIå¯åŠ¨
</p>

<p>
BIOSï¼ˆBasic Input Output SystemåŸºæœ¬è¾“å…¥è¾“å‡ºç³»ç»Ÿï¼‰ä¸»è¦å®Œæˆç³»ç»Ÿç¡¬ä»¶è‡ªæ£€
å’Œå¼•å¯¼æ“ä½œç³»ç»Ÿï¼Œæ“ä½œç³»ç»Ÿå¼€å§‹å¯åŠ¨ä¹‹åï¼ŒBIOSçš„ä»»åŠ¡å°±å®Œæˆäº†ã€‚ç³»ç»Ÿç¡¬ä»¶è‡ªæ£€ï¼š
å¦‚æœç³»ç»Ÿç¡¬ä»¶æœ‰æ•…éšœï¼Œä¸»æ¿ä¸Šçš„æ‰¬å£°å™¨å°±ä¼šå‘å‡ºé•¿çŸ­ä¸åŒçš„â€æ»´æ»´â€éŸ³ï¼Œå¯ä»¥ç®€
å•çš„åˆ¤æ–­ç¡¬ä»¶æ•…éšœï¼Œæ¯”å¦‚â€1é•¿1çŸ­â€é€šå¸¸è¡¨ç¤ºå†…å­˜æ•…éšœï¼Œ"1é•¿3çŸ­"é€šå¸¸è¡¨ç¤ºæ˜¾å¡
æ•…éšœ
</p>

<p>
BIOSåœ¨1975å¹´å°±è¯ç”Ÿäº†ï¼Œä½¿ç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™ï¼Œå½“åˆåªæœ‰16ä½ï¼Œå› æ­¤åªèƒ½è®¿é—®1Mçš„
å†…å­˜ï¼Œå…¶ä¸­å‰640Kç§°ä¸ºåŸºæœ¬å†…å­˜ï¼Œå384Kå†…å­˜ç•™ç»™å¼€æœºå’Œå„ç±»BIOSæœ¬èº«ä½¿ç”¨ã€‚
BIOSåªèƒ½è¯†åˆ«åˆ°ä¸»å¼•å¯¼è®°å½•ï¼ˆMBRï¼‰åˆå§‹åŒ–çš„ç¡¬ç›˜ï¼Œæœ€å¤§æ”¯æŒ2Tçš„ç¡¬ç›˜ï¼Œ4ä¸ªä¸»åˆ†
åŒºï¼ˆé€»è¾‘åˆ†åŒºä¸­çš„æ‰©å±•åˆ†åŒºé™¤å¤–ï¼‰ï¼Œè€Œç›®å‰æ™®éå®ç°äº†64ä½ç³»ç»Ÿï¼Œä¼ ç»Ÿçš„BIOSå·²
ç»æ— æ³•æ»¡è¶³éœ€æ±‚äº†ï¼Œè¿™æ—¶è‹±ç‰¹å°”ä¸»å¯¼çš„EFIå°±è¯ç”Ÿäº†
</p>

<p>
EFIï¼ˆExtensible Firmware Interfaceï¼‰å¯æ‰©å±•å›ºä»¶æ¥å£ï¼Œæ˜¯ Intel ä¸º PCå›ºä»¶
çš„ä½“ç³»ç»“æ„ã€æ¥å£å’ŒæœåŠ¡æå‡ºçš„å»ºè®®æ ‡å‡†ã€‚å…¶ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç»„åœ¨ OSåŠ 
è½½ä¹‹å‰ï¼ˆå¯åŠ¨å‰ï¼‰åœ¨æ‰€æœ‰å¹³å°ä¸Šä¸€è‡´çš„ã€æ­£ç¡®æŒ‡å®šçš„å¯åŠ¨æœåŠ¡ï¼Œè¢«çœ‹åšæ˜¯BIOSçš„
ç»§ä»»è€…ï¼Œæˆ–è€…ç†è§£ä¸ºæ–°ç‰ˆBIOSã€‚
</p>

<p>
UEFIæ˜¯ç”±EFI1.10ä¸ºåŸºç¡€å‘å±•èµ·æ¥çš„ï¼Œå®ƒçš„æ‰€æœ‰è€…å·²ä¸å†æ˜¯Intelï¼Œè€Œæ˜¯ä¸€ä¸ªç§°ä½œ
Unified EFI Formçš„å›½é™…ç»„ç»‡
</p>

<p>
UEFI(Unified Extensible Firmware Interface)ç»Ÿä¸€çš„å¯æ‰©å±•å›ºä»¶æ¥å£ï¼Œæ˜¯ä¸€
ç§è¯¦ç»†æè¿°ç±»å‹æ¥å£çš„æ ‡å‡†ã€‚UEFIç›¸å½“äºä¸€ä¸ªè½»é‡åŒ–çš„æ“ä½œç³»ç»Ÿï¼Œæä¾›äº†ç¡¬ä»¶å’Œ
æ“ä½œç³»ç»Ÿä¹‹é—´çš„ä¸€ä¸ªæ¥å£ï¼Œæä¾›äº†å›¾å½¢åŒ–çš„æ“ä½œç•Œé¢ã€‚æœ€å…³é”®çš„æ˜¯å¼•å…¥äº†GPTåˆ†
åŒºè¡¨ï¼Œæ”¯æŒ2Tä»¥ä¸Šçš„ç¡¬ç›˜ï¼Œç¡¬ç›˜åˆ†åŒºä¸å—é™åˆ¶
</p>

<p>
<b>BIOSå’ŒUEFIåŒºåˆ«</b>
</p>

<p>
BIOSé‡‡ç”¨äº†16ä½æ±‡ç¼–è¯­è¨€ç¼–å†™ï¼Œåªèƒ½è¿è¡Œåœ¨å®æ¨¡å¼ï¼ˆå†…å­˜å¯»å€æ–¹å¼ç”±16ä½æ®µå¯„å­˜
å™¨çš„å†…å®¹ä¹˜ä»¥16(10H)å½“åšæ®µåŸºåœ°å€ï¼ŒåŠ ä¸Š16ä½åç§»åœ°å€å½¢æˆ20ä½çš„ç‰©ç†åœ°å€ï¼‰
ä¸‹ï¼Œå¯è®¿é—®çš„å†…å­˜ç©ºé—´ä¸º1MBï¼Œåªæ”¯æŒå­—ç¬¦æ“ä½œç•Œé¢
</p>

<p>
UEFIé‡‡ç”¨32ä½æˆ–è€…64ä½çš„Cè¯­è¨€ç¼–å†™ï¼Œçªç ´äº†å®æ¨¡å¼çš„é™åˆ¶ï¼Œå¯ä»¥è¾¾åˆ°æœ€å¤§çš„å¯»
å€ç©ºé—´ï¼Œæ”¯æŒå›¾å½¢æ“ä½œç•Œé¢ï¼Œä½¿ç”¨æ–‡ä»¶æ–¹å¼ä¿å­˜ä¿¡æ¯ï¼Œæ”¯æŒGPTåˆ†åŒºå¯åŠ¨ï¼Œé€‚åˆ
å’Œè¾ƒæ–°çš„ç³»ç»Ÿå’Œç¡¬ä»¶çš„é…åˆä½¿ç”¨
</p>

<p>
<b>BIOS+MBRä¸UEFI+GPT</b>
</p>


<figure id="org22cf0f5">
<img src="images/image-20210216020813567.png" alt="image-20210216020813567.png" width="60%">

</figure>

<p>
MSDN(Microsoft Developer Network)æŒ‡å‡ºï¼ŒWindowsåªèƒ½å®‰è£…äºBIOS+MBRæˆ–æ˜¯UEF+GPTçš„ç»„åˆä¸Šï¼Œ
ä½†æ˜¯BIOS+GPT+GRUBå¯åŠ¨Linuxæ˜¯å¯ä»¥çš„ã€‚
</p>

<p>
èŒƒä¾‹ï¼šæŸ¥çœ‹ç£ç›˜åˆ†åŒºç±»å‹
</p>
<div class="org-src-container">
<pre class="src src-sh">root@debian:~# fdisk -l
Disk /dev/sda: 20 GiB, 21474836480 bytes, 41943040 sectors
Disk model: VMware Virtual S
Units: sectors of 1 * <span style="color: #a0522d;">512</span> = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos   <span style="color: #b22222;">#</span><span style="color: #b22222;">dos &#20195;&#34920;MBR</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c91dfc83-06a0-4be7-b8e2-70442d7572ce" class="outline-4">
<h4 id="h:c91dfc83-06a0-4be7-b8e2-70442d7572ce">ç®¡ç†åˆ†åŒº</h4>
<div class="outline-text-4" id="text-h:c91dfc83-06a0-4be7-b8e2-70442d7572ce">
<p>
åˆ—å‡ºå—è®¾å¤‡
</p>
<div class="org-src-container">
<pre class="src src-sh">lsblk
</pre>
</div>

<p>
åˆ›å»ºåˆ†åŒºå‘½ä»¤
</p>
<div class="org-src-container">
<pre class="src src-sh">fdisk    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31649;&#29702;MBR&#20998;&#21306;</span>
gdisk   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31649;&#29702;GPT&#20998;&#21306;</span>
parted <span style="color: #b22222;">#</span><span style="color: #b22222;">&#39640;&#32423;&#20998;&#21306;&#25805;&#20316;&#65292;&#21487;&#20197;&#26159;&#20132;&#20114;&#25110;&#38750;&#20132;&#20114;&#26041;&#24335;</span>
</pre>
</div>

<p>
é‡æ–°è®¾ç½®å†…å­˜ä¸­çš„å†…æ ¸åˆ†åŒºè¡¨ç‰ˆæœ¬ï¼Œé€‚åˆäºé™¤äº†CentOS 6 ä»¥å¤–çš„å…¶å®ƒç‰ˆæœ¬5ï¼Œ7ï¼Œ8
</p>
<div class="org-src-container">
<pre class="src src-sh">partprobe
</pre>
</div>

<p>
ä¸é‡å¯Linuxè¯†åˆ«æ–°æ·»åŠ çš„ç¡¬ç›˜
</p>
<div class="org-src-container">
<pre class="src src-sh">ls &#8211;l  /sys/class/scsi_host/
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#26377;&#20960;&#20010;host&#25991;&#20214;&#20351;&#29992;&#21629;&#20196;&#25195;&#25551;&#65306;</span>
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">'- - -'</span> &gt;/sys/class/scsi_host/host0/scan
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">'- - -'</span> &gt;/sys/class/scsi_host/host1/scan
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">'- - -'</span> &gt;/sys/class/scsi_host/host2/scan

[root@centos8 ~]#alias <span style="color: #a0522d;">scandisk</span>=<span style="color: #8b2252;">'echo - - - &gt;/sys/class/scsi_host/host0/scan;echo - - - &gt;/sys/class/scsi_host/host1/scan;echo - - - &gt; /sys/class/scsi_host/host2/scan'</span>
</pre>
</div>
</div>
<div id="outline-container-h:5f9d6e08-dfda-491b-8654-d7d8f1af32ba" class="outline-5">
<h5 id="h:5f9d6e08-dfda-491b-8654-d7d8f1af32ba">åˆ—å‡ºå—è®¾å¤‡ lsblk</h5>
<div class="outline-text-5" id="text-h:5f9d6e08-dfda-491b-8654-d7d8f1af32ba">
<div class="org-src-container">
<pre class="src src-sh">lsblk
&#36873;&#39033;&#19982;&#21442;&#25968;&#65306;
-d &#65306;&#20165;&#21015;&#20986;&#30913;&#30424;&#26412;&#36523;&#65292;&#24182;&#19981;&#20250;&#21015;&#20986;&#35813;&#30913;&#30424;&#30340;&#20998;&#21306;&#25968;&#25454;
-f &#65306;&#21516;&#26102;&#21015;&#20986;&#35813;&#30913;&#30424;&#20869;&#30340;&#25991;&#20214;&#31995;&#32479;&#21517;&#31216; ** 
-i &#65306;&#20351;&#29992; ASCII &#30340;&#32447;&#27573;&#36755;&#20986;&#65292;&#19981;&#35201;&#20351;&#29992;&#22797;&#26434;&#30340;&#32534;&#30721; &#65288;&#20877;&#26576;&#20123;&#29615;&#22659;&#19979;&#24456;&#26377;&#29992;&#65289;
-m &#65306;&#21516;&#26102;&#36755;&#20986;&#35813;&#35774;&#22791;&#22312; /dev &#19979;&#38754;&#30340;&#26435;&#38480;&#25968;&#25454; &#65288;rwx &#30340;&#25968;&#25454;&#65289;
-p &#65306;&#21015;&#20986;&#35813;&#35774;&#22791;&#30340;&#23436;&#25972;&#25991;&#20214;&#21517;&#65281;&#32780;&#19981;&#26159;&#20165;&#21015;&#20986;&#26368;&#21518;&#30340;&#21517;&#23383;&#32780;&#24050;&#12290;
-t &#65306;&#21015;&#20986;&#35813;&#30913;&#30424;&#35774;&#22791;&#30340;&#35814;&#32454;&#25968;&#25454;&#65292;&#21253;&#25324;&#30913;&#30424;&#20267;&#21015;&#26426;&#21046;&#12289;&#39044;&#35835;&#20889;&#30340;&#25968;&#25454;&#37327;&#22823;&#23567;&#31561;
</pre>
</div>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]# lsblk  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#24403;&#21069;&#26377;&#22810;&#23569;&#22359;&#35774;&#22791;</span>
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
fd0      2:0    1    4K  0 disk 
sda      8:0    0  120G  0 disk 
&#9500;&#9472;sda1   8:1    0  512M  0 part /boot
&#9500;&#9472;sda2   8:2    0   20G  0 part /
&#9500;&#9472;sda3   8:3    0   20G  0 part /usr
&#9500;&#9472;sda4   8:4    0    1K  0 part 
&#9500;&#9472;sda5   8:5    0    2G  0 part [SWAP]
&#9492;&#9472;sda6   8:6    0   10G  0 part 
sr0     11:0    1  7.1G  0 rom  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20809;&#39537;</span>
&#36755;&#20986;&#20449;&#24687;&#35299;&#37322;&#65306;
NAME&#65306;&#23601;&#26159;&#35774;&#22791;&#30340;&#25991;&#20214;&#21517;&#65281;&#20250;&#30465;&#30053; /dev &#31561;&#21069;&#23548;&#30446;&#24405;
MAJ:MIN&#65306;&#20998;&#21035;&#26159;&#20027;&#35201;&#65306;&#27425;&#35201;&#35774;&#22791;&#20195;&#30721;
RM&#65306;&#26159;&#21542;&#20026;&#21487;&#21368;&#36733;&#35774;&#22791; &#65288;removable device&#65289;&#65292;&#22914;&#20809;&#30424;&#12289;USB &#30913;&#30424;&#31561;&#31561;
SIZE&#65306;&#24403;&#28982;&#23601;&#26159;&#23481;&#37327;
RO&#65306;&#26159;&#21542;&#20026;&#21482;&#35835;&#35774;&#22791;&#30340;&#24847;&#24605;
TYPE&#65306;&#26159;&#30913;&#30424; &#65288;disk&#65289;&#12289;&#20998;&#21306; &#65288;partition&#65289; &#36824;&#26159;&#21482;&#35835;&#23384;&#20648;&#22120; &#65288;rom&#65289; &#31561;&#36755;&#20986;
MOUTPOINT&#65306;&#25346;&#36733;&#28857;
</pre>
</div>

<p>
èŒƒä¾‹ï¼šè¯†åˆ«SSDå’Œæœºæ¢°ç¡¬ç›˜ç±»å‹
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">1&#34920;&#31034;&#26426;&#26800;&#65292;0&#34920;&#31034;SSD</span>
[root@centos8 ~]#lsblk -d -o name,rota
NAME  ROTA
sda     1
sr0     1
nvme0n1   0
nvme0n2   0
</pre>
</div>
</div>
</div>
<div id="outline-container-h:09cba273-0615-45b6-905c-f05fc7feaa3c" class="outline-5">
<h5 id="h:09cba273-0615-45b6-905c-f05fc7feaa3c">parted å‘½ä»¤</h5>
<div class="outline-text-5" id="text-h:09cba273-0615-45b6-905c-f05fc7feaa3c">
<p>
<b>æ³¨æ„ï¼špartedçš„æ“ä½œéƒ½æ˜¯å®æ—¶ç”Ÿæ•ˆçš„ï¼Œå°å¿ƒä½¿ç”¨</b>
</p>

<p>
æ ¼å¼ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">parted [&#36873;&#39033;]... [&#35774;&#22791; [&#21629;&#20196; [&#21442;&#25968;]...]...]
</pre>
</div>

<p>
é€‰é¡¹ï¼š -l æ˜¾ç¤ºç£ç›˜ä¿¡æ¯
</p>

<p>
èŒƒä¾‹ï¼šåˆ†åŒºåˆ›å»ºåˆ é™¤
</p>

<div class="org-src-container">
<pre class="src src-sh">parted /dev/sdb mklabel gpt|msdos  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#20998;&#21306;&#34920;&#65307;msdos&#34920;&#31034;MBR&#20998;&#21306;</span>
parted /dev/sdb unit mb print  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26174;&#31034;&#20998;&#21306;  &#21333;&#20301;&#26174;&#31034;&#19981;&#19968;&#33268;&#26102;&#65292;unit mb &#25351;&#23450;&#20197;mb&#26174;&#31034;</span>
parted /dev/sdb mkpart primary 1 200 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26032;&#22686;&#20998;&#21306;&#65288;&#40664;&#35748;&#22823;&#23567;M&#65289;&#31435;&#21363;&#29983;&#25928;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">lsblk    &#12289;ll /dev/sdb* &#12289;cat /proc/partitions &#26597;&#30475;&#20998;&#21306; </span>
parted /dev/sdb rm 1  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21024;&#38500;&#20998;&#21306;</span>
parted &#8211;l  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21015;&#20986;&#25152;&#26377;&#30828;&#30424;&#20998;&#21306;&#20449;&#24687;</span>
</pre>
</div>

<p>
èŒƒä¾‹ï¼šåˆ›å»ºåˆ†åŒºå¹¶æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ
</p>

<div class="org-src-container">
<pre class="src src-sh">mkdir /data
parted /dev/vdb mklabel gpt
parted -s /dev/vdb <span style="color: #8b2252;">'mkpart primary 1049k -1'</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">parted /dev/vdb mkpart primary xfs 0G 4398GB</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">parted -s /dev/vdb mkpart primary 0 100%</span>
mkfs.ext4  /dev/vdb1
<span style="color: #b22222;">#</span><span style="color: #b22222;">mkfs.xfs -f /dev/vdb1</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">blkid</span>
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"/dev/vdb1  /data1                       ext4    defaults,nodelalloc,noatime       0 2"</span> &gt;&gt;/etc/fstab
mount -a
</pre>
</div>

<p>
èŒƒä¾‹: æ–°å¢åˆ†åŒº
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#parted /dev/sdb print
Partition Table: unknown
[root@centos8 ~]#parted /dev/sdb mklabel gpt
[root@centos8 ~]#parted /dev/sdb print
Partition Table: gpt
[root@centos8 ~]#parted /dev/sdb mkpart primary 1 1001
[root@centos8 ~]#parted /dev/sdb print
Model: VMware, VMware Virtual S (scsi)
Disk /dev/sdb: 21.5GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:
Number Start  End   Size  File system Name   Flags
1   1049kB 1001MB 1000MB        primary
[ 1 ] [ 2 ] [ 3 ] [ 4 ] [ 5 ] [ 6 ]
1. Number&#65306;&#36825;&#20010;&#23601;&#26159;&#20998;&#21306;&#30340;&#21495;&#30721;&#21862;&#65281;&#20030;&#20363;&#26469;&#35828;&#65292;1&#21495;&#20195;&#34920;&#30340;&#26159; /dev/sdb1 &#30340;&#24847;&#24605;&#65307;
2. Start&#65306;&#20998;&#21306;&#30340;&#36215;&#22987;&#20301;&#32622;&#22312;&#36825;&#39063;&#30913;&#30424;&#30340;&#22810;&#23569; MB &#22788;&#65311;
3. End&#65306;&#27492;&#20998;&#21306;&#30340;&#32467;&#26463;&#20301;&#32622;&#22312;&#36825;&#39063;&#30913;&#30424;&#30340;&#22810;&#23569; MB &#22788;&#65311;
4. Size&#65306;&#30001;&#19978;&#36848;&#20004;&#32773;&#30340;&#20998;&#26512;&#65292;&#24471;&#21040;&#36825;&#20010;&#20998;&#21306;&#26377;&#22810;&#23569;&#23481;&#37327;&#65307;
5. File system&#65306;&#20998;&#26512;&#21487;&#33021;&#30340;&#25991;&#20214;&#31995;&#32479;&#31867;&#22411;&#20026;&#20309;&#30340;&#24847;&#24605;&#65281;
6. Name&#65306;&#23601;&#22914;&#21516; gdisk &#30340; System ID &#20043;&#24847;&#12290;
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#39044;&#30041;&#20102;1048k&#65292;&#20026;&#23558;&#26469;&#23384;&#25918;&#21644;&#35745;&#31639;&#26426;&#21551;&#21160;&#30456;&#20851;&#30340;&#19996;&#35199;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#28155;&#21152;&#20998;&#21306;</span>
[root@centos8 ~]#parted /dev/sdb mkpart primary 1002 1102
Information: You may need to update /etc/fstab.

[root@centos8 ~]#parted /dev/sdb print
Model: VMware, VMware Virtual S (scsi)
Disk /dev/sdb: 21.5GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Number Start  End   Size  File system Name   Flags
1   1049kB 1001MB 1000MB        primary
2   1002MB 1102MB  99.6MB        primary

[root@centos8 ~]#parted /dev/sdb rm 2
[root@centos8 ~]#parted /dev/sdb print                  
Model: VMware, VMware Virtual S (scsi)
Disk /dev/sdb: 21.5GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:
Number Start  End   Size  File system Name   Flags
1   1049kB 1001MB 1000MB        primary

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21361;&#38505;&#65281;&#21361;&#38505;&#65281;&#21247;&#20081;&#25630;&#65281;&#26080;&#27861;&#22797;&#21407;&#65281;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26356;&#25913;&#29616;&#22312;&#20998;&#21306;&#34920;&#31867;&#22411;</span>
[root@centos8 ~]#parted /dev/sdb mklabel msdos
Warning: The existing disk label on /dev/sdb will be destroyed and all data on
this disk will be lost. Do you want to continue?
Yes/No? Y
Information: You may need to update /etc/fstab.

[root@centos8 ~]#parted /dev/sdb print             
Model: VMware, VMware Virtual S (scsi)
Disk /dev/sdb: 21.5GB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:
Number Start End Size Type File system Flags
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6d53ac13-e5e5-4ef7-817b-efa6882d6728" class="outline-5">
<h5 id="h:6d53ac13-e5e5-4ef7-817b-efa6882d6728">åˆ†åŒºå·¥å…·fdiskå’Œgdisk</h5>
<div class="outline-text-5" id="text-h:6d53ac13-e5e5-4ef7-817b-efa6882d6728">
<div class="org-src-container">
<pre class="src src-sh">gdisk [device...]       &#31867;fdisk &#30340;GPT&#20998;&#21306;&#24037;&#20855;
fdisk -l [-u] [device...]   &#26597;&#30475;&#20998;&#21306;
fdisk [device...]       &#31649;&#29702;MBR\GPT&#20998;&#21306;
</pre>
</div>

<p>
å­å‘½ä»¤ï¼šé€‚ç”¨äºfdisk, gdiskå‘½ä»¤
</p>

<div class="org-src-container">
<pre class="src src-sh">m &#24110;&#21161;
p &#20998;&#21306;&#21015;&#34920;
t &#26356;&#25913;&#20998;&#21306;&#31867;&#22411;
l &#26597;&#30475;&#25152;&#26377;&#24050;&#30693;&#30340;&#20998;&#21306;&#31867;&#22411; ID **
n &#21019;&#24314;&#26032;&#20998;&#21306;
d &#21024;&#38500;&#20998;&#21306;
v &#26657;&#39564;&#20998;&#21306;
u &#36716;&#25442;&#21333;&#20301;
w &#20445;&#23384;&#24182;&#36864;&#20986;
q &#19981;&#20445;&#23384;&#24182;&#36864;&#20986;
</pre>
</div>

<p>
æŸ¥çœ‹å†…æ ¸æ˜¯å¦å·²ç»è¯†åˆ«æ–°çš„åˆ†åŒº
</p>

<div class="org-src-container">
<pre class="src src-sh">cat /proc/partitions
</pre>
</div>

<p>
<b>CentOS7,8 åŒæ­¥åˆ†åŒºè¡¨</b>
</p>
<div class="org-src-container">
<pre class="src src-shell">partprobe
</pre>
</div>

<p>
<b>CentOS6 é€šçŸ¥å†…æ ¸é‡æ–°è¯»å–ç¡¬ç›˜åˆ†åŒºè¡¨</b>
</p>

<p>
æ–°å¢åˆ†åŒºç”¨
</p>
<div class="org-src-container">
<pre class="src src-sh">partx -a /dev/DEVICE
kpartx -a /dev/DEVICE -f: force

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31034;&#20363;&#65306;</span>
[root@centos6 ~]#partx -a /dev/sda
</pre>
</div>

<p>
åˆ é™¤åˆ†åŒºç”¨
</p>

<div class="org-src-container">
<pre class="src src-sh">partx -d --nr M-N /dev/DEVICE
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31034;&#20363;&#65306;</span>
[root@centos6 ~]#partx -d --nr 6-8 /dev/sda
</pre>
</div>

<p>
èŒƒä¾‹:éäº¤äº’å¼åˆ›å»ºåˆ†åŒº
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">echo</span> -e <span style="color: #8b2252;">'n\np\n\n\n+2G\nw\n'</span> | fdisk /dev/sdb

fdisk /dev/sdb &lt;&lt;EOF
<span style="color: #ffa54f;">n</span>
<span style="color: #ffa54f;">p</span>


<span style="color: #ffa54f;">+1G</span>
<span style="color: #ffa54f;">w</span>
<span style="color: #ffa54f;">EOF</span>
</pre>
</div>

<p>
èŒƒä¾‹: fdiskåˆ†åŒº
</p>

<div class="org-src-container">
<pre class="src src-sh">&#21019;&#24314;&#25193;&#23637;&#20998;&#21306;
[root@node01 ~]# fdisk /dev/sdb
n  &#21019;&#24314;&#26032;&#20998;&#21306;
e  &#36873;&#25321;&#20998;&#21306;&#31867;&#22411;&#65292;p &#20026;&#20027;&#20998;&#21306;&#65292;e &#20026;&#25193;&#23637;&#20998;&#21306;
Partition number (1-4, default 1):    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20998;&#21306;&#32534;&#21495;&#40664;&#35748;</span>
First sector (2048-41943039, default 2048):    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25159;&#21306;&#24320;&#22987;&#20301;&#32622;&#12290;&#22238;&#36710;&#20026;&#40664;&#35748;</span>
Last sector, +sectors or +size{K,M,G} (2048-41943039, default 41943039): +10G <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25159;&#21306;&#32467;&#26463;&#20301;&#32622;&#12290;&#26377;2&#31181;&#26041;&#24335;&#65292;&#25351;&#23450;&#25159;&#21306;&#21644;&#25351;&#23450;&#22823;&#23567;&#12290;&#25351;&#23450;&#22823;&#23567;&#27604;&#36739;&#26041;&#20415;</span>
p &#25171;&#21360;&#20998;&#21306;&#20449;&#24687;
Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors
   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048    20973567    10485760    5  Extended
&#25193;&#23637;&#20998;&#21306;&#19981;&#33021;&#21333;&#29420;&#20351;&#29992;&#65292;&#35201;&#32487;&#32493;&#20998;&#25104;&#36923;&#36753;&#20998;&#21306;
n  &#21019;&#24314;&#26032;&#20998;&#21306;
Partition type:
   l   logical (numbered from 5)
<span style="color: #0000ff;">Select</span> (default p): l <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36873;&#25321;&#20998;&#21306;&#31867;&#22411;&#65292;l &#20026;&#36923;&#36753;&#20998;&#21306;</span>
First sector (4096-20973567, default 4096):
Using default value 4096
Last sector, +sectors or +size{K,M,G} (4096-20973567, default 20973567): +2G     
<span style="color: #0000ff;">Command</span> (m for help): p


Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors
   Device Boot      Start         End      Blocks   Id  System

/dev/sdb1            2048    20973567    10485760    5  Extended
/dev/sdb5            4096     4198399     2097152   83  Linux
w &#20445;&#23384;&#24182;&#36864;&#20986;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22686;&#21152;&#20102;6,7&#20998;&#21306;</span>
[root@centos6 ~]#fdisk /dev/sda
<span style="color: #0000ff;">Command</span> (m for help): w
The partition table has been altered!
Calling ioctl() to re-read partition table.

WARNING: Re-reading the partition table failed with error 16: Device or resource busy.
The kernel still uses the old table. The new table will be used at
the next reboot or after you run partprobe(8) or kpartx(8)
Syncing disks.

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20998;&#21306;&#34920;&#19981;&#21516;&#27493;</span>
[root@centos6 ~]#lsblk
NAME  MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sr0   11:0   1  3.7G  0 rom 
sda    8:0   0 200G  0 disk
&#9500;&#9472;sda1  8:1   0  1G  0 part /boot
&#9500;&#9472;sda2  8:2   0 97.7G  0 part /
&#9500;&#9472;sda3  8:3   0 48.8G  0 part /data
&#9500;&#9472;sda4  8:4   0  1K  0 part
&#9492;&#9472;sda5  8:5   0  2G  0 part [SWAP]

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21516;&#27493;&#20998;&#21306;&#34920;</span>
[root@centos6 ~]#partx -a /dev/sda
BLKPG: Device or resource busy
error adding partition 1
BLKPG: Device or resource busy
error adding partition 2
BLKPG: Device or resource busy
error adding partition 3
BLKPG: Device or resource busy
error adding partition 4
BLKPG: Device or resource busy
error adding partition 5
[root@centos6 ~]#lsblk
NAME  MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sr0   11:0   1  3.7G  0 rom 
sda    8:0   0 200G  0 disk
&#9500;&#9472;sda1  8:1   0  1G  0 part /boot
&#9500;&#9472;sda2  8:2   0 97.7G  0 part /
&#9500;&#9472;sda3  8:3   0 48.8G  0 part /data
&#9500;&#9472;sda4  8:4   0  1K  0 part
&#9500;&#9472;sda5  8:5   0  2G  0 part [SWAP]
&#9500;&#9472;sda6  8:6   0  2G  0 part
&#9492;&#9472;sda7  8:7   0  3G  0 part

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500;&#20102;6,7&#20998;&#21306;</span>
[root@centos6 ~]#fdisk /dev/sda
<span style="color: #0000ff;">Command</span> (m for help): w
The partition table has been altered!
Calling ioctl() to re-read partition table.
WARNING: Re-reading the partition table failed with error 16: Device or resource
busy.
The kernel still uses the old table. The new table will be used at
the next reboot or after you run partprobe(8) or kpartx(8)
Syncing disks.
[root@centos6 ~]#
[root@centos6 ~]#lsblk
NAME  MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sr0   11:0   1  3.7G  0 rom 
sda    8:0   0 200G  0 disk
&#9500;&#9472;sda1  8:1   0  1G  0 part /boot
&#9500;&#9472;sda2  8:2   0 97.7G  0 part /
&#9500;&#9472;sda3  8:3   0 48.8G  0 part /data
&#9500;&#9472;sda4  8:4   0  1K  0 part
&#9500;&#9472;sda5  8:5   0  2G  0 part [SWAP]
&#9500;&#9472;sda6  8:6   0  2G  0 part
&#9492;&#9472;sda7  8:7   0  3G  0 part

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21516;&#27493;&#20998;&#21306;&#34920;</span>
[root@centos6 ~]#partx -d --nr 6-7 /dev/sda
[root@centos6 ~]#lsblk
NAME  MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
sr0   11:0   1  3.7G  0 rom 
sda    8:0   0 200G  0 disk
&#9500;&#9472;sda1  8:1   0  1G  0 part /boot
&#9500;&#9472;sda2  8:2   0 97.7G  0 part /
&#9500;&#9472;sda3  8:3   0 48.8G  0 part /data
&#9500;&#9472;sda4  8:4   0  1K  0 part
&#9492;&#9472;sda5  8:5   0  2G  0 part [SWAP]
</pre>
</div>

<p>
èŒƒä¾‹ï¼šgdiskåˆ†åŒº, é»˜è®¤MBRä¼šè½¬æˆGPT
</p>
<div class="org-src-container">
<pre class="src src-sh">gdisk /dev/sdb  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21644;fdisk &#20132;&#20114;&#36873;&#39033;&#19968;&#26679;</span>
p <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#20986;</span>
n <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26032;&#24314;&#20998;&#21306;</span>
w <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20445;&#23384;</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:b3fbddc6-7cdb-4263-b4d2-a2d36c8301bb" class="outline-3">
<h3 id="h:b3fbddc6-7cdb-4263-b4d2-a2d36c8301bb">æ–‡ä»¶ç³»ç»Ÿ</h3>
<div class="outline-text-3" id="text-h:b3fbddc6-7cdb-4263-b4d2-a2d36c8301bb">
</div>
<div id="outline-container-h:3c131bca-7170-492f-acb2-42982c9137a0" class="outline-4">
<h4 id="h:3c131bca-7170-492f-acb2-42982c9137a0">æ–‡ä»¶ç³»ç»Ÿæ¦‚å¿µ</h4>
<div class="outline-text-4" id="text-h:3c131bca-7170-492f-acb2-42982c9137a0">
<p>
æ–‡ä»¶ç³»ç»Ÿæ˜¯æ“ä½œç³»ç»Ÿç”¨äºæ˜ç¡®å­˜å‚¨è®¾å¤‡æˆ–åˆ†åŒºä¸Šçš„æ–‡ä»¶çš„æ–¹æ³•å’Œæ•°æ®ç»“æ„ï¼›å³åœ¨
å­˜å‚¨è®¾å¤‡ä¸Šç»„ç»‡æ–‡ä»¶çš„æ–¹æ³•ã€‚æ“ä½œç³»ç»Ÿä¸­è´Ÿè´£ç®¡ç†å’Œå­˜å‚¨æ–‡ä»¶ä¿¡æ¯çš„è½¯ä»¶ç»“æ„ç§°
ä¸ºæ–‡ä»¶ç®¡ç†ç³»ç»Ÿï¼Œç®€ç§°æ–‡ä»¶ç³»ç»Ÿ
</p>

<p>
ä»ç³»ç»Ÿè§’åº¦æ¥çœ‹ï¼Œæ–‡ä»¶ç³»ç»Ÿæ˜¯å¯¹æ–‡ä»¶å­˜å‚¨è®¾å¤‡çš„ç©ºé—´è¿›è¡Œç»„ç»‡å’Œåˆ†é…ï¼Œè´Ÿè´£æ–‡ä»¶
å­˜å‚¨å¹¶å¯¹å­˜å…¥çš„æ–‡ä»¶è¿›è¡Œä¿æŠ¤å’Œæ£€ç´¢çš„ç³»ç»Ÿã€‚å…·ä½“åœ°è¯´ï¼Œå®ƒè´Ÿè´£ä¸ºç”¨æˆ·å»ºç«‹æ–‡ä»¶ï¼Œ
å­˜å…¥ã€è¯»å‡ºã€ä¿®æ”¹ã€è½¬å‚¨æ–‡ä»¶ï¼Œæ§åˆ¶æ–‡ä»¶çš„å­˜å–ï¼Œå®‰å…¨æ§åˆ¶ï¼Œæ—¥å¿—ï¼Œå‹ç¼©ï¼ŒåŠ å¯†
ç­‰
</p>

<p>
æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">ls /lib/modules/<span style="color: #ff00ff;">`uname -r`</span>/kernel/fs

[root@proxy ~]# grep -i ext4 /boot/config-3.10.0-1160.119.1.el7.x86_64 
<span style="color: #a0522d;">CONFIG_EXT4_FS</span>=m  <span style="color: #b22222;">#</span><span style="color: #b22222;">m&#34920;&#31034;&#26159;&#19968;&#20010;&#29420;&#31435;&#30340;&#30913;&#30424;&#25991;&#20214;&#65292;y&#34920;&#31034;&#38598;&#25104;&#22312;&#20869;&#26680;&#20013;</span>
<span style="color: #a0522d;">CONFIG_EXT4_USE_FOR_EXT23</span>=y
</pre>
</div>

<p>
å„ç§æ–‡ä»¶ç³»ç»Ÿï¼š<a href="https://en.wikipedia.org/wiki/Comparison_of_file_systems">https://en.wikipedia.org/wiki/Comparison_of_file_systems</a>
</p>

<p>
å¸®åŠ©ï¼šman 5 fs
</p>
</div>
</div>
<div id="outline-container-h:a5a0758b-405a-4efb-8f7f-ff9cb367f5b7" class="outline-4">
<h4 id="h:a5a0758b-405a-4efb-8f7f-ff9cb367f5b7">æ–‡ä»¶ç³»ç»Ÿç±»å‹</h4>
<div class="outline-text-4" id="text-h:a5a0758b-405a-4efb-8f7f-ff9cb367f5b7">
<p>
<b>Linux å¸¸ç”¨æ–‡ä»¶ç³»ç»Ÿ</b>
</p>

<ul class="org-ul">
<li>ext2ï¼šExtended file system
é€‚ç”¨äºé‚£äº›åˆ†åŒºå®¹é‡ä¸æ˜¯å¤ªå¤§ï¼Œæ›´æ–°ä¹Ÿä¸é¢‘ç¹çš„æƒ…å†µï¼Œä¾‹å¦‚ /boot åˆ†åŒº</li>
<li>ext3ï¼šæ˜¯ ext2
çš„æ”¹è¿›ç‰ˆæœ¬ï¼Œå…¶æ”¯æŒæ—¥å¿—åŠŸèƒ½ï¼Œèƒ½å¤Ÿå¸®åŠ©ç³»ç»Ÿä»éæ­£å¸¸å…³æœºå¯¼è‡´çš„å¼‚å¸¸ä¸­æ¢å¤</li>
<li>ext4ï¼šæ˜¯ extæ–‡ä»¶ç³»ç»Ÿçš„æœ€æ–°ç‰ˆã€‚æä¾›äº†å¾ˆå¤šæ–°çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬çº³ç§’çº§æ—¶é—´æˆ³ã€
åˆ›å»ºå’Œä½¿ç”¨å·¨å‹æ–‡ä»¶(16TB)ã€æœ€å¤§1EBçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»¥åŠé€Ÿåº¦çš„æå‡</li>
<li>xfsï¼šSGIï¼Œæ”¯æŒæœ€å¤§8EBçš„æ–‡ä»¶ç³»ç»Ÿ</li>
<li>swap</li>
<li>iso9660 å…‰ç›˜</li>
<li>btrfsï¼ˆOracleï¼‰</li>
<li>reiserfs</li>
</ul>

<p>
<b>Windows å¸¸ç”¨æ–‡ä»¶ç³»ç»Ÿ</b>
</p>

<ul class="org-ul">
<li>FAT32</li>
<li>NTFS</li>
<li>exFAT</li>
</ul>

<p>
<b>Unixï¼š</b>
</p>

<ul class="org-ul">
<li>FFSï¼ˆfastï¼‰</li>
<li>UFSï¼ˆunixï¼‰</li>
<li>JFS2</li>
</ul>

<p>
<b>ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼š</b>
</p>

<ul class="org-ul">
<li>NFS</li>
<li>CIFS</li>
</ul>

<p>
<b>é›†ç¾¤æ–‡ä»¶ç³»ç»Ÿï¼š</b>
</p>

<ul class="org-ul">
<li>GFS2</li>
<li>OCFS2ï¼ˆoracleï¼‰</li>
</ul>

<p>
<b>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼š</b>
</p>

<ul class="org-ul">
<li>fastdfs</li>
<li>ceph</li>
<li>moosefs</li>
<li>mogilefs</li>
<li>glusterfs</li>
<li>Lustre</li>
</ul>

<p>
<b>RAWï¼š</b> æœªç»å¤„ç†æˆ–è€…æœªç»æ ¼å¼åŒ–äº§ç”Ÿçš„æ–‡ä»¶ç³»ç»Ÿ
</p>

<p>
<b>å¸¸ç”¨çš„æ–‡ä»¶ç³»ç»Ÿç‰¹æ€§ï¼š</b> <b>FAT32</b>
</p>

<ul class="org-ul">
<li>æœ€å¤šåªèƒ½æ”¯æŒ16TBçš„æ–‡ä»¶ç³»ç»Ÿå’Œ4GBçš„æ–‡ä»¶</li>
</ul>

<p>
<b>NTFS</b>
</p>

<ul class="org-ul">
<li>æœ€å¤šåªèƒ½æ”¯æŒ16EBçš„æ–‡ä»¶ç³»ç»Ÿå’Œ16EBçš„æ–‡ä»¶</li>
</ul>

<p>
<b>EXT3</b>
</p>

<ul class="org-ul">
<li>æœ€å¤šåªèƒ½æ”¯æŒ32TBçš„æ–‡ä»¶ç³»ç»Ÿå’Œ2TBçš„æ–‡ä»¶ï¼Œå®é™…åªèƒ½å®¹çº³2TBçš„æ–‡ä»¶ç³»ç»Ÿå’Œ16GBçš„æ–‡ä»¶</li>
<li>Ext3ç›®å‰åªæ”¯æŒ32000ä¸ªå­ç›®å½•</li>
<li>Ext3æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨32ä½ç©ºé—´è®°å½•å—æ•°é‡å’Œ inodeæ•°é‡</li>
<li>å½“æ•°æ®å†™å…¥åˆ°Ext3æ–‡ä»¶ç³»ç»Ÿä¸­æ—¶ï¼ŒExt3çš„æ•°æ®å—åˆ†é…å™¨æ¯æ¬¡åªèƒ½åˆ†é…ä¸€ä¸ª4KBçš„å—</li>
</ul>

<p>
<b>EXT4ï¼š</b>
</p>

<ul class="org-ul">
<li>EXT4æ˜¯Linuxç³»ç»Ÿä¸‹çš„æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿï¼Œæ˜¯EXT3æ–‡ä»¶ç³»ç»Ÿçš„åç»§ç‰ˆæœ¬</li>
<li>Ext4çš„æ–‡ä»¶ç³»ç»Ÿå®¹é‡è¾¾åˆ°1EBï¼Œè€Œæ”¯æŒå•ä¸ªæ–‡ä»¶åˆ™è¾¾åˆ°16TB</li>
<li>ç†è®ºä¸Šæ”¯æŒæ— é™æ•°é‡çš„å­ç›®å½•</li>
<li>Ext4æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨64ä½ç©ºé—´è®°å½•å—æ•°é‡å’Œ inodeæ•°é‡</li>
<li>Ext4çš„å¤šå—åˆ†é…å™¨æ”¯æŒä¸€æ¬¡è°ƒç”¨åˆ†é…å¤šä¸ªæ•°æ®å—</li>
<li>ä¿®å¤é€Ÿåº¦æ›´å¿«</li>
</ul>

<p>
<b>XFS</b>
</p>

<ul class="org-ul">
<li>æ ¹æ®æ‰€è®°å½•çš„æ—¥å¿—åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…è¿…é€Ÿæ¢å¤ç£ç›˜æ–‡ä»¶å†…å®¹</li>
<li>ç”¨ä¼˜åŒ–ç®—æ³•ï¼Œæ—¥å¿—è®°å½•å¯¹æ•´ä½“æ–‡ä»¶æ“ä½œå½±å“éå¸¸å°</li>
<li>æ˜¯ä¸€ä¸ªå…¨64-bitçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€å¤§å¯ä»¥æ”¯æŒ8EBçš„æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œæ”¯æŒå•ä¸ªæ–‡ä»¶åˆ™è¾¾åˆ°8EB</li>
<li>èƒ½ä»¥æ¥è¿‘è£¸è®¾å¤‡I/Oçš„æ€§èƒ½å­˜å‚¨æ•°æ®</li>
</ul>

<p>
æŸ¥å‰æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">cat /proc/filesystems
</pre>
</div>
</div>
</div>
<div id="outline-container-h:408140a8-173d-44ea-a166-f9b6b77d2895" class="outline-4">
<h4 id="h:408140a8-173d-44ea-a166-f9b6b77d2895">æ–‡ä»¶ç³»ç»Ÿçš„ç»„æˆéƒ¨åˆ†</h4>
<div class="outline-text-4" id="text-h:408140a8-173d-44ea-a166-f9b6b77d2895">
<ul class="org-ul">
<li>å†…æ ¸ä¸­çš„æ¨¡å—ï¼šext4, xfs, vfat</li>
<li>Linuxçš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼šVFS</li>
<li>ç”¨æˆ·ç©ºé—´çš„ç®¡ç†å·¥å…·ï¼šmkfs.ext4, mkfs.xfs,mkfs.vfat</li>
</ul>


<figure id="org68ef4b1">
<img src="images/image-20210216020847687.png" alt="image-20210216020847687.png" width="60%">

</figure>

<p>
VFS: Virtual File
Systemï¼Œä¸åŒæ–‡ä»¶ç³»ç»Ÿå’Œä¸Šå±‚æ¥ä¹‹é—´å£çš„ä¸­é—´å±‚
</p>
</div>
</div>
<div id="outline-container-h:432e0a58-303e-420b-8691-551154f8de43" class="outline-4">
<h4 id="h:432e0a58-303e-420b-8691-551154f8de43">æ–‡ä»¶ç³»ç»Ÿé€‰æ‹©ç®¡ç†</h4>
<div class="outline-text-4" id="text-h:432e0a58-303e-420b-8691-551154f8de43">
</div>
<div id="outline-container-h:63f2bda1-7472-4755-89e1-9b6e3ee6e585" class="outline-5">
<h5 id="h:63f2bda1-7472-4755-89e1-9b6e3ee6e585">åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ</h5>
<div class="outline-text-5" id="text-h:63f2bda1-7472-4755-89e1-9b6e3ee6e585">
<p>
åˆ›å»ºæ–‡ä»¶ç®¡ç†å·¥å…·
</p>

<ul class="org-ul">
<li><p>
mkfså‘½ä»¤ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">(1) mkfs.FS_TYPE /dev/DEVICE
ext4
xfs
btrfs
vfat
(2) mkfs -t FS_TYPE /dev/DEVICE
-L <span style="color: #8b2252;">'LABEL'</span> &#35774;&#23450;&#21367;&#26631;
</pre>
</div></li>

<li>mke2fsï¼šextç³»åˆ—æ–‡ä»¶ç³»ç»Ÿä¸“ç”¨ç®¡ç†å·¥å…·</li>
</ul>

<p>
å¸¸ç”¨é€‰é¡¹
</p>

<div class="org-src-container">
<pre class="src src-sh">-t {ext2|ext3|ext4|xfs}   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450;&#25991;&#20214;&#31995;&#32479;&#31867;&#22411;</span>
-b {1024|2048|4096}  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450;&#22359; block &#22823;&#23567;</span>
-L <span style="color: #8b2252;">'LABEL'</span>                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622;&#21367;&#26631;</span>
-j                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30456;&#24403;&#20110; -t ext3&#65292; mkfs.ext3 = mkfs -t ext3 = mke2fs -j = mke2fs -t ext3</span>
-i                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;&#25968;&#25454;&#31354;&#38388;&#20013;&#27599;&#22810;&#23569;&#20010;&#23383;&#33410;&#21019;&#24314;&#19968;&#20010;inode&#65307;&#19981;&#24212;&#35813;&#23567;&#20110;block&#22823;&#23567;; &#40664;&#35748;&#27599;16kb&#30913;&#30424;&#31354;&#38388;&#20998;&#37197;&#19968;&#20010;inode&#65292;&#19968;&#20010;inode&#22823;&#23567;&#20026;256b</span>
-T                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450;&#31867;&#22411;&#65307; -T largefile &#30456;&#24403;&#20110; -i 104876</span>
-N                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25351;&#23450;&#20998;&#21306;&#20013;&#21019;&#24314;&#22810;&#23569;&#20010;inode</span>
-I                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#20010;inode&#35760;&#24405;&#21344;&#29992;&#30340;&#30913;&#30424;&#31354;&#38388;&#22823;&#23567;&#65292;128---4096</span>
-m                                <span style="color: #b22222;"># </span><span style="color: #b22222;">&#40664;&#35748;5%,&#20026;&#31649;&#29702;&#20154;&#21592;&#39044;&#30041;&#31354;&#38388;&#21344;&#24635;&#31354;&#38388;&#30340;&#30334;&#20998;&#27604;&#65292;&#30913;&#30424;&#28385;&#20102;&#21487;&#25805;&#20316;&#31354;&#38388;&#22823;&#23567;&#12290;&#30334;&#20998;&#27604;&#25968;&#20540;&#65307;#=1,2,3...100 &#23545;&#20110;&#22823;&#30913;&#30424;&#26469;&#35828;&#39044;&#30041;5%&#32473;&#36229;&#32423;&#31649;&#29702;&#21592;&#22810;&#20102;&#12290;</span>
-O FEATURE[,...]          <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#29992;&#25351;&#23450;&#29305;&#24615;</span>
-O ^FEATURE             <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20851;&#38381;&#25351;&#23450;&#29305;&#24615;  &#8211;O ^has_journal &#34920;&#31034;&#21435;&#38500;&#26085;&#24535;&#21151;&#33021;</span>
-n                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27169;&#25311;&#36816;&#34892;&#65292;&#20294;&#19981;&#26684;&#24335;&#21270;</span>
</pre>
</div>

<p>
èŒƒä¾‹ï¼š åˆ›å»ºext4æ–‡ä»¶ç³»ç»Ÿ
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;ext4</span>
[root@node01 ~]# mkfs.ext4 /dev/sdb5
mke2fs 1.42.9 (28-Dec-2013)
Filesystem <span style="color: #a0522d;">label</span>=                                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25991;&#20214;&#31995;&#32479;&#21367;&#26631;&#65292;&#36825;&#37324;&#27809;&#25351;&#23450;</span>
OS type: Linux                                                             <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25805;&#20316;&#31995;&#32479;</span>
Block <span style="color: #a0522d;">size</span>=4096 (<span style="color: #a0522d;">log</span>=2)                                             <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22359;&#22823;&#23567;&#65292;&#40664;&#35748;&#20026; 4k</span>
Fragment <span style="color: #a0522d;">size</span>=4096 (<span style="color: #a0522d;">log</span>=2)                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20998;&#22359;&#22823;&#23567;&#65292;&#40664;&#35748;&#20026; 4k</span>
<span style="color: #a0522d;">Stride</span>=0 blocks, Stripe <span style="color: #a0522d;">width</span>=0 blocks
131072 inodes, 524288 blocks                                   <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19968;&#20849;&#21019;&#24314;&#22810;&#23569; inode &#21644; block</span>
26214 blocks (5.00%) reserved for the super user     <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312;block &#30913;&#30424;&#22359;&#20013;&#39044;&#30041;&#22810;&#23569;&#32473; &#36229;&#32423;&#31649;&#29702;&#21592;&#12290;&#23545;&#20110;&#22823;&#30913;&#30424;&#26469;&#35828;&#39044;&#30041;5%&#22810;&#20102;&#12290;</span>
First data <span style="color: #a0522d;">block</span>=0                                                       <span style="color: #b22222;"># </span><span style="color: #b22222;">&#31532; 1 &#20010;&#30913;&#30424;&#22359;&#30340;&#32534;&#21495;&#20174; 0 &#24320;&#22987;</span>
Maximum filesystem <span style="color: #a0522d;">blocks</span>=536870912                   <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26368;&#22823;&#30913;&#30424;&#22359;&#32534;&#21495;</span>
16 block groups                                                          <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30913;&#30424;&#22359;&#32452;&#20010;&#25968;</span>
32768 blocks per group, 32768 fragments per group      <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#20010;&#22359;&#32452;&#20869;&#22810;&#23569;&#22359;</span>
8192 inodes per group                                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#20010;&#32452;&#20869;&#26377;&#22810;&#23569; inode</span>
Superblock backups stored on blocks:                              <span style="color: #b22222;"># </span><span style="color: #b22222;">superblock &#34987;&#20998;&#22312;&#21738;&#20123;&#22359;&#19978;&#20102;&#65292;&#27599;&#20010;&#22359;&#30340;&#32534;&#21495;</span>
    32768, 98304, 163840, 229376, 294912

Allocating group tables: done                            
Writing inode tables: done                                          <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#22312;&#20889;&#20837; inode &#34920;</span>
Creating journal (16384 blocks): done                         <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#26085;&#24535;&#21151;&#33021;</span>
Writing superblocks and filesystem accounting information: done

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#25991;&#20214;&#31995;&#32479;&#30340; TYPE &#31867;&#22411;</span>
[root@node01 ~]# blkid /dev/sdb5

/dev/sdb5: <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"66d93d3e-0141-4147-ac2c-59fc811a089d"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"ext4"</span> <span style="color: #a0522d;">BLOCK_SIZE</span>=<span style="color: #8b2252;">"4096"</span>
UUID &#20840;&#21306;&#21807;&#19968;&#26631;&#35782;&#31526;
TYPE &#25991;&#20214;&#31995;&#32479;&#31867;&#22411;
BLOCK_SIZE &#25991;&#20214;&#31995;&#32479;&#23384;&#25918;&#25968;&#25454;&#26368;&#23567;&#21333;&#20301;&#12290;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;ext4&#29366;&#24577;&#21644;&#20803;&#25968;&#25454;</span>
tune2fs -l /dev/sdb5

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;&#25991;&#20214;&#31995;&#32479;&#25351;&#26126;&#21367;&#26631;</span>
[root@node01 ~]# mkfs.ext4 -L MYDATA -b 1024 /dev/sdb5
[root@node01 ~]# blkid /dev/sdb5
/dev/sdb5: <span style="color: #a0522d;">LABEL</span>=<span style="color: #8b2252;">"MYDATA"</span> <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"2d6d8919-1079-4235-923f-33d655b760f2"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"ext4"</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;&#24102;&#26085;&#24535;&#30340;&#25991;&#20214;&#31995;&#32479;&#65292;&#40664;&#35748;ext3&#25991;&#20214;&#31995;&#32479;</span>
[root@node01 ~]# mke2fs -O has_journal  /dev/sdb5
[root@node01 ~]# blkid /dev/sdb5
/dev/sdb5: <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"c86bb335-6ea4-4fe6-bf4a-dfae0e9ab3eb"</span> <span style="color: #a0522d;">SEC_TYPE</span>=<span style="color: #8b2252;">"ext2"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"ext3"</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21462;&#28040;&#26085;&#24535;&#29305;&#24615;</span>
[root@node01 ~]# mke2fs -O ^has_journal  /dev/sdb5
[root@node01 ~]# blkid /dev/sdb5
/dev/sdb5: <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"6bb9e6e1-0445-4487-9a12-dd1d3e70c045"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"ext2"</span>
</pre>
</div>

<p>
<b>æ ¼å¼åŒ–å¤§å®¹é‡ç£ç›˜</b>
</p>

<p>
æ ¼å¼åŒ–å¤§å®¹é‡ç£ç›˜ï¼Œç³»ç»Ÿä¼šåˆ†é…è¿‡å¤šinodeï¼Œä¸ºinodeé¢„ç•™è¿‡å¤šç©ºé—´ï¼Œå¯¼è‡´ç£ç›˜ç©º
é—´å ç”¨ç‰¹åˆ«å¤§ã€‚
</p>

<p>
å¯ä»¥å‡å°inodeå ç”¨çš„ç£ç›˜ç©ºé—´ï¼Œå‡å°‘ç£ç›˜æµªè´¹
</p>

<p>
ç£ç›˜æ ¼å¼åŒ–åinodeå ç”¨çš„ç£ç›˜ç©ºé—´ï¼šnodeæ•°é‡ * æ¯ä¸ªinodeå ç”¨çš„ç©ºé—´ 256b
/1024 æ¢ç®—ä¸ºkb /1024 æ¢ç®—ä¸º mb
</p>

<p>
é»˜è®¤2TBç£ç›˜inodeå ç”¨ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">mkfs.ext4 -n /dev/sdc1
122101760 inodes, 488378368 blocks

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36890;&#36807;&#20197;&#19978;&#20449;&#24687;&#21487;&#20197;&#35745;&#31639;&#20986;&#30913;&#30424;&#26684;&#24335;&#21270;&#21518;inode&#21344;&#29992;&#30340;&#30913;&#30424;&#31354;&#38388;</span>
122101760 * 256 / 1024 / <span style="color: #a0522d;">1024</span> = 29810mb
</pre>
</div>

<p>
å¢å¤§ <code>-i</code> å‚æ•°ï¼Œä¸ºæ•°æ®ç©ºé—´ä¸­æ¯å¤šå°‘ä¸ªå­—èŠ‚åˆ›å»ºä¸€ä¸ªinodeï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450;1m&#31354;&#38388;&#20998;&#37197;&#19968;&#20010;inode&#26469;&#26684;&#24335;&#21270;2TB&#30913;&#30424;</span>
mkfs.ext4 -i 1048576 -n /dev/sdc
1907840 inodes, 488378368 blocks
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#36807;&#20197;&#19978;&#20449;&#24687;&#21487;&#20197;&#35745;&#31639;&#20986;&#30913;&#30424;&#26684;&#24335;&#21270;&#21518;inode&#21344;&#29992;&#30340;&#30913;&#30424;&#31354;&#38388;</span>
1907840 * 256 / 1024 / <span style="color: #a0522d;">1024</span> = 465mb 
&#26356;&#25913;-i&#21442;&#25968;&#65292;&#33410;&#30465;&#20102;29G&#31354;&#38388;
</pre>
</div>

<p>
é™¤äº†æ›´æ”¹-iå‚åŠ ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡-Tå‚æ•°ç›´æ¥æŒ‡å®šå¤šå¤§ç£ç›˜ç©ºé—´åˆ†é…ä¸€ä¸ªinode
</p>

<div class="org-src-container">
<pre class="src src-sh">mkfs.ext4 -T largefile -n /dev/sdc1 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20960;&#20046;&#22312;&#20960;&#20998;&#38047;&#23436;&#25104;&#24555;&#36895;&#26684;&#24335;&#21270;</span>
mkfs.ext4 -T largefile4 -n /dev/sdc1
</pre>
</div>

<p>
largefileå’Œlargefile4å¯¹åº”çš„ã€å¤šå¤§ç£ç›˜ç©ºé—´åˆ†é…ä¸€ä¸ªinodeã€‘å…¶å®æ˜¯åœ¨
/etc/mke2fs.conf å®šä¹‰çš„ã€‚
</p>

<ul class="org-ul">
<li>largefile ç±»å‹å°±æ˜¯ 1M ä¸€ä¸ª inode</li>
<li>largefile4 ç±»å‹å°±æ˜¯ 4M ä¸€ä¸ª inode</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">mkfs.ext4 -N 314572800 -T largefile /dev/xvdb1
</pre>
</div>

<p>
å› ä¸ºext4æ— æ³•åŠ¨æ€è°ƒæ•´inodeç©ºé—´å æ¯”ï¼Œæ‰€ä»¥é€‰æ‹©å°†ext4æ”¹ä¸ºxfs(æ”¯æŒåŠ¨æ€è°ƒæ•´
inodeç©ºé—´å æ¯”)
</p>

<p>
xfsç¡¬ç›˜æ ¼å¼inodeç©ºé—´å æ¯”(é»˜è®¤ä¸º5%)
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">xfs&#25991;&#20214;&#31995;&#32479;&#21160;&#24577;&#25193;&#23481;inode&#31354;&#38388;&#21344;&#27604;&#20026;10%</span>
xfs_growfs -m 10 /minio
</pre>
</div>
</div>
</div>
<div id="outline-container-h:12595ccb-f7d7-4028-92c1-5727c5d29a85" class="outline-5">
<h5 id="h:12595ccb-f7d7-4028-92c1-5727c5d29a85">æŸ¥çœ‹å’Œç®¡ç†åˆ†åŒºä¿¡æ¯</h5>
<div class="outline-text-5" id="text-h:12595ccb-f7d7-4028-92c1-5727c5d29a85">
<p>
blkid å¯ä»¥æŸ¥çœ‹å—è®¾å¤‡å±æ€§ä¿¡æ¯ æ ¼å¼ï¼š
</p>
<div class="org-src-container">
<pre class="src src-sh">blkid [OPTION]... [DEVICE]

&#24120;&#29992;&#36873;&#39033;&#65306;
- -U UUID   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26681;&#25454;&#25351;&#23450;&#30340;UUID&#26469;&#26597;&#25214;&#23545;&#24212;&#30340;&#35774;&#22791;</span>
- -L LABEL  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26681;&#25454;&#25351;&#23450;&#30340;LABEL&#26469;&#26597;&#25214;&#23545;&#24212;&#30340;&#35774;&#22791; &#33539;&#20363;</span>
</pre>
</div>

<p>
èŒƒä¾‹ï¼š
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@node01 ~]# blkid
/dev/sda1: <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"740f2026-5852-4f08-ba89-03a41da96641"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"xfs"</span>
/dev/sda2: <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"kX2LpD-lIl1-sU1x-adD3-ZZDB-S0xt-uhNESv"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"LVM2_member"</span>
/dev/sr0: <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"2017-09-06-10-53-42-00"</span> <span style="color: #a0522d;">LABEL</span>=<span style="color: #8b2252;">"CentOS 7 x86_64"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"iso9660"</span> <span style="color: #a0522d;">PTTYPE</span>=<span style="color: #8b2252;">"dos"</span>
/dev/mapper/centos-root: <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"00d2160a-c185-4a69-b5d0-3616bc34bdac"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"xfs"</span>
/dev/mapper/centos-swap: <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"d99a0da9-3302-46cb-905a-79c12134ee70"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"swap"</span>
</pre>
</div>

<p>
e2labelï¼šç®¡ç†extç³»åˆ—æ–‡ä»¶ç³»ç»Ÿçš„LABEL
</p>
<div class="org-src-container">
<pre class="src src-sh">e2label DEVICE [LABEL]
</pre>
</div>

<p>
findfs ï¼šæŸ¥æ‰¾åˆ†åŒº
</p>
<div class="org-src-container">
<pre class="src src-sh">findfs [options] <span style="color: #a0522d;">LABEL</span>=&lt;label&gt;
findfs [options] <span style="color: #a0522d;">UUID</span>=&lt;uuid&gt;
</pre>
</div>

<p>
èŒƒä¾‹ï¼š
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#findfs <span style="color: #a0522d;">UUID</span>=f7f53add-b184-4ddc-8d2c-5263b84d1e15
/dev/sda2
</pre>
</div>

<p>
tune2fsï¼šé‡æ–°è®¾å®šextç³»åˆ—æ–‡ä»¶ç³»ç»Ÿå¯è°ƒæ•´å‚æ•°çš„å€¼
</p>
<div class="org-src-container">
<pre class="src src-sh">-l                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#25351;&#23450;&#25991;&#20214;&#31995;&#32479;&#36229;&#32423;&#22359;&#20449;&#24687;&#65307;super block</span>
-L <span style="color: #8b2252;">'LABEL'</span>  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#21367;&#26631;</span>
-m              <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#39044;&#30041;&#32473;&#31649;&#29702;&#21592;&#30340;&#31354;&#38388;&#30334;&#20998;&#27604;</span>
-j                <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;ext2&#21319;&#32423;&#20026;ext3</span>
-O              <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25991;&#20214;&#31995;&#32479;&#23646;&#24615;&#21551;&#29992;&#25110;&#31105;&#29992;, &#8211;O ^has_journal</span>
-o               <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35843;&#25972;&#25991;&#20214;&#31995;&#32479;&#30340;&#40664;&#35748;&#25346;&#36733;&#36873;&#39033;&#65292;&#8211;o ^acl</span>
-U UUID    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;UUID&#21495;</span>
</pre>
</div>

<p>
èŒƒä¾‹ï¼štune2fs -l device ï¼šæŸ¥çœ‹è¶…çº§å—çš„å†…å®¹
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@node01 ~]# tune2fs -l /dev/sdb5
tune2fs 1.42.9 (28-Dec-2013)
Filesystem volume name:   HAHAH                                    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21367;&#26631;</span>
Last mounted on:          &lt;not available&gt;                            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19978;&#27425;&#20160;&#20040;&#26102;&#20505;&#25346;&#36733;&#12290; not available&#20026;&#19981;&#21487;&#29992;&#27809;&#25346;&#36733;&#36807;</span>
Filesystem UUID:          51f52968-de90-4595-a050-52d325f1805c     <span style="color: #b22222;"># </span><span style="color: #b22222;">UUID&#20840;&#21306;&#21807;&#19968;&#26631;&#35782;&#31526;</span>
Filesystem magic number:  0xEF53                                   <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25991;&#20214;&#31995;&#32479;&#30340;&#39764;&#25968;&#65307;&#25991;&#20214;&#31995;&#32479;&#19987;&#29992;&#30340;&#26631;&#35782;</span>
Filesystem revision <span style="color: #b22222;">#</span><span style="color: #b22222;">:    1 (dynamic)  </span>
Filesystem features:      ext_attr resize_inode dir_index filetype sparse_super large_file   <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24050;&#32463;&#21551;&#29992;&#29305;&#24615; &#12290;&#20351;&#29992; tune2fs -O [^]feature[,...]  &#24320;&#21551;&#25110;&#20851;&#38381;&#26576;&#31181;&#29305;&#24615;</span>
Filesystem flags:         signed_directory_hash                    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26631;&#24535;</span>
Default mount options:    user_xattr acl                           <span style="color: #b22222;"># </span><span style="color: #b22222;">&#40664;&#35748;&#30340;&#25346;&#36733;&#36873;&#39033;&#65307;tune2fs -o [^]mount-option[,...] &#65306;&#24320;&#21551;&#25110;&#20851;&#38381;&#26576;&#31181;&#40664;&#35748;&#25346;&#36733;&#36873;&#39033;&#65307;</span>
Filesystem state:         clean                                              <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25991;&#20214;&#31995;&#32479;&#29366;&#24577;&#65307;clean &#34920;&#31034;&#19968;&#33268;&#29366;&#24577;&#21363;&#27809;&#26377;&#25991;&#20214;&#22788;&#20110;&#25439;&#22351;&#29366;&#24577;&#12290;dirty &#19981;&#24178;&#20928;&#19981;&#19968;&#33268;&#29366;&#24577;</span>
Errors behavior:          Continue                                       <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20986;&#29616;&#38169;&#35823;&#24590;&#20040;&#21150;&#65311;continue &#32487;&#32493;&#19981;&#31649;&#23427;</span>
Filesystem OS type:       Linux     
Inode count:              131072                                           <span style="color: #b22222;">#  </span><span style="color: #b22222;">inode &#25968;&#37327;</span>
Block count:              524288                                          <span style="color: #b22222;"># </span><span style="color: #b22222;">block &#25968;&#37327;</span>
Reserved block count:     26214                                    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#39044;&#30041; block &#25968;&#37327;</span>
Free blocks:              515284                                         <span style="color: #b22222;"># </span><span style="color: #b22222;">&#31354;&#38386;&#22359;&#25968;</span>
Free inodes:              131061                                         <span style="color: #b22222;"># </span><span style="color: #b22222;">&#31354;&#38386; inode &#25968;</span>
First block:              0                                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">&#31532; 1 &#20010;&#22359;&#32534;&#21495;</span>
Block size:               4096                                               <span style="color: #b22222;">#  </span><span style="color: #b22222;">&#22359;&#22823;&#23567; </span>
Fragment size:            4096                                           <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20559;&#31227;&#65292;&#29255;&#26029;&#22823;&#23567;</span>
Reserved GDT blocks:      127                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">&#39044;&#30041;&#32473; GDT &#22359;&#32452;&#25551;&#36848;&#31526;&#30340;&#22823;&#23567;</span>
Blocks per group:         32768                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#32452;&#22810;&#23569;&#22359;</span>
Fragments per group:      32768                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#32452;&#22810;&#23569;&#29255;&#26029;</span>
Inodes per group:         8192                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#32452;&#22810;&#23569; inode</span>
Inode blocks per group:   512                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#32452;&#26377;&#22810;&#23569;&#20010;&#22359;&#26159;&#25918; inode</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">tune2fs -j device &#26080;&#25439;&#21319;&#32423;&#25991;&#20214;&#31995;&#32479;</span>
mke2fs /dev/sdb5 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314; ext2 &#25991;&#20214;&#31995;&#32479;</span>
[root@node01 ~]# blkid /dev/sdb5
/dev/sdb5: <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"7a56c6bd-340c-4247-8ed8-37bb33cf0c36"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"ext2"</span>
[root@node01 ~]# tune2fs -j /dev/sdb5 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21319;&#32423;&#21040; ext3 &#25991;&#20214;&#31995;&#32479;</span>
Creating journal inode: done
[root@node01 ~]# blkid /dev/sdb5
/dev/sdb5: <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"7a56c6bd-340c-4247-8ed8-37bb33cf0c36"</span> <span style="color: #a0522d;">SEC_TYPE</span>=<span style="color: #8b2252;">"ext2"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"ext3</span>

<span style="color: #8b2252;"># tune2fs -m num &#35843;&#25972;&#39044;&#30041;&#32473;&#36229;&#32423;&#31649;&#29702;&#21592;&#30340;&#31354;&#38388;&#30334;&#20998;&#27604;&#12290;&#20174; 5% -&gt; 2%</span>
<span style="color: #8b2252;">[root@node01 ~]# tune2fs -l /dev/sdb5 |grep "</span>Reserved block count<span style="color: #8b2252;">"</span>
<span style="color: #8b2252;">Reserved block count:     26214</span>
<span style="color: #8b2252;">[root@node01 ~]# tune2fs -m 2 /dev/sdb5</span>

<span style="color: #8b2252;">Setting reserved blocks percentage to 2% (10485 blocks)</span>
<span style="color: #8b2252;">[root@node01 ~]# tune2fs -l /dev/sdb5 |grep "</span>Reserved block count<span style="color: #8b2252;">"</span>
<span style="color: #8b2252;">Reserved block count:     10485</span>

<span style="color: #8b2252;"># tune2fs -O ^has_journal &#20851;&#38381;&#25991;&#20214;&#31995;&#32479;&#26085;&#24535;&#29305;&#24615;</span>
<span style="color: #8b2252;">tune2fs -O ^has_journal /dev/sdb5</span>

<span style="color: #8b2252;"># tune2fs -o ^acl &#20851;&#38381;&#40664;&#35748;&#25346;&#36733;&#39033; acl </span>
<span style="color: #8b2252;">tune2fs -o ^acl /dev/sdb5</span>
</pre>
</div>

<p>
dumpe2fsï¼šæ˜¾ç¤ºextæ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ï¼Œå°†ç£ç›˜å—åˆ†ç»„ç®¡ç†
</p>

<div class="org-src-container">
<pre class="src src-shell">-h     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#36229;&#32423;&#22359;&#20449;&#24687;&#65292;&#19981;&#26174;&#31034;&#20998;&#32452;&#20449;&#24687;</span>
</pre>
</div>

<p>
èŒƒä¾‹ï¼šæŸ¥çœ‹extæ–‡ä»¶ç³»ç»Ÿçš„å…ƒæ•°æ®å’Œå—ç»„ä¿¡æ¯
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#dumpe2fs /dev/sda1
dumpe2fs 1.44.6 (5-Mar-2019)
Filesystem volume name:  &lt;none&gt;
Last mounted on:     /boot
Filesystem UUID:     5c2216e3-ae34-444e-aa60-83cbaebb47e7
Filesystem magic number: 0xEF53
Filesystem revision <span style="color: #b22222;">#</span><span style="color: #b22222;">:  1 (dynamic)</span>
Filesystem features:   has_journal ext_attr resize_inode dir_index filetype
needs_recovery extent 64bit flex_bg sparse_super large_file huge_file dir_nlink
extra_isize metadata_csum
Filesystem flags:     signed_directory_hash
Default mount options:  user_xattr acl
Filesystem state:     clean
Errors behavior:     Continue
Filesystem OS type:    Linux
Inode count:       65536
Block count:       262144
Reserved block count:   13107  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#39044;&#30041;&#31354;&#38388;&#22823;&#23567;</span>
Free blocks:       217118
Free inodes:       65227
First block:       0
Block size:        4096
Fragment size:      4096
Group descriptor size:  64
Reserved GDT blocks:   127
Blocks per group:     32768
Fragments per group:   32768
Inodes per group:     8192
Inode blocks per group:  512
Flex block group size:  16
Filesystem created:    Thu Jan 16 10:39:10 2020
Last mount time:     Mon Apr 13 12:03:10 2020
Last write time:     Mon Apr 13 12:03:10 2020
Mount count:       6
Maximum mount count:   -1
Last checked:       Thu Jan 16 10:39:10 2020
Check interval:      0 (&lt;none&gt;)
Lifetime writes:     236 MB
Reserved blocks uid:   0 (user root)
Reserved blocks gid:   0 (group root)
First inode:       11
Inode size:     256
Required extra isize:   32
Desired extra isize:   32
Journal inode:      8
Default directory hash:  half_md4
Directory Hash Seed:   5737d3fe-91ce-4cf3-bb5b-125ea41dd70f
Journal backup:      inode blocks
Checksum type:      crc32c
Checksum:         0x66531756
Journal features:     journal_incompat_revoke journal_64bit
journal_checksum_v3
Journal size:       32M
Journal length:      8192
Journal sequence:     0x00000150
Journal start:      1
Journal checksum type:  crc32c
Journal checksum:     0x96f6d31c
Group 0: (Blocks 0-32767)
  Primary superblock at 0, Group descriptors at 1-1        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20027;&#36229;&#32423;&#22359;&#22312; 0 &#32452;&#30340; 0 &#22359;&#19978;&#65292;GDT at 1-1</span>
  Reserved GDT blocks at 2-128                             <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20026; GDT &#39044;&#30041;&#30340;&#22359;&#22312; 2-128</span>
  Block bitmap at 129 (+129), Inode bitmap at 130 (+130)   <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22359;&#20301;&#22270;&#22312; 129&#65292;inode &#20301;&#22270;&#22312; 130</span>
  Inode table at 131-642 (+131)                            <span style="color: #b22222;"># </span><span style="color: #b22222;">inode &#34920;&#22312; 131</span>
  32119 free blocks, 8181 free inodes, 2 directories       <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21097;&#20313;&#30340;&#31354;&#38388; block , inode</span>
  Free blocks: 649-32767                                   <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#29992;&#22359;&#25968;&#12290;&#22914;&#26524;&#20986;&#29616;&#31163;&#25955;&#25968;&#65292;&#35828;&#26126;&#22359;&#20013;&#26377;&#30862;&#29255;&#12290;</span>
  Free inodes: 12-8192                                     <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#29992; inode &#25968;</span>
Group 1: (Blocks 32768-65535)
  Backup superblock at 32768, Group descriptors at 32769-32769
  Reserved GDT blocks at 32770-32896
  Block bitmap at 32897 (+129), Inode bitmap at 32898 (+130)
  Inode table at 32899-33410 (+131)
  32125 free blocks, 8192 free inodes, 0 directories
  Free blocks: 33411-65535
  Free inodes: 8193-16384

... ... 
</pre>
</div>

<p>
xfs_infoï¼šæ˜¾ç¤ºç¤ºæŒ‚è½½æˆ–å·²æŒ‚è½½çš„ xfs æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯
</p>

<div class="org-src-container">
<pre class="src src-sh">xfs_info mountpoint|devname
</pre>
</div>

<p>
èŒƒä¾‹:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">xfs_info /dev/vda1</span>
meta-data=/dev/vda1              <span style="color: #a0522d;">isize</span>=512    <span style="color: #a0522d;">agcount</span>=4, <span style="color: #a0522d;">agsize</span>=13107136 blks
         =                       <span style="color: #a0522d;">sectsz</span>=512   <span style="color: #a0522d;">attr</span>=2, <span style="color: #a0522d;">projid32bit</span>=1
         =                       <span style="color: #a0522d;">crc</span>=1        <span style="color: #a0522d;">finobt</span>=0 <span style="color: #a0522d;">spinodes</span>=0
<span style="color: #a0522d;">data</span>     =                       <span style="color: #a0522d;">bsize</span>=4096   <span style="color: #a0522d;">blocks</span>=52428544, <span style="color: #a0522d;">imaxpct</span>=25
         =                       <span style="color: #a0522d;">sunit</span>=0      <span style="color: #a0522d;">swidth</span>=0 blks
<span style="color: #a0522d;">naming</span>   =version 2              <span style="color: #a0522d;">bsize</span>=4096   ascii-ci=0 <span style="color: #a0522d;">ftype</span>=1
<span style="color: #a0522d;">log</span>      =internal               <span style="color: #a0522d;">bsize</span>=4096   <span style="color: #a0522d;">blocks</span>=25599, <span style="color: #a0522d;">version</span>=2
         =                       <span style="color: #a0522d;">sectsz</span>=512   <span style="color: #a0522d;">sunit</span>=0 blks, lazy-count=1
<span style="color: #a0522d;">realtime</span> =none                   <span style="color: #a0522d;">extsz</span>=4096   <span style="color: #a0522d;">blocks</span>=0, <span style="color: #a0522d;">rtextents</span>=0
</pre>
</div>

<p>
<b>è¶…çº§å—å’ŒINODE TABLE</b>
</p>


<figure id="org2b9e292">
<img src="images/image-20210216020912193.png" alt="image-20210216020912193.png" width="60%">

</figure>

<p>
<b>å—ç»„æè¿°ç¬¦è¡¨(GDT)</b>
</p>

<p>
extæ–‡ä»¶ç³»ç»Ÿæ¯ä¸€ä¸ªå—ç»„ä¿¡æ¯ä½¿ç”¨32å­—èŠ‚æè¿°ï¼Œè¿™32ä¸ªå­—èŠ‚ç§°ä¸ºå—ç»„æè¿°ç¬¦ï¼Œæ‰€
æœ‰å—ç»„çš„å—ç»„æè¿°ç¬¦ç»„æˆå—ç»„æè¿°ç¬¦è¡¨GDT(group descriptor table)ã€‚è™½ç„¶æ¯
ä¸ªå—ç»„éƒ½éœ€è¦å—ç»„æè¿°ç¬¦æ¥è®°å½•å—ç»„çš„ä¿¡æ¯å’Œå±æ€§å…ƒæ•°æ®ï¼Œä½†æ˜¯ä¸æ˜¯æ¯ä¸ªå—ç»„ä¸­
éƒ½å­˜æ”¾äº†å—ç»„æè¿°ç¬¦ã€‚å°†æ‰€æœ‰å—ç»„çš„å—ç»„ä¿¡æ¯ç»„æˆä¸€ä¸ªGDTä¿å­˜,å¹¶å°†è¯¥GDTå­˜æ”¾
äºæŸäº›å—ç»„ä¸­ï¼Œç±»ä¼¼å­˜æ”¾superblockå’Œå¤‡ä»½superblockçš„å—
</p>
</div>
</div>
<div id="outline-container-h:88f74429-ec9a-4d55-845b-749c4862fc93" class="outline-5">
<h5 id="h:88f74429-ec9a-4d55-845b-749c4862fc93">æ–‡ä»¶ç³»ç»Ÿæ£€æµ‹å’Œä¿®å¤</h5>
<div class="outline-text-5" id="text-h:88f74429-ec9a-4d55-845b-749c4862fc93">
<p>
æ–‡ä»¶ç³»ç»Ÿå¤¹æ•…éšœå¸¸å‘ç”Ÿäºæ­»æœºæˆ–è€…éæ­£å¸¸å…³æœºä¹‹åï¼ŒæŒ‚è½½ä¸ºæ–‡ä»¶ç³»ç»Ÿæ ‡è®°ä¸ºâ€no cleanâ€
</p>

<p>
<b>æ³¨æ„ï¼šä¸€å®šä¸è¦åœ¨æŒ‚è½½çŠ¶æ€ä¸‹æ‰§è¡Œä¸‹é¢å‘½ä»¤ä¿®å¤</b>
</p>

<p>
fsck: File System Check
</p>

<div class="org-src-container">
<pre class="src src-sh">fsck.FS_TYPE
fsck -t FS_TYPE
</pre>
</div>

<p>
æ³¨æ„ï¼šFS_TYPE ä¸€å®šè¦ä¸åˆ†åŒºä¸Šå·²ç»æ–‡ä»¶ç±»å‹ç›¸åŒ
</p>

<p>
å¸¸ç”¨é€‰é¡¹ï¼š
</p>
<div class="org-src-container">
<pre class="src src-sh">-a &#33258;&#21160;&#20462;&#22797; ;&#19981;&#24314;&#35758;&#29992;&#65307;&#20250;&#23558;&#30862;&#29255;&#25991;&#20214;&#21024;&#38500;
-r &#20132;&#20114;&#24335;&#20462;&#22797;&#38169;&#35823;
-f : &#24378;&#21046;&#26816;&#27979;
</pre>
</div>

<p>
e2fsckï¼šextç³»åˆ—æ–‡ä»¶ä¸“ç”¨çš„æ£€æµ‹ä¿®å¤å·¥å…·
</p>

<div class="org-src-container">
<pre class="src src-sh">-y &#33258;&#21160;&#22238;&#31572;&#20026;yes
-f &#24378;&#21046;&#20462;&#22797;
-p &#33258;&#21160;&#36827;&#34892;&#23433;&#20840;&#30340;&#20462;&#22797;&#25991;&#20214;&#31995;&#32479;&#38382;&#39064;
</pre>
</div>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">&#22914;&#65292;&#24378;&#21046;&#26816;&#27979;&#25991;&#20214;&#31995;&#32479;
[root@node01 ~]# e2fsck -f /dev/sdb5
e2fsck 1.42.9 (28-Dec-2013)
Pass 1: Checking inodes, blocks, and sizes  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26816;&#26597; inode, &#22359;&#21644;&#22823;&#23567;</span>
Pass 2: Checking directory structure            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26816;&#26597;&#30446;&#24405;&#32467;&#26500;</span>
Pass 3: Checking directory connectivity       <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26816;&#26597;&#30446;&#24405;&#36830;&#25509;&#24615;</span>
Pass 4: Checking reference counts                <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26816;&#26597;&#24341;&#29992;&#35745;&#25968;</span>
Pass 5: Checking group summary information  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26816;&#26597;&#31751;&#27010;&#35201;&#20449;&#24687;</span>
/dev/sdb5: 11/131072 files (0.0% non-contiguous), 9004/524288 blocks
</pre>
</div>

<p>
xfs_repairï¼šxfsæ–‡ä»¶ç³»ç»Ÿä¸“ç”¨æ£€æµ‹ä¿®å¤å·¥å…· å¸¸ç”¨é€‰é¡¹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">-f &#20462;&#22797;&#25991;&#20214;&#65292;&#32780;&#35774;&#22791;
-n &#21482;&#26816;&#26597;
-d &#20801;&#35768;&#20462;&#22797;&#21482;&#35835;&#30340;&#25346;&#36733;&#35774;&#22791;&#65292;&#22312;&#21333;&#29992;&#25143;&#19979;&#65288; init 1&#65289;&#20462;&#22797; / &#26102;&#20351;&#29992;&#65292;&#28982;&#21518;&#31435;&#21363;reboot
&#27880;&#24847;&#65306;xfs_repair &#21487;&#20197;&#26816;&#26597;/&#20462;&#22797;&#25991;&#20214;&#31995;&#32479;&#65292;&#19981;&#36807;&#65292;&#22240;&#20026;&#20462;&#22797;&#25991;&#20214;&#31995;&#32479;&#26159;&#20010;&#24456;&#24222;&#22823;&#30340;&#20219;&#21153;&#65281;&#22240;&#27492;&#65292;&#20462;&#22797;&#26102;&#35813;&#25991;&#20214;&#31995;&#32479;&#19981;&#33021;&#34987;&#25346;&#36733;&#65281;
</pre>
</div>

<p>
èŒƒä¾‹ï¼šä¿®æ”¹ç ´åçš„extæ–‡ä»¶ç³»ç»Ÿ
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#mount /dev/sdb2 /mnt
[root@centos8 ~]#cp /etc/fstab /mnt/f1
[root@centos8 ~]#cp /etc/fstab /mnt/f2
[root@centos8 ~]#ls /mnt
f1 f2 lost+found

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#30772;&#22351;ext&#25991;&#20214;&#31995;&#32479;, &#30772;&#22351;&#20803;&#25968;&#25454;</span>
[root@centos8 ~]#dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/dev/sdb2 <span style="color: #a0522d;">bs</span>=1M <span style="color: #a0522d;">count</span>=1
[root@centos8 ~]#ls /mnt
[root@centos8 ~]#tune2fs -l /dev/sdb2
tune2fs 1.44.6 (5-Mar-2019)
tune2fs: Bad magic number<span style="color: #a020f0;"> in</span> super-block while trying to open /dev/sdb2
[root@centos8 ~]#df  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22823;&#23567;&#19981;&#27491;&#24120;&#20102;</span>
Filesystem        1K-blocks         Used Available Use% Mounted on
/dev/sdb2    73786976294838107984 73786976294836115464  1976136 100% /mnt

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#22797;</span>
[root@centos8 ~]#umount /mnt
[root@centos8 ~]#e2fsck /dev/sdb2 -y  <span style="color: #b22222;"># </span><span style="color: #b22222;">fsck /dev/sdb2 -y &#20462;&#22797;&#25991;&#20214;&#31995;&#32479;&#30340;&#20803;&#25968;&#25454;&#65292;&#36229;&#32423;&#22359;&#12290; &#33021;&#19981;&#33021;&#25214;&#22238;&#25968;&#25454;&#23601;&#30475;&#36816;&#27668;&#20102;</span>
e2fsck 1.44.6 (5-Mar-2019)
test was not cleanly unmounted, check forced.
Pass 1: Checking inodes, blocks, and sizes
Pass 2: Checking directory structure
Pass 3: Checking directory connectivity
Pass 4: Checking reference counts
Pass 5: Checking group summary information
Free blocks count wrong for group <span style="color: #b22222;">#</span><span style="color: #b22222;">0 (24280, counted=24281).</span>
Fix? yes
Free blocks count wrong for group <span style="color: #b22222;">#</span><span style="color: #b22222;">1 (32511, counted=32509).</span>
Fix? yes
Free blocks count wrong (498131, <span style="color: #a0522d;">counted</span>=498130).
Fix? yes
Free inodes count wrong for group <span style="color: #b22222;">#</span><span style="color: #b22222;">0 (8181, counted=8179).</span>
Fix? yes
Free inodes count wrong (131061, <span style="color: #a0522d;">counted</span>=131059).
Fix? yes
Padding at end of inode bitmap is not set. Fix? yes
test: ***** FILE SYSTEM WAS MODIFIED *****
test: 13/131072 files (0.0% non-contiguous), 26158/524288 blocks

[root@centos8 ~]#tune2fs -l /dev/sdb2
tune2fs 1.44.6 (5-Mar-2019)
Filesystem volume name:  test
Last mounted on:     &lt;not available&gt;
... ...
[root@centos8 ~]#mount /dev/sdb2 /mnt
[root@centos8 ~]#ls /mnt
f1 f2 lost+found
[root@centos8 ~]#cat /mnt/f1
... ...
[root@centos8 ~]#
</pre>
</div>
</div>
</div>
<div id="outline-container-h:57ed1dd5-4d08-4513-9d77-0af1ec131ea9" class="outline-5">
<h5 id="h:57ed1dd5-4d08-4513-9d77-0af1ec131ea9">æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶æ¢å¤</h5>
<div class="outline-text-5" id="text-h:57ed1dd5-4d08-4513-9d77-0af1ec131ea9">
<p>
<b>1.åŸºäºæ­£åœ¨æ‰“å¼€æ–‡ä»¶çš„åˆ é™¤æ¢å¤</b>
</p>

<p>
ç¨‹åºè¦æŠŠæ–‡ä»¶å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­æ‰èƒ½è¢«è¯»å–ã€‚æ¢å¥è¯è¯´ï¼Œè¢«è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶åœ¨å†…å­˜æ˜¯æœ‰ä¸€ä¸ªå‰¯æœ¬çš„ã€‚
</p>

<p>
æ¼”ç¤ºï¼šåˆ é™¤æ¢å¤
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">1. /var/log/auth.log&#26159;&#34987;rsyslog&#36827;&#31243;&#25171;&#24320;&#30340;&#65292;&#25105;&#20204;&#22791;&#20221;&#24182;&#21024;&#38500;&#23427;</span>
root@u-18:~# cp /var/log/auth.log /root
root@u-18:~# rm -f /var/log/auth.log

<span style="color: #b22222;"># </span><span style="color: #b22222;">2. lsof    &#21015;&#34920;&#20986;&#25152;&#26377;&#34987;&#36827;&#31243;&#35835;&#21462;&#30340;&#25991;&#20214;&#65292;&#33021;&#30475;&#21040;&#25991;&#20214;&#24050;&#32463;&#34987;&#21024;&#38500;&#65292;&#20294;&#20869;&#23481;&#36824;&#22312;&#20869;&#23384;&#20013;&#29992;&#21040;&#12290;</span>
root@u-18:~# lsof |grep /var/log/auth.log
rsyslogd                694                                                                    syslog                8w                        REG                                                                8,1            138318                1704473 /var/log/auth.log (deleted)

<span style="color: #b22222;"># </span><span style="color: #b22222;">3.    &#21040;&#23545;&#24212;&#36827;&#31243;&#20013;&#25214;&#21040;&#35813;&#25991;&#20214;</span>
root@u-18:~# cd /proc/694/fd

root@u-18:/proc/694/fd# ll
l-wx------ 1 root            root            64 5&#26376;            9 00:39 8 -&gt; <span style="color: #8b2252;">'/var/log/auth.log (deleted)'</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">4. 8&#36824;&#22312;&#20869;&#23384;&#20013;&#65292;&#25152;&#20197;&#33021;&#35835;&#21462;&#21040;&#65292;&#25105;&#20204;&#24674;&#22797;&#30475;&#30475;</span>
root@u-18:/proc/694/fd# cat 8 &gt; /var/log/auth.log
root@u-18:/proc/694/fd# diff /var/log/auth.log /root/auth.log
</pre>
</div>

<p>
<b>2.äººå·¥è¯¯åˆ é™¤ï¼Œæ²¡è¢«è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æ¢å¤</b>
</p>

<p>
2.1 ä½¿ç”¨extundeleteå·¥å…·
</p>

<p>
å¸¸è§çš„å¼€æºæ•°æ®æ¢å¤å·¥å…·æœ‰ï¼Œdebugfsã€R-Linuxã€ext3grepã€extundelete ç­‰ã€‚
ext3grep è·Ÿ extundelete æ¯”è¾ƒå¸¸ç”¨ï¼Œå…¶ä¸­ ext3grep åªæ”¯æŒ ext3æ–‡ä»¶ç³»ç»Ÿï¼Œ
extundelete æ”¯æŒ ext3/ext4ã€‚
</p>

<p>
éƒ½æ˜¯é€šè¿‡åˆ†ææ–‡ä»¶ç³»ç»Ÿæ—¥å¿—ï¼Œè§£æå‡ºæ‰€æœ‰æ–‡ä»¶çš„ inode ä¿¡æ¯ï¼Œåˆ©ç”¨ inodeå»æŸ¥
æ‰¾æ‰€åœ¨ block ,åˆ©ç”¨ dd å¤‡ä»½å‡ºä»¥åˆ é™¤çš„æ•°æ®
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">1. &#23433;&#35013;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">1). epel &#20179;&#24211;&#23433;&#35013;</span>
yum install epel-release 
yum install extundelete -y
<span style="color: #b22222;"># </span><span style="color: #b22222;">ubuntu&#31995;&#32479;&#23433;&#35013;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">root@u-18:/proc/694/fd# apt install extundelete</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2). &#28304;&#30721;&#32534;&#35793;&#23433;&#35013;</span>
http://jaist.dl.sourceforge.net/project/extundelete/extundelete/0.2.4/extundelete-0.2.4.tar.bz2
yum -y install e2fsprogs-devel
tar jxf extundelete-0.2.4.tar.bz2
<span style="color: #483d8b;">cd</span> extundelete-0.2.4
./configure &amp;&amp; make &amp;&amp; make install

<span style="color: #b22222;"># </span><span style="color: #b22222;">2. &#21024;&#38500;&#19968;&#20010;&#25991;&#20214;</span>
root@u-18:/proc/694/fd# df -hPT
/dev/sda1                        ext4                            69G            14G            52G        21% /
root@u-18:/proc/694/fd# mkdir /data/app -pv
root@u-18:/proc/694/fd# cd /data/app
root@u-18:/data/app# cp /etc/fstab ./
root@u-18:/data/app# cp /var/log/auth.log ./
root@u-18:/data/app# rm -f fstab auth.log

<span style="color: #b22222;"># </span><span style="color: #b22222;">3. &#24674;&#22797;&#25991;&#20214;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">1) &#31435;&#21363;&#20445;&#35777;&#20998;&#21306;&#26159;&#21482;&#35835;&#30340;&#65292;&#25110;&#32773;&#21368;&#36733;&#20998;&#21306;</span>
root@u-18:/data/app# mount -f -o remount,ro /dev/sda1

<span style="color: #b22222;">#</span><span style="color: #b22222;">2)&#26597;&#30475;&#21024;&#38500;&#30340;&#25991;&#20214;</span>
root@u-18:/data/app# extundelete /dev/sda1 --inode 2

<span style="color: #b22222;">#</span><span style="color: #b22222;">3) &#20999;&#25442;&#21040;&#20854;&#23427;&#20998;&#21306;&#65292;&#25191;&#34892;&#24674;&#22797;</span>
root@u-18:/data/app# cd    
root@u-18:/root# extundelete /dev/sda1 --restore-all     <span style="color: #b22222;">#    </span><span style="color: #b22222;">&#24674;&#22797;&#20840;&#37096;</span>

&#25991;&#20214;&#22312;RECOVERED_FIELES&#65292;&#36827;&#20837;&#21040;&#30446;&#24405;&#19979;cp&#35201;&#24674;&#22797;&#30340;&#25991;&#20214;&#21363;&#21487;&#12290;

<span style="color: #b22222;"># </span><span style="color: #b22222;">4) &#20998;&#21306;&#21464;&#20026;&#35835;&#20889;</span>
root@u-18:/data/app# mount -f -o remount,rw /dev/sda1
</pre>
</div>

<p>
2.2.1 å‚æ•°é€‰é¡¹
</p>

<div class="org-src-container">
<pre class="src src-sh">--after dtime  &#26102;&#38388;&#21442;&#25968;&#65292;&#34920;&#31034;&#22312;&#26576;&#27573;&#26102;&#38388;&#20043;&#21518;&#34987;&#21024;&#38500;&#30340;&#25991;&#20214;&#25110;&#30446;&#24405;
--before dtime  &#26102;&#38388;&#21442;&#25968;&#65292;&#34920;&#31034;&#22312;&#26576;&#27573;&#26102;&#38388;&#20043;&#21069;&#34987;&#21024;&#38500;&#30340;&#25991;&#20214;&#25110;&#30446;&#24405;

&#24120;&#29992;&#21160;&#20316;
--inode ino  &#26174;&#31034;&#33410;&#28857; ino &#30340;&#20449;&#24687;
--block blk  &#26174;&#31034;&#25968;&#25454;&#22359; blk &#30340;&#20449;&#24687;

--restore-inode ino  &#34920;&#31034;&#24674;&#22797;&#33410;&#28857; ino &#30340;&#25991;&#20214;&#65292;&#29992;&#26469;&#24674;&#22797;&#21333;&#20010;&#25991;&#20214;
--restore-file path  &#34920;&#31034;&#24674;&#22797;&#25351;&#23450;&#36335;&#24452;&#19979;&#30340;&#25991;&#20214;&#65292;&#29992;&#26469;&#24674;&#22797;&#30446;&#24405;&#19979;&#25152;&#26377;&#25991;&#20214;
--restore-all  &#34920;&#31034;&#24674;&#22797;&#25152;&#26377;&#34987;&#21024;&#38500;&#30340;&#30446;&#24405;&#36319;&#25991;&#20214;
</pre>
</div>

<p>
CentOS7ä½¿ç”¨Extundeleteæ¢å¤è¯¯åˆ é™¤çš„æ–‡ä»¶
</p>

<p>
å¸¸è§çš„å¼€æºæ•°æ®æ¢å¤å·¥å…·æœ‰ï¼Œdebugfsã€R-Linuxã€ext3grepã€extundelete ç­‰ã€‚
ext3grep è·Ÿ extundelete æ¯”è¾ƒå¸¸ç”¨ï¼Œå…¶ä¸­ ext3grep åªæ”¯æŒ ext3
æ–‡ä»¶ç³»ç»Ÿï¼Œextundelete æ”¯æŒ ext3/ext4ã€‚
</p>

<p>
éƒ½æ˜¯é€šè¿‡åˆ†ææ–‡ä»¶ç³»ç»Ÿæ—¥å¿—ï¼Œè§£æå‡ºæ‰€æœ‰æ–‡ä»¶çš„ inode ä¿¡æ¯ï¼Œåˆ©ç”¨ inode
å»æŸ¥æ‰¾æ‰€åœ¨ block ,åˆ©ç”¨ dd å¤‡ä»½å‡ºä»¥åˆ é™¤çš„æ•°æ®ã€‚
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">1. &#26597;&#25214;&#34987;&#21024;&#38500;&#30340;&#25991;&#20214;</span>
shell &gt; ls -id /usr/local/src
130619 /usr/local/src
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#39318;&#20808;&#26597;&#30475;&#34987;&#21024;&#38500;&#30340;&#19978;&#23618;&#30446;&#24405; inode</span>

shell &gt; extundelete /dev/mapper/vg_study-LogVol00 --inode 130619
...
File name | Inode number | Deleted status
.                 130619
..                130587
package           137256   Deleted
apr-1.5.1         140038
apr-util-1.5.4    535002
httpd-2.4.10      535320
pcre-8.30         656184
siege-3.0.8       656483
libmcrypt-2.5.8   144383
package.xml       146709
mysql-5.6.4-m7    140588
memcache-2.2.7    146712
php-5.4.13        667097
redis-2.2.5       269016
memcached-1.4.15  146806
libevent-master   539531   Deleted
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#21487;&#20197;&#30475;&#21040;&#34987;&#21024;&#38500;&#30340;&#30446;&#24405; package &#29366;&#24577;&#20026; Deleted &#65292;inode &#20026; 137256</span>

shell &gt; extundelete /dev/mapper/vg_study-LogVol00 --inode 137256
...
File name | Inode number | Deleted status
.                 137256
..                130573
e2p.h;54b8ac2f    137260        Deleted
e2p.h             137260
mysql-5.6.4-m7.tar.gz   140630  Deleted
httpd-2.4.10.tar.gz     140035  Deleted
pcre-8.30.tar.gz        140036  Deleted
siege-3.0.8.tar.gz      140037  Deleted
libmcrypt-2.5.8.tar.bz2 144382  Deleted
php-5.4.13.tar.bz2      144439  Deleted
memcache-2.2.7.tgz      144381  Deleted
redis-2.2.5.tgz         146713  Deleted
libevent-master         539531  Deleted
memcached-1.4.15.tar.gz 144377  Deleted
libevent-master.zip     146863  Deleted

<span style="color: #b22222;">## </span><span style="color: #b22222;">&#21487;&#20197;&#30475;&#21040;&#34987;&#21024;&#38500;&#30340;&#30446;&#24405;&#24213;&#19979;&#26377;&#21738;&#20123;&#34987;&#21024;&#38500;&#30340;&#25991;&#20214;&#21450; inode &#21495;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">2. &#24674;&#22797;&#25968;&#25454;</span>

shell &gt; extundelete /dev/mapper/vg_study-LogVol00 --restore-directory /usr/local/src/package
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#25351;&#23450;&#21024;&#38500;&#30446;&#24405;&#25152;&#22312;&#20998;&#21306;&#65292;--restore-directory &#20026;&#24674;&#22797;&#25972;&#20010;&#30446;&#24405;&#65292;&#21518;&#38754;&#26159;&#35201;&#24674;&#22797;&#30340;&#30446;&#24405;</span>
Would you like to continue? (y/n)
y
Loading filesystem metadata ... 151 groups loaded.
Loading journal descriptors ... 22517 descriptors loaded.
Searching for recoverable inodes<span style="color: #a020f0;"> in</span> directory /usr/local/src/package ...
1679 recoverable inodes found.
Looking through the directory structure for deleted files ...
Block 578312 is allocated.
Unable to restore inode 146713 (usr/local/src/package/redis-2.2.5.tgz): Space has been reallocated.
Unable to restore inode 539531 (usr/local/src/package/libevent-master): Space has been reallocated.
1670 recoverable inodes still lost.
&#22797;&#21046;&#20195;&#30721;
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#20854;&#20013;&#65292;redis-2.2.4.tgz &#21644; libevent-master &#27809;&#26377;&#34987;&#24674;&#22797;&#65292;&#22240;&#20026; inode &#34987;&#37325;&#26032;&#20998;&#37197;&#20986;&#21435;&#20102;...</span>

shell &gt; cd RECOVERED_FILES/usr/local/src/package
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#24674;&#22797;&#23436;&#25104;&#21518;&#20250;&#22312;&#24403;&#21069;&#30446;&#24405;&#19979;&#29983;&#25104;&#19968;&#20010; RECOVERED_FILES &#30446;&#24405;</span>

shell &gt; ls
e2p.h;54b8ac2f libmcrypt-2.5.8.tar.bz2 memcached-1.4.15.tar.gz php-5.4.13.tar.bz2
libevent-master.zip memcache-2.2.7.tgz mysql-5.6.4-m7.tar.gz
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#21482;&#24674;&#22797;&#20102; 7 &#20010;&#25991;&#20214;&#65292;&#21024;&#38500;&#30340;&#26377; 12 &#20010;... &#20351;&#29992; find &#26597;&#19968;&#19979;&#27809;&#26377;&#24674;&#22797;&#30340;&#25991;&#20214;&#30340; inode &#21495;</span>

shell &gt; find / -inum 140035
/usr/lib64/libe2p.so
shell &gt; find / -inum 140036
/usr/lib64/libext2fs.a
shell &gt; find / -inum 140037
/usr/lib64/libext2fs.so
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#21457;&#29616; httpd &#12289;pcre &#12289;siege &#30340;&#37117;&#34987;&#20998;&#37197;&#20986;&#21435;&#20102;...&#65292;&#29616;&#22312;&#24674;&#22797;&#19981;&#20986;&#26469;&#30340;&#23601;&#27704;&#36828;&#27809;&#26377;&#20102;..</span>

<span style="color: #b22222;">## </span><span style="color: #b22222;">&#25152;&#20197;&#65292;&#21315;&#19975;&#35760;&#20303;&#65306;&#19975;&#19968;&#35823;&#21024;&#38500;&#25968;&#25454;&#20102;&#65292;&#19968;&#23450;&#35201;&#31532;&#19968;&#26102;&#38388;&#23558;&#25968;&#25454;&#25152;&#22312;&#30913;&#30424;&#21368;&#36733;&#25110;&#25346;&#36733;&#20026;&#21482;&#35835;&#20998;&#21306;&#65292;&#38450;&#27490;&#20889;&#20837;&#25991;&#20214; inode &#34987;&#37325;&#26032;&#20998;&#37197;&#12290;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#22914;&#26524;&#35823;&#21024;&#30340;&#26159;&#26681;&#20998;&#21306;&#30340;&#25968;&#25454;&#65292;&#37027;&#20040;&#31435;&#21363;&#36827;&#21435;&#21333;&#29992;&#25143;&#27169;&#24335;&#65292;&#23558;&#26681;&#20998;&#21306;&#21482;&#35835;&#25346;&#36733;&#12290;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#21448;&#24341;&#30003;&#20986;&#19968;&#20010;&#38382;&#39064;&#65292;&#20570;&#31995;&#32479;&#20998;&#21306;&#30340;&#26102;&#20505;&#65292;&#26368;&#22909;&#19981;&#35201;&#21482;&#20998;&#19968;&#20010;&#26681;&#20998;&#21306;&#65292;&#20687;&#36825;&#26679;&#30340;&#24773;&#20917;&#24456;&#38590;&#21150;...</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#31532;&#20108;&#65292;&#25968;&#25454;&#24674;&#22797;&#36719;&#20214;&#20107;&#20808;&#35013;&#22909;&#21543;..</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#31532;&#19977;&#65292;&#21024;&#38500;&#25968;&#25454;&#26102;&#65292;&#20808;&#23558;&#35201;&#21024;&#38500;&#30340;&#25968;&#25454;&#31227;&#21160;&#21040; /tmp&#65288;&#21333;&#29420;&#20998;&#21306;&#65289;&#65292;&#28982;&#21518;&#21024;&#38500;&#25110;&#33050;&#26412;&#23450;&#26399;&#21024;&#38500;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#31532;&#22235;&#65292;&#20570;&#22909;&#25968;&#25454;&#22791;&#20221;&#12290;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#26368;&#21518;&#65292;&#25970;&#24930;&#28857; &#65281;&#65281;&#65281;</span>
</pre>
</div>

<p>
2.2 linuxè‡ªå¸¦å·¥å…·debugfsæ¢å¤è¯¯åˆ æ–‡ä»¶æ–¹æ³• ä¸æ”¯æŒxfsæ–‡ä»¶æ ¼å¼çš„æ¢å¤
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">1.&#22312; /example/&#30446;&#24405;&#20013;&#65292;&#21019;&#24314;&#19968;&#20010;&#25991;&#20214;&#20889;&#20837;&#20869;&#23481;&#24182;&#21024;&#38500;</span>
$ cd /example
$ echo 22 &gt;1.c
$ rm 1.c

<span style="color: #b22222;"># </span><span style="color: #b22222;">2.&#26597;&#30475;&#25991;&#20214;&#25152;&#22312;&#20998;&#21306;</span>
$ df ./
Filesystem     1K-blocks     Used Available Use% Mounted on
/dev/sda1       41020640 23113464  15793744  60% /

<span style="color: #b22222;"># </span><span style="color: #b22222;">3.&#21551;&#21160;debugfs&#24037;&#20855;</span>
$ sudo debugfs
debugfs:  open /dev/sda1
debugfs:  ls -d /example/
ls -d&#20250;&#21015;&#20986;&#27492;&#30446;&#24405;&#26368;&#36817;&#30340;&#25805;&#20316;&#65292;&#20854;&#20013;&#21487;&#20197;&#30475;&#21040;&lt;num&gt;&#30340;&#26085;&#24535;&#21024;&#38500;&#35760;&#24405;
&lt;1590178&gt; (4044) 1.c   
&#35760;&#24405;&#19979;&#23574;&#25324;&#21495;&#20869;&#30340;&#25968;&#20540;&#65292;&#25353;q&#22238;&#21040;debugfs&#12290;
&#22914;&#26524;&#32467;&#26524;&#22826;&#22810;&#65292;&#21487;&#20197;&#30452;&#25509;&#25191;&#34892;&#22914;&#19979;&#21629;&#20196;&#65306; echo lsdel | debugfs /dev/sda1 &gt; lsdel.out &#22914;&#27492;&#21487;&#23558;&#32467;&#26524;&#36755;&#20986;&#25104;&#26412;&#22320;&#25991;&#20214;

<span style="color: #b22222;"># </span><span style="color: #b22222;">4 &#25191;&#34892;logdump -i &lt;num&gt; &#26174;&#31034;&#27492;&#26085;&#24535;&#20869;&#23481;,&#24182;&#20351;&#29992;quit&#36864;&#20986;debugfs&#22914;&#19979;</span>
debugfs:  logdump -i &lt;1590178&gt;
Inode 1590178 is at group 194, block 6292541, offset 128
Journal starts at block 33979, transaction 115345
No magic number at block 36187: end of journal.
debugfs:  quit
&#25110;&#32773;
&#22312;debugfs&#27169;&#24335;&#19979;&#65292;&#25191;&#34892; dump &lt;123456&gt; /tmp/123456.bak&#65292;&#21487;&#23558;&#34987;&#21024;&#38500;&#30340;&#25991;&#20214;&#24674;&#22797;&#65292;&#20854;&#20013;123456&#20026;&#34987;&#21024;&#38500;&#25991;&#20214;&#30340;inode&#21495;&#12290;

<span style="color: #b22222;">#</span><span style="color: #b22222;">4.&#24674;&#22797;&#25991;&#20214;</span>
$ sudo dd <span style="color: #a0522d;">if</span>=/dev/sda1 <span style="color: #a0522d;">of</span>=/tmp/example/1.c <span style="color: #a0522d;">bs</span>=128 <span style="color: #a0522d;">count</span>=1 <span style="color: #a0522d;">skip</span>=629541
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:fe5371ea-92e7-411e-b933-a5e2531a44f9" class="outline-3">
<h3 id="h:fe5371ea-92e7-411e-b933-a5e2531a44f9">æŒ‚è½½</h3>
<div class="outline-text-3" id="text-h:fe5371ea-92e7-411e-b933-a5e2531a44f9">
<p>
æŒ‚è½½:å°†é¢å¤–æ–‡ä»¶ç³»ç»Ÿä¸æ ¹æ–‡ä»¶ç³»ç»ŸæŸç°å­˜çš„ç›®å½•å»ºç«‹èµ·å…³è”å…³ç³»ï¼Œè¿›è€Œä½¿å¾—æ­¤
ç›®å½•åšä¸ºå…¶å®ƒæ–‡ä»¶è®¿é—®å…¥å£çš„è¡Œä¸º
</p>

<p>
å¸è½½:ä¸ºè§£é™¤æ­¤å…³è”å…³ç³»çš„è¿‡ç¨‹
</p>

<p>
æŠŠè®¾å¤‡å…³è”æŒ‚è½½ç‚¹ï¼šmount Point
</p>

<p>
æŒ‚è½½ç‚¹ä¸‹åŸæœ‰æ–‡ä»¶åœ¨æŒ‚è½½å®Œæˆåä¼šè¢«ä¸´æ—¶éšè—ï¼Œå› æ­¤ï¼ŒæŒ‚è½½ç‚¹ç›®å½•ä¸€èˆ¬ä¸ºç©º
</p>

<p>
è¿›ç¨‹æ­£åœ¨ä½¿ç”¨ä¸­çš„è®¾å¤‡æ— æ³•è¢«å¸è½½
</p>
</div>
<div id="outline-container-h:9300dc8a-8557-4bcb-924e-9a9886cacf5f" class="outline-4">
<h4 id="h:9300dc8a-8557-4bcb-924e-9a9886cacf5f">æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿmount</h4>
<div class="outline-text-4" id="text-h:9300dc8a-8557-4bcb-924e-9a9886cacf5f">
<p>
æ ¼å¼ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">mount [-fnrsvw] [-t vfstype] [-o options] device mountpoint
</pre>
</div>

<p>
<b>deviceï¼šæŒ‡æ˜è¦æŒ‚è½½çš„è®¾å¤‡</b>
</p>

<ul class="org-ul">
<li>è®¾å¤‡æ–‡ä»¶ï¼šä¾‹å¦‚:/dev/sda5</li>
<li>å·æ ‡ï¼š-L 'LABEL', ä¾‹å¦‚ -L 'MYDATA'</li>
<li>UUIDï¼š -U 'UUID'ï¼šä¾‹å¦‚ -U '0c50523c-43f1-45e7-85c0-a126711d406e'</li>
<li>ä¼ªæ–‡ä»¶ç³»ç»Ÿåç§°ï¼šproc, sysfs, devtmpfs, configfs</li>
</ul>

<p>
<b>mountpointï¼šæŒ‚è½½ç‚¹ç›®å½•å¿…é¡»äº‹å…ˆå­˜åœ¨ï¼Œå»ºè®®ä½¿ç”¨ç©ºç›®å½•</b>
</p>

<p>
èŒƒä¾‹ï¼š
</p>
<div class="org-src-container">
<pre class="src src-shell">blkid
mount <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"xxxxx"</span> /data/tmp
</pre>
</div>

<p>
<b>mountå¸¸ç”¨å‘½ä»¤é€‰é¡¹</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#19981;&#24102;&#20219;&#20309;&#36873;&#39033;&#30340;&#21629;&#20196;&#26174;&#31034;&#24403;&#21069;&#24050;&#25346;&#36733;&#30340;&#25152;&#26377;&#25991;&#20214;&#31995;&#32479;
-t vsftype &#25351;&#23450;&#35201;&#25346;&#36733;&#30340;&#35774;&#22791;&#19978;&#30340;&#25991;&#20214;&#31995;&#32479;&#31867;&#22411;; &#22810;&#25968;&#24773;&#20917;&#19979;&#21487;&#20197;&#30465;&#30053;&#65292;&#27492;&#26102;mount&#20250;&#36890;&#36807; blkid &#21629;&#20196;&#26469;&#21028;&#26029;&#35201;&#25346;&#36733;&#30340;&#35774;&#22791;&#25991;&#20214;&#31867;&#22411;&#65307;
-r readonly&#65292;&#21482;&#35835;&#25346;&#36733;&#65307;&#20809;&#39537;&#21482;&#33021;&#21482;&#35835;&#25346;&#36733;
-w read and write, &#35835;&#20889;&#25346;&#36733;
-n &#19981;&#26356;&#26032;/etc/mtab&#65292;mount&#19981;&#21487;&#35265;
-a &#33258;&#21160;&#25346;&#36733;&#25152;&#26377;&#25903;&#25345;&#33258;&#21160;&#25346;&#36733;&#30340;&#35774;&#22791;(&#23450;&#20041;&#22312;&#20102;/etc/fstab&#25991;&#20214;&#20013;&#65292;&#19988;&#25346;&#36733;&#36873;&#39033;&#20013;&#26377;auto&#21151;&#33021;)
-L <span style="color: #8b2252;">'LABEL'</span> &#20197;&#21367;&#26631;&#25351;&#23450;&#25346;&#36733;&#35774;&#22791;
-U <span style="color: #8b2252;">'UUID'</span> &#20197;UUID&#25351;&#23450;&#35201;&#25346;&#36733;&#30340;&#35774;&#22791;
-B, --bind &#32465;&#23450;&#30446;&#24405;&#21040;&#21478;&#19968;&#20010;&#30446;&#24405;&#19978;; &#20316;&#20026;&#20854;&#20020;&#26102;&#35775;&#38382;&#20837;&#21475;

-o options&#65306;(&#25346;&#36733;&#25991;&#20214;&#31995;&#32479;&#30340;&#36873;&#39033;)&#65292;&#22810;&#20010;&#36873;&#39033;&#20351;&#29992;&#36887;&#21495;&#20998;&#38548;
    async                              <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24322;&#27493;&#27169;&#24335;,&#20869;&#23384;&#26356;&#25913;&#26102;,&#20889;&#20837;&#32531;&#23384;&#21306;buffer,&#36807;&#19968;&#27573;&#26102;&#38388;&#20877;&#20889;&#21040;&#30913;&#30424;&#20013;&#65292;&#25928;&#29575;&#39640;&#65292;&#20294;&#19981;&#23433;&#20840;</span>
    sync                                <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21516;&#27493;&#27169;&#24335;,&#20869;&#23384;&#26356;&#25913;&#26102;&#65292;&#21516;&#26102;&#20889;&#30913;&#30424;&#65292;&#23433;&#20840;&#65292;&#20294;&#25928;&#29575;&#20302;&#19979;</span>
    atime/noatime               <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21253;&#21547;&#30446;&#24405;&#21644;&#25991;&#20214;&#35835;&#26102;&#38388;&#65292;&#25991;&#20214;&#30340;&#35835;&#26102;&#38388;&#19968;&#33324;&#24847;&#20041;&#19981;&#22823;&#21487;&#20197;&#21435;&#25481;noatime&#65292;&#20943;&#23569;&#30913;&#30424;IO&#35835;&#20889;&#12290;</span>
    diratime/nodiratime     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30446;&#24405;&#30340;&#35775;&#38382;&#26102;&#38388;&#25139;</span>
    auto/noauto                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26159;&#21542;&#25903;&#25345;&#24320;&#26426;&#33258;&#21160;&#25346;&#36733;&#65292;&#26159;&#21542;&#25903;&#25345;-a&#36873;&#39033;</span>
    exec/noexec                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26159;&#21542;&#25903;&#25345;&#23558;&#25991;&#20214;&#31995;&#32479;&#19978;&#36816;&#34892;&#24212;&#29992;&#31243;&#24207;</span>
    dev/nodev                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26159;&#21542;&#25903;&#25345;&#22312;&#27492;&#25991;&#20214;&#31995;&#32479;&#19978;&#20351;&#29992;&#35774;&#22791;&#25991;&#20214;</span>
    suid/nosuid                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26159;&#21542;&#25903;&#25345;suid&#21644;sgid&#26435;&#38480;</span>
    remount                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#37325;&#26032;&#25346;&#36733;</span>
    ro/rw                             <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#35835;&#12289;&#35835;&#20889; </span>
    user/nouser                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26159;&#21542;&#20801;&#35768;&#26222;&#36890;&#29992;&#25143;&#25346;&#36733;&#27492;&#35774;&#22791;&#65292;/etc/fstab&#20351;&#29992;</span>
    acl/noacl                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#29992;&#27492;&#25991;&#20214;&#31995;&#32479;&#19978;&#30340;acl&#21151;&#33021;</span>
    loop                              <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;loop&#35774;&#22791;&#65292;&#24517;&#38656;&#26377;&#25991;&#20214;&#31995;&#32479;&#30340;&#25991;&#20214;</span>
    _netdev                         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#32593;&#32476;&#21487;&#29992;&#26102;&#25165;&#23545;&#32593;&#32476;&#36164;&#28304;&#36827;&#34892;&#25346;&#36733;&#65292;&#22914;&#65306;NFS&#25991;&#20214;&#31995;&#32479;</span>
    defaults                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30456;&#24403;&#20110;rw, suid, dev, exec, auto, nouser, async</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36879;&#26126;&#21387;&#32553;&#26426;&#21046;&#65306;&#20256;&#30340;&#25968;&#25454;&#20250;&#34987;&#21387;&#32553;&#20043;&#21518;&#23384;&#25918;</span>
&#21629;&#20196;&#65306;mount -o <span style="color: #a0522d;">compress</span>={lzo|zlib} DEVICE MOUNT_POINT
</pre>
</div>

<blockquote>
<p>
åŒæ­¥å¼‚æ­¥ï¼šè¿›ç¨‹æ¯ä¸€æ¬¡æ‰€è®¿é—®çš„æ•°æ®é»˜è®¤éƒ½åº”è¯¥åœ¨ç£ç›˜ä¸Šçš„ï¼Œä½†æ˜¯è¿›ç¨‹æ˜¯ä¸å¯èƒ½
æ“ä½œç£ç›˜ä¸Šçš„æ•°æ®ï¼Œå®ƒéœ€è¦æŠŠæ•°æ®å…ˆè£…å…¥åˆ°å†…å­˜ä¸­ï¼Œåœ¨å†…å­˜ä¸­æ‰§è¡Œè¯»å†™æ“ä½œï¼Œå°¤
å…¶æ˜¯å†™æ“ä½œã€‚
</p>

<p>
å¦‚ä½•å†™å‘¢ï¼Ÿ å…ˆåœ¨å†…å­˜ä¸­å†™å®Œï¼Œè¿‡ä¸€ä¼šå†åŒæ­¥åˆ°ç£ç›˜ä¸Šï¼Œè¿™å«å¼‚æ­¥ã€‚
å¦‚æœåœ¨å†…å­˜ä¸­ä¸€å†™ç«‹å³åŒæ­¥åˆ°ç£ç›˜ä¸Šï¼Œè¿™å«åŒæ­¥ã€‚
</p>

<p>
æƒ³ä¸€ä¸‹ï¼Œå†…å­˜æ˜¯æ¯”ç£ç›˜å¿«å¾—å¤šï¼Œå¼‚æ­¥æ€§èƒ½æ›´å¥½ã€‚
</p>
</blockquote>

<p>
<b>æŒ‚è½½è§„åˆ™:</b>
</p>

<ul class="org-ul">
<li>ä¸€ä¸ªæŒ‚è½½ç‚¹åŒä¸€æ—¶é—´åªèƒ½æŒ‚è½½ä¸€ä¸ªè®¾å¤‡</li>
<li>ä¸€ä¸ªæŒ‚è½½ç‚¹åŒä¸€æ—¶é—´æŒ‚è½½äº†å¤šä¸ªè®¾å¤‡ï¼Œåªèƒ½çœ‹åˆ°æœ€åä¸€ä¸ªè®¾å¤‡çš„æ•°æ®ï¼Œå…¶å®ƒè®¾
å¤‡ä¸Šçš„æ•°æ®å°†è¢«éšè—</li>
<li>ä¸€ä¸ªè®¾å¤‡å¯ä»¥åŒæ—¶æŒ‚è½½åˆ°å¤šä¸ªæŒ‚è½½ç‚¹</li>
<li>é€šå¸¸æŒ‚è½½ç‚¹ä¸€èˆ¬æ˜¯å·²å­˜åœ¨ç©ºçš„ç›®å½•</li>
</ul>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">1. &#32465;&#23450;&#30446;&#24405;; &#36890;&#36807; /mnt &#30446;&#24405;&#26469;&#35775;&#38382; /etc &#30446;&#24405;</span>
[root@node01 mnt]# mount --bind /etc/ /mnt

<span style="color: #b22222;"># </span><span style="color: #b22222;">2 &#25346;&#36733;&#35774;&#22791;</span>
[root@node01 ~]# mount /dev/sdb5 /mnt/ 

<span style="color: #b22222;"># </span><span style="color: #b22222;">3 &#21482;&#35835;&#25346;&#36733;</span>
[root@node01 ~]# mount -r /dev/sdb5 /media

<span style="color: #b22222;"># </span><span style="color: #b22222;">4 -o options &#25351;&#26126;&#25346;&#36733;&#26102;&#31995;&#32479;&#21551;&#29992;&#30340;&#29305;&#24615;</span>
acl&#65306;&#25903;&#25345;&#20351;&#29992;fac &#25991;&#20214;&#35775;&#38382;&#25511;&#20214;&#21015;&#34920; &#21151;&#33021;&#65307;&#26377; 2 &#31181;&#26041;&#24335;&#23454;&#29616;
1&#12289;# mount -o acl device dir
2&#12289;# tune2fs -o acl device   <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;&#21518;&#65292;mount &#21629;&#20196;&#19981;&#20250;&#26174;&#31034;&#26377; acl &#65292;&#20294;&#20854;&#23454;&#26377; acl &#21151;&#33021;&#12290;</span>
&#21333;&#29992;&#25143;&#27169;&#24335;&#19979;&#20197;rw&#26041;&#24335;&#37325;&#26032;&#25346;&#36733; /
mount -o remount,rw /

<span style="color: #b22222;"># </span><span style="color: #b22222;">5 &#25346;&#36733;&#20809;&#30424;&#65306;</span>
mount -r /dev/cdrom &#25346;&#36733;&#28857;
&#20809;&#30424;&#35774;&#22791;&#25991;&#20214;&#65306;/dev/cdrom,/dev/dvd
[root@node01 mnt]# ls -l /dev/cdr*
lrwxrwxrwx 1 root root 3 Jan 18 23:24 /dev/cdrom -&gt; sr0  <span style="color: #b22222;"># </span><span style="color: #b22222;">sr0 &#20854;&#23454;&#26159; SATA &#25509;&#21475;&#30340;&#20809;&#39537;&#35774;&#22791; &#12290; sr0 &#21487;&#33021;&#26159; hdc&#65292;&#34987;&#34394;&#25311;&#25104; IDE &#25509;&#21475;&#20102;</span>

<span style="color: #b22222;">######</span>
&#25346;&#36733;&#20809;&#30424;&#35774;&#22791;&#65306;
&#20809;&#30424;&#35774;&#22791;&#25991;&#20214;&#65306;
IDE: /dev/hdc
SATA: /dev/sr0

&#31526;&#21495;&#38142;&#25509;&#25991;&#20214;&#65306;
/dev/cdrom
/dev/cdrw
/dev/dvd
/dev/dvdrw

<span style="color: #b22222;"># </span><span style="color: #b22222;">6 &#25346;&#36733;U&#30424;&#65306;</span>
&#20107;&#20808;&#35782;&#21035;U&#30424;&#35774;&#22791;&#25991;&#20214;&#65307;

<span style="color: #b22222;"># </span><span style="color: #b22222;">6 &#25346;&#36733;&#26412;&#22320;&#30340;&#22238;&#29615;&#35774;&#22791;&#65306;&#21487;&#20197;&#29992;&#25991;&#20214;&#24403;&#27169;&#25311;&#30828;&#30424;&#29992;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#27880;&#24847;&#65306;&#26412;&#22320;&#22238;&#29615;&#35774;&#22791;&#26410;&#24517;&#37117;&#26159; ISO &#38236;&#20687;&#65292;&#21487;&#20197;&#26159; image &#25991;&#20214; </span>
dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/disk.iso <span style="color: #a0522d;">bs</span>=1M <span style="color: #a0522d;">count</span>=100
mkfs.ext4 /disk.iso
mount -o loop /disk.iso  /media

losetup - set up and control loop devices
losetup -a: &#26174;&#31034;&#25152;&#26377;&#24050;&#29992;&#30340;loop&#35774;&#22791;&#30456;&#20851;&#20449;&#24687;
losetup -f: &#26174;&#31034;&#31532;&#19968;&#20010;&#31354;&#38386;&#30340;loop&#35774;&#22791;&#25991;&#20214;
losetup /dev/loop0 /images/xen/busybox3.img

<span style="color: #b22222;"># </span><span style="color: #b22222;">NAS&#25346;&#36733;</span>
mount -t nfs -o <span style="color: #a0522d;">vers</span>=4,<span style="color: #a0522d;">minorversion</span>=0,<span style="color: #a0522d;">rsize</span>=1048576,<span style="color: #a0522d;">wsize</span>=1048576,hard,<span style="color: #a0522d;">timeo</span>=600,<span style="color: #a0522d;">retrans</span>=2,noresvport file-system-id.region.nas.aliyuncs.com:/ /mnt    
&#21442;&#25968;&#35828;&#26126;&#65306;
rsize&#65306;&#23450;&#20041;&#25968;&#25454;&#22359;&#30340;&#22823;&#23567;&#65292;&#29992;&#20110;&#23458;&#25143;&#31471;&#19982;&#25991;&#20214;&#31995;&#32479;&#20043;&#38388;&#35835;&#21462;&#25968;&#25454;&#12290;&#24314;&#35758;&#20540;&#65306;1048576&#12290;
wsize&#65306;&#23450;&#20041;&#25968;&#25454;&#22359;&#30340;&#22823;&#23567;&#65292;&#29992;&#20110;&#23458;&#25143;&#31471;&#19982;&#25991;&#20214;&#31995;&#32479;&#20043;&#38388;&#20889;&#20837;&#25968;&#25454;&#12290;&#24314;&#35758;&#20540;&#65306;1048576&#12290;
&#35828;&#26126; &#22914;&#26524;&#24744;&#38656;&#35201;&#26356;&#25913;IO&#22823;&#23567;&#21442;&#25968;&#65288;rsize&#21644;wsize&#65289;&#65292;&#24314;&#35758;&#24744;&#23613;&#21487;&#33021;&#20351;&#29992;&#26368;&#22823;&#20540;&#65288;1048576&#65289;&#65292;&#20197;&#36991;&#20813;&#24615;&#33021;&#19979;&#38477;&#12290;
hard&#65306;&#22312;&#25991;&#20214;&#23384;&#20648;NAS&#26242;&#26102;&#19981;&#21487;&#29992;&#30340;&#24773;&#20917;&#19979;&#65292;&#20351;&#29992;&#25991;&#20214;&#31995;&#32479;&#19978;&#26576;&#20010;&#25991;&#20214;&#30340;&#26412;&#22320;&#24212;&#29992;&#31243;&#24207;&#26102;&#20250;&#20572;&#27490;&#24182;&#31561;&#24453;&#33267;&#35813;&#25991;&#20214;&#31995;&#32479;&#24674;&#22797;&#22312;&#32447;&#29366;&#24577;&#12290;&#24314;&#35758;&#21551;&#29992;&#35813;&#21442;&#25968;&#12290;
timeo&#65306;&#25351;&#23450;&#26102;&#38271;&#65292;&#21333;&#20301;&#20026;0.1&#31186;&#65292;&#21363;NFS&#23458;&#25143;&#31471;&#22312;&#37325;&#35797;&#21521;&#25991;&#20214;&#31995;&#32479;&#21457;&#36865;&#35831;&#27714;&#20043;&#21069;&#31561;&#24453;&#21709;&#24212;&#30340;&#26102;&#38388;&#12290;&#24314;&#35758;&#20540;&#65306;600&#65288;60&#31186;&#65289;&#12290;
&#35828;&#26126; &#22914;&#26524;&#24744;&#24517;&#39035;&#26356;&#25913;&#36229;&#26102;&#21442;&#25968;&#65288;timeo&#65289;&#65292;&#24314;&#35758;&#24744;&#20351;&#29992;150&#25110;&#26356;&#22823;&#30340;&#20540;&#12290;&#35813;timeo&#21442;&#25968;&#30340;&#21333;&#20301;&#20026;0.1&#31186;&#65292;&#22240;&#27492;150&#34920;&#31034;&#30340;&#26102;&#38388;&#20026;15&#31186;&#12290;
retrans&#65306;NFS&#23458;&#25143;&#31471;&#37325;&#35797;&#35831;&#27714;&#30340;&#27425;&#25968;&#12290;&#24314;&#35758;&#20540;&#65306;2&#12290;
noresvport&#65306;&#22312;&#32593;&#32476;&#37325;&#36830;&#26102;&#20351;&#29992;&#26032;&#30340;TCP&#31471;&#21475;&#65292;&#20445;&#38556;&#22312;&#32593;&#32476;&#21457;&#29983;&#25925;&#38556;&#24674;&#22797;&#26102;&#19981;&#20250;&#20013;&#26029;&#36830;&#25509;&#12290;&#24314;&#35758;&#21551;&#29992;&#35813;&#21442;&#25968;&#12290;
_netdev &#38450;&#27490;&#23458;&#25143;&#31471;&#22312;&#32593;&#32476;&#23601;&#32490;&#20043;&#21069;&#24320;&#22987;&#25346;&#36733;&#25991;&#20214;&#31995;&#32479;&#12290;
/etc/fstab&#26368;&#21518;2&#21015;
0&#65288;noresvport&#21518;&#31532;&#19968;&#39033;&#65289;   &#38750;&#38646;&#20540;&#34920;&#31034;&#25991;&#20214;&#31995;&#32479;&#24212;&#30001;dump&#22791;&#20221;&#12290;&#23545;&#20110;NAS&#25991;&#20214;&#31995;&#32479;&#32780;&#35328;&#65292;&#27492;&#20540;&#40664;&#35748;&#20026;0&#12290;
0&#65288;noresvport&#21518;&#31532;&#20108;&#39033;&#65289;   &#35813;&#20540;&#34920;&#31034;fsck&#22312;&#21551;&#21160;&#26102;&#26816;&#26597;&#25991;&#20214;&#31995;&#32479;&#30340;&#39034;&#24207;&#12290;&#23545;&#20110;NAS&#25991;&#20214;&#31995;&#32479;&#32780;&#35328;&#65292;&#27492;&#20540;&#40664;&#35748;&#20026;0&#65292;&#34920;&#31034;fsck&#19981;&#24212;&#22312;&#21551;&#21160;&#26102;&#36816;&#34892;

<span style="color: #b22222;"># </span><span style="color: #b22222;">smba&#25346;&#36733;</span>
mount -t cifs //xxx-crf23.eu-west-1.nas.aliyuncs.com/myshare /mnt -o <span style="color: #a0522d;">vers</span>=2.1,guest,<span style="color: #a0522d;">uid</span>=0,<span style="color: #a0522d;">gid</span>=0,<span style="color: #a0522d;">dir_mode</span>=0755,<span style="color: #a0522d;">file_mode</span>=0755,mfsymlinks,<span style="color: #a0522d;">cache</span>=strict,<span style="color: #a0522d;">rsize</span>=1048576,<span style="color: #a0522d;">wsize</span>=1048576
&#21442;&#25968;&#35828;&#26126;&#65306;
vers&#65306;&#25903;&#25345;2.1&#25110;&#32773;3.0&#21327;&#35758;&#29256;&#26412;&#12290;
guest&#65306;&#22312;&#35748;&#35777;&#26041;&#38754;&#65292;&#29616;&#22312;&#21482;&#25903;&#25345;&#22522;&#20110;ntlm&#35748;&#35777;&#21327;&#35758;&#30340;guest&#25346;&#36733;&#12290;<span style="color: #a0522d;">&#21363;&#20351;&#29992;username</span>=guest&#12289;<span style="color: #a0522d;">password</span>=guest&#25110;&#32773;guest&#12290;
&#35828;&#26126; &#26381;&#21153;&#22120;&#25903;&#25345;ntlm,ntlmv2&#21644;ntlmssp&#12290;&#40664;&#35748;&#26102;&#65292;SMB&#23458;&#25143;&#31471;&#21644;&#26381;&#21153;&#22120;&#20250;&#21327;&#21830;&#19968;&#20010;&#21487;&#25509;&#21463;&#30340;ntlm&#35748;&#35777;&#21327;&#35758;&#65307;&#25110;&#32773;&#24744;&#22312;&#25346;&#36733;&#26102;&#65292;&#36890;&#36807;sec &lt;option&gt;&#21487;&#20197;&#36873;&#25321;&#19968;&#20010;&#26399;&#26395;&#20540;&#65288;ntlm&#12289;ntlmv2 &#25110;&#32773;ntlmssp&#65289;&#12290;
rsize&#65306;&#29992;&#26469;&#35774;&#32622;&#35835;&#25968;&#25454;&#21253;&#30340;&#26368;&#22823;&#38480;&#21046;&#12290;&#19968;&#33324;&#38656;&#35201;&#35774;&#32622;&#25104;1048576&#65288;1 MB&#65289;&#12290;
wsize&#65306;&#29992;&#26469;&#35774;&#32622;&#20889;&#25968;&#25454;&#21253;&#30340;&#26368;&#22823;&#38480;&#21046;&#65292;&#19968;&#33324;&#38656;&#35201;&#35774;&#32622;&#25104;1048576&#65288;1 MB&#65289;&#12290;
uid&#65306;&#25346;&#36733;&#25104;&#21151;&#21518;&#65292;&#25991;&#20214;&#25152;&#23646;&#30340;&#29992;&#25143;&#12290;&#22914;&#26524;&#26410;&#35774;&#32622;uid&#65292;<span style="color: #a0522d;">&#21017;&#40664;&#35748;uid</span>=0&#12290;
gid&#65306;&#25346;&#36733;&#25104;&#21151;&#21518;&#65292;&#25991;&#20214;&#25152;&#23646;&#30340;&#29992;&#25143;&#32452;&#12290;&#22914;&#26524;&#26410;&#35774;&#32622;gid&#65292;<span style="color: #a0522d;">&#21017;&#40664;&#35748;gid</span>=0&#12290;
dir_mode&#65306;&#21521;&#29992;&#25143;&#25480;&#20104;&#30446;&#24405;&#30340;&#35835;&#21462;&#12289;&#20889;&#20837;&#21644;&#25191;&#34892;&#26435;&#38480;&#12290;&#24517;&#39035;&#20197;0&#24320;&#22836;&#65292;&#20363;&#22914;&#65306;0755&#12289;0644&#31561;&#12290;&#22914;&#26524;&#26410;&#35774;&#32622;dir_more&#65292;<span style="color: #a0522d;">&#21017;&#40664;&#35748;dir_mode</span>=0755&#12290;
file_mode&#65306;&#21521;&#29992;&#25143;&#25480;&#20104;&#26222;&#36890;&#25991;&#20214;&#30340;&#35835;&#21462;&#12289;&#20889;&#20837;&#21644;&#25191;&#34892;&#26435;&#38480;&#12290;&#24517;&#39035;&#20197;0&#24320;&#22836;&#65292;&#20363;&#22914;&#65306;0755&#12289;0644&#31561;&#12290;&#22914;&#26524;&#26410;&#35774;&#32622;file_mode&#65292;<span style="color: #a0522d;">&#21017;&#40664;&#35748;file_mode</span>=0755&#12290;
mfsymlinks&#65306;&#29992;&#20197;&#25903;&#25345;symbol link&#21151;&#33021;&#12290;
cache&#65306;
<span style="color: #a0522d;">cache</span>=strict&#65306;&#35774;&#32622;SMB&#23458;&#25143;&#31471;&#20351;&#29992;&#23458;&#25143;&#31471;&#32531;&#23384;&#12290;&#22914;&#26524;&#26410;&#35774;&#32622;cache&#65292;<span style="color: #a0522d;">&#21017;&#40664;&#35748;cache</span>=strict&#12290;
<span style="color: #a0522d;">cache</span>=none&#65306;&#35774;&#32622;SMB&#23458;&#25143;&#31471;&#19981;&#20351;&#29992;&#23458;&#25143;&#31471;&#32531;&#23384;&#12290;
atime|relatime&#65306;&#22914;&#26524;&#24744;&#30340;&#19994;&#21153;&#19981;&#26159;&#23545;&#25991;&#20214;&#30340;&#35775;&#38382;&#26102;&#38388;&#26497;&#20026;&#25935;&#24863;&#65292;&#35831;&#19981;&#35201;&#22312;&#25346;&#36733;&#26102;&#20351;&#29992;atime&#36873;&#39033;&#65292;&#40664;&#35748;&#26102;&#20250;&#20351;&#29992;relatime&#26041;&#24335;&#25346;&#36733;&#12290;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:698dd5a2-56c6-46ee-bc9e-b969480bbff9" class="outline-4">
<h4 id="h:698dd5a2-56c6-46ee-bc9e-b969480bbff9">å¸è½½æ–‡ä»¶ç³»ç»Ÿ umount</h4>
<div class="outline-text-4" id="text-h:698dd5a2-56c6-46ee-bc9e-b969480bbff9">
<p>
å¸è½½æ—¶ï¼šå¯ä½¿ç”¨è®¾å¤‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æŒ‚è½½ç‚¹
</p>

<div class="org-src-container">
<pre class="src src-sh">umount &#35774;&#22791;&#21517;|&#25346;&#36733;&#28857;

umount -lf /dev/sdb <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24378;&#21046;&#21462;&#28040;&#25346;&#36733;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d991921a-dab2-4eb7-9951-ba6f8a4e0b32" class="outline-4">
<h4 id="h:d991921a-dab2-4eb7-9951-ba6f8a4e0b32">æŸ¥çœ‹æŒ‚è½½æƒ…å†µ</h4>
<div class="outline-text-4" id="text-h:d991921a-dab2-4eb7-9951-ba6f8a4e0b32">
<p>
æŸ¥çœ‹æŒ‚è½½
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#36807;&#26597;&#30475;/etc/mtab&#25991;&#20214;&#26174;&#31034;&#24403;&#21069;&#24050;&#25346;&#36733;&#30340;&#25152;&#26377;&#35774;&#22791;</span>
mount
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#20869;&#26680;&#36861;&#36394;&#21040;&#30340;&#24050;&#25346;&#36733;&#30340;&#25152;&#26377;&#35774;&#22791;</span>
cat /proc/mounts
</pre>
</div>

<p>
æŸ¥çœ‹æŒ‚è½½ç‚¹æƒ…å†µ
</p>

<div class="org-src-container">
<pre class="src src-sh">findmnt  MOUNT_POINT|device
</pre>
</div>

<p>
æŸ¥çœ‹æ­£åœ¨è®¿é—®æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿçš„è¿›ç¨‹
</p>

<div class="org-src-container">
<pre class="src src-sh">lsof MOUNT_POINT
fuser -v MOUNT_POINT
</pre>
</div>

<p>
ç»ˆæ­¢æ‰€æœ‰åœ¨æ­£è®¿é—®æŒ‡å®šçš„æ–‡ä»¶ç³»ç»Ÿçš„è¿›ç¨‹
</p>

<div class="org-src-container">
<pre class="src src-sh">fuser -km MOUNT_POINT
</pre>
</div>
</div>
</div>
<div id="outline-container-h:50d6a75a-f75a-48b0-b540-4a1ea5c5d1bd" class="outline-4">
<h4 id="h:50d6a75a-f75a-48b0-b540-4a1ea5c5d1bd">æŒä¹…æŒ‚è½½</h4>
<div class="outline-text-4" id="text-h:50d6a75a-f75a-48b0-b540-4a1ea5c5d1bd">
<p>
å°†æŒ‚è½½ä¿å­˜åˆ° /etc/fstab ä¸­å¯ä»¥ä¸‹æ¬¡å¼€æœºæ—¶ï¼Œè‡ªåŠ¨å¯ç”¨æŒ‚è½½
</p>

<p>
/etc/fstabæ ¼å¼å¸®åŠ©ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">man 5 fstab
</pre>
</div>

<p>
æ¯è¡Œå®šä¹‰ä¸€ä¸ªè¦æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿ,ï¼Œå…¶ä¸­åŒ…æ‹¬å…± 6 é¡¹
</p>

<div class="org-src-container">
<pre class="src src-sh">/disk.img        /mnt/disk       ext4   loop       0 0
</pre>
</div>

<ol class="org-ol">
<li><p>
è¦æŒ‚è½½çš„è®¾å¤‡æˆ–ä¼ªæ–‡ä»¶ç³»ç»Ÿ è®¾å¤‡æ–‡ä»¶
</p>

<pre class="example" id="org516187e">
LABELï¼šLABEL=""
UUIDï¼šUUID=""
ä¼ªæ–‡ä»¶ç³»ç»Ÿåç§°ï¼šproc, sysfs
æ¨èç”¨UUIDï¼Œå†™è®¾å¤‡åçš„å¯èƒ½ä¸ç¨³å®šï¼Œå°¤å…¶æ˜¯é€»è¾‘å·ï¼ŒåŸæ¥æ˜¯5ï¼Œ6æŠŠ5åˆ é™¤äº†6å°±å˜æˆäº†5
</pre></li>

<li>æŒ‚è½½ç‚¹ï¼šå¿…é¡»æ˜¯äº‹å…ˆå­˜åœ¨çš„ç›®å½•</li>

<li>æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼šext4ï¼Œxfsï¼Œiso9660ï¼Œnfsï¼Œnone</li>

<li>æŒ‚è½½é€‰é¡¹ï¼šdefaults ï¼Œaclï¼Œbind</li>

<li>å¤‡ä»½é¢‘ç‡ï¼š0ï¼šä¸åšå¤‡ä»½ 1ï¼šæ¯å¤©è½¬å‚¨ 2ï¼šæ¯éš”ä¸€å¤©è½¬å‚¨ã€‚åŸºäºåˆ†åŒºçš„å¤‡ä»½ä¸€èˆ¬ä¸ç”¨ï¼Œå†™0å°±å¥½</li>

<li>fsckæ£€æŸ¥çš„æ–‡ä»¶ç³»ç»Ÿçš„é¡ºåºï¼šå…è®¸çš„æ•°å­—æ˜¯0 1 2 ã€‚ 0ï¼šä¸è‡ªæ£€ï¼Œ1ï¼šé¦–å…ˆè‡ªæ£€ï¼›ä¸€èˆ¬åªæœ‰rootfsæ‰ç”¨ 2ï¼šérootfsä½¿ç”¨</li>
</ol>

<p>
æ·»åŠ æ–°çš„æŒ‚è½½é¡¹ï¼Œéœ€è¦æ‰§è¡Œä¸‹é¢å‘½ä»¤ç”Ÿæ•ˆ
</p>
<div class="org-src-container">
<pre class="src src-sh">mount -a
</pre>
</div>

<p>
èŒƒä¾‹ï¼švimè¯»ä¹¦å…¥è®¾å¤‡ä¿¡æ¯
</p>

<div class="org-src-container">
<pre class="src src-sh">vim /etc/fstab
:r!blkid /dev/sdb1
</pre>
</div>

<p>
èŒƒä¾‹ï¼šcentos7, 8 /etc/fstab çš„åˆ†åŒºUUIDé”™è¯¯ï¼Œæ— æ³•å¯åŠ¨
</p>

<div class="org-src-container">
<pre class="src src-sh">&#33258;&#21160;&#36827;&#20837;emergency mode&#25925;&#38556;&#27169;&#24335;,&#36755;&#20837;root &#23494;&#30721;
<span style="color: #b22222;">#</span><span style="color: #b22222;">cat /proc/mounts &#21487;&#20197;&#26597;&#30475;&#21040;/ &#20197;rw&#26041;&#24335;&#25346;&#36733;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">vim /etc/fstab</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">reboot</span>
</pre>
</div>

<p>
èŒƒä¾‹ï¼šcentos 6 /etc/fstab çš„åˆ†åŒºUUIDé”™è¯¯ï¼Œæ— æ³•å¯åŠ¨
</p>

<div class="org-src-container">
<pre class="src src-sh">&#22914;&#26524;/etc/fstab &#30340;&#25346;&#36733;&#35774;&#22791;&#20986;&#38169;&#65292;&#27604;&#22914;&#25991;&#20214;&#31995;&#32479;&#25925;&#38556;&#65292;&#24182;&#19988;&#25991;&#20214;&#31995;&#32479;&#26816;&#27979;&#39033;&#65288;&#21363;&#31532;6&#39033;&#20026;&#38750;0&#65289;&#65292;&#23558;&#23548;&#33268;&#26080;&#27861;&#21551;&#21160;

&#33258;&#21160;&#36827;&#20837;emergency mode,&#36755;&#20837;root &#23494;&#30721;
<span style="color: #b22222;">#</span><span style="color: #b22222;">cat /proc/mounts &#21487;&#20197;&#26597;&#30475;&#21040;/ &#20197;ro&#26041;&#24335;&#25346;&#36733;&#65292;&#26080;&#27861;&#30452;&#25509;&#20462;&#25913;&#37197;&#32622;&#25991;&#20214;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">mount -o remount,rw /</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">vim /etc/fstab</span>
&#23558;&#25925;&#38556;&#34892;&#30340;&#26368;&#21518;1&#39033;&#65292;&#21363;&#31532;6&#39033;&#20462;&#25913;&#20026;0&#65292;&#24320;&#26426;&#19981;&#26816;&#27979;&#27492;&#39033;&#25346;&#36733;&#35774;&#22791;&#30340;&#20581;&#24247;&#24615;&#65292;&#20174;&#32780;&#24573;&#30053;&#38169;&#35823;&#65292;&#33021;&#23454;&#29616;&#21551;&#21160;
</pre>
</div>

<p>
èŒƒä¾‹ï¼š/etc/fstabæ ¼å¼
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /etc/fstab
<span style="color: #a0522d;">UUID</span>=cb7cae1e-d227-4f64-872b-cd6cce20c911 /data/mysql  ext4  noatime    0 0
/disk.img data/disk   xfs   defaults    0 0
/etc      /mnt/etc                 none  bind      0 0 

[root@centos6 ~]#cat /etc/fstab
/disk.img        /mnt/disk       ext4   loop       0 0
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:a098f076-559a-4920-b220-8960eb56ecdc" class="outline-3">
<h3 id="h:a098f076-559a-4920-b220-8960eb56ecdc">å¤„ç†äº¤æ¢æ–‡ä»¶å’Œåˆ†åŒº</h3>
<div class="outline-text-3" id="text-h:a098f076-559a-4920-b220-8960eb56ecdc">
</div>
<div id="outline-container-h:7470583d-3528-4316-b425-04624cc37c66" class="outline-4">
<h4 id="h:7470583d-3528-4316-b425-04624cc37c66">swap ä»‹ç»</h4>
<div class="outline-text-4" id="text-h:7470583d-3528-4316-b425-04624cc37c66">
<p>
å½“å†…å­˜ä¸è¶³æ—¶ï¼Œç”¨ç£ç›˜æ¨¡æ‹Ÿå†…å­˜ä½¿ç”¨ï¼Œé€Ÿåº¦å¾ˆæ…¢
</p>

<p>
swapäº¤æ¢åˆ†åŒºæ˜¯ç³»ç»ŸRAMçš„è¡¥å……ï¼Œswap åˆ†åŒºæ”¯æŒè™šæ‹Ÿå†…å­˜ã€‚å½“æ²¡æœ‰è¶³å¤Ÿçš„ RAMä¿
å­˜ç³»ç»Ÿå¤„ç†çš„æ•°æ®æ—¶ä¼šå°†æ•°æ®å†™å…¥ swap åˆ†åŒºï¼Œå½“ç³»ç»Ÿç¼ºä¹ swapç©ºé—´æ—¶ï¼Œå†…æ ¸
ä¼šå›  RAM å†…å­˜è€—å°½è€Œç»ˆæ­¢è¿›ç¨‹ã€‚é…ç½®è¿‡å¤š swapç©ºé—´ä¼šé€ æˆå­˜å‚¨è®¾å¤‡å¤„äºåˆ†é…çŠ¶
æ€ä½†é—²ç½®ï¼Œé€ æˆæµªè´¹ï¼Œè¿‡å¤š swapç©ºé—´è¿˜ä¼šæ©ç›–å†…å­˜æ³„éœ²
</p>

<p>
æ³¨æ„ï¼šä¸ºä¼˜åŒ–æ€§èƒ½ï¼Œå¯ä»¥å°†swap åˆ†å¸ƒå­˜æ”¾ï¼Œæˆ–é«˜æ€§èƒ½ç£ç›˜å­˜æ”¾
</p>

<p>
<b>å®˜æ–¹æ¨èæ¨èç³»ç»Ÿ swap ç©ºé—´</b>
</p>

<ul class="org-ul">
<li><a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/installation_guide/sect-disk-partitioning-setup-ppc#sect-recommended-partitioning-scheme-ppc">https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/installation_guide/sect-disk-partitioning-setup-ppc#sect-recommended-partitioning-scheme-ppc</a></li>
</ul>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">ç³»ç»Ÿä¸­çš„ RAM é‡</th>
<th scope="col" class="org-left">æ¨èçš„ swap ç©ºé—´</th>
<th scope="col" class="org-left">å…è®¸ä¼‘çœ çš„å»ºè®® swap ç©ºé—´å¤§å°</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">ä½äº 2 GB</td>
<td class="org-left">RAM é‡çš„2å€æ•°</td>
<td class="org-left">RAM å®¹é‡çš„ä¸‰å€</td>
</tr>

<tr>
<td class="org-left">2 GB - 8 GB</td>
<td class="org-left">ç­‰äº RAM é‡</td>
<td class="org-left">RAM é‡çš„å€æ•°</td>
</tr>

<tr>
<td class="org-left">8 GB - 64 GB</td>
<td class="org-left">4 GB åˆ° RAM å®¹é‡çš„ 0.5 å€</td>
<td class="org-left">RAM å®¹é‡çš„ 1.5 å€</td>
</tr>

<tr>
<td class="org-left">è¶…è¿‡ 64 GB</td>
<td class="org-left">ç‹¬ç«‹è´Ÿè½½ï¼ˆè‡³å°‘ 4GBï¼‰</td>
<td class="org-left">ä¸å»ºè®®ä½¿ç”¨ä¼‘çœ åŠŸèƒ½</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-h:1b8a44ce-deb5-4e21-a31b-71f26a8ce1c6" class="outline-4">
<h4 id="h:1b8a44ce-deb5-4e21-a31b-71f26a8ce1c6">äº¤æ¢åˆ†åŒºå®ç°è¿‡ç¨‹</h4>
<div class="outline-text-4" id="text-h:1b8a44ce-deb5-4e21-a31b-71f26a8ce1c6">
<ol class="org-ol">
<li>åˆ›å»ºäº¤æ¢åˆ†åŒºæˆ–è€…æ–‡ä»¶</li>
<li>ä½¿ç”¨mkswapå†™å…¥ç‰¹æ®Šç­¾å</li>
<li>åœ¨/etc/fstabæ–‡ä»¶ä¸­æ·»åŠ é€‚å½“çš„æ¡ç›®</li>
<li>ä½¿ç”¨swapon -a æ¿€æ´»äº¤æ¢ç©ºé—´</li>
</ol>

<p>
å¯ç”¨swapåˆ†åŒº
</p>

<div class="org-src-container">
<pre class="src src-sh">swapon [OPTION]... [DEVICE]

&#36873;&#39033;&#65306;
-a                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#28608;&#27963;&#25152;&#26377;&#30340;&#20132;&#25442;&#20998;&#21306;</span>
-p PRIORITY   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450;&#20248;&#20808;&#32423;&#65292;&#20063;&#21487;&#22312;/etc/fstab &#22312;&#31532;4&#21015;&#25351;&#23450;&#65306;pri=value</span>
-s                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;</span>
</pre>
</div>

<p>
èŒƒä¾‹: ä»¥ç£ç›˜åˆ†åŒºæ–¹å¼åˆ›å»ºswap
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#echo -e <span style="color: #8b2252;">'n\np\n\n\n+2G\nt\n82\nw\n'</span> | fdisk /dev/sdc
[root@centos8 ~]#mkswap /dev/sdc1
Setting up swapspace version 1, <span style="color: #a0522d;">size</span> = 2 GiB (2147479552 bytes)
no label, <span style="color: #a0522d;">UUID</span>=d3140a7a-65b7-4cb7-8a2b-12d38aa98c6f
[root@centos8 ~]#blkid /dev/sdc1
/dev/sdc1: <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"d3140a7a-65b7-4cb7-8a2b-12d38aa98c6f"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"swap"</span>
<span style="color: #a0522d;">PARTUUID</span>=<span style="color: #8b2252;">"b094d43d-01</span>

<span style="color: #8b2252;">[root@centos8 ~]#vim /etc/fstab</span>
<span style="color: #8b2252;">UUID=d3140a7a-65b7-4cb7-8a2b-12d38aa98c6f swap     swap defaults 0 0</span>

<span style="color: #8b2252;">[root@centos8 ~]#swapon -a</span>
<span style="color: #8b2252;">[root@centos8 ~]#free -h</span>
<span style="color: #8b2252;">      total    used    free   shared buff/cache  available</span>
<span style="color: #8b2252;">Mem:      3.7Gi    264Mi    3.2Gi    9.0Mi    261Mi    3.2Gi</span>
<span style="color: #8b2252;">Swap:     4.0Gi     0B    4.0Gi</span>
<span style="color: #8b2252;">[root@centos8 ~]#cat /proc/swaps</span>
<span style="color: #8b2252;">Filename Type Size Used Priority</span>
<span style="color: #8b2252;">/dev/sda5                partition 2097148 0 -2</span>
<span style="color: #8b2252;">/dev/sdc1                partition 2097148 0 -3</span>
</pre>
</div>

<p>
èŒƒä¾‹ï¼šä»¥æ–‡ä»¶æ–¹å¼åˆ›å»ºswap
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;&#19968;&#20010;&#29992;&#20110;&#20132;&#25442;&#30340;&#25991;&#20214;</span>
fallocate -l 1G /swapfile
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25110;&#32773;&#20351;&#29992;dd&#21019;&#24314;&#20132;&#25442;&#25991;&#20214;</span>
dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/swapfile <span style="color: #a0522d;">bs</span>=1M <span style="color: #a0522d;">count</span>=1024

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622;&#27491;&#30830;&#30340;&#26435;&#38480;</span>
chmod 600 /swapfile

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622;Linux&#20132;&#25442;&#21306;&#25991;&#20214;&#31995;&#32479;</span>
mkswap /swapfile

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#29992;&#20132;&#25442;</span>
swapon /swapfile
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27704;&#20037;&#35774;&#32622;&#65292;&#25171;&#24320;/etc/fstab</span>
cat &lt;&lt;\EOF&gt;&gt; /etc/fstab
<span style="color: #ffa54f;">/swapfile swap swap defaults 0 0</span>
<span style="color: #ffa54f;">EOF</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26816;&#26597;</span>
swapon -s
free -m

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500;&#20132;&#25442;&#25991;&#20214;</span>
swapoff -v /swapfile
</pre>
</div>


<p>
ç¦ç”¨swapåˆ†åŒºï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">swapoff [OPTION]... [DEVICE]
</pre>
</div>

<p>
èŒƒä¾‹:ç¦ç”¨swapåˆ†åŒº
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#sed -i.bak <span style="color: #8b2252;">'/swap/d'</span> /etc/fstab
[root@centos8 ~]#swapoff -a
</pre>
</div>

<p>
<b>SWAPçš„ä¼˜å…ˆçº§</b>
</p>

<p>
å¯ä»¥æŒ‡å®šswapåˆ†åŒº0åˆ°32767çš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜
</p>

<p>
å¦‚æœç”¨æˆ·æ²¡æœ‰æŒ‡å®šï¼Œé‚£ä¹ˆæ ¸å¿ƒä¼šè‡ªåŠ¨ç»™swapæŒ‡å®šä¸€ä¸ªä¼˜å…ˆçº§ï¼Œè¿™ä¸ªä¼˜å…ˆçº§ä»-1å¼€
å§‹ï¼Œæ¯åŠ å…¥ä¸€ä¸ªæ–°çš„
</p>

<p>
æ²¡æœ‰ç”¨æˆ·æŒ‡å®šä¼˜å…ˆçº§çš„swapï¼Œä¼šç»™è¿™ä¸ªä¼˜å…ˆçº§å‡ä¸€
</p>

<p>
å…ˆæ·»åŠ çš„swapçš„ç¼ºçœä¼˜å…ˆçº§æ¯”è¾ƒé«˜ï¼Œé™¤éç”¨æˆ·è‡ªå·±æŒ‡å®šä¸€ä¸ªä¼˜å…ˆçº§ï¼Œè€Œç”¨æˆ·æŒ‡å®š
çš„ä¼˜å…ˆçº§(æ˜¯æ­£æ•°)æ°¸è¿œé«˜äºæ ¸å¿ƒç¼ºçœæŒ‡å®šçš„ä¼˜å…ˆçº§(æ˜¯è´Ÿæ•°)
</p>
</div>
</div>
<div id="outline-container-h:f6966f45-4165-419c-94b5-6274d9f00302" class="outline-4">
<h4 id="h:f6966f45-4165-419c-94b5-6274d9f00302">swapçš„ä½¿ç”¨ç­–ç•¥</h4>
<div class="outline-text-4" id="text-h:f6966f45-4165-419c-94b5-6274d9f00302">
<p>
/proc/sys/vm/swappiness
çš„å€¼å†³å®šäº†å½“å†…å­˜å ç”¨è¾¾åˆ°ä¸€å®šçš„ç™¾åˆ†æ¯”æ—¶ï¼Œä¼šå¯ç”¨swapåˆ†åŒºçš„ç©ºé—´
</p>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]# cat /proc/sys/vm/swappiness
30
[root@rhel5 ~]# cat /proc/sys/vm/swappiness
60
</pre>
</div>

<p>
è¯´æ˜ï¼šå†…å­˜åœ¨ä½¿ç”¨åˆ°100-30=70%çš„æ—¶å€™ï¼Œå°±å¼€å§‹å‡ºç°æœ‰äº¤æ¢åˆ†åŒºçš„ä½¿ç”¨ã€‚ç®€å•åœ°
è¯´è¿™ä¸ªå‚æ•°å®šä¹‰äº†ç³»ç»Ÿå¯¹swapçš„ä½¿ç”¨å€¾å‘ï¼Œé»˜è®¤å€¼ä¸º30ï¼Œå€¼è¶Šå¤§è¡¨ç¤ºè¶Šå€¾å‘äºä½¿
ç”¨swapã€‚å¯ä»¥è®¾ä¸º0ï¼Œè¿™æ ·åšå¹¶ä¸ä¼šç¦æ­¢å¯¹swapçš„ä½¿ç”¨ï¼Œåªæ˜¯æœ€å¤§é™åº¦åœ°é™ä½äº†
ä½¿ç”¨swapçš„å¯èƒ½æ€§
</p>
</div>
</div>
</div>
<div id="outline-container-h:2ed19f37-bf19-41df-adba-657193b1f13b" class="outline-3">
<h3 id="h:2ed19f37-bf19-41df-adba-657193b1f13b">ç§»åŠ¨ä»‹è´¨</h3>
<div class="outline-text-3" id="text-h:2ed19f37-bf19-41df-adba-657193b1f13b">
<p>
æŒ‚è½½æ„å‘³ç€ä½¿å¤–æ¥çš„æ–‡ä»¶ç³»ç»Ÿçœ‹èµ·æ¥å¦‚åŒæ˜¯ä¸»ç›®å½•æ ‘çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€æœ‰ç§»åŠ¨ä»‹è´¨ä¹Ÿ
éœ€è¦æŒ‚è½½ï¼ŒæŒ‚è½½ç‚¹é€šå¸¸åœ¨/mediaæˆ–/mntä¸‹
</p>

<p>
è®¿é—®å‰ï¼Œä»‹è´¨å¿…é¡»è¢«æŒ‚è½½
</p>

<p>
æ‘˜é™¤æ—¶ï¼Œä»‹è´¨å¿…é¡»è¢«å¸è½½
</p>

<p>
æŒ‰ç…§é»˜è®¤è®¾ç½®ï¼Œéæ ¹ç”¨æˆ·åªèƒ½æŒ‚è½½æŸäº›è®¾å¤‡ï¼ˆå…‰ç›˜ã€DVDã€è½¯ç›˜ã€USBç­‰ç­‰ï¼‰
</p>
</div>
<div id="outline-container-h:4da950f8-5acb-4af0-947d-dd90f63a069e" class="outline-4">
<h4 id="h:4da950f8-5acb-4af0-947d-dd90f63a069e">ä½¿ç”¨å…‰ç›˜</h4>
<div class="outline-text-4" id="text-h:4da950f8-5acb-4af0-947d-dd90f63a069e">
<p>
åœ¨å›¾å½¢ç¯å¢ƒä¸‹è‡ªåŠ¨å¯åŠ¨æŒ‚è½½/run/media/&lt;user&gt;/&lt;label&gt;
</p>

<p>
æ‰‹å·¥æŒ‚è½½
</p>
<div class="org-src-container">
<pre class="src src-sh">mount /dev/cdrom /mnt/
</pre>
</div>

<p>
æ“ä½œå…‰ç›˜
</p>
<div class="org-src-container">
<pre class="src src-sh">eject           <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24377;&#20986;&#20809;&#30424;</span>
eject -t       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24377;&#20837;&#20809;&#30424;</span>
</pre>
</div>

<p>
åˆ›å»ºISOæ–‡ä»¶
</p>
<div class="org-src-container">
<pre class="src src-sh">cp /dev/cdrom /root/centos.iso
mkisofs -r -o /root/etc.iso /etc <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26469;&#33258;&#20110;genisoimage&#21253;</span>
</pre>
</div>

<p>
åˆ»å½•å…‰ç›˜
</p>
<div class="org-src-container">
<pre class="src src-sh">wodim &#8211;v &#8211;eject centos.iso
</pre>
</div>

<p>
<b>å°†ISOåˆ¶ä½œä¸ºUç›˜å·¥å…·Rufus</b>
</p>

<p>
Rufus æ˜¯å¼€æºå…è´¹çš„å¿«é€Ÿåˆ¶ä½œUç›˜å’Œæ ¼å¼åŒ–USBçš„å®ç”¨å°å·¥å…·ï¼Œå®ƒå¯ä»¥å¿«é€ŸæŠŠISO
æ ¼å¼çš„ç³»ç»Ÿé•œåƒæ–‡ä»¶å¿«é€Ÿåˆ¶ä½œæˆå¯å¼•å¯¼çš„USBå¯åŠ¨å®‰è£…ç›˜ï¼Œæ”¯æŒWindowsæˆ–Linux
å¯åŠ¨ã€‚è½¯ä»¶ä½“ç§¯ä»…700å¤šKBï¼Œéº»é›€è™½å°ï¼Œä½†äº”è„ä¿±å…¨ï¼
</p>
</div>
</div>
<div id="outline-container-h:f755173b-d9fb-4a64-82ce-986a0f53f1c2" class="outline-4">
<h4 id="h:f755173b-d9fb-4a64-82ce-986a0f53f1c2">USBä»‹è´¨</h4>
<div class="outline-text-4" id="text-h:f755173b-d9fb-4a64-82ce-986a0f53f1c2">
<p>
æŸ¥çœ‹USBè®¾å¤‡æ˜¯å¦è¯†åˆ«
</p>

<div class="org-src-container">
<pre class="src src-sh">lsusb   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26469;&#33258;&#20110;usbutils&#21253;</span>
</pre>
</div>

<p>
è¢«å†…æ ¸æ¢æµ‹ä¸ºSCSIè®¾å¤‡ï¼Œè¡¨ç°ä¸º/dev/sdaX ã€ /dev/sdbX æˆ–ç±»ä¼¼çš„è®¾å¤‡æ–‡ä»¶
</p>

<p>
åœ¨å›¾å½¢ç¯å¢ƒä¸­è‡ªåŠ¨æŒ‚è½½åœ¨/run/media/&lt;user&gt;/&lt;label&gt;
</p>

<p>
æ‰‹åŠ¨æŒ‚è½½
</p>

<div class="org-src-container">
<pre class="src src-sh">mount /dev/sdX# /mnt
</pre>
</div>

<p>
èŒƒä¾‹ï¼šæ’å…¥Uç›˜åå¯ä»¥çœ‹åˆ°æ—¥å¿—ä¿¡æ¯
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">tail /var/log/messages -f</span>
dmesg
</pre>
</div>

<p>
èŒƒä¾‹ï¼šæ ¼å¼åŒ–Uç›˜ä¸º FAT32 æ–‡ä»¶ç³»ç»Ÿ
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#dnf -y install dosfstools
[root@centos8 ~]#mkfs.vfat /dev/sdd1
mkfs.fat 4.1 (2017-01-24)
[root@centos8 ~]#mount /dev/sdd1 /mnt
</pre>
</div>

<p>
èŒƒä¾‹ï¼šæŸ¥çœ‹USBè®¾å¤‡
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#yum -y install usbutils
[root@centos8 ~]#lsusb
Bus 004 Device 002: ID 0951:1666 Kingston Technology DataTraveler 100 G3/G4/SE9G2
Bus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 003: ID 0e0f:0002 VMware, Inc. Virtual USB Hub
Bus 002 Device 002: ID 0e0f:0003 VMware, Inc. Virtual Mouse
Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
</pre>
</div>
</div>
<div id="outline-container-h:e9a55927-6e9c-41f9-964a-3c5ec441b36d" class="outline-5">
<h5 id="h:e9a55927-6e9c-41f9-964a-3c5ec441b36d">åˆ¶ä½œUç›˜å¯åŠ¨å®‰è£…CentOS</h5>
<div class="outline-text-5" id="text-h:e9a55927-6e9c-41f9-964a-3c5ec441b36d">
<p>
æ–¹æ³•ä¸€ï¼šä½¿ç”¨UltraISOï¼Œå°†uç›˜åšæˆå¯åŠ¨ç›˜
</p>

<p>
1.æ–‡ä»¶&#x2013;&gt;æ‰“å¼€&#x2013;&gt;é€‰æ‹©CentOS6.6çš„isoé•œåƒCentOS-6.6-x86_64-bin-DVD1.iso
</p>


<figure id="orgeaf0365">
<img src="images/image-20210310162916285.png" alt="image-20210310162916285.png" width="80%">

</figure>


<figure id="org3d4ad05">
<img src="images/image-20210310162928701.png" alt="image-20210310162928701.png" width="80%">

</figure>

<p>
2.å¯åŠ¨&#x2013;&gt;å†™å…¥ç¡¬ç›˜æ˜ åƒ
</p>


<figure id="org2778782">
<img src="images/image-20210310162943318.png" alt="image-20210310162943318.png" width="80%">

</figure>


<figure id="org9f000b8">
<img src="images/image-20210310162956163.png" alt="image-20210310162956163.png" width="80%">

</figure>
</div>
</div>
</div>
</div>
<div id="outline-container-h:87b6ab89-195e-4106-92f1-8302c0cf7544" class="outline-3">
<h3 id="h:87b6ab89-195e-4106-92f1-8302c0cf7544">ç£ç›˜å¸¸è§å·¥å…·</h3>
<div class="outline-text-3" id="text-h:87b6ab89-195e-4106-92f1-8302c0cf7544">
</div>
<div id="outline-container-h:60c75dae-bb03-4e5d-bbd7-0f4e74fe0c11" class="outline-4">
<h4 id="h:60c75dae-bb03-4e5d-bbd7-0f4e74fe0c11">æ–‡ä»¶ç³»ç»Ÿç©ºé—´å ç”¨ç­‰ä¿¡æ¯çš„æŸ¥çœ‹å·¥å…·df</h4>
<div class="outline-text-4" id="text-h:60c75dae-bb03-4e5d-bbd7-0f4e74fe0c11">
<div class="org-src-container">
<pre class="src src-sh">df [OPTION]... [FILE]...

&#24120;&#29992;&#36873;&#39033;
-H    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;10&#20026;&#21333;&#20301;</span>
-T     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25991;&#20214;&#31995;&#32479;&#31867;&#22411;</span>
-h     <span style="color: #b22222;">#</span><span style="color: #b22222;">human-readable</span>
-i      <span style="color: #b22222;">#</span><span style="color: #b22222;">inodes instead of blocks</span>
-P     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;Posix&#20860;&#23481;&#30340;&#26684;&#24335;&#36755;&#20986;&#12290;&#26684;&#24335;&#25972;&#40784;&#20123;&#65292;&#24403;&#35774;&#22791;&#21517;&#27604;&#36739;&#38271;&#26102;&#21487;&#20197;&#25918;&#19968;&#34892;&#26174;&#31034;&#12290;</span>
</pre>
</div>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#df -Th
Filesystem   Type   Size Used Avail Use% Mounted on
/dev/sda2   xfs    100G  2.7G  98G  3% /
/dev/sda3   xfs    50G  1.4G  49G  3% /data

[root@centos8 ~]#lsblk -f
NAME  FSTYPE LABEL           UUID                
MOUNTPOINT
sda                                      
&#9500;&#9472;sda1 ext4                5c2216e3-ae34-444e-aa60-83cbaebb47e7
/boot
&#9500;&#9472;sda2 xfs                f7f53add-b184-4ddc-8d2c-5263b84d1e15 /
&#9500;&#9472;sda3 xfs                9a2293a8-9277-4b18-bae1-498e0b9da145
</pre>
</div>

<p>
èŒƒä¾‹ï¼šè‡ªåŠ¨è¯†åˆ«ç›®å½•æ‰€åœ¨ç£ç›˜ df -kP /path
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">df -h</span>
Filesystem                   Size  Used Avail Use% Mounted on
/dev/vda1                     40G   13G   25G  35% /
devtmpfs                     3.7G     0  3.7G   0% /dev
tmpfs                        3.7G     0  3.7G   0% /dev/shm
tmpfs                        3.7G  484K  3.7G   1% /run
tmpfs                        3.7G     0  3.7G   0% /sys/fs/cgroup
/dev/mapper/vg_data-lv_data   89G  2.5G   82G   3% /apps

<span style="color: #b22222;"># </span><span style="color: #b22222;">df -kP /tmp</span>
Filesystem     1024-blocks     Used Available Capacity Mounted on
/dev/vda1         41147472 13424504  25819476      35% /

[root@ali-prod-ops-k8s-kubectl ~] <span style="color: #a0522d;">eth0</span> = 10.16.202.198
<span style="color: #b22222;"># </span><span style="color: #b22222;">df -kP /apps</span>
Filesystem                  1024-blocks    Used Available Capacity Mounted on
/dev/mapper/vg_data-lv_data    92759720 2600600  85424144       3% /apps
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a4448b54-3e98-49fa-9d25-42cd0304ee83" class="outline-4">
<h4 id="h:a4448b54-3e98-49fa-9d25-42cd0304ee83">æŸ¥çœ‹æŸç›®å½•æ€»ä½“ç©ºé—´å ç”¨çŠ¶æ€du</h4>
<div class="outline-text-4" id="text-h:a4448b54-3e98-49fa-9d25-42cd0304ee83">
<div class="org-src-container">
<pre class="src src-sh">du [OPTION]... DIR

&#24120;&#29992;&#36873;&#39033;
-h   <span style="color: #b22222;">#</span><span style="color: #b22222;">human-readable</span>
-s   <span style="color: #b22222;">#</span><span style="color: #b22222;">summary </span>
--max-depth=#  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450;&#26368;&#22823;&#30446;&#24405;&#23618;&#32423;</span>

&#20854;&#20182;
--exclude=[files] : &#25490;&#38500;&#21305;&#37197;&#25991;&#20214;&#25110;&#25991;&#20214;&#22841;
-a: &#36882;&#24402;&#26174;&#31034;&#25351;&#23450;&#30446;&#24405;&#20013;&#21508;&#25991;&#20214;&#21644;&#23376;&#30446;&#24405;&#20013;&#25991;&#20214;&#21344;&#29992;&#30340;&#25968;&#25454;&#22359;
-l: &#35745;&#31639;&#25152;&#26377;&#25991;&#20214;&#22823;&#23567;&#65292;&#23545;&#30828;&#38142;&#25509;&#25991;&#20214;&#35745;&#31639;&#22810;&#27425;
</pre>
</div>
</div>
<div id="outline-container-h:c8bdfb52-947b-4763-a054-05047366c079" class="outline-5">
<h5 id="h:c8bdfb52-947b-4763-a054-05047366c079">dfå’Œduçš„åŒºåˆ«</h5>
<div class="outline-text-5" id="text-h:c8bdfb52-947b-4763-a054-05047366c079">
<ul class="org-ul">
<li>df æŸ¥çœ‹çš„æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„ç©ºé—´ä½¿ç”¨ï¼ŒåŒ…æ‹¬å…ƒæ•°æ®å’Œæ•°æ®ã€‚åˆ é™¤æ–‡ä»¶åï¼Œå¦‚æœæ­¤æ–‡ä»¶æ­£åœ¨ä½¿ç”¨ï¼Œä¸ä¼šç«‹å³é‡Šæ”¾ç©ºé—´</li>
<li>du æŸ¥çœ‹çš„æ˜¯æ–‡ä»¶æ•°æ®ç©ºé—´ä½¿ç”¨ï¼Œä¸åŒ…æ‹¬å…ƒæ•°æ®ã€‚åˆ é™¤æ–‡ä»¶åç©ºé—´ç«‹å³é‡Šæ”¾ã€‚</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:bbda5d5b-62fe-415f-962d-bd0e74352285" class="outline-4">
<h4 id="h:bbda5d5b-62fe-415f-962d-bd0e74352285">å·¥å…·dd</h4>
<div class="outline-text-4" id="text-h:bbda5d5b-62fe-415f-962d-bd0e74352285">
<p>
dd å‘½ä»¤ï¼šconvert and copy a file
</p>

<p>
æ ¼å¼ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">dd <span style="color: #a0522d;">if</span>=/PATH/FROM/SRC <span style="color: #a0522d;">of</span>=/PATH/TO/DEST <span style="color: #a0522d;">bs</span>=# <span style="color: #a0522d;">count</span>=#

&#24120;&#29992;&#36873;&#39033;
<span style="color: #a0522d;">if</span>=file               <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20174;&#25152;&#21629;&#21517;&#25991;&#20214;&#35835;&#21462;&#32780;&#19981;&#26159;&#20174;&#26631;&#20934;&#36755;&#20837;</span>
<span style="color: #a0522d;">of</span>=file             <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20889;&#21040;&#25152;&#21629;&#21517;&#30340;&#25991;&#20214;&#32780;&#19981;&#26159;&#21040;&#26631;&#20934;&#36755;&#20986;</span>
<span style="color: #a0522d;">ibs</span>=size           <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#27425;&#35835;size&#20010;byte</span>
<span style="color: #a0522d;">obs</span>=size         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#27425;&#20889;size&#20010;byte</span>
<span style="color: #a0522d;">bs</span>=size           <span style="color: #b22222;">#</span><span style="color: #b22222;">block size, &#25351;&#23450;&#22359;&#22823;&#23567;&#65288;&#26082;&#26159;&#26159;ibs&#20063;&#26159;obs)</span>
<span style="color: #a0522d;">cbs</span>=size         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#27425;&#36716;&#21270;size&#20010;byte</span>
<span style="color: #a0522d;">skip</span>=blocks   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20174;&#24320;&#22836;&#24573;&#30053;blocks&#20010;ibs&#22823;&#23567;&#30340;&#22359;</span>
<span style="color: #a0522d;">seek</span>=blocks  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20174;&#24320;&#22836;&#24573;&#30053;blocks&#20010;obs&#22823;&#23567;&#30340;&#22359;</span>
<span style="color: #a0522d;">count</span>=n         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22797;&#21046;n&#20010;bs</span>
<span style="color: #a0522d;">conv</span>=conversion[,conversion...] <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#25351;&#23450;&#30340;&#21442;&#25968;&#36716;&#25442;&#25991;&#20214;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">conversion &#36716;&#25442;&#21442;&#25968;:</span>
ascii &#36716;&#25442; EBCDIC &#20026; ASCII
ebcdic &#36716;&#25442; ASCII &#20026; EBCDIC
lcase &#25226;&#22823;&#20889;&#23383;&#31526;&#36716;&#25442;&#20026;&#23567;&#20889;&#23383;&#31526;
ucase &#25226;&#23567;&#20889;&#23383;&#31526;&#36716;&#25442;&#20026;&#22823;&#20889;&#23383;&#31526;
nocreat &#19981;&#21019;&#24314;&#36755;&#20986;&#25991;&#20214;
noerror &#20986;&#38169;&#26102;&#19981;&#20572;&#27490;
notrunc &#19981;&#25130;&#30701;&#36755;&#20986;&#25991;&#20214;
sync &#25226;&#27599;&#20010;&#36755;&#20837;&#22359;&#22635;&#20805;&#21040;ibs&#20010;&#23383;&#33410;&#65292;&#19981;&#36275;&#37096;&#20998;&#29992;&#31354;(NUL)&#23383;&#31526;&#34917;&#40784;
fdatasync &#20889;&#23436;&#25104;&#21069;&#65292;&#29289;&#29702;&#20889;&#20837;&#36755;&#20986;&#25991;&#20214;
</pre>
</div>

<p>
ä¸¤ä¸ªç‰¹æ®Šè®¾å¤‡ï¼š
</p>
<ul class="org-ul">
<li>/dev/null: æ•°æ®é»‘æ´ï¼›ç±»ä¼¼äºå›æ”¶ç«™</li>
<li>/dev/zeroï¼šåé›¶æœºï¼›è¯¥è®¾å¤‡æ— ç©·å°½åœ°æä¾›0,ï¼ˆä¸äº§ç”Ÿè¯»ç£ç›˜IOï¼‰</li>
</ul>

<p>
èŒƒä¾‹:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat f1.txt;
abcdef
[root@centos8 ~]#cat f2.txt
123456789
[root@centos8 ~]#dd <span style="color: #a0522d;">if</span>=f1.txt <span style="color: #a0522d;">of</span>=f2.txt <span style="color: #a0522d;">bs</span>=1 <span style="color: #a0522d;">count</span>=2 <span style="color: #a0522d;">skip</span>=3 <span style="color: #a0522d;">seek</span>=4 
2+0 records<span style="color: #a020f0;"> in</span>
2+0 records out
2 bytes copied, 6.6515e-05 s, 30.1 kB/s
[root@centos8 ~]#cat f2.txt
1234de[root@centos8 ~]#echo 123456789 &gt; f2.txt
[root@centos8 ~]#cat f2.txt
123456789
[root@centos8 ~]#cat f1.txt
abcdef
[root@centos8 ~]#cat f1.txt; cat f2.txt
abcdef
123456789
[root@centos8 ~]#dd <span style="color: #a0522d;">if</span>=f1.txt <span style="color: #a0522d;">of</span>=f2.txt <span style="color: #a0522d;">bs</span>=1 <span style="color: #a0522d;">count</span>=2 <span style="color: #a0522d;">skip</span>=3 <span style="color: #a0522d;">seek</span>=4 <span style="color: #a0522d;">conv</span>=notrunc
2+0 records<span style="color: #a020f0;"> in</span>
2+0 records out
2 bytes copied, 7.6153e-05 s, 26.3 kB/s
[root@centos8 ~]#cat f2.txt
1234de789
</pre>
</div>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#22791;&#20221;MBR</span>
dd <span style="color: #a0522d;">if</span>=/dev/sda <span style="color: #a0522d;">of</span>=/tmp/mbr.bak <span style="color: #a0522d;">bs</span>=512 <span style="color: #a0522d;">count</span>=1

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#30772;&#22351;MBR&#20013;&#30340;bootloader</span>
dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/dev/sda <span style="color: #a0522d;">bs</span>=64 <span style="color: #a0522d;">count</span>=1 <span style="color: #a0522d;">seek</span>=446

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#19968;&#20010;&#22823;&#19982;2K&#30340;&#20108;&#36827;&#21046;&#25991;&#20214;fileA&#12290;&#29616;&#22312;&#24819;&#20174;&#31532;64&#20010;&#23383;&#33410;&#20301;&#32622;&#24320;&#22987;&#35835;&#21462;&#65292;&#38656;&#35201;&#35835;&#21462;&#30340;&#22823;&#23567;&#26159;128Byts&#12290;&#21448;&#26377;fileB, &#24819;&#25226;&#19978;&#38754;&#35835;&#21462;&#21040;&#30340;128Bytes&#20889;&#21040;&#31532;32&#20010;&#23383;&#33410;&#24320;&#22987;&#30340;&#20301;&#32622;&#65292;&#26367;&#25442;128Bytes&#65292;&#23454;&#29616;&#22914;&#19979;</span>
dd <span style="color: #a0522d;">if</span>=fileA <span style="color: #a0522d;">of</span>=fileB <span style="color: #a0522d;">bs</span>=1 <span style="color: #a0522d;">count</span>=128 <span style="color: #a0522d;">skip</span>=63 <span style="color: #a0522d;">seek</span>=31 <span style="color: #a0522d;">conv</span>=notrunc

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#26412;&#22320;&#30340;/dev/sdx&#25972;&#30424;&#22791;&#20221;&#21040;/dev/sdy</span>
dd <span style="color: #a0522d;">if</span>=/dev/sdx <span style="color: #a0522d;">of</span>=/dev/sdy

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;/dev/sdx&#20840;&#30424;&#25968;&#25454;&#22791;&#20221;&#21040;&#25351;&#23450;&#36335;&#24452;&#30340;image&#25991;&#20214;</span>
dd <span style="color: #a0522d;">if</span>=/dev/sdx <span style="color: #a0522d;">of</span>=/path/to/image

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22791;&#20221;/dev/sdx&#20840;&#30424;&#25968;&#25454;&#65292;&#24182;&#21033;&#29992;gzip&#21387;&#32553;&#65292;&#20445;&#23384;&#21040;&#25351;&#23450;&#36335;&#24452;</span>
dd <span style="color: #a0522d;">if</span>=/dev/sdx | gzip &gt;/path/to/image.gz

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#22791;&#20221;&#25991;&#20214;&#24674;&#22797;&#21040;&#25351;&#23450;&#30424;</span>
dd <span style="color: #a0522d;">if</span>=/path/to/image <span style="color: #a0522d;">of</span>=/dev/sdx

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#21387;&#32553;&#30340;&#22791;&#20221;&#25991;&#20214;&#24674;&#22797;&#21040;&#25351;&#23450;&#30424;</span>
gzip -dc /path/to/image.gz | dd <span style="color: #a0522d;">of</span>=/dev/sdx

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#20869;&#23384;&#37324;&#30340;&#25968;&#25454;&#25335;&#36125;&#21040;root&#30446;&#24405;&#19979;&#30340;mem.bin&#25991;&#20214;</span>
dd <span style="color: #a0522d;">if</span>=/dev/mem <span style="color: #a0522d;">of</span>=/root/mem.bin <span style="color: #a0522d;">bs</span>=1024

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25335;&#36125;&#20809;&#30424;&#25968;&#25454;&#21040;root&#25991;&#20214;&#22841;&#19979;&#65292;&#24182;&#20445;&#23384;&#20026;cdrom.iso&#25991;&#20214;</span>
dd <span style="color: #a0522d;">if</span>=/dev/cdrom <span style="color: #a0522d;">of</span>=/root/cdrom.iso

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#38144;&#27585;&#30913;&#30424;&#25968;&#25454;</span>
dd <span style="color: #a0522d;">if</span>=/dev/urandom <span style="color: #a0522d;">of</span>=/dev/sda1

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#36807;&#27604;&#36739;dd&#25351;&#20196;&#36755;&#20986;&#20013;&#21629;&#20196;&#30340;&#25191;&#34892;&#26102;&#38388;&#65292;&#21363;&#21487;&#30830;&#23450;&#31995;&#32479;&#26368;&#20339;&#30340;block size&#22823;&#23567;</span>
dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/root/1Gb.file <span style="color: #a0522d;">bs</span>=1024 <span style="color: #a0522d;">count</span>=1000000
dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/root/1Gb.file <span style="color: #a0522d;">bs</span>=2048 <span style="color: #a0522d;">count</span>=500000 
dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/root/1Gb.file <span style="color: #a0522d;">bs</span>=4096 <span style="color: #a0522d;">count</span>=250000

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27979;&#35797;&#30828;&#30424;&#20889;&#36895;&#24230;</span>
dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/root/1Gb.file <span style="color: #a0522d;">bs</span>=1024 <span style="color: #a0522d;">count</span>=1000000

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27979;&#35797;&#30828;&#30424;&#35835;&#36895;&#24230;</span>
dd <span style="color: #a0522d;">if</span>=/root/1Gb.file <span style="color: #a0522d;">bs</span>=64k | dd <span style="color: #a0522d;">of</span>=/dev/null
</pre>
</div>

<p>
ç»ƒä¹ 
</p>

<ul class="org-ul">
<li>åˆ›å»ºä¸€ä¸ª2Gçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå—å¤§å°ä¸º2048byteï¼Œé¢„ç•™1%å¯ç”¨ç©ºé—´,æ–‡ä»¶ç³»ç»Ÿext4ï¼Œ
å·æ ‡ä¸ºTESTï¼Œè¦æ±‚æ­¤åˆ†åŒºå¼€æœºåè‡ªåŠ¨æŒ‚è½½è‡³/testç›®å½•ï¼Œä¸”é»˜è®¤æœ‰aclæŒ‚è½½é€‰é¡¹</li>
<li>å†™ä¸€ä¸ªè„šæœ¬ï¼Œå®Œæˆå¦‚ä¸‹åŠŸèƒ½ï¼š
<ol class="org-ol">
<li>åˆ—å‡ºå½“å‰ç³»ç»Ÿè¯†åˆ«åˆ°çš„æ‰€æœ‰ç£ç›˜è®¾å¤‡</li>
<li>å¦‚ç£ç›˜æ•°é‡ä¸º1ï¼Œåˆ™æ˜¾ç¤ºå…¶ç©ºé—´ä½¿ç”¨ä¿¡æ¯
å¦åˆ™ï¼Œåˆ™æ˜¾ç¤ºæœ€åä¸€ä¸ªç£ç›˜ä¸Šçš„ç©ºé—´ä½¿ç”¨ä¿¡æ¯</li>
</ol></li>
<li>å°†CentOS6çš„CentOS-6.10-x86_64-bin-DVD1.isoå’Œ
CentOS-6.10-x86_64-bin-DVD2.isoä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆå¹¶æˆä¸€ä¸ª
CentOS-6.10-x86_64-Everything.isoæ–‡ä»¶ï¼Œå¹¶å°†å…¶é…ç½®ä¸ºyumæº</li>
</ul>
</div>
</div>
</div>
</section>
<section id="outline-container-h:3b73de93-6c86-4841-b593-d3d87883062f" class="outline-2">
<h2 id="h:3b73de93-6c86-4841-b593-d3d87883062f">RAID</h2>
<div class="outline-text-2" id="text-h:3b73de93-6c86-4841-b593-d3d87883062f">
</div>
<div id="outline-container-h:973a4e72-5a73-4da5-aa9f-22ff8accf254" class="outline-3">
<h3 id="h:973a4e72-5a73-4da5-aa9f-22ff8accf254">ä»€ä¹ˆæ˜¯RAID</h3>
<div class="outline-text-3" id="text-h:973a4e72-5a73-4da5-aa9f-22ff8accf254">
<p>
ç‹¬ç«‹ç£ç›˜å†—ä½™é˜µåˆ—(RAID, Redundant Arrays of Independent Disks), æ—§åç§°å«å»‰ä»·ç£ç›˜å†—ä½™é˜µåˆ—(Redundant Arrays of Inexpensive Disks),
ç®€ç§°ç£ç›˜é˜µåˆ—
</p>

<p>
1988å¹´ç”±åŠ åˆ©ç¦å°¼äºšå¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡ï¼ˆUniversity of California-Berkeleyï¼‰
"A Case for Redundant Arrays of Inexpensive Disks",å¤šä¸ªç£ç›˜åˆæˆä¸€ä¸ªâ€
é˜µåˆ—â€æ¥æä¾›æ›´å¥½çš„æ€§èƒ½ã€å†—ä½™ï¼Œæˆ–è€…ä¸¤è€…éƒ½æä¾›
</p>

<p>
<b>RAIDåŠŸèƒ½å®ç°</b>
</p>

<ul class="org-ul">
<li>æé«˜IOèƒ½åŠ›,ç£ç›˜å¹¶è¡Œè¯»å†™</li>
<li>æé«˜è€ç”¨æ€§,ç£ç›˜å†—ä½™ç®—æ³•æ¥å®ç°</li>
</ul>

<p>
<b>RAIDå®ç°çš„æ–¹å¼</b>
</p>

<ul class="org-ul">
<li>å¤–æ¥å¼ç£ç›˜é˜µåˆ—ï¼šé€šè¿‡æ‰©å±•å¡æä¾›é€‚é…èƒ½åŠ›</li>
<li>å†…æ¥å¼RAIDï¼šä¸»æ¿é›†æˆRAIDæ§åˆ¶å™¨ï¼Œå®‰è£…OSå‰åœ¨BIOSé‡Œé…ç½®</li>
<li>è½¯ä»¶RAIDï¼šé€šè¿‡OSå®ç°ï¼Œæ¯”å¦‚ï¼šç¾¤æ™–çš„NAS</li>
</ul>
</div>
</div>
<div id="outline-container-h:c4d07f2a-f0f2-4eab-93fe-e541c4321332" class="outline-3">
<h3 id="h:c4d07f2a-f0f2-4eab-93fe-e541c4321332">RAIDçº§åˆ«</h3>
<div class="outline-text-3" id="text-h:c4d07f2a-f0f2-4eab-93fe-e541c4321332">
<p>
çº§åˆ«ï¼šå¤šå—ç£ç›˜ç»„ç»‡åœ¨ä¸€èµ·çš„å·¥ä½œæ–¹å¼æœ‰æ‰€ä¸åŒ
</p>

<div class="org-src-container">
<pre class="src src-sh">RAID-0&#65306;&#26465;&#24102;&#21367;&#65292;strip
RAID-1&#65306;&#38236;&#20687;&#21367;&#65292;mirror
RAID-2
..
RAID-5
RAID-6
RAID-10
RAID-01
RAID&#32423;&#21035;
</pre>
</div>
</div>
<div id="outline-container-h:4972c508-54ae-428d-a521-ecc4f8a69909" class="outline-4">
<h4 id="h:4972c508-54ae-428d-a521-ecc4f8a69909">RAID-0</h4>
<div class="outline-text-4" id="text-h:4972c508-54ae-428d-a521-ecc4f8a69909">
<p>
ä»¥ chunk å•ä½,è¯»å†™æ•°æ®ï¼Œå› ä¸ºè¯»å†™æ—¶éƒ½å¯ä»¥å¹¶è¡Œå¤„ç†ï¼Œæ‰€ä»¥åœ¨æ‰€æœ‰çš„çº§åˆ«ä¸­ï¼Œ
RAID0çš„é€Ÿåº¦æ˜¯æœ€å¿«çš„ã€‚ä½†æ˜¯RAID0æ—¢æ²¡æœ‰å†—ä½™åŠŸèƒ½ï¼Œä¹Ÿä¸å…·å¤‡å®¹é”™èƒ½åŠ›ï¼Œå¦‚æœä¸€
ä¸ªç£ç›˜(ç‰©ç†)æŸåï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¼šä¸¢å¤±ã€‚
</p>

<div class="org-src-container">
<pre class="src src-sh">&#35835;&#12289;&#20889;&#24615;&#33021;&#25552;&#21319;
&#21487;&#29992;&#31354;&#38388;&#65306;N*min(S1,S2,...)
&#26080;&#23481;&#38169;&#33021;&#21147;
&#26368;&#23569;&#30913;&#30424;&#25968;&#65306;1+
</pre>
</div>
</div>
</div>
<div id="outline-container-h:8fee72f6-f628-4dc3-8ad6-fd9611431aa9" class="outline-4">
<h4 id="h:8fee72f6-f628-4dc3-8ad6-fd9611431aa9">RAID-1</h4>
<div class="outline-text-4" id="text-h:8fee72f6-f628-4dc3-8ad6-fd9611431aa9">
<p>
ä¹Ÿç§°ä¸ºé•œåƒï¼Œä¸¤ç»„ä»¥ä¸Šçš„Nä¸ªç¡¬ç›˜ç›¸äº’ä½œé•œåƒï¼Œåœ¨ä¸€äº›å¤šçº¿ç¨‹æ“ä½œç³»ç»Ÿä¸­èƒ½æœ‰å¾ˆ
å¥½çš„è¯»å–é€Ÿåº¦ï¼Œç†è®ºä¸Šè¯»å–é€Ÿåº¦ç­‰äºç¡¬ç›˜æ•°æ®çš„å€æ•°ï¼Œä¸RAID 0ç›¸åŒã€‚å¦å¤–å†™å…¥
é€Ÿåº¦æœ‰ç¨å¾®çš„é™ä½ã€‚
</p>

<div class="org-src-container">
<pre class="src src-sh">&#35835;&#24615;&#33021;&#25552;&#21319;&#12289;&#20889;&#24615;&#33021;&#30053;&#26377;&#19979;&#38477;
&#21487;&#29992;&#31354;&#38388;&#65306;1*min(S1,S2,...)
&#30913;&#30424;&#21033;&#29992;&#29575; 50%
&#26377;&#20887;&#20313;&#33021;&#21147;
&#26368;&#23569;&#30913;&#30424;&#25968;&#65306;2+
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c7e3333b-9652-4934-b22d-02d4fa14aa55" class="outline-4">
<h4 id="h:c7e3333b-9652-4934-b22d-02d4fa14aa55">RAID-4</h4>
<div class="outline-text-4" id="text-h:c7e3333b-9652-4934-b22d-02d4fa14aa55">
<p>
å’ŒRAID5å¾ˆåƒ. ä½†æœ‰ä¸€ä¸ªç¡¬ç›˜ä¸“ç”¨äºä½œæ£€éªŒã€‚
</p>

<div class="org-src-container">
<pre class="src src-sh">&#22810;&#22359;&#25968;&#25454;&#30424;&#24322;&#25110;&#36816;&#31639;&#20540;&#23384;&#20110;&#19987;&#29992;&#26657;&#39564;&#30424;
 &#30913;&#30424;&#21033;&#29992;&#29575; (N-1)/N
&#26377;&#20887;&#20313;&#33021;&#21147;
&#26368;&#23569;&#30913;&#30424;&#25968;&#65306;3+
</pre>
</div>
</div>
</div>
<div id="outline-container-h:19bb3bf6-bb09-496a-9f44-1a2185859dcc" class="outline-4">
<h4 id="h:19bb3bf6-bb09-496a-9f44-1a2185859dcc">RAID-5</h4>
<div class="outline-text-4" id="text-h:19bb3bf6-bb09-496a-9f44-1a2185859dcc">
<p>
ä¸RAID 4ä¸åŒï¼Œæ¯ä¸€å—ç¡¬ç›˜éƒ½æœ‰æ£€éªŒä½ã€‚
</p>

<div class="org-src-container">
<pre class="src src-sh">&#35835;&#12289;&#20889;&#24615;&#33021;&#25552;&#21319;
&#21487;&#29992;&#31354;&#38388;&#65306;(N-1)*min(S1,S2,...)
&#26377;&#23481;&#38169;&#33021;&#21147;&#65306;&#20801;&#35768;&#26368;&#22810;1&#22359;&#30913;&#30424;&#25439;&#22351;
&#26368;&#23569;&#30913;&#30424;&#25968;&#65306;3, 3+
</pre>
</div>
</div>
</div>
<div id="outline-container-h:e04af9c1-08c0-4047-a6e9-8c258d1217fc" class="outline-4">
<h4 id="h:e04af9c1-08c0-4047-a6e9-8c258d1217fc">RAID-6</h4>
<div class="outline-text-4" id="text-h:e04af9c1-08c0-4047-a6e9-8c258d1217fc">
<p>
RAID5 åªå…è®¸æœ€å¤šåä¸€å—ç¡¬ç›˜ï¼Œä¸ºäº†é˜²æ­¢2å—ç¡¬ç›˜åŒæ—¶æŸåï¼Œæœ‰äº†RAID 6, æ¯å—ç¡¬ç›˜æœ‰2ä¸ªæ£€éªŒä½ã€‚
</p>

<div class="org-src-container">
<pre class="src src-sh">&#35835;&#12289;&#20889;&#24615;&#33021;&#25552;&#21319;
&#21487;&#29992;&#31354;&#38388;&#65306;(N-2)*min(S1,S2,...)
&#26377;&#23481;&#38169;&#33021;&#21147;&#65306;&#20801;&#35768;&#26368;&#22810;2&#22359;&#30913;&#30424;&#25439;&#22351;
&#26368;&#23569;&#30913;&#30424;&#25968;&#65306;4, 4+
</pre>
</div>
</div>
</div>
<div id="outline-container-h:3d1e1314-f915-46bf-a17b-eeee104d4eee" class="outline-4">
<h4 id="h:3d1e1314-f915-46bf-a17b-eeee104d4eee">RAID-10</h4>
<div class="outline-text-4" id="text-h:3d1e1314-f915-46bf-a17b-eeee104d4eee">
<p>
æ˜¯RAID 1å’ŒRAID 0çš„ç»„åˆã€‚å…ˆ2å—ç¡¬ç›˜ä½œæˆRAID 1ï¼Œå†2ä¸ªç¡¬ç›˜ä½œæˆRAID 1ï¼ŒæŠŠ2ä¸ªRAID 1ç»„åˆä¸º RAID 0
</p>

<div class="org-src-container">
<pre class="src src-sh">&#35835;&#12289;&#20889;&#24615;&#33021;&#25552;&#21319;
&#21487;&#29992;&#31354;&#38388;&#65306;N*min(S1,S2,...)/2
&#26377;&#23481;&#38169;&#33021;&#21147;&#65306;&#27599;&#32452;&#38236;&#20687;&#26368;&#22810;&#21482;&#33021;&#22351;&#19968;&#22359;
&#26368;&#23569;&#30913;&#30424;&#25968;&#65306;4, 4+
</pre>
</div>
</div>
</div>
<div id="outline-container-h:874f487b-55ff-4026-9df6-e595606d2d58" class="outline-4">
<h4 id="h:874f487b-55ff-4026-9df6-e595606d2d58">RAID-01</h4>
<div class="outline-text-4" id="text-h:874f487b-55ff-4026-9df6-e595606d2d58">
<p>
å¤šå—ç£ç›˜å…ˆå®ç°RAID0,å†ç»„åˆæˆRAID1
</p>
</div>
</div>
<div id="outline-container-h:bb331ab6-e57d-4a56-90ef-0cfff77d807a" class="outline-4">
<h4 id="h:bb331ab6-e57d-4a56-90ef-0cfff77d807a">RAID-50</h4>
<div class="outline-text-4" id="text-h:bb331ab6-e57d-4a56-90ef-0cfff77d807a">

<figure id="org8541b2b">
<img src="images/image-20210216021040451.png" alt="image-20210216021040451.png" width="60%">

</figure>

<p>
å¤šå—ç£ç›˜å…ˆå®ç°RAID5,å†ç»„åˆæˆRAID0
</p>
</div>
</div>
<div id="outline-container-h:3ab099aa-4e48-4f25-b5d0-b082380688ca" class="outline-4">
<h4 id="h:3ab099aa-4e48-4f25-b5d0-b082380688ca">å…¶å®ƒçº§åˆ«</h4>
<div class="outline-text-4" id="text-h:3ab099aa-4e48-4f25-b5d0-b082380688ca">
<p>
<b>JBODï¼šJust a Bunch Of Disks åªæ˜¯ä¸€å †ç£ç›˜</b>
</p>

<p>
åŠŸèƒ½ï¼šå°†å¤šå—ç£ç›˜çš„ç©ºé—´åˆå¹¶ä¸€ä¸ªå¤§çš„è¿ç»­ç©ºé—´ä½¿ç”¨
</p>

<p>
å¯ç”¨ç©ºé—´ï¼šsum(S1,S2,&#x2026;)
</p>

<p>
<b>RAID7</b>
</p>

<p>
éå…¬å¼€çš„RAIDæ ‡å‡†ï¼Œæ˜¯ç¾å›½å…¬å¸çš„ç§æœ‰ä¸“åˆ©äº§å“ã€‚å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç‹¬ç«‹å­˜å‚¨è®¡ç®—æœºï¼Œè‡ªèº«å¸¦æœ‰æ“ä½œç³»ç»Ÿå’Œç®¡ç†å·¥å…·ï¼Œå¯ä»¥
ç‹¬ç«‹è¿è¡Œï¼Œç†è®ºä¸Šæ€§èƒ½æœ€é«˜çš„RAIDæ¨¡å¼
</p>

<p>
<b>SHR(Synology Hybrid RAID)</b>
</p>

<p>
ç¾¤æ™–å…¬å¸çš„æŠ€æœ¯ï¼Œé€‚åˆä¸äº†è§£RAIDçš„ç”¨æˆ·
</p>

<p>
æ ¹æ®ç£ç›˜ä¸ªæ•°è‡ªåŠ¨ç»„æˆä¸åŒçš„RAID, 1å—æ™®é€šç£ç›˜ï¼Œ 2å—RAID1, 3å—RAID4, SHR2ç±»ä¼¼RAID6
</p>

<p>
åªæ”¯æŒç¾¤æ™–ç³»ç»Ÿ
</p>
</div>
</div>
<div id="outline-container-h:9cebdd7a-3502-49a1-8c2e-cf5fca26e9bb" class="outline-4">
<h4 id="h:9cebdd7a-3502-49a1-8c2e-cf5fca26e9bb">RAIDæ€»ç»“</h4>
<div class="outline-text-4" id="text-h:9cebdd7a-3502-49a1-8c2e-cf5fca26e9bb">
<p>
å¸¸ç”¨çº§åˆ«ï¼š RAID-0, RAID-1, RAID-5, RAID-10, RAID-50, JBOD
</p>

<p>
RAID 0, 1, 5, 6, 10, 01çº§åˆ«åŒºåˆ«
</p>
<pre class="example" id="org17d0bc3">
1. ç£ç›˜åˆ©ç”¨ç‡
2. æœ€å°‘å‡ å—ç£ç›˜å®ç°
3. æœ‰æ²¡æœ‰å®¹é”™æ€§ï¼Œé˜²æ­¢å‡ å—ç£ç›˜æŸå
4. æ€§èƒ½å¥½å
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b5c9b1fe-0384-4288-beb3-880300a070f8" class="outline-3">
<h3 id="h:b5c9b1fe-0384-4288-beb3-880300a070f8">å®ç°è½¯RAID</h3>
<div class="outline-text-3" id="text-h:b5c9b1fe-0384-4288-beb3-880300a070f8">
<p>
ç”Ÿäº§ä¸­æ²¡äººç”¨è½¯RAIDï¼Œéƒ½æ˜¯ç”¨ç¡¬ä»¶RAID. æœ¬èŠ‚å¯å½“äº†è§£æˆ–å¿½ç•¥ã€‚
</p>

<p>
mdadmå·¥å…·ï¼šä¸ºè½¯RAIDæä¾›ç®¡ç†ç•Œé¢ï¼Œä¸ºç©ºä½™ç£ç›˜æ·»åŠ å†—ä½™ï¼Œç»“åˆå†…æ ¸ä¸­çš„
md(multi devices)
</p>

<p>
RAIDè®¾å¤‡å¯å‘½åä¸º/dev/md0ã€/dev/md1ã€/dev/md2ã€/dev/md3ç­‰
</p>

<p>
mdadmï¼šæ¨¡å¼åŒ–çš„å·¥å…·,æ”¯æŒçš„RAIDçº§åˆ«ï¼šLINEAR, RAID0, RAID1, RAID4,
RAID5, RAID6, RAID10
</p>

<p>
å‘½ä»¤çš„è¯­æ³•æ ¼å¼ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">mdadm [mode] &lt;raiddevice&gt; [options] &lt;component-devices&gt;
</pre>
</div>

<p>
å¸¸ç”¨é€‰é¡¹è¯´æ˜
</p>

<div class="org-src-container">
<pre class="src src-sh">&#27169;&#24335;&#65306;
    &#21019;&#24314;&#65306;-C
    &#35013;&#37197;&#65306;-A
    &#30417;&#25511;&#65306;-F
    &#31649;&#29702;&#65306;-f, -r, -a
&lt;raiddevice&gt;: /dev/md#
&lt;component-devices&gt;: &#20219;&#24847;&#22359;&#35774;&#22791;
-C: &#21019;&#24314;&#27169;&#24335;
    -n <span style="color: #b22222;">#</span><span style="color: #b22222;">: &#20351;&#29992;#&#20010;&#22359;&#35774;&#22791;&#26469;&#21019;&#24314;&#27492;RAID</span>
    -l <span style="color: #b22222;">#</span><span style="color: #b22222;">&#65306;&#25351;&#26126;&#35201;&#21019;&#24314;&#30340;RAID&#30340;&#32423;&#21035;</span>
    -a {yes|no}&#65306;&#33258;&#21160;&#21019;&#24314;&#30446;&#26631;RAID&#35774;&#22791;&#30340;&#35774;&#22791;&#25991;&#20214;
    -c CHUNK_SIZE: &#25351;&#26126;&#22359;&#22823;&#23567;,&#21333;&#20301;k
    -x <span style="color: #b22222;">#</span><span style="color: #b22222;">: &#25351;&#26126;&#31354;&#38386;&#30424;&#30340;&#20010;&#25968;</span>
-D&#65306;&#26174;&#31034;raid&#30340;&#35814;&#32454;&#20449;&#24687;
    mdadm -D /dev/md#

&#31649;&#29702;&#27169;&#24335;&#65306;
    -f: &#26631;&#35760;&#25351;&#23450;&#30913;&#30424;&#20026;&#25439;&#22351;
    -a: &#28155;&#21152;&#30913;&#30424;
    -r: &#31227;&#38500;&#30913;&#30424;

&#35266;&#23519;md&#30340;&#29366;&#24577;&#65306; cat /proc/mdstat
</pre>
</div>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;mdadm&#21019;&#24314;&#24182;&#23450;&#20041;RAID&#35774;&#22791;</span>
mdadm -C /dev/md0 -a yes -l 5 -n 3 -x 1 /dev/sd{b,c,d,e}1
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#25991;&#20214;&#31995;&#32479;&#23545;&#27599;&#20010;RAID&#35774;&#22791;&#36827;&#34892;&#26684;&#24335;&#21270;</span>
mkfs.xfs /dev/md0

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;mdadm&#26816;&#26597;RAID&#35774;&#22791;&#30340;&#29366;&#20917;</span>
mdadm --detail|D /dev/md0
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22686;&#21152;&#26032;&#30340;&#25104;&#21592;</span>
mdadm &#8211;G /dev/md0 &#8211;n4  -a /dev/sdf1
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27169;&#25311;&#30913;&#30424;&#25925;&#38556;</span>
mdadm /dev/md0  -f /dev/sda1
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31227;&#38500;&#30913;&#30424;</span>
mdadm  /dev/md0 &#8211;r /dev/sda1

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;&#22791;&#29992;&#39537;&#21160;&#22120;&#19978;&#37325;&#24314;&#20998;&#21306;</span>
mdadm /dev/md0  -a /dev/sda1
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31995;&#32479;&#26085;&#24535;&#20449;&#24687;</span>
cat /proc/mdstat
</pre>
</div>

<p>
ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">mdadm &#8211;D &#8211;s &gt;&gt; /etc/mdadm.conf
</pre>
</div>

<p>
åœæ­¢è®¾å¤‡ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">mdadm &#8211;S /dev/md0
</pre>
</div>

<p>
æ¿€æ´»è®¾å¤‡ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">mdadm &#8211;A &#8211;s /dev/md0
</pre>
</div>

<p>
å¼ºåˆ¶å¯åŠ¨ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">mdadm &#8211;R /dev/md0
</pre>
</div>

<p>
åˆ é™¤raidä¿¡æ¯ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">mdadm --zero-superblock /dev/sdb1
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:8e7781b7-ad87-44dd-b691-4881da975c8f" class="outline-2">
<h2 id="h:8e7781b7-ad87-44dd-b691-4881da975c8f">é€»è¾‘å·ç®¡ç†å™¨ï¼ˆLVMï¼‰</h2>
<div class="outline-text-2" id="text-h:8e7781b7-ad87-44dd-b691-4881da975c8f">
</div>
<div id="outline-container-h:08177873-8507-4d30-9969-6855fee5a55f" class="outline-3">
<h3 id="h:08177873-8507-4d30-9969-6855fee5a55f">LVMä»‹ç»</h3>
<div class="outline-text-3" id="text-h:08177873-8507-4d30-9969-6855fee5a55f">
<p>
LVM: Logical Volume Managerå¯ä»¥å…è®¸å¯¹å·è¿›è¡Œæ–¹ä¾¿æ“ä½œçš„æŠ½è±¡å±‚ï¼ŒåŒ…æ‹¬é‡æ–°
è®¾å®šæ–‡ä»¶ç³»ç»Ÿçš„å¤§å°ï¼Œå…è®¸åœ¨å¤šä¸ªç‰©ç†è®¾å¤‡é—´é‡æ–°ç»„ç»‡æ–‡ä»¶ç³»ç»Ÿ
</p>

<p>
LVMå¯ä»¥å¼¹æ€§çš„æ›´æ”¹LVMçš„å®¹é‡
</p>

<p>
é€šè¿‡äº¤æ¢PEæ¥è¿›è¡Œèµ„æ–™çš„è½¬æ¢ï¼Œå°†åŸæ¥LVå†…çš„PEè½¬ç§»åˆ°å…¶ä»–çš„è®¾å¤‡ä¸­ä»¥é™ä½LVçš„
å®¹é‡ï¼Œæˆ–å°†å…¶ä»–è®¾å¤‡ä¸­çš„PEåŠ åˆ°LVä¸­ä»¥åŠ å¤§å®¹é‡
</p>

<p>
<b>å®ç°è¿‡ç¨‹</b>
</p>

<ol class="org-ol">
<li>pvcreate å°†è®¾å¤‡æŒ‡å®šä¸ºç‰©ç†å·</li>
<li>vgcreate ç”¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªç‰©ç†å·æ¥åˆ›å»ºä¸€ä¸ªå·ç»„ï¼Œç‰©ç†å·æ˜¯ç”¨å›ºå®šå¤§å°çš„ç‰©ç†åŒºåŸŸ
ï¼ˆPhysical Extentï¼ŒPEï¼‰æ¥å®šä¹‰çš„</li>
<li>lvcreate åœ¨ç‰©ç†å·ä¸Šåˆ›å»ºçš„é€»è¾‘å·ï¼Œ æ˜¯ç”±ç‰©ç†åŒºåŸŸï¼ˆPEï¼‰ç»„æˆ</li>
<li><p>
å¯ä»¥åœ¨é€»è¾‘å·ä¸Šåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿå¹¶æŒ‚è½½
</p>


<figure id="org9a8c1ef">
<img src="images/image-20210216021128040.png" alt="image-20210216021128040.png" width="60%">

</figure></li>
</ol>

<p>
ç¬¬ä¸€ä¸ªé€»è¾‘å·å¯¹åº”è®¾å¤‡åï¼š <code>/dev/dm-#</code>
</p>

<p>
dm: device mapperï¼Œå°†ä¸€ä¸ªæˆ–å¤šä¸ªåº•å±‚å—è®¾å¤‡ç»„ç»‡æˆä¸€ä¸ªé€»è¾‘è®¾å¤‡çš„æ¨¡å—
</p>

<p>
è½¯é“¾æ¥ï¼š
</p>

<ul class="org-ul">
<li>/dev/mapper/VG_NAME-LV_NAME</li>
<li>/dev/VG_NAME/LV_NAME</li>
</ul>

<p>
èŒƒä¾‹
</p>

<div class="org-src-container">
<pre class="src src-sh">/dev/mapper/vol0-root
/dev/vol0/root
</pre>
</div>
</div>
</div>
<div id="outline-container-h:4b14bc2f-7089-44bd-a519-52e46a9de2b2" class="outline-3">
<h3 id="h:4b14bc2f-7089-44bd-a519-52e46a9de2b2">å®ç°é€»è¾‘å·</h3>
<div class="outline-text-3" id="text-h:4b14bc2f-7089-44bd-a519-52e46a9de2b2">
<p>
ç›¸å…³å·¥å…·æ¥è‡ªäº lvm2 åŒ…
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#yum -y install lvm2
</pre>
</div>
</div>
<div id="outline-container-h:1da9df56-8298-4a17-b9a5-198cca47f9b8" class="outline-4">
<h4 id="h:1da9df56-8298-4a17-b9a5-198cca47f9b8">pvç®¡ç†å·¥å…·</h4>
<div class="outline-text-4" id="text-h:1da9df56-8298-4a17-b9a5-198cca47f9b8">
<p>
æ˜¾ç¤ºpvä¿¡æ¯
</p>

<div class="org-src-container">
<pre class="src src-sh">pvs&#65306;&#31616;&#35201;pv&#20449;&#24687;&#26174;&#31034;
pvdisplay
</pre>
</div>

<p>
åˆ›å»ºpv
</p>

<div class="org-src-container">
<pre class="src src-sh">pvcreate /dev/DEVICE
</pre>
</div>

<p>
åˆ é™¤pv
</p>

<div class="org-src-container">
<pre class="src src-sh">pvremove /dev/DEVICE
</pre>
</div>
</div>
</div>
<div id="outline-container-h:dac7283a-62c4-479f-b24a-769a3a65b2a0" class="outline-4">
<h4 id="h:dac7283a-62c4-479f-b24a-769a3a65b2a0">vgç®¡ç†å·¥å…·</h4>
<div class="outline-text-4" id="text-h:dac7283a-62c4-479f-b24a-769a3a65b2a0">
<p>
æ˜¾ç¤ºå·ç»„
</p>

<div class="org-src-container">
<pre class="src src-sh">vgs
vgdisplay
</pre>
</div>

<p>
åˆ›å»ºå·ç»„
</p>

<div class="org-src-container">
<pre class="src src-sh">vgcreate [-s <span style="color: #b22222;">#</span><span style="color: #b22222;">[kKmMgGtTpPeE]] VolumeGroupName PhysicalDevicePath [PhysicalDevicePath...]</span>
</pre>
</div>

<p>
ç®¡ç†å·ç»„
</p>

<div class="org-src-container">
<pre class="src src-sh">vgextend VolumeGroupName PhysicalDevicePath [PhysicalDevicePath...]
vgreduce VolumeGroupName PhysicalDevicePath [PhysicalDevicePath...]
</pre>
</div>

<p>
èŒƒä¾‹ï¼šæ‰©å±•å·ç»„
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21152;&#20837;&#21040;&#21367;&#32452;</span>
vgs
vgextend vg0 /dev/vdc
</pre>
</div>

<p>
åˆ é™¤å·ç»„
</p>

<ul class="org-ul">
<li>å…ˆåšpvmove</li>
<li>å†åšvgremove</li>
</ul>
</div>
</div>
<div id="outline-container-h:033be43b-3a4f-4637-ba3f-fffddf837009" class="outline-4">
<h4 id="h:033be43b-3a4f-4637-ba3f-fffddf837009">lvç®¡ç†å·¥å…·</h4>
<div class="outline-text-4" id="text-h:033be43b-3a4f-4637-ba3f-fffddf837009">
<p>
æ˜¾ç¤ºé€»è¾‘å·
</p>

<div class="org-src-container">
<pre class="src src-sh">lvs
Lvdisplay
</pre>
</div>

<p>
åˆ›å»ºé€»è¾‘å·
</p>

<div class="org-src-container">
<pre class="src src-sh">lvcreate -L <span style="color: #b22222;">#</span><span style="color: #b22222;">[mMgGtT] -n NAME VolumeGroup</span>
</pre>
</div>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">lvcreate -l 60%VG -n mylv testvg
lvcreate -l 100%FREE -n yourlv testvg
</pre>
</div>

<p>
åˆ é™¤é€»è¾‘å·
</p>

<div class="org-src-container">
<pre class="src src-sh">lvremove /dev/VG_NAME/LV_NAME
</pre>
</div>

<p>
é‡è®¾æ–‡ä»¶ç³»ç»Ÿå¤§å°
</p>

<div class="org-src-container">
<pre class="src src-sh">fsadm [options] resize device [new_size[BKMGTEP]] resize2fs [-f] [-F] [-M] [-P] [-p] device [new_size] xfs_growfs /mountpoint
</pre>
</div>

<p>
èŒƒä¾‹ï¼šåˆ›å»ºlvm
</p>

<div class="org-src-container">
<pre class="src src-sh">fdisk /dev/sda
n
p
+5G

t <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#20998;&#21306;&#30340;&#35805;&#35201;&#25913;id 8e&#12290;&#22914;&#26524;&#26159;&#30828;&#30424;&#19981;&#29992;&#25913;</span>
w

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#30913;&#30424;&#20998;&#21306;</span>
lsblk

<span style="color: #b22222;">#</span><span style="color: #b22222;">1.&#21019;&#24314;&#29289;&#29702;&#21367;, 2&#20010;&#29289;&#29702;&#21367;</span>
pvcreate /dev/sda3  /dev/sdc
pvs

<span style="color: #b22222;">#</span><span style="color: #b22222;">2.&#20026;&#21367;&#32452;&#20998;&#37197;&#29289;&#29702;&#21367;</span>
vgs
vgcreate vg0 /dev/sda3
vgdisplay

<span style="color: #b22222;">#</span><span style="color: #b22222;">3.&#20174;&#21367;&#32452;&#21019;&#24314;&#36923;&#36753;&#21367;</span>
lvcreate  -L 256M  -n lv-data vg0

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26684;&#24335;&#21270;</span>
mkfs.xfs  /dev/vg0/lv-data
<span style="color: #b22222;">#</span><span style="color: #b22222;">4.&#25346;&#36733;</span>
mount /dev/vg0/lv-data /mnt/data#
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a4df6d57-3275-4971-a21d-b427836afa13" class="outline-4">
<h4 id="h:a4df6d57-3275-4971-a21d-b427836afa13">æ‰©å±•å’Œç¼©å‡é€»è¾‘å·</h4>
<div class="outline-text-4" id="text-h:a4df6d57-3275-4971-a21d-b427836afa13">
</div>
<div id="outline-container-h:4bbc1af1-1a91-4d58-8ec9-0485b4fe7f95" class="outline-5">
<h5 id="h:4bbc1af1-1a91-4d58-8ec9-0485b4fe7f95">åœ¨çº¿æ‰©å±•é€»è¾‘å·</h5>
<div class="outline-text-5" id="text-h:4bbc1af1-1a91-4d58-8ec9-0485b4fe7f95">
<div class="org-src-container">
<pre class="src src-sh">lvextend -L [+]#[mMgGtT] /dev/VG_NAME/LV_NAME

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#38024;&#23545;ext</span>
resize2fs /dev/VG_NAME/LV_NAME
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#38024;&#23545;xfs</span>
xfs_growfs MOUNTPOINT

lvresize -r -l +100%FREE /dev/VG_NAME/LV_NAME
</pre>
</div>


<p>
èŒƒä¾‹ï¼š lvmæ‰©å±•
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;pv</span>
lsblk
pvs
pvcreate /dev/vda3

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21152;&#20837;&#21040;&#21367;&#32452;</span>
vgs
vgextend cl /dev/vda3

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25193;&#23637;&#36923;&#36753;&#21367;</span>
lvs
lvdisplay
<span style="color: #b22222;">#</span><span style="color: #b22222;">lvextend -L +5G /dev/cl/root  #&#25193;&#23637;&#31354;&#38388;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">lvextend -l +100%free /dev/cl/root  #&#25193;&#23637;&#31354;&#38388;, &#25152;&#26377;&#21097;&#20313;&#31354;&#38388;&#29992;&#23436;</span>
lvextend -r -l +100%free /dev/cl/root  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36830;&#31354;&#38388;&#24102;&#25991;&#20214;&#31995;&#32479;&#19968;&#36215;&#25193;&#20102;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25193;&#25991;&#20214;&#31995;&#32479;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#38024;&#23545;ext</span>
resize2fs /dev/VG_NAME/LV_NAME
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#38024;&#23545;xfs</span>
xfs_growfs MOUNTPOINT
</pre>
</div>
</div>
</div>
<div id="outline-container-h:8a7ec24b-31a5-4abe-9e9e-829230ab0479" class="outline-5">
<h5 id="h:8a7ec24b-31a5-4abe-9e9e-829230ab0479">ç¼©å‡é€»è¾‘å·</h5>
<div class="outline-text-5" id="text-h:8a7ec24b-31a5-4abe-9e9e-829230ab0479">
<p>
<b>æ³¨æ„ï¼šç¼©å‡æœ‰æ•°æ®æŸåçš„é£é™©ï¼Œå»ºè®®å…ˆå¤‡ä»½å†ç¼©å‡ï¼Œxfsæ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒç¼©å‡</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;1</span>
umount /dev/VG_NAME/LV_NAME
e2fsck -f /dev/VG_NAME/LV_NAME
resize2fs /dev/VG_NAME/LV_NAME <span style="color: #b22222;">#</span><span style="color: #b22222;">[mMgGtT]</span>
lvreduce -L [-]#[mMgGtT] /dev/VG_NAME/LV_NAME
mount /dev/VG_NAME/LV_NAME mountpoint

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;2&#65306;&#21487;&#20197;&#31616;&#20889;</span>
umount /dev/VG_NAME/LV_NAME
lvreduce -L [-]#[mMgGtT] -r /dev/VG_NAME/LV_NAME <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#33021;&#26159;ext&#31995;&#32479;&#65292;xfs&#25991;&#20214;&#31995;&#32479;&#19981;&#25903;&#25345;&#32553;&#20943;</span>
mount /dev/VG_NAME/LV_NAME mountpoint
</pre>
</div>

<p>
èŒƒä¾‹ï¼šlvmç¼©å‡é€»è¾‘å·
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#blkid /dev/vg0/mysql
/dev/vg0/mysql: <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"94674607-2196-4015-9194-4632ac23f36a"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"ext4"</span>
[root@centos8 ~]#lvs
LV  VG Attr    LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert
mysql vg0 -wi-a----- 2.99g 

[root@centos8 ~]#df
Filesystem      1K-blocks  Used Available Use% Mounted on
/dev/mapper/vg0-mysql  3022704   9204  2840240  1% /data/mysql

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31532;&#19968;&#27493;&#65292;&#21462;&#28040;&#25346;&#36733;</span>
[root@centos8 ~]#umount /data/mysql
[root@centos8 ~]#resize2fs /dev/vg0/mysql 1G
resize2fs 1.44.6 (5-Mar-2019)
Please run <span style="color: #8b2252;">'e2fsck -f /dev/vg0/mysql'</span> first.

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31532;&#20108;&#27493;</span>
[root@centos8 ~]#fsck -f /dev/vg0/mysql
fsck from util-linux 2.32.1
e2fsck 1.44.6 (5-Mar-2019)
Pass 1: Checking inodes, blocks, and sizes
Pass 2: Checking directory structure
Pass 3: Checking directory connectivity
Pass 4: Checking reference counts
Pass 5: Checking group summary information
/dev/mapper/vg0-mysql: 14/196224 files (0.0% non-contiguous), 31009/784384 blocks

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31532;&#19977;&#27493;</span>
[root@centos8 ~]#resize2fs /dev/vg0/mysql 1G
resize2fs 1.44.6 (5-Mar-2019)
Resizing the filesystem on /dev/vg0/mysql to 262144 (4k) blocks.
The filesystem on /dev/vg0/mysql is now 262144 (4k) blocks long.

[root@centos8 ~]#lvs
LV  VG Attr    LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert
mysql vg0 -wi-a----- 2.99g                          
[root@centos8 ~]#df
Filesystem   1K-blocks  Used Available Use% Mounted on
devtmpfs      391676    0   391676  0% /dev
tmpfs       408092    0   408092  0% /dev/shm
tmpfs       408092   5792   402300  2% /run
tmpfs       408092    0   408092  0% /sys/fs/cgroup
/dev/sda2    104806400 2274504 102531896  3% /
/dev/sda3    52403200  398576  52004624  1% /data
/dev/sda1     999320  130848   799660  15% /boot
tmpfs        81616    0   81616  0% /run/user/0
[root@centos8 ~]#mount -a

[root@centos8 ~]#df -h
Filesystem       Size Used Avail Use% Mounted on
/dev/mapper/vg0-mysql 944M  7.5M 870M  1% /data/mysql
[root@centos8 ~]#lvs
LV  VG Attr    LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert
mysql vg0 -wi-ao---- 2.99g                          
[root@centos8 ~]#umount /data/mysql

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31532;&#22235;&#27493;</span>
[root@centos8 ~]#lvreduce -L 1G /dev/vg0/mysql
WARNING: Reducing active logical volume to 1.00 GiB.
THIS MAY DESTROY YOUR DATA (filesystem etc.)
Do you really want to reduce vg0/mysql? [y/n]: y
Size of logical volume vg0/mysql changed from 2.99 GiB (766 extents) to 1.00
<span style="color: #0000ff;">GiB</span> (256 extents).
Logical volume vg0/mysql successfully resized.

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31532;&#20116;&#27493;&#65292;&#25346;&#36733;&#22238;&#21435;</span>
[root@centos8 ~]#mount -a
[root@centos8 ~]#lvs
LV  VG Attr    LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert
mysql vg0 -wi-ao---- 1.00g                          
[root@centos8 ~]#df -h
Filesystem       Size Used Avail Use% Mounted on
devtmpfs        383M   0 383M  0% /dev
tmpfs         399M   0 399M  0% /dev/shm
tmpfs         399M  5.7M 393M  2% /run
tmpfs         399M   0 399M  0% /sys/fs/cgroup
/dev/sda2       100G  2.2G  98G  3% /
/dev/sda3        50G 390M  50G  1% /data
/dev/sda1       976M 128M 781M  15% /boot
tmpfs          80M   0  80M  0% /run/user/0
/dev/mapper/vg0-mysql 944M  7.5M 870M  1% /data/mysql
</pre>
</div>

<p>
èŒƒä¾‹ï¼šæ‹†é™¤ç¡¬ç›˜ï¼Œæ•°æ®è¿ç§»
</p>
<div class="org-src-container">
<pre class="src src-shell">vgdisplay <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#21097;&#20313;&#31354;&#38388;&#26159;&#21542;&#22815;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#29289;&#29702;&#21367;&#19978;&#31354;&#38388;&#25968;&#25454;&#36801;&#31227;&#21040;&#20854;&#20182;&#25104;&#21592;&#20013;</span>
pvmove /dev/sdc  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25968;&#25454;&#36801;&#31227;&#65292;&#31561;&#24453;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;</span>
pvs

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31227;&#38500;&#29289;&#29702;&#21367;</span>
vgreduce vg0 /dev/sdc
pvremove /dev/sdc
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:4e31819a-fb68-4c57-bc13-556936e150c5" class="outline-4">
<h4 id="h:4e31819a-fb68-4c57-bc13-556936e150c5">è·¨ä¸»æœºè¿ç§»å·ç»„</h4>
<div class="outline-text-4" id="text-h:4e31819a-fb68-4c57-bc13-556936e150c5">
<p>
æºè®¡ç®—æœºä¸Š 1 åœ¨æ—§ç³»ç»Ÿä¸­ï¼Œumountæ‰€æœ‰å·ç»„ä¸Šçš„é€»è¾‘å· 2 ç¦ç”¨å·ç»„
</p>

<div class="org-src-container">
<pre class="src src-sh">vgchange &#8211;a n vg0
lvdisplay
</pre>
</div>

<p>
3 å¯¼å‡ºå·ç»„
</p>

<div class="org-src-container">
<pre class="src src-sh">vgexport vg0
pvscan
vgdisplay
</pre>
</div>

<p>
4 æ‹†ä¸‹æ—§ç¡¬ç›˜åœ¨ç›®æ ‡è®¡ç®—æœºä¸Š,å¹¶å¯¼å…¥å·ç»„ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">vgimport vg0
</pre>
</div>

<p>
5 å¯ç”¨
</p>

<div class="org-src-container">
<pre class="src src-sh">vgchange &#8211;ay vg0 
</pre>
</div>

<p>
6 mount æ‰€æœ‰å·ç»„ä¸Šçš„é€»è¾‘å·
</p>
</div>
</div>
</div>
<div id="outline-container-h:c901eab5-6c8d-4d6b-badb-561747abb038" class="outline-3">
<h3 id="h:c901eab5-6c8d-4d6b-badb-561747abb038">é€»è¾‘å·å¿«ç…§</h3>
<div class="outline-text-3" id="text-h:c901eab5-6c8d-4d6b-badb-561747abb038">
</div>
<div id="outline-container-h:15b6fce9-8786-45f6-9277-d3df139d65e6" class="outline-4">
<h4 id="h:15b6fce9-8786-45f6-9277-d3df139d65e6">é€»è¾‘å·å¿«ç…§åŸç†</h4>
<div class="outline-text-4" id="text-h:15b6fce9-8786-45f6-9277-d3df139d65e6">

<figure id="org2d597d5">
<img src="images/image-20210216021152346.png" alt="image-20210216021152346.png" width="60%">

</figure>

<p>
å¿«ç…§æ˜¯ç‰¹æ®Šçš„é€»è¾‘å·ï¼Œå®ƒæ˜¯åœ¨ç”Ÿæˆå¿«ç…§æ—¶å­˜åœ¨çš„é€»è¾‘å·çš„å‡†ç¡®æ‹·è´,å¯¹äºéœ€è¦å¤‡
ä»½æˆ–è€…å¤åˆ¶çš„ç°æœ‰æ•°æ®ä¸´æ—¶æ‹·è´ä»¥åŠå…¶å®ƒæ“ä½œæ¥è¯´ï¼Œå¿«ç…§æ˜¯æœ€åˆé€‚çš„é€‰æ‹©,å¿«ç…§
åªæœ‰åœ¨å®ƒä»¬å’ŒåŸæ¥çš„é€»è¾‘å·ä¸åŒæ—¶æ‰ä¼šæ¶ˆè€—ç©ºé—´ï¼Œå»ºç«‹å¿«ç…§çš„å·å¤§å°å°äºç­‰äºåŸ
å§‹é€»è¾‘å·,ä¹Ÿå¯ä»¥ä½¿ç”¨lvextendæ‰©å±•å¿«ç…§
</p>

<p>
é€»è¾‘å·ç®¡ç†å™¨å¿«ç…§
</p>

<p>
å¿«ç…§å°±æ˜¯å°†å½“æ—¶çš„ç³»ç»Ÿä¿¡æ¯è®°å½•ä¸‹æ¥ï¼Œå°±å¥½åƒç…§ç›¸ä¸€èˆ¬ï¼Œè‹¥å°†æ¥æœ‰ä»»ä½•æ•°æ®æ”¹åŠ¨
äº†ï¼Œåˆ™åŸå§‹æ•°æ®ä¼šè¢«ç§»åŠ¨åˆ°å¿«ç…§åŒºï¼Œæ²¡æœ‰æ”¹åŠ¨çš„åŒºåŸŸåˆ™ç”±å¿«ç…§åŒºå’Œæ–‡ä»¶ç³»ç»Ÿå…±äº«
</p>

<p>
é€»è¾‘å·å¿«ç…§å·¥ä½œåŸç†
</p>

<ul class="org-ul">
<li>åœ¨ç”Ÿæˆå¿«ç…§æ—¶ä¼šåˆ†é…ç»™å®ƒä¸€å®šçš„ç©ºé—´ï¼Œä½†åªæœ‰åœ¨åŸæ¥çš„é€»è¾‘å·æˆ–è€…å¿«ç…§æœ‰æ‰€æ”¹å˜æ‰ä¼šä½¿ç”¨è¿™äº›ç©ºé—´</li>
<li>å½“åŸæ¥çš„é€»è¾‘å·ä¸­æœ‰æ‰€æ”¹å˜æ—¶ï¼Œä¼šå°†æ—§çš„æ•°æ®å¤åˆ¶åˆ°å¿«ç…§ä¸­</li>
<li>å¿«ç…§ä¸­åªå«æœ‰åŸæ¥çš„é€»è¾‘å·ä¸­æ›´æ”¹çš„æ•°æ®æˆ–è€…è‡ªç”Ÿæˆå¿«ç…§åçš„å¿«ç…§ä¸­æ›´æ”¹çš„æ•°æ®</li>
</ul>

<p>
ç”±äºå¿«ç…§åŒºä¸åŸæœ¬çš„LVå…±ç”¨å¾ˆå¤šPEçš„åŒºå—ï¼Œå› æ­¤å¿«ç…§ä¸è¢«å¿«ç…§çš„LVå¿…é¡»åœ¨åŒä¸€ä¸ª
VGä¸­.ç³»ç»Ÿæ¢å¤çš„æ—¶å€™çš„æ–‡ä»¶æ•°é‡ä¸èƒ½é«˜äºå¿«ç…§åŒºçš„å®é™…å®¹é‡
</p>

<p>
å¿«ç…§ç‰¹ç‚¹ï¼š
</p>

<ul class="org-ul">
<li>å¤‡ä»½é€Ÿåº¦å¿«ï¼Œç¬é—´å®Œ</li>
<li>åº”ç”¨åœºæ™¯æ˜¯æµ‹è¯•ç¯å¢ƒï¼Œä¸èƒ½å®Œæˆä»£æ›¿å¤‡ä»½</li>
<li>å¿«ç…§åï¼Œé€»è¾‘å·çš„ä¿®æ”¹é€Ÿåº¦ä¼šä¸€å®šæœ‰å½±å“</li>
</ul>
</div>
</div>
<div id="outline-container-h:049936f4-e103-4c0d-87f3-0b0d4da2d63b" class="outline-4">
<h4 id="h:049936f4-e103-4c0d-87f3-0b0d4da2d63b">å®ç°é€»è¾‘å·å¿«ç…§</h4>
<div class="outline-text-4" id="text-h:049936f4-e103-4c0d-87f3-0b0d4da2d63b">
<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">mkfs.xfs /dev/vg0/data
mount /dev/vg0/data/ /mnt/data

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;&#29616;&#26377;&#36923;&#36753;&#21367;&#21019;&#24314;&#24555;&#29031;&#65292;&#27880;&#24847;ext4&#24314;&#35758;&#20351;&#29992;-p r &#23454;&#29616;&#21482;&#35835;</span>
lvcreate -l 64 -s -n data-snapshot /dev/vg0/data
<span style="color: #b22222;">#</span><span style="color: #b22222;">lvcreate -l 64 -s -n data-snapshot -p r -L 10G /dev/vg0/data</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25346;&#36733;&#24555;&#29031;, xfs&#27880;&#24847;&#35201;&#20351;&#29992;-o ro&#23454;&#29616;&#21482;&#35835;&#65292;&#38450;&#27490;&#24555;&#29031;&#34987;&#20462;&#25913;</span>
mkdir  -p /mnt/snap
mount -o ro,nouuid /dev/vg0/data-snapshot  /mnt/snap

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#24674;&#22797;&#24555;&#29031;</span>
umount /dev/vg0/data-snapshot
umount /dev/vg0/data
lvconvert --merge /dev/vg0/data-snapshot
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500;&#24555;&#29031;</span>
umount /mnt/databackup
lvremove /dev/vg0/databackup
</pre>
</div>

<p>
ç»ƒä¹ 
</p>
<ul class="org-ul">
<li>åˆ›å»ºä¸€ä¸ªè‡³å°‘æœ‰ä¸¤ä¸ªPVç»„æˆçš„å¤§å°ä¸º20Gçš„åä¸ºtestvgçš„VGï¼›è¦æ±‚PEå¤§å°ä¸º16MB,</li>
<li>åœ¨å·ç»„ä¸­åˆ›å»ºå¤§å°ä¸º5Gçš„é€»è¾‘å·testlvï¼›æŒ‚è½½è‡³/usersç›®å½• 2ã€</li>
<li>ç”¨æˆ·archlinuxï¼Œè¦æ±‚å…¶å®¶ç›®å½•ä¸º/users/archlinuxï¼Œè€Œåsuåˆ‡æ¢è‡³archlinuxç”¨æˆ·ï¼Œå¤åˆ¶/etc/pam.dç›®å½•è‡³è‡ªå·±çš„å®¶ç›®å½•</li>
<li>æ‰©å±•testlvè‡³7Gï¼Œè¦æ±‚archlinuxç”¨æˆ·çš„æ–‡ä»¶ä¸èƒ½ä¸¢å¤±</li>
<li>æ”¶ç¼©testlvè‡³3Gï¼Œè¦æ±‚archlinuxç”¨æˆ·çš„æ–‡ä»¶ä¸èƒ½ä¸¢å¤±</li>
<li>å¯¹testlvåˆ›å»ºå¿«ç…§ï¼Œå¹¶å°è¯•åŸºäºå¿«ç…§å¤‡ä»½æ•°æ®ï¼ŒéªŒè¯å¿«ç…§çš„åŠŸèƒ½</li>
</ul>
</div>
</div>
</div>
</section>
<section id="outline-container-h:9ee48b0c-52c9-4385-92c6-7e4a21bf4d47" class="outline-2">
<h2 id="h:9ee48b0c-52c9-4385-92c6-7e4a21bf4d47">btrfsæ–‡ä»¶ç³»ç»Ÿç®¡ç†ä¸åº”ç”¨</h2>
<div class="outline-text-2" id="text-h:9ee48b0c-52c9-4385-92c6-7e4a21bf4d47">
<p>
åœ¨ centos7 ä¸Šå«åšæŠ€æœ¯é¢„è§ˆç‰ˆã€‚åœ¨æœ‰äº›ä¼ä¸šä¸­å·²ç»å¼€å§‹å°è¯•ä½¿ç”¨äº†ã€‚
</p>
</div>
<div id="outline-container-h:43f03ce8-5345-4d1c-8687-d5f1e2f6a356" class="outline-3">
<h3 id="h:43f03ce8-5345-4d1c-8687-d5f1e2f6a356">Btrfsæ–‡ä»¶ç³»ç»Ÿç®€ä»‹</h3>
<div class="outline-text-3" id="text-h:43f03ce8-5345-4d1c-8687-d5f1e2f6a356">
<p>
Btrfsé€æ˜å‹ç¼©æ–‡ä»¶ç³»ç»Ÿ (B-tree, Butter FS, Better FS)æ˜¯ä¸€ç§
COW(copy-on-writeå¼)æ–‡ä»¶ç³»ç»Ÿï¼Œæœ‰ç€ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿ(ext3/4)æ‰€æ²¡æœ‰çš„ä¸€äº›ç‰¹æ€§ï¼Œ
å¦‚æ”¯æŒå¯å†™çš„ç£ç›˜å¿«ç…§(snapshots)ï¼Œä»¥åŠæ”¯æŒé€’å½’çš„å¿«ç…§(snapshots of
snapshots)ï¼Œæ”¯æŒå†…å»ºç£ç›˜é˜µåˆ—ï¼ˆRAIDï¼‰ï¼Œæ”¯æŒå­å·(Subvolumes)çš„æ¦‚å¿µï¼Œå…è®¸
åœ¨çº¿è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°ç­‰ã€‚
</p>

<p>
Oracle ä» 2007 å¹´å‰åå¼€å§‹ç ”å‘ã€‚æœ€é‡è¦çš„ç‰¹æ€§æ˜¯æ”¯æŒCOW(copy-on-writeå¼å†™
æ—¶å¤åˆ¶)æœºåˆ¶ï¼Œæ¯”å°±åœ°ä¿®æ”¹æ–‡ä»¶ç³»ç»Ÿæœ‰ç€æå¤§çš„å¥½å¤„ã€‚ä¸»è¦å–ä»£ext3/ext4ï¼Œä½†åœ¨
centos 6 ä¸Šå·²ç»æœ‰äº† xfs
</p>
</div>
</div>
<div id="outline-container-h:ca088b3f-f2ba-4c18-9a66-0efc6c7174ea" class="outline-3">
<h3 id="h:ca088b3f-f2ba-4c18-9a66-0efc6c7174ea">æ ¸å¿ƒç‰¹æ€§</h3>
<div class="outline-text-3" id="text-h:ca088b3f-f2ba-4c18-9a66-0efc6c7174ea">
<p>
æ ¸å¿ƒç‰¹æ€§ï¼š
</p>

<ul class="org-ul">
<li>å¤šç‰©ç†å·è‡³æ”¯æŒï¼›btrfså¯ç”±å¤šä¸ªåº•å±‚ç‰©ç†å·ç»„æˆï¼›æ”¯æŒRAID,ä»¥åŠè”æœº"æ·»åŠ "ã€"ç§»é™¤"ï¼Œ"ä¿®æ”¹"ï¼›</li>
<li>å†™æ—¶å¤åˆ¶æ›´æ–°æœºåˆ¶(CoW)ï¼šå¤åˆ¶ã€æ›´æ–°åŠæ›¿æ¢æŒ‡é’ˆï¼Œè€Œéå°±åœ°æ›´æ–°ï¼›æ–‡ä»¶ä¿®æ”¹
åˆ›å»ºå¤åˆ¶ä»½ï¼Œè·¯å¾„æŒ‡å‘å¤åˆ¶æ–‡ä»¶ï¼Œè¿˜åŸæ—¶æŒ‡å‘åŸæ¥æ–‡ä»¶ä¸Šï¼›</li>
<li>æ•°æ®åŠå…ƒæ•°æ®æ ¡éªŒç æœºåˆ¶ï¼›checksum</li>
<li>æ”¯æŒå­å·ï¼šsub_volumeï¼Œå­å·å®è´¨ä¸Šæ˜¯ä¸€ä¸ªä¿å­˜æ–‡ä»¶å’Œç›®å½•çš„å‘½åçš„Bæ ‘ã€‚å®ƒ
ä»¬çš„inodeä¿å­˜åœ¨æ ‘æ ¹ä¹‹æ ‘ä¸­ï¼Œå¯ä»¥ä¸ºéæ ¹ç”¨æˆ·å’Œç»„æ‰€æœ‰ã€‚å­å·å¯é€‰è®¾å®šå—é…
é¢ã€‚å­å·å†…çš„æ‰€æœ‰å—å’Œæ–‡ä»¶åŒºæ®µéƒ½æœ‰å¼•ç”¨è®¡æ•°ä»¥ä¾¿åšå¿«ç…§ã€‚å’Œè™šæ‹Ÿæœºå­˜å‚¨çš„åŠ¨
æ€æ‰©å±•ç›¸ä¼¼ï¼Œå…¶åªæŒ‰éœ€ä½¿ç”¨è®¾å¤‡ç©ºé—´ï¼Œæ¶ˆé™¤äº†è®¸å¤šåŠæ»¡çš„åˆ†åŒºã€‚ç”¨æˆ·ä¹Ÿå¯ç”¨ä¸
åŒçš„æŒ‚è½½é€‰é¡¹æŒ‚è½½å­å·ï¼Œå¾—åˆ°æ›´çµæ´»çš„å®‰å…¨æ€§ã€‚</li>
<li>å¿«ç…§ï¼šæ”¯æŒå¿«ç…§çš„å¿«ç…§ï¼›å‘½ä»¤ï¼šbtrfs subvolume snapshot</li>
<li>é€æ˜å‹ç¼©æœºåˆ¶ï¼šä¼ è¾“æ•°æ®è‡ªåŠ¨å‹ç¼©ï¼Œè¯»å–æ—¶è‡ªåŠ¨è§£å‹ç¼©ï¼Œä¸ä»…å‡å°äº†æ–‡ä»¶çš„å¤§
å°ï¼Œè¿˜æé«˜äº†æ€§èƒ½ã€‚</li>
<li>Btrfsæ”¯æŒåœ¨çº¿ç¢ç‰‡æ•´ç†ã€‚å‘½ä»¤ï¼š btrfs filesystem defragment</li>
</ul>

<p>
æ³¨æ„: åœ¨åŒä¸€ä¸ªç£ç›˜ä¸Šä¸åŒåˆ†åŒºç»„æˆä¸€ä¸ª btrfs æ–‡ä»¶ç³»ç»Ÿå¹¶æ— ç‰¹æ®Šæ„ä¹‰ã€‚å»ºè®®
ä½¿ç”¨å¤šå—ç¡¬ç›˜ç»„æˆ b-TREE æ–‡ä»¶ç³»ç»Ÿã€‚
</p>
</div>
</div>
<div id="outline-container-h:ac5edb5c-f06c-41ec-afe1-aa64e5291c77" class="outline-3">
<h3 id="h:ac5edb5c-f06c-41ec-afe1-aa64e5291c77">åˆ›å»º b-tree æ–‡ä»¶ç³»ç»Ÿ</h3>
<div class="outline-text-3" id="text-h:ac5edb5c-f06c-41ec-afe1-aa64e5291c77">
<p>
<b>mkfs.btrfs å‘½ä»¤ï¼Œæ–‡ä»¶ç³»ç»Ÿåˆ›å»ºï¼š</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">-L <span style="color: #8b2252;">'LABEL'</span> : &#25351;&#23450;&#21367;&#26631;
-D
-m &lt;profile&gt; : &#35774;&#32622;&#20803;&#25968;&#25454;&#23646;&#24615;&#65292;&#21487;&#20197;&#22522;&#20110;raid0,raid1,raid5,raid6,raid10,single,dup &#21019;&#24314;&#20803;&#25968;&#25454;
-d &lt;type&gt; : &#26126;&#25968;&#25454;&#26159;&#22914;&#20309;&#36328;&#22810;&#35774;&#22791;&#23384;&#25918;&#30340;&#31867;&#22411;raid0,raid1,raid5,raid6,raid10,single(&#21482;&#23384;&#21333;&#20221;)
-O &lt;feature&gt;  : &#25351;&#26126;&#22312;&#26684;&#24335;&#26102;&#25903;&#25345;&#30340;&#23646;&#24615;
    -O list-all&#65306;&#21015;&#20986;&#25903;&#25345;&#30340;feature
</pre>
</div>

<p>
æ¼”ç¤ºï¼šæ·»åŠ  3 å—ç‰©ç†ç£ç›˜ sdb, sdc, sdd å¹¶åšæˆ b-tree æ–‡ä»¶ç³»ç»Ÿ
</p>

<div class="org-src-container">
<pre class="src src-sh">systemctl set-defaul multi-user.target &#19981;&#21551;&#21160;&#22270;&#24418;&#30028;&#38754;

[root@node01 ~]# lsblk
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sdb               8:16   0   20G  0 disk
sdc               8:32   0   20G  0 disk
sdd               8:48   0   20G  0 disk

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558; /dev/sdb , /dev/sdc &#20004;&#20010;&#35774;&#22791;&#20570;&#25104; b-tree &#25991;&#20214;&#31995;&#32479;</span>
[root@node01 ~]# mkfs.btrfs -L mydata /dev/sdb /dev/sdc
btrfs-progs v4.9.1
Label:              mydata  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21367;&#26631;</span>
UUID:               ec5cff63-8a4f-4bce-8eb4-4bb64f85e4a7
Node size:          16384
Sector size:        4096
Filesystem size:    40.00GiB  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24635;&#31354;&#38388;&#22823;&#23567;</span>
Block group profiles:
  Data:             RAID0             2.00GiB
  Metadata:         RAID1             1.00GiB
  System:           RAID1             8.00MiB
SSD detected:       no
Incompat features:  extref, skinny-metadata
Number of devices:  2
Devices:
   ID        SIZE  PATH
    1    20.00GiB  /dev/sdb
    2    20.00GiB  /dev/sdc
</pre>
</div>

<p>
<b>æ˜¾ç¤ºbtræ–‡ä»¶ç³»ç»Ÿ btrfs filesystem show</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@node01 ~]# btrfs filesystem show
Label: <span style="color: #8b2252;">'mydata'</span>  uuid: ec5cff63-8a4f-4bce-8eb4-4bb64f85e4a7
    Total devices 2 FS bytes used 112.00KiB
    devid    1 size 20.00GiB used 2.01GiB path /dev/sdb
    devid    2 size 20.00GiB used 2.01GiB path /dev/sdc
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992; blkid &#21457;&#29616; /dev/sdb, /dev/sdc &#23646;&#20110;&#21516;&#19968;&#20010;&#21367;&#65292;&#20294;&#23376;&#21367;&#30340; UUID &#19981;&#19968;&#21516;</span>
[root@node01 ~]# blkid /dev/sdb
/dev/sdb: <span style="color: #a0522d;">LABEL</span>=<span style="color: #8b2252;">"mydata"</span> <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"ec5cff63-8a4f-4bce-8eb4-4bb64f85e4a7"</span> <span style="color: #a0522d;">UUID_SUB</span>=<span style="color: #8b2252;">"92ee4816-2fa6-4f5d-a4b5-0158af186c06"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"btrfs"</span>
[root@node01 ~]# blkid /dev/sdc
/dev/sdc: <span style="color: #a0522d;">LABEL</span>=<span style="color: #8b2252;">"mydata"</span> <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"ec5cff63-8a4f-4bce-8eb4-4bb64f85e4a7"</span> <span style="color: #a0522d;">UUID_SUB</span>=<span style="color: #8b2252;">"2267dd05-989b-438f-a9f3-cf1e736f90bf"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"btrfs"</span>
</pre>
</div>

<p>
<b>æŒ‚è½½ï¼ŒæŒ‚è½½ä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@node01 ~]# mkdir /mydata
[root@node01 ~]# mount -t btrfs /dev/sdb /mydata/   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25346;&#36733;&#20219;&#20309;&#19968;&#20010; btrfs &#21367;&#23601;&#34892;&#12290;#&#21482;&#35201;blkid&#33021;&#35782;&#21035;&#65292;&#23601;&#19981;&#29992;-t btrfs&#25351;&#23450;&#20102;</span>
[root@node01 ~]# mount
/dev/sdb on /mydata type btrfs (rw,relatime,space_cache,<span style="color: #a0522d;">subvolid</span>=5,<span style="color: #a0522d;">subvol</span>=/)
[root@node01 ~]# df -h
/dev/sdb                  40G   17M   38G   1% /mydata
</pre>
</div>

<p>
<b>é€æ˜å‹ç¼©æœºåˆ¶ï¼š</b>
</p>

<p>
å‘½ä»¤ï¼šmount -o compress={lzo|zlib} DEVICE MOUNT_POINT
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@node01 ~]# umount /dev/sdb
[root@node01 ~]# mount -o <span style="color: #a0522d;">compress</span>=lzo /dev/sdb /mydata/
[root@node01 ~]# cp /etc/rc.d/init.d/functions  /mydata/
[root@node01 ~]# ll /mydata/
-rw-r--r-- 1 root root 17500 Apr 28 09:40 functions
</pre>
</div>

<p>
è¿™ç§å‹ç¼©è§£å‹ç¼©æ˜¯è‡ªåŠ¨çš„ï¼Œç”¨æˆ·æ˜¯çœ‹ä¸åˆ°çš„ã€‚
</p>
</div>
</div>
<div id="outline-container-h:35b34bd7-8e74-4621-9c36-a592c768c00e" class="outline-3">
<h3 id="h:35b34bd7-8e74-4621-9c36-a592c768c00e">btrfs æ–‡ä»¶ç³»ç»Ÿå‘½ä»¤</h3>
<div class="outline-text-3" id="text-h:35b34bd7-8e74-4621-9c36-a592c768c00e">
<div class="org-src-container">
<pre class="src src-sh">[root@node01 ~]# btrfs
btrfs               btrfs-convert       btrfs-find-root     btrfs-map-logical   btrfstune           
btrfsck             btrfs-debug-tree    btrfs-image         btrfs-select-super  btrfs-zero-log
</pre>
</div>

<p>
ç»Ÿä¸€å‘½ä»¤å·¥å…·btrfsï¼Œå°†å¤šä¸ªå‘½ä»¤åˆå¹¶äº†ã€‚
</p>

<ul class="org-ul">
<li>btrfs-convert  åŠ¨æ€è½¬æ¢æ–‡ä»¶ç³»ç»Ÿ</li>
<li>btrfsck  æ–‡ä»¶ç³»ç»Ÿæ£€æµ‹</li>
</ul>

<p>
å¸®åŠ©æ‰‹å†Œ man btrfs
</p>

<p>
<b>btrfs filesystem&lt; subcommand&gt; &lt;args&gt; æ–‡ä»¶ç³»ç»Ÿç›¸å…³</b>
</p>

<ol class="org-ol">
<li><p>
å±æ€§æŸ¥çœ‹ï¼š btrfs filesystem show [options] [&lt;path&gt;|&lt;uuid&gt;|&lt;device&gt;|label]
</p>

<p>
å¸®åŠ©æ‰‹å†Œ man btrfs-filesystem
</p>

<p>
-m| &#x2013;mounted : æŸ¥çœ‹å½“å‰æ–‡ä»¶ç³»ç»ŸæŒ‚è½½æƒ…å†µ. å¦‚ï¼Œ[root@node01 ~]# btrfs filesystem show -m
</p></li>

<li>æŸ¥çœ‹å·²æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿç©ºé—´ä½¿ç”¨æƒ…å†µï¼šbtrfs filesystem df [options] &lt;path&gt;</li>

<li>åŒæ­¥ï¼šbtrfs filesystem sync &lt;path&gt;</li>

<li>ç£ç›˜ç¢ç‰‡æ•´ç†ï¼šbtrfs filesystem defragment [options] &lt;file&gt;|&lt;dir&gt; [&lt;file&gt;|&lt;dir&gt;&#x2026;]</li>

<li><p>
åŠ¨æ€è°ƒæ•´å¤§å° ï¼šbtrfs filesystem resize [devid:][+/-]&lt;newsize&gt;[kKmMgGtTpPeE]|[devid:]max &lt;path&gt;
</p>

<p>
å¿…é¡»æŒ‚è½½å®Œåè°ƒæ•´å¤§å°
</p>

<p>
ç›´æ¥è°ƒæ•´ä¸ºæœ€å¤§ [root@node01 ~]# btrfs filesystem resize max /mydata
</p></li>

<li><p>
æŒ‡æ˜æˆ–æ˜¾ç¤ºå·æ ‡ btrfs filesystem label [&lt;dev&gt;|&lt;mountpoint&gt;] [&lt;newlabel&gt;]
å¦‚
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@node01 ~]# btrfs filesystem label /dev/sdb 
mydata
</pre>
</div></li>
</ol>


<p>
<b>btrfs device &lt;subcommand&gt; &lt;args&gt; è®¾å¤‡ç›¸å…³</b>
</p>

<p>
æ‰‹å†Œbtrfs-device
</p>

<ol class="org-ol">
<li><code>btrfs device add [-Kf] &lt;dev&gt; [&lt;dev&gt;...] &lt;path&gt;</code>  æ–°å¢è®¾å¤‡</li>
</ol>

<p>
ä¼šè‡ªåŠ¨æ·»åŠ è‡ªåŠ¨æ‰§è¡Œæ‰©å±•ï¼Œä½†æ•°æ®æ²¡æœ‰å‡è¡¡åˆ°æ–°è®¾å¤‡ä¸Šï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨ btrfs balance å‘½ä»¤
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@node01 ~]# btrfs device add /dev/sdd  /mydata
[root@node01 ~]# df -lh
/dev/sdb                  60G   18M   56G   1% /mydata
</pre>
</div>


<ol class="org-ol">
<li>btrfs device delete &lt;dev&gt;|&lt;devid&gt; [&lt;dev&gt;|&lt;devid&gt;&#x2026;] &lt;path&gt;  ç§»é™¤è®¾å¤‡</li>
</ol>
<p>
ä¼šè‡ªåŠ¨è¡ŒåŠ¨è®¾å¤‡ä¸Šçš„æ•°æ®åˆ°å…¶å®ƒè®¾å¤‡ä¸Šã€‚
</p>

<p>
å¦‚ï¼Œ[root@node01 ~]# btrfs device delete /dev/sdb /mydata
</p>

<ol class="org-ol">
<li>btrfs device scan [(&#x2013;all-devices|-d)|&lt;device&gt; [&lt;device&gt;&#x2026;]]  æ‰«æè®¾å¤‡</li>

<li>btrfs device  ready &lt;device&gt; è½¬ä¸ºå¤‡ç”¨çŠ¶æ€</li>

<li>btrfs device stats [options] &lt;path&gt;|&lt;device&gt;  æ˜¾ç¤º IO ç»Ÿè®¡æ•°æ®</li>
</ol>


<p>
<b>btrfs balance &lt;subcommand&gt; &lt;args&gt;  æ•°æ®å¹³è¡¡</b>
</p>

<ol class="org-ol">
<li>btrfs balance start [options] &lt;path&gt;  åœ¨çº¿å®ç°å—ç§»åŠ¨</li>
</ol>

<div class="org-src-container">
<pre class="src src-sh">&#23376;&#21629;&#20196;
-d[&lt;filters&gt;]  &#20462;&#25913;&#25968;&#25454;&#30340;&#32452;&#32455;&#26426;&#21046;
-m[&lt;filters&gt;] &#20462;&#25913;&#20803;&#25968;&#25454;&#32452;&#32455;&#26426;&#21046;
-s[&lt;filters&gt;]  &#20462;&#25913;&#31995;&#32479;&#30340;&#32452;&#32455;&#26426;&#21046;
Profile names, used<span style="color: #a020f0;"> in</span> profiles and convert are one of: raid0, raid1, raid10, raid5, raid6, dup, single
</pre>
</div>

<ol class="org-ol">
<li>btrfs balance pause &lt;path&gt;  æš‚åœ</li>

<li>btrfs balance cancel &lt;path&gt; å–æ¶ˆ</li>

<li>btrfs balance resume &lt;path&gt; ç»§ç»­</li>

<li>btrfs balance status [-v] &lt;path&gt; æ˜¾ç¤ºçŠ¶æ€</li>
</ol>

<p>
<b>ç®¡ç†å­å·å’Œå¿«ç…§å‘½ä»¤ btrfs subvolume&lt; subcommand&gt; [&lt;args&gt;]</b>
</p>

<p>
æ‰‹å†Œ man btrfs-subvolume
</p>

<p>
A subvolume in btrfs can be accessed in two ways:
</p>

<ul class="org-ul">
<li>like any other directory that is accessible to the user</li>
<li>like a separately mounted filesystem (options subvol or subvolid)</li>
</ul>

<p>
å­å·ä¸‹çš„æ–‡ä»¶éƒ½å¯ä»¥é€šè¿‡çˆ¶å·è®¿é—®åˆ°
</p>

<ol class="org-ol">
<li><p>
btrfs subvolume create [-i &lt;qgroupid&gt;] [&lt;dest&gt;/]&lt;name&gt; åˆ›å»ºå­å·
</p>

<p>
å¦‚åœ¨mydata å·ä¸‹åˆ›å»ºlogså­å·ï¼Œ[root@node01 ~]# btrfs subvolume create /mydata/logs
</p>

<p>
æŒ‚è½½æ—¶ä½¿ç”¨subvol subvolid æŒ‚è½½ï¼Œå¦‚ mount -o subvol=logs /dev/sdb /mnt  æˆ–  mount -o subvolid=264 /dev/sdb /mnt  
</p>

<p>
mount -o subvol=logs /dev/sdb /mnt/log &#x2013;mkdir
</p></li>

<li>btrfs subvolume delete [options] &lt;subvolume&gt; [&lt;subvolume&gt;&#x2026;] åˆ é™¤å­å·</li>

<li>btrfs subvolume list [options] [-G [+|-]&lt;value&gt;] [-C [+|-]&lt;value&gt;] [&#x2013;sort=rootid,gen,ogen,path] &lt;path&gt; åˆ—å‡ºæ‰€æœ‰å­å·</li>

<li>btrfs subvolume snapshot [-r] &lt;source&gt; &lt;dest&gt;|[&lt;dest&gt;/]&lt;name&gt;  åšå¿«ç…§å¿«ç…§å·å¿…é¡»ä¸åŸå·åœ¨ä¸€ä¸ªå·ç»„ä¸­</li>

<li>btrfs subvolume  get-default &lt;path&gt; æŸ¥çœ‹é»˜è®¤å·</li>

<li>btrfs subvolume set-default &lt;id&gt; &lt;path&gt; è®¾ç½®é»˜è®¤å·</li>

<li>btrfs subvolume show &lt;path&gt; æŸ¥çœ‹å­å·ä¿¡æ¯</li>
</ol>
</div>
</div>
<div id="outline-container-h:16e27007-cf1d-4a6e-a182-4803dd8b7236" class="outline-3">
<h3 id="h:16e27007-cf1d-4a6e-a182-4803dd8b7236">è®¾å¤‡ç®¡ç†å‘½ä»¤</h3>
<div class="outline-text-3" id="text-h:16e27007-cf1d-4a6e-a182-4803dd8b7236">
<p>
å‘½ä»¤ï¼šbtrfs device&lt; subcommand&gt; &lt;args&gt;
</p>
</div>
</div>
<div id="outline-container-h:464f5498-d025-4bcc-a4d4-a7ebb7d1567d" class="outline-3">
<h3 id="h:464f5498-d025-4bcc-a4d4-a7ebb7d1567d">å—ç»„å‡è¡¡ç®¡ç†</h3>
<div class="outline-text-3" id="text-h:464f5498-d025-4bcc-a4d4-a7ebb7d1567d">
<p>
å‘½ä»¤ï¼šbtrfs [filesystem] balance &lt;subcommand&gt;|&lt;args&gt;
</p>

<p>
btrfs scrub ç”¨æ¥æ“¦é™¤æ•°æ®
</p>

<p>
btrfs rescue ç´§æ€¥æ•‘æ´
</p>

<p>
btrfs restore ä¿®å¤æ¨¡å¼
</p>

<p>
èŒƒä¾‹ï¼š åŠ¨æ€è°ƒæ•´å¤§å° ï¼šbtrfs filesystem resize [devid:][+/-]&lt;newsize&gt;[kKmMgGtTpPeE]|[devid:]max &lt;path&gt;
</p>

<p>
å¿…é¡»æŒ‚è½½å®Œåè°ƒæ•´å¤§å°
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@node01 ~]# btrfs filesystem show /mydata
[root@node01 ~]# btrfs filesystem resize -10G /mydata
Resize <span style="color: #8b2252;">'/mydata'</span> of <span style="color: #8b2252;">'-10G'</span>
[root@node01 ~]# df -h   <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#30475;&#21040;&#21407;&#26412; 40G &#21464;&#25104;&#20102; 30G</span>
/dev/sdb                  30G   18M   18G   1% /mydata
[root@node01 ~]# btrfs filesystem resize +5G /mydata
Resize <span style="color: #8b2252;">'/mydata'</span> of <span style="color: #8b2252;">'+5G'</span>
[root@node01 ~]# df -h
/dev/sdb                  35G   18M   28G   1% /mydata
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;&#30495;&#27491;&#30340;&#21487;&#29992;&#31354;&#38388;&#20351;&#29992; btrfs &#33258;&#24102;&#30340; df &#21629;&#20196;</span>
[root@node01 ~]# btrfs filesystem df /mydata
Data, RAID0: <span style="color: #a0522d;">total</span>=2.00GiB, <span style="color: #a0522d;">used</span>=780.00KiB
System, RAID1: <span style="color: #a0522d;">total</span>=8.00MiB, <span style="color: #a0522d;">used</span>=16.00KiB
Metadata, RAID1: <span style="color: #a0522d;">total</span>=1.00GiB, <span style="color: #a0522d;">used</span>=112.00KiB
GlobalReserve, single: <span style="color: #a0522d;">total</span>=16.00MiB, <span style="color: #a0522d;">used</span>=0.00B
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#30452;&#25509;&#35843;&#25972;&#20026;&#26368;&#22823;</span>
[root@node01 ~]# btrfs filesystem resize max /mydata

[root@node01 ~]# btrfs filesystem usage -h /mydata
Overall:
    Device size:          40.00GiB
    Device allocated:           4.02GiB
    Device unallocated:          35.98GiB
    Device missing:             0.00B
    Used:               1.01MiB
    Free (estimated):          37.98GiB    (min: 19.99GiB)
    Data ratio:                  1.00
    Metadata ratio:              2.00
    Global reserve:          16.00MiB    (used: 0.00B)

Data,RAID0: Size:2.00GiB, Used:780.00KiB
   /dev/sdb       1.00GiB
   /dev/sdc       1.00GiB

Metadata,RAID1: Size:1.00GiB, Used:112.00KiB
   /dev/sdb       1.00GiB
   /dev/sdc       1.00GiB

System,RAID1: Size:8.00MiB, Used:16.00KiB
   /dev/sdb       8.00MiB
   /dev/sdc       8.00MiB

Unallocated:
   /dev/sdb      17.99GiB
   /dev/sdc      17.99GiB
</pre>
</div>


<p>
èŒƒä¾‹ï¼š  btrfs device add [-Kf] &lt;dev&gt; [&lt;dev&gt;&#x2026;] &lt;path&gt;  æ–°å¢è®¾å¤‡
</p>

<p>
ä¼šè‡ªåŠ¨æ·»åŠ è‡ªåŠ¨æ‰§è¡Œæ‰©å±•ï¼Œä½†æ•°æ®æ²¡æœ‰å‡è¡¡åˆ°æ–°è®¾å¤‡ä¸Šï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨ btrfs balance å‘½ä»¤
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@node01 ~]# btrfs device add /dev/sdd  /mydata
[root@node01 ~]# df -lh
/dev/sdb                  60G   18M   56G   1% /mydata
[root@node01 ~]# btrfs balance start /mydata
WARNING:

    Full balance without filters requested. This operation is very
    intense and takes potentially very long. It is recommended to
    use the balance filters to narrow down the balanced data.
    Use <span style="color: #8b2252;">'btrfs balance start --full-balance'</span> option to skip this
    warning. The operation will start<span style="color: #a020f0;"> in</span> 10 seconds.
</pre>
</div>


<p>
èŒƒä¾‹ btrfs device delete &lt;dev&gt;|&lt;devid&gt; [&lt;dev&gt;|&lt;devid&gt;&#x2026;] &lt;path&gt;  ç§»é™¤è®¾å¤‡
</p>

<p>
ä¼šè‡ªåŠ¨è¡ŒåŠ¨è®¾å¤‡ä¸Šçš„æ•°æ®åˆ°å…¶å®ƒè®¾å¤‡ä¸Šã€‚
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@node01 ~]# btrfs device delete /dev/sdb /mydata
[root@node01 ~]# df -lh
/dev/sdc                  40G   18M   38G   1% /mydata
[root@node01 ~]# btrfs filesystem show /mydata
Label: <span style="color: #8b2252;">'mydata'</span>  uuid: ec5cff63-8a4f-4bce-8eb4-4bb64f85e4a7
    Total devices 2 FS bytes used 908.00KiB
    devid    2 size 20.00GiB used 2.03GiB path /dev/sdc
    devid    3 size 20.00GiB used 2.03GiB path /dev/sdd
</pre>
</div>

<p>
èŒƒä¾‹  btrfs balance start [options] &lt;path&gt;  åœ¨çº¿å®ç°å—ç§»åŠ¨ï¼Œå¹¶ä¿®æ”¹æ•°æ®çš„ç»„ç»‡æœºåˆ¶ä¸º raid5 
</p>

<p>
å­å‘½ä»¤
-d[&lt;filters&gt;]  ä¿®æ”¹æ•°æ®çš„ç»„ç»‡æœºåˆ¶
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@node01 ~]# btrfs device  add /dev/sdb /mydata
[root@node01 ~]# btrfs balance start /mydata
[root@node01 ~]# btrfs filesystem show /mydata
    devid    2 size 20.00GiB used 1.03GiB path /dev/sdc
    devid    3 size 20.00GiB used 2.00GiB path /dev/sdd
    devid    4 size 20.00GiB used 2.03GiB path /dev/sdb
[root@node01 ~]# btrfs balance start -dconvert=raid5 /mydata
Done, had to relocate 1 out of 3 chunks
</pre>
</div>


<p>
èŒƒä¾‹ å¦‚åœ¨mydata å·ä¸‹åˆ›å»ºå­å·å¹¶æŒ‚è½½å­å·åˆ° /mnt ä¸‹ï¼Œbtrfs subvolume create [-i &lt;qgroupid&gt;] [&lt;dest&gt;/]&lt;name&gt; åˆ›å»ºå­å·
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@node01 ~]# btrfs subvolume show /mydata
[root@node01 ~]# btrfs subvolume create /mydata/logs
Create subvolume <span style="color: #8b2252;">'/mydata/logs'</span>
[root@node01 ~]# btrfs subvolume show /mydata
/mydata
    Name:             &lt;FS_TREE&gt;
    UUID:             -
    Parent UUID:         -
    Received UUID:         -
    Creation time:         -
    Subvolume ID:         5
    Generation:         86
    Gen at creation:     0
    Parent ID:         0
    Top level ID:         0
    Flags:             -
    Snapshot(s):
                logs
[root@node01 ~]# btrfs subvolume list /mydata  
ID 264 gen 86 top level 5 path logs
&#21487;&#20197;&#30475;&#21040; logs &#23376;&#21367;&#23545;&#24212;&#30340; id &#21495;&#20026;264

[root@node01 ~]# btrfs subvolume create /mydata/cache
[root@node01 ~]# btrfs subvolume list /mydata
ID 264 gen 86 top level 5 path logs
ID 265 gen 87 top level 5 path cache

&#25346;&#36733;&#23376;&#21367;
[root@node01 ~]# umount /mydata
[root@node01 ~]# mount -o <span style="color: #a0522d;">subvol</span>=logs /dev/sdb /mnt
[root@node01 ~]# ls /mnt
[root@node01 ~]# cp /var/log/messages /mnt
[root@node01 ~]# ls /mnt/
messages
[root@node01 ~]# btrfs subvolume show /mnt
/mnt
    Name:             logs
    UUID:             e684c81d-c907-b841-895a-08ce66f3ea0f
    Parent UUID:         -
    Received UUID:         -
    Creation time:         2018-05-07 07:01:23 +0800
    Subvolume ID:         264
    Generation:         89
    Gen at creation:     86
    Parent ID:         5
    Top level ID:         5
    Flags:             -
    Snapshot(s):
&#23376;&#21367;&#19979;&#30340;&#25991;&#20214;&#37117;&#21487;&#20197;&#36890;&#36807;&#29238;&#21367;&#35775;&#38382;&#21040;
[root@node01 ~]# umount  /mnt
[root@node01 ~]# mount /dev/sdb /mydata
[root@node01 ~]# ls /mydata/logs
messages
&#21024;&#38500;&#23376;&#21367;
[root@node01 ~]# btrfs subvolume delete /mydata/logs
[root@node01 ~]# btrfs subvolume list /mydata/
ID 265 gen 87 top level 5 path cache
</pre>
</div>

<p>
æ¼”ç¤º6  åˆ›å»ºå­å·å¿«ç…§ btrfs subvolume snapshot [-r] &lt;source&gt; &lt;dest&gt;|[&lt;dest&gt;/]&lt;name&gt;  åšå¿«ç…§
</p>

<p>
å¿«ç…§å·å¿…é¡»ä¸åŸå·åœ¨ä¸€ä¸ªå·ç»„ä¸­
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@node01 ~]# btrfs subvolume create /mydata/logs
[root@node01 ~]# cp /etc/grub2.cfg  /mydata/logs/
[root@node01 ~]# btrfs subvolume snapshot /mydata/logs /mydata/logs_snapshot
[root@node01 ~]# btrfs subvolume list /mydata/logs
ID 265 gen 87 top level 5 path cache
ID 266 gen 95 top level 5 path logs
ID 267 gen 95 top level 5 path logs_snapshot
[root@node01 ~]# btrfs subvolume delete /mydata/logs_snapshot
cp &#21629;&#20196;&#21487;&#20197;&#21333;&#29420;&#20026;&#25991;&#20214;&#21019;&#24314;&#24555;&#29031;
[root@node01 logs]# cp --reflink=auto grub2.cfg grub2.cfg_snap
[root@node01 logs]# vim  grub2.cfg
[root@node01 logs]# vim grub2.cfg_snap
</pre>
</div>


<p>
èŒƒä¾‹ ext4 æ–‡ä»¶ç³»ç»Ÿè½¬æ¢ä¸º btrfs ç³»ç»Ÿ
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@node01 ~]# btrfs balance start -dconvert=single -mconvert=raid1 /mydata
&#25286;&#38500;&#19968;&#20010;&#35774;&#22791;&#24182;&#36716;&#25442;&#20026;ext4 &#31995;&#32479;
[root@node01 ~]# btrfs device delete /dev/sdd /mydata
[root@node01 ~]# fdisk  /dev/sdd
<span style="color: #0000ff;">Command</span> (m for help): n
<span style="color: #0000ff;">Select</span> (default p): p
Partition number (1-4, default 1):
First sector (2048-41943039, default 2048):
Last sector, +sectors or +size{K,M,G} (2048-41943039, default 41943039):
<span style="color: #0000ff;">Command</span> (m for help): w   
[root@node01 ~]# mke2fs -t ext4 /dev/sdd1
[root@node01 ~]#  mount /dev/sdd1 /mnt
[root@node01 ~]# cp /etc/fstab  /mnt

&#36716;&#25442;&#20026; btrfs&#31995;&#32479;&#12288;
[root@node01 ~]# umount  /mnt
[root@node01 ~]# fsck -f /dev/sdd1
[root@node01 ~]# btrfs-convert  /dev/sdd1
conversion complete[root@node01 ~]# btrfs filesystem show
Label: <span style="color: #8b2252;">'mydata'</span>  uuid: ec5cff63-8a4f-4bce-8eb4-4bb64f85e4a7
    Total devices 2 FS bytes used 496.00KiB
    devid    2 size 20.00GiB used 1.28GiB path /dev/sdc
    devid    4 size 20.00GiB used 288.00MiB path /dev/sdb

Label: none  uuid: d0092458-52ea-4a27-be4f-4a47840fe0dd
    Total devices 1 FS bytes used 494.20MiB
    devid    1 size 20.00GiB used 808.29MiB path /dev/sdd1


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;btrfs&#25991;&#20214;&#31995;&#32479;&#22238;&#28378;&#21407;&#26469;&#30340;&#25991;&#20214;&#31995;&#32479;</span>
[root@node01 ~]# btrfs-convert  -r /dev/sdd1
[root@node01 ~]# blkid /dev/sdd1
/dev/sdd1: <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"a25e7670-2b48-4a69-a520-e9051e9dba99"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"ext4"</span>
</pre>
</div>



<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">1&#12289;&#21019;&#24314;btrfs&#25991;&#20214;&#31995;&#32479;
      &#22312;vmware&#20013;&#26032;&#22686;&#20004;&#22359;20G&#30913;&#30424;&#65292;/dev/sdb&#19982;/dev/sdc
[root@localhost ~]# mkfs.btrfs -L <span style="color: #8b2252;">'B-tree-fs'</span> -f /dev/sd{b,c}
[root@localhost ~]# btrfs filesystem show
Label: <span style="color: #8b2252;">'B-tree-fs'</span>  uuid: b254b565-0418-4601-8317-f9a5306c6f19
Total devices 2 FS bytes used 112.00KiB
devid    1 size 20.00GiB used 2.03GiB path /dev/sdb
devid    2 size 20.00GiB used 2.01GiB path /dev/sdc

2&#12289;&#25346;&#36733;&#25991;&#20214;&#31995;&#32479;
[root@localhost ~]# mkdir /btrdata
[root@localhost ~]# mount /dev/sdb /btrdata    
[root@localhost ~]# df -h | grep btrdata
/dev/sdb         40G  1.0M   38G   1% /btrdata

3&#12289;&#24314;&#31435;&#23376;&#21367;
[root@localhost ~]# btrfs subvolume create /btrdata/mydata
Create subvolume <span style="color: #8b2252;">'/btrdata/mydata'</span>
[root@localhost ~]# cp -r /root/* /btrdata/mydata    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22797;&#21046;&#25968;&#25454;</span>
[root@localhost ~]# btrfs filesystem show
Label: <span style="color: #8b2252;">'B-tree-fs'</span>  uuid: b254b565-0418-4601-8317-f9a5306c6f19
Total devices 2 FS bytes used 735.67MiB
devid    1 size 20.00GiB used 2.03GiB path /dev/sdb
devid    2 size 20.00GiB used 2.01GiB path /dev/sdc

4&#12289;&#25193;&#23637;&#25991;&#20214;&#31995;&#32479;
[root@localhost ~]# btrfs device add /dev/sdd /btrdata
[root@localhost ~]# btrfs filesystem show
Label: <span style="color: #8b2252;">'B-tree-fs'</span>  uuid: b254b565-0418-4601-8317-f9a5306c6f19
Total devices 3 FS bytes used 735.67MiB
devid    1 size 20.00GiB used 2.03GiB path /dev/sdb
devid    2 size 20.00GiB used 2.01GiB path /dev/sdc
devid    3 size 20.00GiB used 0.00 path /dev/sdd
[root@localhost ~]# df -h | grep btrdata
/dev/sdb         60G  772M   56G   2% /btrdata

5&#12289;&#37325;&#26032;&#22343;&#34913;&#25991;&#20214;&#31995;&#32479;
[root@localhost ~]# btrfs balance start /btrdata
Done, had to relocate 6 out of 6 chunks
[root@localhost ~]# btrfs filesystem show
Label: <span style="color: #8b2252;">'B-tree-fs'</span>  uuid: b254b565-0418-4601-8317-f9a5306c6f19
Total devices 3 FS bytes used 736.20MiB
devid    1 size 20.00GiB used 1.03GiB path /dev/sdb
devid    2 size 20.00GiB used 2.00GiB path /dev/sdc
devid    3 size 20.00GiB used 2.03GiB path /dev/sdd

6&#12289;&#31227;&#38500;&#30828;&#30424;
      &#31227;&#38500;&#30828;&#30424;&#30340;&#26102;&#20505;&#20250;&#20808;&#25226;&#25968;&#25454;&#31227;&#21160;&#21040;&#20854;&#20182;&#30424;&#65292;&#19981;&#38656;&#35201;&#20687;LVM&#37027;&#26679;&#38656;&#35201;&#25163;&#21160;&#31227;&#21160;&#25968;&#25454;
[root@localhost ~]# btrfs device delete /dev/sdb /btrdata
[root@localhost ~]# df -h | grep btrdata
/dev/sdc         40G  772M   38G   2% /btrdata
[root@localhost ~]# ls /btrdata/
commdir  mydata
[root@localhost ~]# head /btrdata/mydata/anaconda-ks.cfg
<span style="color: #b22222;">#</span><span style="color: #b22222;">version=RHEL7</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">System authorization information</span>
auth --enableshadow --passalgo=sha512

<span style="color: #b22222;"># </span><span style="color: #b22222;">Use CDROM installation media</span>
cdrom
<span style="color: #b22222;"># </span><span style="color: #b22222;">Use graphical install</span>
graphical
<span style="color: #b22222;"># </span><span style="color: #b22222;">Run the Setup Agent on first boot</span>
firstboot --enable

7&#12289;&#20462;&#25913;&#25968;&#25454;&#25110;&#20803;&#25968;&#25454;&#30340;RAID&#32423;&#21035;
[root@localhost ~]# btrfs device add /dev/sdb /btrdata
[root@localhost ~]# btrfs filesystem df /btrdata
Data, RAID0: <span style="color: #a0522d;">total</span>=2.00GiB, <span style="color: #a0522d;">used</span>=699.96MiB
System, RAID1: <span style="color: #a0522d;">total</span>=32.00MiB, <span style="color: #a0522d;">used</span>=16.00KiB
Metadata, RAID1: <span style="color: #a0522d;">total</span>=1.00GiB, <span style="color: #a0522d;">used</span>=35.98MiB
GlobalReserve, single: <span style="color: #a0522d;">total</span>=16.00MiB, <span style="color: #a0522d;">used</span>=0.00

[root@localhost ~]# btrfs balance start -mconvert=raid5 /btrdata    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27492;&#22788;&#20462;&#25913;&#20803;&#25968;&#25454;RAID&#32423;&#21035;</span>
Done, had to relocate 2 out of 3 chunks
[root@localhost ~]# btrfs filesystem df /btrdata
Data, RAID0: <span style="color: #a0522d;">total</span>=2.00GiB, <span style="color: #a0522d;">used</span>=700.21MiB
System, RAID5: <span style="color: #a0522d;">total</span>=64.00MiB, <span style="color: #a0522d;">used</span>=16.00KiB
Metadata, RAID5: <span style="color: #a0522d;">total</span>=1.00GiB, <span style="color: #a0522d;">used</span>=35.91MiB
GlobalReserve, single: <span style="color: #a0522d;">total</span>=16.00MiB, <span style="color: #a0522d;">used</span>=0.00
[root@localhost ~]# btrfs filesystem show
Label: <span style="color: #8b2252;">'B-tree-fs'</span>  uuid: b254b565-0418-4601-8317-f9a5306c6f19
Total devices 3 FS bytes used 735.89MiB
devid    2 size 20.00GiB used 1.53GiB path /dev/sdc
devid    3 size 20.00GiB used 1.53GiB path /dev/sdd
devid    4 size 20.00GiB used 544.00MiB path /dev/sdb

8&#12289;&#21019;&#24314;&#24555;&#29031;
[root@localhost ~]# btrfs subvolume snapshot /btrdata/mydata /btrdata/mydata_snapshot
Create a snapshot of <span style="color: #8b2252;">'/btrdata/mydata'</span><span style="color: #a020f0;"> in</span> <span style="color: #8b2252;">'/btrdata/mydata_snapshot'</span>
[root@localhost ~]# cat /btrdata/mydata/1.txt
1
[root@localhost ~]# echo <span style="color: #8b2252;">'just a test'</span> &gt;&gt; /btrdata/mydata/1.txt
[root@localhost ~]# cat /btrdata/mydata/1.txt
1
just a test
[root@localhost ~]# cat /btrdata/mydata_snapshot/1.txt
1
9&#12289;&#36716;&#25442;
[root@localhost ~]# btrfs balance start -dconvert=single -mconvert=raid1 /btrdata
Done, had to relocate 3 out of 3 chunks
[root@localhost ~]# btrfs device delete /dev/sdd /btrdata
[root@localhost ~]# fdisk /dev/sdd
Welcome to fdisk (util-linux 2.23.2).

Changes will remain<span style="color: #a020f0;"> in</span> memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table
Building a new DOS disklabel with disk identifier 0xadd41340.

<span style="color: #0000ff;">Command</span> (m for help): n
Partition type:
   p   primary (0 primary, 0 extended, 4 free)
   e   extended
<span style="color: #0000ff;">Select</span> (default p): p
Partition number (1-4, default 1): 1
First sector (2048-41943039, default 2048):
Using default value 2048
Last sector, +sectors or +size{K,M,G} (2048-41943039, default 41943039): +5G
Partition 1 of type Linux and of size 5 GiB is set

<span style="color: #0000ff;">Command</span> (m for help): w
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.
[root@localhost ~]# mke2fs -t ext4 /dev/sdd1
mke2fs 1.42.9 (28-Dec-2013)
Filesystem <span style="color: #a0522d;">label</span>=
OS type: Linux
Block <span style="color: #a0522d;">size</span>=4096 (<span style="color: #a0522d;">log</span>=2)
Fragment <span style="color: #a0522d;">size</span>=4096 (<span style="color: #a0522d;">log</span>=2)
<span style="color: #a0522d;">Stride</span>=0 blocks, Stripe <span style="color: #a0522d;">width</span>=0 blocks
327680 inodes, 1310720 blocks
65536 blocks (5.00%) reserved for the super user
First data <span style="color: #a0522d;">block</span>=0
Maximum filesystem <span style="color: #a0522d;">blocks</span>=1342177280
40 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks:
32768, 98304, 163840, 229376, 294912, 819200, 884736

Allocating group tables: done                           
Writing inode tables: done                           
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done

[root@localhost ~]# fsck -f /dev/sdd1
fsck from util-linux 2.23.2
e2fsck 1.42.9 (28-Dec-2013)
Pass 1: Checking inodes, blocks, and sizes
Pass 2: Checking directory structure
Pass 3: Checking directory connectivity
Pass 4: Checking reference counts
Pass 5: Checking group summary information
/dev/sdd1: 12/327680 files (0.0% non-contiguous), 58463/1310720 blocks
[root@localhost ~]# btrfs-convert /dev/sdd1    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;ext4&#25991;&#20214;&#31995;&#32479;&#36716;&#25442;&#20026;btrfs</span>
creating btrfs metadata.
creating ext2fs image file.
cleaning up system chunk.
conversion complete.
[root@localhost ~]# btrfs filesystem show
Label: <span style="color: #8b2252;">'B-tree-fs'</span>  uuid: b254b565-0418-4601-8317-f9a5306c6f19
Total devices 2 FS bytes used 735.81MiB
devid    2 size 20.00GiB used 2.03GiB path /dev/sdc
devid    4 size 20.00GiB used 1.03GiB path /dev/sdb

Label: none  uuid: 12170ec7-9847-4a5a-85ee-13215a478a3c
Total devices 1 FS bytes used 228.42MiB
devid    1 size 5.00GiB used 5.00GiB path /dev/sdd1

Btrfs v3.16.2
[root@localhost ~]# btrfs-convert -r /dev/sdd1     <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;btrfs&#25991;&#20214;&#31995;&#32479;&#22238;&#28378;&#21407;&#26469;&#30340;&#25991;&#20214;&#31995;&#32479;</span>
rollback complete.
[root@localhost ~]# blkid /dev/sdd1
/dev/sdd1: <span style="color: #a0522d;">UUID</span>=<span style="color: #8b2252;">"fbbd653f-fb3f-4715-8c42-8c942564c8f4"</span> <span style="color: #a0522d;">TYPE</span>=<span style="color: #8b2252;">"ext4"</span>
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:0b9caad1-b74d-4267-b495-11de46b4d2de" class="outline-2">
<h2 id="h:0b9caad1-b74d-4267-b495-11de46b4d2de">ISOåˆ¶ä½œ</h2>
<div class="outline-text-2" id="text-h:0b9caad1-b74d-4267-b495-11de46b4d2de">
</div>
<div id="outline-container-h:04af2fe8-0674-474b-86af-8106ce885a94" class="outline-3">
<h3 id="h:04af2fe8-0674-474b-86af-8106ce885a94">å‡†å¤‡å·¥ä½œ</h3>
<div class="outline-text-3" id="text-h:04af2fe8-0674-474b-86af-8106ce885a94">
<p>
<b>ç›®å½•è¯´æ˜</b>
</p>

<ul class="org-ul">
<li>/home/emacle/scriptç›®å½•ä¸ºè„šæœ¬å­˜æ”¾ç›®å½•ã€‚</li>
<li>/home/emacle/emacle_rhel_6.3 ç›®å½•ä¸ºISOåˆ¶ä½œçš„æ ¹ç›®å½•ã€‚</li>
</ul>

<p>
æ­¤ç›®å½•ç»„æˆä¸ºï¼š
</p>
<ol class="org-ol">
<li>æºrhel_6.3å…‰ç›˜ä¸­é™¤Packagesç›®å½•ä¸‹æ‰€æœ‰å®‰è£…åŒ…ã€‚</li>
<li>æ‰‹åŠ¨å®‰è£…æ“ä½œç³»ç»Ÿä¸­/root/anaconda-ks.cfgæ–‡ä»¶ã€‚ä¹‹åä¼šå¯¹æ­¤æ–‡ä»¶åšå®šåˆ¶åŒ–ä¿®æ”¹ã€‚</li>
<li>ä»æ‰‹åŠ¨å®‰è£…æ“ä½œç³»ç»Ÿä¸­/root/install.logæ–‡ä»¶ä¸­æå–æ‰€æœ‰å®‰è£…çš„rpmåŒ…æ”¾åˆ°Packagesç›®å½•ä¸‹ã€‚</li>
<li>åœ¨ä»æ‰‹åŠ¨å®‰è£…æ“ä½œç³»ç»Ÿä¸­å®‰è£…æ‰€æœ‰åº”ç”¨ç¨‹åºã€‚æŠŠä¸‹è½½çš„rpmåŒ…æ”¾åˆ°Packagesç›®å½•ä¸‹ã€‚</li>
<li>æŠŠæ‰€æœ‰éœ€è¦ç¼–è¯‘å®‰è£…çš„æºç åŒ…å’Œä¸èƒ½é€šè¿‡rpmå®‰è£…çš„ç¨‹åºæ–‡ä»¶æ‰“æˆä¸€ä¸ªrpmåŒ…ï¼Œæ”¾åˆ°Packagesç›®å½•ä¸‹ã€‚</li>
</ol>


<p>
<b>å®‰è£…createrepoåŒ…</b>
</p>
</div>
</div>
<div id="outline-container-h:b185453f-a697-4e5f-8c24-267fadf124e7" class="outline-3">
<h3 id="h:b185453f-a697-4e5f-8c24-267fadf124e7">é…ç½®æ–‡ä»¶ä¿®æ”¹</h3>
<div class="outline-text-3" id="text-h:b185453f-a697-4e5f-8c24-267fadf124e7">
<p>
<b>ä¿®æ”¹/home/emacle/emacle_rhel_6.3/anaconda-ks.cfgé…ç½®æ–‡ä»¶</b>
</p>

<p>
æ­¤æ–‡ä»¶ä¸ºè‡ªåŠ¨å®‰è£…è„šæœ¬æ–‡ä»¶ã€‚å†…å®¹å¦‚ä¸‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">Kickstart file automatically generated by anaconda.</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">version=DEVEL</span>
install
text
cdrom
lang en_US.UTF-8
keyboard us
network --onboot no --device eth0 --bootproto dhcp --noipv6
rootpw  --iscrypted $<span style="color: #a0522d;">6</span>$<span style="color: #a0522d;">ksiYu</span>.rXVzFbCNNi$<span style="color: #a0522d;">7</span>Q9ho0VOQlSMDTZj.xrJHwL6MVEJ3e5CH/Ko3V834XHQQfHEHmGj04QmzuciR.ufrAxYRGuWO6SfR/RyeOM6j1
firewall --disabled
authconfig --enableshadow --passalgo=sha512
selinux --disabled
timezone --utc Asia/Shanghai
bootloader --location=mbr --driveorder=sda --append=<span style="color: #8b2252;">"crashkernel=auto rhgb quiet"</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">The following is the partition information you requested</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Note that any partitions you deleted are not expressed</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">here so unless you clear all partitions first, this is</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">not guaranteed to work</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">clearpart --none</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">part /boot --fstype=ext4 --size=128</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">part swap --size=1024</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">part / --fstype=ext4 --grow --size=200</span>
%packages
@additional-devel
@base
@chinese-support
@client-mgmt-tools
@console-internet
@core
@debugging
@desktop-platform-devel
@development
@directory-client
@eclipse
@hardware-monitoring
@java-platform
@large-systems
@network-file-system-client
@performance
@perl-runtime
@server-platform
@server-platform-devel
@server-policy
@system-admin-tools
libXinerama-devel
openmotif-devel
libXmu-devel
xorg-x11-proto-devel
startup-notification-devel
libgnomeui-devel
libbonobo-devel
junit
libXau-devel
libgcrypt-devel
popt-devel
libdrm-devel
libXrandr-devel
libxslt-devel
libglade2-devel
gnutls-devel
pax
python-dmidecode
oddjob
sgpio
mtools
systemtap-client
desktop-file-utils
ant
rpmdevtools
jpackage-utils
rpmlint
certmonger
pam_krb5
krb5-workstation
perl-DBD-SQLite
<span style="color: #b22222;">#</span><span style="color: #b22222;">app</span>
appserver
webstatic
user_platform
search
tpush
privacycloud_scripts
<span style="color: #b22222;">#</span>
nginx
nginx_config
mongo-10gen
mongo-10gen-server
redis
rabbitmq-server
td-agent
emacle-config
<span style="color: #b22222;">#</span>
%post
<span style="color: #b22222;">###</span><span style="color: #b22222;">sysinfo.log</span>
useradd emacle
<span style="color: #483d8b;">echo</span> emacle2013 | passwd --stdin emacle &gt;/dev/null 2&gt;&amp;1
chmod 755 /home/emacle
<span style="color: #a0522d;">CUR_PWD</span>=<span style="color: #8b2252;">"/usr/local/software"</span>
<span style="color: #a0522d;">PATH</span>=${<span style="color: #a0522d;">PATH</span>}:/usr/local/bin
<span style="color: #483d8b;">export</span> CUR_PWD PATH
<span style="color: #b22222;">#</span>
cat &gt;&gt;/etc/security/limits.conf &lt;&lt;\EOF
<span style="color: #ffa54f;">emacle soft nproc 65535</span>
<span style="color: #ffa54f;">emacle hard nproc 65535</span>
<span style="color: #ffa54f;">emacle soft nofile 65535</span>
<span style="color: #ffa54f;">emacle hard nofile 65535</span>
<span style="color: #ffa54f;">EOF</span>
<span style="color: #b22222;">#</span>
sed -i <span style="color: #8b2252;">'s/SELINUX=enforcing/SELINUX=disabled/g'</span> /etc/selinux/config
sed -i <span style="color: #8b2252;">'s/^exclude/#exclude/'</span> /etc/yum.conf
setenforce 0 &gt;/dev/null 2&gt;&amp;1
iptables -F
<span style="color: #b22222;">#</span><span style="color: #b22222;">yum</span>
yum makecache
yum -q -y install yum-fastestmirror
yum -q -y install gcc gcc-c++ libtool make cmake autoconf automake
yum -q -y groupinstall <span style="color: #8b2252;">'Additional Development'</span> <span style="color: #8b2252;">'Security Tools'</span> <span style="color: #8b2252;">'Development tools'</span>
<span style="color: #b22222;">### </span><span style="color: #b22222;">Install ntp ###</span>
yum -q -y install ntp
ntpdate -u pool.ntp.org
hwclock -w
chkconfig ntpd on
service ntpd restart &gt;/dev/null 2&gt;&amp;1
service ntpd restart &gt;/dev/null 2&gt;&amp;1
<span style="color: #b22222;">#</span><span style="color: #b22222;">service_test</span>
<span style="color: #b22222;">### </span><span style="color: #b22222;">Install openssh ###</span>
yum -q -y install openssh
chkconfig sshd on
sed -i <span style="color: #8b2252;">'s/#UseDNS yes/UseDNS no/'</span> /etc/ssh/sshd_config
service sshd restart &gt;/dev/null 2&gt;&amp;1
service sshd restart &gt;/dev/null 2&gt;&amp;1
<span style="color: #b22222;">#</span><span style="color: #b22222;">service_test</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">install_app.sh</span>
mkdir -p /tmp_ram
chown -R emacle:emacle /tmp_ram
mkdir /home/emacle/logs
chown -R emacle:emacle /home/emacle/logs
<span style="color: #b22222;">#</span><span style="color: #b22222;">install_nginx.sh</span>
chown emacle.emacle -R /home/emacle/services
<span style="color: #b22222;">#</span><span style="color: #b22222;">install_mongodb.sh</span>
mv /etc/init.d/mongod /etc/init.d/mongod.bak
mkdir -p /data/mongodb/{data,log,config,arbiter}
chown mongod -R /data/mongodb
<span style="color: #b22222;">#</span><span style="color: #b22222;">install_redis.sh</span>
sed -i <span style="color: #8b2252;">'s/bind 127.0.0.1/#bind 127.0.0.1/'</span> /etc/redis.conf
cp /etc/redis.conf /etc/redis6380.conf
sed -i <span style="color: #8b2252;">'s!pidfile /var/run/redis/redis.pid!#pidfile /var/run/redis/redis6380.pid!'</span> /etc/redis6380.conf
sed -i <span style="color: #8b2252;">'s!port 6379!port 6380!'</span> /etc/redis6380.conf
sed -i <span style="color: #8b2252;">'s!logfile /var/log/redis/redis.log!logfile /var/log/redis/redis6380.log!'</span> /etc/redis6380.conf
grep <span style="color: #8b2252;">'vm.overcommit_memory = 1'</span> /etc/sysctl.conf &gt;/dev/null 2&gt;&amp;1 || <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">'vm.overcommit_memory = 1'</span> &gt;&gt; /etc/sysctl.conf
<span style="color: #b22222;">#</span><span style="color: #b22222;">install_rabbitmq.sh</span>
<span style="color: #a0522d;">HOST</span>=$(hostname | awk -F<span style="color: #8b2252;">'.'</span> <span style="color: #8b2252;">'{print $1}'</span>)
grep <span style="color: #8b2252;">"127.0.0.1\ \+$HOST"</span> /etc/hosts &gt;/dev/null || <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"127.0.0.1 $HOST"</span> &gt;&gt; /etc/hosts
<span style="color: #b22222;">#</span><span style="color: #b22222;">install_fluentd.sh</span>
tar xf /usr/local/software/conf.d/fluentd.tar.gz  -C /
mkdir -p /home/emacle/tmp
chown td-agent /home/emacle/tmp
<span style="color: #b22222;">#</span><span style="color: #b22222;">install_jdk.sh</span>
bash /usr/local/software/soft/jdk-6u45-linux-x64.bin &gt;/dev/null 2&gt;&amp;1
mv jdk1.6.0_45 /usr/local/
cat &gt;&gt;/etc/profile &lt;&lt;\EOF
<span style="color: #ffa54f;">JAVAHOME=/usr/local/jdk1.6.0_45/bin</span>
<span style="color: #ffa54f;">PATH=${PATH}:${JAVAHOME}</span>
<span style="color: #ffa54f;">export PATH JAVAHOME</span>
<span style="color: #ffa54f;">EOF</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">install_hadoop.sh</span>
mkdir -p /home/emacle/app
tar xf /usr/local/software/soft/hadoop-1.0.4.tar.gz -C /home/emacle/app/
tar xf /usr/local/software/conf.d/hadoop.tar.gz  -C /home/emacle/app/hadoop-1.0.4
\cp -r /usr/local/software/soft/.ssh ~emacle
mkdir -p /home/emacle/app/hadoop-1.0.4/data/hadoop/{name,data,tmp}
chown emacle.emacle -R /home/emacle/app
<span style="color: #b22222;">#</span><span style="color: #b22222;">install_python.sh</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">install rpm ###</span>
yum -y -q install zlib zlib-devel openssl openssl-deval freetype freetype-devel libxml2 libxml2-devel libxslt libxslt-devel
rpm -ivh ${<span style="color: #a0522d;">CUR_PWD</span>}/soft/mysql-5.1.61-4.el6.x86_64.rpm
rpm -ivh ${<span style="color: #a0522d;">CUR_PWD</span>}/soft/mysql-devel-5.1.61-4.el6.x86_64.rpm
<span style="color: #a0522d;">InstallLog</span>=<span style="color: #8b2252;">"${CUR_PWD}/install.log"</span>
<span style="color: #a0522d;">PythonDir</span>=<span style="color: #8b2252;">"${CUR_PWD}/soft/python/"</span>
<span style="color: #483d8b;">cd</span> $<span style="color: #a0522d;">PythonDir</span> &amp;&amp; rm -rf Python-2.7.3 pip-1.0
tar jxvf Python-2.7.3.tar.bz2
<span style="color: #483d8b;">cd</span> Python-2.7.3
./configure -q
make  -s all
make -s install
make clean
make distclean
mv /usr/bin/python /usr/bin/python2.6.6
ln -s /usr/local/bin/python2.7 /usr/bin/python
sed -i <span style="color: #8b2252;">'1s@^#!/usr/bin/python@#!/usr/bin/python2.6.6@'</span> /usr/bin/yum
<span style="color: #483d8b;">cd</span> $<span style="color: #a0522d;">PythonDir</span>
chmod 775 setuptools-0.6c11-py2.7.egg
sh setuptools-0.6c11-py2.7.egg
tar xvfz pip-1.0.tar.gz
<span style="color: #483d8b;">cd</span> pip-1.0
python setup.py install
<span style="color: #b22222;">#</span><span style="color: #b22222;">chown emacle.emacle -R /home/emacle</span>
<span style="color: #b22222;">### </span><span style="color: #b22222;">/Install python ###</span>
<span style="color: #b22222;">### </span><span style="color: #b22222;">configuration python env ###</span>
mkdir -p /home/emacle/python_dependency/source
\cp -r ${<span style="color: #a0522d;">PythonDir</span>}/source/* /home/emacle/python_dependency/source/
pip install /home/emacle/python_dependency/source/virtualenv-1.9.1.tar.gz
<span style="color: #b22222;">#</span><span style="color: #b22222;">mkdir -p /home/emacle/services</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">\cp -r ${PythonDir}/user_platform /home/emacle/services</span>
<span style="color: #483d8b;">cd</span> /home/emacle/services
/usr/local/bin/virtualenv --distribute env
<span style="color: #483d8b;">cd</span> /home/emacle/services/user_platform
(
/home/emacle/services/env/bin/easy_install /home/emacle/python_dependency/source/pytz-2013b-py2.7.egg
/home/emacle/services/env/bin/easy_install /home/emacle/python_dependency/source/flup-1.0.3.dev_20110405-py2.7.egg
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/distribute-0.6.45.tar.gz
/home/emacle/services/env/bin/easy_install /home/emacle/python_dependency/source/Babel-0.9.6-py2.7.egg
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/captchaimage-1.3.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/chardet-2.1.1.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/gdata-2.0.18.zip
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/lxml-3.2.1.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/nose-1.3.0.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/pika-0.9.13.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/Imaging-1.1.7.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/pycrypto-2.6.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/pyDes-2.0.1.zip
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/pydns-2.3.6.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/pymongo-2.5.2.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/pystache-0.5.3.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/redis-2.7.6.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/sendgrid-0.1.3.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/SQLAlchemy-0.8.1.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/suds-0.4.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/xlwt-0.7.5.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/mustache-0.1.4.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/httpagentparser-1.2.2.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/speaklater-1.3.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/billiard-2.7.3.28.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/anyjson-0.3.3.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/amqp-1.0.12.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/Werkzeug-0.9.1.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/itsdangerous-0.21.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/MarkupSafe-0.18.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/six-1.3.0.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/MySQL-python-1.2.4.zip
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/python-dateutil-2.1.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/kombu-2.5.11.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/celery-3.0.19.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/Jinja2-2.7.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/Flask-0.9.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/Flask-Babel-0.8.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/Flask-PyMongo-0.2.1.tar.gz
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/vobject-0.8.1c.tar.gz
/home/emacle/services/env/bin/easy_install /home/emacle/python_dependency/source/Flask_Cache-0.12-py2.7.egg
/home/emacle/services/env/bin/pip install /home/emacle/python_dependency/source/IPy-0.81.tar.gz
) &gt; /dev/null 2&gt;&amp;1
chown emacle.emacle -R /home/emacle/services/env/
chown emacle.emacle -R /home/emacle/python_dependency
chown emacle /var/run
<span style="color: #b22222;"># </span><span style="color: #b22222;">td-agent require</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">chown td-agent:emacle /home/emacle/tmp</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">install_celeryd.sh</span>
<span style="color: #a020f0;">if</span> [ ! -d /etc/default ]
<span style="color: #a020f0;">then</span>
        mkdir /etc/default
<span style="color: #a020f0;">fi</span>
\cp ${<span style="color: #a0522d;">CUR_PWD</span>}/soft/celeryd/celeryd /etc/init.d/                <span style="color: #b22222;"># </span><span style="color: #b22222;">celeryd init script</span>
\cp ${<span style="color: #a0522d;">CUR_PWD</span>}/soft/celeryd/config/celeryd /etc/default/        <span style="color: #b22222;"># </span><span style="color: #b22222;">celeryd config</span>
\cp ${<span style="color: #a0522d;">CUR_PWD</span>}/soft/celeryd/celeryctl /usr/bin/                 <span style="color: #b22222;"># </span><span style="color: #b22222;">for sceleryd ervice start|stop</span>
\cp ${<span style="color: #a0522d;">CUR_PWD</span>}/soft/celeryd/celeryd-multi /usr/bin/             <span style="color: #b22222;"># </span><span style="color: #b22222;">for sceleryd ervice status</span>
chmod 755  /usr/bin/celeryd-multi /etc/init.d/celeryd  /usr/bin/celeryctl
mkdir -p /var/log/celery
mkdir -p /var/run/celery
chown emacle.emacle -R /var/log/celery /var/run/celery
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"/etc/init.d/celeryd start"</span> &gt;&gt;/etc/rc.d/rc.local
<span style="color: #b22222;"># </span><span style="color: #b22222;">Init consumer</span>
mkdir /var/run/consumer
chown emacle.emacle /var/run/consumer
<span style="color: #b22222;">#</span><span style="color: #b22222;">install_mysql.sh</span>
<span style="color: #b22222;">#</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">install_cront.sh</span>
cat /usr/local/software/soft/crontab &gt;&gt; /var/spool/cron/emacle
<span style="color: #b22222;">#</span><span style="color: #b22222;">install_nconvert.sh</span>
\cp /usr/local/software/soft/nconvert /usr/bin
chmod 755 /usr/bin/nconvert
<span style="color: #b22222;">#</span>
<span style="color: #b22222;">### </span><span style="color: #b22222;">Reset owner of file ###</span>
chown emacle.emacle -R /tmp_ram &gt;/dev/null 2&gt;&amp;1
chown emacle.emacle -R /var/log/celery /var/run/celery /var/run/consumer &gt;/dev/null 2&gt;&amp;1
chown td-agent:emacle -R /home/emacle/tmp &gt;/dev/null 2&gt;&amp;1
chown mongod -R /data/mongodb &gt;/dev/null 2&gt;&amp;1
chown emacle /var/run
<span style="color: #b22222;"># </span><span style="color: #b22222;">chkconfig</span>
<span style="color: #a0522d;">SERVICE_ON</span>=<span style="color: #8b2252;">"ntpd nginx mongod redis rabbitmq-server td-agent sshd"</span>
<span style="color: #a020f0;">for</span> i<span style="color: #a020f0;"> in</span> ${<span style="color: #a0522d;">SERVICE_ON</span>}
<span style="color: #a020f0;">do</span>
        chkconfig $<span style="color: #a0522d;">i</span> on
<span style="color: #a020f0;">done</span>
%end
</pre>
</div>

<p>
<b>ä¿®æ”¹/home/emacle/emacle_rhel_6.3/isolinux/isolinux.cfgé…ç½®æ–‡ä»¶</b>
</p>

<p>
æ­¤æ–‡ä»¶æ·»åŠ â€œautoâ€è‡ªåŠ¨å®‰è£…å‘½ä»¤ã€‚å†…å®¹å¦‚ä¸‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">default vesamenu.c32
<span style="color: #b22222;">#</span><span style="color: #b22222;">prompt 1</span>
timeout 600
display boot.msg
menu background splash.jpg
menu title Welcome to Red Hat Enterprise Linux 6.3!
menu color border 0 <span style="color: #b22222;">#</span><span style="color: #b22222;">ffffffff #00000000</span>
menu color sel 7 <span style="color: #b22222;">#</span><span style="color: #b22222;">ffffffff #ff000000</span>
menu color title 0 <span style="color: #b22222;">#</span><span style="color: #b22222;">ffffffff #00000000</span>
menu color tabmsg 0 <span style="color: #b22222;">#</span><span style="color: #b22222;">ffffffff #00000000</span>
menu color unsel 0 <span style="color: #b22222;">#</span><span style="color: #b22222;">ffffffff #00000000</span>
menu color hotsel 0 <span style="color: #b22222;">#</span><span style="color: #b22222;">ff000000 #ffffffff</span>
menu color hotkey 7 <span style="color: #b22222;">#</span><span style="color: #b22222;">ffffffff #ff000000</span>
menu color scrollbar 0 <span style="color: #b22222;">#</span><span style="color: #b22222;">ffffffff #00000000</span>
label linux
  menu label ^Install or upgrade an existing system
  menu default
  kernel vmlinuz
  append <span style="color: #a0522d;">initrd</span>=initrd.img
label vesa
  menu label Install system with ^basic video driver
  kernel vmlinuz
  append <span style="color: #a0522d;">initrd</span>=initrd.img <span style="color: #a0522d;">xdriver</span>=vesa nomodeset
label rescue
  menu label ^Rescue installed system
  kernel vmlinuz
  append <span style="color: #a0522d;">initrd</span>=initrd.img rescue
label local
  menu label Boot from ^local drive
  localboot 0xffff
label memtest86
  menu label ^Memory test
  kernel memtest
  append -
label auto  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26032;&#28155;&#21152;&#19968;&#27573;</span>
  kernel vmlinuz
  append <span style="color: #a0522d;">ks</span>=cdrom:/anaconda-ks.cfg <span style="color: #a0522d;">initrd</span>=initrd.img
</pre>
</div>

<p>
<b>ä¿®æ”¹/home/emacle/script/build_iso.shè„šæœ¬</b>
</p>

<p>
æ­¤è„šæœ¬ç”¨äºisoåˆ¶ä½œã€‚
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Description: Build new iso file of emacle</span>
<span style="color: #a0522d;">DATE</span>=$(date <span style="color: #8b2252;">'+%Y%m%d%H%M'</span>)
<span style="color: #a0522d;">ISODIR</span>=/home/emacle/emacle_rhel_6.3
<span style="color: #a0522d;">NEWRPM</span>=/usr/src/redhat/RPMS/x86_64
<span style="color: #a0522d;">SCRIPT_NAME</span>=$(basename $<span style="color: #a0522d;">0</span>)
<span style="color: #0000ff;">create_iso</span>() {
        rm -f /mnt/mkiso/Emacle_rhel_6.3*.iso
        mv ${<span style="color: #a0522d;">NEWRPM</span>}/* ${<span style="color: #a0522d;">ISODIR</span>}/Packages &gt;/dev/null 2&gt;&amp;1
        <span style="color: #b22222;">#</span><span style="color: #b22222;">Create repodata</span>
        <span style="color: #483d8b;">cd</span> ${<span style="color: #a0522d;">ISODIR</span>}
        createrepo -g repodata/comps-rhel6-Server.xml ${<span style="color: #a0522d;">ISODIR</span>}
        <span style="color: #b22222;"># </span><span style="color: #b22222;">Create iso file</span>
        mkisofs -o /mnt/mkiso/Emacle_rhel_6.3_${<span style="color: #a0522d;">DATE</span>}.iso -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4  -boot-info-table -R -J -v -T ${<span style="color: #a0522d;">ISODIR</span>}
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Emacle_mini${DATE}.iso is created"</span> &gt;&gt;/home/emacle/script/mkiso.log
}
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"### ${DATE} ISO BUILDING</span>
<span style="color: #8b2252;">$0 $@ command is performed"</span> &gt;&gt;/home/emacle/script/mkiso.log
create_iso
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"### $0 is complete"</span> &gt;&gt;/home/emacle/script/mkiso.log
</pre>
</div>


<p>
ç¬¬ä¸€æ­¥ï¼Œå…‰ç›˜å¯åŠ¨ã€‚
</p>


<figure id="org764dde1">
<img src="./images/img_20240129_161412.png" alt="img_20240129_161412.png" width="60%">

</figure>


<p>
ç¬¬äºŒæ­¥ï¼ŒæŒ‰â€˜ESCâ€™è°ƒå‡ºå‘½ä»¤è¡Œæ¨¡å¼è¾“å…¥â€œautoâ€åå›è½¦ã€‚
</p>


<figure id="org00a485d">
<img src="./images/img_20240129_161500.png" alt="img_20240129_161500.png" width="60%">

</figure>


<p>
ç¬¬ä¸‰æ­¥ï¼Œæ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ä½¿ç”¨ç£ç›˜ç©ºé—´ã€‚
</p>


<figure id="org88f1068">
<img src="./images/img_20240129_161527.png" alt="img_20240129_161527.png" width="60%">

</figure>



<p>
ç¬¬å››æ­¥ï¼Œç¨‹åºæ–‡ä»¶å®‰è£…ã€‚
</p>


<p>
ç¬¬äº”æ­¥ï¼Œæ‰§è¡Œå®‰è£…è„šæœ¬ã€‚æ³¨æ„ï¼šæ­¤æ­¥éª¤æ—¶é—´å¾ˆé•¿ï¼Œå¤§æ¦‚è¦30åˆ†é’Ÿã€‚
</p>


<p>
ç¬¬å…­æ­¥ï¼Œå®‰è£…å®Œæ¯•ï¼æŒ‰â€œRebootâ€é‡å¯æœåŠ¡å™¨ã€‚
</p>


<figure id="org43a6fb5">
<img src="./images/img_20240129_161551.png" alt="img_20240129_161551.png" width="60%">

</figure>
</div>
</div>
</section>
</main class="container">
<footer id="postamble" class="status">
<footer data-astro-cid-sz7xmlte data-turbo-permanent id=rootFooter>
    <script>
        const shuffle = e => e.map((e => ({
            v: e,
            sort: Math.random()
        }))).sort(( (e, o) => e.sort - o.sort)).map(( ({v: e}) => e));
        var songList = ["barbie-girl--stantough", "blue-da-ba-dee--cornelius-link", "hips-dont-lie--stantough", "i-want-it-that-way--stantough", "seven-nation-army--stantough", "smooth-criminal--stantough"]
          , songOrder = songOrder ?? shuffle(songList).map((e => `/audio/music/${e}.opus`))
          , song = new Audio(songOrder[0])
          , nextSong = new Audio(songOrder[1])
          , songIndex = 2
          , musicWrapper = void 0
          , arrow = void 0
          , notes = void 0;
        song.addEventListener("ended", next);
        const toggle = () => song.paused ? play() : pause();
        function play() {
            song.play(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.add("shakeManHorse"),
            notes.classList.remove("hideNotes")
        }
        function pause() {
            song.pause(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.remove("shakeManHorse"),
            notes.classList.add("hideNotes")
        }
        function next() {
            song = nextSong,
            play(),
            songIndex === songOrder.length && (songIndex = 0),
            nextSong = new Audio(songOrder[songIndex]),
            songIndex += 1
        }
        function skip() {
            pause(),
            (arrow = arrow || document.getElementById("musicArrow")).classList.add("shootArrow");
            new Audio("/audio/effects/ohno.m4a").play(),
            arrow.addEventListener("animationend", arrowShootHandler, !1)
        }
        function arrowShootHandler() {
            arrow.removeEventListener("animationend", arrowShootHandler, !1),
            arrow.classList.remove("shootArrow");
            new Audio("/audio/effects/heythathurt.m4a").play(),
            next()
        }
    </script>
    <div id=musicPlayer data-astro-cid-q7a5pyro>
        <button class=skip data-astro-cid-q7a5pyro onclick=skip() title="Skip song">
            <div id=skipWrapper data-astro-cid-q7a5pyro>
                <img alt="Medieval drollery of a man/snail/bat/monkey shooting an arrow" class=archer decoding=async height=334 loading=lazy src=/images/archer-no-arrow.448ccd8b_Z1KfRYq.webp width=226 data-astro-cid-q7a5pyro>
                <img alt="Arrow for archer" class="arrow complete" decoding=async height=23 loading=lazy src=/images/no-archer-full-arrow.87aa9971_Z2qL2KO.webp width=141 data-astro-cid-q7a5pyro id=musicArrow>
            </div>
        </button>
        <button class=playPause data-astro-cid-q7a5pyro onclick=toggle() title="Play/pause song">
            <div id=musicWrapper data-astro-cid-q7a5pyro>
                <div class=hideNotes id=notesWrapper data-astro-cid-q7a5pyro>
                    <div class=lyreNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                    <div class=fluteNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                </div>
                <img alt="Medieval drollery of a man/horse playing a lyre and a horn" class=manHorse decoding=async height=665 loading=lazy src=/images/man-horse-band.e3a2efcf_q8FCa.webp width=531 data-astro-cid-q7a5pyro>
            </div>
        </button>
    </div>
    <hr data-astro-cid-sz7xmlte>
    <div class=salutation data-astro-cid-gdmrbrho>
        <p data-astro-cid-gdmrbrho>
            <span class=flower2 data-astro-cid-gdmrbrho>A</span>
            <span class=smallcap data-astro-cid-gdmrbrho>pax vobiscum</span>
            <span class="flower2 wiggle" data-astro-cid-gdmrbrho id=leaf>a</span>
        </p>
    </div>
    <script>
        function animateLeafBlownHandler() {
            leaf.removeEventListener("animationend", animateLeafBlownHandler, !1),
            leaf.classList.remove("blownAway"),
            leaf.classList.add("wiggle")
        }
        function animateLeaf() {
            leaf = leaf ?? document.getElementById("leaf"),
            leaf.classList.remove("wiggle"),
            leaf.classList.add("blownAway"),
            leaf.addEventListener("animationend", animateLeafBlownHandler, !1)
        }
        document.getElementById("leaf").onclick = animateLeaf
    </script>


    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>æ‰“èµ</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Â© 2024 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
</footer>
</footer>
</body>
</html>
