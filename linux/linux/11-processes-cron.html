<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linux: 进程和计划任务</title>
<meta name="generator" content="Org Mode" />
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<!-- from -->
<!--
<style>#back-to-top{background:#000;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;bottom:20px;-webkit-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);-moz-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);box-shadow:0 2px 5px 0 rgba(0,0,0,.26);color:#fff;cursor:pointer;display:block;height:56px;opacity:1;outline:0;position:fixed;right:20px;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-transition:bottom .2s,opacity .2s;-o-transition:bottom .2s,opacity .2s;-moz-transition:bottom .2s,opacity .2s;transition:bottom .2s,opacity .2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:56px;z-index:1}#back-to-top svg{display:block;fill:currentColor;height:24px;margin:16px auto 0;width:24px}#back-to-top.hidden{bottom:-56px;opacity:0}</style>
-->
<link rel="stylesheet" href="/static/aandds.com/css/main.css">
<link rel="stylesheet" href="/static/aandds.com/css/drollery.min.css">
<script type="text/javascript" src="/static/aandds.com/js/main.js"></script>
<!--
<script id="MathJax-script" async="" src="/static/aandds.com/js/mathjax.js"></script>

<script type="text/javascript" src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
-->
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Linux: 进程和计划任务</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:bb878e64-7125-4329-ba6f-97c252fe79ad">进程和内存管理</a>
<ul>
<li><a href="#h:9c961d10-b1e6-4b1b-8b34-7cf2e0f47f68">什么是进程</a></li>
<li><a href="#h:c3f05039-baa1-4c4a-be60-144e8096f406">进程结构</a></li>
<li><a href="#h:57b651ad-8998-470c-9a4c-c91f7e706840">进程相关概念</a>
<ul>
<li><a href="#h:9cb50d2a-9f3c-4107-9500-1804f3b23c68">物理地址空间和虚拟地址空间</a></li>
<li><a href="#h:87d329d1-481e-4b31-9b23-b09a181063c5">用户和内核空间</a></li>
<li><a href="#h:48ef5582-7ebf-4b7c-88cf-a4f1e80f5396">C代码和内存布局之间的对应关系</a></li>
<li><a href="#h:5dbb64e7-53e6-446f-b582-bae8ead3480e">进程使用内存问题</a>
<ul>
<li><a href="#h:03523338-4006-4ee1-b763-4dd6537463c9">内存泄漏 Memory Leak</a></li>
<li><a href="#h:756dbfcc-e5f6-4925-bc59-dce549fa694f">内存溢出 Memory Overflow</a></li>
<li><a href="#h:dd7a4854-6dbd-426b-b419-568d3e1c7dd0">内存不足 Out of Memory</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:a9057e7b-bf7d-4596-b217-d93c11add675">进程状态</a></li>
<li><a href="#h:381f7bfd-db0e-4a01-a91b-6009bebe8e93">LRU算法</a></li>
<li><a href="#h:687c7006-fa03-433f-aec5-e663c778954e">IPC进程间通信</a></li>
<li><a href="#h:dad7d2e2-ce69-46d9-936f-0917a05a292b">进程优先级</a></li>
<li><a href="#h:d8aed175-f1dc-40e1-9dcc-cdd06c7aeafa">进程分类</a></li>
<li><a href="#h:6e9172bf-6edb-49d2-bb27-3262a3026edb">IO调度算法</a></li>
<li><a href="#h:e20fa8f0-844e-40c5-9c84-554269646a47">进程的数字标识16bits：</a></li>
</ul>
</li>
<li><a href="#h:5f6c0250-4959-4a0f-9fd8-873eedc2409e">进程管理和性能相关工具</a>
<ul>
<li><a href="#h:3aa13baa-6936-4735-8e60-ed7c9f1e01a9">进程</a>
<ul>
<li><a href="#h:3c768fad-9e98-4ded-8386-cc830fc00926">pstree 进程树</a></li>
<li><a href="#h:c958b3e7-098f-41e4-985a-061832340cac">ps进程信息</a>
<ul>
<li><a href="#h:6c3cd49e-cf55-4d47-8459-f58332736a9d">watch实时监控变化</a></li>
</ul>
</li>
<li><a href="#h:3e14aeb7-c449-4675-a824-e562aa1493a9">prtstat查看进程信息</a></li>
<li><a href="#h:2b8f9814-68e8-4ce0-81a6-b9df3f9a808b">nice/renice设置和调整进程优先级</a></li>
<li><a href="#h:b5aeab48-3b30-4cc5-830a-59cc39d0d75b">搜索进程</a>
<ul>
<li><a href="#h:39fb0328-b807-476a-9455-203d1b6b50b3">pgrep</a></li>
<li><a href="#h:e6d706cc-8561-469f-99b6-fe4b1e011f46">pidof</a></li>
</ul>
</li>
<li><a href="#h:39f4481d-a9ef-42e6-9cd7-32c9974056a8">lsof查看进程打开文件</a></li>
</ul>
</li>
<li><a href="#h:a7dd34ec-779f-4067-b78c-86ce4bcb8676">CPU</a>
<ul>
<li><a href="#h:5f1fcdfc-1002-4274-8c26-23ee720b0ccc">uptime负载查询</a></li>
<li><a href="#h:24a4ad7f-1403-465e-9dad-f5cdda77ad26">mpstat多核CPU性能分析</a></li>
<li><a href="#h:e36530d8-f550-4914-b11a-37c2d30b1862">pidstat进程性能分析</a></li>
<li><a href="#h:a5b12a6e-c2c2-4d3e-819a-8025c8934580">查看进程实时状态</a>
<ul>
<li><a href="#h:d1ffa1d7-1529-409f-8da0-3e447f2f7827">top</a></li>
<li><a href="#h:1ca7acf9-d2f1-4b8a-b92a-c31aaf63ae87">atop</a></li>
<li><a href="#h:6d104da6-44ce-4d47-8d52-69e0c6727b3b">htop</a></li>
<li><a href="#h:01344ab0-02ee-485f-b3a7-e2c939adacf8">perf</a></li>
<li><a href="#h:c0c62af8-3ccf-4bb1-9048-45734250112a">execsnoop</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:0ebd85c2-d031-4417-abcd-dad9403f246d">内存</a>
<ul>
<li><a href="#h:e76f3ac2-1108-4fbe-9a52-94dbee71709b">free内存空间</a></li>
<li><a href="#h:356e2d5b-6da7-42b9-acc6-13630fc5b33d">pmap进程对应的内存映射</a></li>
<li><a href="#h:77503210-ed71-4bc8-9aa5-e352b67f555f">vmstat虚拟内存信息</a></li>
</ul>
</li>
<li><a href="#h:83c2b7c6-c9c3-427c-aac2-c58da16a13f2">磁盘</a>
<ul>
<li><a href="#h:a0bcad56-fdc3-4935-9d4f-a9d8de9324fe">iostat统计CPU和设备IO信息</a></li>
<li><a href="#h:51037e76-5944-4489-b008-16eb33c9518c">iotop监视磁盘I/O</a></li>
<li><a href="#h:0a42e52e-84d2-4ce4-a29a-b33e3da796e3">dstat系统资源统计</a></li>
</ul>
</li>
<li><a href="#h:96a6809a-6b5a-40df-845a-0cfca9b9d5b1">网络</a>
<ul>
<li><a href="#h:bb3d212e-032d-45b9-8bc1-ffa5188ecb5d">iftop显示网络带宽使用情况</a></li>
<li><a href="#h:1bdd5c97-98c5-4e83-82f6-363f076abde5">nload查看网络实时吞吐量</a></li>
<li><a href="#h:fb78b733-c80c-4958-b7a8-bcad1fe7d71a">nethogs查看进程网络带宽</a></li>
<li><a href="#h:3340adee-7ad1-483f-948e-351760b61576">iptraf-ng网络监视工具</a></li>
</ul>
</li>
<li><a href="#h:e47b0b5c-afd7-4108-87c5-155ce9348177">kill信号发送</a></li>
<li><a href="#h:0fe8fc8e-7e2d-45c1-b909-6bd448384f19">作业管理</a></li>
<li><a href="#h:1800cacc-3bc6-47e9-a03d-2d2872382276">并行运行</a></li>
<li><a href="#h:d65616f4-161d-4dd1-ae18-1993426b49d9">其他</a>
<ul>
<li><a href="#h:348f1b38-2d40-44b9-8841-e88f5dcd7535">sar</a></li>
<li><a href="#h:c8cc55b7-606a-449b-aa78-0cbab6aede60">glances综合监控工具</a></li>
<li><a href="#h:a539a95d-65d6-418d-a3a0-b1fa9de5fb9e">cockpit系统web管理</a></li>
<li><a href="#h:ced46580-24cc-4081-8d3b-f7fce4119f9f">webmin综合管理平台</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:96cc7c37-b4fa-461a-9ccc-39ed146f93b9">任务计划</a>
<ul>
<li><a href="#h:58d2bcee-e888-4855-bb25-448d3651ca39">at一次性任务</a></li>
<li><a href="#h:ae1143a1-3fda-43e9-8b4b-f99a32f1d8df">cront周期性任务计划</a>
<ul>
<li><a href="#h:58d06a8b-70d6-4f82-a301-4841fbd576b9">系统cron计划任务</a></li>
<li><a href="#h:5a006901-d26c-424c-8393-5176af2cea82">anacron</a></li>
<li><a href="#h:b803f365-45c1-49c0-b327-c3cde65d1016">管理临时文件</a></li>
<li><a href="#h:5d47d219-e4c1-4e22-93ee-77d4d7d80930">用户计划任务</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../index.html">Linux</a></li>
</ul>


<p>
摘要：linux入门，本文介绍进程和计划任务
</p>


<p>
内容概述
</p>

<ul class="org-ul">
<li>进程相关概念</li>
<li>进程工具</li>
<li>系统性能相关工具</li>
<li>计划任务</li>
</ul>
<section id="outline-container-h:bb878e64-7125-4329-ba6f-97c252fe79ad" class="outline-2">
<h2 id="h:bb878e64-7125-4329-ba6f-97c252fe79ad">进程和内存管理</h2>
<div class="outline-text-2" id="text-h:bb878e64-7125-4329-ba6f-97c252fe79ad">
<p>
内核功用：进程管理、内存管理、文件系统、网络功能、驱动程序、安全功能等
</p>


<figure id="org51cf0ef">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210119161707557.png" alt="image-20210119161707557.png" width="50%">

</figure>



<figure id="org4c1be7f">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/Image.jpg" alt="Image.jpg" width="50%">

</figure>

<p>
<b>进程的调度：</b>
</p>

<p>
(1) cpu上的指令： CPU环0,特权指令，只有kernel才能运行
</p>

<p>
CPU环3上的指令普通用户能运行
</p>

<p>
整个代码的执行过程中，可能需要不断的在自己能执行的代码和调用内核所执行
的代码间转换；如果代没有权限执行时，就要做模式转换，也就意味程序要发起
一次软中断，软中断的作用就是要发起系统调用的，执行内核中的代码；
</p>

<p>
如果需要做管理类操作时，就会发起系统调用。任何需要系统特权指令的功能，
操作系统就把它封装成一个一个的调用；任何人任何程序都不得直接操作，必须
向内核调用才可以；
</p>

<p>
(2) 用户模式和内核模式
</p>

<p>
用户空间(即用户模式)：执行用户代码的机制
</p>

<p>
内核空间(即内核模式)：执行内核的代码的机制
</p>

<p>
模式切换用户模式：如果发生系统调用，就会转换成内核模式，然后又会切换到
用户模式；
</p>

<p>
内核功用：进程管理、文件系统、网络功能、内存管理、驱动程序、安全功能；
</p>

<p>
模式切换：理想状态70%用户 30%内核
</p>

<p>
多任务是各进程之间是以时间片切割，一个进程运行的时间到了就下去让其他需
要的上来。
</p>

<p>
多个进程都在等待的话就需要优先级；内核负责进程调度的，它会会将霸占的时
间的进程踢掉，
</p>

<p>
进程的当前状态在CPU上，CPU上有指令指针寄存器，寄存器保存了当前进程的状
态，其运行速度接近CPU的速度；等要切换下一个进程时；内核在完成进程切换
时找一个位置保存进程执行的中间状态，这叫做保存现场；恢复第二个进程现场，
进程间切换不断发生保存切换现场；
</p>
</div>
<div id="outline-container-h:9c961d10-b1e6-4b1b-8b34-7cf2e0f47f68" class="outline-3">
<h3 id="h:9c961d10-b1e6-4b1b-8b34-7cf2e0f47f68">什么是进程</h3>
<div class="outline-text-3" id="text-h:9c961d10-b1e6-4b1b-8b34-7cf2e0f47f68">
<p>
程序=指令+数据
</p>

<p>
process：运行中的程序的一个副本，是被载入内存的一个指令集合，是资源分配的单位
</p>

<ul class="org-ul">
<li>进程ID(PID)号码被用来标记各个进程</li>
<li>UID、GID、和SELinux语境决定对文件系统的存取和访问权限</li>
<li>通常从执行进程的用户来继承</li>
<li>存在生命周期</li>
</ul>

<p>
进程创建：
</p>

<ul class="org-ul">
<li>init：第一个进程，从CentOS7以后为systemd</li>
<li>进程：都由其父进程创建， fork()，父子关系，CoW: Copy On Write
<ul class="org-ul">
<li>fork() :是内核开设的调用，子进程是由fork生成</li>
<li>clone()：父进程克隆自己的数据给子进程；</li>
</ul></li>
</ul>

<p>
CoW: Copy On Write
</p>

<p>
我们知道进程间的内存地址空间是隔离的，fork()系统调用的结果是生成一个新
的子进程，为了保证隔离性，早期的UNIX采用在fork()将父进程的地址空间完整
的复制一份。这个操作非常的耗时。为了提高效率现代的Unix及Linux采用了一
种称为写时复制的技术，其实也就是一种延迟操作的做法，子进程和父进程在
fork()时并不马上复制，而是暂时共享内存空间，随后只要父进程或者子进程试
图写共享的内存就会产生一个异常，这时内核才把内存空间进程复制，比如我们
在Shell中启动一个程序时随后就会启动新的程序，启动后的程序将会覆盖旧的
内存空间，如果提前就复制了，那么这个复制操作其实是白做了，为此系统将这
个操作优化为写时复制；
</p>

<p>
参考： Linux写时拷贝技术(copy-on-write)
<a href="http://www.cnblogs.com/biyeymyhjob/archive/2012/07/20/2601655.html">http://www.cnblogs.com/biyeymyhjob/archive/2012/07/20/2601655.html</a>
</p>


<figure id="org7a47a43">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210213221300521.png" alt="image-20210213221300521.png" width="50%">

</figure>

<p>
<b>进程，线程和协程</b>
</p>


<figure id="org6d01630">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210119161829509.png" alt="image-20210119161829509.png" width="50%">

</figure>

<p>
查看进程中的线程：
</p>

<div class="org-src-container">
<pre class="src src-sh">pstree -p
cat /proc/PID/status | grep -i threads
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c3f05039-baa1-4c4a-be60-144e8096f406" class="outline-3">
<h3 id="h:c3f05039-baa1-4c4a-be60-144e8096f406">进程结构</h3>
<div class="outline-text-3" id="text-h:c3f05039-baa1-4c4a-be60-144e8096f406">

<figure id="org17aa91b">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210119162058621.png" alt="image-20210119162058621.png" width="50%">

</figure>

<p>
内核把进程存放在叫做任务列表的双向循环列表中
</p>

<p>
链表中的每一项都是类型为task_struct，称为进程控制块(Processing Control
Block)，PCB中包含一个具体进程的所有信息
</p>



<figure id="org0581916">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210119162249166.png" alt="image-20210119162249166.png" width="50%">

</figure>

<p>
<b>进程控制块PCB包含信息：</b>
</p>

<ul class="org-ul">
<li>进程id、用户id和组id</li>
<li>程序计数器</li>
<li>进程的状态(有就绪、运行、阻塞)</li>
<li>进程切换时需要保存和恢复的CPU寄存器的值</li>
<li>描述虚拟地址空间的信息</li>
<li>描述控制终端的信息</li>
<li>当前工作目录</li>
<li>文件描述符表，包含很多指向file结构体的指针</li>
<li>进程可以使用的资源上限(ulimit -a命令可以查看)</li>
<li>输入输出状态：配置进程使用I/O设备</li>
</ul>
</div>
</div>
<div id="outline-container-h:57b651ad-8998-470c-9a4c-c91f7e706840" class="outline-3">
<h3 id="h:57b651ad-8998-470c-9a4c-c91f7e706840">进程相关概念</h3>
<div class="outline-text-3" id="text-h:57b651ad-8998-470c-9a4c-c91f7e706840">
<p>
Page Frame：页框，用存储页面数据，存储Page 4k
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">getconf -a |grep -i size</span>
PAGESIZE                           4096
PAGE_SIZE                          4096
SSIZE_MAX                          32767
_POSIX_SSIZE_MAX                   32767
_POSIX_THREAD_ATTR_STACKSIZE       200809
FILESIZEBITS                       64
POSIX_ALLOC_SIZE_MIN               4096
POSIX_REC_INCR_XFER_SIZE           
POSIX_REC_MAX_XFER_SIZE            
POSIX_REC_MIN_XFER_SIZE            4096
LEVEL1_ICACHE_SIZE                 32768
LEVEL1_ICACHE_LINESIZE             64
LEVEL1_DCACHE_SIZE                 32768
LEVEL1_DCACHE_LINESIZE             64
LEVEL2_CACHE_SIZE                  2097152
LEVEL2_CACHE_LINESIZE              64
LEVEL3_CACHE_SIZE                  0
LEVEL3_CACHE_LINESIZE              0
LEVEL4_CACHE_SIZE                  0
LEVEL4_CACHE_LINESIZE              0
</pre>
</div>
</div>
<div id="outline-container-h:9cb50d2a-9f3c-4107-9500-1804f3b23c68" class="outline-4">
<h4 id="h:9cb50d2a-9f3c-4107-9500-1804f3b23c68">物理地址空间和虚拟地址空间</h4>
<div class="outline-text-4" id="text-h:9cb50d2a-9f3c-4107-9500-1804f3b23c68">
<p>
MMU：Memory Management Unit 负责虚拟地址转换为物理地址
</p>

<p>
程序在访问一个内存地址指向的内存时，CPU不是直接把这个地址送到内存总线
上，而是被送到MMU，然后把这个内存地址映射到实际的物理内存地址上，然后
通过总线再去访问内存，程序操作的地址称为虚拟内存地址
</p>

<p>
TLB：Translation Lookaside Buffer
翻译后备缓冲器，用于保存虚拟地址和物理地址映射关系的缓存
</p>



<figure id="org749c246">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210119170329347.png" alt="image-20210119170329347.png" width="50%">

</figure>

<p>
不过要注意，MMU并不以字节为单位来管理内存，而是规定了一个内存映射的最
小单位，也就是页，通常是4 KB 大小。这样，每一次内存映射，都需要关联 4
KB 或者 4KB整数倍的内存空间。
</p>

<p>
页的大小只有 4 KB，导致的另一个问题就是，整个页表会变得非常大。比方说，
仅 32 位系统就需要100多万个页表项（4GB/4KB），才可以实现整个地址空间的
映射。为了解决页表项过多的问题，Linux提供了两种机制，也就是多级页表和
大页（HugePage）。
</p>

<p>
多级页表就是把内存分成区块来管理，将原来的映射关系改成区块索引和区块内
的偏移。由于虚拟内存空间通常只用了很少一部分，那么，多级页表就只保存这
些使用中的区块，这样就可以大大地减少页表的项数。
</p>

<p>
Linux 用的正是四级页表来管理内存页，如下图所示，虚拟地址被分为 5个部分，
前 4 个表项用于选择页，而最后一个索引表示页内偏移。
</p>


<figure id="orga890dd6">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210209224059700.png" alt="image-20210209224059700.png" width="50%">

</figure>

<p>
再看大页，顾名思义，就是比普通页更大的内存块，常见的大小有 2MB 和
1GB。大页通常用在使用大量内存的进程上，比如 Oracle、DPDK 等。
</p>

<p>
通过这些机制，在页表的映射下，进程就可以通过虚拟地址来访问物理内存了。那么具体到一个
Linux 进程中，这些内存又是怎么使用的呢？
</p>
</div>
</div>
<div id="outline-container-h:87d329d1-481e-4b31-9b23-b09a181063c5" class="outline-4">
<h4 id="h:87d329d1-481e-4b31-9b23-b09a181063c5">用户和内核空间</h4>
<div class="outline-text-4" id="text-h:87d329d1-481e-4b31-9b23-b09a181063c5">

<figure id="orgdb0156c">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210119170358917.png" alt="image-20210119170358917.png" width="50%">

</figure>

<p>
进一步了解虚拟内存空间的分布情况。最上方的内核空间不用多讲，下方的用户
空间内存，其实又被分成了多个不同的段。以32 位系统为例，下图来表示它们
的关系。
</p>


<figure id="orgedcf948">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210209222659178.png" alt="image-20210209222659178.png">

</figure>

<p>
进一步了解虚拟内存空间的分布情况。最上方的内核空间不用多讲，下方的用户
空间内存，其实又被分成了多个不同的段。以32 位系统为例，下图来表示它们
的关系。
</p>

<p>
通过这张图你可以看到，用户空间内存，从低到高分别是五种不同的内存段。
</p>

<ol class="org-ol">
<li>只读段，包括代码和常量等。</li>
<li>数据段，包括全局变量等。</li>
<li>堆，包括动态分配的内存，从低地址开始向上增长。</li>
<li>文件映射段，包括动态库、共享内存等，从高地址开始向下增长。</li>
<li>栈，包括局部变量和函数调用的上下文等。栈的大小是固定的，一般是 8 MB。</li>
</ol>

<p>
在这五个内存段中，堆和文件映射段的内存是动态分配的。比如说，使用 C标准
库的 malloc() 或者 mmap()，就可以分别在堆和文件映射段动态分配内存。其
实 64位系统的内存分布也类似，只不过内存空间要大得多。
</p>
</div>
</div>
<div id="outline-container-h:48ef5582-7ebf-4b7c-88cf-a4f1e80f5396" class="outline-4">
<h4 id="h:48ef5582-7ebf-4b7c-88cf-a4f1e80f5396">C代码和内存布局之间的对应关系</h4>
<div class="outline-text-4" id="text-h:48ef5582-7ebf-4b7c-88cf-a4f1e80f5396">
<p width="50%">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210119171600413.png" alt="image-20210119171600413.png" width="50%">
每个进程都包含5种不同的数据段
</p>

<ul class="org-ul">
<li>代码段：用来存放可执行文件的操作指令，也就是说它是可执行程序在内存中
的镜像。代码段需要防止在运行时被非法修改，所以只准许读取操作，而不允
许写入(修改)操作-&#x2013;&#x2014;它是不可写的</li>
<li>数据段：用来存放可执行文件中已初始化全局变量，换句话说就是存放程序静
态分配的变量和全局变量</li>
<li>BSS段：Block Started by Symbol以符号开始的块，BSS段包含了程序中未初
始化的全局变量，在内存中bss段全部置零</li>
<li>堆(heap)：存放数组和对象，堆是用于存放进程运行中被动态分配的内存段，
它的大小并不固定，可动态扩张和缩减。当进程调用malloc等函数分配内存时，
新分配的内存就被动态添加到堆上(堆被扩张)；当利用free等函数释放内存时，
被释放的内存从堆中被剔除(堆被缩减)</li>
<li>栈：栈是用户存放程序临时创建的局部变量，也就是说函数括弧“{}”中定义
的变量(但不包括static声明的变量，static意味着在数据段中存放变量)。除
此以外，在函数被调用时，其参数也会被压入发起调用的进程栈中，并且待到
调用结束后，函数的返回值也会被存放回栈中。由于栈的后进先出特点，所以
栈特别方便用来保存/恢复调用现场。可以把堆栈看成一个内存、交换临时数
据的内存区</li>
</ul>


<figure id="org28494a2">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210119171650687.png" alt="image-20210119171650687.png" width="50%">

</figure>
</div>
</div>
<div id="outline-container-h:5dbb64e7-53e6-446f-b582-bae8ead3480e" class="outline-4">
<h4 id="h:5dbb64e7-53e6-446f-b582-bae8ead3480e">进程使用内存问题</h4>
<div class="outline-text-4" id="text-h:5dbb64e7-53e6-446f-b582-bae8ead3480e">
</div>
<div id="outline-container-h:03523338-4006-4ee1-b763-4dd6537463c9" class="outline-5">
<h5 id="h:03523338-4006-4ee1-b763-4dd6537463c9">内存泄漏 Memory Leak</h5>
<div class="outline-text-5" id="text-h:03523338-4006-4ee1-b763-4dd6537463c9">
<p>
指程序中用malloc或new申请了一块内存，但是没有用free或delete将内存释放，
导致这块内存一直处于占用状态
</p>
</div>
</div>
<div id="outline-container-h:756dbfcc-e5f6-4925-bc59-dce549fa694f" class="outline-5">
<h5 id="h:756dbfcc-e5f6-4925-bc59-dce549fa694f">内存溢出 Memory Overflow</h5>
<div class="outline-text-5" id="text-h:756dbfcc-e5f6-4925-bc59-dce549fa694f">
<p>
指程序申请了10M的空间，但是在这个空间写入10M以上字节的数据，就是溢出
</p>

<p>
溢出部分内存可能占用了别的应用程序的内存空间。
</p>
</div>
</div>
<div id="outline-container-h:dd7a4854-6dbd-426b-b419-568d3e1c7dd0" class="outline-5">
<h5 id="h:dd7a4854-6dbd-426b-b419-568d3e1c7dd0">内存不足 Out of Memory</h5>
<div class="outline-text-5" id="text-h:dd7a4854-6dbd-426b-b419-568d3e1c7dd0">
<p>
内存用完了，在情况在java程序中比较常见。系统会选一个进程将之杀死，在
日志messages中看到类似下面的提示
</p>

<p>
<b>Jul 10 10:20:30 kernel: Out of memory: Kill process 9527 (java) score
88 or sacrifice child</b>
</p>

<p>
当JVM因为没有足够的内存来为对象分配空间并且垃圾回收器也已经没有空间可
回收时，就会抛出这个error，因为这个问题已经严重到不足以被应用处理）。
</p>

<p>
原因：
</p>

<ul class="org-ul">
<li>给应用分配内存太少：比如虚拟机本身可使用的内存（一般通过启动时的VM参
数指定）太少。</li>
<li>应用用的太多，并且用完没释放，浪费了。此时就会造成内存泄露或者内存溢出。</li>
</ul>

<p>
使用的解决方法：
</p>

<p>
1.限制Java进程的max heap，并且降低Java程序的worker数量，从而降低内存使
  用
</p>

<p>
2.给系统增加swap空间
</p>


<p>
设置内核参数(不推荐)，不允许内存申请过量：
</p>

<pre class="example" id="org9ef138c">
echo 2 &gt; /proc/sys/vm/overcommit_memory
echo 80 &gt; /proc/sys/vm/overcommit_ratio
echo 2 &gt; /proc/sys/vm/panic_on_oom 
</pre>

<p>
说明：
</p>

<p>
Linux默认是允许memory overcommit的，只要你来申请内存我就给你，寄希望于
进程实际上用不到那么多内存，但万一用到那么多了呢？Linux设计了一个OOM
killer机制挑选一个进程出来杀死，以腾出部分内存，如果还不够就继续。也可
通过设置内核参数vm.panic_on_oom使得发生OOM时自动重启系统。这都是有风险
的机制，重启有可能造成业务中断，杀死进程也有可能导致业务中断。所以
Linux 2.6之后允许通过内核参数 vm.overcommit_memory 禁止memory
overcommit。
</p>

<p>
vm.panic_on_oom 决定系统出现oom的时候，要做的操作。接受的三种取值如下：
</p>

<pre class="example" id="orgafb3c17">
0 - 默认值，当出现oom的时候，触发oom killer
1 - 程序在有cpuset、memory policy、memcg的约束情况下的OOM，可以考虑不  panic，而是启动OOMkiller。其它情况触发 kernel panic，即系统直接重启
2 - 当出现oom，直接触发kernel panic，即系统直接重启
</pre>

<p>
vm.overcommit_memory 接受三种取值:
</p>

<pre class="example" id="org6950e47">
0 – Heuristic overcommit handling. 这是缺省值，它允许overcommit，但过于明目张胆的overcommit会被拒绝，比如malloc一次性申请的内存大小就超过了系统总内存。Heuristic的意思是“试探式的”，内核利用某种算法猜测你的内存申请是否合理，它认为不合理就会拒绝overcommit。
1 – Always overcommit. 允许overcommit，对内存申请来者不拒。内核执行无内存过量使用处理。使用这个设置会增大内存超载的可能性，但也可以增强大量使用内存任务的性能。
2 – Don’t overcommit. 禁止overcommit。 内存拒绝等于或者大于总可用 swap 大小以及
overcommit_ratio 指定的物理 RAM 比例的内存请求。如果您希望减小内存过度使用的风险，这个设置就是最好的。
</pre>

<p>
Heuristic overcommit算法：
单次申请的内存大小不能超过以下值，否则本次申请就会失败。
</p>

<pre class="example" id="orgb261889">
free memory + free swap + pagecache的大小 + SLAB
</pre>

<p>
vm.overcommit_memory=2 禁止overcommit,那么怎样才算是overcommit呢？
</p>

<p>
kernel设有一个阈值，申请的内存总数超过这个阈值就算overcommit，在/proc/meminfo中可以看到这个阈值的大小：
</p>

<pre class="example" id="org14a0adb">
grep -i commit /proc/meminfo
CommitLimit:     5967744 kB
Committed_AS:   5363236 kB
</pre>

<p>
CommitLimit就是overcommit的阈值，申请的内存总数超过CommitLimit的话就算
是overcommit。此值通过内核参数vm.overcommit_ratio或
vm.overcommit_kbytes间接设置的，公式如下：
</p>

<pre class="example" id="orgbef0a8e">
CommitLimit = (Physical RAM * vm.overcommit_ratio / 100) + Swap
</pre>

<p>
vm.overcommit_ratio是内核参数，缺省值是50，表示物理内存的50%。如果你不
想使用比率，也可以直接指定内存的字节数大小，通过另一个内核参数
vm.overcommit_kbytes即可；如果使用了huge pages，那么需要从物理内存中减
去，公式变成：
</p>

<pre class="example" id="orgea74bac">
CommitLimit = ([total RAM] – [total huge TLB RAM]) * vm.overcommit_ratio / 100 + swap
</pre>

<p>
/proc/meminfo中的 Committed_AS表示所有进程已经申请的内存总大小，（注意
是已经申请的，不是已经分配的），如果Committed_AS 超过 CommitLimit 就表
示发生了overcommit，超出越多表示overcommit 越严重。Committed_AS的含义
换一种说法就是，如果要绝对保证不发生OOM (out ofmemory)需要多少物理内存。
</p>

<p>
范例：
</p>

<pre class="example" id="org060c989">
[root@centos8 ~]#cat /proc/sys/vm/panic_on_oom
0
[root@centos8 ~]#cat /proc/sys/vm/overcommit_memory
0
[root@centos8 ~]#cat /proc/sys/vm/overcommit_ratio
50
[root@centos8 ~]#grep -i commit /proc/meminfo
CommitLimit:     3021876 kB
Committed_AS:     340468 kB
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:a9057e7b-bf7d-4596-b217-d93c11add675" class="outline-3">
<h3 id="h:a9057e7b-bf7d-4596-b217-d93c11add675">进程状态</h3>
<div class="outline-text-3" id="text-h:a9057e7b-bf7d-4596-b217-d93c11add675">

<figure id="org6093c83">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210119171906284.png" alt="image-20210119171906284.png" width="50%">

</figure>

<p>
<b>进程的基本状态</b>
</p>

<ul class="org-ul">
<li>创建状态：进程在创建时需要申请一个空白PCB进程控制块，向其中填写控制
和管理进程的信息，完成资源分配。如果创建工作无法完成，比如资源无法满
足，就无法被调度运行，把此时进程所处状态称为创建状态</li>

<li>就绪状态：进程已准备好，已分配到所需资源，只要分配到CPU就能够立即运行</li>

<li>执行状态：进程处于就绪状态被调度后，进程进入执行状态</li>

<li>阻塞状态：正在执行的进程由于某些事件（I／O请求，申请缓存区失败）而暂
时无法进行，进程受到阻塞。在满足请求时进入就绪状态等待系统调用</li>

<li>终止状态：进程结束，或出现错误，或被系统终止，进入终止状态。无法再执行</li>
</ul>

<p>
<b>状态之间转换六种情况</b>
</p>
<ul class="org-ul">
<li>运行-&#x2013;&#x2014;&gt;就绪：1，主要是进程占用CPU的时间过长，而系统分配给该进程
占用CPU的时间是有限的；2，在采用抢先式优先级调度算法的系统中,当有更
高优先级的进程要运行时，该进程就被迫让出CPU，该进程便由执行状态转变
为就绪状态</li>
<li>就绪-&#x2013;&#x2014;&gt;运行：运行的进程的时间片用完，调度就转到就绪队列中选择合
适的进程分配CPU</li>
<li>运行-&#x2013;&#x2014;&gt;阻塞：正在执行的进程因发生某等待事件而无法执行，则进程由
执行状态变为阻塞状态，如发生了I/O请求</li>
<li>阻塞-&#x2013;&#x2014;&gt;就绪:进程所等待的事件已经发生，就进入就绪队列</li>
</ul>

<p>
以下两种状态是不可能发生的：
</p>
<ul class="org-ul">
<li>阻塞-&#x2013;&#x2014;&gt;运行：即使给阻塞进程分配CPU，也无法执行，操作系统在进行调
度时不会从阻塞队列进行挑选，而是从就绪队列中选取</li>
<li>就绪-&#x2013;&#x2014;&gt;阻塞：就绪态根本就没有执行，谈不上进入阻塞态</li>
</ul>

<p>
<b>进程更多的状态</b>
</p>

<ul class="org-ul">
<li>运行态:running</li>
<li>就绪态：ready</li>
<li>睡眠态：分为两种，可中断：interruptable，不可中断：uninterruptable
<ul class="org-ul">
<li>可中断:interruptable；可以立即被调度到CPU运行</li>
<li>不可中断:uniterruptable；调度到CPU运行不起来；进程运行过程中需要加
载数据，而内存中没有时就请求内核操作，内核将数据先加载到内核内存中
再从内核内存复制到进程内存中，期间这样的一次I/O等待，进程是运行不
起来的.一次IO分两步:
<ul class="org-ul">
<li>内核将数据加载到内核内存中</li>
<li>从内核内存中复制到进程内存</li>
</ul></li>
</ul></li>
<li>停止态：stopped，暂停于内存，但不会被调度，除非手动启动</li>
<li>僵死态：zombie，僵尸态，结束进程，父进程结束前，子进程不关闭，杀死父
进程可以关闭僵死态的子进程。父进程出问题了，没人处理子进程问题。</li>
</ul>



<figure id="orgc5a2733">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210119172156411.png" alt="image-20210119172156411.png" width="50%">

</figure>

<p>
不可中断状态的进程则是正处于内核态关键流程中的进程，并且这些流程是不可
打断的，比如最常见的是等待硬件设备的I/O响应，也就是我们在ps命令中看到
的D状态（Uninterruptible Sleep，也称为Disk Sleep）的进程。
</p>

<p>
范例:僵死态
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#bash
[root@centos8 ~]#echo $<span style="color: #a0522d;">BASHPID</span>
1809
[root@centos8 ~]#echo $<span style="color: #a0522d;">PPID</span>
1436

<span style="color: #483d8b;">kill</span> -L

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#29238;&#36827;&#31243;&#35774;&#20026;&#20572;&#27490;&#24577;</span>
[root@centos8 ~]#kill -19 1436
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26432;&#27515;&#23376;&#36827;&#31243;&#65292;&#20351;&#20854;&#36827;&#20837;&#20725;&#23608;&#24577;</span>
[root@centos8 ~]#kill -9 1809
[root@centos8 ~]#ps aux <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#30475;&#21040;&#19978;&#38754;&#22270;&#31034;&#30340;&#32467;&#26524;&#65292;STAT&#20026;Z&#65292;&#34920;&#31034;&#20026;&#20725;&#23608;&#24577;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;1:&#24674;&#22797;&#29238;&#36827;&#31243;</span>
[root@centos8 ~]#kill -18 1436
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;2:&#26432;&#27515;&#29238;&#36827;&#31243;</span>
[root@centos8 ~]#kill -9 1436
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20877;&#27425;&#35266;&#23519;&#65292;&#21487;&#20197;&#20725;&#23608;&#24577;&#30340;&#36827;&#31243;&#19981;&#23384;&#22312;&#20102;</span>
[root@centos8 ~]#ps aux 
</pre>
</div>

<p>
<b>孤儿进程</b>
</p>

<p>
如果在子进程退出前，父进程先退出，这时进程将成为孤儿进程，因为它的父进程已经死了。孤儿进程会被PID=1的systemd进程收养，成为systemd的子进程。
注意，孤儿进程还会继续运行，而不会随父进程退出而退出，只不过父进程发生了改变。
</p>

<p>
范例：孤儿进程
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">screen &#20013;ping 127.1</span>
[root@ip-10-0-129-226 ~]# ping 127.1

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21478;&#19968;&#20010;&#31383;&#21475;&#26597;&#30475;ping</span>
[root@ip-10-0-129-226 ~]# pstree -p
           &#9500;&#9472;sshd(1729)&#9472;&#9516;&#9472;sshd(1975726)&#9472;&#9472;&#9472;sshd(1975738)&#9472;&#9472;&#9472;bash(1975792)&#9472;&#9472;&#9472;sudo(1975831)&#9472;&#9472;&#9472;sudo(1975833)&#9472;&#9472;&#9472;su(1975834)&#9472;&#9472;&#9472;bash(1975835)&#9472;&#9472;&#9472;screen(1976376)&#9472;&#9472;&#9472;screen(1976377)&#9472;&#9472;&#9472;bash(1976378)&#9472;&#9472;&#9472;ping(1976415)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20851;&#38381;ping&#30340;&#31383;&#21475;, screen&#24050;&#32463;&#34987;systemd&#25509;&#31649;</span>
[root@ip-10-0-129-226 ~]# pstree -p
           &#9500;&#9472;screen(1976377)&#9472;&#9472;&#9472;bash(1976378)&#9472;&#9472;&#9472;ping(1976415)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:381f7bfd-db0e-4a01-a91b-6009bebe8e93" class="outline-3">
<h3 id="h:381f7bfd-db0e-4a01-a91b-6009bebe8e93">LRU算法</h3>
<div class="outline-text-3" id="text-h:381f7bfd-db0e-4a01-a91b-6009bebe8e93">
<p>
LRU:Least Recently Used 近期最少使用算法,释放内存
</p>


<figure id="org60213d0">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/img_20240928_234006.png" alt="img_20240928_234006.png" width="30%">

</figure>


<p>
范例: 假设序列为 4 3 4 2 3 1 4 2， 物理块有3个，
</p>
<pre class="example" id="org6b1dcba">
第1轮 4调入内存 4
第2轮 3调入内存 3 4
第3轮 4调入内存 4 3
第4轮 2调入内存 2 4 3
第5轮 3调入内存 3 2 4
第6轮 1调入内存 1 3 2
第7轮 4调入内存 4 1 3
第8轮 2调入内存 2 4 1
</pre>
</div>
</div>
<div id="outline-container-h:687c7006-fa03-433f-aec5-e663c778954e" class="outline-3">
<h3 id="h:687c7006-fa03-433f-aec5-e663c778954e">IPC进程间通信</h3>
<div class="outline-text-3" id="text-h:687c7006-fa03-433f-aec5-e663c778954e">
<p>
进程中有些数据必须在内存中，有些可以被换出的；必须在内存中的就叫做常驻
内存集，而能交换出去的就是交虚拟内存集；常驻内存集：指令 虚拟内存集：
真正占用的
</p>

<p>
虽然进程以为只有自己在运行，但必要时还是需要进程间通信的，这时就需要
IPC机制；
</p>

<p>
IPC:Inter Process Communication
</p>

<ul class="org-ul">
<li>同一主机进程通讯方式:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">pipe                                <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31649;&#36947;,&#21333;&#21521;&#20256;&#36755;</span>
socket                             <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22871;&#25509;&#23383;&#25991;&#20214;, &#25903;&#25345;&#21452;&#24037;&#36890;&#20449;</span>
Memory-maped file     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25991;&#20214;&#26144;&#23556;,&#23558;&#25991;&#20214;&#20013;&#30340;&#19968;&#27573;&#25968;&#25454;&#26144;&#23556;&#21040;&#29289;&#29702;&#20869;&#23384;&#65292;&#22810;&#20010;&#36827;&#31243;&#20849;&#20139;&#36825;&#29255;&#20869;&#23384;</span>
shm shared memory    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20849;&#20139;&#20869;&#23384;</span>
signal                              <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20449;&#21495;</span>
Lock                                <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#36164;&#28304;&#19978;&#38145;&#65292;&#22914;&#26524;&#36164;&#28304;&#24050;&#34987;&#26576;&#36827;&#31243;&#38145;&#20303;&#65292;&#21017;&#20854;&#23427;&#36827;&#31243;&#24819;&#20462;&#25913;&#29978;&#33267;&#35835;&#21462;&#36825;&#20123;&#36164;&#28304;&#65292;&#37117;&#23558;&#34987;&#38459;&#22622;&#65292;&#30452;&#21040;&#38145;&#34987;&#25171;&#24320;</span>
semaphore                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20449;&#21495;&#37327;&#65292;&#19968;&#31181;&#35745;&#25968;&#22120;</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
不同主机:socket=IP和端口号
</p>

<p>
在实际开发中很少使用socket来实现进程之间通信，使用以下几种
</p></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">RPC remote procedure call  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36828;&#31243;&#36807;&#31243;&#35843;&#29992;</span>
MQ                                          <span style="color: #b22222;">#</span><span style="color: #b22222;">&#28040;&#24687;&#38431;&#21015;&#65292;&#29983;&#20135;&#32773;&#21644;&#28040;&#36153;&#32773;&#65292;&#22914;&#65306;Kafka&#65292;RabbitMQ&#65292;ActiveMQ</span>
</pre>
</div>

<p>
范例：利用管道文件实现进IPC
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#31649;&#36947;&#25991;&#20214;&#23454;&#38469;&#19978;&#26159;&#25918;&#22312;&#20869;&#23384;&#20013;&#65292;&#21482;&#26159;&#20511;&#21161;&#25991;&#20214;&#32780;&#24050;</span>
[root@centos8 ~]#mkfifo /data/test.fifo
[root@centos8 ~]#ll /data/test.fifo
prw-r--r-- 1 root root 0 May  6 14:32 /data/test.fifo
[root@centos8 ~]#cat &gt; /data/test.fifo
me

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;&#21478;&#19968;&#20010;&#32456;&#31471;&#21487;&#20197;&#20174;&#25991;&#20214;&#20013;&#35835;&#21462;&#25968;&#25454;</span>
[root@centos8 ~]#cat /data/test.fifo
me
</pre>
</div>



<figure id="org868c92d">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210213224011528.png" alt="image-20210213224011528.png" width="50%">

</figure>

<p>
利用管道可以实现并发处理
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@stor01 ~]# cat a.sh
<span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/bash</span>
mkfifo test_fifo
<span style="color: #a020f0;">exec</span> 5&lt;&gt;test_fifo <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#24320;&#25991;&#20214;&#65292;&#24182;&#25351;&#23450;&#20854;&#25991;&#20214;&#25551;&#36848;&#31526;&#20026;5&#65292;&#35813;&#25551;&#36848;&#31526;&#26159;&#21487;&#35835;&#12289;&#21487;&#20889;&#30340;&#12290;</span>
rm -f test_fifo
seq 2&gt;&amp;5   <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21521;&#31649;&#36947;&#20013;&#20889;&#20837;2&#34892;</span>

<span style="color: #a020f0;">for</span> i<span style="color: #a020f0;"> in</span> {1..3};<span style="color: #a020f0;">do</span>
    <span style="color: #483d8b;">read</span> -u5
    {
        <span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">i</span>;sleep 2;  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38656;&#35201;&#24182;&#21457;&#30340;&#20869;&#23481;&#32479;&#19968;&#20889;&#22312;&#22823;&#25324;&#21495;&#37324;</span>
        <span style="color: #483d8b;">echo</span> &gt;&amp;5
    }&amp;
<span style="color: #a020f0;">done</span>
<span style="color: #483d8b;">wait</span>

[root@stor01 ~]# bash a.sh
2
1
3
</pre>
</div>

<p>
范例:查找socket文件
</p>

<pre class="example" id="org69d8010">
[root@centos8 ~]#find / -type s -ls
</pre>
</div>
</div>
<div id="outline-container-h:dad7d2e2-ce69-46d9-936f-0917a05a292b" class="outline-3">
<h3 id="h:dad7d2e2-ce69-46d9-936f-0917a05a292b">进程优先级</h3>
<div class="outline-text-3" id="text-h:dad7d2e2-ce69-46d9-936f-0917a05a292b">

<figure id="org43ed6f1">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210119172444273.png" alt="image-20210119172444273.png" width="50%">

</figure>

<p>
CentOS 优先级
</p>


<figure id="org6920620">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210119172527665.png" alt="image-20210119172527665.png" width="50%">

</figure>

<p>
进程优先级:
</p>

<div class="org-src-container">
<pre class="src src-sh">&#31995;&#32479;&#20248;&#20808;&#32423;&#65306;0-139, &#25968;&#23383;&#36234;&#23567;&#65292;&#20248;&#20808;&#32423;&#36234;&#39640;&#65292;&#21508;&#26377;140&#20010;&#36816;&#34892;&#38431;&#21015;&#21644;&#36807;&#26399;&#38431;&#21015;
    0-139&#65288;CentOS 4,5&#65289;
    0-98&#65292;99&#65288;CentOS 6&#65289;&#23454;&#26102;&#36827;&#31243;
    100-139 &#38750;&#23454;&#26102;&#36827;&#31243;
&#23454;&#26102;&#20248;&#20808;&#32423;: 99-0 &#20540;&#26368;&#22823;&#20248;&#20808;&#32423;&#26368;&#39640;
nice&#20540;&#65306;-20&#21040;19&#65292;&#23545;&#24212;&#31995;&#32479;&#20248;&#20808;&#32423;100-139&#25110;99&#65307;&#26222;&#36890;&#29992;&#25143;&#21482;&#33021;&#35843;&#20302;&#33258;&#24049;&#30340;&#20248;&#20808;&#32423;&#65292;&#21482;&#26377;&#31649;&#29702;&#21592;&#25165;&#33021;&#35843;&#39640;
</pre>
</div>

<p>
范例：查看进程优先级
</p>
<div class="org-src-container">
<pre class="src src-sh">ps axo pid,cmd,ni   <span style="color: #b22222;">#</span><span style="color: #b22222;">ni &#20248;&#20808;&#32423;&#65292;&#40664;&#35748;&#36827;&#31243;&#30340;&#20248;&#20808;&#32423;&#26159;0&#65292;&#23545;&#24212;&#31995;&#32479;&#20248;&#20808;&#32423;&#30340;120</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;renice&#35843;&#25972;&#24050;&#32463;&#36816;&#34892;&#36827;&#31243;&#30340;&#20248;&#20808;&#32423;</span>
renice -n -10 123445
</pre>
</div>

<p>
优先级高不一定快，受io，程序逻辑等影响。如ping命令有网络io、1秒执行一次，提高进程优先级并不能快
</p>

<p>
调用时内核只需要扫描队列的首部，根据优先级来判断哪个先进；每个队列有两
对：运行队列、过期队列，140对280队，通过CPU中断控制来给进程运行时间;程
序从运行队列中运行完毕，就会被抛到过期队列；等运行队列被运行完了，就会
和过期队列调换位置；
</p>

<p>
Big O：时间（空间）复杂度，用时（空间）和规模的关系：
</p>

<pre class="example" id="orgb71f72b">
- O(1) 无论复杂度多大，解决的时间都是恒定的；理想标准
- O(logn)：对数
- O(n)线性
- O(n^2)抛物线
- O(2^n) 指数，有时叫作“几何”（阶）
</pre>

<p>
参考： 大O符号
</p>

<ul class="org-ul">
<li><a href="http://baike.baidu.com/link?url=OpMWVJjZ4h6ZV79Yz2wHXTg1a_vm7Ywi0dKjZH-3Cr7H1Y964sAG4Rq51Z-4xDkWPBrKMyWhHTbrB0uwR4xjC">http://baike.baidu.com/link?url=OpMWVJjZ4h6ZV79Yz2wHXTg1a_vm7Ywi0dKjZH-3Cr7H1Y964sAG4Rq51Z-4xDkWPBrKMyWhHTbrB0uwR4xjC</a>_</li>
</ul>
<p>
算法的时间复杂度(大O表示法)
</p>
<ul class="org-ul">
<li><a href="https://blog.csdn.net/ws9029/article/details/109398268">https://blog.csdn.net/ws9029/article/details/109398268</a> log(logarithms）</li>
<li><a href="http://baike.baidu.com/link?url=A11fWl0T_lX7K5jbVPYjLTLgOZKXQwZv8tMk9taP0fxaIpwfNja_uWDDCIHoSBBpDYCjb1rG05aeZV39Vka0rpvp9nhMAoKABOPhwNPkdkq">http://baike.baidu.com/link?url=A11fWl0T_lX7K5jbVPYjLTLgOZKXQwZv8tMk9taP0fxaIpwfNja_uWDDCIHoSBBpDYCjb1rG05aeZV39Vka0rpvp9nhMAoKABOPhwNPkdkq</a></li>
</ul>
</div>
</div>
<div id="outline-container-h:d8aed175-f1dc-40e1-9dcc-cdd06c7aeafa" class="outline-3">
<h3 id="h:d8aed175-f1dc-40e1-9dcc-cdd06c7aeafa">进程分类</h3>
<div class="outline-text-3" id="text-h:d8aed175-f1dc-40e1-9dcc-cdd06c7aeafa">
<p>
<b>操作系统分类:</b>
</p>

<ul class="org-ul">
<li>协作式多任务:早期Windows系统使用,即一个任务得到了CPU时间,除非它自己
放弃使用CPU，否则将完全霸占CPU ，所以任务之间需要协作-&#x2013;&#x2014;使用一段
时间的 CPU ，主动放弃使用</li>

<li>抢占式多任务:Linux内核，CPU的总控制权在操作系统手中，操作系统会轮流
询问每一个任务是否需要使用 CPU，需要使用的话就让它用，不过在一定时间
后，操作系统会剥夺当前任务的 CPU使用权，把它排在询问队列的最后，再去
询问下一个任务</li>
</ul>

<p>
<b>进程类型:</b>
</p>

<ul class="org-ul">
<li>守护进程: daemon,在系统引导过程中启动的进程，和终端无关进程</li>
<li>前台进程：跟终端相关，通过终端启动的进</li>
</ul>

<p>
注意：两者可相互转化
</p>

<p>
<b>按进程资源使用的分类：</b>
</p>

<ul class="org-ul">
<li>CPU-Bound：CPU 密集型，非交互</li>
<li>IO-Bound：IO 密集型，交互</li>
</ul>
</div>
</div>
<div id="outline-container-h:6e9172bf-6edb-49d2-bb27-3262a3026edb" class="outline-3">
<h3 id="h:6e9172bf-6edb-49d2-bb27-3262a3026edb">IO调度算法</h3>
<div class="outline-text-3" id="text-h:6e9172bf-6edb-49d2-bb27-3262a3026edb">
<p>
在LINUX 2.6中有四种关于IO的调度算法:
</p>

<ul class="org-ul">
<li><p>
NOOP
</p>

<p>
NOOP算法的全写为No Operation。该算法实现了最简单的FIFO队列，所有IO请
求大致按照先来后到的顺序进行操作。之所以说“大致”，原因是NOOP在FIFO
的基础上还做了相邻IO请求的合并，并不是完完全全按照先进先出的规则满足
IO请求。NOOP假定I/O请求由驱动程序或者设备做了优化或者重排了顺序(就像
一个智能控制器完成的工作那样)。在有些SAN环境下，这个选择可能是最好选
择。Noop对于 IO 不那么操心，对所有的 IO请求都用 FIFO 队列形式处理，
默认认为 IO不会存在性能问题。这也使得 CPU也不用那么操心。当然，对于
复杂一点的应用类型，使用这个调度器，用户自己就会非常操心。
</p></li>

<li><p>
CFQ
</p>

<p>
CFQ算法的全写为Completely Fair Queuing。该算法的特点是按照IO请求的地
址进行排序，而不是按照先来后到的顺序来进行响应。在传统的SAS盘上，磁
盘寻道花去了绝大多数的IO响应时间。CFQ的出发点是对IO地址进行排序，以
尽量少的磁盘旋转次数来满足尽可能多的IO请求。在CFQ算法下，SAS盘的吞吐
量大大提高了。但是相比于NOOP的缺点是，先来的IO请求并不一定能被满足，
可能会出现饿死的情况。Completely Fair Queuing （cfq, 完全公平队列)
在 2.6.18 取代了Anticipatory scheduler 成为Linux Kernel 默认的 IO
scheduler 。cfq对每个进程维护一个 IO 队列，各个进程发来的 IO 请求会
被 cfq以轮循方式处理。也就是对每一个 IO 请求都是公平的。这使得 cfq很
适合离散读的应用(eg: OLTP DB)
</p></li>

<li><p>
Deadline scheduler
</p>

<p>
DEADLINE在CFQ的基础上，解决了IO请求饿死的极端情况。deadline算法保证
对于既定的 IO 请求以最小的延迟时间，除了CFQ本身具有的IO排序队列之外，
DEADLINE额外分别为读IO和写IO提供了FIFO队列。读FIFO队列的最大等待时间
为500ms，写FIFO队列的最大等待时间为5s。FIFO队列内的IO请求优先级要比
CFQ队列中的高，，而读FIFO队列的优先级又比写FIFO队列的优先级高。优先
级可以表示如下：FIFO(Read) &gt; FIFO(Write) &gt; CFQ
</p></li>

<li><p>
Anticipatory scheduler
</p>

<p>
CFQ和DEADLINE考虑的焦点在于满足零散IO请求上。
对于连续的IO请求，比如顺序读，并没有做优化。为了满足随机IO和顺序IO混
合的场景，Linux还支持ANTICIPATORY调度算法。ANTICIPATORY的在DEADLINE
的基础上，为每个读IO都设置了6ms的等待时间窗口。如果在这6ms内OS收到了
相邻位置的读IO请求，就可以立即满足Anticipatory scheduler（as) 曾经一
度是 Linux 2.6 Kernel 的 IO scheduler 。Anticipatory 的中文含义是”
预料的, 预想的”,这个词的确揭示了这个算法的特点，简单的说，有个 IO发
生的时候，如果又有进程请求 IO 操作，则将产生一个默认的 6毫秒猜测时间，
猜测下一个 进程请求 IO是要干什么的。这对于随即读取会造成比较大的延时，
对数据库应用很糟糕，而对于Web Server等则会表现的不错。这个算法也可以
简单理解为面向低速磁盘的，因为那个”猜测”实际上的目的是为了减少磁头
移动时间。
</p></li>
</ul>

<p>
范例:查看IO调度算法
</p>

<pre class="example" id="orge0404ad">
[root@ubuntu1804 ~]#cat /sys/block/sda/queue/scheduler
noop deadline [cfq]
[root@centos8 ~]#cat /sys/block/sda/queue/scheduler
[mq-deadline] kyber bfq none
[root@centos7 ~]#cat /sys/block/sda/queue/scheduler
noop [deadline] cfq
[root@centos6 ~]#cat /sys/block/sda/queue/scheduler
noop anticipatory deadline [cfq]  
</pre>
</div>
</div>
<div id="outline-container-h:e20fa8f0-844e-40c5-9c84-554269646a47" class="outline-3">
<h3 id="h:e20fa8f0-844e-40c5-9c84-554269646a47">进程的数字标识16bits：</h3>
<div class="outline-text-3" id="text-h:e20fa8f0-844e-40c5-9c84-554269646a47">
<p>
0-65535：有效使用1-65535
</p>

<ul class="org-ul">
<li>1-1023：固定分配，服务器使用，而且只有管理员有权限启用；</li>
<li>1024-4W：半固定，服务，如mysql等</li>
<li>4W+：临时；标识临时通信进程</li>
</ul>
</div>
</div>
</section>
<section id="outline-container-h:5f6c0250-4959-4a0f-9fd8-873eedc2409e" class="outline-2">
<h2 id="h:5f6c0250-4959-4a0f-9fd8-873eedc2409e">进程管理和性能相关工具</h2>
<div class="outline-text-2" id="text-h:5f6c0250-4959-4a0f-9fd8-873eedc2409e">
<p>
参考链接：<a href="https://www.brendangregg.com/linuxperf.html">https://www.brendangregg.com/linuxperf.html</a>
</p>


<figure id="org84ff3ae">
<img src="https://www.brendangregg.com/Perf/linux_observability_tools.png" alt="linux_observability_tools.png" width="50%">

</figure>

<p>
Linux系统状态的查看及管理工具:
</p>
</div>
<div id="outline-container-h:3aa13baa-6936-4735-8e60-ed7c9f1e01a9" class="outline-3">
<h3 id="h:3aa13baa-6936-4735-8e60-ed7c9f1e01a9">进程</h3>
<div class="outline-text-3" id="text-h:3aa13baa-6936-4735-8e60-ed7c9f1e01a9">
</div>
<div id="outline-container-h:3c768fad-9e98-4ded-8386-cc830fc00926" class="outline-4">
<h4 id="h:3c768fad-9e98-4ded-8386-cc830fc00926">pstree 进程树</h4>
<div class="outline-text-4" id="text-h:3c768fad-9e98-4ded-8386-cc830fc00926">
<p>
pstree 可以用来显示进程的父子关系,以树形结构显示 格式:
</p>

<div class="org-src-container">
<pre class="src src-sh">pstree [OPTION] [ PID | USER ]
</pre>
</div>

<p>
选项:
</p>

<div class="org-src-container">
<pre class="src src-sh">&#24120;&#29992;&#36873;&#39033;:
-p &#26174;&#31034;&#36827;&#31243;&#32534;&#21495;PID
-T &#19981;&#26174;&#31034;&#32447;&#31243;thread,&#40664;&#35748;&#26174;&#31034;&#32447;&#31243;
-u &#26174;&#31034;&#29992;&#25143;&#20999;&#25442;
-H pid &#39640;&#20142;&#26174;&#31034;&#25351;&#23450;&#36827;&#31243;&#21450;&#20854;&#21069;&#36744;&#36827;&#31243;&#65307;&#21644;&#25351;&#23450;&#8221;-h&#8221;&#21442;&#25968;&#31867;&#20284;&#65292;&#20294;&#29305;&#21035;&#26631;&#26126;&#25351;&#23450;&#30340;&#31243;&#24207;&#12290;

&#20854;&#23427;&#36873;&#39033;
-a &#12288;&#26174;&#31034;&#27599;&#20010;&#31243;&#24207;&#30340;&#23436;&#25972;&#25351;&#20196;&#65292;&#21253;&#21547;&#36335;&#24452;&#65292;&#21442;&#25968;&#25110;&#26159;&#24120;&#39547;&#26381;&#21153;&#30340;&#26631;&#31034;&#12290;
-c &#12288;&#19981;&#20351;&#29992;&#31934;&#31616;&#26631;&#31034;&#27861;&#12290;
-G &#12288;&#20351;&#29992;VT100&#32456;&#31471;&#26426;&#30340;&#21015;&#32472;&#22270;&#23383;&#31526;&#12290;
-h &#12288;&#21015;&#20986;&#26641;&#29366;&#22270;&#26102;&#65292;&#29305;&#21035;&#26631;&#26126;&#29616;&#22312;&#25191;&#34892;&#30340;&#31243;&#24207;&#12290;
-l &#12288;&#37319;&#29992;&#38271;&#21015;&#26684;&#24335;&#26174;&#31034;&#26641;&#29366;&#22270;&#12290;
-n &#12288;&#29992;&#31243;&#24207;&#35782;&#21035;&#30721;&#25490;&#24207;&#12290;&#39044;&#35774;&#26159;&#20197;&#31243;&#24207;&#21517;&#31216;&#26469;&#25490;&#24207;&#12290;
-U &#12288;&#20351;&#29992;UTF-8&#21015;&#32472;&#22270;&#23383;&#31526;&#12290;
-V &#12288;&#26174;&#31034;&#29256;&#26412;&#20449;&#24687;&#12290;
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#pstree 1
[root@centos8 ~]#pstree -T
[root@centos8 ~]#pstree -pT
[root@centos8 ~]#pstree -u  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#29992;&#25143;&#30340;&#20999;&#25442;</span>
        &#9500;&#9472;sshd&#9472;&#9472;&#9472;sshd&#9472;&#9472;&#9472;sshd(ec2-user)&#9472;&#9472;&#9472;bash&#9472;&#9472;&#9472;sudo(root)&#9472;&#9472;&#9472;sudo&#9472;&#9472;&#9472;su&#9472;&#9472;&#9472;bash&#9472;&#9472;&#9472;pstree

[root@centos8 ~]#pstree -pH 1780 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#39640;&#20142;&#26174;&#31034;&#21069;&#36744;&#36827;&#31243;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c958b3e7-098f-41e4-985a-061832340cac" class="outline-4">
<h4 id="h:c958b3e7-098f-41e4-985a-061832340cac">ps进程信息</h4>
<div class="outline-text-4" id="text-h:c958b3e7-098f-41e4-985a-061832340cac">
<p>
ps 即 process state,可以显示当前进程的快照,默认显示当前终端中的进
程,Linux系统各进程的相关信息均保存在/proc/PID目录下的各文件中
</p>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 1]# cat /proc/1/maps
7f672b716000-7f672b71a000 r-xp 00000000 08:03 33695159                   /usr/lib64/libuuid.so.1.3.0
...
7f672e0b9000-7f672e310000 rw-p 00000000 00:00 0                          [heap]   &#22534;&#20869;&#23384;
7ffff3fa4000-7ffff3fc5000 rw-p 00000000 00:00 0                          [stack]  &#26632;&#20869;&#23384;
7ffff3ffe000-7ffff4000000 r-xp 00000000 00:00 0                          [vdso]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]
&#36827;&#31243;&#29289;&#29702;&#20869;&#23384;&#24320;&#22987;-&#32467;&#26463;                                                    &#23384;&#25918;&#30340;&#25968;&#25454;
</pre>
</div>

<p>
ps格式:
</p>
<div class="org-src-container">
<pre class="src src-sh">ps [OPTION]...

&#25903;&#25345;&#19977;&#31181;&#36873;&#39033;:
- UNIX&#36873;&#39033; &#22914;:-A -e
- BSD&#36873;&#39033; &#22914;:a
- GNU&#36873;&#39033; &#22914;:--help
</pre>
</div>

<p>
常用选项:
</p>

<div class="org-src-container">
<pre class="src src-sh">a &#36873;&#39033;&#21253;&#25324;&#25152;&#26377;&#32456;&#31471;&#20013;&#30340;&#36827;&#31243;
x &#36873;&#39033;&#21253;&#25324;&#19981;&#38142;&#25509;&#32456;&#31471;&#30340;&#36827;&#31243; &#24102;[]&#26631;&#35782;&#20869;&#26680;&#32447;&#31243;
u &#36873;&#39033;&#26174;&#31034;&#36827;&#31243;&#25152;&#26377;&#32773;&#30340;&#20449;&#24687;
f &#36873;&#39033;&#26174;&#31034;&#36827;&#31243;&#26641;,&#30456;&#24403;&#20110; --forest
k|--sort &#23646;&#24615; &#23545;&#23646;&#24615;&#25490;&#24207;,&#23646;&#24615;&#21069;&#21152; - &#34920;&#31034;&#20498;&#24207;
o &#23646;&#24615;&#8230; &#36873;&#39033;&#26174;&#31034;&#23450;&#21046;&#30340;&#20449;&#24687; pid&#12289;cmd&#12289;%cpu&#12289;%mem
L &#26174;&#31034;&#25903;&#25345;&#30340;&#23646;&#24615;&#21015;&#34920;
-C cmdlist &#25351;&#23450;&#21629;&#20196;&#65292;&#22810;&#20010;&#21629;&#20196;&#29992;&#65292;&#20998;&#38548;
-L &#26174;&#31034;&#32447;&#31243;
-e &#26174;&#31034;&#25152;&#26377;&#36827;&#31243;&#65292;&#30456;&#24403;&#20110;-A
-f &#26174;&#31034;&#23436;&#25972;&#26684;&#24335;&#31243;&#24207;&#20449;&#24687;
-F &#26174;&#31034;&#26356;&#23436;&#25972;&#26684;&#24335;&#30340;&#36827;&#31243;&#20449;&#24687;
    C:CPU utilization
    PSR: &#36816;&#34892;&#22312;&#21738;&#20010;CPU&#20043;&#19978;
-H &#20197;&#36827;&#31243;&#23618;&#32423;&#26684;&#24335;&#26174;&#31034;&#36827;&#31243;&#30456;&#20851;&#20449;&#24687;  --forest &#26356;&#32654;&#35266;
-u userlist &#25351;&#23450;&#26377;&#25928;&#30340;&#29992;&#25143;ID&#25110;&#21517;&#31216;
-U userlist &#25351;&#23450;&#30495;&#27491;&#30340;&#29992;&#25143;ID&#25110;&#21517;&#31216;
-g gid&#25110;groupname &#25351;&#23450;&#26377;&#25928;&#30340;gid&#25110;&#32452;&#21517;&#31216;
-G gid&#25110;groupname &#25351;&#23450;&#30495;&#27491;&#30340;gid&#25110;&#32452;&#21517;&#31216;
-p pid &#26174;&#31034;&#25351;pid&#30340;&#36827;&#31243;
--ppid pid &#26174;&#31034;&#23646;&#20110;pid&#30340;&#23376;&#36827;&#31243;
-t ttylist &#25351;&#23450;tty,&#30456;&#24403;&#20110; t
-M &#26174;&#31034;SELinux&#20449;&#24687;&#65292;&#30456;&#24403;&#20110;Z
</pre>
</div>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@ip-10-0-129-226 ~]# ps -ef
UID          PID    PPID  C STIME TTY          TIME CMD
root           1       0  0 Sep07 ?        00:01:50 /usr/lib/systemd/systemd --switched-root --system --deserialize=32
root           2       0  0 Sep07 ?        00:00:00 [kthreadd]

[root@ip-10-0-129-226 ~]#  ps aux  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26356;&#21152;&#20016;&#23500;</span>
USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root           1  0.0  0.3 182576 11952 ?        Ss   Sep07   1:50 /usr/lib/systemd/systemd --switched-root --system --deserialize=32
root           2  0.0  0.0      0     0 ?        S    Sep07   0:00 [kthreadd]
</pre>
</div>

<p>
<b>ps输出属性</b>
</p>

<pre class="example" id="orgb9d857b">
C :  ps -ef 显示列 C 表示cpu利用率
USER：运行该进程的用户
PID：进程的ID号码
PPID：父进程的进程号，0在内核启动init之前存在，init启动后终止，存在过渡，一般为swap的进程
%CPU：CPU的占用百分比
%MEM：内存空间占用比率，占用整个内存空间的比例
VSZ: Virtual memory SiZe，虚拟内存集，线性内存；占用的虚拟内存大小，真正用来占用的内存
    每个内存占用的内存有两种：线性内存空间、物理内存空间
        线性内存：会映射到物理内存，在线性内存空间角度看是连续的内存占用
        物理内存：实际上是以内存页框保存，可能一个进程占用的不连续的页框
RSS: ReSident Size, 常驻内存集；坚决不能转换到swap中内存集
STAT：进程状态
    R：running 运行态
    S: interruptable sleeping 可中断睡眠
    D: uninterruptable sleeping ，不可中断睡眠
    T: stopped 停止状态
    Z: zombie 僵死状态，进程结束后，在被回收之前状态
    +: 前台进程
    l: 多线程进程
    L：内存分页并带锁
    N：低优先级进程
    &lt;: 高优先级进程
    s: session leader，会话（子进程）发起者，如shell，其主导其下的进程
    I：Idle kernel thread 空闲内核线程，CentOS 8 新特性
START：进程开始时间
TIME：累计运行CPU时间. 如，35-09:30:18：35天9小时30分钟18秒
COMMAND：使用进程、线程

系统优先级： 0 --&gt; 100 --&gt;120 --&gt; 139
ni: nice值 0为120
pri: priority 优先级  把系统优先级倒着排  139 &lt;-- 0 其中139对应优系统先级139-139=0
rtprio: 实时优先级
psr: processor CPU编号 
</pre>

<p>
示例:
</p>

<pre class="example" id="org1512c89">
ps axo pid,cmd,psr,ni,pri,rtprio
</pre>

<p>
<b>常用组合</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">ps aux      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#25152;&#26377;&#19982;&#32456;&#31471;&#26377;&#26080;&#20851;&#32852;&#30340;&#36827;&#31243;&#20449;&#24687;&#65292;&#19968;&#29992;&#25143;&#20026;&#20013;&#24515;&#32452;&#32455;&#29366;&#24577;&#20449;&#24687;&#26174;&#31034;</span>
ps -ef
ps auxf     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#36827;&#31243;&#30340;&#29238;&#23376;&#20851;&#31995;</span>
ps -eFH    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26641;&#29366;&#23618;&#32423;&#32467;&#26500;&#26174;&#31034;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#36827;&#31243;&#30340;&#29305;&#23450;&#23646;&#24615;</span>
ps -eo pid,tid,class,rtprio,ni,pri,psr,pcpu,stat,comm
ps  axo stat,euid,ruid,tty,tpgid,sess,pgrp,ppid,pid,pcpu,comn

&#24120;&#29992;&#30340;field&#65306;pid,ni,pri,psr,user,pcpu,pmem,stat,comm,tty,ppid,rtprio
ni                  <span style="color: #b22222;">#</span><span style="color: #b22222;">nice&#20540;  0&#20026;120&#65307;</span>
pri                 <span style="color: #b22222;">#</span><span style="color: #b22222;">priorty ,&#20248;&#20808;&#32423;&#65307;&#25226;&#31995;&#32479;&#20248;&#20808;&#32423;&#20498;&#30528;&#25490;  139 &lt;-- 0</span>
rtprio           <span style="color: #b22222;">#</span><span style="color: #b22222;">real time priority,&#23454;&#26102;&#20248;&#20808;&#32423;&#65307; </span>
psr               <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36816;&#36716;&#37027;&#20010;cpu&#19978;</span>
pcpu            <span style="color: #b22222;">#</span><span style="color: #b22222;">cpu&#21033;&#29992;&#29575;</span>
pmem         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20869;&#23384;&#21344;&#29992;&#29575;</span>
user             <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36827;&#31243;&#29992;&#25143;</span>
euser          <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#25928;&#29992;&#25143;</span>
ruser           <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23454;&#38469;&#29992;&#25143;  suid</span>
args             <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#21629;&#20196;&#21644;&#21442;&#25968;</span>
comm         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31243;&#24207;&#21517;</span>
cmd            <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21629;&#20196;</span>
stat             <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29366;&#24577;</span>
tty               <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32456;&#31471;</span>
ppip           <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29238;&#36827;&#31243;&#21495;</span>
lstart          <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20986;&#36827;&#31243;&#21551;&#21160;&#26102;&#21051;</span>
etime         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36827;&#31243;&#36317;&#31163;&#20170;&#22825;&#21551;&#21160;&#22825;&#25968;</span>

ps -eo pid,lstart,etime
ps axo pid,cmd,%mem,%cpu
</pre>
</div>

<p>
范例：针对属性 <b>排序</b> ，CentOS6 以下版本不支持
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#25353;CPU&#21033;&#29992;&#29575;&#20498;&#24207;&#25490;&#24207;</span>
[root@centos8 ~]#ps aux k -%cpu
[root@centos8 ~]#ps axo pid,cmd,%cpu,%mem k -%cpu

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25353;&#20869;&#23384;&#20498;&#24207;&#25490;&#24207;</span>
[root@centos8 ~]#ps axo pid,cmd,%cpu,%mem --sort=-%mem
</pre>
</div>

<p>
范例:有效用户和实际用户
</p>

<div class="org-src-container">
<pre class="src src-sh">[cici@centos8 ~]$<span style="color: #a0522d;">passwd</span>
Changing password for user cici.
Current password:
[root@centos8 ~]#ps axo pid,cmd,%cpu,%mem,user,euser,ruser | grep passwd
 1965 passwd                       0.0  1.0 root     root     cici
 1970 grep --color=auto passwd     0.0  0.1 root     root     root 

euser &#26377;&#25928;&#29992;&#25143;
ruser &#23454;&#38469;&#29992;&#25143;  suid
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#35810;&#20320;&#25317;&#26377;&#30340;&#25152;&#26377;&#36827;&#31243;</span>
ps -x
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#25351;&#23450;&#29992;&#25143;&#21517;(RUID)&#25110;&#29992;&#25143;ID&#30340;&#36827;&#31243;</span>
ps -fU apache
ps -fU 48
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#25351;&#23450;&#29992;&#25143;&#21517;(EUID)&#25110;&#29992;&#25143;ID&#30340;&#36827;&#31243;</span>
ps -fu cici
ps -fu 1000
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#20197;root&#29992;&#25143;&#26435;&#38480;&#65288;&#23454;&#38469;&#21644;&#26377;&#25928;ID&#65289;&#36816;&#34892;&#30340;&#27599;&#20010;&#36827;&#31243;</span>
ps -U root -u root
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#20986;&#26576;&#20010;&#32452;&#25317;&#26377;&#30340;&#25152;&#26377;&#36827;&#31243;&#65288;&#23454;&#38469;&#32452;ID&#65306;RGID&#25110;&#21517;&#31216;&#65289;</span>
ps -fG nginx

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#20986;&#26377;&#25928;&#32452;&#21517;&#31216;&#65288;&#25110;&#20250;&#35805;&#65289;&#25152;&#25317;&#26377;&#30340;&#25152;&#26377;&#36827;&#31243;</span>
ps -fg mysql
ps -fg 27

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#25351;&#23450;&#30340;&#36827;&#31243;ID&#23545;&#24212;&#30340;&#36827;&#31243;</span>
ps -fp 1234

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;&#29238;&#36827;&#31243;ID&#26469;&#26174;&#31034;&#20854;&#19979;&#25152;&#26377;&#30340;&#36827;&#31243;&#65292;&#22914;&#26174;&#31034;&#29238;&#36827;&#31243;&#20026;1234&#30340;&#25152;&#26377;&#36827;&#31243;</span>
ps -f --ppid 1234

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#25351;&#23450;PID&#30340;&#22810;&#20010;&#36827;&#31243;</span>
ps -fp 1204,1239,1263

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35201;&#25353;tty&#26174;&#31034;&#25152;&#23646;&#36827;&#31243;</span>
ps -ft pts/0

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;&#36827;&#31243;&#26641;&#26174;&#31034;&#31995;&#32479;&#20013;&#30340;&#36827;&#31243;&#22914;&#20309;&#30456;&#20114;&#38142;&#25509;</span>
ps -e --forest  <span style="color: #b22222;"># </span><span style="color: #b22222;">--forest &#31867;&#20284;&#20110;-H&#65292;&#27604;-H&#26356;&#26131;&#35835;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;&#36827;&#31243;&#26641;&#26174;&#31034;&#25351;&#23450;&#30340;&#36827;&#31243;</span>
ps -f --forest -C sshd
ps -ef --forest | grep -v grep | grep sshd

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35201;&#26174;&#31034;&#19968;&#20010;&#36827;&#31243;&#30340;&#25152;&#26377;&#32447;&#31243;,&#23558;&#26174;&#31034;LWP&#65288;&#36731;&#37327;&#32423;&#36827;&#31243;&#65289;&#20197;&#21450;NLWP&#65288;&#36731;&#37327;&#32423;&#36827;&#31243;&#25968;&#65289;&#21015;</span>
ps -fL -C nginx

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35201;&#21015;&#20986;&#25152;&#26377;&#26684;&#24335;&#35828;&#26126;&#31526;</span>
ps L

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#36827;&#31243;&#30340;PID&#65292;PPID&#65292;&#29992;&#25143;&#21517;&#21644;&#21629;&#20196;</span>
ps -eo pid,ppid,user,cmd

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#33258;&#23450;&#20041;&#26684;&#24335;&#26174;&#31034;&#25991;&#20214;&#31995;&#32479;&#32452;,ni&#20540;&#24320;&#22987;&#26102;&#38388;&#21644;&#36827;&#31243;&#30340;&#26102;&#38388;</span>
ps -p 1234 -o pid,ppid,fgroup,ni,lstart,etime

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;&#20854;PID&#26597;&#25214;&#36827;&#31243;&#21517;&#31216;&#65306;</span>
ps -p 1244 -o <span style="color: #a0522d;">comm</span>=  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21152;=&#31561;&#21495;&#21518;&#65292;&#23558;&#19981;&#26174;&#31034;&#39030;&#37096;&#33756;&#21333;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35201;&#20197;&#20854;&#21517;&#31216;&#36873;&#25321;&#29305;&#23450;&#36827;&#31243;&#65292;&#26174;&#31034;&#20854;&#25152;&#26377;&#23376;&#36827;&#31243;</span>
ps -C sshd,bash

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#25214;&#25351;&#23450;&#36827;&#31243;&#21517;&#25152;&#26377;&#30340;&#25152;&#23646;PID&#65292;&#22312;&#32534;&#20889;&#38656;&#35201;&#20174;std&#36755;&#20986;&#25110;&#25991;&#20214;&#35835;&#21462;PID&#30340;&#33050;&#26412;&#26102;&#36825;&#20010;&#21442;&#25968;&#24456;&#26377;&#29992;</span>
ps -C httpd,sshd -o <span style="color: #a0522d;">pid</span>=

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26816;&#26597;&#19968;&#20010;&#36827;&#31243;&#30340;&#21551;&#21160;&#26102;&#38388;&#21644;&#25191;&#34892;&#26102;&#38388;</span>
ps -eo comm,etime,user | grep nginx

[root@centos7 ~] eth0 = 10.0.1.86
<span style="color: #b22222;"># </span><span style="color: #b22222;">ps -o comm,lstart,etime,user -C nginx</span>
COMMAND                          STARTED     ELAPSED USER
nginx           Wed Jan  6 23:48:52 2021 35-09:30:18 root
nginx           Wed Jan  6 23:48:52 2021 35-09:30:18 nginx
nginx           Wed Jan  6 23:48:52 2021 35-09:30:18 nginx
[root@centos7 ~] eth0 = 10.0.1.86
<span style="color: #b22222;"># </span><span style="color: #b22222;">ps -eo comm,lstart,etime,user |grep nginx</span>
nginx           Wed Jan  6 23:48:52 2021 35-09:30:27 root
nginx           Wed Jan  6 23:48:52 2021 35-09:30:27 nginx
nginx           Wed Jan  6 23:48:52 2021 35-09:30:27 nginx

35-09:30:18&#65306;35&#22825;9&#23567;&#26102;30&#20998;&#38047;18&#31186;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25490;&#24207;&#65292;&#26597;&#25214;&#21344;&#29992;&#26368;&#22810;&#20869;&#23384;&#21644;CPU&#30340;&#36827;&#31243;</span>
ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%mem | head
ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%cpu | head

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#23433;&#20840;&#20449;&#24687;</span>
ps -eM
ps --context

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;&#20197;&#19979;&#21629;&#20196;&#20197;&#29992;&#25143;&#23450;&#20041;&#30340;&#26684;&#24335;&#26174;&#31034;&#23433;&#20840;&#20449;&#24687;</span>
ps -eo euser,ruser,suser,fuser,f,comm,label

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;watch&#23454;&#29992;&#31243;&#24207;&#25191;&#34892;&#37325;&#22797;&#30340;&#36755;&#20986;&#20197;&#23454;&#29616;&#23545;&#23601;&#31243;&#36827;&#34892;&#23454;&#26102;&#30340;&#30417;&#35270;&#65292;&#22914;&#19979;&#38754;&#30340;&#21629;&#20196;&#26174;&#31034;&#27599;&#31186;&#38047;&#30340;&#30417;&#35270;</span>
watch -n 1 <span style="color: #8b2252;">'ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%mem | head'</span>
</pre>
</div>

<p>
面试题：找到未知进程的执行程序文件路径
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#ls -l /proc/1272/exe
lrwxrwxrwx 1 root root 0 Jan     4 15:47 /proc/1272/exe -&gt; /usr/bin/bash
</pre>
</div>

<p>
范例:查看优先级和CPU绑定关系
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#ps axo pid,cmd,ni,pri,psr,rtprio |grep migration
   11 [migration/0]                 - 139   0     99
   16 [migration/1]                 - 139   1     99
 2246 grep --color=auto migration   0  19   0      -
[root@centos8 ~]#

[root@centos8 ~]#ps axo pid,cmd,ni,pri,psr |grep dd
    2 [kthreadd]                    0  19   1
  138 [ipv6_addrconf]             -20  39   0
 2153 dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/dev/nul  19   0   0
 2228 grep --color=auto dd          0  19   1
[root@centos8 ~]#
</pre>
</div>

<p>
范例;实现进程和CPU的绑定
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#taskset --help
Usage: taskset [options] [mask | cpu-list] [pid|cmd [args...]]
</pre>
</div>
</div>
<div id="outline-container-h:6c3cd49e-cf55-4d47-8459-f58332736a9d" class="outline-5">
<h5 id="h:6c3cd49e-cf55-4d47-8459-f58332736a9d">watch实时监控变化</h5>
<div class="outline-text-5" id="text-h:6c3cd49e-cf55-4d47-8459-f58332736a9d">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;watch&#23454;&#29992;&#31243;&#24207;&#25191;&#34892;&#37325;&#22797;&#30340;&#36755;&#20986;&#20197;&#23454;&#29616;&#23545;&#23601;&#31243;&#36827;&#34892;&#23454;&#26102;&#30340;&#30417;&#35270;&#65292;&#22914;&#19979;&#38754;&#30340;&#21629;&#20196;&#26174;&#31034;&#27599;&#31186;&#38047;&#30340;&#30417;&#35270;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36873;&#39033;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">-d &#21442;&#25968;&#34920;&#31034;&#39640;&#20142;&#26174;&#31034;&#21464;&#21270;&#30340;&#21306;&#22495;</span>

watch -n 1 <span style="color: #8b2252;">'ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%mem | head'</span>
watch -d uptime
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:3e14aeb7-c449-4675-a824-e562aa1493a9" class="outline-4">
<h4 id="h:3e14aeb7-c449-4675-a824-e562aa1493a9">prtstat查看进程信息</h4>
<div class="outline-text-4" id="text-h:3e14aeb7-c449-4675-a824-e562aa1493a9">
<p>
可以显示进程信息,来自于psmisc包
</p>

<p>
格式:
</p>
<div class="org-src-container">
<pre class="src src-sh">prtstat [options] PID ...

-r raw     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26684;&#24335;&#26174;&#31034;</span>
</pre>
</div>



<p>
范例:
</p>
<div class="org-src-container">
<pre class="src src-sh">prtstat 18395
prtstat <span style="color: #ff00ff;">`pidof sshd`</span>
[root@centos8 ~]#prtstat -r 18395
</pre>
</div>
</div>
</div>
<div id="outline-container-h:2b8f9814-68e8-4ce0-81a6-b9df3f9a808b" class="outline-4">
<h4 id="h:2b8f9814-68e8-4ce0-81a6-b9df3f9a808b">nice/renice设置和调整进程优先级</h4>
<div class="outline-text-4" id="text-h:2b8f9814-68e8-4ce0-81a6-b9df3f9a808b">
<p>
进程优先级调整
</p>

<ul class="org-ul">
<li>静态优先级:100-139</li>
<li>进程默认启动时的nice值为0,优先级为120</li>
<li>只有根用户才能降低nice值</li>
</ul>

<p>
nice命令
</p>

<p>
以指定的优先级来启动进程
</p>

<pre class="example" id="org09a2feb">
nice [OPTION] [COMMAND [ARG]...]
-n, --adjustment=N   add integer N to the niceness (default 10) 
</pre>

<p>
renice命令
可以调整正在执行中的进程的优先级
</p>

<pre class="example" id="orgd654ffd">
renice [-n] priority pid...
</pre>

<p>
查看
</p>

<pre class="example" id="org06c1a47">
ps axo pid,cmd,ni
</pre>

<p>
范例: 修改优先级
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#nice -n -10 ping 127.0.0.1
[root@centos8 ~]#ps axo pid,cmd,nice |grep ping
 2118 ping 127.0.0.1              -10
 2120 grep --color=auto ping        0

[root@centos8 ~]#renice -n -20 2118
<span style="color: #0000ff;">2106</span> (process ID) old priority -10, new priority -20
[root@centos8 ~]#ps axo pid,cmd,nice |grep ping
 2118 ping 127.0.0.1              -20
 2200 grep --color=auto ping        0 
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b5aeab48-3b30-4cc5-830a-59cc39d0d75b" class="outline-4">
<h4 id="h:b5aeab48-3b30-4cc5-830a-59cc39d0d75b">搜索进程</h4>
<div class="outline-text-4" id="text-h:b5aeab48-3b30-4cc5-830a-59cc39d0d75b">
<p>
按条件搜索进程
</p>

<ul class="org-ul">
<li>ps 选项 | grep 'pattern' 灵活</li>
<li>pgrep 按预定义的模式</li>
<li>/sbin/pidof 按确认的程序名称查看pid</li>
</ul>
</div>
<div id="outline-container-h:39fb0328-b807-476a-9455-203d1b6b50b3" class="outline-5">
<h5 id="h:39fb0328-b807-476a-9455-203d1b6b50b3">pgrep</h5>
<div class="outline-text-5" id="text-h:39fb0328-b807-476a-9455-203d1b6b50b3">
<p>
命令格式
</p>
<div class="org-src-container">
<pre class="src src-sh">pgrep [options] pattern

&#24120;&#29992;&#36873;&#39033;:
-u uid: effective user&#65292;&#29983;&#25928;&#32773;
-U uid: real user&#65292;&#30495;&#27491;&#21457;&#36215;&#36816;&#34892;&#21629;&#20196;&#32773;
-t terminal: &#19982;&#25351;&#23450;&#32456;&#31471;&#30456;&#20851;&#30340;&#36827;&#31243;
-l: &#26174;&#31034;&#36827;&#31243;&#21517;
-a: &#26174;&#31034;&#23436;&#25972;&#26684;&#24335;&#30340;&#36827;&#31243;&#21517;
-P pid: &#26174;&#31034;&#25351;&#23450;&#36827;&#31243;&#30340;&#23376;&#36827;&#31243;
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#pgrep -u cici
2303
2330
[root@centos8 ~]#pgrep -lu cici
2303 bash
2330 dd
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#38169;&#35823;&#20889;&#27861;</span>
[root@centos8 ~]#pgrep -ul cici
pgrep: invalid user name: l
[root@centos8 ~]#pgrep -au cici
2303 -bash
2330 dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/dev/null
[root@centos8 ~]#pgrep -aP 2303
2330 dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/dev/null
[root@centos8 ~]#pgrep -at pts/2
1482 -bash
2302 su - cici
2303 -bash
2330 dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/dev/null
</pre>
</div>
</div>
</div>
<div id="outline-container-h:e6d706cc-8561-469f-99b6-fe4b1e011f46" class="outline-5">
<h5 id="h:e6d706cc-8561-469f-99b6-fe4b1e011f46">pidof</h5>
<div class="outline-text-5" id="text-h:e6d706cc-8561-469f-99b6-fe4b1e011f46">
<p>
显示程序进程号
</p>

<p>
命令格式
</p>
<div class="org-src-container">
<pre class="src src-sh">pidof [options] [program [...]]

&#24120;&#29992;&#36873;&#39033;:
-x    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25353;&#33050;&#26412;&#21517;&#31216;&#26597;&#25214;pid</span>
</pre>
</div>

<p>
范例:
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#pidof bash
19035 18813 18789 1251
[root@centos8 ~]#pidof ping.sh
[root@centos8 ~]#pidof -x ping.sh
19035
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:39f4481d-a9ef-42e6-9cd7-32c9974056a8" class="outline-4">
<h4 id="h:39f4481d-a9ef-42e6-9cd7-32c9974056a8">lsof查看进程打开文件</h4>
<div class="outline-text-4" id="text-h:39f4481d-a9ef-42e6-9cd7-32c9974056a8">
<p>
lsof:list open files,查看当前系统文件的工具.在linux环境下，一切皆文件，
用户通过文件不仅可以访问常规数据，还可以访问网络连接和硬件如传输控制协
议(TCP) 和用户数据报协议(UDP)套接字等，系统在后台都为该应用程序分配了
一个文件描述符
</p>

<p>
命令选项:
</p>

<pre class="example" id="org908e419">
-a：列出打开文件存在的进程
-c&lt;进程名&gt;：列出指定进程所打开的文件
-g：列出GID号进程详情
-d&lt;文件号&gt;：列出占用该文件号的进程
+d&lt;目录&gt;：列出目录下被打开的文件
+D&lt;目录&gt;：递归列出目录下被打开的文件
-n&lt;目录&gt;：列出使用NFS的文件
-i&lt;条件&gt;：列出符合条件的进程(4、6、协议、:端口、 @ip )
-p&lt;进程号&gt;：列出指定进程号所打开的文件
-u：列出UID号进程详情
-h：显示帮助信息
-v：显示版本信息。
-n: 不反向解析网络名字           
</pre>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#30001;&#30331;&#38470;&#29992;&#25143;&#21551;&#21160;&#32780;&#38750;&#31995;&#32479;&#21551;&#21160;&#30340;&#36827;&#31243;</span>
lsof /dev/pts/1

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450;&#36827;&#31243;&#21495;&#65292;&#21487;&#20197;&#26597;&#30475;&#35813;&#36827;&#31243;&#25171;&#24320;&#30340;&#25991;&#20214;</span>
lsof -p 9527

[root@centos8 ~]#lsof -p <span style="color: #ff00ff;">`pidof bc`</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#25351;&#23450;&#31243;&#24207;&#25171;&#24320;&#30340;&#25991;&#20214;</span>
lsof -c httpd
[root@centos8 ~]#lsof -c bc

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#25351;&#23450;&#29992;&#25143;&#25171;&#24320;&#30340;&#25991;&#20214;</span>
lsof -u root | more

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#25351;&#23450;&#30446;&#24405;&#19979;&#34987;&#25171;&#24320;&#30340;&#25991;&#20214;&#65292;&#21442;&#25968;+D&#20026;&#36882;&#24402;&#21015;&#20986;&#30446;&#24405;&#19979;&#34987;&#25171;&#24320;&#30340;&#25991;&#20214;&#65292;&#21442;&#25968;+d&#20026;&#21015;&#20986;&#30446;&#24405;&#19979;&#34987;&#25171;&#24320;&#30340;&#25991;&#20214;</span>
lsof +D /var/log/
lsof +d /var/log/  

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#25152;&#26377;&#32593;&#32476;&#36830;&#25509;&#65292;&#36890;&#36807;&#21442;&#25968;-i&#26597;&#30475;&#32593;&#32476;&#36830;&#25509;&#30340;&#24773;&#20917;&#65292;&#21253;&#25324;&#36830;&#25509;&#30340;ip&#12289;&#31471;&#21475;&#31561;&#20197;&#21450;&#19968;&#20123;&#26381;&#21153;&#30340;&#36830;&#25509;&#24773;&#20917;&#65292;&#20363;</span>
&#22914;&#65306;sshd&#31561;&#12290;&#20063;&#21487;&#20197;&#36890;&#36807;&#25351;&#23450;ip&#26597;&#30475;&#35813;ip&#30340;&#32593;&#32476;&#36830;&#25509;&#24773;&#20917;
lsof -i &#8211;n      
lsof -i@127.0.0.1
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#31471;&#21475;&#36830;&#25509;&#24773;&#20917;&#65292;&#36890;&#36807;&#21442;&#25968;-i:&#31471;&#21475;&#21487;&#20197;&#26597;&#30475;&#31471;&#21475;&#30340;&#21344;&#29992;&#24773;&#20917;&#65292;-i&#21442;&#25968;&#36824;&#26377;&#26597;&#30475;&#21327;&#35758;&#65292;ip&#30340;&#36830;&#25509;&#24773;&#20917;&#31561;</span>
lsof -i :80 -n

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#25351;&#23450;&#36827;&#31243;&#25171;&#24320;&#30340;&#32593;&#32476;&#36830;&#25509;&#65292;&#21442;&#25968;-i&#12289;-a&#12289;-p&#31561;&#65292;-i&#26597;&#30475;&#32593;&#32476;&#36830;&#25509;&#24773;&#20917;&#65292;-a&#26597;&#30475;&#23384;&#22312;&#30340;&#36827;&#31243;&#65292;-p&#25351;&#23450;&#36827;&#31243;</span>
lsof -i &#8211;n -a -p 9527

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#25351;&#23450;&#29366;&#24577;&#30340;&#32593;&#32476;&#36830;&#25509;&#65292;-n:no host names, -P:no port names,-i TCP&#25351;&#23450;&#21327;&#35758;&#65292;-s&#25351;&#23450;&#21327;&#35758;</span>
&#29366;&#24577;&#36890;&#36807;&#22810;&#20010;&#21442;&#25968;&#21487;&#20197;&#28165;&#26224;&#30340;&#26597;&#30475;&#32593;&#32476;&#36830;&#25509;&#24773;&#20917;&#12289;&#21327;&#35758;&#36830;&#25509;&#24773;&#20917;&#31561;
lsof -n -P -i TCP -s TCP:ESTABLISHED  
</pre>
</div>

<p>
范例: 利用lsof恢复正在使用中的误删除的文件
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20445;&#35777;&#25991;&#20214;&#19968;&#30452;&#34987;&#25171;&#24320;</span>
tail -f /var/log/messages

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500;&#25991;&#20214;</span>
lsof |grep /var/log/messages
rm -f /var/log/messages

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#24674;&#22797;&#25991;&#20214;</span>
lsof |grep delete <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25214;&#21040;/var/log/messages&#30340;&#36827;&#31243;</span>
cat /proc/653/fd/6
cat /proc/653/fd/6 &gt; /var/log/messages 
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:a7dd34ec-779f-4067-b78c-86ce4bcb8676" class="outline-3">
<h3 id="h:a7dd34ec-779f-4067-b78c-86ce4bcb8676">CPU</h3>
<div class="outline-text-3" id="text-h:a7dd34ec-779f-4067-b78c-86ce4bcb8676">
</div>
<div id="outline-container-h:5f1fcdfc-1002-4274-8c26-23ee720b0ccc" class="outline-4">
<h4 id="h:5f1fcdfc-1002-4274-8c26-23ee720b0ccc">uptime负载查询</h4>
<div class="outline-text-4" id="text-h:5f1fcdfc-1002-4274-8c26-23ee720b0ccc">
<p>
/proc/uptime包括两个值,单位s
</p>

<ul class="org-ul">
<li>系统启动时长</li>
<li>空闲进程的总时长(按总的CPU核数计算)</li>
</ul>

<p>
uptime和w显示以下内容
</p>

<ul class="org-ul">
<li>当前时间</li>
<li>系统已启动的时间</li>
<li>当前上线人数</li>
<li>系统平均负载(1,5,15分钟的平均负载,一般不会超过1,超过5时建议警报)</li>
</ul>

<p>
范例:
</p>
<div class="org-src-container">
<pre class="src src-shell">[root@centos8 ~]#uptime
09:38:34 up 1 day,  1:04,  2 users, load average: 0.00, 0.00, 0.00
&#24403;&#21069;&#26102;&#38388;;  &#31995;&#32479;&#24050;&#21551;&#21160;&#30340;&#26102;&#38388;;  &#24403;&#21069;&#19978;&#32447;&#20154;&#25968;;  &#31995;&#32479;&#24179;&#22343;&#36127;&#36733;(1,5,15&#20998;&#38047;&#30340;&#24179;&#22343;&#36127;&#36733;,&#19968;&#33324;&#19981;&#20250;&#36229;&#36807;1,&#36229;&#36807;5&#26102;&#24314;&#35758;&#35686;&#25253;)

[root@centos8 ~]#w
09:38:29 up 1 day,  1:04,  2 users, load average: 0.00, 0.00, 0.00
USER     TTY     FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
root     pts/0    10.0.0.1         Wed08    0.00s  0.32s  0.00s w
root     pts/1    10.0.0.1         09:10    5:25   0.06s  0.00s /bin/bash
./ping.sh 
</pre>
</div>

<p>
平均负载是指单位时间内，系统处于 <b>可运行状态</b> 和 <b>不可中断状态</b> 的平均
进程数，也就是 <b>平均活跃进程数</b> ，它和CPU使用率并没有直接关系。它不仅
包括了 <b>正在使用CPU</b> 的进程，还包括 <b>等待 CPU</b> 和 <b>等待 I/O</b> 的进程。
</p>

<p>
所谓可运行状态的进程，是指正在使用CPU或者正在等待CPU的进程，也就是我们
常用ps命令看到的，处于R状态（Running或 Runnable）的进程。
</p>

<p>
不可中断状态的进程则是正处于内核态关键流程中的进程，并且这些流程是不可
打断的，比如最常见的是等待硬件设备的I/O响应，也就是我们在ps命令中看到
的D状态（Uninterruptible Sleep，也称为Disk Sleep）的进程。
</p>

<p>
平均活跃进程数，直观上的理解就是单位时间内的活跃进程数，但它实际上是活
跃进程数的指数衰减平均值。
</p>

<p>
既然平均的是活跃进程数，那么最理想的，就是每个CPU上都刚好运行着一个进
程，这样每个CPU都得到了充分利用。
</p>

<p>
首先要知道系统有几个CPU(核数)
</p>
<div class="org-src-container">
<pre class="src src-sh">grep <span style="color: #8b2252;">'model name'</span> /proc/cpuinfo | wc -l
</pre>
</div>

<p>
当发现负载高的时候，你可以使用 mpstat、pidstat 等工具
</p>

<p>
如:Linux主机是个1核CPU,当Load Average为6的时候说明机器已经被充分使用
</p>
</div>
</div>
<div id="outline-container-h:24a4ad7f-1403-465e-9dad-f5cdda77ad26" class="outline-4">
<h4 id="h:24a4ad7f-1403-465e-9dad-f5cdda77ad26">mpstat多核CPU性能分析</h4>
<div class="outline-text-4" id="text-h:24a4ad7f-1403-465e-9dad-f5cdda77ad26">
<p>
来自于sysstat包
</p>

<p>
mpstat 是一个常用的多核 CPU 性能分析工具，用来实时查看每个 CPU
的性能指标，以及所有CPU的平均指标。
</p>

<div class="org-src-container">
<pre class="src src-sh">mpstat -P ALL 5  -P ALL &#34920;&#31034;&#30417;&#25511;&#25152;&#26377;CPU&#65292;&#21518;&#38754;&#25968;&#23383;5&#34920;&#31034;&#38388;&#38548;5&#31186;&#21518;&#36755;&#20986;&#19968;&#32452;&#25968;&#25454;
</pre>
</div>

<p>
范例:
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#yum install -y sysstat
[root@centos8 ~]#mpstat
[root@centos8 ~]#mpstat 1 3

$ mpstat -P ALL 5
Linux 4.15.0 (ubuntu) 09/22/18 _x86_64_ (2 CPU)
13:30:06     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
13:30:11     all   50.05    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   49.95

CPU        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22788;&#29702;&#22120;&#32534;&#21495;&#12290;all&#34920;&#26126;&#32479;&#35745;&#25968;&#25454;&#20026;&#25152;&#26377;&#22788;&#29702;&#22120;&#20043;&#38388;&#35745;&#31639;&#30340;&#24179;&#22343;&#20540;&#12290;</span>
%usr       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#22312;&#29992;&#25143;&#32423;&#21035;&#65288;&#24212;&#29992;&#31243;&#24207;&#65289;&#25191;&#34892;&#26102;&#21457;&#29983;&#30340;CPU&#20351;&#29992;&#29575;&#30334;&#20998;&#27604;&#12290;</span>
%nice     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#22312;&#29992;&#25143;&#32423;&#21035;&#20351;&#29992;nice&#20248;&#20808;&#32423;&#25191;&#34892;&#26102;&#21457;&#29983;&#30340;CPU&#20351;&#29992;&#29575;&#30334;&#20998;&#27604;&#12290;</span>
%sys       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#22312;&#31995;&#32479;&#32423;&#21035;&#65288;&#20869;&#26680;&#65289;&#25191;&#34892;&#26102;&#21457;&#29983;&#30340;CPU&#20351;&#29992;&#29575;&#30334;&#20998;&#27604;&#12290;&#27880;&#24847;&#65292;&#36825;&#27809;&#26377;&#21253;&#25324;&#20026;&#30828;&#20214;&#21644;&#36719;&#20214;&#20013;&#26029;&#26381;&#21153;&#25152;&#33457;&#36153;&#30340;&#26102;&#38388;&#12290;</span>
%iowait   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#22312;&#31995;&#32479;&#26410;&#23436;&#25104;&#30913;&#30424;I/O&#35831;&#27714;&#26399;&#38388;&#65292;&#19968;&#20010;CPU&#25110;&#22810;&#20010;CPU&#31354;&#38386;&#26102;&#38388;&#30340;&#30334;&#20998;&#27604;&#12290;</span>
%irq        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#19968;&#20010;CPU&#25110;&#22810;&#20010;CPU&#26381;&#21153;&#30828;&#20214;&#20013;&#26029;&#33457;&#36153;&#26102;&#38388;&#30340;&#30334;&#20998;&#27604;&#12290;</span>
%soft      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#19968;&#20010;CPU&#25110;&#22810;&#20010;CPU&#26381;&#21153;&#36719;&#20214;&#20013;&#26029;&#33457;&#36153;&#26102;&#38388;&#30340;&#30334;&#20998;&#27604;&#12290;</span>
%steal     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31649;&#29702;&#31243;&#24207;(hypervisor)&#20026;&#21478;&#19968;&#20010;&#34394;&#25311;&#36827;&#31243;&#25552;&#20379;&#26381;&#21153;&#32780;&#31561;&#24453;&#34394;&#25311; CPU &#30340;&#30334;&#20998;&#27604;&#12290;</span>
%guest    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#19968;&#20010;CPU&#25110;&#22810;&#20010;CPU&#36816;&#34892;&#19968;&#20010;&#34394;&#25311;&#22788;&#29702;&#22120;&#25152;&#33457;&#36153;&#26102;&#38388;&#30340;&#30334;&#20998;&#27604;&#65288;Red Hat Enterprise Linux 6&#65289;&#12290;</span>
%gnice    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#19968;&#20010;CPU&#25110;&#22810;&#20010;CPU&#36816;&#34892;&#19968;&#20010;nice&#30340;&#34394;&#25311;&#26426;&#25152;&#33457;&#36153;&#26102;&#38388;&#30340;&#30334;&#20998;&#27604;&#65288;Red Hat Enterprise Linux 7&#65289;&#12290;</span>
%idle       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#19968;&#20010;CPU&#25110;&#22810;&#20010;CPU&#31354;&#38386;&#26102;&#38388;&#30340;&#30334;&#20998;&#27604;&#65292;&#24182;&#19988;&#31995;&#32479;&#27809;&#26377;&#26410;&#23436;&#25104;&#30340;&#30913;&#30424;I/O&#35831;&#27714;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#23545;&#20110;&#19968;&#20010;&#22810;&#22788;&#29702;&#22120;&#26381;&#21153;&#22120;&#19978;&#30340;CPU0&#65292;&#38388;&#38548;1&#31186;&#38047;&#26174;&#31034;2&#27425;&#32479;&#35745;&#20449;&#24687;&#26465;&#30446;&#65292;&#20351;&#29992;&#21629;&#20196;</span>
mpstat -P 0 1 2
</pre>
</div>
</div>
</div>
<div id="outline-container-h:e36530d8-f550-4914-b11a-37c2d30b1862" class="outline-4">
<h4 id="h:e36530d8-f550-4914-b11a-37c2d30b1862">pidstat进程性能分析</h4>
<div class="outline-text-4" id="text-h:e36530d8-f550-4914-b11a-37c2d30b1862">
<p>
pidstat 是一个常用的进程性能分析工具，用来实时查看进程的 CPU、内存、
I/O以及上下文切换等性能指标。
</p>

<div class="org-src-container">
<pre class="src src-sh">-w &#26597;&#30475;&#27599;&#20010;&#36827;&#31243;&#19978;&#19979;&#25991;&#20999;&#25442;&#30340;&#24773;&#20917;
-u &#21442;&#25968;&#21017;&#34920;&#31034;&#36755;&#20986; CPU &#20351;&#29992;&#25351;&#26631;
-wt &#21442;&#25968;&#34920;&#31034;&#36755;&#20986;&#32447;&#31243;&#30340;&#19978;&#19979;&#25991;&#20999;&#25442;&#25351;&#26631;
</pre>
</div>

<p>
-u 输出 CPU 使用指标
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#38388;&#38548;5&#31186;&#21518;&#36755;&#20986;&#19968;&#32452;&#25968;&#25454;</span>
$ pidstat -u 5 1
13:37:07      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command
13:37:12        0      2962  100.00    0.00    0.00    0.00  100.00     1  stress
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">&#29992;&#25143;&#24577; CPU &#20351;&#29992;&#29575; &#65288;%usr&#65289;&#65307;
&#20869;&#26680;&#24577; CPU &#20351;&#29992;&#29575;&#65288;%system&#65289;&#65307;
&#36816;&#34892;&#34394;&#25311;&#26426; CPU &#20351;&#29992;&#29575;&#65288;%guest&#65289;&#65307;
&#31561;&#24453; CPU &#20351;&#29992;&#29575;&#65288;%wait&#65289;&#65307;
&#20197;&#21450;&#24635;&#30340; CPU &#20351;&#29992;&#29575;&#65288;%CPU&#65289;&#12290;
</pre>
</div>

<p>
-w  查看每个进程上下文切换的情况
</p>
<div class="org-src-container">
<pre class="src src-sh">Linux 4.19.91-27.1.al7.x86_64 (iZt4n78a9pmn4txteww3sjZ)         06/24/2025      _x86_64_        (8 CPU)

10:32:39 AM   UID       PID   cswch/s nvcswch/s  Command
10:32:44 AM     0         1      1.20      0.00  systemd
10:32:44 AM     0         9      5.58      0.00  ksoftirqd/0
10:32:44 AM     0        10    263.55      0.00  rcu_sched
10:32:44 AM     0        12      1.20      0.00  migration/0
10:32:44 AM     0        15      0.80      0.00  migration/1
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">cswch/s    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#34920;&#31034;&#27599;&#31186;&#33258;&#24895;&#19978;&#19979;&#25991;&#20999;&#25442;&#65288;voluntary context switches&#65289;&#30340;&#27425;&#25968;</span>
nvcswch/s  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#34920;&#31034;&#27599;&#31186;&#38750;&#33258;&#24895;&#19978;&#19979;&#25991;&#20999;&#25442;&#65288;non voluntary context switches&#65289;&#30340;&#27425;&#25968;</span>

&#33258;&#24895;&#19978;&#19979;&#25991;&#20999;&#25442;&#65292;&#26159;&#25351;&#36827;&#31243;&#26080;&#27861;&#33719;&#21462;&#25152;&#38656;&#36164;&#28304;&#65292;&#23548;&#33268;&#30340;&#19978;&#19979;&#25991;&#20999;&#25442;&#12290;&#27604;&#22914;&#35828;&#65292; I/O&#12289;&#20869;&#23384;&#31561;&#31995;&#32479;&#36164;&#28304;&#19981;&#36275;&#26102;&#65292;&#23601;&#20250;&#21457;&#29983;&#33258;&#24895;&#19978;&#19979;&#25991;&#20999;&#25442;&#12290;
&#38750;&#33258;&#24895;&#19978;&#19979;&#25991;&#20999;&#25442;&#65292;&#21017;&#26159;&#25351;&#36827;&#31243;&#30001;&#20110;&#26102;&#38388;&#29255;&#24050;&#21040;&#31561;&#21407;&#22240;&#65292;&#34987;&#31995;&#32479;&#24378;&#21046;&#35843;&#24230;&#65292;&#36827;&#32780;&#21457;&#29983;&#30340;&#19978;&#19979;&#25991;&#20999;&#25442;&#12290;&#27604;&#22914;&#35828;&#65292;&#22823;&#37327;&#36827;&#31243;&#37117;&#22312;&#20105;&#25250; CPU &#26102;&#65292;&#23601;&#23481;&#26131;&#21457;&#29983;&#38750;&#33258;&#24895;&#19978;&#19979;&#25991;&#20999;&#25442;&#12290;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#38548;1&#31186;&#65292;&#26174;&#31034;&#36827;&#31243;&#20999;&#25442;&#12289;CPU&#20351;&#29992;&#25351;&#26631;</span>
pidstat -w -u 1
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20986;&#32447;&#31243;&#30340;&#19978;&#19979;&#25991;&#20999;&#25442;&#25351;&#26631;&#65292;&#27599;&#31186;&#19968;&#27425;</span>
pidstat -wt 1
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a5b12a6e-c2c2-4d3e-819a-8025c8934580" class="outline-4">
<h4 id="h:a5b12a6e-c2c2-4d3e-819a-8025c8934580">查看进程实时状态</h4>
<div class="outline-text-4" id="text-h:a5b12a6e-c2c2-4d3e-819a-8025c8934580">
</div>
<div id="outline-container-h:d1ffa1d7-1529-409f-8da0-3e447f2f7827" class="outline-5">
<h5 id="h:d1ffa1d7-1529-409f-8da0-3e447f2f7827">top</h5>
<div class="outline-text-5" id="text-h:d1ffa1d7-1529-409f-8da0-3e447f2f7827">
<p>
top提供动态的实时进程状态
</p>


<p>
top命令栏位信息简介:
</p>

<div class="org-src-container">
<pre class="src src-sh">]# top
top - 08:30:56 up 135 days, 22:46,  1 user,  load average: 0.00, 0.00, 0.00
        &#24403;&#21069;&#26102;&#38388;;   &#31995;&#32479;&#19978;&#32447;&#26102;&#38388;; ;  &#24403;&#21069;&#30331;&#38470;&#29992;&#25143;&#25968;;  &#31995;&#32479;&#36127;&#36733;(&#20219;&#21153;&#38431;&#21015;&#30340;&#24179;&#22343;&#38271;&#24230;)

Tasks: 105 total,   1 running, 104 sleeping,   0 stopped,   0 zombie
        &#36827;&#31243;&#24635;&#25968;&#65307; &#27491;&#22312;&#36816;&#34892;&#36827;&#31243;&#25968;&#65307; &#20241;&#30496;&#36827;&#31243;&#25968;&#65307; &#20572;&#27490;&#36827;&#31243;&#25968;&#65307; &#20725;&#23608;&#36827;&#31243;&#25968;

%Cpu0  :  0.0 us,        0.0 sy,                0.0 ni,                               100.0 id,               0.0 wa,  0.0 hi,        0.0 si,  0.0 st
       &#29992;&#25143;&#31354;&#38388;&#21344;&#27604;&#65307; &#20869;&#26680;&#31354;&#38388;&#21344;&#27604;&#65307; &#25913;&#21464;&#36807;&#20248;&#20808;&#32423;&#30340;&#36827;&#31243;&#21344;&#27604;&#65307; &#31354;&#38388;CPU&#21344;&#27604;&#65307;  IO&#31561;&#24453;&#65307;&#30828;&#20013;&#26029;&#65307; &#36719;&#20214;&#20013;&#26029;&#65307; &#34394;&#25311;&#26426;CPU

MiB Mem :    949.6 total,     83.6 free,    178.7 used,    687.2 buff/cache
           &#29289;&#29702;&#20869;&#23384;&#24635;&#37327;&#65307; &#31354;&#38386;&#20869;&#23384;&#24635;&#37327;&#65307; &#24050;&#20351;&#29992;&#29289;&#29702;&#20869;&#23384;&#24635;&#37327;&#65307;  &#20869;&#26680;&#32531;&#23384;&#20869;&#23384;&#37327;

MiB Swap:      0.0 total,      0.0 free,      0.0 used.    616.2 avail Mem 
                &#20132;&#25442;&#21306;&#24635;&#37327;&#65307;  &#31354;&#38386;&#20869;&#23384;&#24635;&#37327;&#65307; &#20351;&#29992;&#30340;&#20132;&#25442;&#21306;&#24635;&#37327;&#65307;
&#36827;&#31243;ID;  &#29992;&#25143;&#65307;&#20248;&#20808;&#32423;&#65307;Nice&#20540;&#65307;&#34394;&#25311;&#20869;&#23384;&#65307;&#24120;&#39547;&#20869;&#23384;&#65307;&#20849;&#20139;&#20869;&#23384;
    PID    USER      PR       NI          VIRT           RES           SHR       S  %CPU  %MEM     TIME+ COMMAND                                                                 
      1     root      20          0         171184       16536         9724      S   0.0   1.7  10:44.90 systemd                                                                 
      2     root      20          0              0             0                0          S   0.0   0.0   0:01.49 kthreadd   
PID: &#36827;&#31243; ID
USER: &#21551;&#21160;&#36827;&#31243;&#30340;&#29992;&#25143;&#36134;&#25143;
PR: &#36827;&#31243;&#20248;&#20808;&#32423;
NI: nice&#20540;, &#24433;&#21709;&#35843;&#24230;&#20248;&#20808;&#32423;
VIRT: &#34394;&#25311;&#20869;&#23384; &#12290;&#36827;&#31243;&#20351;&#29992;&#30340;&#24635;&#34394;&#25311;&#20869;&#23384;(KiB)
RES: &#24120;&#39547;&#20869;&#23384;&#65288;&#23454;&#38469;&#20351;&#29992;&#30340;&#29289;&#29702;&#20869;&#23384;&#65289;(KiB)
SHR: &#36827;&#31243;&#20351;&#29992;&#30340;&#20849;&#20139;&#20869;&#23384;(KiB)
S: &#36827;&#31243;&#29366;&#24577;&#65288;&#20363;&#22914;&#65292;S &#34920;&#31034;&#30561;&#30496;&#65292;R &#34920;&#31034;&#36816;&#34892;&#65289;
%CPU: &#36827;&#31243;&#20351;&#29992;&#30340; CPU &#26102;&#38388;&#30334;&#20998;&#27604;
%MEM: &#36827;&#31243;&#20351;&#29992;&#30340; RAM &#30334;&#20998;&#27604;
TIME+: &#36827;&#31243;&#28040;&#32791;&#30340;&#24635; CPU &#26102;&#38388;
COMMAND: &#27599;&#20010;&#27963;&#21160;&#36827;&#31243;&#36127;&#36131;&#30340;&#31243;&#24207;&#12289;&#26381;&#21153;&#25110;&#21629;&#20196;
</pre>
</div>


<figure id="orge081b39">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210301151326094.png" alt="image-20210301151326094.png" width="50%">

</figure>

<p>
有许多内置命令:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#24110;&#21161;</span>
h &#25110; &#65311; &#65292;&#25353; q &#25110;esc &#36864;&#20986;&#24110;&#21161;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#39318;&#37096;&#20449;&#24687;&#26174;&#31034;</span>
l  <span style="color: #b22222;">#</span><span style="color: #b22222;">uptime&#20449;&#24687;</span>
t  <span style="color: #b22222;">#</span><span style="color: #b22222;">tasks&#21450;cpu&#20449;&#24687;</span>
1  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25968;&#23383;1 cpu&#20998;&#21035;&#26174;&#31034;</span>
m  <span style="color: #b22222;">#</span><span style="color: #b22222;">memory&#20449;&#24687;</span>
f  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36827;&#20837;top&#30340;&#20132;&#20114;&#24335;&#37197;&#32622;&#23631;&#24149;&#65292;&#28155;&#21152;&#65295;&#21024;&#38500;&#25152;&#26174;&#31034;&#30340;&#21015;&#65292;&#26377;&#21161;&#20110;&#20026;&#26576;&#20010;&#29305;&#23450;&#30340;&#20219;&#21153;&#35774;&#32622;top</span>
o  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36827;&#20837;top&#30340;&#20132;&#20114;&#24335;&#37197;&#32622;&#23631;&#24149;&#65292;&#37197;&#32622;top&#21015;&#26174;&#31034;&#30340;&#39034;&#24207;&#65288;&#20174;&#24038;&#21040;&#21491;&#65289;</span>
r  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;renice&#20462;&#25913;&#26576;&#20010;&#36827;&#31243;&#30340;&#20248;&#20808;&#32423;</span>
q  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36864;&#20986;&#21629;&#20196;</span>
s  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#21047;&#26032;&#26102;&#38388;&#38388;&#38548;</span>
W  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20445;&#23384;&#25991;&#20214;</span>
c  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20999;&#25442; COMMAND &#21015;&#26174;&#31034;&#65306;&#21629;&#20196;&#21517;/&#21629;&#20196;&#34892;</span>
&#8595;  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35270;&#35282;&#19979;&#31227;&#65288;&#21363;&#65306;&#21015;&#34920;&#19978;&#31227;&#65289;</span>
&#8593;  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35270;&#35282;&#19978;&#31227;&#65288;&#21363;&#65306;&#21015;&#34920;&#19979;&#31227;&#65289;</span>
H  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20999;&#25442;&#21040; &#32447;&#31243;&#35270;&#22270;&#65292;&#20363;&#22914;&#65306;</span>
V  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29238;&#23376;&#36827;&#31243;&#20197;&#26641;&#24418;&#26174;&#31034;</span>
e  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20999;&#25442; &#20869;&#23384;&#32479;&#35745;&#20449;&#24687;&#21306; &#19982; VIRT | RES | SHR &#19977;&#21015;&#30340;&#25968;&#25454;&#21333;&#20301;</span>
k  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26432;&#27515;&#25351;&#23450;&#36827;&#31243;&#65288;&#21015;&#34920;&#20013;&#30340;&#31532;&#19968;&#20010;&#36827;&#31243;&#65289;</span>

&#39640;&#20142;&#65306;
b  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#39640;&#20142;&#26174;&#31034;&#24403;&#21069;&#36816;&#34892;&#36827;&#31243;</span>
x  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#39640;&#20142;&#26174;&#31034;&#21015;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25490;&#24207;</span>
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#25353;&#21015;&#25490;&#24207;&#65292;&#40664;&#35748;&#38477;&#24207;&#65292;&#21453;&#21521;&#25353;R</span>
P  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;&#21344;&#25454;&#30340;CPU&#30334;&#20998;&#27604;,%CPU</span>
M  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21344;&#25454;&#20869;&#23384;&#30334;&#20998;&#27604;,%MEM</span>
T  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32047;&#31215;&#21344;&#25454;CPU&#26102;&#38271;,TIME+</span>
N  <span style="color: #b22222;">#</span><span style="color: #b22222;">PID&#25490;&#24207;</span>
&#25913;&#21464;&#25490;&#24207;&#21015;&#65306;shift + &gt; &#25110; shift + &lt;&#65292;&#40664;&#35748;cpu

&#25353;f&#36827;&#20837;&#21015;&#30028;&#38754;&#65292;&#36873;&#22909;&#21518;&#25353;s&#30830;&#35748;&#65292;esc&#36864;&#20986;&#21015;&#30028;&#38754;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36807;&#28388;</span>
o <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20837;&#36807;&#28388;&#26465;&#20214;&#12290;&#22914;&#36827;&#31243;&#29366;&#24577;&#20026;R&#30340;&#65292;S=R &#65307;&#22914;&#19981;&#21253;&#21547;java&#20851;&#38190;&#23383;&#30340;&#36827;&#31243; !COMMAND=java&#65307;&#22914; %CPU&gt;2.0</span>
= <span style="color: #b22222;">#</span><span style="color: #b22222;">&#37325;&#32622;&#36807;&#28388;</span>
u <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36807;&#28388;&#29992;&#25143;&#36827;&#31243;&#12290;&#36755;&#20837;&#29992;&#25143;&#21363;&#21487;</span>
i <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#26174;&#31034;&#31354;&#38388;&#36827;&#31243;</span>
</pre>
</div>


<p>
<b>cpu使用率</b>
</p>

<p>
Linux 作为一个多任务操作系统，将每个 CPU的时间划分为很短的时间片，再通
过调度器轮流分配给各个任务使用，因此造成多任务同时运行的错觉。
</p>

<p>
为了维护 CPU 时间，Linux 通过事先定义的节拍率（内核中表示为
HZ），触发时间中断，并使用全局变量 Jiffies
记录了开机以来的节拍数。每发生一次时间中断，Jiffies 的值就加 1。
</p>

<p>
节拍率 HZ 是内核的可配选项，可以设置为 100、250、1000
等。不同的系统可能设置不同数值，你可以通过查询 /boot/config
内核选项来查看它的配置值。比如在我的系统中，节拍率设置成了
250，也就是每秒钟触发 250 次时间中断。
</p>

<div class="org-src-container">
<pre class="src src-sh">$ grep <span style="color: #8b2252;">'CONFIG_HZ='</span> /boot/config-$(<span style="color: #ff00ff;">uname -r</span>)
<span style="color: #a0522d;">CONFIG_HZ</span>=250
</pre>
</div>

<p>
同时，正因为节拍率 HZ是内核选项，所以用户空间程序并不能直接访问。为了
方便用户空间程序，内核还提供了一个用户空间节拍率USER_HZ，它总是固定为
100，也就是 1/100秒。这样，用户空间程序并不需要关心内核中 HZ被设置成了
多少，因为它看到的总是固定值 USER_HZ。
</p>

<p>
/proc 虚拟文件系统，向用户空间提供了系统内部状态的信息，而 /proc/stat
提供的就是系统的 CPU 和任务统计信息
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#20445;&#30041;&#21508;&#20010;CPU&#30340;&#25968;&#25454;</span>
$ cat /proc/stat | grep ^cpu
cpu  280580 7407 286084 172900810 83602 0 583 0 0 0  <span style="color: #b22222;"># </span><span style="color: #b22222;">cpu&#30340;&#32047;&#21152;</span>
cpu0 144745 4181 176701 86423902 52076 0 301 0 0 0
cpu1 135834 3226 109383 86476907 31525 0 282 0 0 0
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">user&#65288;&#36890;&#24120;&#32553;&#20889;&#20026; us&#65289;&#65292;&#20195;&#34920;&#29992;&#25143;&#24577; CPU &#26102;&#38388;&#12290;&#27880;&#24847;&#65292;&#23427;&#19981;&#21253;&#25324;&#19979;&#38754;&#30340; nice &#26102;&#38388;&#65292;&#20294;&#21253;&#25324;&#20102; guest &#26102;&#38388;&#12290;
nice&#65288;&#36890;&#24120;&#32553;&#20889;&#20026; ni&#65289;&#65292;&#20195;&#34920;&#20302;&#20248;&#20808;&#32423;&#29992;&#25143;&#24577; CPU &#26102;&#38388;&#65292;&#20063;&#23601;&#26159;&#36827;&#31243;&#30340; nice &#20540;&#34987;&#35843;&#25972;&#20026; 1-19 &#20043;&#38388;&#26102;&#30340; CPU &#26102;&#38388;&#12290;&#36825;&#37324;&#27880;&#24847;&#65292;nice &#21487;&#21462;&#20540;&#33539;&#22260;&#26159; -20 &#21040; 19&#65292;&#25968;&#20540;&#36234;&#22823;&#65292;&#20248;&#20808;&#32423;&#21453;&#32780;&#36234;&#20302;&#12290;
system&#65288;&#36890;&#24120;&#32553;&#20889;&#20026; sys&#65289;&#65292;&#20195;&#34920;&#20869;&#26680;&#24577; CPU &#26102;&#38388;&#12290;
idle&#65288;&#36890;&#24120;&#32553;&#20889;&#20026; id&#65289;&#65292;&#20195;&#34920;&#31354;&#38386;&#26102;&#38388;&#12290;&#27880;&#24847;&#65292;&#23427;&#19981;&#21253;&#25324;&#31561;&#24453; I/O &#30340;&#26102;&#38388;&#65288;iowait&#65289;&#12290;
iowait&#65288;&#36890;&#24120;&#32553;&#20889;&#20026; wa&#65289;&#65292;&#20195;&#34920;&#31561;&#24453; I/O &#30340; CPU &#26102;&#38388;&#12290;
irq&#65288;&#36890;&#24120;&#32553;&#20889;&#20026; hi&#65289;&#65292;&#20195;&#34920;&#22788;&#29702;&#30828;&#20013;&#26029;&#30340; CPU &#26102;&#38388;&#12290;
softirq&#65288;&#36890;&#24120;&#32553;&#20889;&#20026; si&#65289;&#65292;&#20195;&#34920;&#22788;&#29702;&#36719;&#20013;&#26029;&#30340; CPU &#26102;&#38388;&#12290;
steal&#65288;&#36890;&#24120;&#32553;&#20889;&#20026; st&#65289;&#65292;&#20195;&#34920;&#24403;&#31995;&#32479;&#36816;&#34892;&#22312;&#34394;&#25311;&#26426;&#20013;&#30340;&#26102;&#20505;&#65292;&#34987;&#20854;&#20182;&#34394;&#25311;&#26426;&#21344;&#29992;&#30340; CPU &#26102;&#38388;&#12290;
guest&#65288;&#36890;&#24120;&#32553;&#20889;&#20026; guest&#65289;&#65292;&#20195;&#34920;&#36890;&#36807;&#34394;&#25311;&#21270;&#36816;&#34892;&#20854;&#20182;&#25805;&#20316;&#31995;&#32479;&#30340;&#26102;&#38388;&#65292;&#20063;&#23601;&#26159;&#36816;&#34892;&#34394;&#25311;&#26426;&#30340; CPU &#26102;&#38388;&#12290;
guest_nice&#65288;&#36890;&#24120;&#32553;&#20889;&#20026; gnice&#65289;&#65292;&#20195;&#34920;&#20197;&#20302;&#20248;&#20808;&#32423;&#36816;&#34892;&#34394;&#25311;&#26426;&#30340;&#26102;&#38388;&#12290;

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19978;&#38754;&#23545;&#24212;top &#30340;cpu&#20351;&#29992;&#29575;</span>
</pre>
</div>

<p>
而我们通常所说的 CPU 使用率，就是除了空闲时间外的其他时间占总 CPU
时间的百分比，用公式来表示就是：
</p>



<figure id="orgbcb180c">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210214000817683.png" alt="image-20210214000817683.png" width="50%">

</figure>

<p>
这是开机以来的节拍数累加值，所以直接算出来的，是开机以来的平均 CPU使用
率，一般没啥参考价值。 事实上，为了计算 CPU使用率，性能工具一般都会取
间隔一段时间（比如 3秒）的两次值，作差后，再计算出这段时间内的平均 CPU
使用率，即
</p>



<figure id="org62e05df">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210214002231633.png" alt="image-20210214002231633.png" width="50%">

</figure>

<p>
是我们用各种性能工具所看到的 CPU 使用率的实际计算方法。
</p>

<p>
比如，对比一下 top 和 ps 这两个工具报告的 CPU使用率，默认的结果很可能
不一样，因为 top 默认使用 3 秒时间间隔，而 ps使用的却是进程的整个生命
周期。
</p>

<p>
top 并没有细分进程的用户态 CPU 和内核态 CPU。使用 pidstat命令查看
</p>

<p>
top选项:
</p>
<div class="org-src-container">
<pre class="src src-sh">-d <span style="color: #b22222;">#    </span><span style="color: #b22222;">#&#25351;&#23450;&#21047;&#26032;&#26102;&#38388;&#38388;&#38548;,&#40664;&#35748;&#20026;3&#31186;</span>
-b       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20840;&#37096;&#26174;&#31034;&#25152;&#26377;&#36827;&#31243;</span>
-n <span style="color: #b22222;">#    </span><span style="color: #b22222;">#&#21047;&#26032;&#22810;&#23569;&#27425;&#21518;&#36864;&#20986;</span>
-H      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32447;&#31243;&#27169;&#24335;</span>
-p <span style="color: #b22222;">#   </span><span style="color: #b22222;">#&#25351;&#23450;&#36827;&#31243;&#32534;&#21495;</span>
</pre>
</div>

<p>
示例:
</p>
<div class="org-src-container">
<pre class="src src-sh">top -H -p <span style="color: #ff00ff;">`pidof mysqld`</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:1ca7acf9-d2f1-4b8a-b92a-c31aaf63ae87" class="outline-5">
<h5 id="h:1ca7acf9-d2f1-4b8a-b92a-c31aaf63ae87">atop</h5>
<div class="outline-text-5" id="text-h:1ca7acf9-d2f1-4b8a-b92a-c31aaf63ae87">
<p>
与 top 命令类似，但 atop 提供了更详细的信息，包括 CPU、内存、硬盘、网络等多个系统资源的使用情况。atop 还能保存历史记录，便于后续分析。
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">Ubuntu/Debian</span>
sudo apt install atop

<span style="color: #b22222;"># </span><span style="color: #b22222;">CentOS/RHEL</span>
sudo yum install atop
</pre>
</div>

<p>
使用
</p>
<div class="org-src-container">
<pre class="src src-sh">atop

-r&#65306;&#26174;&#31034;&#20869;&#23384;&#20351;&#29992;&#24773;&#20917;
-d&#65306;&#26174;&#31034;&#30913;&#30424;&#30340; I/O &#27963;&#21160;
-n&#65306;&#26174;&#31034;&#32593;&#32476;&#27963;&#21160;
-u&#65306;&#26174;&#31034;&#29992;&#25143;&#32423;&#30340; CPU &#36127;&#36733;
-m&#65306;&#26174;&#31034;&#20869;&#23384;&#30340;&#20351;&#29992;&#24773;&#20917;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#36807;&#25351;&#23450;&#26085;&#24535;&#25991;&#20214;&#36335;&#24452;&#65292;&#21487;&#20197;&#26597;&#30475;&#21382;&#21490;&#25968;&#25454;</span>
atop -r /var/log/atop/atop_YYYYMMDD
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6d104da6-44ce-4d47-8d52-69e0c6727b3b" class="outline-5">
<h5 id="h:6d104da6-44ce-4d47-8d52-69e0c6727b3b">htop</h5>
<div class="outline-text-5" id="text-h:6d104da6-44ce-4d47-8d52-69e0c6727b3b">
<p>
htop命令是增强版的TOP命令,来自于EPEL源,比top功能更强 选项:
</p>

<pre class="example" id="orga25a388">
-d # 指定延迟时间
-u USERNAME:仅显示指定用户的进程
-s COLUME:以指定字段进行排序
</pre>

<p>
子命令:
</p>

<pre class="example" id="org9861825">
s:跟踪选定进程的系统调用
l:显示选定进程打开的文件列表
a:将选定的进程绑定至某指定CPU核心
t:显示进程树
</pre>
</div>
</div>
<div id="outline-container-h:01344ab0-02ee-485f-b3a7-e2c939adacf8" class="outline-5">
<h5 id="h:01344ab0-02ee-485f-b3a7-e2c939adacf8">perf</h5>
<div class="outline-text-5" id="text-h:01344ab0-02ee-485f-b3a7-e2c939adacf8">
<p>
使用 perf 分析 CPU 性能问题
</p>

<p>
perf top 类似于 top，它能够实时显示占用 CPU时钟最多的函数或者指令，因
此可以用来查找热点函数并不保存数据，也就无法用于离线或者后续的分析
</p>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">$ perf top
Samples: 833  of event <span style="color: #8b2252;">'cpu-clock'</span>, Event count (approx.): 97742399
Overhead  Shared Object       Symbol
   7.28%  perf                [.] 0x00000000001f78a4
   4.72%  [kernel]            [k] vsnprintf
   4.32%  [kernel]            [k] module_get_kallsym
   3.65%  [kernel]            [k] _raw_spin_unlock_irqrestore
...


<span style="color: #b22222;"># </span><span style="color: #b22222;">-g&#24320;&#21551;&#35843;&#29992;&#20851;&#31995;&#20998;&#26512;&#65292;-p&#25351;&#23450;php-fpm&#30340;&#36827;&#31243;&#21495;21515</span>
$ perf top -g -p 21515
</pre>
</div>

<ul class="org-ul">
<li>第一行包含三个数据，分别是采样数（Samples）、事件类型（event）和事件总数量（Event count）</li>
<li>第一列 Overhead，是该符号的性能事件在所有采样中的比例，用百分比来表
示。</li>
<li>第二列 Shared，是该函数或指令所在的动态共享对象（Dynamic Shared
Object），如内核、进程名、动态链接库名、内核模块名等。</li>

<li>第三列 Object，是动态共享对象的类型。比如 [.] 表示用户空间的可执行程
序、或者动态链接库，而 [k] 则表示内核空间。</li>

<li>最后一列 Symbol是符号名，也就是函数名。当函数名未知时，用十六进制的
地址来表示。</li>
</ul>

<p>
perf record 和 perf report perf record
</p>

<p>
则提供了保存数据的功能，保存后的数据，需要你用 perf report 解析展示。
</p>

<p>
perf top 和 perf record 加上 -g 参数，开启调用关系的采样，方便我们根据
调用链来分析性能问题。
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#35760;&#24405;&#24615;&#33021;&#20107;&#20214;&#65292;&#31561;&#24453;&#22823;&#32422;15&#31186;&#21518;&#25353; Ctrl+C &#32456;&#27490;&#37319;&#26679;</span>
$ perf record -g

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;&#25253;&#21578;</span>
$ perf report
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c0c62af8-3ccf-4bb1-9048-45734250112a" class="outline-5">
<h5 id="h:c0c62af8-3ccf-4bb1-9048-45734250112a">execsnoop</h5>
<div class="outline-text-5" id="text-h:c0c62af8-3ccf-4bb1-9048-45734250112a">
<p>
execsnoop 就是一个专为短时进程设计的工具。它通过 ftrace 实时监控进程的
exec() 行为，并输出短时进程的基本信息，包括进程 PID、父进程
PID、命令行参数以及执行的结果。
</p>

<ul class="org-ul">
<li>地址：<a href="https://github.com/brendangregg/perf-tools/blob/master/execsnoop">https://github.com/brendangregg/perf-tools/blob/master/execsnoop</a></li>
<li>博客：<a href="http://www.brendangregg.com/blog/2014-07-28/execsnoop-for-linux.html">http://www.brendangregg.com/blog/2014-07-28/execsnoop-for-linux.html</a></li>
</ul>

<p>
execsnoop 所用的 ftrace 是一种常用的动态追踪技术，一般用于分析 Linux
内核的运行时行为，后面课程我也会详细介绍并带你使用。
</p>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#25353; Ctrl+C &#32467;&#26463;</span>
$ execsnoop
PCOMM            PID    PPID   RET ARGS
sh               30394  30393    0
stress           30396  30394    0 /usr/local/bin/stress -t 1 -d 1
sh               30398  30393    0
stress           30399  30398    0 /usr/local/bin/stress -t 1 -d 1
sh               30402  30400    0
stress           30403  30402    0 /usr/local/bin/stress -t 1 -d 1
sh               30405  30393    0
stress           30407  30405    0 /usr/local/bin/stress -t 1 -d 1
...
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:0ebd85c2-d031-4417-abcd-dad9403f246d" class="outline-3">
<h3 id="h:0ebd85c2-d031-4417-abcd-dad9403f246d">内存</h3>
<div class="outline-text-3" id="text-h:0ebd85c2-d031-4417-abcd-dad9403f246d">
</div>
<div id="outline-container-h:e76f3ac2-1108-4fbe-9a52-94dbee71709b" class="outline-4">
<h4 id="h:e76f3ac2-1108-4fbe-9a52-94dbee71709b">free内存空间</h4>
<div class="outline-text-4" id="text-h:e76f3ac2-1108-4fbe-9a52-94dbee71709b">

<figure id="org51e5cc3">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210119175420516.png" alt="image-20210119175420516.png" width="50%">

</figure>

<p>
free可以显示内存空间使用状态
</p>

<p>
格式
</p>
<div class="org-src-container">
<pre class="src src-sh">free [OPTION] <span style="color: #b22222;"># </span><span style="color: #b22222;">&#40664;&#35748;&#21333;&#20301;&#26159; KB</span>

&#24120;&#29992;&#36873;&#39033;:
-b &#20197;&#23383;&#33410;&#20026;&#21333;&#20301;
-m &#20197;MB&#20026;&#21333;&#20301;
-g &#20197;GB&#20026;&#21333;&#20301;
-h &#26131;&#35835;&#26684;&#24335;
-o &#19981;&#26174;&#31034;-/+buffers/cache&#34892;
-t   &#26174;&#31034;RAM + swap&#30340;&#24635;&#21644;
-s n &#21047;&#26032;&#38388;&#38548;&#20026;n&#31186;
-c n &#21047;&#26032;n&#27425;&#21518;&#21363;&#36864;&#20986; 
</pre>
</div>

<p>
范例: 释放内存
</p>

<div class="org-src-container">
<pre class="src src-sh">man proc
              To free pagecache, use:

                  <span style="color: #483d8b;">echo</span> 1 &gt; /proc/sys/vm/drop_caches

              To free dentries and inodes, use:

                  <span style="color: #483d8b;">echo</span> 2 &gt; /proc/sys/vm/drop_caches

              To free pagecache, dentries and inodes, use:

                  <span style="color: #483d8b;">echo</span> 3 &gt; /proc/sys/vm/drop_caches

dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/f.img <span style="color: #a0522d;">bs</span>=1M <span style="color: #a0522d;">count</span>=1024
~]#echo 3 &gt; /proc/sys/vm/drop_caches  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#28165;&#29702;&#32531;&#23384;&#12290;&#20294;&#19968;&#33324;&#19981;&#22909;&#28165;&#29702;&#65292;&#36825;&#26159;&#20026;&#20102;&#25552;&#39640;&#32531;&#23384;&#29992;&#30340;&#12290;</span>
</pre>
</div>

<p>
从 free 的手册中，你可以看到 buffer 和 cache 的说明:
</p>

<ul class="org-ul">
<li>Buffers 是内核缓冲区用到的内存，对应的是 /proc/meminfo 中的 Buffers
值。</li>
<li>Cache 是内核页缓存和 Slab 用到的内存，对应的是 /proc/meminfo 中的
Cached 与 SReclaimable 之和。</li>
</ul>

<p>
执行 man proc，你就可以得到 proc文件系统的详细文档。注意这个文档比较长，
你最好搜索一下（比如搜索meminfo），以便更快定位到内存部分。
</p>

<p>
man proc，你就可以得到 proc 文件系统的详细文档，我们可以看到：
</p>

<ul class="org-ul">
<li>Buffers 是对原始磁盘块的临时存储，也就是用来缓存磁盘的数据，通常不会
特别大（20MB左右）。这样，内核就可以把分散的写集中起来，统一优化磁盘
的写入，比如可以把多次小的写合并成单次大的写等等。</li>
<li>Cached 是从磁盘读取文件的页缓存，也就是用来缓存从文件读取的数据。这
样，下次访问这些文件数据时，就可以直接从内存中快速获取，而不需要再次
访问缓慢的磁盘。</li>
<li>SReclaimable 是 Slab 的一部分。Slab 包括两部分，其中的可回收部分，用
SReclaimable 记录；而不可回收部分，用 SUnreclaim 记录。</li>
</ul>

<p>
简单来说， <b>Buffer 是对磁盘数据的缓存，而 Cache是文件数据的缓存，它们
既会用在读请求中，也会用在写请求中</b> 。
</p>

<p>
不同版本内存计算公式：<a href="https://access.redhat.com/solutions/406773">https://access.redhat.com/solutions/406773</a>
</p>

<p>
代码： <a href="https://gitlab.com/procps-ng/procps/-/blob/master/src/free.c">https://gitlab.com/procps-ng/procps/-/blob/master/src/free.c</a>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@proxy ec2]# rpm -qf /usr/bin/free
procps-ng-3.3.10-28.el7.x86_64

rpm -qi procps-ng
</pre>
</div>

<p>
新版3.3.10
</p>

<p>
范例：不同版本free的区别
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">free -k output (RHEL 5 and RHEL 6):</span>
             total       used       free     shared    buffers     cached
Mem:       7778104    2971960    4806144          0     211756    1071092
-/+ buffers/cache:    1689112    6088992
Swap:      4194296          0    4194296

<span style="color: #b22222;">#</span><span style="color: #b22222;">free -k output (RHEL 7/8):</span>
              total        used        free      shared  buff/cache   available
Mem:        1012952      252740      158732       11108      601480      543584
Swap:       1048572        5380     1043192
</pre>
</div>

<p>
来自/proc/meminfo 的相关字段与 free-k 的输出进行匹配
</p>

<pre class="example" id="orga7b454d">
MemTotal:        7778104 kB
MemFree:         4806144 kB
Buffers:          211756 kB
Cached:          1071092 kB
SwapTotal:       4194296 kB
SwapFree:        4194296 kB
</pre>

<p>
<code>free -k</code> 和 <code>/proc/meminfo</code> 对比
</p>

<p>
Linux 5、6 和 7/8 中的 /proc/meminfo 字段匹配的free输出
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left"><code>free output</code></th>
<th scope="col" class="org-left">coresponding <code>/proc/meminfo</code> fields</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>Mem: total</code></td>
<td class="org-left"><code>MemTotal</code></td>
</tr>

<tr>
<td class="org-left"><code>Mem: used</code></td>
<td class="org-left"><code>MemTotal - MemFree</code></td>
</tr>

<tr>
<td class="org-left"><code>Mem: free</code></td>
<td class="org-left"><code>MemFree</code></td>
</tr>

<tr>
<td class="org-left"><code>Mem: shared</code> (can be ignored nowadays. It has no meaning.)</td>
<td class="org-left">N/A</td>
</tr>

<tr>
<td class="org-left"><code>Mem: buffers</code></td>
<td class="org-left"><code>Buffers</code></td>
</tr>

<tr>
<td class="org-left"><code>Mem: cached</code></td>
<td class="org-left"><code>Cached</code></td>
</tr>

<tr>
<td class="org-left"><code>-/+ buffers/cache: used</code></td>
<td class="org-left"><code>MemTotal - (MemFree + Buffers + Cached)</code></td>
</tr>

<tr>
<td class="org-left"><code>-/+ buffers/cache: free</code></td>
<td class="org-left"><code>MemFree + Buffers + Cached</code></td>
</tr>

<tr>
<td class="org-left"><code>Swap: total</code></td>
<td class="org-left"><code>SwapTotal</code></td>
</tr>

<tr>
<td class="org-left"><code>Swap: used</code></td>
<td class="org-left"><code>SwapTotal - SwapFree</code></td>
</tr>

<tr>
<td class="org-left"><code>Swap: free</code></td>
<td class="org-left"><code>SwapFree</code></td>
</tr>
</tbody>
</table>

<p>
Red Hat Enterprise Linux 7.1 或更高版本 (procps-ng 3.3.10) 中获取与
/proc/meminfo 字段匹配的免费输出
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left"><code>free output</code></th>
<th scope="col" class="org-left">coresponding <code>/proc/meminfo</code> fields</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>Mem: total</code></td>
<td class="org-left"><code>MemTotal</code></td>
</tr>

<tr>
<td class="org-left"><code>Mem: used</code></td>
<td class="org-left"><code>MemTotal - MemFree - Buffers - Cached - Slab</code></td>
</tr>

<tr>
<td class="org-left"><code>Mem: free</code></td>
<td class="org-left"><code>MemFree</code></td>
</tr>

<tr>
<td class="org-left"><code>Mem: shared</code></td>
<td class="org-left"><code>Shmem</code></td>
</tr>

<tr>
<td class="org-left"><code>Mem: buff/cache</code></td>
<td class="org-left"><code>Buffers + Cached + Slab</code></td>
</tr>

<tr>
<td class="org-left"><code>Mem:available</code></td>
<td class="org-left"><code>MemAvailable</code></td>
</tr>

<tr>
<td class="org-left"><code>Swap: total</code></td>
<td class="org-left"><code>SwapTotal</code></td>
</tr>

<tr>
<td class="org-left"><code>Swap: used</code></td>
<td class="org-left"><code>SwapTotal - SwapFree</code></td>
</tr>

<tr>
<td class="org-left"><code>Swap: free</code></td>
<td class="org-left"><code>SwapFree</code></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-h:356e2d5b-6da7-42b9-acc6-13630fc5b33d" class="outline-4">
<h4 id="h:356e2d5b-6da7-42b9-acc6-13630fc5b33d">pmap进程对应的内存映射</h4>
<div class="outline-text-4" id="text-h:356e2d5b-6da7-42b9-acc6-13630fc5b33d">
<p>
格式:
</p>
<div class="org-src-container">
<pre class="src src-sh">pmap [options] pid [...]

&#24120;&#29992;&#36873;&#39033;
-x: &#26174;&#31034;&#35814;&#32454;&#26684;&#24335;&#30340;&#20449;&#24687;
</pre>
</div>

<p>
范例：
</p>
<pre class="example" id="orgaa0ab00">
pmap 1
</pre>

<p>
另外一种实现
</p>

<pre class="example" id="org4b4821f">
cat /proc/PID/maps
</pre>

<p>
范例:
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#pmap 33477
33477:   ping 127.0.0.1
&#22320;&#22336;                         &#21344;&#29992;&#30340;&#24635;&#31354;&#38388;     &#20989;&#25968;\&#24211;&#35843;&#29992;
000055f708aa7000     56K r-x-- ping
00007fe73fb13000   2528K r---- LC_COLLATE
00007fe73fd8b000   108K r-x-- libpthread-2.28.so
00007fe73fda6000   2044K ----- libpthread-2.28.so
00007fe73ffa5000     4K r---- libpthread-2.28.so
00007fe73ffa6000     4K rw--- libpthread-2.28.so
00007fe73ffa7000     16K rw---   [ anon ]
00007fe73ffab000     12K r-x-- libdl-2.28.so

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#31995;&#32479;&#35843;&#29992;</span>
[root@centos7 ~]#dnf -y install strace
[root@centos7 ~]#strace ls 

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#24211;&#35843;&#29992;</span>
[root@centos7 ~]#yum -y install ltrace
[root@centos7 ~]# ltrace ls
</pre>
</div>
</div>
</div>
<div id="outline-container-h:77503210-ed71-4bc8-9aa5-e352b67f555f" class="outline-4">
<h4 id="h:77503210-ed71-4bc8-9aa5-e352b67f555f">vmstat虚拟内存信息</h4>
<div class="outline-text-4" id="text-h:77503210-ed71-4bc8-9aa5-e352b67f555f">
<p>
vmstat 是一个常用的系统性能分析工具，主要用来分析系统的内存使用情况，也常用来分析 CPU 上下文切换和中断的次数。
</p>

<p>
格式:
</p>
<pre class="example" id="orgd43724c">
vmstat [options] [delay [count]] 
</pre>

<p>
显示项说明：
</p>

<pre class="example" id="org538952b">
procs:
    r：可运行（正运行或等待运行）进程的个数，和核心数有关; CPU上等待运行的任务队列长度；实时的值；
    b：处于不可中断睡眠态的进程个数(被阻塞的队列的长度)
    注意：
        a队列长期大于系统CPU的个数，说明CPU不足，需要增加CPU；
        b队列太长，代表等待I/O很大，I/O能力不佳；
memory：
    swpd: 交换内存的使用总量
    free：空闲物理内存总量
    buffer：用于buffer的内存总量;缓冲, 使用场景，写入数据时，多文件先把数据写
                   到buffer缓冲区中，达到一定量时操作系统会统一写到磁盘上，这样减少了磁盘IO
    cache：用于cache的内存总量;缓存。场景，读文件时，先把内容放到内核cache中，
                  把文件复制到应用程序的内存空间，别的程序如果用到可以直接在内存中找到，这样提高了读取的速度
    注意：swpd值很大时，代表当前物理内存太少，对于服务器来讲能不使用交换内存最好；
swap:以内存为参照物，内存不足时交换分区模拟内存使用
    si：swap input, 以内在为参照物，进内存。对swap来说，就是从swap磁盘出去进内存。交换进内存的数据速率(kb/s)
    so：swap output, 以内存为参照物，从内存出。对swap来说，就是从内存出来进swap。交换至磁盘的数据速率(kb/s)
    注意：si,so很大时，物理内存不够用；如果si很大，换出so很少时，表示目前内存不是很严重；
io：以内存为参照物
    bi：以内存为参照物，从块设备读入数据到系统的速率(kb/s)
    bo: 保存数据至块设备的速率
    注意：bi,bo很大时，只能说读写很大，并不能判断性能问题；
system：
    in: interrupts 中断速率，包括时钟
    cs: context switch     进程切换速率。即每秒上下文切换的次数。
    注意：cs一旦达到上万个，说明需要运行的进程太多，cpu性能需要提高；
cpu：
    us:Time spent running non-kernel code
    sy: Time spent running kernel code
    id: Time spent idle. Linux 2.5.41前,包括IO-wait time.
    wa: Time spent waiting for IO.  2.5.41前，包括in idle.
    st: Time stolen from a virtual machine.  2.6.11前, unknown.
    如果使用率加起来上升到了 100%，其中sy 列高达 84%，说明 CPU 主要是被内核占用了
</pre>

<p>
选项:
</p>

<pre class="example" id="org714ea4e">
-s 显示内存的统计数据
</pre>

<p>
范例:
</p>

<pre class="example" id="orgfe2a859">
[root@centos8 ~]#vmstat  
[root@centos8 ~]#vmstat  1 3
[root@centos8 ~]#vmstat  -s
</pre>

<p>
范例：测试磁盘内存使用情况
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#27979;&#35797;si so</span>
dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/dev/null <span style="color: #a0522d;">bs</span>=3g <span style="color: #a0522d;">count</span>=1
vmstat <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35266;&#23519;&#21040;so&#30636;&#38388;&#21464;&#22823;&#12290;&#20197;&#20869;&#23384;&#20026;&#21442;&#29031;&#29289;&#65292;&#20174;&#20869;&#23384;&#20986;&#36827;&#21040;swap&#20013;&#20102;&#12290;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27979;&#35797;bi bo</span>
dd <span style="color: #a0522d;">if</span>=/dev/sda <span style="color: #a0522d;">of</span>=/dev/null
vmstat  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35266;&#23519;&#21040;bi&#21464;&#22823;&#12290;&#20197;&#20869;&#23384;&#20026;&#21442;&#29031;&#29289;&#65292;&#20174;&#30913;&#30424;&#20986;&#36827;&#20869;&#23384;&#12290;</span>

dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/f2.img <span style="color: #a0522d;">bs</span>=1M <span style="color: #a0522d;">count</span>=1024
vmsta  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35266;&#23519;&#21040;bo&#21464;&#22823;&#12290;&#20197;&#20869;&#23384;&#20026;&#21442;&#29031;&#29289;&#65292;&#20174;&#20869;&#23384;&#20986;&#20889;&#20837;&#30913;&#30424;&#12290;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:83c2b7c6-c9c3-427c-aac2-c58da16a13f2" class="outline-3">
<h3 id="h:83c2b7c6-c9c3-427c-aac2-c58da16a13f2">磁盘</h3>
<div class="outline-text-3" id="text-h:83c2b7c6-c9c3-427c-aac2-c58da16a13f2">
</div>
<div id="outline-container-h:a0bcad56-fdc3-4935-9d4f-a9d8de9324fe" class="outline-4">
<h4 id="h:a0bcad56-fdc3-4935-9d4f-a9d8de9324fe">iostat统计CPU和设备IO信息</h4>
<div class="outline-text-4" id="text-h:a0bcad56-fdc3-4935-9d4f-a9d8de9324fe">
<p>
此工具由sysstat包提供
</p>

<p>
通过iostat方便查看CPU、网卡、tty设备、磁盘、CD-ROM 等等设备的活动情况,负载信息。
</p>

<p>
选项
</p>

<div class="org-src-container">
<pre class="src src-sh">-C &#26174;&#31034;CPU&#20351;&#29992;&#24773;&#20917;
-d &#26174;&#31034;&#30913;&#30424;&#20351;&#29992;&#24773;&#20917;
-k &#20197; KB &#20026;&#21333;&#20301;&#26174;&#31034;
-m &#20197; M &#20026;&#21333;&#20301;&#26174;&#31034;
-N &#26174;&#31034;&#30913;&#30424;&#38453;&#21015;(LVM) &#20449;&#24687;
-n &#26174;&#31034;NFS &#20351;&#29992;&#24773;&#20917;
-p[&#30913;&#30424;] &#26174;&#31034;&#30913;&#30424;&#21644;&#20998;&#21306;&#30340;&#24773;&#20917;
-t &#26174;&#31034;&#32456;&#31471;&#21644;CPU&#30340;&#20449;&#24687;
-x &#26174;&#31034;&#35814;&#32454;&#20449;&#24687;
-V &#26174;&#31034;&#29256;&#26412;&#20449;&#24687;
</pre>
</div>

<p>
范例:
</p>

<pre class="example" id="org20e1b66">
[root@centos8 ~]#iostat 
[root@centos8 ~]#iostat 1 3

1．CPU使用率报告
通过iostat命令生成的第一部分报告是CPU使用率报告。对于多处理器系统，它是所有处理器总数的CPU全局平均值。报告包含以下格式：
%user，显示当在用户级别（应用程序）执行时发生的CPU使用率百分比。
%nice，显示在拥有nice优先级用户级别执行时发生的CPU使用率百分比。
%system，显示当在系统级别（内核）执行时发生的CPU使用率百分比。
%iowait，显示在系统未完成磁盘I/O请求期间，一个CPU或多个CPU空闲时间的百分比。
%steal，显示当hypervisor为另一个虚拟处理器服务的时候，一个虚拟CPU或多个虚拟CPU非自愿等待所花费时间的百分比。
%idle，显示一个CPU或多个CPU空闲时间的百分比，并且系统没有未完成的磁盘I/O请求。

2. 设备使用率报告
通过iostat命令生成的第二部分报告是设备使用率报告。设备报告提供了基于每个物理设备或每个分区上的统计数据。可以在命令行输入块设备和分区来显示统计数据。如果没有输入设备或分区，那么显示系统使用的每个设备统计数据，并提供内核对其维护的统计数据。如果在命令行上使用ALL选项，那么显示的统计数据为系统定义的每个设备的，包括那些从未使用过的。传输速率默认显示的块为1KB。该报告可以显示以下字段，这取决于所使用的标记：

Device，这列给出了在/dev目录中列出的设备（或分区）名称。
tps，指出每秒发出到设备的传输数量。传输是一个到设备的I/O请求。到设备的多个逻辑请求可以组合成一个单个的I/O请求。传输具有不确定的大小。
Blk_read/s，指出从设备读取的数据量，以每秒块的数量表示。块相当于扇区，因此大小为512字节。
Blk_wrtn/s，指出设备写入到的数据量，以每秒块的数量表示。块相当于扇区，因此大小为512字节。
Blk_read，总共读取的块数。
Blk_wrtn，总共写入的块数。

从性能角度来看，最有用的一个选项是-x。它显示扩展统计信息。下面是其示例输出
rrqm/s，设备请求队列中，每秒合并的读请求数量。
wrqm/s，设备请求队列中，每秒合并的写请求数量。
r/s，设备每秒完成的读请求的数量（合并之后）。
w/s，设备每秒完成的写请求的数量（合并之后）。
rsec/s，每秒从设备读取的扇区的数量。
wsec/s，每秒写入到设备的扇区的数量。
avgrq-sz，发出到设备的请求的平均大小（以扇区为单位）。
avgqu-sz，发出到设备的请求的平均队列长度。
await，发出到设备的I/O请求到被服务的平均时间（以毫秒为单位）。这包括请求在队列中花费的时间和服务请求花费的时间。
svctm，发出到设备的I/O请求的平均服务时间（以毫秒为单位）。
%util，在I/O请求发出到设备期间CPU时间的百分比（设备的带宽使用率）。当这个值接近100%的时候设备饱和。
</pre>

<p>
范例：测试
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#35835;&#30913;&#30424;</span>
dd <span style="color: #a0522d;">if</span>=/dev/sda  <span style="color: #a0522d;">of</span>=/dev/null
iostat 1     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35266;&#23519;&#30913;&#30424;&#35835;&#36895;&#24230;&#22686;&#21152;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20889;&#30913;&#30424;</span>
dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/f2.img <span style="color: #a0522d;">bs</span>=1M <span style="color: #a0522d;">count</span>=1024
iostat 1     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35266;&#23519;&#30913;&#30424;&#20889;&#36895;&#24230;&#22686;&#21152;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:51037e76-5944-4489-b008-16eb33c9518c" class="outline-4">
<h4 id="h:51037e76-5944-4489-b008-16eb33c9518c">iotop监视磁盘I/O</h4>
<div class="outline-text-4" id="text-h:51037e76-5944-4489-b008-16eb33c9518c">
<p>
来自于iotop包
</p>

<p>
iotop命令是一个用来监视磁盘I/O使用状况的top类工具iotop具有与top相似的
UI，其中包括PID、用户、I/O、进程等相关信息，可 <b>查看每个进程是如何使用IO</b>
</p>

<p>
iotop输出
</p>
<div class="org-src-container">
<pre class="src src-sh">- &#31532;&#19968;&#34892;:Read&#21644;Write&#36895;&#29575;&#24635;&#35745;
- &#31532;&#20108;&#34892;:&#23454;&#38469;&#30340;Read&#21644;Write&#36895;&#29575;
- &#31532;&#19977;&#34892;:&#21442;&#25968;&#22914;&#19979;
  TID                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32447;&#31243;ID(&#25353;p&#20999;&#25442;&#20026;&#36827;&#31243;ID)</span>
  PRIO                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20248;&#20808;&#32423;</span>
  USER                                <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#25143;</span>
  DISK READ                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30913;&#30424;&#35835;&#36895;&#29575;</span>
  DISK WRITE                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30913;&#30424;&#20889;&#36895;&#29575;</span>
  SWAPIN                          <span style="color: #b22222;">#</span><span style="color: #b22222;">swap&#20132;&#25442;&#30334;&#20998;&#27604;</span>
  IO                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">IO&#31561;&#24453;&#25152;&#21344;&#30340;&#30334;&#20998;&#27604;</span>
  COMMAN                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21738;&#37324;&#36827;&#31243;</span>
</pre>
</div>


<p>
iotop常用参数:
</p>

<pre class="example" id="orgb593135">
-o, --only只显示正在产生I/O的进程或线程，除了传参，可以在运行过程中按o生效
-b, --batch非交互模式，一般用来记录日志
-n NUM, --iter=NUM设置监测的次数，默认无限。在非交互模式下很有用
-d SEC, --delay=SEC设置每次监测的间隔，默认1秒，接受非整形数据例如1.1
-p PID, --pid=PID指定监测的进程/线程
-u USER, --user=USER指定监测某个用户产生的I/O
-P, --processes仅显示进程，默认iotop显示所有线程
-a, --accumulated显示累积的I/O，而不是带宽
-k, --kilobytes使用kB单位，而不是对人友好的单位。在非交互模式下，脚本编程有用
-t, --time 加上时间戳，非交互非模式
-q, --quiet 禁止头几行，非交互模式，有三种指定方式
-q 只在第一次监测时显示列名
-qq 永远不显示列名
-qqq 永远不显示I/O汇总
</pre>

<p>
交互按键
</p>

<pre class="example" id="org8bf6a01">
left和right方向键：改变排序
r：反向排序
o：切换至选项--only
p：切换至--processes选项
a：切换至--accumulated选项
q：退出
i：改变线程的优先级
</pre>
</div>
</div>
<div id="outline-container-h:0a42e52e-84d2-4ce4-a29a-b33e3da796e3" class="outline-4">
<h4 id="h:0a42e52e-84d2-4ce4-a29a-b33e3da796e3">dstat系统资源统计</h4>
<div class="outline-text-4" id="text-h:0a42e52e-84d2-4ce4-a29a-b33e3da796e3">
<p>
dstat由pcp-system-tools包提供,但安装dstat包即可,可用于代替vmstat,iostat功能
</p>

<p>
格式:
</p>

<pre class="example" id="orgfde8885">
dstat [-afv] [options..] [delay [count]]
</pre>

<p>
常用选项:
</p>

<pre class="example" id="org78cae89">
-c 显示cpu相关信息
-C #,#,...,total 显示第几颗CPU，total总共的
-d 显示disk相关信息
-D total,sda,sdb,... 指明具体的磁盘信息
-g 显示page相关统计数据
-m 显示memory相关统计数据
-n 显示network相关统计数据
-p 显示process相关统计数据
-r 显示io请求相关的统计数据 
-s 显示swapped相关的统计数据
--tcp 显示tcp连接状态
--udp 显示udp连接状态信息
--unix
--raw raw套接字状态信息
--socket 套接字状态信息
--ipc ipc状态信息
--top-cpu：显示最占用CPU的进程
--top-cpu-adv：(incl. pid and other stats)
--top-io: 显示最占用io的进程
--top-io-adv：(incl. pid and other stats)
--top-mem: 显示最占用内存的进程
--top-latency: 显示延迟最大的进程
</pre>

<p>
范例:
</p>

<pre class="example" id="org4c75910">
[root@centos8 ~]#yum -y install dstat
[root@centos8 ~]#dstat 1 6

统合检查
dstat -cydrmlns --fs --tcp -f
dst -tlvsn --tcp -at-top-io-adv
dstat --top-bio --top-cpu --top-cputime --top-io  --top-mem --top-oom
</pre>
</div>
</div>
</div>
<div id="outline-container-h:96a6809a-6b5a-40df-845a-0cfca9b9d5b1" class="outline-3">
<h3 id="h:96a6809a-6b5a-40df-845a-0cfca9b9d5b1">网络</h3>
<div class="outline-text-3" id="text-h:96a6809a-6b5a-40df-845a-0cfca9b9d5b1">
</div>
<div id="outline-container-h:bb3d212e-032d-45b9-8bc1-ffa5188ecb5d" class="outline-4">
<h4 id="h:bb3d212e-032d-45b9-8bc1-ffa5188ecb5d">iftop显示网络带宽使用情况</h4>
<div class="outline-text-4" id="text-h:bb3d212e-032d-45b9-8bc1-ffa5188ecb5d">
<p>
通过EPEL源的iftop包
</p>

<div class="org-src-container">
<pre class="src src-sh">~]#iftop -ni eth0

TX       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21457;&#36865;</span>
RX      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25509;&#25910;</span>
</pre>
</div>

<p>
范例：测试
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21457;&#36865;&#22823;&#30340;&#25968;&#25454;&#21253;</span>
ping -f -s 65507      10.0.08
iftop -ni eth0   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35266;&#23519;&#36828;&#31243;&#20027;&#26426;&#30340;&#36827;&#26469;&#27969;&#37327;&#65292;&#26412;&#22320;&#20986;&#21435;&#27969;&#37327;&#24773;&#20917;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:1bdd5c97-98c5-4e83-82f6-363f076abde5" class="outline-4">
<h4 id="h:1bdd5c97-98c5-4e83-82f6-363f076abde5">nload查看网络实时吞吐量</h4>
<div class="outline-text-4" id="text-h:1bdd5c97-98c5-4e83-82f6-363f076abde5">
<p>
nload是一个实时监控网络流量和带宽使用情况，以数值和动态图展示进出的流量情况,通过EPEL源安装
</p>

<p>
界面操作
</p>

<pre class="example" id="org8d57155">
上下方向键、左右方向键、enter键或者tab键都就可以切换查看多个网卡的流量情况
按 F2 显示选项窗口
按 q 或者 Ctrl+C 退出 nload
</pre>

<p>
范例:
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#40664;&#35748;&#21482;&#26597;&#30475;&#31532;&#19968;&#20010;&#32593;&#32476;&#30340;&#27969;&#37327;&#36827;&#20986;&#24773;&#20917;</span>
nload

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;nload&#21518;&#38754;&#25351;&#23450;&#32593;&#21345;&#65292;&#21487;&#20197;&#25351;&#23450;&#22810;&#20010;,&#25353;&#24038;&#21491;&#38190;&#20998;&#21035;&#26174;&#31034;&#32593;&#21345;&#29366;&#24577;</span>
nload eth0 eth1

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622;&#21047;&#26032;&#38388;&#38548;&#65306;&#40664;&#35748;&#21047;&#26032;&#38388;&#38548;&#26159;100&#27627;&#31186;&#65292;&#21487;&#36890;&#36807; -t &#21629;&#20196;&#35774;&#32622;&#21047;&#26032;&#26102;&#38388;&#65288;&#21333;&#20301;&#26159;&#27627;&#31186;&#65289;</span>
nload -t 500 eth0

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622;&#21333;&#20301;&#65306;&#26174;&#31034;&#20004;&#31181;&#21333;&#20301;&#19968;&#31181;&#26159;&#26174;&#31034;Bit/s&#12289;&#19968;&#31181;&#26159;&#26174;&#31034;Byte/s&#65292;&#40664;&#35748;&#26159;&#20197;Bit/s&#65292;&#20063;&#21487;&#19981;&#26174;&#31034;/s</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">-u h|b|k|m|g|H|B|K|M|G &#34920;&#31034;&#30340;&#21547;&#20041;&#65306; h: auto, b: Bit/s, k: kBit/s, m: MBit/s, H:</span>
auto, B: Byte/s, K: kByte/s, M: MByte/s
nload -u M eth0
</pre>
</div>
</div>
</div>
<div id="outline-container-h:fb78b733-c80c-4958-b7a8-bcad1fe7d71a" class="outline-4">
<h4 id="h:fb78b733-c80c-4958-b7a8-bcad1fe7d71a">nethogs查看进程网络带宽</h4>
<div class="outline-text-4" id="text-h:fb78b733-c80c-4958-b7a8-bcad1fe7d71a">
<p>
Nethogs是一个开源的命令行工具，用来按进程或者程序实时统计网络带宽使用率。
</p>

<div class="org-src-container">
<pre class="src src-sh">nethogs
</pre>
</div>
</div>
</div>
<div id="outline-container-h:3340adee-7ad1-483f-948e-351760b61576" class="outline-4">
<h4 id="h:3340adee-7ad1-483f-948e-351760b61576">iptraf-ng网络监视工具</h4>
<div class="outline-text-4" id="text-h:3340adee-7ad1-483f-948e-351760b61576">
<p>
来自于iptraf-ng包,可以对网络进行监控,对终端窗口大小有要求
</p>

<p>
范例:
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#yum -y install iptraf-ng
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#32456;&#31471;&#31383;&#21475;&#22823;&#23567;&#26377;&#35201;&#27714;,&#22914;&#26524;&#22826;&#23567;&#21542;&#21017;&#26080;&#27861;&#26174;&#31034;</span>
[root@centos8 ~]#iptraf-ng 
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:e47b0b5c-afd7-4108-87c5-155ce9348177" class="outline-3">
<h3 id="h:e47b0b5c-afd7-4108-87c5-155ce9348177">kill信号发送</h3>
<div class="outline-text-3" id="text-h:e47b0b5c-afd7-4108-87c5-155ce9348177">
<p>
kill:内部命令,可用来向进程发送控制信号,以实现对进程管理,每个信号对应一
个数字,信号名称以SIG开头(可省略),不区分大小写
</p>

<p>
显示当前系统可用信号:
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">kill</span> -l
<span style="color: #a020f0;">trap</span> -l
&#26597;&#30475;&#24110;&#21161;:man 7 signal &#24120;&#29992;&#20449;&#21495;:
</pre>
</div>


<div class="org-src-container">
<pre class="src src-sh">1) SIGHUP      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32456;&#27490;&#36827;&#31243;&#65292;&#29305;&#21035;&#26159;&#32456;&#31471;&#36864;&#20986;&#26102;&#65292;&#27492;&#32456;&#31471;&#20869;&#30340;&#36827;&#31243;&#37117;&#23558;&#34987;&#32456;&#27490;&#65307;&#26080;&#39035;&#20851;&#38381;&#36827;&#31243;&#32780;&#35753;&#20854;&#37325;&#35835;&#37197;&#32622;&#25991;&#20214;&#65292;&#22914;httpd nginx  postfix</span>
2) SIGINT       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20013;&#27490;&#27491;&#22312;&#36816;&#34892;&#30340;&#36827;&#31243;&#65307;&#30456;&#24403;&#20110;Ctrl+c</span>
3) SIGQUIT     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20174;&#38190;&#30424;&#21457;&#20986;&#26432;&#27515;(&#32456;&#27490;)&#36827;&#31243;&#30340;&#20449;&#21495;&#65292;&#30456;&#24403;&#20110;ctrl+\    , quit</span>
9) SIGKILL      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24378;&#21046;&#26432;&#27515;&#36827;&#31243;&#65292;&#35813;&#20449;&#21495;&#19981;&#21487;&#34987;&#25429;&#25417;&#21644;&#24573;&#30053;&#65292;&#36827;&#31243;&#25910;&#21040;&#35813;&#20449;&#21495;&#21518;&#19981;&#20250;&#25191;&#34892;&#20219;&#20309;clean-up&#34892;&#20026;&#65292;&#25152;&#20197;&#36164;&#28304;&#19981;&#20250;&#37322;&#25918;&#65292;&#29366;&#24577;&#19981;&#20250;&#20445;&#23384; </span>
15) SIGTERM  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26432;&#27515;(&#32456;&#27490;)&#36827;&#31243;&#65292;&#20960;&#20046;&#31561;&#21516;&#20110;sigint&#20449;&#21495;&#65292;&#20250;&#23613;&#21487;&#33021;&#30340;&#37322;&#25918;&#25191;&#34892;clean-up&#65292;&#37322;&#25918;&#36164;&#28304;&#65292;&#20445;&#23384;&#29366;&#24577;&#31561;&#65292;&#40664;&#35748;&#20449;&#21495;</span>
18) SIGCONT  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32487;&#32493;&#36816;&#34892; bg &lt;number&gt;</span>
19) SIGSTOP  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21518;&#21488;&#20241;&#30496; &#20572;&#27490;&#29366;&#24577; ctrl+z</span>
20) SIGTSTP   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35813;&#20449;&#21495;&#26159;&#21487;&#34987;&#24573;&#30053;&#30340;&#36827;&#31243;&#20572;&#27490;&#20449;&#21495;(CTRL+Z)</span>
</pre>
</div>

<p>
指定信号的方法 :
</p>

<ul class="org-ul">
<li>信号的数字标识：1, 2, 9</li>
<li>信号完整名称：SIGHUP，sighup</li>
<li>信号的简写名称：HUP，hup</li>
</ul>

<p>
向进程发送信号: 按PID:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">kill</span> [-s sigspec | -n signum | -sigspec] pid | jobspec ... or kill -l [sigspec]
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">kill</span> -1   pid &#8230;   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#37325;&#26032;&#35835;&#21462;&#37197;&#32622;&#25991;&#20214;</span>
<span style="color: #483d8b;">kill</span> -n 9 pid
<span style="color: #483d8b;">kill</span> -s SIGINT pid 
</pre>
</div>

<p>
按名称:killall 来自于psmisc包
</p>

<div class="org-src-container">
<pre class="src src-sh">killall [-SIGNAL] comm...
</pre>
</div>

<p>
按模式:
</p>
<div class="org-src-container">
<pre class="src src-sh">pkill [options] pattern
</pre>
</div>

<p>
常用选项:
</p>
<div class="org-src-container">
<pre class="src src-sh">-SIGNAL
-u uid: effective user&#65292;&#29983;&#25928;&#32773;
-U uid: real user&#65292;&#30495;&#27491;&#21457;&#36215;&#36816;&#34892;&#21629;&#20196;&#32773;
-t terminal: &#19982;&#25351;&#23450;&#32456;&#31471;&#30456;&#20851;&#30340;&#36827;&#31243;
-l: &#26174;&#31034;&#36827;&#31243;&#21517;&#65288;pgrep&#21487;&#29992;&#65289;
-a: &#26174;&#31034;&#23436;&#25972;&#26684;&#24335;&#30340;&#36827;&#31243;&#21517;&#65288;pgrep&#21487;&#29992;&#65289;
-P pid: &#26174;&#31034;&#25351;&#23450;&#36827;&#31243;&#30340;&#23376;&#36827;&#31243; 
</pre>
</div>

<p>
范例:查看HUP信号
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#35768;&#22810;&#26381;&#21153;&#25903;&#25345;&#30340;reload&#25805;&#20316;,&#23454;&#38469;&#23601;&#26159;&#21457;&#36865;&#20102;HUP&#20449;&#21495;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">service httpd reload &#21363;&#30456;&#24403;&#20110; killall -1 httpd</span>
[root@centos6 ~]#grep -A 10 -w reload -m 1 /etc/init.d/httpd
<span style="color: #0000ff;">reload</span>() {
        <span style="color: #483d8b;">echo</span> -n $<span style="color: #8b2252;">"Reloading $prog: "</span>
        <span style="color: #a020f0;">if</span> ! <span style="color: #a0522d;">LANG</span>=$<span style="color: #a0522d;">HTTPD_LANG</span> $<span style="color: #a0522d;">httpd</span> $<span style="color: #a0522d;">OPTIONS</span> -t &gt;&amp;/dev/null; <span style="color: #a020f0;">then</span>
                <span style="color: #a0522d;">RETVAL</span>=6
                <span style="color: #483d8b;">echo</span> $<span style="color: #8b2252;">"not reloading due to configuration syntax error"</span>
            failure $<span style="color: #8b2252;">"not reloading $httpd due to configuration syntax error"</span>
        <span style="color: #a020f0;">else</span>
                <span style="color: #b22222;"># </span><span style="color: #b22222;">Force LSB behaviour from killproc</span>
                <span style="color: #a0522d;">LSB</span>=1 killproc -p ${<span style="color: #a0522d;">pidfile</span>} $<span style="color: #a0522d;">httpd</span> -HUP
                <span style="color: #a0522d;">RETVAL</span>=$<span style="color: #a0522d;">?</span>
                <span style="color: #a020f0;">if</span> [ $<span style="color: #a0522d;">RETVAL</span> -eq 7 ]; <span style="color: #a020f0;">then</span>
[root@centos6 ~]#
</pre>
</div>

<p>
范例:利用0信号实现进程的健康性检查
</p>

<pre class="example" id="org9bc2062">
[root@centos8 ~]#man kill
If signal is 0, then no actual signal is sent, but error checking is still
performed.
[root@centos8 ~]#killall -0 ping
[root@centos8 ~]#echo $?
0
[root@centos8 ~]#killall -0 ping
ping: no process found
[root@centos8 ~]#echo $?
1
#此方式有局限性，即使进程处于停止或僵尸状态，此方式仍然认为进程是健康的 
#进程停止状态： 给进程19信号
#进程僵尸状态：给父进程19信号，15信号给子进程
</pre>

<p>
范例：踢除指定终端的用户
</p>

<div class="org-src-container">
<pre class="src src-sh">pkill -kill -t pts/2
</pre>
</div>

<p>
范例：nginx服务信号
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@proxy ~]# man nginx
     SIGQUIT          Shut down gracefully.
     SIGUSR1          Reopen log files.   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#37325;&#26032;&#25171;&#24320;&#26085;&#24535;</span>
     SIGUSR2          Upgrade the nginx executable on the fly.
     SIGWINCH         Shut down worker processes gracefully.

/mnt/logs/nginx/*.log {
        daily   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25353;&#26085;&#36718;&#24490;</span>
        copytruncate
        missingok
        dateext
        rotate 52
        compress
        delaycompress
        notifempty
        create 644 nginx nginx
        sharedscripts
        postrotate
                [ -f /var/run/nginx.pid ] &amp;&amp; <span style="color: #483d8b;">kill</span> -USR1 <span style="color: #ff00ff;">`cat /var/run/nginx.pid`</span>
        endscript
}
</pre>
</div>
</div>
</div>
<div id="outline-container-h:0fe8fc8e-7e2d-45c1-b909-6bd448384f19" class="outline-3">
<h3 id="h:0fe8fc8e-7e2d-45c1-b909-6bd448384f19">作业管理</h3>
<div class="outline-text-3" id="text-h:0fe8fc8e-7e2d-45c1-b909-6bd448384f19">
<p>
Linux作业控制
</p>

<ul class="org-ul">
<li>前台作业:通过终端启动,且启动后一直占据终端</li>
<li>后台作业:可通过终端启动,但启动后即转入后台运行(释放终端)</li>
</ul>



<figure id="orge46d810">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210119180203469.png" alt="image-20210119180203469.png" width="50%">

</figure>

<p>
让作业运行于后台
</p>

<ul class="org-ul">
<li>运行中的作业： Ctrl+z</li>
<li>尚未启动的作业： COMMAND &amp;</li>
</ul>

<p>
后台作业虽然被送往后台运行，但其依然与终端相关；退出终端，将关闭后台作业。如果希望送往后台后，剥离与终端的关系
</p>

<ul class="org-ul">
<li>nohup COMMAND &amp;&gt;/dev/null &amp;</li>
<li>screen；COMMAND</li>
<li>tmux；COMMAND</li>
</ul>

<p>
查看当前终端所有作业:
</p>

<pre class="example" id="org3f246d8">
jobs

+/- 表示优先级；当调用时不加作业号会默认调用+的命令
</pre>

<p>
作业控制：
</p>

<pre class="example" id="org2a3fe8b">
fg [[%]JOB_NUM]：把指定的后台作业调回前台
bg [[%]JOB_NUM]：让送往后台的作业在后台继续运行
kill [%JOB_NUM]： 终止指定的作业 
</pre>

<p>
范例: 后台运行的进程和终端关系
</p>

<pre class="example" id="org924618b">
#终端1运行后台进程
[root@centos8 ~]#ping 127.0.0.1 &amp;
[1] 30545
#终端2 可以查看到进程
[root@centos8 ~]#ps aux|grep ping
root 30545 0.0 0.2 32408 2416 pts/0 S 12:25 0:00 ping
127.0.0.1
root 30547 0.0 0.1 12108 988 pts/2 S+ 12:25 0:00 grep --
color=auto ping
#关闭终端1后,在终端2查看不到进程
[root@centos8 ~]#ps aux|grep ping
root 30552 0.0 0.1 12108 1084 pts/2 S+ 12:25 0:00 grep --
color=auto ping 
</pre>
</div>
</div>
<div id="outline-container-h:1800cacc-3bc6-47e9-a03d-2d2872382276" class="outline-3">
<h3 id="h:1800cacc-3bc6-47e9-a03d-2d2872382276">并行运行</h3>
<div class="outline-text-3" id="text-h:1800cacc-3bc6-47e9-a03d-2d2872382276">
<p>
利用后台执行,实现并行功能,即同时运行多个进程,提高效率
</p>

<p>
方法1:
</p>
<div class="org-src-container">
<pre class="src src-sh">cat all.sh
f1.sh&amp;
f2.sh&amp;
f3.sh&amp; 
</pre>
</div>

<p>
方法2:
</p>
<div class="org-src-container">
<pre class="src src-sh">(f1.sh&amp;);(f2.sh&amp;);(f3.sh&amp;)
</pre>
</div>

<p>
方法3:
</p>
<div class="org-src-container">
<pre class="src src-sh">f1.sh&amp;f2.sh&amp;f3.sh&amp; 
</pre>
</div>

<p>
范例：多组命令实现并行
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#{ ping -c3 127.1; ping 127.2; }&amp; { ping -c3 127.3 ;ping 127.4; }&amp; 
</pre>
</div>

<p>
范例:
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>
<span style="color: #a0522d;">NET</span>=10.0.0
<span style="color: #a020f0;">for</span> i<span style="color: #a020f0;"> in</span> {1..254};<span style="color: #a020f0;">do</span>
{
    ping -c1 -W1 ${<span style="color: #a0522d;">NET</span>}<span style="color: #483d8b;">.</span>${<span style="color: #a0522d;">i</span>} &amp;&gt; /dev/null &amp;&amp; <span style="color: #483d8b;">echo</span> ${<span style="color: #a0522d;">NET</span>}<span style="color: #483d8b;">.</span>${<span style="color: #a0522d;">i</span>} is up || <span style="color: #483d8b;">echo</span> ${<span style="color: #a0522d;">NET</span>}<span style="color: #483d8b;">.</span>${<span style="color: #a0522d;">i</span>} is down
}&amp;
<span style="color: #a020f0;">done</span>
<span style="color: #483d8b;">wait</span>   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21518;&#21488;&#25191;&#34892;&#30340;&#31243;&#24207;&#36864;&#20986;&#21152;wait</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d65616f4-161d-4dd1-ae18-1993426b49d9" class="outline-3">
<h3 id="h:d65616f4-161d-4dd1-ae18-1993426b49d9">其他</h3>
<div class="outline-text-3" id="text-h:d65616f4-161d-4dd1-ae18-1993426b49d9">
</div>
<div id="outline-container-h:348f1b38-2d40-44b9-8841-e88f5dcd7535" class="outline-4">
<h4 id="h:348f1b38-2d40-44b9-8841-e88f5dcd7535">sar</h4>
<div class="outline-text-4" id="text-h:348f1b38-2d40-44b9-8841-e88f5dcd7535">
<p>
sar工具是sysstat软件包的一部分。 /proc
下的一系列内存文件，通过采样来得到数据
</p>

<p>
sar（System Activity Reporter系统活动情况报告）是目前 Linux上最为全面
的系统性能分析工具之一，可以从多方面对系统的活动进行报告，包括：文件的
读写情况、系统调用的使用情况、磁盘I/O、CPU效率、内存使用状况、进程活动
及IPC有关的活动等。
</p>



<figure id="org9953367">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210301174240699.png" alt="image-20210301174240699.png" width="50%">

</figure>

<p>
yum install sysstat
</p>

<p>
sar命令常用格式
</p>

<p>
sar [options] [-A] [-o file] t [n]
</p>

<p>
其中：
</p>

<p>
t为采样间隔，n为采样次数，默认值是1；
</p>

<p>
-o file表示将命令结果以二进制格式存放在文件中，file 是文件名。
</p>

<p>
options 为命令行选项，sar命令常用选项如下：
</p>

<div class="org-src-container">
<pre class="src src-sh">-A&#65306;&#25152;&#26377;&#25253;&#21578;&#30340;&#24635;&#21644;
-u&#65306;&#36755;&#20986;CPU&#20351;&#29992;&#24773;&#20917;&#30340;&#32479;&#35745;&#20449;&#24687;
-v&#65306;&#36755;&#20986;inode&#12289;&#25991;&#20214;&#21644;&#20854;&#20182;&#20869;&#26680;&#34920;&#30340;&#32479;&#35745;&#20449;&#24687;
-d&#65306;&#36755;&#20986;&#27599;&#19968;&#20010;&#22359;&#35774;&#22791;&#30340;&#27963;&#21160;&#20449;&#24687;
-r&#65306;&#36755;&#20986;&#20869;&#23384;&#21644;&#20132;&#25442;&#31354;&#38388;&#30340;&#32479;&#35745;&#20449;&#24687;
-b&#65306;&#26174;&#31034;I/O&#21644;&#20256;&#36865;&#36895;&#29575;&#30340;&#32479;&#35745;&#20449;&#24687;
-a&#65306;&#25991;&#20214;&#35835;&#20889;&#24773;&#20917;
-c&#65306;&#36755;&#20986;&#36827;&#31243;&#32479;&#35745;&#20449;&#24687;&#65292;&#27599;&#31186;&#21019;&#24314;&#30340;&#36827;&#31243;&#25968;
-R&#65306;&#36755;&#20986;&#20869;&#23384;&#39029;&#38754;&#30340;&#32479;&#35745;&#20449;&#24687;
-y&#65306;&#32456;&#31471;&#35774;&#22791;&#27963;&#21160;&#24773;&#20917;
-w&#65306;&#36755;&#20986;&#31995;&#32479;&#20132;&#25442;&#27963;&#21160;&#20449;&#24687;
&#34917;&#20805;&#35828;&#26126;&#65306;
<span style="color: #8b2252;">"sar -&#21442;&#25968; -o filename &#38388;&#38548;&#26102;&#38388; &#37319;&#38598;&#27425;&#25968;"</span>
&#21487;&#20197;&#26681;&#25454;&#38656;&#35201;&#30340;&#24615;&#33021;&#21442;&#25968;&#65292;&#25163;&#21160;&#24320;&#21551;&#24615;&#33021;&#25968;&#25454;&#37319;&#38598;&#35760;&#24405;&#20837;&#25991;&#20214;&#65307;
<span style="color: #8b2252;">"sar -f filename"</span>
&#36890;&#36807;&#20197;&#19978;&#25351;&#20196;&#23545;&#20108;&#36827;&#21046;&#25991;&#20214;&#36827;&#34892;&#26597;&#30475;&#12290;
</pre>
</div>

<p>
系统已经为我们准备好了自动化作业/etc/crontab/sysstat。请记住，在你的系
统上安装sysstat之后自动设置每天运行sar的默认自动化作业。
</p>

<p>
使用cron开启自动化记录报告的示例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@zyg &#65374;]# cat /etc/cron.d/sysstat
<span style="color: #b22222;"># </span><span style="color: #b22222;">Run system activity accounting tool every 10 minutes</span>
*/10 * * * * root /usr/lib64/sa/sa1 -S DISK 1 1
<span style="color: #b22222;"># </span><span style="color: #b22222;">0 * * * * root /usr/lib64/sa/sa1 -S DISK 600 6 &amp;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Generate a daily summary of process accounting at 23:53</span>
53 23 * * * root /usr/lib64/sa/sa2 -A
</pre>
</div>

<p>
sa1命令用来将二进制数据收集和存储到/var/log/sa/sadd文件，dd参数表示当前天的日期。
</p>

<p>
sa2命令将每日报告写入到/var/log/sa/sardd文件，dd参数表示当前天的日期。
</p>

<p>
ps: 如果想细化收集粒度，可将sa1每10分钟改为1分钟执行一次！
</p>

<p>
范例：sar存储了本月的24小时系统记录，如20号，sa20
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@web17 ~]# ls /var/log/sa/
sa01  sa04  sa07  sa10  sa13  sa16  sa19  sa22  sa25  sa28  sar01  sar04  sar07  sar10  sar13  sar16  sar19  sar22  sar25  sar28
sa02  sa05  sa08  sa11  sa14  sa17  sa20  sa23  sa26  sa29  sar02  sar05  sar08  sar11  sar14  sar17  sar20  sar23  sar26  sar29
sa03  sa06  sa09  sa12  sa15  sa18  sa21  sa24  sa27  sa30  sar03  sar06  sar09  sar12  sar15  sar18  sar21  sar24  sar27  sar30
[root@web17 ~]# sar -q -f  /var/log/sa/sa09
</pre>
</div>

<p>
<b>CPU资源监控</b>
</p>

<p>
怀疑CPU存在瓶颈，可用 sar -u 和 sar -q 等来查看
</p>

<p>
1.1 CPU资源监控
</p>

<p>
范例：每10秒采样一次，连续采样3次，观察CPU的使用情况，并将采样结果以二
进制形式存入当前目录下的文件test中，需键入如下命令：
</p>

<div class="org-src-container">
<pre class="src src-sh">sar -u -o test 10 3

&#23631;&#24149;&#26174;&#31034;&#22914;&#19979;&#65306;
17:06:16 CPU %user %nice %system %iowait %steal %idle
17:06:26 all 0.00 0.00 0.20 0.00 0.00 99.80
17:06:36 all 0.00 0.00 0.20 0.00 0.00 99.80
17:06:46 all 0.00 0.00 0.10 0.00 0.00 99.90
Average: all 0.00 0.00 0.17 0.00 0.00 99.83

&#36755;&#20986;&#39033;&#35828;&#26126;&#65306;
CPU&#65306;all &#34920;&#31034;&#32479;&#35745;&#20449;&#24687;&#20026;&#25152;&#26377; CPU &#30340;&#24179;&#22343;&#20540;&#12290;
%user&#65306;&#26174;&#31034;&#22312;&#29992;&#25143;&#32423;&#21035;(application)&#36816;&#34892;&#20351;&#29992; CPU &#24635;&#26102;&#38388;&#30340;&#30334;&#20998;&#27604;&#12290;
%nice&#65306;&#26174;&#31034;&#22312;&#29992;&#25143;&#32423;&#21035;&#65292;&#29992;&#20110;nice&#25805;&#20316;&#65292;&#25152;&#21344;&#29992; CPU &#24635;&#26102;&#38388;&#30340;&#30334;&#20998;&#27604;&#12290;
%system&#65306;&#22312;&#26680;&#24515;&#32423;&#21035;(kernel)&#36816;&#34892;&#25152;&#20351;&#29992; CPU &#24635;&#26102;&#38388;&#30340;&#30334;&#20998;&#27604;&#12290;
%iowait&#65306;&#26174;&#31034;&#29992;&#20110;&#31561;&#24453;I/O&#25805;&#20316;&#21344;&#29992; CPU &#24635;&#26102;&#38388;&#30340;&#30334;&#20998;&#27604;&#12290;
%steal&#65306;&#31649;&#29702;&#31243;&#24207;(hypervisor)&#20026;&#21478;&#19968;&#20010;&#34394;&#25311;&#36827;&#31243;&#25552;&#20379;&#26381;&#21153;&#32780;&#31561;&#24453;&#34394;&#25311; CPU &#30340;&#30334;&#20998;&#27604;&#12290;
%idle&#65306;&#26174;&#31034; CPU &#31354;&#38386;&#26102;&#38388;&#21344;&#29992; CPU &#24635;&#26102;&#38388;&#30340;&#30334;&#20998;&#27604;&#12290;

1. &#33509; %iowait &#30340;&#20540;&#36807;&#39640;&#65292;&#34920;&#31034;&#30828;&#30424;&#23384;&#22312;I/O&#29942;&#39048;
2. &#33509; %idle &#30340;&#20540;&#39640;&#20294;&#31995;&#32479;&#21709;&#24212;&#24930;&#26102;&#65292;&#26377;&#21487;&#33021;&#26159; CPU &#31561;&#24453;&#20998;&#37197;&#20869;&#23384;&#65292;&#27492;&#26102;&#24212;&#21152;&#22823;&#20869;&#23384;&#23481;&#37327;
3. &#33509; %idle &#30340;&#20540;&#25345;&#32493;&#20302;&#20110;1&#65292;&#21017;&#31995;&#32479;&#30340; CPU &#22788;&#29702;&#33021;&#21147;&#30456;&#23545;&#36739;&#20302;&#65292;&#34920;&#26126;&#31995;&#32479;&#20013;&#26368;&#38656;&#35201;&#35299;&#20915;&#30340;&#36164;&#28304;&#26159; CPU &#12290;
</pre>
</div>

<p>
如果要查看二进制文件test中的内容，需键入如下sar命令：
</p>

<div class="org-src-container">
<pre class="src src-sh">sar -u -f test
</pre>
</div>

<p>
1.2. inode、文件和其他内核表监控
</p>

<p>
范例，每10秒采样一次，连续采样3次，观察核心表的状态，需键入如下命令：
</p>

<div class="org-src-container">
<pre class="src src-sh">sar -v 10 3
&#23631;&#24149;&#26174;&#31034;&#22914;&#19979;&#65306;
17:10:49 dentunusd file-nr inode-nr pty-nr
17:10:59 6301 5664 12037 4
17:11:09 6301 5664 12037 4
17:11:19 6301 5664 12037 4
Average: 6301 5664 12037 4

&#36755;&#20986;&#39033;&#35828;&#26126;&#65306;
dentunusd&#65306;&#30446;&#24405;&#39640;&#36895;&#32531;&#23384;&#20013;&#26410;&#34987;&#20351;&#29992;&#30340;&#26465;&#30446;&#25968;&#37327;
file-nr&#65306;&#25991;&#20214;&#21477;&#26564;&#65288;file handle&#65289;&#30340;&#20351;&#29992;&#25968;&#37327;
inode-nr&#65306;&#32034;&#24341;&#33410;&#28857;&#21477;&#26564;&#65288;inode handle&#65289;&#30340;&#20351;&#29992;&#25968;&#37327;
pty-nr&#65306;&#20351;&#29992;&#30340;pty&#25968;&#37327;
</pre>
</div>

<p>
1.3. 进程队列长度和平均负载状态监控
</p>

<p>
范例，每10秒采样一次，连续采样3次，监控进程队列长度和平均负载状态：
</p>

<div class="org-src-container">
<pre class="src src-sh">sar -q 10 3
&#23631;&#24149;&#26174;&#31034;&#22914;&#19979;&#65306;
[root@node1 ~]# sar -q 10 3
Linux 3.10.0-229.el7.x86_64 (node1)     2016&#24180;06&#26376;29&#26085;     _x86_64_    (2 CPU)

00&#26102;07&#20998;06&#31186;   runq-sz  plist-sz   ldavg-1   ldavg-5  ldavg-15   blocked
00&#26102;07&#20998;16&#31186;         0       445      0.01      0.03      0.05         0
00&#26102;07&#20998;26&#31186;         0       445      0.01      0.03      0.05         0

&#36755;&#20986;&#39033;&#35828;&#26126;&#65306;
runq-sz&#65306;&#36816;&#34892;&#38431;&#21015;&#30340;&#38271;&#24230;&#65288;&#31561;&#24453;&#36816;&#34892;&#30340;&#36827;&#31243;&#25968;&#65289;
plist-sz&#65306;&#36827;&#31243;&#21015;&#34920;&#20013;&#36827;&#31243;&#65288;processes&#65289;&#21644;&#32447;&#31243;&#65288;threads&#65289;&#30340;&#25968;&#37327;
ldavg-1&#65306;&#26368;&#21518;1&#20998;&#38047;&#30340;&#31995;&#32479;&#24179;&#22343;&#36127;&#36733;&#65288;System load average&#65289;
ldavg-5&#65306;&#36807;&#21435;5&#20998;&#38047;&#30340;&#31995;&#32479;&#24179;&#22343;&#36127;&#36733;
ldavg-15&#65306;&#36807;&#21435;15&#20998;&#38047;&#30340;&#31995;&#32479;&#24179;&#22343;&#36127;&#36733;

&#22266;&#23450;&#26102;&#38388;&#30340;&#36127;&#36733;
sar -q -s <span style="color: #8b2252;">'16:13:01'</span> -e <span style="color: #8b2252;">'18:11:01'</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">-s&#24320;&#22987;&#26102;&#38388; -e &#32467;&#26463;&#26102;&#38388; </span>
</pre>
</div>

<p>
<b>内存和交换空间监控</b>
</p>

<p>
怀疑内存存在瓶颈，可用 sar -B、sar -r 和 sar -W等来查看
</p>

<p>
2.1. 内存和交换空间监控
</p>

<p>
范例，每10秒采样一次，连续采样3次，监控内存分页：
</p>

<div class="org-src-container">
<pre class="src src-sh">sar -r 10 3
&#23631;&#24149;&#26174;&#31034;&#22914;&#19979;&#65306;
[root@node1 ~]# sar -r 10 3
Linux 3.10.0-229.el7.x86_64 (node1)     2016&#24180;06&#26376;29&#26085;     _x86_64_    (2 CPU)

00&#26102;03&#20998;53&#31186; kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty
00&#26102;04&#20998;03&#31186;    160652    842532     83.99      1444    504480    366976     17.92    288676    293292        28
00&#26102;04&#20998;13&#31186;    160652    842532     83.99      1444    504480    366976     17.92    288680    293292        28
&#36755;&#20986;&#39033;&#35828;&#26126;&#65306;
kbmemfree&#65306;&#36825;&#20010;&#20540;&#21644;free&#21629;&#20196;&#20013;&#30340;free&#20540;&#22522;&#26412;&#19968;&#33268;,&#25152;&#20197;&#23427;&#19981;&#21253;&#25324;buffer&#21644;cache&#30340;&#31354;&#38388;.
kbmemused&#65306;&#36825;&#20010;&#20540;&#21644;free&#21629;&#20196;&#20013;&#30340;used&#20540;&#22522;&#26412;&#19968;&#33268;,&#25152;&#20197;&#23427;&#21253;&#25324;buffer&#21644;cache&#30340;&#31354;&#38388;.
%memused&#65306;&#36825;&#20010;&#20540;&#26159;kbmemused&#21644;&#20869;&#23384;&#24635;&#37327;(&#19981;&#21253;&#25324;swap)&#30340;&#19968;&#20010;&#30334;&#20998;&#27604;.
kbbuffers&#21644;kbcached&#65306;&#36825;&#20004;&#20010;&#20540;&#23601;&#26159;free&#21629;&#20196;&#20013;&#30340;buffer&#21644;cache.
kbcommit&#65306;&#20445;&#35777;&#24403;&#21069;&#31995;&#32479;&#25152;&#38656;&#35201;&#30340;&#20869;&#23384;,&#21363;&#20026;&#20102;&#30830;&#20445;&#19981;&#28322;&#20986;&#32780;&#38656;&#35201;&#30340;&#20869;&#23384;(RAM+swap)<span style="color: #483d8b;">.</span>
%commit&#65306;&#36825;&#20010;&#20540;&#26159;kbcommit&#19982;&#20869;&#23384;&#24635;&#37327;(&#21253;&#25324;swap)&#30340;&#19968;&#20010;&#30334;&#20998;&#27604;.
</pre>
</div>

<p>
2.2. 内存分页监控
</p>

<p>
范例，每10秒采样一次，连续采样3次，监控内存分页：
</p>

<div class="org-src-container">
<pre class="src src-sh">sar -B 10 3
&#23631;&#24149;&#26174;&#31034;&#22914;&#19979;&#65306;
[root@node1 ~]# sar -B 10 3
Linux 3.10.0-229.el7.x86_64 (node1)     2016&#24180;06&#26376;29&#26085;     _x86_64_    (2 CPU)

00&#26102;05&#20998;02&#31186;  pgpgin/s pgpgout/s   fault/s  majflt/s  pgfree/s pgscank/s pgscand/s pgsteal/s    %vmeff
00&#26102;05&#20998;12&#31186;      0.00      0.00      6.70      0.00      5.70      0.00      0.00      0.00      0.00
00&#26102;05&#20998;22&#31186;      0.00      1.80      2.80      0.00      4.90      0.00      0.00      0.00      0.00

&#36755;&#20986;&#39033;&#35828;&#26126;&#65306;
pgpgin/s&#65306;&#34920;&#31034;&#27599;&#31186;&#20174;&#30913;&#30424;&#25110;SWAP&#32622;&#25442;&#21040;&#20869;&#23384;&#30340;&#23383;&#33410;&#25968;(KB)
pgpgout/s&#65306;&#34920;&#31034;&#27599;&#31186;&#20174;&#20869;&#23384;&#32622;&#25442;&#21040;&#30913;&#30424;&#25110;SWAP&#30340;&#23383;&#33410;&#25968;(KB)
fault/s&#65306;&#27599;&#31186;&#38047;&#31995;&#32479;&#20135;&#29983;&#30340;&#32570;&#39029;&#25968;,&#21363;&#20027;&#32570;&#39029;&#19982;&#27425;&#32570;&#39029;&#20043;&#21644;(major + minor)
majflt/s&#65306;&#27599;&#31186;&#38047;&#20135;&#29983;&#30340;&#20027;&#32570;&#39029;&#25968;.
pgfree/s&#65306;&#27599;&#31186;&#34987;&#25918;&#20837;&#31354;&#38386;&#38431;&#21015;&#20013;&#30340;&#39029;&#20010;&#25968;
pgscank/s&#65306;&#27599;&#31186;&#34987;kswapd&#25195;&#25551;&#30340;&#39029;&#20010;&#25968;
pgscand/s&#65306;&#27599;&#31186;&#30452;&#25509;&#34987;&#25195;&#25551;&#30340;&#39029;&#20010;&#25968;
pgsteal/s&#65306;&#27599;&#31186;&#38047;&#20174;cache&#20013;&#34987;&#28165;&#38500;&#26469;&#28385;&#36275;&#20869;&#23384;&#38656;&#35201;&#30340;&#39029;&#20010;&#25968;
%vmeff&#65306;&#27599;&#31186;&#28165;&#38500;&#30340;&#39029;(pgsteal)&#21344;&#24635;&#25195;&#25551;&#39029;(pgscank+pgscand)&#30340;&#30334;&#20998;&#27604;
</pre>
</div>

<p>
2.3. 系统交换活动信息监控
</p>

<p>
范例，每10秒采样一次，连续采样3次，监控系统交换活动信息：
</p>

<div class="org-src-container">
<pre class="src src-sh">sar -W 10 3
&#23631;&#24149;&#26174;&#31034;&#22914;&#19979;&#65306;
[root@node1 ~]# sar -W 10 3
Linux 3.10.0-229.el7.x86_64 (node1)     2016&#24180;06&#26376;29&#26085;     _x86_64_    (2 CPU)

00&#26102;08&#20998;07&#31186;  pswpin/s pswpout/s
00&#26102;08&#20998;17&#31186;      0.00      0.00
00&#26102;08&#20998;28&#31186;      0.00      0.00

&#36755;&#20986;&#39033;&#35828;&#26126;&#65306;
pswpin/s&#65306;&#27599;&#31186;&#31995;&#32479;&#25442;&#20837;&#30340;&#20132;&#25442;&#39029;&#38754;&#65288;swap page&#65289;&#25968;&#37327;
pswpout/s&#65306;&#27599;&#31186;&#31995;&#32479;&#25442;&#20986;&#30340;&#20132;&#25442;&#39029;&#38754;&#65288;swap page&#65289;&#25968;&#37327;
</pre>
</div>

<p>
2.4 报告一个特定中断的统计数据。
</p>

<p>
-I {int [,&#x2026;] | SUM | ALL | XALL}，注意，中断统计数据的收集依赖于sadc
"-S INT"选项，如：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@zyg &#65374;]# sar -I SUM 1
Linux 2.6.32-71.el6.x86_64 (zyg.power.com)&#12288;&#12288;10/14/14&#12288;&#12288;_x86_64_ (16 CPU)
17:07:05        INTR    intr/s
17:07:06        sum     1292.00
17:07:07        sum     1424.00

Int&#65292;&#20013;&#26029;&#21495;&#12290;&#22312;&#21629;&#20196;&#34892;&#19978;&#25351;&#23450;&#22810;&#20010;-I int&#21442;&#25968;&#23558;&#34987;&#35748;&#20026;&#26159;&#22810;&#20010;&#29420;&#31435;&#30340;&#20013;&#26029;&#12290;
SUM&#65292;&#34920;&#31034;&#26174;&#31034;&#27599;&#31186;&#25509;&#25910;&#21040;&#30340;&#20013;&#26029;&#24635;&#25968;&#12290;
ALL&#65292;&#34920;&#31034;&#32479;&#35745;&#25968;&#25454;&#26469;&#33258;&#25253;&#21578;&#30340;&#21069;16&#20010;&#20013;&#26029;&#12290;
XALL&#65292;&#34920;&#31034;&#32479;&#35745;&#25968;&#25454;&#26469;&#33258;&#25152;&#26377;&#20013;&#26029;&#65292;&#21253;&#25324;&#28508;&#22312;&#30340;APIC&#20013;&#26029;&#28304;&#37117;&#20250;&#34987;&#25253;&#21578;&#12290;
</pre>
</div>

<p>
<b>IO监控</b>
</p>

<p>
怀疑I/O存在瓶颈，可用 sar -b、sar -u 和 sar -d 等来查看
</p>

<p>
3.1. I/O和传送速率监控
</p>

<p>
范例，每10秒采样一次，连续采样3次，报告缓冲区的使用情况，需键入如下命令：
</p>

<div class="org-src-container">
<pre class="src src-sh">sar -b 10 3
&#23631;&#24149;&#26174;&#31034;&#22914;&#19979;&#65306;
[root@node1 ~]# sar -b 10 3
Linux 3.10.0-229.el7.x86_64 (node1)     2016&#24180;06&#26376;29&#26085;     _x86_64_    (2 CPU)

00&#26102;06&#20998;07&#31186;       tps      rtps      wtps   bread/s   bwrtn/s
00&#26102;06&#20998;17&#31186;      0.00      0.00      0.00      0.00      0.00
00&#26102;06&#20998;27&#31186;      0.20      0.00      0.20      0.00      0.30

&#36755;&#20986;&#39033;&#35828;&#26126;&#65306;
tps&#65306;&#27599;&#31186;&#38047;&#29289;&#29702;&#35774;&#22791;&#30340; I/O &#20256;&#36755;&#24635;&#37327;
rtps&#65306;&#27599;&#31186;&#38047;&#20174;&#29289;&#29702;&#35774;&#22791;&#35835;&#20837;&#30340;&#25968;&#25454;&#24635;&#37327;
wtps&#65306;&#27599;&#31186;&#38047;&#21521;&#29289;&#29702;&#35774;&#22791;&#20889;&#20837;&#30340;&#25968;&#25454;&#24635;&#37327;
bread/s&#65306;&#27599;&#31186;&#38047;&#20174;&#29289;&#29702;&#35774;&#22791;&#35835;&#20837;&#30340;&#25968;&#25454;&#37327;&#65292;&#21333;&#20301;&#20026; &#22359;/s
bwrtn/s&#65306;&#27599;&#31186;&#38047;&#21521;&#29289;&#29702;&#35774;&#22791;&#20889;&#20837;&#30340;&#25968;&#25454;&#37327;&#65292;&#21333;&#20301;&#20026; &#22359;/s
</pre>
</div>

<p>
3.2. 设备使用情况监控
</p>

<p>
范例，每10秒采样一次，连续采样3次，报告设备使用情况，需键入如下命令：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">sar -d 10 3</span>
&#23631;&#24149;&#26174;&#31034;&#22914;&#19979;&#65306;
[root@node1 ~]# sar -d 10 3 -p
Linux 3.10.0-229.el7.x86_64 (node1)     2016&#24180;06&#26376;29&#26085;     _x86_64_    (2 CPU)

00&#26102;10&#20998;56&#31186;       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util
00&#26102;11&#20998;06&#31186;       sda      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
00&#26102;11&#20998;06&#31186; centos-root      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
00&#26102;11&#20998;06&#31186; centos-swap      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00

[root@node1 ~]# sar -d 10 3
Linux 3.10.0-229.el7.x86_64 (node1)     2016&#24180;06&#26376;29&#26085;     _x86_64_    (2 CPU)

00&#26102;09&#20998;40&#31186;       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util
00&#26102;09&#20998;50&#31186;    dev8-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
00&#26102;09&#20998;50&#31186;  dev253-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00

&#20854;&#20013;&#65306;
&#21442;&#25968;-p&#21487;&#20197;&#25171;&#21360;&#20986;sda,hdc&#31561;&#30913;&#30424;&#35774;&#22791;&#21517;&#31216;,&#22914;&#26524;&#19981;&#29992;&#21442;&#25968;-p,&#35774;&#22791;&#33410;&#28857;&#21017;&#26377;&#21487;&#33021;&#26159;dev8-0,dev22-0

tps:&#27599;&#31186;&#20174;&#29289;&#29702;&#30913;&#30424;I/O&#30340;&#27425;&#25968;.&#22810;&#20010;&#36923;&#36753;&#35831;&#27714;&#20250;&#34987;&#21512;&#24182;&#20026;&#19968;&#20010;I/O&#30913;&#30424;&#35831;&#27714;,&#19968;&#27425;&#20256;&#36755;&#30340;&#22823;&#23567;&#26159;&#19981;&#30830;&#23450;&#30340;.
rd_sec/s:&#27599;&#31186;&#35835;&#25159;&#21306;&#30340;&#27425;&#25968;.
wr_sec/s:&#27599;&#31186;&#20889;&#25159;&#21306;&#30340;&#27425;&#25968;.
avgrq-sz:&#24179;&#22343;&#27599;&#27425;&#35774;&#22791;I/O&#25805;&#20316;&#30340;&#25968;&#25454;&#22823;&#23567;(&#25159;&#21306;)<span style="color: #483d8b;">.</span>
avgqu-sz:&#30913;&#30424;&#35831;&#27714;&#38431;&#21015;&#30340;&#24179;&#22343;&#38271;&#24230;.
await:&#20174;&#35831;&#27714;&#30913;&#30424;&#25805;&#20316;&#21040;&#31995;&#32479;&#23436;&#25104;&#22788;&#29702;,&#27599;&#27425;&#35831;&#27714;&#30340;&#24179;&#22343;&#28040;&#32791;&#26102;&#38388;,&#21253;&#25324;&#35831;&#27714;&#38431;&#21015;&#31561;&#24453;&#26102;&#38388;,&#21333;&#20301;&#26159;&#27627;&#31186;(<span style="color: #a0522d;">1&#31186;</span>=1000&#27627;&#31186;)<span style="color: #483d8b;">.</span>
svctm:&#31995;&#32479;&#22788;&#29702;&#27599;&#27425;&#35831;&#27714;&#30340;&#24179;&#22343;&#26102;&#38388;,&#19981;&#21253;&#25324;&#22312;&#35831;&#27714;&#38431;&#21015;&#20013;&#28040;&#32791;&#30340;&#26102;&#38388;.
%util:I/O&#35831;&#27714;&#21344;CPU&#30340;&#30334;&#20998;&#27604;,&#27604;&#29575;&#36234;&#22823;,&#35828;&#26126;&#36234;&#39281;&#21644;.

1. avgqu-sz &#30340;&#20540;&#36739;&#20302;&#26102;&#65292;&#35774;&#22791;&#30340;&#21033;&#29992;&#29575;&#36739;&#39640;&#12290;
2. &#24403;%util&#30340;&#20540;&#25509;&#36817; 1% &#26102;&#65292;&#34920;&#31034;&#35774;&#22791;&#24102;&#23485;&#24050;&#32463;&#21344;&#28385;&#12290;
</pre>
</div>

<p>
要判断系统瓶颈问题，有时需几个 sar 命令选项结合起来
</p>

<p>
怀疑CPU存在瓶颈，可用 sar -u 和 sar -q 等来查看
</p>

<p>
怀疑内存存在瓶颈，可用sar -B、sar -r 和 sar -W 等来查看
</p>

<p>
怀疑I/O存在瓶颈，可用 sar -b、sar -u和 sar -d 等来查看
</p>

<p>
<b>网络</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">sar -n { DEV | EDEV | NFS | NFSD | SOCK | ALL }
</pre>
</div>

<p>
sar 提供六种不同的语法选项来显示网络信息。-n选项使用6个不同的开关：
DEV | EDEV | NFS | NFSD | SOCK | ALL。DEV显示网络接口信息，EDEV显示关
于网络错误的统计数据，NFS统计活动的NFS客户端的信息，NFSD统计NFS服务器
的信息，SOCK显示套接字信息，ALL显示所有5个开关。它们可以单独或者一起使
用。
</p>

<p>
4.1 DEV显示网络接口信息
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">sar -n DEV 2 10</span>

[root@node1 ~]# sar -n DEV 2 10
Linux 3.10.0-229.el7.x86_64 (node1)     2016&#24180;06&#26376;29&#26085;     _x86_64_    (2 CPU)

00&#26102;15&#20998;18&#31186;     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s
00&#26102;15&#20998;20&#31186; eno16777736      0.50      0.50      0.03      0.09      0.00      0.00      0.00
00&#26102;15&#20998;20&#31186;        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00
00&#26102;15&#20998;20&#31186; virbr0-nic      0.00      0.00      0.00      0.00      0.00      0.00      0.00
00&#26102;15&#20998;20&#31186;    virbr0      0.00      0.00      0.00      0.00      0.00      0.00      0.00

&#36755;&#20986;&#39033;&#35828;&#26126;&#65306;
IFACE&#65306;LAN&#25509;&#21475;
rxpck/s&#65306;&#27599;&#31186;&#38047;&#25509;&#25910;&#30340;&#25968;&#25454;&#21253;
txpck/s&#65306;&#27599;&#31186;&#38047;&#21457;&#36865;&#30340;&#25968;&#25454;&#21253;
rxbyt/s&#65306;&#27599;&#31186;&#38047;&#25509;&#25910;&#30340;&#23383;&#33410;&#25968;
txbyt/s&#65306;&#27599;&#31186;&#38047;&#21457;&#36865;&#30340;&#23383;&#33410;&#25968;
rxcmp/s&#65306;&#27599;&#31186;&#38047;&#25509;&#25910;&#30340;&#21387;&#32553;&#25968;&#25454;&#21253;
txcmp/s&#65306;&#27599;&#31186;&#38047;&#21457;&#36865;&#30340;&#21387;&#32553;&#25968;&#25454;&#21253;
rxmcst/s&#65306;&#27599;&#31186;&#38047;&#25509;&#25910;&#30340;&#22810;&#25773;&#25968;&#25454;&#21253;
</pre>
</div>

<p>
4.2 EDEV显示关于网络错误的统计数据
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">sar -n EDEV 2 10</span>
[root@node1 ~]# sar -n EDEV 2 10
Linux 3.10.0-229.el7.x86_64 (node1)     2016&#24180;06&#26376;29&#26085;     _x86_64_    (2 CPU)

00&#26102;16&#20998;40&#31186;     IFACE   rxerr/s   txerr/s    coll/s  rxdrop/s  txdrop/s  txcarr/s  rxfram/s  rxfifo/s  txfifo/s
00&#26102;16&#20998;42&#31186; eno16777736      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
00&#26102;16&#20998;42&#31186;        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
00&#26102;16&#20998;42&#31186; virbr0-nic      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
00&#26102;16&#20998;42&#31186;    virbr0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00

&#36755;&#20986;&#39033;&#35828;&#26126;&#65306;
IFACE&#65306;LAN&#25509;&#21475;
rxerr/s&#65306;&#27599;&#31186;&#38047;&#25509;&#25910;&#30340;&#22351;&#25968;&#25454;&#21253;
txerr/s&#65306;&#27599;&#31186;&#38047;&#21457;&#36865;&#30340;&#22351;&#25968;&#25454;&#21253;
coll/s&#65306;&#27599;&#31186;&#20914;&#31361;&#25968;
rxdrop/s&#65306;&#22240;&#20026;&#32531;&#20914;&#20805;&#28385;&#65292;&#27599;&#31186;&#38047;&#20002;&#24323;&#30340;&#24050;&#25509;&#25910;&#25968;&#25454;&#21253;&#25968;
txdrop/s&#65306;&#22240;&#20026;&#32531;&#20914;&#20805;&#28385;&#65292;&#27599;&#31186;&#38047;&#20002;&#24323;&#30340;&#24050;&#21457;&#36865;&#25968;&#25454;&#21253;&#25968;
txcarr/s&#65306;&#21457;&#36865;&#25968;&#25454;&#21253;&#26102;&#65292;&#27599;&#31186;&#36733;&#27874;&#38169;&#35823;&#25968;
rxfram/s&#65306;&#27599;&#31186;&#25509;&#25910;&#25968;&#25454;&#21253;&#30340;&#24103;&#23545;&#40784;&#38169;&#35823;&#25968;
rxfifo/s&#65306;&#25509;&#25910;&#30340;&#25968;&#25454;&#21253;&#27599;&#31186;FIFO&#36807;&#36895;&#30340;&#38169;&#35823;&#25968;
txfifo/s&#65306;&#21457;&#36865;&#30340;&#25968;&#25454;&#21253;&#27599;&#31186;FIFO&#36807;&#36895;&#30340;&#38169;&#35823;&#25968;
</pre>
</div>

<p>
4.3 NFS统计活动的NFS客户端的信息，NFSD统计NFS服务器的信息，
</p>

<div class="org-src-container">
<pre class="src src-sh">call/s&#65292;&#27599;&#31186;&#20135;&#29983;RPC&#35831;&#27714;&#30340;&#25968;&#37327;&#12290;
retrans/s&#65292;&#27599;&#31186;&#38656;&#35201;&#37325;&#20256;&#30340;RPC&#35831;&#27714;&#30340;&#25968;&#37327;&#65288;&#20363;&#22914;&#65292;&#22240;&#20026;&#26381;&#21153;&#22120;&#36229;&#26102;&#65289;&#12290;
read/s&#65292;&#27599;&#31186;&#20135;&#29983;&#8216;read&#8217;RPC&#35843;&#29992;&#30340;&#25968;&#37327;&#12290;
write/s&#65292;&#27599;&#31186;&#20135;&#29983;&#8216;write&#8217;RPC&#35843;&#29992;&#30340;&#25968;&#37327;&#12290;
access/s&#65292;&#27599;&#31186;&#20135;&#29983;&#8216;access&#8217;RPC&#35843;&#29992;&#30340;&#25968;&#37327;&#12290;
getatt/s&#65292;&#27599;&#31186;&#20135;&#29983;&#8216;getattr&#8217;RPC&#35843;&#29992;&#30340;&#25968;&#37327;&#12290;
</pre>
</div>

<p>
4.4 NFSD，报告有关NFS服务器活动的统计数据。显示下面的值
</p>

<div class="org-src-container">
<pre class="src src-sh">scall/s&#65292;&#27599;&#31186;&#25509;&#25910;RPC&#35831;&#27714;&#30340;&#25968;&#37327;&#12290;
badcall/s&#65292;&#27599;&#31186;&#25509;&#25910;&#38169;&#35823;RPC&#35831;&#27714;&#30340;&#25968;&#37327;&#12290;
packet/s&#65292;&#27599;&#31186;&#25509;&#25910;&#32593;&#32476;&#25968;&#25454;&#21253;&#30340;&#25968;&#37327;&#12290;
udp/s&#65292;&#27599;&#31186;&#25509;&#25910;UDP&#25968;&#25454;&#21253;&#30340;&#25968;&#37327;&#12290;
tcp/s&#65292;&#27599;&#31186;&#25509;&#25910;TCP&#25968;&#25454;&#21253;&#30340;&#25968;&#37327;&#12290;
hit/s&#65292;&#27599;&#31186;&#22238;&#22797;&#32531;&#23384;&#21629;&#20013;&#30340;&#25968;&#37327;&#12290;
miss/s&#65292;&#27599;&#31186;&#22238;&#22797;&#32531;&#23384;&#26410;&#21629;&#20013;&#30340;&#25968;&#37327;&#12290;
sread/s&#65292;&#27599;&#31186;&#25509;&#25910;&#8216;read&#8217;RPC&#35843;&#29992;&#30340;&#25968;&#37327;&#12290;
swrite/s&#65292;&#27599;&#31186;&#25509;&#25910;&#8216;write&#8217;RPC&#35843;&#29992;&#30340;&#25968;&#37327;&#12290;
saccess/s&#65292;&#27599;&#31186;&#25509;&#25910;&#8216;access&#8217;RPC&#35843;&#29992;&#30340;&#25968;&#37327;&#12290;
sgetatt/s&#65292;&#27599;&#31186;&#25509;&#25910;&#8216;getattr&#8217;RPC&#35843;&#29992;&#30340;&#25968;&#37327;&#12290;
</pre>
</div>

<p>
4.5 SOCK显示套接字信息
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">sar -n SOCK 2 10</span>
[root@node1 ~]# sar -n SOCK 2 10
Linux 3.10.0-229.el7.x86_64 (node1)     2016&#24180;06&#26376;29&#26085;     _x86_64_    (2 CPU)

00&#26102;18&#20998;42&#31186;    totsck    tcpsck    udpsck    rawsck   ip-frag    tcp-tw
00&#26102;18&#20998;44&#31186;       459         4         4         0         0         0
00&#26102;18&#20998;46&#31186;       459         4         4         0         0         0

&#36755;&#20986;&#39033;&#35828;&#26126;&#65306;
Totsck&#65292;&#31995;&#32479;&#20351;&#29992;&#30340;socket&#24635;&#25968;&#12290;
Tcpsck&#65292;&#24403;&#21069;&#20351;&#29992;&#20013;&#30340;TCP socket&#25968;&#37327;&#12290;
Udpsck&#65292;&#24403;&#21069;&#20351;&#29992;&#20013;&#30340;UDP socket&#25968;&#37327;&#12290;
Rawsck&#65292;&#24403;&#21069;&#20351;&#29992;&#20013;&#30340;RAW socket&#25968;&#37327;&#12290;
ip-frag&#65292;&#24403;&#21069;&#22312;&#38431;&#21015;&#20013;IP&#20998;&#29255;&#30340;&#25968;&#37327;&#12290;
tcp-tw&#65292;&#22788;&#20110;TIME_WAIT&#29366;&#24577;&#30340;TCP socket&#30340;&#25968;&#37327;
</pre>
</div>

<p>
4.6
IP，报告有关IPv4网络流量的统计数据。注意，IPv4统计数据的收集依赖于sadc“-S
SNMP”选项。显示下面的值（方括号中的是正式SNMP名称）：
</p>

<div class="org-src-container">
<pre class="src src-sh">irec/s&#65292;&#27599;&#31186;&#20174;&#25509;&#21475;&#25509;&#25910;&#21040;&#30340;&#36755;&#20837;&#25968;&#25454;&#25253;&#30340;&#24635;&#25968;&#65292;&#21253;&#25324;&#38169;&#35823;&#25509;&#25910;[ipInReceives]&#12290;
fwddgm/s&#65292;&#27599;&#31186;&#36755;&#20837;&#25968;&#25454;&#25253;&#30340;&#25968;&#37327;&#65292;&#36825;&#24182;&#19981;&#26159;&#23427;&#20204;&#26368;&#32456;&#30340;IP&#30446;&#30340;&#22320;&#65292;&#20854;&#32467;&#26524;&#26159;&#35797;&#22270;&#25214;&#21040;&#19968;&#20010;&#36335;&#30001;&#36716;&#21457;&#23427;&#20204;&#21040;&#26368;&#32456;&#30340;&#30446;&#30340;&#22320;[ipForwDatagrams]&#12290;
idel/s&#65292;&#27599;&#31186;&#25104;&#21151;&#20256;&#36882;&#21040;IP&#29992;&#25143;&#21327;&#35758;&#30340;&#36755;&#20837;&#25968;&#25454;&#25253;&#30340;&#24635;&#25968;&#65288;&#21253;&#25324;ICMP&#65289;[ipInDelivers]&#12290;
orq/s&#65292;&#27599;&#31186;&#25552;&#20379;&#30340;&#26412;&#22320;IP&#29992;&#25143;&#21327;&#35758;&#65288;&#21253;&#25324;ICMP&#65289;&#21040;&#20256;&#36755;&#35831;&#27714;IP[ipOutRequests]&#30340;IP&#25968;&#25454;&#25253;&#24635;&#25968;&#12290;&#27880;&#24847;&#65292;&#36825;&#20010;&#35745;&#25968;&#22120;&#19981;&#21253;&#21547;fwddgm/s&#35745;&#31639;&#30340;&#20219;&#20309;&#25968;&#25454;&#25253;&#12290;
asmrq/s&#65292;&#27599;&#31186;&#25509;&#25910;&#30340;&#38656;&#35201;&#37325;&#32452;&#23454;&#20307;&#30340;IP&#20998;&#29255;&#25968;&#37327;[ipReasmReqds]&#12290;
asmok/s&#65292;&#27599;&#31186;&#25104;&#21151;&#37325;&#32452;&#23454;&#20307;&#30340;IP&#25968;&#25454;&#25253;&#25968;&#37327;[ipReasmOKs]&#12290;
fragok/s&#65292;&#27599;&#31186;&#23545;&#23454;&#20307;&#24050;&#32463;&#25104;&#21151;&#20998;&#29255;&#30340;IP&#25968;&#25454;&#25253;&#25968;&#37327;[ipFragOKs]&#12290;
fragcrt/s&#65292;&#27599;&#31186;&#29983;&#25104;&#30340;IP&#25968;&#25454;&#25253;&#20998;&#29255;&#30340;&#25968;&#37327;&#65292;&#20316;&#20026;&#23454;&#20307;&#20998;&#29255;&#30340;&#19968;&#20010;&#32467;&#26524;[ipFragCreates]&#12290;
</pre>
</div>

<p>
4.7 EIP，报告有关IPv4网络错误的统计数据。注意，IPv4统计数据依赖于sadc“-S
SNMP”选项的收集。显示下面的值（方括号中的是正式SNMP名称）：
</p>

<div class="org-src-container">
<pre class="src src-sh">ihdrerr/s&#65292;&#30001;&#20110;IP&#25253;&#22836;&#38169;&#35823;&#65292;&#27599;&#31186;&#20002;&#24323;&#36755;&#20837;&#25968;&#25454;&#25253;&#30340;&#25968;&#37327;&#65292;&#21253;&#25324;&#38169;&#35823;&#30340;checksum&#12289;&#29256;&#26412;&#21495;&#19981;&#21305;&#37197;&#12289;&#20854;&#20182;&#26684;&#24335;&#38169;&#35823;&#12289;&#36229;&#36807;&#20102;&#29983;&#23384;&#26102;&#38388;&#12289;&#22312;&#22788;&#29702;&#23427;&#30340;IP&#36873;&#39033;&#26102;&#21457;&#29616;&#38169;&#35823;&#65292;&#31561;&#31561;[ipInHdrErrors]&#12290;
iadrerr/s&#65292;&#27599;&#31186;&#20002;&#24323;&#36755;&#20837;&#25968;&#25454;&#25253;&#30340;&#25968;&#37327;&#65292;&#22240;&#20026;&#36825;&#20010;&#23454;&#20307;&#25509;&#25910;&#30340;IP&#25253;&#22836;&#30446;&#26631;&#22320;&#22336;&#23383;&#27573;&#30340;IP&#22320;&#22336;&#19981;&#26159;&#19968;&#20010;&#26377;&#25928;&#30340;&#22320;&#22336;&#12290;&#36825;&#20010;&#35745;&#25968;&#21253;&#21547;&#26080;&#25928;&#30340;&#22320;&#22336;&#65288;&#20363;&#22914;0.0.0.0&#65289;&#21644;&#19981;&#25903;&#25345;&#30340;&#22320;&#22336;&#31867;&#65288;&#20363;&#22914;&#65292;E&#31867;&#65289;&#12290;&#22914;&#26524;&#23454;&#20307;&#19981;&#26159;IP&#36335;&#30001;&#22120;&#32780;&#19988;&#19981;&#36716;&#21457;&#25968;&#25454;&#25253;&#65292;&#21017;&#36825;&#20010;&#35745;&#25968;&#22120;&#21253;&#25324;&#22240;&#20026;&#30446;&#26631;&#22320;&#22336;&#19981;&#26159;&#26412;&#22320;&#22320;&#22336;&#20002;&#24323;&#30340;&#25968;&#25454;&#25253;[ipInAddrErrors]&#12290;
iukwnpr/s&#65292;&#22240;&#20026;&#26410;&#30693;&#25110;&#19981;&#25903;&#25345;&#30340;&#21327;&#35758;&#27599;&#31186;&#25104;&#21151;&#25509;&#25910;&#20294;&#26159;&#34987;&#20002;&#24323;&#30340;&#26412;&#22320;&#22320;&#22336;&#30340;&#25968;&#25454;&#25253;&#25968;&#37327;&#12290;
idisc/s&#65292;&#27599;&#31186;&#36755;&#20837;IP&#25968;&#25454;&#25253;&#30340;&#25968;&#37327;&#12290;&#27809;&#26377;&#36935;&#21040;&#38459;&#27490;&#23427;&#32487;&#32493;&#34987;&#22788;&#29702;&#30340;&#38382;&#39064;&#65292;&#20294;&#26159;&#34987;&#20002;&#24323;&#65288;&#20363;&#22914;&#65292;&#32531;&#20914;&#21306;&#31354;&#38388;&#19981;&#36275;&#65289;[ipInDiscards]&#12290;&#27880;&#24847;&#65292;&#36825;&#20010;&#35745;&#25968;&#22120;&#19981;&#21253;&#25324;&#22312;&#31561;&#24453;&#37325;&#32452;&#26102;&#20002;&#24323;&#30340;&#20219;&#20309;&#25968;&#25454;&#21253;&#12290;
odisc/s&#65292;&#27599;&#31186;&#36755;&#20986;IP&#25968;&#25454;&#25253;&#30340;&#25968;&#37327;&#65292;&#23427;&#20204;&#27809;&#26377;&#36935;&#21040;&#38459;&#27490;&#23427;&#20204;&#20256;&#36755;&#21040;&#23427;&#20204;&#30446;&#30340;&#22320;&#30340;&#38382;&#39064;&#65292;&#20294;&#26159;&#34987;&#20002;&#24323;&#65288;&#20363;&#22914;&#65292;&#32531;&#20914;&#21306;&#31354;&#38388;&#19981;&#36275;&#65289;[ipOutDiscards]&#12290;&#27880;&#24847;&#65292;&#36825;&#20010;&#35745;&#25968;&#22120;&#21253;&#21547;&#22312;fwddgm/s&#20013;&#12290;
onort/s&#65292;&#27599;&#31186;&#20002;&#24323;IP&#25968;&#25454;&#25253;&#30340;&#25968;&#37327;&#65292;&#22240;&#20026;&#27809;&#26377;&#21457;&#29616;&#20256;&#36755;&#23427;&#20204;&#21040;&#23427;&#20204;&#30340;&#30446;&#30340;&#22320;&#30340;&#36335;&#30001;[ipOutNoRoutes]&#12290;&#27880;&#24847;&#65292;&#36825;&#20010;&#35745;&#25968;&#22120;&#21253;&#21547;&#22312;fwddgm/s&#20013;&#36935;&#21040;&#30340;&#8216;no-route&#8217;&#26631;&#20934;&#35745;&#31639;&#30340;&#20219;&#20309;&#25968;&#25454;&#25253;&#12290;&#27880;&#24847;&#65292;&#36825;&#21253;&#21547;&#20102;&#22240;&#20026;&#25152;&#26377;&#30340;&#40664;&#35748;&#36335;&#30001;&#19979;&#32447;&#65292;&#20027;&#26426;&#19981;&#33021;&#36335;&#30001;&#30340;&#20219;&#20309;&#25968;&#25454;&#25253;&#12290;
asmf/s&#65292;&#36890;&#36807;IP&#37325;&#32452;&#31639;&#27861;&#27599;&#31186;&#26816;&#27979;&#21040;&#30340;&#25925;&#38556;&#25968;&#37327;&#65288;&#26080;&#35770;&#20219;&#20309;&#21407;&#22240;&#65292;&#36229;&#26102;&#12289;&#38169;&#35823;&#65292;&#31561;&#31561;&#65289;[ipReasmFails]&#12290;&#27880;&#24847;&#65292;&#36825;&#24182;&#19981;&#19968;&#23450;&#26159;&#34987;&#20002;&#24323;&#30340;IP&#20998;&#29255;&#30340;&#35745;&#25968;&#65292;&#22240;&#20026;&#19968;&#20123;&#31639;&#27861;&#22312;&#25509;&#25910;&#23427;&#20204;&#26102;&#30001;&#20110;&#21512;&#24182;&#23427;&#20204;&#21487;&#33021;&#20250;&#20002;&#22833;&#20998;&#29255;&#30340;&#25968;&#37327;&#12290;
fragf/s&#65292;&#27599;&#31186;&#20002;&#24323;IP&#25968;&#25454;&#25253;&#30340;&#25968;&#37327;&#65292;&#22240;&#20026;&#23454;&#20307;&#38656;&#35201;&#20998;&#29255;&#20294;&#26159;&#19981;&#33021;&#23436;&#25104;&#65292;&#20363;&#22914;&#65292;&#22240;&#20026;&#35774;&#32622;&#20102;&#23427;&#30340;Don&#8217;t Fragment&#26631;&#24535;[ipFragFails]&#12290;
</pre>
</div>

<p>
4.8
ICMP，报告有关ICMPv4网络流量的统计数据。注意，ICMPv4统计数据的收集依赖于sadc“-S
SNMP”选项。显示下面的值：
</p>

<div class="org-src-container">
<pre class="src src-sh">imsg/s&#65292;&#23454;&#20307;&#27599;&#31186;&#25509;&#25910;ICMP&#28040;&#24687;&#30340;&#24635;&#25968;[icmpInMsgs]&#12290;&#27880;&#24847;&#65292;&#36825;&#20010;&#35745;&#25968;&#22120;&#21253;&#25324;&#25152;&#26377;&#30001;ierr/s&#35745;&#31639;&#24471;&#26469;&#30340;&#25968;&#25454;&#12290;
omsg/s&#65292;&#23454;&#20307;&#27599;&#31186;&#23581;&#35797;&#21457;&#36865;ICMP&#28040;&#24687;&#30340;&#24635;&#25968;[icmpOutMsgs]&#12290;&#27880;&#24847;&#65292;&#36825;&#20010;&#35745;&#25968;&#22120;&#21253;&#25324;&#25152;&#26377;&#30001;oerr/s&#35745;&#31639;&#24471;&#26469;&#30340;&#25968;&#25454;&#12290;
iech/s&#65292;&#27599;&#31186;&#25509;&#25910;ICMP Echo&#65288;request&#65289;&#28040;&#24687;&#30340;&#25968;&#37327;[icmpInEchos]&#12290;
iechr/s&#65292;&#27599;&#31186;&#25509;&#25910;ICMP Echo Reply&#28040;&#24687;&#30340;&#25968;&#37327;[icmpInEchoReps]&#12290;
oech/s&#65292;&#27599;&#31186;&#21457;&#36865;ICMP Echo&#65288;request&#65289;&#28040;&#24687;&#30340;&#25968;&#37327;[icmpOutEchos]&#12290;
oechr/s&#65292;&#27599;&#31186;&#21457;&#36865;ICMP Echo Reply&#28040;&#24687;&#30340;&#25968;&#37327;[icmpOutEchoReps]&#12290;
itm/s&#65292;&#27599;&#31186;&#25509;&#25910;ICMP Timestamp&#65288;request&#65289;&#28040;&#24687;&#30340;&#25968;&#37327;[icmpInTimestamps]&#12290;
itmr/s&#65292;&#27599;&#31186;&#25509;&#25910;ICMP Timestamp Reply&#28040;&#24687;&#30340;&#25968;&#37327;[icmpInTimestampReps]&#12290;
otm/s&#65292;&#27599;&#31186;&#21457;&#36865;ICMP Timestamp&#65288;request&#65289;&#28040;&#24687;&#30340;&#25968;&#37327;[icmpOutTimestamps]&#12290;
otmr/s&#65292;&#27599;&#31186;&#21457;&#36865;ICMP Timestamp Reply&#28040;&#24687;&#30340;&#25968;&#37327;[icmpOutTimestampReps]&#12290;
iadrmk/s&#65292;&#27599;&#31186;&#25509;&#25910;ICMP Address Mask Request&#28040;&#24687;&#30340;&#25968;&#37327;[icmpInAddrMasks]&#12290;
iadrmkr/s&#65292;&#27599;&#31186;&#25509;&#25910;ICMP Address Mask Reply&#28040;&#24687;&#30340;&#25968;&#37327;[icmpInAddrMaskReps]&#12290;
oadrmk/s&#65292;&#27599;&#31186;&#21457;&#36865;ICMP Address Mask Request&#28040;&#24687;&#30340;&#25968;&#37327;[icmpOutAddrMasks]&#12290;
</pre>
</div>

<p>
4.9
EICMP，报告有关ICMPv4错误消息的统计数据。注意，ICMPv4统计数据的收集依赖于sadc“-S
SNMP”选项。显示下面的值（方括号中的是正式SNMP名称）：
</p>

<div class="org-src-container">
<pre class="src src-sh">ierr/s&#65292;&#23454;&#20307;&#27599;&#31186;&#25509;&#25910;&#30340;&#34987;&#30830;&#23450;&#20026;&#29305;&#23450;ICMP&#38169;&#35823;&#30340;ICMP&#28040;&#24687;&#25968;&#37327;&#65288;&#38169;&#35823;ICMP&#26657;&#39564;&#21644;&#12289;&#38169;&#35823;&#38271;&#24230;&#65292;&#31561;&#31561;&#65289;[icmpInErrors]&#12290;
oerr/s&#65292;&#23454;&#20307;&#27599;&#31186;&#30001;&#20110;ICMP&#20869;&#21457;&#29616;&#38169;&#35823;&#32780;&#27809;&#26377;&#21457;&#36865;&#65288;&#27604;&#22914;&#32531;&#20914;&#21306;&#19981;&#36275;&#65289;&#30340;ICMP&#28040;&#24687;&#30340;&#25968;&#37327;[icmpOutErrors]&#12290;
idstunr/s&#65292;&#27599;&#31186;&#25509;&#25910;&#30340;ICMP&#30446;&#30340;&#22320;&#19981;&#21487;&#36798;&#30340;&#25968;&#37327;[icmpInDestUnreachs]&#12290;
odstunr/s&#65292;&#27599;&#31186;&#21457;&#36865;&#30340;ICMP&#30446;&#30340;&#22320;&#19981;&#21487;&#36798;&#30340;&#25968;&#37327;[icmpOutDestUnreachs]&#12290;
itmex/s&#65292;&#27599;&#31186;&#25509;&#25910;&#30340;ICMP&#36229;&#26102;&#28040;&#24687;&#30340;&#25968;&#37327;[icmpInTimeExcds]&#12290;
otmex/s&#65292;&#27599;&#31186;&#21457;&#36865;&#30340;ICMP&#36229;&#26102;&#28040;&#24687;&#30340;&#25968;&#37327;[icmpOutTimeExcds]&#12290;
iparmpb/s&#65292;&#27599;&#31186;&#25509;&#25910;&#30340;ICMP&#21442;&#25968;&#38169;&#35823;&#28040;&#24687;&#30340;&#25968;&#37327;[icmpInParmProbs]&#12290;
oparmpb/s&#65292;&#27599;&#31186;&#21457;&#36865;&#30340;ICMP&#21442;&#25968;&#38169;&#35823;&#28040;&#24687;&#30340;&#25968;&#37327;[icmpOutParmProbs]&#12290;
isrcq/s&#65292;&#27599;&#31186;&#25509;&#25910;&#30340;ICMP&#28304;&#25233;&#21046;&#28040;&#24687;&#30340;&#25968;&#37327;[icmpInSrcQuenchs]&#12290;
osrcq/s&#65292;&#27599;&#31186;&#21457;&#36865;&#30340;ICMP&#28304;&#25233;&#21046;&#28040;&#24687;&#30340;&#25968;&#37327;[icmpOutSrcQuenchs]&#12290;
iredir/s&#65292;&#27599;&#31186;&#25509;&#25910;&#30340;ICMP&#37325;&#23450;&#21521;&#28040;&#24687;&#30340;&#25968;&#37327;[icmpInRedirects]&#12290;
oredir/s&#65292;&#27599;&#31186;&#21457;&#36865;&#30340;ICMP&#37325;&#23450;&#21521;&#28040;&#24687;&#30340;&#25968;&#37327;[icmpOutRedirects]&#12290;
</pre>
</div>

<p>
4.10
TCP，报告有关TCPv4网络流量的统计数据。注意，TCPv4统计数据的收集依赖于sadc“-S
SNMP”选项。显示下面的值（方括号中的是正式SNMP名称）：
</p>

<div class="org-src-container">
<pre class="src src-sh">active/s&#65292;&#27599;&#31186;TCP&#36830;&#25509;&#20174;CLOSED&#29366;&#24577;&#30452;&#25509;&#36716;&#25442;&#21040;SYN-SENT&#29366;&#24577;&#30340;&#27425;&#25968;[tcpActiveOpens]&#12290;
passive/s&#65292;&#27599;&#31186;TCP&#36830;&#25509;&#20174;LISTEN&#29366;&#24577;&#30452;&#25509;&#36716;&#25442;&#21040;SYN-RCVD&#29366;&#24577;&#30340;&#27425;&#25968;[tcpPassiveOpens]&#12290;
iseg/s&#65292;&#27599;&#31186;&#25509;&#25910;&#20998;&#27573;&#30340;&#24635;&#25968;&#65292;&#21253;&#25324;&#38169;&#35823;&#30340;&#25509;&#25910;[tcpInSegs]&#12290;&#36825;&#20010;&#35745;&#25968;&#21253;&#25324;&#22312;&#24403;&#21069;&#24050;&#32463;&#24314;&#31435;&#36830;&#25509;&#19978;&#25509;&#25910;&#30340;&#20998;&#27573;&#12290;
oseg/s&#65292;&#27599;&#31186;&#21457;&#36865;&#20998;&#27573;&#30340;&#24635;&#25968;&#65292;&#21253;&#25324;&#24403;&#21069;&#36830;&#25509;&#20294;&#19981;&#21253;&#25324;&#21482;&#21253;&#21547;&#37325;&#21457;&#30340;&#23383;&#33410;[tcpOutSegs]&#12290;
</pre>
</div>

<p>
4.11
ETCP，报告TCPv4网络错误的统计数据。注意，TCPv4统计数据的收集依赖于sadc“-S
SNMP”选项。显示下面的值（方括号中的是正式SNMP名称）：
</p>

<div class="org-src-container">
<pre class="src src-sh">atmptf/s&#65292;&#27599;&#31186;TCP&#36830;&#25509;&#20174;SYN-SENT&#29366;&#24577;&#25110;SYN-RCVD&#29366;&#24577;&#30452;&#25509;&#36716;&#25442;&#21040;CLOSED&#29366;&#24577;&#30340;&#27425;&#25968;&#65292;&#21152;&#19978;&#27599;&#31186;TCP&#36830;&#25509;&#20174;SYN-RCVD&#29366;&#24577;&#30452;&#25509;&#36716;&#25442;&#21040;LISTEN&#29366;&#24577;&#30340;&#27425;&#25968;[tcpAttemptFails]&#12290;
estres/s&#65292;&#27599;&#31186;TCP&#36830;&#25509;&#20174;ESTABLISHED&#29366;&#24577;&#25110;CLOSE-WAIT&#29366;&#24577;&#30452;&#25509;&#36716;&#25442;&#21040;CLOSED&#29366;&#24577;&#30340;&#27425;&#25968;[tcpEstabResets]&#12290;
retrans/s&#65292;&#27599;&#31186;&#37325;&#21457;&#30340;&#20998;&#27573;&#24635;&#25968;&#65292;&#21363;&#20256;&#36755;TCP&#20998;&#27573;&#21253;&#21547;&#20102;&#19968;&#20010;&#25110;&#22810;&#20010;&#20043;&#21069;&#21457;&#36865;&#30340;&#23383;&#33410;[tcpRetransSegs]&#12290;
isegerr/s&#65292;&#27599;&#31186;&#25509;&#25910;&#38169;&#35823;&#20998;&#27573;&#65288;&#20363;&#22914;&#65292;&#38169;&#35823;&#30340;TCP&#26657;&#39564;&#21644;&#65289;&#30340;&#24635;&#25968;[tcpInErrs]&#12290;
orsts/s&#65292;&#27599;&#31186;&#21457;&#36865;&#30340;&#21253;&#21547;RST&#26631;&#24535;&#30340;TCP&#20998;&#27573;&#25968;&#37327;[tcpOutRsts]&#12290;
</pre>
</div>

<p>
4.12
UDP，报告有关UDPv4网络流量的统计数据。注意，UCPv4统计数据的收集依赖于sadc“-S
SNMP”选项。显示下面的值（方括号中的是正式SNMP名称）：
</p>

<div class="org-src-container">
<pre class="src src-sh">idgm/s&#65292;&#27599;&#31186;&#36716;&#21457;&#21040;UDP&#29992;&#25143;&#30340;UDP&#25968;&#25454;&#25253;&#25991;&#30340;&#24635;&#25968;[udpInDatagrams]&#12290;
odgm/s&#65292;&#27599;&#31186;&#23454;&#20307;&#21457;&#36865;&#30340;UPD&#25968;&#25454;&#25253;&#25991;&#30340;&#24635;&#25968;[udpOutDatagrams]&#12290;
noport/s&#65292;&#27599;&#31186;&#25509;&#25910;&#30340;UDP&#25968;&#25454;&#25253;&#25991;&#30340;&#24635;&#25968;&#65292;&#20294;&#26159;&#30446;&#26631;&#22320;&#22336;&#23646;&#20110;&#20219;&#20309;&#24212;&#29992;&#31243;&#24207;[udpNoPorts]&#12290;
idgmerr/s&#65292;&#27599;&#31186;&#25509;&#25910;&#30340;&#19981;&#33021;&#36716;&#21457;&#30340;UDP&#25968;&#25454;&#25253;&#25991;&#30340;&#25968;&#37327;&#65292;&#21407;&#22240;&#26159;&#32570;&#23569;&#24212;&#29992;&#31243;&#24207;&#30340;&#30446;&#26631;&#31471;&#21475;[udpInErrors]&#12290;
</pre>
</div>



<figure id="org9a7e4ad">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210301174546625.png" alt="image-20210301174546625.png" width="50%">

</figure>
</div>
</div>
<div id="outline-container-h:c8cc55b7-606a-449b-aa78-0cbab6aede60" class="outline-4">
<h4 id="h:c8cc55b7-606a-449b-aa78-0cbab6aede60">glances综合监控工具</h4>
<div class="outline-text-4" id="text-h:c8cc55b7-606a-449b-aa78-0cbab6aede60">
<p>
此工具可以通过EPEL源安装 格式:
</p>

<div class="org-src-container">
<pre class="src src-sh">glances [-bdehmnrsvyz1] [-B bind] [-c server] [-C conffile] [-p port] [-P
password] [--password] [-t refresh] [-f file] [-o output]
</pre>
</div>

<p>
内建命令：
</p>

<div class="org-src-container">
<pre class="src src-sh">h &#24110;&#21161;
a Sort processes automatically     l Show/hide logs
c Sort processes by CPU%           b Bytes or bits for network I/O
m Sort processes by MEM%         w Delete warning logs
p Sort processes by name             x Delete warning and critical logs
i Sort processes by I/O rate           1 Global CPU or per-CPU stats
d Show/hide disk I/O stats             h Show/hide this help screen
f Show/hide file system stats         t View network I/O as combination
n Show/hide network stats            u View cumulative network I/O
s Show/hide sensors stats            q Quit (Esc and Ctrl-C also work)
y Show/hide hddtemp stats
</pre>
</div>

<p>
常用选项:
</p>

<pre class="example" id="orgede0c5b">
-b: 以Byte为单位显示网卡数据速率
-d: 关闭磁盘I/O模块
-f /path/to/somefile: 设定输入文件位置
-o {HTML|CSV}：输出格式
-m: 禁用mount模块
-n: 禁用网络模块
-t #: 延迟时间间隔
-1：每个CPU的相关数据单独显示 
</pre>

<p>
<b>C/S模式下运行glances命令</b>
</p>

<ul class="org-ul">
<li>服务器模式:
glances -s -B IPADDR</li>
<li><p>
客户端模式:
glances -c IPADDR
</p>

<p>
IPADDR:要连入的服务器端地址
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:a539a95d-65d6-418d-a3a0-b1fa9de5fb9e" class="outline-4">
<h4 id="h:a539a95d-65d6-418d-a3a0-b1fa9de5fb9e">cockpit系统web管理</h4>
<div class="outline-text-4" id="text-h:a539a95d-65d6-418d-a3a0-b1fa9de5fb9e">
<p>
由cockpit包提供 Cockpit 是CentOS 8 取入的新特性，是一个基于 Web
界面的应用，它提供了对系统的图形化管理。 支持ubuntu, centos等
</p>

<ul class="org-ul">
<li>监控系统活动（CPU、内存、磁盘 IO 和网络流量）</li>
<li>查看系统日志条目</li>
<li>查看磁盘分区的容量</li>
<li>查看网络活动（发送和接收）</li>
<li>查看用户帐户</li>
<li>检查系统服务的状态</li>
<li>提取已安装应用的信息</li>
<li>查看和安装可用更新（如果以 root 身份登录）并在需要时重新启动系统</li>
<li>打开并使用终端窗口</li>
</ul>


<p>
范例:安装cockpit
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#dnf -y install cockpit
[root@centos8 ~]#systemctl enable --now cockpit.socket
</pre>
</div>

<p>
打开浏览器,访问以下地址:
</p>

<pre class="example" id="orgd1034f7">
https://centos8:9090
</pre>



<figure id="org1ed536f">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210119175947600.png" alt="image-20210119175947600.png" width="50%">

</figure>
</div>
</div>
<div id="outline-container-h:ced46580-24cc-4081-8d3b-f7fce4119f9f" class="outline-4">
<h4 id="h:ced46580-24cc-4081-8d3b-f7fce4119f9f">webmin综合管理平台</h4>
<div class="outline-text-4" id="text-h:ced46580-24cc-4081-8d3b-f7fce4119f9f">
<p>
官网:<a href="http://www.webmin.com/">http://www.webmin.com/</a>
</p>

<p>
下载:<a href="http://www.webmin.com/download.html">http://www.webmin.com/download.html</a>
</p>

<p>
Webmin是目前功能最强大的基于Web的Unix系统管理工具。管理员通过浏览器访
问Webmin的各种管理功能并完成相应的管理动作。目前Webmin支持绝大多数的
Unix系统，这些系统除了各种版本的linux以外还包括：AIX、HPUX、Solaris、
Unixware、Irix和FreeBSD等
</p>

<pre class="example" id="org8401386">
[root@centos8 ~]#wget http://prdownloads.sourceforge.net/webadmin/webmin-1.941-
1.noarch.rpm
[root@centos8 ~]#yum -y install webmin-1.941-1.noarch.rpm
[root@centos8 ~]#chkconfig --list
[root@centos8 ~]#service webmin start
[root@centos8 ~]#ss -ntl
</pre>

<p>
<a href="https://webmin.com/screenshots/">https://webmin.com/screenshots/</a>
</p>
</div>
</div>
</div>
</section>
<section id="outline-container-h:96cc7c37-b4fa-461a-9ccc-39ed146f93b9" class="outline-2">
<h2 id="h:96cc7c37-b4fa-461a-9ccc-39ed146f93b9">任务计划</h2>
<div class="outline-text-2" id="text-h:96cc7c37-b4fa-461a-9ccc-39ed146f93b9">
<p>
通过任务计划,可以让系统自动的按时间或周期性任务执行任务
</p>

<p>
注意:学习本节需要实现邮件通知,学习内容必须安装并启动邮件服务
</p>

<p>
范例:环境准备
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#yum -y install postfix
[root@centos8 ~]#systemctl enable --now postfix
</pre>
</div>

<p>
未来的某时间点执行一次任务
</p>

<ul class="org-ul">
<li>at 指定时间点,执行一次性任务</li>
<li>batch 系统自行选择空闲时间去执行此处指定的任务周期性运行某任务</li>
<li>cron</li>
</ul>
</div>
<div id="outline-container-h:58d2bcee-e888-4855-bb25-448d3651ca39" class="outline-3">
<h3 id="h:58d2bcee-e888-4855-bb25-448d3651ca39">at一次性任务</h3>
<div class="outline-text-3" id="text-h:58d2bcee-e888-4855-bb25-448d3651ca39">
<p>
at工具
</p>

<ul class="org-ul">
<li>由包at提供</li>
<li>依赖于atd服务,需要启动才能实现at任务</li>
<li>at队列存放在/var/spool/at目录中</li>
<li>执行任务时PATH变量的值和当前定义任务的用户身份一致</li>
<li><b>在未来某时间点一次执行某任务,命令结果在邮件里</b></li>
</ul>

<p>
at命令:
</p>

<div class="org-src-container">
<pre class="src src-sh">at [option] TIME

&#24120;&#29992;&#36873;&#39033;:
-V &#26174;&#31034;&#29256;&#26412;&#20449;&#24687;
-t time &#26102;&#38388;&#26684;&#24335; [[CC]YY]MMDDhhmm[.ss]
-l &#21015;&#20986;&#25351;&#23450;&#38431;&#21015;&#20013;&#31561;&#24453;&#36816;&#34892;&#30340;&#20316;&#19994;&#65307;&#30456;&#24403;&#20110;atq
-d N &#21024;&#38500;&#25351;&#23450;&#30340;N&#21495;&#20316;&#19994;&#65307;&#30456;&#24403;&#20110;atrm
-c N &#26597;&#30475;&#20855;&#20307;&#20316;&#19994;N&#21495;&#20219;&#21153;
-f file &#25351;&#23450;&#30340;&#25991;&#20214;&#20013;&#35835;&#21462;&#20219;&#21153;
-m &#24403;&#20219;&#21153;&#34987;&#23436;&#25104;&#20043;&#21518;&#65292;&#23558;&#32473;&#29992;&#25143;&#21457;&#36865;&#37038;&#20214;&#65292;&#21363;&#20351;&#27809;&#26377;&#26631;&#20934;&#36755;&#20986; 


TIME:&#23450;&#20041;&#20160;&#20040;&#26102;&#20505;&#36827;&#34892;at&#36825;&#39033;&#20219;&#21153;&#30340;&#26102;&#38388;
HH:MM   [YYYY-mm-dd]                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30452;&#25509;&#25351;&#26126;&#20855;&#20307;&#30340;&#26102;&#38388;&#65292;&#22914; at 03:45,   at 02:00 2016-09-20</span>
noon,midnight,teatime(4pm)               <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20013;&#21320;&#12289;&#21320;&#22812;&#12289;&#19979;&#21320;&#33590;&#26102;&#38388;(&#19979;&#21320;&#22235;&#28857;&#24038;&#21491;)</span>
tomorrow                                            <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26126;&#22825;</span>
now+#{minutes,hours,days,OR weeks}  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29616;&#22312;&#20043;&#21518;&#30340;&#22810;&#20037;&#65292;&#21487;&#20351;&#29992;&#34920;&#31034;&#21333;&#20301;&#20026;minutes, hours, days, OR weeks. &#22914; at now+5min</span>
UNIT:minutes,hours,days,OR weeks

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32452;&#21512;</span>
HH:MM[am|pm] [Month] [Date]          <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;at 06pm March 17,   at 17:20 tomorrow</span>
HH:MM[am|pm] + number [minutes|hours|days|weeks] <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;&#26576;&#20010;&#26102;&#38388;&#28857;&#20877;&#21152;&#20960;&#20010;&#26102;&#38388;&#21518;&#25165;&#36827;&#34892;&#35813;&#39033;&#20219;&#21153;. &#22914;at now + 5min , at 02pm + 3days</span>

Ctrl+D &#65306;&#25552;&#20132;&#19968;&#27425;&#24615;&#20219;&#21153;&#65292;&#36864;&#20986;at
</pre>
</div>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@proxy ~]# date
Mon Sep 30 03:41:06 UTC 2024
[root@proxy ~]# at 03:45  <span style="color: #b22222;">#</span><span style="color: #b22222;">03:45&#25191;&#34892;&#20219;&#21153;</span>
at&gt; touch /tmp/at.log
at&gt; echo at job
<span style="color: #b22222;">#</span><span style="color: #b22222;">ctrl + d &#36864;&#20986;</span>

at now+5min  <span style="color: #b22222;">#</span><span style="color: #b22222;">5&#20998;&#38047;&#21518;&#25191;&#34892;&#20219;&#21153;</span>

<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">'wall at job'</span> | at 03:46  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25509;&#25910;&#26631;&#20934;&#36755;&#20837;&#30340;&#20219;&#21153;</span>
at 03:46 &lt; &lt;(<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">'wall at job'</span>)
at 03:45 -f filenmae

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26816;&#26597;</span>
atq       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20219;&#21153;&#21015;&#34920;&#65292;&#30456;&#24403;&#20110;at -l</span>
at -c 1  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26816;&#26597;&#20219;&#21153;&#20855;&#20307;&#20869;&#23481;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500;&#35745;&#21010;&#20219;&#21153;</span>
at -d 1 <span style="color: #b22222;">#</span><span style="color: #b22222;">1&#20195;&#34920;at -l &#20013;&#30340;&#32534;&#21495;</span>
</pre>
</div>

<p>
<b>注意:</b>
</p>
<ul class="org-ul">
<li>作业执行命令的结果中的标准输出和错误以执行任务的用户身份发邮件通知给root. 使用mail命令检查</li>
<li>at任务内容存放在磁盘中, centos: <i>var/spool/at</i>  ubuntu: /var/spool/cron/atjobs</li>
</ul>

<p>
at任务执行方式:
</p>
<ul class="org-ul">
<li>交互式</li>
<li>管道</li>
<li>输入重定向</li>
<li>at -f file</li>
</ul>

<p>
/etc/at.{follow,deny}控制用户是否能执行at任务
</p>
<ul class="org-ul">
<li>白名单:/etc/at.allow默认不存在,只有该文件中的用户才能执行at命令</li>
<li>黑名单:/etc/at.deny默认存在,拒绝该文件中用户执行at命令,而没有在
at.deny文件中的使用者则可执行</li>
<li>如果两个文件都不存在,只有root可以执行at命令</li>
</ul>
</div>
</div>
<div id="outline-container-h:ae1143a1-3fda-43e9-8b4b-f99a32f1d8df" class="outline-3">
<h3 id="h:ae1143a1-3fda-43e9-8b4b-f99a32f1d8df">cront周期性任务计划</h3>
<div class="outline-text-3" id="text-h:ae1143a1-3fda-43e9-8b4b-f99a32f1d8df">
<p>
周期性任务计划cron相关的程序包
</p>

<ul class="org-ul">
<li>cronie:主程序包,提供crond守护进程及相关辅助工具</li>
<li>crontabs:包含CentOS提供系统维护任务</li>
<li>cronie-anacron:cronie的补充程序,用于监控cronie任务执行状况,如:cronie
中的任务在过去该运行的时间点未能正常运行,则anacron会随后启动一次此任
务</li>
</ul>

<p>
cron依赖于crond服务,确保crond守护处于运行状态:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">CentOS7&#20197;&#21518;&#29256;&#26412;:</span>
systemctl status crond

<span style="color: #b22222;">#</span><span style="color: #b22222;">CentOS6</span>
service crond status
</pre>
</div>

<p>
cron任务分为
</p>

<ul class="org-ul">
<li>系统cron任务:  系统维护作业, /etc/crontab主配置文件, /etc/cron.d/子配置文件</li>
<li>用户cron任务:  保存在/var/spool/cron/USERNAME, 利用crontab命令管理</li>
</ul>

<p>
计划任务日志:/var/log/cron
</p>
</div>
<div id="outline-container-h:58d06a8b-70d6-4f82-a301-4841fbd576b9" class="outline-4">
<h4 id="h:58d06a8b-70d6-4f82-a301-4841fbd576b9">系统cron计划任务</h4>
<div class="outline-text-4" id="text-h:58d06a8b-70d6-4f82-a301-4841fbd576b9">
<p>
/etc/crontab格式说明:man 5 crontab
注释行以 # 开头
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /etc/crontab
<span style="color: #a0522d;">SHELL</span>=/bin/bash <span style="color: #b22222;">#</span><span style="color: #b22222;">&#40664;&#35748;&#30340;SHELL&#31867;&#22411;</span>
<span style="color: #a0522d;">PATH</span>=/sbin:/bin:/usr/sbin:/usr/bin <span style="color: #b22222;">#</span><span style="color: #b22222;">&#40664;&#35748;&#30340;PATH&#21464;&#37327;&#20540;,&#21487;&#20462;&#25913;&#20026;&#20854;&#23427;&#36335;&#24452;</span>
<span style="color: #a0522d;">MAILTO</span>=root <span style="color: #b22222;">#</span><span style="color: #b22222;">&#40664;&#35748;&#26631;&#20934;&#36755;&#20986;&#21644;&#38169;&#35823;&#21457;&#37038;&#20214;&#32473;root,&#21487;&#20197;&#25351;&#21521;&#20854;&#23427;&#29992;&#25143;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">For details see man 4 crontabs</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">Example of job definition:</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">.---------------- minute (0 - 59)</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">| .------------- hour (0 - 23)</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">| | .---------- day of month (1 - 31)</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">| | | .------- month (1 - 12) OR jan,feb,mar,apr ... </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">| | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">sun,mon,tue,wed,thu,fri,sat</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">| | | | |</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">* * * * * user-name command to be executed</span>
</pre>
</div>

<p>
<b>计划任务时间表示法</b>
</p>



<figure id="org567585c">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/linux/linux/images/image-20210214032148463.png" alt="image-20210214032148463.png" width="50%">

</figure>

<pre class="example" id="orgb6b5da3">
(1) 特定值
   *  ,  -  /
   给定时间点有效取值范围内的值
   注意：day of week和day of month一般不同时使用；
(2) *
   给定时间点上有效取值范围内的所有值,表示"每...",放在星期的位置表示不确定
(3) 离散取值
   在时间点上使用逗号分隔的多个值；
   #,#,# 
   如，0 8,20 * * 3,7：离散，每周3和周日的8点和20点执行
(4) 连续取值
   在时间点上使用-连接开头和结束
   #-#
   如，0 9-18 * * 1-5：连续，每周1到周5的9点到18点执行
(5)  在指定时间范围上,定义步长
    /#:#即为步长
    如，*/5 * * * *：每5分钟执行一次任务
(6) 特定关键字
@yearly 0 0 1 1 *
@annually 0 0 1 1 *
@monthly 0 0 1 * *
@weekly 0 0 * * 0
@daily 0 0 * * *
@hourly 0 * * * *
@reboot Run once after reboot

注意：
(1)指定的时间点不能被步长整除时，其意义将不复存在；
(2)最小时间单位为"分钟"，想完成"秒"级任务，得需要额外借助于其他机制；
定义每分钟任务：而在利用脚本实现在每分钟之内，循环运行
</pre>

<p>
范例:
</p>

<pre class="example" id="org8c92a60">
示例：
(1)3 * * * *：每小时的第3分钟；
(2)3 4 * * 5：每周执行一次：每周五4点3分；
(3)5 6 7 * *：每月执行一次：每月的7号的6点5分；
(4)7 8 9 10 *：每年执行一次：每年的10月9号8点7分；
(5)9 8 * * 3,7：每周三和周日

#晚上9点10分运行echo命令,输出信息仍会发送到root 邮箱
10 21 * * * kobe /usr/bin/echo "haha"

#每3小时echo和wall命令
0 */3 * * * kobe /usr/bin/echo "haha";/usr/bin/wall "Hello,I am kobe."

0 10  * * * root  /usr/local/python37/bin/python3 /data/script/cardgames.py
0 18  * * * root  /usr/local/python37/bin/python3 /data/script/cardgames.py

# nginx 20秒健康检查
#!/bin/bash

i=0
interval=3
count=$[60/$interval]   # $[]只能进行整数运算
while [ $i -lt $count ]; do
    nginx_arr=(pgrep nginx)
    if [ ${#nginx_arr[@]} == 0 ]; then
        nginx  -c  /usr/local/nginx/etc/nginx.conf &gt;/dev/null   2&gt;&amp;1
    fi
    ((i++))
    sleep $interval
done
</pre>

<p>
crond任务相关文件:
</p>

<pre class="example" id="orgc349d2d">
/etc/crontab 配置文件
/etc/cron.d/ 配置文件
/etc/cron.hourly/ 脚本
/etc/cron.daily/ 脚本
/etc/cron.weekly/ 脚本
/etc/cron.monthly/ 脚本 
</pre>
</div>
</div>
<div id="outline-container-h:5a006901-d26c-424c-8393-5176af2cea82" class="outline-4">
<h4 id="h:5a006901-d26c-424c-8393-5176af2cea82">anacron</h4>
<div class="outline-text-4" id="text-h:5a006901-d26c-424c-8393-5176af2cea82">
<p>
运行计算机关机时cron不运行的任务,CentOS6以后版本取消anacron服务,由
crond服务管理,对笔记本电脑,台式机,工作站,偶尔要关机的服务器及其它不一
直开机的系统很重要
</p>

<p>
由/etc/cron.hourly/0anacron执行，当执行任务时，更新/var/spool/anacron/cron.daily
文件的时间戳
</p>

<p>
配置文件：/etc/anacrontab，负责执行/etc/ cron.daily
/etc/cron.weekly /etc/cron.monthly中系统任务
</p>

<p>
/etc/anacrontab格式说明
</p>

<ul class="org-ul">
<li>字段1：如果在这些日子里没有运行这些任务&#x2026;&#x2026;</li>
<li>字段2：在重新引导后等待这么多分钟后运行它</li>
<li>字段3：任务识别器，在日志文件中标识 字段4：要执行的任务</li>
</ul>
</div>
</div>
<div id="outline-container-h:b803f365-45c1-49c0-b327-c3cde65d1016" class="outline-4">
<h4 id="h:b803f365-45c1-49c0-b327-c3cde65d1016">管理临时文件</h4>
<div class="outline-text-4" id="text-h:b803f365-45c1-49c0-b327-c3cde65d1016">
<p>
CentOS 7 使用 systemd-tmpfiles-setup服务实现
</p>

<p>
CentOS 6 使用/etc/cron.daily/tmpwatch定时清除临时文件
</p>

<p>
<b>配置文件</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">/etc/tmpfiles.d/*.conf
/run/tmpfiles.d/*.conf
/usr/lib/tmpfiles/*.conf 
</pre>
</div>

<p>
命令:
</p>

<div class="org-src-container">
<pre class="src src-sh">systemd-tmpfiles &#8211;clean|remove|create configfile
</pre>
</div>
</div>
</div>
<div id="outline-container-h:5d47d219-e4c1-4e22-93ee-77d4d7d80930" class="outline-4">
<h4 id="h:5d47d219-e4c1-4e22-93ee-77d4d7d80930">用户计划任务</h4>
<div class="outline-text-4" id="text-h:5d47d219-e4c1-4e22-93ee-77d4d7d80930">
<p>
crontab命令:
</p>

<ul class="org-ul">
<li>每个用户都有专用的cron任务文件:/var/spool/cron/USERNAME</li>
<li>默认标准输出和错误会被发邮件给对应的用户,如：cici创建的任务就发送至
cici的邮箱</li>
<li>root能够修改其它用户的作业</li>
<li>用户的cron 中默认PATH=/usr/bin:/bin,如果使用其它路径,在任务文件的第
一行加PATH=/path或者加入到计划任务执行的脚本中</li>
<li>第六个字段指定要运行的命令。该行的整个命令部分，直至换行符或“％”字
符，指定的shell执行.除非使用反斜杠（\）进行转义，否则该命令中的“％”字
符将变为换行符，并且第一个％之后的所有数据将作为标准输入发送到该命令。</li>
</ul>

<p>
crontab命令格式：
</p>

<pre class="example" id="org882f17a">
crontab [-u user] [-l | -r | -e] [-i]
</pre>

<p>
常用选项:
</p>

<pre class="example" id="org8cc2f0d">
-l 列出所有任务
-e 编辑任务
-r 移除所有任务
-i 同-r一同使用,以交互式模式移除指定任务
-u user 指定用户管理cron任务,仅root可运行
</pre>

<p>
注意1：运行结果以邮件通知给当前用户；如果拒绝拒绝邮件；
</p>

<p>
(1)COMMAND &gt; /dev/null 将正确结果导入到数据黑洞，只报告错误结果
</p>

<p>
(2)COMMAND &amp;&gt; /dev/null 将所有结果都导入数据黑洞
</p>

<p>
注意2: 定义COMMMAND时，如果命令需要用到%,需要对其转义；但放置于单引号中
的%不用转义易可；
</p>

<p>
思考：某任务在指定的时间因关机未能执行；下次开机会不会自动执行；答：不会！
</p>

<p>
crontab 不支持$()
</p>

<p>
控制用户执行任务计划: /etc/cron.{allow,deny}
</p>

<p>
范例：每个月日期和星期几字段的关系
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#25110;&#30340;&#20851;&#31995;man 5 crontab</span>

Note: The day of a command<span style="color: #8b2252;">'s execution can be specified in the</span>
<span style="color: #8b2252;">following two fields &#8212; '</span>day of month<span style="color: #8b2252;">', and '</span>day of week<span style="color: #8b2252;">'.  If both</span>
<span style="color: #8b2252;">fields are restricted (i.e., do not contain the "*" character), the</span>
<span style="color: #8b2252;">command will be run when either field matches the current time.  For</span>
<span style="color: #8b2252;">example, "30 4 1,15 * 5" would cause a command to be run at 4:30 am on</span>
<span style="color: #8b2252;">the 1st and 15th of each month, plus every Friday.</span>
</pre>
</div>

<p>
范例:修改默认的cron的文本编辑工具
</p>

<div class="org-src-container">
<pre class="src src-sh">root@ubuntu1804:~# crontab -e
no crontab for root - using an empty one
Select an editor. To change later, run <span style="color: #8b2252;">'select-editor'</span>.
1. /bin/nano &lt;---- easiest
2. /usr/bin/vim.basic
3. /usr/bin/vim.tiny
4. /bin/ed
Choose 1-4 [1]:
root@ubuntu1804:~# cat /etc/profile.d/env.sh
<span style="color: #483d8b;">export</span> <span style="color: #a0522d;">EDITOR</span>=vim 
</pre>
</div>

<p>
范例：PATH变量
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;1,&#22312;&#35745;&#21010;&#20219;&#21153;&#37197;&#32622;&#20013;&#25351;&#23450;PATH</span>
[root@centos8 ~]#crontab -l
<span style="color: #a0522d;">PATH</span>=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin
* * * * * useradd hehe;<span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">PATH</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;2,&#22312;&#33050;&#26412;&#20013;&#25351;&#23450;PATH&#21464;&#37327;</span>
[root@centos8 ~]#crontab -l
* * * * * /data/test.sh
[root@centos8 ~]#cat /data/test.sh
<span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/bash</span>
<span style="color: #a0522d;">PATH</span>=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin
useradd hehe
<span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">PATH</span> 
</pre>
</div>

<p>
范例: 磁盘检查任务
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 scripts]#cat check_disk.sh 
<span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/bash</span>
<span style="color: #a0522d;">WARNING</span>=10
df | sed -En <span style="color: #8b2252;">'/^\/dev\/sd/s@^([^ ]+).* ([0-9]+)%.*@\1 \2@p'</span>| <span style="color: #a020f0;">while </span><span style="color: #483d8b;">read</span> DEVICE USE;<span style="color: #a020f0;">do</span>
   [ $<span style="color: #a0522d;">USE</span> -gt $<span style="color: #a0522d;">WARNING</span> ] &amp;&amp; <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"$DEVICE will be full,USE:$USE"</span> | mail -s diskfull root
<span style="color: #a020f0;">done</span>
[root@centos8 scripts]#crontab -e
[root@centos8 scripts]#crontab -l
*/2 * * * * /data/check_disk.sh

[root@centos8 ~]#cat check_disk2.sh
<span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/bash</span>
<span style="color: #a0522d;">WARNING</span>=2 
df | awk -F <span style="color: #8b2252;">' +|%'</span> <span style="color: #8b2252;">'/^\/dev\/sd/{print $1,$5}'</span>|<span style="color: #a020f0;">while </span><span style="color: #483d8b;">read</span> DISK USE;<span style="color: #a020f0;">do</span>
  <span style="color: #a020f0;">if</span> [ $<span style="color: #a0522d;">USE</span> -gt $<span style="color: #a0522d;">WARNING</span> ];<span style="color: #a020f0;">then</span>
     <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"$DISK will be full,use:$USE"</span> | mail -s diskwarning root@wa.com
  <span style="color: #a020f0;">fi</span>
<span style="color: #a020f0;">done</span>

[root@centos8 ~]#crontab -l
*/10 * * * * /root/check_disk2.sh
</pre>
</div>

<p>
范例：任务检查：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #a020f0;">for</span> i<span style="color: #a020f0;"> in</span> $(<span style="color: #ff00ff;">awk -F':' '{print $1}' /etc/passwd</span>);<span style="color: #a020f0;">do </span><span style="color: #483d8b;">echo</span> -e <span style="color: #8b2252;">"$i"</span> &amp;&amp; crontab -u $<span style="color: #a0522d;">i</span> -l 2&gt;/dev/null ;<span style="color: #a020f0;">done</span>
</pre>
</div>

<p>
面试题：11月每天的6-12点之间每隔2小时执行/app/bin/test.sh
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#crontab -l
0 6-12/2 * 11 * /app/bin/test.sh
</pre>
</div>

<p>
注意:运行结果的标准输出和错误以邮件通知给相关用户
</p>

<pre class="example" id="org5c8ac77">
(1) COMMAND &gt; /dev/null
(2) COMMAND &amp;&gt; /dev/null 
</pre>

<p>
cron任务中不建议使用%，它有特殊用途，它表示换行的特殊意义，且第一个%后
的所有字符串会被当作命令的标准输入,如果在命令中要使用%，则需要用\ 转义
注意：将%放置于单引号中是不支持的
</p>

<p>
范例： 在crontab中%的用法
</p>

<div class="org-src-container">
<pre class="src src-sh">30 2 * * * /bin/cp -a /etc/ /data/etc<span style="color: #ff00ff;">`date +\%F_\%T`</span>
30 2 * * * /bin/cp -a /etc/ /data/etc<span style="color: #ff00ff;">`date +&#8216;%F_%T&#8217;`</span> &#26377;&#38382;&#39064; 
</pre>
</div>

<p>
范例: 在crontab中%的用法
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#crontab -l
* * * * * mail -s <span style="color: #8b2252;">"test"</span> cici%cici,%%how are you?% 

From root@centos8.localdomain Sat Jul 4 23:58:01 2020
Return-Path: <a href="mailto:root%40centos8.localdomain">&lt;root@centos8.localdomain&gt;</a>
X-Original-To: cici
Delivered-To: cici@centos8.localdomain
Received: by centos8.localdomain (Postfix, from userid 0)
id 0B03860272; Sat, 4 Jul 2020 23:58:01 +0800 (CST)
Date: Sat, 04 Jul 2020 23:58:01 +0800
To: cici@centos8.localdomain
Subject: test
User-Agent: Heirloom mailx 12.5 7/5/10
MIME-Version: 1.0
Content-Type: text/plain; <span style="color: #a0522d;">charset</span>=us-ascii
Content-Transfer-Encoding: 7bit
Message-Id: <a href="mailto:20200704155801.0B03860272%40centos8.localdomain">&lt;20200704155801.0B03860272@centos8.localdomain&gt;</a>
From: root@centos8.localdomain (root)

cici,

how are you?

[root@centos8 ~]#
</pre>
</div>

<p>
思考：
</p>

<p>
(1) 如何在秒级别运行任务？
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #a020f0;">for</span> min<span style="color: #a020f0;"> in</span> 0 1 2; <span style="color: #a020f0;">do </span><span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"hi"</span>; sleep 20; <span style="color: #a020f0;">done</span>
</pre>
</div>

<p>
(2) 如何实现每7分钟运行一次任务?
sleep命令：
</p>

<pre class="example" id="org6ec084c">
sleep NUMBER[SUFFIX]...

SUFFIX:
s: 秒, 默认
m: 分
h: 小时
d: 天
</pre>

<div class="org-src-container">
<pre class="src src-sh">date; sleep 7m; <span style="color: #483d8b;">echo</span> test; date
</pre>
</div>

<p>
以微秒为单位
</p>

<div class="org-src-container">
<pre class="src src-sh">usleep <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;&#24223;&#24323;</span>
sleep 1e-06  <span style="color: #b22222;"># </span><span style="color: #b22222;">centos8</span>
</pre>
</div>
</div>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>打赏</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>© 2025 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
<!--
<script type="text/javascript" src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/bootstrap@5.2.1/dist/js/bootstrap.min.js"></script>
<div id="back-to-top" class=""><svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg></div>
-->
</div>
</body>
</html>
