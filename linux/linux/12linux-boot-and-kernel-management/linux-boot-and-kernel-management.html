<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linux: Linuxå¯åŠ¨å’Œå†…æ ¸ç®¡ç†</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/font.css"/>
<link rel="stylesheet" type="text/css" href="/static/drollery.e825b870.css"/>
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<header id="preamble" class="status">
<header class="{className}" data-astro-cid-3ef6ksr2>
  <div class=header-branding data-astro-cid-g2lrb5xm>
      <span class=header-text data-astro-cid-g2lrb5xm>
          <span class=dropcap data-astro-cid-g2lrb5xm aria-hidden=true>
              <span class=actual data-astro-cid-g2lrb5xm>J</span>
              <span class=rest data-astro-cid-g2lrb5xm>asper Hsu</span>
              <span class=period data-astro-cid-g2lrb5xm>.</span>
          </span>
          <span class=sr-only data-astro-cid-g2lrb5xm>Drollery</span>
      </span>
      <img alt="Medieval drollery of a knight on a horse" class=spring decoding=async height=250 loading=lazy src=/images/knight-horse.a96eee7d_Z1WCOYs.webp width=68 data-astro-cid-g2lrb5xm>
  </div>

  <nav data-astro-cid-pux6a34n>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/jcodelog.html class=nobracket data-astro-cid-pux6a34n>æŠ€æœ¯</a>
      <span class=flower2 data-astro-cid-pux6a34n>K</span>
      <a href=/reading/index.html class=nobracket data-astro-cid-pux6a34n>é˜…è¯»</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
      <a href=/archives.html class=nobracket data-astro-cid-pux6a34n>å½’æ¡£</a>
      <span class=flower2 data-astro-cid-pux6a34n>L</span>
      <a href=/link/index.html class=nobracket data-astro-cid-pux6a34n>å‹é“¾</a>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/about.html class=nobracket data-astro-cid-pux6a34n>å…³äº</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
  </nav>


  <div class="container" data-astro-cid-3ef6ksr2>
    <p class="info" data-astro-cid-3ef6ksr2>
              ğŸ† æ¬¢è¿æ¥åˆ°æœ¬ç«™ï¼š
              <a href="https://xuchangwei.com/">https://xuchangwei.com/</a>ã€‚
              <strong>å¸Œæœ›è¿™é‡Œæœ‰ä½ æ„Ÿå…´è¶£çš„å†…å®¹</strong>ã€‚
            </p>
  </div>
  <div id=borderArtWrapper class="tt1" data-astro-cid-5hce7sga data-turbo-permanent>
      <script>
          var man, shakeCount = 0, noSound = new Audio("/audio/effects/no.m4a"), screamSound = new Audio("/audio/effects/scream.m4a");
          function animateManShakeHandler() {
              man.removeEventListener("animationend", animateManShakeHandler, !1),
              shakeCount += 1,
              man.classList.remove("shakeMan")
          }
          function animateManFallHandler() {
              man.removeEventListener("animationend", animateManFallHandler, !1),
              man.classList.add("hide")
          }
          function animateMan() {
              man = man ?? document.getElementById("borderMan"),
              3 === shakeCount ? (man.classList.add("fallMan"),
              screamSound.play(),
              man.addEventListener("animationend", animateManFallHandler, !1)) : (man.classList.add("shakeMan"),
              noSound.play(),
              man.addEventListener("animationend", animateManShakeHandler, !1))
          }
      </script>
      <div class=borderArt data-astro-cid-5dda5nwp id=articleBorder>
          <img alt="flowery border with man falling" decoding=async height=620 loading=lazy src=/images/border-vines-no-man.b7d246cc_DRxSe.webp width=909 class=border data-astro-cid-5dda5nwp>
          <div class=fallWrapper data-astro-cid-5dda5nwp>
              <img alt="flowery border with man falling" decoding=async height=292 loading=lazy src=/images/man-no-vines.247a3187_Z2ioXNM.webp width=98 class=man data-astro-cid-5dda5nwp id=borderMan onclick=animateMan()>
          </div>
      </div>
  </div>
</header>
</header>
<main class="container" id="content" class="content">
<header>
<h1 class="title">Linux: Linuxå¯åŠ¨å’Œå†…æ ¸ç®¡ç†</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:0b546144-e571-48d9-a009-0f9cbe0cdbe7">CentOS 6 çš„å¯åŠ¨ç®¡ç†</a>
<ul>
<li><a href="#h:2b567e78-f3ae-437e-b118-0c78a9658f39">Linux ç»„æˆ</a></li>
<li><a href="#h:54676b88-2d8d-44fc-85e2-ad4352393c65">å†…æ ¸è®¾è®¡æµæ´¾</a></li>
<li><a href="#h:94b1f8fa-6a22-4304-8f3a-369184a4355e">CentOS 6å¯åŠ¨æµç¨‹</a>
<ul>
<li><a href="#h:22a12376-fbdd-4906-aa55-546dcd9816eb">CentOS 6 å¯åŠ¨æµç¨‹</a></li>
<li><a href="#h:f7232f45-7a26-484d-8409-b8856a4acba1">ç¡¬ä»¶å¯åŠ¨POST</a></li>
<li><a href="#h:5e23a4ab-6b97-4074-a986-9431073d2bc7">å¯åŠ¨åŠ è½½å™¨ bootloader</a>
<ul>
<li><a href="#h:e969a394-0bf8-482f-be79-9a4963ad8a90">grub åŠŸèƒ½å’Œç»„æˆ</a></li>
<li><a href="#h:baaa672b-bc8a-4bb4-88a6-d5920b841811">CentOS 6 grub å®‰è£…</a></li>
<li><a href="#h:6e1a49bc-5a04-43b2-b36b-f87bce8e5188">grub legacy ç®¡ç†-è€ç‰ˆæœ¬</a></li>
<li><a href="#h:01c8ac6f-260f-4472-82ee-29480796bbf8">èŒƒä¾‹: CentOS 6 grub 1é˜¶æ®µ1.5é˜¶æ®µä¿®å¤</a></li>
<li><a href="#h:d748c701-b6ac-478b-a1f4-e017fbd435ea">èŒƒä¾‹ï¼šç ´è§£rootå£ä»¤</a></li>
<li><a href="#h:46b18b4d-50ff-447d-b261-0cd00eb96f42">èŒƒä¾‹: grubå®šåˆ¶èƒŒæ™¯å›¾ï¼š</a></li>
</ul>
</li>
<li><a href="#h:5ad3069c-afe1-4589-afc0-7a21c41947ae">åŠ è½½ kernel</a>
<ul>
<li><a href="#h:e6735169-2d9b-49a9-a7a6-b4711266f38d">ramdiskæ–‡ä»¶çš„åˆ¶ä½œ</a></li>
<li><a href="#h:c7694ad5-1b56-4643-b12c-0667a2e9184a">èŒƒä¾‹: è¯¯åˆ é™¤/boot/initramfs-2.6.32-754.el6.x86_64.imgæ— æ³•å¯åŠ¨ï¼Œæ•…éšœæ¢å¤</a></li>
<li><a href="#h:a04675a0-6c3c-47e7-9b0c-c3eb21e9ff51">èŒƒä¾‹ï¼šè¯¯åˆ é™¤/bootç›®å½•ï¼Œè¿›è¡Œæ•…éšœæ¢å¤</a></li>
</ul>
</li>
<li><a href="#h:922e18db-8e34-4983-a49c-e6981c4d049d">initåˆå§‹åŒ–</a>
<ul>
<li><a href="#h:a3070eb9-6255-4bee-982a-1e7ffcfe3ed4">è¿è¡Œçº§åˆ«</a></li>
<li><a href="#h:c24479f4-cd07-49f4-aac2-c46a4868a46e">åˆå§‹åŒ–è„šæœ¬ sysinit</a></li>
<li><a href="#h:329773be-3b6d-4bda-ae51-75bc045717be">æœåŠ¡ç®¡ç†</a></li>
<li><a href="#h:89dbf263-728d-4b4b-b3e6-12e8d75b9c11">éç‹¬ç«‹æœåŠ¡</a></li>
<li><a href="#h:eb3705a5-0b35-4b40-9393-53fdd3cffaa9">å¼€æœºå¯åŠ¨æ–‡ä»¶ rc.local</a></li>
</ul>
</li>
<li><a href="#h:68d3f8f3-bb2c-493c-a893-75b491828d0e">CentOS6 å¯åŠ¨è¿‡ç¨‹æ€»ç»“</a></li>
<li><a href="#h:bc7e0987-9d2c-4c05-a5a2-6754a03a6938">å¯åŠ¨è¿‡ç¨‹çš„æ•…éšœæ’é”™</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:de26e8c1-e341-4303-b061-58b9a47e9dbc">systemd</a>
<ul>
<li><a href="#systemd-ç‰¹æ€§">systemd ç‰¹æ€§</a></li>
<li><a href="#h:c2706445-f151-4bdb-aff6-8ba2673635cc">systemctlç®¡ç†ç³»ç»ŸæœåŠ¡service unit</a></li>
<li><a href="#h:ea007418-a7c5-4f5d-a690-a15f8663c759">service unitæ–‡ä»¶æ ¼å¼</a></li>
<li><a href="#h:aa278884-730a-49e7-b6ee-72532922b8e6">è¿è¡Œçº§åˆ«</a></li>
<li><a href="#orgb20f77f">è®¾ç½®å†…æ ¸å‚æ•°</a></li>
<li><a href="#h:cf968388-2306-4340-a133-e0987ef64338">CentOS 7ä¹‹åç‰ˆæœ¬å¼•å¯¼é¡ºåº</a></li>
<li><a href="#h:f8905e48-bb3a-42bc-a312-d2ee1162f23e">ç ´è§£ CentOS 7å’Œ8çš„ root å¯†ç </a></li>
<li><a href="#h:920aa398-c45d-46a3-a9c1-9ea439dd507f">å®ç°GRUB2å®‰å…¨</a></li>
<li><a href="#h:a6970b05-11b5-46fb-a408-4bc10305ed9a">ä¿®å¤GRUB2</a></li>
<li><a href="#h:eb90ecd0-adf0-4fda-9787-375d8ccc54e2">æ•…éšœæ’é”™å®æˆ˜æ¡ˆä¾‹</a>
<ul>
<li><a href="#orgaf13282">å®æˆ˜æ¡ˆä¾‹1ï¼šcentos 7 ï¼Œ8 ç ´åMBRåè¿›è¡Œæ¢å¤</a></li>
<li><a href="#org1a13fff">å®æˆ˜æ¡ˆä¾‹2ï¼šCentos 7 ï¼Œ8åˆ é™¤/boot/grub2/*æ‰€æœ‰å†…å®¹è¿›è¡Œæ¢å¤</a></li>
<li><a href="#orgcaabe8a">å®æˆ˜æ¡ˆä¾‹3ï¼šCentOS 7 ï¼Œ8 åˆ é™¤/boot/ä¸‹æ‰€æœ‰æ–‡ä»¶åè¿›è¡Œæ¢å¤</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:10153c76-1ed8-43cb-861e-273504654859">/proc ç›®å½•å’Œå†…æ ¸å‚æ•°ç®¡ç†</a></li>
<li><a href="#h:fa9b09be-a7d3-4d9f-8564-44bcfed39546">journalctl</a></li>
<li><a href="#h:99edcc75-a6f5-464e-a8c4-ee70d80156f3">/sys ç›®å½•</a></li>
<li><a href="#h:cf699c8b-b48e-4f44-a0f2-577ecad299b1">å†…æ ¸æ¨¡å—ç®¡ç†å’Œç¼–è¯‘</a>
<ul>
<li><a href="#h:4204a51c-b3f6-4d17-ab2e-fd819ae78ced">å†…æ ¸ç‰ˆæœ¬</a></li>
<li><a href="#h:8c326ac8-2293-4cd6-a4ed-0b8a19bf4157">å†…æ ¸æ¨¡å—å‘½ä»¤</a></li>
<li><a href="#h:f30f3641-467f-49b3-a788-56a87a18d863">ç¼–è¯‘å†…æ ¸</a></li>
</ul>
</li>
<li><a href="#h:332c7b43-6385-41d2-9f54-965a542e9c76">Busybox</a>
<ul>
<li><a href="#h:a1d005de-1031-4f4c-afcd-6d4da7b3f72a">Busyboxä»‹ç»</a></li>
<li><a href="#h:ca4d2c03-5a53-4e61-b59e-1ed6b628baec">Busyboxä½¿ç”¨</a></li>
<li><a href="#h:80f0d7a7-d098-4aee-9bd1-448f8e6068fe">busyboxç¼–è¯‘å®‰è£…</a></li>
</ul>
</li>
<li><a href="#h:b31b2d22-3823-4f22-8e68-9cfbf9c37a31">è‡ªåˆ¶linuxç³»ç»Ÿ</a>
<ul>
<li><a href="#orgbd1772c">Centos6è‡ªåˆ¶linuxç³»ç»Ÿ</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../../index.html">Linux</a></li>
</ul>


<p>
æ‘˜è¦ï¼šæœ¬æ–‡ä»‹ç»Linuxå¯åŠ¨å’Œå†…æ ¸ç®¡ç†
</p>

<p>
å†…å®¹æ¦‚è¿°
</p>

<ul class="org-ul">
<li>CentOS 6 ä¹‹å‰ç‰ˆæœ¬çš„å¯åŠ¨æµç¨‹</li>
<li>æœåŠ¡ç®¡ç†</li>
<li>Grubç®¡ç†</li>
<li>è‡ªåˆ¶Linux</li>
<li>å¯åŠ¨æ’é”™</li>
<li>ç¼–è¯‘å®‰è£…å†…æ ¸</li>
<li>BusyBox</li>
<li>CentOS 7 ä»¥åç‰ˆæœ¬å¯åŠ¨æµç¨‹</li>
<li>Unitä»‹ç»</li>
<li>æœåŠ¡ç®¡ç†å’ŒæŸ¥çœ‹</li>
<li>å¯åŠ¨æ’é”™</li>
<li>ç ´è§£å£ä»¤</li>
<li>ä¿®å¤Grub2</li>
</ul>
<section id="outline-container-h:0b546144-e571-48d9-a009-0f9cbe0cdbe7" class="outline-2">
<h2 id="h:0b546144-e571-48d9-a009-0f9cbe0cdbe7">CentOS 6 çš„å¯åŠ¨ç®¡ç†</h2>
<div class="outline-text-2" id="text-h:0b546144-e571-48d9-a009-0f9cbe0cdbe7">
</div>
<div id="outline-container-h:2b567e78-f3ae-437e-b118-0c78a9658f39" class="outline-3">
<h3 id="h:2b567e78-f3ae-437e-b118-0c78a9658f39">Linux ç»„æˆ</h3>
<div class="outline-text-3" id="text-h:2b567e78-f3ae-437e-b118-0c78a9658f39">
<ul class="org-ul">
<li>kernel å®ç°è¿›ç¨‹ç®¡ç†ã€å†…å­˜ç®¡ç†ã€ç½‘ç»œç®¡ç†ã€é©±åŠ¨ç¨‹åºã€æ–‡ä»¶ç³»ç»Ÿã€å®‰å…¨åŠŸèƒ½ç­‰åŠŸèƒ½</li>
<li><p>
rootfs åŒ…æ‹¬ç¨‹åºå’Œ glibc åº“
</p>

<p>
ç¨‹åºï¼šäºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶
</p>

<p>
åº“ï¼šå‡½æ•°é›†åˆ, function, è°ƒç”¨æ¥å£ï¼ˆå¤´æ–‡ä»¶è´Ÿè´£æè¿°ï¼‰
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:54676b88-2d8d-44fc-85e2-ad4352393c65" class="outline-3">
<h3 id="h:54676b88-2d8d-44fc-85e2-ad4352393c65">å†…æ ¸è®¾è®¡æµæ´¾</h3>
<div class="outline-text-3" id="text-h:54676b88-2d8d-44fc-85e2-ad4352393c65">
<ul class="org-ul">
<li>å®å†…æ ¸(monolithic kernel)ï¼šåˆç§°å•å†…æ ¸å’Œå¼ºå†…æ ¸ï¼ŒUnixï¼ŒLinuxæŠŠæ‰€æœ‰ç³»ç»Ÿ
æœåŠ¡éƒ½æ”¾åˆ°å†…æ ¸é‡Œï¼Œæ‰€æœ‰åŠŸèƒ½é›†æˆäºåŒä¸€ä¸ªç¨‹åºï¼Œåˆ†å±‚å®ç°ä¸åŒåŠŸèƒ½ï¼Œç³»ç»Ÿåº
å¤§å¤æ‚ï¼ŒLinuxå…¶å®åœ¨å•å†…æ ¸å†…æ ¸å®ç°äº†æ¨¡å—åŒ–ï¼Œä¹Ÿå°±ç›¸å½“äºå¸æ”¶äº†å¾®å†…æ ¸çš„
ä¼˜ç‚¹</li>

<li><p>
å¾®å†…æ ¸(micro kernel)ï¼šWindowsï¼ŒSolarisï¼ŒHarmonyOS
</p>

<p>
ç®€åŒ–å†…æ ¸åŠŸèƒ½ï¼Œåœ¨å†…æ ¸ä¹‹å¤–çš„ç”¨æˆ·æ€å°½å¯èƒ½å¤šåœ°å®ç°ç³»ç»ŸæœåŠ¡ï¼ŒåŒæ—¶åŠ å…¥ç›¸äº’
ä¹‹é—´çš„å®‰å…¨ä¿æŠ¤ï¼Œæ¯ç§åŠŸèƒ½ä½¿ç”¨ä¸€ä¸ªå•ç‹¬å­ç³»ç»Ÿå®ç°ï¼Œå°†å†…æ ¸åŠŸèƒ½ç§»åˆ°ç”¨æˆ·ç©º
é—´ï¼Œæ€§èƒ½å·®
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:94b1f8fa-6a22-4304-8f3a-369184a4355e" class="outline-3">
<h3 id="h:94b1f8fa-6a22-4304-8f3a-369184a4355e">CentOS 6å¯åŠ¨æµç¨‹</h3>
<div class="outline-text-3" id="text-h:94b1f8fa-6a22-4304-8f3a-369184a4355e">
</div>
<div id="outline-container-h:22a12376-fbdd-4906-aa55-546dcd9816eb" class="outline-4">
<h4 id="h:22a12376-fbdd-4906-aa55-546dcd9816eb">CentOS 6 å¯åŠ¨æµç¨‹</h4>
<div class="outline-text-4" id="text-h:22a12376-fbdd-4906-aa55-546dcd9816eb">

<figure id="org5429fd6">
<img src="images/image-20210120111434311.png" alt="image-20210120111434311.png" width="80%">

</figure>



<figure id="orgbfb686e">
<img src="images/image-20210227224724401.png" alt="image-20210227224724401.png" width="80%">

</figure>

<p>
POST &#x2013;&gt; Boot Sequence(BIOS) &#x2013;&gt; Boot Loader (MBR) &#x2013;&gt; Kernel(ramdisk)
&#x2013;&gt; rootfs &#x2013;&gt; switchroot &#x2013;&gt; /sbin/init &#x2013;&gt;(/etc/inittab,
/etc/init/*.conf) &#x2013;&gt; è®¾å®šè¿è¡Œçº§åˆ« &#x2013;&gt; ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬ &#x2013;&gt;
å…³é—­æˆ–å¯åŠ¨å¯¹åº”çº§åˆ«ä¸‹çš„æœåŠ¡ &#x2013;&gt; å¯åŠ¨ç»ˆç«¯
</p>

<ol class="org-ol">
<li>åŠ è½½BIOSçš„ç¡¬ä»¶ä¿¡æ¯ï¼Œè·å–ç¬¬ä¸€ä¸ªå¯åŠ¨è®¾å¤‡</li>
<li>è¯»å–ç¬¬ä¸€ä¸ªå¯åŠ¨è®¾å¤‡MBRçš„å¼•å¯¼åŠ è½½ç¨‹åº(grub)çš„å¯åŠ¨ä¿¡æ¯</li>
<li>åŠ è½½æ ¸å¿ƒæ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒä¿¡æ¯ï¼Œæ ¸å¿ƒå¼€å§‹è§£å‹ç¼©ï¼Œå¹¶å°è¯•é©±åŠ¨æ‰€æœ‰çš„ç¡¬ä»¶è®¾å¤‡</li>
<li>æ ¸å¿ƒæ‰§è¡Œinitç¨‹åºï¼Œå¹¶è·å–é»˜è®¤çš„è¿è¡Œä¿¡æ¯</li>
<li>initç¨‹åºæ‰§è¡Œ/etc/rc.d/rc.sysinitæ–‡ä»¶ï¼Œé‡æ–°æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ</li>
<li>å¯åŠ¨æ ¸å¿ƒçš„å¤–æŒ‚æ¨¡å—</li>
<li>initæ‰§è¡Œè¿è¡Œçš„å„ä¸ªæ‰¹å¤„ç†æ–‡ä»¶(scripts)</li>
<li>initæ‰§è¡Œ/etc/rc.d/rc.local</li>
<li>æ‰§è¡Œ/bin/loginç¨‹åºï¼Œç­‰å¾…ç”¨æˆ·ç™»å½•</li>
<li>ç™»å½•ä¹‹åå¼€å§‹ä»¥Shellæ§åˆ¶ä¸»æœº</li>
</ol>
</div>
</div>
<div id="outline-container-h:f7232f45-7a26-484d-8409-b8856a4acba1" class="outline-4">
<h4 id="h:f7232f45-7a26-484d-8409-b8856a4acba1">ç¡¬ä»¶å¯åŠ¨POST</h4>
<div class="outline-text-4" id="text-h:f7232f45-7a26-484d-8409-b8856a4acba1">
<p>
POSTï¼šPower-On-Self-Testï¼ŒåŠ ç”µè‡ªæ£€ï¼Œæ˜¯BIOSåŠŸèƒ½çš„ä¸€ä¸ªä¸»è¦éƒ¨åˆ†ã€‚è´Ÿè´£å®Œ
æˆå¯¹CPUã€ä¸»æ¿ã€å†…å­˜ã€ç¡¬ç›˜å­ç³»ç»Ÿã€æ˜¾ç¤ºå­ç³»ç»Ÿã€ä¸²å¹¶è¡Œæ¥å£ã€é”®ç›˜ç­‰ç¡¬ä»¶
æƒ…å†µçš„æ£€æµ‹
</p>

<ul class="org-ul">
<li>ä¸»æ¿çš„ROMï¼šBIOSï¼ŒBasic Input and Output Systemï¼Œä¿å­˜ç€æœ‰å…³è®¡ç®—æœºç³»ç»Ÿ
æœ€é‡è¦çš„åŸºæœ¬è¾“å…¥è¾“å‡ºç¨‹åºï¼Œç³»ç»Ÿä¿¡æ¯è®¾ç½®ã€å¼€æœºåŠ ç”µè‡ªæ£€ç¨‹åºå’Œç³»ç»Ÿå¯åŠ¨è‡ª
ä¸¾ç¨‹åºç­‰</li>

<li>ä¸»æ¿çš„RAMï¼šCMOSäº’è¡¥é‡‘å±æ°§åŒ–ç‰©åŠå¯¼ä½“ï¼Œä¿å­˜å„é¡¹å‚æ•°çš„è®¾å®šï¼ŒæŒ‰æ¬¡åºæŸ¥æ‰¾
å¼•å¯¼è®¾å¤‡ï¼Œç¬¬ä¸€ä¸ªæœ‰å¼•å¯¼ç¨‹åºçš„è®¾å¤‡ä¸ºæœ¬æ¬¡å¯åŠ¨è®¾å¤‡</li>
</ul>
</div>
</div>
<div id="outline-container-h:5e23a4ab-6b97-4074-a986-9431073d2bc7" class="outline-4">
<h4 id="h:5e23a4ab-6b97-4074-a986-9431073d2bc7">å¯åŠ¨åŠ è½½å™¨ bootloader</h4>
<div class="outline-text-4" id="text-h:5e23a4ab-6b97-4074-a986-9431073d2bc7">
<p>
è¿æ¥ç¡¬ä»¶å’Œè½¯ä»¶çš„è¿‡åº¦é˜¶æ®µï¼Œå¯åŠ¨å¼•å¯¼æ“ä½œç³»ç»Ÿ
</p>

<p>
bootloaderå­˜æ”¾åœ¨ç¡¬ç›˜çš„ç¬¬ä¸€ä¸ªæ‰‡åŒº512å­—èŠ‚ã€‚ç¬¬ä¸€ä¸ªæ‰‡åŒºåˆ†ä¸º3éƒ¨åˆ†ï¼š
</p>
<ul class="org-ul">
<li>å‰446å­—èŠ‚</li>
<li>ä¸­é—´64å­—èŠ‚çš„åˆ†åŒºè¡¨</li>
<li>æœ€å2ä¸ªå­—èŠ‚ï¼Œ55aaæ ‡è®°ä½</li>
</ul>
</div>
<div id="outline-container-h:e969a394-0bf8-482f-be79-9a4963ad8a90" class="outline-5">
<h5 id="h:e969a394-0bf8-482f-be79-9a4963ad8a90">grub åŠŸèƒ½å’Œç»„æˆ</h5>
<div class="outline-text-5" id="text-h:e969a394-0bf8-482f-be79-9a4963ad8a90">
<p>
bootloader: å¼•å¯¼åŠ è½½å™¨ï¼Œå¼•å¯¼ç¨‹åº
</p>

<ul class="org-ul">
<li>windows: ntloaderï¼Œä»…æ˜¯å¯åŠ¨OS</li>
<li>Linuxï¼šåŠŸèƒ½ä¸°å¯Œï¼Œæä¾›èœå•ï¼Œå…è®¸ç”¨æˆ·é€‰æ‹©è¦å¯åŠ¨ç³»ç»Ÿæˆ–ä¸åŒçš„å†…æ ¸ç‰ˆæœ¬ï¼›
æŠŠç”¨æˆ·é€‰å®šçš„å†…æ ¸è£…è½½åˆ°å†…å­˜ä¸­çš„ç‰¹å®šç©ºé—´ä¸­ï¼Œè§£å‹ã€å±•å¼€ï¼Œå¹¶æŠŠç³»ç»Ÿæ§åˆ¶æƒ
ç§»äº¤ç»™å†…æ ¸</li>
<li>è™šæ‹Ÿæœºbiosè®¾å®šï¼šå¼€æœºF2(è™šæ‹Ÿæœº</li>
</ul>

<p>
Linuxçš„bootloader
</p>

<ul class="org-ul">
<li>LILOï¼šLInux LOaderï¼Œæ—©æœŸçš„bootloaderï¼ŒåŠŸèƒ½å•ä¸€</li>
<li>GRUB: GRand Unified Bootloader, CentOS5,6 GRUB 0.97: GRUB Legacyï¼ŒCentOS 7 ä»¥åä½¿ç”¨GRUB 2.02</li>
</ul>

<p>
GRUB å¯åŠ¨é˜¶æ®µ
</p>

<ul class="org-ul">
<li><p>
primary boot loader :
</p>

<p>
1st stageï¼šMBRçš„å‰446ä¸ªå­—èŠ‚
</p>

<p>
1.5 stageï¼š mbrä¹‹åçš„æ‰‡åŒºï¼Œè®©stage1ä¸­çš„bootloaderèƒ½è¯†åˆ«stage2æ‰€åœ¨çš„
åˆ†åŒºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿ
</p></li>

<li>secondary boot loader ï¼š2nd stageï¼Œåˆ†åŒºæ–‡ä»¶/boot/grub/</li>
</ul>


<blockquote>
<p>
bootloaderæ‰¾åˆ°ç¡¬ç›˜çš„å‰446ä¸ªå­—èŠ‚åï¼Œè¦è¿›ä¸€æ­¥è¿›å…¥æ“ä½œç³»ç»Ÿè¿›è¡Œå¯åŠ¨ã€‚ä½†å¯åŠ¨æ“ä½œç³»ç»Ÿçš„è¯å¿…ç„¶è¦åŠ è½½æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±å¿…é¡»èƒ½è¯†åˆ«æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œ446å­—èŠ‚å¤ªå°æ— æ³•å­˜æ”¾æ–‡ä»¶ç³»ç»Ÿçš„é©±åŠ¨ã€‚
é€šè¿‡1.5é˜¶æ®µï¼Œåˆ©ç”¨mbrä¹‹åçš„æ‰‡åŒºï¼Œæ‰¾åˆ°æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ã€‚æ‰¾æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨åå°±å¯ä»¥æŠŠlinuxå†…æ ¸å¯¹åº”çš„åˆ†åŒºæ–‡ä»¶ç³»ç»ŸåŠ è½½ï¼Œå¹¶è¿›å…¥åˆ°bootä¸­æ‰¾åˆ°å†…æ ¸æ–‡ä»¶ã€‚2é˜¶æ®µå°±æ˜¯æ¥å­˜æ”¾å¯åŠ¨å†…æ ¸ç›¸å…³æ–‡ä»¶çš„ã€‚grub.conf
å®šä¹‰äº†å†…æ ¸æ–‡ä»¶åœ¨å“ªã€‚åŠ è½½å†…æ ¸æ“ä½œç³»ç»Ÿå°±èƒ½è¿›ä¸€æ­¥å¯åŠ¨äº†ã€‚
</p>
</blockquote>

<p>
èŒƒä¾‹ï¼šæŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26816;&#26597;</span>
modinfo ext4
</pre>
</div>

<p>
å¦‚æœä¸å°å¿ƒæŠŠæŸä¸ªé˜¶æ®µç ´åäº†ï¼Œå¯ä»¥é€šè¿‡grubçš„grub-installå‘½ä»¤æˆ–è€…grubæ¥ä¿®å¤ã€‚
</p>

<p>
èŒƒä¾‹ï¼š æœ¬å®ä¾‹æ“ä½œç³»ç»Ÿï¼Œ/boot/grubæ˜¯æ”¾åœ¨/dev/sda ç¬¬1ä¸ªåˆ†åŒºä¸­ã€‚ sda1 å­˜æ”¾äº†bootloader çš„1é˜¶æ®µã€1.5é˜¶æ®µã€2é˜¶æ®µ
</p>
<div class="org-src-container">
<pre class="src src-sh">df -T
/dev/sda2     /
/dev/sda1    /boot
</pre>
</div>
</div>
</div>
<div id="outline-container-h:baaa672b-bc8a-4bb4-88a6-d5920b841811" class="outline-5">
<h5 id="h:baaa672b-bc8a-4bb4-88a6-d5920b841811">CentOS 6 grub å®‰è£…</h5>
<div class="outline-text-5" id="text-h:baaa672b-bc8a-4bb4-88a6-d5920b841811">
<p>
å®‰è£…grubï¼š
</p>

<p>
(1) grub-install å®‰è£…
</p>

<p>
grub stage1å’Œstage1.5åˆ°/dev/DISKç£ç›˜ä¸Šï¼Œå¹¶å¤åˆ¶GRUBç›¸å…³æ–‡ä»¶åˆ° DIR/bootç›®å½•ä¸‹
</p>

<div class="org-src-container">
<pre class="src src-sh">grub-install --root-directory=DIR /dev/DISK
</pre>
</div>

<p>
(2) grub
</p>
<div class="org-src-container">
<pre class="src src-sh">grub&gt; root (hd#,#)  hd&#34920;&#31034;&#30828;&#30424;&#65292;#&#21495;&#34920;&#31034;&#31532;&#20960;&#20010;&#30424;&#31532;&#20960;&#20010;&#20998;&#21306;
grub&gt; setup (hd#)
</pre>
</div>

<p>
ä¸Šé¢grub stage1å’Œstage1.5é˜¶æ®µéƒ½èƒ½ä¿®å¤
</p>
</div>
</div>
<div id="outline-container-h:6e1a49bc-5a04-43b2-b36b-f87bce8e5188" class="outline-5">
<h5 id="h:6e1a49bc-5a04-43b2-b36b-f87bce8e5188">grub legacy ç®¡ç†-è€ç‰ˆæœ¬</h5>
<div class="outline-text-5" id="text-h:6e1a49bc-5a04-43b2-b36b-f87bce8e5188">
<p>
é…ç½®æ–‡ä»¶ï¼š/boot/grub/grub.conf &lt;&#x2013; /etc/grub.conf
stage2åŠå†…æ ¸ç­‰é€šå¸¸æ”¾ç½®äºä¸€ä¸ªåŸºæœ¬ç£ç›˜åˆ†åŒº
</p>

<p>
grub legacy åŠŸç”¨ï¼š
</p>

<ol class="org-ol">
<li><p>
æä¾›å¯åŠ¨èœå•ã€å¹¶æä¾›äº¤äº’å¼æ¥å£ 
</p>

<p>
aï¼šå†…æ ¸å‚æ•° 
</p>

<p>
eï¼šç¼–è¾‘æ¨¡å¼ï¼Œç”¨äºç¼–è¾‘èœå• 
</p>

<p>
cï¼šå‘½ä»¤æ¨¡å¼ï¼Œäº¤äº’å¼æ¥å£ 
</p></li>

<li><p>
åŠ è½½ç”¨æˆ·é€‰æ‹©çš„å†…æ ¸æˆ–æ“ä½œç³»ç»Ÿ 
</p>

<p>
å…è®¸ä¼ é€’å‚æ•°ç»™å†…æ ¸ 
</p>

<p>
å¯éšè—å¯åŠ¨èœå• 
</p></li>
<li><p>
ä¸ºèœå•æä¾›äº†ä¿æŠ¤æœºåˆ¶ 
</p>

<p>
ä¸ºç¼–è¾‘å¯åŠ¨èœå•è¿›è¡Œè®¤è¯ 
</p>

<p>
ä¸ºå¯ç”¨å†…æ ¸æˆ–æ“ä½œç³»ç»Ÿè¿›è¡Œè®¤è¯
</p></li>
</ol>

<p>
<b>grub legacyé…ç½®æ–‡ä»¶ï¼š/boot/grub/grub.conf</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #a0522d;">default</span>=#: &#35774;&#23450;&#40664;&#35748;&#21551;&#21160;&#30340;&#33756;&#21333;&#39033;&#65307;&#33756;&#21333;&#39033;(title)&#32534;&#21495;&#20174;0&#24320;&#22987;
<span style="color: #a0522d;">timeout</span>=#&#65306;&#25351;&#23450;&#33756;&#21333;&#39033;&#31561;&#24453;&#36873;&#39033;&#36873;&#25321;&#30340;&#26102;&#38271;
<span style="color: #a0522d;">splashimage</span>=(hd#,#)/PATH/XPM_FILE&#65306;&#33756;&#21333;&#32972;&#26223;&#22270;&#29255;&#25991;&#20214;&#36335;&#24452;  hd&#34920;&#31034;&#30828;&#30424;&#65292;#&#21495;&#34920;&#31034;&#31532;&#20960;&#20010;&#30424;&#31532;&#20960;&#20010;&#20998;&#21306;
password [--md5| --encrypt] STRING: &#21551;&#21160;&#33756;&#21333;&#32534;&#36753;&#35748;&#35777;
hiddenmenu&#65306;&#38544;&#34255;&#33756;&#21333;(title)
title TITLE&#65306;&#23450;&#20041;&#33756;&#21333;&#39033;&#8220;&#26631;&#39064;&#8221;, &#21487;&#20986;&#29616;&#22810;&#27425;
  root (hd#,#)&#65306;&#26597;&#25214;stage2&#21450;kernel&#25991;&#20214;&#25152;&#22312;&#35774;&#22791;&#20998;&#21306;&#65307;&#20026;grub&#30340;&#26681;/boot. &#31532;1&#20010;#&#20195;&#34920;&#31532;&#20960;&#22359;&#30828;&#30424;&#65292;&#31532;2&#20010;#&#20195;&#34920;&#31532;&#20960;&#20010;&#20998;&#21306;
  kernel /PATH/TO/VMLINUZ_FILE [PARAMETERS]&#65306;&#21551;&#21160;&#30340;&#20869;&#26680;&#12290;&#26377;&#20869;&#26680;&#25991;&#20214;&#20301;&#32622;&#65292;&#22914;/vmlinuz;   &#36824;&#26377;&#25972;&#20010;&#25805;&#20316;&#31995;&#32479;&#26681;&#20301;&#32622;&#65292;&#21487;&#20197;&#26159;&#35774;&#22791;&#21517;&#65292;&#22914; <span style="color: #a0522d;">root</span>=/dev/sda2, &#25110;&#32773;&#35774;&#22791;UUID, <span style="color: #a0522d;">&#22914;root</span>=<span style="color: #a0522d;">UUID</span>=e76sljf-sldjf-xx
  initrd /PATH/TO/INITRAMFS_FILE: &#20869;&#26680;&#21305;&#37197;&#30340;ramfs&#25991;&#20214;&#65292;/&#26681;&#23454;&#38469;&#19978;&#26159;/boot&#30446;&#24405;&#12290;&#23384;&#20648;&#20102;&#21508;&#31181;&#25991;&#20214;&#31995;&#32479;&#39537;&#21160;&#31243;&#24207;
  password [--md5|--encrypted ] STRING: &#21551;&#21160;&#36873;&#23450;&#30340;&#20869;&#26680;&#25110;&#25805;&#20316;&#31995;&#32479;&#26102;&#36827;&#34892;&#35748;&#35777;
</pre>
</div>

<p>
èŒƒä¾‹ï¼šgrub.conf
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #a0522d;">default</span>=0
<span style="color: #a0522d;">timeout</span>=5
  root (hd0, 0)                                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26681;&#20026;boot&#30446;&#24405;&#20301;&#32622;&#12290;&#36825;&#37324;&#20026;&#31532;&#19968;&#20010;&#30828;&#30424;&#20013;&#30340;&#31532;&#19968;&#20010;&#21306;&#20998;&#65292;&#36825;&#37324;&#20026;/dev/sda1</span>
  kernel (hd0,0)/vmlinuz <span style="color: #a0522d;">root</span>=/dev/sda2         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20869;&#26680;&#21551;&#21160;&#21253;&#21547;&#65292;&#20869;&#26680;&#25991;&#20214;&#20301;&#32622;&#21644;&#25972;&#20010;&#25805;&#20316;&#31995;&#32479;&#30340;&#26681;&#12290; &#20854;&#20182;&#20013;(hd0,0)&#21487;&#30465;&#30053;&#19981;&#20889;</span>
  initrd (hd0,0)/initramfs.img                              <span style="color: #b22222;">#</span><span style="color: #b22222;">boot&#30446;&#24405;&#19979;&#30340;&#25991;&#20214;</span>
</pre>
</div>


<p>
<b>grubçš„å‘½ä»¤è¡Œæ¥å£</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">help: &#33719;&#21462;&#24110;&#21161;&#21015;&#34920;
help KEYWORD: &#35814;&#32454;&#24110;&#21161;&#20449;&#24687;
<span style="color: #0000ff;">find</span> (hd#,#)/PATH/TO/SOMEFILE&#65306;
<span style="color: #0000ff;">root</span> (hd#,#) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622;&#24403;&#21069;&#20351;&#29992;&#30340;&#26681;&#35774;&#22791;&#65307;&#26681;&#35774;&#22791;&#25351;&#31532;&#20108;&#38454;&#27573;&#25152;&#22312;&#30913;&#30424;&#20998;&#21306;</span>
kernel /PATH/TO/KERNEL_FILE: &#35774;&#23450;&#26412;&#27425;&#21551;&#21160;&#30340;&#20869;&#26680;&#25991;&#20214;&#65307;&#39069;&#22806;&#36824;&#21487;&#28155;&#21152;&#35768;&#22810;&#20869;&#26680;&#25903;&#25345;&#20351;&#29992;&#30340;cmdline&#21442;&#25968;
    &#20363;&#22914;&#65306;<span style="color: #a0522d;">max_loop</span>=100 <span style="color: #a0522d;">selinux</span>=0 <span style="color: #a0522d;">init</span>=/path/to/init  <span style="color: #b22222;">#</span><span style="color: #b22222;">init=&#34920;&#31034;&#21738;&#20010;&#25991;&#20214;&#24403;Init&#31243;&#24207;</span>
initrd /PATH/TO/INITRAMFS_FILE: &#35774;&#23450;&#20026;&#36873;&#23450;&#30340;&#20869;&#26680;&#25552;&#20379;&#39069;&#22806;&#25991;&#20214;&#30340;ramdisk
boot: &#24341;&#23548;&#21551;&#21160;&#36873;&#23450;&#30340;&#20869;&#26680;
</pre>
</div>

<p>
cat /proc/cmdline å†…æ ¸å‚æ•°
</p>

<p>
å†…æ ¸å‚æ•°æ–‡æ¡£:
</p>

<div class="org-src-container">
<pre class="src src-sh">/usr/share/doc/kernel-doc-2.6.32/Documentation/kernel-parameters.txt
</pre>
</div>

<p>
grub legacyè¯†åˆ«ç¡¬ç›˜è®¾å¤‡
</p>

<div class="org-src-container">
<pre class="src src-sh">(hd#,#)
hd#: &#30913;&#30424;&#32534;&#21495;&#65292;&#29992;&#25968;&#23383;&#34920;&#31034;&#65307;&#20174;0&#24320;&#22987;&#32534;&#21495;
<span style="color: #b22222;">#</span><span style="color: #b22222;">: &#20998;&#21306;&#32534;&#21495;&#65292;&#29992;&#25968;&#23383;&#34920;&#31034;; &#20174;0&#24320;&#22987;&#32534;&#21495;</span>
&#31034;&#20363;&#65306;
(hd0,0) &#31532;&#19968;&#22359;&#30828;&#30424;&#65292;&#31532;&#19968;&#20010;&#20998;&#21306;
</pre>
</div>

<p>
æ‰‹åŠ¨åœ¨grubå‘½ä»¤è¡Œæ¥å£å¯åŠ¨ç³»ç»Ÿ
</p>

<div class="org-src-container">
<pre class="src src-sh">grub&gt; root (hd#,#) &#25214;&#21040;grub&#30340;&#26681;
grub&gt; kernel /vmlinuz-VERSION-RELEASE ro <span style="color: #a0522d;">root</span>=/dev/DEVICE 
grub&gt; initrd /initramfs-VERSION-RELEASE.img
grub&gt; boot
</pre>
</div>


<p>
grubåŠ å¯†ç”Ÿæˆgrubå£ä»¤
</p>

<div class="org-src-container">
<pre class="src src-sh">grub-md5-crypt
grub-crypt
</pre>
</div>

<p>
æ›´å¤šç”Ÿæˆå¯†ç çš„æ–¹æ³•ï¼Œè¯·çœ‹<a href="https://xuchangwei.com/linux/linux/04linux-user-groups-and-permission-management/linux-user-groups-and-permission-management">ç”¨æˆ·ç»„å’Œæƒé™ç®¡ç†ç« èŠ‚</a>ã€‚
</p>
</div>
</div>
<div id="outline-container-h:01c8ac6f-260f-4472-82ee-29480796bbf8" class="outline-5">
<h5 id="h:01c8ac6f-260f-4472-82ee-29480796bbf8">èŒƒä¾‹: CentOS 6 grub 1é˜¶æ®µ1.5é˜¶æ®µä¿®å¤</h5>
<div class="outline-text-5" id="text-h:01c8ac6f-260f-4472-82ee-29480796bbf8">
<p>
èŒƒä¾‹ï¼šä¿®å¤grubçš„ç¬¬1é˜¶æ®µæ•…éšœ
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 grub]#hexdump -C -n 512 /dev/sda
00000000  eb 48 90 10 8e d0 bc 00  b0 b8 00 00 8e d8 8e c0  |.H..............|
    ......
000001b0  00 00 00 00 00 00 00 00  b7 47 02 00 00 00 80 20  |.........G..... |
000001c0  21 00 83 aa 28 82 00 08  00 00 00 00 20 00 00 aa  |!...(....... ...|
000001d0  29 82 83 fe ff ff 00 08  20 00 00 00 35 0c 00 fe  |)....... ...5...|
000001e0  ff ff 83 fe ff ff 00 08  55 0c 00 80 1a 06 00 fe  |........U.......|
000001f0  ff ff 05 fe ff ff 00 88  6f 12 00 78 90 06 55 aa  |........o..x..U.|
00000200

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#30772;&#22351;grub&#31532;1&#38454;&#27573;, &#21069;446&#23383;&#33410;&#28165;0&#12290;&#20998;&#21306;&#34920;&#19981;&#35201;&#30772;&#22351;&#65292;&#19981;&#28982;&#25214;&#19981;&#21040;&#20998;&#21306;&#20102;</span>
[root@centos6 grub]#dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/dev/sda <span style="color: #a0522d;">bs</span>=1 <span style="color: #a0522d;">count</span>=446
446+0 records<span style="color: #a020f0;"> in</span>
446+0 records out
446 bytes (446 B) copied, 0.00200007 s, 223 kB/s

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#26159;&#21542;&#34987;&#30772;&#22351;</span>
[root@centos6 grub]#hexdump -C -n 512 /dev/sda
00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
......
000001b0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 80 20  |............... |
000001c0  21 00 83 aa 28 82 00 08  00 00 00 00 20 00 00 aa  |!...(....... ...|
000001d0  29 82 83 fe ff ff 00 08  20 00 00 00 35 0c 00 fe  |)....... ...5...|
000001e0  ff ff 83 fe ff ff 00 08  55 0c 00 80 1a 06 00 fe  |........U.......|
000001f0  ff ff 05 fe ff ff 00 88  6f 12 00 78 90 06 55 aa  |........o..x..U.|
00000200

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37325;&#21551;&#26426;&#22120;&#65292;&#21457;&#29616;&#26080;&#27861;&#21551;&#21160;</span>
[root@centos6 grub]#reboot
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20986;&#29616;&#19979;&#38754;&#25552;&#31034;</span>
</pre>
</div>


<figure id="org2478445">
<img src="images/image-20210120111655668.png" alt="image-20210120111655668.png" width="80%">

</figure>

<p>
ä¿®å¤bootloader 1é˜¶æ®µ
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#25554;&#20837;&#20809;&#30424;&#65292;&#20351;&#29992;&#20809;&#30424;&#21551;&#21160;&#65292;&#36827;&#20837;rescue&#25937;&#25588;&#27169;&#24335;&#8220;Rescue installed system&#8221;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25805;&#20316;&#31995;&#32479;&#30340;&#26681;&#25346;&#36733;&#21040;&#20102;/mnt/sysimge&#25991;&#20214;&#22841;&#19979;</span>
chroot /mnt/sysimage    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20999;&#26681;&#65292;&#23558;&#30913;&#30424;&#30340;&#26681;&#24403;&#30495;&#27491;&#30340;&#26681;</span>
grub-install /dev/sda      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#22797;1, 1.5&#38454;&#27573;</span>
sync <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25968;&#25454;&#20889;&#20837;&#30913;&#30424;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26816;&#26597;&#21069;446&#23383;&#33410;</span>
hexdump -C -n 512 /dev/sda <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;MBR&#20998;&#21306;&#26159;&#21542;&#20462;&#22797;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">exit</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">exit</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">reboot</span>
</pre>
</div>

<p>
èŒƒä¾‹ï¼šä¿®å¤grubçš„ç¬¬1.5 é˜¶æ®µæ•…éšœ
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#30772;&#22351;1&#38454;&#27573;</span>
[root@centos6 ~]#dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/dev/sda <span style="color: #a0522d;">bs</span>=1 <span style="color: #a0522d;">count</span>=446
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#22797;&#25152;&#26377;&#38454;&#27573;</span>
[root@centos6 ~]#grub
grub&gt; root (hd0,0)
<span style="color: #0000ff;">root</span> (hd0,0)
 Filesystem type is ext2fs, partition type 0x83
grub&gt; setup (hd0)
<span style="color: #0000ff;">setup</span> (hd0)
 Checking if <span style="color: #8b2252;">"/boot/grub/stage1"</span> exists... no
 Checking if <span style="color: #8b2252;">"/grub/stage1"</span> exists... yes
 Checking if <span style="color: #8b2252;">"/grub/stage2"</span> exists... yes
 Checking if <span style="color: #8b2252;">"/grub/e2fs_stage1_5"</span> exists... yes
 Running <span style="color: #8b2252;">"embed /grub/e2fs_stage1_5 (hd0)"</span>...  27 sectors are embedded.
succeeded
 Running <span style="color: #8b2252;">"install /grub/stage1 (hd0) (hd0)1+27 p (hd0,0)/grub/stage2 /grub/grub.conf"</span>... succeeded
Done.
grub&gt; quit
quit

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#30772;&#22351;&#31532;1.5 &#38454;&#27573;&#25925;&#38556;</span>
[root@centos6 ~]#dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/dev/sda <span style="color: #a0522d;">bs</span>=512 <span style="color: #a0522d;">count</span>=25 <span style="color: #a0522d;">seek</span>=1
[root@centos6 ~]#reboot
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26080;&#27861;&#21551;&#21160;&#65292;&#26174;&#31034;&#19979;&#38754;&#30028;&#38754;</span>
</pre>
</div>


<figure id="orge76dec4">
<img src="images/image-20210214172820316.png" alt="image-20210214172820316.png" width="60%">

</figure>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20809;&#30424;&#21551;&#21160;&#65292;&#36827;&#20837;rescue&#27169;&#24335; </span>
chroot /mnt/sysimage
grub-install /dev/sda
sync 
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25353; ctrl+alt+delete &#19977;&#20010;&#38190;&#37325;&#21551;&#21160;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d748c701-b6ac-478b-a1f4-e017fbd435ea" class="outline-5">
<h5 id="h:d748c701-b6ac-478b-a1f4-e017fbd435ea">èŒƒä¾‹ï¼šç ´è§£rootå£ä»¤</h5>
<div class="outline-text-5" id="text-h:d748c701-b6ac-478b-a1f4-e017fbd435ea">
<p>
æ–¹æ³•1ï¼šæ’å…¥å…‰ç›˜ï¼Œä½¿ç”¨æ•‘æ´æ¨¡å¼ï¼Œè¿›å…¥ç³»ç»ŸæŠŠ/etc/shadowä¸­rootå¯†ç åˆ é™¤
</p>

<p>
æ–¹æ³•2ï¼šå•ç”¨æˆ·æ¨¡å¼ï¼Œæ— æ³•è¿ç½‘ç»œï¼Œåªèƒ½åœ¨ç°åœº
</p>
<pre class="example" id="org55d5cbe">
1. æ“ä½œç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œè¾“å…¥ä»»æ„é”®æ˜¾ç¤ºå‡ºgrubèœå•ã€‚æç¤ºå¦‚ä¸‹
    å›è½¦ï¼šç›´æ¥å¯åŠ¨
    e: å¯åŠ¨å‰ç¼–è¾‘å‘½ä»¤
    a: ä¿®æ”¹å†…æ ¸å‚æ•°
    c: è¿›å…¥å‘½ä»¤è¡Œ

2. è¾“å…¥aæ·»åŠ å‚æ•°ï¼Œåœ¨é€‰å®šçš„kernelæœ€åé™„åŠ 1ã€ sã€ Sã€single ä»»æ„ä¸€ä¸ªï¼Œéƒ½å¯ä»¥è¿›å…¥å•ç”¨æˆ·æ¨¡å¼ã€‚
3. é‡è®¾rootå¯†ç ï¼Œè¾“å…¥ passwd
</pre>

<p>
èŒƒä¾‹: ç»™grub æ·»åŠ å¯†ç ,é˜²æ­¢å•ç”¨æˆ·æ¨¡å¼ç ´è§£rootå¯†ç 
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#grub-crypt <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29983;&#25104;&#23494;&#30721;</span>
Password: 
Retype password: 
$<span style="color: #a0522d;">6</span>$<span style="color: #a0522d;">RedtvBe0D0sM8yKq</span>$<span style="color: #a0522d;">yKwmmnHSDb9wDRUuZbC3H1ZNwIlf</span>/Mh88MXa3JzXloXyy0hXIxFwLIoMdgmYFfkWXxkP.vW3ypIla4P5zUKuT.

[root@centos6 ~]#vim /boot/grub/grub.conf <span style="color: #b22222;"># </span><span style="color: #b22222;">grub &#21152;&#23494;</span>
<span style="color: #a0522d;">default</span>=0
<span style="color: #a0522d;">timeout</span>=5
password --encrypt $<span style="color: #a0522d;">6</span>$<span style="color: #a0522d;">RedtvBe0D0sM8yKq</span>$<span style="color: #a0522d;">yKwmmnHSDb9wDRUuZbC3H1ZNwIlf</span>/Mh88MXa3JzXloXyy0hXIxFwLIoMdgmYFfkWXxkP.vW3ypIla4P5zUKuT.
<span style="color: #a0522d;">splashimage</span>=(hd0,0)/grub/splash.xpm.gz
hiddenmenu
title CentOS 6 (2.6.32-754.el6.x86_64)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:46b18b4d-50ff-447d-b261-0cd00eb96f42" class="outline-5">
<h5 id="h:46b18b4d-50ff-447d-b261-0cd00eb96f42">èŒƒä¾‹: grubå®šåˆ¶èƒŒæ™¯å›¾ï¼š</h5>
<div class="outline-text-5" id="text-h:46b18b4d-50ff-447d-b261-0cd00eb96f42">
<p>
gimpè½¯ä»¶ï¼Œxpmå›¾ç‰‡æ ¼å¼è¦æ±‚
</p>
<ol class="org-ol">
<li>å›¾ç‰‡å¿…é¡»æ˜¯xpmæ ¼å¼</li>
<li>å›¾ç‰‡å¤§å°å¿…é¡»æ˜¯640Ã—480</li>
<li>å›¾ç‰‡åªèƒ½æœ‰14ç§é¢œè‰²</li>
</ol>

<p>
èŒƒä¾‹ï¼šç”ŸæˆèƒŒæ™¯å›¾ç‰‡
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;&#22270;&#29255; winner.png &#65292;&#21046;&#20316;</span>
[root@centos6 ~]#convert -resize 640x480 -colors 14 winner.png splash.xpm
[root@centos6 ~]#more splash.xpm <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32467;&#26524;&#20013;&#26377; 640 480 41&#31561;&#21363;&#20026;&#27491;&#24120;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104; grub &#25903;&#25345;&#30340; gz&#26684;&#24335;&#65292;splash.xpm.gz</span>
[root@centos6 ~]#gzip   splash.xpm 
[root@centos6 ~]#mv splash.xpm.gz /boot/grub
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:5ad3069c-afe1-4589-afc0-7a21c41947ae" class="outline-4">
<h4 id="h:5ad3069c-afe1-4589-afc0-7a21c41947ae">åŠ è½½ kernel</h4>
<div class="outline-text-4" id="text-h:5ad3069c-afe1-4589-afc0-7a21c41947ae">
<p>
kernel è‡ªèº«åˆå§‹åŒ–è¿‡ç¨‹
</p>

<ol class="org-ol">
<li>æ¢æµ‹å¯è¯†åˆ«åˆ°çš„æ‰€æœ‰ç¡¬ä»¶è®¾å¤‡</li>
<li>åŠ è½½ç¡¬ä»¶é©±åŠ¨ç¨‹åºï¼ˆå€ŸåŠ©äºramdiskåŠ è½½é©±åŠ¨ï¼‰</li>
<li>ä»¥åªè¯»æ–¹å¼æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ</li>
<li>è¿è¡Œç”¨æˆ·ç©ºé—´çš„ç¬¬ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼š/sbin/init</li>
</ol>

<p>
Linuxå†…æ ¸ç‰¹ç‚¹ï¼š
</p>

<ul class="org-ul">
<li>æ”¯æŒæ¨¡å—åŒ–ï¼š.koï¼ˆå†…æ ¸å¯¹è±¡ï¼‰ï¼Œå¦‚ï¼šæ–‡ä»¶ç³»ç»Ÿï¼Œç¡¬ä»¶é©±åŠ¨ï¼Œç½‘ç»œåè®®ç­‰</li>
<li>æ”¯æŒå†…æ ¸æ¨¡å—çš„åŠ¨æ€è£…è½½å’Œå¸è½½</li>
</ul>

<p>
å†…æ ¸ç»„æˆéƒ¨åˆ†ï¼š
</p>

<ul class="org-ul">
<li><p>
æ ¸å¿ƒæ–‡ä»¶ï¼š/boot/vmlinuz-VERSION-release
</p>

<p>
ramdiskï¼šè¾…åŠ©çš„ä¼ªæ ¹ç³»ç»Ÿï¼ŒåŠ è½½ç›¸åº”çš„ç¡¬ä»¶é©±åŠ¨ï¼Œramdisk &#x2013;&gt; ramfsæé«˜é€Ÿåº¦
</p>
<ul class="org-ul">
<li>CentOS 5 /boot/initrd-VERSION-release.img</li>
<li>CentOS 6 ä»¥åç‰ˆæœ¬/boot/initramfs-VERSION-release.img ï¼ˆåŠ è½½æ ¹ï¼‰</li>
</ul></li>

<li>æ¨¡å—æ–‡ä»¶ï¼š/lib/modules/VERSION-release</li>
</ul>

<p>
èŒƒä¾‹ï¼šè¯¯åˆ é™¤å†…æ ¸æ–‡ä»¶/boot/vmlinuz-2.6.32-754.el6.x86_64æ— æ³•å¯åŠ¨ï¼Œæ•…éšœæ¢å¤
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#20869;&#26680;&#25991;&#20214;&#26469;&#33258;&#21738;&#20010;&#21253;</span>
[root@centos6 ~]#rpm -qf /boot/vmlinuz-2.6.32-754.el6.x86_64
kernel-2.6.32-754.el6.x86_64

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#30772;&#22351;&#65292;&#21024;&#38500;&#20869;&#26680;&#25991;&#20214;</span>
[root@centos6 ~]#rm -f /boot/vmlinuz-2.6.32-754.el6.x86_64
[root@centos6 ~]#reboot

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25554;&#20837;&#20809;&#30424;&#65292;&#20351;&#29992;&#20809;&#30424;&#21551;&#21160;&#65292;&#36827;&#20837;rescue&#25937;&#25588;&#27169;&#24335;&#8220;Rescue installed system&#8221;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25805;&#20316;&#31995;&#32479;&#30340;&#26681;&#25346;&#36733;&#21040;&#20102;/mnt/sysimge&#25991;&#20214;&#22841;&#19979;</span>
chroot /mnt/sysimage
mount /dev/sr0 /mnt/  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25346;&#20809;&#30424;&#65292;&#37324;&#38754;&#26377;&#20869;&#26680;&#23433;&#35013;&#21253;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;1 </span>
rpm -ivh /mnt/Packages/kernel.xxxx.rpm --root=/mnt/sysimage --force  

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;2 </span>
cp /mnt/isolinux/vmlinuz /boot/vmlinuz-2.6.32-754.el6.x86_64
sync
<span style="color: #a020f0;">exit</span>
reboot
</pre>
</div>
</div>
<div id="outline-container-h:e6735169-2d9b-49a9-a7a6-b4711266f38d" class="outline-5">
<h5 id="h:e6735169-2d9b-49a9-a7a6-b4711266f38d">ramdiskæ–‡ä»¶çš„åˆ¶ä½œ</h5>
<div class="outline-text-5" id="text-h:e6735169-2d9b-49a9-a7a6-b4711266f38d">
<p>
mkinitrdå‘½ä»¤
</p>
<div class="org-src-container">
<pre class="src src-sh">mkinitrd /boot/initramfs-$(uname -r).img $(uname -r) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38388;&#25509;&#35843;&#29992;dracut&#21629;&#20196;</span>
</pre>
</div>

<p>
dracutå‘½ä»¤
</p>
<div class="org-src-container">
<pre class="src src-sh">dracut /boot/initramfs-$(uname -r).img $(uname -r)
</pre>
</div>

<blockquote>
<p>
ç›®å‰ï¼ŒåŠ è½½æ–‡ä»¶ç³»ç»Ÿçš„é©±åŠ¨æ˜¯bootæ‰€åœ¨åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ã€‚è€Œæˆ‘ä»¬åŠ è½½æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨èƒ½æ‰¾åˆ°å†…æ ¸äº†ï¼Œ
å†…æ ¸å¯åŠ¨ä¹‹ååŠ è½½çœŸæ­£ç¡¬ç›˜æ ¹ï¼ŒçœŸæ­£ç¡¬ç›˜æ ¹çš„æ–‡ä»¶ç³»ç»Ÿå’Œbootä¸­çš„æ ¹(/vmlinuz)æ–‡ä»¶ç³»ç»Ÿå¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œ
è¿›å…¥åˆ°çœŸæ­£ç¡¬ç›˜ä¸­æ ¹å°±è¦åŠ è½½æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ï¼Œé©±åŠ¨ç¨‹åºæ–‡ä»¶å®é™…ä¸Šæ˜¯åœ¨ç¡¬ç›˜ä¸Šçš„ï¼Œé€šè¿‡ <code>modinfo ext4</code> æ¥æ‰¾åˆ°å·²è¿è¡Œå®ä¾‹æ–‡ä»¶ç³»ç»Ÿå¯¹åº”é©±åŠ¨ä½ç½®ï¼Œ
ä½†æˆ‘ä»¬ä¸èƒ½ç›´æ¥è¿›å…¥çœŸæ­£çš„ç¡¬ç›˜ï¼Œè¿™æ—¶å°±ä¼šç”¨/bootä¸‹æ–‡ä»¶ï¼Œæå‰å­˜æ”¾äº†å„ç§æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ç¨‹åºã€‚
<code>initrd /initramfs.im</code> ç²¾ç®€ç‰ˆå°linuxç³»ç»Ÿï¼Œå­˜æ”¾äº†å¤šç§æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨
</p>

<p>
åŠ è½½æ“ä½œç³»ç»Ÿæ ¹åï¼Œæ‰èƒ½è¿›è¡Œåç»­çš„å¯åŠ¨è¿‡ç¨‹
</p>
</blockquote>

<p>
èŒƒä¾‹ï¼šæŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#25991;&#20214;&#31867;&#22411;&#65292;&#21457;&#29616;&#26159;&#21387;&#32553;&#25991;&#20214;&#65292;&#20351;&#29992;&#23545;&#24212;&#30340;&#35299;&#21387;&#32553;&#24037;&#20855;&#35299;&#21387;</span>
[root@test jasper]# file initramfs-6.1.106-116.188.amzn2023.aarch64.img 
initramfs-6.1.106-116.188.amzn2023.aarch64.img: Zstandard compressed data (v0.8+), Dictionary ID: None
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#25991;&#20214;&#21518;&#32512;</span>
[root@test jasper]# mv initramfs-6.1.106-116.188.amzn2023.aarch64.img  initramfs-6.1.106-116.188.amzn2023.aarch64.img.zst
[root@test jasper]# zstd -d initramfs-6.1.106-116.188.amzn2023.aarch64.img.zst 
initramfs-6.1.106-116.188.amzn2023.aarch64.img.zst: 50185216 bytes

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#25991;&#20214;&#31867;&#22411;&#65292;&#21457;&#29616;&#26159;cpio&#25991;&#20214;</span>
[root@test jasper]# file initramfs-6.1.106-116.188.amzn2023.aarch64.img
initramfs-6.1.106-116.188.amzn2023.aarch64.img: ASCII cpio archive (SVR4 with no CRC)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;cpio&#25991;&#20214;&#20869;&#23481;</span>
[root@test jasper]# cpio -tv &lt; initramfs-6.1.106-116.188.amzn2023.aarch64.img
drwxr-xr-x  12 root     root            0 Jul  6  2023 .
lrwxrwxrwx   1 root     root            7 Jul  6  2023 bin -&gt; usr/bin
drwxr-xr-x   2 root     root            0 Jul  6  2023 dev
crw-r--r--   1 root     root       5,   1 Jul  6  2023 dev/console
crw-r--r--   1 root     root       1,  11 Jul  6  2023 dev/kmsg
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35299;&#21387;cpio&#25991;&#20214;</span>
[root@test jasper]# cpio -idv &lt; initramfs-6.1.106-116.188.amzn2023.aarch64.img
[root@test jasper]# ls
bin  etc   initramfs-6.1.106-116.188.amzn2023.aarch64.img      lib    proc  run   shutdown  sysroot  usr
dev  init  initramfs-6.1.106-116.188.amzn2023.aarch64.img.zst  lib64  root  sbin  sys       tmp      var

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#26377;&#27809;&#26377;ext4&#30340;&#39537;&#21160;</span>
[root@test jasper]# find -name ext4.ko
./usr/lib/modules/6.1.106-116.188.amzn2023.aarch64/kernel/fs/ext4/ext4.ko
</pre>
</div>

<p>
å°ç»“ï¼šå¯åŠ¨è¿‡ç¨‹
</p>
<ol class="org-ol">
<li>POSTåŠ ç”µè‡ªæ£€</li>
<li>bootloader</li>
<li>kernel å€ŸåŠ©grub.confæ‰¾åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸</li>
<li>intramfs.&lt;version&gt;.img åœ¨è¿›å…¥åˆ°æ“ä½œç³»ç»Ÿçš„æ ¹ä¹‹å‰ï¼Œå€ŸåŠ©intramfs.&lt;version&gt;.img å°å‹linuxæ¥æŒ‚è½½å®Œæ•´ç‰ˆçš„æ ¹</li>
<li>/ è¿›å…¥æ“ä½œç³»ç»Ÿçš„æ ¹</li>
</ol>
</div>
</div>
<div id="outline-container-h:c7694ad5-1b56-4643-b12c-0667a2e9184a" class="outline-5">
<h5 id="h:c7694ad5-1b56-4643-b12c-0667a2e9184a">èŒƒä¾‹: è¯¯åˆ é™¤/boot/initramfs-2.6.32-754.el6.x86_64.imgæ— æ³•å¯åŠ¨ï¼Œæ•…éšœæ¢å¤</h5>
<div class="outline-text-5" id="text-h:c7694ad5-1b56-4643-b12c-0667a2e9184a">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#30772;&#22351;&#65292;&#21024;&#38500;&#20266;&#26681;&#25991;&#20214;&#31995;&#32479;</span>
[root@centos6 ~]#rm -f /boot/initramfs-2.6.32-754.el6.x86_64.img
[root@centos6 ~]#reboot

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25554;&#20837;&#20809;&#30424;&#65292;&#20351;&#29992;&#20809;&#30424;&#21551;&#21160;&#65292;&#36827;&#20837;rescue&#25937;&#25588;&#27169;&#24335;&#8220;Rescue installed system&#8221;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25805;&#20316;&#31995;&#32479;&#30340;&#26681;&#25346;&#36733;&#21040;&#20102;/mnt/sysimge&#25991;&#20214;&#22841;&#19979;</span>
chroot /mnt/sysimage
mkinitrd /boot/initramfs-$(uname -r).img $(uname -r)
sync

<span style="color: #a020f0;">exit</span>
<span style="color: #a020f0;">exit</span>
reboot
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a04675a0-6c3c-47e7-9b0c-c3eb21e9ff51" class="outline-5">
<h5 id="h:a04675a0-6c3c-47e7-9b0c-c3eb21e9ff51">èŒƒä¾‹ï¼šè¯¯åˆ é™¤/bootç›®å½•ï¼Œè¿›è¡Œæ•…éšœæ¢å¤</h5>
<div class="outline-text-5" id="text-h:a04675a0-6c3c-47e7-9b0c-c3eb21e9ff51">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#30772;&#22351;&#65292;&#21024;&#38500;/boot&#30446;&#24405;</span>
rm -fr /boot
reboot

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25554;&#20837;&#20809;&#30424;&#65292;&#20351;&#29992;&#20809;&#30424;&#21551;&#21160;&#65292;&#36827;&#20837;rescue&#25937;&#25588;&#27169;&#24335;&#8220;Rescue installed system&#8221;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25805;&#20316;&#31995;&#32479;&#30340;&#26681;&#25346;&#36733;&#21040;&#20102;/mnt/sysimge&#25991;&#20214;&#22841;&#19979;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20808;&#20462;&#22797;&#20869;&#26680;&#65292;&#20877;&#20462;&#22797;grub</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">1.&#20462;&#20869;&#26680;</span>
chroot /mnt/sysimage
mount /dev/sr0 /mnt/  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25346;&#20809;&#30424;&#65292;&#37324;&#38754;&#26377;&#20869;&#26680;&#23433;&#35013;&#21253;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;1 </span>
rpm -ivh /mnt/Packages/kernel.xxxx.rpm --root=/mnt/sysimage --force
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;2 </span>
cp /mnt/isolinux/vmlinuz /boot/ <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#22797;&#20869;&#26680;</span>
mkinitrd /boot/initramfs.img $(uname -r)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#22797;nitramfs</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">2.&#20462;grub</span>
grub-install /dev/sda

<span style="color: #b22222;">#</span><span style="color: #b22222;">2.1&#28155;&#21152;grub.conf</span>
cat &lt;&lt;\EOF&gt; /boot/grub/grub.conf
<span style="color: #ffa54f;">default=0</span>
<span style="color: #ffa54f;">timeout=5</span>
<span style="color: #ffa54f;">title My Linux</span>
<span style="color: #ffa54f;">kernel (hd0,0)/vmlinuz root=/dev/sda2</span>
<span style="color: #ffa54f;">initrd (hd0,0)/initramfs.img</span>
<span style="color: #ffa54f;">EOF</span>

sync
reboot
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:922e18db-8e34-4983-a49c-e6981c4d049d" class="outline-4">
<h4 id="h:922e18db-8e34-4983-a49c-e6981c4d049d">initåˆå§‹åŒ–</h4>
<div class="outline-text-4" id="text-h:922e18db-8e34-4983-a49c-e6981c4d049d">
<p>
POST &#x2013;&gt; BootSequence (BIOS) &#x2013;&gt; Bootloader(MBR) &#x2013;&gt; kernel(ramdisk) &#x2013;&gt;rootfs(åªè¯») &#x2013;&gt; initï¼ˆsystemdï¼‰
</p>

<p>
å°ç»“ï¼šå¯åŠ¨è¿‡ç¨‹
</p>
<ol class="org-ol">
<li>POSTåŠ ç”µè‡ªæ£€</li>
<li>GRUB1é˜¶æ®µMBR446</li>
<li>GRUB1.5é˜¶æ®µMBRä¹‹å(æä¾›grub2æ–‡ä»¶æ‰€æœ‰åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿ)</li>
<li>GRUB2é˜¶æ®µ(grub.conf)</li>
<li>kernel (initramfs.img)å€ŸåŠ©grub.confæ‰¾åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸, æ ¹åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿç”±initramfs.imgæä¾›</li>
<li>/ è¿›å…¥æ“ä½œç³»ç»Ÿçš„æ ¹</li>
<li>/sbin/init åŠ è½½ç³»ç»Ÿä¸­ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œåˆå§‹åŒ–</li>
<li><i>etc/inittab è¿›å…¥ç³»ç»Ÿæ¨¡å¼, æ¯ä¸ªæ¨¡å¼å¯åŠ¨çš„æœåŠ¡æ˜¯ä¸ä¸€æ ·çš„ã€‚æ¯ä¸ªæ¨¡å¼éƒ½ä¸€ä¸ªæ–‡ä»¶å¤¹ /etc/rc*.d</i>, å¦‚ <i>etc/rc0.d</i>, <i>etc/rc1.d</i>,&#x2026;, <i>etc/rc6.d</i>, <i>etc/rc.d</i>.   æ–‡ä»¶å¤¹é‡Œéƒ½æ˜¯è½¯è¿æ¥æŒ‡å‘æœåŠ¡å¯åŠ¨åœæ­¢è„šæœ¬ /etc/init.d/*</li>
</ol>

<p>
initç¨‹åºçš„ç±»å‹ï¼š
</p>

<ol class="org-ol">
<li>SysV: init, CentOS 5ä¹‹å‰ é…ç½®æ–‡ä»¶ï¼š/etc/inittab</li>
<li>Upstart: init,CentOS 6 é…ç½®æ–‡ä»¶ï¼š/etc/inittab, /etc/init/*.conf</li>
<li>Systemdï¼šsystemd, CentOS 7 é…ç½®æ–‡ä»¶ï¼š/usr/lib/systemd/system   /etc/systemd/system</li>
</ol>
</div>
<div id="outline-container-h:a3070eb9-6255-4bee-982a-1e7ffcfe3ed4" class="outline-5">
<h5 id="h:a3070eb9-6255-4bee-982a-1e7ffcfe3ed4">è¿è¡Œçº§åˆ«</h5>
<div class="outline-text-5" id="text-h:a3070eb9-6255-4bee-982a-1e7ffcfe3ed4">
<p>
è¿è¡Œçº§åˆ«ï¼šä¸ºç³»ç»Ÿè¿è¡Œæˆ–ç»´æŠ¤ç­‰ç›®çš„è€Œè®¾å®šï¼›0-6ï¼š7ä¸ªçº§åˆ«ï¼Œä¸€èˆ¬ä½¿ç”¨3,
5åšä¸ºé»˜è®¤çº§åˆ«
</p>

<div class="org-src-container">
<pre class="src src-sh">0&#65306;&#20851;&#26426;
1&#65306;&#21333;&#29992;&#25143;&#27169;&#24335;(root&#33258;&#21160;&#30331;&#24405;), single, &#32500;&#25252;&#27169;&#24335;
2&#65306;&#22810;&#29992;&#25143;&#27169;&#24335;&#65292;&#21551;&#21160;&#32593;&#32476;&#21151;&#33021;&#65292;&#20294;&#19981;&#20250;&#21551;&#21160;NFS&#65307;&#32500;&#25252;&#27169;&#24335;
3&#65306;&#22810;&#29992;&#25143;&#27169;&#24335;&#65292;&#27491;&#24120;&#27169;&#24335;&#65307;&#25991;&#26412;&#30028;&#38754;
4&#65306;&#39044;&#30041;&#32423;&#21035;&#65307;&#21487;&#21516;3&#32423;&#21035;
5&#65306;&#22810;&#29992;&#25143;&#27169;&#24335;&#65292;&#27491;&#24120;&#27169;&#24335;&#65307;&#22270;&#24418;&#30028;&#38754;
6&#65306;&#37325;&#21551;
</pre>
</div>

<p>
åˆ‡æ¢çº§åˆ«ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">init <span style="color: #b22222;">#</span>
</pre>
</div>

<p>
æŸ¥çœ‹çº§åˆ«ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">runlevel 
who -r
</pre>
</div>

<p>
å®šä¹‰è¿è¡Œçº§åˆ«
</p>

<div class="org-src-container">
<pre class="src src-sh">/etc/inittab
</pre>
</div>

<p>
CentOS 5 çš„inittabæ–‡ä»¶è¿˜å®šä¹‰ä»¥ä¸‹å†…å®¹
</p>

<pre class="example" id="org4c3eacf">
åˆå§‹è¿è¡Œçº§åˆ«(RUN LEVEL)
ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬
å¯¹åº”è¿è¡Œçº§åˆ«çš„è„šæœ¬ç›®å½•
æ•è·æŸä¸ªå…³é”®å­—é¡ºåº
å®šä¹‰UPSç”µæºç»ˆç«¯/æ¢å¤è„šæœ¬
åœ¨è™šæ‹Ÿæ§åˆ¶å°ç”Ÿæˆgetty
åœ¨è¿è¡Œçº§åˆ«5åˆå§‹åŒ–X
</pre>

<p>
CentOS 5 çš„inittabæ–‡ä»¶æ¯ä¸€è¡Œæ ¼å¼ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">id:runlevel:action:process

id&#65306;&#26159;&#24799;&#19968;&#26631;&#35782;&#35813;&#39033;&#30340;&#23383;&#31526;&#24207;&#21015;
runlevels&#65306; &#23450;&#20041;&#20102;&#25805;&#20316;&#25152;&#20351;&#29992;&#30340;&#36816;&#34892;&#32423;&#21035;
action&#65306; &#25351;&#23450;&#20102;&#35201;&#25191;&#34892;&#30340;&#29305;&#23450;&#25805;&#20316;
         <span style="color: #483d8b;">wait</span>: &#20999;&#25442;&#33267;&#27492;&#32423;&#21035;&#36816;&#34892;&#19968;&#27425;
         respawn&#65306;&#27492;process&#32456;&#27490;&#65292;&#23601;&#37325;&#26032;&#21551;&#21160;&#20043;
         initdefault&#65306;&#35774;&#23450;&#40664;&#35748;&#36816;&#34892;&#32423;&#21035;&#65307;process&#30465;&#30053;
         sysinit&#65306;&#35774;&#23450;&#31995;&#32479;&#21021;&#22987;&#21270;&#26041;&#24335;
process&#65306;&#23450;&#20041;&#20102;&#35201;&#25191;&#34892;&#30340;&#36827;&#31243;
</pre>
</div>

<p>
èŒƒä¾‹ï¼šCentOS 5 çš„inittabæ–‡ä»¶
</p>

<div class="org-src-container">
<pre class="src src-sh">id:5:initdefault:
si::sysinit:/etc/rc.d/rc.sysinit
l0:0:wait:/etc/rc.d/rc 0
l1:1:wait:/etc/rc.d/rc 1
l2:2:wait:/etc/rc.d/rc 2
l3:3:wait:/etc/rc.d/rc 3
l4:4:wait:/etc/rc.d/rc 4
l5:5:wait:/etc/rc.d/rc 5
l6:6:wait:/etc/rc.d/rc 6
ca::ctrlaltdel:/sbin/shutdown -t3 -r now
pf::powerfail:/sbin/shutdown -f -h +2 <span style="color: #8b2252;">"Power Failure; System Shutting Down&#8221;</span>
<span style="color: #8b2252;">pr:12345:powerokwait:/sbin/shutdown -c "</span>Power Restored; Shutdown Cancelled&#8221;
1:2345:respawn:/sbin/mingetty tty1
2:2345:respawn:/sbin/mingetty tty2
3:2345:respawn:/sbin/mingetty tty3
4:2345:respawn:/sbin/mingetty tty4
5:2345:respawn:/sbin/mingetty tty5
6:2345:respawn:/sbin/mingetty tty6
x:5:respawn:/etc/X11/prefdm -nodaemon
</pre>
</div>

<p>
CentOS 6 /etc/inittabå’Œç›¸å…³æ–‡ä»¶
</p>

<p>
CentOS 6 initç¨‹åºä¸º upstart, å…¶é…ç½®æ–‡ä»¶/etc/inittab, /etc/init/*.confï¼Œ
é…ç½®æ–‡ä»¶çš„è¯­æ³• éµå¾ªupstarté…ç½®æ–‡ä»¶è¯­æ³•æ ¼å¼ï¼Œå’ŒCentOS5ä¸åŒ
</p>

<div class="org-src-container">
<pre class="src src-sh">/etc/inittab &#35774;&#32622;&#31995;&#32479;&#40664;&#35748;&#30340;&#36816;&#34892;&#32423;&#21035;
/etc/init/control-alt-delete.conf
/etc/init/tty.conf
/etc/init/start-ttys.conf
/etc/init/rc.conf
/etc/init/prefdm.conf
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c24479f4-cd07-49f4-aac2-c46a4868a46e" class="outline-5">
<h5 id="h:c24479f4-cd07-49f4-aac2-c46a4868a46e">åˆå§‹åŒ–è„šæœ¬ sysinit</h5>
<div class="outline-text-5" id="text-h:c24479f4-cd07-49f4-aac2-c46a4868a46e">
<div class="org-src-container">
<pre class="src src-sh">/etc/rc.d/rc.sysinit
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#cat /etc/init/rcS.conf  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36890;&#36807;&#36825;&#20010;&#25991;&#20214;&#35843;&#29992; &#33050;&#26412; /etc/rc.d/rc.sysinit</span>
</pre>
</div>

<p>
ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬åŠŸèƒ½
</p>

<div class="org-src-container">
<pre class="src src-sh">(1) &#35774;&#32622;&#20027;&#26426;&#21517;
(2) &#35774;&#32622;&#27426;&#36814;&#20449;&#24687;
(3) &#28608;&#27963;udev&#21644;selinux 
(4) &#25346;&#36733;/etc/fstab&#25991;&#20214;&#20013;&#23450;&#20041;&#30340;&#25991;&#20214;&#31995;&#32479;
(5) &#26816;&#27979;&#26681;&#25991;&#20214;&#31995;&#32479;&#65292;&#24182;&#20197;&#35835;&#20889;&#26041;&#24335;&#37325;&#26032;&#25346;&#36733;&#26681;&#25991;&#20214;&#31995;&#32479;
(6) &#35774;&#32622;&#31995;&#32479;&#26102;&#38047;
(7) &#28608;&#27963;swap&#35774;&#22791;
(8) &#26681;&#25454;/etc/sysctl.conf&#25991;&#20214;&#35774;&#32622;&#20869;&#26680;&#21442;&#25968;
(9) &#28608;&#27963;lvm&#21450;software raid&#35774;&#22791;
(10)&#21152;&#36733;&#39069;&#22806;&#35774;&#22791;&#30340;&#39537;&#21160;&#31243;&#24207;
(11)&#28165;&#29702;&#25805;&#20316;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:329773be-3b6d-4bda-ae51-75bc045717be" class="outline-5">
<h5 id="h:329773be-3b6d-4bda-ae51-75bc045717be">æœåŠ¡ç®¡ç†</h5>
<div class="outline-text-5" id="text-h:329773be-3b6d-4bda-ae51-75bc045717be">
<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#cat /etc/init/rc.conf 
<span style="color: #b22222;"># </span><span style="color: #b22222;">rc - System V runlevel compatibility</span>
<span style="color: #b22222;">#</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">This task runs the old sysv-rc runlevel scripts. It</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">is usually started by the telinit compatibility wrapper.</span>
<span style="color: #b22222;">#</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Do not edit this file directly. If you want to change the behaviour,</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">please create a file rc.override and put your changes there.</span>

start on runlevel [0123456]

stop on runlevel [!$<span style="color: #a0522d;">RUNLEVEL</span>]

task

<span style="color: #483d8b;">export</span> RUNLEVEL
console output
<span style="color: #a020f0;">exec</span> /etc/rc.d/rc $<span style="color: #a0522d;">RUNLEVEL</span>
</pre>
</div>

<p>
service å‘½ä»¤ï¼šæ‰‹åŠ¨ç®¡ç†æœåŠ¡
</p>

<div class="org-src-container">
<pre class="src src-sh">service &#26381;&#21153; start|stop|restart
service --status-all
</pre>
</div>

<p>
/etc/rc.d/rc æ§åˆ¶æœåŠ¡è„šæœ¬çš„å¼€æœºè‡ªåŠ¨è¿è¡Œ
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #a020f0;">for</span> srv<span style="color: #a020f0;"> in</span> /etc/rc.d/rcN.d/K*; <span style="color: #a020f0;">do</span>
    $<span style="color: #a0522d;">srv</span> stop
<span style="color: #a020f0;">done</span>
<span style="color: #a020f0;">for</span> srv<span style="color: #a020f0;"> in</span> /etc/rc.d/rcN.d/S*; <span style="color: #a020f0;">do</span>
    $<span style="color: #a0522d;">srv</span> start
<span style="color: #a020f0;">done</span>
</pre>
</div>

<p>
è¯´æ˜ï¼šrc N &#x2013;&gt; æ„å‘³ç€è¯»å–/etc/rc.d/rcN.d/
</p>
<ul class="org-ul">
<li>K: K##ï¼š##è¿è¡Œæ¬¡åºï¼›æŒ‰ç…§å­—æ¯çš„å­—ç¬¦åºæ¥æ’åºè¿è¡Œï¼›æ•°å­—è¶Šå°çš„æœåŠ¡ï¼Œé€šå¸¸ä¸ºä¾èµ–åˆ°
åˆ«çš„æœåŠ¡</li>

<li>S: S##ï¼š##è¿è¡Œæ¬¡åºï¼›æŒ‰ç…§å­—æ¯çš„å­—ç¬¦åºæ¥æ’åºè¿è¡Œï¼›æ•°å­—è¶Šå°çš„æœåŠ¡ï¼Œé€šå¸¸ä¸ºè¢«ä¾èµ–
åˆ°çš„æœåŠ¡</li>
</ul>

<p>
é…ç½®æœåŠ¡å¼€æœºå¯åŠ¨
</p>

<ul class="org-ul">
<li>chkconfigå‘½ä»¤</li>
<li>ntsysvå‘½ä»¤ åºŸå¼ƒäº†ï¼Œå›¾å½¢ç•Œé¢ åªèƒ½æ”¹ä¸€ç§æ¨¡å¼</li>
</ul>

<p>
<b>chkconfig å‘½ä»¤ç®¡ç†æœåŠ¡</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#26381;&#21153;&#22312;&#25152;&#26377;&#32423;&#21035;&#30340;&#21551;&#21160;&#25110;&#20851;&#38381;&#35774;&#23450;&#24773;&#24418;&#65306;</span>
chkconfig [--list] [name]

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#28155;&#21152;&#26381;&#21153;</span>
<span style="color: #0000ff;">SysV&#30340;&#26381;&#21153;&#33050;&#26412;&#25918;&#32622;&#20110;/etc/rc.d/init.d</span> (/etc/init.d)

<span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/bash</span>
chkconfig: LLLL nn nn  <span style="color: #b22222;">#</span><span style="color: #b22222;">LLLL &#34920;&#31034;&#21021;&#22987;&#22312;&#21738;&#20010;&#32423;&#21035;&#19979;&#21551;&#21160;&#65292;-&#34920;&#31034;&#37117;&#19981;&#21551;&#21160;</span>
description : &#25551;&#36848;&#20449;&#24687;

chkconfig --add name

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500;&#26381;&#21153;</span>
chkconfig --del name

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#25351;&#23450;&#30340;&#36816;&#34892;&#32423;&#21035;</span>
chkconfig [--level levels] name &lt;on|off|reset&gt;
&#35828;&#26126;&#65306;--level LLLL: &#25351;&#23450;&#35201;&#35774;&#32622;&#30340;&#32423;&#21035;&#65307;&#30465;&#30053;&#26102;&#34920;&#31034;2345
chkconfig --level 35 chronyd on
</pre>
</div>

<p>
èŒƒä¾‹ï¼šå¼€æœºå¯åŠ¨è„šæœ¬
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#vim /etc/init.d/testservice
[root@centos6 ~]#cat /etc/init.d/testservice
<span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/bash</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">chkconfig: - 98 3 </span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">description : test service scripts</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36825;&#37324;&#30340; - &#27178;&#32447;&#21021;&#22987;&#40664;&#35748;&#20840;&#26159;off&#30340;</span>

. /etc/init.d/functions

<span style="color: #0000ff;">start</span> (){
    touch /var/lock/subsys/testservice
    action <span style="color: #8b2252;">"Starting testservice:"</span>
    sleep 3
}
<span style="color: #0000ff;">stop</span> (){
    rm -f /var/lock/subsys/testservice
    action <span style="color: #8b2252;">"Shutting down testservice:"</span>
}
<span style="color: #0000ff;">restart</span> (){
    stop
    start
}
<span style="color: #0000ff;">status</span> (){
    <span style="color: #a020f0;">if</span> [ -e /var/lock/subsys/testservice ] ;<span style="color: #a020f0;">then</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"testservice is running..."</span>
    <span style="color: #a020f0;">else</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"testservice is stopped"</span>
    <span style="color: #a020f0;">fi</span>
}

<span style="color: #a020f0;">case</span> $<span style="color: #a0522d;">1</span><span style="color: #a020f0;"> in</span>
start)
    start
    ;;
stop)
    stop
    ;;
restart)
    restart
    ;;
status)
    status
    ;;
*)
    <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Usage:/etc/init.d/testservice {start|stop|restart|status}"</span>
    ;;
<span style="color: #a020f0;">esac</span>
[root@centos6 ~]#chmod +x /etc/init.d/testservice
[root@centos6 ~]#chkconfig --add testservice
[root@centos6 ~]#chkconfig --list testservice
testservice     0:off   1:off   2:on    3:on    4:on    5:on    6:off
[root@centos6 ~]#chkconfig --del testservice <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21024;&#38500;&#24320;&#26426;&#21551;&#21160;&#65292;&#23454;&#38469;&#21024;&#38500;&#36719;&#36830;&#25509;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:89dbf263-728d-4b4b-b3e6-12e8d75b9c11" class="outline-5">
<h5 id="h:89dbf263-728d-4b4b-b3e6-12e8d75b9c11">éç‹¬ç«‹æœåŠ¡</h5>
<div class="outline-text-5" id="text-h:89dbf263-728d-4b4b-b3e6-12e8d75b9c11">
<p>
æœåŠ¡åˆ†ä¸ºç‹¬ç«‹æœåŠ¡å’Œéç‹¬ç«‹æœåŠ¡
</p>

<p>
ç¬æ€ï¼ˆTransientï¼‰æœåŠ¡è¢«è¶…çº§å®ˆæŠ¤è¿›ç¨‹ xinetd è¿›ç¨‹æ‰€ç®¡ç†ï¼Œä¹Ÿç§°ä¸ºéç‹¬ç«‹æœåŠ¡ã€‚æœåŠ¡æœ‰è®¿é—®äº†å°±ä¼šè¢«å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨ã€‚
</p>

<p>
è¿›å…¥çš„è¯·æ±‚é¦–å…ˆè¢«xinetdä»£ç†
</p>

<p>
é…ç½®æ–‡ä»¶ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">/etc/xinetd.conf
/etc/xinetd.d/&lt;service&gt;
</pre>
</div>

<p>
ç”¨chkconfigæ§åˆ¶éç‹¬ç«‹æœåŠ¡å¼€æœºå¯åŠ¨
ç¤ºä¾‹ï¼šchkconfig tftp on
</p>

<p>
èŒƒä¾‹ï¼šéç‹¬ç«‹æœåŠ¡telnet-server
</p>
<div class="org-src-container">
<pre class="src src-sh">yum install telnet-server -y  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#33258;&#21160;&#25226;&#23432;&#20449;&#26381;&#21153;xinetd&#23433;&#35013;</span>
chkconfig --list

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#28608;&#27963;telnet-server</span>
chkconfig telent-server on
service xinetd start  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30417;&#25511;&#32593;&#32476;&#20013;&#30340;&#35831;&#27714;&#65292;&#26377;&#35775;&#38382;telnet-server 23&#31471;&#21475;&#26102;&#65292;&#28608;&#27963;telnet-server&#26381;&#21153;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27979;&#35797;, &#30331;&#24405;ssh</span>
~]# telnet 10.0.0.6
centos6 login: root
Password:

</pre>
</div>
</div>
</div>
<div id="outline-container-h:eb3705a5-0b35-4b40-9393-53fdd3cffaa9" class="outline-5">
<h5 id="h:eb3705a5-0b35-4b40-9393-53fdd3cffaa9">å¼€æœºå¯åŠ¨æ–‡ä»¶ rc.local</h5>
<div class="outline-text-5" id="text-h:eb3705a5-0b35-4b40-9393-53fdd3cffaa9">
<div class="org-src-container">
<pre class="src src-sh">/etc/rc.d/rc.local
</pre>
</div>

<p>
æ³¨æ„ï¼š
</p>

<ul class="org-ul">
<li>æ­£å¸¸çº§åˆ«ä¸‹ï¼Œæœ€åå¯åŠ¨ä¸€ä¸ªæœåŠ¡S99localæ²¡æœ‰é“¾æ¥è‡³/etc/rc.d/init.dä¸€ä¸ªæœ
åŠ¡è„šæœ¬ï¼Œè€Œæ˜¯æŒ‡å‘äº†/etc/rc.d/rc.localè„šæœ¬</li>
<li>ä¸ä¾¿æˆ–ä¸éœ€å†™æœåŠ¡è„šæœ¬æ”¾ç½®äº/etc/rc.d/init.d/ç›®å½•ï¼Œä¸”åˆæƒ³å¼€æœºæ—¶è‡ªåŠ¨è¿
è¡Œçš„å‘½ä»¤ï¼Œå¯ç›´æ¥æ”¾ç½®äº/etc/rc.d/rc.localæ–‡ä»¶ä¸­</li>
<li>/etc/rc.d/rc.localåœ¨æŒ‡å®šè¿è¡Œçº§åˆ«è„šæœ¬åè¿è¡Œ</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:68d3f8f3-bb2c-493c-a893-75b491828d0e" class="outline-4">
<h4 id="h:68d3f8f3-bb2c-493c-a893-75b491828d0e">CentOS6 å¯åŠ¨è¿‡ç¨‹æ€»ç»“</h4>
<div class="outline-text-4" id="text-h:68d3f8f3-bb2c-493c-a893-75b491828d0e">
<pre class="example" id="org461383f">
POST
boot loader
vmlinux(initramfs.img)
roofs
/sbin/init
/etc/inittab è®¾ç½®é»˜è®¤è¿è¡Œçº§åˆ«
/etc/rc.d/rc.sysinit   è¿è¡Œç³»ç»Ÿåˆå§‹è„šæœ¬å®Œæˆç³»ç»Ÿåˆå§‹åŒ–
/etc/rc#.d/Sxxxx  å¯åŠ¨éœ€è¦å¯åŠ¨æœåŠ¡å…³é—­å¯¹åº”ä¸éœ€è¦å¯åŠ¨æœåŠ¡
/etc/rc.d/rc.local
è®¾ç½®ç™»å½•ç»ˆç«¯
</pre>

<p>
å°ç»“ï¼šå¯åŠ¨è¿‡ç¨‹
</p>
<ol class="org-ol">
<li>POSTåŠ ç”µè‡ªæ£€</li>
<li>GRUB1é˜¶æ®µMBR446</li>
<li>GRUB1.5é˜¶æ®µMBRä¹‹åç©ºé—´(æä¾›grub2æ–‡ä»¶æ‰€æœ‰åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿ)</li>
<li>GRUB2é˜¶æ®µ(grub.conf)</li>
<li>kernel (initramfs.img)å€ŸåŠ©grub.confæ‰¾åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸, æ ¹åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿç”±initramfs.imgæä¾›</li>
<li>/ è¿›å…¥æ“ä½œç³»ç»Ÿçš„æ ¹</li>
<li>/sbin/init åŠ è½½ç³»ç»Ÿä¸­ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œåˆå§‹åŒ–</li>
<li><i>etc/inittab è¿›å…¥ç³»ç»Ÿæ¨¡å¼, æ¯ä¸ªæ¨¡å¼å¯åŠ¨çš„æœåŠ¡æ˜¯ä¸ä¸€æ ·çš„ã€‚æ¯ä¸ªæ¨¡å¼éƒ½ä¸€ä¸ªæ–‡ä»¶å¤¹ /etc/rc*.d</i>, å¦‚ <i>etc/rc0.d</i>, <i>etc/rc1.d</i>,&#x2026;, <i>etc/rc6.d</i>, <i>etc/rc.d</i>.   æ–‡ä»¶å¤¹é‡Œéƒ½æ˜¯è½¯è¿æ¥æŒ‡å‘æœåŠ¡å¯åŠ¨åœæ­¢è„šæœ¬ /etc/init.d/*</li>
<li>/etc/rc.d/rc.sysinit ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬</li>
<li>/etc/rc.d/rc  è„šæœ¬å†…å®¹ï¼Œéå†/etc/rc&lt;N&gt;.d/æ–‡ä»¶å¤¹ä¸‹è¿è¡Œæ¨¡å¼ï¼Œ /etc/rcN.d/K*æ‰€æœ‰K*å¼€å¤´æ–‡ä»¶è¿è¡Œè„šæœ¬å¹¶åŠ stopå‚æ•°ï¼›/etc/rcN.d/S*æ‰€æœ‰S*å¼€å¤´æ–‡ä»¶è¿è¡Œè„šæœ¬å¹¶åŠ startå‚æ•°ï¼›</li>
<li><i>etc/rcN.d</i> è°ƒç”¨æ–‡ä»¶å¤¹ä¸‹è½¯è¿æ¥è„šæœ¬</li>
<li>/etc/rc.local</li>
<li>loginç™»å½•</li>
</ol>

<p>
å‚çœ‹ï¼š
</p>


<figure id="orged7bc45">
<img src="images/Screenshot.jpg" alt="Screenshot.jpg" width="95%">

</figure>
</div>
</div>
<div id="outline-container-h:bc7e0987-9d2c-4c05-a5a2-6754a03a6938" class="outline-4">
<h4 id="h:bc7e0987-9d2c-4c05-a5a2-6754a03a6938">å¯åŠ¨è¿‡ç¨‹çš„æ•…éšœæ’é”™</h4>
<div class="outline-text-4" id="text-h:bc7e0987-9d2c-4c05-a5a2-6754a03a6938">
<p>
<b>å®æˆ˜æ¡ˆä¾‹ æ•…éšœ: åˆ é™¤ /sbin/init æ— æ³•å¯åŠ¨ æ¢å¤è¿‡ç¨‹</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">1 &#20808;&#36827;&#20837;grub&#33756;&#21333;&#65292;&#22312;kernel&#21442;&#25968;&#21518;&#21152; <span style="color: #a0522d;">selinux</span>=0 <span style="color: #a0522d;">init</span>=/bin/bash 

2 mount -o remount,rw /

3 mount /dev/sr0 /mnt/

4 rpm2cpio /mnt/Packages/upstart.xxx.rpm | cpio -idv ./sbin/init 

5 mv ./sbin/init /sbin/
</pre>
</div>

<p>
<b>å®æˆ˜æ¡ˆä¾‹</b>
</p>

<p>
æ•…éšœï¼šrm -rf /boot/* å’Œ /etc/fstab è¿›è¡Œæ¢å¤
</p>

<p>
æ¢å¤è¿‡ç¨‹
</p>

<ol class="org-ol">
<li>ç”¨å…‰ç›˜è¿›å…¥ rescue modeï¼Œæ‰¾åˆ°/ æ‰€åœ¨åˆ†åŒºå¹¶æ¢å¤/etc/fstab</li>
</ol>


<figure id="org02f68d6">
<img src="images/image-20210120112802465.png" alt="image-20210120112802465.png" width="60%">

</figure>

<div class="org-src-container">
<pre class="src src-sh">fdisk -l 
mkdir /mnt/rootdir
mount /dev/sdaN /mnt/rootdir  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26816;&#26597;&#26159;&#19981;&#26159;&#26681;&#30446;&#24405;</span>
ls /mnt/rootdir
mount /dev/sda2 /mnt/rootdir

vim /mnt/rootdir/etc/fstab 
/dev/sda1 /boot ext4 defaults 0 0 
/dev/sda2 /   ext4 defaults 0 0
/dev/sda3 /data ext4 defaults 0 0
/dev/sda5 swap swap defaults 0 0

reboot
</pre>
</div>

<ol class="org-ol">
<li><p>
rescue mode æ¢å¤å†…æ ¸å’Œinitrd æ–‡ä»¶
</p>

<p>
/dev/sda2 &#x2013;&gt; /mnt/sysimage
</p></li>
</ol>

<div class="org-src-container">
<pre class="src src-sh">chroot /mnt/sysimage
mount /dev/sr0 /mnt/
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;1 </span>
rpm -ivh /mnt/Packages/kernel.xxxx.rpm --root=/mnt/sysimage --force  
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;2 </span>
cp /mnt/isolinux/vmlinuz /boot/
mkinitrd /boot/initramfs.img <span style="color: #ff00ff;">`uname -r`</span>
</pre>
</div>

<ol class="org-ol">
<li>ä¿®å¤ grub</li>
</ol>

<div class="org-src-container">
<pre class="src src-sh">grub-install /dev/sda 
vim /boot/grub/grub.conf &#26041;&#27861;2
[root@centos6 ~]#cat /boot/grub/grub.conf 
<span style="color: #a0522d;">default</span>=0
<span style="color: #a0522d;">timeout</span>=5
title centos
kernel /vmlinuz <span style="color: #a0522d;">root</span>=/dev/sda2
initrd /initramfs.img
</pre>
</div>

<ol class="org-ol">
<li>reboot</li>
</ol>
</div>
</div>
</div>
</section>
<section id="outline-container-h:de26e8c1-e341-4303-b061-58b9a47e9dbc" class="outline-2">
<h2 id="h:de26e8c1-e341-4303-b061-58b9a47e9dbc">systemd</h2>
<div class="outline-text-2" id="text-h:de26e8c1-e341-4303-b061-58b9a47e9dbc">
<p>
initçš„å‘å±•
</p>

<ul class="org-ul">
<li>CentOS 5: SysV init,ä¸²è¡Œå¯åŠ¨</li>
<li>CentOS 6ï¼šUpstart,å¹¶è¡Œå¯åŠ¨ï¼Œå€Ÿé‰´ubantu</li>
<li>CentOS 7ï¼šSystemd,å¹¶è¡Œå¯åŠ¨ï¼Œå€Ÿé‰´MACã€‚å³ä½¿æœ‰ä¾èµ–å…³ç³»ä¹Ÿèƒ½åŒæ—¶å¯åŠ¨ï¼Œè®¿é—®æ—¶æ‰ä¼šç¡®è®¤ä¾èµ–å…³ç³»çŠ¶æ€ã€‚</li>
</ul>

<p>
èŒƒä¾‹ï¼šcentos7 å¼€å§‹initå·²ç»æ¢æˆsystemd, å› æ­¤æ“ä½œç³»ç»Ÿå¯åŠ¨çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹å˜æˆäº†systemd
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@test jasper]# ll <span style="color: #ff00ff;">`which init`</span>
lrwxrwxrwx. 1 root root 22 Jun 17 21:21 /usr/sbin/init -&gt; ../lib/systemd/systemd
[root@test jasper]# rpm -qf <span style="color: #ff00ff;">`which init`</span>
systemd-xxxx
</pre>
</div>
</div>
<div id="outline-container-systemd-ç‰¹æ€§" class="outline-3">
<h3 id="systemd-ç‰¹æ€§">systemd ç‰¹æ€§</h3>
<div class="outline-text-3" id="text-systemd-ç‰¹æ€§">
<p>
Systemdï¼šä» CentOS 7 ç‰ˆæœ¬ä¹‹åå¼€å§‹ç”¨ systemdå®ç°initè¿›ç¨‹ï¼Œç³»ç»Ÿå¯åŠ¨å’Œæœ
åŠ¡å™¨å®ˆæŠ¤è¿›ç¨‹ç®¡ç†å™¨ï¼Œè´Ÿè´£åœ¨ç³»ç»Ÿå¯åŠ¨æˆ–è¿è¡Œæ—¶ï¼Œæ¿€æ´»ç³»ç»Ÿèµ„æºï¼ŒæœåŠ¡å™¨è¿›ç¨‹å’Œ
å…¶å®ƒè¿›ç¨‹
</p>

<p>
Systemdæ–°ç‰¹æ€§
</p>

<ul class="org-ul">
<li>ç³»ç»Ÿå¼•å¯¼æ—¶å®ç°æœåŠ¡å¹¶è¡Œå¯åŠ¨</li>
<li>æŒ‰éœ€å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹</li>
<li>è‡ªåŠ¨åŒ–çš„æœåŠ¡ä¾èµ–å…³ç³»ç®¡ç†</li>
<li>åŒæ—¶é‡‡ç”¨socketå¼ä¸D-Busæ€»çº¿å¼æ¿€æ´»æœåŠ¡</li>
<li>socketä¸æœåŠ¡ç¨‹åºåˆ†ç¦»</li>
<li>å‘åå…¼å®¹sysv initè„šæœ¬</li>
<li>ä½¿ç”¨systemctlå‘½ä»¤ç®¡ç†ï¼Œsystemctlå‘½ä»¤å›ºå®šä¸å˜ï¼Œä¸å¯æ‰©å±•ï¼Œéç”±systemd
å¯åŠ¨çš„æœåŠ¡ï¼Œsystemctlæ— æ³•ä¸ä¹‹é€šä¿¡å’Œæ§åˆ¶</li>
<li>ç³»ç»ŸçŠ¶æ€å¿«ç…§</li>
</ul>

<p>
systemdæ ¸å¿ƒæ¦‚å¿µï¼šunit
</p>

<p>
unitè¡¨ç¤ºä¸åŒç±»å‹çš„systemdå¯¹è±¡ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œæ ‡è¯†å’Œé…ç½®ï¼›æ–‡ä»¶ä¸­ä¸»è¦
åŒ…å«äº†ç³»ç»ŸæœåŠ¡ã€ç›‘å¬socketã€ä¿å­˜çš„ç³»ç»Ÿå¿«ç…§ä»¥åŠå…¶å®ƒä¸initç›¸å…³çš„ä¿¡æ¯
</p>

<p>
Unitç±»å‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;unit&#25903;&#25345;&#30340;&#36164;&#28304;&#31867;&#22411;</span>
[root@centos8-A ~]#systemctl -t help
Available unit types:
service                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26381;&#21153;</span>
socket                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22871;&#25509;&#23383;</span>
target                   <span style="color: #b22222;">#</span><span style="color: #b22222;">runlevel&#36816;&#34892;&#27169;&#24335;</span>
device                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#22791;</span>
mount                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25346;&#36733;</span>
automount
swap                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20132;&#25442;&#20998;&#21306;</span>
timer                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35745;&#25968;&#22120;</span>
path
slice
scope
</pre>
</div>

<ul class="org-ul">
<li>service unit: æ–‡ä»¶æ‰©å±•åä¸º.service,ç”¨äºå®šä¹‰ç³»ç»ŸæœåŠ¡ï¼Œç›¸å½“äºå¼€å¯æœåŠ¡è„šæœ¬</li>
<li>Socket unit: .socket,å®šä¹‰è¿›ç¨‹é—´é€šä¿¡ç”¨çš„socketæ–‡ä»¶ï¼Œä¹Ÿå¯åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œå»¶è¿Ÿå¯åŠ¨æœåŠ¡ï¼Œå®ç°æŒ‰éœ€å¯åŠ¨ï¼Œä»£æ›¿äº†xinetd</li>
<li>Target unit: æ–‡ä»¶æ‰©å±•åä¸º.targetï¼Œç”¨äºæ¨¡æ‹Ÿå®ç°è¿è¡Œçº§åˆ«ï¼Œç›¸å½“äºrunlevel</li>
<li>Device unit: .device, ç”¨äºå®šä¹‰å†…æ ¸è¯†åˆ«çš„è®¾å¤‡</li>
<li>Mount unit: .mount, å®šä¹‰æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹</li>
<li>Snapshot unit: .snapshot, ç®¡ç†ç³»ç»Ÿå¿«ç…§</li>
<li>Swap unit: .swap, ç”¨äºæ ‡è¯†swapè®¾å¤‡</li>
<li>Automount unit: .automountï¼Œæ–‡ä»¶ç³»ç»Ÿçš„è‡ªåŠ¨æŒ‚è½½ç‚¹</li>
<li>Path unit: .pathï¼Œç”¨äºå®šä¹‰æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ä½¿ç”¨,å¸¸ç”¨äºå½“æ–‡ä»¶ç³»ç»Ÿå˜åŒ–æ—¶ï¼Œå»¶è¿Ÿæ¿€æ´»æœåŠ¡ï¼Œå¦‚ï¼šspoolç›®å½•</li>
</ul>

<p>
èŒƒä¾‹ï¼šsystemdå®ç°äº†socketä¸æœåŠ¡ç¨‹åºåˆ†ç¦»
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">socket ip &#31471;&#21475;</span>
[root@ali-bj-prod-web001 ~]# yum install telnet-server
[root@ali-bj-prod-web001 ~]# systemctl start  telnet.socket
[root@ali-bj-prod-web001 ~]# systemctl status telnet.socket
&#9679; telnet.socket - Telnet Server Activation Socket
   Loaded: loaded (/usr/lib/systemd/system/telnet.socket; disabled; vendor preset: disabled)
   Active: active (listening) since Sat 2021-02-27 07:25:12 CST; 2s ago

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26816;&#26597; telnet&#26381;&#21153;&#24182;&#27809;&#26377;&#21551;&#21160;&#65292;&#32780;systemd&#21551;&#21160;&#19968;&#20010;23&#31471;&#21475;</span>
[root@ali-bj-prod-web001 ~]# ps -ef|grep telnet 
root        1655    1339  0 07:25 pts/0    00:00:00 grep --color=auto telnet
[root@ali-bj-prod-web001 ~]# ss -tnlp   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#30475;&#21040;23&#31471;&#21475;&#30001;systemd&#30417;&#25511;</span>
State         Recv-Q        Send-Q               Local Address:Port               Peer Address:Port    
LISTEN        0             128                              *:23                            *:*            users:((<span style="color: #8b2252;">"systemd"</span>,<span style="color: #a0522d;">pid</span>=1,<span style="color: #a0522d;">fd</span>=24))                  
[root@ali-bj-prod-web001 ~]# lsof -i :23
COMMAND PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
systemd   1 root   24u  IPv6  29270      0t0  TCP *:telnet (LISTEN)

<span style="color: #b22222;"># </span><span style="color: #b22222;">windows&#36828;&#31243; 23&#31471;&#21475; </span>
[c:<span style="color: #8b2252;">\~</span>]$ telnet 182.92.4.110 23
Connecting to 182.92.4.110:23.
Connection established.
To escape to local shell, press Ctrl+Alt+].

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20877;&#26816;&#26597;&#65292;telnet&#26381;&#21153;&#21551;&#21160;</span>
[root@ali-bj-prod-web001 ~]# lsof -i :23
COMMAND    PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
systemd      1 root   19u  IPv6  29811      0t0  TCP ali-bj-prod-web001:telnet-&gt;120.244.188.76:30963 (ESTABLISHED)
systemd      1 root   24u  IPv6  29270      0t0  TCP *:telnet (LISTEN)
in.telnet 1666 root    0u  IPv6  29811      0t0  TCP ali-bj-prod-web001:telnet-&gt;120.244.188.76:30963 (ESTABLISHED)
in.telnet 1666 root    1u  IPv6  29811      0t0  TCP ali-bj-prod-web001:telnet-&gt;120.244.188.76:30963 (ESTABLISHED)
in.telnet 1666 root    2u  IPv6  29811      0t0  TCP ali-bj-prod-web001:telnet-&gt;120.244.188.76:30963 (ESTABLISHED)
[root@ali-bj-prod-web001 ~]# ps -ef|grep telnet 
root        1666       1  0 07:26 ?        00:00:00 in.telnetd: ::ffff:120.244.188.76

<span style="color: #b22222;"># </span><span style="color: #b22222;">socket&#19982;&#26381;&#21153;&#31243;&#24207;&#20998;&#31163;</span>
[root@ali-bj-prod-web001 ~]# yum install rpcbind -y
[root@ali-bj-prod-web001 ~]# rpm -ql rpcbind
/usr/lib/systemd/system/rpcbind.service
/usr/lib/systemd/system/rpcbind.socket
[root@ali-bj-prod-web001 ~]# systemctl start   rpcbind.socket
[root@ali-bj-prod-web001 ~]# ps -ef|grep rpcbind
root        1905    1339  0 07:31 pts/0    00:00:00 grep --color=auto rpcbind
[root@ali-bj-prod-web001 ~]# ss -tnlp   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#30475;&#21040;111&#31471;&#21475;&#30001;systemd&#30417;&#25511;</span>
LISTEN        0             128                        0.0.0.0:111                     0.0.0.0:*            users:((<span style="color: #8b2252;">"systemd"</span>,<span style="color: #a0522d;">pid</span>=1,<span style="color: #a0522d;">fd</span>=108))   

[root@ali-bj-prod-web001 ~]# lsof -i :111
COMMAND PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
systemd   1 root  108u  IPv4  30718      0t0  TCP *:sunrpc (LISTEN)
systemd   1 root  109u  IPv4  30719      0t0  UDP *:sunrpc 
systemd   1 root  110u  IPv6  30720      0t0  TCP *:sunrpc (LISTEN)
systemd   1 root  111u  IPv6  31745      0t0  UDP *:sunrpc 


<span style="color: #b22222;"># </span><span style="color: #b22222;">windows&#36828;&#31243; 23&#31471;&#21475; </span>
[c:<span style="color: #8b2252;">\~</span>]$ telnet 182.92.4.110 111
Connecting to 182.92.4.110:111.
Connection established.
To escape to local shell, press Ctrl+Alt+].

[root@ali-bj-prod-web001 ~]# ps -ef|grep rpcbind
rpc         1961       1  3 07:33 ?        00:00:00 /usr/bin/rpcbind -w -f
root        1976    1339  0 07:33 pts/0    00:00:00 grep --color=auto rpcbind

[root@ali-bj-prod-web001 ~]# systemctl status  rpcbind
&#9679; rpcbind.service - RPC Bind
   Loaded: loaded (/usr/lib/systemd/system/rpcbind.service; enabled; vendor preset: enabled)
   Active: active (running) since Sat 2021-02-27 07:33:04 CST; 5s ago
     Docs: man:rpcbind(8)
 Main PID: 1961 (rpcbind)
    Tasks: 1 (<span style="color: #483d8b;">limit</span>: 4652)
   Memory: 996.0K
   CGroup: /system.slice/rpcbind.service
           &#9492;&#9472;1961 /usr/bin/rpcbind -w -f

Feb 27 07:33:03 ali-bj-prod-web001 systemd[1]: Starting RPC Bind...
Feb 27 07:33:04 ali-bj-prod-web001 systemd[1]: Started RPC Bind.
</pre>
</div>

<p>
<b>unitçš„é…ç½®æ–‡ä»¶</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">/usr/lib/systemd/system         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#20010;&#26381;&#21153;&#26368;&#20027;&#35201;&#30340;&#21551;&#21160;&#33050;&#26412;&#35774;&#32622;&#65292;&#31867;&#20284;&#20110;&#20043;&#21069;&#30340;/etc/init.d/</span>
/lib/systemd/system                <span style="color: #b22222;">#</span><span style="color: #b22222;">ubutun&#30340;&#23545;&#24212;&#30446;&#24405;&#65292;&#20860;&#23481;&#20110;CentOS7,8&#21644;Ubuntu</span>

/run/systemd/system              <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31995;&#32479;&#25191;&#34892;&#36807;&#31243;&#20013;&#25152;&#20135;&#29983;&#30340;&#26381;&#21153;&#33050;&#26412;&#65292;&#27604;&#19978;&#38754;&#30446;&#24405;&#20248;&#20808;&#36816;&#34892;</span>
/etc/systemd/system               <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31649;&#29702;&#21592;&#24314;&#31435;&#30340;&#25191;&#34892;&#33050;&#26412;&#65292;&#31867;&#20284;&#20110;/etc/rcN.d/Sxx&#30340;&#21151;&#33021;&#65292;&#27604;&#19978;&#38754;&#30446;&#24405;&#20248;&#20808;&#36816;&#34892;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c2706445-f151-4bdb-aff6-8ba2673635cc" class="outline-3">
<h3 id="h:c2706445-f151-4bdb-aff6-8ba2673635cc">systemctlç®¡ç†ç³»ç»ŸæœåŠ¡service unit</h3>
<div class="outline-text-3" id="text-h:c2706445-f151-4bdb-aff6-8ba2673635cc">
<p>
å‘½ä»¤
</p>

<div class="org-src-container">
<pre class="src src-sh">systemctl COMMAND name.service
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">##</span><span style="color: #b22222;">setp1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#21160;&#65306;&#30456;&#24403;&#20110;service name start </span>
systemctl start name1.service  name2.service   

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20572;&#27490;&#65306;&#30456;&#24403;&#20110;service name stop</span>
systemctl stop name.service

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37325;&#21551;&#65306;&#30456;&#24403;&#20110;service name restart </span>
systemctl restart name.service 

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#29366;&#24577;&#65306;&#30456;&#24403;&#20110;service name status</span>
systemctl status name.service

<span style="color: #b22222;">##</span><span style="color: #b22222;">setp2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31105;&#27490;&#33258;&#21160;&#21644;&#25163;&#21160;&#21551;&#21160;&#65306;</span>
systemctl mask name.service <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25226; /etc/systemd/system/&#19979;&#30340;&#36719;&#36830;&#25509;&#25991;&#20214;&#25351;&#21521;/dev/null</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21462;&#28040;&#31105;&#27490;</span>
systemctl unmask name.service

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#26576;&#26381;&#21153;&#24403;&#21069;&#28608;&#27963;&#19982;&#21542;&#30340;&#29366;&#24577;&#65306;</span>
systemctl is-active name.service    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27809;&#26377;&#21551;&#21160;&#65292;&#36820;&#22238;&#29366;&#24577;&#30721;&#20026;&#38750;0&#12290;&#21551;&#21160;&#36820;&#22238;&#29366;&#24577;&#30721;&#20026;0</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;service&#25991;&#20214;&#20869;&#23481;</span>
systemctl cat name.service

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#25152;&#26377;&#24050;&#32463;&#28608;&#27963;&#30340;&#26381;&#21153;&#65306;</span>
systemctl list-units --type|-t service

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#25152;&#26377;&#26381;&#21153;&#65306;</span>
systemctl list-units --type service --all|-a

<span style="color: #b22222;">##</span><span style="color: #b22222;">setp3</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#23450;&#26576;&#26381;&#21153;&#24320;&#26426;&#33258;&#21551;&#65292;&#30456;&#24403;&#20110;chkconfig name on </span>
systemctl enable name.service 

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#23450;&#26576;&#26381;&#21153;&#24320;&#26426;&#31105;&#27490;&#21551;&#21160;&#65306;&#30456;&#24403;&#20110;chkconfig name off</span>
systemctl disable name.service

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#26159;&#21542;&#24320;&#26426;&#21551;&#21160;</span>
systemctl is-enabled name.service

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#24320;&#26426;&#24182;&#31435;&#21363;&#21551;&#21160;&#25110;&#20572;&#27490;</span>
systemctl enable --now postfix 
systemctl disable  --now postfix

<span style="color: #b22222;">##</span><span style="color: #b22222;">setp4</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#25152;&#26377;&#26381;&#21153;&#30340;&#24320;&#26426;&#33258;&#21551;&#29366;&#24577;&#65292;&#30456;&#24403;&#20110;chkconfig --list</span>
systemctl list-unit-files --type service

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#26469;&#21015;&#20986;&#35813;&#26381;&#21153;&#22312;&#21738;&#20123;&#36816;&#34892;&#32423;&#21035;&#19979;&#21551;&#29992;&#21644;&#31105;&#29992;&#65306;chkconfig &#8211;list name</span>
ls /etc/systemd/system/*.wants/name.service

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#20986;&#22833;&#36133;&#30340;&#26381;&#21153;</span>
systemctl --failed --type=service

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#26381;&#21153;&#30340;&#20381;&#36182;&#20851;&#31995;&#65306;</span>
systemctl list-dependencies name.service

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26432;&#25481;&#36827;&#31243;&#65306;</span>
systemctl kill unitname
</pre>
</div>

<p>
<b>æœåŠ¡çŠ¶æ€</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#29366;&#24577;</span>
systemctl list-unit-files --type service --all
</pre>
</div>

<ul class="org-ul">
<li>loaded Unité…ç½®æ–‡ä»¶å·²å¤„ç†</li>
<li>active(running) ä¸€æ¬¡æˆ–å¤šæ¬¡æŒç»­å¤„ç†çš„è¿è¡Œ</li>
<li>active(exited) æˆåŠŸå®Œæˆä¸€æ¬¡æ€§çš„é…ç½®</li>
<li>active(waiting) è¿è¡Œä¸­ï¼Œç­‰å¾…ä¸€ä¸ªäº‹ä»¶</li>
<li>inactive ä¸è¿è¡Œ</li>
<li>enabled å¼€æœºå¯åŠ¨</li>
<li>disabled å¼€æœºä¸å¯åŠ¨</li>
<li>static å¼€æœºä¸å¯åŠ¨ï¼Œä½†å¯è¢«å¦ä¸€ä¸ªå¯ç”¨çš„æœåŠ¡æ¿€æ´»</li>
<li>indirect é‡å®šå‘åˆ°åˆ«å¤„</li>
</ul>

<p>
èŒƒä¾‹ï¼šsystemctl å‘½ä»¤ç¤ºä¾‹
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#25152;&#26377;&#21333;&#20803;&#29366;&#24577;</span>
systemctl &#25110; systemctl list-units
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#26174;&#31034;&#26381;&#21153;&#21333;&#20803;&#30340;&#29366;&#24577;</span>
systemctl --type=service
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;sshd&#26381;&#21153;&#21333;&#20803;</span>
systemctl &#8211;l status sshd.service
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#39564;&#35777;sshd&#26381;&#21153;&#24403;&#21069;&#26159;&#21542;&#27963;&#21160;</span>
systemctl is-active sshd
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#21160;&#65292;&#20572;&#27490;&#21644;&#37325;&#21551;sshd&#26381;&#21153;</span>
systemctl start sshd.service
systemctl stop sshd.service
systemctl restart sshd.service

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37325;&#26032;&#21152;&#36733;&#37197;&#32622;</span>
systemctl reload sshd.service
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#20986;&#27963;&#21160;&#29366;&#24577;&#30340;&#25152;&#26377;&#26381;&#21153;&#21333;&#20803;</span>
systemctl list-units --type=service
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#20986;&#25152;&#26377;&#26381;&#21153;&#21333;&#20803;</span>
systemctl list-units --type=service --all
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#26381;&#21153;&#21333;&#20803;&#30340;&#21551;&#29992;&#21644;&#31105;&#29992;&#29366;&#24577;</span>
systemctl list-unit-files --type=service

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#20986;&#20381;&#36182;&#30340;&#21333;&#20803;</span>
systemctl list-dependencies sshd
&#39564;&#35777;sshd&#26381;&#21153;&#26159;&#21542;&#24320;&#26426;&#21551;&#21160;
systemctl is-enabled sshd
&#31105;&#29992;network&#65292;&#20351;&#20043;&#19981;&#33021;&#33258;&#21160;&#21551;&#21160;,&#20294;&#25163;&#21160;&#21487;&#20197;
systemctl disable network

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#29992;network</span>
systemctl enable network

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31105;&#29992;network&#65292;&#20351;&#20043;&#19981;&#33021;&#25163;&#21160;&#25110;&#33258;&#21160;&#21551;&#21160;</span>
systemctl mask network

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#29992;network</span>
systemctl unmask network
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ea007418-a7c5-4f5d-a690-a15f8663c759" class="outline-3">
<h3 id="h:ea007418-a7c5-4f5d-a690-a15f8663c759">service unitæ–‡ä»¶æ ¼å¼</h3>
<div class="outline-text-3" id="text-h:ea007418-a7c5-4f5d-a690-a15f8663c759">
<ul class="org-ul">
<li>/etc/systemd/systemï¼šç³»ç»Ÿç®¡ç†å‘˜å’Œç”¨æˆ·ä½¿ç”¨</li>
<li>/usr/lib/systemd/systemï¼šå‘è¡Œç‰ˆæ‰“åŒ…è€…ä½¿ç”¨</li>
</ul>

<p>
å¸®åŠ©å‚è€ƒï¼š systemd.directivesï¼ˆ7ï¼‰ï¼Œsystemd.unit(5),systemd.service(5), systemd.socket(5), systemd.target(5),systemd.exec(5)
</p>

<p>
unit æ ¼å¼è¯´æ˜ï¼š
</p>

<ul class="org-ul">
<li>ä»¥ "#" å¼€å¤´çš„è¡Œåé¢çš„å†…å®¹ä¼šè¢«è®¤ä¸ºæ˜¯æ³¨é‡Š</li>
<li>ç›¸å…³å¸ƒå°”å€¼ï¼Œ1ã€yesã€onã€true éƒ½æ˜¯å¼€å¯ï¼Œ0ã€noã€offã€false éƒ½æ˜¯å…³é—­</li>
<li>æ—¶é—´å•ä½é»˜è®¤æ˜¯ç§’ï¼Œæ‰€ä»¥è¦ç”¨æ¯«ç§’ï¼ˆmsï¼‰åˆ†é’Ÿï¼ˆmï¼‰ç­‰é¡»æ˜¾å¼è¯´æ˜</li>
</ul>

<p>
service unit fileæ–‡ä»¶é€šå¸¸ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š
</p>

<ul class="org-ul">
<li>[Unit]ï¼šå®šä¹‰ä¸Unitç±»å‹æ— å…³çš„é€šç”¨é€‰é¡¹ï¼›ç”¨äºæä¾›unitçš„æè¿°ä¿¡æ¯ã€unitè¡Œä¸ºåŠä¾èµ–å…³ç³»ç­‰</li>
<li>[Service]ï¼šä¸ç‰¹å®šç±»å‹ç›¸å…³çš„ä¸“ç”¨é€‰é¡¹ï¼›æ­¤å¤„ä¸ºServiceç±»å‹</li>
<li>[Install]ï¼šå®šä¹‰ç”±â€œsystemctl enableâ€ä»¥åŠâ€systemctl
disableâ€œå‘½ä»¤åœ¨å®ç°æœåŠ¡å¯ç”¨æˆ–ç¦ç”¨æ—¶ç”¨åˆ°çš„ä¸€äº›é€‰é¡¹</li>
</ul>

<p>
å‚è€ƒï¼š
</p>

<ul class="org-ul">
<li>UnitåŠInstatllå­—æ®µå‚è€ƒï¼š<a href="https://www.jinbuguo.com/systemd/systemd.unit.html#AllowIsolate">https://www.jinbuguo.com/systemd/systemd.unit.html#AllowIsolate</a></li>
<li>systemd.service â€” æœåŠ¡å•å…ƒé…ç½®ï¼š<a href="https://www.jinbuguo.com/systemd/systemd.service.html">https://www.jinbuguo.com/systemd/systemd.service.html</a></li>
<li>systemd.exec â€” æ‰§è¡Œç¯å¢ƒé…ç½®: <a href="https://www.jinbuguo.com/systemd/systemd.exec.html#">https://www.jinbuguo.com/systemd/systemd.exec.html#</a></li>
<li>systemd.kill â€” é…ç½® å¦‚ä½•æ€æ­»è¿›ç¨‹: <a href="https://www.jinbuguo.com/systemd/systemd.kill.html">https://www.jinbuguo.com/systemd/systemd.kill.html</a></li>
<li>systemd.resource-control â€” å•å…ƒçš„èµ„æºé™åˆ¶: <a href="https://www.jinbuguo.com/systemd/systemd.resource-control.html#">https://www.jinbuguo.com/systemd/systemd.resource-control.html#</a></li>
</ul>

<p>
<b>Unitæ®µçš„å¸¸ç”¨é€‰é¡¹ï¼š</b>
</p>

<ul class="org-ul">
<li>Descriptionï¼šæè¿°ä¿¡æ¯</li>
<li>Documentation= ä¸€ç»„ç”¨ç©ºæ ¼åˆ†éš”çš„æ–‡æ¡£URIåˆ—è¡¨. å¦‚ Documentation=<a href="https://github.com/kubernetes/kubernetes">https://github.com/kubernetes/kubernetes</a></li>
<li>Afterï¼šå®šä¹‰unitçš„å¯åŠ¨æ¬¡åºï¼Œè¡¨ç¤ºå½“å‰unitåº”è¯¥æ™šäºå“ªäº›unitå¯åŠ¨ï¼Œå…¶åŠŸèƒ½ä¸Beforeç›¸å</li>
<li>Requiresï¼šä¾èµ–åˆ°çš„å…¶å®ƒunitsï¼Œå¼ºä¾èµ–ï¼Œè¢«ä¾èµ–çš„unitsæ— æ³•æ¿€æ´»æ—¶ï¼Œå½“å‰unitä¹Ÿæ— æ³•æ¿€æ´»</li>
<li>Wantsï¼šä¾èµ–åˆ°çš„å…¶å®ƒunitsï¼Œå¼±ä¾èµ–</li>
<li>Conflictsï¼šå®šä¹‰unitsé—´çš„å†²çªå…³ç³»</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#head -n 5 /lib/systemd/system/postfix.service 
[Unit]
<span style="color: #a0522d;">Description</span>=Postfix Mail Transport Agent
<span style="color: #a0522d;">After</span>=syslog.target network.target
<span style="color: #a0522d;">Conflicts</span>=sendmail.service exim.service
</pre>
</div>

<p>
<b>Serviceæ®µçš„å¸¸ç”¨é€‰é¡¹ï¼š</b>
</p>

<p>
<a href="https://www.jinbuguo.com/systemd/systemd.service.html#">systemd.service â€” æœåŠ¡å•å…ƒé…ç½®</a>:
</p>

<ul class="org-ul">
<li>Typeï¼šå®šä¹‰å½±å“ExecStartåŠç›¸å…³å‚æ•°çš„åŠŸèƒ½çš„unitè¿›ç¨‹å¯åŠ¨ç±»å‹

<ul class="org-ul">
<li>simpleï¼šé»˜è®¤å€¼ï¼Œè¿™ä¸ªdaemonä¸»è¦ç”±ExecStartæ¥çš„æŒ‡ä»¤ä¸²æ¥å¯åŠ¨ï¼Œå¯åŠ¨å
å¸¸é©»äºå†…å­˜ä¸­</li>
<li>forkingï¼šç”±ExecStartå¯åŠ¨çš„ç¨‹åºé€è¿‡spawnså»¶ä¼¸å‡ºå…¶ä»–å­ç¨‹åºæ¥ä½œä¸ºæ­¤
daemonçš„ä¸»è¦æœåŠ¡ã€‚åŸç”Ÿçˆ¶ç¨‹åºåœ¨å¯åŠ¨ç»“æŸåå°±ä¼šç»ˆæ­¢</li>
<li>oneshotï¼šä¸simpleç±»ä¼¼ï¼Œä¸è¿‡è¿™ä¸ªç¨‹åºåœ¨å·¥ä½œå®Œæ¯•åå°±ç»“æŸäº†ï¼Œä¸ä¼šå¸¸é©»
åœ¨å†…å­˜ä¸­</li>
<li>dbusï¼šä¸simpleç±»ä¼¼ï¼Œä½†è¿™ä¸ªdaemonå¿…é¡»è¦åœ¨å–å¾—ä¸€ä¸ªD-Busçš„åç§°åï¼Œæ‰
ä¼šç»§ç»­è¿ä½œ.å› æ­¤é€šå¸¸ä¹Ÿè¦åŒæ—¶è®¾å®šBusNname=æ‰è¡Œ</li>
<li>notifyï¼šåœ¨å¯åŠ¨å®Œæˆåä¼šå‘é€ä¸€ä¸ªé€šçŸ¥æ¶ˆæ¯ã€‚è¿˜éœ€è¦é…åˆ NotifyAccess æ¥
è®©Systemd æ¥æ”¶æ¶ˆæ¯</li>
<li>idleï¼šä¸simpleç±»ä¼¼ï¼Œè¦æ‰§è¡Œè¿™ä¸ªdaemonå¿…é¡»è¦æ‰€æœ‰çš„å·¥ä½œéƒ½é¡ºåˆ©æ‰§è¡Œå®Œæ¯•
åæ‰ä¼šæ‰§è¡Œã€‚è¿™ç±»çš„daemoné€šå¸¸æ˜¯å¼€æœºåˆ°æœ€åæ‰æ‰§è¡Œå³å¯çš„æœåŠ¡</li>
</ul></li>

<li>ExecStartï¼šæŒ‡æ˜å¯åŠ¨unitè¦è¿è¡Œå‘½ä»¤æˆ–è„šæœ¬çš„ç»å¯¹è·¯å¾„</li>

<li>ExecStartPreï¼š ExecStartå‰è¿è¡Œã€‚è¯­æ³•è§„åˆ™ä¸ ExecStart= å®Œå…¨ç›¸åŒã€‚ å¦‚æœè®¾ç½®äº†å¤šä¸ªå‘½ä»¤è¡Œ</li>

<li>ExecStartPostï¼š ExecStartåè¿è¡Œ</li>

<li>ExecReload  ï¼šé‡æ–°è½½å…¥é…ç½®ã€‚ç‰¹æ®Šçš„ç¯å¢ƒå˜é‡ $MAINPID å¯ç”¨äºè¡¨ç¤ºä¸»è¿›ç¨‹çš„PIDã€‚ /bin/kill -s HUP $MAINPID</li>

<li>ExecStopï¼šæŒ‡æ˜åœæ­¢unitè¦è¿è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬</li>

<li>Restartï¼šæ˜¯å¦é‡æ–°å¯åŠ¨è¯¥æœåŠ¡. no(é»˜è®¤å€¼) è¡¨ç¤ºä¸ä¼šè¢«é‡å¯ã€‚ always è¡¨ç¤ºä¼šè¢«æ— æ¡ä»¶çš„é‡å¯ã€‚on-failure è¡¨ç¤º ä»…åœ¨æœåŠ¡è¿›ç¨‹å¼‚å¸¸é€€å‡ºæ—¶é‡å¯</li>

<li>PrivateTmpï¼šè®¾å®šä¸ºyesæ—¶ï¼Œä¼šåœ¨ç”Ÿæˆ
/tmp/systemd-private-UUID-NAME.service-XXXXX/tmp/ç›®å½•</li>

<li>RestartSec=: è®¾ç½®åœ¨é‡å¯æœåŠ¡(Restart=)å‰æš‚åœå¤šé•¿æ—¶é—´ã€‚é»˜è®¤å€¼æ˜¯100æ¯«ç§’
(100ms)ã€‚ å¦‚æœæœªæŒ‡å®šæ—¶é—´å•ä½ï¼Œé‚£ä¹ˆå°†è§†ä¸ºä»¥ç§’ä¸ºå•ä½ã€‚ä¾‹å¦‚è®¾ä¸ºâ€20â€ç­‰
ä»·äºè®¾ä¸ºâ€20sâ€ã€‚</li>
</ul>

<p>
<a href="https://www.jinbuguo.com/systemd/systemd.exec.html#">systemd.exec æ‰§è¡Œç¯å¢ƒé…ç½®</a>:
</p>
<ul class="org-ul">
<li>è·¯å¾„
<ul class="org-ul">
<li>WorkingDirectory= è®¾ç½®è¿›ç¨‹çš„å·¥ä½œç›®å½•ã€‚</li>
<li>EnvironmentFileï¼šç¯å¢ƒé…ç½®æ–‡ä»¶. ä½†å¯åœ¨è·¯å¾„å‰åŠ ä¸Š "-" å‰ç¼€è¡¨ç¤ºå¿½ç•¥ä¸å­˜åœ¨çš„æ–‡ä»¶ã€‚ å¯ä»¥å¤šæ¬¡ä½¿ç”¨æ­¤é€‰é¡¹ï¼Œä»¥ä»å¤šä¸ªä¸åŒçš„æ–‡ä»¶ä¸­è¯»å–è®¾ç½®ã€‚</li>
</ul></li>

<li>å‡­è¯
<ul class="org-ul">
<li>User=, Group= : è®¾ç½®è¿›ç¨‹åœ¨æ‰§è¡Œæ—¶ä½¿ç”¨çš„ç”¨æˆ·ä¸ç»„ã€‚</li>
</ul></li>

<li>è¿›ç¨‹å±æ€§
<ul class="org-ul">
<li>OOMScoreAdjust= è®¾ç½®è¿›ç¨‹å› å†…å­˜ä¸è¶³è€Œè¢«æ€æ­»çš„ä¼˜å…ˆçº§ã€‚ å¯è®¾ä¸º -1000(ç¦æ­¢è¢«æ€æ­») åˆ° 1000(æœ€å…ˆè¢«æ€æ­»)ä¹‹é—´çš„æ•´æ•°å€¼ã€‚ è¯¦è§ <a href="https://www.kernel.org/doc/Documentation/filesystems/proc.txt">proc.txt</a> æ–‡æ¡£ã€‚</li>
<li>LimitCPU=, LimitFSIZE=, LimitDATA=, LimitSTACK=, LimitCORE=, LimitRSS=, LimitNOFILE=, LimitAS=, LimitNPROC=, LimitMEMLOCK=, LimitLOCKS=, LimitSIGPENDING=, LimitMSGQUEUE=, LimitNICE=, LimitRTPRIO=, LimitRTTIME=
<ul class="org-ul">
<li>ç‰¹æ®Šå€¼ infinity è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ã€‚</li>
</ul></li>
</ul></li>
</ul>


<figure id="org16c6271">
<img src="images/image-20210228010307414.png" alt="image-20210228010307414.png">

<figcaption><span class="figure-number">Figure 1: </span>è¡¨ 1. èµ„æºé™åˆ¶æŒ‡ä»¤ã€å¯¹åº”çš„ ulimit å‘½ä»¤ã€å•ä½</figcaption>
</figure>


<p>
<a href="https://www.jinbuguo.com/systemd/systemd.kill.html">systemd.kill â€” é…ç½® å¦‚ä½•æ€æ­»è¿›ç¨‹</a>:
</p>

<ul class="org-ul">
<li>KillMode=è®¾ç½®åœ¨å•å…ƒåœæ­¢æ—¶ï¼Œæ€æ­»è¿›ç¨‹çš„æ–¹æ³•ã€‚ å–å€¼èŒƒå›´å¦‚ä¸‹ï¼š control-group, process, mixed, none
<ul class="org-ul">
<li>control-group è¡¨ç¤ºæ€æ­»è¯¥å•å…ƒçš„ cgroup å†…çš„æ‰€æœ‰è¿›ç¨‹. é»˜è®¤å€¼</li>
<li>process è¡¨ç¤ºä»…æ€æ­»ä¸»è¿›ç¨‹ã€‚</li>
</ul></li>
</ul>

<p>
<a href="https://www.jinbuguo.com/systemd/systemd.resource-control.html#">systemd.resource-control â€” å•å…ƒçš„èµ„æºé™åˆ¶</a>: 
</p>

<ul class="org-ul">
<li>CPUQuota= ä¸ºæ­¤å•å…ƒçš„è¿›ç¨‹è®¾ç½®CPUæ—¶é—´é™é¢ï¼Œå¿…é¡»è®¾ä¸ºä¸€ä¸ªä»¥"%"ç»“å°¾çš„ç™¾åˆ†æ•°ï¼Œ è¡¨ç¤ºè¯¥å•å…ƒæœ€å¤šå¯ä½¿ç”¨å•é¢—CPUæ€»æ—¶é—´çš„ç™¾åˆ†ä¹‹å¤šå°‘ã€‚
<ul class="org-ul">
<li>ä¾‹å¦‚ CPUQuota=20% èƒ½å¤Ÿç¡®ä¿ æ­¤å•å…ƒçš„è¿›ç¨‹æ°¸è¿œä¸ä¼šä½¿ç”¨è¶…è¿‡ 20% çš„å•é¢—CPUæ—¶é—´ã€‚</li>
</ul></li>
<li>MemoryMin=bytes è®¾ç½®è¯¥å•å…ƒè¿›ç¨‹çš„æœ€ä½å†…å­˜ç”¨é‡ä¿è¯å€¼ã€‚ é€‰é¡¹å€¼å¯ä»¥æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„ç»å¯¹å†…å­˜å¤§å° (å¯ä»¥ä½¿ç”¨ä»¥1024ä¸ºåŸºæ•°çš„ K, M, G, T åç¼€)ï¼Œ ä¹Ÿå¯ä»¥æ˜¯ä»¥ç™¾åˆ†æ¯”è¡¨ç¤ºçš„ç›¸å¯¹å†…å­˜å¤§å°(ç›¸å¯¹äºç³»ç»Ÿçš„å…¨éƒ¨ç‰©ç†å†…å­˜)ã€‚
<ul class="org-ul">
<li>ä¾‹å¦‚ MemoryLimit=250Mã€‚</li>
</ul></li>
</ul>

<p>
<b>Installæ®µçš„å¸¸ç”¨é€‰é¡¹ï¼š</b>
</p>

<ul class="org-ul">
<li>Aliasï¼šåˆ«åï¼Œå¯ä½¿ç”¨systemctl command Alias.service</li>
<li>RequiredByï¼šè¢«å“ªäº›unitsæ‰€ä¾èµ–ï¼Œå¼ºä¾èµ–</li>
<li>WantedByï¼šè¢«å“ªäº›unitsæ‰€ä¾èµ–ï¼Œå¼±ä¾èµ–</li>
<li>Alsoï¼šå®‰è£…æœ¬æœåŠ¡çš„æ—¶å€™è¿˜è¦å®‰è£…åˆ«çš„ç›¸å…³æœåŠ¡</li>
</ul>

<p>
æ³¨æ„ï¼šå¯¹äºæ–°åˆ›å»ºçš„unitæ–‡ä»¶ï¼Œæˆ–è€…ä¿®æ”¹äº†çš„unitæ–‡ä»¶ï¼Œè¦é€šçŸ¥systemdé‡è½½æ­¤
é…ç½®æ–‡ä»¶,è€Œåå¯ä»¥é€‰æ‹©é‡å¯
</p>

<div class="org-src-container">
<pre class="src src-sh">systemctl daemon-reload
</pre>
</div>

<p>
èŒƒä¾‹ï¼šæœåŠ¡Unitæ–‡ä»¶
</p>

<div class="org-src-container">
<pre class="src src-sh">[Unit]
<span style="color: #a0522d;">Description</span>=The Nginx HTTP Server daemon <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25551;&#36848;&#20449;&#24687;</span>
<span style="color: #a0522d;">After</span>=network.target remote-fs.target nss-lookup.target 
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25351;&#23450;&#21551;&#21160;nginx&#20043;&#21069;&#38656;&#35201;&#20854;&#20182;&#30340;&#20854;&#20182;&#26381;&#21153;&#65292;&#22914;network.target&#31561;</span>

[Service]
<span style="color: #b22222;"># </span><span style="color: #b22222;">Type&#20026;&#26381;&#21153;&#31867;&#22411;&#65292;&#20165;&#21551;&#21160;&#19968;&#20010;&#20027;&#36827;&#31243;&#30340;&#26381;&#21153;&#20026;simple&#65292;&#38656;&#35201;&#21551;&#21160;&#33509;&#24178;&#23376;&#36827;&#31243;&#30340;&#26381;&#21153;&#20026;forking</span>
<span style="color: #a0522d;">Type</span>=forking 

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#25191;&#34892;systemctl start nginx&#21518;&#38656;&#35201;&#21551;&#21160;&#30340;&#20855;&#20307;&#21629;&#20196;</span>
<span style="color: #a0522d;">ExecStart</span>=/usr/local/nginx/sbin/nginx

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#25191;&#34892;systemctl reload nginx&#21518;&#38656;&#35201;&#25191;&#34892;&#30340;&#20855;&#20307;&#21629;&#20196;</span>
<span style="color: #a0522d;">ExecReload</span>=/usr/local/nginx/sbin/nginx -s reload

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#25191;&#34892;systemctl stop nginx&#21518;&#38656;&#35201;&#25191;&#34892;&#30340;&#20855;&#20307;&#21629;&#20196;</span>
<span style="color: #a0522d;">ExecStop</span>=/bin/kill -s QUIT ${<span style="color: #a0522d;">MAINPID</span>}

[Install]
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#22312;&#20160;&#20040;&#27169;&#24335;&#19979;&#34987;&#23433;&#35013;&#65292;&#35774;&#32622;&#24320;&#26426;&#21551;&#21160;&#30340;&#26102;&#20505;&#38656;&#35201;</span>
<span style="color: #a0522d;">WantedBy</span>=multi-user.target
</pre>
</div>

<p>
èŒƒä¾‹ï¼škubelet
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@ip-10-0-133-61 ~]#  systemctl cat kubelet
<span style="color: #b22222;"># </span><span style="color: #b22222;">/etc/systemd/system/kubelet.service</span>
[Unit]
<span style="color: #a0522d;">Description</span>=Kubernetes Kubelet
<span style="color: #a0522d;">Documentation</span>=https://github.com/kubernetes/kubernetes
<span style="color: #a0522d;">After</span>=containerd.service sandbox-image.service
<span style="color: #a0522d;">Requires</span>=containerd.service sandbox-image.service

[Service]
<span style="color: #a0522d;">Slice</span>=runtime.slice
<span style="color: #a0522d;">ExecStartPre</span>=/sbin/iptables -P FORWARD ACCEPT -w 5
<span style="color: #a0522d;">ExecStart</span>=/usr/bin/kubelet <span style="color: #8b2252;">\</span>
    --config /etc/kubernetes/kubelet/kubelet-config.json <span style="color: #8b2252;">\</span>
    --kubeconfig /var/lib/kubelet/kubeconfig <span style="color: #8b2252;">\</span>
    --container-runtime-endpoint unix:///run/containerd/containerd.sock <span style="color: #8b2252;">\</span>
    --image-credential-provider-config /etc/eks/image-credential-provider/config.json <span style="color: #8b2252;">\</span>
    --image-credential-provider-bin-dir /etc/eks/image-credential-provider <span style="color: #8b2252;">\</span>
    $<span style="color: #a0522d;">KUBELET_ARGS</span> <span style="color: #8b2252;">\</span>
    $<span style="color: #a0522d;">KUBELET_EXTRA_ARGS</span>

<span style="color: #a0522d;">Restart</span>=on-failure
<span style="color: #a0522d;">RestartForceExitStatus</span>=SIGPIPE
<span style="color: #a0522d;">RestartSec</span>=5
<span style="color: #a0522d;">KillMode</span>=process
<span style="color: #a0522d;">CPUAccounting</span>=true
<span style="color: #a0522d;">MemoryAccounting</span>=true

[Install]
<span style="color: #a0522d;">WantedBy</span>=multi-user.target

<span style="color: #b22222;"># </span><span style="color: #b22222;">/etc/systemd/system/kubelet.service.d/10-kubelet-args.conf</span>
[Service]
<span style="color: #a0522d;">Environment</span>=<span style="color: #8b2252;">'KUBELET_ARGS=--node-ip=10.0.133.61 --pod-infra-container-image=8770xxxx.dkr.ecr.af-south-1.amazonaws.com/eks/pause:3.5 --v=2 --hostname-override=ip-10-0-133-61.af-south-1</span>
<span style="color: #8b2252;"># /etc/systemd/system/kubelet.service.d/30-kubelet-extra-args.conf</span>
<span style="color: #8b2252;">[Service]</span>
<span style="color: #8b2252;">Environment='</span><span style="color: #a0522d;">KUBELET_EXTRA_ARGS</span>=--node-labels=eks.amazonaws.com/sourceLaunchTemplateVersion=8,eks.amazonaws.com/nodegroup-image=ami-0660eafe04534cc32,eks.amazonaws.com/capacityType=ON_DEM
</pre>
</div>

<p>
èŒƒä¾‹ï¼šæœåŠ¡Unitæ–‡ä»¶ç¤ºä¾‹ï¼ˆäº†è§£ï¼‰
</p>

<div class="org-src-container">
<pre class="src src-sh">vim /usr/lib/systemd/system/tomcat.service 
[Unit]
<span style="color: #a0522d;">Description</span>=java tomcat project
<span style="color: #a0522d;">After</span>=syslog.target network.target

[Service]
<span style="color: #a0522d;">Type</span>=forking
<span style="color: #a0522d;">EnvironmentFile</span>=/usr/local/tomcat/conf/tomcat.conf
<span style="color: #a0522d;">ExecStart</span>=/usr/local/tomcat/bin/startup.sh
<span style="color: #a0522d;">ExecStop</span>=/usr/local/tomcat/bin/shutdown.sh
<span style="color: #a0522d;">PrivateTmp</span>=true
<span style="color: #a0522d;">User</span>=tomcat

[Install]
<span style="color: #a0522d;">WantedBy</span>=multi-user.target
</pre>
</div>

<p>
èŒƒä¾‹ï¼šæœåŠ¡Unitæ–‡ä»¶ç¤ºä¾‹ï¼ˆäº†è§£ï¼‰
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@test jasper]# systemctl  cat nginx
<span style="color: #b22222;"># </span><span style="color: #b22222;">/usr/lib/systemd/system/nginx.service</span>
[Unit]
<span style="color: #a0522d;">Description</span>=nginx - high performance web server
<span style="color: #a0522d;">Documentation</span>=http://nginx.org/en/docs/
<span style="color: #a0522d;">After</span>=network-online.target remote-fs.target nss-lookup.target
<span style="color: #a0522d;">Wants</span>=network-online.target

[Service]
<span style="color: #a0522d;">Type</span>=forking
<span style="color: #a0522d;">PIDFile</span>=/var/run/nginx.pid
<span style="color: #a0522d;">ExecStart</span>=/usr/sbin/nginx -c /etc/nginx/nginx.conf
<span style="color: #a0522d;">ExecReload</span>=/bin/sh -c <span style="color: #8b2252;">"/bin/kill -s HUP $(/bin/cat /var/run/nginx.pid)"</span>
<span style="color: #a0522d;">ExecStop</span>=/bin/sh -c <span style="color: #8b2252;">"/bin/kill -s TERM $(/bin/cat /var/run/nginx.pid)"</span>

[Install]
<span style="color: #a0522d;">WantedBy</span>=multi-user.target
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">cat &gt;/usr/lib/systemd/system/nginx.service&lt;&lt;\EOF
<span style="color: #ffa54f;">[Unit]</span>
<span style="color: #ffa54f;">Description=The NGINX HTTP and reverse proxy server</span>
<span style="color: #ffa54f;">Documentation=http://nginx.org/en/docs/</span>
<span style="color: #ffa54f;">After=network-online.target remote-fs.target nss-lookup.target</span>
<span style="color: #ffa54f;">Wants=network-online.target</span>

<span style="color: #ffa54f;">[Service]</span>
<span style="color: #ffa54f;">Type=forking</span>
<span style="color: #ffa54f;">PIDFile=/usr/local/nginx/logs/nginx.pid</span>
<span style="color: #ffa54f;">ExecStartPre=/usr/local/nginx/sbin/nginx -t</span>
<span style="color: #ffa54f;">ExecStart=/usr/local/nginx/sbin/nginx</span>
<span style="color: #ffa54f;">ExecReload=/usr/local/nginx/sbin/nginx -s reload</span>
<span style="color: #ffa54f;">#ExecReload=/bin/kill -s HUP $MAINPID</span>
<span style="color: #ffa54f;">ExecStop=/bin/kill -s QUIT $MAINPID</span>
<span style="color: #ffa54f;">PrivateTmp=true</span>
<span style="color: #ffa54f;">LimitNOFILE=infinity</span>

<span style="color: #ffa54f;">[Install]</span>
<span style="color: #ffa54f;">WantedBy=multi-user.target</span>
<span style="color: #ffa54f;">EOF</span>
systemctl daemon-reload
systemctl enable nginx


&#65283;&#20462;&#25913;&#26435;&#38480;
$ sudo chmod +x /usr/lib/systemd/system/nginx.service
&#65283;/etc/systemd/system/multi-user.target.wants/
$ sudo systemctl enable nginx.service
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29616;&#22312;&#21487;&#20197;&#20351;&#29992;&#19979;&#38754;&#30340;&#25351;&#20196;&#26469;&#25511;&#21046;nginx&#21862;</span>
$ sudo systemctl start nginx.service
$ sudo systemctl reload nginx.service
$ sudo systemctl restart nginx.service
$ sudo systemctl stop nginx.service
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26085;&#24535;</span>
$ journalctl -f -u nginx.service
</pre>
</div>

<p>
èŒƒä¾‹ï¼šzookeeper unitæ–‡ä»¶
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@master01 ~]# cat /usr/lib/systemd/system/zookeeper.service
[Unit]
<span style="color: #a0522d;">Description</span>=Apache ZooKeeperPI
<span style="color: #a0522d;">After</span>=network.target
<span style="color: #a0522d;">ConditionPathExists</span>=/etc/zookeeper/conf/zoo.cfg
<span style="color: #a0522d;">ConditionPathExists</span>=/etc/zookeeper/conf/log4j.properties

[Service]
<span style="color: #a0522d;">Environment</span>=<span style="color: #8b2252;">"ZOOCFGDIR=/etc/zookeeper/conf"</span>
<span style="color: #a0522d;">SyslogIdentifier</span>=zookeeper
<span style="color: #a0522d;">WorkingDirectory</span>=/opt/mesosphere/zookeeper
<span style="color: #a0522d;">ExecStart</span>=/opt/mesosphere/zookeeper/bin/zkServer.sh start-foreground
<span style="color: #a0522d;">Restart</span>=on-failure
<span style="color: #a0522d;">RestartSec</span>=20
<span style="color: #a0522d;">User</span>=root
<span style="color: #a0522d;">Group</span>=root

[Install]
<span style="color: #a0522d;">WantedBy</span>=multi-user.target
</pre>
</div>

<p>
èŒƒä¾‹ï¼šæœåŠ¡
</p>

<div class="org-src-container">
<pre class="src src-sh">[Unit]
<span style="color: #a0522d;">Description</span>=Java Service

[Service]
<span style="color: #a0522d;">User</span>=www
<span style="color: #a0522d;">WorkingDirectory</span>=/rummy/rummy-pot
<span style="color: #a0522d;">Environment</span>=<span style="color: #a0522d;">LOG_DIR</span>=/rummy/rummy-pot
<span style="color: #a0522d;">ExecStart</span>=/usr/local/java/bin/java  -XX:<span style="color: #a0522d;">MetaspaceSize</span>=128m -XX:<span style="color: #a0522d;">MaxMetaspaceSize</span>=128m -XX:+HeapDumpOnOutOfMemoryError -Xms4g -Xmx4g  -Xss256k  -XX:+UseG1GC -XX:<span style="color: #a0522d;">MaxGCPauseMillis</span>=200 -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps -XX:+PrintGCDetails -Xloggc:/rummy/rummy-pot/logs/gc.log -jar rummy-pot.jar
<span style="color: #a0522d;">SuccessExitStatus</span>=143
<span style="color: #a0522d;">TimeoutStopSec</span>=10
<span style="color: #a0522d;">Restart</span>=on-failure
<span style="color: #a0522d;">RestartSec</span>=5
<span style="color: #a0522d;">LimitNOFILE</span> = 200000

[Install]
<span style="color: #a0522d;">WantedBy</span>=multi-user.target
</pre>
</div>

<p>
èŒƒä¾‹ï¼šUbutunå®ç°å¼€æœºè‡ªåŠ¨è¿è¡Œç¨‹åº
</p>

<div class="org-src-container">
<pre class="src src-sh">root@ubuntu1804 ~]#ll /lib/systemd/system/rc.local.service 
lrwxrwxrwx 1 root root 16 Dec 12  2018 /lib/systemd/system/rc.local.service -&gt; 
rc-local.service
[root@ubuntu1804 ~]#grep -v <span style="color: #8b2252;">"^#"</span> /lib/systemd/system/rc.local.service 
[Unit]
<span style="color: #a0522d;">Description</span>=/etc/rc.local Compatibility
<span style="color: #a0522d;">Documentation</span>=man:systemd-rc-local-generator(8)
<span style="color: #a0522d;">ConditionFileIsExecutable</span>=/etc/rc.local
<span style="color: #a0522d;">After</span>=network.target

[Service]
<span style="color: #a0522d;">Type</span>=forking
<span style="color: #a0522d;">ExecStart</span>=/etc/rc.local start
<span style="color: #a0522d;">TimeoutSec</span>=0
<span style="color: #a0522d;">RemainAfterExit</span>=yes
<span style="color: #a0522d;">GuessMainPID</span>=no

[root@ubuntu1804 ~]#vim /etc/rc.local
[root@ubuntu1804 ~]#cat /etc/rc.local
<span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/bash</span>
<span style="color: #483d8b;">echo</span> -e <span style="color: #8b2252;">'\E[31;1mstarting test service\E[0m'</span>
sleep 10
[root@ubuntu1804 ~]#chmod +x /etc/rc.local
[root@ubuntu1804 ~]#reboot
</pre>
</div>

<p>
<b>å¤šè¿›ç¨‹ç®¡ç†</b>
</p>

<p>
åœ¨systemdä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¸ºæ¯ä¸ªå®ä¾‹åŒ–è¿›ç¨‹ç¼–å†™ä¸€ä»½é…ç½®æ–‡ä»¶ï¼Œåªéœ€è¦ç¼–å†™ä¸€
ä¸ªæ¨¡æ¿æ–‡ä»¶ï¼Œç„¶ååœ¨å¯ç”¨æ—¶å€™è°ƒç”¨æ¨¡æ¿æ–‡ä»¶å³å¯ï¼Œæ¨¡æ¿æ–‡ä»¶å¯ä»¥é€šè¿‡åŒ¹é…æ¨¡æ¿æ—¶
ä¼ å…¥çš„å­—ç¬¦ä¸²å®ä¾‹åŒ–è¿›ç¨‹æ¨¡æ¿æ–‡ä»¶ä¸­çš„%Iã€%iè¢«å±•å¼€ä¸ºå‘½ä»¤ä¸­@ä¹‹å.serviceä¹‹
å‰çš„å­—ç¬¦ä¸²ï¼Œå³ethNã€‚%Iä¸%içš„åŒºåˆ«åœ¨æ­¤ä¾‹ä¸­çœ‹ä¸å‡ºæ¥ï¼Œå®é™…ä¸Š%Iå±•å¼€åæ˜¯ä¸è½¬
ä¹‰çš„å­—ç¬¦ä¸²ï¼Œè€Œ%iå±•å¼€åæ˜¯è½¬ç§»çš„å­—ç¬¦ä¸²ã€‚
</p>

<p>
memcached unit æ–‡ä»¶ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">cp /lib/systemd/system/memcached.service /lib/systemd/system/memcached@.service

[Unit]
<span style="color: #a0522d;">Description</span>=Memcached
<span style="color: #a0522d;">Before</span>=httpd.service
<span style="color: #a0522d;">After</span>=network.target

[Service]
<span style="color: #a0522d;">Type</span>=simple
<span style="color: #a0522d;">EnvironmentFile</span>=-/etc/sysconfig/memcached%i
<span style="color: #a0522d;">ExecStart</span>=/usr/bin/memcached -u $<span style="color: #a0522d;">USER</span> -p $<span style="color: #a0522d;">PORT</span> -m $<span style="color: #a0522d;">CACHESIZE</span> -c $<span style="color: #a0522d;">MAXCONN</span> $<span style="color: #a0522d;">OPTIONS</span>

[Install]
<span style="color: #a0522d;">WantedBy</span>=multi-user.target

systemctl start memcached@1 &#22312;service&#25991;&#20214;&#37324;&#29992;%i&#26469;&#25509;&#21463;&#21442;&#25968;

systemctl enable memcached@2.service
systemctl enable memcached@1.service
[root@xu-2 sysconfig]# systemctl list-unit-files|grep enable|grep memcached
memcached@.service   

&#24403; systemd &#26597;&#25214;&#21333;&#20803;&#25991;&#20214;&#26102;&#65292;&#20250;&#39318;&#20808;&#26597;&#25214;&#19982;&#21333;&#20803;&#21517;&#31216;&#23436;&#20840;&#21563;&#21512;&#30340;&#21333;&#20803;&#25991;&#20214;&#65292; &#22914;&#26524;&#27809;&#26377;&#25214;&#21040;&#65292;&#24182;&#19988;&#21333;&#20803;&#21517;&#31216;&#20013;&#21253;&#21547; <span style="color: #8b2252;">"@"</span> &#23383;&#31526;&#65292; &#37027;&#20040; systemd &#23558;&#20250;&#32487;&#32493;&#26597;&#25214;&#25317;&#26377;&#30456;&#21516;&#21069;&#32512;&#30340;&#27169;&#26495;&#25991;&#20214;&#65292; &#22914;&#26524;&#25214;&#21040;&#65292;&#37027;&#20040;&#23558;&#20174;&#36825;&#20010;&#27169;&#26495;&#25991;&#20214;&#23454;&#20363;&#21270;&#19968;&#20010;&#21333;&#20803;&#26469;&#20351;&#29992;&#12290; &#20363;&#22914;&#65292;&#23545;&#20110; getty@tty3.service &#21333;&#20803;&#26469;&#35828;&#65292; &#20854;&#23545;&#24212;&#30340;&#27169;&#26495;&#25991;&#20214;&#26159; getty@.service (&#20063;&#23601;&#26159;&#21435;&#25481; <span style="color: #8b2252;">"@"</span> &#19982;&#21518;&#32512;&#21517;&#20043;&#38388;&#30340;&#37096;&#20998;)&#12290;
systemctl enable --now memcached@2
</pre>
</div>

<p>
å‚è€ƒ: <a href="https://www.cnblogs.com/xdao/p/systemctl_muti.html">https://www.cnblogs.com/xdao/p/systemctl_muti.html</a>
</p>
</div>
</div>
<div id="outline-container-h:aa278884-730a-49e7-b6ee-72532922b8e6" class="outline-3">
<h3 id="h:aa278884-730a-49e7-b6ee-72532922b8e6">è¿è¡Œçº§åˆ«</h3>
<div class="outline-text-3" id="text-h:aa278884-730a-49e7-b6ee-72532922b8e6">
<p>
target unitsï¼šç›¸å½“äºCentOS 6ä¹‹å‰çš„runlevel ,unit
</p>

<p>
é…ç½®æ–‡ä»¶ï¼š.target
</p>

<div class="org-src-container">
<pre class="src src-sh">ls /usr/lib/systemd/system/*.target
systemctl list-unit-files --type target --all
</pre>
</div>

<p>
å’Œè¿è¡Œçº§åˆ«å¯¹åº”å…³ç³»
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #a0522d;">0</span> ==&gt; runlevel0.target, poweroff.target
<span style="color: #a0522d;">1</span> ==&gt; runlevel1.target, rescue.target
<span style="color: #a0522d;">2</span> ==&gt; runlevel2.target, multi-user.target
<span style="color: #a0522d;">3</span> ==&gt; runlevel3.target, multi-user.target
<span style="color: #a0522d;">4</span> ==&gt; runlevel4.target, multi-user.target
<span style="color: #a0522d;">5</span> ==&gt; runlevel5.target, graphical.target
<span style="color: #a0522d;">6</span> ==&gt; runlevel6.target, reboot.target
0&#65306;&#20851;&#26426;
1&#65306;&#21333;&#29992;&#25143;&#27169;&#24335;(root&#33258;&#21160;&#30331;&#24405;), single, &#32500;&#25252;&#27169;&#24335;
2&#65306;&#22810;&#29992;&#25143;&#27169;&#24335;&#65292;&#21551;&#21160;&#32593;&#32476;&#21151;&#33021;&#65292;&#20294;&#19981;&#20250;&#21551;&#21160;NFS&#65307;&#32500;&#25252;&#27169;&#24335;
3&#65306;&#22810;&#29992;&#25143;&#27169;&#24335;&#65292;&#27491;&#24120;&#27169;&#24335;&#65307;&#25991;&#26412;&#30028;&#38754;
4&#65306;&#39044;&#30041;&#32423;&#21035;&#65307;&#21487;&#21516;3&#32423;&#21035;
5&#65306;&#22810;&#29992;&#25143;&#27169;&#24335;&#65292;&#27491;&#24120;&#27169;&#24335;&#65307;&#22270;&#24418;&#30028;&#38754;
6&#65306;&#37325;&#21551;
</pre>
</div>

<p>
æŸ¥çœ‹ä¾èµ–æ€§ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">systemctl list-dependencies graphical.target
</pre>
</div>

<p>
çº§åˆ«åˆ‡æ¢ï¼šç›¸å½“äº init N
</p>

<div class="org-src-container">
<pre class="src src-sh">systemctl isolate name.target
</pre>
</div>

<p>
è¿›å…¥é»˜è®¤target
</p>

<div class="org-src-container">
<pre class="src src-sh">systemctl default  
</pre>
</div>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20999;&#25442;&#33267;&#23383;&#31526;&#27169;&#24335;</span>
systemctl isolate multi-user.target
</pre>
</div>

<p>
æ³¨æ„ï¼šåªæœ‰/lib/systemd/system/*.targetæ–‡ä»¶ä¸­AllowIsolate=yes
æ‰èƒ½åˆ‡æ¢(ä¿®æ”¹æ–‡ä»¶éœ€æ‰§è¡Œsystemctl daemon-reloadæ‰èƒ½ç”Ÿæ•ˆ)
</p>

<p>
è·å–é»˜è®¤è¿è¡Œçº§åˆ«ï¼š ç›¸å½“äºæŸ¥çœ‹ /etc/inittab
</p>

<div class="org-src-container">
<pre class="src src-sh">systemctl get-default
</pre>
</div>

<p>
ä¿®æ”¹é»˜è®¤çº§åˆ«ï¼šç›¸å½“äºä¿®æ”¹ /etc/inittab
</p>

<div class="org-src-container">
<pre class="src src-sh">systemctl set-default name.target
</pre>
</div>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#systemctl set-default multi-user.target
[root@centos8 ~]#ls -l /etc/systemd/system/default.target
lrwxrwxrwx. 1 root root 37 Nov 7 19:32 /etc/systemd/system/default.target -&gt; 
/lib/systemd/system/multi-user.target
</pre>
</div>

<p>
åˆ‡æ¢è‡³ç´§æ€¥æ•‘æ´æ¨¡å¼ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">systemctl rescue
</pre>
</div>

<p>
åˆ‡æ¢è‡³emergencyæ¨¡å¼ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">systemctl emergency
</pre>
</div>

<p>
è¯´æ˜ï¼šrescue.target æ¯”emergency æ”¯æŒæ›´å¤šçš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ—¥å¿—ç­‰
</p>

<p>
ä¼ ç»Ÿå‘½ä»¤initï¼Œpoweroffï¼Œhaltï¼Œrebootéƒ½æˆä¸º systemctlçš„è½¯é“¾æ¥
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20851;&#26426;</span>
systemctl halt&#12289;systemctl poweroff

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37325;&#21551;&#65306;</span>
systemctl reboot

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25346;&#36215;&#65306;</span>
systemctl suspend

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20241;&#30496;&#65306;</span>
systemctl hibernate

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20241;&#30496;&#24182;&#25346;&#36215;&#65306;</span>
systemctl hybrid-sleep
</pre>
</div>

<p>
èŒƒä¾‹ï¼šç¦ç”¨ctrl+alt+delete é‡å¯å¿«æ·é”®
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#ls -l /lib/systemd/system/ctrl-alt-del.target    
lrwxrwxrwx. 1 root root 13 May 23 2019 /lib/systemd/system/ctrl-alt-del.target 
-&gt; reboot.target
[root@centos8 ~]#systemctl mask ctrl-alt-del.target 
Created symlink /etc/systemd/system/ctrl-alt-del.target &#8594; /dev/null.

[root@centos8 ~]#init q  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30456;&#24403;&#20110;systemctl daemon-reload &#37325;&#26032;&#21152;&#36733;&#21551;&#21160;&#25991;&#20214;</span>
[root@centos8 ~]#systemctl daemon-reload
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb20f77f" class="outline-3">
<h3 id="orgb20f77f">è®¾ç½®å†…æ ¸å‚æ•°</h3>
<div class="outline-text-3" id="text-orgb20f77f">
<p>
è®¾ç½®å†…æ ¸å‚æ•°ï¼Œåªå“åº”å½“æ¬¡è¯·æ±‚
</p>

<p>
å¯åŠ¨æ—¶ï¼Œåˆ°å¯åŠ¨èœå•ï¼ŒæŒ‰eé”®ï¼Œæ‰¾åˆ°åœ¨linuxå¼€å¤´çš„è¡Œåæ·»åŠ systemd.unit=&lt;æœŸæœ›çš„è¿è¡Œæ¨¡å¼&gt;.target
</p>

<p>
æ¯”å¦‚
</p>
<div class="org-src-container">
<pre class="src src-sh">systemd.unit=multi-user.target
systemd.unit=emergency.target
systemd.unit=rescue.target
</pre>
</div>
</div>
</div>
<div id="outline-container-h:cf968388-2306-4340-a133-e0987ef64338" class="outline-3">
<h3 id="h:cf968388-2306-4340-a133-e0987ef64338">CentOS 7ä¹‹åç‰ˆæœ¬å¼•å¯¼é¡ºåº</h3>
<div class="outline-text-3" id="text-h:cf968388-2306-4340-a133-e0987ef64338">
<ol class="org-ol">
<li>UEFiæˆ–BIOSåˆå§‹åŒ–ï¼Œè¿è¡ŒPOSTå¼€æœºè‡ªæ£€</li>
<li>é€‰æ‹©å¯åŠ¨è®¾å¤‡</li>
<li>å¼•å¯¼è£…è½½ç¨‹åº, centos7æ˜¯grub2,åŠ è½½è£…è½½ç¨‹åºçš„é…ç½®æ–‡ä»¶ï¼š <i>etc/grub.d</i>
/etc/default/grub /boot/grub2/grub.cfg</li>
<li>åŠ è½½initramfsé©±åŠ¨æ¨¡å—(å¯ä»¥å®ç°æ ¹æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½)</li>
<li>åŠ è½½å†…æ ¸é€‰é¡¹</li>
<li>å†…æ ¸åˆå§‹åŒ–ï¼Œcentos7ä½¿ç”¨systemdä»£æ›¿init</li>
<li>æ‰§è¡Œinitrd.targetæ‰€æœ‰å•å…ƒï¼ŒåŒ…æ‹¬æŒ‚è½½/etc/fstab</li>
<li>ä»initramfsæ ¹æ–‡ä»¶ç³»ç»Ÿåˆ‡æ¢åˆ°ç£ç›˜æ ¹ç›®å½•</li>
<li>systemdæ‰§è¡Œé»˜è®¤targeté…ç½®ï¼Œé…ç½®æ–‡ä»¶
/etc/systemd/system/default.target</li>
<li>systemdæ‰§è¡Œsysinit.targetåˆå§‹åŒ–ç³»ç»ŸåŠbasic.targetå‡†å¤‡æ“ä½œç³»ç»Ÿ</li>
<li>systemdå¯åŠ¨multi-user.targetä¸‹çš„æœ¬æœºä¸æœåŠ¡å™¨æœåŠ¡</li>
<li>systemdæ‰§è¡Œmulti-user.targetä¸‹çš„/etc/rc.d/rc.local</li>
<li>Systemdæ‰§è¡Œmulti-user.targetä¸‹çš„getty.targetåŠç™»å½•æœåŠ¡</li>
<li>systemdæ‰§è¡Œgraphicaléœ€è¦çš„æœåŠ¡</li>
</ol>

<p>
æŸ¥çœ‹è¿è¡Œæ¨¡å¼3ä¾èµ–å…³ç³»
</p>
<div class="org-src-container">
<pre class="src src-sh">systemctl list-dependencies multi-user.target
</pre>
</div>

<p>
é€šè¿‡systemd-analyze å·¥å…·å¯ä»¥äº†è§£å¯åŠ¨çš„è¯¦ç»†è¿‡ç¨‹
</p>

<div class="org-src-container">
<pre class="src src-sh">systemd-analyze time <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#21160;&#26102;&#38388; </span>
systemd-analyze blame <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35814;&#32454;&#21551;&#21160;&#20869;&#23481;</span>
systemd-analyze plot &gt;bootime.svg <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29983;&#25104;&#22270;&#29255;</span>
systemd-analyze plot &gt; boot.html <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29983;&#25104;&#32593;&#39029;</span>
</pre>
</div>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8-A ~]#systemd-analyze blame
         46.797s dnf-makecache.service
          5.789s kdump.service
          5.370s tuned.service
          5.110s postfix.service
          3.551s systemd-udev-settle.service
          2.837s sssd.service
          2.753s vdo.service
          2.240s NetworkManager-wait-online.service
          1.982s systemd-machined.service
          1.958s plymouth-quit.service
          1.913s plymouth-quit-wait.service
          1.755s lvm2-monitor.service
          1.501s polkit.service
          1.481s systemd-resolved.service
          1.391s dracut-initqueue.service
          1.288s systemd-logind.service
          1.183s ModemManager.service
          1.120s libvirtd.service
          1.025s cockpit-motd.service
          1.004s rsyslog.service
           985ms avahi-daemon.service
           737ms initrd-switch-root.service
           675ms bluetooth.service
           652ms systemd-journald.service
           629ms NetworkManager.service
           531ms gssproxy.service
           528ms cups.service
           ......
            58ms rpcbind.service
            56ms systemd-fsck-root.service
            55ms rpc-statd-notify.service
            49ms date.mount
            48ms systemd-rfkill.service
            45ms cockpit.socket
            43ms import-state.service
            38ms dracut-pre-udev.service
            31ms plymouth-switch-root.service
            30ms systemd-tmpfiles-setup.service
            29ms sys-kernel-config.mount
            26ms systemd-journal-flush.service
            26ms systemd-tmpfiles-clean.service
            25ms systemd-update-utmp-runlevel.service
            24ms initrd-udevadm-cleanup-db.service
            22ms initrd-cleanup.service
            18ms plymouth-read-write.service
            10ms systemd-update-utmp.service
             8ms sysstat-collect.service
             7ms dracut-shutdown.service
</pre>
</div>

<p>
èŒƒä¾‹ï¼šç”Ÿæˆç½‘é¡µ
</p>

<div class="org-src-container">
<pre class="src src-sh">systemd-analyze plot &gt; boot.html
</pre>
</div>


<figure id="org51b8f05">
<img src="images/image-20210120141206840.png" alt="image-20210120141206840.png" width="80%">

</figure>
</div>
</div>
<div id="outline-container-h:f8905e48-bb3a-42bc-a312-d2ee1162f23e" class="outline-3">
<h3 id="h:f8905e48-bb3a-42bc-a312-d2ee1162f23e">ç ´è§£ CentOS 7å’Œ8çš„ root å¯†ç </h3>
<div class="outline-text-3" id="text-h:f8905e48-bb3a-42bc-a312-d2ee1162f23e">
<p>
æ–¹æ³•ä¸€
</p>

<div class="org-src-container">
<pre class="src src-sh">&#21551;&#21160;&#26102;&#20219;&#24847;&#38190;&#26242;&#20572;&#21551;&#21160;
&#25353;e&#38190;&#36827;&#20837;&#32534;&#36753;&#27169;&#24335;
&#23558;&#20809;&#26631;&#31227;&#21160;linux &#24320;&#22987;&#30340;&#34892;&#65292;&#28155;&#21152;&#20869;&#26680;&#21442;&#25968;rd.break &#25171;&#30772;&#27491;&#24120;&#21551;&#21160;
&#25353;ctrl-x&#21551;&#21160;
mount &#8211;o remount,rw /sysroot
chroot /sysroot
passwd root

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;SELinux&#26159;&#21551;&#29992;&#30340;,&#25165;&#38656;&#35201;&#25191;&#34892;&#19979;&#38754;&#25805;&#20316;,&#22914;&#26597;&#27809;&#26377;&#21551;&#21160;,&#19981;&#38656;&#35201;&#25191;&#34892;</span>
touch /.autorelabel

<span style="color: #a020f0;">exit</span>
reboot
</pre>
</div>

<p>
æ–¹æ³•äºŒ
</p>

<div class="org-src-container">
<pre class="src src-sh">&#21551;&#21160;&#26102;&#20219;&#24847;&#38190;&#26242;&#20572;&#21551;&#21160;
&#25353;e&#38190;&#36827;&#20837;&#32534;&#36753;&#27169;&#24335;
&#23558;&#20809;&#26631;&#31227;&#21160;linux &#24320;&#22987;&#30340;&#34892;&#65292;&#25913;&#20026;rw <span style="color: #a0522d;">init</span>=/sysroot/bin/sh
&#25353;ctrl-x&#21551;&#21160;
chroot /sysroot
passwd root

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;SELinux&#26159;&#21551;&#29992;&#30340;,&#25165;&#38656;&#35201;&#25191;&#34892;&#19979;&#38754;&#25805;&#20316;,&#22914;&#26597;&#27809;&#26377;&#21551;&#21160;,&#19981;&#38656;&#35201;&#25191;&#34892;</span>
touch /.autorelabel

<span style="color: #a020f0;">exit</span>
reboot
</pre>
</div>
</div>
</div>
<div id="outline-container-h:920aa398-c45d-46a3-a9c1-9ea439dd507f" class="outline-3">
<h3 id="h:920aa398-c45d-46a3-a9c1-9ea439dd507f">å®ç°GRUB2å®‰å…¨</h3>
<div class="outline-text-3" id="text-h:920aa398-c45d-46a3-a9c1-9ea439dd507f">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#28155;&#21152;grub&#23494;&#30721;&#65292;&#20250;&#22312;/boot/grub2/&#19979;&#29983;&#25104;user.cfg&#25991;&#20214;</span>
[root@centos8 ~]#grub2-setpassword
Enter password: 
Confirm password: 

[root@centos8 ~]#ls -l /boot/grub2/
total 32
drwxr-xr-x 2 root root  4096 Jan 19 15:17 fonts
-rw-r--r-- 1 root root  5101 Jan 19 15:18 grub.cfg
-rw-r--r-- 1 root root  1024 Jan 19 15:18 grubenv
drwxr-xr-x 2 root root 12288 Jan 19 15:17 i386-pc
-rw------- 1 root root   298 Jan 19 18:20 user.cfg
[root@centos8 ~]#ls -l /boot/grub2/user.cfg 
-rw------- 1 root root 298 Jan 19 18:20 /boot/grub2/user.cfg
[root@centos8 ~]#cat /boot/grub2/user.cfg
<span style="color: #a0522d;">GRUB2_PASSWORD</span>=grub.pbkdf2.sha512.10000.60AAA29A65F4DC77E8861EF25BDE2034C9B30CE1
E07EE688D7F30460E7E87E7356B0893A6DFFB250B27D2EB9D3ED3E9207199C494D7882E2E8C772C8
2E2DDB7A.5E42FD69FA04293DECD68F077E83875A8E4572A7FBB89BA9F161B15EAFE54FBA963FE5D
52E16764944823396231803E5118DA1D9CAF3EB73C175A7D7A3682A90

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#28165;&#31354;grub&#23494;&#30721;</span>
[root@centos8 ~]#cat /dev/null &gt; /boot/grub2/user.cfg
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a6970b05-11b5-46fb-a408-4bc10305ed9a" class="outline-3">
<h3 id="h:a6970b05-11b5-46fb-a408-4bc10305ed9a">ä¿®å¤GRUB2</h3>
<div class="outline-text-3" id="text-h:a6970b05-11b5-46fb-a408-4bc10305ed9a">
<p>
GRUB2ï¼šCentOS
7ï¼Œ8åŠubuntu1804éƒ½ä½¿ç”¨å¼•å¯¼æç¤ºæ—¶å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œç•Œé¢ï¼Œå¯ä»æ–‡ä»¶ç³»ç»Ÿå¼•å¯¼
</p>

<p>
ä¸»è¦é…ç½®æ–‡ä»¶ï¼š/boot/grub2/grub.cfg
</p>

<p>
ä¿®å¤é…ç½®æ–‡ä»¶ï¼šgrub2-mkconfig &gt; /boot/grub2/grub.cfg
</p>

<p>
ä¿®å¤grub
</p>

<div class="org-src-container">
<pre class="src src-sh">grub2-install /dev/sda <span style="color: #b22222;">#</span><span style="color: #b22222;">BIOS&#29615;&#22659;</span>
grub2-install <span style="color: #b22222;">#</span><span style="color: #b22222;">UEFI&#29615;&#22659;</span>
</pre>
</div>

<p>
èŒƒä¾‹ï¼šè°ƒæ•´é»˜è®¤å¯åŠ¨å†…æ ¸
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8-A ~]#cat /boot/grub2/grubenv 
<span style="color: #b22222;"># </span><span style="color: #b22222;">GRUB Environment Block</span>
<span style="color: #a0522d;">saved_entry</span>=b74f53e89700498b96f22ddee0f70ced-4.18.0-147.el8.x86_64  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#25163;&#21160;&#20462;&#25913;&#20026;&#24819;&#21551;&#21160;&#30340;&#20869;&#26680;&#20869;&#23481;&#65292;&#36866;&#21512;centos8</span>
<span style="color: #a0522d;">kernelopts</span>=<span style="color: #a0522d;">root</span>=<span style="color: #a0522d;">UUID</span>=6498b37b-cbbf-4771-8327-b65704274aef ro <span style="color: #a0522d;">crashkernel</span>=auto <span style="color: #a0522d;">resume</span>=<span style="color: #a0522d;">UUID</span>=8424a27b-4f74-4249-b229-0ba992a5c4e7 rhgb quiet net.ifnames=0 
<span style="color: #a0522d;">boot_success</span>=0
<span style="color: #a0522d;">boot_indeterminate</span>=0
<span style="color: #b22222;">#############################################################</span>

[root@centos8-A ~]#ls /boot/loader/entries/
b74f53e89700498b96f22ddee0f70ced-0-rescue.conf  
b74f53e89700498b96f22ddee0f70ced-4.18.0-147.el8.x86_64.conf

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;&#19979;&#21629;&#20196;&#26159;&#20462;&#25913; /boot/grub2/grubenv &#23454;&#29616; &#36866;&#21512;centos7</span>
[root@centos8 ~]#grub2-set-default 1  
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25110;&#32773;</span>
[root@centos8 ~]#vim /etc/default/grub 
<span style="color: #a0522d;">GRUB_DEFAULT</span>=1
</pre>
</div>


<figure id="org017d2f8">
<img src="images/image-20210227191424514.png" alt="image-20210227191424514.png" width="60%">

</figure>
</div>
</div>
<div id="outline-container-h:eb90ecd0-adf0-4fda-9787-375d8ccc54e2" class="outline-3">
<h3 id="h:eb90ecd0-adf0-4fda-9787-375d8ccc54e2">æ•…éšœæ’é”™å®æˆ˜æ¡ˆä¾‹</h3>
<div class="outline-text-3" id="text-h:eb90ecd0-adf0-4fda-9787-375d8ccc54e2">
</div>
<div id="outline-container-orgaf13282" class="outline-4">
<h4 id="orgaf13282">å®æˆ˜æ¡ˆä¾‹1ï¼šcentos 7 ï¼Œ8 ç ´åMBRåè¿›è¡Œæ¢å¤</h4>
<div class="outline-text-4" id="text-orgaf13282">
<div class="org-src-container">
<pre class="src src-sh">dd <span style="color: #a0522d;">if</span>=/dev/zero <span style="color: #a0522d;">of</span>=/dev/sda <span style="color: #a0522d;">bs</span>=1 <span style="color: #a0522d;">count</span>=446
&#20809;&#30424;&#36827;&#20837;&#25937;&#25588;&#27169;&#24335;
grub2-install --root-directory=/mnt/sysimage /dev/sda
</pre>
</div>
</div>
</div>
<div id="outline-container-org1a13fff" class="outline-4">
<h4 id="org1a13fff">å®æˆ˜æ¡ˆä¾‹2ï¼šCentos 7 ï¼Œ8åˆ é™¤/boot/grub2/*æ‰€æœ‰å†…å®¹è¿›è¡Œæ¢å¤</h4>
<div class="outline-text-4" id="text-org1a13fff">

<figure id="org1fbaeeb">
<img src="images/image-20210120141254875.png" alt="image-20210120141254875.png" width="60%">

<figcaption><span class="figure-number">Figure 2: </span>image-20210120141254875</figcaption>
</figure>

<div class="org-src-container">
<pre class="src src-sh">&#20809;&#30424;&#36827;&#20837;&#25937;&#25588;&#27169;&#24335;
chroot /mnt/sysimage
grub2-install /dev/sda
grub2-mkconfig -o /boot/grub2/grub.cfg
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcaabe8a" class="outline-4">
<h4 id="orgcaabe8a">å®æˆ˜æ¡ˆä¾‹3ï¼šCentOS 7 ï¼Œ8 åˆ é™¤/boot/ä¸‹æ‰€æœ‰æ–‡ä»¶åè¿›è¡Œæ¢å¤</h4>
<div class="outline-text-4" id="text-orgcaabe8a">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">1 &#20809;&#30424;&#25937;&#25588;&#27169;&#24335;&#19979;&#23433;&#35013;grub2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29305;&#21035;&#35828;&#26126;&#65306;Centos8 &#24517;&#39035;&#20808;grub&#65292;&#20877;&#23433;&#35013;kernel,&#21542;&#21017;&#23433;&#35013;kernel-core&#26102;&#20250;&#25552;&#31034;grub&#20986;&#38169;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">centos8 &#20999;&#26681;</span>
chroot /mnt/sysroot
<span style="color: #b22222;">#</span><span style="color: #b22222;">centos7 &#20999;&#26681;</span>
chroot /mnt/sysimage

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;grub</span>
grub2-install /dev/sda  <span style="color: #b22222;">#</span><span style="color: #b22222;">BIOS&#29615;&#22659;</span>
grub2-install  <span style="color: #b22222;">#</span><span style="color: #b22222;">UEFI&#29615;&#22659;</span>


<span style="color: #b22222;">#</span><span style="color: #b22222;">2 &#23433;&#35013;Kernel</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">CentOS 7</span>
mount /dev/sr0 /mnt
rpm &#8211;ivh /mnt/Packages/kernel-3.10.0-1062.el7.x86_64.rpm --force

<span style="color: #b22222;">#</span><span style="color: #b22222;">CentOS 8 </span>
mount /dev/sr0 /mnt
rpm -ivh /mnt/BaseOS/Packages/kernel-core-4.18.0-147.el8.x86_64.rpm --force

<span style="color: #b22222;">#</span><span style="color: #b22222;">3 &#20462;&#22797;grub&#37197;&#32622;&#25991;&#20214;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;grub2.cfg&#25991;&#20214;</span>
grub2-mkconfig &#8211;o /boot/grub2/grub.cfg

<span style="color: #b22222;">#</span><span style="color: #b22222;">4 &#36864;&#20986;&#37325;&#21551;</span>
sync
sync
<span style="color: #a020f0;">exit</span>
<span style="color: #a020f0;">exit</span>
</pre>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-h:10153c76-1ed8-43cb-861e-273504654859" class="outline-2">
<h2 id="h:10153c76-1ed8-43cb-861e-273504654859">/proc ç›®å½•å’Œå†…æ ¸å‚æ•°ç®¡ç†</h2>
<div class="outline-text-2" id="text-h:10153c76-1ed8-43cb-861e-273504654859">
<p>
/procç›®å½•ï¼šå†…æ ¸æŠŠè‡ªå·±å†…éƒ¨çŠ¶æ€ä¿¡æ¯åŠç»Ÿè®¡ä¿¡æ¯ï¼Œä»¥åŠå¯é…ç½®å‚æ•°é€šè¿‡procä¼ª
æ–‡ä»¶ç³»ç»ŸåŠ ä»¥è¾“å‡º
</p>

<p>
å¸®åŠ©ï¼šman proc
</p>

<p>
å†…æ ¸å‚æ•°ï¼š
</p>
<ul class="org-ul">
<li>åªè¯»ï¼šåªç”¨äºè¾“å‡ºä¿¡æ¯</li>
<li>å¯å†™ï¼šå¯æ¥å—ç”¨æˆ·æŒ‡å®šâ€œæ–°å€¼â€æ¥å®ç°å¯¹å†…æ ¸æŸåŠŸèƒ½æˆ–ç‰¹æ€§çš„é…ç½®</li>
</ul>

<p>
/proc/sys è®¾ç½®
</p>

<pre class="example" id="orgc3a814f">
systctlæ˜¯ä¸€ä¸ªå…è®¸æ”¹å˜æ­£åœ¨è¿è¡Œä¸­çš„linuxç³»ç»Ÿçš„æ¥å£ï¼Œä¿®æ”¹çš„æ˜¯æ•´ä¸ªç³»ç»Ÿçš„å†…æ ¸å‚æ•°ã€‚sysctlçš„ä¿®æ”¹æ˜¯ç«‹å³ä¸”ä¸´æ—¶çš„(é‡å¯åå¤±æ•ˆ)ã€‚
ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹sysctl.confé…ç½®æ–‡ä»¶ï¼Œè¾¾åˆ°æ°¸ä¹…ç”Ÿæ•ˆã€‚
</pre>

<ul class="org-ul">
<li>sysctlå‘½ä»¤ç”¨äºæŸ¥çœ‹æˆ–è®¾å®šæ­¤ç›®å½•ä¸­è¯¸å¤šå‚æ•°</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">sysctl -w path.to.parameter=VALUE
</pre>
</div>

<ul class="org-ul">
<li>é»˜è®¤é…ç½®æ–‡ä»¶ï¼š/etc/sysctl.conf åŠä»¥ä¸‹æ–‡ä»¶(å‚æ•°è®¾ç½®æ”¾åœ¨ä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥)</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">/run/sysctl.d/*.conf
/etc/sysctl.d/*.conf
/usr/local/lib/sysctl.d/*.conf
/usr/lib/sysctl.d/*.conf
/lib/sysctl.d/*.conf
/etc/sysctl.conf
</pre>
</div>

<p>
èŒƒä¾‹:
</p>

<div class="org-src-container">
<pre class="src src-sh">sysctl -w kernel.hostname=mail.me.com
</pre>
</div>

<ul class="org-ul">
<li>echoå‘½ä»¤é€šè¿‡é‡å®šå‘æ–¹å¼ä¹Ÿå¯ä»¥ä¿®æ”¹å¤§å¤šæ•°å‚æ•°çš„å€¼</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"VALUE"</span> &gt; /proc/sys/path/to/parameter
</pre>
</div>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">echo</span> &#8220;websrv&#8221; &gt; /proc/sys/kernel/hostname
</pre>
</div>

<p>
sysctlå‘½ä»¤ï¼š
(1) ä¸´æ—¶è®¾ç½®æŸå‚æ•°
</p>

<div class="org-src-container">
<pre class="src src-sh">sysctl -w <span style="color: #a0522d;">parameter</span>=VALUE
</pre>
</div>

<p>
(2) é€šè¿‡è¯»å–é…ç½®æ–‡ä»¶è®¾ç½®å‚æ•°
</p>

<div class="org-src-container">
<pre class="src src-sh">sysctl -p [/path/to/conf_file]
</pre>
</div>

<p>
(3) æŸ¥çœ‹æ‰€æœ‰ç”Ÿæ•ˆå‚æ•°
</p>

<div class="org-src-container">
<pre class="src src-sh">sysctl -a
</pre>
</div>

<p>
å¸¸ç”¨çš„å†…æ ¸å‚æ•°ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">net.ipv4.ip_forward                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36335;&#30001;&#21151;&#33021;,&#34920;&#31034;&#24320;&#21551;ip&#36716;&#21457;</span>
net.ipv4.icmp_echo_ignore_all  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20801;&#35768;ping&#35774;&#32622;</span>
net.ipv4.ip_nonlocal_bind          <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20801;&#35768;&#24212;&#29992;&#31243;&#24207;&#21487;&#20197;&#30417;&#21548;&#26412;&#22320;&#19981;&#23384;&#22312;&#30340;IP  &#65292;vip&#26102;&#20250;&#29992;&#21040;</span>
vm.drop_caches                          <span style="color: #b22222;">#</span><span style="color: #b22222;">&#37322;&#25918;&#32531;&#20914;&#21306;</span>
fs.file-max = 1020000               <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26368;&#22823;&#25991;&#20214;&#20010;&#25968;</span>

vm.overcommit_memory = 0
<span style="color: #b22222;">#</span><span style="color: #b22222;">0&#34920;&#31034;&#20869;&#26680;&#23558;&#26816;&#26597;&#26159;&#21542;&#26377;&#36275;&#22815;&#21487;&#29992;&#20869;&#23384;&#20379;&#36827;&#31243;&#20351;&#29992;&#65307;&#22914;&#26524;&#26377;&#36275;&#22815;&#21487;&#29992;&#20869;&#23384;&#65292;&#20869;&#23384;&#30003;&#35831;&#20801;&#35768;&#65307;&#21542;&#21017;&#20869;&#23384;&#30003;&#35831;&#22833;&#36133;&#65292;&#24182;&#25226;&#38169;&#35823;&#36820;&#22238;&#32473;&#24212;&#29992;&#36827;&#31243;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">1&#34920;&#31034;&#20869;&#26680;&#20801;&#35768;&#20998;&#37197;&#25152;&#26377;&#30340;&#29289;&#29702;&#20869;&#23384;&#65292;&#32780;&#19981;&#31649;&#24403;&#21069;&#20869;&#23384;&#29366;&#24577;&#22914;&#20309;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">2&#34920;&#31034;&#20869;&#26680;&#20801;&#35768;&#20998;&#37197;&#36229;&#36807;&#25152;&#26377;&#29289;&#29702;&#20869;&#23384;&#21644;&#20132;&#25442;&#31354;&#38388;&#24635;&#21644;&#30340;&#20869;&#23384;</span>

vm.swappiness = 10         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622;&#20869;&#23384;&#36824;&#21097;&#20313;10%&#31354;&#38386;&#31354;&#38388;&#26102;&#65292;&#23601;&#20250;&#20351;&#29992;swap&#31354;&#38388;&#65292;&#40664;&#35748;&#20540;&#20026;30&#65292;&#20540;&#36234;&#22823;&#34920;&#31034;&#36234;&#20542;&#21521;&#20110;&#20351;&#29992;swap</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31105;&#29992;ipv6</span>
net.ipv6.conf.all.disable_ipv6 =1
net.ipv6.conf.default.disable_ipv6 =1
</pre>
</div>

<p>
èŒƒä¾‹
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /proc/sys/net/ipv4/icmp_echo_ignore_all 
0
[root@centos8 ~]#vim /etc/sysctl.d/test.conf
[root@centos8 ~]#cat /etc/sysctl.d/test.conf
net.ipv4.icmp_echo_ignore_all=1
[root@centos8 ~]#sysctl -p /etc/sysctl.d/test.conf
net.ipv4.icmp_echo_ignore_all = 1
[root@centos8 ~]#cat /proc/sys/net/ipv4/icmp_echo_ignore_all 
1
</pre>
</div>
</div>
</section>
<section id="outline-container-h:fa9b09be-a7d3-4d9f-8564-44bcfed39546" class="outline-2">
<h2 id="h:fa9b09be-a7d3-4d9f-8564-44bcfed39546">journalctl</h2>
<div class="outline-text-2" id="text-h:fa9b09be-a7d3-4d9f-8564-44bcfed39546">
<p>
journalctl -u wokd -f
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475; systemd &#26085;&#24535;</span>
journalctl -u cron.service --since <span style="color: #8b2252;">"11:40:00"</span>
journalctl -u sshd --since <span style="color: #8b2252;">"2025-05-04 04:00:00"</span> --until <span style="color: #8b2252;">"2025-05-07 05:00:00"</span>
</pre>
</div>

<p>
ä¼šè¯è¯¦æƒ…
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#36890;&#36807; journalctl &#36807;&#28388;&#29305;&#23450;&#20250;&#35805;</span>
journalctl <span style="color: #a0522d;">_PID</span>=4771
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25110;&#26597;&#30475;&#25152;&#26377; root &#29992;&#25143;&#20250;&#35805;</span>
journalctl <span style="color: #a0522d;">_UID</span>=0
</pre>
</div>

<p>
èŒƒä¾‹: sshæš´åŠ›ç ´è§£æ£€æŸ¥
</p>
<div class="org-src-container">
<pre class="src src-sh">~]# tail /var/log/messages
May  8 13:50:01 overseas-tools systemd: Started Session 4786 of user root.

~]# grep 14450 /var/log/secure
May  4 04:18:22 overseas-tools sshd[14450]: Invalid user a from 195.211.191.197 port 39244
May  4 04:18:22 overseas-tools sshd[14450]: input_userauth_request: invalid user a [preauth]
May  4 04:18:24 overseas-tools sshd[14450]: Connection closed by 195.211.191.197 port 39244 [preauth]
<span style="color: #b22222;">#</span><span style="color: #b22222;">invalid user a&#65306;&#23581;&#35797;&#20351;&#29992;&#26080;&#25928;&#29992;&#25143;&#21517; a &#36827;&#34892;&#35748;&#35777;&#65292;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">[preauth]&#65306;&#27492;&#27425;&#35748;&#35777;&#35831;&#27714;&#22312;SSH&#30340;&#8220;&#39044;&#35748;&#35777;&#38454;&#27573;&#8221;&#34987;&#25298;&#32477;&#65288;&#26410;&#23436;&#25104;&#23494;&#38053;&#20132;&#25442;&#25110;&#23494;&#30721;&#39564;&#35777;&#21069;&#65289;&#12290;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36890;&#36807; journalctl &#36807;&#28388;&#29305;&#23450;&#20250;&#35805;</span>
~]# journalctl <span style="color: #a0522d;">_PID</span>=14450
-- Logs begin at Thu 2023-10-19 11:48:25 CST, end at Thu 2025-05-08 14:11:00 CST. --
Feb 19 08:10:01 overseas-tools CROND[14450]: (root) CMD (/usr/lib64/sa/sa1 1 1)
Mar 11 14:51:03 overseas-tools sshd[14450]: Invalid user centos from 59.148.102.58 port 50150
Mar 11 14:51:03 overseas-tools sshd[14450]: input_userauth_request: invalid user centos [preauth]
Mar 11 14:51:03 overseas-tools sshd[14450]: Connection closed by 59.148.102.58 port 50150 [preauth]
-- Reboot --
May 04 04:18:22 overseas-tools sshd[14450]: Invalid user a from 195.211.191.197 port 39244
May 04 04:18:22 overseas-tools sshd[14450]: input_userauth_request: invalid user a [preauth]
May 04 04:18:24 overseas-tools sshd[14450]: Connection closed by 195.211.191.197 port 39244 [preauth]

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35786;&#26029;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#32479;&#35745;&#25152;&#26377;&#26080;&#25928;&#29992;&#25143;&#21517;&#30340;&#23581;&#35797;&#27425;&#25968;</span>
grep <span style="color: #8b2252;">"invalid user"</span> /var/log/secure | awk <span style="color: #8b2252;">'{print $(NF-1)}'</span> | sort | uniq -c | sort -nr
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#25552;&#21462;&#25152;&#26377;&#23581;&#35797;&#38750;&#27861;&#30331;&#24405;&#30340;IP&#22320;&#22336;</span>
grep <span style="color: #8b2252;">"sshd.*Invalid user.*from"</span> /var/log/secure | grep -oE <span style="color: #8b2252;">'([0-9]{1,3}\.){3}[0-9]{1,3}'</span> | sort | uniq -c

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26816;&#26597;SSH&#37197;&#32622;</span>
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#30830;&#35748;SSH&#26381;&#21153;&#30417;&#21548;&#33539;&#22260;</span>
ss -tulnp | grep sshd
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#26597;&#30475;SSH&#35748;&#35777;&#22833;&#36133;&#35760;&#24405;</span>
journalctl -u sshd --since <span style="color: #8b2252;">"2025-05-04 04:00:00"</span> --until <span style="color: #8b2252;">"2025-05-07 05:00:00"</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#38450;&#25252;</span>
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#38480;&#21046;SSH&#35775;&#38382;IP</span>
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"AllowUsers *@192.168.1.0/24"</span> &gt;&gt; /etc/ssh/sshd_config
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#31105;&#29992;&#23494;&#30721;&#30331;&#24405;&#65292;&#21551;&#29992;&#23494;&#38053;&#35748;&#35777;</span>
sed -i <span style="color: #8b2252;">'s/#PasswordAuthentication yes/PasswordAuthentication no/g'</span> /etc/ssh/sshd_config
systemctl restart sshd
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#26356;&#25913;SSH&#40664;&#35748;&#31471;&#21475;</span>
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#37096;&#32626;Fail2ban,&#33258;&#21160;&#23553;&#31105;&#22810;&#27425;&#23581;&#35797;&#22833;&#36133;&#30340;IP</span>
apt install fail2ban  <span style="color: #b22222;"># </span><span style="color: #b22222;">Debian/Ubuntu</span>
yum install fail2ban  <span style="color: #b22222;"># </span><span style="color: #b22222;">CentOS/RHEL</span>
systemctl enable --now fail2ban
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#37197;&#32622;&#38450;&#28779;&#22681;&#35268;&#21017;&#65306;&#20351;&#29992; iptables &#25110; ufw &#38480;&#21046;SSH&#31471;&#21475;&#30340;&#35775;&#38382;&#39057;&#29575;</span>
ufw limit proto tcp to 0.0.0.0/0 port 22

<span style="color: #b22222;">#</span><span style="color: #b22222;">IP&#23433;&#20840;&#26816;&#26597;</span>
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#26816;&#26597;&#24403;&#21069;&#36830;&#25509;&#29366;&#24577;</span>
netstat -antp | grep 195.211.191.197
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#26597;&#30475;&#21487;&#30097;&#36827;&#31243;</span>
ps -aux | grep [PID]
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#23041;&#32961;&#24773;&#25253;&#24179;&#21488;&#39564;&#35777;</span>
&#24494;&#27493;&#22312;&#32447;&#65288;ThreatBook&#65289;&#65306;&#35775;&#38382; https://x.threatbook.cn/ &#36755;&#20837;IP&#65292;&#26597;&#30475;&#20854;&#21382;&#21490;&#23041;&#32961;&#26631;&#31614;&#65288;&#22914;&#26159;&#21542;&#20851;&#32852;&#24694;&#24847;&#36719;&#20214;&#23478;&#26063;&#25110;&#20725;&#23608;&#32593;&#32476;&#65289;&#12290;
VirusTotal&#65306;&#36890;&#36807; https://www.virustotal.com/ &#20998;&#26512;IP&#30340;&#20449;&#35465;&#35780;&#20998;&#21450;&#20851;&#32852;&#26679;&#26412;&#12290;
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#20998;&#26512;&#35813;IP&#30340;&#20840;&#29699;&#23041;&#32961;&#30011;&#20687;</span>
&#21487;&#36890;&#36807; Shodan &#26597;&#35810;&#20854;&#24320;&#25918;&#31471;&#21475;&#21450;&#26381;&#21153;&#20449;&#24687; https://www.shodan.io/

<span style="color: #b22222;">##</span><span style="color: #b22222;">&#23553;&#31105;IP</span>
iptables -A INPUT -s 195.211.191.197 -j DROP
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#28145;&#24230;&#25490;&#26597;</span>
&#26816;&#26597;&#31995;&#32479;&#23436;&#25972;&#24615;:
- &#20351;&#29992;&#24037;&#20855;&#65288;&#22914; rkhunter&#12289;chkrootkit&#65289;&#25195;&#25551;&#38544;&#34255;&#21518;&#38376;&#25110;Rootkit
- &#26816;&#26597;&#35745;&#21010;&#20219;&#21153;&#12289;&#21551;&#21160;&#39033;&#12289;&#26381;&#21153;&#21015;&#34920;&#26159;&#21542;&#23384;&#22312;&#24322;&#24120;&#26465;&#30446;
&#20840;&#30424;&#26432;&#27602;&#65306;
- &#20351;&#29992;ClamAV&#25110;&#20225;&#19994;&#32423;&#26432;&#27602;&#24037;&#20855;&#65288;&#22914;&#21345;&#24052;&#26031;&#22522;&#65289;&#25195;&#25551;&#24694;&#24847;&#25991;&#20214;
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#27861;&#24459;&#19982;&#25253;&#21578;</span>
&#30041;&#23384;&#35777;&#25454;&#65306;
- &#23548;&#20986;&#23436;&#25972;&#26085;&#24535;&#21644;&#32593;&#32476;&#27969;&#37327;&#35760;&#24405;&#65292;&#29992;&#20110;&#21518;&#32493;&#21462;&#35777;&#12290;

&#19978;&#25253;&#30456;&#20851;&#37096;&#38376;&#65306;
- &#33509;&#30830;&#35748;&#25915;&#20987;&#28041;&#21450;&#37325;&#22823;&#23041;&#32961;&#65292;&#21487;&#32852;&#31995;&#22269;&#23478;&#32593;&#32476;&#23433;&#20840;&#36890;&#25253;&#20013;&#24515;&#25110;&#24403;&#22320;&#32593;&#35686;
</pre>
</div>
</div>
</section>
<section id="outline-container-h:99edcc75-a6f5-464e-a8c4-ee70d80156f3" class="outline-2">
<h2 id="h:99edcc75-a6f5-464e-a8c4-ee70d80156f3">/sys ç›®å½•</h2>
<div class="outline-text-2" id="text-h:99edcc75-a6f5-464e-a8c4-ee70d80156f3">
<p>
/sysç›®å½•ï¼š
</p>

<p>
ä½¿ç”¨sysfsæ–‡ä»¶ç³»ç»Ÿï¼Œä¸ºç”¨æˆ·ä½¿ç”¨çš„ä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œ <b>è¾“å‡ºå†…æ ¸è¯†åˆ«å‡ºçš„å„ç¡¬ä»¶è®¾
å¤‡çš„ç›¸å…³å±æ€§ä¿¡æ¯</b> ï¼Œä¹Ÿæœ‰å†…æ ¸å¯¹ç¡¬ä»¶ç‰¹æ€§çš„è®¾å®šä¿¡æ¯ï¼›æœ‰äº›å‚æ•°æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œ
ç”¨äºè°ƒæ•´ç¡¬ä»¶å·¥ä½œç‰¹æ€§
</p>

<p>
udevé€šè¿‡æ­¤è·¯å¾„ä¸‹è¾“å‡ºçš„ä¿¡æ¯åŠ¨æ€ä¸ºå„è®¾å¤‡åˆ›å»ºæ‰€éœ€è¦è®¾å¤‡æ–‡ä»¶ï¼Œudevæ˜¯è¿è¡Œç”¨
æˆ·ç©ºé—´ç¨‹åº
</p>

<p>
ä¸“ç”¨å·¥å…·ï¼šudevadmin, hotplug
</p>

<p>
udevä¸ºè®¾å¤‡åˆ›å»ºè®¾å¤‡æ–‡ä»¶æ—¶ï¼Œä¼šè¯»å–å…¶äº‹å…ˆå®šä¹‰å¥½çš„è§„åˆ™æ–‡ä»¶ï¼Œä¸€èˆ¬åœ¨
/etc/udev/rules.d åŠ/usr/lib/udev/rules.dç›®å½•ä¸‹
</p>
</div>
</section>
<section id="outline-container-h:cf699c8b-b48e-4f44-a0f2-577ecad299b1" class="outline-2">
<h2 id="h:cf699c8b-b48e-4f44-a0f2-577ecad299b1">å†…æ ¸æ¨¡å—ç®¡ç†å’Œç¼–è¯‘</h2>
<div class="outline-text-2" id="text-h:cf699c8b-b48e-4f44-a0f2-577ecad299b1">
<p>
å•å†…æ ¸ä½“ç³»è®¾è®¡ã€ä½†å……åˆ†å€Ÿé‰´äº†å¾®å†…æ ¸è®¾è®¡ä½“ç³»çš„ä¼˜ç‚¹ï¼Œä¸ºå†…æ ¸å¼•å…¥æ¨¡å—åŒ–æœºåˆ¶
</p>

<p>
å†…æ ¸ç»„æˆéƒ¨åˆ†ï¼š
</p>

<ul class="org-ul">
<li>kernelï¼šå†…æ ¸æ ¸å¿ƒï¼Œä¸€èˆ¬ä¸ºbzImageï¼Œé€šå¸¸åœ¨/bootç›®å½•ä¸‹ , åç§°ä¸º
vmlinuz-VERSION-RELEASE</li>
<li>kernel objectï¼šå†…æ ¸å¯¹è±¡ï¼Œä¸€èˆ¬æ”¾ç½®äº <code>/lib/modules/VERSION-RELEASE/</code></li>
<li>è¾…åŠ©æ–‡ä»¶ï¼šramdisk
<ul class="org-ul">
<li>initrdï¼šä»CentOS 5 ç‰ˆæœ¬ä»¥å‰</li>
<li>initramfsï¼šä»CentOS6 ç‰ˆæœ¬ä»¥å</li>
</ul></li>
</ul>
</div>
<div id="outline-container-h:4204a51c-b3f6-4d17-ab2e-fd819ae78ced" class="outline-3">
<h3 id="h:4204a51c-b3f6-4d17-ab2e-fd819ae78ced">å†…æ ¸ç‰ˆæœ¬</h3>
<div class="outline-text-3" id="text-h:4204a51c-b3f6-4d17-ab2e-fd819ae78ced">
<p>
è¿è¡Œä¸­çš„å†…æ ¸ï¼š
</p>

<p>
unameå‘½ä»¤ï¼š
</p>

<p>
uname - print system information
</p>

<p>
uname [OPTION]&#x2026;
</p>

<div class="org-src-container">
<pre class="src src-sh">-n: &#26174;&#31034;&#33410;&#28857;&#21517;&#31216;
-r: &#26174;&#31034;VERSION-RELEASE
-a:&#26174;&#31034;&#25152;&#26377;&#20449;&#24687;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:8c326ac8-2293-4cd6-a4ed-0b8a19bf4157" class="outline-3">
<h3 id="h:8c326ac8-2293-4cd6-a4ed-0b8a19bf4157">å†…æ ¸æ¨¡å—å‘½ä»¤</h3>
<div class="outline-text-3" id="text-h:8c326ac8-2293-4cd6-a4ed-0b8a19bf4157">
<p>
<b>lsmodå‘½ä»¤ï¼š</b>
</p>

<ul class="org-ul">
<li>æ˜¾ç¤ºç”±æ ¸å¿ƒå·²ç»è£…è½½çš„å†…æ ¸æ¨¡å—</li>
<li>æ˜¾ç¤ºçš„å†…å®¹æ¥è‡ªäº: /proc/modulesæ–‡ä»¶</li>
</ul>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#lsmod 
Module                 Size Used by
uas                    28672  0
usb_storage            73728  1 uas
nls_utf8               16384  0
isofs                  45056  0 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#65306;&#21517;&#31216;&#12289;&#22823;&#23567;&#65292;&#20351;&#29992;&#27425;&#25968;&#65292;&#34987;&#21738;&#20123;&#27169;&#22359;&#20381;&#36182;</span>
</pre>
</div>

<p>
<b>modinfoå‘½ä»¤ï¼š</b>
</p>

<p>
åŠŸèƒ½ï¼šç®¡ç†å†…æ ¸æ¨¡å—
</p>

<p>
é…ç½®æ–‡ä»¶ï¼š/etc/modprobe.conf, /etc/modprobe.d/*.conf
</p>

<ul class="org-ul">
<li>æ˜¾ç¤ºæ¨¡å—çš„è¯¦ç»†æè¿°ä¿¡æ¯</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">modinfo [ -k kernel ] [ modulename|filename... ]
</pre>
</div>

<p>
å¸¸ç”¨é€‰é¡¹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">-n&#65306;&#21482;&#26174;&#31034;&#27169;&#22359;&#25991;&#20214;&#36335;&#24452;&#65307;&#30456;&#23545;&#20110;-F filename
-p&#65306;&#26174;&#31034;&#27169;&#22359;&#21442;&#25968;
-a&#65306;&#20316;&#32773;
-d&#65306;&#25551;&#36848;
-F field&#65306;&#20165;&#26174;&#31034;&#25351;&#23450;&#23383;&#27573;&#30340;&#20449;&#24687;&#65307;
-k kernel&#65306;&#22810;&#20869;&#26680;&#24182;&#23384;&#26102;&#33509;&#35201;&#26597;&#35810;&#21478;&#22806;&#19968;&#20010;kernel&#19978;&#30340;&#27169;&#22359;&#20449;&#24687;
</pre>
</div>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8-A ~]#lsmod |grep xfs
xfs                  1474560  2
libcrc32c              16384  3 nf_conntrack,nf_nat,xfs
[root@centos8-A ~]#modinfo xfs
filename:       /lib/modules/4.18.0-147.el8.x86_64/kernel/fs/xfs/xfs.ko.xz
license:        GPL
description:    SGI XFS with ACLs, security attributes, no debug enabled
author:         Silicon Graphics, Inc.
<span style="color: #483d8b;">alias</span>:          fs-xfs
rhelversion:    8.1
srcversion:     947E2EDC226CFCEC0F1F71B
depends:        libcrc32c
intree:         Y
name:           xfs
vermagic:       4.18.0-147.el8.x86_64 SMP mod_unload modversions 
sig_id:         PKCS#7
signer:         CentOS Linux kernel signing key
sig_key:        79:05:D0:5C:21:6F:8A:C5:DD:6E:19:BB:77:9D:05:F6:F2:21:B8:17
sig_hashalgo:   sha256
signature:      C9:68:71:F6:2D:2A:F9:83:AC:A8:12:30:29:E3:61:1C:0C:2F:1E:7E:
        BC:1D:87:B9:56:00:4E:6F:87:9C:6F:22:78:09:D1:D9:C0:D0:21:C1:
        8F:0F:62:11:C0:15:E5:6E:70:D4:A5:92:F7:15:D8:0F:C4:4E:F4:7E:
        87:74:A9:32:CC:D7:97:1B:11:B9:3C:98:51:25:DD:99:1D:15:55:19:
        C2:E4:67:58:AE:A0:7F:21:13:3C:F5:A1:8B:86:81:70:49:3F:62:3B:
        F0:37:A9:8F:87:01:5D:7F:FA:5C:5A:1F:16:88:EE:87:DA:03:8C:9D:
        92:7E:5E:F4:D6:56:AF:FF:DB:FA:8A:AC:D3:BE:2F:13:7A:1D:CB:BF:
        A5:EB:2C:06:2C:7D:55:E6:AA:78:83:51:F4:CA:72:98:79:C1:55:E4:
        80:C2:8D:4F:E5:CB:EC:A4:9D:AB:5A:AA:CB:8A:A5:FE:0C:E1:CC:1E:
        26:A3:D1:E7:FA:F4:D2:66:12:1F:BB:4F:73:16:8A:A0:19:7E:A5:17:
        3D:DF:2A:A5:B2:4F:64:44:2B:3E:06:A1:3A:5F:FF:DD:CC:6B:71:20:
        A8:6E:83:AF:A6:C0:38:B6:3A:C3:72:2F:74:64:1F:E4:1C:EC:E5:B4:
        77:AA:5D:38:3B:50:EB:1A:82:79:13:7C:A6:70:B1:37:A0:1E:4C:18:
        C9:14:46:7A:0B:D4:2F:A3:29:E6:49:42:D4:A8:03:4F:33:FA:D7:3E:
        C4:CE:F7:53:C7:1D:7F:28:4F:70:F5:67:71:29:2E:9C:E5:A6:60:02:
        D2:49:7F:F1:6D:3D:E6:F9:FF:B0:01:F8:C2:50:C3:AB:23:50:F4:19:
        A2:45:DC:9B:C3:1C:DA:C0:36:88:7C:C0:9B:D7:7D:B6:3A:D5:83:AD:
        AD:7A:33:92:09:D2:7F:B0:0E:B4:21:2F:DB:F9:F7:50:E4:C8:94:D1:
        29:E6:2D:C1:5D:51:94:14:1C:72:04:CB:BF:FC:DA:6E:A3:66:D2:0A:
        C5:E0:F2:0F
</pre>
</div>

<p>
<b>è£…è½½æˆ–å¸è½½å†…æ ¸æ¨¡å—</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">modprobe [ -C config-file ] [ modulename ] [ module parame-ters... ] 
modprobe [ -r ] modulename&#8230; &#21368;&#36733;
&#21516;&#26102;&#20250;&#25346;&#36733;&#20381;&#36182;&#30340;&#27169;&#22359;
</pre>
</div>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8-A ~]#lsmod |grep usb
btusb                  53248  0
btrtl                  16384  1 btusb
btbcm                  16384  1 btusb
btintel                24576  1 btusb
bluetooth             630784  27 btrtl,btintel,btbcm,bnep,btusb,rfcomm
[root@centos8-A ~]#modprobe usb_storage
[root@centos8-A ~]#lsmod |grep usb
usb_storage            73728  0
btusb                  53248  0
btrtl                  16384  1 btusb
btbcm                  16384  1 btusb
btintel                24576  1 btusb
bluetooth             630784  27 btrtl,btintel,btbcm,bnep,btusb,rfcomm
[root@centos8-A ~]#modprobe -r usb_storage
[root@centos8-A ~]#lsmod |grep uas

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22240;&#20026;uas&#20381;&#36182;usb_storage,&#23433;&#35013;uas&#20250;&#33258;&#21160;&#21152;&#36733;usb_storage</span>
[root@centos8-A ~]#modprobe uas
[root@centos8-A ~]#lsmod |grep usb
usb_storage            73728  1 uas
btusb                  53248  0
btrtl                  16384  1 btusb
btbcm                  16384  1 btusb
btintel                24576  1 btusb
bluetooth             630784  27 btrtl,btintel,btbcm,bnep,btusb,rfcomm
[root@centos8-A ~]#lsmod |grep -E <span style="color: #8b2252;">'usb|uas'</span>
uas                    28672  0
usb_storage            73728  1 uas
btusb                  53248  0
btrtl                  16384  1 btusb
btbcm                  16384  1 btusb
btintel                24576  1 btusb
bluetooth             630784  27 btrtl,btintel,btbcm,bnep,btusb,rfcomm

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22240;&#20026;uas&#20381;&#36182;usb_storage&#65292;&#26080;&#27861;&#30452;&#25509;&#21368;&#36733;usb_storage</span>
[root@centos8-A ~]#modprobe -r usb_storage
modprobe: FATAL: Module usb_storage is<span style="color: #a020f0;"> in</span> use.

[root@centos8-A ~]#modprobe -r uas
[root@centos8-A ~]#modprobe -r usb_storage
</pre>
</div>

<p>
depmodå‘½ä»¤ï¼šå†…æ ¸æ¨¡å—ä¾èµ–å…³ç³»æ–‡ä»¶åŠç³»ç»Ÿä¿¡æ¯æ˜ å°„æ–‡ä»¶çš„ç”Ÿæˆå·¥å…·
</p>

<p>
insmodå‘½ä»¤ï¼šå¯ä»¥å®‰è£…æ¨¡å—ï¼Œéœ€è¦æŒ‡å®šæ¨¡å—æ–‡ä»¶è·¯å¾„ï¼Œå¹¶ä¸”ä¸è‡ªåŠ¨è§£å†³ä¾èµ–æ¨¡å—
</p>

<div class="org-src-container">
<pre class="src src-sh">insmod [ filename ] [ module options... ]
</pre>
</div>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">insmod <span style="color: #ff00ff;">`modinfo &#8211;n exportfs`</span>
insmod <span style="color: #ff00ff;">`modinfo &#8211;n xfs`</span>
</pre>
</div>

<p>
rmmodå‘½ä»¤ï¼šå¸è½½æ¨¡å—
</p>

<div class="org-src-container">
<pre class="src src-sh">rmmod [ modulename ]
</pre>
</div>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">rmmod xfs
rmmod exportfs
</pre>
</div>
</div>
</div>
<div id="outline-container-h:f30f3641-467f-49b3-a788-56a87a18d863" class="outline-3">
<h3 id="h:f30f3641-467f-49b3-a788-56a87a18d863">ç¼–è¯‘å†…æ ¸</h3>
<div class="outline-text-3" id="text-h:f30f3641-467f-49b3-a788-56a87a18d863">
<p>
ç¼–è¯‘å®‰è£…å†…æ ¸å‡†å¤‡ï¼š
</p>
<ol class="org-ol">
<li>å‡†å¤‡å¥½å¼€å‘ç¯å¢ƒ</li>
<li>è·å–ç›®æ ‡ä¸»æœºä¸Šç¡¬ä»¶è®¾å¤‡çš„ç›¸å…³ä¿¡æ¯</li>
<li>è·å–ç›®æ ‡ä¸»æœºç³»ç»ŸåŠŸèƒ½çš„ç›¸å…³ä¿¡æ¯ï¼Œä¾‹å¦‚:éœ€è¦å¯ç”¨ç›¸åº”çš„æ–‡ä»¶ç³»ç»Ÿ</li>
<li>è·å–å†…æ ¸æºä»£ç åŒ…ï¼Œ www.kernel.org</li>
</ol>

<p>
<b>ç¼–è¯‘å‡†å¤‡</b>
</p>

<p>
<b>ç›®æ ‡ä¸»æœºç¡¬ä»¶è®¾å¤‡ç›¸å…³ä¿¡æ¯</b>
</p>

<p>
CPUï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">cat /proc/cpuinfo
x86info -a
lscpu
</pre>
</div>

<p>
PCIè®¾å¤‡ï¼šlspci -v ï¼Œ-vv
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]# lspci <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#24403;&#21069;PCI&#35774;&#22791;</span>
00:00.0 Host bridge: Intel Corporation 440BX/ZX/DX - 82443BX/ZX/DX Host bridge (rev 01)
00:01.0 PCI bridge&#65288;&#21271;&#26725;&#65289;: Intel Corporation 440BX/ZX/DX - 82443BX/ZX/DX AGP bridge (rev 01)
00:07.0 ISA bridge&#65288;&#21335;&#26725;&#65289;: Intel Corporation 82371AB/EB/MB PIIX4 ISA (rev 08)
00:07.1 IDE interface(IDE&#25509;&#21475;): Intel Corporation 82371AB/EB/MB PIIX4 IDE (rev 01)
00:07.3 Bridge(&#39640;&#32423;&#30005;&#28304;&#31649;&#29702;&#26725;): Intel Corporation 82371AB/EB/MB PIIX4 ACPI (rev 08)
00:07.7 System peripheral&#65288;&#38598;&#25104;&#25509;&#21475;&#65289;: VMware Virtual Machine Communication Interface (rev 10)
00:0f.0 VGA compatible controller&#65288;&#26174;&#21345;&#25509;&#21475;&#65289;: VMware SVGA II Adapter
00:10.0 SCSI storage controller&#65288;&#23384;&#20648;&#25511;&#21046;&#22120;&#65289;: LSI Logic / Symbios Logic 53c1030 PCI-X Fusion-MPT Dual Ultra320 SCSI (rev 01)
... ...
00:18.7 PCI bridge: VMware PCI Express Root Port (rev 01)
02:00.0 USB controller: VMware USB1.1 UHCI Controller&#65288;&#22411;&#21495;UHCI&#65292;USB1.1&#25511;&#21046;&#22120;&#65289;
02:01.0 Ethernet controller: Intel Corporation 82545EM Gigabit Ethernet Controller (Copper) (rev 01)&#65288;&#21315;&#20806;&#20197;&#22826;&#32593;&#32593;&#25511;&#21046;&#22120;&#65289;
02:02.0 Multimedia audio controller: Ensoniq ES1371 / Creative Labs CT2518 [AudioPCI-97] (rev 02)
02:03.0 USB controller: VMware USB2 EHCI Controller&#65288;&#22411;&#21495;EHCI&#65292;USB2&#25511;&#21046;&#22120;&#65289;
</pre>
</div>

<p>
USBè®¾å¤‡ï¼šlsusb -vï¼Œ-vv
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8-A ~]#dnf install usbutils -y
[root@centos8-A ~]#lsusb
Bus 001 Device 004: ID 0951:1666 Kingston Technology DataTraveler 100 G3/G4/SE9 
G2
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 003: ID 0e0f:0002 VMware, Inc. Virtual USB Hub
Bus 002 Device 002: ID 0e0f:0003 VMware, Inc. Virtual Mouse
Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
[root@centos8-A ~]#lsmod |grep usb
usb_storage           73728 1 uas
</pre>
</div>

<p>
lsblk å—è®¾å¤‡
</p>

<p>
å…¨éƒ¨ç¡¬ä»¶è®¾å¤‡ä¿¡æ¯ï¼šhal-deviceï¼šCentOS 6
</p>

<p>
<b>å¼€å‘ç¯å¢ƒç›¸å…³åŒ…</b>
</p>

<p>
gcc make ncurses-devel flex bison openssl-devel elfutils-libelf-devel
</p>

<p>
<b>å†…æ ¸ç¼–è¯‘å®‰è£…å®ç°</b>
</p>

<ul class="org-ul">
<li>ä¸‹è½½æºç æ–‡ä»¶</li>
<li>å‡†å¤‡æ–‡æœ¬é…ç½®æ–‡ä»¶/boot/config-`uname -r`</li>
<li>make menuconfigï¼šé…ç½®å†…æ ¸é€‰é¡¹ ï¼Œç›¸å½“äº./configure</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">[ ]: N
[M]: M  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29420;&#31435;&#27169;&#22359;&#26680;&#24515;&#25991;&#20214;</span>
[*]: Y  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21253;&#21040;&#20869;&#26680;&#25991;&#20214;&#20013;</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
make [-j #] æˆ–è€…ç”¨ä»¥ä¸‹ä¸¤æ­¥å®ç°ï¼š
</p>

<p>
make -j # bzImage
</p>

<p>
make -j # modules
</p></li>

<li>å®‰è£…æ¨¡å—ï¼šmake modules_install</li>
<li>å®‰è£…å†…æ ¸ç›¸å…³æ–‡ä»¶ï¼šmake install
<ul class="org-ul">
<li>å®‰è£…bzImageä¸º /boot/vmlinuz-VERSION-RELEASE</li>
<li>ç”Ÿæˆinitramfsæ–‡ä»¶</li>
<li>ç¼–è¾‘grubçš„é…ç½®æ–‡ä»¶</li>
</ul></li>
</ul>

<p>
èŒƒä¾‹ï¼šç¼–è¯‘å†…æ ¸
</p>

<div class="org-src-container">
<pre class="src src-sh">&#33719;&#21462;&#28304;&#20195;&#30721;
tar xf linux-
<span style="color: #483d8b;">cd</span> /usr/src
ln -sv linux-3.10.67 linux  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#35793;&#39537;&#21160;&#26102;&#36890;&#24120;&#20250;&#25214;linux&#30446;&#24405;&#65292;&#36825;&#37324;&#21019;&#24314;&#20010;&#36719;&#36830;&#25509;</span>
<span style="color: #483d8b;">cd</span> linux
make menuconfig             <span style="color: #b22222;">#</span><span style="color: #b22222;">&#37197;&#32622;&#20869;&#26680;&#36873;&#39033;</span>
make [-j <span style="color: #b22222;">#</span><span style="color: #b22222;">]                 #&#32534;&#35793;&#20869;&#26680;&#65292;&#21487;&#20351;&#29992;-j&#25351;&#23450;&#32534;&#35793;&#32447;&#31243;&#25968;&#25454;&#27969;</span>
make modules_install        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#20869;&#26680;&#27169;&#22359;</span>
make install                <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#20869;&#26680;</span>
&#37325;&#21551;&#31995;&#32479;&#65292;&#36873;&#25321;&#20351;&#29992;&#26032;&#20869;&#26680;&#65307;
</pre>
</div>

<p>
<b>ç¼–è¯‘å®‰è£…å†…æ ¸å®æˆ˜æ¡ˆä¾‹</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#23433;&#35013;&#20381;&#36182;</span>
[root@centos8 ~]#yum -y install gcc make ncurses-devel flex bison openssl-devel elfutils-libelf-devel
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#36733;&#20869;&#26680;</span>
[root@centos8 ~]#tar xf linux-5.6.12.tar.xz -C /usr/local/src
[root@centos8 ~]#cd /usr/local/src
[root@centos8 ~]#ln -sv linux-5.6.12 linux

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#32534;&#35793;</span>
[root@centos8 ~]#cd /usr/src/linux
[root@centos8 linux]#cp /boot/config-$(uname -r)   ./.config
[root@centos8 linux]#vim .config 
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#19979;&#38754;&#20004;&#34892;&#65292;CentOS7&#26080;&#38656;&#20462;&#25913;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">CONFIG_MODULE_SIG is not set</span>
<span style="color: #a0522d;">CONFIG_SYSTEM_TRUSTED_KEYS</span>=<span style="color: #8b2252;">""</span>

[root@centos8 linux]#make help
[root@centos8 linux]#make menuconfig  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22823;&#31383;&#21475;&#25165;&#33021;&#26174;&#31034;</span>
[root@centos8 linux]#time make -j $(nproc)  <span style="color: #b22222;"># </span><span style="color: #b22222;">nproc &#33719;&#21462;CPU&#20010;&#25968;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25110;&#32773;&#20004;&#27493;&#23454;&#29616;&#65306;make -j 2 bzImage ; make -j 2 modules</span>
......
 LD [M] sound/xen/snd_xen_front.ko
 LD [M] virt/lib/irqbypass.ko

real 82m52.128s
user 133m37.982s
sys 25m46.311s
[root@centos8 linux]#pwd
/usr/local/src/linux
[root@centos8 linux]#du -sh .
15G .
[root@centos8 linux]#make modules_install
[root@centos8 linux]#ls /lib/modules
4.18.0-147.el8.x86_64  5.6.12-cuilinux-6.6.6
[root@centos8 linux]#du -sh /lib/modules/5.6.12-cuilinux-6.6.6/
3.5G /lib/modules/5.6.12-cuilinux-6.6.6/

[root@centos8 linux]#make install  <span style="color: #b22222;">#  </span><span style="color: #b22222;">&#20250;&#33258;&#21160;&#20462;&#25913;grub&#20449;&#24687;</span>
[root@centos8 linux]#ls /boot
System.map-4.18.0-147.el8.x86_64
System.map-5.6.12-cuilinux-6.6.6
vmlinuz-5.6.12-cuilinux-6.6.6

[root@centos8 ~]#ls /boot/loader/entries/ 
5b85fc7444b240a992c42ce2a9f65db5-0-rescue.conf
5b85fc7444b240a992c42ce2a9f65db5-5.6.12-cuilinux-6.6.6.conf
[root@centos8 ~]#cat /boot/loader/entries/5b85fc7444b240a992c42ce2a9f65db5-5.6.12-cuilinux-6.6.6.conf 
title CentOS Linux (5.6.12-cuilinux-6.6.6) 8 (Core)
version 5.6.12-cuilinux-6.6.6
linux /vmlinuz-5.6.12-cuilinux-6.6.6
initrd /initramfs-5.6.12-cuilinux-6.6.6.img $<span style="color: #a0522d;">tuned_initrd</span>
options $<span style="color: #a0522d;">kernelopts</span> $<span style="color: #a0522d;">tuned_params</span>
id centos-20200513060531-5.6.12-cuilinux-6.6.6
grub_users $<span style="color: #a0522d;">grub_users</span>
grub_arg --unrestricted
grub_class kernel

[root@centos8 ~]#reboot 
[root@centos8 ~]#uname -r
5.6.12-cuilinux-6.6.6
</pre>
</div>


<figure id="orga86f8af">
<img src="images/image-20210120113001460.png" alt="image-20210120113001460.png" width="60%">

<figcaption><span class="figure-number">Figure 3: </span>image-20210120113001460</figcaption>
</figure>

<p>
centos7ç¼–è¯‘æŠ¥é”™
</p>

<div class="org-src-container">
<pre class="src src-sh">cc1: error: -Werror=date-time: no option -Wdate-time
<span style="color: #b22222;"># </span><span style="color: #b22222;">4.9&#20197;&#21450;&#20043;&#21518;&#30340;gcc&#29256;&#26412;&#20013;&#25165;&#26377;&#36825;&#20004;&#20010;&#36873;&#39033;&#65292;&#22914;&#26524;&#20320;&#22312;gcc&#29256;&#26412;&#23567;&#20110;4.9&#30340;&#31995;&#32479;&#19978;&#32534;&#35793;&#65292;&#27604;&#22914;&#22312;centos7.2&#31995;&#32479;&#20013;&#65292;centos&#20013;&#40664;&#35748;&#30340;gcc&#29256;&#26412;&#26159;4.8.5&#65292;&#32534;&#35793;&#26102;&#23601;&#20250;&#25253;"cc1: &#38169;&#35823;&#65306;-Werror=date-time&#65306;&#27809;&#26377;&#36873;&#39033; -Wdate-time"&#38169;&#35823;&#65292;&#25152;&#20197;&#36825;&#31181;&#35299;&#20915;&#26041;&#27861;&#22914;&#26524;&#21482;&#26159;&#20351;&#29992;4.9&#20197;&#19978;&#30340;gcc&#29256;&#26412;&#26159;&#27809;&#26377;&#38382;&#39064;&#30340;&#65307;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26041;&#27861;1 &#21319;&#32423;gcc 4.9</span>
yum install bzip2 -y
wget -P /usr/src https://mirrors.aliyun.com/gnu/gcc/gcc-10.2.0/gcc-10.2.0.tar.gz
<span style="color: #483d8b;">cd</span> /usr/src &amp;&amp; tar -xzvf gcc-10.2.0.tar.gz
<span style="color: #483d8b;">cd</span> gcc-10.2.0/ &amp;&amp; ./contrib/download_prerequisites <span style="color: #b22222;"># </span><span style="color: #b22222;">&#37197;&#32622;&#20381;&#36182;&#39033;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#19968;&#27493;&#21487;&#33021;&#22269;&#20869;&#20250;&#31561;&#24453;&#27604;&#36739;&#20037;&#65292;&#32784;&#24515;&#31561;&#24453;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#25253;&#38169;&#20854;&#20182;&#25991;&#20214;&#19981;&#33021;&#19979;&#36733;&#65292;&#21435;https://gcc.gnu.org/pub/gcc/infrastructure/&#19979;&#36733;&#23545;&#24212;&#25991;&#20214;&#65292;&#22797;&#21046;&#21040;/usr/src/gcc-10.2.0&#21363;&#21487;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;&#23433;&#35013;&#25991;&#20214;&#22841;&#21644;&#32534;&#35793;&#25991;&#20214;&#22841;</span>
mkdir /usr/lib/gcc/x86_64-redhat-linux/10.2.0
mkdir /usr/src/gcc-build-10.2.0

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#37197;&#32622;&#23433;&#35013;&#25991;&#20214;</span>
<span style="color: #483d8b;">cd</span> /usr/src/gcc-10.2.0
./configure --prefix=/usr/lib/gcc/x86_64-redhat-linux/10.2.0/ --enable-checking=release --enable-languages=c,c++ --disable-multilib

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32534;&#35793;&#24182;&#23433;&#35013;(&#32534;&#35793;&#38656;&#35201;2-3&#23567;&#26102;&#65292;&#35831;&#32784;&#24515;&#31561;&#24453;)</span>
<span style="color: #483d8b;">time</span> make -j $(nproc) &amp;&amp; make install

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22791;&#20221;&#21407;gcc&#24182;&#38142;&#25509;&#26032;gcc</span>
mv /usr/bin/gcc /usr/bin/gcc-4.8.5
mv /usr/bin/g++ /usr/bin/g++-4.8.5
alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8.5 88 --slave /usr/bin/g++ g++ /usr/bin/g++-4.8.5
alternatives --install /usr/bin/gcc gcc /usr/lib/gcc/x86_64-redhat-linux/10.2.0/bin/x86_64-pc-linux-gnu-gcc 99 --slave /usr/bin/g++ g++ /usr/lib/gcc/x86_64-redhat-linux/10.2.0/bin/x86_64-pc-linux-gnu-g++
alternatives --config gcc

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#35810;&#29256;&#26412;</span>
gcc -v
g++ -v

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#20986;&#29616;&#38169;&#35823;</span>
/lib64/libstdc++.so.6: version <span style="color: #ff00ff;">`GLIBCXX_3.4.21' not found</span>
<span style="color: #ff00ff;">/lib64/libstdc++.so.6: version `</span>GLIBCXX_3.4.22<span style="color: #8b2252;">' not found</span>
<span style="color: #8b2252;">#&#25191;&#34892;&#38142;&#25509;&#26032;&#30340;libstdc++.so.6&#24211;&#25991;&#20214;</span>
<span style="color: #8b2252;">rm -f /usr/lib64/libstdc++.so.6</span>
<span style="color: #8b2252;">ln -s /usr/lib/gcc/x86_64-redhat-linux/10.2.0/lib64/libstdc++.so.6 /usr/lib64/libstdc++.so.6</span>
<span style="color: #8b2252;">#&#21487;&#20197;&#29992;&#20197;&#19979;&#25351;&#20196;&#26597;&#30475;&#30446;&#21069;&#21253;&#21547;&#21738;&#20123;&#24211;</span>
<span style="color: #8b2252;">strings /usr/lib64/libstdc++.so.6 | grep GLIBC</span>
</pre>
</div>

<p>
<b>å†…æ ¸ç¼–è¯‘è¯´æ˜</b>
</p>

<p>
1.é…ç½®å†…æ ¸é€‰é¡¹ 
</p>

<p>
æ”¯æŒâ€œæ›´æ–°â€æ¨¡å¼è¿›è¡Œé…ç½®ï¼šmake help 
</p>

<p>
a) make configï¼šåŸºäºå‘½ä»¤è¡Œä»¥éå†çš„æ–¹å¼é…ç½®å†…æ ¸ä¸­å¯é…ç½®çš„æ¯ä¸ªé€‰é¡¹ 
b) make menuconfigï¼šåŸºäºcursesçš„æ–‡æœ¬çª—å£ç•Œé¢ 
c) make gconfigï¼šåŸºäºGTK \(GNOMEï¼‰ç¯å¢ƒçª—å£ç•Œé¢ 
d) make xconfigï¼šåŸºäºQT\(KDE\)ç¯å¢ƒçš„çª—å£ç•Œé¢ 
</p>

<p>
æ”¯æŒâ€œå…¨æ–°é…ç½®â€æ¨¡å¼è¿›è¡Œé…ç½® 
a) make defconfigï¼šåŸºäºå†…æ ¸ä¸ºç›®æ ‡å¹³å°æä¾›çš„â€œé»˜è®¤â€é…ç½®è¿›è¡Œé…ç½® 
b) make allyesconfig: æ‰€æœ‰é€‰é¡¹å‡å›ç­”ä¸ºâ€œyesâ€œ 
c) make allnoconfig: æ‰€æœ‰é€‰é¡¹å‡å›ç­”ä¸ºâ€œnoâ€œ
</p>


<p>
2.ç¼–è¯‘å†…æ ¸
</p>

<ul class="org-ul">
<li>å…¨ç¼–è¯‘:</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">make [-j <span style="color: #b22222;">#</span><span style="color: #b22222;">]</span>
</pre>
</div>

<ul class="org-ul">
<li>ç¼–è¯‘å†…æ ¸çš„ä¸€éƒ¨åˆ†åŠŸèƒ½ï¼š</li>
</ul>

<p>
(a) åªç¼–è¯‘æŸå­ç›®å½•ä¸­çš„ç›¸å…³ä»£ç 
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">cd</span> /usr/src/linux; make dir/
</pre>
</div>

<p>
(b) åªç¼–è¯‘ä¸€ä¸ªç‰¹å®šçš„æ¨¡å—
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">cd</span> /usr/src/linux; make dir/file.ko
</pre>
</div>

<p>
èŒƒä¾‹ï¼šåªä¸ºe1000ç¼–è¯‘é©±åŠ¨ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">make drivers/net/ethernet/intel/e1000/e1000.ko
</pre>
</div>

<p>
3 äº¤å‰ç¼–è¯‘å†…æ ¸
</p>

<p>
ç¼–è¯‘çš„ç›®æ ‡å¹³å°ä¸å½“å‰å¹³å°ä¸ç›¸åŒ make ARCH=arch_name
</p>

<p>
è¦è·å–ç‰¹å®šç›®æ ‡å¹³å°çš„ä½¿ç”¨å¸®åŠ© make ARCH=arch_name help
</p>

<p>
ç¤ºä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">make <span style="color: #a0522d;">ARCH</span>=arm help
</pre>
</div>

<p>
4 é‡æ–°ç¼–è¯‘éœ€è¦äº‹å…ˆæ¸…ç†æ“ä½œ
</p>

<div class="org-src-container">
<pre class="src src-sh">make clean&#65306;&#28165;&#29702;&#22823;&#22810;&#25968;&#32534;&#35793;&#29983;&#25104;&#30340;&#25991;&#20214;&#65292;&#20294;&#20250;&#20445;&#30041;.config&#25991;&#20214;&#31561;
make mrproper: &#28165;&#29702;&#25152;&#26377;&#32534;&#35793;&#29983;&#25104;&#30340;&#25991;&#20214;&#12289;config&#21450;&#26576;&#20123;&#22791;&#20221;&#25991;&#20214;
make distclean&#65306;&#21253;&#21547; make mrproper,&#24182;&#28165;&#29702;patches&#20197;&#21450;&#32534;&#36753;&#22120;&#22791;&#20221;&#25991;&#20214;
</pre>
</div>

<p>
<b>å¸è½½å†…æ ¸</b>
</p>

<ul class="org-ul">
<li>åˆ é™¤/usr/src/linux/ç›®å½•ä¸‹ä¸éœ€è¦çš„å†…æ ¸æºç </li>
<li>åˆ é™¤/lib/modules/ç›®å½•ä¸‹ä¸éœ€è¦çš„å†…æ ¸åº“æ–‡ä»¶</li>
<li>åˆ é™¤/bootç›®å½•ä¸‹å¯åŠ¨çš„å†…æ ¸å’Œå†…æ ¸æ˜ åƒæ–‡ä»¶</li>
<li>æ›´æ”¹grubçš„é…ç½®æ–‡ä»¶ï¼Œåˆ é™¤ä¸éœ€è¦çš„å†…æ ¸å¯åŠ¨åˆ—è¡¨ grub2-mkconfig -o
/boot/grub2/grub.cfg</li>
<li>CentOS 8 è¿˜éœ€è¦åˆ é™¤
/boot/loader/entries/5b85fc7444b240a992c42ce2a9f65db5-æ–°å†…æ ¸ç‰ˆ æœ¬.conf</li>
</ul>
</div>
</div>
</section>
<section id="outline-container-h:332c7b43-6385-41d2-9f54-965a542e9c76" class="outline-2">
<h2 id="h:332c7b43-6385-41d2-9f54-965a542e9c76">Busybox</h2>
<div class="outline-text-2" id="text-h:332c7b43-6385-41d2-9f54-965a542e9c76">
</div>
<div id="outline-container-h:a1d005de-1031-4f4c-afcd-6d4da7b3f72a" class="outline-3">
<h3 id="h:a1d005de-1031-4f4c-afcd-6d4da7b3f72a">Busyboxä»‹ç»</h3>
<div class="outline-text-3" id="text-h:a1d005de-1031-4f4c-afcd-6d4da7b3f72a">
<p>
Busybox æœ€åˆæ˜¯ç”± Bruce Perens åœ¨ 1996 å¹´ä¸º Debian GNU/Linuxå®‰è£…ç›˜ç¼–å†™
çš„ã€‚å…¶ç›®æ ‡æ˜¯åœ¨ä¸€å¼ è½¯ç›˜(å­˜å‚¨ç©ºé—´åªæœ‰1MBå¤š)ä¸Šåˆ›å»ºä¸€ä¸ªGNU/Linuxç³»ç»Ÿï¼Œå¯ä»¥
ç”¨ä½œå®‰è£…ç›˜å’Œæ€¥æ•‘ç›˜
</p>

<p>
Busybox æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œéµå¾ªGPL v2åè®®ã€‚Busyboxå°†ä¼—å¤šçš„UNIXå‘½ä»¤é›†åˆè¿›
ä¸€ä¸ªå¾ˆå°çš„å¯æ‰§è¡Œç¨‹åºä¸­ï¼Œå¯ä»¥ç”¨æ¥æ›¿ä»£GNU fileutilsã€shellutilsç­‰å·¥å…·é›†ã€‚
Busyboxä¸­å„ç§å‘½ä»¤ä¸ç›¸åº”çš„GNUå·¥å…·ç›¸æ¯”ï¼Œæ‰€èƒ½æä¾›çš„é€‰é¡¹æ¯”è¾ƒå°‘ï¼Œä½†æ˜¯ä¹Ÿè¶³å¤Ÿ
ä¸€èˆ¬çš„åº”ç”¨äº†ã€‚Busyboxä¸»è¦ç”¨äºåµŒå…¥å¼ç³»ç»Ÿ
</p>

<p>
Busybox æ˜¯ä¸€ä¸ªé›†æˆäº†ä¸‰ç™¾å¤šä¸ªæœ€å¸¸ç”¨Linuxå‘½ä»¤å’Œå·¥å…·çš„è½¯ä»¶ã€‚BusyBoxåŒ…å«äº†
ä¸€äº›ç®€å•çš„å·¥å…·ï¼Œä¾‹å¦‚lsã€catå’Œechoç­‰ç­‰ï¼Œè¿˜åŒ…å«äº†ä¸€äº›æ›´å¤§ã€æ›´å¤æ‚çš„å·¥å…·ï¼Œ
ä¾‹grepã€findã€mountä»¥åŠtelnetã€‚æœ‰äº›äººå°†BusyBox ç§°ä¸º Linuxå·¥å…·é‡Œçš„ç‘å£«
å†›åˆ€ã€‚ç®€å•çš„è¯´BusyBoxå°±å¥½åƒæ˜¯ä¸ªå¤§å·¥å…·ç®±ï¼Œå®ƒé›†æˆå‹ç¼©äº†Linuxçš„è®¸å¤šå·¥å…·å’Œ
å‘½ä»¤ï¼Œä¹ŸåŒ…å«äº† Android ç³»ç»Ÿçš„è‡ªå¸¦çš„shell
</p>

<p>
å®šåˆ¶å°å‹çš„Linuxæ“ä½œç³»ç»Ÿï¼šlinuxå†…æ ¸+busybox
</p>

<p>
å®˜æ–¹ç½‘ç«™ï¼š<a href="https://busybox.net/">https://busybox.net/</a>
</p>
</div>
</div>
<div id="outline-container-h:ca4d2c03-5a53-4e61-b59e-1ed6b628baec" class="outline-3">
<h3 id="h:ca4d2c03-5a53-4e61-b59e-1ed6b628baec">Busyboxä½¿ç”¨</h3>
<div class="outline-text-3" id="text-h:ca4d2c03-5a53-4e61-b59e-1ed6b628baec">
<p>
busybox çš„ç¼–è¯‘è¿‡ç¨‹ä¸Linuxå†…æ ¸çš„ç¼–è¯‘ç±»ä¼¼
</p>

<p>
busyboxçš„ä½¿ç”¨æœ‰ä¸‰ç§æ–¹å¼ï¼š
</p>

<ul class="org-ul">
<li>busyboxåç›´æ¥è·Ÿå‘½ä»¤ï¼Œå¦‚ busybox ls</li>
<li>ç›´æ¥å°†busyboxé‡å‘½åï¼Œå¦‚ cp busybox tar</li>
<li>åˆ›å»ºç¬¦å·é“¾æ¥ï¼Œå¦‚ ln -s busybox rm</li>
</ul>

<p>
busyboxçš„å®‰è£…
</p>

<p>
ä»¥ä¸Šæ–¹æ³•ä¸­ï¼Œç¬¬ä¸‰ç§æ–¹æ³•æœ€æ–¹ä¾¿ï¼Œä½†ä¸ºbusyboxä¸­æ¯ä¸ªå‘½ä»¤éƒ½åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ï¼Œ
ç›¸å½“è´¹äº‹ï¼Œbusyboxæä¾›è‡ªåŠ¨æ–¹æ³•ï¼šbusyboxç¼–è¯‘æˆåŠŸåï¼Œæ‰§è¡Œmake install,åˆ™
ä¼šäº§ç”Ÿä¸€ä¸ª_installç›®å½•ï¼Œå…¶ä¸­åŒ…å«äº†busyboxåŠæ¯ä¸ªå‘½ä»¤çš„è½¯é“¾æ¥
</p>

<p>
ç¼–è¯‘Busybox
</p>
</div>
</div>
<div id="outline-container-h:80f0d7a7-d098-4aee-9bd1-448f8e6068fe" class="outline-3">
<h3 id="h:80f0d7a7-d098-4aee-9bd1-448f8e6068fe">busyboxç¼–è¯‘å®‰è£…</h3>
<div class="outline-text-3" id="text-h:80f0d7a7-d098-4aee-9bd1-448f8e6068fe">
<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]#yum -y install   gcc gcc-c++ glibc glibc-devel make pcre pcredevel openssl openssl-devel systemd-devel zlib-devel glibc-static ncurses-devel

[root@centos7 ~]#wget https://busybox.net/downloads/busybox-1.31.1.tar.bz2

[root@centos7 ~]#tar xvf busybox-1.31.1.tar.bz2 
[root@centos7 ~]#cd busybox-1.31.1/
[root@centos7 busybox-1.31.1]#make menuconfig 
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25353;&#19979;&#38754;&#36873;&#25321;&#65292;&#25226;busybox&#32534;&#35793;&#20063;&#38745;&#24577;&#20108;&#36827;&#21046;&#12289;&#19981;&#29992;&#20849;&#20139;&#24211;:Settings --&gt;Build Options --&gt;[*] Build static binary (no shared libs)</span>

[root@centos7 busybox-1.31.1]#make 
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#20986;&#38169;&#65292;&#25191;&#34892;make clean&#21518;&#65292;&#37325;&#26032;&#25191;&#34892;&#19978;&#38754;&#21629;&#20196;</span>
[root@centos7 busybox-1.31.1]#ls 
[root@centos7 busybox-1.31.1]#make install 
[root@centos7 busybox-1.31.1]#pwd
/root/busybox-1.31.1
[root@Centos7 busybox-1.31.1]#ls
applets                 debianutils  loginutils              qemu_multiarch_testing
applets_sh              docs         mailutils               README
arch                    e2fsprogs    Makefile                runit
archival                editors      Makefile.custom         scripts
AUTHORS                 examples     Makefile.flags          selinux
busybox                 findutils    Makefile.help           shell
busybox.links           include      make_single_applets.sh  size_single_applets.sh
busybox_unstripped      init         miscutils               sysklogd
busybox_unstripped.map  _install     modutils                testsuite
busybox_unstripped.out  INSTALL      networking              TODO
Config.in               klibc-utils  NOFORK_NOEXEC.lst       TODO_unicode
configs                 libbb        NOFORK_NOEXEC.sh        util-linux
console-tools           libpwdgrp    printutils
coreutils               LICENSE      procps
[root@Centos7 busybox-1.31.1]#ll busybox -h
-rwxr-xr-x 1 root root 2.6M May 14 09:35 busybox

[root@Centos7 busybox-1.31.1]#ls _install/
bin  linuxrc  sbin  usr
[root@Centos7 busybox-1.31.1]#ls _install/bin
arch     cttyhack       fdflush   kbd_mode  mknod       ping           run-parts     tar
ash      date           fgrep     kill      mktemp      ping6          scriptreplay  touch
base64   dd             fsync     link      more        pipe_progress  sed           true
busybox  df             getopt    linux32   mount       printenv       setarch       umount
cat      dmesg          grep      linux64   mountpoint  ps             setpriv       uname
chattr   dnsdomainname  gunzip    ln        mpstat      pwd            setserial     usleep
chgrp    dumpkmap       gzip      login     mt          reformime      sh            vi
chmod    echo           hostname  ls        mv          resume         sleep         watch
chown    ed             hush      lsattr    netstat     rev            stat          zcat
conspy   egrep          ionice    lzop      nice        rm             stty
cp       false          iostat    makemime  nuke        rmdir          su
cpio     fatattr        ipcalc    mkdir     pidof       rpm            sync

[root@Centos7 busybox-1.31.1]#find _install/ -type l |wc -l
396
[root@Centos7 busybox-1.31.1]#du -sh _install/
2.6M    _install/

[root@Centos7 busybox-1.31.1]#mkdir /mnt/sysroot/
[root@Centos7 busybox-1.31.1]#cp -a _install/* /mnt/sysroot/
</pre>
</div>



<figure id="org1061a2a">
<img src="./images/img_20241001_204253.png" alt="img_20241001_204253.png" width="90%">

</figure>
</div>
</div>
</section>
<section id="outline-container-h:b31b2d22-3823-4f22-8e68-9cfbf9c37a31" class="outline-2">
<h2 id="h:b31b2d22-3823-4f22-8e68-9cfbf9c37a31">è‡ªåˆ¶linuxç³»ç»Ÿ</h2>
<div class="outline-text-2" id="text-h:b31b2d22-3823-4f22-8e68-9cfbf9c37a31">
</div>
<div id="outline-container-orgbd1772c" class="outline-3">
<h3 id="orgbd1772c">Centos6è‡ªåˆ¶linuxç³»ç»Ÿ</h3>
<div class="outline-text-3" id="text-orgbd1772c">
<p>
<b>1 åˆ†åŒºå¹¶åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20998;&#20004;&#20010;&#24517;&#35201;&#30340;&#20998;&#21306;,/dev/sdb1&#23545;&#24212;/boot   /dev/sdb2&#23545;&#24212;&#26681; /</span>
[root@centos6 ~]#echo -e <span style="color: #8b2252;">'n\np\n1\n\n+1G\nw\n'</span> | fdisk /dev/sdb
[root@centos6 ~]#echo -e <span style="color: #8b2252;">'n\np\n2\n\n\n\nw\n'</span> | fdisk /dev/sdb
[root@centos6 ~]#mkfs.ext4 /dev/sdb1
[root@centos6 ~]#mkfs.ext4 /dev/sdb2
</pre>
</div>

<p>
<b>2 æŒ‚è½½boot</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23376;&#30446;&#24405;&#24517;&#39035;&#20026;boot</span>
[root@centos6 ~]#mkdir /mnt/boot
[root@centos6 ~]#mount /dev/sdb1 /mnt/boot
</pre>
</div>

<p>
<b>3 å®‰è£…grub</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#grub-install --root-directory=/mnt/ /dev/sdb
</pre>
</div>

<p>
<b>4 å‡†å¤‡å†…æ ¸å’Œinitramfsæ–‡ä»¶</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#cp /boot/vmlinuz-2.6.32-754.el6.x86_64 /mnt/boot/vmlinuz
[root@centos6 ~]#cp /boot/initramfs-2.6.32-754.el6.x86_64.img /mnt/boot/initramfs.img
</pre>
</div>

<p>
<b>5 å»ºç«‹grub.conf</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#cat /mnt/boot/grub/grub.conf
<span style="color: #a0522d;">default</span>=0
<span style="color: #a0522d;">timeout</span>=5
title cui linux 
<span style="color: #0000ff;">root</span> (hd0,0)
kernel /vmlinuz <span style="color: #a0522d;">root</span>=/dev/sda2 <span style="color: #a0522d;">selinux</span>=0 <span style="color: #a0522d;">init</span>=/bin/bash
initrd /initramfs.img

<span style="color: #b22222;"># </span><span style="color: #b22222;">root=/dev/sda2 &#23545;&#20110;&#35201;&#21551;&#21160;&#30340;&#31995;&#32479;&#32780;&#35328;</span>
[root@centos6 ~]#tree /mnt/boot
/mnt/boot
&#9500;&#9472;&#9472; grub
&#9474;   &#9500;&#9472;&#9472; device.map
&#9474;   &#9500;&#9472;&#9472; e2fs_stage1_5
&#9474;   &#9500;&#9472;&#9472; fat_stage1_5
&#9474;   &#9500;&#9472;&#9472; ffs_stage1_5
&#9474;   &#9500;&#9472;&#9472; grub.conf
&#9474;   &#9500;&#9472;&#9472; iso9660_stage1_5
&#9474;   &#9500;&#9472;&#9472; jfs_stage1_5
&#9474;   &#9500;&#9472;&#9472; minix_stage1_5
&#9474;   &#9500;&#9472;&#9472; reiserfs_stage1_5
&#9474;   &#9500;&#9472;&#9472; stage1
&#9474;   &#9500;&#9472;&#9472; stage2
&#9474;   &#9500;&#9472;&#9472; ufs2_stage1_5
&#9474;   &#9500;&#9472;&#9472; vstafs_stage1_5
&#9474;   &#9492;&#9472;&#9472; xfs_stage1_5
&#9500;&#9472;&#9472; initramfs-2.6.32-754.el6.x86_64.img
&#9500;&#9472;&#9472; lost+found
&#9492;&#9472;&#9472; vmlinuz.img

2 directories, 16 files
</pre>
</div>

<p>
<b>6 å‡†å¤‡æ ¹ä¸‹é¢ç›¸å…³ç¨‹åºå’Œåº“</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#mkdir /mnt/sysroot
[root@centos6 ~]#mount /dev/sdb2   /mnt/sysroot
[root@centos6 ~]#mkdir &#8211;pv /mnt/sysroot/{boot,dev,sys,proc,etc,lib,lib64,bin,sbin,tmp,var,usr,opt,home,root,mnt,media}
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22797;&#21046;bash&#31561;&#21629;&#20196;&#21644;&#30456;&#20851;&#24211;&#25991;&#20214;&#65292;&#22914;&#65306;</span>
bash,ifconfig,insmod,ping,mount,ls,cat,df,lsblk,blkid,tree,fdisk

[root@centos6 ~]#mkdir /mnt/sysroot/{dev,proc,etc,sys,lib,home,root}
<span style="color: #a020f0;">for</span> i<span style="color: #a020f0;"> in</span> $(ldd /bin/bash | grep -o <span style="color: #8b2252;">'/[^[:space:]]\+[0-9]\&gt;'</span>); <span style="color: #a020f0;">do</span> cp $<span style="color: #a0522d;">i</span> /mnt/sysroot/lib64 ;<span style="color: #a020f0;">done</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;&#32593;&#21345;&#39537;&#21160;</span>
[root@centos6 ~]#ethtool -i eth0
driver: e1000
version: 7.3.21-k8-NAPI
firmware-version: 
bus-info: 0000:02:01.0
supports-statistics: yes
supports-test: yes
supports-eeprom-access: yes
supports-register-dump: yes
supports-priv-flags: no
[root@centos6 ~]#modinfo e1000
filename:/lib/modules/2.6.32-754.el6.x86_64/kernel/drivers/net/e1000/e1000.ko

[root@centos6 ~]#cp /lib/modules/2.6.32-754.el6.x86_64/kernel/drivers/net/e1000/e1000.ko /mnt/sysroot/lib/

[root@centos6 ~]#chroot /mnt/sysroot/
bash-4.1# pwd
/
</pre>
</div>

<p>
<b>7 å‡†å¤‡æ–°çš„è™šæ‹Ÿæœº</b>
</p>

<p>
å°†å‰ä¸€è™šæ‹Ÿæœºsdbç¡¬ç›˜å¯¹åº”çš„vmdkæ–‡ä»¶å¢åŠ è¿›å»ï¼Œåˆ é™¤åŸæœ‰ç£ç›˜ï¼Œå¼€æœºå¯åŠ¨
</p>


<figure id="org29ad53e">
<img src="images/image-20210120112617421.png" alt="image-20210120112617421.png" width="80%">

</figure>



<figure id="org4827ef5">
<img src="./images/img_20241001_204653.png" alt="img_20241001_204653.png" width="80%">

</figure>



<figure id="org9dc8fad">
<img src="./images/img_20241001_204612.png" alt="img_20241001_204612.png" width="80%">

</figure>



<figure id="org6206373">
<img src="images/image-20210120112739319.png" alt="image-20210120112739319.png" width="80%">

</figure>
</div>
</div>
</section>
</main class="container">
<footer id="postamble" class="status">
<footer data-astro-cid-sz7xmlte data-turbo-permanent id=rootFooter>
    <script>
        const shuffle = e => e.map((e => ({
            v: e,
            sort: Math.random()
        }))).sort(( (e, o) => e.sort - o.sort)).map(( ({v: e}) => e));
        var songList = ["barbie-girl--stantough", "blue-da-ba-dee--cornelius-link", "hips-dont-lie--stantough", "i-want-it-that-way--stantough", "seven-nation-army--stantough", "smooth-criminal--stantough"]
          , songOrder = songOrder ?? shuffle(songList).map((e => `/audio/music/${e}.opus`))
          , song = new Audio(songOrder[0])
          , nextSong = new Audio(songOrder[1])
          , songIndex = 2
          , musicWrapper = void 0
          , arrow = void 0
          , notes = void 0;
        song.addEventListener("ended", next);
        const toggle = () => song.paused ? play() : pause();
        function play() {
            song.play(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.add("shakeManHorse"),
            notes.classList.remove("hideNotes")
        }
        function pause() {
            song.pause(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.remove("shakeManHorse"),
            notes.classList.add("hideNotes")
        }
        function next() {
            song = nextSong,
            play(),
            songIndex === songOrder.length && (songIndex = 0),
            nextSong = new Audio(songOrder[songIndex]),
            songIndex += 1
        }
        function skip() {
            pause(),
            (arrow = arrow || document.getElementById("musicArrow")).classList.add("shootArrow");
            new Audio("/audio/effects/ohno.m4a").play(),
            arrow.addEventListener("animationend", arrowShootHandler, !1)
        }
        function arrowShootHandler() {
            arrow.removeEventListener("animationend", arrowShootHandler, !1),
            arrow.classList.remove("shootArrow");
            new Audio("/audio/effects/heythathurt.m4a").play(),
            next()
        }
    </script>
    <div id=musicPlayer data-astro-cid-q7a5pyro>
        <button class=skip data-astro-cid-q7a5pyro onclick=skip() title="Skip song">
            <div id=skipWrapper data-astro-cid-q7a5pyro>
                <img alt="Medieval drollery of a man/snail/bat/monkey shooting an arrow" class=archer decoding=async height=334 loading=lazy src=/images/archer-no-arrow.448ccd8b_Z1KfRYq.webp width=226 data-astro-cid-q7a5pyro>
                <img alt="Arrow for archer" class="arrow complete" decoding=async height=23 loading=lazy src=/images/no-archer-full-arrow.87aa9971_Z2qL2KO.webp width=141 data-astro-cid-q7a5pyro id=musicArrow>
            </div>
        </button>
        <button class=playPause data-astro-cid-q7a5pyro onclick=toggle() title="Play/pause song">
            <div id=musicWrapper data-astro-cid-q7a5pyro>
                <div class=hideNotes id=notesWrapper data-astro-cid-q7a5pyro>
                    <div class=lyreNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                    <div class=fluteNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                </div>
                <img alt="Medieval drollery of a man/horse playing a lyre and a horn" class=manHorse decoding=async height=665 loading=lazy src=/images/man-horse-band.e3a2efcf_q8FCa.webp width=531 data-astro-cid-q7a5pyro>
            </div>
        </button>
    </div>
    <hr data-astro-cid-sz7xmlte>
    <div class=salutation data-astro-cid-gdmrbrho>
        <p data-astro-cid-gdmrbrho>
            <span class=flower2 data-astro-cid-gdmrbrho>A</span>
            <span class=smallcap data-astro-cid-gdmrbrho>pax vobiscum</span>
            <span class="flower2 wiggle" data-astro-cid-gdmrbrho id=leaf>a</span>
        </p>
    </div>
    <script>
        function animateLeafBlownHandler() {
            leaf.removeEventListener("animationend", animateLeafBlownHandler, !1),
            leaf.classList.remove("blownAway"),
            leaf.classList.add("wiggle")
        }
        function animateLeaf() {
            leaf = leaf ?? document.getElementById("leaf"),
            leaf.classList.remove("wiggle"),
            leaf.classList.add("blownAway"),
            leaf.addEventListener("animationend", animateLeafBlownHandler, !1)
        }
        document.getElementById("leaf").onclick = animateLeaf
    </script>


    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>æ‰“èµ</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Â© 2024 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
</footer>
</footer>
</body>
</html>
