<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linux: Linux From Scratch</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/font.css"/>
<link rel="stylesheet" type="text/css" href="/static/drollery.e825b870.css"/>
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
</head>
<body>
<header id="preamble" class="status">
<header class="{className}" data-astro-cid-3ef6ksr2>
  <div class=header-branding data-astro-cid-g2lrb5xm>
      <span class=header-text data-astro-cid-g2lrb5xm>
          <span class=dropcap data-astro-cid-g2lrb5xm aria-hidden=true>
              <span class=actual data-astro-cid-g2lrb5xm>J</span>
              <span class=rest data-astro-cid-g2lrb5xm>asper Hsu</span>
              <span class=period data-astro-cid-g2lrb5xm>.</span>
          </span>
          <span class=sr-only data-astro-cid-g2lrb5xm>Drollery</span>
      </span>
      <img alt="Medieval drollery of a knight on a horse" class=spring decoding=async height=250 loading=lazy src=/images/knight-horse.a96eee7d_Z1WCOYs.webp width=68 data-astro-cid-g2lrb5xm>
  </div>

  <nav data-astro-cid-pux6a34n>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/jcodelog.html class=nobracket data-astro-cid-pux6a34n>技术</a>
      <span class=flower2 data-astro-cid-pux6a34n>K</span>
      <a href=/reading/index.html class=nobracket data-astro-cid-pux6a34n>阅读</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
      <a href=/archives.html class=nobracket data-astro-cid-pux6a34n>归档</a>
      <span class=flower2 data-astro-cid-pux6a34n>L</span>
      <a href=/link/index.html class=nobracket data-astro-cid-pux6a34n>友链</a>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/about.html class=nobracket data-astro-cid-pux6a34n>关于</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
  </nav>


  <div class="container" data-astro-cid-3ef6ksr2>
    <p class="info" data-astro-cid-3ef6ksr2>
              🏆 欢迎来到本站：
              <a href="https://xuchangwei.com/">https://xuchangwei.com/</a>。
              <strong>希望这里有你感兴趣的内容</strong>。
            </p>
  </div>
  <div id=borderArtWrapper class="tt1" data-astro-cid-5hce7sga data-turbo-permanent>
      <script>
          var man, shakeCount = 0, noSound = new Audio("/audio/effects/no.m4a"), screamSound = new Audio("/audio/effects/scream.m4a");
          function animateManShakeHandler() {
              man.removeEventListener("animationend", animateManShakeHandler, !1),
              shakeCount += 1,
              man.classList.remove("shakeMan")
          }
          function animateManFallHandler() {
              man.removeEventListener("animationend", animateManFallHandler, !1),
              man.classList.add("hide")
          }
          function animateMan() {
              man = man ?? document.getElementById("borderMan"),
              3 === shakeCount ? (man.classList.add("fallMan"),
              screamSound.play(),
              man.addEventListener("animationend", animateManFallHandler, !1)) : (man.classList.add("shakeMan"),
              noSound.play(),
              man.addEventListener("animationend", animateManShakeHandler, !1))
          }
      </script>
      <div class=borderArt data-astro-cid-5dda5nwp id=articleBorder>
          <img alt="flowery border with man falling" decoding=async height=620 loading=lazy src=/images/border-vines-no-man.b7d246cc_DRxSe.webp width=909 class=border data-astro-cid-5dda5nwp>
          <div class=fallWrapper data-astro-cid-5dda5nwp>
              <img alt="flowery border with man falling" decoding=async height=292 loading=lazy src=/images/man-no-vines.247a3187_Z2ioXNM.webp width=98 class=man data-astro-cid-5dda5nwp id=borderMan onclick=animateMan()>
          </div>
      </div>
  </div>
</header>
</header>
<main class="container" id="content" class="content">
<header>
<h1 class="title">Linux: Linux From Scratch</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:20294f5b-9312-4c4c-a592-0bd2d225a6ac">前言</a></li>
<li><a href="#h:f7f17d6f-0bd6-4936-a141-ff03869bd3b3">概述</a>
<ul>
<li><a href="#h:d8e7c50e-44a2-4f3f-aee2-117fb94228ec">概述</a></li>
</ul>
</li>
<li><a href="#h:7d439272-49de-4d0a-95a5-d4b9ee7d7d91">准备</a>
<ul>
<li><a href="#h:7071c200-3565-4fda-b9aa-e7b688f014e1">准备宿主系统</a></li>
<li><a href="#h:f2ee1ad7-c977-4d5b-a158-d28732b6076b">软件包和补丁</a></li>
<li><a href="#h:5358eb06-aad1-4a52-8004-3915d76d8f28">最后准备工作</a></li>
</ul>
</li>
<li><a href="#h:3d7ba030-be4f-4d9c-92bf-2ef7bba05ac3">构建 LFS 交叉工具链和临时工具</a>
<ul>
<li><a href="#h:869e7a31-cfa6-43db-9e2d-8a14a77c5434">编译交叉工具链</a>
<ul>
<li><a href="#h:5fade581-5448-473f-bf66-34e5595f7c55">Binutils-2.43.1</a></li>
<li><a href="#h:313f3757-3e8a-43f9-a938-2d8f4718fc30">GCC-14.2.0</a></li>
<li><a href="#h:6f9cd604-5194-42a7-b900-909784aba98c">Linux-6.10.5</a></li>
<li><a href="#h:4ce8c9f3-0347-42e0-85bd-c109dd398001">Glibc-2.40</a></li>
<li><a href="#h:046877b9-4d76-4867-b058-ed74d843f505">Libstdc++ from GCC-14.2.0</a></li>
</ul>
</li>
<li><a href="#h:d37a07f5-2831-4050-9927-c289ca373835">交叉编译临时工具</a>
<ul>
<li><a href="#h:479f654f-a297-4057-a903-42aa0d3c784c">M4-1.4.19</a></li>
<li><a href="#h:5baeff0a-00f9-4365-ad32-d1f59de16145">Ncurses-6.5</a></li>
<li><a href="#h:946ed7c3-2957-4116-95a8-c48a6399b3c2">Bash-5.2.32</a></li>
<li><a href="#h:fbea40a8-9035-4a54-9a65-2db739d7e7e7">Coreutils-9.5</a></li>
<li><a href="#h:b9f7bf47-05c4-43f2-8a4c-46ce24b432b0">Diffutils-3.10</a></li>
<li><a href="#h:8379e04d-9a9b-436c-9a2d-4c75ba4f1e70">File-5.45</a></li>
<li><a href="#h:72a7a1d6-b997-4d4f-9056-bd66d5a778ba">Findutils-4.10.0</a></li>
<li><a href="#h:966caf3e-b63f-44ac-bd02-e830081e4cf8">Gawk-5.3.0</a></li>
<li><a href="#h:f8f9aa46-cdb2-4318-9566-214d731a6cac">Grep-3.11</a></li>
<li><a href="#h:343843c8-4e89-45ef-aef3-adef31974350">Gzip-1.13</a></li>
<li><a href="#h:efbda3b1-774d-493a-912a-b13443414f82">Make-4.4.1</a></li>
<li><a href="#h:2e370f28-e5f7-4a5c-9b6d-d2ca893995d6">Patch-2.7.6</a></li>
<li><a href="#h:c8bffb93-47ca-47c2-9f48-9c1cccb593e1">Sed-4.9</a></li>
<li><a href="#h:263a4c1b-50c6-4af2-a861-7344cafb50fd">Tar-1.35</a></li>
<li><a href="#h:1b4eb74b-8db8-48f4-8214-416449130a3a">Xz-5.6.2</a></li>
<li><a href="#h:831b8a5c-d1ef-4c6c-87ae-535c0783464e">Binutils-2.43.1 - Pass 2</a></li>
<li><a href="#h:9128980e-e36e-49a6-9e78-656813fa0ec9">GCC-14.2.0 - Pass 2</a></li>
</ul>
</li>
<li><a href="#h:c340c4bb-844b-489f-8f4d-52ac5ede37cb">进入 Chroot 并构建其他临时工具</a>
<ul>
<li><a href="#h:9347fd4e-babe-4383-9f20-360d5fdb8e27">改变所有者</a></li>
<li><a href="#h:3bd969cb-bd91-4cd5-8f3e-750ac3f32820">准备虚拟内核文件系统</a></li>
<li><a href="#h:ec350cc3-90b9-4ed3-9d02-e22dba00591d">进入 Chroot 环境</a></li>
<li><a href="#h:2157d65c-cea3-4ed0-9bfa-053dfc72a476">创建目录</a></li>
<li><a href="#h:fc1b840c-de6a-41bc-a63c-4b50ade9f940">创建必要的文件和符号链接</a></li>
<li><a href="#h:3573458b-9f06-4ce8-8d97-05ee5f39cd70">Gettext-0.22.5</a></li>
<li><a href="#h:7e0533d5-fdab-4b83-a261-23d2fe580908">Bison-3.8.2</a></li>
<li><a href="#h:9f7b70c1-49eb-451a-95e2-d3ffac1f78b1">Perl-5.40.0</a></li>
<li><a href="#h:1706a6be-f698-4c96-a077-f2d4378d5524">Python-3.12.5</a></li>
<li><a href="#h:d3bbeaa0-3f1c-4105-aef8-7d922380bf37">Texinfo-7.1</a></li>
<li><a href="#h:c3d4c960-57c8-4ead-9da7-11b57f29ece7">Util-linux-2.40.2</a></li>
<li><a href="#h:b8de7ed6-4f31-4526-ac9a-afbdc25f9e01">清理和备份临时系统</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:b28c2e60-a1d7-4679-8f9a-de74016490fd">构建 LFS 系统</a>
<ul>
<li><a href="#h:bc02fbf3-71ed-4d56-aa3a-7a341c4d0f81">安装基本系统软件</a>
<ul>
<li><a href="#h:7614d3a1-a873-45f7-815c-09ae5e78fedd">移除调试符号</a></li>
<li><a href="#h:c2e65dbe-c286-47cb-aeb1-953648e08914">清理系统</a></li>
</ul>
</li>
<li><a href="#h:ddfde966-a273-409d-8830-9752f65e8757">系统配置</a>
<ul>
<li><a href="#h:f2ee1b43-bcae-473a-83d8-4f1020dd5d45">网络配置</a></li>
<li><a href="#h:07e05a40-7a9e-487d-9808-5f636779301f">配置系统时钟</a></li>
<li><a href="#h:85f932ea-b0a3-4a97-8956-83f978162110">配置系统 Locale</a></li>
<li><a href="#h:46f6918d-8694-4087-9dd3-596d7ac873d6">创建 /etc/inputrc 文件</a></li>
<li><a href="#h:488711f9-8adf-47bc-a810-4c9c4dc68a83">创建 /etc/shells 文件</a></li>
</ul>
</li>
<li><a href="#h:418ae55c-55b8-45a3-9d2d-a21355b7beb5">使 LFS 系统可引导</a>
<ul>
<li><a href="#h:d168dfcb-929a-4f7c-9ea4-fa3d07e8255a">创建 /etc/fstab 文件</a></li>
<li><a href="#h:e1bfae87-1ef2-44db-98a8-d453e40aacf7">Linux-6.10.5</a></li>
<li><a href="#h:d91826da-ea77-4883-87af-92b4fe8f8a35">使用 GRUB 设定引导过程</a></li>
</ul>
</li>
<li><a href="#h:bfc2dbb3-501c-456d-96f1-7134c0893fec">收尾工作</a>
<ul>
<li><a href="#h:718a8c7a-8f20-4a41-938a-f2ad4f7a2589">收尾工作</a></li>
<li><a href="#h:ead0ae82-548b-40f1-ae3b-f4d37ff9c93b">重启系统</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../../index.html">Linux</a></li>
</ul>

<div class="mediawrapper">
  <iframe src="https:////player.bilibili.com/player.html?aid=671666082&bvid=BV1TU4y1W7nV&cid=299074250&p=1&high_quality=1&danmaku=0&autoplay=false" width="732px" height="458px"scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts">> </iframe>
</div>

<!--
&high_quality=1   (1=最高画质 0=最低画质)
&danmaku=0   (1=打开弹幕 0=关闭弹幕)
iframe 参数
    allowfullscreen="allowfullscreen" #移动端全屏
    sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts" #禁止弹出网页
-->

<p>
官网：<a href="https://www.linuxfromscratch.org/">https://www.linuxfromscratch.org/</a>
</p>

<p>
文档：<a href="https://www.linuxfromscratch.org/lfs/read.html">https://www.linuxfromscratch.org/lfs/read.html</a>
</p>

<p>
systemd稳定版： <a href="https://www.linuxfromscratch.org/lfs/view/stable-systemd/">https://www.linuxfromscratch.org/lfs/view/stable-systemd/</a>
</p>

<p>
版本：12.2
</p>
<section id="outline-container-h:20294f5b-9312-4c4c-a592-0bd2d225a6ac" class="outline-2">
<h2 id="h:20294f5b-9312-4c4c-a592-0bd2d225a6ac">前言</h2>
<div class="outline-text-2" id="text-h:20294f5b-9312-4c4c-a592-0bd2d225a6ac">
<p>
从1998年开始，作者开始体验从源码编译构建出自己的操作系统。Linux From Scratch 项目由此诞生。
</p>

<p>
提前条件：
</p>

<ul class="org-ul">
<li>至少需要一个现有的 Linux 系统，例如已经构建好的 LFS 系统，Ubuntu，Rad Hat/Fedora，或者其他支持您的硬件架构的发行版.</li>
<li>CPU架构： x86_64  , 稍作修改也能运行在ARM架构CPU上</li>
<li>至少需要知道如何使用命令行 (shell) 来复制或移动文件和目录，列出目录或文件的内容，以及切换当前工作目录。另外，我们预期您知道如何使用和安装 Linux 软件</li>
</ul>

<p>
LFS 和标准:
</p>
<ul class="org-ul">
<li><a href="https://pubs.opengroup.org/onlinepubs/9699919799/">POSIX.1-2008</a></li>
<li><a href="https://refspecs.linuxfoundation.org/FHS_3.0/fhs/index.html">Filesystem Hierarchy Standard (FHS) Version 3.0</a></li>
<li><p>
<a href="https://refspecs.linuxfoundation.org/lsb.shtml">Linux Standard Base (LSB) Version 5.0 (2015)</a>
</p>

<p>
LSB 由四个独立的规范组成：Core，Desktop，Languages，以及 Imaging。Core 和 Desktop 规范中一些部分是架构相关的。另外，还有两个处于试用阶段的规范：Gtk3 和 Graphics。
</p></li>
</ul>

<p>
<a href="https://www.linuxfromscratch.org/lfs/view/stable-systemd/prologue/package-choices.html">LFS中软件包说明</a>：
</p>

<pre class="example" id="org061d492">
Acl
这个软件包包含管理访问控制列表 (ACL) 的工具，用来对文件和目录提供细粒度的访问权限控制。

Attr
这个软件包包含管理文件系统对象的扩展属性的程序。

Autoconf
这个软件包提供能根据软件开发者提供的模板，自动生成配置源代码的 shell 脚本的程序。如果修改了软件包的构建过程，一般需要该软件包的支持才能重新构建被修改的软件包。

Automake
这个软件包包含能根据软件开发者提供的模板，自动生成 Makefile 的程序。如果修改了软件包的构建过程，一般需要该软件包的支持才能重新构建被修改的软件包。

Bash
这个软件包为系统提供一个 LSB core 要求的 Bourne Shell 接口。它是较为常用的 shell 软件包，且具有一定的的扩展能力，因此在各种 shell 软件包中选择了它。

Bc
这个软件包提供了一个任意精度数值处理语言。在编译 Linux 内核时需要该软件包。

Binutils
该软件包提供链接器、汇编器，以及其他处理目标文件的工具。编译 LFS 系统中的大多数软件包都需要这些程序。

Bison
这个软件包包含 yacc (Yet Another Compiler Compiler) 的 GNU 版本。一些 LFS 程序的编译过程需要该软件包。

Bzip2
这个软件包包含用于压缩和解压缩文件的程序。许多 LFS 软件包的解压需要该软件包。

Check
这个软件包提供其他程序使用的测试环境。

Coreutils
这个软件包包含一些用于查看和操作文件和目录的基本程序。这些程序被用于在命令行下管理文件，以及每个 LFS 软件包的安装过程。

D-Bus
这个软件包包含用于提供消息总线系统的程序，作为一种应用程序之间通信的简单方式。

DejaGNU
这个软件包提供用于测试其他程序的框架。

Diffutils
这个软件包包含用于显示文件或目录之间的差异的程序。这些程序可以被用于创建补丁，很多软件包的编译过程也需要该软件包。

E2fsprogs
这个软件包提供用于处理 ext2, ext3 和 ext4 文件系统的工具。它们是 Linux 支持的最常用且久经考验的文件系统。

Expat
这个软件包提供一个相对轻量级的 XML 解析库。Perl 模块 XML::Parser 需要该软件包。

Expect
这个软件包包含一个自动和其他交互程序交互的脚本执行程序。一般用它测试其他程序。

File
这个软件包包含用于判定给定文件类型的工具。一些软件包的构建脚本需要它。

Findutils
这个软件包提供用于在文件系统中寻找文件的程序。它被许多软件包的编译脚本使用。

Flex
这个软件包包含用于生成词法分析器的程序。它是 lex (lexical analyzer) 程序的 GNU 版本。许多 LFS 软件包的编译过程需要该软件包。

Gawk
这个软件包提供用于操作文本文件的程序。它是 awk (Aho-Weinberg-Kernighan) 的 GNU 版本。它被许多其他软件包的构建脚本使用。

GCC
这是 GNU 编译器的集合。它包含 C 和 C++ 编译器，以及其他一些在 LFS 中不会涉及的编译器。

GDBM
这个软件包包含 GNU 数据库管理库。LFS 的另一个软件包 Man-DB 需要该软件包。

Gettext
这个软件包提供用于许多其他软件包的国际化和本地化的工具和库。

Glibc
这个软件包包含主要的 C 语言库。Linux 程序没有该软件包的支持根本无法运行。

GMP
这个软件包提供数学库，这些库支持用于任意精度算术的函数。编译 GCC 需要该软件包。

Gperf
这个软件包提供一个能够根据键值集合生成完美散列函数的程序。 Systemd 需要该软件包。

Grep
这个软件包包含在文本中搜索指定模式的程序。它被多数软件包的编译脚本所使用。

Groff
这个软件包提供用于处理和格式化文本的程序。它们的一项重要功能是格式化手册页。

GRUB
这个软件包是 Grand Unified Boot Loader。Linux 可以使用其他引导加载器，但 GRUB 最灵活。

Gzip
这个软件包包含用于压缩和解压缩文件的程序。许多 LFS 软件包的解压需要该软件包。

Iana-etc
这个软件包包含网络服务和协议的描述数据。网络功能的正确运作需要该软件包。

Inetutils
这个软件包提供基本网络管理程序。

Intltool
这个软件包提供能够从源代码中提取可翻译字符串的工具。

IProute2
这个软件包提供了用于 IPv4 和 IPv6 网络的基础和高级管理程序。和另一个常见的网络工具包 net-tools 相比，它具有管理 IPv6 网络的能力。

Jinja2
该软件包是一个处理文本文件模板的 Python 模块。构建 Systemd 需要它。

Kbd
这个软件包提供键盘映射文件，用于非美式键盘的键盘工具，以及一些控制台字体。

Kmod
这个软件包提供用于管理 Linux 内核模块的程序。

Less
这个软件包包含一个很好的文本文件查看器，它支持在查看文件时上下滚动。许多软件包使用它对输出进行分页。

Libcap
这个软件包实现了用于访问 Linux 内核中 POSIX 1003.1e 权能字功能的用户空间接口。

Libelf
Elfutils 项目提供了用于 ELF 文件和 DWARF 数据的工具和库。该软件包的大多数工具已经由其他软件包提供，但使用默认 (也是最高效的) 配置构建 Linux 内核时，需要使用该软件包的库。

Libffi
这个软件包实现了一个可移植的高级编程接口，用于处理不同的调用惯例。某些程序在编译时并不知道如何向函数传递参数，例如解释器在运行时才得到函数的参数个数和类型信息。它们可以使用 libffi 作为解释语言和编译语言之间的桥梁。

Libpipeline
Libpipeline 提供一个能够灵活、方便地操作子进程流水线的库。Man-DB 软件包需要这个库。

Libtool
这个软件包包含 GNU 通用库支持脚本。它将共享库的使用封装成一个一致、可移植的接口。在其他 LFS 软件包的测试套件中需要该软件包。

Libxcrypt
该软件包提供 libcrypt 库，一些软件包 (例如 Shadow) 使用该库对密码进行散列操作。它替代 Glibc 中过时的 libcrypt 实现。

Linux Kernel
这个软件包就是操作系统。我们平常说的 “GNU/Linux” 环境中的 “Linux” 就指的是它。

M4
这个软件包提供通用的文本宏处理器。它被其他程序用作构建工具。

Make
这个软件包包含用于指导软件包编译过程的程序。LFS 中几乎每个软件包都需要它。

MarkupSafe
该软件包是一个安全地处理 HTML/XHTML/XML 中的字符串的 Python 模块。Jinja2 需要该软件包。

Man-DB
这个软件包包含用于查找和浏览手册页的程序。与 man 软件包相比，该软件包的国际化功能更为强大。该软件包提供了 man 程序。

Man-pages
这个软件包提供基本的 Linux 手册页的实际内容。

Meson
这个软件包一个自动化软件构建过程的工具。它的设计目标是最小化软件开发者不得不用于配置构建系统的时间。该软件包在构建 Systemd 和很多 BLFS 软件包时是必要的。

MPC
这个软件包提供用于复数算术的函数。GCC 需要该软件包。

MPFR
这个软件包包含用于多精度算术的函数。GCC 需要该软件包。

Ninja
这个软件包提供一个注重执行速度的小型构建系统。它被设计为读取高级构建系统生成的输入文件，并以尽量高的速度运行。Meson 需要该软件包。

Ncurses
这个软件包包含用于处理字符界面的不依赖特定终端的库。它一般被用于为菜单系统提供光标控制。一些 LFS 软件包需要该软件包。

Openssl
这个软件包包含关于密码学的管理工具和库，它们为 Linux 内核等其他软件包提供密码学功能。

Patch
这个软件包包含一个通过 补丁 文件修改或创建文件的程序。补丁文件通常由 diff 程序创建。一些 LFS 软件包的编译过程需要该软件包。

Perl
这个软件包是运行时语言 PERL 的解释器。几个 LFS 软件包的安装和测试过程需要该软件包。

Pkgconf
这个软件包包含一个为开发库配置编译和链接选项的程序。该程序可以直接替代 pkg-config 命令，许多软件包的构建系统都需要该命令。它的维护比原始的 Pkg-config 软件包更积极，而且运行速度稍快一些。

Procps-NG
这个软件包包含用于监控系统进程的程序，对系统管理非常有用。另外 LFS 引导脚本也需要该软件包。

Psmisc
这个软件包提供一些显示当前运行的系统进程信息的程序。这些程序对系统管理非常有用。

Python 3
这个软件包提供了一种在设计时强调代码可读性的解释性语言支持。

Readline
这个软件包是一组库，提供命令行编辑和历史记录支持。Bash 需要该软件包。

Sed
这个软件包可以在没有文本编辑器的情况下编辑文本文件。另外，许多 LFS 软件包的配置脚本需要该软件包。

Shadow
这个软件包包含用于安全地处理密码的程序。

Systemd
这个软件包提供一个init程序，和一些附加的引导和系统控制支持。它能够替代 SysVinit。许多商业发行版使用该软件包。

Tar
这个软件包提供存档和提取功能，几乎每个 LFS 软件包都需要它才能被提取。

Tcl
这个软件包包含在测试套件中广泛使用的工具控制语言 (Tool Command Language)。

Texinfo
这个软件包提供用于阅读、编写和转换 info 页面的程序。许多 LFS 软件包的安装过程需要使用它。

Util-linux
这个软件包包含许多工具程序，其中有处理文件系统、终端、分区和消息的工具。

Vim
这个软件包提供一个编辑器。由于它与经典的 vi 编辑器相兼容，且拥有许多强大的功能，我们选择这个编辑器。编辑器的选择是非常主观的。如果希望的话，读者可以用其他编辑器替代它。

Wheel
该软件包提供一个 Python 模块，该模块是 Python wheel 软件包标准格式的参考实现。

XML::Parser
这个软件包是和 Expat 交互的 Perl 模块。

XZ Utils
这个软件包包含用于压缩和解压缩文件的程序。在所有这类程序中，该软件包提供了最高的压缩率。该软件包被用于解压 XZ 或 LZMA 格式的压缩文件。

Zlib
这个软件包包含一些程序使用的压缩和解压缩子程序。

Zstd
这个软件包提供一些程序使用的压缩和解压缩子程序。它具有较高的压缩比，以及很宽的压缩比/速度权衡范围。
</pre>
</div>
</section>
<section id="outline-container-h:f7f17d6f-0bd6-4936-a141-ff03869bd3b3" class="outline-2">
<h2 id="h:f7f17d6f-0bd6-4936-a141-ff03869bd3b3">概述</h2>
<div class="outline-text-2" id="text-h:f7f17d6f-0bd6-4936-a141-ff03869bd3b3">
</div>
<div id="outline-container-h:d8e7c50e-44a2-4f3f-aee2-117fb94228ec" class="outline-3">
<h3 id="h:d8e7c50e-44a2-4f3f-aee2-117fb94228ec">概述</h3>
<div class="outline-text-3" id="text-h:d8e7c50e-44a2-4f3f-aee2-117fb94228ec">
<p>
<b>如何构建 LFS 系统</b>
</p>
<ul class="org-ul">
<li>第 2 章(<a href="#h:7071c200-3565-4fda-b9aa-e7b688f014e1">准备宿主系统</a>)描述了如何创建一个新的 Linux 本地分区和文件系统，
以在其中编译和安装新的 LFS 系统。第 3 章(<a href="#h:f2ee1ad7-c977-4d5b-a158-d28732b6076b">软件包和补丁</a>)列举了在构建
LFS 系统的过程中必须下载的软件包和补丁，并解释了在新文件系统中存储它
们的方法。第 4 章(<a href="#h:5358eb06-aad1-4a52-8004-3915d76d8f28">最后准备工作</a>)讨论工作环境的正确配置。请仔细阅读第
4 章，因为它解释了您在开始第 5 章(<a href="#h:869e7a31-cfa6-43db-9e2d-8a14a77c5434">编译交叉工具链</a>)及后续章节的工作前必须了解的一些重
要问题。</li>

<li>第 5 章(<a href="#h:869e7a31-cfa6-43db-9e2d-8a14a77c5434">编译交叉工具链</a>)解释初始工具链 (binutils, gcc, 以及 glibc) 的
安装过程，在安装过程中使用交叉编译技术，将新的工具与宿主系统完全隔离。</li>

<li>第 6 章(<a href="#h:d37a07f5-2831-4050-9927-c289ca373835">交叉编译临时工具</a>)向您展示如何使用刚刚构建的交叉工具链，交叉编译一些基本工具。</li>

<li>之后在第 7 章(<a href="#h:c340c4bb-844b-489f-8f4d-52ac5ede37cb">进入 Chroot 并构建其他临时工具</a>)中，进入一个 "chroot"
环境，在其中使用刚刚构建的工具，继续构建 LFS 构建过程中需要的其余工
具。</li>

<li>我们努力将新构造的系统从宿主发行版分离出来。这个过程看上去很繁琐，我
们将会在<a href="https://www.linuxfromscratch.org/lfs/view/stable-systemd/partintro/toolchaintechnotes.html">工具链技术说明</a>中完整地从技术上解释这样做的必要性。</li>

<li>在第 8 章(<a href="#h:bc02fbf3-71ed-4d56-aa3a-7a341c4d0f81">安装基本系统软件</a>)中我们将构建完整的 LFS 系统。使用 chroot
环境的另一项优势是，在构建 LFS 的过程中，您可以继续使用宿主系统。这
样，在等待软件包编译的过程中，您可以继续正常使用计算机。</li>

<li>为了完成安装，我们在第 9 章(<a href="#h:ddfde966-a273-409d-8830-9752f65e8757">系统配置</a>)中进行系统的基本设置，在第 10
章(<a href="#h:418ae55c-55b8-45a3-9d2d-a21355b7beb5">使 LFS 系统可引导</a>)中配置内核和引导加载器。最后，第 11 章(<a href="#h:bfc2dbb3-501c-456d-96f1-7134c0893fec">收尾工作</a>)包
含在阅读完本书后继续体验 LFS 的相关信息。在完成本书的所有流程后，重
启计算机即可进入新的 LFS 系统。</li>
</ul>
</div>
</div>
</section>
<section id="outline-container-h:7d439272-49de-4d0a-95a5-d4b9ee7d7d91" class="outline-2">
<h2 id="h:7d439272-49de-4d0a-95a5-d4b9ee7d7d91">准备</h2>
<div class="outline-text-2" id="text-h:7d439272-49de-4d0a-95a5-d4b9ee7d7d91">
<p>
描述了如何进行构建的准备工作，包括分区、下载软件包、编译临时工具链等。
</p>
</div>
<div id="outline-container-h:7071c200-3565-4fda-b9aa-e7b688f014e1" class="outline-3">
<h3 id="h:7071c200-3565-4fda-b9aa-e7b688f014e1">准备宿主系统</h3>
<div class="outline-text-3" id="text-h:7071c200-3565-4fda-b9aa-e7b688f014e1">
<p>
1.宿主系统需求
</p>

<p>
硬件:
</p>

<p>
LFS 编辑建议使用有四个以上 CPU 核心和至少 8 GB 内存的硬件进行构建。
</p>

<p>
软件
</p>

<p>
为了确定您的宿主系统拥有每个软件的合适版本，且能够编译程序，请运行下列命令：
</p>

<p>
<a href="https://www.linuxfromscratch.org/lfs/view/stable-systemd/chapter02/hostreqs.html">https://www.linuxfromscratch.org/lfs/view/stable-systemd/chapter02/hostreqs.html</a>
</p>

<p>
2.创建新的分区
</p>

<p>
使用cfdisk 或者fdisk命令, 创建一个新分区，不小于30GB空间
</p>

<div class="org-src-container">
<pre class="src src-sh">cfdisk /dev/sda
[new]  100GB
[write] yes
</pre>
</div>

<p>
3.在分区上建立文件系统
</p>

<div class="org-src-container">
<pre class="src src-sh">mkfs.ext4 /dev/sda5
</pre>
</div>

<p>
4.设置 $LFS 环境变量
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23450;&#20041; &#26500;&#24314; LFS &#20351;&#29992;&#30340;&#30446;&#24405;</span>
<span style="color: #483d8b;">export</span> <span style="color: #a0522d;">LFS</span>=/mnt/lfs
<span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">LFS</span>
</pre>
</div>

<p>
5.挂载新的分区
</p>

<div class="org-src-container">
<pre class="src src-sh">mkdir -pv $<span style="color: #a0522d;">LFS</span>
mount -v /dev/sda5 $<span style="color: #a0522d;">LFS</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:f2ee1ad7-c977-4d5b-a158-d28732b6076b" class="outline-3">
<h3 id="h:f2ee1ad7-c977-4d5b-a158-d28732b6076b">软件包和补丁</h3>
<div class="outline-text-3" id="text-h:f2ee1ad7-c977-4d5b-a158-d28732b6076b">
<p>
软件包备用地址：<a href="https://www.linuxfromscratch.org/lfs/mirrors.html#files">https://www.linuxfromscratch.org/lfs/mirrors.html#files</a>
</p>

<p>
构建基本的 Linux 系统时需要下载的软件包列表, root用户运行
</p>
<div class="org-src-container">
<pre class="src src-sh">mkdir -v $<span style="color: #a0522d;">LFS</span>/sources
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35813;&#30446;&#24405;&#28155;&#21152;&#20889;&#20837;&#26435;&#38480;&#21644; sticky &#26631;&#24535;&#12290;&#8220;Sticky&#8221; &#26631;&#24535;&#20351;&#24471;&#21363;&#20351;&#26377;&#22810;&#20010;&#29992;&#25143;&#23545;&#35813;&#30446;&#24405;&#26377;&#20889;&#20837;&#26435;&#38480;&#65292;&#20063;&#21482;&#26377;&#25991;&#20214;&#25152;&#26377;&#32773;&#33021;&#22815;&#21024;&#38500;&#20854;&#20013;&#30340;&#25991;&#20214;&#12290;</span>
chmod -v a+wt $<span style="color: #a0522d;">LFS</span>/sources

<span style="color: #b22222;">#</span><span style="color: #b22222;">lfs&#25152;&#38656;&#36719;&#20214;&#21253;&#65292;&#36825;&#37324;&#20351;&#29992;&#28165;&#21326;&#28304;</span>
wget https://mirrors.ustc.edu.cn/lfs/lfs-packages/lfs-packages-12.2.tar
tar xf  lfs-packages-12.2.tar
mv -v 12.2/* $<span style="color: #a0522d;">LFS</span>/sources

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26657;&#39564;&#21253;.</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">pushd &#36827;&#26632;&#65292;&#30456;&#24403;&#20110;cd &#21040;&#30446;&#24405;&#19979;&#12290;popd&#20986;&#26632;&#65292;&#30456;&#24403;&#20110;cd - &#36820;&#22238;&#19978;&#19968;&#27425;&#30446;&#24405;</span>
<span style="color: #483d8b;">pushd</span> $<span style="color: #a0522d;">LFS</span>/sources
  md5sum -c md5sums
<span style="color: #483d8b;">popd</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:5358eb06-aad1-4a52-8004-3915d76d8f28" class="outline-3">
<h3 id="h:5358eb06-aad1-4a52-8004-3915d76d8f28">最后准备工作</h3>
<div class="outline-text-3" id="text-h:5358eb06-aad1-4a52-8004-3915d76d8f28">
<p>
以root身份运行
</p>

<p>
1.在 LFS 文件系统中创建有限目录布局
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;&#25152;&#38656;&#30340;&#30446;&#24405;&#24067;&#23616;</span>
mkdir -pv $<span style="color: #a0522d;">LFS</span>/{etc,var} $<span style="color: #a0522d;">LFS</span>/usr/{bin,lib,sbin}

<span style="color: #a020f0;">for</span> i<span style="color: #a020f0;"> in</span> bin lib sbin; <span style="color: #a020f0;">do</span>
  ln -sv usr/$<span style="color: #a0522d;">i</span> $<span style="color: #a0522d;">LFS</span>/$<span style="color: #a0522d;">i</span>
<span style="color: #a020f0;">done</span>

<span style="color: #a020f0;">case</span> $(uname -m) <span style="color: #a020f0;">in</span>
  x86_64) mkdir -pv $<span style="color: #a0522d;">LFS</span>/lib64 ;;
<span style="color: #a020f0;">esac</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20132;&#21449;&#32534;&#35793;&#22120;&#20250;&#34987;&#23433;&#35013;&#21040;&#19968;&#20010;&#19987;&#29992;&#30340;&#30446;&#24405;&#20013;</span>
mkdir -pv $<span style="color: #a0522d;">LFS</span>/tools
</pre>
</div>

<p>
2.添加 LFS 用户
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#28155;&#21152; LFS &#29992;&#25143;</span>
groupadd lfs
useradd -s /bin/bash -g lfs -m -k /dev/null lfs

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622;lfs&#29992;&#25143;&#23494;&#30721;</span>
passwd lfs

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558; lfs &#35774;&#20026; $LFS &#20013;&#25152;&#26377;&#30446;&#24405;&#30340;&#25152;&#26377;&#32773;</span>
chown -v lfs $<span style="color: #a0522d;">LFS</span>/{usr{,/*},lib,var,etc,bin,sbin,tools}
<span style="color: #a020f0;">case</span> $(uname -m) <span style="color: #a020f0;">in</span>
  x86_64) chown -v lfs $<span style="color: #a0522d;">LFS</span>/lib64 ;;
<span style="color: #a020f0;">esac</span>
</pre>
</div>

<p>
切换用户 lfs
</p>
<div class="org-src-container">
<pre class="src src-sh">su - lfs
</pre>
</div>

<p>
3.配置环境
</p>

<p>
以lfs用户运行
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26032;&#24314;&#19968;&#20010;&#38500;&#20102; HOME, TERM &#20197;&#21450; PS1 &#22806;&#27809;&#26377;&#20219;&#20309;&#29615;&#22659;&#21464;&#37327;&#30340; shell &#24182;&#26367;&#25442;&#24403;&#21069; shell. &#38450;&#27490;&#23487;&#20027;&#29615;&#22659;&#20013;&#19981;&#38656;&#35201;&#21644;&#26377;&#28508;&#22312;&#39118;&#38505;&#30340;&#29615;&#22659;&#21464;&#37327;&#36827;&#20837;&#26500;&#24314;&#29615;&#22659;</span>
cat &gt; ~/.bash_profile &lt;&lt; <span style="color: #8b2252;">"EOF"</span>
<span style="color: #ffa54f;">exec env -i HOME=$HOME TERM=$TERM PS1='\u:\w\$ ' /bin/bash</span>
<span style="color: #ffa54f;">EOF</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">LFS&#24517;&#35201;&#30340;&#21464;&#37327;</span>
cat &gt; ~/.bashrc &lt;&lt; <span style="color: #8b2252;">"EOF"</span>
<span style="color: #ffa54f;">set +h</span>
<span style="color: #ffa54f;">umask 022</span>
<span style="color: #ffa54f;">LFS=/mnt/lfs</span>
<span style="color: #ffa54f;">LC_ALL=POSIX</span>
<span style="color: #ffa54f;">LFS_TGT=$(uname -m)-lfs-linux-gnu</span>
<span style="color: #ffa54f;">PATH=/usr/bin</span>
<span style="color: #ffa54f;">if [ ! -L /bin ]; then PATH=/bin:$PATH; fi</span>
<span style="color: #ffa54f;">PATH=$LFS/tools/bin:$PATH</span>
<span style="color: #ffa54f;">CONFIG_SITE=$LFS/usr/share/config.site</span>
<span style="color: #ffa54f;">export LFS LC_ALL LFS_TGT PATH CONFIG_SITE</span>
<span style="color: #ffa54f;">EOF</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#35793;&#25552;&#36895;&#65292;&#26681;&#25454;&#23487;&#20027;&#26426;cpu&#26680;&#25968;&#35774;&#32622;&#32534;&#35793;&#21442;&#25968;. &#22914;&#26524;&#19981;&#24076;&#26395;&#20351;&#29992;&#20840;&#37096;&#36923;&#36753; CPU &#26680;&#24515;&#65292;&#23558; $(nproc) &#26367;&#25442;&#20026;&#24076;&#26395;&#20351;&#29992;&#30340;&#26680;&#24515;&#25968;&#12290;</span>
cat &gt;&gt; ~/.bashrc &lt;&lt; <span style="color: #8b2252;">"EOF"</span>
<span style="color: #ffa54f;">export MAKEFLAGS=-j$(nproc)</span>
<span style="color: #ffa54f;">EOF</span>
</pre>
</div>

<p>
以root身份运行
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#20123;&#21830;&#19994;&#21457;&#34892;&#29256;&#26410;&#20570;&#25991;&#26723;&#35828;&#26126;&#22320;&#23558; /etc/bash.bashrc &#24341;&#20837; bash &#21021;&#22987;&#21270;&#36807;&#31243;&#12290;&#35813;&#25991;&#20214;&#21487;&#33021;&#20462;&#25913; lfs &#29992;&#25143;&#30340;&#29615;&#22659;&#65292;&#24182;&#24433;&#21709; LFS &#20851;&#38190;&#36719;&#20214;&#21253;&#30340;&#26500;&#24314;&#12290;&#20026;&#20102;&#20445;&#35777; lfs &#29992;&#25143;&#29615;&#22659;&#30340;&#32431;&#20928;&#65292;&#26816;&#26597; /etc/bash.bashrc &#26159;&#21542;&#23384;&#22312;&#65292;&#22914;&#26524;&#23427;&#23384;&#22312;&#23601;&#23558;&#23427;&#31227;&#36208;&#12290;</span>
[ ! -e /etc/bash.bashrc ] || mv -v /etc/bash.bashrc /etc/bash.bashrc.NOUSE
</pre>
</div>

<p>
以lfs用户运行
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">source</span> ~/.bash_profile
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:3d7ba030-be4f-4d9c-92bf-2ef7bba05ac3" class="outline-2">
<h2 id="h:3d7ba030-be4f-4d9c-92bf-2ef7bba05ac3">构建 LFS 交叉工具链和临时工具</h2>
<div class="outline-text-2" id="text-h:3d7ba030-be4f-4d9c-92bf-2ef7bba05ac3">
<p>
提供在最终构建 LFS 系统时需要使用的工具的构建方法。
</p>
</div>
<div id="outline-container-h:869e7a31-cfa6-43db-9e2d-8a14a77c5434" class="outline-3">
<h3 id="h:869e7a31-cfa6-43db-9e2d-8a14a77c5434">编译交叉工具链</h3>
<div class="outline-text-3" id="text-h:869e7a31-cfa6-43db-9e2d-8a14a77c5434">
<p>
编译的程序会被安装在 $LFS/tools 目录中
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">LFS</span>
</pre>
</div>

<p>
软件包构建过程的概要
</p>
<pre class="example" id="orgcaa1b23">
1. 把所有的源码包和补丁放在一个能够从 chroot 环境访问的目录，例如 /mnt/lfs/sources/。
2. 切换到 /mnt/lfs/sources/ 目录。
3. 对于每个软件包：lfs身份
   1. 使用 tar 程序，解压需要构建的软件包。
   2. 切换到解压源码包时产生的目录。
   3. 根据指示构建软件包。
   4. 构建完成后，切换回包含所有源码包的目录。
   5. 除非另有说明，删除解压出来的目录。
</pre>


<p>
以lfs身份运行
</p>
</div>
<div id="outline-container-h:5fade581-5448-473f-bf66-34e5595f7c55" class="outline-4">
<h4 id="h:5fade581-5448-473f-bf66-34e5595f7c55">Binutils-2.43.1</h4>
<div class="outline-text-4" id="text-h:5fade581-5448-473f-bf66-34e5595f7c55">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#29992;&#27493;&#39588;&#65292;&#35299;&#21387;&#21253;</span>
<span style="color: #483d8b;">cd</span> $<span style="color: #a0522d;">LFS</span>/sources
tar xf binutils-2.43.1.tar.xz
<span style="color: #483d8b;">cd</span> binutils-2.43.1/

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36719;&#20214;&#32534;&#35793;&#65292;&#20197;&#25991;&#26723;&#20026;&#20934;</span>
mkdir -v build
<span style="color: #483d8b;">cd</span>       build

../configure --prefix=$<span style="color: #a0522d;">LFS</span>/tools <span style="color: #8b2252;">\</span>
             --with-sysroot=$<span style="color: #a0522d;">LFS</span> <span style="color: #8b2252;">\</span>
             --target=$<span style="color: #a0522d;">LFS_TGT</span>   <span style="color: #8b2252;">\</span>
             --disable-nls       <span style="color: #8b2252;">\</span>
             --enable-gprofng=no <span style="color: #8b2252;">\</span>
             --disable-werror    <span style="color: #8b2252;">\</span>
             --enable-new-dtags  <span style="color: #8b2252;">\</span>
             --enable-default-hash-style=gnu

make &amp;&amp; make install

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#35793;&#23436;&#36820;&#22238;&#28304;&#30721;&#21253;&#30446;&#24405;&#65292;&#21024;&#38500;&#35299;&#21387;&#30340;&#21253;&#30446;&#24405;</span>
<span style="color: #483d8b;">cd</span> $<span style="color: #a0522d;">LFS</span>/sources
rm -rf binutils-2.43.1
</pre>
</div>
</div>
</div>
<div id="outline-container-h:313f3757-3e8a-43f9-a938-2d8f4718fc30" class="outline-4">
<h4 id="h:313f3757-3e8a-43f9-a938-2d8f4718fc30">GCC-14.2.0</h4>
<div class="outline-text-4" id="text-h:313f3757-3e8a-43f9-a938-2d8f4718fc30">
<p>
同上
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#29992;&#27493;&#39588;&#65292;&#35299;&#21387;&#21253;</span>
<span style="color: #483d8b;">cd</span> $<span style="color: #a0522d;">LFS</span>/sources
tar xf gcc-14.2.0.tar.xz
<span style="color: #483d8b;">cd</span> gcc-14.2.0

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36719;&#20214;&#32534;&#35793;&#65292;&#20197;&#25991;&#26723;&#20026;&#20934;</span>
tar -xf ../mpfr-4.2.1.tar.xz
mv -v mpfr-4.2.1 mpfr
tar -xf ../gmp-6.3.0.tar.xz
mv -v gmp-6.3.0 gmp
tar -xf ../mpc-1.3.1.tar.gz
mv -v mpc-1.3.1 mpc

<span style="color: #a020f0;">case</span> $(uname -m) <span style="color: #a020f0;">in</span>
  x86_64)
    sed -e <span style="color: #8b2252;">'/m64=/s/lib64/lib/'</span> <span style="color: #8b2252;">\</span>
        -i.orig gcc/config/i386/t-linux64
 ;;
<span style="color: #a020f0;">esac</span>

mkdir -v build
<span style="color: #483d8b;">cd</span>       build

../configure                  <span style="color: #8b2252;">\</span>
    --target=$<span style="color: #a0522d;">LFS_TGT</span>         <span style="color: #8b2252;">\</span>
    --prefix=$<span style="color: #a0522d;">LFS</span>/tools       <span style="color: #8b2252;">\</span>
    --with-glibc-version=2.40 <span style="color: #8b2252;">\</span>
    --with-sysroot=$<span style="color: #a0522d;">LFS</span>       <span style="color: #8b2252;">\</span>
    --with-newlib             <span style="color: #8b2252;">\</span>
    --without-headers         <span style="color: #8b2252;">\</span>
    --enable-default-pie      <span style="color: #8b2252;">\</span>
    --enable-default-ssp      <span style="color: #8b2252;">\</span>
    --disable-nls             <span style="color: #8b2252;">\</span>
    --disable-shared          <span style="color: #8b2252;">\</span>
    --disable-multilib        <span style="color: #8b2252;">\</span>
    --disable-threads         <span style="color: #8b2252;">\</span>
    --disable-libatomic       <span style="color: #8b2252;">\</span>
    --disable-libgomp         <span style="color: #8b2252;">\</span>
    --disable-libquadmath     <span style="color: #8b2252;">\</span>
    --disable-libssp          <span style="color: #8b2252;">\</span>
    --disable-libvtv          <span style="color: #8b2252;">\</span>
    --disable-libstdcxx       <span style="color: #8b2252;">\</span>
    --enable-languages=c,c++

make &amp;&amp; make install

<span style="color: #483d8b;">cd</span> ..
cat gcc/limitx.h gcc/glimits.h gcc/limity.h &gt; <span style="color: #8b2252;">\</span>
  <span style="color: #ff00ff;">`dirname $($LFS_TGT-gcc -print-libgcc-file-name)`</span>/include/limits.h

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#35793;&#23436;&#36820;&#22238;&#28304;&#30721;&#21253;&#30446;&#24405;&#65292;&#21024;&#38500;&#35299;&#21387;&#30340;&#21253;&#30446;&#24405;</span>
<span style="color: #483d8b;">cd</span> $<span style="color: #a0522d;">LFS</span>/sources
rm -rf gcc-14.2.0
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6f9cd604-5194-42a7-b900-909784aba98c" class="outline-4">
<h4 id="h:6f9cd604-5194-42a7-b900-909784aba98c">Linux-6.10.5</h4>
<div class="outline-text-4" id="text-h:6f9cd604-5194-42a7-b900-909784aba98c">
<p>
同上
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#29992;&#27493;&#39588;&#65292;&#35299;&#21387;&#21253;</span>
<span style="color: #483d8b;">cd</span> $<span style="color: #a0522d;">LFS</span>/sources
tar xf linux-6.10.5.tar.xz
<span style="color: #483d8b;">cd</span> linux-6.10.5

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36719;&#20214;&#32534;&#35793;&#65292;&#20197;&#25991;&#26723;&#20026;&#20934;</span>
make mrproper

make headers
find usr/include -type f ! -name <span style="color: #8b2252;">'*.h'</span> -delete
cp -rv usr/include $<span style="color: #a0522d;">LFS</span>/usr

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#35793;&#23436;&#36820;&#22238;&#28304;&#30721;&#21253;&#30446;&#24405;&#65292;&#21024;&#38500;&#35299;&#21387;&#30340;&#21253;&#30446;&#24405;</span>
<span style="color: #483d8b;">cd</span> $<span style="color: #a0522d;">LFS</span>/sources
rm -fr linux-6.10.5
</pre>
</div>
</div>
</div>
<div id="outline-container-h:4ce8c9f3-0347-42e0-85bd-c109dd398001" class="outline-4">
<h4 id="h:4ce8c9f3-0347-42e0-85bd-c109dd398001">Glibc-2.40</h4>
<div class="outline-text-4" id="text-h:4ce8c9f3-0347-42e0-85bd-c109dd398001">
<p>
同上
</p>

<p>
阅读执行注意事项内容
</p>
</div>
</div>
<div id="outline-container-h:046877b9-4d76-4867-b058-ed74d843f505" class="outline-4">
<h4 id="h:046877b9-4d76-4867-b058-ed74d843f505">Libstdc++ from GCC-14.2.0</h4>
<div class="outline-text-4" id="text-h:046877b9-4d76-4867-b058-ed74d843f505">
<p>
同上
</p>

<p>
进入gcc包中编译
</p>
</div>
</div>
</div>
<div id="outline-container-h:d37a07f5-2831-4050-9927-c289ca373835" class="outline-3">
<h3 id="h:d37a07f5-2831-4050-9927-c289ca373835">交叉编译临时工具</h3>
<div class="outline-text-3" id="text-h:d37a07f5-2831-4050-9927-c289ca373835">
<p>
使用刚刚构建的交叉工具链对基本工具进行交叉编译。这些工具会被安装到它们的最终位置，但现在还无法使用。基本操作仍然依赖宿主系统的工具。
</p>
</div>
<div id="outline-container-h:479f654f-a297-4057-a903-42aa0d3c784c" class="outline-4">
<h4 id="h:479f654f-a297-4057-a903-42aa0d3c784c">M4-1.4.19</h4>
<div class="outline-text-4" id="text-h:479f654f-a297-4057-a903-42aa0d3c784c">
<p>
同上
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#29992;&#27493;&#39588;&#65292;&#35299;&#21387;&#21253;</span>
<span style="color: #483d8b;">cd</span> $<span style="color: #a0522d;">LFS</span>/sources
tar xf &#36719;&#20214;&#21253;
<span style="color: #483d8b;">cd</span> &#36719;&#20214;&#21253;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36719;&#20214;&#32534;&#35793;&#65292;&#20197;&#25991;&#26723;&#20026;&#20934;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#35793;&#23436;&#36820;&#22238;&#28304;&#30721;&#21253;&#30446;&#24405;&#65292;&#21024;&#38500;&#35299;&#21387;&#30340;&#21253;&#30446;&#24405;</span>
<span style="color: #483d8b;">cd</span> $<span style="color: #a0522d;">LFS</span>/sources
rm -fr &#36719;&#20214;&#21253;&#35299;&#21387;&#30340;&#30446;&#24405;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:5baeff0a-00f9-4365-ad32-d1f59de16145" class="outline-4">
<h4 id="h:5baeff0a-00f9-4365-ad32-d1f59de16145">Ncurses-6.5</h4>
<div class="outline-text-4" id="text-h:5baeff0a-00f9-4365-ad32-d1f59de16145">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:946ed7c3-2957-4116-95a8-c48a6399b3c2" class="outline-4">
<h4 id="h:946ed7c3-2957-4116-95a8-c48a6399b3c2">Bash-5.2.32</h4>
<div class="outline-text-4" id="text-h:946ed7c3-2957-4116-95a8-c48a6399b3c2">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:fbea40a8-9035-4a54-9a65-2db739d7e7e7" class="outline-4">
<h4 id="h:fbea40a8-9035-4a54-9a65-2db739d7e7e7">Coreutils-9.5</h4>
<div class="outline-text-4" id="text-h:fbea40a8-9035-4a54-9a65-2db739d7e7e7">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:b9f7bf47-05c4-43f2-8a4c-46ce24b432b0" class="outline-4">
<h4 id="h:b9f7bf47-05c4-43f2-8a4c-46ce24b432b0">Diffutils-3.10</h4>
<div class="outline-text-4" id="text-h:b9f7bf47-05c4-43f2-8a4c-46ce24b432b0">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:8379e04d-9a9b-436c-9a2d-4c75ba4f1e70" class="outline-4">
<h4 id="h:8379e04d-9a9b-436c-9a2d-4c75ba4f1e70">File-5.45</h4>
<div class="outline-text-4" id="text-h:8379e04d-9a9b-436c-9a2d-4c75ba4f1e70">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:72a7a1d6-b997-4d4f-9056-bd66d5a778ba" class="outline-4">
<h4 id="h:72a7a1d6-b997-4d4f-9056-bd66d5a778ba">Findutils-4.10.0</h4>
<div class="outline-text-4" id="text-h:72a7a1d6-b997-4d4f-9056-bd66d5a778ba">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:966caf3e-b63f-44ac-bd02-e830081e4cf8" class="outline-4">
<h4 id="h:966caf3e-b63f-44ac-bd02-e830081e4cf8">Gawk-5.3.0</h4>
<div class="outline-text-4" id="text-h:966caf3e-b63f-44ac-bd02-e830081e4cf8">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:f8f9aa46-cdb2-4318-9566-214d731a6cac" class="outline-4">
<h4 id="h:f8f9aa46-cdb2-4318-9566-214d731a6cac">Grep-3.11</h4>
<div class="outline-text-4" id="text-h:f8f9aa46-cdb2-4318-9566-214d731a6cac">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:343843c8-4e89-45ef-aef3-adef31974350" class="outline-4">
<h4 id="h:343843c8-4e89-45ef-aef3-adef31974350">Gzip-1.13</h4>
<div class="outline-text-4" id="text-h:343843c8-4e89-45ef-aef3-adef31974350">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:efbda3b1-774d-493a-912a-b13443414f82" class="outline-4">
<h4 id="h:efbda3b1-774d-493a-912a-b13443414f82">Make-4.4.1</h4>
<div class="outline-text-4" id="text-h:efbda3b1-774d-493a-912a-b13443414f82">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:2e370f28-e5f7-4a5c-9b6d-d2ca893995d6" class="outline-4">
<h4 id="h:2e370f28-e5f7-4a5c-9b6d-d2ca893995d6">Patch-2.7.6</h4>
<div class="outline-text-4" id="text-h:2e370f28-e5f7-4a5c-9b6d-d2ca893995d6">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:c8bffb93-47ca-47c2-9f48-9c1cccb593e1" class="outline-4">
<h4 id="h:c8bffb93-47ca-47c2-9f48-9c1cccb593e1">Sed-4.9</h4>
<div class="outline-text-4" id="text-h:c8bffb93-47ca-47c2-9f48-9c1cccb593e1">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:263a4c1b-50c6-4af2-a861-7344cafb50fd" class="outline-4">
<h4 id="h:263a4c1b-50c6-4af2-a861-7344cafb50fd">Tar-1.35</h4>
<div class="outline-text-4" id="text-h:263a4c1b-50c6-4af2-a861-7344cafb50fd">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:1b4eb74b-8db8-48f4-8214-416449130a3a" class="outline-4">
<h4 id="h:1b4eb74b-8db8-48f4-8214-416449130a3a">Xz-5.6.2</h4>
<div class="outline-text-4" id="text-h:1b4eb74b-8db8-48f4-8214-416449130a3a">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:831b8a5c-d1ef-4c6c-87ae-535c0783464e" class="outline-4">
<h4 id="h:831b8a5c-d1ef-4c6c-87ae-535c0783464e">Binutils-2.43.1 - Pass 2</h4>
<div class="outline-text-4" id="text-h:831b8a5c-d1ef-4c6c-87ae-535c0783464e">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:9128980e-e36e-49a6-9e78-656813fa0ec9" class="outline-4">
<h4 id="h:9128980e-e36e-49a6-9e78-656813fa0ec9">GCC-14.2.0 - Pass 2</h4>
<div class="outline-text-4" id="text-h:9128980e-e36e-49a6-9e78-656813fa0ec9">
<p>
同上
</p>
</div>
</div>
</div>
<div id="outline-container-h:c340c4bb-844b-489f-8f4d-52ac5ede37cb" class="outline-3">
<h3 id="h:c340c4bb-844b-489f-8f4d-52ac5ede37cb">进入 Chroot 并构建其他临时工具</h3>
<div class="outline-text-3" id="text-h:c340c4bb-844b-489f-8f4d-52ac5ede37cb">
<p>
本章展示如何构建临时系统最后缺失的部分：在构建一些软件包时必要的工具。由于已经解决了所有循环依赖问题，现在即可使用“chroot”环境进行构建，它与宿主系统 (除正在运行的内核外) 完全隔离。
</p>

<p>
在进入 chroot 之后，仍然以 root 身份执行所有命令
</p>
</div>
<div id="outline-container-h:9347fd4e-babe-4383-9f20-360d5fdb8e27" class="outline-4">
<h4 id="h:9347fd4e-babe-4383-9f20-360d5fdb8e27">改变所有者</h4>
<div class="outline-text-4" id="text-h:9347fd4e-babe-4383-9f20-360d5fdb8e27">
<p>
以root身份运行
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558; $LFS/* &#30446;&#24405;&#30340;&#25152;&#26377;&#32773;&#25913;&#21464;&#20026; root</span>
chown --from lfs -R root:root $<span style="color: #a0522d;">LFS</span>/{usr,lib,var,etc,bin,sbin,tools}
<span style="color: #a020f0;">case</span> $(uname -m) <span style="color: #a020f0;">in</span>
  x86_64) chown --from lfs -R root:root $<span style="color: #a0522d;">LFS</span>/lib64 ;;
<span style="color: #a020f0;">esac</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26816;&#26597;</span>
ls -la $<span style="color: #a0522d;">LFS</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:3bd969cb-bd91-4cd5-8f3e-750ac3f32820" class="outline-4">
<h4 id="h:3bd969cb-bd91-4cd5-8f3e-750ac3f32820">准备虚拟内核文件系统</h4>
<div class="outline-text-4" id="text-h:3bd969cb-bd91-4cd5-8f3e-750ac3f32820">
<p>
用户态程序使用内核创建的一些文件系统和内核通信。这些文件系统是虚拟的：它们并不占用磁盘空间。它们的内容保留在内存中。必须将它们被挂载到 $LFS 目录树中，这样 chroot 环境中的程序才能找到它们。
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;&#25991;&#20214;&#31995;&#32479;&#30340;&#25346;&#36733;&#28857;</span>
mkdir -pv $<span style="color: #a0522d;">LFS</span>/{dev,proc,sys,run}

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25346;&#36733;&#21644;&#22635;&#20805; /dev</span>
mount -v --bind /dev $<span style="color: #a0522d;">LFS</span>/dev

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25346;&#36733;&#34394;&#25311;&#20869;&#26680;&#25991;&#20214;&#31995;&#32479;</span>
mount -vt devpts devpts -o <span style="color: #a0522d;">gid</span>=5,<span style="color: #a0522d;">mode</span>=0620 $<span style="color: #a0522d;">LFS</span>/dev/pts
mount -vt proc proc $<span style="color: #a0522d;">LFS</span>/proc
mount -vt sysfs sysfs $<span style="color: #a0522d;">LFS</span>/sys
mount -vt tmpfs tmpfs $<span style="color: #a0522d;">LFS</span>/run

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;&#26576;&#20123;&#23487;&#20027;&#31995;&#32479;&#19978;&#65292;/dev/shm &#26159;&#19968;&#20010;&#31526;&#21495;&#38142;&#25509;&#65292;&#36890;&#24120;&#25351;&#21521; /run/shm &#30446;&#24405;&#12290;&#25105;&#20204;&#24050;&#32463;&#22312; /run &#19979;&#25346;&#36733;&#20102; tmpfs &#25991;&#20214;&#31995;&#32479;&#65292;&#22240;&#27492;&#22312;&#36825;&#37324;&#21482;&#38656;&#35201;&#21019;&#24314;&#19968;&#20010;&#35775;&#38382;&#26435;&#38480;&#31526;&#21512;&#35201;&#27714;&#30340;&#30446;&#24405;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;&#20854;&#20182;&#23487;&#20027;&#31995;&#32479;&#19978;&#65292;/dev/shm &#26159;&#19968;&#20010; tmpfs &#30340;&#25346;&#36733;&#28857;&#12290;&#27492;&#26102;&#65292;&#32465;&#23450;&#25346;&#36733; /dev &#21482;&#20250;&#22312; chroot &#29615;&#22659;&#20013;&#29983;&#25104; /dev/shm &#30446;&#24405;&#12290;&#36825;&#26679;&#65292;&#25105;&#20204;&#24517;&#39035;&#26174;&#24335;&#25346;&#36733;&#19968;&#20010; tmpfs&#65306;</span>
<span style="color: #a020f0;">if</span> [ -h $<span style="color: #a0522d;">LFS</span>/dev/shm ]; <span style="color: #a020f0;">then</span>
  install -v -d -m 1777 $<span style="color: #a0522d;">LFS</span>$(realpath /dev/shm)
<span style="color: #a020f0;">else</span>
  mount -vt tmpfs -o nosuid,nodev tmpfs $<span style="color: #a0522d;">LFS</span>/dev/shm
<span style="color: #a020f0;">fi</span>
</pre>
</div>

<p>
之后就要chroot了，如果在构建过程中中途离开，需要重新挂载设备或者目录。
</p>
</div>
</div>
<div id="outline-container-h:ec350cc3-90b9-4ed3-9d02-e22dba00591d" class="outline-4">
<h4 id="h:ec350cc3-90b9-4ed3-9d02-e22dba00591d">进入 Chroot 环境</h4>
<div class="outline-text-4" id="text-h:ec350cc3-90b9-4ed3-9d02-e22dba00591d">
<div class="org-src-container">
<pre class="src src-sh">chroot <span style="color: #8b2252;">"$LFS"</span> /usr/bin/env -i   <span style="color: #8b2252;">\</span>
    <span style="color: #a0522d;">HOME</span>=/root                  <span style="color: #8b2252;">\</span>
    <span style="color: #a0522d;">TERM</span>=<span style="color: #8b2252;">"$TERM"</span>                <span style="color: #8b2252;">\</span>
    <span style="color: #a0522d;">PS1</span>=<span style="color: #8b2252;">'(lfs chroot) \u:\w\$ '</span> <span style="color: #8b2252;">\</span>
    <span style="color: #a0522d;">PATH</span>=/usr/bin:/usr/sbin     <span style="color: #8b2252;">\</span>
    <span style="color: #a0522d;">MAKEFLAGS</span>=<span style="color: #8b2252;">"-j$(nproc)"</span>      <span style="color: #8b2252;">\</span>
    <span style="color: #a0522d;">TESTSUITEFLAGS</span>=<span style="color: #8b2252;">"-j$(nproc)"</span> <span style="color: #8b2252;">\</span>
    /bin/bash --login
</pre>
</div>

<p>
注意 bash 的提示符会包含 I have no name!。这是正常的，因为现在还没有创建 /etc/passwd 文件。
</p>
</div>
</div>
<div id="outline-container-h:2157d65c-cea3-4ed0-9bfa-053dfc72a476" class="outline-4">
<h4 id="h:2157d65c-cea3-4ed0-9bfa-053dfc72a476">创建目录</h4>
<div class="outline-text-4" id="text-h:2157d65c-cea3-4ed0-9bfa-053dfc72a476">
<p>
在 LFS 文件系统中创建完整的目录结构
</p>

<p>
chroot环境
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;&#19968;&#20123;&#20301;&#20110;&#26681;&#30446;&#24405;&#20013;&#30340;&#30446;&#24405;</span>
mkdir -pv /{boot,home,mnt,opt,srv}

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;&#27425;&#32423;&#30446;&#24405;&#32467;&#26500;</span>
mkdir -pv /etc/{opt,sysconfig}
mkdir -pv /lib/firmware
mkdir -pv /media/{floppy,cdrom}
mkdir -pv /usr/{,local/}{include,src}
mkdir -pv /usr/lib/locale
mkdir -pv /usr/local/{bin,lib,sbin}
mkdir -pv /usr/{,local/}share/{color,dict,doc,info,locale,man}
mkdir -pv /usr/{,local/}share/{misc,terminfo,zoneinfo}
mkdir -pv /usr/{,local/}share/man/man{1..8}
mkdir -pv /var/{cache,local,log,mail,opt,spool}
mkdir -pv /var/lib/{color,misc,locate}

ln -sfv /run /var/run
ln -sfv /run/lock /var/lock

install -dv -m 0750 /root
install -dv -m 1777 /tmp /var/tmp
</pre>
</div>
</div>
</div>
<div id="outline-container-h:fc1b840c-de6a-41bc-a63c-4b50ade9f940" class="outline-4">
<h4 id="h:fc1b840c-de6a-41bc-a63c-4b50ade9f940">创建必要的文件和符号链接</h4>
<div class="outline-text-4" id="text-h:fc1b840c-de6a-41bc-a63c-4b50ade9f940">
<p>
chroot环境
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21382;&#21490;&#19978;&#65292;Linux &#26366;&#22312; /etc/mtab &#32500;&#25252;&#24050;&#32463;&#25346;&#36733;&#30340;&#25991;&#20214;&#31995;&#32479;&#30340;&#21015;&#34920;&#12290;&#29616;&#20195;&#20869;&#26680;&#22312;&#20869;&#37096;&#32500;&#25252;&#35813;&#21015;&#34920;&#65292;&#24182;&#36890;&#36807; /proc &#25991;&#20214;&#31995;&#32479;&#23558;&#23427;&#23637;&#31034;&#32473;&#29992;&#25143;&#12290;&#20026;&#20102;&#28385;&#36275;&#19968;&#20123;&#20173;&#28982;&#20351;&#29992; /etc/mtab &#30340;&#24037;&#20855;</span>
ln -sv /proc/self/mounts /etc/mtab

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;&#19968;&#20010;&#22522;&#26412;&#30340; /etc/hosts &#25991;&#20214;&#65292;&#19968;&#20123;&#27979;&#35797;&#22871;&#20214;&#65292;&#20197;&#21450; Perl &#30340;&#19968;&#20010;&#37197;&#32622;&#25991;&#20214;&#23558;&#20250;&#20351;&#29992;&#23427;&#65306;</span>
cat &gt; /etc/hosts &lt;&lt; EOF
<span style="color: #ffa54f;">127.0.0.1  localhost $(hostname)</span>
<span style="color: #ffa54f;">::1        localhost</span>
<span style="color: #ffa54f;">EOF</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;&#20102;&#20351;&#24471; root &#33021;&#27491;&#24120;&#30331;&#24405;&#65292;&#32780;&#19988;&#29992;&#25143;&#21517; &#8220;root&#8221; &#33021;&#34987;&#27491;&#24120;&#35782;&#21035;&#65292;&#24517;&#39035;&#22312;&#25991;&#20214; /etc/passwd &#21644; /etc/groups &#20013;&#20889;&#20837;&#30456;&#20851;&#30340;&#26465;&#30446;</span>
cat &gt; /etc/passwd &lt;&lt; <span style="color: #8b2252;">"EOF"</span>
<span style="color: #ffa54f;">root:x:0:0:root:/root:/bin/bash</span>
<span style="color: #ffa54f;">bin:x:1:1:bin:/dev/null:/usr/bin/false</span>
<span style="color: #ffa54f;">daemon:x:6:6:Daemon User:/dev/null:/usr/bin/false</span>
<span style="color: #ffa54f;">messagebus:x:18:18:D-Bus Message Daemon User:/run/dbus:/usr/bin/false</span>
<span style="color: #ffa54f;">systemd-journal-gateway:x:73:73:systemd Journal Gateway:/:/usr/bin/false</span>
<span style="color: #ffa54f;">systemd-journal-remote:x:74:74:systemd Journal Remote:/:/usr/bin/false</span>
<span style="color: #ffa54f;">systemd-journal-upload:x:75:75:systemd Journal Upload:/:/usr/bin/false</span>
<span style="color: #ffa54f;">systemd-network:x:76:76:systemd Network Management:/:/usr/bin/false</span>
<span style="color: #ffa54f;">systemd-resolve:x:77:77:systemd Resolver:/:/usr/bin/false</span>
<span style="color: #ffa54f;">systemd-timesync:x:78:78:systemd Time Synchronization:/:/usr/bin/false</span>
<span style="color: #ffa54f;">systemd-coredump:x:79:79:systemd Core Dumper:/:/usr/bin/false</span>
<span style="color: #ffa54f;">uuidd:x:80:80:UUID Generation Daemon User:/dev/null:/usr/bin/false</span>
<span style="color: #ffa54f;">systemd-oom:x:81:81:systemd Out Of Memory Daemon:/:/usr/bin/false</span>
<span style="color: #ffa54f;">nobody:x:65534:65534:Unprivileged User:/dev/null:/usr/bin/false</span>
<span style="color: #ffa54f;">EOF</span>

cat &gt; /etc/group &lt;&lt; <span style="color: #8b2252;">"EOF"</span>
<span style="color: #ffa54f;">root:x:0:</span>
<span style="color: #ffa54f;">bin:x:1:daemon</span>
<span style="color: #ffa54f;">sys:x:2:</span>
<span style="color: #ffa54f;">kmem:x:3:</span>
<span style="color: #ffa54f;">tape:x:4:</span>
<span style="color: #ffa54f;">tty:x:5:</span>
<span style="color: #ffa54f;">daemon:x:6:</span>
<span style="color: #ffa54f;">floppy:x:7:</span>
<span style="color: #ffa54f;">disk:x:8:</span>
<span style="color: #ffa54f;">lp:x:9:</span>
<span style="color: #ffa54f;">dialout:x:10:</span>
<span style="color: #ffa54f;">audio:x:11:</span>
<span style="color: #ffa54f;">video:x:12:</span>
<span style="color: #ffa54f;">utmp:x:13:</span>
<span style="color: #ffa54f;">cdrom:x:15:</span>
<span style="color: #ffa54f;">adm:x:16:</span>
<span style="color: #ffa54f;">messagebus:x:18:</span>
<span style="color: #ffa54f;">systemd-journal:x:23:</span>
<span style="color: #ffa54f;">input:x:24:</span>
<span style="color: #ffa54f;">mail:x:34:</span>
<span style="color: #ffa54f;">kvm:x:61:</span>
<span style="color: #ffa54f;">systemd-journal-gateway:x:73:</span>
<span style="color: #ffa54f;">systemd-journal-remote:x:74:</span>
<span style="color: #ffa54f;">systemd-journal-upload:x:75:</span>
<span style="color: #ffa54f;">systemd-network:x:76:</span>
<span style="color: #ffa54f;">systemd-resolve:x:77:</span>
<span style="color: #ffa54f;">systemd-timesync:x:78:</span>
<span style="color: #ffa54f;">systemd-coredump:x:79:</span>
<span style="color: #ffa54f;">uuidd:x:80:</span>
<span style="color: #ffa54f;">systemd-oom:x:81:</span>
<span style="color: #ffa54f;">wheel:x:97:</span>
<span style="color: #ffa54f;">users:x:999:</span>
<span style="color: #ffa54f;">nogroup:x:65534:</span>
<span style="color: #ffa54f;">EOF</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#21495; 65534 &#34987;&#20869;&#26680;&#29992;&#20110; NFS &#21644;&#29992;&#25143;&#21629;&#21517;&#31354;&#38388;&#65292;&#20197;&#34920;&#31034;&#26410;&#26144;&#23556;&#30340;&#29992;&#25143;&#25110;&#32452;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#20123;&#36719;&#20214;&#21253;&#38656;&#35201;&#19968;&#20010; locale</span>
localedef -i C -f UTF-8 C.UTF-8

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27979;&#35797;&#29992;&#25143;&#29992;&#20110;&#27979;&#35797;&#65292;&#21487;&#20197;&#19981;&#21019;&#24314;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;&#20102;&#31227;&#38500; &#8220;I have no name!&#8221; &#25552;&#31034;&#31526;&#65292;&#38656;&#35201;&#25171;&#24320;&#19968;&#20010;&#26032; shell</span>
<span style="color: #a020f0;">exec</span> /usr/bin/bash --login

<span style="color: #b22222;">#</span><span style="color: #b22222;">login&#12289;agetty &#21644; init &#31561;&#31243;&#24207;&#20351;&#29992;&#19968;&#20123;&#26085;&#24535;&#25991;&#20214;&#65292;&#20197;&#35760;&#24405;&#30331;&#24405;&#31995;&#32479;&#30340;&#29992;&#25143;&#21644;&#30331;&#24405;&#26102;&#38388;&#31561;&#20449;&#24687;&#12290;&#28982;&#32780;&#65292;&#36825;&#20123;&#31243;&#24207;&#19981;&#20250;&#21019;&#24314;&#19981;&#23384;&#22312;&#30340;&#26085;&#24535;&#25991;&#20214;&#12290;&#21021;&#22987;&#21270;&#26085;&#24535;&#25991;&#20214;&#65292;&#24182;&#20026;&#23427;&#20204;&#35774;&#32622;&#21512;&#36866;&#30340;&#35775;&#38382;&#26435;&#38480;</span>
touch /var/log/{btmp,lastlog,faillog,wtmp}
chgrp -v utmp /var/log/lastlog
chmod -v 664  /var/log/lastlog
chmod -v 600  /var/log/btmp

</pre>
</div>
</div>
</div>
<div id="outline-container-h:3573458b-9f06-4ce8-8d97-05ee5f39cd70" class="outline-4">
<h4 id="h:3573458b-9f06-4ce8-8d97-05ee5f39cd70">Gettext-0.22.5</h4>
<div class="outline-text-4" id="text-h:3573458b-9f06-4ce8-8d97-05ee5f39cd70">
<p>
chroot环境
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#29992;&#27493;&#39588;&#65292;&#35299;&#21387;&#21253;</span>
<span style="color: #483d8b;">cd</span> /sources
tar xf &#36719;&#20214;&#21253;
<span style="color: #483d8b;">cd</span> &#36719;&#20214;&#21253;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36719;&#20214;&#32534;&#35793;&#65292;&#20197;&#25991;&#26723;&#20026;&#20934;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#35793;&#23436;&#36820;&#22238;&#28304;&#30721;&#21253;&#30446;&#24405;&#65292;&#21024;&#38500;&#35299;&#21387;&#30340;&#21253;&#30446;&#24405;</span>
<span style="color: #483d8b;">cd</span> /sources
rm -fr &#36719;&#20214;&#21253;&#35299;&#21387;&#30340;&#30446;&#24405;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:7e0533d5-fdab-4b83-a261-23d2fe580908" class="outline-4">
<h4 id="h:7e0533d5-fdab-4b83-a261-23d2fe580908">Bison-3.8.2</h4>
<div class="outline-text-4" id="text-h:7e0533d5-fdab-4b83-a261-23d2fe580908">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:9f7b70c1-49eb-451a-95e2-d3ffac1f78b1" class="outline-4">
<h4 id="h:9f7b70c1-49eb-451a-95e2-d3ffac1f78b1">Perl-5.40.0</h4>
<div class="outline-text-4" id="text-h:9f7b70c1-49eb-451a-95e2-d3ffac1f78b1">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:1706a6be-f698-4c96-a077-f2d4378d5524" class="outline-4">
<h4 id="h:1706a6be-f698-4c96-a077-f2d4378d5524">Python-3.12.5</h4>
<div class="outline-text-4" id="text-h:1706a6be-f698-4c96-a077-f2d4378d5524">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:d3bbeaa0-3f1c-4105-aef8-7d922380bf37" class="outline-4">
<h4 id="h:d3bbeaa0-3f1c-4105-aef8-7d922380bf37">Texinfo-7.1</h4>
<div class="outline-text-4" id="text-h:d3bbeaa0-3f1c-4105-aef8-7d922380bf37">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:c3d4c960-57c8-4ead-9da7-11b57f29ece7" class="outline-4">
<h4 id="h:c3d4c960-57c8-4ead-9da7-11b57f29ece7">Util-linux-2.40.2</h4>
<div class="outline-text-4" id="text-h:c3d4c960-57c8-4ead-9da7-11b57f29ece7">
<p>
同上
</p>
</div>
</div>
<div id="outline-container-h:b8de7ed6-4f31-4526-ac9a-afbdc25f9e01" class="outline-4">
<h4 id="h:b8de7ed6-4f31-4526-ac9a-afbdc25f9e01">清理和备份临时系统</h4>
<div class="outline-text-4" id="text-h:b8de7ed6-4f31-4526-ac9a-afbdc25f9e01">
<p>
1.清理
</p>

<p>
chroot环境
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500;&#24050;&#32463;&#23433;&#35013;&#30340;&#20020;&#26102;&#24037;&#20855;&#25991;&#26723;&#25991;&#20214;&#65292;&#20197;&#38450;&#27490;&#23427;&#20204;&#36827;&#20837;&#26368;&#32456;&#26500;&#24314;&#30340;&#31995;&#32479;</span>
rm -rf /usr/share/{info,man,doc}/*
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;&#29616;&#20195; Linux &#31995;&#32479;&#20013;&#65292;libtool &#30340; .la &#25991;&#20214;&#20165;&#29992;&#20110; libltdl&#12290;LFS &#20013;&#27809;&#26377;&#24211;&#36890;&#36807; libltdl &#21152;&#36733;&#65292;&#32780;&#19988;&#24050;&#30693;&#19968;&#20123; .la &#25991;&#20214;&#20250;&#23548;&#33268; BLFS &#36719;&#20214;&#21253;&#20986;&#29616;&#24322;&#24120;&#12290;&#29616;&#22312;&#21024;&#38500;&#36825;&#20123;&#25991;&#20214;</span>
find /usr/{lib,libexec} -name <span style="color: #8b2252;">\*</span>.la -delete
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25105;&#20204;&#24050;&#32463;&#19981;&#38656;&#35201;&#20854;&#20013;&#30340; /tools &#30446;&#24405;&#20102;</span>
rm -rf /tools
</pre>
</div>

<p>
2.备份
</p>

<p>
可不做
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;&#36827;&#34892;&#22791;&#20221;&#20043;&#21069;&#65292;&#35299;&#38500;&#20869;&#26680;&#34394;&#25311;&#25991;&#20214;&#31995;&#32479;&#30340;&#25346;&#36733;</span>
mountpoint -q $<span style="color: #a0522d;">LFS</span>/dev/shm &amp;&amp; umount $<span style="color: #a0522d;">LFS</span>/dev/shm
umount $<span style="color: #a0522d;">LFS</span>/dev/pts
umount $<span style="color: #a0522d;">LFS</span>/{sys,proc,run,dev}

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22791;&#20221;</span>
<span style="color: #483d8b;">cd</span> $<span style="color: #a0522d;">LFS</span>
tar -cJpf $<span style="color: #a0522d;">HOME</span>/lfs-temp-tools-r12.2-17-systemd.tar.xz .
</pre>
</div>

<p>
需要按照(<a href="#h:3bd969cb-bd91-4cd5-8f3e-750ac3f32820">准备虚拟内核文件系统</a>) “准备虚拟内核文件系统”的描述重新挂载内核虚拟文件系统，并重新进入 chroot 环境(<a href="#h:ec350cc3-90b9-4ed3-9d02-e22dba00591d">进入 Chroot 环境</a>)
</p>

<p>
范例: 重新挂载, 并chroot
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">LFS</span>
mount /dev/sda5 $<span style="color: #a0522d;">LFS</span> -v

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25346;&#36733;&#21644;&#22635;&#20805; /dev</span>
mount -v --bind /dev $<span style="color: #a0522d;">LFS</span>/dev

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25346;&#36733;&#34394;&#25311;&#20869;&#26680;&#25991;&#20214;&#31995;&#32479;</span>
mount -vt devpts devpts -o <span style="color: #a0522d;">gid</span>=5,<span style="color: #a0522d;">mode</span>=0620 $<span style="color: #a0522d;">LFS</span>/dev/pts
mount -vt proc proc $<span style="color: #a0522d;">LFS</span>/proc
mount -vt sysfs sysfs $<span style="color: #a0522d;">LFS</span>/sys
mount -vt tmpfs tmpfs $<span style="color: #a0522d;">LFS</span>/run

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;&#26576;&#20123;&#23487;&#20027;&#31995;&#32479;&#19978;&#65292;/dev/shm &#26159;&#19968;&#20010;&#31526;&#21495;&#38142;&#25509;&#65292;&#36890;&#24120;&#25351;&#21521; /run/shm &#30446;&#24405;&#12290;&#25105;&#20204;&#24050;&#32463;&#22312; /run &#19979;&#25346;&#36733;&#20102; tmpfs &#25991;&#20214;&#31995;&#32479;&#65292;&#22240;&#27492;&#22312;&#36825;&#37324;&#21482;&#38656;&#35201;&#21019;&#24314;&#19968;&#20010;&#35775;&#38382;&#26435;&#38480;&#31526;&#21512;&#35201;&#27714;&#30340;&#30446;&#24405;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;&#20854;&#20182;&#23487;&#20027;&#31995;&#32479;&#19978;&#65292;/dev/shm &#26159;&#19968;&#20010; tmpfs &#30340;&#25346;&#36733;&#28857;&#12290;&#27492;&#26102;&#65292;&#32465;&#23450;&#25346;&#36733; /dev &#21482;&#20250;&#22312; chroot &#29615;&#22659;&#20013;&#29983;&#25104; /dev/shm &#30446;&#24405;&#12290;&#36825;&#26679;&#65292;&#25105;&#20204;&#24517;&#39035;&#26174;&#24335;&#25346;&#36733;&#19968;&#20010; tmpfs&#65306;</span>
<span style="color: #a020f0;">if</span> [ -h $<span style="color: #a0522d;">LFS</span>/dev/shm ]; <span style="color: #a020f0;">then</span>
  install -v -d -m 1777 $<span style="color: #a0522d;">LFS</span>$(realpath /dev/shm)
<span style="color: #a020f0;">else</span>
  mount -vt tmpfs -o nosuid,nodev tmpfs $<span style="color: #a0522d;">LFS</span>/dev/shm
<span style="color: #a020f0;">fi</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">chroot</span>
chroot <span style="color: #8b2252;">"$LFS"</span> /usr/bin/env -i   <span style="color: #8b2252;">\</span>
    <span style="color: #a0522d;">HOME</span>=/root                  <span style="color: #8b2252;">\</span>
    <span style="color: #a0522d;">TERM</span>=<span style="color: #8b2252;">"$TERM"</span>                <span style="color: #8b2252;">\</span>
    <span style="color: #a0522d;">PS1</span>=<span style="color: #8b2252;">'(lfs chroot) \u:\w\$ '</span> <span style="color: #8b2252;">\</span>
    <span style="color: #a0522d;">PATH</span>=/usr/bin:/usr/sbin     <span style="color: #8b2252;">\</span>
    <span style="color: #a0522d;">MAKEFLAGS</span>=<span style="color: #8b2252;">"-j$(nproc)"</span>      <span style="color: #8b2252;">\</span>
    <span style="color: #a0522d;">TESTSUITEFLAGS</span>=<span style="color: #8b2252;">"-j$(nproc)"</span> <span style="color: #8b2252;">\</span>
    /bin/bash --login
</pre>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-h:b28c2e60-a1d7-4679-8f9a-de74016490fd" class="outline-2">
<h2 id="h:b28c2e60-a1d7-4679-8f9a-de74016490fd">构建 LFS 系统</h2>
<div class="outline-text-2" id="text-h:b28c2e60-a1d7-4679-8f9a-de74016490fd">
<p>
逐个安装和编译所有需要的软件包，设定引导脚本，以及安装内核。得到的 Linux 系统是一个基本系统，在它之上可以继续编译其他软件，以扩展系统，更好地满足需求。
</p>
</div>
<div id="outline-container-h:bc02fbf3-71ed-4d56-aa3a-7a341c4d0f81" class="outline-3">
<h3 id="h:bc02fbf3-71ed-4d56-aa3a-7a341c4d0f81">安装基本系统软件</h3>
<div class="outline-text-3" id="text-h:bc02fbf3-71ed-4d56-aa3a-7a341c4d0f81">
<p>
按文档说明安装软件, 保险起见，安装完运行测试。
</p>

<p>
<a href="https://www.linuxfromscratch.org/lfs/view/stable-systemd/chapter08/introduction.html">https://www.linuxfromscratch.org/lfs/view/stable-systemd/chapter08/introduction.html</a>
</p>

<p>
chroot环境
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#29992;&#27493;&#39588;&#65292;&#35299;&#21387;&#21253;</span>
<span style="color: #483d8b;">cd</span> /sources
tar xf &#36719;&#20214;&#21253;
<span style="color: #483d8b;">cd</span> &#36719;&#20214;&#21253;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36719;&#20214;&#32534;&#35793;&#65292;&#20197;&#25991;&#26723;&#20026;&#20934;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#35793;&#23436;&#36820;&#22238;&#28304;&#30721;&#21253;&#30446;&#24405;&#65292;&#21024;&#38500;&#35299;&#21387;&#30340;&#21253;&#30446;&#24405;</span>
<span style="color: #483d8b;">cd</span> /sources
rm -fr &#36719;&#20214;&#21253;&#35299;&#21387;&#30340;&#30446;&#24405;
</pre>
</div>
</div>
<div id="outline-container-h:7614d3a1-a873-45f7-815c-09ae5e78fedd" class="outline-4">
<h4 id="h:7614d3a1-a873-45f7-815c-09ae5e78fedd">移除调试符号</h4>
<div class="outline-text-4" id="text-h:7614d3a1-a873-45f7-815c-09ae5e78fedd">
<p>
包含这些调试符号会显著增大程序或库的体积。
</p>

<p>
chroot环境, 执行. 参考 <a href="https://www.linuxfromscratch.org/lfs/view/stable-systemd/chapter08/stripping.html">https://www.linuxfromscratch.org/lfs/view/stable-systemd/chapter08/stripping.html</a>
</p>
</div>
</div>
<div id="outline-container-h:c2e65dbe-c286-47cb-aeb1-953648e08914" class="outline-4">
<h4 id="h:c2e65dbe-c286-47cb-aeb1-953648e08914">清理系统</h4>
<div class="outline-text-4" id="text-h:c2e65dbe-c286-47cb-aeb1-953648e08914">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#28165;&#29702;&#22312;&#25191;&#34892;&#27979;&#35797;&#30340;&#36807;&#31243;&#20013;&#36951;&#30041;&#30340;&#19968;&#20123;&#25991;&#20214;</span>
rm -rf /tmp/{*,.*}

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312; /usr/lib &#21644; /usr/libexec &#30446;&#24405;&#20013;&#36824;&#26377;&#19968;&#20123;&#25193;&#23637;&#21517;&#20026; .la &#30340;&#25991;&#20214;&#12290;&#23427;&#20204;&#26159; "libtool &#26723;&#26696;" &#25991;&#20214;&#12290;&#23427;&#20204;&#22312;&#29616;&#20195; Linux &#31995;&#32479;&#20013;&#20165;&#29992;&#20110; libltdl&#12290;LFS &#20013;&#27809;&#26377;&#24211;&#34987;&#35774;&#35745;&#20026;&#36890;&#36807; libltdl &#21152;&#36733;&#65292;</span>
find /usr/lib /usr/libexec -name <span style="color: #8b2252;">\*</span>.la -delete

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27809;&#26377;&#23384;&#22312;&#24847;&#20041;&#30340;&#31243;&#24207;</span>
find /usr -depth -name $(uname -m)-lfs-linux-gnu<span style="color: #8b2252;">\*</span> | xargs rm -rf

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31227;&#38500;&#20020;&#26102; 'tester' &#29992;&#25143;&#36134;&#25143;, &#25105;&#20204;&#36825;&#37324;&#27809;&#26377;&#21019;&#24314;&#65292;&#21487;&#19981;&#25805;&#20316;</span>
userdel -r tester
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:ddfde966-a273-409d-8830-9752f65e8757" class="outline-3">
<h3 id="h:ddfde966-a273-409d-8830-9752f65e8757">系统配置</h3>
<div class="outline-text-3" id="text-h:ddfde966-a273-409d-8830-9752f65e8757">
</div>
<div id="outline-container-h:f2ee1b43-bcae-473a-83d8-4f1020dd5d45" class="outline-4">
<h4 id="h:f2ee1b43-bcae-473a-83d8-4f1020dd5d45">网络配置</h4>
<div class="outline-text-4" id="text-h:f2ee1b43-bcae-473a-83d8-4f1020dd5d45">
<p>
网络配置请根据自己机器的情况设置。
</p>

<p>
chroot环境
</p>

<p>
静态 IP 配置
</p>
<div class="org-src-container">
<pre class="src src-sh">cat &gt; /etc/systemd/network/10-eth-static.network &lt;&lt; <span style="color: #8b2252;">"EOF"</span>
<span style="color: #ffa54f;">[Match]</span>
<span style="color: #ffa54f;">Name=&lt;&#32593;&#32476;&#35774;&#22791;&#21517;&gt;</span>

<span style="color: #ffa54f;">[Network]</span>
<span style="color: #ffa54f;">Address=192.168.0.2/24</span>
<span style="color: #ffa54f;">Gateway=192.168.0.1</span>
<span style="color: #ffa54f;">DNS=192.168.0.1</span>
<span style="color: #ffa54f;">Domains=&lt;&#24744;&#30340;&#22495;&#21517;&gt;</span>
<span style="color: #ffa54f;">EOF</span>
</pre>
</div>

<p>
DHCP 配置
</p>
<div class="org-src-container">
<pre class="src src-sh">cat &gt; /etc/systemd/network/10-eth-dhcp.network &lt;&lt; <span style="color: #8b2252;">"EOF"</span>
<span style="color: #ffa54f;">[Match]</span>
<span style="color: #ffa54f;">Name=&lt;&#32593;&#32476;&#35774;&#22791;&#21517;wlp2s0&gt;</span>

<span style="color: #ffa54f;">[Network]</span>
<span style="color: #ffa54f;">DHCP=ipv4</span>

<span style="color: #ffa54f;">[DHCPv4]</span>
<span style="color: #ffa54f;">UseDomains=true</span>
<span style="color: #ffa54f;">EOF</span>
</pre>
</div>

<p>
创建 /etc/resolv.conf 文件
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524; /etc/resolv.conf &#19981;&#23384;&#22312;&#65292;systemd-resolved &#20250;&#23558;&#20854;&#21019;&#24314;&#20026;&#25351;&#21521; /run/systemd/resolve/stub-resolv.conf &#30340;&#31526;&#21495;&#38142;&#25509;&#12290;&#22240;&#27492;&#65292;&#19981;&#38656;&#35201;&#25163;&#21160;&#21019;&#24314; /etc/resolv.conf</span>
systemctl status systemd-resolved
</pre>
</div>

<p>
配置系统主机名
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"lfs-os"</span> &gt; /etc/hostname
</pre>
</div>

<p>
自定义 /etc/hosts 文件
</p>
<div class="org-src-container">
<pre class="src src-sh">cat &gt; /etc/hosts &lt;&lt; <span style="color: #8b2252;">"EOF"</span>
<span style="color: #ffa54f;"># Begin /etc/hosts</span>
<span style="color: #ffa54f;">127.0.0.1 localhost.localdomain localhost</span>
<span style="color: #ffa54f;">127.0.0.1 lfs-os</span>
<span style="color: #ffa54f;">::1       ip6-localhost ip6-loopback</span>
<span style="color: #ffa54f;">ff02::1   ip6-allnodes</span>
<span style="color: #ffa54f;">ff02::2   ip6-allrouters</span>

<span style="color: #ffa54f;"># End /etc/hosts</span>
<span style="color: #ffa54f;">EOF</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:07e05a40-7a9e-487d-9808-5f636779301f" class="outline-4">
<h4 id="h:07e05a40-7a9e-487d-9808-5f636779301f">配置系统时钟</h4>
<div class="outline-text-4" id="text-h:07e05a40-7a9e-487d-9808-5f636779301f">
<p>
网络时钟同步
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">systemd &#38468;&#24102;&#20102;&#19968;&#20010;&#21517;&#20026; systemd-timesyncd &#30340;&#23432;&#25252;&#31243;&#24207;&#65292;&#21487;&#20197;&#29992;&#20110;&#23558;&#31995;&#32479;&#26102;&#38388;&#19982;&#36828;&#31243; NTP &#26381;&#21153;&#22120;&#21516;&#27493;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20174; systemd &#29256;&#26412; 216 &#24320;&#22987;&#65292;systemd-timesyncd &#23432;&#25252;&#36827;&#31243;&#34987;&#40664;&#35748;&#21551;&#29992;&#12290;&#22914;&#26524;&#24076;&#26395;&#31105;&#29992;&#23427;</span>
systemctl disable systemd-timesyncd
</pre>
</div>
</div>
</div>
<div id="outline-container-h:85f932ea-b0a3-4a97-8956-83f978162110" class="outline-4">
<h4 id="h:85f932ea-b0a3-4a97-8956-83f978162110">配置系统 Locale</h4>
<div class="outline-text-4" id="text-h:85f932ea-b0a3-4a97-8956-83f978162110">
<div class="org-src-container">
<pre class="src src-sh">cat &gt; /etc/locale.conf &lt;&lt; <span style="color: #8b2252;">"EOF"</span>
<span style="color: #ffa54f;">LANG=en_US.UTF-8</span>
<span style="color: #ffa54f;">EOF</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#30331;&#24405; shell &#24448;&#24448;&#19981;&#20250;&#20351;&#29992; /etc/locale.conf &#20013;&#30340;&#35774;&#23450;&#12290;&#21019;&#24314; /etc/profile &#20197;&#35835;&#21462; /etc/locale.conf &#20013;&#30340; locale &#35774;&#23450;&#20540;&#24182;&#23548;&#20986;&#23427;&#20204;&#20197;&#35774;&#23450;&#24744;&#26399;&#26395;&#30340; locale</span>
cat &gt; /etc/profile &lt;&lt; <span style="color: #8b2252;">"EOF"</span>
<span style="color: #ffa54f;"># Begin /etc/profile</span>

<span style="color: #ffa54f;">for i in $(locale); do</span>
<span style="color: #ffa54f;">  unset ${i%=*}</span>
<span style="color: #ffa54f;">done</span>

<span style="color: #ffa54f;">if [[ "$TERM" = linux ]]; then</span>
<span style="color: #ffa54f;">  export LANG=C.UTF-8</span>
<span style="color: #ffa54f;">else</span>
<span style="color: #ffa54f;">  source /etc/locale.conf</span>

<span style="color: #ffa54f;">  for i in $(locale); do</span>
<span style="color: #ffa54f;">    key=${i%=*}</span>
<span style="color: #ffa54f;">    if [[ -v $key ]]; then</span>
<span style="color: #ffa54f;">      export $key</span>
<span style="color: #ffa54f;">    fi</span>
<span style="color: #ffa54f;">  done</span>
<span style="color: #ffa54f;">fi</span>

<span style="color: #ffa54f;"># End /etc/profile</span>
<span style="color: #ffa54f;">EOF</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:46f6918d-8694-4087-9dd3-596d7ac873d6" class="outline-4">
<h4 id="h:46f6918d-8694-4087-9dd3-596d7ac873d6">创建 /etc/inputrc 文件</h4>
<div class="outline-text-4" id="text-h:46f6918d-8694-4087-9dd3-596d7ac873d6">
<p>
inputrc 文件是 Readline 库的配置文件，该库在用户从终端输入命令行时提供编辑功能。
</p>

<div class="org-src-container">
<pre class="src src-sh">cat &gt; /etc/inputrc &lt;&lt; <span style="color: #8b2252;">"EOF"</span>
<span style="color: #ffa54f;"># Begin /etc/inputrc</span>
<span style="color: #ffa54f;"># Modified by Chris Lynn <a href="mailto:roryo%40roryo.dynup.net">&lt;roryo@roryo.dynup.net&gt;</a></span>

<span style="color: #ffa54f;"># Allow the command prompt to wrap to the next line</span>
<span style="color: #ffa54f;">set horizontal-scroll-mode Off</span>

<span style="color: #ffa54f;"># Enable 8-bit input</span>
<span style="color: #ffa54f;">set meta-flag On</span>
<span style="color: #ffa54f;">set input-meta On</span>

<span style="color: #ffa54f;"># Turns off 8th bit stripping</span>
<span style="color: #ffa54f;">set convert-meta Off</span>

<span style="color: #ffa54f;"># Keep the 8th bit for display</span>
<span style="color: #ffa54f;">set output-meta On</span>

<span style="color: #ffa54f;"># none, visible or audible</span>
<span style="color: #ffa54f;">set bell-style none</span>

<span style="color: #ffa54f;"># All of the following map the escape sequence of the value</span>
<span style="color: #ffa54f;"># contained in the 1st argument to the readline specific functions</span>
<span style="color: #ffa54f;">"\eOd": backward-word</span>
<span style="color: #ffa54f;">"\eOc": forward-word</span>

<span style="color: #ffa54f;"># for linux console</span>
<span style="color: #ffa54f;">"\e[1~": beginning-of-line</span>
<span style="color: #ffa54f;">"\e[4~": end-of-line</span>
<span style="color: #ffa54f;">"\e[5~": beginning-of-history</span>
<span style="color: #ffa54f;">"\e[6~": end-of-history</span>
<span style="color: #ffa54f;">"\e[3~": delete-char</span>
<span style="color: #ffa54f;">"\e[2~": quoted-insert</span>

<span style="color: #ffa54f;"># for xterm</span>
<span style="color: #ffa54f;">"\eOH": beginning-of-line</span>
<span style="color: #ffa54f;">"\eOF": end-of-line</span>

<span style="color: #ffa54f;"># for Konsole</span>
<span style="color: #ffa54f;">"\e[H": beginning-of-line</span>
<span style="color: #ffa54f;">"\e[F": end-of-line</span>

<span style="color: #ffa54f;"># End /etc/inputrc</span>
<span style="color: #ffa54f;">EOF</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:488711f9-8adf-47bc-a810-4c9c4dc68a83" class="outline-4">
<h4 id="h:488711f9-8adf-47bc-a810-4c9c4dc68a83">创建 /etc/shells 文件</h4>
<div class="outline-text-4" id="text-h:488711f9-8adf-47bc-a810-4c9c4dc68a83">
<div class="org-src-container">
<pre class="src src-sh">cat &gt; /etc/shells &lt;&lt; <span style="color: #8b2252;">"EOF"</span>
<span style="color: #ffa54f;"># Begin /etc/shells</span>

<span style="color: #ffa54f;">/bin/sh</span>
<span style="color: #ffa54f;">/bin/bash</span>

<span style="color: #ffa54f;"># End /etc/shells</span>
<span style="color: #ffa54f;">EOF</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:418ae55c-55b8-45a3-9d2d-a21355b7beb5" class="outline-3">
<h3 id="h:418ae55c-55b8-45a3-9d2d-a21355b7beb5">使 LFS 系统可引导</h3>
<div class="outline-text-3" id="text-h:418ae55c-55b8-45a3-9d2d-a21355b7beb5">
<p>
创建 /etc/fstab 文件，为新的 LFS 系统构建内核，以及安装 GRUB 引导加载器，使得系统引导时可以选择进入 LFS 系统。
</p>
</div>
<div id="outline-container-h:d168dfcb-929a-4f7c-9ea4-fa3d07e8255a" class="outline-4">
<h4 id="h:d168dfcb-929a-4f7c-9ea4-fa3d07e8255a">创建 /etc/fstab 文件</h4>
<div class="outline-text-4" id="text-h:d168dfcb-929a-4f7c-9ea4-fa3d07e8255a">
<div class="org-src-container">
<pre class="src src-sh">cat &gt; /etc/fstab &lt;&lt; <span style="color: #8b2252;">"EOF"</span>
<span style="color: #ffa54f;"># Begin /etc/fstab</span>

<span style="color: #ffa54f;"># file system  mount-point  type     options             dump  fsck</span>
<span style="color: #ffa54f;">#                                                              order</span>

<span style="color: #ffa54f;">/dev/sda5     /     ext4    defaults      0     0</span>

<span style="color: #ffa54f;"># End /etc/fstab</span>
<span style="color: #ffa54f;">EOF</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:e1bfae87-1ef2-44db-98a8-d453e40aacf7" class="outline-4">
<h4 id="h:e1bfae87-1ef2-44db-98a8-d453e40aacf7">Linux-6.10.5</h4>
<div class="outline-text-4" id="text-h:e1bfae87-1ef2-44db-98a8-d453e40aacf7">
<p>
编译内核
</p>

<p>
chroot环境
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#29992;&#27493;&#39588;&#65292;&#35299;&#21387;&#21253;</span>
<span style="color: #483d8b;">cd</span> $<span style="color: #a0522d;">LFS</span>/sources
tar xf linux-6.10.5.tar.xz
<span style="color: #483d8b;">cd</span> linux-6.10.5

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36719;&#20214;&#32534;&#35793;&#65292;&#20197;&#25991;&#26723;&#20026;&#20934;</span>
make mrproper

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#35793;&#20869;&#26680;&#65292;&#20197;&#25991;&#26723;&#20026;&#20934;&#183;</span>
make menuconfig

make -j9 &amp;&amp; make modules_install -j9

cp -iv arch/x86/boot/bzImage /boot/vmlinuz-6.10.5-lfs-12.2-systemd
cp -iv System.map /boot/System.map-6.10.5
cp -iv .config /boot/config-6.10.5
cp -r Documentation -T /usr/share/doc/linux-6.10.5

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37197;&#32622; Linux &#20869;&#26680;&#27169;&#22359;&#21152;&#36733;&#39034;&#24207;</span>
install -v -m755 -d /etc/modprobe.d
cat &gt; /etc/modprobe.d/usb.conf &lt;&lt; <span style="color: #8b2252;">"EOF"</span>
<span style="color: #ffa54f;"># Begin /etc/modprobe.d/usb.conf</span>

<span style="color: #ffa54f;">install ohci_hcd /sbin/modprobe ehci_hcd ; /sbin/modprobe -i ohci_hcd ; true</span>
<span style="color: #ffa54f;">install uhci_hcd /sbin/modprobe ehci_hcd ; /sbin/modprobe -i uhci_hcd ; true</span>

<span style="color: #ffa54f;"># End /etc/modprobe.d/usb.conf</span>
<span style="color: #ffa54f;">EOF</span>



<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#35793;&#23436;&#36820;&#22238;&#28304;&#30721;&#21253;&#30446;&#24405;&#65292;&#21024;&#38500;&#35299;&#21387;&#30340;&#21253;&#30446;&#24405;</span>
<span style="color: #483d8b;">cd</span> $<span style="color: #a0522d;">LFS</span>/sources
rm -fr linux-6.10.5
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d91826da-ea77-4883-87af-92b4fe8f8a35" class="outline-4">
<h4 id="h:d91826da-ea77-4883-87af-92b4fe8f8a35">使用 GRUB 设定引导过程</h4>
<div class="outline-text-4" id="text-h:d91826da-ea77-4883-87af-92b4fe8f8a35">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">cd</span> /tmp
grub-mkrescue --output=grub-img.iso
xorriso -as cdrecord -v <span style="color: #a0522d;">dev</span>=/dev/cdrw <span style="color: #a0522d;">blank</span>=as_needed grub-img.iso
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">grub-install /dev/sda
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">cat &gt; /boot/grub/grub.cfg &lt;&lt; <span style="color: #8b2252;">"EOF"</span>
<span style="color: #ffa54f;"># Begin /boot/grub/grub.cfg</span>
<span style="color: #ffa54f;">set default=0</span>
<span style="color: #ffa54f;">set timeout=5</span>

<span style="color: #ffa54f;">insmod part_gpt</span>
<span style="color: #ffa54f;">insmod ext2</span>
<span style="color: #ffa54f;">set root=(hd0,2)</span>

<span style="color: #ffa54f;">menuentry "GNU/Linux, Linux 6.10.5-lfs-12.2-systemd" {</span>
<span style="color: #ffa54f;">        linux   /boot/vmlinuz-6.10.5-lfs-12.2-systemd root=/dev/sda5 ro</span>
<span style="color: #ffa54f;">}</span>
<span style="color: #ffa54f;">EOF</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:bfc2dbb3-501c-456d-96f1-7134c0893fec" class="outline-3">
<h3 id="h:bfc2dbb3-501c-456d-96f1-7134c0893fec">收尾工作</h3>
<div class="outline-text-3" id="text-h:bfc2dbb3-501c-456d-96f1-7134c0893fec">
</div>
<div id="outline-container-h:718a8c7a-8f20-4a41-938a-f2ad4f7a2589" class="outline-4">
<h4 id="h:718a8c7a-8f20-4a41-938a-f2ad4f7a2589">收尾工作</h4>
<div class="outline-text-4" id="text-h:718a8c7a-8f20-4a41-938a-f2ad4f7a2589">
<p>
创建一个 /etc/lfs-release 文件。通过使用它，您 (或者我们，如果您向我们寻求帮助的话) 能够容易地找出当前安装的 LFS 系统版本。
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">echo</span> r12.2-17-systemd &gt; /etc/lfs-release
</pre>
</div>

<p>
描述系统状态
</p>
<div class="org-src-container">
<pre class="src src-sh">cat &gt; /etc/lsb-release &lt;&lt; <span style="color: #8b2252;">"EOF"</span>
<span style="color: #ffa54f;">DISTRIB_ID="Linux From Scratch"</span>
<span style="color: #ffa54f;">DISTRIB_RELEASE="r12.2-systemd"</span>
<span style="color: #ffa54f;">DISTRIB_CODENAME="Jasper"</span>
<span style="color: #ffa54f;">DISTRIB_DESCRIPTION="Linux From Scratch"</span>
<span style="color: #ffa54f;">EOF</span>


cat &gt; /etc/os-release &lt;&lt; <span style="color: #8b2252;">"EOF"</span>
<span style="color: #ffa54f;">NAME="Linux From Scratch"</span>
<span style="color: #ffa54f;">VERSION="r12.2-systemd"</span>
<span style="color: #ffa54f;">ID=lfs</span>
<span style="color: #ffa54f;">PRETTY_NAME="Linux From Scratch r12.2-systemd"</span>
<span style="color: #ffa54f;">VERSION_CODENAME="Jasper"</span>
<span style="color: #ffa54f;">HOME_URL="https://www.linuxfromscratch.org/lfs/"</span>
<span style="color: #ffa54f;">EOF</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ead0ae82-548b-40f1-ae3b-f4d37ff9c93b" class="outline-4">
<h4 id="h:ead0ae82-548b-40f1-ae3b-f4d37ff9c93b">重启系统</h4>
<div class="outline-text-4" id="text-h:ead0ae82-548b-40f1-ae3b-f4d37ff9c93b">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#39318;&#20808;&#36864;&#20986; chroot &#29615;&#22659;</span>
<span style="color: #a020f0;">logout</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35299;&#38500;&#34394;&#25311;&#25991;&#20214;&#31995;&#32479;&#30340;&#25346;&#36733;</span>
umount -v $<span style="color: #a0522d;">LFS</span>/dev/pts
mountpoint -q $<span style="color: #a0522d;">LFS</span>/dev/shm &amp;&amp; umount -v $<span style="color: #a0522d;">LFS</span>/dev/shm
umount -v $<span style="color: #a0522d;">LFS</span>/dev
umount -v $<span style="color: #a0522d;">LFS</span>/run
umount -v $<span style="color: #a0522d;">LFS</span>/proc
umount -v $<span style="color: #a0522d;">LFS</span>/sys

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35299;&#38500; LFS &#25991;&#20214;&#31995;&#32479;&#30340;&#25346;&#36733;</span>
umount -v $<span style="color: #a0522d;">LFS</span>
</pre>
</div>

<p>
现在重新启动系统。
</p>
</div>
</div>
</div>
</section>
</main class="container">
<footer id="postamble" class="status">
<footer data-astro-cid-sz7xmlte data-turbo-permanent id=rootFooter>
    <script>
        const shuffle = e => e.map((e => ({
            v: e,
            sort: Math.random()
        }))).sort(( (e, o) => e.sort - o.sort)).map(( ({v: e}) => e));
        var songList = ["barbie-girl--stantough", "blue-da-ba-dee--cornelius-link", "hips-dont-lie--stantough", "i-want-it-that-way--stantough", "seven-nation-army--stantough", "smooth-criminal--stantough"]
          , songOrder = songOrder ?? shuffle(songList).map((e => `/audio/music/${e}.opus`))
          , song = new Audio(songOrder[0])
          , nextSong = new Audio(songOrder[1])
          , songIndex = 2
          , musicWrapper = void 0
          , arrow = void 0
          , notes = void 0;
        song.addEventListener("ended", next);
        const toggle = () => song.paused ? play() : pause();
        function play() {
            song.play(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.add("shakeManHorse"),
            notes.classList.remove("hideNotes")
        }
        function pause() {
            song.pause(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.remove("shakeManHorse"),
            notes.classList.add("hideNotes")
        }
        function next() {
            song = nextSong,
            play(),
            songIndex === songOrder.length && (songIndex = 0),
            nextSong = new Audio(songOrder[songIndex]),
            songIndex += 1
        }
        function skip() {
            pause(),
            (arrow = arrow || document.getElementById("musicArrow")).classList.add("shootArrow");
            new Audio("/audio/effects/ohno.m4a").play(),
            arrow.addEventListener("animationend", arrowShootHandler, !1)
        }
        function arrowShootHandler() {
            arrow.removeEventListener("animationend", arrowShootHandler, !1),
            arrow.classList.remove("shootArrow");
            new Audio("/audio/effects/heythathurt.m4a").play(),
            next()
        }
    </script>
    <div id=musicPlayer data-astro-cid-q7a5pyro>
        <button class=skip data-astro-cid-q7a5pyro onclick=skip() title="Skip song">
            <div id=skipWrapper data-astro-cid-q7a5pyro>
                <img alt="Medieval drollery of a man/snail/bat/monkey shooting an arrow" class=archer decoding=async height=334 loading=lazy src=/images/archer-no-arrow.448ccd8b_Z1KfRYq.webp width=226 data-astro-cid-q7a5pyro>
                <img alt="Arrow for archer" class="arrow complete" decoding=async height=23 loading=lazy src=/images/no-archer-full-arrow.87aa9971_Z2qL2KO.webp width=141 data-astro-cid-q7a5pyro id=musicArrow>
            </div>
        </button>
        <button class=playPause data-astro-cid-q7a5pyro onclick=toggle() title="Play/pause song">
            <div id=musicWrapper data-astro-cid-q7a5pyro>
                <div class=hideNotes id=notesWrapper data-astro-cid-q7a5pyro>
                    <div class=lyreNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                    <div class=fluteNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                </div>
                <img alt="Medieval drollery of a man/horse playing a lyre and a horn" class=manHorse decoding=async height=665 loading=lazy src=/images/man-horse-band.e3a2efcf_q8FCa.webp width=531 data-astro-cid-q7a5pyro>
            </div>
        </button>
    </div>
    <hr data-astro-cid-sz7xmlte>
    <div class=salutation data-astro-cid-gdmrbrho>
        <p data-astro-cid-gdmrbrho>
            <span class=flower2 data-astro-cid-gdmrbrho>A</span>
            <span class=smallcap data-astro-cid-gdmrbrho>pax vobiscum</span>
            <span class="flower2 wiggle" data-astro-cid-gdmrbrho id=leaf>a</span>
        </p>
    </div>
    <script>
        function animateLeafBlownHandler() {
            leaf.removeEventListener("animationend", animateLeafBlownHandler, !1),
            leaf.classList.remove("blownAway"),
            leaf.classList.add("wiggle")
        }
        function animateLeaf() {
            leaf = leaf ?? document.getElementById("leaf"),
            leaf.classList.remove("wiggle"),
            leaf.classList.add("blownAway"),
            leaf.addEventListener("animationend", animateLeafBlownHandler, !1)
        }
        document.getElementById("leaf").onclick = animateLeaf
    </script>


    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>打赏</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>© 2024 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
</footer>
</footer>
</body>
</html>
