<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linux: 企业级 shell 脚本编程</title>
<meta name="generator" content="Org Mode" />
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<link rel="stylesheet" type="text/css" href="https://blog.xuchangwei.com/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://blog.xuchangwei.com/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<link rel="stylesheet" type="text/css" href="https://blog.xuchangwei.com/org-html-themes/src/readtheorg_theme/css/code-copy.css"/>
<link rel="stylesheet" type="text/css" href="https://blog.xuchangwei.com/org-html-themes/src/readtheorg_theme/css/search.css"/>
<script src="https://blog.xuchangwei.com/org-html-themes/src/lib/js/jquery.min.js"></script>
<script src="https://blog.xuchangwei.com/org-html-themes/src/lib/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://blog.xuchangwei.com/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://blog.xuchangwei.com/org-html-themes/src/readtheorg_theme/js/search.js"></script>
<script type="text/javascript" src="https://blog.xuchangwei.com/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript" src="https://blog.xuchangwei.com/org-html-themes/src/readtheorg_theme/js/code-copy.js"></script>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Linux: 企业级 shell 脚本编程</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#编程基础">编程基础</a>
<ul>
<li><a href="#程序组成">程序组成</a></li>
<li><a href="#程序编程风格">程序编程风格</a></li>
<li><a href="#编程语言">编程语言</a></li>
<li><a href="#编程逻辑处理方式">编程逻辑处理方式</a></li>
<li><a href="#学习一种语言">学习一种语言</a>
<ul>
<li><a href="#shell基础用法">shell基础用法</a></li>
<li><a href="#shell词法">shell词法</a></li>
<li><a href="#shell语法">shell语法</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#shell-脚本语言的基本用法">shell 脚本语言的基本用法</a>
<ul>
<li><a href="#shell-脚本的用途">shell 脚本的用途</a></li>
<li><a href="#shell-脚本基本结构">shell 脚本基本结构</a></li>
<li><a href="#shell脚本创建过程">shell脚本创建过程</a></li>
<li><a href="#shell-脚本注释规范">shell 脚本注释规范</a></li>
<li><a href="#第一个脚本多种执行方法">第一个脚本，多种执行方法</a></li>
<li><a href="#shell-脚本调试">shell 脚本调试</a></li>
<li><a href="#变量">变量</a>
<ul>
<li><a href="#变量-1">变量</a></li>
<li><a href="#变量类型">变量类型</a></li>
<li><a href="#编程语言分类">编程语言分类</a></li>
<li><a href="#shell中变量命名法则">Shell中变量命名法则</a></li>
<li><a href="#变量定义和引用">变量定义和引用</a></li>
</ul>
</li>
<li><a href="#变量的拓展">变量的拓展</a>
<ul>
<li><a href="#环境变量">环境变量</a></li>
<li><a href="#只读变量">只读变量</a></li>
<li><a href="#位置变量">位置变量</a></li>
<li><a href="#退出状态码变量">退出状态码变量</a></li>
<li><a href="#展开命令行">展开命令行</a></li>
<li><a href="#脚本安全和-set">set命令和脚本安全</a></li>
<li><a href="#小结">小结</a></li>
</ul>
</li>
<li><a href="#shell算术运算">shell 算术运算</a>
<ul>
<li><a href="#算术表达式中进制转换"><code>算术表达式中进制转换</code></a></li>
</ul>
</li>
<li><a href="#h:2897e64f-fddf-4ccf-9370-7f21cd328c13">shell 逻辑运算</a></li>
<li><a href="#条件测试命令">条件测试命令</a>
<ul>
<li><a href="#变量测试">变量测试</a></li>
<li><a href="#数值测试">数值测试</a></li>
<li><a href="#字符串测试">字符串测试</a>
<ul>
<li><a href="#字符串是否为数字的方法">字符串是否为数字的方法</a></li>
</ul>
</li>
<li><a href="#文件测试">文件测试</a></li>
</ul>
</li>
<li><a href="#关于-和-中多个命令组合">关于 () 和 {}中多个命令组合</a></li>
<li><a href="#组合测试条件">组合测试条件</a>
<ul>
<li><a href="#第一种方式">第一种方式 [ ]</a></li>
<li><a href="#第二种方式">第二种方式 <code>[[]]</code></a></li>
</ul>
</li>
<li><a href="#输入输出">输入输出</a>
<ul>
<li><a href="#格式化输出-printf">格式化输出 printf</a></li>
<li><a href="#使用read命令来接受输入">使用read命令来接受输入</a></li>
<li><a href="#小结-1">小结</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#bash的配置文件">bash的配置文件</a>
<ul>
<li><a href="#按生效范围划分两类">按生效范围划分两类</a></li>
<li><a href="#shell登录两种方式分类">shell登录两种方式分类</a>
<ul>
<li><a href="#交互式登录">交互式登录</a></li>
<li><a href="#非交互式登录">非交互式登录</a></li>
</ul>
</li>
<li><a href="#按功能划分分类">按功能划分分类</a>
<ul>
<li><a href="#profile类">Profile类</a></li>
<li><a href="#bashrc类">Bashrc类</a></li>
</ul>
</li>
<li><a href="#编辑配置文件生效">编辑配置文件生效</a></li>
<li><a href="#bash-退出任务">Bash 退出任务</a></li>
</ul>
</li>
<li><a href="#流程控制">流程控制</a>
<ul>
<li><a href="#条件选择">条件选择</a>
<ul>
<li><a href="#条件判断分绍">条件判断分绍</a>
<ul>
<li><a href="#单分支条件">单分支条件</a></li>
<li><a href="#多分支条件">多分支条件</a></li>
</ul>
</li>
<li><a href="#选择执行-if-语句">选择执行 if 语句</a></li>
<li><a href="#条件判断-case-语句">条件判断 case 语句</a></li>
</ul>
</li>
<li><a href="#循环">循环</a>
<ul>
<li><a href="#循环执行介绍">循环执行介绍</a></li>
<li><a href="#for循环">for循环</a></li>
<li><a href="#while循环">while循环</a></li>
<li><a href="#until-循环">until 循环</a></li>
<li><a href="#循环控制语句-continue">循环控制语句 continue</a></li>
<li><a href="#循环控制语句-break">循环控制语句 break</a></li>
<li><a href="#循环控制-shift-命令">循环控制 shift 命令</a></li>
<li><a href="#h:f30b432e-f55e-4d03-81f7-a58fc9acd198">while 特殊用法 while read</a>
<ul>
<li><a href="#while-循环中使用ssh问题">while 循环中使用ssh问题</a></li>
</ul>
</li>
<li><a href="#select-循环与菜单">select 循环与菜单</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#function">函数 function</a>
<ul>
<li><a href="#函数介绍">函数介绍</a></li>
<li><a href="#管理函数">管理函数</a>
<ul>
<li><a href="#定义函数">定义函数</a></li>
<li><a href="#查看函数">查看函数</a></li>
<li><a href="#删除函数">删除函数</a></li>
</ul>
</li>
<li><a href="#函数调用">函数调用</a>
<ul>
<li><a href="#交互式环境调用函数">交互式环境调用函数</a></li>
<li><a href="#在脚本中定义及使用函数">在脚本中定义及使用函数</a></li>
<li><a href="#使用函数文件">使用函数文件</a></li>
</ul>
</li>
<li><a href="#函数返回值">函数返回值</a></li>
<li><a href="#环境函数">环境函数</a></li>
<li><a href="#函数参数">函数参数</a></li>
<li><a href="#函数变量">函数变量</a></li>
<li><a href="#函数递归">函数递归</a>
<ul>
<li><a href="#fork-炸弹">fork 炸弹</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#其它脚本相关工具">其它脚本相关工具</a>
<ul>
<li><a href="#信号捕捉-trap">信号捕捉 trap</a>
<ul>
<li><a href="#常见的信号">常见的信号</a></li>
<li><a href="#信号捕捉-trap-1">信号捕捉 trap</a></li>
</ul>
</li>
<li><a href="#创建临时文件-mktemp">创建临时文件 mktemp</a></li>
<li><a href="#安装复制文件-install">安装复制文件 install</a></li>
<li><a href="#交互式转化批处理工具-expect">交互式转化批处理工具 expect</a></li>
<li><a href="#脚本添加二进制文件">脚本添加二进制文件</a></li>
<li><a href="#脚本转二进制执行文件">脚本转二进制执行文件</a></li>
</ul>
</li>
<li><a href="#数组array">数组array</a>
<ul>
<li><a href="#数组介绍">数组介绍</a></li>
<li><a href="#声明数组">声明数组</a></li>
<li><a href="#数组赋值">数组赋值</a></li>
<li><a href="#显示所有数组">显示所有数组</a></li>
<li><a href="#引用数组">引用数组</a></li>
<li><a href="#删除数组">删除数组</a></li>
<li><a href="#数组数据处理">数组数据处理</a></li>
<li><a href="#关联数组">关联数组</a></li>
<li><a href="#范例">范例</a></li>
</ul>
</li>
<li><a href="#字符串处理">字符串处理</a>
<ul>
<li><a href="#字符串切片">字符串切片</a></li>
<li><a href="#查找替换">查找替换</a></li>
<li><a href="#查找并删除">查找并删除</a></li>
<li><a href="#字符大小写转换">字符大小写转换</a></li>
</ul>
</li>
<li><a href="#高级变量">高级变量</a>
<ul>
<li><a href="#高级变量赋值">高级变量赋值</a>
<ul>
<li><a href="#单行多变量赋值">单行多变量赋值</a></li>
<li><a href="#变量与命令单行存在">变量与命令单行存在</a></li>
</ul>
</li>
<li><a href="#高级变量用法-有类型变量">高级变量用法-有类型变量</a></li>
<li><a href="#变量间接引用">变量间接引用</a>
<ul>
<li><a href="#eval命令">eval命令</a></li>
<li><a href="#间接变量引用">间接变量引用</a></li>
<li><a href="#变量引用reference">变量引用reference</a></li>
<li><a href="#set命令">set命令</a></li>
<li><a href="#枚举变量">枚举变量</a></li>
</ul>
</li>
<li><a href="#bash选项">bash选项</a>
<ul>
<li><a href="#交互shell设置位置参数">交互shell设置位置参数</a></li>
<li><a href="#脚本所在目录">脚本所在目录</a></li>
<li><a href="#eof多行写入文件防止变量替换">EOF多行写入文件防止变量替换</a></li>
<li><a href="#多行注释">多行注释</a></li>
<li><a href="#长命令的换行以及注释处理">长命令的换行以及注释处理</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:0d4b3171-2192-474a-897d-0686ca53e567">set命令总结</a>
<ul>
<li><a href="#h:eb4430e3-1a38-43f7-af88-41c103a562a5">位置参数</a></li>
<li><a href="#h:d093911d-ab87-424a-b1c1-303674e0d01e">set 命令实现脚本安全</a></li>
</ul>
</li>
<li><a href="#设计shell脚本选项getopt">设计shell脚本选项：getopt</a>
<ul>
<li><a href="#命令行选项的那些事">命令行选项的那些事</a>
<ul>
<li><a href="#区分optionparameterargumentoption-argument和non-option-parameter">1.区分option、parameter、argument、option argument和non-option parameter</a></li>
<li><a href="#短选项和长选项以及它们的潜规则">2.短选项和长选项以及它们的”潜规则”</a></li>
<li><a href="#不带参数的选项可选参数的选项和带参数的选项">3.不带参数的选项、可选参数的选项和带参数的选项</a></li>
<li><a href="#使用将选项及它们的选项参数与非选项类型参数进行分隔">4.使用”&#x2013;“将选项(及它们的选项参数)与非选项类型参数进行分隔</a></li>
<li><a href="#命令行参数中的短横线开头的并不一定总是短选项也可能是负数参数">5.命令行参数中的短横线开头的并不一定总是短选项，也可能是负数参数</a></li>
<li><a href="#选项的依赖性和互斥性">6.选项的依赖性和互斥性</a></li>
<li><a href="#模式化模块化类型的选项">7.模式化(模块化)类型的选项</a></li>
<li><a href="#其他特性的选项">8.其他特性的选项</a></li>
</ul>
</li>
<li><a href="#getopt解析选项的工作机制">getopt解析选项的工作机制</a>
<ul>
<li><a href="#getopt选项">1 getopt选项</a></li>
<li><a href="#getopt如何解析选项和参数">2 getopt如何解析选项和参数</a></li>
<li><a href="#示例分析getopt的解析方式">3 示例分析getopt的解析方式</a></li>
</ul>
</li>
<li><a href="#处理getopt解析的结果">处理getopt解析的结果</a></li>
<li><a href="#getopt的两种扫描模式">getopt的两种扫描模式</a></li>
<li><a href="#如何实现命令行选项的各种个性功能">如何实现命令行选项的各种个性功能</a>
<ul>
<li><a href="#选项依赖性">1.选项依赖性</a></li>
<li><a href="#选项互斥性">2.选项互斥性</a></li>
<li><a href="#识别负数参数">3.识别负数参数</a></li>
<li><a href="#模式化选项">4.模式化选项</a></li>
<li><a href="#选项参数替代选项">5.选项参数替代选项</a></li>
</ul>
</li>
<li><a href="#使用getopt设计shell脚本选项示例">6.使用getopt设计shell脚本选项示例</a></li>
</ul>
</li>
<li><a href="#脚本编程进阶-07-shell多进程并发执行">shell多进程并发执行</a>
<ul>
<li><a href="#普通脚本">普通脚本</a></li>
<li><a href="#子shell后台运行">子shell后台运行</a></li>
<li><a href="#配合wait运行">配合wait运行</a></li>
<li><a href="#管道的特性">管道的特性</a></li>
<li><a href="#多进程中的管道与重定向">多进程中的管道与重定向</a>
<ul>
<li><a href="#管道来并发控制">管道来并发控制</a></li>
<li><a href="#完整的例子">完整的例子</a></li>
</ul>
</li>
<li><a href="#应用场景">应用场景</a></li>
</ul>
</li>
<li><a href="#bash高级重定向">Bash高级重定向</a>
<ul>
<li><a href="#h:2e4f6100-bdfd-4230-b5e1-10057944b81f">Bash高级重定向</a>
<ul>
<li><a href="#获取当前终端">获取当前终端</a></li>
<li><a href="#bash初始分配的文件描述符">Bash初始分配的文件描述符</a></li>
<li><a href="#再看基础重定向操作">再看基础重定向操作</a></li>
<li><a href="#close-file-关闭文件描述符">close file 关闭文件描述符</a></li>
<li><a href="#fd-duplicate-文件描述符的复制">fd duplicate 文件描述符的复制</a></li>
<li><a href="#fd-move-文件描述符的移动">fd move 文件描述符的移动</a></li>
<li><a href="#自动分配文件描述符号">自动分配文件描述符号</a></li>
<li><a href="#read从文件描述符读取数据">read从文件描述符读取数据</a></li>
</ul>
</li>
<li><a href="#bash中的here-document">bash中的here document</a>
<ul>
<li><a href="#将here-document内容写进文件">将here document内容写进文件</a></li>
<li><a href="#将here-document内容放进管道">将here document内容放进管道</a></li>
<li><a href="#多个here-document嵌套">多个here document嵌套</a></li>
</ul>
</li>
<li><a href="#脚本编程补缺-01-shell里的进程替换process-substitution">shell里的进程替换(Process Substitution)</a></li>
</ul>
</li>
<li><a href="#h:8298d36b-6a38-4fd6-a0af-e751d5f071e4">嵌套子命令</a>
<ul>
<li><a href="#bash自动补全">bash自动补全</a>
<ul>
<li><a href="#补全说明">补全说明</a>
<ul>
<li><a href="#complete-补全命令">complete 补全命令</a></li>
<li><a href="#compgen-筛选命令">compgen 筛选命令</a></li>
<li><a href="#compopt-修改补全命令设置">compopt 修改补全命令设置</a></li>
<li><a href="#内置补全变量">内置补全变量</a></li>
</ul>
</li>
<li><a href="#参数自动补全">参数自动补全</a></li>
<li><a href="#别名补全">别名补全</a></li>
</ul>
</li>
<li><a href="#zsh自动补全">zsh自动补全</a>
<ul>
<li><a href="#参数自动补全-1">参数自动补全</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:bb7efdc7-d751-41a0-90e8-ff52fc4f8a5b">man帮助和实用技巧</a>
<ul>
<li><a href="#man-bash">man bash</a></li>
<li><a href="#shell中判断字符串是否为数字的6种方法">Shell中判断字符串是否为数字的6种方法</a></li>
<li><a href="#linux下的命令可以用来作计算bcexprdcechoawk">linux下的命令可以用来作计算bc、expr、dc、echo、awk</a></li>
<li><a href="#shell进度条">shell进度条</a></li>
<li><a href="#随机数">随机数</a>
<ul>
<li><a href="#h:e586927b-fe45-4eb1-a8f6-8652a97f15d3">脚本：使用系统的 $RANDOM 变量</a></li>
<li><a href="#h:47165a11-7373-4701-962a-11137cfffb6a">脚本：使用date +%s%N</a></li>
<li><a href="#h:d9ac9287-b746-436f-b2fc-7ee028b9ef52">脚本：使用/dev/random 和 /dev/urandom /dev/random</a></li>
<li><a href="#h:b8f8ab6d-24c0-44dd-a56f-5f7f99e15f2d">脚本：使用linux uuid uuid</a></li>
<li><a href="#h:e725f088-1ab5-4783-a77e-7c24ff0bac31">脚本：python</a></li>
<li><a href="#h:07f91ee1-7fa8-42c3-9876-ff75a502787b">生成随机数：date +%s%N</a></li>
<li><a href="#h:5b5f44e1-8e7c-499f-9e3c-1356eb0ab266">生成随机数：/dev/urandom和tr命令</a></li>
<li><a href="#h:b019867c-6b9f-4fc5-b891-67bb700dd754">生成随机数：openssl rand</a></li>
<li><a href="#h:cd75f786-e9ed-421c-978b-e65fa183023c">生成随机数：pwgen</a></li>
</ul>
</li>
<li><a href="#批量删除子目录下的文件保留指定数量的最新文件">批量删除子目录下的文件，保留指定数量的最新文件</a></li>
<li><a href="#秒级脚本">秒级脚本</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="././index.html">Script</a></li>
</ul>

<p>
内容概述
</p>

<ul class="org-ul">
<li>编程基础</li>
<li>脚本基本格式</li>
<li>变量</li>
<li>运算</li>
<li>条件测试</li>
<li>配置用户环境</li>
<li>循环</li>
<li>信号捕捉</li>
<li>函数</li>
<li>数组</li>
<li>高级字符串操作</li>
<li>高级变量</li>
<li>expect</li>
</ul>
<section id="outline-container-编程基础" class="outline-2">
<h2 id="编程基础"><a href="#编程基础">编程基础</a></h2>
<div class="outline-text-2" id="text-编程基础">
<p>
Linus：Talk is cheap, show me the code
</p>

<p>
简明教程：
</p>
<ul class="org-ul">
<li><a href="https://liujiacai.net/blog/2024/04/05/robust-shell-scripting/">健壮 Shell 脚本编写指南</a></li>
<li><a href="https://learnxinyminutes.com/docs/bash/">Learn X in Y minutes Where X=bash</a> <a href="https://learnxinyminutes.com/docs/zh-cn/bash-cn/">中文</a></li>
</ul>
</div>
<div id="outline-container-程序组成" class="outline-3">
<h3 id="程序组成"><a href="#程序组成">程序组成</a></h3>
<div class="outline-text-3" id="text-程序组成">
<ul class="org-ul">
<li>程序：算法+数据结构</li>
<li>数据：是程序的核心</li>
<li>数据结构：数据在计算机中的类型和组织方式</li>
<li>算法：处理数据的方式</li>
</ul>
</div>
</div>
<div id="outline-container-程序编程风格" class="outline-3">
<h3 id="程序编程风格"><a href="#程序编程风格">程序编程风格</a></h3>
<div class="outline-text-3" id="text-程序编程风格">
<p>
面向过程语言
</p>

<ul class="org-ul">
<li>做一件事情，排出个步骤，第一步干什么，第二步干什么，如果出现情况A，
做什么处理，如果出现了情况B，做什么处理</li>
<li>问题规模小，可以步骤化，按部就班处理</li>
<li>以指令为中心，数据服务于指令</li>
<li>C，shell</li>
</ul>

<p>
面向对象语言
</p>

<ul class="org-ul">
<li>一种认识世界、分析世界的方法论。将万事万物抽象为各种对象</li>
<li>类是抽象的概念，是万事万物的抽象，是一类事物的共同特征的集合</li>
<li>对象是类的具象，是一个实体</li>
<li>问题规模大，复杂系统</li>
<li>以数据为中心，指令服务于数据</li>
<li>java，C#，python，golang等</li>
</ul>
</div>
</div>
<div id="outline-container-编程语言" class="outline-3">
<h3 id="编程语言"><a href="#编程语言">编程语言</a></h3>
<div class="outline-text-3" id="text-编程语言">
<p>
计算机：运行二进制指令
</p>

<p>
编程语言：人与计算机之间交互的语言。分为两种：低级语言和高级语言
</p>

<ul class="org-ul">
<li><p>
低级编程语言：
</p>

<p>
机器：二进制的0和1的序列，称为机器指令。与自然语言差异太大，难懂、难
写
</p>

<p>
汇编：用一些助记符号替代机器指令，称为汇编语言 如：ADD A,B 将寄存器A的数与寄存器B的数相加得到的数放到寄存器A中
</p>

<p>
汇编语言写好的程序需要汇编程序转换成机器指令
</p>

<p>
汇编语言稍微好理解，即机器指令对应的助记符，助记符更接近自然语言
</p></li>

<li><p>
高级编程语言：
</p>

<p>
编译：高级语言&#x2013;&gt;编译器&#x2013;&gt;机器代码文件&#x2013;&gt;执行，如：C，C++
</p>

<p>
解释：高级语言&#x2013;&gt;执行&#x2013;&gt;解释器&#x2013;&gt;机器代码，如：shell，python，php，JavaScript，perl
</p></li>
</ul>

<p>
<b>编译和解释型语言</b>
</p>


<figure id="orgd5d19b6">
<img src="././images/image-20210206103827805.png" alt="image-20210206103827805.png" width="50%">

</figure>

<p>
根据运行的方式
</p>

<ul class="org-ul">
<li><p>
编译运行：
</p>

<p>
源代码&#x2013;&gt;编译器(编译)&#x2013;&gt;程序文件
</p>

<p>
优点：运行速度快
</p>

<p>
缺点：不利于bug调试，需要重新编译
</p>

<p>
如，C 语言特性
</p>

<p>
C 语言写出的源代码本身几乎整个会编译成一个指定的二进制程序文件，当然
也有可能是1 个或多个也有可能是库文件。它的整个程序代码中的内容都是根
据程序源自己的组织逻辑包括关键词、变量或者库组织起来。
</p>

<p>
而脚本编程是借助外部程序来完成的。
</p></li>

<li><p>
解释运行：
</p>

<p>
源代码&#x2013;&gt;运行时启动解释器，由解释器变解释变运行
</p>

<p>
优点：方便调试，只要改源码，
</p>

<p>
缺点：运行性能相对差些，不过对人而言感知不到
</p></li>
</ul>
</div>
</div>
<div id="outline-container-编程逻辑处理方式" class="outline-3">
<h3 id="编程逻辑处理方式"><a href="#编程逻辑处理方式">编程逻辑处理方式</a></h3>
<div class="outline-text-3" id="text-编程逻辑处理方式">

<figure id="org276544e">
<img src="././images/image-20210206103855966.png" alt="image-20210206103855966.png" width="50%">

</figure>



<figure id="org093d686">
<img src="././images/image-20210206103923211.png" alt="image-20210206103923211.png" width="50%">

</figure>

<p>
<b>三种处理逻辑</b>
</p>

<ul class="org-ul">
<li>顺序执行：程序按从上到下顺序执行</li>
<li>选择执行：程序执行过程中，根据条件的不同，进行选择不同分支继续执行</li>
<li>循环执行：程序执行过程中需要重复执行多次某段语句</li>
</ul>
</div>
</div>
<div id="outline-container-学习一种语言" class="outline-3">
<h3 id="学习一种语言"><a href="#学习一种语言">学习一种语言</a></h3>
<div class="outline-text-3" id="text-学习一种语言">
<p>
1.词法（从字符到单词）
</p>

<p>
2.语法（从单词到句子）
</p>

<p>
3.语义（从句子到文章）
</p>

<p>
我们通常用语法来代表语言的用法。
</p>
</div>
<div id="outline-container-shell基础用法" class="outline-4">
<h4 id="shell基础用法"><a href="#shell基础用法">shell基础用法</a></h4>
<div class="outline-text-4" id="text-shell基础用法">
<p>
1.解释型脚本语言
</p>

<p>
2.解释器：bash,zsh,fish,ksh,sh&#x2026;
</p>

<p>
3.shell=任意命令+流程控制+结果容器
</p>

<p>
4.功能强大，代码量少，性能堪忧
</p>
</div>
</div>
<div id="outline-container-shell词法" class="outline-4">
<h4 id="shell词法"><a href="#shell词法">shell词法</a></h4>
<div class="outline-text-4" id="text-shell词法">
<p>
1.标识符 <code>[A-Za-z_] [A-Za-z_0-9]*</code>
</p>

<p>
2.关键字 <code>if,fi,then,function,...</code>
</p>

<p>
3.操作符 <code>&amp;&amp;, ||, &gt;, &lt;, |, ;, $</code>
</p>

<p>
4.字符串 <code>"string" 'string'</code>
</p>

<p>
5.注释 <code># comment</code>
</p>
</div>
</div>
<div id="outline-container-shell语法" class="outline-4">
<h4 id="shell语法"><a href="#shell语法">shell语法</a></h4>
<div class="outline-text-4" id="text-shell语法">
<p>
1.变量
</p>

<p>
2.输入输出
</p>

<p>
3.结果变换
</p>

<p>
4.流程控制
</p>

<p>
5.函数
</p>
</div>
</div>
</div>
</section>
<section id="outline-container-shell-脚本语言的基本用法" class="outline-2">
<h2 id="shell-脚本语言的基本用法"><a href="#shell-脚本语言的基本用法">shell 脚本语言的基本用法</a></h2>
<div class="outline-text-2" id="text-shell-脚本语言的基本用法">
</div>
<div id="outline-container-shell-脚本的用途" class="outline-3">
<h3 id="shell-脚本的用途"><a href="#shell-脚本的用途">shell 脚本的用途</a></h3>
<div class="outline-text-3" id="text-shell-脚本的用途">
<ul class="org-ul">
<li>自动化常用命令</li>
<li>执行系统管理和故障排除</li>
<li>创建简单的应用程序</li>
<li>处理文本或文件</li>
</ul>
</div>
</div>
<div id="outline-container-shell-脚本基本结构" class="outline-3">
<h3 id="shell-脚本基本结构"><a href="#shell-脚本基本结构">shell 脚本基本结构</a></h3>
<div class="outline-text-3" id="text-shell-脚本基本结构">
<p>
shell脚本编程：是基于过程式、解释执行的语言
</p>

<p>
编程语言的基本结构：
</p>

<ul class="org-ul">
<li>各种系统命令的组合</li>
<li>数据存储：变量、数组</li>
<li>表达式：a + b</li>
<li>控制语句：if</li>
</ul>

<p>
shell脚本：包含一些命令或声明，并符合一定格式的文本文件
</p>

<p>
格式要求： <code>首行shebang机制</code> ，用于指明解释执行当前脚本的解释器文件
</p>

<p>
常见的解释器：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">env</span><span class="org-comment"> bash
</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/python
</span><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/perl</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-shell脚本创建过程" class="outline-3">
<h3 id="shell脚本创建过程"><a href="#shell脚本创建过程">shell脚本创建过程</a></h3>
<div class="outline-text-3" id="text-shell脚本创建过程">
<ul class="org-ul">
<li><p>
第一步：使用文本编辑器来创建文本文件 第一行必须包括shell声明序列：#!
示例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span>
</pre>
</div>

<p>
添加注释,注释以#开头
</p></li>

<li><p>
第二步：加执行权限
</p>

<p>
给予执行权限，在命令行上指定脚本的绝对或相对路径
</p>

<div class="org-src-container">
<pre class="src src-sh">chmod +x file.sh
</pre>
</div></li>

<li><p>
第三步：运行脚本
</p>

<p>
直接运行解释器，将脚本作为解释器程序的参数运行
</p></li>
</ul>
</div>
</div>
<div id="outline-container-shell-脚本注释规范" class="outline-3">
<h3 id="shell-脚本注释规范"><a href="#shell-脚本注释规范">shell 脚本注释规范</a></h3>
<div class="outline-text-3" id="text-shell-脚本注释规范">
<ol class="org-ol">
<li>第一行一般为调用使用的语言</li>
<li>程序名，避免更改文件名为无法找到正确的文件</li>
<li>版本号</li>
<li>更改后的时间</li>
<li>作者相关信息</li>
<li>该程序的作用，及注意事项</li>
<li>最后是各版本的更新简要说明</li>
</ol>


<div class="org-src-container">
<pre class="src src-sh">cat &lt;&lt;\EOF &gt; ~/.vimrc<span class="org-sh-heredoc">
set ts=4
set expandtab
set ignorecase
set cursorline
set autoindent
autocmd BufNewFile *.sh exec ":call SetTitle()"
func SetTitle()
    if expand("%:e") == 'sh'
    call setline(1,"#!/bin/env bash") 
    call setline(2,"#") 
    call setline(3,"#********************************************************************") 
    call setline(4,"#Author:           jasperhsu") 
    call setline(5,"#QQ:               277147964") 
    call setline(6,"#Date:             ".strftime("%Y-%m-%d"))
    call setline(7,"#FileName:         ".expand("%"))
    call setline(8,"#URL:              https://jaspervincent.github.io")
    call setline(9,"#Description:      This is a script") 
    call setline(10,"#Copyright (C):    ".strftime("%Y")." CC BY-NC 4.0")
    call setline(11,"#License:          MIT") 
    call setline(12,"#********************************************************************") 
    call setline(13,"") 
    endif
endfunc
autocmd BufNewFile * normal G
EOF</span>
</pre>
</div>


<figure id="org42b13ae">
<img src="././images/image-20210206104300238.png" alt="image-20210206104300238.png" width="50%">

<figcaption><span class="figure-number">Figure 1: </span>image-20210206104300238</figcaption>
</figure>

<p>
良好的习惯：代码注释，缩进，适度添加空白行以示分隔：
</p>

<p>
<b>语言</b>
</p>

<p>
学习语言，每种语言都有自己的编程语法格式，除此外还学习大量的库调用、还
有算法和数据结构。脚本语言是最不像编程语言的语言了，系统的命令是shell
脚本编程的素材。
</p>

<p>
<b>Shell 脚本编程思想</b>
</p>

<p>
写程序一定要有”编程思想”，能够将学到的语言的语法格式随时转换成解决问
题的思路。
</p>

<p>
简单来讲，在生活中有许多问题需要解决，这个问题我们把它叫做“问题空间”，
解决”问题空间”中的问题就要形成”解空间”，"解空间"是由程序员提供的编
程语言，"问题空间"是由自然语言，我们要学会在两种语言中用不同的思路解决
问题。
</p>

<ul class="org-ul">
<li>文件空间&#x2013;&gt;解空间</li>
<li>背代码思路，读范文以及比较优秀的代码。</li>
</ul>
</div>
</div>
<div id="outline-container-第一个脚本多种执行方法" class="outline-3">
<h3 id="第一个脚本多种执行方法"><a href="#第一个脚本多种执行方法">第一个脚本，多种执行方法</a></h3>
<div class="outline-text-3" id="text-第一个脚本多种执行方法">
<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!SHEBANG
</span>CONFIGURATION_VARIABLES
FUNCTION_DEFINITIONS
MAIN_CODE
</pre>
</div>

<p>
范例：第一个 Shell 脚本 hello world 参考文档：
</p>

<ul class="org-ul">
<li><a href="https://zh.wikipedia.org/wiki/Hello_World">https://zh.wikipedia.org/wiki/Hello_World</a></li>
<li><a href="https://zh.wikipedia.org/wiki/Hello_World%E7%A8%8B%E5%BA%8F%E6%A0%B7%E4%BE%8B">https://zh.wikipedia.org/wiki/Hello_World%E7%A8%8B%E5%BA%8F%E6%A0%B7%E4%BE%8B</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#vim /data/hello.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">&#32463;&#20856;&#20889;&#27861;
</span><span class="org-builtin">echo</span> <span class="org-string">"hello, world"</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">&#27969;&#34892;&#20889;&#27861;
</span><span class="org-builtin">echo</span> <span class="org-string">'Hello, world!'</span>

<span class="org-comment-delimiter">#</span><span class="org-comment">&#25191;&#34892;&#26041;&#27861;1
</span>[root@centos8 ~]#bash /data/hello.sh

<span class="org-comment-delimiter">#</span><span class="org-comment">&#25191;&#34892;&#26041;&#27861;2
</span>[root@centos8 ~]#cat /data/hello.sh | bash

<span class="org-comment-delimiter">#</span><span class="org-comment">&#25191;&#34892;&#26041;&#27861;3
</span>[root@centos8 ~]#bash &lt; /data/hello.sh

<span class="org-comment-delimiter">#</span><span class="org-comment">&#25191;&#34892;&#26041;&#27861;4
</span>[root@centos8 ~]#chmod +x /data/hello.sh

<span class="org-comment-delimiter">#</span><span class="org-comment">&#32477;&#23545;&#36335;&#24452;
</span>[root@centos8 ~]#/data/hello.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">&#30456;&#27861;&#36335;&#24452;
</span>[root@centos8 ~]#cd /data/
[root@centos8 ~]#./hello.sh

<span class="org-comment-delimiter">#</span><span class="org-comment">&#25191;&#34892;&#26041;&#27861;5&#65292;&#26412;&#26041;&#27861;&#21487;&#20197;&#23454;&#29616;&#25191;&#34892;&#36828;&#31243;&#20027;&#26426;&#30340;shell&#33050;&#26412;
</span>[root@centos8 ~]#yum -y install httpd
[root@centos8 ~]#systemctl start httpd
[root@centos8 ~]#mv /data/hello.sh /var/www/html/

[root@centos8 ~]#curl http://10.0.0.8/hello.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter"># </span><span class="org-comment">------------------------------------------
</span><span class="org-comment-delimiter"># </span><span class="org-comment">Filename: hello.sh
</span><span class="org-comment-delimiter"># </span><span class="org-comment">Version: &#160;1.0
</span><span class="org-comment-delimiter"># </span><span class="org-comment">Date: 2017/06/01
</span><span class="org-comment-delimiter"># </span><span class="org-comment">Author: xxx
</span><span class="org-comment-delimiter"># </span><span class="org-comment">Email: xxx@xxx.com
</span><span class="org-comment-delimiter"># </span><span class="org-comment">Description: This is the first script
</span><span class="org-comment-delimiter"># </span><span class="org-comment">Copyright: 2017
</span><span class="org-comment-delimiter"># </span><span class="org-comment">License: GPL
</span><span class="org-comment-delimiter"># </span><span class="org-comment">------------------------------------------
</span><span class="org-comment-delimiter">#</span><span class="org-comment">&#32463;&#20856;&#20889;&#27861;
</span><span class="org-builtin">echo</span> <span class="org-string">"hello, world"</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">&#27969;&#34892;&#20889;&#27861;
</span><span class="org-builtin">echo</span> <span class="org-string">'Hello, world!'</span>

[root@centos8 ~]#curl -s http://10.0.0.8/hello.sh|bash
hello, world
Hello, world!

[root@centos8 ~]#curl http://10.0.0.8/hello.sh 2&gt;/dev/null |bash
hello, world
Hello, world!

[root@centos8 ~]#wget -qO - http://www.cici.com/testdir/hello.sh |bash
hello, world
Hello, world!
</pre>
</div>

<p>
范例：备份脚本
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span>
<span class="org-builtin">echo</span> -e <span class="org-string">"\033[1;32mStarting backup...\033[0m"</span>
sleep 2
cp -av /etc/ /data/etc<span class="org-sh-quoted-exec">`date +%F`</span>/
<span class="org-builtin">echo</span> -e <span class="org-string">"\033[1;32mBackup is finished\033[0m"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-shell-脚本调试" class="outline-3">
<h3 id="shell-脚本调试"><a href="#shell-脚本调试">shell 脚本调试</a></h3>
<div class="outline-text-3" id="text-shell-脚本调试">
<p>
只检测脚本中的语法错误，但无法检查出命令错误，但不真正执行脚本
</p>

<div class="org-src-container">
<pre class="src src-sh">bash -n /path/to/some_script
</pre>
</div>

<p>
调试并执行
</p>

<div class="org-src-container">
<pre class="src src-sh">bash -x /path/to/some_script
</pre>
</div>

<p>
范例：cat -A 查看文件所有的控制符； vim 中命令行模式输入 set list 查看
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 scripts]#cat -A test.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash$
</span><span class="org-comment-delimiter">#</span><span class="org-comment">$
</span>
<span class="org-builtin">echo</span> line1$
hostnam$
cat &gt; test.txt &lt;&lt;EOF $<span class="org-sh-heredoc">
aaa$
bbb$
ccc$
EOF $
$
echo line22$
[root@centos8 scripts]#bash -n test.sh
f1.sh: line 20: warning: here-document at line 14 delimited by end-of-file
(wanted `EOF')</span>
</pre>
</div>

<p>
总结：脚本错误常见的有三种
</p>

<ul class="org-ul">
<li>语法错误，会导致后续的命令不继续执行，可以用bash -n检查错误，提示的
出错行数不一定是准确的</li>
<li>命令错误，默认后续的命令还会继续执行，用bash -n 无法检查出来，可以使
用 bash -x 进行观察</li>
<li>逻辑错误：只能使用 bash -x 进行观察</li>
</ul>
</div>
</div>
<div id="outline-container-变量" class="outline-3">
<h3 id="变量"><a href="#变量">变量</a></h3>
<div class="outline-text-3" id="text-变量">
</div>
<div id="outline-container-变量-1" class="outline-4">
<h4 id="变量-1"><a href="#变量-1">变量</a></h4>
<div class="outline-text-4" id="text-变量-1">
<p>
变量表示命名的内存空间，将数据放在内存空间中，通过变量名引用，获取数据
</p>

<p>
格式
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">&#26631;&#35782;&#31526;</span>=&#20869;&#23481;

&#20869;&#23481;&#26377;&#20197;&#19979;&#20960;&#31181;&#24418;&#24335;&#65306;
1.&#23383;&#38754;&#37327;
2.&#25968;&#23398;&#34920;&#36798;&#24335;
3.&#21629;&#20196;&#34920;&#36798;&#24335;
4.&#21464;&#37327;&#34920;&#36798;&#24335;
5.&#28151;&#21512;&#34920;&#36798;&#24335;&#65288;&#26368;&#24120;&#29992;&#65289;
</pre>
</div>
</div>
</div>
<div id="outline-container-变量类型" class="outline-4">
<h4 id="变量类型"><a href="#变量类型">变量类型</a></h4>
<div class="outline-text-4" id="text-变量类型">
<p>
变量类型：
</p>

<ul class="org-ul">
<li><p>
内置变量
</p>

<p>
如：PS1，EDITOR(默认文本编辑器), PATH，UID，HOSTNAME， BASHPID
(当前shell进程)，PPID(父进程)，HISTSIZE
</p></li>

<li>用户自定义变量</li>
</ul>

<p>
不同的变量存放的数据不同，决定了以下
</p>

<ol class="org-ol">
<li>数据存储方式</li>
<li>参与的运算</li>
<li>表示的数据范围</li>
</ol>

<p>
变量数据类型：
</p>

<ul class="org-ul">
<li>字符</li>

<li>数值：整型、浮点型,bash 不支持浮点数

<ol class="org-ol">
<li><p>
浮点数据如何存储？单精度，双精度
</p>

<p>
float 占四个字节 -3.403E38~3.403E38 单精度
</p>

<p>
double 占八个字节-1.798E308~1.798E308 双精度
</p>

<p>
参考：浮点数在计算机中的存储方式
</p>

<p>
<a href="https://www.cnblogs.com/wuyuan2011woaini/p/4105765.html">https://www.cnblogs.com/wuyuan2011woaini/p/4105765.html</a>
</p></li>
</ol></li>
</ul>
</div>
</div>
<div id="outline-container-编程语言分类" class="outline-4">
<h4 id="编程语言分类"><a href="#编程语言分类">编程语言分类</a></h4>
<div class="outline-text-4" id="text-编程语言分类">
<p>
<b>静态和动态语言</b>
</p>

<ul class="org-ul">
<li>静态编译语言：使用变量前，先声明变量类型，之后类型不能改变，在编译时
检查，如：java，c</li>
<li>动态编译语言：不用事先声明，可随时改变类型，如：bash，Python</li>
</ul>

<p>
<b>强类型和弱类型语言</b>
</p>

<ul class="org-ul">
<li><p>
强类型语言：不同类型数据操作，必须经过强制转换才同一类型才能运算，如
java， c# ，python
</p>

<p>
如：参考以下 python 代码
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">print</span>(<span class="org-string">'me'</span>+ 10) &#25552;&#31034;&#20986;&#38169;&#65292;&#19981;&#20250;&#33258;&#21160;&#36716;&#25442;&#31867;&#22411;
<span class="org-builtin">print</span>(<span class="org-string">'me'</span>+str(10)) &#32467;&#26524;&#20026;me10&#65292;&#38656;&#35201;&#26174;&#31034;&#36716;&#25442;&#31867;&#22411;
</pre>
</div></li>

<li><p>
弱类型语言：语言的运行时会隐式做数据类型转换。无须指定类型，默认均为
字符型；参与运算会自动进行隐式类型转换；变量无须事先定义可直接调用
</p>

<p>
如：bash ，php，javascript
</p></li>
</ul>
</div>
</div>
<div id="outline-container-shell中变量命名法则" class="outline-4">
<h4 id="shell中变量命名法则"><a href="#shell中变量命名法则">Shell中变量命名法则</a></h4>
<div class="outline-text-4" id="text-shell中变量命名法则">
<ul class="org-ul">
<li>不能使程序中的保留字：如：if, for</li>
<li>只能使用数字、字母及下划线，且不能以数字开头，注意：不支持短横线
“ - ”，和主机名相反</li>
<li>见名知义，用英文单词命名，并体现出实际作用，不要用简写，如：ATM</li>
<li>统一命名规则：驼峰命名法，studentname： 大驼峰StudentName
小驼峰studentName</li>
<li>变量名大写：STUDENT_NAME</li>
<li>局部变量小写</li>
<li>函数名小写</li>
</ul>
</div>
</div>
<div id="outline-container-变量定义和引用" class="outline-4">
<h4 id="变量定义和引用"><a href="#变量定义和引用">变量定义和引用</a></h4>
<div class="outline-text-4" id="text-变量定义和引用">
<p>
变量的生效范围等标准划分变量类型
</p>

<ul class="org-ul">
<li>普通变量：生效范围为当前shell进程；对当前shell之外的其它shell进程，
包括当前shell的子shell进程均无效</li>
<li>环境变量：生效范围为当前shell进程及其子进程</li>
<li>本地变量：生效范围为当前shell进程中某代码片断，通常指函数</li>
</ul>

<p>
<b>变量赋值：</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">name</span>=<span class="org-string">'value'</span>
</pre>
</div>

<p>
value 可以是以下多种形式
</p>

<div class="org-src-container">
<pre class="src src-sh">&#30452;&#25509;&#23383;&#20018;&#65306;<span class="org-variable-name">name</span>=<span class="org-string">'root'</span>
&#21464;&#37327;&#24341;&#29992;&#65306;<span class="org-variable-name">name</span>=<span class="org-string">"$USER"</span>
&#21629;&#20196;&#24341;&#29992;&#65306;<span class="org-variable-name">name</span>=<span class="org-sh-quoted-exec">`COMMAND`</span> &#25110;&#32773; <span class="org-variable-name">name</span>=$(COMMAND)
</pre>
</div>

<p>
注意：变量赋值是临时生效，当退出终端后，变量会自动删除，无法持久保存，
脚本中的变量会随着脚本结束，也会自动删除
</p>

<p>
<b>变量引用：</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">name</span>
${<span class="org-variable-name">name</span>}
</pre>
</div>

<p>
<b>弱引用和强引用</b>
</p>

<ul class="org-ul">
<li>"$name" 弱引用，其中的变量引用会被替换为变量值</li>
<li>'$name' 强引用，其中的变量引用不会被替换为变量值，而保持原字符串</li>
</ul>

<p>
范例：变量的各种赋值方式和引用
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#<span class="org-variable-name">TITLE</span>=<span class="org-string">'cto'</span>
[root@centos8 ~]#echo $<span class="org-variable-name">TITLE</span>
cto
[root@centos8 ~]#echo I am $<span class="org-variable-name">TITLE</span>
I am cto
[root@centos8 ~]#echo <span class="org-string">"I am $TITLE"</span>
I am cto
[root@centos8 ~]#echo <span class="org-string">'I am $TITLE'</span>
I am $<span class="org-variable-name">TITLE</span>

[root@centos8 ~]#<span class="org-variable-name">NAME</span>=$<span class="org-variable-name">USER</span>
[root@centos8 ~]#echo $<span class="org-variable-name">NAME</span>
root
[root@centos8 ~]#<span class="org-variable-name">USER</span>=<span class="org-sh-quoted-exec">`whoami`</span>
[root@centos8 ~]#echo $<span class="org-variable-name">USER</span>
root

[root@centos8 ~]#<span class="org-variable-name">FILE</span>=<span class="org-sh-quoted-exec">`ls /run`</span>
[root@centos8 ~]#echo $<span class="org-variable-name">FILE</span>
agetty.reload atd.pid auditd.pid autofs.fifo-misc autofs.fifo-net console
cron.reboot cryptsetup dbus faillock fsck initctl initramfs lock log mount
NetworkManager plymouth rsyslogd.pid screen sepermit setrans sshd.pid sssd.pid
sudo systemd tmpfiles.d tuned udev user utmp vmware

[root@centos8 ~]#<span class="org-variable-name">FILE</span>=/etc/*
[root@centos8 ~]#echo $<span class="org-variable-name">FILE</span>
/etc/adjtime /etc/aliases /etc/alternatives /etc/anacrontab /etc/at.deny
/etc/audit /etc/authselect /etc/autofs.conf /etc/autofs_ldap_auth.conf

<span class="org-comment-delimiter"># </span><span class="org-comment">&#26377;&#20123;&#21629;&#20196;&#22312;&#36171;&#20540;&#32473;&#21464;&#37327;&#26102;&#65292;&#26174;&#31034;&#26159;&#19981;&#19968;&#26679;&#30340;
</span>[root@centos8 ~]#seq 10
1
2
3
4
5
6
7
8
9
10
[root@centos8 ~]#<span class="org-variable-name">NUM</span>=<span class="org-sh-quoted-exec">`seq 10`</span>
[root@centos8 ~]#echo $<span class="org-variable-name">NUM</span>
1 2 3 4 5 6 7 8 9 10
[root@centos8 ~]#echo <span class="org-string">"$NUM"</span>
1
2
3
4
5
6
7
8
9
10

[root@centos8 ~]#<span class="org-variable-name">NAMES</span>=<span class="org-string">"wang
&gt; zhang
&gt; zhao
&gt; li"</span>
[root@centos8 ~]#echo $<span class="org-variable-name">NAMES</span>
wang zhang zhao li
[root@centos8 ~]#echo <span class="org-string">"$NAMES"</span>
wang
zhang
zhao
li
</pre>
</div>

<p>
范例：变量引用
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 data]#<span class="org-variable-name">NAME</span>=cici
[root@centos8 data]#<span class="org-variable-name">AGE</span>=20
[root@centos8 data]#echo $<span class="org-variable-name">NAME</span>
cici
[root@centos8 data]#echo $<span class="org-variable-name">AGE</span>
20
[root@centos8 data]#echo $<span class="org-variable-name">NAME</span> $<span class="org-variable-name">AGE</span>
cici 20
[root@centos8 data]#echo $<span class="org-variable-name">NAME</span>$<span class="org-variable-name">AGE</span>
cici20
[root@centos8 data]#echo $<span class="org-variable-name">NAME_</span>$<span class="org-variable-name">AGE</span>
20
[root@centos8 data]#echo ${<span class="org-variable-name">NAME</span>}_$<span class="org-variable-name">AGE</span>
cici_20
</pre>
</div>

<p>
范例：变量的间接赋值和引用
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#<span class="org-variable-name">TITLE</span>=cto
[root@centos8 ~]#<span class="org-variable-name">NAME</span>=wang
[root@centos8 ~]#<span class="org-variable-name">TITLE</span>=$<span class="org-variable-name">NAME</span>
[root@centos8 ~]#echo $<span class="org-variable-name">NAME</span>
wang
[root@centos8 ~]#echo $<span class="org-variable-name">TITLE</span>
wang
[root@centos8 ~]#<span class="org-variable-name">NAME</span>=me
[root@centos8 ~]#echo $<span class="org-variable-name">NAME</span>
me
[root@centos8 ~]#echo $<span class="org-variable-name">TITLE</span>
wang
</pre>
</div>

<p>
范例：变量追加值
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#<span class="org-variable-name">TITLE</span>=CTO
[root@centos8 ~]#<span class="org-variable-name">TITLE</span>+=:wang
[root@centos8 ~]#echo $<span class="org-variable-name">TITLE</span>
CTO:wang
</pre>
</div>

<p>
范例：利用变量实现动态命令
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#<span class="org-variable-name">CMD</span>=hostname
[root@centos8 ~]#$<span class="org-variable-name">CMD</span>
centos8.cici.com
</pre>
</div>

<p>
<b>显示已定义的所有变量：</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">set</span>
</pre>
</div>

<p>
<b>删除变量：</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">unset</span> &lt;name&gt;
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#<span class="org-variable-name">NAME</span>=cici
[root@centos8 ~]#<span class="org-variable-name">TITLE</span>=ceo
[root@centos8 ~]#echo $<span class="org-variable-name">NAME</span> $<span class="org-variable-name">TITLE</span>
cici ceo
[root@centos8 ~]#unset NAME TITLE
[root@centos8 ~]#echo $<span class="org-variable-name">NAME</span> $<span class="org-variable-name">TITLE</span>
</pre>
</div>

<p>
范例：显示系统信息
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 scripts]#cat systeminfo.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span>
<span class="org-variable-name">RED</span>=<span class="org-string">"\E[1;31m"</span>
<span class="org-variable-name">GREEN</span>=<span class="org-string">"\E[1;32m"</span>
<span class="org-variable-name">END</span>=<span class="org-string">"\E[0m"</span>
<span class="org-builtin">echo</span> -e  <span class="org-string">"$GREEN----------------------Host systeminfo--------------------$END"</span>
<span class="org-builtin">echo</span> -e  <span class="org-string">"HOSTNAME:   $RED`hostname`$END"</span>
<span class="org-builtin">echo</span> -e  <span class="org-string">"IPADDR:    $RED` ifconfig eth0|grep -Eo '([0-9]{1,3}\.){3}[0-9]
{1,3}' |head -n1`$END"</span>
<span class="org-builtin">echo</span> -e  <span class="org-string">"OSVERSION:   $RED`cat /etc/redhat-release`$END"</span>
<span class="org-builtin">echo</span> -e  <span class="org-string">"KERNEL:    $RED`uname -r`$END"</span>
<span class="org-builtin">echo</span> -e  <span class="org-string">"CPU:     $RED`lscpu|grep 'Model name'|tr -s ' '|cut -d : -f2`$END"</span>
<span class="org-builtin">echo</span> -e  <span class="org-string">"MEMORY:    $RED`free -h|grep Mem|tr -s ' ' : |cut -d : -f2`$END"</span>
<span class="org-builtin">echo</span> -e  <span class="org-string">"DISK:     $RED`lsblk |grep '^sd' |tr -s ' ' |cut -d " " -f4`$END"</span>
<span class="org-builtin">echo</span> -e  <span class="org-string">"$GREEN---------------------------------------------------------$END"</span>

[root@centos8 scripts]#cat system_info.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span>
<span class="org-variable-name">RED</span>=<span class="org-string">"\E[1;31m"</span>
<span class="org-variable-name">GREEN</span>=<span class="org-string">"echo -e \E[1;32m"</span>
<span class="org-variable-name">END</span>=<span class="org-string">"\E[0m"</span>
$<span class="org-variable-name">GREEN</span>----------------------Host systeminfo--------------------$<span class="org-variable-name">END</span>
<span class="org-builtin">echo</span> -e  <span class="org-string">"HOSTNAME:   $RED`hostname`$END"</span>
<span class="org-builtin">echo</span> -e  <span class="org-string">"IPADDR:    $RED` ifconfig eth0|grep -Eo '([0-9]{1,3}\.){3}[0-9]
{1,3}' |head -n1`$END"</span>
<span class="org-builtin">echo</span> -e  <span class="org-string">"OSVERSION:   $RED`cat /etc/redhat-release`$END"</span>
<span class="org-builtin">echo</span> -e  <span class="org-string">"KERNEL:    $RED`uname -r`$END"</span>
<span class="org-builtin">echo</span> -e  <span class="org-string">"CPU:     $RED`lscpu|grep 'Model name'|tr -s ' '|cut -d : -f2`$END"</span>
<span class="org-builtin">echo</span> -e  <span class="org-string">"MEMORY:    $RED`free -h|grep Mem|tr -s ' ' : |cut -d : -f2`$END"</span>
<span class="org-builtin">echo</span> -e  <span class="org-string">"DISK:     $RED`lsblk |grep '^sd' |tr -s ' ' |cut -d " " -f4`$END"</span>
$<span class="org-variable-name">GREEN</span>---------------------------------------------------------$<span class="org-variable-name">END</span>
</pre>
</div>

<p>
动动手：
</p>
<ul class="org-ul">
<li>编写脚本 systeminfo.sh，显示当前主机系统信息，包括:主机名，IPv4地址，
操作系统版本，内核版本，CPU型号，内存大小，硬盘大小</li>
<li>编写脚本 backup.sh，可实现每日将/etc/目录备份到/backup/etcYYYY-mm-dd 中</li>
<li>编写脚本 disk.sh，显示当前硬盘分区中空间利用率最大的值</li>
<li>编写脚本 links.sh，显示正连接本主机的每个远程主机的IPv4地址和连接数，
并按连接数从大到小排序</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-变量的拓展" class="outline-3">
<h3 id="变量的拓展"><a href="#变量的拓展">变量的拓展</a></h3>
<div class="outline-text-3" id="text-变量的拓展">
</div>
<div id="outline-container-环境变量" class="outline-4">
<h4 id="环境变量"><a href="#环境变量">环境变量</a></h4>
<div class="outline-text-4" id="text-环境变量">
<p>
环境变量：
</p>

<ul class="org-ul">
<li>可以使子进程（包括孙子进程）继承父进程的变量，但是无法让父进程使用子
进程的变量</li>
<li>一旦子进程修改从父进程继承的变量，将会新的值传递给孙子进程</li>
<li>一般只在系统配置文件中使用，在脚本中较少使用</li>
</ul>

<p>
变量声明和赋值：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#22768;&#26126;&#24182;&#36171;&#20540;
</span><span class="org-builtin">export</span> <span class="org-variable-name">name</span>=VALUE
<span class="org-builtin">declare</span> -x <span class="org-variable-name">name</span>=VALUE

<span class="org-comment-delimiter">#</span><span class="org-comment">&#25110;&#32773;&#20998;&#20004;&#27493;&#23454;&#29616;
</span><span class="org-variable-name">name</span>=VALUE
<span class="org-builtin">export</span> name
</pre>
</div>

<p>
变量引用：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">name</span>
${<span class="org-variable-name">name</span>}
</pre>
</div>

<p>
显示所有环境变量：
</p>

<div class="org-src-container">
<pre class="src src-sh">env
printenv
<span class="org-builtin">export</span>
<span class="org-builtin">declare</span> -x
</pre>
</div>

<p>
删除变量：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">unset</span> name
</pre>
</div>

<p>
bash内建的环境变量
</p>

<div class="org-src-container">
<pre class="src src-sh">PATH
SHELL
USER
UID
HOME
PWD
SHLVL <span class="org-comment-delimiter">#</span><span class="org-comment">shell&#30340;&#23884;&#22871;&#23618;&#25968;&#65292;&#21363;&#28145;&#24230;
</span>LANG
MAIL
HOSTNAME
HISTSIZE
_  <span class="org-comment-delimiter">#</span><span class="org-comment">&#19979;&#21010;&#32447; &#34920;&#31034;&#21069;&#19968;&#21629;&#20196;&#30340;&#26368;&#21518;&#19968;&#20010;&#21442;&#25968;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-只读变量" class="outline-4">
<h4 id="只读变量"><a href="#只读变量">只读变量</a></h4>
<div class="outline-text-4" id="text-只读变量">
<p>
只读变量：只能声明定义，但后续不能修改和删除，即常量
</p>

<p>
声明只读变量：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">readonly</span> name
<span class="org-builtin">declare</span>  -r name
</pre>
</div>

<p>
查看只读变量：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">readonly</span> [-p]
<span class="org-builtin">declare</span> -r
</pre>
</div>

<p>
只读变量无法重新赋值，并且不支持撤销；存活时间为当前shell进程的声明周
期，随shell终止而终止；
</p>

<p>
登出后重进，只读变量就没了
</p>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#readonly <span class="org-variable-name">PI</span>=3.14159
[root@centos8 ~]#echo $<span class="org-variable-name">PI</span>
3.14159

[root@centos8 ~]#<span class="org-variable-name">PI</span>=3.14  <span class="org-comment-delimiter"># </span><span class="org-comment">&#21482;&#35835;&#21464;&#37327;&#26080;&#27861;&#37325;&#26032;&#36171;&#20540;
</span>-bash: PI: readonly variable
[root@centos8 ~]#unset PI <span class="org-comment-delimiter"># </span><span class="org-comment">&#21482;&#35835;&#21464;&#37327;&#19981;&#25903;&#25345;&#25764;&#38144;
</span>-bash: unset: PI: cannot unset: readonly variable

[root@centos8 ~]#echo $<span class="org-variable-name">PI</span>
3.14159
[root@centos8 ~]#exit  <span class="org-comment-delimiter"># </span><span class="org-comment">&#21482;&#35835;&#21464;&#37327;&#23384;&#27963;&#26102;&#38388;&#20026;&#24403;&#21069;shell&#36827;&#31243;&#30340;&#22768;&#26126;&#21608;&#26399;&#65292;&#38543;shell&#32456;&#27490;&#32780;&#32456;&#27490;
</span>
[root@centos8 ~]#echo $<span class="org-variable-name">PI</span>  
[root@centos8 ~]#
</pre>
</div>
</div>
</div>
<div id="outline-container-位置变量" class="outline-4">
<h4 id="位置变量"><a href="#位置变量">位置变量</a></h4>
<div class="outline-text-4" id="text-位置变量">
<p>
位置变量：在bash shell中内置的变量，在脚本代码中调用通过命令行传递给脚
本的参数
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">1</span>, $<span class="org-variable-name">2</span>, ... &#23545;&#24212;&#31532;1&#20010;&#12289;&#31532;2&#20010;&#31561;&#21442;&#25968;&#65292;shift [n]&#25442;&#20301;&#32622;
$<span class="org-variable-name">0</span> &#21629;&#20196;&#26412;&#36523;,&#21253;&#25324;&#36335;&#24452;
$<span class="org-variable-name">*</span> &#20256;&#36882;&#32473;&#33050;&#26412;&#30340;&#25152;&#26377;&#21442;&#25968;&#65292;&#20840;&#37096;&#21442;&#25968;&#21512;&#20026;&#19968;&#20010;&#23383;&#31526;&#20018;
$<span class="org-variable-name">@</span> &#20256;&#36882;&#32473;&#33050;&#26412;&#30340;&#25152;&#26377;&#21442;&#25968;&#65292;&#27599;&#20010;&#21442;&#25968;&#20026;&#29420;&#31435;&#23383;&#31526;&#20018;
$<span class="org-variable-name">#</span> &#20256;&#36882;&#32473;&#33050;&#26412;&#30340;&#21442;&#25968;&#30340;&#20010;&#25968;

&#27880;&#24847;&#65306;$<span class="org-variable-name">@</span> $<span class="org-variable-name">*</span> &#21482;&#22312;&#34987;&#21452;&#24341;&#21495;&#21253;&#36215;&#26469;&#30340;&#26102;&#20505;&#25165;&#20250;&#26377;&#24046;&#24322;

<span class="org-comment-delimiter"># </span><span class="org-comment">&#20854;&#23427;
</span>$<span class="org-variable-name">_</span> : &#20195;&#34920;&#19978;&#19968;&#20010;&#21629;&#20196;&#30340;&#26368;&#21518;&#19968;&#20010;&#21442;&#25968;
$<span class="org-variable-name">$</span> : &#20195;&#34920;&#25152;&#22312;&#21629;&#20196;&#30340;PID
$<span class="org-variable-name">!</span> : &#20195;&#34920;&#26368;&#21518;&#25191;&#34892;&#30340;&#21518;&#21488;&#21629;&#20196;&#30340;PID
$<span class="org-variable-name">-</span>  &#24403;&#21069;bash&#30340;&#21442;&#25968;&#65292;set&#35774;&#32622;&#33050;&#26412;&#23433;&#20840;&#26102;&#29992;&#21040;
</pre>
</div>

<p>
清空所有位置变量
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">set</span> --
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /data/scripts/arg.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span>
<span class="org-builtin">echo</span> <span class="org-string">"1st arg is $1"</span>
<span class="org-builtin">echo</span> <span class="org-string">"2st arg is $2"</span>
<span class="org-builtin">echo</span> <span class="org-string">"3st arg is $3"</span>
<span class="org-builtin">echo</span> <span class="org-string">"10st arg is ${10}"</span>
<span class="org-builtin">echo</span> <span class="org-string">"11st arg is ${11}"</span>
<span class="org-builtin">echo</span> <span class="org-string">"The number of arg is $#"</span>
<span class="org-builtin">echo</span> <span class="org-string">"All args are $*"</span>
<span class="org-builtin">echo</span> <span class="org-string">"All args are $@"</span>
<span class="org-builtin">echo</span> <span class="org-string">"The scriptname is `basename $0`"</span>

[root@centos8 ~]#bash /data/scripts/arg.sh {a..z}
1st arg is a
2st arg is b
3st arg is c
10st arg is j
11st arg is k
The number of arg is 26
All args are a b c d e f g h i j k l m n o p q r s t u v w x y z
All args are a b c d e f g h i j k l m n o p q r s t u v w x y z
The scriptname is arg.sh
</pre>
</div>

<p>
范例： $0 脚本文件路径本身
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@node01 scripts]# cat  filename.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-builtin">echo</span> $<span class="org-variable-name">0</span> <span class="org-comment-delimiter">#</span><span class="org-comment">&#33719;&#21462;&#33050;&#26412;&#36335;&#24452;
</span>basename $<span class="org-variable-name">0</span> <span class="org-comment-delimiter">#</span><span class="org-comment">&#33719;&#21462;&#33050;&#26412;&#21517;
</span><span class="org-variable-name">DIR</span>=<span class="org-string">"$( cd "$( dirname "${BASH_SOURCE[0]}" )" &amp;&amp; pwd )"</span>
<span class="org-builtin">echo</span> $<span class="org-variable-name">DIR</span> <span class="org-comment-delimiter">#</span><span class="org-comment">&#33719;&#21462;&#33050;&#26412;&#25152;&#22312;&#30340;&#30446;&#24405;&#36335;&#24452;
</span><span class="org-builtin">echo</span> $(dirname <span class="org-string">"${BASH_SOURCE[0]}"</span>) = $(dirname $<span class="org-variable-name">0</span>)

[root@node01 scripts]# bash filename.sh
filename.sh
filename.sh
/root/scripts
. = .
</pre>
</div>

<p>
范例：删库跑路之命令rm的安全实现
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /data/scripts/rm.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-variable-name">WARNING_COLOR</span>=<span class="org-string">"echo -e \E[1;31m"</span>
<span class="org-variable-name">END</span>=<span class="org-string">"\E[0m"</span>
<span class="org-variable-name">DIR</span>=/tmp/<span class="org-sh-quoted-exec">`date +%F_%H-%M-%S`</span>
mkdir $<span class="org-variable-name">DIR</span>
mv  $<span class="org-variable-name">*</span>  $<span class="org-variable-name">DIR</span>
${<span class="org-variable-name">WARNING_COLOR</span>}Move $<span class="org-variable-name">*</span> to $<span class="org-variable-name">DIR</span> $<span class="org-variable-name">END</span>

[root@centos8 ~]#chmod a+x /data/scripts/rm.sh
[root@centos8 ~]#alias <span class="org-variable-name">rm</span>=<span class="org-string">'/data/scripts/rm.sh'</span>

[root@centos8 ~]#touch {1..10}.txt
[root@centos8 ~]#rm *.txt
Move 10.txt 1.txt 2.txt 3.txt 4.txt 5.txt 6.txt 7.txt 8.txt 9.txt to /tmp/2020-04-01_15-15-28
</pre>
</div>

<p>
范例： <code>$* 和 $​@</code> 的区别
</p>

<div class="org-src-container">
<pre class="src src-text">$* &#20256;&#36882;&#32473;&#33050;&#26412;&#30340;&#25152;&#26377;&#21442;&#25968;&#65292;&#20840;&#37096;&#21442;&#25968;&#21512;&#20026;&#19968;&#20010;&#23383;&#31526;&#20018;
$@ &#20256;&#36882;&#32473;&#33050;&#26412;&#30340;&#25152;&#26377;&#21442;&#25968;&#65292;&#27599;&#20010;&#21442;&#25968;&#20026;&#29420;&#31435;&#23383;&#31526;&#20018;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 scripts]#cat f1.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-builtin">echo</span> <span class="org-string">"f1.sh:all args are $@"</span>
<span class="org-builtin">echo</span> <span class="org-string">"f1.sh:all args are $*"</span>

./file.sh <span class="org-string">"$*"</span>
[root@centos8 scripts]#cat f2.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-builtin">echo</span> <span class="org-string">"f2.sh:all args are $@"</span>
<span class="org-builtin">echo</span> <span class="org-string">"f2.sh:all args are $*"</span>
./file.sh <span class="org-string">"$@"</span>
[root@centos8 scripts]#cat file.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-builtin">echo</span> <span class="org-string">"file.sh:1st arg is $1"</span>

[root@centos8 scripts]#./f1.sh a b c
f1.sh:all args are a b c
f1.sh:all args are a b c
file.sh:1st arg is a b c
[root@centos8 scripts]#./f2.sh a b c
f2.sh:all args are a b c
f2.sh:all args are a b c
file.sh:1st arg is a
</pre>
</div>

<p>
范例: 利用软链接实现同一个脚本不同功能
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat test.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-builtin">echo</span> $<span class="org-variable-name">0</span>

[root@centos8 ~]#ln -s test.sh a.sh
[root@centos8 ~]#ln -s test.sh b.sh

[root@centos8 ~]#./a.sh
./a.sh
[root@centos8 ~]#./b.sh
./b.sh
</pre>
</div>
</div>
</div>
<div id="outline-container-退出状态码变量" class="outline-4">
<h4 id="退出状态码变量"><a href="#退出状态码变量">退出状态码变量</a></h4>
<div class="outline-text-4" id="text-退出状态码变量">
<p>
当我们浏览网页时，有时会看到下图所显示的数字，表示网页的错误信息，我们
称为状态码，在shell脚本中也有相似的技术表示程序执行的相应状态。
</p>

<p>
进程执行后，将使用变量 <code>$?</code> 保存状态码的相关数字，不同的值反应成功或失
败， <code>$?</code> 取值范例 0-255
</p>

<pre class="example" id="org4aefb4c">
$?的值为0 #代表成功
$?的值是1到255  #代表失败
</pre>

<pre class="example" id="org2e4385c">
~125 运行失败。
126 找到命令无法运行
127 找不到命令。
&gt;128 终止正在执行的命令,返回值.
</pre>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">ping -c1 -W1 hostdown &amp;&gt; /dev/null
<span class="org-builtin">echo</span> $<span class="org-variable-name">?</span>
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 scripts]#curl http://www.cici.com &amp;&gt; /dev/null
[root@centos8 scripts]#echo $<span class="org-variable-name">?</span>
0
</pre>
</div>

<p>
用户可以在脚本中使用以下命令自定义退出状态码
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">exit</span> [n]
</pre>
</div>

<p>
注意：
</p>

<ul class="org-ul">
<li>脚本中一旦遇到exit命令，脚本会立即终止；终止退出状态取决于exit命令后
面的数字</li>
<li>如果未给脚本指定退出状态码，整个脚本的退出状态码取决于脚本中执行的最
后一条命令的状态码</li>
</ul>
</div>
</div>
<div id="outline-container-展开命令行" class="outline-4">
<h4 id="展开命令行"><a href="#展开命令行">展开命令行</a></h4>
<div class="outline-text-4" id="text-展开命令行">
<p>
<b>展开命令执行顺序</b>
</p>

<pre class="example" id="org1b02bbb">
把命令行分成单个命令词
展开别名
展开大括号的声明 {}
展开波浪符声明 ~
命令替换 $() 和 ``
再次把命令行分成命令词
展开文件通配 *、?、[abc]等等
准备 I/0 重导向 &lt;、&gt;
运行命令
</pre>

<p>
<b>防止扩展</b>
</p>

<pre class="example" id="org207fcf3">
反斜线（\）会使随后的字符按原意解释
</pre>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">echo</span> Your cost: <span class="org-string">\$</span><span class="org-variable-name">5</span>.00
Your cost: $<span class="org-variable-name">5</span>.00
</pre>
</div>

<p>
<b>加引号来防止扩展</b>
</p>

<pre class="example" id="orgad76ce8">
单引号（'  '）防止所有扩展
双引号（"  "）也可防止扩展，但是以下情况例外：$（美元符号）
</pre>

<p>
<b>变量扩展</b>
</p>

<pre class="example" id="orgf2dc903">
`` : 反引号，命令替换
\：反斜线，禁止单个字符扩展
!：叹号，历史命令替换
</pre>
</div>
</div>
<div id="outline-container-脚本安全和-set" class="outline-4">
<h4 id="脚本安全和-set"><a href="#脚本安全和-set">set命令和脚本安全</a></h4>
<div class="outline-text-4" id="text-脚本安全和-set">
<p>
set 命令：可以用来定制 shell 环境
</p>

<p>
<b>$- 变量</b> : 当前bash的参数
</p>

<p>
变量输出说明：
</p>
<ul class="org-ul">
<li>h：hashall，打开选项后，Shell 会将命令所在的路径 hash 下来，避免每次都
要查询。通过 <code>set +h</code> 将h选项关闭</li>
<li>i：interactive-comments，包含这个选项说明当前的 shell 是一个交互式的
shell。所谓的交互式 shell，在脚本中，i 选项是关闭的</li>
<li>m：monitor，打开监控模式，就可以通过Job control来控制进程的停止、继
续，后台或者前台执行等</li>
<li>B：braceexpand，大括号扩展</li>
<li>H：history，H 选项打开，可以展开历史列表中的命令，可以通过 ! 感叹号
来完成，例如“!!”返回上最近的一个历史命令，“!n”返回第 n 个历史命令</li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#echo $<span class="org-variable-name">-</span>
himBHs

[root@centos8 ~]#set +h <span class="org-comment-delimiter">#</span><span class="org-comment">&#20851;&#38381;hash
</span>[root@centos8 ~]#echo $<span class="org-variable-name">-</span>
imBHs
[root@centos8 ~]#hash
-bash: hash: hashing disabled

[root@centos8 ~]#echo {1..10}
1 2 3 4 5 6 7 8 9 10
[root@centos8 ~]#echo $<span class="org-variable-name">-</span>
imBHs
[root@centos8 ~]#set +B <span class="org-comment-delimiter"># </span><span class="org-comment">&#20851;&#38381;&#22823;&#25324;&#21495;&#25193;&#23637;
</span>[root@centos8 ~]#echo $<span class="org-variable-name">-</span>
imHs
[root@centos8 ~]#echo {1..10}
{1..10}
</pre>
</div>

<p>
<b>set 命令实现脚本安全</b>
</p>

<p>
参考： <a href="https://www.gnu.org/software/bash/manual/bash.html#The-Set-Builtin">https://www.gnu.org/software/bash/manual/bash.html#The-Set-Builtin</a>
</p>

<pre class="example" id="org21c802a">
-u 在扩展一个没有设置的变量时，显示错误信息， 等同set -o nounset
-e 如果一个命令返回一个非0退出状态值(失败)就退出， 等同set -o errexit=on
set -C 禁止将内容覆盖已有文件,但可追加， 等同set -o noclobber 。利用 &gt;| 仍可强制覆盖

-o option 显示，打开或者关闭选项
    显示选项：set -o
    打开选项：set -o 选项
    关闭选项：set +o 选项
-x 当执行命令时，打印命令及其参数,类似 bash -x
</pre>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#set -o
allexport   off
braceexpand  on
emacs     on
errexit    off
nounset         off
&#12290;&#12290;&#12290;
xtrace     off
</pre>
</div>

<p>
范例：及时止损
</p>

<div class="org-src-container">
<pre class="src src-sh">cat &lt;&lt; EOF &gt;set_safe.sh <span class="org-sh-heredoc">
#!/bin/env bash
#
set -ue
echo 11
xxx
echo 22
EOF
</span>
[root@middle-ware ~/learn] <span class="org-variable-name">eth0</span> = 10.0.1.86
<span class="org-comment-delimiter"># </span><span class="org-comment">bash set_safe.sh 
</span>11
set_safe.sh: line 15: xxx: command not found
</pre>
</div>
</div>
</div>
<div id="outline-container-小结" class="outline-4">
<h4 id="小结"><a href="#小结">小结</a></h4>
<div class="outline-text-4" id="text-小结">
<p>
范例：字面量、数学表达式、命令表达式、变量表达式、混合表达式
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span><span class="org-comment-delimiter">#</span><span class="org-comment">&#23383;&#38754;&#37327;
</span><span class="org-variable-name">literal1</span>=
<span class="org-variable-name">literal2</span>=<span class="org-string">""</span>
<span class="org-variable-name">literal3</span>=348
<span class="org-variable-name">literal4</span>=string_without_quotation <span class="org-comment-delimiter">#</span><span class="org-comment">&#27809;&#26377;&#24341;&#21495;&#30340;&#36830;&#32493;&#23383;&#31526;&#20018;&#65292;&#31561;&#20215;&#20110;literal2&#21464;&#37327;&#23450;&#20041;
</span><span class="org-variable-name">literal5</span>=<span class="org-string">"string_with_quotation"</span>
<span class="org-variable-name">literal6</span>=<span class="org-string">'string_with_quotation'</span>
<span class="org-variable-name">literal7</span>=<span class="org-string">"A B C"</span>
<span class="org-keyword">for</span> v<span class="org-keyword"> in</span> ${<span class="org-variable-name">!</span>literal@}; <span class="org-keyword">do </span><span class="org-builtin">echo</span> <span class="org-string">"$v: '${!v}'"</span>; <span class="org-keyword">done</span>
<span class="org-builtin">echo</span> -en <span class="org-string">"\n"</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">&#27880;&#24847;&#65306;
</span><span class="org-builtin">echo</span> <span class="org-string">"&#27880;&#24847;&#65306;&#27809;&#26377;&#24341;&#21495;&#30340;&#36830;&#32493;&#23383;&#31526;&#20018;"</span>
<span class="org-variable-name">a</span>=1 2 3 4 <span class="org-comment-delimiter">#</span><span class="org-comment">&#31561;&#20215;&#20110; a=1; 2 3 4
</span><span class="org-comment-delimiter">#</span><span class="org-comment">&#21069;&#38754;a=1&#26159;&#36171;&#20540;&#65292;&#21518;&#38754;&#20195;&#34920;&#21629;&#20196;&#12290;&#22914;a=/tmp bash ${a}/a.sh ok
</span>

<span class="org-comment-delimiter">#</span><span class="org-comment">&#25968;&#23398;&#34920;&#36798;&#24335;
</span><span class="org-variable-name">math1</span>=$(( 1 + 1 ))
<span class="org-variable-name">math2</span>=$(( 3 ^ 4 )) <span class="org-comment-delimiter">#</span><span class="org-comment">&#24322;&#25110;
</span><span class="org-variable-name">math3</span>=$(( literal3++ % 7  ))
<span class="org-variable-name">math4</span>=$(( literal3++ % 7  ))
<span class="org-variable-name">math5</span>=$(( <span class="org-variable-name">math7</span> = 3 )) <span class="org-comment-delimiter"># </span><span class="org-comment">math7&#34987;&#36171;&#20540;
</span><span class="org-variable-name">math6</span>=$(( <span class="org-variable-name">math7</span> = math7 * 1024 ))
<span class="org-keyword">for</span> v<span class="org-keyword"> in</span> ${<span class="org-variable-name">!</span>math@}; <span class="org-keyword">do </span><span class="org-builtin">echo</span> <span class="org-string">"$v: '${!v}'"</span>; <span class="org-keyword">done</span>
<span class="org-builtin">echo</span> -en <span class="org-string">"\n"</span>

<span class="org-comment-delimiter">#</span><span class="org-comment">&#21629;&#20196;&#34920;&#36798;&#24335;
</span><span class="org-variable-name">cmd1</span>=$(ls)
<span class="org-variable-name">cmd2</span>=$(<span class="org-builtin">pwd</span>)
<span class="org-variable-name">cmd3</span>=$(ls -lrt)
<span class="org-variable-name">cmd4</span>=$(<span class="org-builtin">echo</span> <span class="org-string">"\n1"</span>)
<span class="org-variable-name">cmd5</span>=$(<span class="org-builtin">echo</span> -en <span class="org-string">"\n1"</span>)
<span class="org-keyword">for</span> v<span class="org-keyword"> in</span> ${<span class="org-variable-name">!</span>cmd@}; <span class="org-keyword">do </span><span class="org-builtin">echo</span> <span class="org-string">"$v: '${!v}'"</span>; <span class="org-keyword">done</span>
<span class="org-builtin">which</span> echo
<span class="org-builtin">echo</span> -en <span class="org-string">"\n"</span>

<span class="org-comment-delimiter">#</span><span class="org-comment">&#21464;&#37327;&#34920;&#36798;&#24335;
</span><span class="org-variable-name">var1</span>=$<span class="org-variable-name">cmd1</span>
<span class="org-variable-name">var2</span>=$<span class="org-variable-name">cmd2</span>
<span class="org-variable-name">var3</span>=$<span class="org-variable-name">cmd3</span>
<span class="org-variable-name">var4</span>=$<span class="org-variable-name">cmd4</span>
<span class="org-variable-name">var5</span>=$<span class="org-variable-name">cmd5</span>
<span class="org-variable-name">var6</span>=$<span class="org-variable-name">math7</span>
<span class="org-keyword">for</span> v<span class="org-keyword"> in</span> ${<span class="org-variable-name">!</span>var@}; <span class="org-keyword">do </span><span class="org-builtin">echo</span> <span class="org-string">"$v: '${!v}'"</span>; <span class="org-keyword">done</span>
<span class="org-builtin">echo</span> -en <span class="org-string">"\n"</span>

<span class="org-comment-delimiter">#</span><span class="org-comment">&#28151;&#21512;&#34920;&#36798;&#24335;
</span><span class="org-variable-name">hybird</span>=<span class="org-string">"now at $(pwd), use $literal3, find $(( math7 / 1024 ))KB"</span>
<span class="org-builtin">echo</span> $<span class="org-variable-name">hybird</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-shell算术运算" class="outline-3">
<h3 id="shell算术运算"><a href="#shell算术运算">shell 算术运算</a></h3>
<div class="outline-text-3" id="text-shell算术运算">
<p>
Shell 允许在某些情况下对算术表达式进行求值，比如： let 和 declare 内置
命令， <code>(( ))</code> 复合命令和算术扩展。求值以固定宽度的整数进行，不检查溢
出，尽管除以 0 被困并标记为错误。运算符及其优先级，关联性和值与 C 语言
相同。以下运算符列表分组为等优先级运算符级别。级别按降序排列优先。
</p>

<p>
<b>注意：bash 只支持整数，不支持小数</b>
</p>

<pre class="example" id="org2bbba26">
* / % multiplication, division, remainder, %表示取模，即取余数，示例：9%4=1，5%3=2
+ -  addition, subtraction
i++ i-- variable post-increment and post-decrement
++i --i variable pre-increment and pre-decrement
= *= /= %= += -= &lt;&lt;= &gt;&gt;= &amp;= ^= |=     assignment
- +  unary minus and plus
! ~  logical and bitwise negation
**   exponentiation 乘方
&lt;&lt; &gt;&gt; left and right bitwise shifts
&lt;= &gt;= &lt; &gt;    comparison
== != equality and inequality
&amp;   bitwise AND
|   bitwise OR
^   bitwise exclusive OR
&amp;&amp;   logical AND
||   logical OR
expr?expr:expr    conditional operator
expr1 , expr2   comma
</pre>

<p>
乘法符号有些场景中需要转义
</p>

<p>
实现算术运算：
</p>

<div class="org-src-container">
<pre class="src src-sh">(1) <span class="org-builtin">let</span> <span class="org-variable-name">var</span>=&#31639;&#26415;&#34920;&#36798;&#24335;
(2) ((<span class="org-variable-name">var</span>=&#31639;&#26415;&#34920;&#36798;&#24335;)) &#21644;&#19978;&#38754;&#31561;&#20215;
(3) <span class="org-variable-name">var</span>=$[&#31639;&#26415;&#34920;&#36798;&#24335;]
(4) <span class="org-variable-name">var</span>=$((&#31639;&#26415;&#34920;&#36798;&#24335;)) <span class="org-comment-delimiter"># </span><span class="org-comment">$&#34920;&#31034;&#21462;&#35745;&#31639;&#32467;&#26524;  &#25903;&#25345;c&#35821;&#35328;&#34920;&#36798;
</span>(5) <span class="org-variable-name">var</span>=$(expr arg1 arg2 arg3 ...)
(6) <span class="org-builtin">declare</span> &#8211;i <span class="org-variable-name">var</span> = &#25968;&#20540;
(7) <span class="org-builtin">echo</span> <span class="org-string">'&#31639;&#26415;&#34920;&#36798;&#24335;'</span> | bc

&#34920;&#36798;&#24335;&#20013;&#30340;&#36827;&#21046;
0&#20026;&#21069;&#23548;&#30340;&#24120;&#37327;&#24403;&#20316;8&#36827;&#21046;
0x&#12289;0X&#20026;16&#36827;&#21046;
&#20854;&#20182;&#24773;&#20917;&#19979;&#65292;&#25968;&#23383;&#30340;&#24418;&#24335;&#26159; [base#]n&#65292;&#36825;&#37324; base &#26159;&#19968;&#20010; 2 &#21040; 64 &#30340;&#21313;&#36827;&#21046;&#25968;&#20540;&#65292;&#20316;&#20026;&#25968;&#23383;&#30340;&#22522;&#25968;&#65292;n &#26159;&#22312;&#36825;&#20010;&#22522;&#25968;&#20013;&#25968;&#23383;&#30340;&#20540;&#12290; &#22914;&#26524;&#24573;&#30053;&#20102; base#&#65292;&#23558;&#20197; 10 &#20026;&#22522;&#25968;&#12290;
</pre>
</div>

<p>
上面只支持整数，不支持小数， awk对小数支持比较好
</p>

<div class="org-src-container">
<pre class="src src-sh">awk&#22312;&#22788;&#29702;&#25991;&#20214;&#30340;&#26102;&#65292;&#21487;&#20197;&#36827;&#34892;&#36816;&#31639;&#65292;&#37027;&#24403;&#28982;&#20063;&#21487;&#20197;&#21333;&#21333;&#29992;&#26469;&#35745;&#31639;&#20102;&#65292;&#22914;&#65306;
<span class="org-comment-delimiter"># </span><span class="org-comment">awk 'BEGIN{a=(3+2)*2;print a}'
</span>10
awk <span class="org-string">'BEGIN{printf "%.2f%\n",'</span>$<span class="org-variable-name">a</span><span class="org-string">'/'</span>$<span class="org-variable-name">b</span><span class="org-string">'*100}'</span>
awk <span class="org-string">'BEGIN{printf "%.2f%\n",(1/3)*100}'</span>
</pre>
</div>

<p>
内建的随机数生成器变量：
</p>

<div class="org-src-container">
<pre class="src src-sh">$<span class="org-variable-name">RANDOM</span>  &#21462;&#20540;&#33539;&#22260;&#65306;0-32767
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#29983;&#25104; 0 - 49 &#20043;&#38388;&#38543;&#26426;&#25968;
</span><span class="org-builtin">echo</span> $[$<span class="org-variable-name">RANDOM</span>%50]

<span class="org-comment-delimiter">#</span><span class="org-comment">&#38543;&#26426;&#23383;&#20307;&#39068;&#33394;
</span>[root@centos8 ~]#echo -e <span class="org-string">"\033[1;$[RANDOM%7+31]hello\033[0m"</span>
m
</pre>
</div>

<p>
增强型赋值：
</p>

<div class="org-src-container">
<pre class="src src-sh">+= <span class="org-variable-name">i</span>+=10 &#30456;&#24403;&#20110; <span class="org-variable-name">i</span>=i+10
-= <span class="org-variable-name">i</span>-=j  &#30456;&#24403;&#20110; <span class="org-variable-name">i</span>=i-j
*=
/=
%=
++ i++,++i  &#30456;&#24403;&#20110; <span class="org-variable-name">i</span>=i+1
-- i--,--i  &#30456;&#24403;&#20110; <span class="org-variable-name">i</span>=i-1
</pre>
</div>

<p>
格式：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">let</span> varOPERvalue
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#let <span class="org-variable-name">i</span>=10*2
[root@centos8 ~]#echo $<span class="org-variable-name">i</span>
20
[root@centos8 ~]#((<span class="org-variable-name">j</span>=i+10))
[root@centos8 ~]#echo $<span class="org-variable-name">j</span>
30
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#33258;&#21152;3&#21518;&#33258;&#36171;&#20540;
</span><span class="org-builtin">let</span> <span class="org-variable-name">count</span>+=3

[root@centos8 ~]#<span class="org-variable-name">i</span>=10
[root@centos8 ~]#let <span class="org-variable-name">i</span>+=20 <span class="org-comment-delimiter">#</span><span class="org-comment">&#30456;&#24403;&#20110;let i=i+20
</span>[root@centos8 ~]#echo $<span class="org-variable-name">i</span>
30
[root@centos8 ~]#<span class="org-variable-name">j</span>=20
[root@centos8 ~]#let <span class="org-variable-name">i</span>*=j
[root@centos8 ~]#echo $<span class="org-variable-name">i</span>
600
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#33258;&#22686;&#65292;&#33258;&#20943;
</span><span class="org-builtin">let</span> <span class="org-variable-name">var</span>+=1
<span class="org-builtin">let</span> var++
<span class="org-builtin">let</span> <span class="org-variable-name">var</span>-=1
<span class="org-builtin">let</span> var--

[root@centos8 ~]#unset i j ; <span class="org-variable-name">i</span>=1; <span class="org-builtin">let</span> <span class="org-variable-name">j</span>=i++; <span class="org-builtin">echo</span> <span class="org-string">"i=$i,j=$j"</span>  <span class="org-comment-delimiter"># </span><span class="org-comment">i++ &#20808;&#25226;i&#36171;&#20540;&#32473;j
</span><span class="org-variable-name">i</span>=2,<span class="org-variable-name">j</span>=1
[root@centos8 ~]#unset i j ; <span class="org-variable-name">i</span>=1; <span class="org-builtin">let</span> <span class="org-variable-name">j</span>=++i; <span class="org-builtin">echo</span> <span class="org-string">"i=$i,j=$j"</span>
<span class="org-variable-name">i</span>=2,<span class="org-variable-name">j</span>=2
</pre>
</div>

<p>
范例：expr 计算
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#expr 2 * 3
expr: syntax error: unexpected argument &#8216;anaconda-ks.cfg&#8217;
[root@centos8 ~]#ls
anaconda-ks.cfg
[root@centos8 ~]#expr 2 <span class="org-string">\*</span> 3
6
</pre>
</div>

<p>
范例：bc计算
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#echo <span class="org-string">"scale=3;20/3"</span>|bc
6.666

<span class="org-comment-delimiter"># </span><span class="org-comment">echo 2^128 | bc  # 2 &#30340; 128 &#27425;&#26041;
</span>340282366920938463463374607431768211456
</pre>
</div>

<p>
范例 declare 计算
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#<span class="org-variable-name">i</span>=10
[root@centos8 ~]#<span class="org-variable-name">j</span>=20
[root@centos8 ~]#declare -i <span class="org-variable-name">result</span>=i*j
[root@centos8 ~]#echo $<span class="org-variable-name">result</span>
200
</pre>
</div>
</div>
<div id="outline-container-算术表达式中进制转换" class="outline-4">
<h4 id="算术表达式中进制转换"><a href="#算术表达式中进制转换"><code>算术表达式中进制转换</code></a></h4>
<div class="outline-text-4" id="text-算术表达式中进制转换">
<p>
表达式中的进制
</p>

<p>
方法1 利用bash特性
</p>

<ul class="org-ul">
<li>0为前导的常量当作8进制</li>
<li>0x、0X为16进制</li>
<li>其他数字的形式是 [base#]n</li>
</ul>

<p>
方法2 利用外部命令
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">1. &#36716;&#21313;&#36827;&#21046;  echo&#40664;&#35748;&#36755;&#20986;&#26159;10&#36827;&#21046;
</span><span class="org-comment-delimiter"># </span><span class="org-comment">2&#36827;&#21046;&#36716;10&#36827;&#21046;
</span>((<span class="org-variable-name">num</span>=2#111111)); <span class="org-builtin">echo</span> $<span class="org-variable-name">num</span> <span class="org-comment-delimiter"># </span><span class="org-comment">63 
</span><span class="org-builtin">let</span> <span class="org-variable-name">num</span>=2#111111 ; <span class="org-builtin">echo</span> $<span class="org-variable-name">num</span> <span class="org-comment-delimiter"># </span><span class="org-comment">63 &#36866;&#29992;&#20110;&#20854;&#23427;&#36827;&#21046;&#36716;10
</span><span class="org-builtin">echo</span> $((2#111111)) <span class="org-comment-delimiter"># </span><span class="org-comment">63 &#36866;&#29992;&#20110;&#20854;&#23427;&#36827;&#21046;&#36716;10
</span><span class="org-builtin">echo</span> $[2#111111] <span class="org-comment-delimiter"># </span><span class="org-comment">63 &#36866;&#29992;&#20110;&#20854;&#23427;&#36827;&#21046;&#36716;10
</span><span class="org-builtin">echo</span> <span class="org-string">'obase=10;ibase=2;111111'</span>|bc <span class="org-comment-delimiter"># </span><span class="org-comment">63 &#36866;&#29992;&#20110;&#20854;&#23427;&#36827;&#21046;&#36716;10
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">8&#36827;&#21046;&#36716;10&#36827;&#21046;
</span>((<span class="org-variable-name">num</span>=0123)) ; <span class="org-builtin">echo</span> $<span class="org-variable-name">num</span> <span class="org-comment-delimiter"># </span><span class="org-comment">83   
</span>((<span class="org-variable-name">num</span>=8#123)) ; <span class="org-builtin">echo</span> $<span class="org-variable-name">num</span> <span class="org-comment-delimiter"># </span><span class="org-comment">83 
</span>printf <span class="org-string">'%d\n'</span> 04553207 <span class="org-comment-delimiter"># </span><span class="org-comment">1234567
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">16&#36827;&#21046;&#36716;10&#36827;&#21046;
</span>((<span class="org-variable-name">num</span>=0xff)); <span class="org-builtin">echo</span> $<span class="org-variable-name">num</span> <span class="org-comment-delimiter"># </span><span class="org-comment">255
</span>((<span class="org-variable-name">num</span>=16#ff)); <span class="org-builtin">echo</span> $<span class="org-variable-name">num</span> <span class="org-comment-delimiter"># </span><span class="org-comment">255
</span>printf <span class="org-string">'%d\n'</span> 0xFF <span class="org-comment-delimiter"># </span><span class="org-comment">255
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">base32&#36716;10&#36827;&#21046;
</span>((<span class="org-variable-name">num</span>=32#ffff)); <span class="org-builtin">echo</span> $<span class="org-variable-name">num</span> <span class="org-comment-delimiter"># </span><span class="org-comment">507375
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">base64 &#36716;10&#36827;&#21046;
</span>((<span class="org-variable-name">num</span>=64#abc_)); <span class="org-builtin">echo</span> $<span class="org-variable-name">num</span> <span class="org-comment-delimiter"># </span><span class="org-comment">2667327
</span><span class="org-builtin">let</span> <span class="org-variable-name">num</span>=64#abc_; <span class="org-builtin">echo</span> $<span class="org-variable-name">num</span> <span class="org-comment-delimiter"># </span><span class="org-comment">2667327
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">2. &#21313;&#36827;&#21046;&#36716;&#20854;&#23427;&#36827;&#21046;
</span><span class="org-comment-delimiter"># </span><span class="org-comment">&#21033;&#29992;bc&#21629;&#20196;&#65292;echo "obase=&#36827;&#21046;;&#20540;"|bc  ; ibase&#26159;&#36755;&#20837;&#36827;&#21046;&#65307;&#38480;&#21046;&#33539;&#22260;2~16 ;&#160;obase&#26159;&#36755;&#20986;&#36827;&#21046;,&#25918;ibase&#21069;&#38754;
</span><span class="org-comment-delimiter"># </span><span class="org-comment">printf &#21629;&#20196; %d,%i : &#21313;&#36827;&#21046;&#25972;&#25968;;  %o: &#20843;&#36827;&#21046;&#20540; ; %x : &#21313;&#20845;&#36827;&#21046;&#20540;&#65288;a-f&#65289;; %X : &#21313;&#20845;&#36827;&#21046;&#20540;&#65288;A-F&#65289;
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">10&#36827;&#21046;&#36716;2&#36827;&#21046;
</span><span class="org-builtin">echo</span> <span class="org-string">'obase=2;ibase=10;172'</span>|bc <span class="org-comment-delimiter"># </span><span class="org-comment">10101100 ibase&#19981;&#20889;&#40664;&#35748;&#36755;&#20837;&#26159;10&#36827;&#21046;
</span><span class="org-builtin">echo</span> <span class="org-string">'obase=2;172'</span>|bc <span class="org-comment-delimiter"># </span><span class="org-comment">10101100
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">10&#36827;&#21046;&#36716;8&#36827;&#21046;
</span><span class="org-builtin">echo</span> <span class="org-string">"obase=8;01234567"</span>|bc <span class="org-comment-delimiter"># </span><span class="org-comment">4553207
</span>printf <span class="org-string">'%o\n'</span> 1234567 <span class="org-comment-delimiter"># </span><span class="org-comment">4553207
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">10&#36827;&#21046;&#36716;16&#36827;&#21046;
</span><span class="org-builtin">echo</span> <span class="org-string">"obase=16;255"</span> |bc <span class="org-comment-delimiter"># </span><span class="org-comment">FF
</span>printf <span class="org-string">"%X\n"</span> 255 <span class="org-comment-delimiter"># </span><span class="org-comment">FF
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">10&#36827;&#21046;&#36716;64&#36827;&#21046;
</span><span class="org-builtin">echo</span> <span class="org-string">"obase=64;123456"</span>|bc &#160;
&#160; &#160; 30 09 00
</pre>
</div>

<p>
范例：今有雉兔同笼，上有三十五头，下有九十四足，问雉兔各几何？
</p>

<pre class="example" id="orgf73b5e5">
除2元1次方程 x+y=25 2x+4y=94
抬脚法：鸡兔把2只脚本都抬起来，就只有兔子的脚了

1. 都抬1只 94-35=59

2. 再抬1只 59-35=24 24只都是兔子的脚

3. 24/2=12 兔子有12只

4. 35-12=23 鸡有23只
</pre>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 scripts]#cat chook_rabbit.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-variable-name">HEAD</span>=$<span class="org-variable-name">1</span>
<span class="org-variable-name">FOOT</span>=$<span class="org-variable-name">2</span>

<span class="org-variable-name">RABBIT</span>=$(((FOOT-HEAD-HEAD)/2))
<span class="org-variable-name">CHOOK</span>=$[HEAD-RABBIT]
<span class="org-builtin">echo</span> RABBIT:$<span class="org-variable-name">RABBIT</span>
<span class="org-builtin">echo</span> CHOOK:$<span class="org-variable-name">CHOOK</span>

[root@centos8 scripts]#./chook_rabbit.sh 30 80
RABBIT:10
CHOOK:20
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:2897e64f-fddf-4ccf-9370-7f21cd328c13" class="outline-3">
<h3 id="h:2897e64f-fddf-4ccf-9370-7f21cd328c13"><a href="#h:2897e64f-fddf-4ccf-9370-7f21cd328c13">shell 逻辑运算</a></h3>
<div class="outline-text-3" id="text-h:2897e64f-fddf-4ccf-9370-7f21cd328c13">
<p>
true, false
</p>

<pre class="example" id="org2b6d4d3">
1，真
0，假
</pre>

<p>
与&amp; ： 和0相与，结果为0，和1相与，结果保留原值
</p>

<pre class="example" id="org517507a">
1 与 1 = 1
1 与 0 = 0
0 与 1 = 0
0 与 0 = 0
</pre>

<p>
或|： 和1相或结果为1，和0相或，结果保留原值
</p>

<pre class="example" id="org70aaaae">
1 或 1 = 1
1 或 0 = 1
0 或 1 = 1
0 或 0 = 0
</pre>

<p>
<b>非：！</b> 
</p>

<pre class="example" id="orgd9b89da">
! 1 = 0    ! true
! 0 = 1    ! false
</pre>

<p>
<b>异或：^</b>
</p>

<p>
异或的两个值，相同为假，不同为真。 <code>两个数字X,Y异或得到结果Z，Z再和任意两者之一X异或，将得出另一个值Y</code>
</p>

<div class="org-src-container">
<pre class="src src-sh">1 ^ <span class="org-variable-name">1</span> = 0
1 ^ <span class="org-variable-name">0</span> = 1
0 ^ <span class="org-variable-name">1</span> = 1
0 ^ <span class="org-variable-name">0</span> = 0
</pre>
</div>

<p>
范例: <code>异或运算，2个变量数值交换</code>
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#true
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#false
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1
[root@centos8 ~]#! true
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1
[root@centos8 ~]#! false
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#<span class="org-variable-name">x</span>=10;<span class="org-variable-name">y</span>=20;<span class="org-variable-name">temp</span>=$<span class="org-variable-name">x</span>;<span class="org-variable-name">x</span>=$<span class="org-variable-name">y</span>;<span class="org-variable-name">y</span>=$<span class="org-variable-name">temp</span>;<span class="org-builtin">echo</span> <span class="org-variable-name">x</span>=$<span class="org-variable-name">x</span>,<span class="org-variable-name">y</span>=$<span class="org-variable-name">y</span>
<span class="org-variable-name">x</span>=20,<span class="org-variable-name">y</span>=10
<span class="org-comment-delimiter"># </span><span class="org-comment">&#24322;&#25110;&#36816;&#31639;&#65292;2&#20010;&#21464;&#37327;&#25968;&#20540;&#20132;&#25442;
</span>[root@centos8 ~]#<span class="org-variable-name">x</span>=10;<span class="org-variable-name">y</span>=20;<span class="org-variable-name">x</span>=$[x^y];<span class="org-variable-name">y</span>=$[x^y];<span class="org-variable-name">x</span>=$[x^y];<span class="org-builtin">echo</span> <span class="org-variable-name">x</span>=$<span class="org-variable-name">x</span>,<span class="org-variable-name">y</span>=$<span class="org-variable-name">y</span>
<span class="org-variable-name">x</span>=20,<span class="org-variable-name">y</span>=10
</pre>
</div>

<p>
<b>短路运算</b>
</p>

<ul class="org-ul">
<li><p>
短路与
</p>

<pre class="example" id="org518bb79">
CMD1 短路与 CMD2

第一个CMD1结果为真 (1)，第二个CMD2必须要参与运算，才能得到最终的结果
第一个CMD1结果为假 (0)，总的结果必定为0，因此不需要执行CMD2
</pre></li>

<li><p>
短路或
</p>

<pre class="example" id="org80ce817">
CMD1 短路或 CMD2

第一个CMD1结果为真 (1)，总的结果必定为1，因此不需要执行CMD2
第一个CMD1结果为假 (0)，第二个CMD2 必须要参与运算,,才能得到最终的结果
</pre></li>
</ul>
</div>
</div>
<div id="outline-container-条件测试命令" class="outline-3">
<h3 id="条件测试命令"><a href="#条件测试命令">条件测试命令</a></h3>
<div class="outline-text-3" id="text-条件测试命令">
<p>
条件测试：判断某需求是否满足，需要由测试机制来实现，专用的测试表达式需
要由测试命令辅助完成测试过程，实现评估布尔声明，以便用在条件性环境下进
行执行
</p>

<p>
若真，则状态码变量 <code>$?</code> 返回 0
</p>

<p>
若假，则状态码变量 <code>$?</code> 返回1
</p>

<p>
条件测试命令
</p>

<pre class="example" id="org3e49cd5">
- test EXPRESSION
- [ EXPRESSION ] 和 test 等价，建议使用 [ ]
- [[ EXPRESSION ]] 意：EXPRESSION前后必须有空白字符
</pre>


<p>
帮助：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#type [
[ is a shell builtin
[root@centos8 ~]#help [
[: [ arg... ]
 Evaluate conditional expression.

 This is a synonym for the <span class="org-string">"test"</span> builtin, but the last argument must
 be a literal <span class="org-sh-quoted-exec">`]', to match the opening `</span>[<span class="org-string">'.
[root@centos8 ~]#help test
test: test [expr]
 Evaluate conditional expression.

 Exits with a status of 0 (true) or 1 (false) depending on
 the evaluation of EXPR. Expressions may be unary or binary. Unary
 expressions are often used to examine the status of a file. There
 are string operators and numeric comparison operators as well.

 The behavior of test depends on the number of arguments. Read the
 bash manual page for the complete specification.

 File operators:

  -a FILE    True if file exists.
  -b FILE    True if file is block special.
  -c FILE    True if file is character special.
  -d FILE    True if file is a directory.
  -e FILE    True if file exists.
  -f FILE    True if file exists and is a regular file.
  -g FILE    True if file is set-group-id.
  -h FILE    True if file is a symbolic link.
  -L FILE    True if file is a symbolic link.
  -k FILE    True if file has its `sticky'</span> bit set.
  -p FILE    True if file is a named pipe.
  -r FILE    True if file is readable by you.
  -s FILE    True if file exists and is not empty.
  -S FILE    True if file is a socket.
  -t FD     True if FD is opened on a terminal.
  -u FILE    True if the file is set-user-id.
  -w FILE    True if the file is writable by you.
  -x FILE    True if the file is executable by you.
  -O FILE    True if the file is effectively owned by you.
  -G FILE    True if the file is effectively owned by your group.
  -N FILE    True if the file has been modified since it was last read.

  FILE1 -nt FILE2 True if file1 is newer than file2 (according to
           modification date).

  FILE1 -ot FILE2 True if file1 is older than file2.

  FILE1 -ef FILE2 True if file1 is a hard link to file2.

 String operators:

  -z STRING   True if string is empty.

  -n STRING
    STRING   True if string is not empty.

  <span class="org-variable-name">STRING1</span> = STRING2
          True if the strings are equal.
  STRING1 != STRING2
          True if the strings are not equal.
  STRING1 &lt; STRING2
          True if STRING1 sorts before STRING2 lexicographically.
  STRING1 &gt; STRING2

          True if STRING1 sorts after STRING2 lexicographically.

 Other operators:

  -o OPTION   True if the shell option OPTION is enabled.
  -v VAR     True if the shell variable VAR is set.
  -R VAR     True if the shell variable VAR is set and is a name
          reference.
  <span class="org-negation-char">!</span> EXPR     True if expr is false.
  EXPR1 -a EXPR2 True if both expr1 AND expr2 are true.
  EXPR1 -o EXPR2 True if either expr1 OR expr2 is true.

  arg1 OP arg2  Arithmetic tests. OP is one of -eq, -ne,
          -lt, -le, -gt, or -ge.

 Arithmetic binary operators return true if ARG1 is equal, not-equal,
 less-than, less-than-or-equal, greater-than, or greater-than-or-equal
 than ARG2.

 Exit Status:
 Returns success if EXPR evaluates to true; fails if EXPR evaluates to
 <span class="org-builtin">false</span> or an invalid argument is given.
[root@centos8 ~]#
</pre>
</div>
</div>
<div id="outline-container-变量测试" class="outline-4">
<h4 id="变量测试"><a href="#变量测试">变量测试</a></h4>
<div class="outline-text-4" id="text-变量测试">
<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#21028;&#26029; NAME &#21464;&#37327;&#26159;&#21542;&#23450;&#20041;
</span>[ -v NAME ]

<span class="org-comment-delimiter">#</span><span class="org-comment">&#21028;&#26029; NAME &#21464;&#37327;&#26159;&#21542;&#23450;&#20041;&#24182;&#19988;&#26159;&#21517;&#31216;&#24341;&#29992;,bash 4.4&#26032;&#29305;&#24615;
</span>[ -R NAME ]
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#unset x
[root@centos8 ~]#test -v x
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1
[root@centos8 ~]#<span class="org-variable-name">x</span>=10
[root@centos8 ~]#test -v x
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#<span class="org-variable-name">y</span>=
[root@centos8 ~]#test -v y
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0

<span class="org-comment-delimiter">#</span><span class="org-comment">&#27880;&#24847; [ ] &#38656;&#35201;&#31354;&#26684;&#65292;&#21542;&#21017;&#20250;&#25253;&#19979;&#38754;&#38169;&#35823;
</span>[root@centos8 ~]#[-v y]
-bash: [-v: command not found
[root@centos8 ~]#[ -v y ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
</pre>
</div>
</div>
</div>
<div id="outline-container-数值测试" class="outline-4">
<h4 id="数值测试"><a href="#数值测试">数值测试</a></h4>
<div class="outline-text-4" id="text-数值测试">
<div class="org-src-container">
<pre class="src src-sh">-eq &#26159;&#21542;&#31561;&#20110;
-ne &#26159;&#21542;&#19981;&#31561;&#20110;
-gt &#26159;&#21542;&#22823;&#20110;
-ge &#26159;&#21542;&#22823;&#20110;&#31561;&#20110;
-lt &#26159;&#21542;&#23567;&#20110;
-le &#26159;&#21542;&#23567;&#20110;&#31561;&#20110;
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#<span class="org-variable-name">i</span>=10
[root@centos8 ~]#<span class="org-variable-name">j</span>=8
[root@centos8 ~]#[ $<span class="org-variable-name">i</span> -lt $<span class="org-variable-name">j</span> ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1
[root@centos8 ~]#[ $<span class="org-variable-name">i</span> -gt $<span class="org-variable-name">j</span> ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#[ i -gt j ]
-bash: [: i: integer expression expected
</pre>
</div>

<p>
算术表达式比较
</p>

<pre class="example" id="org7135671">
==  相等
!=  不相等
&lt;=
&gt;=
&lt;
&gt;
</pre>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#<span class="org-variable-name">x</span>=10;<span class="org-variable-name">y</span>=10;(( <span class="org-variable-name">x</span> == y ));<span class="org-builtin">echo</span> $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#<span class="org-variable-name">x</span>=10;<span class="org-variable-name">y</span>=20;(( <span class="org-variable-name">x</span> == y ));<span class="org-builtin">echo</span> $<span class="org-variable-name">?</span>
1
[root@centos8 ~]#<span class="org-variable-name">x</span>=10;<span class="org-variable-name">y</span>=20;(( x != y ));<span class="org-builtin">echo</span> $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#<span class="org-variable-name">x</span>=10;<span class="org-variable-name">y</span>=10;(( x != y ));<span class="org-builtin">echo</span> $<span class="org-variable-name">?</span>
1

[root@centos8 ~]#<span class="org-variable-name">x</span>=10;<span class="org-variable-name">y</span>=20;(( x &gt; y ));<span class="org-builtin">echo</span> $<span class="org-variable-name">?</span>
1
[root@centos8 ~]#<span class="org-variable-name">x</span>=10;<span class="org-variable-name">y</span>=20;(( x &lt; y ));<span class="org-builtin">echo</span> $<span class="org-variable-name">?</span>
0
</pre>
</div>
</div>
</div>
<div id="outline-container-字符串测试" class="outline-4">
<h4 id="字符串测试"><a href="#字符串测试">字符串测试</a></h4>
<div class="outline-text-4" id="text-字符串测试">
<p>
test和 <code>[ ]</code> 用法
</p>

<pre class="example" id="org96d0030">
test和 [ ]用法
-z “STRING” 字符串是否为空，没定义或空为真，不空为假，
-n ”STRING“ 字符串是否不空，不空为真，空为假
 STRING  同上 如[ "$str" ]

STRING1 = STRING2 是否等于，注意 = 前后有空格
STRING1 != STRING2 是否不等于
&gt; ascii码是否大于ascii码
&lt; 是否小于
</pre>

<p>
<code>[[ ]]</code> 用法
</p>
<pre class="example" id="org443d3fb">
[[ expression ]] 用法，建议，当使用正则表达式或通配符使用，其它一般情况使用 [ ]做字符比较
==  左侧字符串是否和右侧的PATTERN相同
    注意:此表达式用于[[ ]]中，PATTERN为通配符
=~ 左侧字符串是否能够被右侧的正则表达式的PATTERN所匹配
    注意: 此表达式用于[[ ]]中；扩展的正则表达式

注意： 
(1) 字符串加引用，'' ""， 排除空格干扰
(2) == 右侧的 * 做为通配符，不要加“”，只想做为*, 需要加“” 或转义
</pre>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#unset str
[root@centos8 ~]#[ -z <span class="org-string">"$str"</span> ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#<span class="org-variable-name">str</span>=<span class="org-string">""</span>
[root@centos8 ~]#[ -z <span class="org-string">"$str"</span> ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#<span class="org-variable-name">str</span>=<span class="org-string">" "</span>
[root@centos8 ~]#[ -z <span class="org-string">"$str"</span> ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1
[root@centos8 ~]#[ -n <span class="org-string">"$str"</span> ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#unset str
[root@centos8 ~]#[ -n <span class="org-string">"$str"</span> ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1
[root@centos8 ~]#[ <span class="org-string">"$str"</span> ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1
[root@centos8 ~]#<span class="org-variable-name">str</span>=mu
[root@centos8 ~]#[ <span class="org-string">"$str"</span> ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0

[root@centos8 ~]#<span class="org-variable-name">str1</span>=mu
[root@centos8 ~]#<span class="org-variable-name">str2</span>=me
[root@centos8 ~]#[ $<span class="org-variable-name">str1</span> = $<span class="org-variable-name">str2</span> ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1
[root@centos8 ~]#<span class="org-variable-name">str2</span>=mu
[root@centos8 ~]#[ $<span class="org-variable-name">str1</span> = $<span class="org-variable-name">str2</span> ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
</pre>
</div>

<p>
范例：在比较字符串时，建议变量放在 <code>""</code> 中
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#[ <span class="org-string">"$NAME"</span> ]
[root@centos8 ~]#<span class="org-variable-name">NAME</span>=<span class="org-string">"I love linux"</span>
[root@centos8 ~]#[ $<span class="org-variable-name">NAME</span> ]  <span class="org-comment-delimiter"># </span><span class="org-comment">&#21464;&#37327;&#26377;&#20013;&#31354;&#26684;&#22312;&#27604;&#36739;&#20013;&#25253;&#38169;&#65292;&#24314;&#35758;&#21152;"&#21452;&#24341;&#21495;
</span>-bash: [: love: binary operator expected
[root@centos8 ~]#[ <span class="org-string">"$NAME"</span> ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#[ I love linux ]
-bash: [: love: binary operator expected
</pre>
</div>

<p>
范例: <code>[[ ]]</code> 用法匹配字符
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#36890;&#37197;&#31526;
</span>[root@centos8 ~]#<span class="org-variable-name">FILE</span>=test.log
[root@centos8 ~]#[[ <span class="org-string">"$FILE"</span> == *.log ]]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#<span class="org-variable-name">FILE</span>=test.txt
[root@centos8 ~]#[[ <span class="org-string">"$FILE"</span> == *.log ]]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1
[root@centos8 ~]#[[ <span class="org-string">"$FILE"</span> != *.log ]]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0

<span class="org-comment-delimiter">#</span><span class="org-comment">&#27491;&#21017;&#34920;&#36798;&#24335;
</span>[root@centos8 ~]#[[ <span class="org-string">"$FILE"</span> =~ <span class="org-string">\.</span>log$ ]]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1
[root@centos8 ~]#<span class="org-variable-name">FILE</span>=test.log
[root@centos8 ~]#[[ <span class="org-string">"$FILE"</span> =~ <span class="org-string">\.</span>log$ ]]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0

[root@centos8 ~]#<span class="org-variable-name">N</span>=100
[root@centos8 ~]#[[ <span class="org-string">"$N"</span> =~ ^[0-9]+$ ]]  <span class="org-comment-delimiter"># </span><span class="org-comment">&#21028;&#26029;&#26159;&#21542;&#20026;&#25968;&#23383;
</span>[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#<span class="org-variable-name">N</span>=me10
[root@centos8 ~]#[[ <span class="org-string">"$N"</span> =~ ^[0-9]+$ ]]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1

<span class="org-comment-delimiter">#</span><span class="org-comment">ip&#22320;&#22336;&#21305;&#37197;
</span>[root@centos8 ~]#<span class="org-variable-name">IP</span>=1.2.3.4
[root@centos8 ~]#[[ <span class="org-string">"$IP"</span> =~ ^([0-9]{1,3}<span class="org-string">\.</span>){3}[0-9]{1,3}$ ]]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#<span class="org-variable-name">IP</span>=1.2.3.4567
[root@centos8 ~]#[[ <span class="org-string">"$IP"</span> =~ ^([0-9]{1,3}.){3}[0-9]{1,3}$ ]]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1

[root@centos8 ~]#[[ $<span class="org-variable-name">IP</span> =~ ^(([1-9]?[0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])<span class="org-string">\.</span>){3}([1-9]?[0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$ ]]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1

<span class="org-comment-delimiter">#</span><span class="org-comment">-----------------------------
</span><span class="org-comment-delimiter">#</span><span class="org-comment">&#36890;&#37197;&#31526;
</span>[root@centos8 ~]#<span class="org-variable-name">NAME</span>=<span class="org-string">"linux1"</span>
[root@centos8 ~]#[[ <span class="org-string">"$NAME"</span> == linux* ]]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#[[ <span class="org-string">"$NAME"</span> == <span class="org-string">"linux*"</span> ]]   <span class="org-comment-delimiter"># </span><span class="org-comment">&#22914;&#26524;*&#20889;&#22312;""&#21495;&#20869;&#65292;&#20195;&#34920;&#26222;&#36890;&#23383;&#31526;
</span>[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1
[root@centos8 ~]#<span class="org-variable-name">NAME</span>=<span class="org-string">"linux*"</span>
[root@centos8 ~]#[[ <span class="org-string">"$NAME"</span> == <span class="org-string">"linux*"</span> ]]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0

<span class="org-comment-delimiter">#</span><span class="org-comment">&#32467;&#35770;&#65306;[[ == ]] == &#21491;&#20391;&#30340; * &#20570;&#20026;&#36890;&#37197;&#31526;&#65292;&#19981;&#35201;&#21152;&#8220;&#8221;&#65292;&#21482;&#24819;&#20570;&#20026;*, &#38656;&#35201;&#21152;&#8220;&#8221; &#25110;&#36716;&#20041;</span>
</pre>
</div>
</div>
<div id="outline-container-字符串是否为数字的方法" class="outline-5">
<h5 id="字符串是否为数字的方法"><a href="#字符串是否为数字的方法">字符串是否为数字的方法</a></h5>
<div class="outline-text-5" id="text-字符串是否为数字的方法">
<p>
<code>[[]]</code> 中 `=~` 此表达式用于 <code>[[]]</code> 中右侧是 <code>扩展的正则表达式</code>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">=~ &#27492;&#34920;&#36798;&#24335;&#29992;&#20110;[[ ]]&#20013;&#21491;&#20391;&#26159;&#25193;&#23637;&#30340;&#27491;&#21017;&#34920;&#36798;&#24335;
</span>[root@centos8 ~]#<span class="org-variable-name">N</span>=100
[root@centos8 ~]#[[ <span class="org-string">"$N"</span> =~ ^[0-9]+$ ]]  <span class="org-comment-delimiter"># </span><span class="org-comment">&#21028;&#26029;&#26159;&#21542;&#20026;&#25968;&#23383;
</span>[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-文件测试" class="outline-4">
<h4 id="文件测试"><a href="#文件测试">文件测试</a></h4>
<div class="outline-text-4" id="text-文件测试">
<p>
存在性测试
</p>

<pre class="example" id="orgd3b73d2">
(1) 存在性测试
-a FILE：同 -e
-e FILE: 文件存在性测试，存在为真，否则为假

(2)存在性及文件类型测试
-b FILE：是否存在且为块设备文件
-c FILE：是否存在且为字符设备文件
-d FILE：是否存在且为目录文件
-f FILE：是否存在且为普通文件
-h FILE 或 -L FILE：存在且为符号链接文件
-p FILE：是否存在且为命名管道文件
-S FILE：是否存在且为套接字文件
</pre>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#[ -a /etc/nologin ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1
[root@centos8 ~]#! [ -a /etc/nologin ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0

[root@centos8 ~]#[ -d /etc ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#[ -d /etc/issue ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1

[root@centos8 ~]#[ -L /bin ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#[ -L /bin/ ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1
</pre>
</div>

<p>
文件权限测试：
</p>

<pre class="example" id="orgce5ad78">
-r FILE：是否存在且可读
-w FILE: 是否存在且可写
-x FILE: 是否存在且可执行
-u FILE：是否存在且拥有suid权限
-g FILE：是否存在且拥有sgid权限
-k FILE：是否存在且拥有sticky权限
</pre>

<p>
<b>注意：最终结果由用户对文件的实际权限决定，而非文件属性决定</b>
</p>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#[ -w /etc/shadow ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#[ -x /etc/shadow ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1

[root@centos8 ~]#[ -w test.txt ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#chattr +i test.txt
[root@centos8 ~]#lsattr test.txt
----i-------------- nianling.txt
[root@centos8 ~]#[ -w test.txt ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1
[root@centos8 ~]#chattr -i test.txt
[root@centos8 ~]#[ -w test.txt ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
</pre>
</div>

<p>
文件属性测试
</p>

<pre class="example" id="org86f7d50">
-s FILE #是否有内容；有内容为真，否则为假
-t fd #fd 文件描述符是否在某终端已经打开
-N FILE #文件自从上一次被读取之后是否被修改过
-O FILE #当前有效用户是否为文件属主
-G FILE #当前有效用户是否为文件属组
FILE1 -ef FILE2 #FILE1是否是FILE2的硬链接
FILE1 -nt FILE2 #FILE1是否新于FILE2（mtime）
FILE1 -ot FILE2 #FILE1是否旧于FILE2
</pre>
</div>
</div>
</div>
<div id="outline-container-关于-和-中多个命令组合" class="outline-3">
<h3 id="关于-和-中多个命令组合"><a href="#关于-和-中多个命令组合">关于 () 和 {}中多个命令组合</a></h3>
<div class="outline-text-3" id="text-关于-和-中多个命令组合">
<p>
<code>(CMD1;CMD2;...)</code> 和 <code>{ CMD1;CMD2;...; }</code> 都可以将多个命令组合在一起，
批量执行
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#man bash
</pre>
</div>

<pre class="example" id="org5898b9d">
# 关于 () 和 {}中多个命令组合
( list ) 会开启子shell,并且list中变量赋值及内部命令执行后,将不再影响后续的环境, 帮助参看:man bash搜索(list)

{ list; } 不会启子shell, 在当前shell中运行,会影响当前shell环境, 帮助参看:man bash 搜索{ list; }

这里{ list; }&amp; ; wait 方式实例并行处理。wait代表等待所有命令执行结束，不加wait最后要手动按回车键。
</pre>

<p>
小结
</p>

<pre class="example" id="orgf9ca9af">
子shell: () | &amp;
当前shell: source ./  和 {}
</pre>

<p>
范例: <code>()</code> 和 <code>{}</code>
</p>

<p>
环境变量声明和赋值：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#22768;&#26126;&#24182;&#36171;&#20540;
</span><span class="org-builtin">export</span> <span class="org-variable-name">name</span>=VALUE
<span class="org-builtin">declare</span> -x <span class="org-variable-name">name</span>=VALUE
<span class="org-comment-delimiter">#</span><span class="org-comment">&#25110;&#32773;&#20998;&#20004;&#27493;&#23454;&#29616;
</span><span class="org-variable-name">name</span>=VALUE
<span class="org-builtin">export</span> name
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">() &#20250;&#32487;&#25215;&#29238;&#36827;&#31243;&#21464;&#37327;&#12290; &#20294;&#19968;&#33324;&#29615;&#22659;&#21464;&#37327;&#25165;&#33021;&#34987;&#32487;&#25215;
</span>[root@centos8 ~]#<span class="org-variable-name">name</span>=me;(<span class="org-builtin">echo</span> $<span class="org-variable-name">name</span>;<span class="org-variable-name">name</span>=wang;<span class="org-builtin">echo</span> $<span class="org-variable-name">name</span> );<span class="org-builtin">echo</span> $<span class="org-variable-name">name</span>  
me
wang
me
[root@centos8 ~]#<span class="org-variable-name">name</span>=me;{ <span class="org-builtin">echo</span> $<span class="org-variable-name">name</span>;<span class="org-variable-name">name</span>=wang;<span class="org-builtin">echo</span> $<span class="org-variable-name">name</span>; } ;<span class="org-builtin">echo</span> $<span class="org-variable-name">name</span>
me
wang
wang

[root@centos8 ~]#umask
0022
[root@centos8 ~]#(<span class="org-builtin">umask</span> 066;touch f1.txt)
[root@centos8 ~]#ll f1.txt
-rw------- 1 root root 0 Dec 23 16:58 f1.txt
[root@centos8 ~]#umask
0022
[root@centos8 ~]#( <span class="org-builtin">cd</span> /data;ls )
test.log
[root@centos8 ~]#pwd
/root
[root@centos8 ~]#{ <span class="org-builtin">cd</span> /data;ls; }
test.log
[root@centos8 data]#pwd
/data
[root@centos8 data]#

<span class="org-comment-delimiter">#</span><span class="org-comment">&#65288;&#65289;&#20250;&#24320;&#21551;&#23376;shell
</span>[root@centos8 ~]#echo $<span class="org-variable-name">BASHPID</span>
1920
[root@centos8 ~]#( <span class="org-builtin">echo</span> $<span class="org-variable-name">BASHPID</span>;sleep 100)
1979
[root@centos8 ~]#pstree -p
&#9500;&#9472;sshd(719)&#9472;&#9472;&#9472;sshd(1906)&#9472;&#9472;&#9472;sshd(1919)&#9472;&#9516;&#9472;bash(1920)&#9472;&#9472;&#9472;bash(1979)&#9472;&#9472;&#9472;sleep(1980)

<span class="org-comment-delimiter">#</span><span class="org-comment">{ } &#19981;&#20250;&#24320;&#21551;&#23376;shell
</span>[root@centos8 ~]#echo $<span class="org-variable-name">BASHPID</span>
1920
[root@centos8 ~]#{ <span class="org-builtin">echo</span> $<span class="org-variable-name">BASHPID</span>; }
1920
</pre>
</div>

<p>
后面可以结合shell函数定义并发程序，甚至写一个fork炸弹。
</p>
</div>
</div>
<div id="outline-container-组合测试条件" class="outline-3">
<h3 id="组合测试条件"><a href="#组合测试条件">组合测试条件</a></h3>
<div class="outline-text-3" id="text-组合测试条件">
</div>
<div id="outline-container-第一种方式" class="outline-4">
<h4 id="第一种方式"><a href="#第一种方式">第一种方式 [ ]</a></h4>
<div class="outline-text-4" id="text-第一种方式">
<pre class="example" id="orge35d05d">
[ EXPRESSION1 -a EXPRESSION2 ] 并且，EXPRESSION1和EXPRESSION2都是真，结果才为真
[ EXPRESSION1 -o EXPRESSION2 ] 或者，EXPRESSION1和EXPRESSION2只要有一个真，结果就为真
[ ! EXPRESSION ] 取反
</pre>

<p>
说明： <code>-a 和 -o 需要使用测试命令进行，[[]] 不支持</code>
</p>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#ll /data/scrips/test.sh
-rw-r--r-- 1 root root 382 Dec 23 09:32 /data/scripts/test.sh
[root@centos8 ~]#[ -f $<span class="org-variable-name">FILE</span> -a -x $<span class="org-variable-name">FILE</span> ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1
[root@centos8 ~]#chmod +x /data/scripts/test.sh
[root@centos8 ~]#ll /data/scripts/test.sh
-rwxr-xr-x 1 root root 382 Dec 23 09:32 /data/script40/test.sh
[root@centos8 ~]#[ -f $<span class="org-variable-name">FILE</span> -a -x $<span class="org-variable-name">FILE</span> ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#chmod -x /data/scripts/test.sh

[root@centos8 ~]#ll /data/scripts/test.sh
-rw-r--r-- 1 root root 382 Dec 23 09:32 /data/scripts/test.sh
[root@centos8 ~]#[ -f $<span class="org-variable-name">FILE</span> -o -x $<span class="org-variable-name">FILE</span> ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#[ -x $<span class="org-variable-name">FILE</span> ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
1
[root@centos8 ~]#[ <span class="org-negation-char">!</span> -x $<span class="org-variable-name">FILE</span> ]
[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0
[root@centos8 ~]#! [ -x $<span class="org-variable-name">FILE</span> ]
0
</pre>
</div>
</div>
</div>
<div id="outline-container-第二种方式" class="outline-4">
<h4 id="第二种方式"><a href="#第二种方式">第二种方式 <code>[[]]</code></a></h4>
<div class="outline-text-4" id="text-第二种方式">
<div class="org-src-container">
<pre class="src src-sh">COMMAND1 &amp;&amp; COMMAND2 <span class="org-comment-delimiter">#</span><span class="org-comment">&#24182;&#19988;&#65292;&#30701;&#36335;&#19982;&#65292;&#20195;&#34920;&#26465;&#20214;&#24615;&#30340;AND THEN
</span>&#22914;&#26524;COMMAND1 &#25104;&#21151;,&#23558;&#25191;&#34892;COMMAND2,&#21542;&#21017;,&#23558;&#19981;&#25191;&#34892;COMMAND2

COMMAND1 || COMMAND2 <span class="org-comment-delimiter">#</span><span class="org-comment">&#25110;&#32773;&#65292;&#30701;&#36335;&#25110;&#65292;&#20195;&#34920;&#26465;&#20214;&#24615;&#30340;OR ELSE
</span>&#22914;&#26524;COMMAND1 &#25104;&#21151;,&#23558;&#19981;&#25191;&#34892;COMMAND2,&#21542;&#21017;,&#23558;&#25191;&#34892;COMMAND2

<span class="org-negation-char">!</span> COMMAND  <span class="org-comment-delimiter">#</span><span class="org-comment">&#38750;,&#21462;&#21453;
</span>
[root@centos7 ~]#[ $[RANDOM%6] -eq 0 ] &amp;&amp; rm -rf /* || <span class="org-builtin">echo</span> <span class="org-string">"click"</span>click
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#test <span class="org-string">"A"</span> = <span class="org-string">"B"</span> &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"Strings are equal"</span>
[root@centos8 ~]#test <span class="org-string">"A"</span>-eq <span class="org-string">"B"</span> &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"Integers are equal"</span>
[root@centos8 ~]#[ <span class="org-string">"A"</span> = <span class="org-string">"B"</span> ] &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"Strings are equal"</span>
[root@centos8 ~]#[ <span class="org-string">"$A"</span> -eq <span class="org-string">"$B"</span> ] &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"Integers are equal"</span>
-bash: [: : integer expression expected

[root@centos8 ~]#[ -f /bin/cat -a -x /bin/cat ] &amp;&amp; cat /etc/fstab
[root@centos8 ~]#[ -z <span class="org-string">"$HOSTNAME"</span> -o <span class="org-string">"$HOSTNAME"</span> = <span class="org-string">"localhost.localdomain"</span> ]&amp; &amp; hostname centos

[root@centos8 ~]#id wang &amp;&gt; /dev/null ||  useradd wang
[root@centos8 ~]#id zhang &amp;&gt; /dev/null ||  useradd zhang
[root@centos8 ~]#getent passwd zhang
zhang:x:1002:1002::/home/zhang:/bin/bash
[root@centos8 ~]#grep -q no_such_user /etc/passwd || <span class="org-builtin">echo</span> <span class="org-string">'No such user'</span>
No such user
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#[ -f &#8220;$<span class="org-variable-name">FILE</span>&#8221; ] &amp;&amp; [[ &#8220;$<span class="org-variable-name">FILE</span>&#8221;=~ .*<span class="org-string">\.</span>sh$ ]] &amp;&amp; chmod +x $<span class="org-variable-name">FILE</span>

[root@centos8 ~]#ping -c1 -W1 172.16.0.1 &amp;&gt; /dev/null &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">'172.16.0.1 isup'</span> || (<span class="org-builtin">echo</span> <span class="org-string">'172.16.0.1 is unreachable'</span>; <span class="org-keyword">exit</span> 1)
172.16.0.1 is up
[root@centos8 ~]#<span class="org-variable-name">IP</span>=10.0.0.111;ping -c1 -W1 $<span class="org-variable-name">IP</span> &amp;&gt; /dev/null &amp;&amp; <span class="org-builtin">echo</span> $<span class="org-variable-name">IP</span> is up || <span class="org-builtin">echo</span> $<span class="org-variable-name">IP</span> is down
10.0.0.111 is down
[root@centos8 ~]#<span class="org-variable-name">IP</span>=10.0.0.1;ping -c1 -W1 $<span class="org-variable-name">IP</span> &amp;&gt; /dev/null &amp;&amp; <span class="org-builtin">echo</span> $<span class="org-variable-name">IP</span> is up || <span class="org-builtin">echo</span> $<span class="org-variable-name">IP</span> is down
10.0.0.1 is up
</pre>
</div>

<p>
范例： <code>&amp;&amp;</code> 和 <code>||</code> 组合使用
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#<span class="org-variable-name">NAME</span>=wang; id $<span class="org-variable-name">NAME</span> &amp;&gt; /dev/null &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"$NAME is exist"</span>
wang is exist
[root@centos8 ~]#<span class="org-variable-name">NAME</span>=wange; id $<span class="org-variable-name">NAME</span> &amp;&gt; /dev/null || <span class="org-builtin">echo</span> <span class="org-string">"$NAME is notexist"</span>
wange is not exist
[root@centos8 ~]#<span class="org-variable-name">NAME</span>=wange; id $<span class="org-variable-name">NAME</span> &amp;&gt; /dev/null &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"$NAME is exist"</span> ||<span class="org-builtin">echo</span> <span class="org-string">"$NAME is not exist"</span>
wange is not exist
[root@centos8 ~]#<span class="org-variable-name">NAME</span>=wang; id $<span class="org-variable-name">NAME</span> &amp;&gt; /dev/null &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"$NAME is exist"</span> ||
<span class="org-builtin">echo</span> <span class="org-string">"$NAME is not exist"</span>
wang is exist
[root@centos8 ~]#<span class="org-variable-name">NAME</span>=wang; id $<span class="org-variable-name">NAME</span> &amp;&gt; /dev/null &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"$NAME is exist"</span> || <span class="org-builtin">echo</span> <span class="org-string">"$NAME is not exist"</span>
wang is exist
[root@centos8 ~]#<span class="org-variable-name">NAME</span>=wang; id $<span class="org-variable-name">NAME</span> &amp;&gt; /dev/null || <span class="org-builtin">echo</span> <span class="org-string">"$NAME is not exist"</span> &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"$NAME is exist"</span>
wang is exist
[root@centos8 ~]#<span class="org-variable-name">NAME</span>=wange; id $<span class="org-variable-name">NAME</span> &amp;&gt; /dev/null || <span class="org-builtin">echo</span> <span class="org-string">"$NAME is not exist"</span> &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"$NAME is exist"</span>
wange is not exist
wange is exist

<span class="org-comment-delimiter">#</span><span class="org-comment">&#32467;&#35770;&#65306;&#22914;&#26524;&amp;&amp; &#21644; || &#28151;&#21512;&#20351;&#29992;&#65292;&amp;&amp; &#35201;&#22312;&#21069;&#65292;|| &#25918;&#22312;&#21518;
</span>

[root@centos8 ~]#<span class="org-variable-name">NAME</span>=wange; id $<span class="org-variable-name">NAME</span> &amp;&gt; /dev/null &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"$NAME is exist"</span> ||useradd $<span class="org-variable-name">NAME</span>
[root@centos8 ~]#id wange
<span class="org-variable-name">uid</span>=1002(wange) <span class="org-variable-name">gid</span>=1002(wange) <span class="org-variable-name">groups</span>=1002(wange)

[root@centos8 ~]#<span class="org-variable-name">NAME</span>=wangge; id $<span class="org-variable-name">NAME</span> &amp;&gt; /dev/null &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"$NAME is exist"</span> ||( useradd $<span class="org-variable-name">NAME</span>; <span class="org-builtin">echo</span> $<span class="org-variable-name">NAME</span> is created )
wangge is created
[root@centos8 ~]#id wangge
<span class="org-variable-name">uid</span>=1003(wangge) <span class="org-variable-name">gid</span>=1003(wangge) <span class="org-variable-name">groups</span>=1003(wangge)

[root@centos8 ~]#<span class="org-variable-name">NAME</span>=wanggege; id $<span class="org-variable-name">NAME</span> &amp;&gt; /dev/null &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"$NAME is exist"</span> || { useradd $<span class="org-variable-name">NAME</span>; <span class="org-builtin">echo</span> $<span class="org-variable-name">NAME</span> is created; }
wanggege is created
</pre>
</div>


<figure id="orgd9ee7e2">
<img src="././images/image-20210206105021194.png" alt="image-20210206105021194.png" width="50%">

<figcaption><span class="figure-number">Figure 2: </span>image-20210206105021194</figcaption>
</figure>

<div class="org-src-container">
<pre class="src src-sh">[ ${#<span class="org-variable-name">monitor_info</span>[@]} -gt 0 ] &amp;&amp; {
    <span class="org-comment-delimiter"># </span><span class="org-comment">PL&#25253;&#35686;&#32676;
</span>    :
    <span class="org-comment-delimiter">#</span><span class="org-comment">dingding "a74e7f47383f0c73531bf228cc7d4d8538ada2ada124644e04b143dac585f34d" "$(echo -e "${monitor_info[@]}")"
</span>} || :
<span class="org-comment-delimiter"># </span><span class="org-comment">&#22914;&#26524;&#19978;&#38754;&#26465;&#20214;&#19981;&#25104;&#31435;&#65292;$? &#20026;1&#65292;&#22914;&#26524;&#35774;&#32622;&#20102;&#33050;&#26412;&#23433;&#20840;set -e&#65292;&#20989;&#25968;&#36820;&#22238;&#20540;&#20026;1&#65292;&#33050;&#26412;&#20250;&#36864;&#20986;&#65292;&#38543;&#20415;&#21152;&#19968;&#20010;&#21629;&#20196;&#23601;&#27809;&#20107;&#20102;</span>
</pre>
</div>

<p>
范例：网络状态判断
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /data/scripts/ping.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-variable-name">IP</span>=172.16.0.1

ping -c1 -W1 $<span class="org-variable-name">IP</span> &amp;&gt; /dev/null &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"$IP is up"</span> || {  <span class="org-builtin">echo</span> <span class="org-string">"$IP is unreachable"</span>; <span class="org-keyword">exit</span>; }
<span class="org-builtin">echo</span> <span class="org-string">"Script is finished"</span>

[root@centos8 ~]#bash /data/scripts/ping.sh
172.16.0.1 is up
Script is finished
</pre>
</div>

<p>
范例：磁盘空间的判断
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /data/script40/disk_check.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-variable-name">WARNING</span>=80
<span class="org-variable-name">SPACE_USED</span>=<span class="org-sh-quoted-exec">`df|grep '^/dev/sd'|tr -s ' ' %|cut -d% -f5|sort -nr|head -1`</span> 
[ <span class="org-string">"$SPACE_USED"</span> -ge $<span class="org-variable-name">WARNING</span> ] &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"disk used is $SPACE_USED,will be full"</span> | mail -s diskwaring root
</pre>
</div>

<p>
范例：磁盘空间和Inode号的检查脚本
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 scripts]#cat disk_check.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-variable-name">WARNING</span>=80
<span class="org-variable-name">SPACE_USED</span>=<span class="org-sh-quoted-exec">`df | grep '^/dev/sd'|grep -oE '[0-9]+%'|tr -d %| sort -nr|head -1`</span>
<span class="org-variable-name">INODE_USED</span>=<span class="org-sh-quoted-exec">`df -i | grep '^/dev/sd'|grep -oE '[0-9]+%'|tr -d %| sort -nr|head -1`</span>
[ <span class="org-string">"$SPACE_USED"</span> -gt $<span class="org-variable-name">WARNING</span> -o <span class="org-string">"$INODE_USED"</span> -gt $<span class="org-variable-name">WARNING</span> ] &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"DISK
USED:$SPACE_USED%, INODE_USED:$INODE_USED,will be full"</span> | mail -s <span class="org-string">"DISK Warning"</span> root 
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-输入输出" class="outline-3">
<h3 id="输入输出"><a href="#输入输出">输入输出</a></h3>
<div class="outline-text-3" id="text-输入输出">
<ol class="org-ol">
<li>echo, printf 输出字符串</li>
<li>cat, bat 输出文件内容</li>
<li>read 读取</li>
</ol>
</div>
<div id="outline-container-格式化输出-printf" class="outline-4">
<h4 id="格式化输出-printf"><a href="#格式化输出-printf">格式化输出 printf</a></h4>
<div class="outline-text-4" id="text-格式化输出-printf">
<p>
格式
</p>

<div class="org-src-container">
<pre class="src src-sh">printf <span class="org-string">"&#25351;&#23450;&#30340;&#26684;&#24335;"</span> <span class="org-string">"&#25991;&#26412;1"</span> &#8221;&#25991;&#26412;2&#8220;&#8230;&#8230;
</pre>
</div>


<figure id="org4539ff1">
<img src="././images/image-20210206104725123.png" alt="image-20210206104725123.png" width="50%">

<figcaption><span class="figure-number">Figure 3: </span>image-20210206104725123</figcaption>
</figure>

<p>
<b>常用格式替换符</b>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">替换符</th>
<th scope="col" class="org-left">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">%s</td>
<td class="org-left">字符串</td>
</tr>

<tr>
<td class="org-left">%f</td>
<td class="org-left">浮点格式</td>
</tr>

<tr>
<td class="org-left">%b</td>
<td class="org-left">相对应的参数中包含转义字符时，可以使用此替换符进行替换，对应的转义字符会被转义</td>
</tr>

<tr>
<td class="org-left">%c</td>
<td class="org-left">ASCII字符，即显示对应参数的第一个字符</td>
</tr>

<tr>
<td class="org-left">%d,%i</td>
<td class="org-left">十进制整数</td>
</tr>

<tr>
<td class="org-left">%o</td>
<td class="org-left">八进制值</td>
</tr>

<tr>
<td class="org-left">%u</td>
<td class="org-left">不带正负号的十进制值</td>
</tr>

<tr>
<td class="org-left">%x</td>
<td class="org-left">十六进制值（a-f）</td>
</tr>

<tr>
<td class="org-left">%X</td>
<td class="org-left">十六进制值（A-F）</td>
</tr>

<tr>
<td class="org-left">%%</td>
<td class="org-left">表示%本身</td>
</tr>

<tr>
<td class="org-left">说明：</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">%8s 中的数字代表此替换符中的输出字符宽度，不足补空格，默认是右对齐，</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">%-10s表示10个字符宽，- 表示左对齐</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
<b>常用转义字符</b>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">转义符</th>
<th scope="col" class="org-left">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">\a</td>
<td class="org-left">警告字符，通常为ASCII的BEL字符</td>
</tr>

<tr>
<td class="org-left">\b</td>
<td class="org-left">后退</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">\f</td>
<td class="org-left">换页</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">\n</td>
<td class="org-left">换行</td>
</tr>

<tr>
<td class="org-left">\r</td>
<td class="org-left">回车</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">\t</td>
<td class="org-left">水平制表符</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">\v</td>
<td class="org-left">垂直制表符</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">\</td>
<td class="org-left">表示\本身</td>
</tr>
</tbody>
</table>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#printf <span class="org-string">"%s\n"</span> 1 2 3 4
1
2
3
4
[root@centos8 ~]#printf <span class="org-string">"%f\n"</span> 1 2 3 4
1.000000
2.000000
3.000000
4.000000

<span class="org-comment-delimiter">#</span><span class="org-comment">.2f &#34920;&#31034;&#20445;&#30041;&#20004;&#20301;&#23567;&#25968;
</span>[root@centos8 ~]#printf <span class="org-string">"%.2f\n"</span> 1 2 3 4
1.00
2.00
3.00
4.00
[root@centos8 ~]#printf <span class="org-string">"(%s)"</span> 1 2 3 4;<span class="org-builtin">echo</span>
(1)(2)(3)(4)
[root@centos8 ~]#printf <span class="org-string">" (%s) "</span> 1 2 3 4;<span class="org-builtin">echo</span> <span class="org-string">""</span>
(1) (2) (3) (4)
[root@centos8 ~]#printf <span class="org-string">"(%s)\n"</span> 1 2 3 4
(1)
(2)
(3)
(4)
[root@centos8 ~]#printf <span class="org-string">"%s %s\n"</span> 1 2 3 4
1 2
3 4
[root@centos8 ~]#printf <span class="org-string">"%s %s %s\n"</span> 1 2 3 4
1 2 3
4 

<span class="org-comment-delimiter">#</span><span class="org-comment">%-10s &#34920;&#31034;&#23485;&#24230;10&#20010;&#23383;&#31526;&#65292;&#24038;&#23545;&#40784;
</span>[root@centos8 ~]#printf <span class="org-string">"%-10s %-10s %-4s %s \n"</span> &#22995;&#21517; &#24615;&#21035; &#24180;&#40836; &#20307;&#37325; &#23567;&#26126; &#30007; 20 70 &#23567;&#32418; &#22899; 18 50
&#22995;&#21517;   &#24615;&#21035;   &#24180;&#40836;  &#20307;&#37325;
&#23567;&#26126;   &#30007;     20  70
&#23567;&#32418;   &#22899;     18  50

<span class="org-comment-delimiter">#</span><span class="org-comment">&#23558;&#21313;&#36827;&#21046;&#30340;17&#36716;&#25442;&#25104;16&#36827;&#21046;&#25968;
</span>[root@centos8 ~]#printf <span class="org-string">"%X"</span> 17
11[root@centos8 ~]#

<span class="org-comment-delimiter">#</span><span class="org-comment">&#23558;&#21313;&#20845;&#36827;&#21046;C&#36716;&#25442;&#25104;&#21313;&#36827;&#21046;
</span><span class="org-comment-delimiter">#</span><span class="org-comment">printf "%d\n" 0xC # 12
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">16&#36827;&#21046;&#36716;8&#36827;&#21046;
</span>printf <span class="org-string">'%o\n'</span> 0xF <span class="org-comment-delimiter"># </span><span class="org-comment">17
</span>
[root@centos8 ~]#<span class="org-variable-name">VAR</span>=<span class="org-string">"welcome to M"</span>;printf <span class="org-string">"\033[31m%s\033[0m\n"</span> $<span class="org-variable-name">VAR</span>
welcome
to
M
[root@centos8 ~]#<span class="org-variable-name">VAR</span>=<span class="org-string">"welcome to M"</span>;printf <span class="org-string">"\033[31m%s\033[0m\n"</span> <span class="org-string">"$VAR"</span>
welcome to M
</pre>
</div>

<p>
在bash中使用ACSII颜色：
</p>

<pre class="example" id="orge211aaa">
\033[31m hello \033[0m
##m：
左侧#：
    3表示前景色
    4表示背景色
右侧#: 颜色种类
    0:黑
    1:红
    2:绿
    3:黄
    4:蓝
    5:紫
    6:深绿
    7:白色 

#m:
加粗、闪烁等功能；

多种控制符，可组合使用，彼此间用分号隔开；
</pre>

<p>
dialog命令可实现窗口化编程；
</p>

<p>
各窗体控件使用方式；
</p>

<p>
如何获取用户选择或键入的内容？ 默认，其输出信息被定向到了错误输出流；
</p>
</div>
</div>
<div id="outline-container-使用read命令来接受输入" class="outline-4">
<h4 id="使用read命令来接受输入"><a href="#使用read命令来接受输入">使用read命令来接受输入</a></h4>
<div class="outline-text-4" id="text-使用read命令来接受输入">
<p>
使用read来把输入值分配给一个或多个shell变量，read从标准输入中读取值，
给每个单词分配一个变量，所有剩余单词都被分配给最后一个变量，如果变量名
没有指定，默认标准输入的值赋值给系统内置变量REPLY
</p>

<p>
格式：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">read</span> [options] [name ...]
</pre>
</div>

<p>
常见选项：
</p>

<div class="org-src-container">
<pre class="src src-sh">-p  &#25351;&#23450;&#35201;&#26174;&#31034;&#30340;&#25552;&#31034;
-s  &#38745;&#40664;&#36755;&#20837;&#65292;&#19968;&#33324;&#29992;&#20110;&#23494;&#30721;
-n N &#25351;&#23450;&#36755;&#20837;&#30340;&#23383;&#31526;&#38271;&#24230;N
-d <span class="org-string">'&#23383;&#31526;'</span>  &#36755;&#20837;&#32467;&#26463;&#31526;
-t N TIMEOUT&#20026;N&#31186;
-e  &#22312;&#36755;&#20837;&#26469;&#33258;&#32456;&#31471;
-i str  &#40664;&#35748;&#36755;&#20837;&#30340;&#23383;&#31526;
-r &#21453;&#26012;&#26464;&#19981;&#20316;&#20026;&#36716;&#20041;&#23383;&#31526;&#12290;&#21453;&#26012;&#26464;&#34987;&#35748;&#20026;&#34892;&#30340;&#19968;&#37096;&#20998;
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#read
wun
[root@centos8 ~]#echo $<span class="org-variable-name">REPLY</span>
wun

[root@centos8 ~]#read NAME TITLE
wang cto
[root@centos8 ~]#echo $<span class="org-variable-name">NAME</span>
wang
[root@centos8 ~]#echo $<span class="org-variable-name">TITLE</span>
cto
[root@centos8 ~]#read -p <span class="org-string">"Please input your name: "</span> NAME
Please input your name: wang
[root@centos8 ~]#echo $<span class="org-variable-name">NAME</span>
wang

<span class="org-comment-delimiter"># </span><span class="org-comment">read -p "abc: " -e -i 1 abc
</span>abc: 1
</pre>
</div>

<p>
范例：利用输入重定向读
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#read x y z &lt;&lt;&lt; <span class="org-string">"I love you"</span>
[root@centos8 ~]#echo $<span class="org-variable-name">x</span>
I
[root@centos8 ~]#echo $<span class="org-variable-name">y</span>
love
[root@centos8 ~]#echo $<span class="org-variable-name">z</span>
you
[root@centos8 ~]#
</pre>
</div>

<p>
范例：利用管道读，注意变量获取方式。管理命令会运行在一个独立的子进程shell中，
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#echo mu | <span class="org-builtin">read</span> NAME
[root@centos8 ~]#echo $<span class="org-variable-name">NAME</span>

[root@centos8 ~]#echo mu | { <span class="org-builtin">read</span> NAME; <span class="org-builtin">echo</span> $<span class="org-variable-name">NAME</span>; }
mu
[root@cento
</pre>
</div>

<p>
范例：面试题 read和输入重定向进行赋值
</p>

<div class="org-src-container">
<pre class="src src-sh">s8 scripts]#cat test.txt
1 2
[root@centos8 scripts]#read i j &lt; test.txt ; <span class="org-builtin">echo</span> <span class="org-variable-name">i</span>=$<span class="org-variable-name">i</span> <span class="org-variable-name">j</span>=$<span class="org-variable-name">j</span>
<span class="org-variable-name">i</span>=1 <span class="org-variable-name">j</span>=2
[root@centos8 scripts]#echo 1 2 | <span class="org-builtin">read</span> x y ; <span class="org-builtin">echo</span> <span class="org-variable-name">x</span>=$<span class="org-variable-name">x</span> <span class="org-variable-name">y</span>=$<span class="org-variable-name">y</span>
<span class="org-variable-name">x</span>= <span class="org-variable-name">y</span>=
[root@centos8 ~]#echo 1 2 | ( <span class="org-builtin">read</span> x y ; <span class="org-builtin">echo</span> <span class="org-variable-name">x</span>=$<span class="org-variable-name">x</span> <span class="org-variable-name">y</span>=$<span class="org-variable-name">y</span> )
<span class="org-variable-name">x</span>=1 <span class="org-variable-name">y</span>=2
[root@centos8 ~]#echo 1 2 | { <span class="org-builtin">read</span> x y ; <span class="org-builtin">echo</span> <span class="org-variable-name">x</span>=$<span class="org-variable-name">x</span> <span class="org-variable-name">y</span>=$<span class="org-variable-name">y</span>; }
<span class="org-variable-name">x</span>=1 <span class="org-variable-name">y</span>=2
[root@centos8 ~]#man bash
</pre>
</div>

<p>
管理命令会运行在一个独立的子进程shell中，
</p>


<figure id="org49f7edd">
<img src="././images/image-20210206105129761.png" alt="image-20210206105129761.png" width="50%">

</figure>

<p>
范例： 匹配大小写yes
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 scripts]#cat read.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-builtin">read</span> -p <span class="org-string">"Are you rich?yes or no: "</span> ANSWER
[[ $<span class="org-variable-name">ANSWER</span> =~ ^[Yy]|[Yy][Ee][Ss]$ ]] &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"You are rich"</span> || <span class="org-builtin">echo</span> <span class="org-string">"Good Good
Study,Day Day Up!"</span>
</pre>
</div>

<p>
范例：添加提示
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">read</span> -p <span class="org-string">"Enter a filename: "</span> FILE
</pre>
</div>

<p>
范例：鸡兔同笼算法，今有雉兔同笼，上有三十五头，下有九十四足，问雉兔各几何？
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /data/script40/chook_rabbit.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-builtin">read</span> -p <span class="org-string">"&#35831;&#36755;&#20837;&#22836;&#30340;&#25968;&#37327;: "</span> HEAD
<span class="org-builtin">read</span> -p <span class="org-string">"&#35831;&#36755;&#20837;&#33050;&#30340;&#25968;&#37327;: "</span> FOOT
<span class="org-variable-name">RABBIT</span>=$[FOOT/2-HEAD]
<span class="org-variable-name">CHOOK</span>=$[HEAD-RABBIT]
<span class="org-builtin">echo</span> <span class="org-string">"&#20820;&#23376;: "</span> $<span class="org-variable-name">RABBIT</span>
<span class="org-builtin">echo</span> <span class="org-string">"&#40481;: "</span> $<span class="org-variable-name">CHOOK</span>
</pre>
</div>

<p>
范例：实现运维工作菜单
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 scripts]#cat work_menu.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-builtin">echo</span> -en <span class="org-string">"\E[$[RANDOM%7+31];1m"</span>
cat &lt;&lt;EOF<span class="org-sh-heredoc">
&#35831;&#36873;&#25321;&#65306;
1&#65289;&#22791;&#20221;&#25968;&#25454;&#24211;
2&#65289;&#28165;&#29702;&#26085;&#24535;
3&#65289;&#36719;&#20214;&#21319;&#32423;
4&#65289;&#36719;&#20214;&#22238;&#28378;
5&#65289;&#21024;&#24211;&#36305;&#36335;
EOF
</span><span class="org-builtin">echo</span> -en <span class="org-string">'\E[0m'</span>
<span class="org-builtin">read</span> -p  <span class="org-string">"&#35831;&#36755;&#20837;&#19978;&#38754;&#25968;&#23383;1-5: "</span> MENU
[ $<span class="org-variable-name">MENU</span> -eq 1 ] &amp;&amp; ./backup.sh
[ $<span class="org-variable-name">MENU</span> -eq 2 ] &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"&#28165;&#29702;&#26085;&#24535;"</span>
[ $<span class="org-variable-name">MENU</span> -eq 3 ] &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"&#36719;&#20214;&#21319;&#32423;"</span>
[ $<span class="org-variable-name">MENU</span> -eq 4 ] &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"&#36719;&#20214;&#22238;&#28378;"</span>
[ $<span class="org-variable-name">MENU</span> -eq 5 ] &amp;&amp; <span class="org-builtin">echo</span> <span class="org-string">"&#21024;&#24211;&#36305;&#36335;"</span>
</pre>
</div>


<p>
在 Bash 中，stty 命令用于改变和打印终端行设置。stty erase 用于设置当用户按下退格键（Backspace）时，终端应该删除的字符。
</p>
<div class="org-src-container">
<pre class="src src-sh">stty erase ^H
<span class="org-comment-delimiter">#</span><span class="org-comment">&#24403;&#21069;&#30340;&#36864;&#26684;&#38190;&#35774;&#32622;&#65292;&#21487;&#20197;&#20351;&#29992;&#20197;&#19979;&#21629;&#20196;
</span>stty -a | grep erase
</pre>
</div>
</div>
</div>
<div id="outline-container-小结-1" class="outline-4">
<h4 id="小结-1"><a href="#小结-1">小结</a></h4>
<div class="outline-text-4" id="text-小结-1">
<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span>
<span class="org-builtin">which</span> echo
<span class="org-builtin">which</span> printf
<span class="org-builtin">which</span> cat
<span class="org-builtin">which</span> bat
<span class="org-builtin">which</span> read
<span class="org-builtin">echo</span> <span class="org-string">"which clear -------------------------"</span>

<span class="org-builtin">echo</span> <span class="org-string">"'1\n'"</span>
<span class="org-builtin">echo</span> -e <span class="org-string">"'2\n'"</span>
<span class="org-builtin">echo</span> -n <span class="org-string">"'3\n'"</span>
<span class="org-builtin">echo</span> -en <span class="org-string">"'4\n'"</span>
<span class="org-builtin">echo</span> <span class="org-string">"echo clear ==========================="</span>

printf <span class="org-string">"[%8s] [%-8s] %08x\n"</span> <span class="org-string">"abc"</span> <span class="org-string">"123"</span> <span class="org-string">"333"</span>
<span class="org-builtin">echo</span> <span class="org-string">"printf clear ------------------------"</span>

cat /proc/uptime
cat &lt;&lt;&lt; <span class="org-string">"here string"</span>  <span class="org-comment-delimiter">#</span><span class="org-comment">Here Strings&#23383;&#31526;&#20018;&#24403;&#26631;&#20934;&#36755;&#20837;
</span>cat &lt;&lt;- EOF_key<span class="org-sh-heredoc">
    this is a
    here document.
EOF_key
</span><span class="org-builtin">echo</span> <span class="org-string">"cat clear ------------------------"</span>

<span class="org-comment-delimiter">#</span><span class="org-comment">https://github.com/sharkdp/bat
</span>wget -O bat.zip https://github.com/sharkdp/bat/releases/download/v0.7.1/bat-v0.7.1-x86_64-unknown-linux-musl.tar.gz
wget -O bat.zip https://github.com/sharkdp/bat/releases/download/v0.18.2/bat-v0.18.2-x86_64-unknown-linux-musl.tar.gz
tar -xvzf bat.zip -C /usr/local/bin  --strip-components=1  bat-v0.18.2-x86_64-unknown-linux-musl/bat
<span class="org-comment-delimiter">#</span><span class="org-comment">&#25110;
</span>wget -c http://repo.openfusion.net/centos7-x86_64/bat-0.7.0-1.of.el7.x86_64.rpm
yum install -y bat-0.7.0-1.of.el7.x86_64.rpm
<span class="org-builtin">echo</span> <span class="org-string">"alias cat='bat -n' "</span> &gt;&gt; ~/.bashrc

bat --pager=never $<span class="org-variable-name">0</span>  <span class="org-comment-delimiter">#</span><span class="org-comment">&#39640;&#20142;&#30340;&#36755;&#20986;
</span><span class="org-builtin">echo</span> <span class="org-string">"bat clear ------------------------"</span>


<span class="org-builtin">read</span> -p <span class="org-string">"input a string: "</span> str
<span class="org-builtin">echo</span> <span class="org-string">"read string: $str"</span>
<span class="org-builtin">echo</span> <span class="org-string">"read clear ------------------------"</span>
</pre>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-bash的配置文件" class="outline-2">
<h2 id="bash的配置文件"><a href="#bash的配置文件">bash的配置文件</a></h2>
<div class="outline-text-2" id="text-bash的配置文件">
<p>
bash shell的配置文件很多，可以分成下面类别
</p>
</div>
<div id="outline-container-按生效范围划分两类" class="outline-3">
<h3 id="按生效范围划分两类"><a href="#按生效范围划分两类">按生效范围划分两类</a></h3>
<div class="outline-text-3" id="text-按生效范围划分两类">
<p>
全局配置：
</p>

<div class="org-src-container">
<pre class="src src-sh">/etc/profile
/etc/profile.d/*.sh
/etc/bashrc
</pre>
</div>

<p>
个人配置：
</p>

<div class="org-src-container">
<pre class="src src-sh">~/.bash_profile
~/.bashrc
</pre>
</div>
</div>
</div>
<div id="outline-container-shell登录两种方式分类" class="outline-3">
<h3 id="shell登录两种方式分类"><a href="#shell登录两种方式分类">shell登录两种方式分类</a></h3>
<div class="outline-text-3" id="text-shell登录两种方式分类">
</div>
<div id="outline-container-交互式登录" class="outline-4">
<h4 id="交互式登录"><a href="#交互式登录">交互式登录</a></h4>
<div class="outline-text-4" id="text-交互式登录">
<ul class="org-ul">
<li>直接通过终端输入账号密码登录</li>
<li>使用 su - UserName 切换的用户</li>
</ul>

<p>
配置文件执行顺序：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">centos
</span>/etc/profile.d/*.sh
/etc/bashrc
/etc/profile
/etc/bashrc &#160;&#160;#&#27492;&#25991;&#20214;&#25191;&#34892;&#20004;&#27425;
.bashrc
.bash_profile

ceontos7 : /etc/profile --&gt; /etc/profile.d/* --&gt; ~/.bash_profile --&gt; ~/.bashrc --&gt; /etc/bashrc&#160;

<span class="org-comment-delimiter"># </span><span class="org-comment">ubuntu
</span><span class="org-comment-delimiter">#</span><span class="org-comment">&#37325;&#21551;&#30331;&#24405;
</span>/etc/profile
/etc/bash.bashrc
/etc/profile.d/<span class="org-string">\*</span>
~/.profile
~/.bashrc
<span class="org-comment-delimiter">#</span><span class="org-comment">sudo su -
</span>/etc/profile
/etc/bash.bashrc
/etc/profile.d/*
<span class="org-comment-delimiter">#</span><span class="org-comment">&#20999;&#26222;&#36890;&#29992;&#25143;
</span>/etc/profile
/etc/bash.bashrc
/etc/profile.d/<span class="org-string">\*</span>
~/.profile
~/.bashrc
</pre>
</div>

<p>
<b>注意：文件之间的调用关系，写在同一个文件的不同位置，将影响文件的执行顺序</b>
</p>
</div>
</div>
<div id="outline-container-非交互式登录" class="outline-4">
<h4 id="非交互式登录"><a href="#非交互式登录">非交互式登录</a></h4>
<div class="outline-text-4" id="text-非交互式登录">
<ul class="org-ul">
<li>su UserName</li>
<li>图形界面下打开的终端</li>
<li>执行脚本</li>
<li>任何其它的bash实例</li>
</ul>

<p>
执行顺序：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">centos
</span>/etc/profile.d/*.sh
/etc/bashrc
.bashrc

<span class="org-comment-delimiter"># </span><span class="org-comment">ubuntu
</span><span class="org-comment-delimiter"># </span><span class="org-comment">sudo su 
</span>/etc/bash.bashrc
<span class="org-comment-delimiter"># </span><span class="org-comment">su name
</span>/etc/bash.bashrc
~/.bashrc
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-按功能划分分类" class="outline-3">
<h3 id="按功能划分分类"><a href="#按功能划分分类">按功能划分分类</a></h3>
<div class="outline-text-3" id="text-按功能划分分类">
<p>
profile类和bashrc类
</p>
</div>
<div id="outline-container-profile类" class="outline-4">
<h4 id="profile类"><a href="#profile类">Profile类</a></h4>
<div class="outline-text-4" id="text-profile类">
<p>
profile类为交互式登录的shell提供配置
</p>

<pre class="example" id="org20e0351">
全局：/etc/profile, /etc/profile.d/*.sh
个人：~/.bash_profile
</pre>

<p>
功用：
</p>
<ol class="org-ol">
<li>用于定义环境变量</li>
<li>运行命令或脚本</li>
</ol>
</div>
</div>
<div id="outline-container-bashrc类" class="outline-4">
<h4 id="bashrc类"><a href="#bashrc类">Bashrc类</a></h4>
<div class="outline-text-4" id="text-bashrc类">
<p>
bashrc类：为非交互式和交互式登录的shell提供配置
</p>

<pre class="example" id="org29e0998">
全局：/etc/bashrc
个人：~/.bashrc
</pre>

<p>
功用：
</p>
<ol class="org-ol">
<li>定义命令别名和函数</li>
<li>定义本地变量</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-编辑配置文件生效" class="outline-3">
<h3 id="编辑配置文件生效"><a href="#编辑配置文件生效">编辑配置文件生效</a></h3>
<div class="outline-text-3" id="text-编辑配置文件生效">
<p>
修改profile和bashrc文件后需生效两种方法:
</p>

<ol class="org-ol">
<li>重新启动shell进程</li>
<li><code>source|. 配置文件</code></li>
</ol>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">.  ~/.bashrc
</pre>
</div>

<p>
在运行脚本一般用子进程运行，bash file.sh
</p>

<p>
<code>配置文件运行一般会用source命令，在当前shell中执行。</code>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#  </span><span class="org-comment">cat a.sh 
</span><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/env bash
</span><span class="org-builtin">echo</span> $<span class="org-variable-name">BASHPID</span>
<span class="org-builtin">echo</span> $<span class="org-variable-name">PPID</span>
[root@middle-ware ~/learn] <span class="org-variable-name">eth0</span> = 10.0.1.86
<span class="org-comment-delimiter"># </span><span class="org-comment">bash a.sh
</span>28455
15413
[root@middle-ware ~/learn] <span class="org-variable-name">eth0</span> = 10.0.1.86
<span class="org-comment-delimiter"># </span><span class="org-comment">source  a.sh
</span>15413
13851
[root@middle-ware ~/learn] <span class="org-variable-name">eth0</span> = 10.0.1.86
<span class="org-comment-delimiter"># </span><span class="org-comment">echo $BASHPID
</span>1541
</pre>
</div>
</div>
</div>
<div id="outline-container-bash-退出任务" class="outline-3">
<h3 id="bash-退出任务"><a href="#bash-退出任务">Bash 退出任务</a></h3>
<div class="outline-text-3" id="text-bash-退出任务">
<p>
保存在 ~/.bash_logout 文件中（用户），在退出登录shell时运行
</p>

<p>
功能：
</p>

<ul class="org-ul">
<li>创建自动备份</li>
<li>清除临时文件</li>
</ul>

<p>
动动手
</p>

<pre class="example" id="org2b90f35">
1、让所有用户的PATH环境变量的值多出一个路径，例如：/usr/local/apache/bin
2、用户 root 登录时，将命令指示符变成红色，并自动启用如下别名： rm='rm –i'
cdnet='cd /etc/sysconfig/network-scripts/'
editnet='vim /etc/sysconfig/network-scripts/ifcfg-eth0'
editnet='vim /etc/sysconfig/network-scripts/ifcfg-eno16777736 或 ifcfg-ens33 ' (如果系统是CentOS7)
3、任意用户登录系统时，显示红色字体的警示提醒信息"Hi,dangerous！"
4、编写生成脚本基本格式的脚本，包括作者，联系方式，版本，时间，描述等
</pre>
</div>
</div>
</section>
<section id="outline-container-流程控制" class="outline-2">
<h2 id="流程控制"><a href="#流程控制">流程控制</a></h2>
<div class="outline-text-2" id="text-流程控制">
</div>
<div id="outline-container-条件选择" class="outline-3">
<h3 id="条件选择"><a href="#条件选择">条件选择</a></h3>
<div class="outline-text-3" id="text-条件选择">
</div>
<div id="outline-container-条件判断分绍" class="outline-4">
<h4 id="条件判断分绍"><a href="#条件判断分绍">条件判断分绍</a></h4>
<div class="outline-text-4" id="text-条件判断分绍">
</div>
<div id="outline-container-单分支条件" class="outline-5">
<h5 id="单分支条件"><a href="#单分支条件">单分支条件</a></h5>
<div class="outline-text-5" id="text-单分支条件">

<figure id="org573714d">
<img src="././images/image-20210206110203117.png" alt="image-20210206110203117.png" width="50%">

<figcaption><span class="figure-number">Figure 4: </span>image-20210206110203117</figcaption>
</figure>
</div>
</div>
<div id="outline-container-多分支条件" class="outline-5">
<h5 id="多分支条件"><a href="#多分支条件">多分支条件</a></h5>
<div class="outline-text-5" id="text-多分支条件">

<figure id="orgee4398e">
<img src="././images/image-20210206110213699.png" alt="image-20210206110213699.png" width="50%">

<figcaption><span class="figure-number">Figure 5: </span>image-20210206110213699</figcaption>
</figure>
</div>
</div>
</div>
<div id="outline-container-选择执行-if-语句" class="outline-4">
<h4 id="选择执行-if-语句"><a href="#选择执行-if-语句">选择执行 if 语句</a></h4>
<div class="outline-text-4" id="text-选择执行-if-语句">
<p>
help if
</p>

<p>
格式：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">if</span> COMMANDS; <span class="org-keyword">then</span> COMMANDS; [ elif COMMANDS; <span class="org-keyword">then</span> COMMANDS; ]... [ else COMMANDS; ] fi
</pre>
</div>

<p>
单分支
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">if</span> &#21028;&#26029;&#26465;&#20214;;<span class="org-keyword">then</span>
    &#26465;&#20214;&#20026;&#30495;&#30340;&#20998;&#25903;&#20195;&#30721;
<span class="org-keyword">fi</span>
</pre>
</div>

<p>
双分支
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">if</span> &#21028;&#26029;&#26465;&#20214;; <span class="org-keyword">then</span>
    &#26465;&#20214;&#20026;&#30495;&#30340;&#20998;&#25903;&#20195;&#30721;
<span class="org-keyword">else</span>
    &#26465;&#20214;&#20026;&#20551;&#30340;&#20998;&#25903;&#20195;&#30721;
<span class="org-keyword">fi</span>
</pre>
</div>

<p>
多分支
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">if</span> &#21028;&#26029;&#26465;&#20214;1; <span class="org-keyword">then</span>
    &#26465;&#20214;1&#20026;&#30495;&#30340;&#20998;&#25903;&#20195;&#30721;
<span class="org-keyword">elif</span> &#21028;&#26029;&#26465;&#20214;2; <span class="org-keyword">then</span>
    &#26465;&#20214;2&#20026;&#30495;&#30340;&#20998;&#25903;&#20195;&#30721;
<span class="org-keyword">elif</span> &#21028;&#26029;&#26465;&#20214;3; <span class="org-keyword">then</span>
    &#26465;&#20214;3&#20026;&#30495;&#30340;&#20998;&#25903;&#20195;&#30721;
...
<span class="org-keyword">else</span>
    &#20197;&#19978;&#26465;&#20214;&#37117;&#20026;&#20551;&#30340;&#20998;&#25903;&#20195;&#30721;
<span class="org-keyword">fi</span>
</pre>
</div>

<p>
说明：
</p>

<ul class="org-ul">
<li>多个条件时，逐个条件进行判断，第一次遇为”真”条件时，执行其分支，而
后结束整个if语句</li>
<li>if 语句可嵌套</li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#declare -f
<span class="org-function-name">__udisks</span> ()
{
 <span class="org-builtin">local</span> <span class="org-variable-name">IFS</span>=<span class="org-string">'
'</span>;
 <span class="org-builtin">local</span> <span class="org-variable-name">cur</span>=<span class="org-string">"${COMP_WORDS[COMP_CWORD]}"</span>;
  <span class="org-keyword">if</span> [ <span class="org-string">"${COMP_WORDS[$(($COMP_CWORD - 1))]}"</span> = <span class="org-string">"--show-info"</span> ]; <span class="org-keyword">then</span>
    <span class="org-variable-name">COMPREPLY</span>=($(compgen -W <span class="org-string">"$(udisks --enumerate-device-files)"</span> -- $<span class="org-variable-name">cur</span>));
  <span class="org-keyword">else</span>
    <span class="org-keyword">if</span> [ <span class="org-string">"${COMP_WORDS[$(($COMP_CWORD - 1))]}"</span> = <span class="org-string">"--inhibit-polling"</span> ]; <span class="org-keyword">then</span>
      <span class="org-variable-name">COMPREPLY</span>=($(compgen -W <span class="org-string">"$(udisks --enumerate-device-files)"</span> --$<span class="org-variable-name">cur</span>));
    <span class="org-keyword">else</span>
      <span class="org-keyword">if</span> [ <span class="org-string">"${COMP_WORDS[$(($COMP_CWORD - 1))]}"</span> = <span class="org-string">"--mount"</span> ]; <span class="org-keyword">then</span>
        <span class="org-variable-name">COMPREPLY</span>=($(compgen -W <span class="org-string">"$(udisks --enumerate-device-files)"</span> --$<span class="org-variable-name">cur</span>));
      <span class="org-keyword">else</span>
        <span class="org-keyword">if</span> [ <span class="org-string">"${COMP_WORDS[$(($COMP_CWORD - 1))]}"</span> = <span class="org-string">"--unmount"</span> ]; <span class="org-keyword">then</span>
          <span class="org-variable-name">COMPREPLY</span>=($(compgen -W <span class="org-string">"$(udisks --enumerate-device-files)"</span>-- $<span class="org-variable-name">cur</span>));
        <span class="org-keyword">else</span>
          <span class="org-keyword">if</span> [ <span class="org-string">"${COMP_WORDS[$(($COMP_CWORD - 1))]}"</span> = <span class="org-string">"--detach"</span> ];<span class="org-keyword">then</span>
            <span class="org-variable-name">COMPREPLY</span>=($(compgen -W <span class="org-string">"$(udisks --enumerate-device-files)"</span> -- $<span class="org-variable-name">cur</span>));
          <span class="org-keyword">else</span>
            <span class="org-keyword">if</span> [ <span class="org-string">"${COMP_WORDS[$(($COMP_CWORD - 1))]}"</span> = <span class="org-string">"--ata-smart-refresh"</span> ]; <span class="org-keyword">then</span>
              <span class="org-variable-name">COMPREPLY</span>=($(compgen -W <span class="org-string">"$(udisks --enumerate-device-files)"</span> -- $<span class="org-variable-name">cur</span>));
            <span class="org-keyword">else</span>
              <span class="org-keyword">if</span> [ <span class="org-string">"${COMP_WORDS[$(($COMP_CWORD - 1))]}"</span> = <span class="org-string">"--ata-smart-simulate"</span> ]; <span class="org-keyword">then</span>
               _filedir || <span class="org-keyword">return</span> 0;
              <span class="org-keyword">else</span>
                <span class="org-keyword">if</span> [ <span class="org-string">"${COMP_WORDS[$(($COMP_CWORD - 1))]}"</span> = <span class="org-string">"--set-spindown"</span> ]; <span class="org-keyword">then</span>
                  <span class="org-variable-name">COMPREPLY</span>=($(compgen -W <span class="org-string">"$(udisks --enumerate-device-files)"</span> -- $<span class="org-variable-name">cur</span>));
                <span class="org-keyword">else</span>
                  <span class="org-keyword">if</span> [ <span class="org-string">"${COMP_WORDS[$(($COMP_CWORD - 1))]}"</span> =<span class="org-string">"--poll-for-media"</span> ]; <span class="org-keyword">then</span>
                    <span class="org-variable-name">COMPREPLY</span>=($(compgen -W <span class="org-string">"$(udisks --enumerate-device-files)"</span> -- $<span class="org-variable-name">cur</span>));
                  <span class="org-keyword">else</span>
                    <span class="org-variable-name">COMPREPLY</span>=($(<span class="org-variable-name">IFS</span>=: compgen -W <span class="org-string">"--dump:--inhibit-polling:--inhibit-all-polling:--enumerate:--enumerate-device-files:--monitor:--monitor-detail:--show-info:--help:--mount:--mount-fstype:--mount-options:--unmount:--unmount-options:--detach:--detach-options:--ata-smart-refresh:--ata-smart-wakeup:--ata-smart-simulate:--set-spindown:--set-spindown-all:--spindown-timeout:--poll-for-media"</span> -- $<span class="org-variable-name">cur</span>));
                  <span class="org-keyword">fi</span>;
                <span class="org-keyword">fi</span>;
              <span class="org-keyword">fi</span>;
            <span class="org-keyword">fi</span>;
          <span class="org-keyword">fi</span>;
        <span class="org-keyword">fi</span>;
      <span class="org-keyword">fi</span>;
    <span class="org-keyword">fi</span>;
  <span class="org-keyword">fi</span>
}
[root@centos6 ~]#
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#26681;&#25454;&#21629;&#20196;&#30340;&#36864;&#20986;&#29366;&#24577;&#26469;&#25191;&#34892;&#21629;&#20196;
</span><span class="org-keyword">if</span> ping -c1 -W2 station1 &amp;&gt; /dev/null; <span class="org-keyword">then</span>  
    <span class="org-builtin">echo</span> <span class="org-string">'station1 is UP'</span> 
<span class="org-keyword">elif</span>  grep -q <span class="org-string">'station1'</span> ~/maintenance.txt;  <span class="org-keyword">then</span>  
    <span class="org-builtin">echo</span> <span class="org-string">'station1 is undergoing maintenance'</span>
<span class="org-keyword">else</span> 
    <span class="org-builtin">echo</span> <span class="org-string">'station1 is unexpectedly DOWN!'</span>  
    <span class="org-keyword">exit</span> 1
<span class="org-keyword">fi</span>
</pre>
</div>

<p>
范例：身体质量指数 (BMI）
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat if_bmi.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span>
<span class="org-builtin">read</span> -p <span class="org-string">"&#35831;&#36755;&#20837;&#36523;&#39640;(m&#20026;&#21333;&#20301;): "</span> HIGH
<span class="org-keyword">if</span> [[ <span class="org-negation-char">!</span> <span class="org-string">"$HIGH"</span> =~ ^[0-2]<span class="org-string">\.</span>?[0-9]{,2}$ ]];<span class="org-keyword">then</span>
    <span class="org-builtin">echo</span> <span class="org-string">"&#36755;&#20837;&#38169;&#35823;&#30340;&#36523;&#39640;"</span>
    <span class="org-keyword">exit</span> 1
<span class="org-keyword">fi</span>

<span class="org-builtin">read</span> -p <span class="org-string">"&#35831;&#36755;&#20837;&#20307;&#37325;(kg&#20026;&#21333;&#20301;): "</span> WEIGHT

<span class="org-keyword">if</span> [[ <span class="org-negation-char">!</span> <span class="org-string">"$WEIGHT"</span> =~ ^[0-9]{1,3}$ ]];<span class="org-keyword">then </span><span class="org-builtin">echo</span> <span class="org-string">"&#36755;&#20837;&#38169;&#35823;&#30340;&#20307;&#37325;"</span>; <span class="org-keyword">exit</span> 1; <span class="org-keyword">fi</span>

<span class="org-variable-name">BMI</span>=<span class="org-sh-quoted-exec">`echo $WEIGHT/$HIGH^2|bc`</span>

<span class="org-keyword">if</span> [ $<span class="org-variable-name">BMI</span>  -le 18 ] ;<span class="org-keyword">then</span>
    <span class="org-builtin">echo</span> <span class="org-string">"&#22826;&#30246;&#20102;,&#22810;&#21507;&#28857;"</span>
<span class="org-keyword">elif</span> [ $<span class="org-variable-name">BMI</span>  -lt 24 ] ;<span class="org-keyword">then</span>
    <span class="org-builtin">echo</span> <span class="org-string">"&#36523;&#26448;&#24456;&#26834;!"</span>
<span class="org-keyword">else</span>
    <span class="org-builtin">echo</span> <span class="org-string">"&#22826;&#32982;&#20102;,&#27880;&#24847;&#33410;&#39135;,&#21152;&#24378;&#36816;&#21160;"</span>
<span class="org-keyword">fi</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-条件判断-case-语句" class="outline-4">
<h4 id="条件判断-case-语句"><a href="#条件判断-case-语句">条件判断 case 语句</a></h4>
<div class="outline-text-4" id="text-条件判断-case-语句">
<p>
格式：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">case</span> WORD<span class="org-keyword"> in</span> [PATTERN [| PATTERN]...) COMMANDS ;;]... esac
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">case</span> &#21464;&#37327;&#24341;&#29992;<span class="org-keyword"> in</span>
PAT1)
    &#20998;&#25903;1
    ;;
PAT2)
    &#20998;&#25903;2
    ;;
...
*)
    &#40664;&#35748;&#20998;&#25903;
    ;;
<span class="org-keyword">esac</span>
</pre>
</div>

<p>
case支持glob风格的通配符：
</p>

<div class="org-src-container">
<pre class="src src-sh">*: &#20219;&#24847;&#38271;&#24230;&#20219;&#24847;&#23383;&#31526;
?: &#20219;&#24847;&#21333;&#20010;&#23383;&#31526;
[]&#65306;&#25351;&#23450;&#33539;&#22260;&#20869;&#30340;&#20219;&#24847;&#21333;&#20010;&#23383;&#31526;
|:  &#25110;&#65292;&#22914; a&#25110;b
</pre>
</div>

<p>
范例: case中 yes no的判断
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 scripts]#cat case_yesorno.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-builtin">read</span> -p <span class="org-string">"Do you agree(yes/no)? "</span> INPUT

<span class="org-variable-name">INPUT</span>=<span class="org-sh-quoted-exec">`echo $INPUT | tr 'A-Z' 'a-z'`</span>

<span class="org-keyword">case</span> $<span class="org-variable-name">INPUT</span><span class="org-keyword"> in</span>
y|yes)
   <span class="org-builtin">echo</span> <span class="org-string">"You input is YES"</span>
  ;;
n|no)
   <span class="org-builtin">echo</span> <span class="org-string">"You input is NO"</span>
  ;;
*)
   <span class="org-builtin">echo</span> <span class="org-string">"Input fales,please input yes or no!"</span>
<span class="org-keyword">esac</span>

[root@centos8 scripts]#cat case_yesorno2.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-builtin">read</span> -p <span class="org-string">"Do you agree(yes/no)? "</span> INPUT
<span class="org-keyword">case</span> $<span class="org-variable-name">INPUT</span><span class="org-keyword"> in</span>
[yY]|[Yy][Ee][Ss])
  <span class="org-builtin">echo</span> <span class="org-string">"You input is YES"</span>
 ;;
[Nn]|[Nn][Oo])
  <span class="org-builtin">echo</span> <span class="org-string">"You input is NO"</span>
 ;;
*)
  <span class="org-builtin">echo</span> <span class="org-string">"Input fales,please input yes or no!"</span>
<span class="org-keyword">esac</span>
</pre>
</div>

<p>
范例：运维菜单实现版本2
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 scripts]#cat work_menu.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-builtin">echo</span> -en <span class="org-string">"\E[$[RANDOM%7+31];1m"</span>
cat &lt;&lt;EOF<span class="org-sh-heredoc">
&#35831;&#36873;&#25321;&#65306;
1&#65289;&#22791;&#20221;&#25968;&#25454;&#24211;
2&#65289;&#28165;&#29702;&#26085;&#24535;
3&#65289;&#36719;&#20214;&#21319;&#32423;
4&#65289;&#36719;&#20214;&#22238;&#28378;
5&#65289;&#21024;&#24211;&#36305;&#36335;
EOF
</span><span class="org-builtin">echo</span> -en <span class="org-string">'\E[0m'</span>

<span class="org-builtin">read</span> -p  <span class="org-string">"&#35831;&#36755;&#20837;&#19978;&#38754;&#25968;&#23383;1-5: "</span> MENU

<span class="org-keyword">case</span> $<span class="org-variable-name">MENU</span><span class="org-keyword"> in</span>
1)
 ./backup.sh
 ;;
2)
  <span class="org-builtin">echo</span> <span class="org-string">"&#28165;&#29702;&#26085;&#24535;"</span>
 ;;
3)
  <span class="org-builtin">echo</span> <span class="org-string">"&#36719;&#20214;&#21319;&#32423;"</span>
 ;;
4)
  <span class="org-builtin">echo</span> <span class="org-string">"&#36719;&#20214;&#22238;&#28378;"</span>
 ;;
5)
  <span class="org-builtin">echo</span> <span class="org-string">"&#21024;&#24211;&#36305;&#36335;"</span>
 ;;
*)
  <span class="org-builtin">echo</span> <span class="org-string">"INPUT FALSE!"</span>
<span class="org-keyword">esac</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-循环" class="outline-3">
<h3 id="循环"><a href="#循环">循环</a></h3>
<div class="outline-text-3" id="text-循环">
</div>
<div id="outline-container-循环执行介绍" class="outline-4">
<h4 id="循环执行介绍"><a href="#循环执行介绍">循环执行介绍</a></h4>
<div class="outline-text-4" id="text-循环执行介绍">

<figure id="org82d9c81">
<img src="././images/image-20210206110241476.png" alt="image-20210206110241476.png" width="50%">

<figcaption><span class="figure-number">Figure 6: </span>image-20210206110241476</figcaption>
</figure>

<p>
将某代码段重复运行多次，通常有进入循环的条件和退出循环的条件
</p>

<p>
重复运行次数
</p>

<ul class="org-ul">
<li>循环次数事先已知</li>
<li>循环次数事先未知</li>
</ul>

<p>
常见的循环的命令：for, while, until
</p>


<figure id="orgcd6a60d">
<img src="././images/image-20210206110311451.png" alt="image-20210206110311451.png" width="50%">

</figure>
</div>
</div>
<div id="outline-container-for循环" class="outline-4">
<h4 id="for循环"><a href="#for循环">for循环</a></h4>
<div class="outline-text-4" id="text-for循环">
<div class="org-src-container">
<pre class="src src-sh">[root@middle-ware ~]# help for
<span class="org-keyword">for</span>: for NAME [in WORDS ... ] ; <span class="org-keyword">do</span> COMMANDS; <span class="org-keyword">done</span>
    Execute commands for each member<span class="org-keyword"> in</span> a list.

    The <span class="org-sh-quoted-exec">`for' loop executes a sequence of commands for each member in a
    list of items.  If `</span><span class="org-keyword">in</span> WORDS ...;<span class="org-string">' is not present, then `in "$@"'</span> is
    assumed.  For each element<span class="org-keyword"> in</span> WORDS, NAME is set to that element, and
    the COMMANDS are executed.

    Exit Status:
    Returns the status of the last command executed.
<span class="org-keyword">for</span> ((: for (( exp1; exp2; exp3 )); <span class="org-keyword">do</span> COMMANDS; <span class="org-keyword">done</span>
    Arithmetic for loop.

    Equivalent to
        (( EXP1 ))
        <span class="org-keyword">while</span> (( EXP2 )); <span class="org-keyword">do</span>
            COMMANDS
            (( EXP3 ))
        <span class="org-keyword">done</span>
    EXP1, EXP2, and EXP3 are arithmetic expressions.  If any expression is
    omitted, it behaves as if it evaluates to 1.

    Exit Status:
    Returns the status of the last command executed.
[root@middle-ware ~]# 
</pre>
</div>

<p>
<b>格式1：</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">for</span> NAME [in WORDS ... ] ; <span class="org-keyword">do</span> COMMANDS; <span class="org-keyword">done</span>

<span class="org-keyword">for</span> &#21464;&#37327;&#21517;<span class="org-keyword"> in</span> &#21015;&#34920;;<span class="org-keyword">do</span>
    &#24490;&#29615;&#20307;
<span class="org-keyword">done</span>

<span class="org-keyword">for</span> &#21464;&#37327;&#21517;<span class="org-keyword"> in</span> &#21015;&#34920;
<span class="org-keyword">do</span>
    &#24490;&#29615;&#20307;
<span class="org-keyword">done</span>
</pre>
</div>

<p>
执行机制： 依次将列表中的元素赋值给”变量名”; 每次赋值后即执行一次循环体;
直到列表中的元素耗尽，循环结束
</p>

<p>
<b>for循环列表生成方式：</b>
</p>

<ul class="org-ul">
<li>直接给出列表</li>

<li><p>
整数列表：
</p>

<div class="org-src-container">
<pre class="src src-sh">{start..end}
$(seq [start [step]] end)
</pre>
</div></li>

<li><p>
返回列表的命令:
</p>

<div class="org-src-container">
<pre class="src src-sh">$(COMMAND)
</pre>
</div></li>

<li>使用glob，如： <code>*.sh</code></li>

<li>变量引用，如： <code>@*</code> ， <code>$#</code></li>
</ul>

<p>
范例：面试题，计算1+2+3+&#x2026;+100的结果
</p>

<div class="org-src-container">
<pre class="src src-sh">seq -s+ 1 100 |bc
<span class="org-builtin">echo</span> {1..100} | tr  <span class="org-string">' '</span> <span class="org-string">'+'</span> | bc
<span class="org-variable-name">sum</span>=0;<span class="org-keyword">for</span> i<span class="org-keyword"> in</span> {1..100};<span class="org-keyword">do </span><span class="org-builtin">let</span> <span class="org-variable-name">sum</span>+=i;<span class="org-keyword">done</span> ;<span class="org-builtin">echo</span> <span class="org-variable-name">sum</span>=$<span class="org-variable-name">sum</span>
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /data/scripts/for_sum.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span>
<span class="org-variable-name">sum</span>=0
<span class="org-keyword">for</span> i<span class="org-keyword"> in</span> $<span class="org-variable-name">*</span> ; <span class="org-keyword">do</span>
 <span class="org-builtin">let</span> <span class="org-variable-name">sum</span>+=i
<span class="org-keyword">done</span>
<span class="org-builtin">echo</span> <span class="org-variable-name">sum</span>=$<span class="org-variable-name">sum</span>

[root@centos8 ~]#bash /data/scripts/for_sum.sh 1 2 3 4 5 6
<span class="org-variable-name">sum</span>=21
</pre>
</div>

<p>
范例: 九九乘法表
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span><span class="org-keyword">for</span> i<span class="org-keyword"> in</span> {1..9};<span class="org-keyword">do</span>
    <span class="org-keyword">for</span> j<span class="org-keyword"> in</span> <span class="org-sh-quoted-exec">`seq $i`</span>;<span class="org-keyword">do</span>
        <span class="org-builtin">echo</span> -e <span class="org-string">"${j}x${i}=$[i*j]\t\c"</span>
    <span class="org-keyword">done</span>
    <span class="org-builtin">echo</span>
<span class="org-keyword">done</span>
</pre>
</div>

<p>
生产案例：将指定目录下的文件所有文件的后缀改名为 bak 后缀
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /data/scripts/for_rename.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-variable-name">DIR</span>=/data/test
<span class="org-builtin">cd</span> $<span class="org-variable-name">DIR</span>
<span class="org-keyword">for</span> FILE<span class="org-keyword"> in</span> * ;<span class="org-keyword">do</span>
  <span class="org-variable-name">PRE</span>=<span class="org-sh-quoted-exec">`echo $FILE | sed -nr 's/(.*)\.([^.]+)$/\1/p'`</span>
<span class="org-comment-delimiter">#  </span><span class="org-comment">SUFFIX=`echo $FILE | sed -nr 's/(.*)\.([^.]+)$/\2/p'`
</span>  mv $<span class="org-variable-name">FILE</span> $<span class="org-variable-name">PRE</span>.bak
<span class="org-keyword">done</span>
</pre>
</div>

<p>
范例：面试题，要求将目录YYYY-MM-DD/中所有文件，移动到YYYY-MM/DD/下
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">1 yyyy-mm-dd10.sh &#21019;&#24314;YYYY-MM-DD&#65292;&#24403;&#21069;&#26085;&#26399;&#19968;&#24180;&#21069;365&#22825;&#21040;&#30446;&#21069;&#20849;365&#20010;&#30446;&#24405;&#65292;&#37324;&#38754;&#26377;10&#20010;&#25991;&#20214;&#65292;
</span>$<span class="org-variable-name">RANDOM</span>.log

[root@centos8 ~]#cat for_dir.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-keyword">for</span> i<span class="org-keyword"> in</span> {1..365};<span class="org-keyword">do</span>
    <span class="org-variable-name">DIR</span>=<span class="org-sh-quoted-exec">`date -d "-$i day" +%F`</span>
    mkdir /data/test/$<span class="org-variable-name">DIR</span>
    <span class="org-builtin">cd</span> /data/test/$<span class="org-variable-name">DIR</span>
    <span class="org-keyword">for</span> n<span class="org-keyword"> in</span> {1..10};<span class="org-keyword">do</span>
        touch $<span class="org-variable-name">RANDOM</span>.log
    <span class="org-keyword">done</span>
<span class="org-keyword">done</span>

<span class="org-comment-delimiter">#</span><span class="org-comment">2 &#31227;&#21160;&#21040;YYYY-MM/DD/&#19979; 
</span><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-variable-name">DIR</span>=/data/test
<span class="org-builtin">cd</span> $<span class="org-variable-name">DIR</span>
<span class="org-keyword">for</span> DIR<span class="org-keyword"> in</span> * ;<span class="org-keyword">do</span>
    <span class="org-variable-name">YYYY_MM</span>=<span class="org-sh-quoted-exec">`echo $DIR |cut -d"-" -f1,2`</span>
    <span class="org-variable-name">DD</span>=<span class="org-sh-quoted-exec">`echo $DIR |cut -d"-" -f3`</span>
    [ -d $<span class="org-variable-name">YYYY_MM</span>/$<span class="org-variable-name">DD</span> ] || mkdir -p $<span class="org-variable-name">YYYY_MM</span>/$<span class="org-variable-name">DD</span> &amp;&gt; /dev/null
    mv $<span class="org-variable-name">DIR</span>/*  $<span class="org-variable-name">YYYY_MM</span>/$<span class="org-variable-name">DD</span>
<span class="org-keyword">done</span>
</pre>
</div>

<p>
面试题：扫描一个网段：10.0.0.0/24，判断此网段中主机在线状态，将在线的
主机的IP打印出来
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /data/scripts/for_scan_host.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span>
<span class="org-variable-name">NET</span>=10.0.0
<span class="org-keyword">for</span> ID<span class="org-keyword"> in</span> {1..254};<span class="org-keyword">do</span>
 {
  ping -c1 -W1 $<span class="org-variable-name">NET</span>.$<span class="org-variable-name">ID</span> &amp;&gt; /dev/null &amp;&amp; <span class="org-builtin">echo</span> $<span class="org-variable-name">NET</span>.$<span class="org-variable-name">ID</span> is up || <span class="org-builtin">echo</span> $<span class="org-variable-name">NET</span>.$<span class="org-variable-name">ID</span> is down
 }&amp;
<span class="org-keyword">done</span>
<span class="org-builtin">wait</span>
</pre>
</div>

<p>
<b>格式2</b>
</p>

<p>
双小括号方法，即 <code>((...))</code> 格式，也可以用于算术运算，双小括号方法也
可以使bash Shell实现C语言风格的变量操作
</p>

<p>
<code>I=10;((I++))</code>
</p>


<figure id="orga7f2316">
<img src="././images/image-20210206110509138.png" alt="image-20210206110509138.png" width="50%">

</figure>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">for</span> ((: for (( exp1; exp2; exp3 )); <span class="org-keyword">do</span> COMMANDS; <span class="org-keyword">done</span>

<span class="org-keyword">for</span> ((&#25511;&#21046;&#21464;&#37327;&#21021;&#22987;&#21270;;&#26465;&#20214;&#21028;&#26029;&#34920;&#36798;&#24335;;&#25511;&#21046;&#21464;&#37327;&#30340;&#20462;&#27491;&#34920;&#36798;&#24335;))
<span class="org-keyword">do</span>
    &#24490;&#29615;&#20307;
<span class="org-keyword">done</span>
</pre>
</div>

<p>
说明：
</p>

<ul class="org-ul">
<li>控制变量初始化：仅在运行到循环代码段时执行一次</li>
<li>控制变量的修正表达式：每轮循环结束会先进行控制变量修正运算，而后再做
条件判断</li>
</ul>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span><span class="org-keyword">for</span>((<span class="org-variable-name">sum</span>=0,<span class="org-variable-name">i</span>=1;i&lt;=100;<span class="org-variable-name">sum</span>+=i,i++));<span class="org-keyword">do</span>           
    <span class="org-builtin">true</span>
<span class="org-keyword">done</span>
<span class="org-builtin">echo</span> $<span class="org-variable-name">sum</span>
</pre>
</div>

<p>
范例:九九乘法表
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">&#35821;&#27861;1&#23454;&#29616;
</span><span class="org-keyword">for</span> i<span class="org-keyword"> in</span> {1..9};<span class="org-keyword">do</span>
 <span class="org-keyword">for</span> j<span class="org-keyword"> in</span> <span class="org-sh-quoted-exec">`seq $i`</span>;<span class="org-keyword">do</span>
   <span class="org-builtin">echo</span> -e <span class="org-string">"${j}x$i=$((j*i))\t\c"</span>
 <span class="org-keyword">done</span>
 <span class="org-builtin">echo</span>
<span class="org-keyword">done</span>

<span class="org-comment-delimiter">#</span><span class="org-comment">&#35821;&#27861;2&#23454;&#29616;
</span><span class="org-keyword">for</span>((<span class="org-variable-name">i</span>=1;i&lt;10;i++));<span class="org-keyword">do</span>
 <span class="org-keyword">for</span>((<span class="org-variable-name">j</span>=1;j&lt;=i;j++));<span class="org-keyword">do</span>
   <span class="org-builtin">echo</span> -e <span class="org-string">"${j}x$i=$((j*i))\t\c"</span>
 <span class="org-keyword">done</span>
 <span class="org-builtin">echo</span>
<span class="org-keyword">done</span>
</pre>
</div>

<p>
范例：等腰三角形
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 scripts]#cat for_triangle.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-builtin">read</span> -p <span class="org-string">"&#35831;&#36755;&#20837;&#19977;&#35282;&#24418;&#30340;&#34892;&#25968;: "</span> line
<span class="org-keyword">for</span>((<span class="org-variable-name">i</span>=1;i&lt;=line;i++));<span class="org-keyword">do</span>
  <span class="org-keyword">for</span>((<span class="org-variable-name">k</span>=0;k&lt;=line-i;k++));<span class="org-keyword">do</span>
    <span class="org-builtin">echo</span> -e <span class="org-string">' \c'</span>
  <span class="org-keyword">done</span>
  <span class="org-keyword">for</span>((<span class="org-variable-name">j</span>=1;j&lt;=2*i-1;j++));<span class="org-keyword">do</span>
    <span class="org-builtin">echo</span> -e <span class="org-string">'*\c'</span>
  <span class="org-keyword">done</span>
  <span class="org-builtin">echo</span>
<span class="org-keyword">done</span>

[root@middle-ware learn]# bash for_triangle.sh 
&#35831;&#36755;&#20837;&#19977;&#35282;&#24418;&#30340;&#34892;&#25968;: 10
          *
         ***
        *****
       *******
      *********
     ***********
    *************
   ***************
  *****************
 *******************
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#for((;;));<span class="org-keyword">do </span><span class="org-builtin">echo</span> for;sleep 1;<span class="org-keyword">done</span>
<span class="org-keyword">for</span>
<span class="org-keyword">for</span>
<span class="org-keyword">for</span>
<span class="org-keyword">for</span>
<span class="org-keyword">for</span>
<span class="org-keyword">for</span>
<span class="org-keyword">for</span>
</pre>
</div>

<p>
动动手：用 for 实现
</p>
<ul class="org-ul">
<li>判断/var/目录下所有文件的类型</li>
<li>添加10个用户user1-user10，密码为8位随机字符</li>
<li>/etc/rc.d/rc3.d目录下分别有多个以K开头和以S开头的文件；分别读取每个
文件，以K开头的输出为文件加stop，以S开头的输出为文件名加start，如
K34filename stop S66filename start</li>
<li>编写脚本，提示输入正整数n的值，计算1+2+…+n的总和</li>
<li>计算100以内所有能被3整除的整数之和</li>
<li>编写脚本，提示请输入网络地址，如192.168.0.0，判断输入的网段中主机在
线状态</li>
<li>打印九九乘法表</li>
<li>在/testdir目录下创建10个html文件,文件名格式为数字N（从1到10）加随机8
个字母，如：1AbCdeFgH.html</li>
<li>打印等腰三角形</li>
<li>猴子第一天摘下若干个桃子，当即吃了一半，还不瘾，又多吃了一个。第二天
早上又将剩下的桃子吃掉一半，又多吃了一个。以后每天早上都吃了前一天剩
下的一半零一个。到第10天早上想再吃时，只剩下一个桃子了。求第一天共摘
了多少？</li>
</ul>
</div>
</div>
<div id="outline-container-while循环" class="outline-4">
<h4 id="while循环"><a href="#while循环">while循环</a></h4>
<div class="outline-text-4" id="text-while循环">
<p>
格式：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">while</span> COMMANDS; <span class="org-keyword">do</span> COMMANDS; <span class="org-keyword">done</span>

<span class="org-keyword">while</span> CONDITION; <span class="org-keyword">do</span>
    &#24490;&#29615;&#20307;
<span class="org-keyword">done</span>
</pre>
</div>

<p>
说明：
</p>

<pre class="example" id="orgaa0e8c8">
CONDITION：循环控制条件；进入循环之前，先做一次判断；每一次循环之后会再次做判断；条件为
"true"，则执行一次循环；直到条件测试状态为"false"终止循环，因此：CONDTION一般应该有循环控
制变量；而此变量的值会在循环体不断地被修正
进入条件：CONDITION为true
退出条件：CONDITION为false
</pre>

<p>
<b>无限循环</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">while </span><span class="org-builtin">true</span>; <span class="org-keyword">do</span>
    &#24490;&#29615;&#20307;
<span class="org-keyword">done</span>
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#37197;&#32622;&#21457;&#37038;&#20214;&#30340;&#37038;&#31665;
</span>[root@centos8 ~]#cat .mailrc
<span class="org-builtin">set</span> <span class="org-variable-name">from</span>=29308620@qq.com
<span class="org-builtin">set</span> <span class="org-variable-name">smtp</span>=smtp.qq.com
<span class="org-builtin">set</span> smtp-auth-user=29308620@qq.com
<span class="org-builtin">set</span> smtp-auth-password=esvnhbnqocirbicf
<span class="org-builtin">set</span> smtp-auth=login
<span class="org-builtin">set</span> ssl-verify=ignore

[root@centos8 ~]#cat while_diskcheck.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-variable-name">WARNING</span>=80
<span class="org-keyword">while</span> :;<span class="org-keyword">do</span>
 <span class="org-variable-name">USE</span>=<span class="org-sh-quoted-exec">`df | sed -rn '/^\/dev\/sd/s#.* ([0-9]+)%.*#\1#p' |sort -nr|head -n1`</span>
 <span class="org-keyword">if</span> [ $<span class="org-variable-name">USE</span> -gt $<span class="org-variable-name">WARNING</span> ];<span class="org-keyword">then</span>
   <span class="org-builtin">echo</span> Disk will be full from <span class="org-sh-quoted-exec">`hostname -I`</span> | mail  -s <span class="org-string">"disk warning"</span>
29308620@qq.com
 <span class="org-keyword">fi</span>
 sleep 10
<span class="org-keyword">done</span>
</pre>
</div>

<p>
范例：判断循环访问判断是否服务是否可用
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-function-name">multi_check</span>() {
    <span class="org-variable-name">UP</span>=0
    <span class="org-variable-name">DOWN</span>=0
    <span class="org-keyword">while</span> [ $<span class="org-variable-name">UP</span> -lt 5 -a $<span class="org-variable-name">DOWN</span> -lt 5 ];<span class="org-keyword">do</span>
        <span class="org-builtin">local</span> <span class="org-variable-name">num</span>=$(curl -I -m 5 -s -w <span class="org-string">"%{http_code}\n"</span> -o /dev/null $<span class="org-variable-name">URL</span> | grep -E  <span class="org-string">"200|301|302"</span> |wc -l)
        <span class="org-keyword">if</span> [ $<span class="org-variable-name">num</span> -eq 1 ];<span class="org-keyword">then</span>
            <span class="org-builtin">let</span> <span class="org-variable-name">UP</span>+=1
            <span class="org-builtin">echo</span> <span class="org-string">"$1: $URL &#36830;&#25509;&#25104;&#21151; ${UP}"</span>
        <span class="org-keyword">else</span>
            <span class="org-builtin">let</span> <span class="org-variable-name">DOWN</span>+=1
            <span class="org-builtin">echo</span> <span class="org-string">"$1: $URL &#36830;&#25509;&#22833;&#36133; ${DOWN}"</span>
        <span class="org-keyword">fi</span>
        /bin/sleep 1
    <span class="org-keyword">done</span>
    <span class="org-keyword">if</span> [ $<span class="org-variable-name">UP</span> -eq 5 ];<span class="org-keyword">then</span>
        <span class="org-keyword">exit</span> 0
    <span class="org-keyword">fi</span>
    <span class="org-keyword">if</span> [ $<span class="org-variable-name">DOWN</span> -eq 5 ];<span class="org-keyword">then</span>
        <span class="org-builtin">echo</span> <span class="org-string">"$1: tomcat&#37325;&#21551;..."</span>
    <span class="org-keyword">fi</span>
}
</pre>
</div>

<p>
动动手：用while实现
</p>
<ul class="org-ul">
<li>编写脚本，求100以内所有正奇数之和</li>
<li>编写脚本，提示请输入网络地址，如192.168.0.0，判断输入的网段中主机在
线状态，并统计在线和离线主机各多少</li>
<li>编写脚本，打印九九乘法表</li>
<li>编写脚本，利用变量RANDOM生成10个随机数字，输出这个10数字，并显示其中
的最大值和最小值</li>
<li>编写脚本，实现打印国际象棋棋盘</li>
<li>后续六个字符串：efbaf275cd、4be9c40b8b、44b2395c46、f8c8873ce0、
b902c16c8b、ad865d2f63是通过对随机数变量RANDOM随机执行命令： echo
$RANDOM|md5sum|cut –c1-10后的结果，请破解这些字符串对应的RANDOM值</li>
</ul>
</div>
</div>
<div id="outline-container-until-循环" class="outline-4">
<h4 id="until-循环"><a href="#until-循环">until 循环</a></h4>
<div class="outline-text-4" id="text-until-循环">
<p>
格式：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">until</span> COMMANDS; <span class="org-keyword">do</span> COMMANDS; <span class="org-keyword">done</span>

<span class="org-keyword">until</span> CONDITION; <span class="org-keyword">do</span>
    &#24490;&#29615;&#20307;
<span class="org-keyword">done</span>
</pre>
</div>

<p>
说明： 进入条件： CONDITION 为false 退出条件： CONDITION 为true
</p>

<p>
<b>无限循环</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">until </span><span class="org-builtin">false</span>; <span class="org-keyword">do</span>
    &#24490;&#29615;&#20307;
Done
</pre>
</div>
</div>
</div>
<div id="outline-container-循环控制语句-continue" class="outline-4">
<h4 id="循环控制语句-continue"><a href="#循环控制语句-continue">循环控制语句 continue</a></h4>
<div class="outline-text-4" id="text-循环控制语句-continue">
<p>
<code>continue [N]</code> ： 提前结束第N层的本轮循环，而直接进入下一轮判断；最内
层为第1层
</p>

<p>
格式：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">while</span> CONDITION1; <span class="org-keyword">do</span>
    CMD1
    ...
    <span class="org-keyword">if</span> CONDITION2; <span class="org-keyword">then</span>
        <span class="org-keyword">continue</span>
    <span class="org-keyword">fi</span>
    CMDn
    ...
<span class="org-keyword">done</span>
</pre>
</div>

<p>
范例: j等于5时，跳到第二层循环。
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 script40]#cat continue_for.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-keyword">for</span> ((<span class="org-variable-name">i</span>=0;i&lt;10;i++));<span class="org-keyword">do</span>
<span class="org-keyword">for</span>((<span class="org-variable-name">j</span>=0;j&lt;10;j++));<span class="org-keyword">do</span>
 [ $<span class="org-variable-name">j</span> -eq 5 ] &amp;&amp; <span class="org-keyword">continue</span> 2
 <span class="org-builtin">echo</span> $<span class="org-variable-name">j</span>
<span class="org-keyword">done</span>
<span class="org-builtin">echo</span> ---------------------------
<span class="org-keyword">done</span>
[root@centos8 script40]#bash continue_for.sh
0
1
2
3
4
0
1
2
3
4
0
1
2
3
4
0
1
2
3
4
0
1
2
3
4
0
1
2
3
4
0
1
2
3
4
0
1
2
3
4
0
1
2
3
4
0
1
2
3
4
</pre>
</div>
</div>
</div>
<div id="outline-container-循环控制语句-break" class="outline-4">
<h4 id="循环控制语句-break"><a href="#循环控制语句-break">循环控制语句 break</a></h4>
<div class="outline-text-4" id="text-循环控制语句-break">
<p>
break [N]：提前结束第N层整个循环，最内层为第1层 格式：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">while</span> CONDITION1; <span class="org-keyword">do</span>
    CMD1
    ...
    <span class="org-keyword">if</span> CONDITION2; <span class="org-keyword">then</span>
    <span class="org-keyword">break</span>
    <span class="org-keyword">fi</span>
    CMDn
    ...
<span class="org-keyword">done</span>
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 script40]#cat break_for.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span>
<span class="org-keyword">for</span> ((<span class="org-variable-name">i</span>=0;i&lt;10;i++));<span class="org-keyword">do</span>
    <span class="org-keyword">for</span>((<span class="org-variable-name">j</span>=0;j&lt;10;j++));<span class="org-keyword">do</span>
        [ $<span class="org-variable-name">j</span> -eq 5 ] &amp;&amp; <span class="org-keyword">break</span>
        <span class="org-builtin">echo</span> $<span class="org-variable-name">j</span>
    <span class="org-keyword">done</span>
    <span class="org-builtin">echo</span> ---------------------------
<span class="org-keyword">done</span>
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 script40]#cat break_for.sh

<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-keyword">for</span> ((<span class="org-variable-name">i</span>=0;i&lt;10;i++));<span class="org-keyword">do</span>
    <span class="org-keyword">for</span>((<span class="org-variable-name">j</span>=0;j&lt;10;j++));<span class="org-keyword">do</span>
        [ $<span class="org-variable-name">j</span> -eq 5 ] &amp;&amp; <span class="org-keyword">break</span> 2
        <span class="org-builtin">echo</span> $<span class="org-variable-name">j</span>
    <span class="org-keyword">done</span>
    <span class="org-builtin">echo</span> ---------------------------
<span class="org-keyword">done</span>

[root@centos8 script40]#bash break_for.sh
0
1
2
3
4
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 script40]#cat menu.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-variable-name">sum</span>=0
<span class="org-variable-name">COLOR</span>=<span class="org-string">'echo -e \033[1;31m'</span>
<span class="org-variable-name">COLOR2</span>=<span class="org-string">'echo -e \033[1;32m'</span>
<span class="org-variable-name">END</span>=<span class="org-string">"\033[0m"</span>

<span class="org-keyword">while </span><span class="org-builtin">true</span>;<span class="org-keyword">do</span>
    <span class="org-builtin">echo</span> -e <span class="org-string">"\033[33;1m\c"</span>
    cat &lt;&lt;-EOF  <span class="org-sh-heredoc">
1) &#40077;&#40060;
2) &#28385;&#27721;&#20840;&#24109;
3) &#40857;&#34430;
4) &#29141;&#31389;
5) &#24093;&#29579;&#34809;
6) &#36864;&#20986;
    EOF  # &#22914;&#26524;&#32467;&#26463;&#26377;tab&#38190;&#21487;&#21152;-EOF &#65292;&#31354;&#26684;&#19981;&#36866;&#29992; &#12290;&#19968;&#33324;&#25105;&#20204;&#25165;&#33021;&#20250;&#29992;4&#20010;&#31354;&#26684;&#32553;&#36827;

    echo -e "\033[0m"

    read -p "&#35831;&#28857;&#33756;(1-6): " MENU
    case $MENU in
    1|4)
        $COLOR'&#33756;&#20215;: $10'$END
        let sum+=10
        ;;
    3|5)
        $COLOR'&#33756;&#20215;: $20'$END
        let sum+=20
        ;;
    2)
        $COLOR'&#33756;&#20215;: $1000'$END
        let sum+=1000
        ;;
    6)
        $COLOR2"&#20320;&#28857;&#30340;&#33756;&#24635;&#20215;&#26684;&#26159; $sum"$END
        break
        ;;
    *)
        echo "&#28857;&#38169;&#20102;,&#27809;&#26377;&#36825;&#36947;&#33756;"
        ;;
    esac
    $COLOR2"&#20320;&#28857;&#30340;&#33756;&#24635;&#20215;&#26684;&#26159; $sum"$END
done</span>
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 script40]#cat guess.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-variable-name">NUM</span>=$[RANDOM%10]
<span class="org-keyword">while </span><span class="org-builtin">read</span> -p <span class="org-string">"&#36755;&#20837; 0-9 &#20043;&#38388;&#30340;&#25968;&#23383;: "</span> INPUT ;<span class="org-keyword">do</span>
<span class="org-keyword">if</span> [ $<span class="org-variable-name">INPUT</span> -eq $<span class="org-variable-name">NUM</span> ];<span class="org-keyword">then</span>
<span class="org-builtin">echo</span> <span class="org-string">"&#24685;&#21916;&#20320;&#29468;&#23545;&#20102;!"</span>
<span class="org-keyword">break</span>
<span class="org-keyword">elif</span> [ $<span class="org-variable-name">INPUT</span> -gt $<span class="org-variable-name">NUM</span> ];<span class="org-keyword">then</span>
    <span class="org-builtin">echo</span> <span class="org-string">"&#25968;&#23383;&#22826;&#22823;&#20102;,&#37325;&#26032;&#29468;!"</span>
<span class="org-keyword">else</span>
    <span class="org-builtin">echo</span> <span class="org-string">"&#25968;&#23383;&#22826;&#23567;&#20102;,&#37325;&#26032;&#29468;!"</span>
  <span class="org-keyword">fi</span>
<span class="org-keyword">done</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-循环控制-shift-命令" class="outline-4">
<h4 id="循环控制-shift-命令"><a href="#循环控制-shift-命令">循环控制 shift 命令</a></h4>
<div class="outline-text-4" id="text-循环控制-shift-命令">
<p>
shift [n] 用于将参量列表 list 左移指定次数，缺省为左移一次。 参量列表
list 一旦被移动，最左端的那个参数就从列表中删除。while
循环遍历位置参量列表时，常用到 shift
</p>

<p>
范例：doit.sh
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span><span class="org-comment-delimiter"># </span><span class="org-comment">Name: doit.sh
</span><span class="org-comment-delimiter"># </span><span class="org-comment">Purpose: shift through command line arguments
</span><span class="org-comment-delimiter"># </span><span class="org-comment">Usage: doit.sh [args]
</span><span class="org-keyword">while</span> [ $<span class="org-variable-name">#</span> -gt 0 ] <span class="org-comment-delimiter"># </span><span class="org-comment">or (( $# &gt; 0 ))                                                                                                  
</span><span class="org-keyword">do</span>
    <span class="org-builtin">echo</span> $<span class="org-variable-name">*</span>
    <span class="org-builtin">shift</span>
don

./doit.sh a b c d e f g h
</pre>
</div>

<p>
范例：示例：shift.sh
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span><span class="org-comment-delimiter">#</span><span class="org-comment">step through all the positional parameters
</span><span class="org-keyword">until</span> [ -z <span class="org-string">"$1"</span> ]
<span class="org-keyword">do</span>
    <span class="org-builtin">echo</span> <span class="org-string">"$1"</span>
    <span class="org-builtin">shift</span>
<span class="org-keyword">done</span>
<span class="org-builtin">echo</span> 

./shfit.sh a b c d e f g h
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 script40]#vim shift_batch_user.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-keyword">if</span> [ $<span class="org-variable-name">#</span> -eq 0 ];<span class="org-keyword">then</span>
  <span class="org-builtin">echo</span> <span class="org-string">"Usage: `basename $0` user1 user2 ..."</span>
  <span class="org-keyword">exit</span>
<span class="org-keyword">fi</span>



<span class="org-keyword">while</span> [ <span class="org-string">"$1"</span> ];<span class="org-keyword">do</span>   <span class="org-comment-delimiter"># </span><span class="org-comment">&#19981;&#20026;&#31354;&#20026;&#30495;&#65292;&#19981;&#20889;-n&#20063;&#34892;
</span>    <span class="org-keyword">if</span> id $<span class="org-variable-name">1</span> &amp;&gt; /dev/null;<span class="org-keyword">then</span>
      <span class="org-builtin">echo</span> $<span class="org-variable-name">1</span> is exist
    <span class="org-keyword">else</span>
     useradd $<span class="org-variable-name">1</span>
     <span class="org-builtin">echo</span> <span class="org-string">"$1 is created"</span>
    <span class="org-keyword">fi</span>
    <span class="org-builtin">shift</span>
<span class="org-keyword">done</span>
<span class="org-builtin">echo</span> <span class="org-string">"All user is created"</span>
</pre>
</div>

<p>
动动手
</p>
<ul class="org-ul">
<li>每隔3秒钟到系统上获取已经登录的用户的信息；如果发现用户hacker登录，
则将登录时间和主机记录于日志/var/log/login.log中,并退出脚本</li>
<li>随机生成10以内的数字，实现猜字游戏，提示比较大或小，相等则退出</li>
<li>用文件名做为参数，统计所有参数文件的总行数</li>
<li>用二个以上的数字为参数，显示其中的最大值和最小值</li>
</ul>
</div>
</div>
<div id="outline-container-h:f30b432e-f55e-4d03-81f7-a58fc9acd198" class="outline-4">
<h4 id="h:f30b432e-f55e-4d03-81f7-a58fc9acd198"><a href="#h:f30b432e-f55e-4d03-81f7-a58fc9acd198">while 特殊用法 while read</a></h4>
<div class="outline-text-4" id="text-h:f30b432e-f55e-4d03-81f7-a58fc9acd198">
<p>
while 循环的特殊用法，遍历文件或文本的每一行
</p>

<p>
while是实现循环的，read是实现读入内容的。
</p>

<p>
格式：
</p>

<div class="org-src-container">
<pre class="src src-sh">1) &#36755;&#20837;&#37325;&#23450;&#21521;&#24490;&#29615;
<span class="org-keyword">while </span><span class="org-builtin">read</span> line; <span class="org-keyword">do</span>
    &#24490;&#29615;&#20307;
<span class="org-keyword">done</span> &lt; /PATH/FROM/SOMEFILE

2) &#31649;&#36947;&#24490;&#29615;
cat a.log|<span class="org-keyword">while </span><span class="org-builtin">read</span> line
<span class="org-keyword">do</span>

<span class="org-keyword">done</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">&#31649;&#29702;&#21629;&#20196;&#20250;&#36816;&#34892;&#22312;&#19968;&#20010;&#29420;&#31435;&#30340;&#23376;&#36827;&#31243;shell&#20013;&#65292;while&#20869;&#37096;&#21464;&#37327;&#26080;&#27861;&#22312;&#22806;&#37096;&#24341;&#29992;
</span>
3)
<span class="org-keyword">exec</span> &lt;a.log
<span class="org-keyword">while </span><span class="org-builtin">read</span> line
<span class="org-keyword">do</span>

<span class="org-keyword">done</span>
</pre>
</div>

<p>
说明：依次读取/PATH/FROM/SOMEFILE文件中的每一行，且将行赋值给变量line
</p>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#echo m| <span class="org-builtin">read</span> X ; <span class="org-builtin">echo</span> $<span class="org-variable-name">X</span>     <span class="org-comment-delimiter"># </span><span class="org-comment">&#31649;&#29702;&#21629;&#20196;&#20250;&#36816;&#34892;&#22312;&#19968;&#20010;&#29420;&#31435;&#30340;&#23376;&#36827;&#31243;shell&#20013;&#65292;
</span>
[root@centos8 ~]#echo m| <span class="org-keyword">while </span><span class="org-builtin">read</span> X ; <span class="org-keyword">do </span><span class="org-builtin">echo</span> $<span class="org-variable-name">X</span>;<span class="org-keyword">done</span>
me
[root@centos8 ~]#echo m | { <span class="org-builtin">read</span> X ; <span class="org-builtin">echo</span> $<span class="org-variable-name">X</span>; }
me
[root@centos8 ~]#echo m | ( <span class="org-builtin">read</span> X ; <span class="org-builtin">echo</span> $<span class="org-variable-name">X</span> )
me
[root@centos8 ~]#echo m wang zhang | ( <span class="org-builtin">read</span> X Y Z; <span class="org-builtin">echo</span> $<span class="org-variable-name">X</span> $<span class="org-variable-name">Y</span> $<span class="org-variable-name">Z</span> )
m wang zhang
[root@centos8 ~]#echo m wang zhang | <span class="org-keyword">while </span><span class="org-builtin">read</span> X Y Z; <span class="org-keyword">do </span><span class="org-builtin">echo</span> $<span class="org-variable-name">X</span> $<span class="org-variable-name">Y</span> $<span class="org-variable-name">Z</span>;<span class="org-keyword">done</span>
m  wang zhang
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">&#31649;&#29702;&#21629;&#20196;&#20250;&#36816;&#34892;&#22312;&#19968;&#20010;&#29420;&#31435;&#30340;&#23376;&#36827;&#31243;shell&#20013;&#65292;
</span><span class="org-comment-delimiter"># </span><span class="org-comment">&#20851;&#20110; () &#21644; {}&#20013;&#22810;&#20010;&#21629;&#20196;&#32452;&#21512;
</span>( list ) &#20250;&#24320;&#21551;&#23376;shell,&#24182;&#19988;list&#20013;&#21464;&#37327;&#36171;&#20540;&#21450;&#20869;&#37096;&#21629;&#20196;&#25191;&#34892;&#21518;,&#23558;&#19981;&#20877;&#24433;&#21709;&#21518;&#32493;&#30340;&#29615;&#22659;, &#24110;&#21161;&#21442;&#30475;:man bash&#25628;&#32034;(list)
{ list; } &#19981;&#20250;&#21551;&#23376;shell, &#22312;&#24403;&#21069;shell&#20013;&#36816;&#34892;,&#20250;&#24433;&#21709;&#24403;&#21069;shell&#29615;&#22659;, &#24110;&#21161;&#21442;&#30475;:man bash &#25628;&#32034;{ list; }

&#36825;&#37324;{ list; }&amp; ; <span class="org-builtin">wait</span> &#26041;&#24335;&#23454;&#20363;&#24182;&#34892;&#22788;&#29702;&#12290;wait&#20195;&#34920;&#31561;&#24453;&#25152;&#26377;&#21629;&#20196;&#25191;&#34892;&#32467;&#26463;&#65292;&#19981;&#21152;wait&#26368;&#21518;&#35201;&#25163;&#21160;&#25353;&#22238;&#36710;&#38190;&#12290;
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">cat while_read_diskcheck.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-variable-name">WARNING</span>=80
<span class="org-variable-name">MAIL</span>=root@cici.com
df |sed -nr  <span class="org-string">"/^\/dev\/sd/s#^([^ ]+) .* ([0-9]+)%.*#\1 \2#p"</span>|<span class="org-keyword">while </span><span class="org-builtin">read</span> DEVICE USE;<span class="org-keyword">do</span>
<span class="org-keyword">if</span> [ $<span class="org-variable-name">USE</span> -gt $<span class="org-variable-name">WARNING</span> ] ;<span class="org-keyword">then</span>
  <span class="org-builtin">echo</span> <span class="org-string">"$DEVICE will be full,use:$USE"</span> | mail -s <span class="org-string">"DISK WARNING"</span> $<span class="org-variable-name">MAIL</span>
<span class="org-keyword">fi</span>
<span class="org-keyword">done</span>
</pre>
</div>

<p>
范例: 将登录失败大于3次的用户，在防火墙中拒绝
</p>

<div class="org-src-container">
<pre class="src src-sh">cat while_read_check_dos.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span>lastb | sed -rn <span class="org-string">'/ssh:/s@.* ([0-9.]{1,3}{3}[0-9]{1,3}) .*@\1@p'</span>|sort |uniq -c|<span class="org-keyword">while </span><span class="org-builtin">read</span> count ip ;<span class="org-keyword">do</span>
    <span class="org-keyword">if</span> [ $<span class="org-variable-name">count</span> -gt 3 ];<span class="org-keyword">then</span>
        iptables -A INPUT -s $<span class="org-variable-name">ip</span> -j REJECT
    <span class="org-keyword">fi</span>
<span class="org-keyword">done</span>
</pre>
</div>

<p>
范例：查看/sbin/nologin的shell类型的用户名和UID
</p>

<div class="org-src-container">
<pre class="src src-sh">cat while_read_passwd.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-keyword">while </span><span class="org-builtin">read</span> line ;<span class="org-keyword">do</span>
    <span class="org-keyword">if</span> [[ <span class="org-string">"$line"</span> =~ /sbin/nologin$ ]] ;<span class="org-keyword">then</span>
        <span class="org-builtin">echo</span> $<span class="org-variable-name">line</span> | cut -d: -f1,3
    <span class="org-keyword">fi</span>                                   

<span class="org-keyword">done</span> &lt; /etc/passwd
</pre>
</div>

<p>
范例：单词文件
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos6 ~]#wc -l /usr/share/dict/linux.words
479829 /usr/share/dict/linux.words
</pre>
</div>

<p>
范例：获取pv，pvc信息对应关系
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span><span class="org-builtin">echo</span> <span class="org-string">"pvc   pv   path   ip"</span>
kubectl get pvc -n tidb  | grep tidb-biz | awk <span class="org-string">'{print $1, $3}'</span>| <span class="org-keyword">while </span><span class="org-builtin">read</span> pvc pv;<span class="org-keyword">do</span>
        <span class="org-variable-name">path</span>=$(kubectl get pv ${<span class="org-variable-name">pv</span>} -o=<span class="org-variable-name">jsonpath</span>=<span class="org-string">"{.spec.local.path}"</span>)
        <span class="org-variable-name">ip</span>=$(kubectl get pv ${<span class="org-variable-name">pv</span>} -o=<span class="org-variable-name">jsonpath</span>=<span class="org-string">"{.spec.nodeAffinity.required.nodeSelectorTerms[0].matchExpressions[0].values[0]}"</span>)
        <span class="org-builtin">echo</span> $<span class="org-variable-name">pvc</span> $<span class="org-variable-name">pv</span> $<span class="org-variable-name">path</span> $<span class="org-variable-name">ip</span>
<span class="org-keyword">done</span>
</pre>
</div>
</div>
<div id="outline-container-while-循环中使用ssh问题" class="outline-5">
<h5 id="while-循环中使用ssh问题"><a href="#while-循环中使用ssh问题">while 循环中使用ssh问题</a></h5>
<div class="outline-text-5" id="text-while-循环中使用ssh问题">
<p>
<a href="https://www.jianshu.com/p/815ba3d6995d">https://www.jianshu.com/p/815ba3d6995d</a>
</p>

<p>
问题分析：while使用重定向机制，ip.txt文件中的信息都已经读入并重定向给
了整个while语句，所以当我们在while循环中再一次调用read语句，就会读取到
下一条记录。问题就出在这里，ssh语句正好回读取输入中的所有东西。为了禁
止ssh读所有东西增加一个&lt; /dev/null，将ssh 的输入重定向输入。
</p>

<p>
解决策略：
</p>

<ol class="org-ol">
<li>使用for循环代表while，因为for没有一次把文件内容缓存获取过来</li>
<li><p>
ssh增加-n参数
通过man ssh查看-n参数的说明
</p>

<p>
Redirects stdin from
/dev/null (actually, prevents reading from stdin)
</p></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-select-循环与菜单" class="outline-4">
<h4 id="select-循环与菜单"><a href="#select-循环与菜单">select 循环与菜单</a></h4>
<div class="outline-text-4" id="text-select-循环与菜单">
<p>
格式：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">select</span> NAME [in WORDS ... ;]<span class="org-keyword"> do</span> COMMANDS; <span class="org-keyword">done</span>

<span class="org-keyword">select</span> variable<span class="org-keyword"> in</span> list ;<span class="org-keyword">do</span>
    &#24490;&#29615;&#20307;&#21629;&#20196;
<span class="org-keyword">done</span>
</pre>
</div>

<p>
说明：
</p>

<ul class="org-ul">
<li>select循环主要用于创建菜单，按数字顺序排列的菜单项显示在标准错误上，
并显示PS3 提示符，等待用户输入</li>
<li>用户输入菜单列表中的某个数字，执行相应的命令</li>
<li>用户输入被保存在内置变量 REPLY 中</li>
<li>select 是个无限循环，因此要用 break 命令退出循环，或用 exit命令终止
脚本。也可以按 ctrl+c退出循环</li>
<li>select 经常和 case 联合使用</li>
<li>与 for 循环类似，可以省略 in list，此时使用位置参量</li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">cat select.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-variable-name">sum</span>=0
<span class="org-variable-name">PS3</span>=<span class="org-string">"&#35831;&#28857;&#33756;(1-6): "</span>
<span class="org-keyword">select</span> MENU<span class="org-keyword"> in</span> &#21271;&#20140;&#28900;&#40493; &#20315;&#36339;&#22681; &#23567;&#40857;&#34430; &#32650;&#34638;&#23376; &#28779;&#38149; &#28857;&#33756;&#32467;&#26463;;<span class="org-keyword">do</span>
<span class="org-keyword">case</span> $<span class="org-variable-name">REPLY</span><span class="org-keyword"> in</span>
1)
    <span class="org-builtin">echo</span> $<span class="org-variable-name">MENU</span> &#20215;&#26684;&#26159; 100
    <span class="org-builtin">let</span> <span class="org-variable-name">sum</span>+=100
    ;;
2)
    <span class="org-builtin">echo</span> $<span class="org-variable-name">MENU</span> &#20215;&#26684;&#26159; 88
    <span class="org-builtin">let</span> <span class="org-variable-name">sum</span>+=88
    ;;
3)
    <span class="org-builtin">echo</span> $<span class="org-variable-name">MENU&#20215;&#26684;&#26159;</span> 66
    <span class="org-builtin">let</span> <span class="org-variable-name">sum</span>+=66
    ;;
4)
    <span class="org-builtin">echo</span> $<span class="org-variable-name">MENU</span> &#20215;&#26684;&#26159; 166
    <span class="org-builtin">let</span> <span class="org-variable-name">sum</span>+=166
    ;;
5)
    <span class="org-builtin">echo</span> $<span class="org-variable-name">MENU</span> &#20215;&#26684;&#26159; 200
    <span class="org-builtin">let</span> <span class="org-variable-name">sum</span>+=200
    ;;
6)
    <span class="org-keyword">break</span>
    ;;
*)
    <span class="org-builtin">echo</span> <span class="org-string">"&#28857;&#38169;"</span>
<span class="org-keyword">esac</span>
<span class="org-keyword">done</span>
</pre>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-function" class="outline-2">
<h2 id="function"><a href="#function">函数 function</a></h2>
<div class="outline-text-2" id="text-function">
</div>
<div id="outline-container-函数介绍" class="outline-3">
<h3 id="函数介绍"><a href="#函数介绍">函数介绍</a></h3>
<div class="outline-text-3" id="text-函数介绍">
<p>
函数function是由若干条shell命令组成的语句块，实现代码重用和模块化编程
</p>

<p>
它与shell程序形式上是相似的，不同的是它不是一个单独的进程，不能独立运
行，而是shell程序的一部分
</p>

<p>
函数和shell程序比较相似，区别在于Shell程序在子Shell中运行，而Shell函数
在当前Shell中运行。因此在当前Shell中，函数可对shell中变量进行修改
</p>
</div>
</div>
<div id="outline-container-管理函数" class="outline-3">
<h3 id="管理函数"><a href="#管理函数">管理函数</a></h3>
<div class="outline-text-3" id="text-管理函数">
<p>
函数由两部分组成：函数名和函数体
</p>

<p>
帮助参看：help function
</p>
</div>
<div id="outline-container-定义函数" class="outline-4">
<h4 id="定义函数"><a href="#定义函数">定义函数</a></h4>
<div class="outline-text-4" id="text-定义函数">
<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#35821;&#27861;&#19968;&#65306;
</span><span class="org-function-name">func_name</span> (){
...&#20989;&#25968;&#20307;...
}
<span class="org-comment-delimiter">#</span><span class="org-comment">&#35821;&#27861;&#20108;&#65306;
</span><span class="org-keyword">function</span> <span class="org-function-name">func_name</span> {
...&#20989;&#25968;&#20307;...
}
<span class="org-comment-delimiter">#</span><span class="org-comment">&#35821;&#27861;&#19977;&#65306;
</span><span class="org-keyword">function</span> <span class="org-function-name">func_name</span> () {
...&#20989;&#25968;&#20307;...
}
</pre>
</div>
</div>
</div>
<div id="outline-container-查看函数" class="outline-4">
<h4 id="查看函数"><a href="#查看函数">查看函数</a></h4>
<div class="outline-text-4" id="text-查看函数">
<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#26597;&#30475;&#24403;&#21069;&#24050;&#23450;&#20041;&#30340;&#20989;&#25968;&#21517;
</span><span class="org-builtin">declare</span> -F
<span class="org-comment-delimiter">#</span><span class="org-comment">&#26597;&#30475;&#24403;&#21069;&#24050;&#23450;&#20041;&#30340;&#20989;&#25968;&#23450;&#20041;
</span><span class="org-builtin">declare</span> -f
<span class="org-comment-delimiter">#</span><span class="org-comment">&#26597;&#30475;&#25351;&#23450;&#24403;&#21069;&#24050;&#23450;&#20041;&#30340;&#20989;&#25968;&#21517;
</span><span class="org-builtin">declare</span> -f func_name
<span class="org-comment-delimiter">#</span><span class="org-comment">&#26597;&#30475;&#24403;&#21069;&#24050;&#23450;&#20041;&#30340;&#20989;&#25968;&#21517;&#23450;&#20041;
</span><span class="org-builtin">declare</span> -F func_name
</pre>
</div>
</div>
</div>
<div id="outline-container-删除函数" class="outline-4">
<h4 id="删除函数"><a href="#删除函数">删除函数</a></h4>
<div class="outline-text-4" id="text-删除函数">
<p>
格式：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">unset</span> func_name
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-函数调用" class="outline-3">
<h3 id="函数调用"><a href="#函数调用">函数调用</a></h3>
<div class="outline-text-3" id="text-函数调用">
<p>
函数的调用方式
</p>

<ul class="org-ul">
<li>可在交互式环境下定义函数</li>
<li>可将函数放在脚本文件中作为它的一部分</li>
<li>可放在只包含函数的单独文件中
调用：函数只有被调用才会执行，通过给定函数名调用函数，函数名出现的地方，会被自动替换为函数代码
函数的生命周期：被调用时创建，返回时终止</li>
</ul>
</div>
<div id="outline-container-交互式环境调用函数" class="outline-4">
<h4 id="交互式环境调用函数"><a href="#交互式环境调用函数">交互式环境调用函数</a></h4>
<div class="outline-text-4" id="text-交互式环境调用函数">
<p>
交互式环境下定义和使用函数
</p>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#dir() {
&gt; ls -l
&gt; }
[root@centos8 ~]#dir
total 4
-rw-------. 1 root root 1559 Nov 7 19:33 anaconda-ks.cfg 
</pre>
</div>
</div>
</div>
<div id="outline-container-在脚本中定义及使用函数" class="outline-4">
<h4 id="在脚本中定义及使用函数"><a href="#在脚本中定义及使用函数">在脚本中定义及使用函数</a></h4>
<div class="outline-text-4" id="text-在脚本中定义及使用函数">
<p>
函数在使用前必须定义，因此应将函数定义放在脚本开始部分，直至shell首次
发现它后才能使用，调用函数仅使用其函数名即可
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat func1.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">name:func1
</span><span class="org-function-name">hello</span>(){
<span class="org-builtin">echo</span> <span class="org-string">"Hello there today's date is `date +%F`"</span>
}
<span class="org-builtin">echo</span> <span class="org-string">"now going to the function hello"</span>
hello
<span class="org-builtin">echo</span> <span class="org-string">"back from the function"</span>

[root@centos8 ~]#./func1.sh
now going to the <span class="org-keyword">function</span> <span class="org-function-name">hello</span>
Hello there today<span class="org-string">'s date is 2019-12-18
back from the function</span>
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">cat reset.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span>
<span class="org-function-name">disable_selinux</span>(){
    sed -i.bak <span class="org-string">'s/SELINUX=enforcing/SELINUX=disabled/'</span> /etc/selinux/config
    <span class="org-builtin">echo</span> <span class="org-string">"SElinux&#24050;&#31105;&#29992;,&#37325;&#26032;&#21551;&#21160;&#21518;&#25165;&#21487;&#29983;&#25928;"</span>
}
<span class="org-function-name">disable_firewall</span>(){
    systemctl disable --now firewalld &amp;&gt; /dev/null
    <span class="org-builtin">echo</span> <span class="org-string">"&#38450;&#28779;&#22681;&#24050;&#31105;&#29992;"</span>
}
<span class="org-function-name">set_ps1</span>() {
    <span class="org-builtin">echo</span> <span class="org-string">"PS1='\[\e[1;35m\][\u@\h \W]\\$\[\e[0m\]'"</span> &gt; /etc/profile.d/reset.sh
    <span class="org-builtin">echo</span> <span class="org-string">"&#25552;&#31034;&#31526;&#24050;&#20462;&#25913;&#25104;&#21151;,&#35831;&#37325;&#26032;&#30331;&#24405;&#29983;&#25928;"</span>
}
<span class="org-function-name">set_eth</span>(){
    sed -i.bak  <span class="org-string">'/GRUB_CMDLINE_LINUX=/s#"$# net.ifnames=0"#'</span> /etc/default/grub
    grub2-mkconfig -o /boot/grub2/grub.cfg &amp;&gt; /dev/null
    <span class="org-builtin">echo</span> <span class="org-string">"&#32593;&#32476;&#21517;&#31216;&#24050;&#20462;&#25913;&#25104;&#21151;,&#35831;&#37325;&#26032;&#21551;&#21160;&#25165;&#33021;&#29983;&#25928;"</span>
}

<span class="org-variable-name">PS3</span>=<span class="org-string">"&#35831;&#36873;&#25321;&#30456;&#24212;&#30340;&#32534;&#21495;(1-6): "</span>
<span class="org-variable-name">MENU</span>=<span class="org-string">'
&#31105;&#29992;SELinux
&#20851;&#38450;&#28779;&#22681;
&#20462;&#25913;&#25552;&#31034;&#31526;
&#20462;&#25913;&#32593;&#21345;&#21517;
&#20197;&#19978;&#20840;&#23454;&#29616;
&#36864;&#20986;
'</span>
<span class="org-keyword">select</span> M<span class="org-keyword"> in</span> $<span class="org-variable-name">MENU</span> ;<span class="org-keyword">do</span>
<span class="org-keyword">case</span> $<span class="org-variable-name">REPLY</span><span class="org-keyword"> in</span>
1)
    disable_selinux
    ;;
2)
    disable_firewall
    ;;
3)
    set_ps1
    ;;
4)
    set_eth
    ;;
5)
    disable_selinux
    disable_firewall
    set_ps1
    set_eth
    ;;
6)
    <span class="org-keyword">break</span>
    ;;
*)
    <span class="org-builtin">echo</span> <span class="org-string">"&#35831;&#36755;&#20837;&#27491;&#30830;&#30340;&#25968;&#23383;"</span>
<span class="org-keyword">esac</span>
<span class="org-keyword">done</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-使用函数文件" class="outline-4">
<h4 id="使用函数文件"><a href="#使用函数文件">使用函数文件</a></h4>
<div class="outline-text-4" id="text-使用函数文件">
<p>
<code>可以将经常使用的函数存入一个单独的函数文件，然后将函数文件载入shell，
再进行调用函数</code>
</p>

<p>
文件名可任意选取，但最好与相关任务有某种联系，例如：functions
</p>

<p>
一旦函数文件载入shell，就可以在命令行或脚本中调用函数。可以使用delcare
-f 或set 命令查看所有
</p>

<p>
定义的函数，其输出列表包括已经载入shell的所有函数
</p>

<p>
若要改动函数，首先用unset命令从shell中删除函数。改动完毕后，再重新载入
此文件
</p>

<p>
实现函数文件的过程：
</p>

<ol class="org-ol">
<li>创建函数文件，只存放函数的定义</li>

<li><p>
在shell脚本或交互式shell中调用函数文件，格式如下：
</p>

<div class="org-src-container">
<pre class="src src-sh">. filename &#25110; source  filename 
</pre>
</div></li>
</ol>

<p>
范例：使用函数文件作为常用功能模块
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat functions
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">functions
</span><span class="org-function-name">hello</span>(){
  <span class="org-builtin">echo</span> Run hello Function
}
<span class="org-function-name">hello2</span>(){
  <span class="org-builtin">echo</span> Run hello2 Function
}

[root@centos8 ~]#. functions
[root@centos8 ~]#hello
Run hello Function
[root@centos8 ~]#hello2
Run hello2 Function

[root@centos8 ~]#declare -f hello hello2
<span class="org-function-name">hello</span> ()
{
  <span class="org-builtin">echo</span> Run hello Function
}
<span class="org-function-name">hello2</span> ()
{
  <span class="org-builtin">echo</span> Run hello2 Function
}
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 script40]#cat reset.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span>
. /etc/init.d/functions
<span class="org-function-name">disable_selinux</span>(){
    sed -i.bak <span class="org-string">'s/SELINUX=enforcing/SELINUX=disabled/'</span> /etc/selinux/config
    action <span class="org-string">"SElinux&#24050;&#31105;&#29992;,&#37325;&#26032;&#21551;&#21160;&#21518;&#25165;&#21487;&#29983;&#25928;"</span>
}
<span class="org-function-name">disable_firewall</span>(){
    systemctl disable --now firewalld &amp;&gt; /dev/null
    action <span class="org-string">"&#38450;&#28779;&#22681;&#24050;&#31105;&#29992;"</span>
}
<span class="org-function-name">set_ps1</span>() {
    <span class="org-builtin">echo</span> <span class="org-string">"PS1='\[\e[1;35m\][\u@\h \W]\\$\[\e[0m\]'"</span> &gt; /etc/profile.d/reset.sh
    action <span class="org-string">"&#25552;&#31034;&#31526;&#24050;&#20462;&#25913;&#25104;&#21151;,&#35831;&#37325;&#26032;&#30331;&#24405;&#29983;&#25928;"</span>
}
<span class="org-function-name">set_eth</span>(){
    sed -i.bak  <span class="org-string">'/GRUB_CMDLINE_LINUX=/s#"$# net.ifnames=0"#'</span> /etc/default/grub
    grub2-mkconfig -o /boot/grub2/grub.cfg &amp;&gt; /dev/null
    action <span class="org-string">"&#32593;&#32476;&#21517;&#31216;&#24050;&#20462;&#25913;&#25104;&#21151;,&#35831;&#37325;&#26032;&#21551;&#21160;&#25165;&#33021;&#29983;&#25928;"</span>
}

<span class="org-variable-name">PS3</span>=<span class="org-string">"&#35831;&#36873;&#25321;&#30456;&#24212;&#30340;&#32534;&#21495;(1-6): "</span>
<span class="org-variable-name">MENU</span>=<span class="org-string">'
&#31105;&#29992;SELinux
&#20851;&#38450;&#28779;&#22681;
&#20462;&#25913;&#25552;&#31034;&#31526;
&#20462;&#25913;&#32593;&#21345;&#21517;
&#20197;&#19978;&#20840;&#23454;&#29616;
&#36864;&#20986;
'</span>
<span class="org-keyword">select</span> M<span class="org-keyword"> in</span> $<span class="org-variable-name">MENU</span> ;<span class="org-keyword">do</span>
<span class="org-keyword">case</span> $<span class="org-variable-name">REPLY</span><span class="org-keyword"> in</span>
1)
    disable_selinux
    ;;
2)
    disable_firewall
    ;;
3)
    set_ps1
    ;;
4)
    set_eth
    ;;
5)
    disable_selinux
    disable_firewall
    set_ps1
    set_eth
    ;;
6)
    <span class="org-keyword">break</span>
    ;;
*)
    <span class="org-builtin">echo</span> <span class="org-string">"&#35831;&#36755;&#20837;&#27491;&#30830;&#30340;&#25968;&#23383;"</span>
<span class="org-keyword">esac</span>
<span class="org-keyword">done</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-函数返回值" class="outline-3">
<h3 id="函数返回值"><a href="#函数返回值">函数返回值</a></h3>
<div class="outline-text-3" id="text-函数返回值">
<p>
函数的执行结果返回值：
</p>

<ul class="org-ul">
<li>使用echo等命令进行输出</li>
<li>函数体中调用命令的输出结果</li>
</ul>

<p>
函数的退出状态码：
</p>

<ul class="org-ul">
<li>默认取决于函数中执行的最后一条命令的退出状态码</li>
<li>自定义退出状态码，其格式为： return
从函数中返回，用最后状态命令决定返回值 return 0 无错误返回 return
1-255 有错误返回</li>
</ul>
</div>
</div>
<div id="outline-container-环境函数" class="outline-3">
<h3 id="环境函数"><a href="#环境函数">环境函数</a></h3>
<div class="outline-text-3" id="text-环境函数">
<p>
类拟于环境变量，也可以定义环境函数，使子进程也可使用父进程定义的函数
用的不多
</p>

<p>
定义环境函数：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">export</span> -f function_name
<span class="org-builtin">declare</span> -xf function_name
</pre>
</div>

<p>
查看环境函数：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">export</span> -f
<span class="org-builtin">declare</span> -xf
</pre>
</div>
</div>
</div>
<div id="outline-container-函数参数" class="outline-3">
<h3 id="函数参数"><a href="#函数参数">函数参数</a></h3>
<div class="outline-text-3" id="text-函数参数">
<p>
函数可以接受参数：
</p>

<ul class="org-ul">
<li>传递参数给函数：在函数名后面以空白分隔给定参数列表即可，如：testfunc
arg1 arg2 &#x2026;</li>
<li>在函数体中当中，可使用 <code>$1, $2, ...</code> 调用这些参数；还可以使用 <code>$@,
  $*, $#</code> 等特殊变量</li>
</ul>
</div>
</div>
<div id="outline-container-函数变量" class="outline-3">
<h3 id="函数变量"><a href="#函数变量">函数变量</a></h3>
<div class="outline-text-3" id="text-函数变量">
<p>
变量作用域：
</p>

<ul class="org-ul">
<li>普通变量：只在当前shell进程有效，为执行脚本会启动专用子shell进程；因此，本地变量的作用范围是当前shell脚本程序文件，包括脚本中的函数</li>
<li>环境变量：当前shell和子shell有效</li>
<li>本地变量：函数的生命周期；函数结束时变量被自动销毁</li>
</ul>

<p>
注意：
</p>

<ul class="org-ul">
<li>如果函数中定义了普通变量，且名称和局部变量相同，则使用本地变量</li>
<li>由于普通变量和局部变量会冲突，建议在函数中只使用本地变量</li>
</ul>

<p>
在函数中定义本地变量的方法
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">local</span> <span class="org-variable-name">NAME</span>=VALUE
</pre>
</div>

<p>
本地变量，向下传递
</p>

<div class="org-src-container">
<pre class="src src-sh">[jasper.xu@ip-172-21-39-120 ~]$ cat a.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span>
<span class="org-function-name">ts</span>() {
    <span class="org-variable-name">commands</span>=()
    <span class="org-variable-name">commands</span>+=(<span class="org-string">"annotate"</span>)
    <span class="org-variable-name">commands</span>+=(<span class="org-string">"api-resources"</span>)
    <span class="org-variable-name">commands</span>+=(<span class="org-string">"api-versions"</span>)
    <span class="org-builtin">echo</span> ${<span class="org-variable-name">commands</span>[@]}
}

<span class="org-function-name">my_f</span>() {
    <span class="org-builtin">local</span> <span class="org-variable-name">commands</span>=(<span class="org-string">"kubectl"</span>)
    <span class="org-builtin">echo</span> ${<span class="org-variable-name">commands</span>[@]}
    ts
}

my_f
<span class="org-builtin">echo</span> ${<span class="org-variable-name">commands</span>[@]}

[jasper.xu@ip-172-21-39-120 ~]$ bash -x a.sh
+ my_f
+ <span class="org-variable-name">commands</span>=(<span class="org-string">"kubectl"</span>)
+ local commands
+ echo kubectl
kubectl
+ ts
+ <span class="org-variable-name">commands</span>=()
+ <span class="org-variable-name">commands</span>+=(<span class="org-string">"annotate"</span>)
+ <span class="org-variable-name">commands</span>+=(<span class="org-string">"api-resources"</span>)
+ <span class="org-variable-name">commands</span>+=(<span class="org-string">"api-versions"</span>)
+ echo annotate api-resources api-versions
annotate api-resources api-versions
+ echo
</pre>
</div>
</div>
</div>
<div id="outline-container-函数递归" class="outline-3">
<h3 id="函数递归"><a href="#函数递归">函数递归</a></h3>
<div class="outline-text-3" id="text-函数递归">
<p>
函数递归：函数直接或间接调用自身，注意递归层数，可能会陷入死循环
</p>

<p>
<b>递归示例：</b>
</p>

<p>
阶乘是基斯顿·卡曼于 1808 年发明的运算符号，是数学术语，一个正整数的阶
乘(factorial)是所有小于及等于该数的正整数的积，并且0和1的阶乘为1，自然
数n的阶乘写作n!
</p>

<pre class="example" id="org027effb">
n!=1×2×3×...×n
阶乘亦可以递归方式定义：0!=1，n!=(n-1)!×n
n!=n(n-1)(n-2)...1
n(n-1)! = n(n-1)(n-2)!
</pre>


<p>
范例：fact.sh
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-function-name">fact</span>() {
  <span class="org-keyword">if</span> [ $<span class="org-variable-name">1</span> -eq 0 -o $<span class="org-variable-name">1</span> -eq 1 ]; <span class="org-keyword">then</span>
<span class="org-builtin">echo</span> 1
  <span class="org-keyword">else</span>
<span class="org-builtin">echo</span> $[$<span class="org-variable-name">1</span>*$(fact $[$<span class="org-variable-name">1</span>-1])]
  <span class="org-keyword">fi</span>
}
fact $<span class="org-variable-name">1</span>
</pre>
</div>
</div>
<div id="outline-container-fork-炸弹" class="outline-4">
<h4 id="fork-炸弹"><a href="#fork-炸弹">fork 炸弹</a></h4>
<div class="outline-text-4" id="text-fork-炸弹">
<p>
fork 炸弹是一种恶意程序，它的内部是一个不断在 fork进程的无限循环，实质
是一个简单的递归程序。由于程序是递归的，如果没有任何限制，这会导致这个
简单的程序迅速耗尽系统里面的所有资源
</p>

<p>
参考：<a href="https://en.wikipedia.org/wiki/Fork_bomb">https://en.wikipedia.org/wiki/Fork_bomb</a>
</p>

<p>
函数实现
</p>

<div class="org-src-container">
<pre class="src src-sh">:(){ :|:&amp; };:
<span class="org-comment-delimiter">#</span><span class="org-comment">&#29702;&#35299;&#65292;&#26356;&#25913;&#26684;&#24335;
</span>:()
{
    :|:&amp;
}
;
:
<span class="org-comment-delimiter">#</span><span class="org-comment">&#29702;&#35299;&#65292;
</span><span class="org-function-name">bomb</span>()
{
    bomb|bomb&amp;
}
;
bomb
<span class="org-comment-delimiter">#</span><span class="org-comment">&#20063;&#23601;&#26159;
</span><span class="org-function-name">bomb</span>() { bomb | bomb &amp; }; bomb
</pre>
</div>

<p>
脚本实现
</p>

<div class="org-src-container">
<pre class="src src-sh">cat Bomb.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span>./$<span class="org-variable-name">0</span>|./$<span class="org-variable-name">0</span>&amp;
</pre>
</div>


<figure id="org4f1192f">
<img src="././images/image-20210206110804686.png" alt="image-20210206110804686.png" width="50%">

<figcaption><span class="figure-number">Figure 7: </span>image-20210206110804686</figcaption>
</figure>

<p>
python版
</p>

<pre class="example" id="org5acce63">
import os
   while True:
   os.fork()
</pre>

<p>
可以通过ulimit命令来限制用户的某些行为。=-u=参数可以限制用户创建进程数，因此，我们可以使用=ulimit -u 20=来允许用户最多创建20个进程。
</p>

<p>
动动手
</p>

<ol class="org-ol">
<li>编写函数，实现OS的版本判断</li>

<li>编写函数，实现取出当前系统eth0的IP地址</li>

<li>编写函数，实现打印绿色OK和红色FAILED</li>

<li>编写函数，实现判断是否无位置参数，如无参数，提示错误</li>

<li>编写函数，实现两个数字做为参数，返回最大值</li>

<li>编写服务脚本/root/bin/testsrv.sh，完成如下要求

<ol class="org-ol">
<li>脚本可接受参数：start, stop, restart, status</li>
<li>如果参数非此四者之一，提示使用格式后报错退出</li>
<li>如是start:则创建/var/lock/subsys/SCRIPT_NAME, 并显示”启动成功”
考虑：如果事先已经启动过一次，该如何处理？</li>
<li>如是stop:则删除/var/lock/subsys/SCRIPT_NAME, 并显示”停止完成”
考虑：如果事先已然停止过了，该如何处理？</li>
<li>如是restart，则先stop, 再start 考虑：如果本来没有start，如何处理？</li>
<li>如是status,
则如果/var/lock/subsys/SCRIPT_NAME文件存在，则显示”SCRIPT_NAME is
running&#x2026;"，如果/var/lock/subsys/SCRIPT_NAME文件不存在，则显示"SCRIPT_NAME
is stopped&#x2026;” (7)在所有模式下禁止启动该服务，可用chkconfig 和
service命令管理 说明：SCRIPT_NAME为当前脚本名</li>
</ol></li>

<li>编写脚本/root/bin/copycmd.sh

<ol class="org-ol">
<li>提示用户输入一个可执行命令名称</li>
<li>获取此命令所依赖到的所有库文件列表</li>
<li>复制命令至某目标目录(例如/mnt/sysroot)下的对应路径下 如：/bin/bash
==&gt; /mnt/sysroot/bin/bash /usr/bin/passwd ==&gt;
/mnt/sysroot/usr/bin/passwd</li>
<li>复制此命令依赖到的所有库文件至目标目录下的对应路径下：
如：/lib64/ld-linux-x86- 64.so.2 ==&gt;
/mnt/sysroot/lib64/ld-linux-x86-64.so.2
(5)每次复制完成一个命令后，不要退出，而是提示用户键入新的要复制的命令，并重复完成上述
功能；直到用户输入quit退出</li>
</ol></li>

<li>斐波那契数列又称黄金分割数列，因数学家列昂纳多·斐波那契以兔子繁殖为例子而引入，故又称
为”兔子数列”，指的是这样一个数列：0、1、1、2、3、5、8、13、21、34、&#x2026;&#x2026;，斐波纳契数列
以如下被以递归的方法定义：F(0)=0，F(1)=1，F(n)=F(n-1)+F(n-2)(n≥2)，利用函数，
求n阶斐波那契数列</li>

<li>汉诺塔(又称河内塔)问题是源于印度一个古老传说。大梵天创造世界的时候做了三根金刚石柱
子，在一根柱子上从下往上按照大小顺序摞着64片黄金圆盘。大梵天命令婆罗门把圆盘从下面开
始按大小顺序重新摆放在另一根柱子上。并且规定，在小圆盘上不能放大圆盘，在三根柱子之间一
次只能移动一个圆盘，利用函数，实现N片盘的汉诺塔的移动步骤</li>
</ol>
</div>
</div>
</div>
</section>
<section id="outline-container-其它脚本相关工具" class="outline-2">
<h2 id="其它脚本相关工具"><a href="#其它脚本相关工具">其它脚本相关工具</a></h2>
<div class="outline-text-2" id="text-其它脚本相关工具">
</div>
<div id="outline-container-信号捕捉-trap" class="outline-3">
<h3 id="信号捕捉-trap"><a href="#信号捕捉-trap">信号捕捉 trap</a></h3>
<div class="outline-text-3" id="text-信号捕捉-trap">
</div>
<div id="outline-container-常见的信号" class="outline-4">
<h4 id="常见的信号"><a href="#常见的信号">常见的信号</a></h4>
<div class="outline-text-4" id="text-常见的信号">
<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">trap</span>        -l
<span class="org-builtin">kill</span>        -l
man        7        signal
</pre>
</div>

<p>
描述一个信号
</p>

<ul class="org-ul">
<li>全称法 如SIGHUP sighup</li>
<li>简写 如HUP hup</li>
<li>数字法 如 1</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">SIGHUP 1 &#32456;&#27490;&#36827;&#31243;&#65292;&#29305;&#21035;&#26159;&#32456;&#31471;&#36864;&#20986;&#26102;&#65292;&#27492;&#32456;&#31471;&#20869;&#30340;&#36827;&#31243;&#37117;&#23558;&#34987;&#32456;&#27490;
SIGINT 2 &#20013;&#26029;&#36827;&#31243;&#65292;&#20960;&#20046;&#31561;&#21516;&#20110;sigterm&#65292;&#20250;&#23613;&#21487;&#33021;&#30340;&#37322;&#25918;&#25191;&#34892;clean-up&#65292;&#37322;&#25918;&#36164;&#28304;&#65292;&#20445;&#23384;&#29366;&#24577;&#31561;(CTRL+C)
SIGQUIT 3 &#20174;&#38190;&#30424;&#21457;&#20986;&#26432;&#27515;(&#32456;&#27490;)&#36827;&#31243;&#30340;&#20449;&#21495;&#65292;&#30456;&#24403;&#20110;&#30456;&#24403;&#20110;ctrl+<span class="org-string">\ </span>&#12289;quit
SIGKILL 9 &#24378;&#21046;&#26432;&#27515;&#36827;&#31243;&#65292;&#35813;&#20449;&#21495;&#19981;&#21487;&#34987;&#25429;&#25417;&#21644;&#24573;&#30053;&#65292;&#36827;&#31243;&#25910;&#21040;&#35813;&#20449;&#21495;&#21518;&#19981;&#20250;&#25191;&#34892;&#20219;&#20309;clean-up&#34892;&#20026;&#65292;&#25152;&#20197;&#36164;&#28304;&#19981;&#20250;&#37322;&#25918;&#65292;&#29366;&#24577;&#19981;&#20250;&#20445;&#23384;
SIGTERM 15 &#26432;&#27515;(&#32456;&#27490;)&#36827;&#31243;&#65292;&#20960;&#20046;&#31561;&#21516;&#20110;sigint&#20449;&#21495;&#65292;&#20250;&#23613;&#21487;&#33021;&#30340;&#37322;&#25918;&#25191;&#34892;clean-up&#65292;&#37322;&#25918;&#36164;&#28304;&#65292;&#20445;&#23384;&#29366;&#24577;&#31561;&#65292;&#40664;&#35748;&#20449;&#21495;
SIGCONT 18 &#32487;&#32493;&#36816;&#34892;
SIGSTOP 19 &#35813;&#20449;&#21495;&#26159;&#19981;&#21487;&#34987;&#25429;&#25417;&#21644;&#24573;&#30053;&#30340;&#36827;&#31243;&#20572;&#27490;&#20449;&#24687;&#65292;&#25910;&#21040;&#20449;&#21495;&#21518;&#20250;&#36827;&#20837;stopped&#29366;&#24577;&#65292;&#21518;&#21488;&#20241;&#30496; 
SIGTSTP 20 &#35813;&#20449;&#21495;&#26159;&#21487;&#34987;&#24573;&#30053;&#30340;&#36827;&#31243;&#20572;&#27490;&#20449;&#21495;(CTRL+Z)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">[root@middle-ware ~/learn] <span class="org-variable-name">eth0</span> = 10.0.1.86                   
<span class="org-comment-delimiter"># </span><span class="org-comment">ping 127.0.0.1                                              
</span>PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.              
64 bytes from 127.0.0.1: <span class="org-variable-name">icmp_seq</span>=1 <span class="org-variable-name">ttl</span>=64 <span class="org-variable-name">time</span>=0.052 ms      

--- 127.0.0.1 ping statistics ---                             
7 packets transmitted, 7 received, 0% packet loss, time 5999ms
rtt min/avg/max/mdev = 0.052/0.063/0.084/0.016 ms    

<span class="org-comment-delimiter"># </span><span class="org-comment">&#21478;&#19968;&#20010;&#31383;&#21475;&#21457;&#36865;&#20449;&#21495;&#32467;&#26463;ping&#21629;&#20196;
</span>[root@middle-ware ~/learn] <span class="org-variable-name">eth0</span> = 10.0.1.86
<span class="org-comment-delimiter"># </span><span class="org-comment">yum provides  killall  # &#25214;&#21040;killall&#21629;&#20196;&#23545;&#24212;&#30340;&#21253;
</span>psmisc-22.20-17.el7.x86_64 : Utilities for managing processes on
[root@middle-ware ~/learn] <span class="org-variable-name">eth0</span> = 10.0.1.86
<span class="org-comment-delimiter"># </span><span class="org-comment">yum install psmisc -y
</span>[root@middle-ware ~/learn] <span class="org-variable-name">eth0</span> = 10.0.1.86
<span class="org-comment-delimiter"># </span><span class="org-comment">killall -2 ping</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-信号捕捉-trap-1" class="outline-4">
<h4 id="信号捕捉-trap-1"><a href="#信号捕捉-trap-1">信号捕捉 trap</a></h4>
<div class="outline-text-4" id="text-信号捕捉-trap-1">
<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">trap</span> <span class="org-string">'&#35302;&#21457;&#25351;&#20196;'</span> &#20449;&#21495;
    &#36827;&#31243;&#25910;&#21040;&#31995;&#32479;&#21457;&#20986;&#30340;&#25351;&#23450;&#20449;&#21495;&#21518;&#65292;&#23558;&#25191;&#34892;&#33258;&#23450;&#20041;&#25351;&#20196;&#65292;&#32780;&#19981;&#20250;&#25191;&#34892;&#21407;&#25805;&#20316;
    &#27880;&#24847;&#65306;9 &#20449;&#21495;&#26159;&#25429;&#25417;&#19981;&#20102;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">trap</span> <span class="org-string">''</span> &#20449;&#21495;
    &#24573;&#30053;&#20449;&#21495;&#30340;&#25805;&#20316;
<span class="org-keyword">trap</span> <span class="org-string">'-'</span> &#20449;&#21495;
    &#24674;&#22797;&#21407;&#20449;&#21495;&#30340;&#25805;&#20316;
<span class="org-keyword">trap</span> -p
    &#21015;&#20986;&#33258;&#23450;&#20041;&#20449;&#21495;&#25805;&#20316;
<span class="org-keyword">trap</span> finish EXIT
    &#24403;&#33050;&#26412;&#36864;&#20986;&#26102;&#65292;&#25191;&#34892;finish&#20989;&#25968;&#12290;&#36864;&#20986;&#21487;&#20197;&#26159;&#20219;&#20309;&#24418;&#24335;&#30340;&#36864;&#20986;

</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span><span class="org-keyword">trap</span> <span class="org-string">'echo "Press ctrl+c"'</span> int quit <span class="org-comment-delimiter"># </span><span class="org-comment">&#25429;&#25417;&#20449;&#21495;ctrl +c  &#25191;&#34892; echo "Press ctrl+c" &#21629;&#20196;
</span><span class="org-keyword">trap</span> -p
<span class="org-keyword">for</span>((<span class="org-variable-name">i</span>=0;i&lt;=10;i++))
<span class="org-keyword">do</span>
   sleep 1
   <span class="org-builtin">echo</span> $<span class="org-variable-name">i</span>
<span class="org-keyword">done</span>

<span class="org-keyword">trap</span> <span class="org-string">''</span> int  <span class="org-comment-delimiter"># </span><span class="org-comment">&#24573;&#30053;&#20449;&#21495;&#65292;&#26377;&#20449;&#21495;&#21457;&#36807;&#26469;&#65292;&#20160;&#20040;&#20063;&#19981;&#20570;
</span><span class="org-keyword">trap</span> -p
<span class="org-keyword">for</span>((<span class="org-variable-name">i</span>=11;i&lt;=20;i++))
<span class="org-keyword">do</span>
   sleep 1
   <span class="org-builtin">echo</span> $<span class="org-variable-name">i</span>
<span class="org-keyword">done</span>

<span class="org-keyword">trap</span> <span class="org-string">'-'</span> int  <span class="org-comment-delimiter"># </span><span class="org-comment">&#24674;&#22797;&#21407;&#20449;&#21495;&#25805;&#20316;
</span><span class="org-keyword">trap</span> -p
<span class="org-keyword">for</span>((<span class="org-variable-name">i</span>=21;i&lt;=30;i++))
<span class="org-keyword">do</span>
   sleep 1
   <span class="org-builtin">echo</span> $<span class="org-variable-name">i</span>
<span class="org-keyword">done</span>

[root@middle-ware ~/learn] <span class="org-variable-name">eth0</span> = 10.0.1.86       
<span class="org-comment-delimiter"># </span><span class="org-comment">bash s.sh                                       
</span><span class="org-keyword">trap</span> -- <span class="org-string">'echo "Press ctrl+c"'</span> SIGINT              
<span class="org-keyword">trap</span> -- <span class="org-string">'echo "Press ctrl+c"'</span> SIGQUIT             
0                                                 
^CPress ctrl+c                                    
1                                                 
2                                                 
3                                                 
^CPress ctrl+c                                    
4                                                 
^CPress ctrl+c                                    
5                                                 
^CPress ctrl+c                                    
6                                                 
7                                                 
8                                                 
9                                                 
10                                                
<span class="org-keyword">trap</span> -- <span class="org-string">''</span> SIGINT                                 
<span class="org-keyword">trap</span> -- <span class="org-string">'echo "Press ctrl+c"'</span> SIGQUIT             
11                                                
12
^C13                                    
14                                      
15                                      
^C16                                    
17                                      
18                                      
19                                      
20                                      
<span class="org-keyword">trap</span> -- <span class="org-string">'echo "Press ctrl+c"'</span> SIGQUIT   
21                                      
22                                      
23                                      
^C                                      
</pre>
</div>

<p>
范例: 当脚本退出时，执行finish函数。退出可以是任何形式的退出
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 script40]#cat trap_exit.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-function-name">finish</span>(){
    <span class="org-builtin">echo</span> finish| tee -a /root/finish.log
}

<span class="org-keyword">trap</span> finish exit
<span class="org-keyword">while </span><span class="org-builtin">true</span> ;<span class="org-keyword">do</span>
    <span class="org-builtin">echo</span> running
    sleep 1
<span class="org-keyword">done</span>
</pre>
</div>

<p>
<b>范例：如何避免shell脚本被同时运行多次</b> 加入锁文件
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span><span class="org-variable-name">LOCK_NAME</span>=<span class="org-string">"/tmp/my.lock"</span>
<span class="org-keyword">if</span> ( <span class="org-builtin">set</span> -o noclobber; <span class="org-builtin">echo</span> <span class="org-string">"$$"</span> &gt; <span class="org-string">"$LOCK_NAME"</span>) 2&gt; /dev/null; <span class="org-keyword">then</span>
    <span class="org-keyword">trap</span> <span class="org-string">'rm -f "$LOCK_NAME"; exit $?'</span> INT TERM EXIT
    <span class="org-comment-delimiter">### </span><span class="org-comment">&#24320;&#22987;&#27491;&#24120;&#27969;&#31243;
</span>    <span class="org-comment-delimiter">### </span><span class="org-comment">&#27491;&#24120;&#27969;&#31243;&#32467;&#26463;
</span>
    <span class="org-comment-delimiter">### </span><span class="org-comment">Removing lock
</span>    rm -f $<span class="org-variable-name">LOCK_NAME</span>
    <span class="org-keyword">trap</span> - INT TERM EXIT
<span class="org-keyword">else</span>
    <span class="org-builtin">echo</span> <span class="org-string">"Failed to acquire lockfile: $LOCK_NAME."</span>
    <span class="org-builtin">echo</span> <span class="org-string">"Held by $(cat $LOCK_NAME)"</span>
    <span class="org-keyword">exit</span> 1
<span class="org-keyword">fi</span>

<span class="org-builtin">echo</span> <span class="org-string">"Done."</span>
</pre>
</div>

<ul class="org-ul">
<li>set -o noclobber 的意思：set -C 禁止将内容覆盖已有文件,但可追加这样
就能保证my.lock只能被一个进程创建出来。比touch靠谱多了。</li>
<li>trap 可以捕获各种信号，然后做出处理：</li>
<li>INT 用来处理 ctrl+c取消脚本执行的情况。</li>
<li>TERM 用来处理 kill -TERM pid 的情况。</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-创建临时文件-mktemp" class="outline-3">
<h3 id="创建临时文件-mktemp"><a href="#创建临时文件-mktemp">创建临时文件 mktemp</a></h3>
<div class="outline-text-3" id="text-创建临时文件-mktemp">
<p>
mktemp 命令用于创建并显示临时文件，可避免冲突
</p>

<p>
格式
</p>

<div class="org-src-container">
<pre class="src src-sh">mktemp [OPTION]... [TEMPLATE]
</pre>
</div>

<p>
说明：TEMPLATE: filenameXXX，X至少要出现三个
</p>

<p>
常见选项：
</p>
<ul class="org-ul">
<li>-d 创建临时目录</li>
<li>-p DIR或&#x2013;tmpdir=DIR 指明临时文件所存放目录位置</li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 data]#mktemp
/tmp/tmp.UogGCumh8C

mktemp /tmp/testXXX
<span class="org-variable-name">tmpdir</span>=<span class="org-sh-quoted-exec">`mktemp &#8211;d /tmp/testdirXXX`</span>
mktemp --tmpdir=/testdir testXXXXXX
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#cat /data/scripts/rm.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span>
<span class="org-variable-name">DIR</span>=<span class="org-sh-quoted-exec">`mktemp -d /tmp/trash-$(date +%F_%H-%M-%S)XXXXXX`</span>
mv $<span class="org-variable-name">*</span> $<span class="org-variable-name">DIR</span>
<span class="org-builtin">echo</span> $<span class="org-variable-name">*</span> is move to $<span class="org-variable-name">DIR</span>

[root@centos8 ~]#alias <span class="org-variable-name">rm</span>=/data/scripts/rm.sh
</pre>
</div>
</div>
</div>
<div id="outline-container-安装复制文件-install" class="outline-3">
<h3 id="安装复制文件-install"><a href="#安装复制文件-install">安装复制文件 install</a></h3>
<div class="outline-text-3" id="text-安装复制文件-install">
<p>
install 功能相当于cp，chmod，chown，chgrp 等相关工具的集合
</p>

<p>
更适合程序的复制
</p>

<p>
install命令格式：
</p>

<div class="org-src-container">
<pre class="src src-sh">install [OPTION]... [-T] SOURCE DEST &#21333;&#25991;&#20214;
install [OPTION]... SOURCE... DIRECTORY
install [OPTION]... -t DIRECTORY SOURCE...
install [OPTION]... -d DIRECTORY...&#21019;&#24314;&#31354;&#30446;&#24405;
</pre>
</div>

<p>
常用选项：
</p>
<pre class="example" id="org3ad2f37">
-m, --mode=MODE：设定目标文件权限，默认为755；
-o, --owner=OWNER：设定目标文件属主；
-g, --group=GROUP：设定目标文件属组；
-d : 创建目录
-D : 文件放到指定目录下，不存在则创建。注意引用
-p :    保留文件的原有时间戳， 也就是说文件的timestaamps 和 source 文件一样.        当我们想要利用安装文件的mtime来跟踪文件的build时间而不是 安装时间.
</pre>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">install -m 700 -o wang -g admins srcfile desfile
install &#8211;m 770 &#8211;d /testdir/installdir
[root@centos8 ~]#install -m 700 -o me -g daemon -d /data/testdir
[root@centos8 ~]#ll -d /data/testdir
drwx------ 2 me daemon 6 Apr 29 15:09 /data/testdir
</pre>
</div>
</div>
</div>
<div id="outline-container-交互式转化批处理工具-expect" class="outline-3">
<h3 id="交互式转化批处理工具-expect"><a href="#交互式转化批处理工具-expect">交互式转化批处理工具 expect</a></h3>
<div class="outline-text-3" id="text-交互式转化批处理工具-expect">
<p>
expect 是由Don Libes基于 Tcl( Tool Command Language )语言开发的，主要
应用于自动化交互式操作的场景，借助 expect处理交互的命令，可以将交互过
程如：ssh登录，ftp登录等写在一个脚本上，使之自动化完成。尤其适用于需要
对多台服务器执行相同操作的环境中，可以大大提高系统管理人员的工作效率
</p>

<div class="org-src-container">
<pre class="src src-sh">yum install expect  -y
</pre>
</div>

<p>
expect 语法：
</p>

<div class="org-src-container">
<pre class="src src-sh">expect [&#36873;&#39033;] [ -c cmds ] [ [ -[f|b] ] cmdfile ] [ args ]
</pre>
</div>

<p>
常见选项：
</p>
<pre class="example" id="org4264f4b">
-c：从命令行执行expect脚本，默认expect是交互地执行的
-d：可以输出输出调试信息
</pre>

<p>
示例： 屏幕上有回车就打印
</p>

<div class="org-src-container">
<pre class="src src-sh">expect  -c <span class="org-string">'expect "\n" {send "pressed enter\n"}'</span>
expect  -d ssh.exp
</pre>
</div>

<p>
expect中相关命令
</p>

<ul class="org-ul">
<li>spawn 启动新的进程</li>
<li>expect 从进程接收字符串</li>
<li>send 用于向进程发送字符串</li>
<li>interact 允许用户交互</li>
<li>exp_continue 匹配多个字符串在执行动作后加此命令</li>
</ul>

<p>
其它
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">&#21442;&#25968;&#21028;&#26029;
</span><span class="org-keyword">if</span> { $<span class="org-variable-name">argc</span> != 2 } {         
    send_user <span class="org-string">"usage: expect fenfa_sshkey.exp file host\n"</span>         
    <span class="org-keyword">exit</span>         
}


<span class="org-comment-delimiter"># </span><span class="org-comment">&#32467;&#26463;
</span>expect eof

<span class="org-comment-delimiter"># </span><span class="org-comment">&#36229;&#26102;
</span><span class="org-builtin">set</span> timeout 10   
<span class="org-comment-delimiter"># </span><span class="org-comment">&#36864;&#20986;&#21518;&#25552;&#31034;
</span><span class="org-keyword">exit</span> -onexit {  
     send_user <span class="org-string">"good bye !\n"</span>
}
</pre>
</div>

<p>
expect最常用的语法(tcl语言:模式-动作) 单一分支模式语法：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 test]#expect
expect1.1&gt; expect <span class="org-string">"hi"</span> {send <span class="org-string">"You said hi\n"</span>}
hahahixixi
You said hi
</pre>
</div>

<p>
匹配到hi后，会输出”you said hi”，并换行
</p>

<p>
多分支模式语法：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 test]#expect
expect1.1&gt; expect <span class="org-string">"hi"</span> { send <span class="org-string">"You said hi\n"</span> } <span class="org-string">"hehe"</span> { send <span class="org-string">"Hehe yourself\n"</span>
} <span class="org-string">"bye"</span> { send <span class="org-string">"Good bye\n"</span> }
hehe
Hehe yourself
expect1.2&gt; expect <span class="org-string">"hi"</span> { send <span class="org-string">"You said hi\n"</span> } <span class="org-string">"hehe"</span> { send <span class="org-string">"Hehe yourself\n"</span>
} <span class="org-string">"bye"</span> { send <span class="org-string">"Good bye\n"</span> }
<span class="org-keyword">bye</span>
Good bye
expect1.3&gt; expect <span class="org-string">"hi"</span> { send <span class="org-string">"You said hi\n"</span> } <span class="org-string">"hehe"</span> { send <span class="org-string">"Hehe yourself\n"</span>
} <span class="org-string">"bye"</span> { send <span class="org-string">"Good bye\n"</span> }
hi
You said hi
expect1.4&gt;
</pre>
</div>

<p>
匹配hi,hello,bye任意字符串时，执行相应输出。等同如下：
</p>

<div class="org-src-container">
<pre class="src src-sh">expect {
<span class="org-string">"hi"</span> { send <span class="org-string">"You said hi\n"</span>}
<span class="org-string">"hehe"</span> { send <span class="org-string">"Hehe yourself\n"</span>}
<span class="org-string">"bye"</span> { send <span class="org-string">" Good bye\n"</span>}
}
[root@centos8 ~]#expect
expect1.1&gt; expect {
+&gt; <span class="org-string">"hi"</span> { send <span class="org-string">"You said hi\n"</span>}
+&gt; <span class="org-string">"hehe"</span> { send <span class="org-string">"Hehe yourself\n"</span>}
+&gt; <span class="org-string">"bye"</span> { send <span class="org-string">" Good bye\n"</span>}
+&gt; }
<span class="org-keyword">bye</span>
  Good bye
expect1.2&gt;
</pre>
</div>

<ul class="org-ul">
<li>spawn 启动新的进程</li>

<li>expect 从进程接收字符串</li>

<li>send 用于向进程发送字符串</li>

<li><p>
exp_continue 匹配多个字符串在执行动作后加此命令 范例1：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/</span><span class="org-keyword">expect</span><span class="org-comment">
</span>spawn scp /etc/fstab 10.0.0.7:/data
expect {
 <span class="org-string">"yes/no"</span> { send <span class="org-string">"yes\n"</span>;exp_continue }
 <span class="org-string">"password"</span> { send <span class="org-string">"me\n"</span> }
}
expect eof
</pre>
</div></li>
</ul>

<p>
范例2：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/</span><span class="org-keyword">expect</span><span class="org-comment">
</span>spawn ssh 10.0.0.7
expect {
   <span class="org-string">"yes/no"</span> { send <span class="org-string">"yes\n"</span>;exp_continue }
   <span class="org-string">"password"</span> { send <span class="org-string">"me\n"</span> }
}
interact
</pre>
</div>

<p>
范例3：expect 变量
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/</span><span class="org-keyword">expect</span><span class="org-comment">
</span><span class="org-builtin">set</span> ip 10.0.0.7  <span class="org-comment-delimiter">#</span><span class="org-comment">&#30456;&#24403;&#20110;bash&#20013;&#30340;ip=10.0.0.7
</span><span class="org-builtin">set</span> user root
<span class="org-builtin">set</span> password me
<span class="org-builtin">set</span> timeout 10
spawn ssh $<span class="org-variable-name">user</span>@$<span class="org-variable-name">ip</span>
expect {
   <span class="org-string">"yes/no"</span> { send <span class="org-string">"yes\n"</span>;exp_continue }
   <span class="org-string">"password"</span> { send <span class="org-string">"$password\n"</span> }
}
interact
</pre>
</div>

<p>
范例4：expect 位置参数
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 scripts]#cat expect4
<span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/expect
</span><span class="org-builtin">set</span> ip [lindex $<span class="org-variable-name">argv</span> 0]
<span class="org-builtin">set</span> user [lindex $<span class="org-variable-name">argv</span> 1]
<span class="org-builtin">set</span> password [lindex $<span class="org-variable-name">argv</span> 2]
spawn ssh $<span class="org-variable-name">user</span>@$<span class="org-variable-name">ip</span>
expect {
   <span class="org-string">"yes/no"</span> { send <span class="org-string">"yes\n"</span>;exp_continue }
   <span class="org-string">"password"</span> { send <span class="org-string">"$password\n"</span> }
}
interact

[root@centos8 scripts]#./expect4 10.0.0.7 root me
spawn ssh root@10.0.0.7
root@10.0.0.7<span class="org-string">'s password:
Last login: Wed Apr 29 15:34:14 2020 from 10.0.0.8
[root@centos7 ~]#exit
logout
Connection to 10.0.0.7 closed.</span>
</pre>
</div>

<p>
范例5：expect 执行多个命令
登录服务器后，发现有]#字符执行命令添加用户密码并退出登录
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/</span><span class="org-keyword">expect</span><span class="org-comment">
</span><span class="org-builtin">set</span> ip [lindex $<span class="org-variable-name">argv</span> 0]
<span class="org-builtin">set</span> user [lindex $<span class="org-variable-name">argv</span> 1]
<span class="org-builtin">set</span> password [lindex $<span class="org-variable-name">argv</span> 2]
<span class="org-builtin">set</span> timeout 10
spawn ssh $<span class="org-variable-name">user</span>@$<span class="org-variable-name">ip</span>
expect {
   <span class="org-string">"yes/no"</span> { send <span class="org-string">"yes\n"</span>;exp_continue }
   <span class="org-string">"password"</span> { send <span class="org-string">"$password\n"</span> }
}
expect <span class="org-string">"]#"</span> { send <span class="org-string">"useradd haha\n"</span> }
expect <span class="org-string">"]#"</span> { send <span class="org-string">"echo me |passwd --stdin haha\n"</span> }
send <span class="org-string">"exit\n"</span>
expect eof
<span class="org-comment-delimiter">#</span><span class="org-comment">./ssh4.exp 10.0.0.7 root me</span>
</pre>
</div>

<p>
范例6：shell脚本调用expect 用多行重定向在bash中调用expect
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span><span class="org-variable-name">ip</span>=$<span class="org-variable-name">1</span>
<span class="org-variable-name">user</span>=$<span class="org-variable-name">2</span>
<span class="org-variable-name">password</span>=$<span class="org-variable-name">3</span>
expect &lt;&lt;EOF<span class="org-sh-heredoc">
set timeout 20
spawn ssh $user@$ip
expect {
   "yes/no" { send "yes\n";exp_continue }
   "password" { send "$password\n" }
}
expect "]#" { send "useradd hehe\n" }
expect "]#" { send "echo me |passwd --stdin hehe\n" }
expect "]#" { send "exit\n" }
expect eof
EOF
</span><span class="org-comment-delimiter">#</span><span class="org-comment">./ssh5.sh 192.168.8.10 root me</span>
</pre>
</div>

<p>
范例7: shell脚本利用循环调用expect在CentOS和Ubuntu上批量创建用户
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span>
<span class="org-variable-name">NET</span>=10.0.0
<span class="org-variable-name">user</span>=root
<span class="org-variable-name">password</span>=me

<span class="org-keyword">for</span> ID<span class="org-keyword"> in</span> 6 7 111;<span class="org-keyword">do</span>
<span class="org-variable-name">ip</span>=$<span class="org-variable-name">NET</span>.$<span class="org-variable-name">ID</span>

expect &lt;&lt;EOF<span class="org-sh-heredoc">
set timeout 20
spawn ssh $user@$ip
expect {
    "yes/no" { send "yes\n";exp_continue }
    "password" { send "$password\n" }
}
expect "#" { send "useradd test\n" }
expect "#" { send "exit\n" }
expect eof
EOF
</span><span class="org-keyword">done</span>
</pre>
</div>

<p>
范例：批量在多机上执行命令
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 scripts]#cat expect8.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span>
<span class="org-variable-name">NET</span>=10.0.0
<span class="org-variable-name">user</span>=root
<span class="org-variable-name">password</span>=centos

<span class="org-keyword">for</span> ID<span class="org-keyword"> in</span> 202 204 ;<span class="org-keyword">do</span>
<span class="org-variable-name">ip</span>=$<span class="org-variable-name">NET</span>.$<span class="org-variable-name">ID</span>

expect &lt;&lt;EOF &amp;&gt; /dev/null   <span class="org-comment-delimiter">#</span><span class="org-comment">&#25110;&#32773; expect &amp;&gt; /dev/null &lt;&lt;EO</span><span class="org-comment-delimiter">F</span><span class="org-sh-heredoc">
set timeout 20
spawn ssh $user@$ip
expect {
    "yes/no" { send "yes\n";exp_continue }
    "password" { send "$password\n" }
}
expect "#" { send "sed -i 's/^SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config\n" }
expect "#" { send "setenforce 0\n" }
expect "#" { send "exit\n" }
expect eof
EOF
done</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-脚本添加二进制文件" class="outline-3">
<h3 id="脚本添加二进制文件"><a href="#脚本添加二进制文件">脚本添加二进制文件</a></h3>
<div class="outline-text-3" id="text-脚本添加二进制文件">
<p>
*思路：*将二进制可执行程序添加到shell 末尾，运行shell时，在将该二进制
可执行程序导出来，然后执行导出的二进制程序。
</p>

<p>
准备脚本
</p>

<div class="org-src-container">
<pre class="src src-sh">cat &lt;&lt;\EOF &gt; test.sh<span class="org-sh-heredoc">
#!/bin/bash
prog_name="./extract.$$"

pre_install() {
    echo "&#20934;&#22791;&#23433;&#35013;&#29615;&#22659;&#65288;&#30053;&#65289;..."
    rm -fr ./install.tmp.$$
    mkdir ./install.tmp.$$
}

check_sum() {
    :
}

extract() {
    echo "&#20174;&#33050;&#26412;&#20013;&#25552;&#21462;&#25991;&#20214;"
    line_number=`awk '/^__BIN_FILE_BEGIN__/ {print NR + 1; exit 0; }' "$0"`    
    tail -n +$line_number "$0" &gt;./install.tmp.$$/${prog_name}
}

install() {
    echo "&#23433;&#35013;&#20013;..."
    chmod u+x ./install.tmp.$$/${prog_name}
    ./install.tmp.$$/${prog_name}
}

post_install() {
    echo "&#37197;&#32622;&#20013;..." 
    echo "&#28165;&#29702;&#20020;&#26102;&#25991;&#20214;"
    rm -rf install.tmp.$$
}

main()
{
    pre_install
    extract
    check_sum
    install
    post_install
    exit 0
}

main
#&#36825;&#34892;&#19979;&#38754;&#25509;&#20108;&#36827;&#21046;&#25991;&#20214;
__BIN_FILE_BEGIN__
EOF</span>
</pre>
</div>

<p>
简易
</p>

<div class="org-src-container">
<pre class="src src-sh">cat &lt;&lt;\EOF &gt; test.sh<span class="org-sh-heredoc">
#!/bin/bash
prog_name="./extract.$$"

main()
{
    rm -fr ./install.tmp.$$
    mkdir ./install.tmp.$$
    line_number=`awk '/^__BIN_FILE_BEGIN__/ {print NR + 1; exit 0; }' "$0"`    
    tail -n +$line_number "$0" &gt;./install.tmp.$$/${prog_name}
    chmod u+x ./install.tmp.$$/${prog_name}
    ./install.tmp.$$/${prog_name}
    rm -rf install.tmp.$$
    exit 0
}

main

__BIN_FILE_BEGIN__
EOF</span>
</pre>
</div>

<p>
将二进制可执行程序 /bin/date 嵌入到该shell 脚本中
</p>

<div class="org-src-container">
<pre class="src src-sh">cat /bin/date  &gt;&gt; test.sh  
</pre>
</div>

<p>
运行：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">bash test.sh
</span>&#20934;&#22791;&#23433;&#35013;&#29615;&#22659;&#65288;&#30053;&#65289;...
&#20174;&#33050;&#26412;&#20013;&#25552;&#21462;&#25991;&#20214;
&#23433;&#35013;&#20013;...
Wed Mar  3 00:07:20 CST 2021
&#37197;&#32622;&#20013;...
&#28165;&#29702;&#20020;&#26102;&#25991;&#20214;
</pre>
</div>
</div>
</div>
<div id="outline-container-脚本转二进制执行文件" class="outline-3">
<h3 id="脚本转二进制执行文件"><a href="#脚本转二进制执行文件">脚本转二进制执行文件</a></h3>
<div class="outline-text-3" id="text-脚本转二进制执行文件">
<p>
如脚本中有些密码不愿被看到或被随意修改，这时就需要shc进行加密了
</p>

<p>
<b>方法1：shc</b>
</p>

<p>
官方下载网站： <a href="http://www.datsi.fi.upm.es/~frosal/">http://www.datsi.fi.upm.es/~frosal/</a>
</p>

<div class="org-src-container">
<pre class="src src-sh">wget http://www.datsi.fi.upm.es/~frosal/sources/shc-3.8.9b.tgz
tar zxvf shc-3.8.9b.tgz 
<span class="org-builtin">cd</span> shc-3.8.9b
mkdir -p /usr/local/man/man1/
make install

cp shc /usr/local/bin/
</pre>
</div>

<p>
选项：
</p>

<div class="org-src-container">
<pre class="src src-sh">-e date &#65288;&#25351;&#23450;&#36807;&#26399;&#26085;&#26399;&#65289;&#22914;<span class="org-string">"4/3/2020"</span>
-m message &#65288;&#25351;&#23450;&#36807;&#26399;&#25552;&#31034;&#30340;&#20449;&#24687;&#65289; 
-f script_name&#65288;&#25351;&#23450;&#35201;&#32534;&#35793;&#30340;shell&#30340;&#36335;&#24452;&#21450;&#25991;&#20214;&#21517;&#65289;
-r Relax security. &#65288;&#21487;&#20197;&#30456;&#21516;&#25805;&#20316;&#31995;&#32479;&#30340;&#19981;&#21516;&#31995;&#32479;&#20013;&#25191;&#34892;&#65289;
-T  &#20801;&#35768;&#20108;&#36827;&#21046;&#25991;&#20214;&#21487;&#36319;&#36394;
-v Verbose compilation&#65288;&#32534;&#35793;&#30340;&#35814;&#32454;&#24773;&#20917;&#65289;
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">shc -T -r -f test.sh

test.sh.x &#26159;&#21152;&#23494;&#21518;&#30340;&#20108;&#36827;&#21046;&#25191;&#34892;&#25991;&#20214;
test.sh.c &#26159;&#33050;&#26412;&#36716;&#21270;&#21518;C&#28304;&#30721;&#25991;&#20214;
</pre>
</div>

<p>
注意
</p>

<div class="org-src-container">
<pre class="src src-sh">&#33050;&#26412;&#31532;&#19968;&#34892;&#20889;&#30528;#!/usr/bin/env bash,&#20351;&#29992;shc &#21152;&#23494;&#24037;&#20855;&#20250;&#20986;&#29616;&#25253;&#38169;&#12290;
&#35299;&#20915;&#26041;&#27861;&#26159;&#25226;&#23427;&#26367;&#25442;&#25104; <span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/bash &#25110;&#21017; #!/bin/bash &#21363;&#21487;</span>
</pre>
</div>

<p>
<b>方法2 gzexe</b> gzexe命令即可隐藏shell源码
</p>

<div class="org-src-container">
<pre class="src src-sh">gzexe xxx.sh
&#29983;&#25104;&#21152;&#23494;&#21518;&#30340;&#33050;&#26412;xxx.sh&#21644;shell&#28304;&#30721;xxx.sh~
</pre>
</div>

<p>
缺点：gzexe可以直接转换明文。
</p>

<div class="org-src-container">
<pre class="src src-sh">gzexe -d xxx.sh
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-数组array" class="outline-2">
<h2 id="数组array"><a href="#数组array">数组array</a></h2>
<div class="outline-text-2" id="text-数组array">
</div>
<div id="outline-container-数组介绍" class="outline-3">
<h3 id="数组介绍"><a href="#数组介绍">数组介绍</a></h3>
<div class="outline-text-3" id="text-数组介绍">
<p>
变量：存储单个元素的内存空间
</p>

<p>
数组：存储多个元素的连续的内存空间，相当于多个变量的集合
</p>

<p>
数组名和索引
</p>

<ul class="org-ul">
<li>索引的编号从0开始，属于数值索引</li>
<li>索引可支持使用自定义的格式，而不仅是数值格式，即为关联索引，bash4.0
版本之后开始支持</li>
<li>bash的数组支持稀疏格式(索引编号不连续)</li>
</ul>
</div>
</div>
<div id="outline-container-声明数组" class="outline-3">
<h3 id="声明数组"><a href="#声明数组">声明数组</a></h3>
<div class="outline-text-3" id="text-声明数组">
<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#26222;&#36890;&#25968;&#32452;&#21487;&#20197;&#19981;&#20107;&#20808;&#22768;&#26126;,&#30452;&#25509;&#20351;&#29992;
</span><span class="org-builtin">declare</span> -a ARRAY_NAME
<span class="org-comment-delimiter">#</span><span class="org-comment">&#20851;&#32852;&#25968;&#32452;&#24517;&#39035;&#20808;&#22768;&#26126;,&#20877;&#20351;&#29992;&#65292;&#19979;&#26631;&#21487;&#20197;&#26159;&#20219;&#24847;&#26684;&#24335;
</span><span class="org-builtin">declare</span> -A ARRAY_NAME
</pre>
</div>

<p>
注意：两者不可相互转换
</p>
</div>
</div>
<div id="outline-container-数组赋值" class="outline-3">
<h3 id="数组赋值"><a href="#数组赋值">数组赋值</a></h3>
<div class="outline-text-3" id="text-数组赋值">
<p>
数组元素的赋值
</p>

<p>
(1) 一次只赋值一个元素
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">ARRAY_NAME</span>[INDEX]=VALUE
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">weekdays</span>[0]=<span class="org-string">"Sunday"</span>
<span class="org-variable-name">weekdays</span>[4]=<span class="org-string">"Thursday"</span>
</pre>
</div>

<p>
(2) 一次赋值全部元素
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">ARRAY_NAME</span>=(<span class="org-string">"VAL1"</span> <span class="org-string">"VAL2"</span> <span class="org-string">"VAL3"</span> ...)
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">title</span>=(<span class="org-string">"ceo"</span> <span class="org-string">"coo"</span> <span class="org-string">"cto"</span>)
<span class="org-variable-name">num</span>=({0..10})
<span class="org-variable-name">alpha</span>=({a..g})
<span class="org-variable-name">file</span>=( *.sh )


<span class="org-variable-name">commands</span>=()
<span class="org-variable-name">commands</span>+=(<span class="org-string">"annotate"</span>)
<span class="org-variable-name">commands</span>+=(<span class="org-string">"api-resources"</span>)
<span class="org-variable-name">commands</span>+=(<span class="org-string">"api-versions"</span>)
</pre>
</div>

<p>
(3) 只赋值特定元素
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">ARRAY_NAME</span>=([0]=<span class="org-string">"VAL1"</span> [3]=<span class="org-string">"VAL2"</span> ...)
</pre>
</div>

<p>
(4) 交互式数组值对赋值
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">read</span> -a ARRAY
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#declare -A course
[root@centos8 ~]#declare -a course
-bash: declare: course: cannot convert associative to indexed array
[root@centos8 ~]#<span class="org-variable-name">file</span>=( *.sh )
[root@centos8 ~]#declare -A file
-bash: declare: file: cannot convert indexed to associative array
</pre>
</div>
</div>
</div>
<div id="outline-container-显示所有数组" class="outline-3">
<h3 id="显示所有数组"><a href="#显示所有数组">显示所有数组</a></h3>
<div class="outline-text-3" id="text-显示所有数组">
<p>
显示所有数组：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">declare</span> -a
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#declare -a
<span class="org-builtin">declare</span> -a <span class="org-variable-name">BASH_ARGC</span>=()
<span class="org-builtin">declare</span> -a <span class="org-variable-name">BASH_ARGV</span>=()
<span class="org-builtin">declare</span> -a <span class="org-variable-name">BASH_COMPLETION_VERSINFO</span>=([0]=<span class="org-string">"2"</span> [1]=<span class="org-string">"7"</span>)
<span class="org-builtin">declare</span> -a <span class="org-variable-name">BASH_LINENO</span>=()
<span class="org-builtin">declare</span> -ar <span class="org-variable-name">BASH_REMATCH</span>=()
<span class="org-builtin">declare</span> -a <span class="org-variable-name">BASH_SOURCE</span>=()
<span class="org-builtin">declare</span> -ar <span class="org-variable-name">BASH_VERSINFO</span>=([0]=<span class="org-string">"4"</span> [1]=<span class="org-string">"4"</span> [2]=<span class="org-string">"19"</span> [3]=<span class="org-string">"1"</span> [4]=<span class="org-string">"release"</span>
[5]=<span class="org-string">"x86_64-redhat-linux-gnu"</span>)
<span class="org-builtin">declare</span> -a <span class="org-variable-name">DIRSTACK</span>=()
<span class="org-builtin">declare</span> -a FUNCNAME
<span class="org-builtin">declare</span> -a <span class="org-variable-name">GROUPS</span>=()
<span class="org-builtin">declare</span> -a <span class="org-variable-name">PIPESTATUS</span>=([0]=<span class="org-string">"0"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-引用数组" class="outline-3">
<h3 id="引用数组"><a href="#引用数组">引用数组</a></h3>
<div class="outline-text-3" id="text-引用数组">
<p>
<b>引用数组元素</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">${<span class="org-variable-name">ARRAY_NAME</span>[INDEX]}
<span class="org-comment-delimiter">#</span><span class="org-comment">&#22914;&#26524;&#30465;&#30053;[INDEX]&#34920;&#31034;&#24341;&#29992;&#19979;&#26631;&#20026;0&#30340;&#20803;&#32032;</span>
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#declare -a <span class="org-variable-name">title</span>=([0]=<span class="org-string">"ceo"</span> [1]=<span class="org-string">"coo"</span> [2]=<span class="org-string">"cto"</span>)
[root@centos8 ~]#echo ${<span class="org-variable-name">title</span>[1]}
coo
[root@centos8 ~]#echo ${<span class="org-variable-name">title</span>}
ceo
[root@centos8 ~]#echo ${<span class="org-variable-name">title</span>[2]}
cto
[root@centos8 ~]#echo ${<span class="org-variable-name">title</span>[3]}
</pre>
</div>

<p>
<b>引用数组所有元素</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">${<span class="org-variable-name">ARRAY_NAME</span>[*]}
${<span class="org-variable-name">ARRAY_NAME</span>[@]}
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#echo ${<span class="org-variable-name">title</span>[@]}
ceo coo cto
[root@centos8 ~]#echo ${<span class="org-variable-name">title</span>[*]}
ceo coo cto
</pre>
</div>

<p>
<b>数组的长度，即数组中元素的个数</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">${#<span class="org-variable-name">ARRAY_NAME</span>[*]}
${#<span class="org-variable-name">ARRAY_NAME</span>[@]}
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#echo ${#<span class="org-variable-name">title</span>[*]}
3
</pre>
</div>
</div>
</div>
<div id="outline-container-删除数组" class="outline-3">
<h3 id="删除数组"><a href="#删除数组">删除数组</a></h3>
<div class="outline-text-3" id="text-删除数组">
<p>
删除数组中的某元素，会导致稀疏格式
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">unset</span> ARRAY[INDEX]
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#echo ${<span class="org-variable-name">title</span>[*]}
ceo coo cto
[root@centos8 ~]#unset title[1]
[root@centos8 ~]#echo ${<span class="org-variable-name">title</span>[*]}
ceo cto
</pre>
</div>

<p>
删除整个数组
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">unset</span> ARRAY
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#unset title
[root@centos8 ~]#echo ${<span class="org-variable-name">title</span>[*]}
[root@centos8 ~]#
</pre>
</div>
</div>
</div>
<div id="outline-container-数组数据处理" class="outline-3">
<h3 id="数组数据处理"><a href="#数组数据处理">数组数据处理</a></h3>
<div class="outline-text-3" id="text-数组数据处理">
<p>
数组切片：
</p>

<div class="org-src-container">
<pre class="src src-sh">${<span class="org-variable-name">ARRAY</span>[@]:offset:number}
offset <span class="org-comment-delimiter">#</span><span class="org-comment">&#35201;&#36339;&#36807;&#30340;&#20803;&#32032;&#20010;&#25968;
</span>number <span class="org-comment-delimiter">#</span><span class="org-comment">&#35201;&#21462;&#20986;&#30340;&#20803;&#32032;&#20010;&#25968;
</span><span class="org-comment-delimiter">#</span><span class="org-comment">&#21462;&#20559;&#31227;&#37327;&#20043;&#21518;&#30340;&#25152;&#26377;&#20803;&#32032;
</span>{ARRAY[@]:offset}
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#<span class="org-variable-name">num</span>=({0..10})
[root@centos8 ~]#echo ${<span class="org-variable-name">num</span>[*]:2:3}
2 3 4
[root@centos8 ~]#echo ${<span class="org-variable-name">num</span>[*]:6}
6 7 8 9 10
</pre>
</div>

<p>
<b>向数组中追加元素：</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">ARRAY</span>[${#<span class="org-variable-name">ARRAY</span>[*]}]=value
<span class="org-variable-name">ARRAY</span>[${#<span class="org-variable-name">ARRAY</span>[@]}]=value
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#<span class="org-variable-name">num</span>[${#<span class="org-variable-name">num</span>[@]}]=11
[root@centos8 ~]#echo ${#<span class="org-variable-name">num</span>[@]}
12
[root@centos8 ~]#echo ${<span class="org-variable-name">num</span>[@]}
0 1 2 3 4 5 6 7 8 9 10 11
</pre>
</div>
</div>
</div>
<div id="outline-container-关联数组" class="outline-3">
<h3 id="关联数组"><a href="#关联数组">关联数组</a></h3>
<div class="outline-text-3" id="text-关联数组">
<p>
类似于python字典，go的m
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">declare</span> -A ARRAY_NAME
<span class="org-variable-name">ARRAY_NAME</span>=([idx_name1]=<span class="org-string">'val1'</span> [idx_name2]=<span class="org-string">'val2'</span>...)
</pre>
</div>

<p>
注意：关联数组必须先声明再调用
</p>

<p>
<b>取出关联数组的key(下标)和value</b>
</p>

<p>
<code>${!ARRAY_NAME[@]}</code>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">declare</span> -A str
<span class="org-variable-name">str</span>[<span class="org-string">'key1'</span>]=value1
<span class="org-variable-name">str</span>[<span class="org-string">'key2'</span>]=value2
[root@middle-ware ~] <span class="org-variable-name">eth0</span> = 10.0.1.86
<span class="org-comment-delimiter"># </span><span class="org-comment">for k in "${!str[@]}"; do echo -e "key: $k \nvalue: ${str[$k]}"; done
</span>key: key2 
value: value2
key: key1 
value: value1
</pre>
</div>

<p>
范例:关联数组必须先声明再调用
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#<span class="org-variable-name">name</span>[ceo]=me
[root@centos8 ~]#<span class="org-variable-name">name</span>[cto]=wang
[root@centos8 ~]#<span class="org-variable-name">name</span>[coo]=zhang
[root@centos8 ~]#echo ${<span class="org-variable-name">name</span>[ceo]}
zhang
[root@centos8 ~]#echo ${<span class="org-variable-name">name</span>[cto]}
zhang
[root@centos8 ~]#echo ${<span class="org-variable-name">name</span>[coo]}
zhang
[root@centos8 ~]#echo ${<span class="org-variable-name">name</span>}
zhang
[root@centos8 ~]#declare -A name
-bash: declare: name: cannot convert indexed to associative array
<span class="org-comment-delimiter">#</span><span class="org-comment">&#19978;&#38754;&#26159;&#26222;&#36890;&#25968;&#32452;&#65292;&#20851;&#32852;&#25968;&#32452;&#24517;&#39035;&#20808;&#22768;&#26126;&#20877;&#35843;&#29992;
</span>
<span class="org-builtin">unset</span> name
<span class="org-builtin">declare</span> -A name
<span class="org-variable-name">name</span>[ceo]=me
<span class="org-variable-name">name</span>[cto]=wang
<span class="org-variable-name">name</span>[coo]=zhang
[root@centos8 ~]#echo ${<span class="org-variable-name">name</span>[coo]}
zhang
[root@centos8 ~]#echo ${<span class="org-variable-name">name</span>[ceo]}
me
[root@centos8 ~]#echo ${<span class="org-variable-name">name</span>[cto]}
wang
[root@centos8 ~]#echo ${<span class="org-variable-name">name</span>[*]}
me wang zhang
</pre>
</div>

<p>
范例：关联数组
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">declare</span> -A student
<span class="org-variable-name">student</span>[name1]=lijun
<span class="org-variable-name">student</span>[name2]=ziqing
<span class="org-variable-name">student</span>[age1]=18
<span class="org-variable-name">student</span>[age2]=16
<span class="org-variable-name">student</span>[gender1]=m
<span class="org-variable-name">student</span>[city1]=nanjing
<span class="org-variable-name">student</span>[gender2]=f
<span class="org-variable-name">student</span>[city2]=anhui
<span class="org-variable-name">student</span>[gender2]=m
<span class="org-variable-name">student</span>[name50]=alice
<span class="org-variable-name">student</span>[name3]=tom
[root@centos8 ~]#for i<span class="org-keyword"> in</span> {1..50};<span class="org-keyword">do </span><span class="org-builtin">echo</span> <span class="org-variable-name">student</span>[name$<span class="org-variable-name">i</span>]=${<span class="org-variable-name">student</span>[name$<span class="org-variable-name">i</span>]};<span class="org-keyword">done</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-范例" class="outline-3">
<h3 id="范例"><a href="#范例">范例</a></h3>
<div class="outline-text-3" id="text-范例">
<p>
范例：生成10个随机数保存于数组中，并找出其最大值和最小值
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span><span class="org-builtin">declare</span> -i min max
<span class="org-builtin">declare</span> -a nums
<span class="org-keyword">for</span> ((<span class="org-variable-name">i</span>=0;i&lt;10;i++));<span class="org-keyword">do</span>
<span class="org-variable-name">nums</span>[$<span class="org-variable-name">i</span>]=$<span class="org-variable-name">RANDOM</span>
[ $<span class="org-variable-name">i</span> -eq 0 ] &amp;&amp; <span class="org-variable-name">min</span>=${<span class="org-variable-name">nums</span>[0]} &amp;&amp;  <span class="org-variable-name">max</span>=${<span class="org-variable-name">nums</span>[0]}&amp;&amp; <span class="org-keyword">continue</span>
[ ${<span class="org-variable-name">nums</span>[$<span class="org-variable-name">i</span>]} -gt $<span class="org-variable-name">max</span> ] &amp;&amp; <span class="org-variable-name">max</span>=${<span class="org-variable-name">nums</span>[$<span class="org-variable-name">i</span>]}
[ ${<span class="org-variable-name">nums</span>[$<span class="org-variable-name">i</span>]} -lt $<span class="org-variable-name">min</span> ] &amp;&amp; <span class="org-variable-name">min</span>=${<span class="org-variable-name">nums</span>[$<span class="org-variable-name">i</span>]}
<span class="org-keyword">done</span>
<span class="org-builtin">echo</span> <span class="org-string">"All numbers are ${nums[*]}"</span>
<span class="org-builtin">echo</span> Max is $<span class="org-variable-name">max</span>
<span class="org-builtin">echo</span> Min is $<span class="org-variable-name">min</span>
</pre>
</div>

<p>
范例：编写脚本，定义一个数组，数组中的元素对应的值是/var/log目录下所有
以.log结尾的文件；统计出其下标为偶数的文件中的行数之和
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-builtin">declare</span> -a files
<span class="org-variable-name">files</span>=(/var/log/*.log)
<span class="org-builtin">declare</span> -i <span class="org-variable-name">lines</span>=0
<span class="org-keyword">for</span> i<span class="org-keyword"> in</span> $(seq 0 $[${#<span class="org-variable-name">files</span>[*]}-1]); <span class="org-keyword">do</span>
  <span class="org-keyword">if</span> [ $[$<span class="org-variable-name">i</span>%2] -eq 0 ];<span class="org-keyword">then</span>
<span class="org-builtin">let</span> <span class="org-variable-name">lines</span>+=$(wc -l ${<span class="org-variable-name">files</span>[$<span class="org-variable-name">i</span>]} | cut -d<span class="org-string">' '</span> -f1)
  <span class="org-keyword">fi</span>
<span class="org-keyword">done</span>
<span class="org-builtin">echo</span> <span class="org-string">"Lines: $lines"</span>
</pre>
</div>

<p>
动动手
</p>

<ol class="org-ol">
<li>输入若干个数值存入数组中，采用冒泡算法进行升序或降序排序</li>
<li>将下图所示，实现转置矩阵 matrix.sh 1 2 3 1 4 7 4 5 6 ===&gt; 2 5 8 7 8
9 3 6 9</li>
<li>打印杨辉三角形</li>
</ol>
</div>
</div>
</section>
<section id="outline-container-字符串处理" class="outline-2">
<h2 id="字符串处理"><a href="#字符串处理">字符串处理</a></h2>
<div class="outline-text-2" id="text-字符串处理">
</div>
<div id="outline-container-字符串切片" class="outline-3">
<h3 id="字符串切片"><a href="#字符串切片">字符串切片</a></h3>
<div class="outline-text-3" id="text-字符串切片">
<p>
<b>基于偏移量取字符串</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#36820;&#22238;&#23383;&#31526;&#20018;&#21464;&#37327;var&#30340;&#38271;&#24230;
</span>${#<span class="org-variable-name">var</span>}

<span class="org-comment-delimiter">#</span><span class="org-comment">&#36820;&#22238;&#23383;&#31526;&#20018;&#21464;&#37327;var&#20013;&#20174;&#31532;offset&#20010;&#23383;&#31526;&#21518;(&#19981;&#21253;&#25324;&#31532;offset&#20010;&#23383;&#31526;)&#30340;&#23383;&#31526;&#24320;&#22987;&#65292;&#21040;&#26368;&#21518;&#30340;&#37096;&#20998;&#65292;offset&#30340;&#21462;&#20540;&#22312;0 &#21040; ${#var}-1 &#20043;&#38388;(bash4.2&#21518;&#65292;&#20801;&#35768;&#20026;&#36127;&#20540;)
</span>${<span class="org-variable-name">var</span>:offset}

<span class="org-comment-delimiter">#</span><span class="org-comment">&#36820;&#22238;&#23383;&#31526;&#20018;&#21464;&#37327;var&#20013;&#20174;&#31532;offset&#20010;&#23383;&#31526;&#21518;(&#19981;&#21253;&#25324;&#31532;offset&#20010;&#23383;&#31526;)&#30340;&#23383;&#31526;&#24320;&#22987;&#65292;&#38271;&#24230;&#20026;number&#30340;&#37096;&#20998;
</span>${<span class="org-variable-name">var</span>:offset:number}

<span class="org-comment-delimiter">#</span><span class="org-comment">&#21462;&#23383;&#31526;&#20018;&#30340;&#26368;&#21491;&#20391;&#20960;&#20010;&#23383;&#31526;,&#21462;&#23383;&#31526;&#20018;&#30340;&#26368;&#21491;&#20391;&#20960;&#20010;&#23383;&#31526;, &#27880;&#24847;&#65306;&#20882;&#21495;&#21518;&#24517;&#39035;&#26377;&#19968;&#31354;&#30333;&#23383;&#31526;
</span>${<span class="org-variable-name">var</span>: -length}

<span class="org-comment-delimiter">#</span><span class="org-comment">&#20174;&#26368;&#24038;&#20391;&#36339;&#36807;offset&#23383;&#31526;&#65292;&#19968;&#30452;&#21521;&#21491;&#21462;&#21040;&#36317;&#31163;&#26368;&#21491;&#20391;lengh&#20010;&#23383;&#31526;&#20043;&#21069;&#30340;&#20869;&#23481;,&#21363;:&#25488;&#22836;&#21435;&#23614;
</span>${<span class="org-variable-name">var</span>:offset:-length}

<span class="org-comment-delimiter">#</span><span class="org-comment">&#20808;&#20174;&#26368;&#21491;&#20391;&#21521;&#24038;&#21462;&#21040;length&#20010;&#23383;&#31526;&#24320;&#22987;&#65292;&#20877;&#21521;&#21491;&#21462;&#21040;&#36317;&#31163;&#26368;&#21491;&#20391;offset&#20010;&#23383;&#31526;&#20043;&#38388;&#30340;&#20869;&#23481;,&#27880;&#24847;&#65306;-length&#21069;&#31354;&#26684;
</span>${<span class="org-variable-name">var</span>: -length:-offset}
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">tr</span>=abcdef&#25105;&#20320;&#20182;
<span class="org-builtin">echo</span> ${#<span class="org-variable-name">str</span>} <span class="org-comment-delimiter"># </span><span class="org-comment">9
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">str</span>:2} <span class="org-comment-delimiter"># </span><span class="org-comment">cdef&#25105;&#20320;&#20182;
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">str</span>:2:3} <span class="org-comment-delimiter"># </span><span class="org-comment">cde
</span>cho ${<span class="org-variable-name">str</span>:-3} <span class="org-comment-delimiter"># </span><span class="org-comment">abcdef&#25105;&#20320;&#20182;
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">str</span>: -3} <span class="org-comment-delimiter"># </span><span class="org-comment">&#25105;&#20320;&#20182;
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">str</span>:2:-3} <span class="org-comment-delimiter"># </span><span class="org-comment">cdef
</span>[root@centos8 script40]#echo ${<span class="org-variable-name">str</span>: -2:-3}
-bash: -3: substring expression &lt; 0
<span class="org-builtin">echo</span> ${<span class="org-variable-name">str</span>: -3:-2} <span class="org-comment-delimiter"># </span><span class="org-comment">&#25105;
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">str</span>:-3:-2} <span class="org-comment-delimiter"># </span><span class="org-comment">abcdef&#25105;&#20320;&#20182;
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">str</span>: -3:-2} <span class="org-comment-delimiter"># </span><span class="org-comment">&#25105;
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">str</span>: -5:-2} <span class="org-comment-delimiter"># </span><span class="org-comment">ef&#25105;
</span>
&#22914;&#26524;$<span class="org-variable-name">string&#21442;&#25968;&#26159;</span><span class="org-string">"*"</span>&#25110;<span class="org-string">"@"</span>, &#37027;&#20040;&#23558;&#20250;&#20174;$<span class="org-variable-name">position&#20301;&#32622;&#24320;&#22987;&#25552;&#21462;</span>$<span class="org-variable-name">length&#20010;&#20301;&#32622;&#21442;&#25968;</span>, &#20294;&#26159;&#30001;&#20110; &#21487;&#33021;&#27809;&#26377;$<span class="org-variable-name">length&#20010;&#20301;&#32622;&#21442;&#25968;&#20102;</span>, &#37027;&#20040;&#23601;&#26377;&#20960;&#20010;&#20301;&#32622;&#21442;&#25968;&#23601;&#25552;&#21462;&#20960;&#20010;&#20301;&#32622;&#21442;&#25968;.
<span class="org-builtin">echo</span> ${<span class="org-variable-name">*</span>:2} <span class="org-comment-delimiter"># </span><span class="org-comment">&#25171;&#21360;&#20986;&#31532;2&#20010;&#21644;&#21518;&#36793;&#25152;&#26377;&#30340;&#20301;&#32622;&#21442;&#25968;.
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">@</span>:2} <span class="org-comment-delimiter"># </span><span class="org-comment">&#21516;&#19978;.
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">*</span>:2:3} <span class="org-comment-delimiter"># </span><span class="org-comment">&#20174;&#31532;2&#20010;&#24320;&#22987;, &#36830;&#32493;&#25171;&#21360;3&#20010;&#20301;&#32622;&#21442;&#25968;.</span>
</pre>
</div>

<p>
<b>基于模式取子串</b>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#20854;&#20013;word&#21487;&#20197;&#26159;&#25351;&#23450;&#30340;&#20219;&#24847;&#23383;&#31526;,&#33258;&#24038;&#32780;&#21491;&#65292;&#26597;&#25214;var&#21464;&#37327;&#25152;&#23384;&#20648;&#30340;&#23383;&#31526;&#20018;&#20013;&#65292;&#31532;&#19968;&#27425;&#20986;&#29616;&#30340;word, &#21024;&#38500;&#23383;&#31526;&#20018;&#24320;&#22836;&#33267;&#31532;&#19968;&#27425;&#20986;&#29616;word&#23383;&#31526;&#20018;(&#21547;)&#20043;&#38388;&#30340;&#25152;&#26377;&#23383;&#31526;
</span>${<span class="org-variable-name">var</span>#*word}&#65306;&#26368;&#30701;&#21305;&#37197;

<span class="org-comment-delimiter">#</span><span class="org-comment">&#21516;&#19978;&#65292;&#36138;&#23146;&#27169;&#24335;&#65292;&#19981;&#21516;&#30340;&#26159;&#65292;&#21024;&#38500;&#30340;&#26159;&#23383;&#31526;&#20018;&#24320;&#22836;&#33267;&#26368;&#21518;&#19968;&#27425;&#30001;word&#25351;&#23450;&#30340;&#23383;&#31526;&#20043;&#38388;&#30340;&#25152;&#26377;&#20869;&#23481;
</span>${<span class="org-variable-name">var</span>##*word}&#65306;&#26368;&#38271;&#21305;&#37197;
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#<span class="org-variable-name">file</span>=<span class="org-string">"var/log/messages"</span>
[root@centos8 ~]#echo ${<span class="org-variable-name">file</span>#*/}
log/messages
[root@centos8 ~]#echo ${<span class="org-variable-name">file</span>##*/}
messages
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#20854;&#20013;word&#21487;&#20197;&#26159;&#25351;&#23450;&#30340;&#20219;&#24847;&#23383;&#31526;,&#21151;&#33021;&#65306;&#33258;&#21491;&#32780;&#24038;&#65292;&#26597;&#25214;var&#21464;&#37327;&#25152;&#23384;&#20648;&#30340;&#23383;&#31526;&#20018;&#20013;&#65292;&#31532;&#19968;&#27425;&#20986;&#29616;&#30340;word,&#21024;&#38500;&#23383;&#31526;&#20018;&#26368;&#21518;&#19968;&#20010;&#23383;&#31526;&#21521;&#24038;&#33267;&#31532;&#19968;&#27425;&#20986;&#29616;word&#23383;&#31526;&#20018;(&#21547;)&#20043;&#38388;&#30340;&#25152;&#26377;&#23383;&#31526;
</span>${<span class="org-variable-name">var</span>%word*} &#26368;&#30701;&#21305;&#37197;

<span class="org-comment-delimiter">#</span><span class="org-comment">&#21516;&#19978;&#65292;&#21482;&#19981;&#36807;&#21024;&#38500;&#23383;&#31526;&#20018;&#26368;&#21491;&#20391;&#30340;&#23383;&#31526;&#21521;&#24038;&#33267;&#26368;&#21518;&#19968;&#27425;&#20986;&#29616;word&#23383;&#31526;&#20043;&#38388;&#30340;&#25152;&#26377;&#23383;&#31526;
</span>${<span class="org-variable-name">var</span>%%word*}&#26368;&#38271;&#21305;&#37197;
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#<span class="org-variable-name">file</span>=<span class="org-string">"var/log/messages"</span>
[root@centos8 ~]#echo ${<span class="org-variable-name">file</span>%/*}
var/log
[root@centos8 ~]#echo ${<span class="org-variable-name">file</span>%%/*}
var
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#<span class="org-variable-name">url</span>=http://www.me.com:8080
[root@centos8 ~]#echo ${<span class="org-variable-name">url</span>##*:}
8080
[root@centos8 ~]#echo ${<span class="org-variable-name">url</span>%%:*}
http
</pre>
</div>
</div>
</div>
<div id="outline-container-查找替换" class="outline-3">
<h3 id="查找替换"><a href="#查找替换">查找替换</a></h3>
<div class="outline-text-3" id="text-查找替换">
<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#26597;&#25214;var&#25152;&#34920;&#31034;&#30340;&#23383;&#31526;&#20018;&#20013;&#65292;&#31532;&#19968;&#27425;&#34987;pattern&#25152;&#21305;&#37197;&#21040;&#30340;&#23383;&#31526;&#20018;&#65292;&#20197;substr&#26367;&#25442;&#20043;
</span>${<span class="org-variable-name">var</span>/pattern/substr}

<span class="org-comment-delimiter">#</span><span class="org-comment">&#26597;&#25214;var&#25152;&#34920;&#31034;&#30340;&#23383;&#31526;&#20018;&#20013;&#65292;&#25152;&#26377;&#33021;&#34987;pattern&#25152;&#21305;&#37197;&#21040;&#30340;&#23383;&#31526;&#20018;&#65292;&#20197;substr&#26367;&#25442;&#20043;
</span>${<span class="org-variable-name">var</span>//pattern/substr}

<span class="org-comment-delimiter">#</span><span class="org-comment">&#26597;&#25214;var&#25152;&#34920;&#31034;&#30340;&#23383;&#31526;&#20018;&#20013;&#65292;&#34892;&#39318;&#34987;pattern&#25152;&#21305;&#37197;&#21040;&#30340;&#23383;&#31526;&#20018;&#65292;&#20197;substr&#26367;&#25442;&#20043;
</span>${<span class="org-variable-name">var</span>/#pattern/substr}

<span class="org-comment-delimiter">#</span><span class="org-comment">&#26597;&#25214;var&#25152;&#34920;&#31034;&#30340;&#23383;&#31526;&#20018;&#20013;&#65292;&#34892;&#23614;&#34987;pattern&#25152;&#21305;&#37197;&#21040;&#30340;&#23383;&#31526;&#20018;&#65292;&#20197;substr&#26367;&#25442;&#20043;
</span>${<span class="org-variable-name">var</span>/%pattern/substr}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">&#26597;&#25214;&#26367;&#25442;
<span class="org-variable-name">mypath</span>=<span class="org-string">"/etc/init.d/functions"</span>
<span class="org-builtin">echo</span> ${<span class="org-variable-name">mypath</span>/func*/abc} <span class="org-comment-delimiter"># </span><span class="org-comment">/etc/init.d/abc
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">mypath</span>//<span class="org-string">\/</span>/@} <span class="org-comment-delimiter"># </span><span class="org-comment">&#20840;&#23616;&#26367;&#25442; @etc@init.d@functions
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">mypath</span>/#ini/abc} <span class="org-comment-delimiter"># </span><span class="org-comment">&#34892;&#39318;&#27809;&#21305;&#37197; /etc/init.d/functions
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">mypath</span>/#<span class="org-string">\/</span>etc/abc} <span class="org-comment-delimiter"># </span><span class="org-comment">&#34892;&#39318;&#21305;&#37197;&#26367;&#25442; abc/init.d/functions
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">mypath</span>/%tions/ABC} <span class="org-comment-delimiter"># </span><span class="org-comment">&#34892;&#23614;&#21305;&#37197;&#26367;&#25442; /etc/init.d/funcABC</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-查找并删除" class="outline-3">
<h3 id="查找并删除"><a href="#查找并删除">查找并删除</a></h3>
<div class="outline-text-3" id="text-查找并删除">
<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#21024;&#38500;var&#34920;&#31034;&#30340;&#23383;&#31526;&#20018;&#20013;&#31532;&#19968;&#27425;&#34987;pattern&#21305;&#37197;&#21040;&#30340;&#23383;&#31526;&#20018;
</span>${<span class="org-variable-name">var</span>/pattern}

&#21024;&#38500;var&#34920;&#31034;&#30340;&#23383;&#31526;&#20018;&#20013;&#25152;&#26377;&#34987;pattern&#21305;&#37197;&#21040;&#30340;&#23383;&#31526;&#20018;
${<span class="org-variable-name">var</span>//pattern}

&#21024;&#38500;var&#34920;&#31034;&#30340;&#23383;&#31526;&#20018;&#20013;&#25152;&#26377;&#20197;pattern&#20026;&#34892;&#39318;&#21305;&#37197;&#21040;&#30340;&#23383;&#31526;&#20018;
${<span class="org-variable-name">var</span>/#pattern}

&#21024;&#38500;var&#25152;&#34920;&#31034;&#30340;&#23383;&#31526;&#20018;&#20013;&#25152;&#26377;&#20197;pattern&#20026;&#34892;&#23614;&#25152;&#21305;&#37197;&#21040;&#30340;&#23383;&#31526;&#20018;
${<span class="org-variable-name">var</span>/%pattern}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">&#26597;&#25214;&#21024;&#38500;&#65306;
<span class="org-variable-name">mypath</span>=<span class="org-string">"/etc/init.d/functions"</span>
<span class="org-builtin">echo</span> ${<span class="org-variable-name">mypath</span>/%tions} <span class="org-comment-delimiter"># </span><span class="org-comment">/etc/init.d/func
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">mypath</span>/#<span class="org-string">\/</span>etc} <span class="org-comment-delimiter"># </span><span class="org-comment">/init.d/functions
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">mypath</span>/init*} <span class="org-comment-delimiter"># </span><span class="org-comment">/etc/
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">mypath</span>//t} <span class="org-comment-delimiter"># </span><span class="org-comment">/ec/ini.d/funcions</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-字符大小写转换" class="outline-3">
<h3 id="字符大小写转换"><a href="#字符大小写转换">字符大小写转换</a></h3>
<div class="outline-text-3" id="text-字符大小写转换">
<p>
<b>shell变量值大小转换</b>
</p>
<div class="org-src-container">
<pre class="src src-sh">${<span class="org-variable-name">var</span>^}   <span class="org-comment-delimiter">#</span><span class="org-comment">&#25226;var&#20013;&#39318;&#20010;&#23567;&#20889;&#23383;&#31526;&#36716;&#22823;&#20889;
</span>${<span class="org-variable-name">var</span>^^}  <span class="org-comment-delimiter">#</span><span class="org-comment">&#25226;var&#20013;&#25152;&#26377;&#23567;&#20889;&#23383;&#31526;&#36716;&#22823;&#20889;
</span>${<span class="org-variable-name">var</span>,}   <span class="org-comment-delimiter">#</span><span class="org-comment">&#25226;var&#20013;&#39318;&#20010;&#22823;&#20889;&#23383;&#31526;&#36716;&#23567;&#20889;
</span>${<span class="org-variable-name">var</span>,,}  <span class="org-comment-delimiter">#</span><span class="org-comment">&#25226;var&#20013;&#25152;&#26377;&#22823;&#20889;&#23383;&#31526;&#36716;&#23567;&#20889;</span>
</pre>
</div>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">name</span>=AbC
<span class="org-builtin">echo</span> ${<span class="org-variable-name">name</span>^^} <span class="org-comment-delimiter"># </span><span class="org-comment">ABC
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">name</span>} <span class="org-comment-delimiter"># </span><span class="org-comment">AbC
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">name</span>,,} <span class="org-comment-delimiter"># </span><span class="org-comment">abc
</span><span class="org-builtin">echo</span> ${<span class="org-variable-name">name</span>} <span class="org-comment-delimiter"># </span><span class="org-comment">AbC</span>
</pre>
</div>


<p>
<b>vim中实现字符大小写转换</b>
</p>
<div class="org-src-container">
<pre class="src src-sh">~     <span class="org-comment-delimiter">#</span><span class="org-comment">&#36716;&#25442;&#22823;&#23567;&#20889;
</span>g~iw  <span class="org-comment-delimiter">#</span><span class="org-comment">&#25913;&#21464;&#24403;&#21069;&#21333;&#35789;&#30340;&#22823;&#23567;&#20889;
</span>gU    <span class="org-comment-delimiter">#</span><span class="org-comment">&#22823;&#20889;
</span>gu    <span class="org-comment-delimiter">#</span><span class="org-comment">&#23567;&#20889;
</span>gUiw  <span class="org-comment-delimiter">#</span><span class="org-comment">&#20351;&#24403;&#21069;&#21333;&#35789;&#20840;&#20026;&#22823;&#20889;
</span>guiw  <span class="org-comment-delimiter">#</span><span class="org-comment">&#20351;&#24403;&#21069;&#21333;&#35789;&#20840;&#20026;&#23567;&#20889;</span>
</pre>
</div>

<p>
例如
</p>
<ul class="org-ul">
<li>光标停留在字母的位置按~键，可以看到字母自动切换大小写；</li>
<li>普通模式下按 v 选中文件，再按gU或gu切换字母大小写</li>
</ul>

<p>
<b>命令行下实现字符大小写转换</b>
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@centos7 ~]# echo $<span class="org-variable-name">name</span> | tr <span class="org-string">'a-z'</span> <span class="org-string">'A-Z'</span>
ABC

[root@centos7 ~]# awk <span class="org-string">'BEGIN{a="abcDEF";print a}'</span>
abcDEF
[root@centos7 ~]# awk <span class="org-string">'BEGIN{a="abcDEF";print tolower(a)}'</span>
abcdef
[root@centos7 ~]# awk <span class="org-string">'BEGIN{a="abcDEF";print toupper(a)}'</span>
ABCDEF
</pre>
</div>

<p>
<b>bash快捷键实现字符大小写转换</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">Alt + c  <span class="org-comment-delimiter">#</span><span class="org-comment">&#20174;&#20809;&#26631;&#22788;&#26356;&#25913;&#20026;&#39318;&#23383;&#27597;&#22823;&#20889;&#30340;&#21333;&#35789;
</span>Alt + u  <span class="org-comment-delimiter">#</span><span class="org-comment">&#20174;&#20809;&#26631;&#22788;&#26356;&#25913;&#20026;&#20840;&#37096;&#22823;&#20889;&#30340;&#21333;&#35789;
</span>Alt + l  <span class="org-comment-delimiter">#</span><span class="org-comment">&#20174;&#20809;&#26631;&#22788;&#26356;&#25913;&#20026;&#20840;&#37096;&#23567;&#20889;&#30340;&#21333;&#35789;
</span>ESC-c    <span class="org-comment-delimiter">#</span><span class="org-comment">&#25353;&#19968;&#19979;ESC &#20877;&#25353;c&#12290;&#20809;&#26631;&#20572;&#30041;&#22788;&#30340;&#23383;&#27597;&#21464;&#22823;&#20889;&#65292;&#24182;&#19988;&#20809;&#26631;&#20999;&#25442;&#21040;&#21333;&#35789;&#32467;&#23614;&#12290;&#32780;&#19981;&#26159;&#21629;&#20196;&#34892;&#32467;&#23614;
</span>ESC-u    <span class="org-comment-delimiter">#</span><span class="org-comment">&#25353;&#19968;&#19979;ESC &#20877;&#25353;u&#12290;&#22312;&#21333;&#35789;&#19978;&#65292;&#20809;&#26631;&#21518;&#30340;&#25152;&#26377;&#23383;&#27597;&#21464;&#22823;&#20889;&#65292;&#24182;&#19988;&#20809;&#26631;&#20999;&#25442;&#21040;&#21333;&#35789;&#32467;&#23614;&#12290;&#32780;&#19981;&#26159;&#21629;&#20196;&#34892;&#32467;&#23614;
</span>ESC-l    <span class="org-comment-delimiter">#</span><span class="org-comment">&#21516;ESC-u, &#20294;&#20351;&#20043;&#20840;&#21464;&#20026;&#23567;&#20889;</span>
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-高级变量" class="outline-2">
<h2 id="高级变量"><a href="#高级变量">高级变量</a></h2>
<div class="outline-text-2" id="text-高级变量">
</div>
<div id="outline-container-高级变量赋值" class="outline-3">
<h3 id="高级变量赋值"><a href="#高级变量赋值">高级变量赋值</a></h3>
<div class="outline-text-3" id="text-高级变量赋值">

<figure id="org671b7e1">
<img src="././images/image-20210206112435586.png" alt="image-20210206112435586.png" width="50%">

<figcaption><span class="figure-number">Figure 8: </span>image-20210206112435586</figcaption>
</figure>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">变量配置方式</th>
<th scope="col" class="org-left">str没有配置</th>
<th scope="col" class="org-left">str为空字符串</th>
<th scope="col" class="org-left">str已配置非为空字符串</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>var=${str-expr}</code></td>
<td class="org-left"><code>var=expr</code></td>
<td class="org-left"><code>var=</code></td>
<td class="org-left"><code>var=$​str</code></td>
</tr>

<tr>
<td class="org-left"><code>var=${str:-expr}</code></td>
<td class="org-left"><code>var=expr</code></td>
<td class="org-left"><code>var=expr</code></td>
<td class="org-left"><code>var=$​str</code></td>
</tr>

<tr>
<td class="org-left"><code>var=${str+expr}</code></td>
<td class="org-left"><code>var=</code></td>
<td class="org-left"><code>var=expr</code></td>
<td class="org-left"><code>var=expr</code></td>
</tr>

<tr>
<td class="org-left"><code>var=${str:+expr}</code></td>
<td class="org-left"><code>var=</code></td>
<td class="org-left"><code>var=</code></td>
<td class="org-left"><code>var=expr</code></td>
</tr>

<tr>
<td class="org-left"><code>var=${str=expr}</code></td>
<td class="org-left"><code>str=expr &lt;br/&gt;var=expr</code></td>
<td class="org-left"><code>str不变 &lt;br/&gt;var=</code></td>
<td class="org-left"><code>str不变 &lt;br/&gt;var=$​str</code></td>
</tr>

<tr>
<td class="org-left"><code>var=${str:=expr}</code></td>
<td class="org-left"><code>str=expr &lt;br/&gt;var=expr</code></td>
<td class="org-left"><code>str=expr &lt;br/&gt;var=expr</code></td>
<td class="org-left"><code>str不变 &lt;br/&gt;var=$​str</code></td>
</tr>

<tr>
<td class="org-left"><code>var=${str?expr}</code></td>
<td class="org-left"><code>expr输出到stderr</code></td>
<td class="org-left"><code>var=</code></td>
<td class="org-left"><code>var=$​str</code></td>
</tr>

<tr>
<td class="org-left"><code>var=${str:?expr}</code></td>
<td class="org-left"><code>expr输出到stderr</code></td>
<td class="org-left"><code>expr输出到stderr</code></td>
<td class="org-left"><code>var=$​str</code></td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-sh">${<span class="org-variable-name">var</span>:-VALUE}&#65306;
&#22914;&#26524;var&#21464;&#37327;&#20026;&#31354;&#65292;&#25110;&#26410;&#35774;&#32622;&#65292;&#37027;&#20040;&#36820;&#22238;VALUE&#65307;&#21542;&#21017;&#65292;&#21017;&#36820;&#22238;var&#21464;&#37327;&#30340;&#20540;&#65307;

${<span class="org-variable-name">var</span>:=VALUE}&#65306;
&#22914;&#26524;var&#21464;&#37327;&#20026;&#31354;&#65292;&#25110;&#26410;&#35774;&#32622;&#65292;&#37027;&#20040;&#36820;&#22238;VALUE&#65292;&#24182;&#23558;VALUE&#36171;&#20540;&#32473;var&#21464;&#37327;&#65307;&#21542;&#21017;&#65292;&#21017;&#36820;&#22238;var&#21464;&#37327;&#30340;&#20540;&#65307;

${<span class="org-variable-name">var</span>:+VALUE}&#65306;
&#22914;&#26524;var&#21464;&#37327;&#19981;&#31354;&#65292;&#21017;&#36820;&#22238;VALUE&#65307;

${<span class="org-variable-name">var</span>:?ERROR_INFO}&#65306;
&#22914;&#26524;var&#20026;&#31354;&#65292;&#25110;&#26410;&#35774;&#32622;&#65292;&#37027;&#20040;&#36820;&#22238;ERROR_INFO&#20026;&#38169;&#35823;&#25552;&#31034;&#65307;&#21542;&#21017;&#65292;&#36820;&#22238;var&#20540;&#65307;
</pre>
</div>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#<span class="org-variable-name">title</span>=ceo
[root@centos8 ~]#<span class="org-variable-name">name</span>=${<span class="org-variable-name">title</span>-me}
[root@centos8 ~]#echo $<span class="org-variable-name">name</span>
ceo
[root@centos8 ~]#<span class="org-variable-name">title</span>=
[root@centos8 ~]#<span class="org-variable-name">name</span>=${<span class="org-variable-name">title</span>-me}
[root@centos8 ~]#echo $<span class="org-variable-name">name</span>

[root@centos8 ~]#unset title
[root@centos8 ~]#<span class="org-variable-name">name</span>=${<span class="org-variable-name">title</span>-me}
[root@centos8 ~]#echo $<span class="org-variable-name">name</span>
me
</pre>
</div>
</div>
<div id="outline-container-单行多变量赋值" class="outline-4">
<h4 id="单行多变量赋值"><a href="#单行多变量赋值">单行多变量赋值</a></h4>
<div class="outline-text-4" id="text-单行多变量赋值">
<p>
<b>:冒号的用法-单行多变量赋值，防止bash运行命令</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">: ${<span class="org-variable-name">x</span>:=11} ${<span class="org-variable-name">c</span>:=22}
<span class="org-builtin">echo</span> ${<span class="org-variable-name">x</span>} ${<span class="org-variable-name">c</span>}  <span class="org-comment-delimiter">#</span><span class="org-comment">11 22
</span>
[root@ct8-ts1 ~]# : ${<span class="org-variable-name">CLUSTER_NAME</span>:=kubernetes}
[root@ct8-ts1 ~]# ${<span class="org-variable-name">CLUSTER_NAME</span>:=kubernetes}
-bash: kubernetes: command not found
</pre>
</div>
</div>
</div>
<div id="outline-container-变量与命令单行存在" class="outline-4">
<h4 id="变量与命令单行存在"><a href="#变量与命令单行存在">变量与命令单行存在</a></h4>
<div class="outline-text-4" id="text-变量与命令单行存在">
<p>
变量被赋值后，将解析变量对应的文件内容交由命令运行，同时也可以接收传来的参数
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#20363;1
</span>]# <span class="org-variable-name">a</span>=/tmp bash ${<span class="org-variable-name">a</span>}/a.sh ok
+ <span class="org-variable-name">a</span>=/tmp
+ bash /tmp/a.sh ok
name: ok

<span class="org-comment-delimiter">#</span><span class="org-comment">&#20363;2
</span><span class="org-variable-name">COMPOSE_PROJECT_NAME</span>=btdp docker-compose -f $<span class="org-variable-name">1</span> up -d
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span>
<span class="org-variable-name">root_dir</span>=$(<span class="org-builtin">cd</span> <span class="org-sh-quoted-exec">`dirname $0`</span>;<span class="org-builtin">pwd</span>)
<span class="org-builtin">echo</span> <span class="org-string">"export BTDP_ROOT=$root_dir"</span> &gt;&gt; /etc/profile
<span class="org-builtin">source</span> /etc/profile

<span class="org-variable-name">BTDP_ROOT</span>=$<span class="org-variable-name">root_dir</span>

<span class="org-variable-name">steps</span>=(
    <span class="org-string">"check and install docker"</span>
    <span class="org-string">"prepare data"</span>
    <span class="org-string">"install tools"</span>
)

<span class="org-variable-name">step</span>=1

<span class="org-keyword">while</span> [ $<span class="org-variable-name">step</span> -le ${#<span class="org-variable-name">steps</span>[@]} ]; <span class="org-keyword">do</span>
    <span class="org-builtin">echo</span> <span class="org-string">"executing step $step: ${steps[step-1]}"</span>
    <span class="org-keyword">case</span> $<span class="org-variable-name">step</span><span class="org-keyword"> in</span>
        1)
            <span class="org-variable-name">BTDP_ROOT</span>=$<span class="org-variable-name">root_dir</span> bash $<span class="org-variable-name">BTDP_ROOT</span>/install/docker.sh
            ;;
        2)
            <span class="org-variable-name">BTDP_ROOT</span>=$<span class="org-variable-name">root_dir</span> bash $<span class="org-variable-name">BTDP_ROOT</span>/install/start-container.sh base
            ;;
        *)
            <span class="org-builtin">echo</span> <span class="org-string">"Invalid step"</span>
            ;;
    <span class="org-keyword">esac</span>
    <span class="org-builtin">let</span> <span class="org-variable-name">step</span>+=1
<span class="org-keyword">done</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-高级变量用法-有类型变量" class="outline-3">
<h3 id="高级变量用法-有类型变量"><a href="#高级变量用法-有类型变量">高级变量用法-有类型变量</a></h3>
<div class="outline-text-3" id="text-高级变量用法-有类型变量">
<p>
Shell变量一般是无类型的，但是bash Shell提供了declare和typeset两个命令
用于指定变量的类型，两个命令是等价的
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">declare</span> [+/-][&#36873;&#39033;] &#21464;&#37327;&#21517;&#160;&#160;
&#36873;&#39033;&#65306;
- : &#32473;&#21464;&#37327;&#30340;&#31867;&#22411;&#23646;&#24615;&#160;&#160;
+ : &#21462;&#28040;&#21464;&#37327;&#30340;&#31867;&#22411;&#23646;&#24615;&#160;&#160;
-r &#22768;&#26126;&#25110;&#26174;&#31034;&#21482;&#35835;&#21464;&#37327;
-i &#23558;&#21464;&#37327;&#23450;&#20041;&#20026;&#25972;&#22411;&#25968;
-a &#23558;&#21464;&#37327;&#23450;&#20041;&#20026;&#25968;&#32452;
-A &#23558;&#21464;&#37327;&#23450;&#20041;&#20026;&#20851;&#32852;&#25968;&#32452;
-f &#26174;&#31034;&#24050;&#23450;&#20041;&#30340;&#25152;&#26377;&#20989;&#25968;&#21517;&#21450;&#20854;&#20869;&#23481;
-F &#20165;&#26174;&#31034;&#24050;&#23450;&#20041;&#30340;&#25152;&#26377;&#20989;&#25968;&#21517;
-x &#22768;&#26126;&#25110;&#26174;&#31034;&#29615;&#22659;&#21464;&#37327;&#21644;&#20989;&#25968;,&#30456;&#24403;&#20110;export
-l &#22768;&#26126;&#21464;&#37327;&#20026;&#23567;&#20889;&#23383;&#27597; declare -l <span class="org-variable-name">var</span>=UPPER <span class="org-comment-delimiter"># </span><span class="org-comment">var=upper
</span>-u &#22768;&#26126;&#21464;&#37327;&#20026;&#22823;&#20889;&#23383;&#27597; declare -u <span class="org-variable-name">var</span>=lower   <span class="org-comment-delimiter"># </span><span class="org-comment">var=LOWER
</span>
<span class="org-builtin">set</span> <span class="org-comment-delimiter"># </span><span class="org-comment">&#21629;&#20196;&#26597;&#30475;&#23450;&#20041;&#30340;&#25152;&#26377;&#21464;&#37327;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-变量间接引用" class="outline-3">
<h3 id="变量间接引用"><a href="#变量间接引用">变量间接引用</a></h3>
<div class="outline-text-3" id="text-变量间接引用">
</div>
<div id="outline-container-eval命令" class="outline-4">
<h4 id="eval命令"><a href="#eval命令">eval命令</a></h4>
<div class="outline-text-4" id="text-eval命令">
<p>
eval命令将会首先扫描命令行进行所有的置换，然后再执行该命令。该命令适用
于那些一次扫描无法实现其功能的变量,该命令对变量进行两次扫描
</p>

<p>
范例:
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]# <span class="org-variable-name">CMD</span>=whoami
[root@centos8 ~]# echo $<span class="org-variable-name">CMD</span>
whoami
[root@centos8 ~]# eval $<span class="org-variable-name">CMD</span>
root
[root@centos8 ~]# <span class="org-variable-name">n</span>=10    
[root@centos8 ~]# echo {0..$<span class="org-variable-name">n</span>}  
{0..10}
[root@centos8 ~]# eval echo {0..$<span class="org-variable-name">n</span>}
0 1 2 3 4 5 6 7 8 9 10

[root@centos8 ~]#for i<span class="org-keyword"> in</span> <span class="org-sh-quoted-exec">`eval echo {1..$n}`</span> ;<span class="org-keyword">do </span><span class="org-builtin">echo</span> <span class="org-variable-name">i</span>=$<span class="org-variable-name">i</span> ;<span class="org-keyword">done</span>
<span class="org-variable-name">i</span>=1
<span class="org-variable-name">i</span>=2
<span class="org-variable-name">i</span>=3
<span class="org-variable-name">i</span>=4
<span class="org-variable-name">i</span>=5
<span class="org-variable-name">i</span>=6
<span class="org-variable-name">i</span>=7
<span class="org-variable-name">i</span>=8
<span class="org-variable-name">i</span>=9
<span class="org-variable-name">i</span>=10

[root@centos8 ~]#<span class="org-variable-name">i</span>=1
[root@centos8 ~]#<span class="org-variable-name">j</span>=a
[root@centos8 ~]#$<span class="org-variable-name">j</span>$<span class="org-variable-name">i</span>=hello
-bash: <span class="org-variable-name">a1</span>=hello: command not found
[root@centos8 ~]#eval $<span class="org-variable-name">j</span>$<span class="org-variable-name">i</span>=hello
[root@centos8 ~]#echo $<span class="org-variable-name">j</span>$<span class="org-variable-name">i</span>
a1
</pre>
</div>
</div>
</div>
<div id="outline-container-间接变量引用" class="outline-4">
<h4 id="间接变量引用"><a href="#间接变量引用">间接变量引用</a></h4>
<div class="outline-text-4" id="text-间接变量引用">
<p>
如果第一个变量的值是第二个变量的名字，从第一个变量引用第二个变量的值就
称为间接变量引用variable1的值是variable2，而variable2又是变量名，
variable2的值为value，间接变量引用是指通过variable1获得变量值value的行
为
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">variable1</span>=variable2
<span class="org-variable-name">variable2</span>=value
</pre>
</div>

<p>
bash Shell提供了两种格式实现间接变量引用
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">eval</span> <span class="org-variable-name">tempvar</span>=<span class="org-string">\$</span><span class="org-variable-name">$variable1</span>  <span class="org-comment-delimiter"># </span><span class="org-comment">$$&#22312;shell&#26159;shell&#36827;&#31243;&#21495;&#65292;&#24341;&#29992;&#30340;&#35805;&#35201;&#21152;\
</span><span class="org-variable-name">tempvar</span>=${<span class="org-variable-name">!</span>variable1}  <span class="org-comment-delimiter">#</span><span class="org-comment">eval \$$variable1 &#31561;&#20215;&#20110; ${!variable1}</span>
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#<span class="org-variable-name">ceo</span>=name
[root@centos8 ~]#<span class="org-variable-name">name</span>=me
[root@centos8 ~]#echo $<span class="org-variable-name">ceo</span>
name
[root@centos8 ~]#echo $<span class="org-variable-name">$ceo</span>
33722ceo
[root@centos8 ~]#echo $<span class="org-variable-name">BASHPID</span>
33722

[root@centos8 ~]#echo <span class="org-string">\$</span><span class="org-variable-name">$ceo</span>
$<span class="org-variable-name">name</span>
[root@centos8 ~]#eval <span class="org-variable-name">tmp</span>=<span class="org-string">\$</span><span class="org-variable-name">$ceo</span>
[root@centos8 ~]#echo $<span class="org-variable-name">tmp</span>
me
[root@centos8 ~]#echo ${<span class="org-variable-name">!</span>ceo}
me

[root@server ~]# <span class="org-variable-name">NAME</span>=cici
[root@server ~]# <span class="org-variable-name">N</span>=NAME
[root@server ~]# <span class="org-variable-name">N1</span>=${<span class="org-variable-name">!</span>N}
[root@server ~]# echo $<span class="org-variable-name">N1</span>
cici



<span class="org-variable-name">a</span>=10
<span class="org-builtin">set</span> -- a <span class="org-comment-delimiter"># </span><span class="org-comment">&#21462;&#28040;&#24182;&#37325;&#26032;&#35774;&#32622;&#20301;&#32622;&#21442;&#25968;
</span>[root@~] <span class="org-variable-name">eth0</span> = 192.168.7.107
<span class="org-comment-delimiter"># </span><span class="org-comment">echo \${\!\$1}=\$$1=${!1}
</span>${<span class="org-variable-name">!</span>$<span class="org-variable-name">1</span>}=$<span class="org-variable-name">a</span>=10
<span class="org-comment-delimiter">#</span><span class="org-comment">2&#23618;&#24341;&#29992;
</span><span class="org-comment-delimiter">#</span><span class="org-comment">int a=1;
</span><span class="org-comment-delimiter">#</span><span class="org-comment">int *p=a;
</span><span class="org-comment-delimiter">#</span><span class="org-comment">$1 = p;
</span><span class="org-comment-delimiter">#</span><span class="org-comment">{!1} == *p;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-变量引用reference" class="outline-4">
<h4 id="变量引用reference"><a href="#变量引用reference">变量引用reference</a></h4>
<div class="outline-text-4" id="text-变量引用reference">
<p>
centos 8 支持
</p>

<div class="org-src-container">
<pre class="src src-sh">-R &#21028;&#26029;&#26159;&#19981;&#26159;&#21464;&#37327;&#30340;&#24341;&#29992;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">[root@server ~]# eval <span class="org-variable-name">N2</span>=<span class="org-string">\$</span><span class="org-variable-name">$N</span>
[root@server ~]# echo $<span class="org-variable-name">N2</span>
cici
[root@centos8 ~]#cat test.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-variable-name">ceo</span>=me
<span class="org-variable-name">title</span>=ceo
<span class="org-builtin">declare</span> -n <span class="org-variable-name">ref</span>=$<span class="org-variable-name">title</span>  <span class="org-comment-delimiter"># </span><span class="org-comment">&#22768;&#26126;&#31867;&#22411;&#65292;&#26159;&#21464;&#37327;&#30340;&#24341;&#29992;
</span>[ -R ref ] &amp;&amp; <span class="org-builtin">echo</span> reference                         
     <span class="org-builtin">echo</span> $<span class="org-variable-name">ref</span>
<span class="org-variable-name">ceo</span>=wang
<span class="org-builtin">echo</span> $<span class="org-variable-name">ref</span>

[root@centos8 ~]#bash test.sh
reference
me
wang
</pre>
</div>
</div>
</div>
<div id="outline-container-set命令" class="outline-4">
<h4 id="set命令"><a href="#set命令">set命令</a></h4>
<div class="outline-text-4" id="text-set命令">
<p>
set命令Shell内建命令
</p>

<p>
set命令作用主要是显示系统中已经存在的shell变量，以及设置shell变量的新
变量值。使用set更改shell特性时，符号”+"和"-“的作用分别是打开和关闭指
定的模式。set命令不能够定义新的shell变量。如果要定义新的变量，可以使用
declare命令以变量名=值的格式进行定义即可。
</p>

<p>
参考： <a href="https://www.gnu.org/software/bash/manual/bash.html#The-Set-Builtin">https://www.gnu.org/software/bash/manual/bash.html#The-Set-Builtin</a>
</p>

<p>
语法 set(选项)(参数) 选项
</p>
<div class="org-src-container">
<pre class="src src-sh">-a&#65306;&#26631;&#31034;&#24050;&#20462;&#25913;&#30340;&#21464;&#37327;&#65292;&#20197;&#20379;&#36755;&#20986;&#33267;&#29615;&#22659;&#21464;&#37327;&#12290;
-b&#65306;&#20351;&#34987;&#20013;&#27490;&#30340;&#21518;&#21488;&#31243;&#24207;&#31435;&#21051;&#22238;&#25253;&#25191;&#34892;&#29366;&#24577;&#12290;
-C&#65306;&#22914;&#26524;&#35774;&#32622;&#30340;&#35805;&#65292;bash&#20351;&#29992;&#37325;&#23450;&#21521;&#25805;&#20316;&#31526; &gt;, &gt;&amp;, &#21644; &lt;&gt; &#26102;&#65292;&#19981;&#20250;&#35206;&#30422;&#24050;&#23384;&#22312;&#30340;&#25991;&#20214;&#12290;&#21487;&#20197;&#20351;&#29992;&#37325;&#23450;&#21521;&#25805;&#20316;&#31526; &gt;| &#20195;&#26367;&#160;&gt;&#160;&#26469;&#21019;&#24314;&#36755;&#20986;&#25991;&#20214;&#65292;&#20174;&#32780;&#32469;&#36807;&#36825;&#20010;&#38480;&#21046;&#12290;
-d&#65306;Shell&#39044;&#35774;&#20250;&#29992;&#26434;&#20945;&#34920;&#35760;&#24518;&#20351;&#29992;&#36807;&#30340;&#25351;&#20196;&#65292;&#20197;&#21152;&#36895;&#25351;&#20196;&#30340;&#25191;&#34892;&#12290;&#20351;&#29992;-d&#21442;&#25968;&#21487;&#21462;&#28040;&#12290;
-e&#65306;&#33509;&#25351;&#20196;&#20256;&#22238;&#20540;&#19981;&#31561;&#20110;0&#65292;&#21017;&#31435;&#21363;&#36864;&#20986;shell&#12290;
-f&#65306;&#21462;&#28040;&#20351;&#29992;&#36890;&#37197;&#31526;&#12290;
-h&#65306;&#33258;&#21160;&#35760;&#24405;&#20989;&#25968;&#30340;&#25152;&#22312;&#20301;&#32622;&#12290;
-H Shell&#65306;&#21487;&#21033;&#29992;<span class="org-string">"!"</span>&#21152;&lt;&#25351;&#20196;&#32534;&#21495;&gt;&#30340;&#26041;&#24335;&#26469;&#25191;&#34892;history&#20013;&#35760;&#24405;&#30340;&#25351;&#20196;&#12290;
-k&#65306;&#25351;&#20196;&#25152;&#32473;&#30340;&#21442;&#25968;&#37117;&#20250;&#34987;&#35270;&#20026;&#27492;&#25351;&#20196;&#30340;&#29615;&#22659;&#21464;&#37327;&#12290;
-l&#65306;&#35760;&#24405;for&#24490;&#29615;&#30340;&#21464;&#37327;&#21517;&#31216;&#12290;
-m&#65306;&#20351;&#29992;&#30417;&#35270;&#27169;&#24335;&#12290;
-n&#65306;&#21482;&#35835;&#21462;&#25351;&#20196;&#65292;&#32780;&#19981;&#23454;&#38469;&#25191;&#34892;&#12290;
-p&#65306;&#21551;&#21160;&#20248;&#20808;&#39034;&#24207;&#27169;&#24335;&#12290;
-P&#65306;&#21551;&#21160;-P&#21442;&#25968;&#21518;&#65292;&#25191;&#34892;&#25351;&#20196;&#26102;&#65292;&#20250;&#20197;&#23454;&#38469;&#30340;&#25991;&#20214;&#25110;&#30446;&#24405;&#26469;&#21462;&#20195;&#31526;&#21495;&#36830;&#25509;&#12290;
-t&#65306;&#25191;&#34892;&#23436;&#38543;&#21518;&#30340;&#25351;&#20196;&#65292;&#21363;&#36864;&#20986;shell&#12290;
-u&#65306;&#24403;&#25191;&#34892;&#26102;&#20351;&#29992;&#21040;&#26410;&#23450;&#20041;&#36807;&#30340;&#21464;&#37327;&#65292;&#21017;&#26174;&#31034;&#38169;&#35823;&#20449;&#24687;&#12290;
-v&#65306;&#26174;&#31034;shell&#25152;&#35835;&#21462;&#30340;&#36755;&#20837;&#20540;&#12290;
-x&#65306;&#25191;&#34892;&#25351;&#20196;&#21518;&#65292;&#20250;&#20808;&#26174;&#31034;&#35813;&#25351;&#20196;&#21450;&#25152;&#19979;&#30340;&#21442;&#25968;&#12290;
--&#22914;&#26524;&#36825;&#20010;&#36873;&#39033;&#27809;&#26377;&#21442;&#25968;&#65292;&#23558;&#21462;&#28040;&#20301;&#32622;&#21442;&#25968;&#30340;&#23450;&#20041;&#12290;&#21542;&#21017;&#65292;&#20301;&#32622;&#21442;&#25968;&#23558;&#35774;&#32622;&#20026; arg&#65292;&#21363;&#20351;&#23427;&#20204;&#20197; - &#24320;&#22987;&#12290;
-&#36890;&#30693;&#20449;&#21495;&#30340;&#32467;&#26463;&#65292;&#20351;&#24471;&#25152;&#26377;&#21097;&#20313;&#30340;&#160;arg&#160;&#34987;&#36171;&#20104;&#20301;&#32622;&#21442;&#25968;&#12290;-x &#21644; -v &#36873;&#39033;&#34987;&#20851;&#38381;&#12290;&#22914;&#26524;&#27809;&#26377; arg&#65292;&#20301;&#32622;&#21442;&#25968;&#23558;&#19981;&#20250;&#25913;&#21464;&#12290;

&#21442;&#25968;
+&lt;&#21442;&#25968;&gt; : &#21462;&#28040;&#26576;&#20010;set&#26366;&#21551;&#21160;&#30340;&#21442;&#25968;&#12290;
</pre>
</div>


<div class="org-src-container">
<pre class="src src-sh">[root@k8s-m-21x121 ~]# set --  <span class="org-comment-delimiter"># </span><span class="org-comment">&#21462;&#28040;&#20301;&#32622;&#21442;&#25968;&#30340;&#23450;&#20041; 
</span>
[root@k8s-m-21x121 ~]# for((<span class="org-variable-name">i</span>=1;i&lt;=$<span class="org-variable-name">#</span>;i++)); <span class="org-keyword">do </span><span class="org-builtin">eval</span> echo <span class="org-string">\$</span>{<span class="org-variable-name">$</span>{<span class="org-variable-name">i</span>}}; <span class="org-keyword">done</span>
[root@k8s-m-21x121 ~]# set  1 2 3 <span class="org-comment-delimiter"># </span><span class="org-comment">&#23450;&#20041;&#20301;&#32622;&#21442;&#25968;
</span>[root@k8s-m-21x121 ~]# set  4 5 6  <span class="org-comment-delimiter"># </span><span class="org-comment">&#37325;&#26032;&#35774;&#32622;&#20301;&#32622;&#21442;&#25968;
</span>[root@k8s-m-21x121 ~]# for((<span class="org-variable-name">i</span>=1;i&lt;=$<span class="org-variable-name">#</span>;i++)); <span class="org-keyword">do </span><span class="org-builtin">eval</span> echo <span class="org-string">\$</span>{<span class="org-variable-name">$</span>{<span class="org-variable-name">i</span>}}; <span class="org-keyword">done</span>
4
5
6
[root@k8s-m-21x121 ~]# set -- <span class="org-comment-delimiter"># </span><span class="org-comment">&#21462;&#28040;&#20301;&#32622;&#21442;&#25968;&#30340;&#23450;&#20041; 
</span>[root@k8s-m-21x121 ~]# for((<span class="org-variable-name">i</span>=1;i&lt;=$<span class="org-variable-name">#</span>;i++)); <span class="org-keyword">do </span><span class="org-builtin">eval</span> echo <span class="org-string">\$</span>{<span class="org-variable-name">$</span>{<span class="org-variable-name">i</span>}}; <span class="org-keyword">done</span>
[root@k8s-m-21x121 ~]# set  1 2 3 
[root@k8s-m-21x121 ~]# set -- a b c <span class="org-comment-delimiter"># </span><span class="org-comment">&#21462;&#28040;&#24182;&#37325;&#26032;&#35774;&#32622;&#20301;&#32622;&#21442;&#25968;
</span>[root@k8s-m-21x121 ~]# for((<span class="org-variable-name">i</span>=1;i&lt;=$<span class="org-variable-name">#</span>;i++)); <span class="org-keyword">do </span><span class="org-builtin">eval</span> echo <span class="org-string">\$</span>{<span class="org-variable-name">$</span>{<span class="org-variable-name">i</span>}}; <span class="org-keyword">done</span>
a
b
c
</pre>
</div>

<p>
<b>set 命令实现脚本安全</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">-u &#22312;&#25193;&#23637;&#19968;&#20010;&#27809;&#26377;&#35774;&#32622;&#30340;&#21464;&#37327;&#26102;&#65292;&#26174;&#31034;&#38169;&#35823;&#20449;&#24687;&#65292; &#31561;&#21516;set -o nounset
-e &#22914;&#26524;&#19968;&#20010;&#21629;&#20196;&#36820;&#22238;&#19968;&#20010;&#38750;0&#36864;&#20986;&#29366;&#24577;&#20540;(&#22833;&#36133;)&#23601;&#36864;&#20986;&#65292; &#31561;&#21516;set -o <span class="org-variable-name">errexit</span>=on
<span class="org-builtin">set</span> -C &#31105;&#27490;&#23558;&#20869;&#23481;&#35206;&#30422;&#24050;&#26377;&#25991;&#20214;,&#20294;&#21487;&#36861;&#21152;&#65292; &#31561;&#21516;set -o noclobber &#12290;&#21033;&#29992; &gt;| &#20173;&#21487;&#24378;&#21046;&#35206;&#30422;

-o option &#26174;&#31034;&#65292;&#25171;&#24320;&#25110;&#32773;&#20851;&#38381;&#36873;&#39033;
    &#26174;&#31034;&#36873;&#39033;&#65306;set -o
    &#25171;&#24320;&#36873;&#39033;&#65306;set -o &#36873;&#39033;
    &#20851;&#38381;&#36873;&#39033;&#65306;set +o &#36873;&#39033;
-x &#24403;&#25191;&#34892;&#21629;&#20196;&#26102;&#65292;&#25171;&#21360;&#21629;&#20196;&#21450;&#20854;&#21442;&#25968;,&#31867;&#20284; bash -x
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#set -o
allexport   off
braceexpand  on
emacs     on
errexit    off
nounset         off
&#12290;&#12290;&#12290;
xtrace     off
</pre>
</div>

<p>
范例：及时止损
</p>

<div class="org-src-container">
<pre class="src src-sh">cat &lt;&lt; EOF &gt;set_safe.sh <span class="org-sh-heredoc">
#!/bin/env bash
#
set -ue
echo 11
xxx
echo 22
EOF
</span>
[root@middle-ware ~/learn] <span class="org-variable-name">eth0</span> = 10.0.1.86
<span class="org-comment-delimiter"># </span><span class="org-comment">bash set_safe.sh 
</span>11
set_safe.sh: line 15: xxx: command not found
</pre>
</div>

<p>
<b>关闭和启用{}的扩展功能</b>
</p>

<p>
范例: 
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#echo $<span class="org-variable-name">-</span>
himBHs
[root@centos8 ~]#echo {1..10}
1 2 3 4 5 6 7 8 9 10
[root@centos8 ~]#set +B
[root@centos8 ~]#echo $<span class="org-variable-name">-</span>
himHs
[root@centos8 ~]#echo {1..10}
{1..10}
[root@centos8 ~]#set -B
[root@centos8 ~]#echo $<span class="org-variable-name">-</span>
himBHs
[root@centos8 ~]#echo {1..10}
1 2 3 4 5 6 7 8 9 10
</pre>
</div>
</div>
</div>
<div id="outline-container-枚举变量" class="outline-4">
<h4 id="枚举变量"><a href="#枚举变量">枚举变量</a></h4>
<div class="outline-text-4" id="text-枚举变量">
<p>
<code>${!prefix*}</code>: 扩展为名称以 prefix 开始的变量名，以特殊变量 IFS的第一
个字符分隔。
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">c_1</span>=a
<span class="org-variable-name">c_2</span>=b
<span class="org-keyword">for</span> i<span class="org-keyword"> in</span> ${<span class="org-variable-name">!</span>c_@};<span class="org-keyword">do </span><span class="org-builtin">echo</span> <span class="org-string">"\$i=$i, \${!i}=${!i}"</span>;<span class="org-keyword">done</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">&#36755;&#20986;
</span>$<span class="org-variable-name">i</span>=c_1, ${<span class="org-variable-name">!</span>i}=a
$<span class="org-variable-name">i</span>=c_2, ${<span class="org-variable-name">!</span>i}=b
</pre>
</div>

<p>
范例：简易数据库与序列化
</p>

<div class="org-src-container">
<pre class="src src-sh">cat &lt;&lt;\EOF&gt; a.sh <span class="org-sh-heredoc">
#!/bin/bash

load_db()
{
    [ -e /tmp/db ] &amp;&amp; source /tmp/db
}

save_db()
{
    for var in ${!DB_@}; do
        echo "$var=${!var}" &gt; /tmp/db
    done
}

DB_A=0
load_db
((DB_A++))
save_db
echo $DB_A

cat /proc/sys/kernel/random/uuid  #&#21487;&#29992;&#20110;&#24322;&#27493;id 
EOF
</span>
&#25191;&#34892;
<span class="org-comment-delimiter"># </span><span class="org-comment">bash a.sh
</span>1
aa25bbf0-17c7-4bc9-9ec7-a05df181660b
<span class="org-comment-delimiter"># </span><span class="org-comment">bash a.sh
</span>2
828830bd-d5b0-4de5-a46c-9c164549c10a
<span class="org-comment-delimiter"># </span><span class="org-comment">bash a.sh
</span>3
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-bash选项" class="outline-3">
<h3 id="bash选项"><a href="#bash选项">bash选项</a></h3>
<div class="outline-text-3" id="text-bash选项">
<p>
除了在 set 内建命令的文档中讲述的单字符选项 (option) 之外，bash在启动
时还解释下列选项。
</p>

<dl class="org-dl">
<dt><code>-s</code></dt><dd>如果有 -s 选项，或者如果选项处理完以后，没有参数剩余，那么命
令将从标准输入读取。这个选项允许在启动一个交互 shell 时可以设置位置参数。</dd>

<dt><code>--</code></dt><dd><code>--</code> 标志选项的结束，禁止其余的选项处理。任何 <code>--</code> 之后的参
数将作为文件名和参数对待。参数 <code>-</code> 与此等价。</dd>
</dl>
</div>
<div id="outline-container-交互shell设置位置参数" class="outline-4">
<h4 id="交互shell设置位置参数"><a href="#交互shell设置位置参数">交互shell设置位置参数</a></h4>
<div class="outline-text-4" id="text-交互shell设置位置参数">
<div class="org-src-container">
<pre class="src src-sh">root@k8s-m-21x121 ~]# cat a.sh
<span class="org-builtin">set</span> -e
<span class="org-builtin">echo</span> <span class="org-string">'$#:'</span> $<span class="org-variable-name">#</span>
<span class="org-builtin">echo</span> $<span class="org-variable-name">@</span>
[root@k8s-m-21x121 ~]# cat a.sh|bash 
$<span class="org-variable-name">#</span>: 0

[root@k8s-m-21x121 ~]# cat a.sh|bash a
bash: a: No such file or directory
</pre>
</div>

<p>
交互shell时，无法将 a 作为参考传送的。
</p>

<p>
<code>-s</code> 可以等待bash的选项处理完后，将剩下的作为位置参数传输。
</p>

<pre class="example" id="orga82a6f7">
[root@k8s-m-21x121 ~]# cat a.sh|bash -s  a
$#: 1
a
[root@k8s-m-21x121 ~]# cat a.sh|&amp; bash  -s -x -a b c 
+ set -e
+ echo '$#:' 2
$#: 2
+ echo b c
b c
</pre>

<p>
<code>--</code> 标志选项的结束，禁止其余的选项处理。任何 <code>--</code> 之后的参数将作为文
件名和参数对待。
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@k8s-m-21x121 ~]# cat a.sh|bash -s -- a
$<span class="org-variable-name">#</span>: 1
a
[root@k8s-m-21x121 ~]# cat a.sh|bash -s -- a b c 
$<span class="org-variable-name">#</span>: 3
a b c

[root@k8s-m-21x121 ~]# cat a.sh|&amp; bash  -s -x -- -a b c 
+ set -e
+ echo <span class="org-string">'$#:'</span> 3
$<span class="org-variable-name">#</span>: 3
+ echo -a b c
-a b c
</pre>
</div>
</div>
</div>
<div id="outline-container-脚本所在目录" class="outline-4">
<h4 id="脚本所在目录"><a href="#脚本所在目录">脚本所在目录</a></h4>
<div class="outline-text-4" id="text-脚本所在目录">
<div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">DIR</span>=<span class="org-string">"$( cd "$( dirname "${BASH_SOURCE[0]}" )" &amp;&amp; pwd )"</span>
</pre>
</div>

<p>
当要获取脚本所在路径时，无论该脚本是被直接执行，还是被source加载，都应
当使用 <code>${BASH_SOURCE[0]}</code>
</p>

<p>
如果a.sh中source b.sh，b.sh中又source c.sh，如果想要获取最顶层a.sh脚本
的路径，可以在a.sh、b.sh、c.sh中使用 <code>dirname $0</code> ，也可以使用
<code>dirname ${BASH_SOURCE[-1]}</code> 。
</p>

<p>
即：
</p>

<div class="org-src-container">
<pre class="src src-sh">&#24819;&#35201;&#33719;&#24471;&#24403;&#21069;&#33050;&#26412;&#30340;&#36335;&#24452;&#65292;&#20351;&#29992;${<span class="org-variable-name">BASH_SOURCE</span>[0]}
&#24819;&#35201;&#33719;&#24471;&#26368;&#39030;&#23618;&#25191;&#34892;source&#21629;&#20196;&#30340;&#20027;&#35843;&#33050;&#26412;&#30340;&#36335;&#24452;&#65292;&#20351;&#29992;${<span class="org-variable-name">BASH_SOURCE</span>[-1]}&#25110;$<span class="org-variable-name">0</span>
</pre>
</div>

<p>
有些脚本是软链接文件，使用dirname之前，应当先使用=realpath=命令获取原
始文件的绝对路径。
</p>

<p>
例如，下面是进入当前脚本所在目录的一种方式：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">cd</span> <span class="org-string">"$(dirname "$(realpath "${BASH_SOURCE[0]}")")"</span>
</pre>
</div>

<p>
可定义一个shell函数，将其放在~/.bashrc中
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">function</span> <span class="org-function-name">get_script_dir</span>(){
  <span class="org-comment-delimiter"># </span><span class="org-comment">for i in "${BASH_SOURCE[@]}";do echo $i; done
</span>  <span class="org-builtin">local</span> <span class="org-variable-name">sourced</span>=0
  [ <span class="org-string">"x$1"</span> = <span class="org-string">"x-s"</span> ] &amp;&amp; <span class="org-variable-name">sourced</span>=1
  <span class="org-keyword">if</span> [ $<span class="org-variable-name">sourced</span> -eq 1 ];<span class="org-keyword">then</span>
    dirname <span class="org-string">"$(realpath "${BASH_SOURCE[1]}")"</span>
  <span class="org-keyword">else</span>
    dirname <span class="org-string">"$(realpath "${BASH_SOURCE[-1]}")"</span>
  <span class="org-keyword">fi</span>
}

<span class="org-builtin">export</span> -f get_script_dir
</pre>
</div>

<p>
注意，上面使用 <code>${BASH_SOURCE[-1]}</code> 获取以二进制方式执行的shell脚本所
在的路径，使用 <code>$​{BASH_SOURCE[1]}</code> 获取以source方式加载的shell脚本所在
路径。
</p>

<p>
之所以使用index=1而不是index=0，是因为该函数该函数定义在 <code>.bashrc</code> 中，
该文件 <code>~/.bashrc</code> 也是被source加载的，因此 <code>${BASH_SOURCE[0]}</code> 的值总
是 <code>.bashrc</code> 。
</p>

<p>
或者也可以这样理解，任何一个被调用shell函数内部的 <code>${FUNCNAME[0]}</code> 都
保存了该函数的名称，而 <code>${FUNCNAME[N]}</code> 总是定义于 <code>${BASH_SOURCE[N]}</code>
中，被调用于 <code>${BASH_SOURCE[N+1]}</code> 中。因此，在a.sh中调用.bashrc中定义
的get_script_dir函数，该函数内部的 <code>${FUNCNAME[0]}</code> 是函数
名，~\({BASH_SOURCE[0]}~ 是 =.bashrc= ， ~\)​{BASH_SOURCE[1]}~ 是a.sh。
</p>

<p>
定义好get_script_dir函数之后，source加载 <code>.bashrc</code> ，然后就可以在任意
shell脚本中使用该函数。
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">&#22312;&#34987;&#25191;&#34892;&#30340;shell&#33050;&#26412;&#20013;
</span><span class="org-builtin">cd</span> <span class="org-string">"$(get_script_dir)"</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">&#22312;&#34987;source&#30340;shell&#33050;&#26412;&#20013;
</span><span class="org-builtin">cd</span> <span class="org-string">"$(get_script_dir -s)"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-eof多行写入文件防止变量替换" class="outline-4">
<h4 id="eof多行写入文件防止变量替换"><a href="#eof多行写入文件防止变量替换">EOF多行写入文件防止变量替换</a></h4>
<div class="outline-text-4" id="text-eof多行写入文件防止变量替换">
<p>
问题描述：对多个变量及多行输出到文件，存在变量自动替换，当使用
<code>cat&lt;&lt;EOF</code> 不想对内容进行变量替换、命令替换、参数展开等
</p>

<p>
问题解决：转义特殊字符如 <code>$</code> <code>`</code> 等
</p>

<div class="org-src-container">
<pre class="src src-sh">&#19968;&#12289;&#23545; $&#183;<span class="org-string">\ </span>&#36827;&#34892;&#36716;&#20041;
cat &gt;&gt; a.sh &lt;&lt; EOF<span class="org-sh-heredoc">
echo \`hostname\`
echo $HOME
EOF
</span>
&#20108;&#12289;&#22312;&#20998;&#30028;&#31526;EOF&#21069;&#28155;&#21152;&#21453;&#26012;&#26464;<span class="org-string">\&#65292;</span>&#25110;&#32773;&#29992;&#21333;&#24341;&#21495;&#12289;&#21452;&#24341;&#21495;&#25324;&#36215;&#26469;
cat &lt;&lt; \EOF &gt;&gt; a.sh <span class="org-sh-heredoc">
echo `hostname`
echo $HOME
EOF
</span>
cat &gt;&gt; a.sh &lt;&lt; <span class="org-string">"EOF"</span><span class="org-sh-heredoc">
echo `hostname`
echo $HOME
EOF
</span>
cat &gt;&gt; a.sh &lt;&lt; <span class="org-string">'EOF'</span><span class="org-sh-heredoc">
echo `hostname`
echo $HOME
EOF</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-多行注释" class="outline-4">
<h4 id="多行注释"><a href="#多行注释">多行注释</a></h4>
<div class="outline-text-4" id="text-多行注释">
<p>
法1：在要注释的多行前增加#号
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@web01 ~]# cat o.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">echo "I am o"
</span><span class="org-comment-delimiter">#</span><span class="org-comment">echo "I am o"
</span><span class="org-comment-delimiter">#</span><span class="org-comment">echo "I am o"
</span><span class="org-builtin">echo</span> <span class="org-string">"I am o"</span>
[root@web01 ~]# sh o.sh
I am o
</pre>
</div>

<p>
法2：使用冒号配合追加输入重定向
</p>

<p>
冒号对它们啥都不做，就相当于没做任何处理和输出，就相当于注释了
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@web01 ~]# cat o.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span>:&lt;&lt;EOF<span class="org-sh-heredoc">
echo "I am o"
echo "I am o"
echo "I am o"
EOF #&lt;==&#39030;&#26684;&#20889;&#65292;&#21644;&#32769;&#30007;&#23401;&#32769;&#24072;&#35762;&#30340;cat&#21629;&#20196;&#36861;&#21152;&#22810;&#34892;&#25991;&#26412;&#26159;&#19968;&#20010;&#21407;&#29702;&#12290;
echo "I am o"
[root@web01 ~]# sh o.sh
I am o</span>
</pre>
</div>

<p>
法3：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@db03 scripts]# cat test1.sh 
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span>cat &gt;/dev/null &lt;&lt;EOF<span class="org-sh-heredoc">
echo "I am o"
echo "I am o"
echo "I am o"
EOF
</span><span class="org-builtin">echo</span> <span class="org-string">"I am o"</span>
</pre>
</div>

<p>
法4：
</p>

<div class="org-src-container">
<pre class="src src-sh">[ 0 -eq 1 ] &amp;&amp;{
<span class="org-builtin">echo</span> <span class="org-string">"I am o"</span>
<span class="org-builtin">echo</span> <span class="org-string">"I am o"</span>
<span class="org-builtin">echo</span> <span class="org-string">"I am o"</span>
}
<span class="org-builtin">echo</span> <span class="org-string">"I am o"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-长命令的换行以及注释处理" class="outline-4">
<h4 id="长命令的换行以及注释处理"><a href="#长命令的换行以及注释处理">长命令的换行以及注释处理</a></h4>
<div class="outline-text-4" id="text-长命令的换行以及注释处理">
<div class="org-src-container">
<pre class="src src-sh">xxxx <span class="org-sh-escaped-newline">\</span>
a <span class="org-sh-quoted-exec">`# &#27880;&#37322;`</span> <span class="org-sh-escaped-newline">\</span>
b <span class="org-sh-escaped-newline">\</span>
c <span class="org-sh-escaped-newline">\</span>
<span class="org-sh-quoted-exec">`# d`</span> <span class="org-sh-escaped-newline">\</span>
e \bash
f <span class="org-sh-escaped-newline">\</span>
g


[root@k8s-master01 ~] <span class="org-variable-name">eth0</span> = 192.168.33.11
<span class="org-comment-delimiter"># </span><span class="org-comment">echo --a --b \
</span>&gt;      --c <span class="org-sh-escaped-newline">\</span>
&gt;      <span class="org-sh-quoted-exec">`# test`</span> <span class="org-sh-escaped-newline">\</span>
&gt;      <span class="org-sh-quoted-exec">`#--d
&gt;       #--e `</span> <span class="org-sh-escaped-newline">\</span>
&gt;       --f
--a --b --c --f
</pre>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-h:0d4b3171-2192-474a-897d-0686ca53e567" class="outline-2">
<h2 id="h:0d4b3171-2192-474a-897d-0686ca53e567"><a href="#h:0d4b3171-2192-474a-897d-0686ca53e567">set命令总结</a></h2>
<div class="outline-text-2" id="text-h:0d4b3171-2192-474a-897d-0686ca53e567">
<p>
set命令Shell内建命令
</p>

<p>
set命令作用主要是显示系统中已经存在的shell变量，以及设置shell变量的新
变量值。使用set更改shell特性时，符号”+"和"-“的作用分别是打开和关闭指
定的模式。set命令不能够定义新的shell变量。如果要定义新的变量，可以使用
declare命令以变量名=值的格式进行定义即可。
</p>

<p>
参考： <a href="https://www.gnu.org/software/bash/manual/bash.html#The-Set-Builtin">https://www.gnu.org/software/bash/manual/bash.html#The-Set-Builtin</a>
</p>

<p>
语法 set(选项)(参数) 选项
</p>

<div class="org-src-container">
<pre class="src src-sh">-a&#65306;&#26631;&#31034;&#24050;&#20462;&#25913;&#30340;&#21464;&#37327;&#65292;&#20197;&#20379;&#36755;&#20986;&#33267;&#29615;&#22659;&#21464;&#37327;&#12290;
-b&#65306;&#20351;&#34987;&#20013;&#27490;&#30340;&#21518;&#21488;&#31243;&#24207;&#31435;&#21051;&#22238;&#25253;&#25191;&#34892;&#29366;&#24577;&#12290;
-C&#65306;&#22914;&#26524;&#35774;&#32622;&#30340;&#35805;&#65292;bash&#20351;&#29992;&#37325;&#23450;&#21521;&#25805;&#20316;&#31526; &gt;, &gt;&amp;, &#21644; &lt;&gt; &#26102;&#65292;&#19981;&#20250;&#35206;&#30422;&#24050;&#23384;&#22312;&#30340;&#25991;&#20214;&#12290;&#21487;&#20197;&#20351;&#29992;&#37325;&#23450;&#21521;&#25805;&#20316;&#31526; &gt;| &#20195;&#26367;&#160;&gt;&#160;&#26469;&#21019;&#24314;&#36755;&#20986;&#25991;&#20214;&#65292;&#20174;&#32780;&#32469;&#36807;&#36825;&#20010;&#38480;&#21046;&#12290;
-d&#65306;Shell&#39044;&#35774;&#20250;&#29992;&#26434;&#20945;&#34920;&#35760;&#24518;&#20351;&#29992;&#36807;&#30340;&#25351;&#20196;&#65292;&#20197;&#21152;&#36895;&#25351;&#20196;&#30340;&#25191;&#34892;&#12290;&#20351;&#29992;-d&#21442;&#25968;&#21487;&#21462;&#28040;&#12290;
-e&#65306;&#33509;&#25351;&#20196;&#20256;&#22238;&#20540;&#19981;&#31561;&#20110;0&#65292;&#21017;&#31435;&#21363;&#36864;&#20986;shell&#12290;
-f&#65306;&#21462;&#28040;&#20351;&#29992;&#36890;&#37197;&#31526;&#12290;
-h&#65306;&#33258;&#21160;&#35760;&#24405;&#20989;&#25968;&#30340;&#25152;&#22312;&#20301;&#32622;&#12290;
-H Shell&#65306;&#21487;&#21033;&#29992;<span class="org-string">"!"</span>&#21152;&lt;&#25351;&#20196;&#32534;&#21495;&gt;&#30340;&#26041;&#24335;&#26469;&#25191;&#34892;history&#20013;&#35760;&#24405;&#30340;&#25351;&#20196;&#12290;
-k&#65306;&#25351;&#20196;&#25152;&#32473;&#30340;&#21442;&#25968;&#37117;&#20250;&#34987;&#35270;&#20026;&#27492;&#25351;&#20196;&#30340;&#29615;&#22659;&#21464;&#37327;&#12290;
-l&#65306;&#35760;&#24405;for&#24490;&#29615;&#30340;&#21464;&#37327;&#21517;&#31216;&#12290;
-m&#65306;&#20351;&#29992;&#30417;&#35270;&#27169;&#24335;&#12290;
-n&#65306;&#21482;&#35835;&#21462;&#25351;&#20196;&#65292;&#32780;&#19981;&#23454;&#38469;&#25191;&#34892;&#12290;
-p&#65306;&#21551;&#21160;&#20248;&#20808;&#39034;&#24207;&#27169;&#24335;&#12290;
-P&#65306;&#21551;&#21160;-P&#21442;&#25968;&#21518;&#65292;&#25191;&#34892;&#25351;&#20196;&#26102;&#65292;&#20250;&#20197;&#23454;&#38469;&#30340;&#25991;&#20214;&#25110;&#30446;&#24405;&#26469;&#21462;&#20195;&#31526;&#21495;&#36830;&#25509;&#12290;
-t&#65306;&#25191;&#34892;&#23436;&#38543;&#21518;&#30340;&#25351;&#20196;&#65292;&#21363;&#36864;&#20986;shell&#12290;
-u&#65306;&#24403;&#25191;&#34892;&#26102;&#20351;&#29992;&#21040;&#26410;&#23450;&#20041;&#36807;&#30340;&#21464;&#37327;&#65292;&#21017;&#26174;&#31034;&#38169;&#35823;&#20449;&#24687;&#12290;
-v&#65306;&#26174;&#31034;shell&#25152;&#35835;&#21462;&#30340;&#36755;&#20837;&#20540;&#12290;
-x&#65306;&#25191;&#34892;&#25351;&#20196;&#21518;&#65292;&#20250;&#20808;&#26174;&#31034;&#35813;&#25351;&#20196;&#21450;&#25152;&#19979;&#30340;&#21442;&#25968;&#12290;
--&#22914;&#26524;&#36825;&#20010;&#36873;&#39033;&#27809;&#26377;&#21442;&#25968;&#65292;&#23558;&#21462;&#28040;&#20301;&#32622;&#21442;&#25968;&#30340;&#23450;&#20041;&#12290;&#21542;&#21017;&#65292;&#20301;&#32622;&#21442;&#25968;&#23558;&#35774;&#32622;&#20026; arg&#65292;&#21363;&#20351;&#23427;&#20204;&#20197; - &#24320;&#22987;&#12290;
-&#36890;&#30693;&#20449;&#21495;&#30340;&#32467;&#26463;&#65292;&#20351;&#24471;&#25152;&#26377;&#21097;&#20313;&#30340;&#160;arg&#160;&#34987;&#36171;&#20104;&#20301;&#32622;&#21442;&#25968;&#12290;-x &#21644; -v &#36873;&#39033;&#34987;&#20851;&#38381;&#12290;&#22914;&#26524;&#27809;&#26377; arg&#65292;&#20301;&#32622;&#21442;&#25968;&#23558;&#19981;&#20250;&#25913;&#21464;&#12290;

&#21442;&#25968;
+&lt;&#21442;&#25968;&gt; : &#21462;&#28040;&#26576;&#20010;set&#26366;&#21551;&#21160;&#30340;&#21442;&#25968;&#12290;
</pre>
</div>

<p>
显示已定义的所有变量
</p>
<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">set</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">&#21024;&#38500;&#21464;&#37327;
</span><span class="org-builtin">unset</span> &lt;name&gt;
</pre>
</div>
</div>
<div id="outline-container-h:eb4430e3-1a38-43f7-af88-41c103a562a5" class="outline-3">
<h3 id="h:eb4430e3-1a38-43f7-af88-41c103a562a5"><a href="#h:eb4430e3-1a38-43f7-af88-41c103a562a5">位置参数</a></h3>
<div class="outline-text-3" id="text-h:eb4430e3-1a38-43f7-af88-41c103a562a5">
<div class="org-src-container">
<pre class="src src-sh">[root@k8s-m-21x121 ~]# set --  <span class="org-comment-delimiter"># </span><span class="org-comment">&#21462;&#28040;&#20301;&#32622;&#21442;&#25968;&#30340;&#23450;&#20041; 
</span>
[root@k8s-m-21x121 ~]# for((<span class="org-variable-name">i</span>=1;i&lt;=$<span class="org-variable-name">#</span>;i++)); <span class="org-keyword">do </span><span class="org-builtin">eval</span> echo <span class="org-string">\$</span>{<span class="org-variable-name">$</span>{<span class="org-variable-name">i</span>}}; <span class="org-keyword">done</span>
[root@k8s-m-21x121 ~]# set  1 2 3 <span class="org-comment-delimiter"># </span><span class="org-comment">&#23450;&#20041;&#20301;&#32622;&#21442;&#25968;
</span>[root@k8s-m-21x121 ~]# set  4 5 6  <span class="org-comment-delimiter"># </span><span class="org-comment">&#37325;&#26032;&#35774;&#32622;&#20301;&#32622;&#21442;&#25968;
</span>[root@k8s-m-21x121 ~]# for((<span class="org-variable-name">i</span>=1;i&lt;=$<span class="org-variable-name">#</span>;i++)); <span class="org-keyword">do </span><span class="org-builtin">eval</span> echo <span class="org-string">\$</span>{<span class="org-variable-name">$</span>{<span class="org-variable-name">i</span>}}; <span class="org-keyword">done</span>
4
5
6
[root@k8s-m-21x121 ~]# set -- <span class="org-comment-delimiter"># </span><span class="org-comment">&#21462;&#28040;&#20301;&#32622;&#21442;&#25968;&#30340;&#23450;&#20041; 
</span>[root@k8s-m-21x121 ~]# for((<span class="org-variable-name">i</span>=1;i&lt;=$<span class="org-variable-name">#</span>;i++)); <span class="org-keyword">do </span><span class="org-builtin">eval</span> echo <span class="org-string">\$</span>{<span class="org-variable-name">$</span>{<span class="org-variable-name">i</span>}}; <span class="org-keyword">done</span>
[root@k8s-m-21x121 ~]# set  1 2 3 
[root@k8s-m-21x121 ~]# set -- a b c <span class="org-comment-delimiter"># </span><span class="org-comment">&#21462;&#28040;&#24182;&#37325;&#26032;&#35774;&#32622;&#20301;&#32622;&#21442;&#25968;
</span>[root@k8s-m-21x121 ~]# for((<span class="org-variable-name">i</span>=1;i&lt;=$<span class="org-variable-name">#</span>;i++)); <span class="org-keyword">do </span><span class="org-builtin">eval</span> echo <span class="org-string">\$</span>{<span class="org-variable-name">$</span>{<span class="org-variable-name">i</span>}}; <span class="org-keyword">done</span>
a
b
c
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d093911d-ab87-424a-b1c1-303674e0d01e" class="outline-3">
<h3 id="h:d093911d-ab87-424a-b1c1-303674e0d01e"><a href="#h:d093911d-ab87-424a-b1c1-303674e0d01e">set 命令实现脚本安全</a></h3>
<div class="outline-text-3" id="text-h:d093911d-ab87-424a-b1c1-303674e0d01e">
<p>
<b>$- 变量</b> : 当前bash的参数
</p>

<p>
变量输出说明：
</p>
<ul class="org-ul">
<li>h：hashall，打开选项后，Shell 会将命令所在的路径 hash 下来，避免每次都
要查询。通过 <code>set +h</code> 将h选项关闭</li>
<li>i：interactive-comments，包含这个选项说明当前的 shell 是一个交互式的
shell。所谓的交互式 shell，在脚本中，i 选项是关闭的</li>
<li>m：monitor，打开监控模式，就可以通过Job control来控制进程的停止、继
续，后台或者前台执行等</li>
<li>B：braceexpand，大括号扩展</li>
<li>H：history，H 选项打开，可以展开历史列表中的命令，可以通过 ! 感叹号
来完成，例如“!!”返回上最近的一个历史命令，“!n”返回第 n 个历史命令</li>
</ul>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#echo $<span class="org-variable-name">-</span>
himBHs

[root@centos8 ~]#set +h <span class="org-comment-delimiter">#</span><span class="org-comment">&#20851;&#38381;hash
</span>[root@centos8 ~]#echo $<span class="org-variable-name">-</span>
imBHs
[root@centos8 ~]#hash
-bash: hash: hashing disabled

[root@centos8 ~]#echo {1..10}
1 2 3 4 5 6 7 8 9 10
[root@centos8 ~]#echo $<span class="org-variable-name">-</span>
imBHs
[root@centos8 ~]#set +B <span class="org-comment-delimiter"># </span><span class="org-comment">&#20851;&#38381;&#22823;&#25324;&#21495;&#25193;&#23637;
</span>[root@centos8 ~]#echo $<span class="org-variable-name">-</span>
imHs
[root@centos8 ~]#echo {1..10}
{1..10}
</pre>
</div>


<div class="org-src-container">
<pre class="src src-sh">-u &#22312;&#25193;&#23637;&#19968;&#20010;&#27809;&#26377;&#35774;&#32622;&#30340;&#21464;&#37327;&#26102;&#65292;&#26174;&#31034;&#38169;&#35823;&#20449;&#24687;&#65292; &#31561;&#21516;set -o nounset
-e &#22914;&#26524;&#19968;&#20010;&#21629;&#20196;&#36820;&#22238;&#19968;&#20010;&#38750;0&#36864;&#20986;&#29366;&#24577;&#20540;(&#22833;&#36133;)&#23601;&#36864;&#20986;&#65292; &#31561;&#21516;set -o <span class="org-variable-name">errexit</span>=on
<span class="org-builtin">set</span> -C &#31105;&#27490;&#23558;&#20869;&#23481;&#35206;&#30422;&#24050;&#26377;&#25991;&#20214;,&#20294;&#21487;&#36861;&#21152;&#65292; &#31561;&#21516;set -o noclobber &#12290;&#21033;&#29992; &gt;| &#20173;&#21487;&#24378;&#21046;&#35206;&#30422;

-o option &#26174;&#31034;&#65292;&#25171;&#24320;&#25110;&#32773;&#20851;&#38381;&#36873;&#39033;
    &#26174;&#31034;&#36873;&#39033;&#65306;set -o
    &#25171;&#24320;&#36873;&#39033;&#65306;set -o &#36873;&#39033;
    &#20851;&#38381;&#36873;&#39033;&#65306;set +o &#36873;&#39033;
-x &#24403;&#25191;&#34892;&#21629;&#20196;&#26102;&#65292;&#25171;&#21360;&#21629;&#20196;&#21450;&#20854;&#21442;&#25968;,&#31867;&#20284; bash -x
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span><span class="org-builtin">set</span> -o errexit  <span class="org-comment-delimiter">#</span><span class="org-comment">&#19982; -e &#30456;&#21516;
</span><span class="org-builtin">set</span> -o nounset <span class="org-comment-delimiter">#</span><span class="org-comment">&#19982; -u &#30456;&#21516;
</span><span class="org-builtin">set</span> -o pipefail
</pre>
</div>


<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#26597;&#30475;&#25152;&#26377;&#36873;&#39033;&#40664;&#35748;&#20540;
</span>[root@centos8 ~]#set -o
allexport   off
braceexpand  on
emacs     on
errexit    off
nounset         off
&#12290;&#12290;&#12290;
xtrace     off
</pre>
</div>

<p>
范例：及时止损
</p>
<div class="org-src-container">
<pre class="src src-sh">cat &lt;&lt; EOF &gt;set_safe.sh <span class="org-sh-heredoc">
#!/bin/env bash
#
set -ue
echo 11
xxx
echo 22
EOF
</span>
[root@middle-ware ~/learn] <span class="org-variable-name">eth0</span> = 10.0.1.86
<span class="org-comment-delimiter"># </span><span class="org-comment">bash set_safe.sh 
</span>11
set_safe.sh: line 15: xxx: command not found
</pre>
</div>

<p>
<b>关闭和启用{}的扩展功能</b>
</p>

<p>
范例: 
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#echo $<span class="org-variable-name">-</span>
himBHs
[root@centos8 ~]#echo {1..10}
1 2 3 4 5 6 7 8 9 10
[root@centos8 ~]#set +B
[root@centos8 ~]#echo $<span class="org-variable-name">-</span>
himHs
[root@centos8 ~]#echo {1..10}
{1..10}
[root@centos8 ~]#set -B
[root@centos8 ~]#echo $<span class="org-variable-name">-</span>
himBHs
[root@centos8 ~]#echo {1..10}
1 2 3 4 5 6 7 8 9 10
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#20020;&#26102;&#31105;&#29992;&#21382;&#21490;&#35760;&#24405;
</span>[space]set +o history
<span class="org-comment-delimiter">#</span><span class="org-comment">&#24674;&#22797;&#21382;&#21490;&#21151;&#33021;
</span>[Space]set -o history 
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-设计shell脚本选项getopt" class="outline-2">
<h2 id="设计shell脚本选项getopt"><a href="#设计shell脚本选项getopt">设计shell脚本选项：getopt</a></h2>
<div class="outline-text-2" id="text-设计shell脚本选项getopt">
<div class="org-src-container">
<pre class="src src-sh">cat &lt;&lt;\EOF &gt;a.sh<span class="org-sh-heredoc">
#!/usr/bin/env bash

function show_help() {
echo help
}
# Get Opts
while getopts "hsr:i:d:t:k:" opt; do
    case "$opt" in
    h)  show_help
        ;;
    s)  SKIP=1
        ;;
    r)  REVERSE_CIDRS="$REVERSE_CIDRS $OPTARG"
        ;;
    i)  CLUSTER_DNS_IP=$OPTARG
        ;;
    d)  CLUSTER_DOMAIN=$OPTARG
        ;;
    t)  YAML_TEMPLATE=$OPTARG
        ;;
    esac
done
EOF
</span>
[root@k8s-m1 ~]# bash a.sh -h
help
</pre>
</div>

<p>
写shell脚本的时候，通过while、case、shift来设计脚本的命令行选项是一件
比较麻烦的事，getopt命令可以解析命令行的选项和参数，将散乱、自由的命令
行选项和参数进行改造，得到一个完整的、规范化的参数列表。
</p>

<p>
getopt有不同的版本，本文介绍的是它的增强版(enhanced)，相比传统的
getopt(也称为兼容版本的getopt)，它提供了引号保护的能力。另外，除了不同
版本的getopt，bash还有一个内置命令getopts(注意，有个尾随的字符s)，也用
来解析命令行选项，但只能解析短选项。
</p>

<p>
要验证安装的getopt是增强版的还是传统版的，使用 <code>getopt -T</code> 判断即可。
如果它什么都不输出，则是增强版，此时它的退出状态码为4。如果输出”&#x2013;“，
则是传统版的getopt，此时它的退出状态码为0。如果想在脚本中进行版本检查，
可以参考如下代码：
</p>

<div class="org-src-container">
<pre class="src src-sh">getopt -T &amp;&gt;/dev/null;[ $<span class="org-variable-name">?</span> -ne 4 ] &amp;&amp; { <span class="org-builtin">echo</span> <span class="org-string">"not enhanced version"</span>;<span class="org-keyword">exit</span> 1; }
</pre>
</div>
</div>
<div id="outline-container-命令行选项的那些事" class="outline-3">
<h3 id="命令行选项的那些事"><a href="#命令行选项的那些事">命令行选项的那些事</a></h3>
<div class="outline-text-3" id="text-命令行选项的那些事">
<p>
在学习getopt如何使用之前，必须先知道命令行的一些常识。这些，都可以通过
getopt来实现，但有些实现起来可能会比较复杂。
</p>
</div>
<div id="outline-container-区分optionparameterargumentoption-argument和non-option-parameter" class="outline-4">
<h4 id="区分optionparameterargumentoption-argument和non-option-parameter"><a href="#区分optionparameterargumentoption-argument和non-option-parameter">1.区分option、parameter、argument、option argument和non-option parameter</a></h4>
<div class="outline-text-4" id="text-区分optionparameterargumentoption-argument和non-option-parameter">
<ul class="org-ul">
<li><p>
parameter 表示独立性的参数，含义更广
</p>

<p>
定义函数时function foo(x,y){CODE}，函数的参数x和y称为parameter
</p></li>

<li><p>
argument 表示依赖于其它实体的参数。可以看作parameter的一种
</p>

<p>
foo(arg1,arg2)中的arg1和arg2都是依赖于函数的，称为argument更合适，当
然也可以称为更广泛的parameter。
</p></li>
</ul>


<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">tar -zcf a.tar.gz /etc/pki
</pre>
</div>

<p>
粗分的话，-z、-c、-f、a.tar.gz、/etc/pki都可以称为parameter。细分的话：
</p>

<p>
"-z -c -f"称为选项，即option
</p>

<p>
a.tar.gz是选项”-f”的选项参数(传递给选项的参数)，依赖于选项，称为
argument更合适，更严格的称呼是option argument
</p>

<p>
/etc/pki既不属于选项，也不属于某个选项的参数，它称为非选项类型的参数，
对应的名称为non-option parameter
</p>

<p>
本文要介绍的是getopt，所以只考虑命令行参数的情况。
</p>
</div>
</div>
<div id="outline-container-短选项和长选项以及它们的潜规则" class="outline-4">
<h4 id="短选项和长选项以及它们的潜规则"><a href="#短选项和长选项以及它们的潜规则">2.短选项和长选项以及它们的”潜规则”</a></h4>
<div class="outline-text-4" id="text-短选项和长选项以及它们的潜规则">
<p>
Linux中绝大多数命令都提供了短选项和长选项。
</p>

<dl class="org-dl">
<dt>短选项</dt><dd><p>
-，只使用一个”-“开头，选项部分只使用一个字符，多个短选项
连接在一起
</p>

<p>
但如果连在一起的短选项有参数的话，则必须作为串联的最后一个字符
</p>

<p>
短选项的参数可以和选项名称连在一起，也可以是用空白分隔。
</p>

<p>
短选项的参数是可选的，那么它的参数必须紧跟在选项名后面，不能使用空格
分开。至于为什么，见下面讲解
</p></dd>

<dt>长选项</dt><dd><p>
&#x2013; ，两个短横线(即”&#x2013;“)开头的。
</p>

<p>
使用等号或空白连接两种方式提供选项参数
</p>

<p>
某个长选项的参数是可选的，那么它的参数必须使用”=“连接。至于为什么，见下面讲解
</p>

<p>
长选项一般可以缩写，只要不产生歧义即可
</p></dd>
</dl>

<div class="org-src-container">
<pre class="src src-sh">&#22914;
<span class="org-comment-delimiter"># </span><span class="org-comment">&#30701;&#36873;&#39033;
</span>-a
-avz &#20854;&#23454;&#20250;&#34987;&#35299;&#26512;&#20026;<span class="org-string">"-a -v -z"</span>
tar -zcf a.tar.gz&#20018;&#32852;&#20102;&#22810;&#20010;&#30701;&#36873;&#39033;&#65292;&#20294;<span class="org-string">"-f"</span>&#36873;&#39033;&#26377;&#21442;&#25968;a.tar.gz&#65292;&#25152;&#20197;&#23427;&#24517;&#39035;&#20316;&#20026;&#20018;&#32852;&#36873;&#39033;&#30340;&#26368;&#21518;&#19968;&#20010;&#23383;&#31526;&#12290;
-n 3&#21644;-n3&#26159;&#31561;&#20215;&#30340;&#65292;&#25968;&#20540;3&#37117;&#26159;<span class="org-string">"-n"</span>&#36873;&#39033;&#30340;&#21442;&#25968;&#20540;

<span class="org-comment-delimiter"># </span><span class="org-comment">&#38271;&#36873;&#39033;
</span>--append 
--file=FILE&#25110;--file FILE
</pre>
</div>

<p>
例如，ls命令，以”a”开头的长选项有3个。
</p>

<div class="org-src-container">
<pre class="src src-sh">$ ls --help | grep -- <span class="org-string">'--a'</span>
-a, --all<span class="org-keyword"> do</span> not ignore entries starting with .
-A, --almost-all<span class="org-keyword"> do</span> not list implied . and ..
--author with -l, print the author of each file
</pre>
</div>

<p>
如果想要指定&#x2013;almost-all，可以缩写为&#x2013;alm；如果想要指定&#x2013;author，可以
缩写为&#x2013;au。如果只缩写为”&#x2013;a”，bash将给出错误提示，长选项出现歧义：
</p>

<div class="org-src-container">
<pre class="src src-sh">$ ls --a
ls: option <span class="org-string">'--a'</span> is ambiguous; possibilities: <span class="org-string">'--all'</span> <span class="org-string">'--author'</span> <span class="org-string">'--almost-all'</span>
Try <span class="org-string">'ls --help'</span> for more information.
</pre>
</div>
</div>
</div>
<div id="outline-container-不带参数的选项可选参数的选项和带参数的选项" class="outline-4">
<h4 id="不带参数的选项可选参数的选项和带参数的选项"><a href="#不带参数的选项可选参数的选项和带参数的选项">3.不带参数的选项、可选参数的选项和带参数的选项</a></h4>
<div class="outline-text-4" id="text-不带参数的选项可选参数的选项和带参数的选项">
<p>
有不同类型的命令行选项，这些选项可能不需要参数，也可能参数是可选的，也
可能是强制要求参数的。
</p>

<p>
前面说了，如果某个选项的参数是可选的，那么它的参数必须不能使用空格将参
数和选项分开。如果使用空格分隔，则无法判断它的下一个元素是该选项的参数
还是非选项类型的参数。
</p>

<p>
例如，-c和&#x2013;config选项的参数是可选的，要向这两个选项提供参数，必须写
成-cFILE、&#x2013;config=FILE，如果写成-c FILE、&#x2013;config FILE，那么命令行将
无法判断这个FILE是提供给选项的参数，还是非选项类型的参数。
</p>

<p>
一般来说，使用可选参数的情况非常少，至少我目前回忆不起来这样的命令
(mysql -p选项是一个)。
</p>
</div>
</div>
<div id="outline-container-使用将选项及它们的选项参数与非选项类型参数进行分隔" class="outline-4">
<h4 id="使用将选项及它们的选项参数与非选项类型参数进行分隔"><a href="#使用将选项及它们的选项参数与非选项类型参数进行分隔">4.使用”&#x2013;“将选项(及它们的选项参数)与非选项类型参数进行分隔</a></h4>
<div class="outline-text-4" id="text-使用将选项及它们的选项参数与非选项类型参数进行分隔">
<p>
unix的命令行中，总是可以在非选项类型的参数之前加上”&#x2013;“，表示选项和选
项参数到此为止，后面的都是非选项类型的参数。
</p>

<p>
例如：
</p>

<div class="org-src-container">
<pre class="src src-sh">seq -w -- 3
seq -w -- 1 3
</pre>
</div>

<p>
分别表示3和”1
3”是seq的非选项类型参数，而”&#x2013;“前面的一定是选项或选项参数。
</p>
</div>
</div>
<div id="outline-container-命令行参数中的短横线开头的并不一定总是短选项也可能是负数参数" class="outline-4">
<h4 id="命令行参数中的短横线开头的并不一定总是短选项也可能是负数参数"><a href="#命令行参数中的短横线开头的并不一定总是短选项也可能是负数参数">5.命令行参数中的短横线开头的并不一定总是短选项，也可能是负数参数</a></h4>
<div class="outline-text-4" id="text-命令行参数中的短横线开头的并不一定总是短选项也可能是负数参数">
<p>
例如seq命令：
</p>

<div class="org-src-container">
<pre class="src src-sh">seq -w -5 -1 5
</pre>
</div>

<p>
其中-5和-1都是负数非选项类型的参数。
</p>
</div>
</div>
<div id="outline-container-选项的依赖性和互斥性" class="outline-4">
<h4 id="选项的依赖性和互斥性"><a href="#选项的依赖性和互斥性">6.选项的依赖性和互斥性</a></h4>
<div class="outline-text-4" id="text-选项的依赖性和互斥性">
<p>
有些命令的选项是有依赖性和互斥性的。比如某个选项要和另一个选项一起使用，
某个选项不能和另一个选项一起使用。
</p>

<p>
例如&#x2013;manage &#x2013;remove，只有在使用了&#x2013;manage的前提下才能使用&#x2013;remove，
否则就应该报错。
</p>
</div>
</div>
<div id="outline-container-模式化模块化类型的选项" class="outline-4">
<h4 id="模式化模块化类型的选项"><a href="#模式化模块化类型的选项">7.模式化(模块化)类型的选项</a></h4>
<div class="outline-text-4" id="text-模式化模块化类型的选项">
<p>
很多unix命令都将选项进行模块化设计。例如ip命令，address模式、route模式、
link模式等等。
</p>

<div class="org-src-container">
<pre class="src src-sh">ip addr OPTIONS
ip route OPTIONS
ip link OPTIONS
ip neigh OPTIONS
</pre>
</div>
</div>
</div>
<div id="outline-container-其他特性的选项" class="outline-4">
<h4 id="其他特性的选项"><a href="#其他特性的选项">8.其他特性的选项</a></h4>
<div class="outline-text-4" id="text-其他特性的选项">
<p>
有些命令还有比较个性化的选项。 比如head命令，-n
NUM选项，即可以指定为-3，也可以指定为-n 3或-n3。
再比如有的命令支持逻辑运算，例如find命令的-a、-o选项。
</p>
</div>
</div>
</div>
<div id="outline-container-getopt解析选项的工作机制" class="outline-3">
<h3 id="getopt解析选项的工作机制"><a href="#getopt解析选项的工作机制">getopt解析选项的工作机制</a></h3>
<div class="outline-text-3" id="text-getopt解析选项的工作机制">
<p>
bash的getopt命令经常用在shell脚本内部或函数内部，用来解析脚本执行或函
数执行时传递的选项、参数。
</p>

<p>
下面都以命令行为例解释getopt是如何解析参数的，但用来解析函数参数是一样
的。
</p>
</div>
<div id="outline-container-getopt选项" class="outline-4">
<h4 id="getopt选项"><a href="#getopt选项">1 getopt选项</a></h4>
<div class="outline-text-4" id="text-getopt选项">
<p>
下面这个是最常用的getopt解析方式(有这个命令就够了)。如果要了解getopt更
完整的语法，见man getopt。
</p>

<div class="org-src-container">
<pre class="src src-sh">getopt -o SHORT_OPTIONS -l LONG_OPTIONS -n <span class="org-string">"$0"</span> -- <span class="org-string">"$@"</span>
</pre>
</div>

<p>
其中：
</p>

<div class="org-src-container">
<pre class="src src-sh">-o SHORT_OPTIONS
--options SHORT_OPTIONS
getopt&#36890;&#36807;<span class="org-string">"-o"</span>&#36873;&#39033;&#25910;&#38598;&#21629;&#20196;&#34892;&#20256;&#36882;&#30340;&#30701;&#36873;&#39033;&#21644;&#23427;&#20204;&#23545;&#24212;&#30340;&#21442;&#25968;&#12290;&#20851;&#20110;SHORT_OPTIONS&#30340;&#26684;&#24335;&#35265;&#19979;&#19968;&#23567;&#33410;&#12290;

-l LONG_OPTIONS
--longoptions LONG_OPTIONS
getopt&#36890;&#36807;<span class="org-string">"-l"</span>&#36873;&#39033;&#25910;&#38598;&#21629;&#20196;&#34892;&#20256;&#36882;&#30340;&#38271;&#36873;&#39033;&#21644;&#23427;&#20204;&#23545;&#24212;&#30340;&#21442;&#25968;&#12290;&#21487;&#33021;&#20174;&#21035;&#20154;&#30340;&#33050;&#26412;&#20013;&#32463;&#24120;&#30475;&#21040;<span class="org-string">"--long"</span>&#65292;&#26159;&#31561;&#20215;&#30340;&#65292;&#21069;&#25991;&#24050;&#32463;&#35299;&#37322;&#36807;&#65292;&#38271;&#36873;&#39033;&#21482;&#35201;&#19981;&#20135;&#29983;&#27495;&#20041;&#65292;&#26159;&#21487;&#20197;&#36827;&#34892;&#32553;&#20889;&#30340;&#12290;&#20851;&#20110;LONG_OPTIONS&#30340;&#26684;&#24335;&#35265;&#19979;&#19968;&#23567;&#33410;&#12290;

-n NAME
getopt&#22312;&#35299;&#26512;&#21629;&#20196;&#34892;&#26102;&#65292;&#22914;&#26524;&#35299;&#26512;&#20986;&#38169;(&#20363;&#22914;&#35201;&#27714;&#32473;&#21442;&#25968;&#30340;&#36873;&#39033;&#27809;&#24102;&#21442;&#25968;&#65292;&#20351;&#29992;&#20102;&#26080;&#27861;&#35299;&#26512;&#30340;&#36873;&#39033;&#31561;)&#23558;&#20250;&#25253;&#21578;&#38169;&#35823;&#20449;&#24687;&#65292;getopt&#23558;&#20351;&#29992;&#35813;NAME&#20316;&#20026;&#25253;&#38169;&#30340;&#33050;&#26412;&#21517;&#31216;&#12290;

-- <span class="org-string">"$@"</span>
&#20854;&#20013;--&#34920;&#31034;getopt&#21629;&#20196;&#33258;&#36523;&#30340;&#36873;&#39033;&#21040;&#27492;&#32467;&#26463;&#65292;&#21518;&#38754;&#30340;&#20803;&#32032;&#37117;&#26159;&#35201;&#34987;getopt&#35299;&#26512;&#30340;&#21629;&#20196;&#34892;&#21442;&#25968;&#12290;&#36825;&#37324;&#20351;&#29992;<span class="org-string">"$@"</span>&#65292;&#34920;&#31034;&#25152;&#26377;&#30340;&#21629;&#20196;&#34892;&#21442;&#25968;&#12290;&#27880;&#24847;&#65292;&#19981;&#33021;&#30465;&#30053;&#21452;&#24341;&#21495;&#12290;
</pre>
</div>
</div>
</div>
<div id="outline-container-getopt如何解析选项和参数" class="outline-4">
<h4 id="getopt如何解析选项和参数"><a href="#getopt如何解析选项和参数">2 getopt如何解析选项和参数</a></h4>
<div class="outline-text-4" id="text-getopt如何解析选项和参数">
<p>
getopt使用”-o”或”-l”解析短、长选项和参数时，将会对每个解析到的选项、参数进行输出，然后不断放进一个字符串中。这个字符串的内容就是完整的、规范化的选项和参数。
</p>

<p>
<b>getopt使用”-o”选项解析短选项时：</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#22810;&#20010;&#30701;&#36873;&#39033;&#21487;&#20197;&#36830;&#22312;&#19968;&#36215;
:  <span class="org-comment-delimiter"># </span><span class="org-comment">&#36873;&#39033;&#21517;&#21518;&#38754;&#36319;&#19968;&#20010;&#20882;&#21495;,&#38656;&#35201;&#19968;&#20010;&#21442;&#25968;
</span>:: <span class="org-comment-delimiter"># </span><span class="org-comment">&#36873;&#39033;&#21517;&#21518;&#38754;&#36319;&#20004;&#20010;&#20882;&#21495;,&#36873;&#39033;&#30340;&#21442;&#25968;&#21487;&#36873;</span>
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">getopt -o ab:c::
&#23558;&#35299;&#26512;&#20026;-a -b arg_b -c [arg_c]&#65292;arg_b&#26159;-b&#36873;&#39033;&#24517;&#39035;&#30340;&#65292;arg_c&#26159;-c&#36873;&#39033;&#21487;&#36873;&#30340;&#21442;&#25968;&#65292;<span class="org-string">"-a"</span>&#36873;&#39033;&#26080;&#38656;&#21442;&#25968;
</pre>
</div>

<p>
<b>getopt使用”-l”选项解析长选项时：</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#21487;&#20197;&#19968;&#27425;&#24615;&#25351;&#23450;&#22810;&#20010;&#36873;&#39033;&#21517;&#31216;&#65292;&#38656;&#35201;&#20351;&#29992;&#36887;&#21495;&#20998;&#38548;&#23427;&#20204;
&#21487;&#20197;&#22810;&#27425;&#20351;&#29992;-l&#36873;&#39033;&#65292;&#22810;&#27425;&#35299;&#26512;&#38271;&#36873;&#39033;

:  <span class="org-comment-delimiter"># </span><span class="org-comment">&#36873;&#39033;&#21517;&#21518;&#38754;&#36319;&#19968;&#20010;&#20882;&#21495;,&#38656;&#35201;&#19968;&#20010;&#21442;&#25968;
</span>:: <span class="org-comment-delimiter"># </span><span class="org-comment">&#36873;&#39033;&#21517;&#21518;&#38754;&#36319;&#20004;&#20010;&#20882;&#21495;,&#36873;&#39033;&#30340;&#21442;&#25968;&#21487;&#36873;</span>
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">getopt -l add:,remove::,show
&#23558;&#35299;&#26512;&#20026;--add arg_add --remove [arg_rem] --show&#65292;&#20854;&#20013;arg_add&#26159;--add&#36873;&#39033;&#24517;&#39035;&#30340;&#65292;--remove&#36873;&#39033;&#30340;&#21442;&#25968;arg_rem&#26159;&#21487;&#36873;&#30340;&#65292;--show&#26080;&#38656;&#21442;&#25968;
</pre>
</div>

<p>
如果解析的是带参数的选项，则getopt生成的字符串中，会将选项的参数值作为
该选项的下一个参数。
</p>

<p>
如果解析的是可选参数的选项，如果为该选项设置了参数，则会将这个参数放在
选项的下一个参数位置，如果没有为该选项设置参数，则会生成一个用引号包围
的空字符串作为选项的下一个参数。
</p>

<p>
getopt解析完选项和选项的参数后，将解析非选项类型的参数(non-option
parameter)。getopt为了让非选项类型的参数和选项、选项参数区分开，将在解
析第一个非选项类型参数时加上一个”&#x2013;"到字符串中，表示选项和选项参数到
此结束，然后将所有的非选项类型参数放在这个"&#x2013;“参数之后。
</p>

<p>
默认情况下，该加强版本的getopt会将所有参数值(包括选项参数、非选项类型
的参数)使用引号进行包围，以便保护空白字符和特殊字符。如果是兼容版本的
getopt，则不会用引号保护，所以会破坏参数解析。看后面的示例就很容易理解
了。
</p>
</div>
</div>
<div id="outline-container-示例分析getopt的解析方式" class="outline-4">
<h4 id="示例分析getopt的解析方式"><a href="#示例分析getopt的解析方式">3 示例分析getopt的解析方式</a></h4>
<div class="outline-text-4" id="text-示例分析getopt的解析方式">
<p>
例如在脚本test.sh中，下面的getopt的结果保存到变量parameters中，然后输
出getopt解析完成后得到的完整参数列表。
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/</span><span class="org-keyword">env</span><span class="org-comment"> bash
</span>
<span class="org-variable-name">parameters</span>=<span class="org-sh-quoted-exec">`getopt -o ab:c:: --long add:,remove::,show -n "$0" -- "$@"`</span>
<span class="org-builtin">echo</span> <span class="org-string">"$parameters"</span>
</pre>
</div>

<p>
如果还不知道这里的-o和&#x2013;long解析了什么东西，请回头仔细再看一遍。
</p>

<p>
执行这个脚本，并给这个脚本传递一些选项和参数，这些脚本参数将被收集到$@，
然后被getopt解析。
</p>

<div class="org-src-container">
<pre class="src src-sh">$ ./test.sh -a non-op_arg1 -b b_short_arg non-op_arg2 --rem --add /path --show -c non-op_arg3
-a -b <span class="org-string">'b_short_arg'</span> --remove <span class="org-string">''</span> --add <span class="org-string">'/path'</span> --show -c <span class="org-string">''</span> -- <span class="org-string">'non-op_arg1'</span> <span class="org-string">'non-op_arg2'</span> <span class="org-string">'non-op_arg3'</span>
</pre>
</div>

<p>
首先可以看出，传递给脚本的参数都是无序的：
</p>

<p>
长选项有：
</p>

<ul class="org-ul">
<li>&#x2013;rem：是&#x2013;remove的缩写形式，它的参数是可选的，但没有为它传递参数</li>
<li>&#x2013;add：并设置了该选项的参数/path &#x2013;show：没有任何参数</li>
</ul>

<p>
短选项有：
</p>
<ul class="org-ul">
<li>-a：它是无需参数的选项，所以它后面的non-op_arg1是一个非选项类型的参数</li>
<li>-b：它是必须带参数的选项，所以b_short_arg是它的参数</li>
<li>-c：它的参数是可选的，这里没有给它提供参数(前面解释过，要给参数可选
的选项提供参数，短选项时，参数和选项名称必须连在一起)。</li>
</ul>

<p>
非选项类型的参数有：
</p>
<ul class="org-ul">
<li>non-op_arg1</li>
<li>non-op_arg2</li>
<li>non-op_arg3</li>
</ul>

<p>
从getopt的输出结果中，可以看出：
</p>

<p>
先解析选项和选项参数
</p>

<p>
选项和选项参数是按照从左向右的方式进行解析的
</p>

<p>
参数都使用引号包围
</p>

<p>
那些参数可选的选项，当没有为它们提供参数时，将生成一个引号包围的空字符
串参数
</p>

<p>
解析完所有的选项和选项参数后，开始解析非选项类型的参数
</p>

<p>
非选项类型的参数前面，会生成一个”&#x2013;“字符串，它将选项(以及选项参数)与
非选项类型的参数隔开了
</p>
</div>
</div>
</div>
<div id="outline-container-处理getopt解析的结果" class="outline-3">
<h3 id="处理getopt解析的结果"><a href="#处理getopt解析的结果">处理getopt解析的结果</a></h3>
<div class="outline-text-3" id="text-处理getopt解析的结果">
<p>
getopt解析得到了完整、规范化的结果，当然要拿来应用。例如直接传递个函数，
或者根据while、case、shift将选项、参数进行分割单独保存。
</p>

<p>
如果要进行分割，由于getopt的解析结果通常保存在一个变量中，要解析这个结
果字符串，需要使用eval函数将变量的内容进行还原，一般来说会将其设置为一
个位置参数(因为shift只能操作位置变量)。
</p>

<p>
一般来说，整个处理流程是这样的：
</p>

<div class="org-src-container">
<pre class="src src-sh">[ $<span class="org-variable-name">?</span> != 0 ] &amp;&amp; <span class="org-keyword">exit</span> 1
<span class="org-builtin">eval</span> set -- <span class="org-string">"$parameters"</span> <span class="org-comment-delimiter"># </span><span class="org-comment">&#23558;$parameters&#35774;&#32622;&#20026;&#20301;&#32622;&#21442;&#25968;
</span><span class="org-keyword">while </span><span class="org-builtin">true</span> ; <span class="org-keyword">do</span> <span class="org-comment-delimiter"># </span><span class="org-comment">&#24490;&#29615;&#35299;&#26512;&#20301;&#32622;&#21442;&#25968;
</span>    <span class="org-keyword">case</span> <span class="org-string">"$1"</span><span class="org-keyword"> in</span>
        -a|--longa) ...;<span class="org-builtin">shift</span> ;; <span class="org-comment-delimiter"># </span><span class="org-comment">&#19981;&#24102;&#21442;&#25968;&#30340;&#36873;&#39033;-a&#25110;--longa
</span>        -b|--longb) ...;<span class="org-builtin">shift</span> 2;; <span class="org-comment-delimiter"># </span><span class="org-comment">&#24102;&#21442;&#25968;&#30340;&#36873;&#39033;-b&#25110;--longb
</span>        -c|--longc) <span class="org-comment-delimiter"># </span><span class="org-comment">&#21442;&#25968;&#21487;&#36873;&#30340;&#36873;&#39033;-c&#25110;--longc
</span>        <span class="org-keyword">case</span> <span class="org-string">"$2"</span><span class="org-keyword"> in</span>
        <span class="org-string">""</span>)...;<span class="org-builtin">shift</span> 2;; <span class="org-comment-delimiter"># </span><span class="org-comment">&#27809;&#26377;&#32473;&#21487;&#36873;&#21442;&#25968;
</span>        *) ...;<span class="org-builtin">shift</span> 2;; <span class="org-comment-delimiter"># </span><span class="org-comment">&#32473;&#20102;&#21487;&#36873;&#21442;&#25968;
</span>        <span class="org-keyword">esac</span>;;
        --) ...; <span class="org-keyword">break</span> ;; <span class="org-comment-delimiter"># </span><span class="org-comment">&#24320;&#22987;&#35299;&#26512;&#38750;&#36873;&#39033;&#31867;&#22411;&#30340;&#21442;&#25968;&#65292;break&#21518;&#65292;&#23427;&#20204;&#37117;&#20445;&#30041;&#22312;$@&#20013;
</span>        *) <span class="org-builtin">echo</span> <span class="org-string">"wrong"</span>;<span class="org-keyword">exit</span> 1;;
    <span class="org-keyword">esac</span>
<span class="org-keyword">done</span>
</pre>
</div>

<p>
需要注意，getopt解析既可以放在脚本中解析命令行参数，也可以放在某个函数
中解析函数参数。
</p>
</div>
</div>
<div id="outline-container-getopt的两种扫描模式" class="outline-3">
<h3 id="getopt的两种扫描模式"><a href="#getopt的两种扫描模式">getopt的两种扫描模式</a></h3>
<div class="outline-text-3" id="text-getopt的两种扫描模式">
<p>
getopt提供了两种扫描模式，只要在getopt的短选项前加上加号或负号，就能指
定两种扫描模式，即getopt -o [+-]SHORT_OPTS。
</p>

<ul class="org-ul">
<li>+扫描模式：只要解析完选项、选项参数，解析到第一个非选项类型的参数后，
就会停止解析，它会将所有没有解析的内容都当作非选项类型参数。所以这种
情况下，非选项类型的参数都必须放在尾部，而不能放在某个待解析选项的前
面。这种模式在区别负数和短选项时，非常有用。</li>

<li>-扫描模式：会按照原始位置参数解析，并保留原始位置。这种模式一般用不
上，因为破坏了getopt的优势：让选项完整、规范化。</li>
</ul>

<p>
例如，对于命令行参数-w -s -5 3 -2，要将-5识别为-s的参数，3和-2为非选项
类型的参数，则：
</p>

<div class="org-src-container">
<pre class="src src-sh">$ set -- -w -s -5 3 -2 <span class="org-comment-delimiter"># </span><span class="org-comment">&#35774;&#32622;&#20301;&#32622;&#21442;&#25968;
</span>$ getopt -o +s:w -n <span class="org-string">"$0"</span> -- <span class="org-string">"$@"</span>
-w -s <span class="org-string">'-5'</span> -- <span class="org-string">'3'</span> <span class="org-string">'-2'</span> <span class="org-comment-delimiter"># </span><span class="org-comment">&#35299;&#26512;&#32467;&#26524;</span>
</pre>
</div>

<p>
注意，上面的-5是被解析成了-s的参数，而不是选项或非选项类型的参数，因
为-s选项必须要指定一个参数。
</p>

<p>
上面的3必须不能是负数，因为getopt必须先扫描到一个正常的非选项型参数，
才能将它后面的所有负数都当作非选项型参数。至于如何将-w
</p>

<p>
-s -5 -3 -2中的-3和-2都解析为非选项型参数，目前我也不知道。
</p>

<p>
使用-扫描模式：
</p>

<div class="org-src-container">
<pre class="src src-sh">$ set -- 3 -w 4 -s -5 a 3
$ getopt -o -s:w -n <span class="org-string">"$0"</span> -- <span class="org-string">"$@"</span>
<span class="org-string">'3'</span> -w <span class="org-string">'4'</span> -s <span class="org-string">'-5'</span> <span class="org-string">'a'</span> <span class="org-string">'3'</span> -- <span class="org-comment-delimiter"># </span><span class="org-comment">&#35299;&#26512;&#32467;&#26524;</span>
</pre>
</div>

<p>
可以看到，上面的所有参数位置都是保持原样的，且将分隔符号”&#x2013;“补在了最尾部。
</p>
</div>
</div>
<div id="outline-container-如何实现命令行选项的各种个性功能" class="outline-3">
<h3 id="如何实现命令行选项的各种个性功能"><a href="#如何实现命令行选项的各种个性功能">如何实现命令行选项的各种个性功能</a></h3>
<div class="outline-text-3" id="text-如何实现命令行选项的各种个性功能">
<p>
在前面命令行选项的那些事中介绍了几种有”个性”的选项功能，包括：
</p>

<p>
选项依赖：例如”-a”或”&#x2013;add”要依赖于”-m”或”&#x2013;manage”选项
</p>

<p>
选项互斥：例如”-a”或”&#x2013;add”与”-r”或”&#x2013;remove”是互斥的识别负数
参数：例如-w -5 -3 5，其中-5和-3不是短选项，而是负数参数
</p>

<p>
模式化选项：例如script_name MODE OPTIONS的MODE部分，可以是manage模式
(&#x2013;manage,-m)，也可以使用add模式(&#x2013;add,-a)
</p>

<p>
选项参数替代选项：例如head -n 3可以替换为head -3
</p>

<p>
这里介绍下用getopt解析参数后实现它们的思路。
</p>

<p>
在getopt解析完成后，假设返回结果保存到了$parameters变量中。
</p>
</div>
<div id="outline-container-选项依赖性" class="outline-4">
<h4 id="选项依赖性"><a href="#选项依赖性">1.选项依赖性</a></h4>
<div class="outline-text-4" id="text-选项依赖性">
<p>
这个其实很好实现，只需使用grep对$parameters变量进行筛选一下即可。
</p>

<p>
例如实现依赖性，只需：
</p>

<div class="org-src-container">
<pre class="src src-sh">{ <span class="org-builtin">echo</span> <span class="org-string">"$parameters"</span> | grep -E <span class="org-string">'\-\-add|\-a '</span> | grep -E <span class="org-string">'\-\-manage|\-m '</span>; } &amp;&gt;/dev/null
[ $<span class="org-variable-name">?</span> -ne 0 ] &amp;&amp; <span class="org-keyword">exit</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-选项互斥性" class="outline-4">
<h4 id="选项互斥性"><a href="#选项互斥性">2.选项互斥性</a></h4>
<div class="outline-text-4" id="text-选项互斥性">
<p>
要实现互斥性，只需：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">or_op</span>=<span class="org-sh-quoted-exec">`echo "$parameters" | grep -Eo '\-\-add|\-a | \-\-remove|\-r ' | wc -l`</span>
[ <span class="org-string">"$or_op"</span> = <span class="org-string">"2"</span> ] &amp;&amp; <span class="org-keyword">exit</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-识别负数参数" class="outline-4">
<h4 id="识别负数参数"><a href="#识别负数参数">3.识别负数参数</a></h4>
<div class="outline-text-4" id="text-识别负数参数">
<p>
前面解释过，getopt提供了两种扫描模式，只要使用+扫描模式，就能轻松区别
负数参数和短选项。
</p>
</div>
</div>
<div id="outline-container-模式化选项" class="outline-4">
<h4 id="模式化选项"><a href="#模式化选项">4.模式化选项</a></h4>
<div class="outline-text-4" id="text-模式化选项">
<p>
一般来说，模式化选项都是命令行的第一个参数。所以，只需将
$parameter中”&#x2013;“后面的第一个非选项类型的参数提取出来，就是所谓的模式
了。当然，还得对这个参数进行一些判断，避免它不是模式参数。
</p>

<p>
例如，要提供addr、show、route三种模式，那么其它的非选项类型参数值都不
应该是模式参数。
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">eval</span> set -- <span class="org-string">"$parameters"</span>
<span class="org-keyword">while </span><span class="org-builtin">true</span> ; <span class="org-keyword">do</span>
    <span class="org-keyword">case</span> <span class="org-string">"$1"</span><span class="org-keyword"> in</span>
        ...
        --)
        <span class="org-builtin">shift</span>
        [ <span class="org-string">"$x"</span> = <span class="org-string">"addr"</span> -o <span class="org-string">"$x"</span> = <span class="org-string">"route"</span> -o <span class="org-string">"$x"</span> = <span class="org-string">"show"</span> ] &amp;&amp; <span class="org-variable-name">MODE</span>=$<span class="org-variable-name">1</span>
        <span class="org-builtin">shift</span>
        <span class="org-keyword">break</span> ;;
        *) <span class="org-builtin">echo</span> <span class="org-string">"wrong"</span>;<span class="org-keyword">exit</span> 1;;
    <span class="org-keyword">esac</span>
<span class="org-keyword">done</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-选项参数替代选项" class="outline-4">
<h4 id="选项参数替代选项"><a href="#选项参数替代选项">5.选项参数替代选项</a></h4>
<div class="outline-text-4" id="text-选项参数替代选项">
<p>
就以-n3和-3为例，它的通用格式是-n NUM和-NUM。这个并不好实现，我能想到
的方法是将这个-NUM先从 <code>$@</code> 中筛选出来]，然后赋值。
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-variable-name">NUM</span>=<span class="org-sh-quoted-exec">`echo "$@" | grep -Eo "\-[0-9]+"`</span>
<span class="org-variable-name">ARGS</span>=<span class="org-sh-quoted-exec">`echo "$@" | sed -nr 's!(.*)-[0-9]+(.*)!\1\2!'p`</span>
<span class="org-builtin">eval</span> set -- <span class="org-string">"$ARGS"</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-使用getopt设计shell脚本选项示例" class="outline-3">
<h3 id="使用getopt设计shell脚本选项示例"><a href="#使用getopt设计shell脚本选项示例">6.使用getopt设计shell脚本选项示例</a></h3>
<div class="outline-text-3" id="text-使用getopt设计shell脚本选项示例">
<p>
这里提供一个和seq命令功能相同的脚本seq.sh，然后设计这个脚本的选项。
</p>

<p>
先看一下seq命令的各个选项说明：
</p>

<div class="org-src-container">
<pre class="src src-sh">seq [OPTION]... LAST <span class="org-comment-delimiter"># </span><span class="org-comment">&#35821;&#27861;1
</span>seq [OPTION]... FIRST LAST <span class="org-comment-delimiter"># </span><span class="org-comment">&#35821;&#27861;2
</span>seq [OPTION]... FIRST INCREMENT LAST <span class="org-comment-delimiter"># </span><span class="org-comment">&#35821;&#27861;3</span>
</pre>
</div>

<p>
选项：
</p>
<pre class="example" id="org11ec72a">
-s, --separator=STRING 使用指定的STRING分隔各数值，默认值为”\n“u

-w, --equal-width 使用0填充在前缀使所有数值长度相同

--help 显示帮助信息并退出

--version 输出版本信息并退出
</pre>

<p>
以下是脚本内容：和seq相比，只有两个问题：第一个起点数值FIRST不能为负数；
不支持小数功能。其它功能完全相同
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/</span><span class="org-keyword">env</span><span class="org-comment"> bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span>
<span class="org-function-name">usage</span>(){
cat &lt;&lt;<span class="org-string">'EOF'</span><span class="org-sh-heredoc">
Usage: $0 [OPTION]... LAST
  or:  $0 [OPTION]... FIRST LAST
  or:  $0 [OPTION]... FIRST INCREMENT LAST
EOF
</span>}

<span class="org-comment-delimiter"># </span><span class="org-comment">getopt&#30340;&#29256;&#26412;&#26159;&#22686;&#24378;&#29256;&#21527;
</span>getopt -T &amp;&gt;/dev/null;[ $<span class="org-variable-name">?</span> -ne 4 ] &amp;&amp; { <span class="org-builtin">echo</span> <span class="org-string">"not enhanced version"</span>;<span class="org-keyword">exit</span> 1; }

<span class="org-comment-delimiter"># </span><span class="org-comment">&#21442;&#25968;&#35299;&#26512;
</span><span class="org-variable-name">parameters</span>=<span class="org-sh-quoted-exec">`getopt -o +s:w --long separator:,equal-width,help,version -n "$0" -- "$@"`</span>
[ $<span class="org-variable-name">?</span> -ne 0 ] &amp;&amp; { <span class="org-builtin">echo</span> <span class="org-string">"Try '$0 --help' for more information."</span>; <span class="org-keyword">exit</span> 1; }

<span class="org-builtin">eval</span> set -- <span class="org-string">"$parameters"</span>

<span class="org-keyword">while </span><span class="org-builtin">true</span>;<span class="org-keyword">do</span>
    <span class="org-keyword">case</span> <span class="org-string">"$1"</span><span class="org-keyword"> in</span>
        -w|--equal-width) <span class="org-variable-name">ZERO_PAD</span>=<span class="org-string">"true"</span>; <span class="org-builtin">shift</span> ;;
        -s|--separator) <span class="org-variable-name">SEPARATOR</span>=$<span class="org-variable-name">2</span>; <span class="org-builtin">shift</span> 2 ;;
        --version) <span class="org-builtin">echo</span> <span class="org-string">"$0 version V1.0"</span>; <span class="org-keyword">exit</span> ;;
        --help) usage;<span class="org-keyword">exit</span> ;;
        --)
            <span class="org-builtin">shift</span>
            <span class="org-variable-name">FIRST</span>=$<span class="org-variable-name">1</span>
            <span class="org-variable-name">INCREMENT</span>=$<span class="org-variable-name">2</span>
            <span class="org-variable-name">LAST</span>=$<span class="org-variable-name">3</span>
            <span class="org-keyword">break</span> ;;
        *) usage;<span class="org-keyword">exit</span> 1;;
    <span class="org-keyword">esac</span>
<span class="org-keyword">done</span>


<span class="org-comment-delimiter"># </span><span class="org-comment">&#29992;&#20110;&#29983;&#25104;&#24207;&#21015;&#25968;
</span><span class="org-keyword">function</span> <span class="org-function-name">seq_func</span>(){

    <span class="org-comment-delimiter"># </span><span class="org-comment">&#26159;&#21542;&#35201;&#20351;&#29992;printf&#22635;&#20805;0&#20301;&#65311;
</span>    [ <span class="org-string">"x$1"</span> = <span class="org-string">"xtrue"</span> ] &amp;&amp; <span class="org-variable-name">zero_pad</span>=<span class="org-string">"true"</span> &amp;&amp; <span class="org-builtin">shift</span>

    <span class="org-comment-delimiter"># </span><span class="org-comment">&#35774;&#32622;first&#12289;step&#12289;last
</span>    <span class="org-keyword">if</span> [ $<span class="org-variable-name">#</span> -eq 1 ];<span class="org-keyword">then</span>
        <span class="org-variable-name">first</span>=1
        <span class="org-variable-name">step</span>=1
        <span class="org-variable-name">last</span>=$<span class="org-variable-name">1</span>
    <span class="org-keyword">elif</span> [ $<span class="org-variable-name">#</span> -eq 2 ];<span class="org-keyword">then</span>
        <span class="org-variable-name">first</span>=$<span class="org-variable-name">1</span>
        <span class="org-variable-name">step</span>=1
        <span class="org-variable-name">last</span>=$<span class="org-variable-name">2</span>
    <span class="org-keyword">elif</span> [ $<span class="org-variable-name">#</span> -eq 3 ]; <span class="org-keyword">then</span>
        <span class="org-variable-name">first</span>=$<span class="org-variable-name">1</span>
        <span class="org-variable-name">step</span>=$<span class="org-variable-name">2</span>
        <span class="org-variable-name">last</span>=$<span class="org-variable-name">3</span>
    <span class="org-keyword">else</span>
        <span class="org-builtin">echo</span> <span class="org-string">"$FUNCNAME: ARGS wrong..."</span>
        <span class="org-keyword">exit</span> 1
    <span class="org-keyword">fi</span>

    <span class="org-comment-delimiter"># </span><span class="org-comment">&#26368;&#21518;&#19968;&#20010;&#35201;&#36755;&#20986;&#30340;&#20803;&#32032;&#21450;&#20854;&#38271;&#24230;&#65292;&#20915;&#23450;&#35201;&#22635;&#20805;&#22810;&#23569;&#20010;0
</span>    <span class="org-variable-name">last_output</span>=$[ last - ( last-first ) % step ]
    <span class="org-variable-name">zero_pad_len</span>=<span class="org-sh-quoted-exec">`[ ${#last_output} -gt ${#first} ] &amp;&amp; echo ${#last_output} || echo ${#first}`</span>

    <span class="org-comment-delimiter"># </span><span class="org-comment">&#29983;&#25104;&#24207;&#21015;&#25968;
</span>    <span class="org-keyword">if</span> [ <span class="org-string">"x$zero_pad"</span> = <span class="org-string">"xtrue"</span> ];<span class="org-keyword">then</span>
        <span class="org-comment-delimiter"># </span><span class="org-comment">&#22635;&#20805;0
</span>        <span class="org-keyword">if</span> [ $<span class="org-variable-name">step</span> -gt 0 ];<span class="org-keyword">then</span>
            <span class="org-comment-delimiter"># </span><span class="org-comment">&#36882;&#22686;&#65292;&#22635;&#20805;0
</span>            <span class="org-keyword">for</span>((<span class="org-variable-name">i</span>=$<span class="org-variable-name">first</span>;i&lt;=$<span class="org-variable-name">last</span>;<span class="org-variable-name">i</span>+=$<span class="org-variable-name">step</span>)){
                [ $<span class="org-variable-name">last_output</span> -eq $<span class="org-variable-name">i</span> ] &amp;&amp; { printf <span class="org-string">"%0${zero_pad_len}i\n"</span> <span class="org-string">"$i"</span>;<span class="org-keyword">return</span>; }
                printf <span class="org-string">"%0${zero_pad_len}i "</span> $<span class="org-variable-name">i</span>
            }
        <span class="org-keyword">else</span>
            <span class="org-comment-delimiter"># </span><span class="org-comment">&#36882;&#20943;&#65292;&#22635;&#20805;0
</span>            <span class="org-keyword">for</span>((<span class="org-variable-name">i</span>=$<span class="org-variable-name">first</span>;i&gt;=$<span class="org-variable-name">last</span>;<span class="org-variable-name">i</span>+=$<span class="org-variable-name">step</span>)){
                [ $<span class="org-variable-name">last_output</span> -eq $<span class="org-variable-name">i</span> ] &amp;&amp; { printf <span class="org-string">"%0${zero_pad_len}i\n"</span> <span class="org-string">"$i"</span>;<span class="org-keyword">return</span>; }
                printf <span class="org-string">"%0${zero_pad_len}i "</span> $<span class="org-variable-name">i</span>
            }
        <span class="org-keyword">fi</span>
    <span class="org-keyword">else</span>
        <span class="org-comment-delimiter"># </span><span class="org-comment">&#19981;&#22635;&#20805;0
</span>        <span class="org-keyword">if</span> [ $<span class="org-variable-name">step</span> -gt 0 ];<span class="org-keyword">then</span>
            <span class="org-comment-delimiter"># </span><span class="org-comment">&#36882;&#22686;&#65292;&#19981;&#22635;&#20805;0
</span>            <span class="org-keyword">for</span>((<span class="org-variable-name">i</span>=$<span class="org-variable-name">first</span>;i&lt;=$<span class="org-variable-name">last</span>;<span class="org-variable-name">i</span>+=$<span class="org-variable-name">step</span>)){
                [ $<span class="org-variable-name">last_output</span> -eq $<span class="org-variable-name">i</span> ] &amp;&amp; { printf <span class="org-string">"%i\n"</span> <span class="org-string">"$i"</span>;<span class="org-keyword">return</span>; }
                printf <span class="org-string">"%i "</span> $<span class="org-variable-name">i</span>
            }
        <span class="org-keyword">else</span>
            <span class="org-comment-delimiter"># </span><span class="org-comment">&#36882;&#20943;&#65292;&#19981;&#22635;&#20805;0
</span>            <span class="org-keyword">for</span>((<span class="org-variable-name">i</span>=$<span class="org-variable-name">first</span>;i&gt;=$<span class="org-variable-name">last</span>;<span class="org-variable-name">i</span>+=$<span class="org-variable-name">step</span>)){
                [ $<span class="org-variable-name">last_output</span> -eq $<span class="org-variable-name">i</span> ] &amp;&amp; { printf <span class="org-string">"%i\n"</span> <span class="org-string">"$i"</span>;<span class="org-keyword">return</span>; }
                printf <span class="org-string">"%i "</span> $<span class="org-variable-name">i</span>
            }
        <span class="org-keyword">fi</span>
    <span class="org-keyword">fi</span>
}

<span class="org-comment-delimiter"># </span><span class="org-comment">&#25351;&#23450;&#36755;&#20986;&#20998;&#38548;&#31526;
</span>: ${<span class="org-variable-name">SEPARATOR</span>=<span class="org-string">"\n"</span>}

<span class="org-comment-delimiter"># </span><span class="org-comment">&#36755;&#20986;&#32467;&#26524;
</span>seq_func $<span class="org-variable-name">ZERO_PAD</span> $<span class="org-variable-name">FIRST</span> $<span class="org-variable-name">INCREMENT</span> $<span class="org-variable-name">LAST</span> | tr <span class="org-string">" "</span> <span class="org-string">"$SEPARATOR"</span>
</pre>
</div>

<p>
上面解析选项的脚本缺陷在于无法解析FIRST为负数的情况，例如./seq.sh -w
-5 3将报错。但可以写为标准的./seq.sh -w &#x2013; -5 -3语法。
</p>
</div>
</div>
</section>
<section id="outline-container-脚本编程进阶-07-shell多进程并发执行" class="outline-2">
<h2 id="脚本编程进阶-07-shell多进程并发执行"><a href="#脚本编程进阶-07-shell多进程并发执行">shell多进程并发执行</a></h2>
<div class="outline-text-2" id="text-脚本编程进阶-07-shell多进程并发执行">
<p>
虽说shell的多进程是后台执行,但是学会了再写一些脚本的时候非常方便
</p>
</div>
<div id="outline-container-普通脚本" class="outline-3">
<h3 id="普通脚本"><a href="#普通脚本">普通脚本</a></h3>
<div class="outline-text-3" id="text-普通脚本">
<p>
先看传统的后台多进程方式,写个shell来举例
</p>

<p>
正常的运行
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@stor01 ~]# cat test.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-variable-name">start</span>=$(date +%s)
<span class="org-keyword">for</span> i<span class="org-keyword"> in</span> $(seq 10) ;<span class="org-keyword">do</span>
    <span class="org-builtin">echo</span> $<span class="org-variable-name">i</span>; sleep 2
<span class="org-keyword">done</span>

<span class="org-builtin">echo</span> <span class="org-string">'Time: '</span> <span class="org-string">"$(($(date +%s) -$start))"</span>

<span class="org-comment-delimiter">#</span><span class="org-comment">&#25191;&#34892;
</span>[root@stor01 ~]# sh test.sh
1
2
3
4
5
6
7
8
9
10
Time:  20
</pre>
</div>
</div>
</div>
<div id="outline-container-子shell后台运行" class="outline-3">
<h3 id="子shell后台运行"><a href="#子shell后台运行">子shell后台运行</a></h3>
<div class="outline-text-3" id="text-子shell后台运行">
<p>
后台运行来节约时间
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@stor01 ~]# vim test.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-variable-name">start</span>=$(date +%s)
<span class="org-keyword">for</span> i<span class="org-keyword"> in</span> $(seq 10) ;<span class="org-keyword">do</span>
    { <span class="org-builtin">echo</span> $<span class="org-variable-name">i</span>; sleep 2; }&amp; <span class="org-comment-delimiter"># </span><span class="org-comment">&#21518;&#21488;&#36816;&#34892;
</span><span class="org-keyword">done</span>
<span class="org-builtin">wait</span> <span class="org-comment-delimiter"># </span><span class="org-comment">&#31561;&#24453;&#25152;&#26377;&#21518;&#21488;&#36827;&#31243;&#36816;&#34892;&#23436;&#25104;
</span><span class="org-builtin">echo</span> <span class="org-string">'Time: '</span> <span class="org-string">"$(($(date +%s) -$start))"</span>


[root@stor01 ~]# sh test.sh
6
7
3
4
5
8
9
10
1
2
Time:  2
</pre>
</div>
</div>
</div>
<div id="outline-container-配合wait运行" class="outline-3">
<h3 id="配合wait运行"><a href="#配合wait运行">配合wait运行</a></h3>
<div class="outline-text-3" id="text-配合wait运行">
<p>
从上面结果对比发现时间大大缩短,但是缺点是不能控制数量。然后因为wait特
性我们可以用它来配合数字来自定并发的数量
</p>

<p>
wait命令与计数变量控制并发数
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@stor01 ~]# vim test.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-variable-name">max_process</span>=5
<span class="org-variable-name">start</span>=$(date +%s)
<span class="org-keyword">for</span> i<span class="org-keyword"> in</span> $(seq 10) ;<span class="org-keyword">do</span>
    { <span class="org-builtin">echo</span> $<span class="org-variable-name">i</span>; sleep 2; }&amp; <span class="org-comment-delimiter"># </span><span class="org-comment">&#21518;&#21488;&#36816;&#34892;
</span>    ((count++));((do_count++)) <span class="org-comment-delimiter"># </span><span class="org-comment">&#27425;&#25968;&#21644;&#36816;&#34892;&#30340;&#27425;&#25968;&#35745;&#25968;
</span>    [ <span class="org-string">"$do_count"</span> -eq <span class="org-string">'10'</span> ] &amp;&amp; { <span class="org-builtin">wait</span>;<span class="org-keyword">break</span>; } <span class="org-comment-delimiter"># </span><span class="org-comment">&#36825;&#37324;&#30340;10&#26159;&#38656;&#35201;&#25191;&#34892;&#30340;&#24635;&#27425;&#25968;,&#36816;&#34892;&#36807;&#30340;&#27425;&#25968;&#31561;&#20110;&#24635;&#27425;&#25968;&#23601;&#31561;&#24453;&#25152;&#26377;&#21518;&#21488;&#36864;&#20986;,&#20294;&#26159;&#20551;&#35774;&#27599;&#27425;&#24182;&#21457;&#30340;&#27425;&#25968;&#26159;3,&#26368;&#21518;&#26377;&#19968;&#20010;&#36827;&#31243;,&#19978;&#19979;&#20457;&#34892;&#23601;&#26159;&#20026;&#20102;&#38450;&#27490;&#36825;&#31181;&#24773;&#20917;&#20986;&#29616;
</span>    [ <span class="org-string">"$count"</span> -eq <span class="org-string">"$max_process"</span> ] &amp;&amp; { <span class="org-builtin">wait</span>;<span class="org-variable-name">count</span>=0; }
<span class="org-keyword">done</span>
<span class="org-builtin">echo</span> <span class="org-string">'Time:'</span> <span class="org-string">"$((`date +%s`-$start))"</span>

[root@stor01 ~]# sh  test.sh
2
3
4
1
5
8
9
6
10
7
Time: 4
</pre>
</div>
</div>
</div>
<div id="outline-container-管道的特性" class="outline-3">
<h3 id="管道的特性"><a href="#管道的特性">管道的特性</a></h3>
<div class="outline-text-3" id="text-管道的特性">
<p>
这种还要考虑需要并发的进程数量在总次数下是否有余数的可能,后面我发现了
可以用mkfifo来实现并发,代码更容易懂。
</p>

<p>
无名管道：
就是我们经常使用的 例如： netstat -antp | grep "abc"
那个|就是管道，只不过是无名的，可以直接作为两个进程的数据通道。
</p>

<p>
有名管道： mkfilo 可以创建一个管道文件 ，例如：mkfifo　fifo_file
</p>

<p>
管道有一个特点：
如果管道中没有数据，那么取管道数据的操作就会停滞，直到管道内进入数据，
然后读出后才会终止这一操作。同理，写入管道的操作如果没有读取操作，这一
个动作也会停滞。
</p>


<figure id="org5e78a26">
<img src="././images/image-20210206145635199.png" alt="image-20210206145635199.png" width="50%">

</figure>

<p>
当我们试图用echo想管道文件中写入数据时，由于没有任何进程在对它做读取操
作，所以它会一直停留在那里等待读取操作，此时我们在另一终端上用cat指令
做读取操作
</p>


<figure id="org4228aa8">
<img src="././images/image-20210206145650659.png" alt="image-20210206145650659.png" width="50%">

</figure>

<p>
你会发现读取操作一旦执行，写入操作就可以顺利完成了，同理，先做读取操作
也是一样的(不信可以自行测试)
</p>
</div>
</div>
<div id="outline-container-多进程中的管道与重定向" class="outline-3">
<h3 id="多进程中的管道与重定向"><a href="#多进程中的管道与重定向">多进程中的管道与重定向</a></h3>
<div class="outline-text-3" id="text-多进程中的管道与重定向">
<p>
后面发现的多进程就是利用管道的读写来控制,exec绑定文件操作符重定向exec
绑定文件操作符后我们来试试按行读取会有啥现象
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@stor01 ~]# echo $<span class="org-variable-name">$</span>
1743
[root@stor01 ~]# exec 3&lt;&gt;test_a
[root@stor01 ~]# exec 5&lt;&gt;test_fifo  <span class="org-comment-delimiter"># </span><span class="org-comment">&#25171;&#24320;&#25991;&#20214;&#65292;&#24182;&#25351;&#23450;&#20854;&#25991;&#20214;&#25551;&#36848;&#31526;&#20026;5&#65292;&#35813;&#25551;&#36848;&#31526;&#26159;&#21487;&#35835;&#12289;&#21487;&#20889;&#30340;&#12290;5&#20026;&#31649;&#36947;&#65311;&#65311;&#12290;
</span>[root@stor01 ~]# echo <span class="org-string">'123'</span> &gt;&amp;5
[root@stor01 ~]# read -u5 <span class="org-comment-delimiter">#</span><span class="org-comment">-u&#36873;&#39033;&#26159;&#34920;&#31034;&#20174;&#25991;&#20214;&#25551;&#21465;&#31526;&#37324;&#35835;&#21462;&#31649;&#36947;&#37324;&#30340;&#19968;&#34892;
</span>[root@stor01 ~]# read -u5
^C                             <span class="org-comment-delimiter">#</span><span class="org-comment">&#19978;&#38754;&#31649;&#36947;&#37324;&#21482;&#26377;&#19968;&#34892;,&#35835;&#21462;&#31532;&#20108;&#34892;&#20250;&#20572;&#28382;&#22312;&#36825;
</span>[root@stor01 ~]# echo -e <span class="org-string">'123\n123'</span> &gt;&amp;5
[root@stor01 ~]# read -u5
[root@stor01 ~]# read -u5
[root@stor01 ~]# read -u5
^C                        <span class="org-comment-delimiter">#</span><span class="org-comment">&#31649;&#36947;&#37324;&#20457;&#34892;,&#35835;&#21462;&#31532;&#19977;&#34892;&#20250;&#20572;&#28382;
</span>[root@stor01 ~]#
</pre>
</div>


<figure id="orgee2cd6e">
<img src="././images/image-20210206145704675.png" alt="image-20210206145704675.png" width="50%">

<figcaption><span class="figure-number">Figure 9: </span>image-20210206145704675</figcaption>
</figure>

<p>
重写向参考：<a href="http://www.cnblogs.com/f-ck-need-u/p/8727401.html">http://www.cnblogs.com/f-ck-need-u/p/8727401.html</a>
</p>
</div>
<div id="outline-container-管道来并发控制" class="outline-4">
<h4 id="管道来并发控制"><a href="#管道来并发控制">管道来并发控制</a></h4>
<div class="outline-text-4" id="text-管道来并发控制">
<p>
管道来并发控制就是先在管道里写入要并发数量的行数。
</p>

<p>
每次read一行后，后面接要后台运行的子shell，这是用大括号括起来的。在大
括号里面的最后一句是向管道里写入一行，只有后台任务执行完了下一个read
-u才不会停滞。
</p>

<p>
演示：3条任务,并发数量为2,一开始管道里写入2行
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@stor01 ~]# cat a.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span>mkfifo test_fifo
<span class="org-keyword">exec</span> 5&lt;&gt;test_fifo <span class="org-comment-delimiter"># </span><span class="org-comment">&#25171;&#24320;&#25991;&#20214;&#65292;&#24182;&#25351;&#23450;&#20854;&#25991;&#20214;&#25551;&#36848;&#31526;&#20026;5&#65292;&#35813;&#25551;&#36848;&#31526;&#26159;&#21487;&#35835;&#12289;&#21487;&#20889;&#30340;&#12290;
</span>rm -f test_fifo
seq 2&gt;&amp;5   <span class="org-comment-delimiter"># </span><span class="org-comment">&#21521;&#31649;&#36947;&#20013;&#20889;&#20837;2&#34892;
</span>
<span class="org-keyword">for</span> i<span class="org-keyword"> in</span> {1..3};<span class="org-keyword">do</span>
    <span class="org-builtin">read</span> -u5
    {
        <span class="org-builtin">echo</span> $<span class="org-variable-name">i</span>;sleep 2;  <span class="org-comment-delimiter">#</span><span class="org-comment">&#38656;&#35201;&#24182;&#21457;&#30340;&#20869;&#23481;&#32479;&#19968;&#20889;&#22312;&#22823;&#25324;&#21495;&#37324;
</span>        <span class="org-builtin">echo</span> &gt;&amp;5
    }&amp;
<span class="org-keyword">done</span>
<span class="org-builtin">wait</span>

[root@stor01 ~]# bash a.sh
2
1
3
</pre>
</div>

<p>
脑补下执行过程,进入循环中:
</p>
<ul class="org-ul">
<li>第一次read(管道里有2行)不会被停滞,管道剩下1行,大括号里的所有代码放在
后台(一个后台并发)</li>
<li>第二次read(管道里有1行)不会被停滞,管道剩下0行,大括号里的所有代码放在
后台(俩个后台并发)</li>
<li>第三次read(管道里有0行),会被停滞,只有等一个后台执行完了(后台里最后一
句)向管道里写入了一个空行,此次的read才会退出停滞状态后面的代码才能继
续执行</li>
</ul>

<p>
然后循环结束后最后还有第三次的后台(此处不一定只有第三次的后台，可能第
二次后台也没执行完),此处写个wait等待最后剩下的后台完成即可
</p>
</div>
</div>
<div id="outline-container-完整的例子" class="outline-4">
<h4 id="完整的例子"><a href="#完整的例子">完整的例子</a></h4>
<div class="outline-text-4" id="text-完整的例子">
<div class="org-src-container">
<pre class="src src-sh">[root@stor01 ~]# cat test.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-comment-delimiter">#</span><span class="org-comment">
</span><span class="org-variable-name">max_process</span>=$<span class="org-variable-name">1</span>

<span class="org-keyword">function</span> <span class="org-function-name">Multi_process_init</span>() {
    <span class="org-keyword">trap</span> <span class="org-string">'exec 5&gt;&amp;-;exec 5&lt;&amp;-;exit 0'</span> 2 <span class="org-comment-delimiter">#</span><span class="org-comment">&#25429;&#25417;&#20013;&#26029;&#20449;&#21495;2(ctrl+C)&#20851;&#38381;fd5&#30340;&#24847;&#24605;,&#21892;&#21518;&#24037;&#20316;
</span>    <span class="org-variable-name">pipe</span>=$(mktemp -u tmp.XXXX)
    mkfifo $<span class="org-variable-name">pipe</span>
    <span class="org-keyword">exec</span> 5&lt;&gt;$<span class="org-variable-name">pipe</span> <span class="org-comment-delimiter">#</span><span class="org-comment">&#36825;&#20010;&#25968;&#20540;&#19981;&#26159;0,1,2&#23601;&#34892;,&#33539;&#22260;&#26159;3-$((`ulimit -u`-1))
</span>    rm -f $<span class="org-variable-name">pipe</span>

    seq $<span class="org-variable-name">max_process</span> &gt;&amp;5 <span class="org-comment-delimiter">#</span><span class="org-comment">&#20889;&#20837;&#24182;&#21457;&#25968;&#37327;&#30340;&#34892;
</span>}

<span class="org-keyword">function</span> <span class="org-function-name">myecho</span>() {
    <span class="org-variable-name">start</span>=$(date +%s)
    <span class="org-keyword">for</span> i<span class="org-keyword"> in</span> {1..10};<span class="org-keyword">do</span>
        <span class="org-builtin">read</span> -u5
        {
            <span class="org-builtin">echo</span> $<span class="org-variable-name">i</span>;sleep 2;
            <span class="org-builtin">echo</span> &gt;&amp;5
        }&amp;
    <span class="org-keyword">done</span>
    <span class="org-builtin">wait</span>
    <span class="org-builtin">echo</span> <span class="org-string">'Time: '</span> <span class="org-string">"$(($(date +%s) -start))"</span>
}

<span class="org-keyword">function</span> <span class="org-function-name">main</span>() {
    Multi_process_init  $<span class="org-variable-name">max_process</span>
    myecho
    <span class="org-keyword">exec</span> 5&gt;&amp;-;<span class="org-keyword">exec</span> 5&lt;&amp;- <span class="org-comment-delimiter">#</span><span class="org-comment">&#20851;&#38381;&#25991;&#20214;&#25805;&#20316;&#31526;&#24517;&#39035;&#20998;&#24320;&#20889;
</span>}

main

[root@stor01 ~]# sh test.sh 2
2
1
3
4
5
6
7
8
9
10
Time:  10
[root@stor01 ~]# sh test.sh 9
7
3
4
5
8
9
1
6
2
10
Time:  4
[root@stor01 ~]#
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-应用场景" class="outline-3">
<h3 id="应用场景"><a href="#应用场景">应用场景</a></h3>
<div class="outline-text-3" id="text-应用场景">
<p>
1 利用travis同步gcr.io镜像到dockerhub
<a href="https://zhangguanzhang.github.io/2018/07/08/travis-sync-gcr-io/">https://zhangguanzhang.github.io/2018/07/08/travis-sync-gcr-io/</a>
</p>

<p>
在拉取镜像时的脚本
<a href="https://github.com/zhangguanzhang/bash/blob/master/google_containers_sync/v2.sh">https://github.com/zhangguanzhang/bash/blob/master/google_containers_sync/v2.sh</a>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span><span class="org-variable-name">max_process</span>=$<span class="org-variable-name">1</span>
<span class="org-variable-name">REPOSITORY</span>=gcr.io/google_containers
<span class="org-variable-name">MY_REPO</span>=zhangguanzhang
<span class="org-variable-name">interval</span>=.
<span class="org-variable-name">max_per</span>=70

<span class="org-function-name">Multi_process_init</span>() {
    <span class="org-keyword">trap</span> <span class="org-string">'exec 5&gt;&amp;-;exec 5&lt;&amp;-;exit 0'</span> 2
    <span class="org-variable-name">pipe</span>=<span class="org-sh-quoted-exec">`mktemp -u tmp.XXXX`</span>
    mkfifo $<span class="org-variable-name">pipe</span>
    <span class="org-keyword">exec</span> 5&lt;&gt;$<span class="org-variable-name">pipe</span>
    rm -f $<span class="org-variable-name">pipe</span>

    seq $<span class="org-variable-name">1</span> &gt;&amp;5
}

<span class="org-comment-delimiter">#  </span><span class="org-comment">GCR_IMAGE_NAME  tag  REPO_IMAGE_NAME
</span><span class="org-function-name">image_tag</span>(){
    docker pull $<span class="org-variable-name">1</span>:$<span class="org-variable-name">2</span>
    docker tag $<span class="org-variable-name">1</span>:$<span class="org-variable-name">2</span> $<span class="org-variable-name">3</span>:$<span class="org-variable-name">2</span>
    docker rmi $<span class="org-variable-name">1</span>:$<span class="org-variable-name">2</span>
<span class="org-comment-delimiter">#    </span><span class="org-comment">docker push $4/$3:$2
</span>}

<span class="org-function-name">img_clean</span>(){
    <span class="org-keyword">while </span><span class="org-builtin">read</span> img tag null;<span class="org-keyword">do</span>
        docker push $<span class="org-variable-name">img</span>:$<span class="org-variable-name">tag</span>;docker rmi $<span class="org-variable-name">img</span>:$<span class="org-variable-name">tag</span>;
        [ <span class="org-string">"$tag"</span> != latest ] &amp;&amp; :&gt;$<span class="org-variable-name">repository_dir</span>/<span class="org-sh-quoted-exec">`sed 's#'"$MY_REPO/$Prefix"'##'&lt;&lt;&lt;$img`</span>/$<span class="org-variable-name">tag</span> || {
            gcloud container images list-tags --format=<span class="org-string">'get(DIGEST)'</span> <span class="org-sh-escaped-newline">\</span>
                <span class="org-sh-quoted-exec">`sed "s#$MY_REPO/$Prefix#${REPOSITORY%/}/#"&lt;&lt;&lt;$img`</span> --filter=<span class="org-string">"tags=latest"</span> <span class="org-sh-escaped-newline">\</span>
                &gt; $<span class="org-variable-name">repository_dir</span>/<span class="org-sh-quoted-exec">`sed 's#'"$MY_REPO/$Prefix"'##'&lt;&lt;&lt;$img`</span>/$<span class="org-variable-name">tag</span>
        }
    <span class="org-keyword">done</span> &lt; &lt;(docker images --format {{.Repository}}<span class="org-string">' '</span>{{.Tag}}<span class="org-string">' '</span>{{.Size}} | awk -vcut=$<span class="org-variable-name">MY_REPO</span>/$<span class="org-variable-name">Prefix</span> <span class="org-string">'$0~cut{print $0 | "sort -hk3" }'</span>)
}
<span class="org-function-name">image_pull</span>(){
    <span class="org-variable-name">Prefix</span>=<span class="org-sh-quoted-exec">`sed 's#/#'"$interval"'#g'&lt;&lt;&lt;${REPOSITORY%/}/`</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">REPOSITORY is the name of the dir,convert the '/' to '.',and cut the last '.'
</span>    <span class="org-variable-name">repository_dir</span>=${<span class="org-variable-name">Prefix</span>::-1}
    [ <span class="org-negation-char">!</span> -d <span class="org-string">"$repository_dir"</span> ] &amp;&amp; mkdir $<span class="org-variable-name">repository_dir</span>

    <span class="org-keyword">while </span><span class="org-builtin">read</span> GCR_IMAGE_NAME;<span class="org-keyword">do</span>
        <span class="org-variable-name">image_name</span>=${<span class="org-variable-name">GCR_IMAGE_NAME</span>##*/}
        <span class="org-variable-name">MY_REPO_IMAGE_NAME</span>=${<span class="org-variable-name">Prefix</span>}${<span class="org-variable-name">image_name</span>}
        [ <span class="org-negation-char">!</span> -d <span class="org-string">"$repository_dir/$image_name"</span> ] &amp;&amp; mkdir -p <span class="org-string">"$repository_dir/$image_name"</span>
        [ -f <span class="org-string">"$repository_dir/$image_name"</span>/latest ] &amp;&amp; mv $<span class="org-variable-name">repository_dir</span>/$<span class="org-variable-name">image_name</span>/latest{,.old}
        <span class="org-keyword">while </span><span class="org-builtin">read</span> tag;<span class="org-keyword">do</span>
        <span class="org-comment-delimiter">#</span><span class="org-comment">&#22788;&#29702;latest&#26631;&#31614;
</span>            [[ <span class="org-string">"$tag"</span> == latest &amp;&amp; -f <span class="org-string">"$repository_dir/$image_name"</span>/latest.old ]] &amp;&amp; {
                gcloud container images list-tags --format=<span class="org-string">'get(DIGEST)'</span> $<span class="org-variable-name">GCR_IMAGE_NAME</span> --filter=<span class="org-string">"tags=latest"</span> &gt; $<span class="org-variable-name">repository_dir</span>/$<span class="org-variable-name">image_name</span>/latest
                diff $<span class="org-variable-name">repository_dir</span>/$<span class="org-variable-name">image_name</span>/latest{,.old} &amp;&gt;/dev/null &amp;&amp;
                    { rm -f $<span class="org-variable-name">repository_dir</span>/$<span class="org-variable-name">image_name</span>/latest.old;<span class="org-keyword">continue</span>; } ||
                    rm $<span class="org-variable-name">repository_dir</span>/$<span class="org-variable-name">image_name</span>/latest{,.old}
            }
            [ -f <span class="org-string">"$repository_dir/$image_name/$tag"</span> ] &amp;&amp; <span class="org-keyword">continue</span>
            [ $(df -h| awk  <span class="org-string">'$NF=="/"{print +$5}'</span>) -ge <span class="org-string">"$max_per"</span> ] &amp;&amp; { <span class="org-builtin">wait</span>;img_clean; }
            <span class="org-builtin">read</span> -u5
            {
                [ -n <span class="org-string">"$tag"</span> ] &amp;&amp; image_tag $<span class="org-variable-name">GCR_IMAGE_NAME</span> $<span class="org-variable-name">tag</span> $<span class="org-variable-name">MY_REPO</span>/$<span class="org-variable-name">MY_REPO_IMAGE_NAME</span>
                <span class="org-builtin">echo</span> &gt;&amp;5
            }&amp;
        <span class="org-keyword">done</span> &lt; &lt;(gcloud container images list-tags $<span class="org-variable-name">GCR_IMAGE_NAME</span>  --format=<span class="org-string">"get(TAGS)"</span> --filter=<span class="org-string">'tags:*'</span> | sed <span class="org-string">'s#;#\n#g'</span>)
        <span class="org-builtin">wait</span>
    <span class="org-keyword">done</span> &lt; &lt;(gcloud container images list --repository=$<span class="org-variable-name">REPOSITORY</span> --format=<span class="org-string">"value(NAME)"</span>)
}


<span class="org-function-name">main</span>(){
    Multi_process_init $<span class="org-variable-name">max_process</span>
    image_pull
    img_clean
    <span class="org-keyword">exec</span> 5&gt;&amp;-;<span class="org-keyword">exec</span> 5&lt;&amp;-
}

main
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-bash高级重定向" class="outline-2">
<h2 id="bash高级重定向"><a href="#bash高级重定向">Bash高级重定向</a></h2>
<div class="outline-text-2" id="text-bash高级重定向">
</div>
<div id="outline-container-h:2e4f6100-bdfd-4230-b5e1-10057944b81f" class="outline-3">
<h3 id="h:2e4f6100-bdfd-4230-b5e1-10057944b81f"><a href="#h:2e4f6100-bdfd-4230-b5e1-10057944b81f">Bash高级重定向</a></h3>
<div class="outline-text-3" id="text-h:2e4f6100-bdfd-4230-b5e1-10057944b81f">
<p>
在Shell中，具备重定向基础之后就能满足绝大多数需求了，但是还可以学习更
多关于文件描述符的操作。
</p>

<p>
Linux中读写文件都会通过文件描述符来完成，而不是通过文件名来完成的，所
以只要打开文件，Linux内核就会为程序分配一个文件描述符。
</p>

<p>
例如cat a.log会打开a.log文件并分配一个文件描述符，cat命令退出后，打开
的文件就会被关闭，所分配的文件描述符也会释放。
</p>
</div>
<div id="outline-container-获取当前终端" class="outline-4">
<h4 id="获取当前终端"><a href="#获取当前终端">获取当前终端</a></h4>
<div class="outline-text-4" id="text-获取当前终端">
<p>
当前终端是
</p>

<ul class="org-ul">
<li>标准输入fd=0</li>
<li>标准输出fd=1</li>
<li>标准错误fd=2的默认数据流目标。</li>
</ul>

<p>
如何知道当前是在哪个终端下呢？Linux一切皆文件，终端也是文件，是终端设
备文件，在/dev目录下。
</p>

<p>
tty命令可以获取当前Shell所在的终端，这是最快获取终端的方式。
</p>

<div class="org-src-container">
<pre class="src src-sh">$ tty
/dev/pts/0
</pre>
</div>

<p>
此外，还能通过其它间接方式来肉眼判断，比较麻烦罢了。
</p>

<div class="org-src-container">
<pre class="src src-sh"> $ readlink /proc/self/fd/1
/dev/pts/0

$ ps -o tty | tail -n 1
pts/0
</pre>
</div>
</div>
</div>
<div id="outline-container-bash初始分配的文件描述符" class="outline-4">
<h4 id="bash初始分配的文件描述符"><a href="#bash初始分配的文件描述符">Bash初始分配的文件描述符</a></h4>
<div class="outline-text-4" id="text-bash初始分配的文件描述符">
<p>
bash自身也是一个进程，它会打开0、1、2三个文件描述符，它们默认都对应终
端文件。只要在bash中运行的外部命令，都是bash的子进程，所以会继承这三个
文件描述符。
</p>

<p>
此外，如果bash是交互式的bash，那么它还需要连接到一个终端上，终端也是文
件，所以交互式bash要为连接的终端文件分配一个文件描述符，默认分配的是
fd=255。
</p>

<div class="org-src-container">
<pre class="src src-sh">$ echo $<span class="org-variable-name">$</span>
799
$ ls -l /proc/799/fd/
total 0
lrwx------ 1 root root 64 Jan 26 21:48 0 -&gt; /dev/pts/1
lrwx------ 1 root root 64 Jan 26 21:48 1 -&gt; /dev/pts/1
lrwx------ 1 root root 64 Jan 26 21:48 2 -&gt; /dev/pts/1
lrwx------ 1 root root 64 Jan 26 21:49 255 -&gt; /dev/pts/1
</pre>
</div>

<p>
此外，如果使用了路径自动提示功能(比如两次tab键)，在提示目录中的文件时，
需要打开那个目录，所以要为这个目录分配一个文件描述符，因为提示或补全也
是bash的内置功能，所以是bash负责打开那个目录的，所分配的文件描述是当前
最小的可用的整数。但是，如果没有使用路径提示或补全，则不会分配该文件描
述符。
</p>

<div class="org-src-container">
<pre class="src src-sh">$ ls -l /proc/799/fd/   <span class="org-comment-delimiter"># </span><span class="org-comment">tab&#20004;&#27425;
</span>0    1    2    255  3    
$ ls -l /proc/799/fd/
</pre>
</div>
</div>
</div>
<div id="outline-container-再看基础重定向操作" class="outline-4">
<h4 id="再看基础重定向操作"><a href="#再看基础重定向操作">再看基础重定向操作</a></h4>
<div class="outline-text-4" id="text-再看基础重定向操作">
<p>
对于基本的重定向操作应该都很熟悉，比如：
</p>

<div class="org-src-container">
<pre class="src src-sh">$ echo hello world &gt;/tmp/a.log
$ cat &lt;/tmp/a.log
</pre>
</div>

<p>
但是在命令行中指定的重定向目标都只在该命令中有效，命令退出后，重定向行
为就消失了。
</p>

<p>
如果想让Shell下的所有命令都向某文件写数据呢？那么就在bash下修改fd=1的
目标即可：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">exec</span> &gt;/tmp/a.log
</pre>
</div>

<p>
exec是shell内置命令，那么第一时间我们就要想一想这是不是一个Shell环境设
置类的操作。
</p>

<p>
答案是确定的，这个操作会设置当前bash进程的标准输出fd=1的数据流目标为
/tmp/a.log。
</p>

<p>
由于bash下运行的命令都是bash的子进程，会继承bash进程的设置，所以经过上
面的设置后，其它命令的标准输出默认也会输出到/tmp/a.log文件。
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">echo</span> helloworld
cat /etc/fstab
</pre>
</div>

<p>
同理，对标准输入也是一样的设置方式：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">exec</span> &lt;/tmp/a.log
</pre>
</div>

<p>
那如何恢复bash的标准输出呢？只需要将fd=1重新重定向到终端设备文件上即可：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">exec</span> &gt;$(tty)
cat /etc/fstab
</pre>
</div>

<p>
<b>open file 打开文件描述符</b>
其实，每个重定向操作也是打开文件的操作，同时会分配文件描述符。
</p>

<p>
比如echo ha &gt;a.log命令，Shell会打开a.log文件并将fd=1关联到该文件，当
echo进程运行时会继承Shell的fd=1以及它关联的a.log属性，于是echo的标准输
出就会输出到a.log中。
</p>

<p>
但是在命令中打开的文件(包括重定向)都是临时的，命令退出完后文件就会关闭，
所分配的文件描述符也会释放。
</p>

<p>
在Shell中，可以手动打开文件：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">exec</span> N&lt;&gt; FILENAME
</pre>
</div>

<p>
整数N建议在[3,9]范围内，超出9的文件描述符有可能已经被bash内部使用了。
</p>

<p>
这表示在当前Shell进程内打开文件FILENAME并分配文件描述符N，只要不手动关
闭文件，只要当前Shell进程不退出，那么打开的FILENAME就一直处于打开状态。
</p>

<p>
例如：
</p>

<div class="org-src-container">
<pre class="src src-sh">$ exec 3&lt;&gt; /tmp/a.log
$ lsof -n | grep /tmp/a.log | grep -v grep
bash  342   root  3u  REG   8,2   0  101410762 /tmp/a.log
</pre>
</div>

<p>
范例：利用重定向模拟浏览器访问网站
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#exec 8&lt;&gt;/dev/tcp/www.baidu.com/80  <span class="org-comment-delimiter"># </span><span class="org-comment">&#25171;&#24320;&#26412;&#22320;&#25991;&#20214;&#25551;&#36848;&#31526; &#35775;&#38382;baidu
</span>[root@centos8 ~]#ll /proc/$<span class="org-variable-name">$</span>/fd
lrwx------ 1 root root 64 Apr 20 14:14 8 -&gt; <span class="org-string">'socket:[32777]'</span>
[root@centos8 ~]# ss -nt |grep 80
ESTAB      0      0      10.0.1.86:41430              182.61.200.7:80
[root@centos8 ~]#echo -e <span class="org-string">'GET / HTTP/1.1\n'</span> &gt;&amp; 8 <span class="org-comment-delimiter"># </span><span class="org-comment">&#27169;&#25311;GET&#35831;&#27714;
</span>[root@centos8 ~]#cat &lt;&amp; 8 <span class="org-comment-delimiter">#</span><span class="org-comment">&#35835;&#21462;&#25551;&#36848;&#20869;&#23481; &#19978;&#38754;&#21160;&#20316;&#24555;&#20123;&#65292;&#19981;&#28982;&#36825;&#37324;&#27809;&#26377;&#20869;&#23481;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-close-file-关闭文件描述符" class="outline-4">
<h4 id="close-file-关闭文件描述符"><a href="#close-file-关闭文件描述符">close file 关闭文件描述符</a></h4>
<div class="outline-text-4" id="text-close-file-关闭文件描述符">
<p>
在编程的时候，不再使用的文件就要关闭，以便释放文件描述符，防止程序一直
占用文件，导致无法释放文件占用的磁盘空间。如果大量文件描述符不关闭，还
可能达到打开文件的上限，使得程序报错。
</p>

<p>
虽然在Shell中可以无视这种问题，但有时候为了测试或为了某些逻辑，还是需
要关闭文件描述符。
</p>

<p>
关闭文件描述符的方式：
</p>

<div class="org-src-container">
<pre class="src src-sh">[exec] N&gt;&amp;-
[exec] N&lt;&amp;-
</pre>
</div>

<p>
这表示关闭文件描述符N。如果是用 <code>exec N&lt;&gt;FILENAME</code> 打开的文件，则上面两
种方式都能关闭N。
</p>

<div class="org-src-container">
<pre class="src src-sh">$ exec 3&lt;&gt; /tmp/a.log
$ lsof -n | grep /tmp/a.log | grep -v grep
bash  342   root  3u  REG   8,2   0  101410762 /tmp/a.log

$ exec 3&lt;&amp;-  <span class="org-comment-delimiter"># </span><span class="org-comment">&#25110;exec 3&gt;&amp;-
</span>$ lsof -n | grep /tmp/a.log | grep -v grep
</pre>
</div>
</div>
</div>
<div id="outline-container-fd-duplicate-文件描述符的复制" class="outline-4">
<h4 id="fd-duplicate-文件描述符的复制"><a href="#fd-duplicate-文件描述符的复制">fd duplicate 文件描述符的复制</a></h4>
<div class="outline-text-4" id="text-fd-duplicate-文件描述符的复制">
<p>
通常被翻译为文件描述符的复制。
</p>

<p>
当内核为某个打开的文件FILE分配文件描述符N后，N和FILE就有了关联关系。可
以简单而不严谨地认为，fd=N指向了磁盘文件FILE。
</p>

<p>
比如 <code>exec 3&lt;&gt; FILE</code> 表示当前Shell环境下，fd=3已经关联到了FILE文件。而对
于 <code>cat a.log &gt;&gt;b.log</code> 命令，可认为fd=1关联到了b.log文件。
</p>

<p>
文件描述符的复制语法：
</p>

<div class="org-src-container">
<pre class="src src-sh">[exec] [M]&gt;&amp;N   <span class="org-comment-delimiter"># </span><span class="org-comment">&#30465;&#30053;M&#26102;&#65292;&#40664;&#35748;M=1&#65292;&#21363;&#26631;&#20934;&#36755;&#20986;
</span>[exec] [M]&lt;&amp;N   <span class="org-comment-delimiter"># </span><span class="org-comment">&#30465;&#30053;M&#26102;&#65292;&#40664;&#35748;M=0&#65292;&#21363;&#26631;&#20934;&#36755;&#20837;</span>
</pre>
</div>

<p>
fd dup表示新分配一个文件描述符M，使得M也关联到N关联的文件FILE上。换句
话说，M是N的一个副本，就像是复制了N文件描述符一样，于是现在M和N都关联
到了FILE文件。这就像是复制了软链接，两个软链接都指向同一个目标文件。
</p>

<p>
例如：
</p>

<div class="org-src-container">
<pre class="src src-sh">$ exec 3&lt;&gt; a.log
$ exec 4&gt;&amp;3
$ lsof -n | grep /tmp/a.log | grep -v grep
bash  342  root  3u  REG  8,2  0  69331702 /root/a.log
bash  342  root  4u  REG  8,2  0  69331702 /root/a.log
</pre>
</div>

<p>
因为fd=3和fd=4都关联在a.log上，所以无论是使用fd=3还是fd=4来写入数据，
都是向a.log写入数据。
</p>

<p>
那如何向fd=3或fd=4写入数据呢？只能借助fd=1，因为Shell下的命令(除非是你
自己写的脚本或程序)默认都使用标准输出fd=1来输出正确数据，fd=2输出错误
数据，并且默认使用标准输入fd=0来读取数据。
</p>

<p>
所以，只需要将标准输出fd=1关联到fd=3或fd=4上即可，这样命令写入fd=1的数
据，也会写入fd=3和fd=4对应的磁盘文件中，因为它们三都关联在同一个磁盘文
件上。
</p>

<div class="org-src-container">
<pre class="src src-sh">$ echo helloworld &gt;&amp;3
$ cat a.log
helloworld

$ echo HELLOWORLD &gt;&amp;4
$ cat a.log
helloworld
HELLOWORLD
</pre>
</div>

<p>
注意上面echo命令中的fd dup是临时的，echo退出后因回到了Shell进程，使得
fd=1又重新关联到/dev/stdout，也即当前终端。
</p>

<p>
可以使用exec直接改变当前Shell环境的标准输入、标准输出、标准错误的默认
目标：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">exec</span> &gt;&amp;3   <span class="org-comment-delimiter"># </span><span class="org-comment">&#24403;&#21069;Shell&#25152;&#26377;&#26631;&#20934;&#36755;&#20986;&#37117;&#23558;&#36755;&#20986;&#21040;fd=3&#25152;&#20851;&#32852;&#30340;&#30340;&#25991;&#20214;
</span><span class="org-keyword">exec</span> 2&gt;&amp;3  <span class="org-comment-delimiter"># </span><span class="org-comment">&#24403;&#21069;Shell&#25152;&#26377;&#26631;&#20934;&#38169;&#35823;&#37117;&#23558;&#36755;&#20986;&#21040;fd=3&#25152;&#20851;&#32852;&#30340;&#30340;&#25991;&#20214;
</span><span class="org-keyword">exec</span> &lt;&amp;4   <span class="org-comment-delimiter"># </span><span class="org-comment">&#24403;&#21069;Shell&#23558;&#40664;&#35748;&#20174;fd=4&#25152;&#20851;&#32852;&#30340;&#30340;&#25991;&#20214;&#20013;&#35835;&#21462;&#25968;&#25454;</span>
</pre>
</div>

<p>
这样修改后，即使之后的命令中不指定重定向，它们的输出、输入也会是a.log。
</p>

<div class="org-src-container">
<pre class="src src-sh">$ echo hellohellohello
</pre>
</div>

<p>
一般修改fd=0、1、2的目标都是临时行为，之后都会将其重新恢复其目标，即关
联到当前终端。两种方式可恢复：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">&#26041;&#24335;1.&#25913;&#21464;&#30446;&#26631;&#20043;&#21069;&#20808;&#22791;&#20221;&#24403;&#21069;&#30446;&#26631;&#65292;&#20197;&#20415;&#24674;&#22797;&#26102;&#20351;&#29992;
</span><span class="org-keyword">exec</span> 9&gt;&amp;1  <span class="org-comment-delimiter"># </span><span class="org-comment">fd=1&#21644;fd=9&#37117;&#20851;&#32852;&#21040;&#32456;&#31471;
</span><span class="org-keyword">exec</span> &gt;&amp;3   <span class="org-comment-delimiter"># </span><span class="org-comment">&#25913;&#21464;fd=1&#30340;&#30446;&#26631;&#65292;&#27492;&#26102;fd=9&#20173;&#28982;&#20851;&#32852;&#21040;&#32456;&#31471;
</span>......     <span class="org-comment-delimiter"># </span><span class="org-comment">&#19968;&#20123;&#25805;&#20316;
</span><span class="org-keyword">exec</span> &gt;&amp;9 ;<span class="org-keyword">exec</span> 9&gt;&amp;-  <span class="org-comment-delimiter"># </span><span class="org-comment">&#24674;&#22797;fd=1&#20351;&#20854;&#20851;&#32852;&#21040;&#32456;&#31471;&#65292;&#28982;&#21518;&#20851;&#38381;fd=9
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">&#26041;&#24335;2.&#30452;&#25509;&#36890;&#36807;tty&#33719;&#21462;&#24403;&#21069;&#32456;&#31471;&#65292;&#24182;&#37325;&#26032;&#37325;&#23450;&#21521;
</span><span class="org-keyword">exec</span> &gt;&amp;3  <span class="org-comment-delimiter"># </span><span class="org-comment">&#25913;&#21464;fd=1&#30340;&#30446;&#26631;
</span>......    <span class="org-comment-delimiter"># </span><span class="org-comment">&#19968;&#20123;&#25805;&#20316;
</span><span class="org-keyword">exec</span> &gt;$(tty)  <span class="org-comment-delimiter"># </span><span class="org-comment">tty&#33719;&#21462;&#24403;&#21069;&#32456;&#31471;&#65292;&#28982;&#21518;&#37325;&#23450;&#21521;&#25913;&#21464;&#30446;&#26631;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-fd-move-文件描述符的移动" class="outline-4">
<h4 id="fd-move-文件描述符的移动"><a href="#fd-move-文件描述符的移动">fd move 文件描述符的移动</a></h4>
<div class="outline-text-4" id="text-fd-move-文件描述符的移动">
<p>
还可执行文件描述的移动操作。文件描述符的移动，表示先复制源文件描述符，
再删除源文件描述符。
</p>

<div class="org-src-container">
<pre class="src src-sh">[exec] [M]&gt;&amp;N-    <span class="org-comment-delimiter"># </span><span class="org-comment">&#30465;&#30053;M&#26102;&#65292;&#40664;&#35748;M=1
</span>[exec] [M]&lt;&amp;N-    <span class="org-comment-delimiter"># </span><span class="org-comment">&#30465;&#30053;M&#26102;&#65292;&#40664;&#35748;M=0</span>
</pre>
</div>

<p>
这等价于：
</p>

<div class="org-src-container">
<pre class="src src-sh">[exec] [M]&gt;&amp;N;N&gt;&amp;-    <span class="org-comment-delimiter"># </span><span class="org-comment">&#30465;&#30053;M&#26102;&#65292;&#40664;&#35748;M=1
</span>[exec] [M]&lt;&amp;N;N&lt;&amp;-    <span class="org-comment-delimiter"># </span><span class="org-comment">&#30465;&#30053;M&#26102;&#65292;&#40664;&#35748;M=0</span>
</pre>
</div>

<p>
即，先fd dup得到fd=N的副本fd=M，同时关闭fd=N。这就实现了从fd=N关联文件
FILE变成fd=M关联文件FILE。
</p>

<p>
例如：
</p>

<div class="org-src-container">
<pre class="src src-sh">$ exec 4&lt;&gt; /tmp/a.log
$ exec 5&gt;&amp;4-
$ lsof -n | grep /tmp/a.log | grep -v grep
bash  1118  root  5u  REG  8,2  39  101410762 /tmp/a.log
</pre>
</div>
</div>
</div>
<div id="outline-container-自动分配文件描述符号" class="outline-4">
<h4 id="自动分配文件描述符号"><a href="#自动分配文件描述符号">自动分配文件描述符号</a></h4>
<div class="outline-text-4" id="text-自动分配文件描述符号">
<p>
使用重定向方式打开文件时，可以将手动指定的文件描述符数值指定为一个
<code>{var_name}</code> 格式，这样bash会自动分配文件描述符号，并将文件描述符数值
保存到bash变量var_name中。
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">exec</span> {tmp_alog}&lt;&gt;/tmp/a.log
<span class="org-builtin">echo</span> $<span class="org-variable-name">tmp_alog</span>       <span class="org-comment-delimiter"># </span><span class="org-comment">11
</span><span class="org-keyword">exec</span> {tmp_alog}&gt; /tmp/a.log
<span class="org-builtin">echo</span> $<span class="org-variable-name">tmp_alog</span>       <span class="org-comment-delimiter"># </span><span class="org-comment">12</span>
</pre>
</div>

<p>
关闭文件描述符时也可以使用这个变量：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">exec</span> {tmp_alog}&gt;&amp;-
</pre>
</div>
</div>
</div>
<div id="outline-container-read从文件描述符读取数据" class="outline-4">
<h4 id="read从文件描述符读取数据"><a href="#read从文件描述符读取数据">read从文件描述符读取数据</a></h4>
<div class="outline-text-4" id="text-read从文件描述符读取数据">
<p>
read是bash内置命令，它默认从标准输入中读取数据，但也可以使用-u FD选项
指定从文件描述符中读取数据。
</p>

<p>
例如，两个文件a.log和b.log：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">a.log&#30340;&#20869;&#23481;
</span>a
b
c

<span class="org-comment-delimiter"># </span><span class="org-comment">b.log&#30340;&#20869;&#23481;
</span>aa
bb
cc
</pre>
</div>

<p>
现在想要将两个文件内容一一对应起来，得到：
</p>

<div class="org-src-container">
<pre class="src src-sh">a aa
b bb
c cc
</pre>
</div>

<p>
实现的方法有很多种，但如果使用read呢？
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">exec</span> 3&lt;&gt; a.log
<span class="org-keyword">exec</span> 4&lt;&gt; b.log
<span class="org-keyword">while </span><span class="org-builtin">read</span> -u 3 linea;<span class="org-keyword">do</span>
  <span class="org-builtin">read</span> -u 4 lineb
  <span class="org-builtin">echo</span> $<span class="org-variable-name">linea</span> $<span class="org-variable-name">lineb</span>
<span class="org-keyword">done</span>
<span class="org-keyword">exec</span> 3&gt;&amp;-
<span class="org-keyword">exec</span> 4&gt;&amp;-
</pre>
</div>

<p>
如果想省略关闭文件描述符的操作，只需将打开文件和while循环放在子Shell这
中执行即可，子Shell的环境设置不会影响父Shell：
</p>

<div class="org-src-container">
<pre class="src src-sh">(<span class="org-keyword">exec</span> 3&lt;&gt; a.log;<span class="org-keyword">exec</span> 4&lt;&gt; b.log;<span class="org-keyword">while </span><span class="org-builtin">read</span> -u 3 linea;<span class="org-keyword">do </span><span class="org-builtin">read</span> -u 4 lineb;<span class="org-builtin">echo</span> $<span class="org-variable-name">linea</span> $<span class="org-variable-name">lineb</span>;<span class="org-keyword">done</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-bash中的here-document" class="outline-3">
<h3 id="bash中的here-document"><a href="#bash中的here-document">bash中的here document</a></h3>
<div class="outline-text-3" id="text-bash中的here-document">
<p>
here document表示这里是一个文档，文档有起始和终止标记，起始和终止标记
中间的内容，属于文档内容。
</p>

<p>
虽说here document作为文档可以当作一个文件名来看待，但因为它是以重定向
的方式存在的，使得它有各种使用姿势。
</p>
</div>
<div id="outline-container-将here-document内容写进文件" class="outline-4">
<h4 id="将here-document内容写进文件"><a href="#将here-document内容写进文件">将here document内容写进文件</a></h4>
<div class="outline-text-4" id="text-将here-document内容写进文件">
<div class="org-src-container">
<pre class="src src-sh">cat &gt;&gt;a.log &lt;&lt;EOF<span class="org-sh-heredoc">
abc
def
EOF
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">&#25110;&#32773;
</span>cat &lt;&lt;EOF&gt;&gt;a.log<span class="org-sh-heredoc">
abc
def
EOF</span>
</pre>
</div>

<p>
这就是here document作为一种重定向语法的好处，使用here
document时，它的位置可以随意摆放，而不像使用文件名，位置固定死了。
</p>
</div>
</div>
<div id="outline-container-将here-document内容放进管道" class="outline-4">
<h4 id="将here-document内容放进管道"><a href="#将here-document内容放进管道">将here document内容放进管道</a></h4>
<div class="outline-text-4" id="text-将here-document内容放进管道">
<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">&#26041;&#26696;&#19968;
</span>cat &lt;&lt;EOF | awk <span class="org-string">'{print}'</span><span class="org-sh-heredoc">
abc
def
EOF
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">&#26041;&#26696;&#20108;
</span>( cat | awk <span class="org-string">'{print}'</span>) &lt;&lt;EOF <span class="org-sh-heredoc">
abc
def
EOF
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">&#26041;&#26696;&#19977;
</span>{ cat | awk <span class="org-string">'{print}'</span>; } &lt;&lt;EOF<span class="org-sh-heredoc">
abc
def
EOF
</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">&#26041;&#26696;&#22235;
</span>{
cat &lt;&lt;EOF<span class="org-sh-heredoc">
abc
def
EOF
</span>} | awk <span class="org-string">'{print}'</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">&#26041;&#26696;&#20116;
</span>(
cat &lt;&lt;EOF<span class="org-sh-heredoc">
abc
def
EOF
</span>) | awk <span class="org-string">'{print}'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-多个here-document嵌套" class="outline-4">
<h4 id="多个here-document嵌套"><a href="#多个here-document嵌套">多个here document嵌套</a></h4>
<div class="outline-text-4" id="text-多个here-document嵌套">
<div class="org-src-container">
<pre class="src src-sh">(cat ; <span class="org-builtin">echo</span> <span class="org-string">'======='</span>; cat &lt;&amp;3) &lt;&lt;EOF 3&lt;&lt;eof<span class="org-sh-heredoc">
abc
def
EOF
ghi
jkl
eof</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-脚本编程补缺-01-shell里的进程替换process-substitution" class="outline-3">
<h3 id="脚本编程补缺-01-shell里的进程替换process-substitution"><a href="#脚本编程补缺-01-shell里的进程替换process-substitution">shell里的进程替换(Process Substitution)</a></h3>
<div class="outline-text-3" id="text-脚本编程补缺-01-shell里的进程替换process-substitution">
<p>
<code>( cat ) &lt; "a.sh"</code> 表示从文件中读取内容交给cat 处理 那么 <code>&lt;( comand )</code>
是什么意思呢？
</p>

<p>
bash 和 zsh 里都支持进程替换(Process Substitution)
</p>

<p>
写法为：
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;(command) &#25110; &gt;(command)
</pre>
</div>

<p>
说明： Process substitution (进程替换) 只有在支持命名管道 (FIFOs)，或
者支持使用 /dev/fd 方式为打开的文件命名的系统中才可用。 它的形式是
&lt;(list) 或者是 &gt;(list)。 进程 list 运行时的输入或输出被连接到一个 FIFO
或者 /dev/fd中的文件。文件的名称作为一个参数被传递到当前命令，作为扩展
的结果。如果使用 &gt;(list) 形式，向文件写入相当于为 list 提供输入。如果
使用&lt;(list) 形式，可以读作为参数传递 的文件来获得 list 的输出
</p>

<p>
比如:
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cat &lt;(ls)       <span class="org-comment-delimiter">#</span><span class="org-comment">&#25226;&lt;(ls)&#24403;&#19968;&#20010;&#20020;&#26102;&#25991;&#20214;&#65292;&#25991;&#20214;&#20869;&#23481;&#26159;ls&#30340;&#32467;&#26524;&#65292;cat&#36825;&#20010;&#20020;&#26102;&#25991;&#20214;
</span>$ ls &gt; &gt;(cat)      <span class="org-comment-delimiter">#</span><span class="org-comment">&#25226;&gt;(cat)&#24403;&#25104;&#20020;&#26102;&#25991;&#20214;&#65292;ls&#30340;&#32467;&#26524;&#37325;&#23450;&#21521;&#21040;&#36825;&#20010;&#25991;&#20214;&#65292;&#26368;&#21518;&#36825;&#20010;&#25991;&#20214;&#34987;cat
</span>&#29992;&#36827;&#31243;&#26367;&#25442;&#23558; std &#21644; err &#36755;&#20986;&#20998;&#21035;&#23450;&#21521;:

$ some_command &gt; &gt;(/bin/cmd_for_stdout) 2&gt; &gt;(/bin/cmd_for_stderr)
</pre>
</div>

<p>
另参考这里：
</p>

<p>
<a href="http://www.ibm.com/developerworks/cn/aix/library/au-satzsh.html">http://www.ibm.com/developerworks/cn/aix/library/au-satzsh.html</a>
</p>

<p>
里面有更多例子，比如：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#20351;&#29992;&#20020;&#26102;&#25991;&#20214;&#26469;&#23558;&#19968;&#20010;&#25991;&#20214;&#20013;&#30340;&#23383;&#27573;&#25552;&#21462;&#24182;&#37325;&#26032;&#32452;&#21512;&#21040;&#21478;&#19968;&#20010;&#25991;&#20214;&#20013;
</span>$ cut -f1 fileone &gt;t1
$ cut -f5 filetone &gt;t5
$ paste t1 t5

<span class="org-comment-delimiter">#</span><span class="org-comment">&#29992;&#36827;&#31243;&#26367;&#25442;&#21487;&#20197;&#26080;&#38656;&#20020;&#26102;&#25991;&#20214;&#23436;&#25104;&#27492;&#20219;&#21153;
</span>$ paste -d: &lt;(cut -d: -f1 /etc/passwd) &lt;(cut -d: -f5 /etc/passwd)

<span class="org-comment-delimiter">#</span><span class="org-comment">&#36827;&#31243;&#26367;&#25442;&#25903;&#25345;&#23884;&#22871;
</span>$ sort &lt;(egrep -v <span class="org-string">'^#'</span> &lt;(paste -d: &lt;(cut -d: -f5 /etc/passwd)  &lt;(cut -d: -f1 /etc/passwd) ) )
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">declare</span> -A MasterArray
<span class="org-variable-name">MasterArray</span>=([<span class="org-string">'k8s-m1'</span>]=10.0.6.166 [<span class="org-string">'k8s-m2'</span>]=10.0.6.167 [<span class="org-string">'k8s-m3'</span>]=10.0.6.168)
sed -ri <span class="org-string">'$r '</span>&lt;( paste -d <span class="org-string">''</span> &lt;(seq -f <span class="org-string">'IP.%g = '</span> 2 $[${#<span class="org-variable-name">MasterArray</span>[@]}+1])  &lt;(xargs -n1&lt;&lt;&lt;${<span class="org-variable-name">MasterArray</span>[@]} | sort) ) ~/k8s-manual-files/pki/openssl.cnf
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">[root@ct8-ts1 ~]# declare -A MasterArray
[root@ct8-ts1 ~]# <span class="org-variable-name">MasterArray</span>=([<span class="org-string">'k8s-m1'</span>]=10.0.6.166 [<span class="org-string">'k8s-m2'</span>]=10.0.6.167 [<span class="org-string">'k8s-m3'</span>]=10.0.6.168)
[root@ct8-ts1 ~]# seq -f <span class="org-string">'IP.%g = '</span> 2 $[${#<span class="org-variable-name">MasterArray</span>[@]}+1]
IP.2 = 
IP.3 = 
IP.4 = 
[root@ct8-ts1 ~]# xargs -n1&lt;&lt;&lt;${<span class="org-variable-name">MasterArray</span>[@]
&gt; ^C
[root@ct8-ts1 ~]# xargs -n1&lt;&lt;&lt;${<span class="org-variable-name">MasterArray</span>[@]}
10.0.6.167
10.0.6.168
10.0.6.166
[root@ct8-ts1 ~]# paste -d <span class="org-string">''</span> &lt;(seq -f <span class="org-string">'IP.%g = '</span> 2 $[${#<span class="org-variable-name">MasterArray</span>[@]}+1])  &lt;(xargs -n1&lt;&lt;&lt;${<span class="org-variable-name">MasterArray</span>[@]} | sort)
IP.2 = 10.0.6.166
IP.3 = 10.0.6.167
IP.4 = 10.0.6.168

[root@ct8-ts1 ~]# echo <span class="org-string">"abc"</span>&gt;a
<span class="org-comment-delimiter">#</span><span class="org-comment">r &#23558;&#25991;&#20214;&#20013;&#30340;&#20869;&#23481;&#35835;&#20837;&#21040;&#21305;&#37197;&#30340;&#20869;&#23481;&#21518;&#38754;
</span>[root@ct8-ts1 ~]# sed -ri <span class="org-string">'$r '</span>&lt;( paste -d <span class="org-string">''</span> &lt;(seq -f <span class="org-string">'IP.%g = '</span> 2 $[${#<span class="org-variable-name">MasterArray</span>[@]}+1])  &lt;(xargs -n1&lt;&lt;&lt;${<span class="org-variable-name">MasterArray</span>[@]} | sort) ) a
[root@ct8-ts1 ~]# cat a
abc
IP.2 = 10.0.6.166
IP.3 = 10.0.6.167
IP.4 = 10.0.6.168
</pre>
</div>

<p>
原文地址：<a href="http://hongjiang.info/shell-process-substitution/">http://hongjiang.info/shell-process-substitution/</a>
</p>
</div>
</div>
</section>
<section id="outline-container-h:8298d36b-6a38-4fd6-a0af-e751d5f071e4" class="outline-2">
<h2 id="h:8298d36b-6a38-4fd6-a0af-e751d5f071e4"><a href="#h:8298d36b-6a38-4fd6-a0af-e751d5f071e4">嵌套子命令</a></h2>
<div class="outline-text-2" id="text-h:8298d36b-6a38-4fd6-a0af-e751d5f071e4">
<p>
<b>自动补全</b> 的功能，就可以极大的提高工具的易用性，还可以保留命令行工具原有的高效。
</p>
</div>
<div id="outline-container-bash自动补全" class="outline-3">
<h3 id="bash自动补全"><a href="#bash自动补全">bash自动补全</a></h3>
<div class="outline-text-3" id="text-bash自动补全">
<p>
在Linux命令行下，输入字符后，按两次Tab键，shell就会列出以这些字符打头
的所有可用命令。如果只有一个命令匹配到，按一次Tab键就自动将这个命令补
全。
</p>
</div>
<div id="outline-container-补全说明" class="outline-4">
<h4 id="补全说明"><a href="#补全说明">补全说明</a></h4>
<div class="outline-text-4" id="text-补全说明">
<p>
自动补全是Bash自带的一个强大的功能，允许通过编码指定命令参数如何补全。
通常，补全脚本会放在/etc/bash_completion.d/目录下，方便统一启用所有补
全脚本。
</p>

<p>
范例：foo补全
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#35774;&#32622;foo&#21629;&#20196;&#34917;&#20840;
</span><span class="org-comment-delimiter"># </span><span class="org-comment">cat /etc/bash_completion.d/foo.bash  
</span><span class="org-function-name">_foo</span>()  
{  
    <span class="org-builtin">local</span> <span class="org-variable-name">cur</span>=${<span class="org-variable-name">COMP_WORDS</span>[COMP_CWORD]}  
    <span class="org-variable-name">COMPREPLY</span>=( $(compgen -W <span class="org-string">"exec help test"</span> -- $<span class="org-variable-name">cur</span>) )  
}  
complete -F _foo foo

<span class="org-comment-delimiter">#</span><span class="org-comment">&#39564;&#35777;foo&#21629;&#20196;&#34917;&#20840;
</span><span class="org-comment-delimiter"># </span><span class="org-comment">chmod +x /etc/bash_completion.d/foo.bash  
</span><span class="org-comment-delimiter"># </span><span class="org-comment">source /etc/bash_completion.d/foo.bash  
</span><span class="org-comment-delimiter"># </span><span class="org-comment">foo [Tab][Tab]  
</span><span class="org-keyword">exec</span>  help  test
</pre>
</div>

<p>
开机生效
</p>

<p>
<code>source /etc/bash_completion.d/foo.bash</code> 命令放入开机启动中
</p>

<p>
全局配置在不同 linux 发行版可能位置不同，如下：
</p>

<ul class="org-ul">
<li>centos <i>etc/bashrc 或个人 ~</i>.bashrc</li>
<li>Ubuntu <i>etc/bash.bashrc 或个人 ~</i>.bashrc</li>
</ul>

<p>
补全命令：complete、compgen、compopt
</p>
</div>
<div id="outline-container-complete-补全命令" class="outline-5">
<h5 id="complete-补全命令"><a href="#complete-补全命令">complete 补全命令</a></h5>
<div class="outline-text-5" id="text-complete-补全命令">
<p>
这是命令补全最核心的命令了
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">help complete 
</span>-F <span class="org-keyword">function</span>   :&#25191;&#34892;shell &#20989;&#25968;&#65292;&#20989;&#25968;&#20013;&#29983;&#25104;COMPREPLY&#20316;&#20026;&#20505;&#36873;&#30340;&#34917;&#20840;&#32467;&#26524;
-C command    :&#23558; command &#21629;&#20196;&#30340;&#25191;&#34892;&#32467;&#26524;&#20316;&#20026;&#20505;&#36873;&#30340;&#34917;&#20840; &#32467;&#26524;
-G pattern    :&#23558;&#21305;&#37197; pattern&#30340;&#25991;&#20214;&#21517;&#20316;&#20026;&#20505;&#36873;&#30340;&#34917;&#20840;&#32467;&#26524;
-W wordlist   :&#20998;&#21106; wordlist &#20013;&#30340;&#21333;&#35789;&#65292;&#20316;&#20026;&#20505;&#36873;&#30340;&#34917;&#20840;&#32467;&#26524;
-p [name]     :&#21015;&#20986;&#24403;&#21069;&#25152;&#26377;&#30340;&#34917;&#20840;&#21629;&#20196;
-r [name]     :&#21024;&#38500;&#26576;&#20010;&#34917;&#20840;&#21629;
-o  &#31867;&#22411;
&#8220;-o bashdefault&#8221;&#65306;&#22914;&#26524;&#27809;&#26377;&#29983;&#25104;&#34917;&#20840;&#26465;&#30446;&#65292;&#23601;&#20351;&#29992;bash&#40664;&#35748;&#30340;&#20854;&#23427;&#34917;&#20840;&#12290; 
&#8220;-o default&#8221;&#65306;&#22914;&#26524;&#27809;&#26377;&#29983;&#25104;&#34917;&#20840;&#26465;&#30446;&#65292;&#23601;&#20351;&#29992;&#8220;readline&#8221;&#40664;&#35748;&#30340;&#25991;&#20214;&#21517;&#34917;&#20840;&#12290; 
&#8220;-o dirnames&#8221;&#65306;&#22914;&#26524;&#27809;&#26377;&#29983;&#25104;&#34917;&#20840;&#26465;&#30446;&#65292;&#23601;&#36827;&#34892;&#30446;&#24405;&#21517;&#34917;&#20840;&#12290; 
&#8220;-o filenames&#8221;&#65306;&#21578;&#35785;&#8220;readline&#8221;&#29983;&#25104;&#25991;&#20214;&#21517;&#65292;&#20197;&#20415;&#36827;&#34892;&#19982;&#25991;&#20214;&#21517;&#30456;&#20851;&#30340;&#22788;&#29702;&#65292;
  &#20363;&#22914;&#22312;&#30446;&#24405;&#21517;&#21518;&#38754;&#21152;&#19978;&#26012;&#26464;&#65292;&#24341;&#29992;&#29305;&#27530;&#23383;&#31526;&#65292;&#21435;&#25481;&#34892;&#23614;&#30340;&#31354;&#26684;&#65292;&#30446;&#30340;&#26159;&#29992;&#20110;shell&#20989;&#25968;&#12290; 
&#8220;-o noquote&#8221;&#65306;&#21578;&#35785;&#8220;readline&#8221;&#19981;&#24341;&#29992;&#25991;&#20214;&#21517;&#65292;&#40664;&#35748;&#20250;&#36827;&#34892;&#24341;&#29992;&#12290; 
&#8220;-o nospace&#8221;&#65306;&#21578;&#35785;&#8220;readline&#8221;&#22312;&#34917;&#20840;&#30340;&#21517;&#31216;&#21518;&#19981;&#28155;&#21152;&#31354;&#26684;&#65292;&#40664;&#35748;&#28155;&#21152;&#31354;&#26684;&#12290; 
&#8220;-o plusdirs&#8221;&#65306;&#29983;&#25104;&#34917;&#20840;&#26465;&#30446;&#20043;&#21518;&#65292;&#36824;&#20250;&#36827;&#34892;&#30446;&#24405;&#21517;&#34917;&#20840;&#24182;&#25226;&#32467;&#26524;&#28155;&#21152;&#21040;&#20854;&#23427;&#21160;&#20316;&#24471;&#21040;&#30340;&#32467;&#26524;&#20013;&#12290;
</pre>
</div>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#34917;&#20840;foo
</span>complete -W <span class="org-string">'word1 word2 word3 test'</span> foo  
<span class="org-comment-delimiter"># </span><span class="org-comment">&#39564;&#35777;&#34917;&#20840;
</span><span class="org-comment-delimiter"># </span><span class="org-comment">foo w&lt;Tab&gt;  
</span><span class="org-comment-delimiter"># </span><span class="org-comment">foo word&lt;Tab&gt;  
</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">&#21015;&#20986;&#24403;&#21069;&#34917;&#20840;&#30340;&#21629;&#20196;
</span>complete -p  

<span class="org-comment-delimiter">#</span><span class="org-comment">&#21024;&#38500;&#34917;&#20840;&#21629;&#20196;
</span>complete -r foo  

<span class="org-comment-delimiter">#</span><span class="org-comment">&#25191;&#34892;&#20989;&#25968;&#65292;&#20989;&#25968;&#20013;&#29983;&#25104;COMPREPLY&#20316;&#20026;&#20505;&#36873;&#30340;&#34917;&#20840;&#32467;&#26524;
</span>complete -F  __cmd_HUB  bsu
&#34920;&#31034;&#24403;&#25191;&#34892;bsu&#21629;&#20196;&#26102;&#65292;&#33258;&#21160;&#34917;&#20840;&#30340;&#20505;&#36873;&#21333;&#35789;&#30001;&#20989;&#25968;__cmd_HUB&#35745;&#31639;&#24471;&#21040;&#65292;&#20855;&#20307;&#30340;&#25215;&#36733;&#23481;&#22120;&#26159;&#21464;&#37327;COMPREPLY
</pre>
</div>
</div>
</div>
<div id="outline-container-compgen-筛选命令" class="outline-5">
<h5 id="compgen-筛选命令"><a href="#compgen-筛选命令">compgen 筛选命令</a></h5>
<div class="outline-text-5" id="text-compgen-筛选命令">
<p>
这个命令，用来筛选生成 匹配单词的 候选补全结果
</p>

<pre class="example" id="org9566d9f">
# help compgen
-W wordlist  分割 wordlist 中的单词，生成候选补全列表
</pre>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">compgen -W 'word1 word2 test'   
</span>word1  
word2  
test  
<span class="org-comment-delimiter"># </span><span class="org-comment">compgen -W 'word1 word2 test' word   
</span>word1  
word2

&#21629;&#20196;&#65306;compgen -W <span class="org-string">"aa ab bb cc"</span> -- &#8220;a&#8221;   
&#34920;&#31034;&#20174;<span class="org-string">"aa ab bb cc"</span>  &#21305;&#37197;&#20986;&#20197;&#8220;a&#8221;&#24320;&#22836;&#30340;&#21333;&#35789;
&#36825;&#26465;&#21629;&#20196;&#30340;&#36820;&#22238;&#32467;&#26524;&#23601;&#26159; &#8220;aa ab&#8221;&#12290; 


&#35201;&#21015;&#20986;&#25152;&#26377;&#21487;&#29992;&#30340;&#21629;&#20196;&#65292;&#21482;&#38656;&#38190;&#20837;&#20197;&#19979;&#21629;&#20196;
compgen -c
&#35201;&#21015;&#20986;&#21487;&#29992;&#30340;&#25152;&#26377;bash shell&#21035;&#21517;&#65292;&#35831;&#36755;&#20837;&#65306;
compgen -a
&#26174;&#31034;&#25152;&#26377;bash&#20869;&#32622;&#25554;&#20214;&#65292;&#20869;&#24314;&#21629;&#20196;
compgen -b
&#26174;&#31034;&#25152;&#26377;bash&#20851;&#38190;&#23383;
compgen -k
&#26174;&#31034;&#25152;&#26377;bash&#20989;&#25968;
compgen -A <span class="org-keyword">function</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-compopt-修改补全命令设置" class="outline-5">
<h5 id="compopt-修改补全命令设置"><a href="#compopt-修改补全命令设置">compopt 修改补全命令设置</a></h5>
<div class="outline-text-5" id="text-compopt-修改补全命令设置">
<p>
这个命令可以修改补全命令设置，注意了，这个命令必须在补全函数中使用，否
则会报错。
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">help compopt
</span>+o option    :&#21551;&#29992; option &#37197;&#32622;
-o option    :&#24323;&#29992; option &#37197;&#32622;
</pre>
</div>

<p>
范例：例如，设置命令补全后不要多加空格，方法如下：
</p>

<div class="org-src-container">
<pre class="src src-sh">compopt -o nospace
</pre>
</div>
</div>
</div>
<div id="outline-container-内置补全变量" class="outline-5">
<h5 id="内置补全变量"><a href="#内置补全变量">内置补全变量</a></h5>
<div class="outline-text-5" id="text-内置补全变量">
<p>
除了上面三个命令外，Bash还有几个内置变量来辅助补全功能，如下
</p>

<pre class="example" id="org825ba40">
COMP_WORDS       ：类型为数组，存放当前命令行中输入的所有单词
COMP_CWORD       ：类型为整数，当前输入的单词在COMP_WORDS中的索引。可以访问命令行中不用位置的单词。
COMPREPLY        ：类型为数组，候选的补全结果
COMP_WORDBREAKS  ：类型为字符串，表示单词之间的分隔符
COMP_LINE        ：类型为字符串，表示当前的命令行输入字符
COMP_POINT       ：类型为整数，表示光标在当前命令行的哪个位置
</pre>
</div>
</div>
</div>
<div id="outline-container-参数自动补全" class="outline-4">
<h4 id="参数自动补全"><a href="#参数自动补全">参数自动补全</a></h4>
<div class="outline-text-4" id="text-参数自动补全">
<p>
比如ip 命令，后面有很多子命令形成工具集的功能。
</p>

<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-sh">cat &lt;&lt;\eof &gt;cli-test.sh<span class="org-sh-heredoc">
_complete_func() {
    local cur prev opts base
    COMPREPLY=()
    cur="${COMP_WORDS[COMP_CWORD]}"  #&#24403;&#21069;&#22312;&#36755;&#20837;&#30340;&#21333;&#35789;
    prev="${COMP_WORDS[COMP_CWORD-1]}" #&#24403;&#21069;&#21333;&#35789;&#21069;&#19968;&#20010;&#21333;&#35789;

    opts="-h -u -d -p"

    if [[ ${cur} == -* ]] ; then
        COMPREPLY=( $(compgen -W "${opts}" -- ${cur}) )
        return 0
    fi

}

complete -F _complete_func cli-test.sh
#&#25191;&#34892;&#20989;&#25968;&#65292;&#20989;&#25968;&#20013;&#29983;&#25104;COMPREPLY&#20316;&#20026;&#20505;&#36873;&#30340;&#34917;&#20840;&#32467;&#26524;
eof
</span>
<span class="org-comment-delimiter">#</span><span class="org-comment">&#34917;&#20840;&#29983;&#25928;
</span><span class="org-builtin">source</span> cli-test.sh
chmod +x cli-test.sh
~]# ./cli-test.sh -
-d  -h  -p  -u
</pre>
</div>

<p>
范例：
</p>

<p>
vim /apps/ops/guard/guard_complete
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-function-name">_comp_ssh</span> () {
    <span class="org-variable-name">iprconfig</span>=<span class="org-string">"${COMP_WORDS[0]}"</span>
    <span class="org-variable-name">cur</span>=<span class="org-string">"${COMP_WORDS[COMP_CWORD]}"</span>
    <span class="org-variable-name">prev</span>=<span class="org-string">"${COMP_WORDS[COMP_CWORD-1]}"</span>

    <span class="org-keyword">case</span> <span class="org-string">"${prev}"</span><span class="org-keyword"> in</span>
<span class="org-comment-delimiter">#    </span><span class="org-comment">"s")
</span><span class="org-comment-delimiter">#        </span><span class="org-comment">opts=$(echo start)
</span><span class="org-comment-delimiter">#        </span><span class="org-comment">COMPREPLY=( $(compgen -W "${opts}" -- ${cur}) )
</span><span class="org-comment-delimiter">#        </span><span class="org-comment">;;
</span><span class="org-comment-delimiter">#    </span><span class="org-comment">"-k")
</span><span class="org-comment-delimiter">#        </span><span class="org-comment">COMPREPLY=( $(compgen -o dirnames -- ${cur}) )
</span><span class="org-comment-delimiter">#        </span><span class="org-comment">;;
</span>    *)
        <span class="org-variable-name">opts</span>=$(ls -l /etc/guard/|grep guard |awk <span class="org-string">'{print $NF}'</span> |sed <span class="org-string">'s/.guard//g'</span> |sed <span class="org-string">'s/cop.//g'</span> |sed <span class="org-string">'s/owt.//g'</span> |sed <span class="org-string">'s/pdl.//g'</span> |sed <span class="org-string">'s/servicegroup.//g'</span> |sed <span class="org-string">'s/service.//g'</span> |sed <span class="org-string">'s/job.//g'</span> |sed <span class="org-string">'s/cluster.//g'</span>|sort |uniq)
        <span class="org-variable-name">COMPREPLY</span>=( $(compgen -W <span class="org-string">"${opts}"</span> -- ${<span class="org-variable-name">cur</span>}) )
        ;;
    <span class="org-keyword">esac</span>
    <span class="org-keyword">return</span> 0;
}
complete -F _comp_ssh guard
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">[root@base01 ~] <span class="org-variable-name">eth0</span> = 10.16.40.165
<span class="org-comment-delimiter"># </span><span class="org-comment">ls -l /etc/guard/|grep guard |awk '{print $NF}' |sed 's/.guard//g' |sed 's/cop.//g' |sed 's/owt.//g' |sed 's/pdl.//g' |sed 's/servicegroup.//g' |sed 's/service.//g' |sed 's/job.//g' |sed 's/cluster.//g'|sort |uniq
</span>captain
falcon

<span class="org-comment-delimiter"># </span><span class="org-comment">&#25928;&#26524;
</span>. /apps/ops/guard/guard_complete
[root@base01 ~] <span class="org-variable-name">eth0</span> = 10.16.40.165
<span class="org-comment-delimiter"># </span><span class="org-comment">guard  &#25353;TAB&#34917;&#20840;
</span>captain  falcon 
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-keyword">function</span> <span class="org-function-name">_my_cmpl</span>() {  
    <span class="org-builtin">local</span> my_cmpl_words cur  
    <span class="org-variable-name">COMPREPLY</span>=()  
    <span class="org-variable-name">cur</span>=<span class="org-string">"${COMP_WORDS[COMP_CWORD]}"</span>  
    <span class="org-variable-name">my_cmpl_words</span>=<span class="org-sh-quoted-exec">`cat /tmp/my_word_list`</span>  
    <span class="org-variable-name">COMPREPLY</span>=( $( compgen -W <span class="org-string">"$my_cmpl_words"</span> -- <span class="org-string">"$cur"</span> ) )  
}  
complete -F _my_cmpl ssh ping myscript  
</pre>
</div>
</div>
</div>
<div id="outline-container-别名补全" class="outline-4">
<h4 id="别名补全"><a href="#别名补全">别名补全</a></h4>
<div class="outline-text-4" id="text-别名补全">
<p>
通常我们更喜欢短别名而不是长命令，但 bash
不支持别名的命令完成。然后你可以使用complete-alias插件。
</p>

<div class="org-src-container">
<pre class="src src-sh">git clone https://github.com/cykerway/complete-alias ~/.complete-alias
</pre>
</div>

<p>
例如，别名kubectl为k
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">vim ~/.bashrc
</span><span class="org-builtin">alias</span> <span class="org-variable-name">k</span>=kubectl
<span class="org-builtin">source</span> &lt;(kubectl completion bash)
. ~/.complete-alias/complete_alias
complete -F _complete_alias k
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-zsh自动补全" class="outline-3">
<h3 id="zsh自动补全"><a href="#zsh自动补全">zsh自动补全</a></h3>
<div class="outline-text-3" id="text-zsh自动补全">
</div>
<div id="outline-container-参数自动补全-1" class="outline-4">
<h4 id="参数自动补全-1"><a href="#参数自动补全-1">参数自动补全</a></h4>
<div class="outline-text-4" id="text-参数自动补全-1">
<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">compdef cli-test.sh
</span><span class="org-comment-delimiter"># </span><span class="org-comment">filename: _cli-test.h
</span>
<span class="org-function-name">_cli_test</span>() {

    _arguments -C -s -S <span class="org-sh-escaped-newline">\</span>
               <span class="org-string">'-h::'</span> <span class="org-sh-escaped-newline">\</span>
               <span class="org-string">'-u::'</span> <span class="org-sh-escaped-newline">\</span>
               <span class="org-string">'-d::'</span> <span class="org-sh-escaped-newline">\</span>
               <span class="org-string">'-p::'</span>
}

_cli_test <span class="org-string">"$@"</span>
</pre>
</div>

<ul class="org-ul">
<li><code>_arguments</code> 为zsh自带函数，类似 bash 中的 compgen ，但是功能更加强
大。</li>
<li><code>-h::</code> 分割的3部分分别是 “待补全的参数:参数的说明:动态补全参数的内
容“</li>
</ul>

<p>
zsh 中有个 fpath 的内置变量，将自动补全脚本放在 <code>$fpath</code> 中，或者在
<code>$​fpath</code> 中创建指向自动补全的脚本的软连接都可以。 下面是我的环境中
fpath的值
</p>

<pre class="example" id="org0f070ad">
echo $fpath
/usr/local/share/zsh/site-functions /usr/share/zsh/site-functions /usr/share/zsh/5.8/functions
</pre>

<p>
为了测试 zsh 下自动补全是否有效，我在 fpath下给自己的自动补全脚本创建
了软连接
</p>

<pre class="example" id="orgde49ad6">
$ cd /usr/local/share/zsh/site-functions
$ ln -s ~/projects/bash/autocomp/_cli-test.sh _cli-test.sh

#验证
$ ./cli-test.sh -&lt;TAB&gt;&lt;TAB&gt;
-d  -h  -p  -u
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:bb7efdc7-d751-41a0-90e8-ff52fc4f8a5b" class="outline-2">
<h2 id="h:bb7efdc7-d751-41a0-90e8-ff52fc4f8a5b"><a href="#h:bb7efdc7-d751-41a0-90e8-ff52fc4f8a5b">man帮助和实用技巧</a></h2>
<div class="outline-text-2" id="text-h:bb7efdc7-d751-41a0-90e8-ff52fc4f8a5b">
</div>
<div id="outline-container-man-bash" class="outline-3">
<h3 id="man-bash"><a href="#man-bash">man bash</a></h3>
<div class="outline-text-3" id="text-man-bash">
<p>
GNU 官方 Bash 文档：<a href="https://www.gnu.org/software/bash/">https://www.gnu.org/software/bash/</a>
</p>

<p>
Bash 是 GNU 工程的 shell——Bourne Again SHell。这是一个与 sh 兼容的 shell，它结合了 Korn shell （ksh） 和 C shell （csh） 的有用功能。它旨在符合 IEEE POSIX P1003.2/ISO 9945.2 外壳和工具标准。它为编程和交互式使用提供了比 sh 的功能改进。此外，大多数 sh 脚本都可以由 Bash 运行，无需修改。
</p>

<p>
Bash 的文档可以在线获得，大多数 GNU 软件的文档也是如此。您还可以通过运行 <code>info bash</code> 或 <code>man bash</code> 查看 <i>usr/share/doc/bash/、/usr/local/share/doc/bash</i> 系统上的类似目录来查找有关 Bash 的信息。可通过运行 <code>bash --help</code> 获得简要摘要。
</p>

<p>
man 文档翻译：
</p>
<ul class="org-ul">
<li><a href="https://github.com/man-pages-zh/manpages-zh">https://github.com/man-pages-zh/manpages-zh</a></li>
<li><a href="https://manpages.debian.org/unstable/manpages-zh/index.html">https://manpages.debian.org/unstable/manpages-zh/index.html</a></li>
<li><a href="http://manpages.ubuntu.com/manpages/bionic/zh_CN/man1/bash.1.html">http://manpages.ubuntu.com/manpages/bionic/zh_CN/man1/bash.1.html</a></li>
</ul>
</div>
</div>
<div id="outline-container-shell中判断字符串是否为数字的6种方法" class="outline-3">
<h3 id="shell中判断字符串是否为数字的6种方法"><a href="#shell中判断字符串是否为数字的6种方法">Shell中判断字符串是否为数字的6种方法</a></h3>
<div class="outline-text-3" id="text-shell中判断字符串是否为数字的6种方法">
<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">    
</span><span class="org-comment-delimiter"># </span><span class="org-comment">=~ &#27492;&#34920;&#36798;&#24335;&#29992;&#20110;[[ ]]&#20013;&#21491;&#20391;&#26159;&#25193;&#23637;&#30340;&#27491;&#21017;&#34920;&#36798;&#24335;
</span>[root@centos8 ~]#<span class="org-variable-name">N</span>=100
[root@centos8 ~]#[[ <span class="org-string">"$N"</span> =~ ^[0-9]+$ ]]  <span class="org-comment-delimiter"># </span><span class="org-comment">&#21028;&#26029;&#26159;&#21542;&#20026;&#25968;&#23383;
</span>[root@centos8 ~]#echo $<span class="org-variable-name">?</span>
0

[[ <span class="org-string">"$var"</span> =~ ^[0-9]+[.]?[0-9]+$ ]] &amp;&amp; <span class="org-builtin">echo</span> int || <span class="org-builtin">echo</span> no

<span class="org-variable-name">var</span>=100.20
awk <span class="org-string">'BEGIN{ b="'</span>$<span class="org-variable-name">var</span><span class="org-string">'";if (b~/^[0-9]+[.]?[0-9]+$/){print b } }'</span>

<span class="org-comment-delimiter">## </span><span class="org-comment">&#26041;&#27861;1
</span><span class="org-variable-name">a</span>=1234;<span class="org-builtin">echo</span> <span class="org-string">"$a"</span>|[ -n <span class="org-string">"`sed -n '/^[0-9][0-9]*$/p'`"</span> ] &amp;&amp; <span class="org-builtin">echo</span> string a is numbers
        &#31532;&#19968;&#20010;-n&#26159;shell&#30340;&#27979;&#35797;&#26631;&#24535;&#65292;&#23545;&#21518;&#38754;&#30340;&#20018;<span class="org-string">"`sed -n '/^[0-9][0-9]*$/p'`"</span> &#36827;&#34892;&#27979;&#35797;&#65292;&#22914;&#26524;&#38750;&#31354;&#65292;&#21017;&#32467;&#26524;&#20026;&#30495;&#12290;
            sed&#40664;&#35748;&#20250;&#26174;&#31034;&#25152;&#26377;&#36755;&#20837;&#34892;&#20449;&#24687;&#30340;&#65292;sed &#30340;&#8220;-n&#8221;&#36873;&#39033;&#26159;&#35753;sed&#19981;&#35201;&#26174;&#31034;&#65292;&#32780;&#21482;&#26174;&#31034;&#25105;&#20204;&#25152;&#38656;&#35201;&#30340;&#20869;&#23481;&#65306;&#21363;&#21518;&#38754;&#30340;&#34920;&#36798;&#24335;&#25152;&#21305;&#37197;&#30340;&#34892;&#65292;&#36825;&#26159;&#36890;&#36807;&#34920;&#36798;&#24335;&#20013;&#21152;&#20837;&#8220;p&#8221;&#21629;&#20196;&#26469;&#23454;&#29616;&#30340;&#12290;
        /^[0-9][0-9]*$/&#20182;&#30340;&#21547;&#20041;&#26159;&#21305;&#37197;&#33267;&#23569;&#30001;&#19968;&#20301;&#25968;&#23383;&#26500;&#25104;&#30340;&#34892;

<span class="org-comment-delimiter">## </span><span class="org-comment">&#26041;&#27861;2, &#21487;&#20197;&#65292;&#19981;&#36807;&#19981;&#26159;bash&#23454;&#29616;&#30340;&#65292;&#26159;&#20351;&#29992;&#20102;grep&#30340;&#27491;&#21017;
</span><span class="org-comment-delimiter">#</span><span class="org-comment">if grep '^[[:digit:]]*$' &lt;&lt;&lt; "$1";then
</span><span class="org-comment-delimiter">#     </span><span class="org-comment">echo "$1 is number."
</span><span class="org-comment-delimiter">#</span><span class="org-comment">else
</span><span class="org-comment-delimiter">#     </span><span class="org-comment">echo 'no.'
</span><span class="org-comment-delimiter">#</span><span class="org-comment">fi
</span>
<span class="org-comment-delimiter">## </span><span class="org-comment">&#26041;&#27861;3
</span><span class="org-comment-delimiter">#</span><span class="org-comment">if [ "$1" -gt 0 ] 2&gt;/dev/null ;then
</span><span class="org-comment-delimiter">#     </span><span class="org-comment">echo "$1 is number."
</span><span class="org-comment-delimiter">#</span><span class="org-comment">else
</span><span class="org-comment-delimiter">#     </span><span class="org-comment">echo 'no.'
</span><span class="org-comment-delimiter">#</span><span class="org-comment">fi
</span>
<span class="org-comment-delimiter">## </span><span class="org-comment">&#26041;&#27861;4,case
</span><span class="org-comment-delimiter">#</span><span class="org-comment">case "$1" in
</span><span class="org-comment-delimiter">#     </span><span class="org-comment">[1-9][0-9]*)    
</span><span class="org-comment-delimiter">#             </span><span class="org-comment">echo "$1 is number."
</span><span class="org-comment-delimiter">#             </span><span class="org-comment">;;
</span><span class="org-comment-delimiter">#     </span><span class="org-comment">*)    
</span><span class="org-comment-delimiter">#             </span><span class="org-comment">;;
</span><span class="org-comment-delimiter">#</span><span class="org-comment">esac
</span>
<span class="org-comment-delimiter">## </span><span class="org-comment">&#26041;&#27861;5,awk
</span><span class="org-comment-delimiter">#</span><span class="org-comment">echo $1| awk '{print($0~/^[-]?([0-9])+[.]?([0-9])+$/)?"number":"string"}'
</span>
<span class="org-comment-delimiter">## </span><span class="org-comment">&#26041;&#27861;5,awk
</span><span class="org-comment-delimiter">#</span><span class="org-comment">if [ -n "$(echo $1| sed -n "/^[0-9]\+$/p")" ];then
</span><span class="org-comment-delimiter">#     </span><span class="org-comment">echo "$1 is number."
</span><span class="org-comment-delimiter">#</span><span class="org-comment">else
</span><span class="org-comment-delimiter">#     </span><span class="org-comment">echo 'no.'
</span><span class="org-comment-delimiter">#</span><span class="org-comment">fi
</span>
<span class="org-comment-delimiter">## </span><span class="org-comment">&#26041;&#27861;6,expr
</span>expr $<span class="org-variable-name">1</span> <span class="org-string">"+"</span> 10 &amp;&gt; /dev/null
<span class="org-keyword">if</span> [ $<span class="org-variable-name">?</span> -eq 0 ];<span class="org-keyword">then</span>
        <span class="org-builtin">echo</span> <span class="org-string">"$1 is number"</span>
<span class="org-keyword">else</span>
        <span class="org-builtin">echo</span> <span class="org-string">"$1 not number"</span>
<span class="org-keyword">fi</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-linux下的命令可以用来作计算bcexprdcechoawk" class="outline-3">
<h3 id="linux下的命令可以用来作计算bcexprdcechoawk"><a href="#linux下的命令可以用来作计算bcexprdcechoawk">linux下的命令可以用来作计算bc、expr、dc、echo、awk</a></h3>
<div class="outline-text-3" id="text-linux下的命令可以用来作计算bcexprdcechoawk">
<p>
1、bc
</p>

<p>
bc在默认的情况下是个交互式的指令。在bc工作环境下，可以使用以下计算符号：
</p>

<div class="org-src-container">
<pre class="src src-sh">+ &#21152;&#27861;
- &#20943;&#27861;
* &#20056;&#27861;
/ &#38500;&#27861;
^ &#25351;&#25968;
% &#20313;&#25968;
</pre>
</div>

<p>
如：
</p>

<div class="org-src-container">
<pre class="src src-sh">1) <span class="org-comment-delimiter"># </span><span class="org-comment">bc
</span>3+6            &lt;=&#21152;&#27861;
9
4+2*3          &lt;=&#21152;&#27861;&#12289;&#20056;&#27861;
10
(4+2)*3        &lt;=&#21152;&#27861;&#12289;&#20056;&#27861;&#65288;&#20248;&#20808;&#65289;
18
4*6/8          &lt;=&#20056;&#27861;&#12289;&#38500;&#27861;
3
10^3           &lt;=&#25351;&#25968;
1000
18%5           &lt;=&#20313;&#25968;
3+4;5*2;5^2;18/4      &lt;=&#19968;&#34892;&#36755;&#20837;&#22810;&#20010;&#35745;&#31639;&#65292;&#29992;;&#30456;&#38548;&#12290;
7
10
25
4
quit           &lt;=&#36864;&#20986;

2) <span class="org-comment-delimiter"># </span><span class="org-comment">bc
</span><span class="org-variable-name">scale</span>=3         &lt;=&#35774;&#23567;&#25968;&#20301;
1/3
.333
quit
</pre>
</div>

<p>
以上是交互的计算，那到也可以不进行交互而直接计算出结果。
</p>

<p>
1.1用echo和 <code>|</code> 法，如：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">echo "(6+3)*2" |bc
</span>18

<span class="org-comment-delimiter"># </span><span class="org-comment">echo "scale=2;8/10"|bc
</span>.80

<span class="org-comment-delimiter"># </span><span class="org-comment">echo "3+4;5*2;5^2;18/4" |bc
</span>7
10
25
4
</pre>
</div>

<p>
另外，bc除了scale来设定小数位之外，还有ibase和obase来其它进制的运算。
如：
</p>

<div class="org-src-container">
<pre class="src src-sh">//&#23558;16&#36827;&#21046;&#30340;A7&#36755;&#20986;&#20026;10&#36827;&#21046;, &#27880;&#24847;&#65292;&#33521;&#25991;&#21482;&#33021;&#22823;&#20889;
<span class="org-comment-delimiter"># </span><span class="org-comment">echo "ibase=16;A7" |bc
</span>167

//&#23558;2&#36827;&#21046;&#30340;11111111&#36716;&#25104;10&#36827;&#21046;
<span class="org-comment-delimiter"># </span><span class="org-comment">echo "ibase=2;11111111" |bc
</span>255

//&#36755;&#20837;&#20026;16&#36827;&#21046;&#65292;&#36755;&#20986;&#20026;2&#36827;&#21046;
<span class="org-comment-delimiter"># </span><span class="org-comment">echo "ibase=16;obase=2;B5-A4" |bc
</span>10001
</pre>
</div>

<p>
对于bc还有补充，在bc &#x2013;help中还可以发现：bc后可以接文件名。如：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">more calc.txt
</span>3+2
4+5
8*2
10/4
<span class="org-comment-delimiter"># </span><span class="org-comment">bc calc.txt
</span>5
9
16
2
</pre>
</div>

<p>
2.expr
</p>

<p>
expr命令可不光能计算加减乘除哦，还有很多表达式，都可以计算出结果，不过
有一点需要注意，在计算加减乘除时，不要忘了使用空格和转义。
</p>

<p>
下面直接用实例来介绍一下expr的运算，如：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">expr 6 + 3       &#65288;&#26377;&#31354;&#26684;&#65289;
</span>9

<span class="org-comment-delimiter"># </span><span class="org-comment">expr 2 /* 3      &#65288;&#26377;&#36716;&#20041;&#31526;&#21495;&#65289;
</span>6

<span class="org-comment-delimiter"># </span><span class="org-comment">expr 14 % 9
</span>5

<span class="org-comment-delimiter"># </span><span class="org-comment">a=3
</span><span class="org-comment-delimiter"># </span><span class="org-comment">expr $a+5          &#65288;&#26080;&#31354;&#26684;&#65289;
</span>3+5
<span class="org-comment-delimiter"># </span><span class="org-comment">expr $a + 5         &#65288;&#21464;&#37327;&#65292;&#26377;&#31354;&#26684;&#65289;
</span>8

<span class="org-comment-delimiter"># </span><span class="org-comment">a=`expr 4 + 2`
</span><span class="org-builtin">echo</span> $<span class="org-variable-name">a</span>
6
<span class="org-comment-delimiter"># </span><span class="org-comment">expr $a + 3
</span>9

&#21478;&#22806;&#65292;expr&#23545;&#20110;&#23383;&#20018;&#30340;&#25805;&#20316;&#65288;&#35745;&#31639;&#65289;&#20063;&#26159;&#24456;&#26041;&#20415;&#30340;&#65292;&#22914;&#65306;
//&#23383;&#20018;&#38271;&#24230;
<span class="org-comment-delimiter"># </span><span class="org-comment">expr length "yangzhigang.cublog.cn"
</span>21
//&#20174;&#20301;&#32622;&#22788;&#25235;&#21462;&#23383;&#20018;
<span class="org-comment-delimiter"># </span><span class="org-comment">expr substr "yangzhigang.cublog.cn" 1 11
</span>yangzhigang

//&#23383;&#20018;&#24320;&#22987;&#22788;
<span class="org-comment-delimiter"># </span><span class="org-comment">expr index "yangzhigang.cublog.cn" cu
</span>13
</pre>
</div>

<p>
3.dc
</p>

<p>
用dc来进行计算的人可以不多，因为dc与bc相比要复杂，但是在进行简单的计划
时，是差不多的，不算难。dc为压栈操作，默认也是交互的，但也可以用echo
和 <code>|</code> 来配合打算。
</p>

<p>
如：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">dc
</span>3
2+
p
5
4*
p
20
quit

<span class="org-comment-delimiter"># </span><span class="org-comment">echo 3 2+ 4* p |dc
</span>20
</pre>
</div>

<p>
4.echo
</p>

<p>
echo用来进行回显，是周知的事。上面也配合bc来进行计算。其实echo也可以单
独进行简单的计算，如：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">echo $((3+5))
</span>8
<span class="org-comment-delimiter"># </span><span class="org-comment">echo $(((3+5)*2))
</span>16
</pre>
</div>

<p>
echo还可以进行变量的计算，如：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">a=10
</span><span class="org-comment-delimiter"># </span><span class="org-comment">b=5
</span><span class="org-comment-delimiter"># </span><span class="org-comment">echo $(($a+$b))
</span>15
<span class="org-comment-delimiter"># </span><span class="org-comment">echo $a+$b
</span>10+5
<span class="org-comment-delimiter"># </span><span class="org-comment">echo $a+$b |bc
</span>15

//&#35745;&#31639;&#21069;&#22825;&#30340;&#26085;&#26399;
<span class="org-comment-delimiter">#  </span><span class="org-comment">echo `date +%Y%m%d`
</span>20090813
<span class="org-comment-delimiter">#  </span><span class="org-comment">echo `date +%Y%m%d`-2
</span>20090813-2
<span class="org-comment-delimiter">#  </span><span class="org-comment">echo `date +%Y%m%d`-2 |bc
</span>20090811
</pre>
</div>

<p>
5.AWK awk在处理文件的时，可以进行运算，那当然也可以单单用来计算了，如：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">awk 'BEGIN{a=(3+2)*2;print a}'
</span>10
awk <span class="org-string">'BEGIN{printf "%.2f%\n",'</span>$<span class="org-variable-name">a</span><span class="org-string">'/'</span>$<span class="org-variable-name">b</span><span class="org-string">'*100}'</span>
awk <span class="org-string">'BEGIN{printf "%.2f%\n",(1/3)*100}'</span>
33.33%
</pre>
</div>
</div>
</div>
<div id="outline-container-shell进度条" class="outline-3">
<h3 id="shell进度条"><a href="#shell进度条">shell进度条</a></h3>
<div class="outline-text-3" id="text-shell进度条">
<div class="org-src-container">
<pre class="src src-sh">[root@agent01 ~]# sh c.sh
[####################################################################################################][100%]|
[root@agent01 ~]# cat c.sh
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash
</span><span class="org-variable-name">i</span>=0;
<span class="org-variable-name">str</span>=<span class="org-string">""</span>
<span class="org-variable-name">arr</span>=(<span class="org-string">"|"</span> <span class="org-string">"/"</span> <span class="org-string">"-"</span> <span class="org-string">"\\"</span>)
<span class="org-keyword">while</span> [ $<span class="org-variable-name">i</span> -le 100 ]
<span class="org-keyword">do</span>
  <span class="org-builtin">let</span> <span class="org-variable-name">index</span>=i%4
  <span class="org-builtin">let</span> <span class="org-variable-name">indexcolor</span>=i%8
  <span class="org-builtin">let</span> <span class="org-variable-name">color</span>=30+indexcolor
  printf <span class="org-string">"\e[0;$color;1m[%-100s][%d%%]%c\r\e[0m"</span> <span class="org-string">"$str"</span> <span class="org-string">"$i"</span> <span class="org-string">"${arr[$index]}"</span>
  usleep 50000
  <span class="org-builtin">let</span> i++
  <span class="org-comment-delimiter">#</span><span class="org-comment">str+='&#9608;'
</span>  <span class="org-variable-name">str</span>+=<span class="org-string">'#'</span>
<span class="org-keyword">done</span>
printf <span class="org-string">"\n"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-随机数" class="outline-3">
<h3 id="随机数"><a href="#随机数">随机数</a></h3>
<div class="outline-text-3" id="text-随机数">
</div>
<div id="outline-container-h:e586927b-fe45-4eb1-a8f6-8652a97f15d3" class="outline-4">
<h4 id="h:e586927b-fe45-4eb1-a8f6-8652a97f15d3"><a href="#h:e586927b-fe45-4eb1-a8f6-8652a97f15d3">脚本：使用系统的 $RANDOM 变量</a></h4>
<div class="outline-text-4" id="text-h:e586927b-fe45-4eb1-a8f6-8652a97f15d3">
<div class="org-src-container">
<pre class="src src-sh">fdipzone@ubuntu:~$ echo $<span class="org-variable-name">RANDOM</span>  
17617  
</pre>
</div>

<p>
$RANDOM 的范围是 [0, 32767]
</p>

<p>
范例：生成400000~500000的随机数
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">  
</span>
<span class="org-keyword">function</span> <span class="org-function-name">rand</span>(){  
    <span class="org-variable-name">min</span>=$<span class="org-variable-name">1</span>  
    <span class="org-variable-name">max</span>=$(($<span class="org-variable-name">2</span>-$<span class="org-variable-name">min</span>+1))  
    <span class="org-variable-name">num</span>=$(($<span class="org-variable-name">RANDOM</span>+1000000000)) <span class="org-comment-delimiter">#</span><span class="org-comment">&#22686;&#21152;&#19968;&#20010;10&#20301;&#30340;&#25968;&#20877;&#27714;&#20313;  
</span>    <span class="org-builtin">echo</span> $(($<span class="org-variable-name">num</span>%$<span class="org-variable-name">max</span>+$<span class="org-variable-name">min</span>))  
}  

<span class="org-variable-name">rnd</span>=$(rand 400000 500000)  
<span class="org-builtin">echo</span> $<span class="org-variable-name">rnd</span>  

<span class="org-keyword">exit</span> 0
</pre>
</div>
</div>
</div>
<div id="outline-container-h:47165a11-7373-4701-962a-11137cfffb6a" class="outline-4">
<h4 id="h:47165a11-7373-4701-962a-11137cfffb6a"><a href="#h:47165a11-7373-4701-962a-11137cfffb6a">脚本：使用date +%s%N</a></h4>
<div class="outline-text-4" id="text-h:47165a11-7373-4701-962a-11137cfffb6a">
<p>
范例：生成1~50的随机数
</p>
<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">  
</span>
<span class="org-keyword">function</span> <span class="org-function-name">rand</span>(){  
    <span class="org-variable-name">min</span>=$<span class="org-variable-name">1</span>  
    <span class="org-variable-name">max</span>=$(($<span class="org-variable-name">2</span>-$<span class="org-variable-name">min</span>+1))  
    <span class="org-variable-name">num</span>=$(date +%s%N)  
    <span class="org-builtin">echo</span> $(($<span class="org-variable-name">num</span>%$<span class="org-variable-name">max</span>+$<span class="org-variable-name">min</span>))  
}  

<span class="org-variable-name">rnd</span>=$(rand 1 50)  
<span class="org-builtin">echo</span> $<span class="org-variable-name">rnd</span>  

<span class="org-keyword">exit</span> 0  
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d9ac9287-b746-436f-b2fc-7ee028b9ef52" class="outline-4">
<h4 id="h:d9ac9287-b746-436f-b2fc-7ee028b9ef52"><a href="#h:d9ac9287-b746-436f-b2fc-7ee028b9ef52">脚本：使用/dev/random 和 /dev/urandom /dev/random</a></h4>
<div class="outline-text-4" id="text-h:d9ac9287-b746-436f-b2fc-7ee028b9ef52">
<p>
存储着系统当前运行环境的实时数据，是阻塞的随机数发生器，读取有时需要等
待。/dev/urandom 非阻塞随机数发生器，读取操作不会产生阻塞。
</p>

<p>
例：使用/dev/urandom生成100~500的随机数，使用urandom避免阻塞。
</p>

<div class="org-src-container">
<pre class="src src-sh">[plain] view plain copy
<span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/bash  
</span>
<span class="org-keyword">function</span> <span class="org-function-name">rand</span>(){  
    <span class="org-variable-name">min</span>=$<span class="org-variable-name">1</span>  
    <span class="org-variable-name">max</span>=$(($<span class="org-variable-name">2</span>-$<span class="org-variable-name">min</span>+1))  
    <span class="org-variable-name">num</span>=$(cat /dev/urandom | head -n 10 | cksum | awk -F <span class="org-string">' '</span> <span class="org-string">'{print $1}'</span>)  
    <span class="org-builtin">echo</span> $(($<span class="org-variable-name">num</span>%$<span class="org-variable-name">max</span>+$<span class="org-variable-name">min</span>))  
}  

<span class="org-variable-name">rnd</span>=$(rand 100 500)  
<span class="org-builtin">echo</span> $<span class="org-variable-name">rnd</span>  

<span class="org-keyword">exit</span> 0  
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b8f8ab6d-24c0-44dd-a56f-5f7f99e15f2d" class="outline-4">
<h4 id="h:b8f8ab6d-24c0-44dd-a56f-5f7f99e15f2d"><a href="#h:b8f8ab6d-24c0-44dd-a56f-5f7f99e15f2d">脚本：使用linux uuid uuid</a></h4>
<div class="outline-text-4" id="text-h:b8f8ab6d-24c0-44dd-a56f-5f7f99e15f2d">
<p>
全称是通用唯一识别码，格式包含32个16进制数字，以'-'连接号分为5段。形式
为8-4-4-4-12的32个字符。
</p>

<div class="org-src-container">
<pre class="src src-sh">fdipzone@ubuntu:~/shell$ cat /proc/sys/kernel/random/uuid  
fd496199-372a-403e-8ec9-bf4c52cbd9cd  
</pre>
</div>

<p>
范例：使用linux uuid 生成100~500随机数
</p>
<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">  
</span>
<span class="org-keyword">function</span> <span class="org-function-name">rand</span>(){  
    <span class="org-variable-name">min</span>=$<span class="org-variable-name">1</span>  
    <span class="org-variable-name">max</span>=$(($<span class="org-variable-name">2</span>-$<span class="org-variable-name">min</span>+1))  
    <span class="org-variable-name">num</span>=$(cat /proc/sys/kernel/random/uuid | cksum | awk -F <span class="org-string">' '</span> <span class="org-string">'{print $1}'</span>)  
    <span class="org-builtin">echo</span> $(($<span class="org-variable-name">num</span>%$<span class="org-variable-name">max</span>+$<span class="org-variable-name">min</span>))  
}  

<span class="org-variable-name">rnd</span>=$(rand 100 500)  
<span class="org-builtin">echo</span> $<span class="org-variable-name">rnd</span>  

<span class="org-keyword">exit</span> 0  
</pre>
</div>
</div>
</div>
<div id="outline-container-h:e725f088-1ab5-4783-a77e-7c24ff0bac31" class="outline-4">
<h4 id="h:e725f088-1ab5-4783-a77e-7c24ff0bac31"><a href="#h:e725f088-1ab5-4783-a77e-7c24ff0bac31">脚本：python</a></h4>
<div class="outline-text-4" id="text-h:e725f088-1ab5-4783-a77e-7c24ff0bac31">
<div class="org-src-container">
<pre class="src src-sh">[root@Fortress01 users]# cat pass.py
import random
import string
def GenPassword(length):
    <span class="org-variable-name">chars</span>=string.ascii_letters+string.digits
    <span class="org-keyword">return</span> <span class="org-string">''</span>.join([random.choice(chars) <span class="org-keyword">for</span> i<span class="org-keyword"> in</span> range(length)])


<span class="org-keyword">if</span> <span class="org-variable-name">__name__</span>==<span class="org-string">"__main__"</span>:
   <span class="org-keyword">for</span> i<span class="org-keyword"> in</span> range(1):
       <span class="org-builtin">print</span> GenPassword(15)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:07f91ee1-7fa8-42c3-9876-ff75a502787b" class="outline-4">
<h4 id="h:07f91ee1-7fa8-42c3-9876-ff75a502787b"><a href="#h:07f91ee1-7fa8-42c3-9876-ff75a502787b">生成随机数：date +%s%N</a></h4>
<div class="outline-text-4" id="text-h:07f91ee1-7fa8-42c3-9876-ff75a502787b">
<p>
范例：生成10位随机字符串
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#20351;&#29992;date &#29983;&#25104;&#38543;&#26426;&#23383;&#31526;&#20018;  
</span>date +%s%N | md5sum | head -c 10  

<span class="org-comment-delimiter">#</span><span class="org-comment">&#20351;&#29992; /dev/urandom &#29983;&#25104;&#38543;&#26426;&#23383;&#31526;&#20018;  
</span>cat /dev/urandom | head -n 10 | md5sum | head -c 10  
</pre>
</div>
</div>
</div>
<div id="outline-container-h:5b5f44e1-8e7c-499f-9e3c-1356eb0ab266" class="outline-4">
<h4 id="h:5b5f44e1-8e7c-499f-9e3c-1356eb0ab266"><a href="#h:5b5f44e1-8e7c-499f-9e3c-1356eb0ab266">生成随机数：/dev/urandom和tr命令</a></h4>
<div class="outline-text-4" id="text-h:5b5f44e1-8e7c-499f-9e3c-1356eb0ab266">
<div class="org-src-container">
<pre class="src src-sh">[root@node01 ~]# cat /dev/urandom | tr -dc <span class="org-string">'0-9a-zA-Z\!\@\#\$\%\^\&amp;\*\(\)\_\+\-\='</span> | head -c 20
[root@node01 ~]# <span class="org-variable-name">LANG</span>=c &lt; /dev/urandom tr -dc _A-Z-a-z-0-9 | head -c${<span class="org-variable-name">1</span>:-16};<span class="org-builtin">echo</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">8&#20301;&#32431;&#25968;&#23383;&#30340;&#38543;&#26426;&#25968;
</span>tr -cd <span class="org-string">'0-9'</span> &lt;/dev/urandom | head -c 8

<span class="org-comment-delimiter"># </span><span class="org-comment">16&#20301;&#21253;&#21547;&#23383;&#27597;&#12289;&#25968;&#23383;&#30340;&#38543;&#26426;&#25968;
</span>tr -cd <span class="org-string">'[:alnum:]'</span> &lt;/dev/urandom | head -c 16

tr -dc <span class="org-string">'#@%a-z0-9'</span> &lt; /dev/urandom |head -c 20
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b019867c-6b9f-4fc5-b891-67bb700dd754" class="outline-4">
<h4 id="h:b019867c-6b9f-4fc5-b891-67bb700dd754"><a href="#h:b019867c-6b9f-4fc5-b891-67bb700dd754">生成随机数：openssl rand</a></h4>
<div class="outline-text-4" id="text-h:b019867c-6b9f-4fc5-b891-67bb700dd754">
<div class="org-src-container">
<pre class="src src-sh">openssl rand -base64 10 <span class="org-comment-delimiter">#</span><span class="org-comment">base64&#32534;&#30721;&#26684;&#24335;
</span>openssl rand -hex 10 <span class="org-comment-delimiter">#</span><span class="org-comment">16&#36827;&#21046;&#32534;&#30721;&#26684;&#24335;
</span>openssl passwd -1 -salt $(openssl rand -hex 4)

[root@af ~]# openssl rand -base64 36 | tr -d <span class="org-string">'\n'</span>
A6dQsCAsp22oH0/OCFZa5KuNubWa8xLRZnXrln71/acvP5T+
[root@af ~]# openssl rand 60 | base64 -w 0
SAi6pCcz9KUAHowUAZts7kbVVeZbAdSM1HFwFMMP+MAnznlCtgoG1/qnvGsNOtyR5+Xj9oEHFNvsqfCD
</pre>
</div>
</div>
</div>
<div id="outline-container-h:cd75f786-e9ed-421c-978b-e65fa183023c" class="outline-4">
<h4 id="h:cd75f786-e9ed-421c-978b-e65fa183023c"><a href="#h:cd75f786-e9ed-421c-978b-e65fa183023c">生成随机数：pwgen</a></h4>
<div class="outline-text-4" id="text-h:cd75f786-e9ed-421c-978b-e65fa183023c">
<div class="org-src-container">
<pre class="src src-shell">yum install pwgen -y  <span class="org-comment-delimiter">#</span><span class="org-comment">centos
</span>apt install pwgen  <span class="org-comment-delimiter">#</span><span class="org-comment">ubuntu</span>
</pre>
</div>

<p>
使用
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@af~]# pwgen -s 50 1
NrtoSMVucUAoYQBtjoVIGsPnBlwxrCqa9yhH9MSjhKfNFDkKda
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-批量删除子目录下的文件保留指定数量的最新文件" class="outline-3">
<h3 id="批量删除子目录下的文件保留指定数量的最新文件"><a href="#批量删除子目录下的文件保留指定数量的最新文件">批量删除子目录下的文件，保留指定数量的最新文件</a></h3>
<div class="outline-text-3" id="text-批量删除子目录下的文件保留指定数量的最新文件">
<p>
方法1
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span><span class="org-comment">
</span><span class="org-comment-delimiter">#</span><span class="org-comment">&#20445;&#30041;&#25991;&#20214;&#25968;
</span><span class="org-variable-name">ReservedNum</span>=2
<span class="org-comment-delimiter">#</span><span class="org-comment">&#35201;&#21024;&#38500;&#25991;&#20214;&#30340;&#65292;&#29238;&#32423;&#30446;&#24405;
</span><span class="org-variable-name">FileDir</span>=/usr/docker/springCloud/project/

<span class="org-comment-delimiter">#</span><span class="org-comment">&#24490;&#29615;&#23376;&#30446;&#24405;&#21015;&#34920;
</span><span class="org-keyword">for</span> element<span class="org-keyword"> in</span> <span class="org-sh-quoted-exec">`ls $FileDir`</span>
<span class="org-keyword">do</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">&#25340;&#25509;&#25104;&#23436;&#25104;&#30446;&#24405; &#65288;&#29238;&#30446;&#24405;&#36335;&#24452;/&#23376;&#30446;&#24405;&#21517;&#65289;
</span>    <span class="org-variable-name">dir_or_file</span>=$<span class="org-variable-name">FileDir</span>$<span class="org-variable-name">element</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">&#33719;&#21462;&#23376;&#30446;&#24405;&#19979;&#30340;&#25351;&#23450;&#25991;&#20214;&#26684;&#24335;&#30340;&#24635;&#25968;&#37327;
</span>    <span class="org-variable-name">FileNum</span>=$(ls -l $<span class="org-variable-name">dir_or_file</span> | grep <span class="org-string">'keda-'</span> |wc -l)
    <span class="org-comment-delimiter"># </span><span class="org-comment">&#36755;&#20986; &#21024;&#38500;&#21069;&#30340; &#25351;&#23450;&#26684;&#24335;&#30340;&#25991;&#20214;&#25968;&#37327;
</span>    <span class="org-builtin">echo</span>  $<span class="org-variable-name">element</span> <span class="org-string">"jar num:"</span> $<span class="org-variable-name">FileNum</span>
    <span class="org-comment-delimiter"># </span><span class="org-comment">&#22914;&#26524; &#25968;&#37327;&#22823;&#20110;&#20445;&#30041;&#25968;&#37327;&#65292;&#37027;&#23601;&#24490;&#29615;&#21024;&#38500; &#25991;&#20214;
</span>    <span class="org-keyword">while</span>(( $<span class="org-variable-name">FileNum</span> &gt; $<span class="org-variable-name">ReservedNum</span>))
    <span class="org-keyword">do</span>
       <span class="org-variable-name">OldFile</span>=$(ls -rt $<span class="org-variable-name">dir_or_file</span> | grep <span class="org-string">'keda-'</span>| head -1)
       <span class="org-builtin">echo</span>  $<span class="org-variable-name">element</span> <span class="org-string">"Delete jar:"</span>$<span class="org-variable-name">OldFile</span>
       rm -rf $<span class="org-variable-name">dir_or_file</span>/$<span class="org-variable-name">OldFile</span>
       <span class="org-builtin">let</span> <span class="org-string">"FileNum--"</span>
    <span class="org-keyword">done</span>
<span class="org-keyword">done</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">&#21024;&#38500;&#23436;&#21518;&#65292;&#20877;&#24490;&#29615;&#36755;&#20986;&#19968;&#19979; &#27599;&#20010;&#23376;&#30446;&#24405;&#19979;&#30340;&#25991;&#20214;&#25968;&#37327;
</span><span class="org-keyword">for</span> element<span class="org-keyword"> in</span> <span class="org-sh-quoted-exec">`ls $FileDir`</span>
<span class="org-keyword">do</span>
    <span class="org-variable-name">dir_or_file</span>=$<span class="org-variable-name">FileDir</span>$<span class="org-variable-name">element</span>
    <span class="org-variable-name">FileNum</span>=$(ls -l $<span class="org-variable-name">dir_or_file</span> | grep <span class="org-string">'keda-'</span> |wc -l)
    <span class="org-builtin">echo</span>  $<span class="org-variable-name">element</span> <span class="org-string">"jar num:"</span> $<span class="org-variable-name">FileNum</span>
</pre>
</div>

<p>
方法2
</p>

<div class="org-src-container">
<pre class="src src-sh">ls -t | awk <span class="org-string">'{if(NR&gt;16){print $0}}'</span>  |xargs rm -f
</pre>
</div>
</div>
</div>
<div id="outline-container-秒级脚本" class="outline-3">
<h3 id="秒级脚本"><a href="#秒级脚本">秒级脚本</a></h3>
<div class="outline-text-3" id="text-秒级脚本">
<p>
可用于crontab 定时任务 如，nginx 20秒健康检查
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">&#65281;/bin/bash
</span>
<span class="org-variable-name">i</span>=0
<span class="org-variable-name">interval</span>=3
<span class="org-variable-name">count</span>=$[60/$<span class="org-variable-name">interval</span>]   <span class="org-comment-delimiter"># </span><span class="org-comment">$[]&#21482;&#33021;&#36827;&#34892;&#25972;&#25968;&#36816;&#31639;
</span><span class="org-keyword">while</span> [ $<span class="org-variable-name">i</span> -lt $<span class="org-variable-name">count</span> ]; <span class="org-keyword">do</span>
    <span class="org-variable-name">nginx_arr</span>=(pgrep nginx)
    <span class="org-keyword">if</span> [ ${#<span class="org-variable-name">nginx_arr</span>[@]} == 0 ]; <span class="org-keyword">then</span>
        nginx  -c  /usr/local/nginx/etc/nginx.conf &gt;/dev/null   2&gt;&amp;1
    <span class="org-keyword">fi</span>
    ((i++))
    sleep $<span class="org-variable-name">interval</span>
<span class="org-keyword">done</span>
</pre>
</div>
</div>
</div>
</section>
</div>
</body>
</html>
