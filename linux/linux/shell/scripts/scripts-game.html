<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>scripts-games</title>
<meta name="generator" content="Org Mode" />
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<!-- from -->
<!--
<style>#back-to-top{background:#000;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;bottom:20px;-webkit-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);-moz-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);box-shadow:0 2px 5px 0 rgba(0,0,0,.26);color:#fff;cursor:pointer;display:block;height:56px;opacity:1;outline:0;position:fixed;right:20px;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-transition:bottom .2s,opacity .2s;-o-transition:bottom .2s,opacity .2s;-moz-transition:bottom .2s,opacity .2s;transition:bottom .2s,opacity .2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:56px;z-index:1}#back-to-top svg{display:block;fill:currentColor;height:24px;margin:16px auto 0;width:24px}#back-to-top.hidden{bottom:-56px;opacity:0}</style>
-->
<link rel="stylesheet" href="/static/aandds.com/css/main.css">
<link rel="stylesheet" href="/static/aandds.com/css/drollery.min.css">
<script type="text/javascript" src="/static/aandds.com/js/main.js"></script>
<!--
<script id="MathJax-script" async="" src="/static/aandds.com/js/mathjax.js"></script>

<script type="text/javascript" src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
-->
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">scripts-games</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org842097a">hanoi-tower</a></li>
<li><a href="#org836ec03">俄罗斯方块</a></li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../index.html">Script</a></li>
</ul>
<section id="outline-container-org842097a" class="outline-2">
<h2 id="org842097a">hanoi-tower</h2>
<div class="outline-text-2" id="text-org842097a">
<div class="org-src-container">
<pre class="src src-sh">cat &lt;&lt; \EOF &gt;hanoi_tower.sh 
<span style="color: #ffa54f;">#!/bin/bash</span>
<span style="color: #ffa54f;">##################################################################</span>
<span style="color: #ffa54f;">#Auther: CaiJingshui Zhaowenguang</span>
<span style="color: #ffa54f;">#</span>
<span style="color: #ffa54f;">#Descript: Hanoi Tower</span>
<span style="color: #ffa54f;">#</span>
<span style="color: #ffa54f;">#Contact: shuinoo@163.com  1793938194@qq.com </span>
<span style="color: #ffa54f;">##################################################################</span>


<span style="color: #ffa54f;">#*******************************************************#</span>
<span style="color: #ffa54f;">#           &#21464;&#37327;&#22768;&#26126;            #</span>
<span style="color: #ffa54f;">#*******************************************************#</span>
<span style="color: #ffa54f;">#&#29992;&#20110;&#20445;&#23384;&#29983;&#25104;&#30340;&#25152;&#26377;&#30340;&#30424;&#23376;</span>
<span style="color: #ffa54f;">declare -ax han_disk</span>
<span style="color: #ffa54f;">#&#29992;&#20110;&#20445;&#23384;&#29983;&#25104;&#30340;&#25972;&#26681;&#31435;&#26609;&#21644;&#24213;&#24231;</span>
<span style="color: #ffa54f;">declare -ax han_pillar</span>
<span style="color: #ffa54f;">#&#29992;&#20110;&#20445;&#23384;&#31435;&#26609;&#30340;&#27599;&#19968;&#33410;</span>
<span style="color: #ffa54f;">declare -x pillar_part</span>
<span style="color: #ffa54f;">#&#29992;&#20110;&#31227;&#21160;&#30424;&#23376;&#30340;&#20020;&#26102;&#21464;&#37327;</span>
<span style="color: #ffa54f;">declare -x tmp</span>
<span style="color: #ffa54f;">#&#22768;&#26126;&#29992;&#20110;&#34920;&#31034;&#26174;&#31034;&#31435;&#26609;&#30340;&#21464;&#37327;</span>
<span style="color: #ffa54f;">declare -ax A</span>
<span style="color: #ffa54f;">#&#35774;&#32622;&#31227;&#21160;&#24310;&#36831;&#26102;&#38388;</span>
<span style="color: #ffa54f;">declare -x times</span>


<span style="color: #ffa54f;">#*******************************************************#</span>
<span style="color: #ffa54f;">#                       &#20989;&#25968;&#22768;&#26126;                        #</span>
<span style="color: #ffa54f;">#*******************************************************#</span>

<span style="color: #ffa54f;">#&#29983;&#25104;&#30424;&#23376;</span>
<span style="color: #ffa54f;">disk(){</span>
<span style="color: #ffa54f;">    local num=$1 color='\033[1;44m' colorend='\033[0m'</span>
<span style="color: #ffa54f;">    for i in `seq 1 $num`;do</span>
<span style="color: #ffa54f;">        local blank="" disk=""</span>
<span style="color: #ffa54f;">        for k in `seq 1 $[num+1-i]`;do</span>
<span style="color: #ffa54f;">            blank+="  "</span>
<span style="color: #ffa54f;">        done</span>
<span style="color: #ffa54f;">        for l in `eval echo {1..$i}`;do</span>
<span style="color: #ffa54f;">            disk+="IIII"</span>
<span style="color: #ffa54f;">        done</span>
<span style="color: #ffa54f;">        han_disk[i]="$blank$color$disk$colorend"</span>
<span style="color: #ffa54f;">    done</span>
<span style="color: #ffa54f;">}</span>

<span style="color: #ffa54f;">#&#29983;&#25104;&#26609;&#23376;</span>
<span style="color: #ffa54f;">pillar ()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">    local radius=$1</span>
<span style="color: #ffa54f;">    local color='\033[1;43m' colorend='\033[0m'</span>
<span style="color: #ffa54f;">    local base=""</span>

<span style="color: #ffa54f;">    #&#31435;&#26609;&#30340;&#27599;&#19968;&#33410;</span>
<span style="color: #ffa54f;">    for n in `seq 1 $radius`;do</span>
<span style="color: #ffa54f;">        pillar_part+="  "</span>
<span style="color: #ffa54f;">        [ $n -eq $radius ] &amp;&amp; pillar_part+=" "</span>
<span style="color: #ffa54f;">    done</span>
<span style="color: #ffa54f;">    pillar_part+="${color}@@${colorend}" </span>

<span style="color: #ffa54f;">    #&#32452;&#35013;&#25104;&#31435;&#26609;</span>
<span style="color: #ffa54f;">    for m in `seq 1 $[num+2]`;do</span>
<span style="color: #ffa54f;">        [ $m -eq 1 ] &amp;&amp; han_pillar[m]="" &amp;&amp; continue</span>
<span style="color: #ffa54f;">         han_pillar[m]="$pillar_part"</span>
<span style="color: #ffa54f;">    done</span>

<span style="color: #ffa54f;">    #&#24213;&#24231;</span>
<span style="color: #ffa54f;">    for o in `seq 1 $[radius+1]`;do</span>
<span style="color: #ffa54f;">        base+='@@@@'</span>
<span style="color: #ffa54f;">    done</span>

<span style="color: #ffa54f;">    #&#23558;&#24213;&#24231;&#23433;&#35013;&#21040;&#31435;&#26609;&#30340;&#19979;&#38754;</span>
<span style="color: #ffa54f;">    han_pillar[$[num+3]]="$color$base$colorend"</span>
<span style="color: #ffa54f;">}</span>

<span style="color: #ffa54f;">#&#28165;&#38500;&#26609;&#23376;&#31354;&#38388;&#30340;&#20869;&#23481;</span>
<span style="color: #ffa54f;">clean_pillar(){</span>
<span style="color: #ffa54f;">    echo -ne "\033[0H"</span>
<span style="color: #ffa54f;">    local blank</span>
<span style="color: #ffa54f;">    for i in `seq 1 $[num+1]`;do</span>
<span style="color: #ffa54f;">        blank+='    '</span>
<span style="color: #ffa54f;">    done</span>
<span style="color: #ffa54f;">    for i in `seq 1 $[num+3]`;do</span>
<span style="color: #ffa54f;">        echo -e "\033[${1}G$blank"</span>
<span style="color: #ffa54f;">    done</span>
<span style="color: #ffa54f;">    echo -ne "\033[0H"</span>
<span style="color: #ffa54f;">}</span>

<span style="color: #ffa54f;">#&#25171;&#21360;&#26609;&#23376;;&#38656;&#35201;&#19968;&#20010;&#21442;&#25968; 1 2 &#25110; 3&#65292;&#25351;&#26126;&#31532;&#20960;&#26681;&#26609;&#23376;</span>
<span style="color: #ffa54f;">printA(){</span>
<span style="color: #ffa54f;">    if [ $1 -eq 1 ] ;then</span>
<span style="color: #ffa54f;">        colume=0</span>
<span style="color: #ffa54f;">    elif [ $1 -eq 2 ];then </span>
<span style="color: #ffa54f;">        colume=$[(num+1)*4]</span>
<span style="color: #ffa54f;">    else</span>
<span style="color: #ffa54f;">        colume=$[(num+1)*8]</span>
<span style="color: #ffa54f;">    fi</span>
<span style="color: #ffa54f;">    clean_pillar $colume</span>
<span style="color: #ffa54f;">    for i in `seq 0 $[num+3]`;do</span>
<span style="color: #ffa54f;">        echo -e "\033[${colume}G${A[$1$i]}"</span>
<span style="color: #ffa54f;">    done</span>
<span style="color: #ffa54f;">    #for j in  "${A[@]}";do</span>
<span style="color: #ffa54f;">    #   echo -e "$j"</span>
<span style="color: #ffa54f;">    #done</span>
<span style="color: #ffa54f;">}</span>

<span style="color: #ffa54f;">#&#21021;&#22987;&#21270;&#26609;&#23376;&#24182;&#25171;&#21360;</span>
<span style="color: #ffa54f;">init_pillar()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">    for i in 1 2 3;do</span>
<span style="color: #ffa54f;">        for j in `seq 0  $[num+3]`;do</span>
<span style="color: #ffa54f;">            A[$i$j]=${han_pillar[$[j+1]]}</span>
<span style="color: #ffa54f;">        done</span>
<span style="color: #ffa54f;">        if [ $i -eq 1 ]; then</span>
<span style="color: #ffa54f;">            for i in `seq 1 $num`;do</span>
<span style="color: #ffa54f;">                A[1$[i+1]]=${han_disk[$i]}</span>
<span style="color: #ffa54f;">            done</span>

<span style="color: #ffa54f;">        fi</span>
<span style="color: #ffa54f;">    done</span>
<span style="color: #ffa54f;">    printA 1</span>
<span style="color: #ffa54f;">    printA 2</span>
<span style="color: #ffa54f;">    printA 3</span>
<span style="color: #ffa54f;">}</span>

<span style="color: #ffa54f;">#&#23558;&#30424;&#23376;&#24448;&#19978;&#31227;&#21160;</span>
<span style="color: #ffa54f;">moveup(){</span>
<span style="color: #ffa54f;">    local  num_tmp</span>
<span style="color: #ffa54f;">    while : ; do</span>
<span style="color: #ffa54f;">        sleep $times</span>
<span style="color: #ffa54f;">        for i in `seq 0 $[num+2]`;do</span>
<span style="color: #ffa54f;">            echo ${A[$1$i]}|grep -E "II" &gt; /dev/null</span>
<span style="color: #ffa54f;">            if [ $? -eq 0 ];then</span>
<span style="color: #ffa54f;">                tmp=${A[$1$i]}</span>
<span style="color: #ffa54f;">                num_tmp=$i</span>

<span style="color: #ffa54f;">                A[$1$[i-1]]=$tmp</span>
<span style="color: #ffa54f;">                A[$1$i]=$pillar_part</span>
<span style="color: #ffa54f;">                break</span>
<span style="color: #ffa54f;">            elif [ $? -ne 0 -a $i -eq $[num+2] ];then</span>
<span style="color: #ffa54f;">                break 2</span>
<span style="color: #ffa54f;">            fi</span>
<span style="color: #ffa54f;">        done</span>
<span style="color: #ffa54f;">        if [ "${A[${1}0]}" != "" ]; then</span>
<span style="color: #ffa54f;">            A[${1}0]=""</span>
<span style="color: #ffa54f;">            printA $1</span>
<span style="color: #ffa54f;">            break </span>
<span style="color: #ffa54f;">        fi</span>
<span style="color: #ffa54f;">        printA $1</span>
<span style="color: #ffa54f;">    done</span>
<span style="color: #ffa54f;">}</span>

<span style="color: #ffa54f;">#&#23558;&#30424;&#23376;&#24448;&#19979;&#25918;;&#38656;&#35201;&#19968;&#20010;&#21442;&#25968; &#35828;&#26126;&#26159;&#21738;&#20010;&#26609;&#23376;</span>
<span style="color: #ffa54f;">movedown(){</span>
<span style="color: #ffa54f;">    local  num_tmp</span>
<span style="color: #ffa54f;">    while : ; do</span>
<span style="color: #ffa54f;">        #sleep $times</span>
<span style="color: #ffa54f;">        for i in `seq 1 $[num+1]`;do</span>
<span style="color: #ffa54f;">            echo ${A[$1$i]}|grep -E "II" &gt; /dev/null</span>
<span style="color: #ffa54f;">            if [ $? -ne 0 ];then</span>
<span style="color: #ffa54f;">                A[$1$i]=$tmp</span>
<span style="color: #ffa54f;">                A[$1$[i-1]]=$pillar_part</span>
<span style="color: #ffa54f;">                if [ $i -eq 1 ]; then</span>
<span style="color: #ffa54f;">                    A[20]=""</span>
<span style="color: #ffa54f;">                    A[$1$[i-1]]=""</span>
<span style="color: #ffa54f;">                    printA 2 #&#21047;&#26032;B&#26609;</span>
<span style="color: #ffa54f;">                fi</span>
<span style="color: #ffa54f;">            else</span>
<span style="color: #ffa54f;">                break 2</span>
<span style="color: #ffa54f;">            fi</span>
<span style="color: #ffa54f;">            sleep $times</span>
<span style="color: #ffa54f;">            printA $1</span>
<span style="color: #ffa54f;">        done</span>
<span style="color: #ffa54f;">        if [[ "${A[$1$[num+1]]}" == *I* ]]; then</span>
<span style="color: #ffa54f;">            break </span>
<span style="color: #ffa54f;">        fi</span>
<span style="color: #ffa54f;">    done</span>

<span style="color: #ffa54f;">}</span>
<span style="color: #ffa54f;">#&#27721;&#35834;&#22612;&#30424;&#29255;&#31227;&#21160;&#20989;&#25968;</span>
<span style="color: #ffa54f;">move()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">local disknum=$1</span>
<span style="color: #ffa54f;">local yuan=$2</span>
<span style="color: #ffa54f;">local linshi=$3</span>
<span style="color: #ffa54f;">local mubiao=$4</span>

<span style="color: #ffa54f;">if [ $disknum -eq 1 ]; then</span>
<span style="color: #ffa54f;">        #echo "$yuan =&gt; $mubiao"</span>
<span style="color: #ffa54f;">    moveup $yuan</span>
<span style="color: #ffa54f;">    movedown $mubiao</span>
<span style="color: #ffa54f;">else</span>
<span style="color: #ffa54f;">        move $[disknum-1] $yuan $mubiao $linshi</span>
<span style="color: #ffa54f;">        #echo "$yuan =&gt; $mubiao"</span>
<span style="color: #ffa54f;">    moveup $yuan</span>
<span style="color: #ffa54f;">        movedown $mubiao</span>
<span style="color: #ffa54f;">        move $[disknum-1] $linshi $yuan $mubiao</span>
<span style="color: #ffa54f;">fi</span>
<span style="color: #ffa54f;">}</span>

<span style="color: #ffa54f;">#&#25429;&#25417; Ctrl+c &#20449;&#24687;</span>
<span style="color: #ffa54f;">kill_han(){</span>
<span style="color: #ffa54f;">    echo -e "\033[?25h"</span>
<span style="color: #ffa54f;">    #kill -9 $pidnum</span>
<span style="color: #ffa54f;">    echo -e "\033[3B"</span>
<span style="color: #ffa54f;">    print_Auther</span>
<span style="color: #ffa54f;">    exit</span>
<span style="color: #ffa54f;">}</span>

<span style="color: #ffa54f;">#&#25171;&#21360;&#20316;&#32773;&#20449;&#24687;</span>
<span style="color: #ffa54f;">print_Auther(){</span>
<span style="color: #ffa54f;">    cat &lt;&lt;EOF</span>
<span style="color: #ffa54f;">    #################################################################</span>
<span style="color: #ffa54f;">    #   Auther: CaiJingshui Zhaowenguang Liuteng        #</span>
<span style="color: #ffa54f;">    #                               #</span>
<span style="color: #ffa54f;">    #   Contact: shuinoo@163.com 1793938194@qq.com      #</span>
<span style="color: #ffa54f;">    #################################################################</span>
<span style="color: #ffa54f;">        &#27492;&#31243;&#24207;&#27599;&#27425;&#21047;&#26032;&#37117;&#26159;&#19968;&#26681;&#26609;&#23376;&#30340;&#33539;&#22260;&#12290;&#30001;&#20110;&#26102;&#38388;&#21407;&#22240;&#65292;&#25105;&#20204;&#19981;&#20877;&#25913;&#36827;</span>
<span style="color: #ffa54f;">    &#22914;&#26524;&#21508;&#20301;&#32593;&#21451;&#26377;&#20852;&#36259;&#65292;&#21487;&#20197;&#23436;&#21892;&#65288;&#21482;&#21047;&#26032;&#21464;&#21270;&#20102;&#30340;&#37096;&#20998;&#12290;&#65289;</span>
<span style="color: #ffa54f;">EOF</span>
}


<span style="color: #b22222;">#</span><span style="color: #b22222;">*******************************************************#</span>
<span style="color: #b22222;">#                         </span><span style="color: #b22222;">&#20027;&#31243;&#24207;                        #</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">*******************************************************#</span>

<span style="color: #a020f0;">trap</span> <span style="color: #8b2252;">"kill_han"</span> 2
<span style="color: #a020f0;">trap</span> <span style="color: #8b2252;">"kill_han"</span> 9
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20837;&#30424;&#23376;&#30340;&#25968;&#37327;</span>
<span style="color: #a020f0;">while</span> : ;<span style="color: #a020f0;">do</span>
    <span style="color: #483d8b;">read</span> -p <span style="color: #8b2252;">"&#35831;&#36755;&#20837;&#19968;&#20010;&#27491;&#25972;&#25968;&#65288;&#27880;&#24847;&#23631;&#24149;&#23485;&#24230;&#38480;&#21046;&#65289;&#65306;"</span> num
    [[ $<span style="color: #a0522d;">num</span> =~ ^[0-9]*[1-9]+$ ]] &amp;&amp; <span style="color: #a020f0;">break</span>
    <span style="color: #483d8b;">echo</span> -e <span style="color: #8b2252;">"\033[1;31m&#36755;&#20837;&#30340;&#19981;&#26159;&#27491;&#25972;&#25968;\033[0m"</span>
<span style="color: #a020f0;">done</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20837;&#30424;&#23376;&#31227;&#21160;&#30340;&#36895;&#24230;</span>
<span style="color: #a020f0;">while</span> : ;<span style="color: #a020f0;">do</span>
        <span style="color: #483d8b;">read</span> -p <span style="color: #8b2252;">"&#35831;&#36755;&#20837;&#30424;&#23376;&#30340;&#31227;&#21160;&#36895;&#24230;&#65306;"</span> times
        [[ <span style="color: #8b2252;">"$times"</span> =~ ^[0-9]*<span style="color: #8b2252;">\.</span>?[0-9]+$ ]] &amp;&amp; <span style="color: #a020f0;">break</span>
        <span style="color: #483d8b;">echo</span> -e <span style="color: #8b2252;">"\033[1;31m&#36755;&#20837;&#30340;&#19981;&#26159;&#25968;&#23383;\033[0m"</span>
<span style="color: #a020f0;">done</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#38544;&#34255;&#20809;&#26631;</span>
<span style="color: #483d8b;">echo</span> -ne <span style="color: #8b2252;">"\033[?25l"</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#26609;&#23376;&#30340;&#39640;&#24230;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">height=$[num+2] &#27492;&#21464;&#37327;&#24050;&#32463;&#24223;&#24323;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#26609;&#23376;&#25968;&#32452;</span>
pillar $<span style="color: #a0522d;">num</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#30424;&#23376;&#25968;&#32452;</span>
disk $<span style="color: #a0522d;">num</span>




<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20027;&#31243;&#24207;</span>
clear
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25773;&#25918;&#32972;&#26223;&#38899;&#20048;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">( play back_music.wav &amp;&gt; /dev/null ) </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">pidnum=`pidof play`</span>
<span style="color: #a0522d;">pid</span>=$<span style="color: #a0522d;">!</span>
init_pillar
move $<span style="color: #a0522d;">num</span>  1 2 3

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25764;&#38144;&#21464;&#37327;</span>
<span style="color: #483d8b;">unset</span> han_disk
<span style="color: #483d8b;">unset</span> han_pillar
<span style="color: #483d8b;">unset</span> pillar_part
<span style="color: #483d8b;">unset</span> tmp
<span style="color: #483d8b;">unset</span> A
<span style="color: #483d8b;">unset</span> times

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#20809;&#26631;&#31227;&#21160;&#21040;&#27721;&#35834;&#22612;&#19979;&#38754;&#30340;&#31532;&#19977;&#34892;</span>
<span style="color: #483d8b;">echo</span> -e <span style="color: #8b2252;">"\033[3B"</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;&#20316;&#32773;&#20449;&#24687;</span>
print_Auther

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#24674;&#22797;&#20809;&#26631;</span>
<span style="color: #483d8b;">echo</span> -e <span style="color: #8b2252;">"\033[?25h"</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">kill -9 $pidnum</span>
EOF
</pre>
</div>
</div>
</section>
<section id="outline-container-org836ec03" class="outline-2">
<h2 id="org836ec03">俄罗斯方块</h2>
<div class="outline-text-2" id="text-org836ec03">
<div class="org-src-container">
<pre class="src src-sh">cat &lt;&lt;\EOF &gt; elsfk.sh 
<span style="color: #ffa54f;">#!/bin/bash</span>

<span style="color: #ffa54f;"># Tetris Game</span>
<span style="color: #ffa54f;"># 10.21.2003 xhchen&lt;[email]xhchen@winbond.com.tw[/email]&gt;</span>

<span style="color: #ffa54f;">#APP declaration</span>
<span style="color: #ffa54f;">APP_NAME="${0##*[\\/]}"</span>
<span style="color: #ffa54f;">APP_VERSION="1.0"</span>


<span style="color: #ffa54f;">#&#39068;&#33394;&#23450;&#20041;</span>
<span style="color: #ffa54f;">cRed=1</span>
<span style="color: #ffa54f;">cGreen=2</span>
<span style="color: #ffa54f;">cYellow=3</span>
<span style="color: #ffa54f;">cBlue=4</span>
<span style="color: #ffa54f;">cFuchsia=5</span>
<span style="color: #ffa54f;">cCyan=6</span>
<span style="color: #ffa54f;">cWhite=7</span>
<span style="color: #ffa54f;">colorTable=($cRed $cGreen $cYellow $cBlue $cFuchsia $cCyan $cWhite)</span>

<span style="color: #ffa54f;">#&#20301;&#32622;&#21644;&#22823;&#23567;</span>
<span style="color: #ffa54f;">iLeft=3</span>
<span style="color: #ffa54f;">iTop=2</span>
<span style="color: #ffa54f;">((iTrayLeft = iLeft + 2))</span>
<span style="color: #ffa54f;">((iTrayTop = iTop + 1))</span>
<span style="color: #ffa54f;">((iTrayWidth = 10))</span>
<span style="color: #ffa54f;">((iTrayHeight = 15))</span>

<span style="color: #ffa54f;">#&#39068;&#33394;&#35774;&#32622;</span>
<span style="color: #ffa54f;">cBorder=$cGreen</span>
<span style="color: #ffa54f;">cScore=$cFuchsia</span>
<span style="color: #ffa54f;">cScoreValue=$cCyan</span>

<span style="color: #ffa54f;">#&#25511;&#21046;&#20449;&#21495;</span>
<span style="color: #ffa54f;">#&#25913;&#28216;&#25103;&#20351;&#29992;&#20004;&#20010;&#36827;&#31243;&#65292;&#19968;&#20010;&#29992;&#20110;&#25509;&#25910;&#36755;&#20837;&#65292;&#19968;&#20010;&#29992;&#20110;&#28216;&#25103;&#27969;&#31243;&#21644;&#26174;&#31034;&#30028;&#38754;;</span>
<span style="color: #ffa54f;">#&#24403;&#21069;&#32773;&#25509;&#25910;&#21040;&#19978;&#19979;&#24038;&#21491;&#31561;&#25353;&#38190;&#26102;&#65292;&#36890;&#36807;&#21521;&#21518;&#32773;&#21457;&#36865;signal&#30340;&#26041;&#24335;&#36890;&#30693;&#21518;&#32773;&#12290;</span>
<span style="color: #ffa54f;">sigRotate=25</span>
<span style="color: #ffa54f;">sigLeft=26</span>
<span style="color: #ffa54f;">sigRight=27</span>
<span style="color: #ffa54f;">sigDown=28</span>
<span style="color: #ffa54f;">sigAllDown=29</span>
<span style="color: #ffa54f;">sigExit=30</span>

<span style="color: #ffa54f;">#&#19971;&#20013;&#19981;&#21516;&#30340;&#26041;&#22359;&#30340;&#23450;&#20041;</span>
<span style="color: #ffa54f;">#&#36890;&#36807;&#26059;&#36716;&#65292;&#27599;&#31181;&#26041;&#22359;&#30340;&#26174;&#31034;&#30340;&#26679;&#24335;&#21487;&#33021;&#26377;&#20960;&#31181;</span>
<span style="color: #ffa54f;">box0=(0 0 0 1 1 0 1 1)</span>
<span style="color: #ffa54f;">box1=(0 2 1 2 2 2 3 2 1 0 1 1 1 2 1 3)</span>
<span style="color: #ffa54f;">box2=(0 0 0 1 1 1 1 2 0 1 1 0 1 1 2 0)</span>
<span style="color: #ffa54f;">box3=(0 1 0 2 1 0 1 1 0 0 1 0 1 1 2 1)</span>
<span style="color: #ffa54f;">box4=(0 1 0 2 1 1 2 1 1 0 1 1 1 2 2 2 0 1 1 1 2 0 2 1 0 0 1 0 1 1 1 2)</span>
<span style="color: #ffa54f;">box5=(0 1 1 1 2 1 2 2 1 0 1 1 1 2 2 0 0 0 0 1 1 1 2 1 0 2 1 0 1 1 1 2)</span>
<span style="color: #ffa54f;">box6=(0 1 1 1 1 2 2 1 1 0 1 1 1 2 2 1 0 1 1 0 1 1 2 1 0 1 1 0 1 1 1 2)</span>
<span style="color: #ffa54f;">#&#25152;&#26377;&#20854;&#20013;&#26041;&#22359;&#30340;&#23450;&#20041;&#37117;&#25918;&#21040;box&#21464;&#37327;&#20013;</span>
<span style="color: #ffa54f;">box=(${box0[@]} ${box1[@]} ${box2[@]} ${box3[@]} ${box4[@]} ${box5[@]} ${box6[@]})</span>
<span style="color: #ffa54f;">#&#21508;&#31181;&#26041;&#22359;&#26059;&#36716;&#21518;&#21487;&#33021;&#30340;&#26679;&#24335;&#25968;&#30446;</span>
<span style="color: #ffa54f;">countBox=(1 2 2 2 4 4 4)</span>
<span style="color: #ffa54f;">#&#21508;&#31181;&#26041;&#22359;&#20877;box&#25968;&#32452;&#20013;&#30340;&#20559;&#31227;</span>
<span style="color: #ffa54f;">offsetBox=(0 1 3 5 7 11 15)</span>

<span style="color: #ffa54f;">#&#27599;&#25552;&#39640;&#19968;&#20010;&#36895;&#24230;&#32423;&#38656;&#35201;&#31215;&#32047;&#30340;&#20998;&#25968;</span>
<span style="color: #ffa54f;">iScoreEachLevel=50        #be greater than 7</span>

<span style="color: #ffa54f;">#&#36816;&#34892;&#26102;&#25968;&#25454;</span>
<span style="color: #ffa54f;">sig=0                #&#25509;&#25910;&#21040;&#30340;signal</span>
<span style="color: #ffa54f;">iScore=0        #&#24635;&#20998;</span>
<span style="color: #ffa54f;">iLevel=0        #&#36895;&#24230;&#32423;</span>
<span style="color: #ffa54f;">boxNew=()        #&#26032;&#19979;&#33853;&#30340;&#26041;&#22359;&#30340;&#20301;&#32622;&#23450;&#20041;</span>
<span style="color: #ffa54f;">cBoxNew=0        #&#26032;&#19979;&#33853;&#30340;&#26041;&#22359;&#30340;&#39068;&#33394;</span>
<span style="color: #ffa54f;">iBoxNewType=0        #&#26032;&#19979;&#33853;&#30340;&#26041;&#22359;&#30340;&#31181;&#31867;</span>
<span style="color: #ffa54f;">iBoxNewRotate=0        #&#26032;&#19979;&#33853;&#30340;&#26041;&#22359;&#30340;&#26059;&#36716;&#35282;&#24230;</span>
<span style="color: #ffa54f;">boxCur=()        #&#24403;&#21069;&#26041;&#22359;&#30340;&#20301;&#32622;&#23450;&#20041;</span>
<span style="color: #ffa54f;">cBoxCur=0        #&#24403;&#21069;&#26041;&#22359;&#30340;&#39068;&#33394;</span>
<span style="color: #ffa54f;">iBoxCurType=0        #&#24403;&#21069;&#26041;&#22359;&#30340;&#31181;&#31867;</span>
<span style="color: #ffa54f;">iBoxCurRotate=0        #&#24403;&#21069;&#26041;&#22359;&#30340;&#26059;&#36716;&#35282;&#24230;</span>
<span style="color: #ffa54f;">boxCurX=-1        #&#24403;&#21069;&#26041;&#22359;&#30340;x&#22352;&#26631;&#20301;&#32622;</span>
<span style="color: #ffa54f;">boxCurY=-1        #&#24403;&#21069;&#26041;&#22359;&#30340;y&#22352;&#26631;&#20301;&#32622;</span>
<span style="color: #ffa54f;">iMap=()                #&#32972;&#26223;&#26041;&#22359;&#22270;&#34920;</span>

<span style="color: #ffa54f;">#&#21021;&#22987;&#21270;&#25152;&#26377;&#32972;&#26223;&#26041;&#22359;&#20026;-1, &#34920;&#31034;&#27809;&#26377;&#26041;&#22359;</span>
<span style="color: #ffa54f;">for ((i = 0; i &lt; iTrayHeight * iTrayWidth; i++)); do iMap[$i]=-1; done</span>


<span style="color: #ffa54f;">#&#25509;&#25910;&#36755;&#20837;&#30340;&#36827;&#31243;&#30340;&#20027;&#20989;&#25968;</span>
<span style="color: #ffa54f;">function RunAsKeyReceiver()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">        local pidDisplayer key aKey sig cESC sTTY</span>

<span style="color: #ffa54f;">        pidDisplayer=$1</span>
<span style="color: #ffa54f;">        aKey=(0 0 0)</span>

<span style="color: #ffa54f;">        cESC=`echo -ne "\033"`</span>
<span style="color: #ffa54f;">        cSpace=`echo -ne "\040"`</span>

<span style="color: #ffa54f;">        #&#20445;&#23384;&#32456;&#31471;&#23646;&#24615;&#12290;&#22312;read -s&#35835;&#21462;&#32456;&#31471;&#38190;&#26102;&#65292;&#32456;&#31471;&#30340;&#23646;&#24615;&#20250;&#34987;&#26242;&#26102;&#25913;&#21464;&#12290;</span>
<span style="color: #ffa54f;">        #&#22914;&#26524;&#22312;read -s&#26102;&#31243;&#24207;&#34987;&#19981;&#24184;&#26432;&#25481;&#65292;&#21487;&#33021;&#20250;&#23548;&#33268;&#32456;&#31471;&#28151;&#20081;&#65292;</span>
<span style="color: #ffa54f;">        #&#38656;&#35201;&#22312;&#31243;&#24207;&#36864;&#20986;&#26102;&#24674;&#22797;&#32456;&#31471;&#23646;&#24615;&#12290;</span>
<span style="color: #ffa54f;">        sTTY=`stty -g`</span>

<span style="color: #ffa54f;">        #&#25429;&#25417;&#36864;&#20986;&#20449;&#21495;</span>
<span style="color: #ffa54f;">        trap "MyExit;" INT TERM</span>
<span style="color: #ffa54f;">        trap "MyExitNoSub;" $sigExit</span>

<span style="color: #ffa54f;">        #&#38544;&#34255;&#20809;&#26631;</span>
<span style="color: #ffa54f;">        echo -ne "\033[?25l"</span>


<span style="color: #ffa54f;">        while :</span>
<span style="color: #ffa54f;">        do</span>
<span style="color: #ffa54f;">                #&#35835;&#21462;&#36755;&#20837;&#12290;&#27880;-s&#19981;&#22238;&#26174;&#65292;-n&#35835;&#21040;&#19968;&#20010;&#23383;&#31526;&#31435;&#21363;&#36820;&#22238;</span>
<span style="color: #ffa54f;">                read -s -n 1 key</span>

<span style="color: #ffa54f;">                aKey[0]=${aKey[1]}</span>
<span style="color: #ffa54f;">                aKey[1]=${aKey[2]}</span>
<span style="color: #ffa54f;">                aKey[2]=$key</span>
<span style="color: #ffa54f;">                sig=0</span>

<span style="color: #ffa54f;">                #&#21028;&#26029;&#36755;&#20837;&#20102;&#20309;&#31181;&#38190;</span>
<span style="color: #ffa54f;">                if [[ $key == $cESC &amp;&amp; ${aKey[1]} == $cESC ]]</span>
<span style="color: #ffa54f;">                then</span>
<span style="color: #ffa54f;">                        #ESC&#38190;</span>
<span style="color: #ffa54f;">                        MyExit</span>
<span style="color: #ffa54f;">                elif [[ ${aKey[0]} == $cESC &amp;&amp; ${aKey[1]} == "[" ]]</span>
<span style="color: #ffa54f;">                then</span>
<span style="color: #ffa54f;">                        if [[ $key == "A" ]]; then sig=$sigRotate        #&lt;&#21521;&#19978;&#38190;&gt;</span>
<span style="color: #ffa54f;">                        elif [[ $key == "B" ]]; then sig=$sigDown        #&lt;&#21521;&#19979;&#38190;&gt;</span>
<span style="color: #ffa54f;">                        elif [[ $key == "D" ]]; then sig=$sigLeft        #&lt;&#21521;&#24038;&#38190;&gt;</span>
<span style="color: #ffa54f;">                        elif [[ $key == "C" ]]; then sig=$sigRight        #&lt;&#21521;&#21491;&#38190;&gt;</span>
<span style="color: #ffa54f;">                        fi</span>
<span style="color: #ffa54f;">                elif [[ $key == "W" || $key == "w" ]]; then sig=$sigRotate        #W, w</span>
<span style="color: #ffa54f;">                elif [[ $key == "S" || $key == "s" ]]; then sig=$sigDown        #S, s</span>
<span style="color: #ffa54f;">                elif [[ $key == "A" || $key == "a" ]]; then sig=$sigLeft        #A, a</span>
<span style="color: #ffa54f;">                elif [[ $key == "D" || $key == "d" ]]; then sig=$sigRight        #D, d</span>
<span style="color: #ffa54f;">                elif [[ "[$key]" == "[]" ]]; then sig=$sigAllDown        #&#31354;&#26684;&#38190;</span>
<span style="color: #ffa54f;">                elif [[ $key == "Q" || $key == "q" ]]                        #Q, q</span>
<span style="color: #ffa54f;">                then</span>
<span style="color: #ffa54f;">                        MyExit</span>
<span style="color: #ffa54f;">                fi</span>

<span style="color: #ffa54f;">                if [[ $sig != 0 ]]</span>
<span style="color: #ffa54f;">                then</span>
<span style="color: #ffa54f;">                        #&#21521;&#21478;&#19968;&#36827;&#31243;&#21457;&#36865;&#28040;&#24687;</span>
<span style="color: #ffa54f;">                        kill -$sig $pidDisplayer</span>
<span style="color: #ffa54f;">                fi</span>
<span style="color: #ffa54f;">        done</span>
<span style="color: #ffa54f;">}</span>

<span style="color: #ffa54f;">#&#36864;&#20986;&#21069;&#30340;&#24674;&#22797;</span>
<span style="color: #ffa54f;">function MyExitNoSub()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">        local y</span>

<span style="color: #ffa54f;">        #&#24674;&#22797;&#32456;&#31471;&#23646;&#24615;</span>
<span style="color: #ffa54f;">        stty $sTTY</span>
<span style="color: #ffa54f;">        ((y = iTop + iTrayHeight + 4))</span>

<span style="color: #ffa54f;">        #&#26174;&#31034;&#20809;&#26631;</span>
<span style="color: #ffa54f;">        echo -e "\033[?25h\033[${y};0H"</span>
<span style="color: #ffa54f;">        exit</span>
<span style="color: #ffa54f;">}</span>


<span style="color: #ffa54f;">function MyExit()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">        #&#36890;&#30693;&#26174;&#31034;&#36827;&#31243;&#38656;&#35201;&#36864;&#20986;</span>
<span style="color: #ffa54f;">        kill -$sigExit $pidDisplayer</span>

<span style="color: #ffa54f;">        MyExitNoSub</span>
<span style="color: #ffa54f;">}</span>


<span style="color: #ffa54f;">#&#22788;&#29702;&#26174;&#31034;&#21644;&#28216;&#25103;&#27969;&#31243;&#30340;&#20027;&#20989;&#25968;</span>
<span style="color: #ffa54f;">function RunAsDisplayer()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">        local sigThis</span>
<span style="color: #ffa54f;">        InitDraw</span>

<span style="color: #ffa54f;">        #&#25346;&#36733;&#21508;&#31181;&#20449;&#21495;&#30340;&#22788;&#29702;&#20989;&#25968;</span>
<span style="color: #ffa54f;">        trap "sig=$sigRotate;" $sigRotate</span>
<span style="color: #ffa54f;">        trap "sig=$sigLeft;" $sigLeft</span>
<span style="color: #ffa54f;">        trap "sig=$sigRight;" $sigRight</span>
<span style="color: #ffa54f;">        trap "sig=$sigDown;" $sigDown</span>
<span style="color: #ffa54f;">        trap "sig=$sigAllDown;" $sigAllDown</span>
<span style="color: #ffa54f;">        trap "ShowExit;" $sigExit</span>

<span style="color: #ffa54f;">        while :</span>
<span style="color: #ffa54f;">        do</span>
<span style="color: #ffa54f;">                #&#26681;&#25454;&#24403;&#21069;&#30340;&#36895;&#24230;&#32423;iLevel&#19981;&#21516;&#65292;&#35774;&#23450;&#30456;&#24212;&#30340;&#24490;&#29615;&#30340;&#27425;&#25968;</span>
<span style="color: #ffa54f;">                for ((i = 0; i &lt; 21 - iLevel; i++))</span>
<span style="color: #ffa54f;">                do</span>
<span style="color: #ffa54f;">                        sleep 0.02</span>
<span style="color: #ffa54f;">                        sigThis=$sig</span>
<span style="color: #ffa54f;">                        sig=0</span>

<span style="color: #ffa54f;">                        #&#26681;&#25454;sig&#21464;&#37327;&#21028;&#26029;&#26159;&#21542;&#25509;&#21463;&#21040;&#30456;&#24212;&#30340;&#20449;&#21495;</span>
<span style="color: #ffa54f;">                        if ((sigThis == sigRotate)); then BoxRotate;        #&#26059;&#36716;</span>
<span style="color: #ffa54f;">                        elif ((sigThis == sigLeft)); then BoxLeft;        #&#24038;&#31227;&#19968;&#21015;</span>
<span style="color: #ffa54f;">                        elif ((sigThis == sigRight)); then BoxRight;        #&#21491;&#31227;&#19968;&#21015;</span>
<span style="color: #ffa54f;">                        elif ((sigThis == sigDown)); then BoxDown;        #&#19979;&#33853;&#19968;&#34892;</span>
<span style="color: #ffa54f;">                        elif ((sigThis == sigAllDown)); then BoxAllDown;        #&#19979;&#33853;&#21040;&#24213;</span>
<span style="color: #ffa54f;">                        fi</span>
<span style="color: #ffa54f;">                done</span>
<span style="color: #ffa54f;">                #kill -$sigDown $$</span>
<span style="color: #ffa54f;">                BoxDown        #&#19979;&#33853;&#19968;&#34892;</span>
<span style="color: #ffa54f;">        done</span>
<span style="color: #ffa54f;">}</span>


<span style="color: #ffa54f;">#BoxMove(y, x), &#27979;&#35797;&#26159;&#21542;&#21487;&#20197;&#25226;&#31227;&#21160;&#20013;&#30340;&#26041;&#22359;&#31227;&#21040;(x, y)&#30340;&#20301;&#32622;, &#36820;&#22238;0&#21017;&#21487;&#20197;, 1&#19981;&#21487;&#20197;</span>
<span style="color: #ffa54f;">function BoxMove()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">        local j i x y xTest yTest</span>
<span style="color: #ffa54f;">        yTest=$1</span>
<span style="color: #ffa54f;">        xTest=$2</span>
<span style="color: #ffa54f;">        for ((j = 0; j &lt; 8; j += 2))</span>
<span style="color: #ffa54f;">        do</span>
<span style="color: #ffa54f;">                ((i = j + 1))</span>
<span style="color: #ffa54f;">                ((y = ${boxCur[$j]} + yTest))</span>
<span style="color: #ffa54f;">                ((x = ${boxCur[$i]} + xTest))</span>
<span style="color: #ffa54f;">                if (( y &lt; 0 || y &gt;= iTrayHeight || x &lt; 0 || x &gt;= iTrayWidth))</span>
<span style="color: #ffa54f;">                then</span>
<span style="color: #ffa54f;">                        #&#25758;&#21040;&#22681;&#22721;&#20102;</span>
<span style="color: #ffa54f;">                        return 1</span>
<span style="color: #ffa54f;">                fi</span>
<span style="color: #ffa54f;">                if ((${iMap[y * iTrayWidth + x]} != -1 ))</span>
<span style="color: #ffa54f;">                then</span>
<span style="color: #ffa54f;">                        #&#25758;&#21040;&#20854;&#20182;&#24050;&#32463;&#23384;&#22312;&#30340;&#26041;&#22359;&#20102;</span>
<span style="color: #ffa54f;">                        return 1</span>
<span style="color: #ffa54f;">                fi</span>
<span style="color: #ffa54f;">        done</span>
<span style="color: #ffa54f;">        return 0;</span>
<span style="color: #ffa54f;">}</span>


<span style="color: #ffa54f;">#&#23558;&#24403;&#21069;&#31227;&#21160;&#20013;&#30340;&#26041;&#22359;&#25918;&#21040;&#32972;&#26223;&#26041;&#22359;&#20013;&#21435;,</span>
<span style="color: #ffa54f;">#&#24182;&#35745;&#31639;&#26032;&#30340;&#20998;&#25968;&#21644;&#36895;&#24230;&#32423;&#12290;(&#21363;&#19968;&#27425;&#26041;&#22359;&#33853;&#21040;&#24213;&#37096;)</span>
<span style="color: #ffa54f;">function Box2Map()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">        local j i x y xp yp line</span>

<span style="color: #ffa54f;">        #&#23558;&#24403;&#21069;&#31227;&#21160;&#20013;&#30340;&#26041;&#22359;&#25918;&#21040;&#32972;&#26223;&#26041;&#22359;&#20013;&#21435;</span>
<span style="color: #ffa54f;">        for ((j = 0; j &lt; 8; j += 2))</span>
<span style="color: #ffa54f;">        do</span>
<span style="color: #ffa54f;">                ((i = j + 1))</span>
<span style="color: #ffa54f;">                ((y = ${boxCur[$j]} + boxCurY))</span>
<span style="color: #ffa54f;">                ((x = ${boxCur[$i]} + boxCurX))</span>
<span style="color: #ffa54f;">                ((i = y * iTrayWidth + x))</span>
<span style="color: #ffa54f;">                iMap[$i]=$cBoxCur</span>
<span style="color: #ffa54f;">        done</span>

<span style="color: #ffa54f;">        #&#28040;&#21435;&#21487;&#34987;&#28040;&#21435;&#30340;&#34892;</span>
<span style="color: #ffa54f;">        line=0</span>
<span style="color: #ffa54f;">        for ((j = 0; j &lt; iTrayWidth * iTrayHeight; j += iTrayWidth))</span>
<span style="color: #ffa54f;">        do</span>
<span style="color: #ffa54f;">                for ((i = j + iTrayWidth - 1; i &gt;= j; i--))</span>
<span style="color: #ffa54f;">                do</span>
<span style="color: #ffa54f;">                        if ((${iMap[$i]} == -1)); then break; fi</span>
<span style="color: #ffa54f;">                done</span>
<span style="color: #ffa54f;">                if ((i &gt;= j)); then continue; fi</span>

<span style="color: #ffa54f;">                ((line++))</span>
<span style="color: #ffa54f;">                for ((i = j - 1; i &gt;= 0; i--))</span>
<span style="color: #ffa54f;">                do</span>
<span style="color: #ffa54f;">                        ((x = i + iTrayWidth))</span>
<span style="color: #ffa54f;">                        iMap[$x]=${iMap[$i]}</span>
<span style="color: #ffa54f;">                done</span>
<span style="color: #ffa54f;">                for ((i = 0; i &lt; iTrayWidth; i++))</span>
<span style="color: #ffa54f;">                do</span>
<span style="color: #ffa54f;">                        iMap[$i]=-1</span>
<span style="color: #ffa54f;">                done</span>
<span style="color: #ffa54f;">        done</span>

<span style="color: #ffa54f;">        if ((line == 0)); then return; fi</span>

<span style="color: #ffa54f;">        #&#26681;&#25454;&#28040;&#21435;&#30340;&#34892;&#25968;line&#35745;&#31639;&#20998;&#25968;&#21644;&#36895;&#24230;&#32423;</span>
<span style="color: #ffa54f;">        ((x = iLeft + iTrayWidth * 2 + 7))</span>
<span style="color: #ffa54f;">        ((y = iTop + 11))</span>
<span style="color: #ffa54f;">        ((iScore += line * 2 - 1))</span>
<span style="color: #ffa54f;">        #&#26174;&#31034;&#26032;&#30340;&#20998;&#25968;</span>
<span style="color: #ffa54f;">        echo -ne "\033[1m\033[3${cScoreValue}m\033[${y};${x}H${iScore}         "</span>
<span style="color: #ffa54f;">        if ((iScore % iScoreEachLevel &lt; line * 2 - 1))</span>
<span style="color: #ffa54f;">        then</span>
<span style="color: #ffa54f;">                if ((iLevel &lt; 20))</span>
<span style="color: #ffa54f;">                then</span>
<span style="color: #ffa54f;">                        ((iLevel++))</span>
<span style="color: #ffa54f;">                        ((y = iTop + 14))</span>
<span style="color: #ffa54f;">                        #&#26174;&#31034;&#26032;&#30340;&#36895;&#24230;&#32423;</span>
<span style="color: #ffa54f;">                        echo -ne "\033[3${cScoreValue}m\033[${y};${x}H${iLevel}        "</span>
<span style="color: #ffa54f;">                fi</span>
<span style="color: #ffa54f;">        fi</span>
<span style="color: #ffa54f;">        echo -ne "\033[0m"</span>


<span style="color: #ffa54f;">        #&#37325;&#26032;&#26174;&#31034;&#32972;&#26223;&#26041;&#22359;</span>
<span style="color: #ffa54f;">        for ((y = 0; y &lt; iTrayHeight; y++))</span>
<span style="color: #ffa54f;">        do</span>
<span style="color: #ffa54f;">                ((yp = y + iTrayTop + 1))</span>
<span style="color: #ffa54f;">                ((xp = iTrayLeft + 1))</span>
<span style="color: #ffa54f;">                ((i = y * iTrayWidth))</span>
<span style="color: #ffa54f;">                echo -ne "\033[${yp};${xp}H"</span>
<span style="color: #ffa54f;">                for ((x = 0; x &lt; iTrayWidth; x++))</span>
<span style="color: #ffa54f;">                do</span>
<span style="color: #ffa54f;">                        ((j = i + x))</span>
<span style="color: #ffa54f;">                        if ((${iMap[$j]} == -1))</span>
<span style="color: #ffa54f;">                        then</span>
<span style="color: #ffa54f;">                                echo -ne "  "</span>
<span style="color: #ffa54f;">                        else</span>
<span style="color: #ffa54f;">                                echo -ne "\033[1m\033[7m\033[3${iMap[$j]}m\033[4${iMap[$j]}m[]\033[0m"</span>
<span style="color: #ffa54f;">                        fi</span>
<span style="color: #ffa54f;">                done</span>
<span style="color: #ffa54f;">        done</span>
<span style="color: #ffa54f;">}</span>


<span style="color: #ffa54f;">#&#19979;&#33853;&#19968;&#34892;</span>
<span style="color: #ffa54f;">function BoxDown()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">        local y s</span>
<span style="color: #ffa54f;">        ((y = boxCurY + 1))        #&#26032;&#30340;y&#22352;&#26631;</span>
<span style="color: #ffa54f;">        if BoxMove $y $boxCurX        #&#27979;&#35797;&#26159;&#21542;&#21487;&#20197;&#19979;&#33853;&#19968;&#34892;</span>
<span style="color: #ffa54f;">        then</span>
<span style="color: #ffa54f;">                s="`DrawCurBox 0`"        #&#23558;&#26087;&#30340;&#26041;&#22359;&#25273;&#21435;</span>
<span style="color: #ffa54f;">                ((boxCurY = y))</span>
<span style="color: #ffa54f;">                s="$s`DrawCurBox 1`"        #&#26174;&#31034;&#26032;&#30340;&#19979;&#33853;&#21518;&#26041;&#22359;</span>
<span style="color: #ffa54f;">                echo -ne $s</span>
<span style="color: #ffa54f;">        else</span>
<span style="color: #ffa54f;">                #&#36208;&#21040;&#36825;&#20799;, &#22914;&#26524;&#19981;&#33021;&#19979;&#33853;&#20102;</span>
<span style="color: #ffa54f;">                Box2Map                #&#23558;&#24403;&#21069;&#31227;&#21160;&#20013;&#30340;&#26041;&#22359;&#36148;&#21040;&#32972;&#26223;&#26041;&#22359;&#20013;</span>
<span style="color: #ffa54f;">                RandomBox        #&#20135;&#29983;&#26032;&#30340;&#26041;&#22359;</span>
<span style="color: #ffa54f;">        fi</span>
<span style="color: #ffa54f;">}</span>

<span style="color: #ffa54f;">#&#24038;&#31227;&#19968;&#21015;</span>
<span style="color: #ffa54f;">function BoxLeft()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">        local x s</span>
<span style="color: #ffa54f;">        ((x = boxCurX - 1))</span>
<span style="color: #ffa54f;">        if BoxMove $boxCurY $x</span>
<span style="color: #ffa54f;">        then</span>
<span style="color: #ffa54f;">                s=`DrawCurBox 0`</span>
<span style="color: #ffa54f;">                ((boxCurX = x))</span>
<span style="color: #ffa54f;">                s=$s`DrawCurBox 1`</span>
<span style="color: #ffa54f;">                echo -ne $s</span>
<span style="color: #ffa54f;">        fi</span>
<span style="color: #ffa54f;">}</span>

<span style="color: #ffa54f;">#&#21491;&#31227;&#19968;&#21015;</span>
<span style="color: #ffa54f;">function BoxRight()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">        local x s</span>
<span style="color: #ffa54f;">        ((x = boxCurX + 1))</span>
<span style="color: #ffa54f;">        if BoxMove $boxCurY $x</span>
<span style="color: #ffa54f;">        then</span>
<span style="color: #ffa54f;">                s=`DrawCurBox 0`</span>
<span style="color: #ffa54f;">                ((boxCurX = x))</span>
<span style="color: #ffa54f;">                s=$s`DrawCurBox 1`</span>
<span style="color: #ffa54f;">                echo -ne $s</span>
<span style="color: #ffa54f;">        fi</span>
<span style="color: #ffa54f;">}</span>


<span style="color: #ffa54f;">#&#19979;&#33853;&#21040;&#24213;</span>
<span style="color: #ffa54f;">function BoxAllDown()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">        local k j i x y iDown s</span>
<span style="color: #ffa54f;">        iDown=$iTrayHeight</span>

<span style="color: #ffa54f;">        #&#35745;&#31639;&#19968;&#20849;&#38656;&#35201;&#19979;&#33853;&#22810;&#23569;&#34892;</span>
<span style="color: #ffa54f;">        for ((j = 0; j &lt; 8; j += 2))</span>
<span style="color: #ffa54f;">        do</span>
<span style="color: #ffa54f;">                ((i = j + 1))</span>
<span style="color: #ffa54f;">                ((y = ${boxCur[$j]} + boxCurY))</span>
<span style="color: #ffa54f;">                ((x = ${boxCur[$i]} + boxCurX))</span>
<span style="color: #ffa54f;">                for ((k = y + 1; k &lt; iTrayHeight; k++))</span>
<span style="color: #ffa54f;">                do</span>
<span style="color: #ffa54f;">                        ((i = k * iTrayWidth + x))</span>
<span style="color: #ffa54f;">                        if (( ${iMap[$i]} != -1)); then break; fi</span>
<span style="color: #ffa54f;">                done</span>
<span style="color: #ffa54f;">                ((k -= y + 1))</span>
<span style="color: #ffa54f;">                if (( $iDown &gt; $k )); then iDown=$k; fi</span>
<span style="color: #ffa54f;">        done</span>

<span style="color: #ffa54f;">        s=`DrawCurBox 0`        #&#23558;&#26087;&#30340;&#26041;&#22359;&#25273;&#21435;</span>
<span style="color: #ffa54f;">        ((boxCurY += iDown))</span>
<span style="color: #ffa54f;">        s=$s`DrawCurBox 1`        #&#26174;&#31034;&#26032;&#30340;&#19979;&#33853;&#21518;&#30340;&#26041;&#22359;</span>
<span style="color: #ffa54f;">        echo -ne $s</span>
<span style="color: #ffa54f;">        Box2Map                #&#23558;&#24403;&#21069;&#31227;&#21160;&#20013;&#30340;&#26041;&#22359;&#36148;&#21040;&#32972;&#26223;&#26041;&#22359;&#20013;</span>
<span style="color: #ffa54f;">        RandomBox        #&#20135;&#29983;&#26032;&#30340;&#26041;&#22359;</span>
<span style="color: #ffa54f;">}</span>


<span style="color: #ffa54f;">#&#26059;&#36716;&#26041;&#22359;</span>
<span style="color: #ffa54f;">function BoxRotate()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">        local iCount iTestRotate boxTest j i s</span>
<span style="color: #ffa54f;">        iCount=${countBox[$iBoxCurType]}        #&#24403;&#21069;&#30340;&#26041;&#22359;&#32463;&#26059;&#36716;&#21487;&#20197;&#20135;&#29983;&#30340;&#26679;&#24335;&#30340;&#25968;&#30446;</span>

<span style="color: #ffa54f;">        #&#35745;&#31639;&#26059;&#36716;&#21518;&#30340;&#26032;&#30340;&#26679;&#24335;</span>
<span style="color: #ffa54f;">        ((iTestRotate = iBoxCurRotate + 1))</span>
<span style="color: #ffa54f;">        if ((iTestRotate &gt;= iCount))</span>
<span style="color: #ffa54f;">        then</span>
<span style="color: #ffa54f;">                ((iTestRotate = 0))</span>
<span style="color: #ffa54f;">        fi</span>

<span style="color: #ffa54f;">        #&#26356;&#26032;&#21040;&#26032;&#30340;&#26679;&#24335;, &#20445;&#23384;&#32769;&#30340;&#26679;&#24335;(&#20294;&#19981;&#26174;&#31034;)</span>
<span style="color: #ffa54f;">        for ((j = 0, i = (${offsetBox[$iBoxCurType]} + $iTestRotate) * 8; j &lt; 8; j++, i++))</span>
<span style="color: #ffa54f;">        do</span>
<span style="color: #ffa54f;">                boxTest[$j]=${boxCur[$j]}</span>
<span style="color: #ffa54f;">                boxCur[$j]=${box[$i]}</span>
<span style="color: #ffa54f;">        done</span>

<span style="color: #ffa54f;">        if BoxMove $boxCurY $boxCurX        #&#27979;&#35797;&#26059;&#36716;&#21518;&#26159;&#21542;&#26377;&#31354;&#38388;&#25918;&#30340;&#19979;</span>
<span style="color: #ffa54f;">        then</span>
<span style="color: #ffa54f;">                #&#25273;&#21435;&#26087;&#30340;&#26041;&#22359;</span>
<span style="color: #ffa54f;">                for ((j = 0; j &lt; 8; j++))</span>
<span style="color: #ffa54f;">                do</span>
<span style="color: #ffa54f;">                        boxCur[$j]=${boxTest[$j]}</span>
<span style="color: #ffa54f;">                done</span>
<span style="color: #ffa54f;">                s=`DrawCurBox 0`</span>

<span style="color: #ffa54f;">                #&#30011;&#19978;&#26032;&#30340;&#26041;&#22359;</span>
<span style="color: #ffa54f;">                for ((j = 0, i = (${offsetBox[$iBoxCurType]} + $iTestRotate) * 8; j &lt; 8; j++, i++))</span>
<span style="color: #ffa54f;">                do</span>
<span style="color: #ffa54f;">                        boxCur[$j]=${box[$i]}</span>
<span style="color: #ffa54f;">                done</span>
<span style="color: #ffa54f;">                s=$s`DrawCurBox 1`</span>
<span style="color: #ffa54f;">                echo -ne $s</span>
<span style="color: #ffa54f;">                iBoxCurRotate=$iTestRotate</span>
<span style="color: #ffa54f;">        else</span>
<span style="color: #ffa54f;">                #&#19981;&#33021;&#26059;&#36716;&#65292;&#36824;&#26159;&#32487;&#32493;&#20351;&#29992;&#32769;&#30340;&#26679;&#24335;</span>
<span style="color: #ffa54f;">                for ((j = 0; j &lt; 8; j++))</span>
<span style="color: #ffa54f;">                do</span>
<span style="color: #ffa54f;">                        boxCur[$j]=${boxTest[$j]}</span>
<span style="color: #ffa54f;">                done</span>
<span style="color: #ffa54f;">        fi</span>
<span style="color: #ffa54f;">}</span>


<span style="color: #ffa54f;">#DrawCurBox(bDraw), &#32472;&#21046;&#24403;&#21069;&#31227;&#21160;&#20013;&#30340;&#26041;&#22359;, bDraw&#20026;1, &#30011;&#19978;, bDraw&#20026;0, &#25273;&#21435;&#26041;&#22359;&#12290;</span>
<span style="color: #ffa54f;">function DrawCurBox()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">        local i j t bDraw sBox s</span>
<span style="color: #ffa54f;">        bDraw=$1</span>

<span style="color: #ffa54f;">        s=""</span>
<span style="color: #ffa54f;">        if (( bDraw == 0 ))</span>
<span style="color: #ffa54f;">        then</span>
<span style="color: #ffa54f;">                sBox="\040\040"</span>
<span style="color: #ffa54f;">        else</span>
<span style="color: #ffa54f;">                sBox="[]"</span>
<span style="color: #ffa54f;">                s=$s"\033[1m\033[7m\033[3${cBoxCur}m\033[4${cBoxCur}m"</span>
<span style="color: #ffa54f;">        fi</span>

<span style="color: #ffa54f;">        for ((j = 0; j &lt; 8; j += 2))</span>
<span style="color: #ffa54f;">        do</span>
<span style="color: #ffa54f;">                ((i = iTrayTop + 1 + ${boxCur[$j]} + boxCurY))</span>
<span style="color: #ffa54f;">                ((t = iTrayLeft + 1 + 2 * (boxCurX + ${boxCur[$j + 1]})))</span>
<span style="color: #ffa54f;">                #\033[y;xH, &#20809;&#26631;&#21040;(x, y)&#22788;</span>
<span style="color: #ffa54f;">                s=$s"\033[${i};${t}H${sBox}"</span>
<span style="color: #ffa54f;">        done</span>
<span style="color: #ffa54f;">        s=$s"\033[0m"</span>
<span style="color: #ffa54f;">        echo -n $s</span>
<span style="color: #ffa54f;">}</span>


<span style="color: #ffa54f;">#&#26356;&#26032;&#26032;&#30340;&#26041;&#22359;</span>
<span style="color: #ffa54f;">function RandomBox()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">        local i j t</span>

<span style="color: #ffa54f;">        #&#26356;&#26032;&#24403;&#21069;&#31227;&#21160;&#30340;&#26041;&#22359;</span>
<span style="color: #ffa54f;">        iBoxCurType=${iBoxNewType}</span>
<span style="color: #ffa54f;">        iBoxCurRotate=${iBoxNewRotate}</span>
<span style="color: #ffa54f;">        cBoxCur=${cBoxNew}</span>
<span style="color: #ffa54f;">        for ((j = 0; j &lt; ${#boxNew[@]}; j++))</span>
<span style="color: #ffa54f;">        do</span>
<span style="color: #ffa54f;">                boxCur[$j]=${boxNew[$j]}</span>
<span style="color: #ffa54f;">        done</span>


<span style="color: #ffa54f;">        #&#26174;&#31034;&#24403;&#21069;&#31227;&#21160;&#30340;&#26041;&#22359;</span>
<span style="color: #ffa54f;">        if (( ${#boxCur[@]} == 8 ))</span>
<span style="color: #ffa54f;">        then</span>
<span style="color: #ffa54f;">                #&#35745;&#31639;&#24403;&#21069;&#26041;&#22359;&#35813;&#20174;&#39030;&#31471;&#21738;&#19968;&#34892;"&#20882;"&#20986;&#26469;</span>
<span style="color: #ffa54f;">                for ((j = 0, t = 4; j &lt; 8; j += 2))</span>
<span style="color: #ffa54f;">                do</span>
<span style="color: #ffa54f;">                        if ((${boxCur[$j]} &lt; t)); then t=${boxCur[$j]}; fi</span>
<span style="color: #ffa54f;">                done</span>
<span style="color: #ffa54f;">                ((boxCurY = -t))</span>
<span style="color: #ffa54f;">                for ((j = 1, i = -4, t = 20; j &lt; 8; j += 2))</span>
<span style="color: #ffa54f;">                do</span>
<span style="color: #ffa54f;">                        if ((${boxCur[$j]} &gt; i)); then i=${boxCur[$j]}; fi</span>
<span style="color: #ffa54f;">                        if ((${boxCur[$j]} &lt; t)); then t=${boxCur[$j]}; fi</span>
<span style="color: #ffa54f;">                done</span>
<span style="color: #ffa54f;">                ((boxCurX = (iTrayWidth - 1 - i - t) / 2))</span>

<span style="color: #ffa54f;">                #&#26174;&#31034;&#24403;&#21069;&#31227;&#21160;&#30340;&#26041;&#22359;</span>
<span style="color: #ffa54f;">                echo -ne `DrawCurBox 1`</span>

<span style="color: #ffa54f;">                #&#22914;&#26524;&#26041;&#22359;&#19968;&#20986;&#26469;&#23601;&#27809;&#22788;&#25918;&#65292;Game over!</span>
<span style="color: #ffa54f;">                if ! BoxMove $boxCurY $boxCurX</span>
<span style="color: #ffa54f;">                then</span>
<span style="color: #ffa54f;">                        kill -$sigExit ${PPID}</span>
<span style="color: #ffa54f;">                        ShowExit</span>
<span style="color: #ffa54f;">                fi</span>
<span style="color: #ffa54f;">        fi</span>



<span style="color: #ffa54f;">        #&#28165;&#38500;&#21491;&#36793;&#39044;&#26174;&#31034;&#30340;&#26041;&#22359;</span>
<span style="color: #ffa54f;">        for ((j = 0; j &lt; 4; j++))</span>
<span style="color: #ffa54f;">        do</span>
<span style="color: #ffa54f;">                ((i = iTop + 1 + j))</span>
<span style="color: #ffa54f;">                ((t = iLeft + 2 * iTrayWidth + 7))</span>
<span style="color: #ffa54f;">                echo -ne "\033[${i};${t}H        "</span>
<span style="color: #ffa54f;">        done</span>

<span style="color: #ffa54f;">        #&#38543;&#26426;&#20135;&#29983;&#26032;&#30340;&#26041;&#22359;</span>
<span style="color: #ffa54f;">        ((iBoxNewType = RANDOM % ${#offsetBox[@]}))</span>
<span style="color: #ffa54f;">        ((iBoxNewRotate = RANDOM % ${countBox[$iBoxNewType]}))</span>
<span style="color: #ffa54f;">        for ((j = 0, i = (${offsetBox[$iBoxNewType]} + $iBoxNewRotate) * 8; j &lt; 8; j++, i++))</span>
<span style="color: #ffa54f;">        do</span>
<span style="color: #ffa54f;">                boxNew[$j]=${box[$i]};</span>
<span style="color: #ffa54f;">        done</span>

<span style="color: #ffa54f;">        ((cBoxNew = ${colorTable[RANDOM % ${#colorTable[@]}]}))</span>

<span style="color: #ffa54f;">        #&#26174;&#31034;&#21491;&#36793;&#39044;&#26174;&#31034;&#30340;&#26041;&#22359;</span>
<span style="color: #ffa54f;">        echo -ne "\033[1m\033[7m\033[3${cBoxNew}m\033[4${cBoxNew}m"</span>
<span style="color: #ffa54f;">        for ((j = 0; j &lt; 8; j += 2))</span>
<span style="color: #ffa54f;">        do</span>
<span style="color: #ffa54f;">                ((i = iTop + 1 + ${boxNew[$j]}))</span>
<span style="color: #ffa54f;">                ((t = iLeft + 2 * iTrayWidth + 7 + 2 * ${boxNew[$j + 1]}))</span>
<span style="color: #ffa54f;">                echo -ne "\033[${i};${t}H[]"</span>
<span style="color: #ffa54f;">        done</span>
<span style="color: #ffa54f;">        echo -ne "\033[0m"</span>
<span style="color: #ffa54f;">}</span>


<span style="color: #ffa54f;">#&#21021;&#22987;&#32472;&#21046;</span>
<span style="color: #ffa54f;">function InitDraw()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">        clear</span>
<span style="color: #ffa54f;">        RandomBox        #&#38543;&#26426;&#20135;&#29983;&#26041;&#22359;&#65292;&#36825;&#26102;&#21491;&#36793;&#39044;&#26174;&#31034;&#31383;&#21475;&#20013;&#26377;&#26041;&#24555;&#20102;</span>
<span style="color: #ffa54f;">        RandomBox        #&#20877;&#38543;&#26426;&#20135;&#29983;&#26041;&#22359;&#65292;&#21491;&#36793;&#39044;&#26174;&#31034;&#31383;&#21475;&#20013;&#30340;&#26041;&#22359;&#34987;&#26356;&#26032;&#65292;&#21407;&#20808;&#30340;&#26041;&#22359;&#23558;&#24320;&#22987;&#19979;&#33853;</span>
<span style="color: #ffa54f;">        local i t1 t2 t3</span>

<span style="color: #ffa54f;">        #&#26174;&#31034;&#36793;&#26694;</span>
<span style="color: #ffa54f;">        echo -ne "\033[1m"</span>
<span style="color: #ffa54f;">        echo -ne "\033[3${cBorder}m\033[4${cBorder}m"</span>

<span style="color: #ffa54f;">        ((t2 = iLeft + 1))</span>
<span style="color: #ffa54f;">        ((t3 = iLeft + iTrayWidth * 2 + 3))</span>
<span style="color: #ffa54f;">        for ((i = 0; i &lt; iTrayHeight; i++))</span>
<span style="color: #ffa54f;">        do</span>
<span style="color: #ffa54f;">                ((t1 = i + iTop + 2))</span>
<span style="color: #ffa54f;">                echo -ne "\033[${t1};${t2}H||"</span>
<span style="color: #ffa54f;">                echo -ne "\033[${t1};${t3}H||"</span>
<span style="color: #ffa54f;">        done</span>

<span style="color: #ffa54f;">        ((t2 = iTop + iTrayHeight + 2))</span>
<span style="color: #ffa54f;">        for ((i = 0; i &lt; iTrayWidth + 2; i++))</span>
<span style="color: #ffa54f;">        do</span>
<span style="color: #ffa54f;">                ((t1 = i * 2 + iLeft + 1))</span>
<span style="color: #ffa54f;">                echo -ne "\033[${iTrayTop};${t1}H=="</span>
<span style="color: #ffa54f;">                echo -ne "\033[${t2};${t1}H=="</span>
<span style="color: #ffa54f;">        done</span>
<span style="color: #ffa54f;">        echo -ne "\033[0m"</span>


<span style="color: #ffa54f;">        #&#26174;&#31034;"Score"&#21644;"Level"&#23383;&#26679;</span>
<span style="color: #ffa54f;">        echo -ne "\033[1m"</span>
<span style="color: #ffa54f;">        ((t1 = iLeft + iTrayWidth * 2 + 7))</span>
<span style="color: #ffa54f;">        ((t2 = iTop + 10))</span>
<span style="color: #ffa54f;">        echo -ne "\033[3${cScore}m\033[${t2};${t1}HScore"</span>
<span style="color: #ffa54f;">        ((t2 = iTop + 11))</span>
<span style="color: #ffa54f;">        echo -ne "\033[3${cScoreValue}m\033[${t2};${t1}H${iScore}"</span>
<span style="color: #ffa54f;">        ((t2 = iTop + 13))</span>
<span style="color: #ffa54f;">        echo -ne "\033[3${cScore}m\033[${t2};${t1}HLevel"</span>
<span style="color: #ffa54f;">        ((t2 = iTop + 14))</span>
<span style="color: #ffa54f;">        echo -ne "\033[3${cScoreValue}m\033[${t2};${t1}H${iLevel}"</span>
<span style="color: #ffa54f;">        echo -ne "\033[0m"</span>
<span style="color: #ffa54f;">}</span>


<span style="color: #ffa54f;">#&#36864;&#20986;&#26102;&#26174;&#31034;GameOVer!</span>
<span style="color: #ffa54f;">function ShowExit()</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">        local y</span>
<span style="color: #ffa54f;">        ((y = iTrayHeight + iTrayTop + 3))</span>
<span style="color: #ffa54f;">        echo -e "\033[${y};0HGameOver!\033[0m"</span>
<span style="color: #ffa54f;">        exit</span>
<span style="color: #ffa54f;">}</span>


<span style="color: #ffa54f;">#&#26174;&#31034;&#29992;&#27861;.</span>
<span style="color: #ffa54f;">function Usage</span>
<span style="color: #ffa54f;">{</span>
<span style="color: #ffa54f;">        cat &lt;&lt; EOF</span>
<span style="color: #ffa54f;">Usage: $APP_NAME</span>
<span style="color: #ffa54f;">Start tetris game.</span>

<span style="color: #ffa54f;">  -h, --help              display this help and exit</span>
<span style="color: #ffa54f;">      --version           output version information and exit</span>
<span style="color: #ffa54f;">EOF</span>
}


<span style="color: #b22222;">#</span><span style="color: #b22222;">&#28216;&#25103;&#20027;&#31243;&#24207;&#22312;&#36825;&#20799;&#24320;&#22987;.</span>
<span style="color: #a020f0;">if</span> [[ <span style="color: #8b2252;">"$1"</span> == <span style="color: #8b2252;">"-h"</span> || <span style="color: #8b2252;">"$1"</span> == <span style="color: #8b2252;">"--help"</span> ]]; <span style="color: #a020f0;">then</span>
        Usage
<span style="color: #a020f0;">elif</span> [[ <span style="color: #8b2252;">"$1"</span> == <span style="color: #8b2252;">"--version"</span> ]]; <span style="color: #a020f0;">then</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"$APP_NAME $APP_VERSION"</span>
<span style="color: #a020f0;">elif</span> [[ <span style="color: #8b2252;">"$1"</span> == <span style="color: #8b2252;">"--show"</span> ]]; <span style="color: #a020f0;">then</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#21457;&#29616;&#20855;&#26377;&#21442;&#25968;--show&#26102;&#65292;&#36816;&#34892;&#26174;&#31034;&#20989;&#25968;</span>
        RunAsDisplayer
<span style="color: #a020f0;">else</span>
        bash $<span style="color: #a0522d;">0</span> --show&amp;        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;&#21442;&#25968;--show&#23558;&#26412;&#31243;&#24207;&#20877;&#36816;&#34892;&#19968;&#36941;</span>
        RunAsKeyReceiver $<span style="color: #a0522d;">!</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;&#19978;&#19968;&#34892;&#20135;&#29983;&#30340;&#36827;&#31243;&#30340;&#36827;&#31243;&#21495;&#20316;&#20026;&#21442;&#25968;</span>
<span style="color: #a020f0;">fi</span>
EOF
</pre>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>打赏</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>© 2025 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
<!--
<script type="text/javascript" src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/bootstrap@5.2.1/dist/js/bootstrap.min.js"></script>
<div id="back-to-top" class=""><svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg></div>
-->
</div>
</body>
</html>
