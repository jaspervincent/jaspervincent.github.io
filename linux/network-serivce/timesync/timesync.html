<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linux: æ—¶é—´åŒæ­¥</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/font.css"/>
<link rel="stylesheet" type="text/css" href="/static/drollery.e825b870.css"/>
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
</head>
<body>
<header id="preamble" class="status">
<header class="{className}" data-astro-cid-3ef6ksr2>
  <div class=header-branding data-astro-cid-g2lrb5xm>
      <span class=header-text data-astro-cid-g2lrb5xm>
          <span class=dropcap data-astro-cid-g2lrb5xm aria-hidden=true>
              <span class=actual data-astro-cid-g2lrb5xm>J</span>
              <span class=rest data-astro-cid-g2lrb5xm>asper Hsu</span>
              <span class=period data-astro-cid-g2lrb5xm>.</span>
          </span>
          <span class=sr-only data-astro-cid-g2lrb5xm>Drollery</span>
      </span>
      <img alt="Medieval drollery of a knight on a horse" class=spring decoding=async height=250 loading=lazy src=/images/knight-horse.a96eee7d_Z1WCOYs.webp width=68 data-astro-cid-g2lrb5xm>
  </div>

  <nav data-astro-cid-pux6a34n>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/jcodelog.html class=nobracket data-astro-cid-pux6a34n>æŠ€æœ¯</a>
      <span class=flower2 data-astro-cid-pux6a34n>K</span>
      <a href=/reading/index.html class=nobracket data-astro-cid-pux6a34n>é˜…è¯»</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
      <a href=/archives.html class=nobracket data-astro-cid-pux6a34n>å½’æ¡£</a>
      <span class=flower2 data-astro-cid-pux6a34n>L</span>
      <a href=/link/index.html class=nobracket data-astro-cid-pux6a34n>å‹é“¾</a>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/about.html class=nobracket data-astro-cid-pux6a34n>å…³äº</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
  </nav>


  <div class="container" data-astro-cid-3ef6ksr2>
    <p class="info" data-astro-cid-3ef6ksr2>
              ğŸ† æ¬¢è¿æ¥åˆ°æœ¬ç«™ï¼š
              <a href="https://xuchangwei.com/">https://xuchangwei.com/</a>ã€‚
              <strong>å¸Œæœ›è¿™é‡Œæœ‰ä½ æ„Ÿå…´è¶£çš„å†…å®¹</strong>ã€‚
            </p>
  </div>
  <div id=borderArtWrapper class="tt1" data-astro-cid-5hce7sga data-turbo-permanent>
      <script>
          var man, shakeCount = 0, noSound = new Audio("/audio/effects/no.m4a"), screamSound = new Audio("/audio/effects/scream.m4a");
          function animateManShakeHandler() {
              man.removeEventListener("animationend", animateManShakeHandler, !1),
              shakeCount += 1,
              man.classList.remove("shakeMan")
          }
          function animateManFallHandler() {
              man.removeEventListener("animationend", animateManFallHandler, !1),
              man.classList.add("hide")
          }
          function animateMan() {
              man = man ?? document.getElementById("borderMan"),
              3 === shakeCount ? (man.classList.add("fallMan"),
              screamSound.play(),
              man.addEventListener("animationend", animateManFallHandler, !1)) : (man.classList.add("shakeMan"),
              noSound.play(),
              man.addEventListener("animationend", animateManShakeHandler, !1))
          }
      </script>
      <div class=borderArt data-astro-cid-5dda5nwp id=articleBorder>
          <img alt="flowery border with man falling" decoding=async height=620 loading=lazy src=/images/border-vines-no-man.b7d246cc_DRxSe.webp width=909 class=border data-astro-cid-5dda5nwp>
          <div class=fallWrapper data-astro-cid-5dda5nwp>
              <img alt="flowery border with man falling" decoding=async height=292 loading=lazy src=/images/man-no-vines.247a3187_Z2ioXNM.webp width=98 class=man data-astro-cid-5dda5nwp id=borderMan onclick=animateMan()>
          </div>
      </div>
  </div>
</header>
</header>
<main class="container" id="content" class="content">
<header>
<h1 class="title">Linux: æ—¶é—´åŒæ­¥</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:d7552cad-1604-44b8-a3a1-b772c69ac077">æ—¶é—´åŒæ­¥</a>
<ul>
<li><a href="#h:03e96976-998f-46dd-a93e-48ab0f0f4ebd">è®¡æ—¶æ–¹å¼</a>
<ul>
<li><a href="#h:0ce168c2-31de-423b-a640-f0307e34639e">å¤ä»£è®¡æ—¶æ–¹å¼</a></li>
<li><a href="#h:014b0009-705f-4112-bc33-b0f5fbd5a09c">ç°ä»£è®¡æ—¶æ–¹å¼</a></li>
</ul>
</li>
<li><a href="#h:696efe75-df2d-41b0-bca9-a9e5f7ddc87e">æ—¶é—´åŒæ­¥æœåŠ¡</a></li>
<li><a href="#h:1e48d0b0-d4e8-47aa-a111-10d63474db26">NTP</a>
<ul>
<li><a href="#h:0b6c70a7-cd4f-4386-9bd4-97f571bc6a0e">NTPç®€ä»‹</a></li>
<li><a href="#h:9af21b86-1f21-4a17-8dd1-24f82c23ac1c">NTPæœåŠ¡å™¨å®‰è£…</a></li>
<li><a href="#h:ac174d22-e830-4a76-9c96-ba6f1f7cee4d">é…ç½®NTPæœåŠ¡</a></li>
<li><a href="#h:c2023251-279d-490d-a747-3a09df9713fc">å¯åŠ¨NTPæœåŠ¡å™¨</a></li>
<li><a href="#h:52fe2dd0-59b1-4db9-89fd-434db037c03c">å®¢æˆ·æœºæ—¶é—´åŒæ­¥</a></li>
</ul>
</li>
<li><a href="#h:db2aaf16-f0fd-449f-bac8-3177e77e928e">Chrony</a>
<ul>
<li><a href="#h:2c08c084-9794-4b9c-9922-a07e021e4bb7">Chronyä»‹ç»</a></li>
<li><a href="#h:68595b80-7637-449a-8d5c-be25c18c4ff2">Chrony æ–‡ä»¶ç»„æˆ</a></li>
<li><a href="#h:f7747200-0b88-483b-8b4a-8a8d73fc0eef">é…ç½®æ–‡ä»¶chrony.conf</a></li>
<li><a href="#h:9cb41dab-6721-4df9-996d-84439649ddc5">Chronyc å‘½ä»¤</a></li>
<li><a href="#h:a4fb5076-6704-47ec-b0af-8ed2355f86fc">å…¬å…±NTPæœåŠ¡</a></li>
<li><a href="#h:f7300e0a-b7a4-4f0b-b1c9-7a1e84494e82">æ—¶é—´å·¥å…·</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../../index.html">Linux</a></li>
</ul>
<section id="outline-container-h:d7552cad-1604-44b8-a3a1-b772c69ac077" class="outline-2">
<h2 id="h:d7552cad-1604-44b8-a3a1-b772c69ac077">æ—¶é—´åŒæ­¥</h2>
<div class="outline-text-2" id="text-h:d7552cad-1604-44b8-a3a1-b772c69ac077">
<p>
<a href="https://chrony.tuxfamily.org/">https://chrony.tuxfamily.org/</a>
</p>
</div>
<div id="outline-container-h:03e96976-998f-46dd-a93e-48ab0f0f4ebd" class="outline-3">
<h3 id="h:03e96976-998f-46dd-a93e-48ab0f0f4ebd">è®¡æ—¶æ–¹å¼</h3>
<div class="outline-text-3" id="text-h:03e96976-998f-46dd-a93e-48ab0f0f4ebd">
</div>
<div id="outline-container-h:0ce168c2-31de-423b-a640-f0307e34639e" class="outline-4">
<h4 id="h:0ce168c2-31de-423b-a640-f0307e34639e">å¤ä»£è®¡æ—¶æ–¹å¼</h4>
<div class="outline-text-4" id="text-h:0ce168c2-31de-423b-a640-f0307e34639e">
<p>
åœ¨è¿œå¤æ—¶æœŸï¼Œäººç±»ç”¨æ¥ç¡®å®šæ—¶é—´çš„æ–¹å¼æ˜¯ä¸€äº›è‡ªç„¶ç•Œâ€œç›¸å¯¹â€äº˜å¤ä¸å˜çš„å‘¨æœŸã€‚
å¦‚åœ°çƒçš„å…¬è½¬æ˜¯ä¸ºä¸€å¹´ï¼Œæœˆçƒçš„å…¬è½¬æ˜¯ä¸ºä¸€æœˆï¼Œåœ°çƒçš„è‡ªè½¬æ˜¯ä¸ºä¸€å¤©ç­‰ï¼Œæœ€æ—©çš„
è®¡æ—¶å¯ä»¥è¿½æº¯åˆ°å…¬å…ƒå‰å¤§çº¦2000å¹´ï¼Œå¤åŸƒåŠäººåˆ©ç”¨å…‰çº¿ç•™ä¸‹çš„å½±å­ç”¨ä½œè®¡æ—¶çš„å·¥
å…·ã€‚å½±å­æ‹‰å¾—è¶Šé•¿ï¼Œè®¡æ—¶è¶Šç²¾ç¡®ã€‚å¤åŸƒåŠäººä¿®å»ºé«˜è€¸å…¥äº‘çš„å¤§å‹æ–¹å°–ç¢‘ï¼Œæ¥è¿½è¸ª
å¤ªé˜³çš„ç§»åŠ¨ï¼Œéšåäººä»¬åˆåˆ©ç”¨äº†æ²™æ¼ã€æ—¥æ™·ã€é’Ÿæ‘†ç­‰å·¥å…·ï¼Œå·§å¦™åœ°åˆ©ç”¨ä¸€äº›ç›¸å¯¹
å›ºå®šè€Œå‡†ç¡®çš„å‘¨æœŸæ¥è®¡æ—¶
</p>

<p>
å•†æœäººå¼€å‘å¹¶ä½¿ç”¨äº†ä¸€ç§æ³„æ°´å‹æ°´é’Ÿ-&#x2013;&#x2014;æ¼å£¶ã€‚åæ¥åˆæœ‰ç”¨èœ¡çƒ›å’Œçº¿é¦™è®¡æ—¶çš„
åŒ—å®‹å…ƒç¥å…ƒå¹´ï¼ˆ1086å¹´ï¼‰ï¼Œå¤©æ–‡å­¦å®¶è‹é¢‚å°†æµ‘ä»ªã€æµ‘è±¡å’ŒæŠ¥æ—¶è£…ç½®ç»“åˆï¼Œå»ºé€ ä¸€
ä¸ªåˆ’æ—¶ä»£çš„è®¡æ—¶å·¥å…·-&#x2013;&#x2014;"æ°´è¿ä»ªè±¡å°"
</p>

<p>
14ä¸–çºªæ—¶ï¼Œè¥¿æ–¹å›½å®¶å¹¿æ³›ä½¿ç”¨æœºæ¢°é’Ÿã€‚åœ¨åå…­ä¸–çºªï¼Œå¥¥æ–¯æ›¼å¸å›½çš„ç§‘å­¦å®¶è¾¾å…¹Â·
è‰¾-ä¸ï¼ˆTaqi al-Dinï¼‰å‘æ˜å‡ºäº†æœºæ¢°é—¹é’Ÿ1583å¹´ï¼Œä¼½åˆ©ç•¥æå‡ºäº†è‘—åçš„ç­‰æ—¶æ€§ç†
è®ºï¼Œå³ä¸è®ºæ‘†åŠ¨å¹…åº¦çš„å¤§å°ï¼Œå®Œæˆä¸€æ¬¡æ‘†åŠ¨çš„æ—¶é—´æ˜¯ç›¸åŒçš„ã€‚1656å¹´ï¼Œè·å…°ç§‘å­¦
å®¶å…‹é‡Œæ–¯è’‚å®‰Â·æƒ æ›´æ–¯ï¼ˆChristiaan Huygensï¼‰åº”ç”¨ä»–çš„ç†è®ºï¼Œè®¾è®¡å‡ºäº†ä¸–ç•Œç¬¬
ä¸€åªé’Ÿæ‘† 1868å¹´ï¼Œç™¾è¾¾ç¿¡ä¸½ï¼ˆPatek Philippeï¼‰å‘æ˜äº†æ‰‹è¡¨
</p>
</div>
</div>
<div id="outline-container-h:014b0009-705f-4112-bc33-b0f5fbd5a09c" class="outline-4">
<h4 id="h:014b0009-705f-4112-bc33-b0f5fbd5a09c">ç°ä»£è®¡æ—¶æ–¹å¼</h4>
<div class="outline-text-4" id="text-h:014b0009-705f-4112-bc33-b0f5fbd5a09c">
<p>
çŸ³è‹±æ™¶ä½“å—åˆ°ç”µæ± çš„ç”µåŠ›å½±å“æ—¶ï¼Œä¼šäº§ç”Ÿè§„å¾‹çš„æŒ¯åŠ¨ã€‚æ¯ç§’çš„æŒ¯åŠ¨æ¬¡æ•°æ˜¯32768
æ¬¡ï¼Œå¯ä»¥è®¾è®¡ç”µè·¯æ¥è®¡ç®—æŒ¯åŠ¨æ¬¡æ•°ï¼Œå½“è®¡æ•°åˆ°32768æ¬¡æ—¶ï¼Œå³è®¡æ—¶1ç§’ã€‚1967å¹´ï¼Œ
ç‘å£«äººå‘å¸ƒäº†ä¸–ç•Œä¸Šé¦–æ¬¾çŸ³è‹±è¡¨
</p>

<p>
å½“åŸå­ä»ä¸€ä¸ªç›¸å¯¹é«˜çš„â€œèƒ½é‡æ€â€è¿è‡³ä½çš„â€œèƒ½é‡æ€â€æ—¶ï¼Œä¼šé‡Šæ”¾å‡ºç”µç£æ³¢ï¼Œäº§
ç”Ÿå…±æŒ¯é¢‘ç‡ã€‚ä¾æ®æ­¤åŸç†ï¼Œæ‹‰æ¯”æ„æƒ³å‡ºäº†ä¸€ç§å…¨æ–°çš„è®¡æ—¶ä»ªå™¨-&#x2013;&#x2014;åŸå­é’Ÿ
ï¼ˆAtomic clockï¼‰
</p>

<p>
å› ä¸ºåŸå­çš„å…±æŒ¯é¢‘ç‡æ˜¯å›ºå®šçš„ã€‚å¦‚ï¼šé“¯åŸå­ï¼ˆCaesium133ï¼‰çš„å›ºæœ‰é¢‘ç‡æ˜¯
9192631770èµ«å…¹ï¼Œçº¦åˆ92äº¿èµ«å…¹ï¼Œå¯¹é“¯åŸå­é’Ÿè®¡æ•°9192631770æ¬¡ï¼Œå³å¯æµ‹é‡å‡ºä¸€
ç§’é’Ÿã€‚å¾ˆå¤šå›½å®¶ï¼ˆåŒ…æ‹¬æˆ‘å›½å’Œç¾å›½NISTï¼‰çš„æ ‡å‡†å±€ï¼Œå°±æ˜¯ç”¨é“¯åŸå­é’Ÿæ¥ä½œä¸ºæ—¶é—´
ç²¾åº¦æ ‡å‡†çš„ã€‚GPSç³»ç»Ÿä¹Ÿæ˜¯ç”¨é“¯åŸå­é’Ÿæ¥è®¡æ—¶
</p>

<p>
2008å¹´è¯ç”Ÿçš„é”¶ï¼ˆStrontium87ï¼‰åŸå­é’Ÿï¼Œå›ºæœ‰é¢‘ç‡ä¸º429228004229873ï¼Œçº¦åˆ
430ä¸‡äº¿èµ«å…¹ï¼Œå°†ç²¾åº¦æé«˜åˆ°äº†10çš„17æ¬¡æ–¹
</p>

<p>
2013å¹´é•±å…ƒç´ ï¼ˆytterbiumï¼‰åˆ¶æˆçš„åŸå­é’Ÿé—®ä¸–ï¼Œé•±åŸå­é’Ÿçš„å›ºæœ‰é¢‘ç‡çº¦åˆ518ä¸‡
äº¿èµ«å…¹ï¼Œç²¾åº¦é«˜è¾¾10çš„18æ¬¡æ–¹ã€‚å®‡å®™çš„å¹´é¾„ä¸º138äº¿å¹´ã€‚å¦‚æœè¿™å°é•±åŸå­é’Ÿä»å®‡
å®™è¯ç”Ÿä¹‹åˆå°±å¼€å§‹è®¡æ—¶ï¼Œç›´åˆ°ä»Šå¤©ä¹Ÿä¸ä¼šå‘ç”Ÿ1ç§’çš„è¯¯å·®
</p>

<p>
èŒƒä¾‹ï¼šä¸€æ¬¡æ€§çš„åŒæ­¥
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@Centos7 ~]#date -s <span style="color: #8b2252;">'-1 year'</span>
Sun May 26 11:08:30 CST 2019
[root@Centos7 ~]#date
Sun May 26 11:08:32 CST 2019
[root@Centos7 ~]#ping ntp.aliyun.com
PING ntp.aliyun.com (203.107.6.88) 56(84) bytes of data.
64 bytes from 203.107.6.88 (203.107.6.88): <span style="color: #a0522d;">icmp_seq</span>=1 <span style="color: #a0522d;">ttl</span>=128 <span style="color: #a0522d;">time</span>=29.4 ms
64 bytes from 203.107.6.88 (203.107.6.88): <span style="color: #a0522d;">icmp_seq</span>=2 <span style="color: #a0522d;">ttl</span>=128 <span style="color: #a0522d;">time</span>=42.3 ms
[root@Centos7 ~]#ntpdate ntp.aliyun.com
26 May 11:09:12 ntpdate[2236]: step time server 203.107.6.88 offset 31622401.067788 sec
[root@Centos7 ~]#date
Tue May 26 11:09:18 CST 2020
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:696efe75-df2d-41b0-bca9-a9e5f7ddc87e" class="outline-3">
<h3 id="h:696efe75-df2d-41b0-bca9-a9e5f7ddc87e">æ—¶é—´åŒæ­¥æœåŠ¡</h3>
<div class="outline-text-3" id="text-h:696efe75-df2d-41b0-bca9-a9e5f7ddc87e">
<p>
åŠ å¯†å’Œå®‰å…¨å½“å‰éƒ½ç¦»ä¸å¼€æ—¶é—´çš„åŒæ­¥ï¼Œå¦åˆ™å„ç§ç½‘ç»œæœåŠ¡å¯èƒ½ä¸èƒ½æ­£å¸¸è¿è¡Œ
</p>

<p>
æ—¶é—´åŒæ­¥æœåŠ¡
</p>

<p>
å¤šä¸»æœºåä½œå·¥ä½œæ—¶ï¼Œå„ä¸ªä¸»æœºçš„æ—¶é—´åŒæ­¥å¾ˆé‡è¦ï¼Œæ—¶é—´ä¸ä¸€è‡´ä¼šé€ æˆå¾ˆå¤šé‡è¦åº”
ç”¨çš„æ•…éšœï¼Œå¦‚ï¼šåŠ å¯†åè®®ï¼Œæ—¥å¿—ï¼Œé›†ç¾¤ç­‰ï¼Œåˆ©ç”¨NTPï¼ˆNetwork Time Protocolï¼‰
åè®®ä½¿ç½‘ç»œä¸­çš„å„ä¸ªè®¡ç®—æœºæ—¶é—´è¾¾åˆ°åŒæ­¥ã€‚ç›®å‰NTPåè®®å±äºè¿ç»´åŸºç¡€æ¶æ„ä¸­å¿…
å¤‡çš„åŸºæœ¬æœåŠ¡ä¹‹ä¸€
</p>

<p>
è™½ç„¶ä¸»æœºçš„cpué¢‘ç‡æ˜¯å›ºå®šçš„ï¼Œæ—¶é—´è®¡ç®—å‡†ç¡®ï¼Œä½†éšç€æœåŠ¡å ç”¨cpuæ—¶é—´ç‰‡è¶Šæ¥è¶Š
å¤šæ—¶é—´ä¹Ÿå°±ä¸å‡†ç¡®äº†ï¼Œéœ€è¦å®šæœŸåŒæ­¥æ—¶é—´ã€‚åˆ©ç”¨äº’è”ç½‘å…¬ç”¨çš„åŸå­é’Ÿæ—¶é—´æœåŠ¡åš
åŒæ­¥ã€‚
</p>

<p>
æ—¶é—´åŒæ­¥è½¯ä»¶å®ç°ï¼š
</p>

<ul class="org-ul">
<li>ntp</li>
<li>chrony ï¼ˆcentos7+æ¨èä½¿ç”¨ï¼‰</li>
</ul>

<p>
<b>ntp</b> ï¼š
</p>

<p>
å°†ç³»ç»Ÿæ—¶é’Ÿå’Œä¸–ç•Œåè°ƒæ—¶UTCåŒæ­¥ï¼Œç²¾åº¦åœ¨å±€åŸŸç½‘å†…å¯è¾¾0.1msï¼Œåœ¨äº’è”ç½‘ä¸Šç»å¤§
å¤šæ•°çš„åœ°æ–¹ç²¾åº¦å¯ä»¥è¾¾åˆ°1-50ms
</p>

<p>
é¡¹ç›®å®˜ç½‘ï¼š<a href="http://www.ntp.org">http://www.ntp.org</a>
</p>

<p>
<b>chrony</b> ï¼š
</p>

<p>
å®ç°NTPåè®®çš„çš„è‡ªç”±è½¯ä»¶ã€‚å¯ä½¿ç³»ç»Ÿæ—¶é’Ÿä¸NTPæœåŠ¡å™¨ï¼Œå‚è€ƒæ—¶é’Ÿï¼ˆä¾‹å¦‚GPSæ¥
æ”¶å™¨ï¼‰ä»¥åŠä½¿ç”¨æ‰‹è¡¨å’Œé”®ç›˜çš„æ‰‹åŠ¨è¾“å…¥è¿›è¡ŒåŒæ­¥ã€‚è¿˜å¯ä»¥ä½œä¸ºNTPv4ï¼ˆRFC 5905ï¼‰
æœåŠ¡å™¨å’Œå¯¹ç­‰ä½“è¿è¡Œï¼Œä¸ºç½‘ç»œä¸­çš„è®¡ç®—æœºæä¾›æ—¶é—´æœåŠ¡ã€‚è®¾è®¡ç”¨äºåœ¨å„ç§æ¡ä»¶ä¸‹
è‰¯å¥½è¿è¡Œï¼ŒåŒ…æ‹¬é—´æ­‡æ€§å’Œé«˜åº¦æ‹¥æŒ¤çš„ç½‘ç»œè¿æ¥ï¼Œæ¸©åº¦å˜åŒ–ï¼ˆè®¡ç®—æœºæ—¶é’Ÿå¯¹æ¸©åº¦æ•
æ„Ÿï¼‰ï¼Œä»¥åŠä¸èƒ½è¿ç»­è¿è¡Œæˆ–åœ¨è™šæ‹Ÿæœºä¸Šè¿è¡Œçš„ç³»ç»Ÿã€‚
</p>

<p>
é€šè¿‡InternetåŒæ­¥çš„ä¸¤å°æœºå™¨ä¹‹é—´çš„å…¸å‹ç²¾åº¦åœ¨å‡ æ¯«ç§’ä¹‹å†…ï¼Œåœ¨LANä¸Šï¼Œç²¾åº¦é€š
å¸¸ä¸ºå‡ åå¾®ç§’ã€‚åˆ©ç”¨ç¡¬ä»¶æ—¶é—´æˆ³æˆ–ç¡¬ä»¶å‚è€ƒæ—¶é’Ÿï¼Œå¯å®ç°äºšå¾®ç§’çš„ç²¾åº¦
</p>
</div>
</div>
<div id="outline-container-h:1e48d0b0-d4e8-47aa-a111-10d63474db26" class="outline-3">
<h3 id="h:1e48d0b0-d4e8-47aa-a111-10d63474db26">NTP</h3>
<div class="outline-text-3" id="text-h:1e48d0b0-d4e8-47aa-a111-10d63474db26">
</div>
<div id="outline-container-h:0b6c70a7-cd4f-4386-9bd4-97f571bc6a0e" class="outline-4">
<h4 id="h:0b6c70a7-cd4f-4386-9bd4-97f571bc6a0e">NTPç®€ä»‹</h4>
<div class="outline-text-4" id="text-h:0b6c70a7-cd4f-4386-9bd4-97f571bc6a0e">
<p>
NTPï¼ˆNetwork Time Protocolï¼Œç½‘ç»œæ—¶é—´åè®®ï¼‰æ˜¯ç”¨æ¥ä½¿ç½‘ç»œä¸­çš„å„ä¸ªè®¡ç®—æœºæ—¶
é—´åŒæ­¥çš„ä¸€ç§åè®®ã€‚å®ƒçš„ç”¨é€”æ˜¯æŠŠè®¡ç®—æœºçš„æ—¶é’ŸåŒæ­¥åˆ°ä¸–ç•Œåè°ƒæ—¶UTCï¼Œå…¶ç²¾åº¦
åœ¨å±€åŸŸç½‘å†…å¯è¾¾0.1msï¼Œåœ¨äº’è”ç½‘ä¸Šç»å¤§å¤šæ•°çš„åœ°æ–¹å…¶ç²¾åº¦å¯ä»¥è¾¾åˆ°1-50msã€‚
</p>

<p>
NTPæœåŠ¡å™¨å°±æ˜¯åˆ©ç”¨NTPåè®®æä¾›æ—¶é—´åŒæ­¥æœåŠ¡
</p>

<p>
ç›¸å…³çš„å‘½ä»¤å’Œé…ç½®æ–‡ä»¶
</p>

<ul class="org-ul">
<li>/etc/ntp.conf: linuxå„ç‰ˆæœ¬è™½ç„¶ç›®å½•ä¸åŒï¼Œä½†æ–‡ä»¶åç›¸åŒã€‚å¯ä»¥ç”¨which
ntp.conf æˆ–è€…locate ntp.confæ¥æŸ¥æ‰¾ã€‚è¿™æ˜¯NTPå”¯ä¸€çš„ä¸€ä¸ªè®¾ç½®æ–‡ä»¶ã€‚</li>

<li><code>/usr/share/zoneinfo/</code> : è¿™ä¸ªé‡Œé¢è§„å®šäº†è¿™ä¸ªä¸»è¦æ—¶åŒºçš„æ—¶é—´è®¾ç½®æ–‡ä»¶ã€‚</li>

<li><p>
/etc/sysconfig/clock:è¿™ä¸ªæ–‡ä»¶æ˜¯linuxçš„ä¸»è¦æ—¶åŒºè®¾ç½®æ–‡ä»¶ï¼Œæ¯æ¬¡å¼€æœºå
linuxä¼šè‡ªåŠ¨è¯»å–è¿™ä¸ªæ–‡ä»¶æ¥è®¾ç½®ç³»ç»Ÿæ‰€é»˜è®¤çš„æ˜¾ç¤ºæ—¶é—´ï¼Œå¯ä»¥çœ‹çœ‹å®ƒé‡Œé¢åˆ°
åº•è®¾ç½®äº†ä»€ä¹ˆï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">cat /etc/sysconfig/clock
<span style="color: #b22222;"># </span><span style="color: #b22222;">The ZONE parameter is only evaluated by system-config-date.</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">The timezone of the system is defined by the contents of /etc/localtime.</span>
<span style="color: #a0522d;">ZONE</span>=<span style="color: #8b2252;">"Asia/Shanghai"</span>
<span style="color: #a0522d;">UTC</span>=true
<span style="color: #a0522d;">ARC</span>=false
</pre>
</div></li>

<li>/etc/localtime: æœ¬åœ°ç«¯æ—¶é—´é…ç½®æ–‡ä»¶ã€‚</li>

<li>/bin/date: è¿™ä¸ªæ˜¯æ—¶é—´çš„ä¿®æ”¹å‘½ä»¤ï¼Œé™¤äº†è¾“å‡ºæ—¶é—´ï¼Œè¿˜å¯ä»¥ä¿®æ”¹æ—¶é—´ã€‚</li>

<li>/sbin/hwclock:å› ä¸ºlinuxç³»ç»Ÿä¸Šé¢BIOSæ—¶é—´ä¸linuxç³»ç»Ÿæ—¶é—´æ˜¯åˆ†å¼€çš„ï¼Œæ‰€ä»¥
ä½¿ç”¨dateè¿™ä¸ªæŒ‡ä»¤è°ƒæ•´äº†æ—¶é—´ä¹‹åï¼Œè¿˜éœ€è¦ä½¿ç”¨hwclockæ‰èƒ½å°†ä¿®æ”¹è¿‡çš„æ—¶é—´
å†™å…¥BIOSä¸­ã€‚</li>

<li>/usr/sbin/ntpd:è¿™æ˜¯NTPçš„daemonæ–‡ä»¶ï¼Œéœ€è¦å¯åŠ¨å®ƒæ‰èƒ½æä¾›NTPæœåŠ¡ï¼Œè¿™ä¸ª
å‘½ä»¤ä¼šè¯»å–/etc/ntp.confé‡Œé¢çš„è®¾ç½®ã€‚</li>

<li>/usr/sbin/ntpdate: è¿™æ˜¯clientç”¨æ¥è¿æ¥NTP Serverçš„ä¸»è¦æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚æœ
æ‚¨ä¸æƒ³å¯ç”¨NTPï¼Œåªæƒ³å¯ç”¨NTP ClientåŠŸèƒ½çš„è¯ï¼Œå¯ä»¥åªåº”ç”¨æ­¤å‘½ä»¤ã€‚</li>

<li>/usr/sbin/ntptrace: å¯ä»¥ç”¨æ¥è¿½è¸ªæŸå°æ—¶é—´æœåŠ¡å™¨çš„æ—¶é—´å¯¹åº”å…³ç³»ã€‚</li>
</ul>
</div>
</div>
<div id="outline-container-h:9af21b86-1f21-4a17-8dd1-24f82c23ac1c" class="outline-4">
<h4 id="h:9af21b86-1f21-4a17-8dd1-24f82c23ac1c">NTPæœåŠ¡å™¨å®‰è£…</h4>
<div class="outline-text-4" id="text-h:9af21b86-1f21-4a17-8dd1-24f82c23ac1c">
<p>
ç³»ç»Ÿè‡ªå¸¦ntp
</p>

<div class="org-src-container">
<pre class="src src-sh">rpm -qa ntp
ntp-4.2.6p5-5.el6.centos.x86_64
&#22914;&#26524;&#27809;&#26377;&#23601;&#23433;&#35013;
yum -y install ntp
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ac174d22-e830-4a76-9c96-ba6f1f7cee4d" class="outline-4">
<h4 id="h:ac174d22-e830-4a76-9c96-ba6f1f7cee4d">é…ç½®NTPæœåŠ¡</h4>
<div class="outline-text-4" id="text-h:ac174d22-e830-4a76-9c96-ba6f1f7cee4d">
<div class="org-src-container">
<pre class="src src-sh">[root@o ~]# vim /etc/ntp.conf
<span style="color: #b22222;"># </span><span style="color: #b22222;">restrict default kod nomodify notrap nopeer noquery</span>
restrict default nomodify
<span style="color: #b22222;"># </span><span style="color: #b22222;">nomodify&#23458;&#25143;&#31471;&#21487;&#20197;&#21516;&#27493;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20801;&#35768;&#20869;&#32593;&#20854;&#20182;&#26426;&#22120;&#21516;&#27493;&#26102;&#38388;</span>
restrict 172.16.1.0 mask 255.255.255.0 nomodify notrap

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#23450;&#20041;&#20351;&#29992;&#30340;&#19978;&#28216; ntp&#26381;&#21153;&#22120;&#65292;&#23558;&#21407;&#26469;&#30340;&#27880;&#37322;</span>
server ntp1.aliyun.com
server time.nist.gov

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20801;&#35768;&#19978;&#23618;&#26102;&#38388;&#26381;&#21153;&#22120;&#20027;&#21160;&#20462;&#25913;&#26412;&#26426;&#26102;&#38388;</span>
restrict ntp1.aliyun.com  nomodify notrap noquery

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22806;&#37096;&#26102;&#38388;&#26381;&#21153;&#22120;&#19981;&#21487;&#29992;&#26102;&#65292;&#20197;&#26412;&#22320;&#26102;&#38388;&#20316;&#20026;&#26102;&#38388;&#26381;&#21153;</span>
server  127.127.1.0    
fudge   127.127.1.0 stratum 10

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35745;&#31639;&#26412;ntp server &#19982;&#19978;&#23618;ntpserver&#30340;&#39057;&#29575;&#35823;&#24046;</span>
driftfile /var/lib/ntp/drift

<span style="color: #b22222;"># </span><span style="color: #b22222;">Key file containing the keys and key identifiers used when operating</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">with symmetric key cryptography.</span>
keys /etc/ntp/keys

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26085;&#24535;&#25991;&#20214;</span>
logfile /var/log/ntp.log
</pre>
</div>

<p>
é…ç½®è¯´æ˜
</p>

<pre class="example" id="org904c788">
restrict [address] mask [netmask_ip] [parameter]

å…¶ä¸­parameterçš„å‚æ•°ä¸»è¦æœ‰ï¼š
ignore     ï¼š    æ‹’ç»æ‰€æœ‰ç±»å‹çš„ntpè¿æ¥
nomodify   ï¼š    å®¢æˆ·ç«¯ä¸èƒ½ä½¿ç”¨ntpcä¸ntpqä¸¤æ”¯ç¨‹å¼æ¥ä¿®æ”¹æœåŠ¡å™¨çš„æ—¶é—´å‚æ•°
noquery    ï¼š    å®¢æˆ·ç«¯ä¸èƒ½ä½¿ç”¨ntpqã€ntpcç­‰æŒ‡ä»¤æ¥æŸ¥è¯¢æœåŠ¡å™¨æ—¶é—´ï¼Œç­‰äºä¸æä¾›ntpçš„ç½‘ç»œæ ¡æ—¶
notrap     ï¼š    ä¸æä¾›trapè¿™ä¸ªè¿œç¨‹æ—¶é—´ç™»å½•çš„åŠŸèƒ½
notrust    ï¼š    æ‹’ç»æ²¡æœ‰è®¤è¯çš„å®¢æˆ·ç«¯
nopeer     ï¼š    ä¸ä¸å…¶ä»–åŒä¸€å±‚çš„ntpæœåŠ¡å™¨è¿›è¡Œæ—¶é—´åŒæ­¥
</pre>
</div>
</div>
<div id="outline-container-h:c2023251-279d-490d-a747-3a09df9713fc" class="outline-4">
<h4 id="h:c2023251-279d-490d-a747-3a09df9713fc">å¯åŠ¨NTPæœåŠ¡å™¨</h4>
<div class="outline-text-4" id="text-h:c2023251-279d-490d-a747-3a09df9713fc">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#35745;&#21010;&#20219;&#21153;&#26377;&#26102;&#38388;&#21516;&#27493;&#65292;&#20808;&#27880;&#37322;&#65292;&#20004;&#31181;&#29992;&#27861;&#20250;&#20914;&#31361;&#12290;</span>
[root@o ~]# crontab -e
<span style="color: #b22222;"># </span><span style="color: #b22222;">time sync</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">*/5 * * * * /usr/sbin/ntpdate time.nist.gov &gt;/dev/null 2&gt;&amp;1</span>
[root@o ~]# systemctl status ntpd
<span style="color: #b22222;">#</span><span style="color: #b22222;">/etc/init.d/ntpd start</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">/usr/sbin/ntpd -u ntp:ntp -g</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;ntp&#26381;&#21153;&#22120;&#19982;&#19978;&#23618;ntp&#26381;&#21153;&#22120;&#30340;&#29366;&#24577;:ntpq</span>
[root@o ~]# ntpq -p
remote refid st t when poll reach delay offset jitter
==============================================================================
*ntp1.aliyun.com 10.137.38.86 2 u 22 64 1 525.885 -42.367 0.000
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20854;&#20013;:</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">remote - &#26412;&#26426;&#21644;&#19978;&#23618;ntp&#30340;ip&#25110;&#20027;&#26426;&#21517;&#65292;&#8220;+&#8221;&#34920;&#31034;&#20248;&#20808;&#65292;&#8220;*&#8221;&#34920;&#31034;&#27425;&#20248;&#20808;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">refid  - &#21442;&#32771;&#19978;&#19968;&#23618;ntp&#20027;&#26426;&#22320;&#22336;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">st     - stratum&#38454;&#23618;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">when   - &#22810;&#23569;&#31186;&#21069;&#26366;&#32463;&#21516;&#27493;&#36807;&#26102;&#38388;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">poll   - &#19979;&#27425;&#26356;&#26032;&#22312;&#22810;&#23569;&#31186;&#21518;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">reach  - &#24050;&#32463;&#21521;&#19978;&#23618;ntp&#26381;&#21153;&#22120;&#35201;&#27714;&#26356;&#26032;&#30340;&#27425;&#25968;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">delay  - &#32593;&#32476;&#24310;&#36831;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">offset - &#26102;&#38388;&#34917;&#20607;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">jitter - &#31995;&#32479;&#26102;&#38388;&#19982;bios&#26102;&#38388;&#24046;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#25152;&#26377;&#36828;&#31243;&#26381;&#21153;&#22120;&#30340;jitter&#20540;&#26159;4000&#24182;&#19988;delay&#21644;reach&#30340;&#20540;&#26159;0&#65292;&#37027;&#20040;&#35828;&#26126;&#26102;&#38388;&#21516;&#27493;&#26159;&#26377;&#38382;&#39064;&#30340;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#33021;&#30340;&#21407;&#22240;&#26159;&#38450;&#28779;&#22681;&#38459;&#26029;&#20102;&#19982;server&#20043;&#38388;&#30340;&#36890;&#35759;&#65292;&#21363;123&#31471;&#21475;&#26159;&#21542;&#27491;&#24120;&#24320;&#25918;&#65307;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;ntp&#26381;&#21153;&#22120;&#26377;&#26080;&#21644;&#19978;&#23618;&#36830;&#36890;</span>
[root@o ~]# ntpstat
synchronised to NTP server (110.75.186.247) at stratum 3
<span style="color: #483d8b;">time</span> correct to within 4257 ms
polling server every 64 s

&#26597;&#30475;ntp&#26381;&#21153;&#22120;&#19982;&#19978;&#23618;&#38388;&#30340;&#32852;&#31995;:ntptrace
ntptrace -n 127.0.0.1

127.0.0.1: stratum 3, offset -0.001095, synch distance 0.532610
116.193.83.174: timed out, nothing received

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21516;&#27493;</span>
[root@o ~]# ntpdate 10.0.0.9
7 Dec 18:43:07 ntpdate[26950]: the NTP socket is<span style="color: #a020f0;"> in</span> use, exiting
ntpdate  time.windows.com
</pre>
</div>
</div>
</div>
<div id="outline-container-h:52fe2dd0-59b1-4db9-89fd-434db037c03c" class="outline-4">
<h4 id="h:52fe2dd0-59b1-4db9-89fd-434db037c03c">å®¢æˆ·æœºæ—¶é—´åŒæ­¥</h4>
<div class="outline-text-4" id="text-h:52fe2dd0-59b1-4db9-89fd-434db037c03c">
<p>
å®¢æˆ·æœºè¦ç­‰å‡ åˆ†é’Ÿå†ä¸æ–°å¯åŠ¨çš„ntpæœåŠ¡å™¨è¿›è¡Œæ—¶é—´åŒæ­¥ï¼Œå¦åˆ™ä¼šæç¤ºno server
suitable for synchronization foundé”™è¯¯ã€‚
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@zyops ~]# ntpdate 10.0.0.9
7 Dec 18:40:16 ntpdate[1453]: step time server 10.0.0.9 offset 40.880807 sec
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;&#21629;&#20196;&#25918;&#20837;&#35745;&#21010;&#20219;&#21153;&#21363;&#21487;&#12290;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:db2aaf16-f0fd-449f-bac8-3177e77e928e" class="outline-3">
<h3 id="h:db2aaf16-f0fd-449f-bac8-3177e77e928e">Chrony</h3>
<div class="outline-text-3" id="text-h:db2aaf16-f0fd-449f-bac8-3177e77e928e">
</div>
<div id="outline-container-h:2c08c084-9794-4b9c-9922-a07e021e4bb7" class="outline-4">
<h4 id="h:2c08c084-9794-4b9c-9922-a07e021e4bb7">Chronyä»‹ç»</h4>
<div class="outline-text-4" id="text-h:2c08c084-9794-4b9c-9922-a07e021e4bb7">
<p>
chrony çš„ä¼˜åŠ¿ï¼š
</p>

<ul class="org-ul">
<li>æ›´å¿«çš„åŒæ­¥åªéœ€è¦æ•°åˆ†é’Ÿè€Œéæ•°å°æ—¶æ—¶é—´ï¼Œä»è€Œæœ€å¤§ç¨‹åº¦å‡å°‘äº†æ—¶é—´å’Œé¢‘ç‡è¯¯
å·®ï¼Œå¯¹äºå¹¶éå…¨å¤©24å°æ—¶è¿è¡Œçš„è™šæ‹Ÿè®¡ç®—æœºè€Œè¨€éå¸¸æœ‰ç”¨</li>
<li>èƒ½å¤Ÿæ›´å¥½åœ°å“åº”æ—¶é’Ÿé¢‘ç‡çš„å¿«é€Ÿå˜åŒ–ï¼Œå¯¹äºå…·å¤‡ä¸ç¨³å®šæ—¶é’Ÿçš„è™šæ‹Ÿæœºæˆ–å¯¼è‡´æ—¶
é’Ÿé¢‘ç‡å‘ç”Ÿå˜åŒ–çš„èŠ‚èƒ½æŠ€æœ¯è€Œè¨€éå¸¸æœ‰ç”¨</li>
<li>åœ¨åˆå§‹åŒæ­¥åï¼Œå®ƒä¸ä¼šåœæ­¢æ—¶é’Ÿï¼Œä»¥é˜²å¯¹éœ€è¦ç³»ç»Ÿæ—¶é—´ä¿æŒå•è°ƒçš„åº”ç”¨ç¨‹åºé€ æˆå½±å“</li>
<li>åœ¨åº”å¯¹ä¸´æ—¶éå¯¹ç§°å»¶è¿Ÿæ—¶ï¼ˆä¾‹å¦‚ï¼Œåœ¨å¤§è§„æ¨¡ä¸‹è½½é€ æˆé“¾æ¥é¥±å’Œæ—¶ï¼‰æä¾›äº†æ›´å¥½çš„ç¨³å®šæ€§</li>
<li>æ— éœ€å¯¹æœåŠ¡å™¨è¿›è¡Œå®šæœŸè½®è¯¢ï¼Œå› æ­¤å…·å¤‡é—´æ­‡æ€§ç½‘ç»œè¿æ¥çš„ç³»ç»Ÿä»ç„¶å¯ä»¥å¿«é€ŸåŒæ­¥æ—¶é’Ÿ</li>
</ul>

<p>
chronyå®˜ç½‘ï¼š<a href="https://chrony.tuxfamily.org">https://chrony.tuxfamily.org</a>
</p>

<p>
chronyå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://chrony.tuxfamily.org/documentation.html">https://chrony.tuxfamily.org/documentation.html</a>
</p>

<p>
chronyä¸ntpéƒ½æ˜¯æ—¶é—´åŒæ­¥è½¯ä»¶
</p>

<p>
ä¸¤ä¸ªè½¯ä»¶ä¸èƒ½å¤ŸåŒæ—¶å¼€å¯ï¼Œä¼šå‡ºç°æ—¶é—´å†²çªã€‚å»ºè®®é…ç½®ntpè¾ƒä¸ºç®€å•ï¼Œä½¿ç”¨æ–¹ä¾¿ã€‚
</p>
</div>
</div>
<div id="outline-container-h:68595b80-7637-449a-8d5c-be25c18c4ff2" class="outline-4">
<h4 id="h:68595b80-7637-449a-8d5c-be25c18c4ff2">Chrony æ–‡ä»¶ç»„æˆ</h4>
<div class="outline-text-4" id="text-h:68595b80-7637-449a-8d5c-be25c18c4ff2">
<p>
åŒ…ï¼šchrony
</p>

<p>
ä¸¤ä¸ªä¸»è¦ç¨‹åºï¼šchronydå’Œchronyc
</p>

<ul class="org-ul">
<li>chronydï¼šåå°è¿è¡Œçš„å®ˆæŠ¤è¿›ç¨‹ï¼Œç”¨äºè°ƒæ•´å†…æ ¸ä¸­è¿è¡Œçš„ç³»ç»Ÿæ—¶é’Ÿå’Œæ—¶é’ŸæœåŠ¡
å™¨åŒæ­¥ã€‚å®ƒç¡®å®šè®¡ç®—æœºå¢å‡æ—¶é—´çš„æ¯”ç‡ï¼Œå¹¶å¯¹æ­¤è¿›è¡Œè¡¥å¿</li>
<li>chronycï¼šå‘½ä»¤è¡Œç”¨æˆ·å·¥å…·ï¼Œç”¨äºç›‘æ§æ€§èƒ½å¹¶è¿›è¡Œå¤šæ ·åŒ–çš„é…ç½®ã€‚å®ƒå¯ä»¥åœ¨
chronydå®ä¾‹æ§åˆ¶çš„è®¡ç®—æœºä¸Šå·¥ä½œï¼Œä¹Ÿå¯åœ¨ä¸€å°ä¸åŒçš„è¿œç¨‹è®¡ç®—æœºä¸Šå·¥ä½œ</li>
</ul>

<p>
æœåŠ¡unit æ–‡ä»¶ï¼š /usr/lib/systemd/system/chronyd.service
</p>

<p>
ç›‘å¬ç«¯å£ï¼š323/udpï¼Œ123/udp
</p>

<p>
é…ç½®æ–‡ä»¶ï¼š /etc/chrony.conf
</p>

<div class="org-src-container">
<pre class="src src-sh">yum install -y chrony
systemctl start chronyd.service
systemctl enable chronyd.service
</pre>
</div>
</div>
</div>
<div id="outline-container-h:f7747200-0b88-483b-8b4a-8a8d73fc0eef" class="outline-4">
<h4 id="h:f7747200-0b88-483b-8b4a-8a8d73fc0eef">é…ç½®æ–‡ä»¶chrony.conf</h4>
<div class="outline-text-4" id="text-h:f7747200-0b88-483b-8b4a-8a8d73fc0eef">
<p>
chronyæœåŠ¡ä½¿ç”¨çš„é…ç½®æ–‡ä»¶ä¸º/etc/chrony.confï¼Œå³å……å½“æœåŠ¡ç«¯å¯ä»¥å½“å®¢æˆ·ç«¯å…¶
é…ç½®å†…å®¹æ ¼å¼å’ŒntpdæœåŠ¡åŸºæœ¬ç›¸ä¼¼
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cat /etc/chrony.conf
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992;pool.ntp.org&#39033;&#30446;&#20013;&#30340;&#20844;&#20849;&#26381;&#21153;&#22120;&#12290;&#20197;server&#24320;&#65292;&#29702;&#35770;&#19978;&#20320;&#24819;&#28155;&#21152;&#22810;&#23569;&#26102;&#38388;&#26381;&#21153;&#22120;&#37117;&#21487;&#20197;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#26381;&#21153;&#31471;&#65292;&#25913;3&#22788; pool&#25110;server&#12289;allow&#12289;local</span>
pool ntp1.aliyun.com iburst
<span style="color: #b22222;">#</span><span style="color: #b22222;">server ntp1.aliyun.com iburst</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">pool &#35813;&#25351;&#20196;&#30340;&#35821;&#27861;&#19982;server &#25351;&#20196;&#30340;&#35821;&#27861;&#30456;&#20284;&#65292;&#19981;&#21516;&#20043;&#22788;&#22312;&#20110;&#65292;&#23427;&#29992;&#20110;&#25351;&#23450;NTP&#26381;&#21153;&#22120;&#27744;&#32780;&#19981;&#26159;&#21333;&#20010;NTP&#26381;&#21153;&#22120;&#12290;&#27744;&#21517;&#31216;&#24212;&#35299;&#26512;&#20026;&#21487;&#33021;&#38543;&#26102;&#38388;&#21464;&#21270;&#30340;&#22810;&#20010;&#22320;&#22336;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25351;&#23450;&#19968;&#21488;&#20027;&#26426;&#12289;&#23376;&#32593;&#65292;&#25110;&#32773;&#32593;&#32476;&#20197;&#20801;&#35768;&#25110;&#25298;&#32477;NTP&#36830;&#25509;&#21040;&#25198;&#28436;&#26102;&#38047;&#26381;&#21153;&#22120;&#30340;&#26426;&#22120;&#65292;&#30417;&#21548;&#22320;&#22336;&#21464;&#20026;0.0.0.0:123</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">allow 0.0.0.0/0</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">allow 192.168.0.0/16</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">deny 192.168/16</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22806;&#37096;&#26102;&#38388;&#26381;&#21153;&#22120;&#19981;&#21487;&#29992;&#26102;&#65292;&#20197;&#26412;&#22320;&#26102;&#38388;&#20316;&#20026;&#26102;&#38388;&#26381;&#21153;</span>
<span style="color: #483d8b;">local</span> stratum 10

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#23458;&#25143;&#31471;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">server ntp1.aliyun.com iburst</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">pool ntp1.aliyun.com iburst</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">----------&#19979;&#38754;&#37197;&#32622;&#19968;&#33324;&#19981;&#29992;&#25913;&#21160;------------------------</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26681;&#25454;&#23454;&#38469;&#26102;&#38388;&#35745;&#31639;&#20986;&#26381;&#21153;&#22120;&#22686;&#20943;&#26102;&#38388;&#30340;&#27604;&#29575;&#65292;&#28982;&#21518;&#35760;&#24405;&#21040;&#19968;&#20010;&#25991;&#20214;&#20013;&#65292;&#22312;&#31995;&#32479;&#37325;&#21551;&#21518;&#20026;&#31995;&#32479;&#20570;&#20986;&#26368;&#20339;&#26102;&#38388;&#34917;&#20607;&#35843;&#25972;&#12290;</span>
driftfile /var/lib/chrony/drift

<span style="color: #b22222;"># </span><span style="color: #b22222;">chronyd&#26681;&#25454;&#38656;&#27714;&#20943;&#24930;&#25110;&#21152;&#36895;&#26102;&#38388;&#35843;&#25972;&#65292;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312;&#26576;&#20123;&#24773;&#20917;&#19979;&#31995;&#32479;&#26102;&#38047;&#21487;&#33021;&#28418;&#31227;&#36807;&#24555;&#65292;&#23548;&#33268;&#26102;&#38388;&#35843;&#25972;&#29992;&#26102;&#36807;&#38271;&#12290;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35813;&#25351;&#20196;&#24378;&#21046;chronyd&#35843;&#25972;&#26102;&#26399;&#65292;&#22823;&#20110;&#26576;&#20010;&#38400;&#20540;&#26102;&#27493;&#36827;&#35843;&#25972;&#31995;&#32479;&#26102;&#38047;&#12290;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#26377;&#22312;&#22240;chronyd&#21551;&#21160;&#26102;&#38388;&#36229;&#36807;&#25351;&#23450;&#30340;&#38480;&#21046;&#26102;&#65288;&#21487;&#20351;&#29992;&#36127;&#20540;&#26469;&#31105;&#29992;&#38480;&#21046;&#65289;&#27809;&#26377;&#26356;&#22810;&#26102;&#38047;&#26356;&#26032;&#26102;&#25165;&#29983;&#25928;&#12290;</span>
makestep 1.0 3

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;&#21551;&#29992;&#19968;&#20010;&#20869;&#26680;&#27169;&#24335;&#65292;&#22312;&#35813;&#27169;&#24335;&#20013;&#65292;&#31995;&#32479;&#26102;&#38388;&#27599;11&#20998;&#38047;&#20250;&#25335;&#36125;&#21040;&#23454;&#26102;&#26102;&#38047;&#65288;RTC&#65289;&#12290;</span>
rtcsync

<span style="color: #b22222;"># </span><span style="color: #b22222;">Enable hardware timestamping on all interfaces that support it.</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36890;&#36807;&#20351;&#29992;hwtimestamp&#25351;&#20196;&#21551;&#29992;&#30828;&#20214;&#26102;&#38388;&#25139;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">hwtimestamp eth0</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">hwtimestamp eth1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">hwtimestamp *</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">Increase the minimum number of selectable sources required to adjust</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">the system clock.</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">minsources 2</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25351;&#23450;&#19968;&#21488;&#20027;&#26426;&#12289;&#23376;&#32593;&#65292;&#25110;&#32773;&#32593;&#32476;&#20197;&#20801;&#35768;&#25110;&#25298;&#32477;NTP&#36830;&#25509;&#21040;&#25198;&#28436;&#26102;&#38047;&#26381;&#21153;&#22120;&#30340;&#26426;&#22120;&#65292;&#30417;&#21548;&#22320;&#22336;&#21464;&#20026;0.0.0.0:123</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">allow 0.0.0.0/16</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">allow 192.168.0.0/16</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">deny 192.168/16</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22806;&#37096;&#26102;&#38388;&#26381;&#21153;&#22120;&#19981;&#21487;&#29992;&#26102;&#65292;&#20197;&#26412;&#22320;&#26102;&#38388;&#20316;&#20026;&#26102;&#38388;&#26381;&#21153;</span>
<span style="color: #483d8b;">local</span> stratum 10

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25351;&#23450;&#21253;&#21547;NTP&#39564;&#35777;&#23494;&#38053;&#30340;&#25991;&#20214;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">keyfile /etc/chrony.keys</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25351;&#23450;&#26085;&#24535;&#25991;&#20214;&#30340;&#30446;&#24405;&#12290;</span>
logdir /var/log/chrony
</pre>
</div>

<p>
<b>å‚æ•°è¯´æ˜</b>
</p>

<pre class="example" id="org6048995">
server - å¯ç”¨äºæ—¶é’ŸæœåŠ¡å™¨ï¼Œiburst é€‰é¡¹å½“æœåŠ¡å™¨å¯è¾¾æ—¶ï¼Œå‘é€ä¸€ä¸ªå…«ä¸ªæ•°æ®åŒ…è€Œä¸æ˜¯é€šå¸¸çš„ä¸€ä¸ªæ•°æ®åŒ…ã€‚ åŒ…é—´éš”é€šå¸¸ä¸º2ç§’,å¯åŠ å¿«åˆå§‹åŒæ­¥é€Ÿåº¦
driftfile - æ ¹æ®å®é™…æ—¶é—´è®¡ç®—å‡ºè®¡ç®—æœºå¢å‡æ—¶é—´çš„æ¯”ç‡ï¼Œå°†å®ƒè®°å½•åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¼šåœ¨é‡å¯åä¸ºç³»ç»Ÿæ—¶é’Ÿä½œå‡ºè¡¥å¿
rtcsync - å¯ç”¨å†…æ ¸æ¨¡å¼ï¼Œç³»ç»Ÿæ—¶é—´æ¯11åˆ†é’Ÿä¼šæ‹·è´åˆ°å®æ—¶æ—¶é’Ÿï¼ˆRTCï¼‰
allow / deny - æŒ‡å®šä¸€å°ä¸»æœºã€å­ç½‘ï¼Œæˆ–è€…ç½‘ç»œä»¥å…è®¸æˆ–æ‹’ç»è®¿é—®æœ¬æœåŠ¡å™¨
cmdallow / cmddeny - å¯ä»¥æŒ‡å®šå“ªå°ä¸»æœºå¯ä»¥é€šè¿‡chronydä½¿ç”¨æ§åˆ¶å‘½ä»¤
bindcmdaddress - å…è®¸chronydç›‘å¬å“ªä¸ªæ¥å£æ¥æ¥æ”¶ç”±chronycæ‰§è¡Œçš„å‘½ä»¤
makestep - é€šå¸¸chronydå°†æ ¹æ®éœ€æ±‚é€šè¿‡å‡æ…¢æˆ–åŠ é€Ÿæ—¶é’Ÿï¼Œä½¿å¾—ç³»ç»Ÿé€æ­¥çº æ­£æ‰€æœ‰æ—¶é—´åå·®ã€‚åœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹ï¼Œç³»ç»Ÿæ—¶é’Ÿå¯èƒ½ä¼šæ¼‚ç§»è¿‡å¿«ï¼Œå¯¼è‡´è¯¥è°ƒæ•´è¿‡ç¨‹æ¶ˆè€—å¾ˆé•¿çš„æ—¶é—´æ¥çº æ­£ç³»ç»Ÿæ—¶é’Ÿã€‚è¯¥æŒ‡ä»¤å¼ºåˆ¶chronydåœ¨è°ƒæ•´æœŸå¤§äºæŸä¸ªé˜€å€¼æ—¶è°ƒæ•´ç³»ç»Ÿæ—¶é’Ÿ
local stratum 10 - å³ä½¿serveræŒ‡ä»¤ä¸­æ—¶é—´æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œä¹Ÿå…è®¸å°†æœ¬åœ°æ—¶é—´ä½œä¸ºæ ‡å‡†æ—¶é—´æˆæ—¶ç»™å…¶å®ƒå®¢æˆ·ç«¯
stratumweight æŒ‡ä»¤è®¾ç½®å½“chronydä»å¯ç”¨æºä¸­é€‰æ‹©åŒæ­¥æºæ—¶ï¼Œæ¯ä¸ªå±‚åº”è¯¥æ·»åŠ å¤šå°‘è·ç¦»åˆ°åŒæ­¥è·ç¦»ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCentOSä¸­è®¾ç½®ä¸º0ï¼Œè®©chronydåœ¨é€‰æ‹©æºæ—¶å¿½ç•¥æºçš„å±‚çº§
</pre>
</div>
</div>
<div id="outline-container-h:9cb41dab-6721-4df9-996d-84439649ddc5" class="outline-4">
<h4 id="h:9cb41dab-6721-4df9-996d-84439649ddc5">Chronyc å‘½ä»¤</h4>
<div class="outline-text-4" id="text-h:9cb41dab-6721-4df9-996d-84439649ddc5">
<p>
chronyc å¯ä»¥è¿è¡Œåœ¨äº¤äº’å¼å’Œéäº¤äº’å¼ä¸¤ç§æ–¹å¼ï¼Œæ”¯æŒä»¥ä¸‹å­å‘½ä»¤
</p>

<pre class="example" id="org5d32b6d">
help å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ›´å¤šchronycçš„äº¤äº’å‘½ä»¤
accheck æ£€æŸ¥æ˜¯å¦å¯¹ç‰¹å®šä¸»æœºå¯è®¿é—®å½“å‰æœåŠ¡å™¨
activity æ˜¾ç¤ºæœ‰å¤šå°‘NTPæºåœ¨çº¿/ç¦»çº¿
sources [-v] æ˜¾ç¤ºå½“å‰æ—¶é—´æºçš„åŒæ­¥ä¿¡æ¯
sourcestats [-v]æ˜¾ç¤ºå½“å‰æ—¶é—´æºçš„åŒæ­¥ç»Ÿè®¡ä¿¡æ¯
add server æ‰‹åŠ¨æ·»åŠ ä¸€å°æ–°çš„NTPæœåŠ¡å™¨
clients æŠ¥å‘Šå·²è®¿é—®æœ¬æœåŠ¡å™¨çš„å®¢æˆ·ç«¯åˆ—è¡¨
delete æ‰‹åŠ¨ç§»é™¤NTPæœåŠ¡å™¨æˆ–å¯¹ç­‰æœåŠ¡å™¨
settime æ‰‹åŠ¨è®¾ç½®å®ˆæŠ¤è¿›ç¨‹æ—¶é—´
tracking æ˜¾ç¤ºç³»ç»Ÿæ—¶é—´ä¿¡æ¯
</pre>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;&#26102;&#38388;&#21516;&#27493;&#28304;&#65306;</span>
chronyc sources -v
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;&#26102;&#38388;&#21516;&#27493;&#28304;&#29366;&#24577;&#65306;</span>
chronyc sourcestats -v

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622;&#30828;&#20214;&#26102;&#38388;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#30828;&#20214;&#26102;&#38388;&#40664;&#35748;&#20026;UTC&#65306;</span>
timedatectl set-local-rtc 1

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21551;&#29992;NTP&#26102;&#38388;&#21516;&#27493;&#65306;</span>
timedatectl set-ntp yes

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26657;&#20934;&#26102;&#38388;&#26381;&#21153;&#22120;&#65306;</span>
chronyc tracking
</pre>
</div>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-sh">[root@centos8 ~]#chronyc 
chrony version 3.5
<span style="color: #0000ff;">Copyright</span> (C) 1997-2003, 2007, 2009-2019 Richard P. Curnow and others
chrony comes with ABSOLUTELY NO WARRANTY.  This is free software, and
you are welcome to redistribute it under certain conditions.  See the
GNU General Public License version 2 for details.

chronyc&gt; clients
Hostname                      NTP   Drop Int IntL Last     Cmd   Drop Int  Last
===============================================================================
10.0.0.77                       4      0   1   -  118m       0      0   -     -
chronyc&gt; activity
200 OK
2 sources online
0 sources offline
0 sources doing burst (<span style="color: #a020f0;">return</span> to online)
0 sources doing burst (<span style="color: #a020f0;">return</span> to offline)
0 sources with unknown address
chronyc&gt; sources -v
210 Number of <span style="color: #a0522d;">sources</span> = 2

  .-- Source mode  <span style="color: #8b2252;">'^'</span> = server, <span style="color: #8b2252;">'='</span> = peer, <span style="color: #8b2252;">'#'</span> = local clock.
 / .- Source state <span style="color: #8b2252;">'*'</span> = current synced, <span style="color: #8b2252;">'+'</span> = combined , <span style="color: #8b2252;">'-'</span> = not combined,
| /   <span style="color: #8b2252;">'?'</span> = unreachable, <span style="color: #8b2252;">'x'</span> = time may be<span style="color: #a020f0;"> in</span> error, <span style="color: #8b2252;">'~'</span> = time too variable.
||                                                 .- xxxx [ yyyy ] +/- zzzz
||      Reachability register (octal) -.           |  <span style="color: #a0522d;">xxxx</span> = adjusted offset,
||      Log2(Polling interval) --.      |          |  <span style="color: #a0522d;">yyyy</span> = measured offset,
||                                <span style="color: #8b2252;">\ </span>    |          |  <span style="color: #a0522d;">zzzz</span> = estimated error.
||                                 |    |           <span style="color: #8b2252;">\</span>
MS Name/IP address         Stratum Poll Reach LastRx Last sample               
===============================================================================
^+ 203.107.6.88                  2   6   377    60  +3649us[+3649us] +/-   28ms
^* 120.25.115.20                 2   6   377    62  +5670us[-1041ms] +/-   27ms
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a4fb5076-6704-47ec-b0af-8ed2355f86fc" class="outline-4">
<h4 id="h:a4fb5076-6704-47ec-b0af-8ed2355f86fc">å…¬å…±NTPæœåŠ¡</h4>
<div class="outline-text-4" id="text-h:a4fb5076-6704-47ec-b0af-8ed2355f86fc">
<ul class="org-ul">
<li>pool.ntp.orgï¼šé¡¹ç›®æ˜¯ä¸€ä¸ªæä¾›å¯é æ˜“ç”¨çš„NTPæœåŠ¡çš„è™šæ‹Ÿé›†ç¾¤
cn.pool.ntp.orgï¼Œ0-3.cn.pool.ntp.org</li>

<li><p>
é˜¿é‡Œäº‘å…¬å…±NTPæœåŠ¡å™¨
</p>

<p>
Unix/linuxç±»ï¼šntp.aliyun.comï¼Œntp1-7.aliyun.com
</p>

<p>
windowsç±»ï¼š time.pool.aliyun.comå’Œ time.nist.gov
</p>

<p>
Mac OS X ä¸Šè‡ªå¸¦çš„ä¿©ä¸ªï¼štime.apple.com å’Œ time.asia.apple.com
</p></li>

<li><p>
å¤§å­¦ntpæœåŠ¡
</p>

<p>
s1a.time.edu.cn åŒ—äº¬é‚®ç”µå¤§å­¦
</p>

<p>
s1b.time.edu.cn æ¸…åå¤§å­¦
</p>

<p>
s1c.time.edu.cn åŒ—äº¬å¤§å­¦
</p></li>

<li>å›½å®¶æˆæ—¶ä¸­å¿ƒæœåŠ¡å™¨ï¼š210.72.145.44</li>
</ul>
</div>
</div>
<div id="outline-container-h:f7300e0a-b7a4-4f0b-b1c9-7a1e84494e82" class="outline-4">
<h4 id="h:f7300e0a-b7a4-4f0b-b1c9-7a1e84494e82">æ—¶é—´å·¥å…·</h4>
<div class="outline-text-4" id="text-h:f7300e0a-b7a4-4f0b-b1c9-7a1e84494e82">
<ul class="org-ul">
<li>timedatectl æ—¶é—´å’Œæ—¶åŒºç®¡ç†</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;&#26085;&#26399;&#26102;&#38388;&#12289;&#26102;&#21306;&#21450;NTP&#29366;&#24577;&#65306;</span>
timedatectl
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;&#26102;&#21306;&#21015;&#34920;&#65306;</span>
timedatectl list-timezones
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;&#26102;&#21306;&#65306;</span>
timedatectl set-timezone Asia/Shanghai

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#23436;&#26102;&#21306;&#21518;&#65292;&#24378;&#21046;&#21516;&#27493;&#19979;&#31995;&#32479;&#26102;&#38047;&#65306;</span>
chronyc -a makestep

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;&#26085;&#26399;&#26102;&#38388;&#65306;</span>
timedatectl set-time <span style="color: #8b2252;">"2017-01-23 10:30:00"</span>&#65288;&#21487;&#20197;&#21482;&#20462;&#25913;&#20854;&#20013;&#19968;&#20010;&#65289;
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#24320;&#21551;NTP&#65306; </span>
timedatectl set-ntp true/false

timedatectl set-timezone UTC <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;&#26412;&#22320;&#26102;&#21306;&#35774;&#32622;&#20026;&#21327;&#35843;&#19990;&#30028;&#26102;&#65288;UTC&#65289;</span>
</pre>
</div>

<ul class="org-ul">
<li>ntpdate æ—¶é—´åŒæ­¥å‘½ä»¤</li>
<li>system-config-dateï¼šå›¾å½¢åŒ–é…ç½®chronyæœåŠ¡çš„å·¥å…·</li>
</ul>

<p>
æ—¶åŒºï¼š
</p>

<p>
é…ç½®æ–‡ä»¶ï¼š/etc/localtime
</p>

<p>
æ—¶åŒºåˆ—è¡¨ç›®å½•ï¼š/usr/share/zoneinfo/
</p>

<p>
èŒƒä¾‹
</p>

<div class="org-src-container">
<pre class="src src-sh">yum install -y chrony
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37197;&#32622;</span>
cat&gt;/etc/chrony.conf&lt;&lt;EOF
<span style="color: #ffa54f;">server ntp1.aliyun.com iburst minpoll 4 maxpoll 10</span>
<span style="color: #ffa54f;">server cn.pool.ntp.org iburst minpoll 4 maxpoll 10</span>
<span style="color: #ffa54f;">server s1b.time.edu.cn iburst minpoll 4 maxpoll 10</span>
<span style="color: #ffa54f;">stratumweight 0</span>
<span style="color: #ffa54f;">driftfile /var/lib/chrony/chrony.drift</span>
<span style="color: #ffa54f;">rtcsync</span>
<span style="color: #ffa54f;">makestep 1.0 3</span>
<span style="color: #ffa54f;">bindcmdaddress 127.0.0.1</span>
<span style="color: #ffa54f;">keyfile /etc/chrony/chrony.keys</span>
<span style="color: #ffa54f;">logdir /var/log/chrony</span>
<span style="color: #ffa54f;">logchange 1</span>
<span style="color: #ffa54f;">EOF</span>

systemctl start chronyd.service
systemctl enable chronyd.service
timedatectl set-timezone Asia/Shanghai <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;&#26102;&#21306;</span>
chronyc -a makestep <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24378;&#21046;&#21516;&#27493;&#19979;&#31995;&#32479;&#26102;&#38047;</span>
timedatectl set-ntp yes <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#29992;NTP&#26102;&#38388;&#21516;&#27493;</span>
</pre>
</div>
</div>
</div>
</div>
</section>
</main class="container">
<footer id="postamble" class="status">
<footer data-astro-cid-sz7xmlte data-turbo-permanent id=rootFooter>
    <script>
        const shuffle = e => e.map((e => ({
            v: e,
            sort: Math.random()
        }))).sort(( (e, o) => e.sort - o.sort)).map(( ({v: e}) => e));
        var songList = ["barbie-girl--stantough", "blue-da-ba-dee--cornelius-link", "hips-dont-lie--stantough", "i-want-it-that-way--stantough", "seven-nation-army--stantough", "smooth-criminal--stantough"]
          , songOrder = songOrder ?? shuffle(songList).map((e => `/audio/music/${e}.opus`))
          , song = new Audio(songOrder[0])
          , nextSong = new Audio(songOrder[1])
          , songIndex = 2
          , musicWrapper = void 0
          , arrow = void 0
          , notes = void 0;
        song.addEventListener("ended", next);
        const toggle = () => song.paused ? play() : pause();
        function play() {
            song.play(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.add("shakeManHorse"),
            notes.classList.remove("hideNotes")
        }
        function pause() {
            song.pause(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.remove("shakeManHorse"),
            notes.classList.add("hideNotes")
        }
        function next() {
            song = nextSong,
            play(),
            songIndex === songOrder.length && (songIndex = 0),
            nextSong = new Audio(songOrder[songIndex]),
            songIndex += 1
        }
        function skip() {
            pause(),
            (arrow = arrow || document.getElementById("musicArrow")).classList.add("shootArrow");
            new Audio("/audio/effects/ohno.m4a").play(),
            arrow.addEventListener("animationend", arrowShootHandler, !1)
        }
        function arrowShootHandler() {
            arrow.removeEventListener("animationend", arrowShootHandler, !1),
            arrow.classList.remove("shootArrow");
            new Audio("/audio/effects/heythathurt.m4a").play(),
            next()
        }
    </script>
    <div id=musicPlayer data-astro-cid-q7a5pyro>
        <button class=skip data-astro-cid-q7a5pyro onclick=skip() title="Skip song">
            <div id=skipWrapper data-astro-cid-q7a5pyro>
                <img alt="Medieval drollery of a man/snail/bat/monkey shooting an arrow" class=archer decoding=async height=334 loading=lazy src=/images/archer-no-arrow.448ccd8b_Z1KfRYq.webp width=226 data-astro-cid-q7a5pyro>
                <img alt="Arrow for archer" class="arrow complete" decoding=async height=23 loading=lazy src=/images/no-archer-full-arrow.87aa9971_Z2qL2KO.webp width=141 data-astro-cid-q7a5pyro id=musicArrow>
            </div>
        </button>
        <button class=playPause data-astro-cid-q7a5pyro onclick=toggle() title="Play/pause song">
            <div id=musicWrapper data-astro-cid-q7a5pyro>
                <div class=hideNotes id=notesWrapper data-astro-cid-q7a5pyro>
                    <div class=lyreNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                    <div class=fluteNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                </div>
                <img alt="Medieval drollery of a man/horse playing a lyre and a horn" class=manHorse decoding=async height=665 loading=lazy src=/images/man-horse-band.e3a2efcf_q8FCa.webp width=531 data-astro-cid-q7a5pyro>
            </div>
        </button>
    </div>
    <hr data-astro-cid-sz7xmlte>
    <div class=salutation data-astro-cid-gdmrbrho>
        <p data-astro-cid-gdmrbrho>
            <span class=flower2 data-astro-cid-gdmrbrho>A</span>
            <span class=smallcap data-astro-cid-gdmrbrho>pax vobiscum</span>
            <span class="flower2 wiggle" data-astro-cid-gdmrbrho id=leaf>a</span>
        </p>
    </div>
    <script>
        function animateLeafBlownHandler() {
            leaf.removeEventListener("animationend", animateLeafBlownHandler, !1),
            leaf.classList.remove("blownAway"),
            leaf.classList.add("wiggle")
        }
        function animateLeaf() {
            leaf = leaf ?? document.getElementById("leaf"),
            leaf.classList.remove("wiggle"),
            leaf.classList.add("blownAway"),
            leaf.addEventListener("animationend", animateLeafBlownHandler, !1)
        }
        document.getElementById("leaf").onclick = animateLeaf
    </script>


    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>æ‰“èµ</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Â© 2024 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
</footer>
</footer>
</body>
</html>
