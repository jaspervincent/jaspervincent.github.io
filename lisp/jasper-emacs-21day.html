<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>我的 Emacs 配置</title>
<meta name="author" content="Jasper Hsu" />
<meta name="generator" content="Org Mode" />
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<!-- from -->
<!--
<style>#back-to-top{background:#000;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;bottom:20px;-webkit-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);-moz-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);box-shadow:0 2px 5px 0 rgba(0,0,0,.26);color:#fff;cursor:pointer;display:block;height:56px;opacity:1;outline:0;position:fixed;right:20px;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-transition:bottom .2s,opacity .2s;-o-transition:bottom .2s,opacity .2s;-moz-transition:bottom .2s,opacity .2s;transition:bottom .2s,opacity .2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:56px;z-index:1}#back-to-top svg{display:block;fill:currentColor;height:24px;margin:16px auto 0;width:24px}#back-to-top.hidden{bottom:-56px;opacity:0}</style>
-->
<link rel="stylesheet" href="/static/aandds.com/css/main.css">
<link rel="stylesheet" href="/static/aandds.com/css/drollery.min.css">
<script type="text/javascript" src="/static/aandds.com/js/main.js"></script>
<!--
<script id="MathJax-script" async="" src="/static/aandds.com/js/mathjax.js"></script>

<script type="text/javascript" src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
-->
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">我的 Emacs 配置</h1>
</header><p>
<b>最后修改时间 2025-06-07 03:55:07 +0800  23922字.</b>
</p>


<p>
在Org文件里，写好了代码块，保存文件的时候，Org mode是不会帮你自动写入文件的（未来我们可以通过配置实现），现在，我们需要通过  <code>C-c C-v C-t</code> or <code>M-x org-babel-tangle</code> 命令来触发 tangle 这个动作。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(org-babel-tangle)
</pre>
</div>

<p>
xx.el 已经写好了，但并没有生效，需要重启一下Emacs，让Emacs重新加载这个配置文件，才会生效。
</p>

<p>
<b>elisp代码执行</b> :
</p>
<ul class="org-ul">
<li><code>C-x C-e</code> ： <code>eval-last-sexp</code> 这是最常用的，每次都要移动光标到要运行的代码后面。</li>
<li><code>M-x eval-region</code> ：执行选中区域代码</li>
<li><code>M-x eval-buffer</code> ：执行当前缓冲区代码</li>
<li><code>M-x load-file &lt;ENTER&gt; FILE_NAME</code> ：执行指定文件代码</li>
<li><code>C-j</code> : 执行最近距离代码，并打印输出以当前位置</li>
<li><code>C-M-x</code> : runs the command eval-defun 执行整个代码块。写函数经常修改
然后运行，如果每次跑到最外面去 <code>C-x C-e</code> ，就很麻烦。光标只要在运行的代码块里就行了。</li>
<li><code>M-:</code> : runs the command eval-expression</li>
<li><code>M-x ielm</code> 类似于ipython交互式运行</li>
</ul>

<p>
文本编辑：
</p>
<ul class="org-ul">
<li><code>C-x C-s</code> 文件保存</li>
</ul>


<ul class="org-ul">
<li>Website: <a href="https://xuchangwei.com/lisp/jasper-emacs.html">https://xuchangwei.com/lisp/jasper-emacs.html</a></li>
<li>Git repositories:
<ul class="org-ul">
<li>GitHub: <a href="https://github.com/jaspervincent/dotfiles">https://github.com/jaspervincent/dotfiles</a></li>
</ul></li>
</ul>

<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:b17d4463-f9b0-43e7-b543-67b9a130db2e">1. <code>init.el</code> (学习)</a>
<ul>
<li><a href="#h:0e90d45f-f8d6-4b1e-b32a-143e762454e8">1.1. 安装</a>
<ul>
<li><a href="#h:f9b3ea3c-a220-4130-9b15-7f85c2037540">1.1.1. 二进制安装</a></li>
<li><a href="#h:04da44fe-12b5-4de9-afc1-126ff7ecfc15">1.1.2. 源码安装</a></li>
</ul>
</li>
<li><a href="#h:learn-key">1.2. 改键</a></li>
<li><a href="#h:b8400296-41de-4401-98c6-094756c3ee53">1.3. 常用配置</a></li>
<li><a href="#h:4a222504-05b5-4a0d-80ab-6cd04ee213a5">1.4. 关于 lexical binding</a></li>
<li><a href="#h:ef17a11a-df61-41c6-8bbd-8d92766b4273">1.5. 插件源</a></li>
<li><a href="#h:6483447a-d63f-42b0-8c5c-48eebe7d352c">1.6. 安装补全插件</a></li>
<li><a href="#h:a10e6f11-2517-4c48-bcb7-5ee139fa2a2c">1.7. 手工安装插件</a></li>
<li><a href="#h:7d42306d-1ba7-468d-b67d-0d2e1894535e">1.8. 其他小配置</a></li>
<li><a href="#h:2ecf5bf5-4f3f-4ac9-8483-ff26c87b2382">1.9. Emacs作为超级前端</a>
<ul>
<li><a href="#h:learn-funcs-front-explorer">1.9.1. 使用 Emacs 来打开文件管理器</a></li>
<li><a href="#h:learn-completion-minibuffer-4-1">1.9.2. 增强 embark 和 consult，批量搜索替换大杀器</a></li>
<li><a href="#h:learn-tools-search-pinyin">1.9.3. 使用拼音进行搜索</a></li>
<li><a href="#h:342e2bb3-0963-4047-bbfe-9949e17d186c">1.9.4. 更换主题</a></li>
</ul>
</li>
<li><a href="#h:78e61272-d6f7-45f9-aeca-948b68f16d02">1.10. 模块化配置</a>
<ul>
<li><a href="#h:dcefc61f-9fbc-4c17-b9c6-043b131b3437">1.10.1. 使用多文件存储配置文件</a></li>
<li><a href="#h:cb5979bf-baeb-48b0-abd7-0f54495dd006">1.10.2. 使用Org-mode 管理 Emacs 配置</a></li>
</ul>
</li>
<li><a href="#h:0ef565c4-904d-4863-9c8b-7462407b2659">1.11. 模块列表</a></li>
<li><a href="#h:ce61a582-6604-448b-8fe4-087ecd41e650">1.12. 清理学习内容</a></li>
</ul>
</li>
<li><a href="#h:680e1564-f032-4677-acdf-1d64b017cdc0">2. Emacs初始化 <code>early-init.el</code></a>
<ul>
<li><a href="#h:d5de6908-9c6e-4fdd-8d06-4059f170abfd">2.1. <code>early-init.el</code> 对启动时间和垃圾回收的调整</a></li>
<li><a href="#h:package-cache">2.2. <code>early-init.el</code> 初始化包缓存</a></li>
</ul>
</li>
<li><a href="#h:84a797ae-9cef-4eb4-8144-4423d96d57d7">3. Emacs主配置文件 (<code>init.el</code>)</a>
<ul>
<li><a href="#h:b5675d8d-07b5-4cc1-bb53-2e13d63c652d">3.1. <code>init.el</code> 加载前自定义配置</a>
<ul>
<li><a href="#h:307ea5c9-d0cb-4458-8c72-fe27e44a52ba">3.1.1. <code>init.el</code> 判断操作系统</a></li>
</ul>
</li>
<li><a href="#h:8a5ac6bd-d9f2-43f8-b0a4-64c758a747aa">3.2. <code>init.el</code> 基础配置禁用备份和锁定文件</a></li>
<li><a href="#h:10a19e0f-2d8a-4e63-b394-f8eadd628aea">3.3. <code>init.el</code> 指定自定义文件 custom.el</a></li>
<li><a href="#h:fdc495f8-e664-4284-a21d-bd34d0c39823">3.4. <code>init.el</code> 始终从 <code>*scratch*</code> 缓冲区开始</a></li>
<li><a href="#h:i-dir">3.5. <code>init.el</code> 加载目录</a></li>
<li><a href="#h:package.el">3.6. <code>init.el</code> 软件包 (<code>package.el</code>)</a>
<ul>
<li><a href="#h:4e302b04-678d-492a-941e-5cc805b8f8a2">3.6.1. <code>init.el</code> use-pacakge 插件</a></li>
</ul>
</li>
<li><a href="#h:i-modules">3.7. <code>init.el</code> 加载各个模块</a></li>
<li><a href="#h:048fe6a9-b02a-46fd-8907-78c8c3366234">3.8. <code>init.el</code> 计算启动时间</a></li>
</ul>
</li>
<li><a href="#h:modules">4. 我的Emacs模块配置(<code>lisp/</code>)</a>
<ul>
<li><a href="#h:20c90145-9293-4c6e-9ac5-7cd73353ed70">4.1. <code>init-packages.el</code></a>
<ul>
<li><a href="#h:packages-quelpa">4.1.1. <code>init-packages.el</code> 安装 quelpa 插件</a></li>
<li><a href="#h:packages-vc">4.1.2. <code>ini-package.el</code> vc <code>package-vc.el</code></a></li>
</ul>
</li>
<li><a href="#h:1a9f33d6-5ff3-4048-872d-80243061b6cb">4.2. <code>init-ui.el</code></a>
<ul>
<li><a href="#h:ui-built-in">4.2.1. <code>init-ui.el</code> 内置配置</a></li>
<li><a href="#h:ui-doom-emacs">4.2.2. <code>init-ui.el</code> 主题 <code>doom-emacs</code></a></li>
</ul>
</li>
<li><a href="#h:8c9e81fb-48a0-41da-b9e0-1e3cfdee7f51">4.3. <code>init-essentials.el</code></a>
<ul>
<li><a href="#h:d5590309-993e-442e-93ac-e0a6d11763af">4.3.1. <code>init-essentials.el</code> 自定义命令 <code>j-simple.el</code></a></li>
</ul>
</li>
<li><a href="#h:eeccf037-bcb1-4a96-b965-0339735c3105">4.4. <code>init-basic.el</code></a>
<ul>
<li><a href="#h:basic-default">4.4.1. <code>init-basic.el</code> 一些默认的配置</a></li>
<li><a href="#h:3bd70b80-cd07-4c49-b8c0-202f525a46d6">4.4.2. <code>init-basic.el</code> 最近编辑过的文件 <code>recentf</code></a></li>
<li><a href="#h:basic-session">4.4.3. <code>init-basic.el</code> 历史命令 <code>savehist</code></a></li>
<li><a href="#h:basic-simple">4.4.4. <code>init-basic.el</code> 内置包 <code>simple</code></a></li>
<li><a href="#h:basic-general">4.4.5. <code>init-basic.el</code> 键位绑定 <code>general</code></a></li>
<li><a href="#h:basic-input">4.4.6. <code>init-basic.el</code> 输入法</a>
<ul>
<li><a href="#h:a7b816c8-da82-4210-856e-07e2edd6e2c2">4.4.6.1. <code>init-basic.el</code> 输入法 <code>pyim</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:800b1175-68ac-43cc-a556-6c4e0d2eccbc">4.5. <code>init-modeline.el</code></a>
<ul>
<li><a href="#h:modeline-keycast">4.5.1. <code>init-modeline.el</code> 按键显示 <code>keycast</code></a></li>
</ul>
</li>
<li><a href="#h:c3c253e7-a1f2-44b3-8e07-adc5ec6271db">4.6. <code>init-completion.el</code></a>
<ul>
<li><a href="#h:completion-built-in">4.6.1. <code>init-completion.el</code> 内置补全</a></li>
<li><a href="#h:completion-company">4.6.2. <code>init-completion.el</code> 补全 <code>company</code></a></li>
<li><a href="#h:completion-corfu">4.6.3. <code>init-completion.el</code> 补全 <code>corfu</code></a></li>
<li><a href="#h:completion-orderless">4.6.4. <code>init-completion.el</code> minibuffer增强 <code>orderless</code></a></li>
<li><a href="#h:completion-consult">4.6.5. <code>init-completion.el</code> 增强文件内搜索 <code>consult</code></a></li>
<li><a href="#h:completion-embark">4.6.6. <code>init-completion.el</code> minibuffer增强 <code>embark</code></a>
<ul>
<li><a href="#h:completion-minibuffer-4-1">4.6.6.1. <code>init-completion.el</code> 增强 <code>embark</code> 和 <code>consult</code> ，批量搜索替换大杀器</a></li>
</ul>
</li>
<li><a href="#h:completion-marginalia">4.6.7. <code>init-completion.el</code> minubuffer增强注释 <code>marginalia</code></a></li>
<li><a href="#h:completion-vertico">4.6.8. <code>init-completion.el</code> minibuffer增强 <code>vertico</code></a></li>
</ul>
</li>
<li><a href="#h:evil">4.7. <code>init-evil.el</code></a>
<ul>
<li><a href="#h:evil-init">4.7.1. <code>init-evil.el</code> 安装</a></li>
<li><a href="#h:evil-custom-keybinding">4.7.2. <code>init.evil.el</code> 自定义快捷键</a></li>
<li><a href="#h:36d15ff2-87fc-47f2-a385-ddca88f7c2f0">4.7.3. 相关插件列表</a>
<ul>
<li><a href="#h:2186eba8-72bf-4c04-b439-168680e1055e">4.7.3.1. evil-escape插件回退到normal state</a></li>
<li><a href="#h:ff29f09d-cec5-488a-a62e-2e96a9327958">4.7.3.2. evil-anzu</a></li>
<li><a href="#h:4ab86f63-e3dc-4b10-a730-72d12d10555a">4.7.3.3. evil-collections</a></li>
<li><a href="#h:efec661d-88ef-4d35-8545-e33a71e60c04">4.7.3.4. evil-surround</a></li>
<li><a href="#h:5748be0d-f8c4-45d6-89c0-3fd42e880a2c">4.7.3.5. evil-nerd-commenter</a></li>
<li><a href="#h:c63ca6bf-d489-49a3-90b9-0826c2bc5f20">4.7.3.6. evil-snipe</a></li>
<li><a href="#h:270a82c8-9426-4829-b6b8-2037a2121fdf">4.7.3.7. evil-matchit</a></li>
</ul>
</li>
<li><a href="#h:78a0a60e-dfaf-4aeb-9f4d-6bbaefd6ae1d">4.7.4. 高阶用法（自定义 text-obj 或者 自定义 commands)</a></li>
</ul>
</li>
<li><a href="#h:b9b5d584-8a46-49ab-91c7-94c1503a12f5">4.8. <code>init-tools.el</code></a>
<ul>
<li><a href="#h:tools-iedit">4.8.1. <code>init-tools.el</code> 多光标操作 <code>iedit</code> &amp; <code>evil-multiedit</code></a></li>
<li><a href="#h:tools-expand-region">4.8.2. <code>init-tools.el</code> 快速选中区域 <code>expand-region</code></a></li>
<li><a href="#h:tools-highlight-global">4.8.3. <code>init-tools.el</code> 文本高亮 <code>symbol-overlay</code> &amp; <code>highlight-global</code></a></li>
</ul>
</li>
<li><a href="#h:window">4.9. <code>init-window.el</code></a>
<ul>
<li><a href="#h:526c9704-5d7a-47e9-96ca-8310e01fa809">4.9.1. <code>init-window.el</code> <code>window numbering</code></a></li>
<li><a href="#h:98d343f7-9e3d-43b7-8402-a4b3ee20db5b">4.9.2. <code>init-window.el</code> <code>es-windows</code></a></li>
<li><a href="#h:ec506a8e-4641-40a6-800a-a13ba8187433">4.9.3. <code>init-window.el</code> <code>Buffer move</code></a></li>
<li><a href="#h:f27bcd87-7576-4c88-94b5-cd0c3760b649">4.9.4. <code>init-window.el</code> <code>Resize windows</code></a></li>
<li><a href="#h:ca4c214b-2e05-4d97-95cf-9fd95fd01771">4.9.5. <code>init-window.el</code> <code>Winner(builtin)</code></a></li>
<li><a href="#h:7c339d63-4318-4073-b826-b7a6eca2b694">4.9.6. <code>init-window.el</code> 关闭弹窗 <code>Popper</code></a></li>
</ul>
</li>
<li><a href="#h:org">4.10. <code>init-org.el</code></a>
<ul>
<li><a href="#h:org-built-in">4.10.1. <code>init-org.el</code> 内置配置</a></li>
<li><a href="#h:bd869f5d-b960-4a71-a831-455165c3b55e">4.10.2. <code>init-org.el</code> 安装最新org包</a></li>
<li><a href="#h:0934bafe-c508-40e7-8312-64fcb0af71fe">4.10.3. <code>init-org.el</code> org 编程语言支持</a></li>
<li><a href="#h:org-todo">4.10.4. <code>init-org.el</code> org todo</a></li>
<li><a href="#h:org-agenda">4.10.5. <code>init-org.el</code> org agenda</a></li>
<li><a href="#h:org-capture">4.10.6. <code>init-org.el</code> org capture</a></li>
<li><a href="#h:org-effect">4.10.7. <code>init-org.el</code> org effect</a></li>
<li><a href="#h:org-tags">4.10.8. <code>init-org.el</code> org tags</a></li>
<li><a href="#h:org-priority">4.10.9. <code>init-org.el</code> org priority</a></li>
<li><a href="#h:org-jietu">4.10.10. <code>init-org.el</code> org 截图</a></li>
<li><a href="#h:org-protocol">4.10.11. <code>init-org.el</code> 从网页摘取内容 Org Protocol</a></li>
<li><a href="#h:org-spell">4.10.12. <code>init-org.el</code> 拼写检查 Spell checking</a></li>
<li><a href="#h:org-fanyi">4.10.13. <code>init-org.el</code> 翻译 Fanyi Dictionary</a></li>
<li><a href="#h:005568af-5e29-4582-9ba1-85eb4a7c4bc2">4.10.14. <code>init-org.el</code> 双链笔记 <code>org-Roam</code></a>
<ul>
<li><a href="#h:d15ff21d-1471-4613-9ec9-8a9273665175">4.10.14.1. <code>init-org.el</code> org <code>org-roam-ui</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:personspace">4.11. <code>init-persp.el</code> 工作区间管理</a>
<ul>
<li><a href="#h:dbb5227a-09bd-44ff-a2c9-59ab9c5b6f11">4.11.1. <code>init-window.el</code> 窗口 <code>tab-bar(built-in)</code></a></li>
<li><a href="#h:persp-tabspaces">4.11.2. <code>init-persp.el</code> 工作区间 <code>tabspaces</code></a></li>
</ul>
</li>
<li><a href="#h:48550b88-bb99-44c6-a4a3-2442cc2d0443">4.12. <code>init-programming.el</code></a>
<ul>
<li><a href="#h:c++">4.12.1. <code>init-programming.el</code> c++</a>
<ul>
<li><a href="#h:c++-eglot">4.12.1.1. <code>init-programming.el</code> 代码编写 <code>eglot</code></a></li>
<li><a href="#h:c++-treesit-auto">4.12.1.2. <code>init-programming.el</code> 语法高亮 <code>treesit-auto</code></a></li>
<li><a href="#h:c++-consult-imenu">4.12.1.3. <code>init-programming.el</code> 跳转函数列表 consult-imenu</a></li>
<li><a href="#h:2be86b5f-655e-4bd6-b2a8-c39eb68c690f">4.12.1.4. <code>init-programming.el</code> 查找定义和引用</a></li>
<li><a href="#h:0adb5e48-1781-4780-a991-0ac87c8ae529">4.12.1.5. <code>init-programming.el</code> 添加 snippets 支持</a></li>
<li><a href="#h:cc34dec7-c21d-47ef-8cc1-519de991bd8d">4.12.1.6. <code>init-programming.el</code> 在头文件和源文件之间进行跳转</a></li>
</ul>
</li>
<li><a href="#h:8c03c26f-8593-46d5-a278-ff1f2d20dbef">4.12.2. <code>init-programming.el</code> python</a></li>
</ul>
</li>
<li><a href="#h:696bce89-99d1-4716-80c0-cf1b36844fa8">4.13. <code>init-keybindings.el</code></a>
<ul>
<li><a href="#h:keybindings-search-file">4.13.1. <code>init-keybindings.el</code> 文件搜索</a></li>
<li><a href="#h:keybindings-general">4.13.2. <code>init-keybindings.el</code> 键位绑定 <code>general</code></a></li>
</ul>
</li>
<li><a href="#h:05e889c3-381b-4d1a-8647-9df6277d8301">4.14. <code>init-funcs.el</code></a></li>
</ul>
</li>
<li><a href="#h:19b981f0-0e13-46d5-b573-9d8e52aefd33">5. 我的自定义库(<code>j-lisp/</code>)</a>
<ul>
<li><a href="#h:1ff292d7-21a0-4f9b-a00d-52a6be5ef3f6">5.1. <code>j-simple.el</code> 库</a></li>
<li><a href="#h:j-consult">5.2. <code>j-consult.el</code> 库</a></li>
<li><a href="#h:j-embark">5.3. <code>j-embark.el</code> 库</a></li>
<li><a href="#h:j-expand-region">5.4. <code>j-expand-region.el</code> 库</a></li>
<li><a href="#h:j-evil">5.5. <code>j-evil.el</code> 库</a></li>
<li><a href="#h:j-highlight-global">5.6. <code>j-highlight-global.el</code> 库</a></li>
<li><a href="#h:j-org-download">5.7. <code>j-org-download.el</code> 库</a></li>
<li><a href="#h:j-org">5.8. <code>j-org.el</code> 库</a></li>
<li><a href="#h:j-emacs-fast">5.9. <code>j-emacs-fast.el</code> 库</a></li>
</ul>
</li>
<li><a href="#h:43ed0760-cc70-475c-9da8-a9caa7f67657">6. Emacs 配置问题排查</a>
<ul>
<li><a href="#h:2fee1b0f-3633-4d2c-9301-8b08562a07aa">6.1. 配置有问题，启动不了怎么办？</a></li>
<li><a href="#h:a95b56f5-efc0-44a0-b9be-1a054b419bde">6.2. 不能安装包，提示签名错误</a></li>
<li><a href="#h:1576a87a-4eda-419a-8e88-46629c6044a4">6.3. 包解压失败，</a></li>
</ul>
</li>
<li><a href="#h:fcadef90-7310-40d6-aaa0-de74737e0940">7. 优化性能，借鉴其他人的配置</a>
<ul>
<li><a href="#h:558eed58-5e30-476b-acd3-ad1a46949b1b">7.1. 运行时性能</a></li>
<li><a href="#h:da6bbc1a-043f-45e9-8aca-f565c8454588">7.2. 度量启动性能</a></li>
<li><a href="#h:d923bc80-6e8b-4832-b177-156188d0cdad">7.3. 借鉴大佬的配置，作为框架</a></li>
<li><a href="#h:33962756-e6d0-4b81-887d-cd51a76eded0">7.4. 小技巧：</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<section id="outline-container-h:b17d4463-f9b0-43e7-b543-67b9a130db2e" class="outline-2">
<h2 id="h:b17d4463-f9b0-43e7-b543-67b9a130db2e"><span class="section-number-2">1.</span> <code>init.el</code> (学习)</h2>
<div class="outline-text-2" id="text-h:b17d4463-f9b0-43e7-b543-67b9a130db2e">
<p>
开启学习
</p>
<div class="org-src-container">
<pre class="src src-sh">:PROPERTIES:
:HEADER-ARGS: :tangle init.el
:END:
</pre>
</div>
</div>
<div id="outline-container-h:0e90d45f-f8d6-4b1e-b32a-143e762454e8" class="outline-3">
<h3 id="h:0e90d45f-f8d6-4b1e-b32a-143e762454e8"><span class="section-number-3">1.1.</span> 安装</h3>
<div class="outline-text-3" id="text-h:0e90d45f-f8d6-4b1e-b32a-143e762454e8">
<p>
本文emacs安装在windows环境中，使用 <a href="https://www.msys2.org/">msys2</a> 工具安装。如安装到 <code>D:\msys64</code>, 并设置PATH变量(<code>D:\msys64\mingw64\bin</code>, <code>D:\msys64\usr\bin</code>)
</p>

<p>
更新msys2, 如下更新命令执行2遍
</p>
<div class="org-src-container">
<pre class="src src-sh">pacman -Suy
</pre>
</div>

<p>
添加msys2右键菜单： 创建 emacs-shell.reg注册表添加如下内容，双击执行即可
</p>
<pre class="example" id="org9d58920">
Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\Directory\Background\shell\MSYS2]
@="MSYS2 Bash Here"
"Icon"="d:\\msys64\\msys2.ico"

[HKEY_CLASSES_ROOT\Directory\Background\shell\MSYS2\command]
@="d:\\msys64\\msys2_shell.cmd -mingw64 -here"
</pre>
</div>
<div id="outline-container-h:f9b3ea3c-a220-4130-9b15-7f85c2037540" class="outline-4">
<h4 id="h:f9b3ea3c-a220-4130-9b15-7f85c2037540"><span class="section-number-4">1.1.1.</span> 二进制安装</h4>
<div class="outline-text-4" id="text-h:f9b3ea3c-a220-4130-9b15-7f85c2037540">
<p>
安装emacs
</p>
<div class="org-src-container">
<pre class="src src-sh">pacman -S mingw-w64-x86_64-emacs
</pre>
</div>
</div>
</div>
<div id="outline-container-h:04da44fe-12b5-4de9-afc1-126ff7ecfc15" class="outline-4">
<h4 id="h:04da44fe-12b5-4de9-afc1-126ff7ecfc15"><span class="section-number-4">1.1.2.</span> 源码安装</h4>
<div class="outline-text-4" id="text-h:04da44fe-12b5-4de9-afc1-126ff7ecfc15">
<ul class="org-ul">
<li><a href="https://savannah.gnu.org/projects/emacs/">https://savannah.gnu.org/projects/emacs/</a> (官方地址，推荐)</li>
<li><a href="https://github.com/emacs-mirror/emacs">https://github.com/emacs-mirror/emacs</a> (github镜像)</li>
</ul>

<p>
下载源码，查看INSTALL文件中不同操作系统安装指引
</p>

<p>
<b>windows</b>
nt/INSTALL.W64
</p>

<p>
参考：<a href="https://eason0210.github.io/post/install-gccemacs/">https://eason0210.github.io/post/install-gccemacs/</a>
</p>

<p>
在 Mingw64 终端中执行以下命令安装依赖。
</p>
<div class="org-src-container">
<pre class="src src-sh">pacman -S --needed base-devel <span style="color: #8b2252;">\</span>
mingw-w64-x86_64-toolchain <span style="color: #8b2252;">\</span>
mingw-w64-x86_64-xpm-nox <span style="color: #8b2252;">\</span>
mingw-w64-x86_64-gmp <span style="color: #8b2252;">\</span>
mingw-w64-x86_64-gnutls <span style="color: #8b2252;">\</span>
mingw-w64-x86_64-libtiff <span style="color: #8b2252;">\</span>
mingw-w64-x86_64-giflib <span style="color: #8b2252;">\</span>
mingw-w64-x86_64-libpng <span style="color: #8b2252;">\</span>
mingw-w64-x86_64-libjpeg-turbo <span style="color: #8b2252;">\</span>
mingw-w64-x86_64-librsvg <span style="color: #8b2252;">\</span>
mingw-w64-x86_64-libwebp <span style="color: #8b2252;">\</span>
mingw-w64-x86_64-lcms2 <span style="color: #8b2252;">\</span>
mingw-w64-x86_64-libxml2 <span style="color: #8b2252;">\</span>
mingw-w64-x86_64-zlib <span style="color: #8b2252;">\</span>
mingw-w64-x86_64-harfbuzz <span style="color: #8b2252;">\</span>
mingw-w64-x86_64-libgccjit <span style="color: #8b2252;">\</span>
mingw-w64-x86_64-sqlite3 <span style="color: #8b2252;">\</span>
mingw-w64-x86_64-tree-sitter
</pre>
</div>

<p>
下载 Emacs 源代码
</p>
<div class="org-src-container">
<pre class="src src-sh">git clone -b master git://git.sv.gnu.org/emacs.git
<span style="color: #483d8b;">cd</span> emacs

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#25191;&#34892;./autogen.sh&#36807;&#31243;&#20013;&#20986;&#38169;&#65292;&#21487;&#33021;&#26159;&#22240;&#20026;&#20811;&#38534;&#20195;&#30721;&#21518; checkout &#26102;&#29992;&#20102; CRLF.</span>
git config core.autocrlf false
</pre>
</div>

<p>
编译 Emac
</p>
<div class="org-src-container">
<pre class="src src-sh">./autogen.sh  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#25552;&#31034;&#29256;&#26412;&#19981;&#22815; pacman -Su autoconf</span>
./configure --prefix=/d/programs/emacs --without-dbus

<span style="color: #483d8b;">echo</span> $(<span style="color: #ff00ff;">nproc</span>)

make -j4
make install
<span style="color: #b22222;">#</span><span style="color: #b22222;">make install prefix=/d/opt/emacs #&#25351;&#23450;&#23433;&#35013;&#30446;&#24405;</span>
</pre>
</div>
<ol class="org-ol">
<li><code>echo $(nproc)</code> 会显示当前系统的 CPU 核心数；然后在 <code>make -j4</code> 就是使用 4 个核心进行编译, 推荐使用总数的一半，既提高了编译速度，也不影响其他应用的运行。</li>
<li>如果需要卸载的话在源码目录里面 <code>make uninstall</code> 就可以了。建议安装在指定目录，注意在路径中使用斜杠&ldquo;/&rdquo;, 而不是反斜杠&ldquo;\&rdquo;。</li>
<li>如果编译过程出错了，记得 <code>make clean</code> 之后重新 <code>configure</code> 再 <code>make</code> 。</li>
</ol>

<p>
测试运行 Emacs
</p>

<p>
<code>bin\runemacs.exe -Q</code>
</p>

<p>
从 mingw64 shell 外部运行 Emacs 时，您需要
将 d：\msys64\mingw64\bin 添加到您的 Windows PATH，或复制所需的
DLL 添加到 Emacs 的 bin/ 目录中。 否则，TLS 等功能会导致
取决于那些DLL将丢失
</p>

<p>
将 <code>d:\programs\emacs\bin</code> 加入到环境变量。 如果和msys2中的emacs同存，将path中的源码安装的路径放在msys2的emacs前面。
</p>

<p>
创建快捷方式
</p>

<p>
请右键选择新建快捷方式，选择bin\runemacs.exe, 并起个名。 右键快捷方式 <code>属性</code> ，目标处添加命令行选项 <code>--debug-init</code> 
</p>
</div>
</div>
</div>
<div id="outline-container-h:learn-key" class="outline-3">
<h3 id="h:learn-key"><span class="section-number-3">1.2.</span> 改键</h3>
<div class="outline-text-3" id="text-h:learn-key">
<p>
模块化配置中添加了键绑定<a href="#h:basic-default">(<code>init-basic.el</code> 一些默认的配置)</a>
</p>


<ul class="org-ul">
<li>M(eta)：统一对应键盘按键(PC/Mac)：left windows/option</li>
<li>s(uper)：统一对应键盘按键(PC/Mac)：left Alt/command</li>
<li>C(trl)：统一对应键盘按键(PC/Mac): Caps Lock</li>
</ul>

<p>
Mac 只需要改大写键，Windows 对齐mac的布局
</p>
<dl class="org-dl">
<dt>MacOS</dt><dd>在 MacOS 中, 大家可以在 <code>system</code> -&gt; <code>keyboard</code> -&gt;  <code>function
  al keys</code> 中调整所有功能键的键位.</dd>
</dl>

<p>
1.Windows SharpKeys 改键
</p>

<p>
来把 Left Window 键改成 Left Alt 键，Left Alt 键改成 A
pp 键，大小写键改成 Ctrl 键。
</p>


<p>
官方下载：<a href="https://github.com/randyrants/sharpkeys">https://github.com/randyrants/sharpkeys</a>，安装后 win 菜单搜
索 sharpkey，修改完成后写入注册表重新开机生效。
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">原键</td>
<td class="org-left">目标键</td>
<td class="org-left">说明</td>
</tr>

<tr>
<td class="org-left">Caps Lock(00_3A)</td>
<td class="org-left">Left Ctrl(01_1D)</td>
<td class="org-left">大小写键改成Ctrl键</td>
</tr>

<tr>
<td class="org-left">Left Alt(00_38)</td>
<td class="org-left">Application(E0_5D)</td>
<td class="org-left">左Alt键改成App键</td>
</tr>

<tr>
<td class="org-left">Left Windows(E0_5B)</td>
<td class="org-left">Left Alt(00_38)</td>
<td class="org-left">左视窗键改成左Alt键</td>
</tr>

<tr>
<td class="org-left">Right Alt(E0_38)</td>
<td class="org-left">Left Windows(E0_5B)</td>
<td class="org-left">右Alt键改成左视窗键</td>
</tr>
</tbody>
</table>


<p>
2.配置
</p>

<p>
Emacs 默认 Alt 键就是 Meta，而 App 键我们改成 super 键，可以通过下面 的 Elisp 代码来完成。
</p>

<p>
window 配置
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> w32-apps-modifier 'super)       <span style="color: #b22222;">; </span><span style="color: #b22222;">&#36890;&#36807;SharpKeys&#25913;&#25104;&#20102; Application</span>
</pre>
</div>

<p>
mac 配置
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;  </span><span style="color: #b22222;">Opt -&gt; meta : M, Cmd -&gt; super : s</span>
(<span style="color: #a020f0;">setq</span> mac-option-modifier 'meta
      mac-command-modifier 'super)
</pre>
</div>

<p>
3.定义常用操作
</p>

<p>
现在我们可以把 Mac 下面的复制、粘贴、剪切、全选等命令移植到 Emacs 中
来了，并且这一套按键是跨平台的。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="color: #8b2252;">"s-a"</span>) 'mark-whole-buffer) <span style="color: #b22222;">;;</span><span style="color: #b22222;">&#23545;&#24212;Windows&#19978;&#38754;&#30340;Ctrl-a &#20840;&#36873;</span>
(global-set-key (kbd <span style="color: #8b2252;">"s-c"</span>) 'kill-ring-save) <span style="color: #b22222;">;;</span><span style="color: #b22222;">&#23545;&#24212;Windows&#19978;&#38754;&#30340;Ctrl-c &#22797;&#21046;</span>
(global-set-key (kbd <span style="color: #8b2252;">"s-s"</span>) 'save-buffer) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#23545;&#24212;Windows&#19978;&#38754;&#30340;Ctrl-s &#20445;&#23384;</span>
(global-set-key (kbd <span style="color: #8b2252;">"s-v"</span>) 'yank) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#23545;&#24212;Windows&#19978;&#38754;&#30340;Ctrl-v &#31896;&#36148;</span>
(global-set-key (kbd <span style="color: #8b2252;">"s-z"</span>) 'undo) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#23545;&#24212;Windows&#19978;&#38754;&#30340;Ctrol-z &#25764;&#38144;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b8400296-41de-4401-98c6-094756c3ee53" class="outline-3">
<h3 id="h:b8400296-41de-4401-98c6-094756c3ee53"><span class="section-number-3">1.3.</span> 常用配置</h3>
<div class="outline-text-3" id="text-h:b8400296-41de-4401-98c6-094756c3ee53">
<p>
1.光标移动
</p>

<p>
光标的移动是编辑器中最常用的操作所以必须熟知。
</p>

<ul class="org-ul">
<li>C-f 为前移一个字符， f 代表 forward。</li>
<li>C-b 为后移一个字符， b 代表 backward。</li>
<li>C-p 为上移至前一行， p 代表 previous。</li>
<li>C-n 为上移至下一行， n 代表 next。</li>
<li>C-a 为移至行首， a 代表 ahead。</li>
<li>C-e 为移至行尾， e 代表 end。</li>
</ul>

<p>
同样适用于 Shell 终端里面。
</p>

<p>
2.内置功能
</p>

<p>
Emacs 功能强大，但是部分功能默认情况下并未开启。
</p>

<p>
如编辑器内显示行号可使用 M-x linum-mode 来开启。
</p>

<p>
配置文件
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-display-line-numbers-mode 1) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#26174;&#31034;&#34892;&#21495; 29&#29256;&#26412;&#12290;29&#20043;&#21069;&#29992;(global-linum-mode 1)</span>
(<span style="color: #a020f0;">setq</span> inhibit-startup-screen t) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#23581;&#35797;&#20851;&#25481;&#21551;&#21160;&#30028;&#38754;</span>
</pre>
</div>

<p>
3.帮助
</p>

<p>
Emacs 是一个富文档编辑器（Self document, extensible editor）而下面的三种方法在学 习 Emacs 的过程中也非常重要。他们分别是，
</p>

<p>
C-h k 寻找快捷键的帮助信息
C-h v 寻找变量的帮助信息
C-h f 寻找函数的帮助信息
</p>

<p>
4.windows 右键菜单添加 Open With Emacs 功能
</p>

<p>
创建注册表文件 emacs-context.reg
</p>

<div class="org-src-container">
<pre class="src src-sh">Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT<span style="color: #8b2252;">\*</span>\shell]
[HKEY_CLASSES_ROOT<span style="color: #8b2252;">\*</span>\shell\openwemacs]
@=<span style="color: #8b2252;">"&amp;Edit with Emacs"</span>
[HKEY_CLASSES_ROOT<span style="color: #8b2252;">\*</span>\shell\openwemacs\command]
@=<span style="color: #8b2252;">"D:\\msys64\\mingw64\\bin\\emacsclientw.exe -n \"%1\""</span>
[HKEY_CLASSES_ROOT\Directory\shell\openwemacs]
@=<span style="color: #8b2252;">"Edit &amp;with Emacs"</span>
[HKEY_CLASSES_ROOT\Directory\shell\openwemacs\command]
@=<span style="color: #8b2252;">"D:\\msys64\\mingw64\\bin\\emacsclientw.exe -n \"%1\""</span>
</pre>
</div>


<p>
使用这个 OpenWithEmacs 的功能，Emacs 需要开启 Server Mode，代码如下：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(server-mode 1)
</pre>
</div>

<p>
双击注册文件。这时右键打开文件就可以选择emacs打开了。
</p>

<p>
5.补全
<a id="org5843600"></a>
</p>

<p>
在我的配置中添加内置补全<a href="#h:completion-built-in">(<code>init-completion.el</code> 内置补全)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20869;&#32622;&#34917;&#20840;&#21151;&#33021;n</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(setq tab-always-indent 'complete)           ;; &#20351;&#29992; TAB &#26469;&#21015;&#20986;&#24403;&#21069;&#34917;&#20840;&#36873;&#39033;</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(icomplete-mode t)                         ;; &#24320;&#21551;&#30340;&#65292;&#22312;&#25353; M-x &#26102;&#23601;&#26377;&#21487;&#36873;&#30340;&#36873;&#39033;&#20102;&#12290;&#20351;&#29992; vertico-mode&#65292;&#20851;&#38381;&#27492;&#39033;</span>
</pre>
</div>

<p>
6.基础Elisp
</p>

<p>
Emacs Lisp 是世界上第二古老高级编程语言 Lisp 专为 Emacs 打造的方言。官方提供了 Emacs Lisp 的<a href="https://www.gnu.org/software/emacs/manual/html_node/eintr/index.html">入门</a>介绍和<a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/index.html">参考手册</a>。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">2 + 2</span>
(+ 2 2)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">2 + 3 * 4</span>
(+ 2 (* 3 4))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#23450;&#20041;&#21464;&#37327;</span>
(<span style="color: #a020f0;">setq</span> name <span style="color: #8b2252;">"username"</span>)
(message name) <span style="color: #b22222;">; </span><span style="color: #b22222;">-&gt; "username"</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#23450;&#20041;&#20989;&#25968;</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">func</span> ()
  (message <span style="color: #8b2252;">"Hello, %s"</span> name))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#25191;&#34892;&#20989;&#25968;</span>
(func) <span style="color: #b22222;">; </span><span style="color: #b22222;">C-x C-e -&gt; Hello, username</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#35774;&#32622;&#24555;&#25463;&#38190;</span>
(global-set-key (kbd <span style="color: #8b2252;">"&lt;f1&gt;"</span>) 'func)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20351;&#20989;&#25968;&#21487;&#30452;&#25509;&#34987;&#35843;&#29992;&#21487;&#28155;&#21152; (interactive)</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">func</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (message <span style="color: #8b2252;">"Hello, %s"</span> name))
</pre>
</div>

<p>
定义f4快速打开配置文件
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#24555;&#36895;&#25171;&#24320;&#37197;&#32622;&#25991;&#20214;</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">open-init-file</span>()
  (<span style="color: #a020f0;">interactive</span>)
  (find-file <span style="color: #8b2252;">"~/.emacs.d/init.el"</span>))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36825;&#19968;&#34892;&#20195;&#30721;&#65292;&#23558;&#20989;&#25968; open-init-file &#32465;&#23450;&#21040; &lt;f4&gt; &#38190;&#19978;</span>
(global-set-key (kbd <span style="color: #8b2252;">"&lt;f4&gt;"</span>) 'open-init-file)
</pre>
</div>

<p>
7.外观配置
<a id="org0f7f12e"></a>
</p>

<p>
我的模块化配置<a href="#h:ui-built-in">(<code>init-ui.el</code> 内置配置)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;</span><span style="color: #b22222;">(toggle-frame-maximized)                   ; &#20840;&#23631;&#32534;&#36753;&#22120;</span>
(tool-bar-mode -1)                           <span style="color: #b22222;">; </span><span style="color: #b22222;">&#20851;&#38381;&#24037;&#20855;&#26639;&#65292;tool-bar-mode &#21363;&#20026;&#19968;&#20010; Minor Mode</span>
(scroll-bar-mode -1)                         <span style="color: #b22222;">; </span><span style="color: #b22222;">&#20851;&#38381;&#25991;&#20214;&#28369;&#21160;&#25511;&#20214;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(menu-bar-mode -1)                        ; &#20851;&#38381;&#33756;&#21333;&#26639; (&#19981;&#20851;&#38381;&#65292;&#20351;&#29992;&#25554;&#20214;&#26102;&#20250;&#29992;&#21040;)</span>

(<span style="color: #a020f0;">setq-default</span> cursor-type 'bar)              <span style="color: #b22222;">; </span><span style="color: #b22222;">&#26356;&#25913;&#20809;&#26631;&#30340;&#26679;&#24335;&#65292;&#40664;&#35748;&#27604;&#36739;&#31895;. &#26356;&#22810;C-h v &#26597;&#35810;&#24110;&#21161;</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(setq cursor-type 'bar)                    ; &#26356;&#25913;&#20809;&#26631;&#30340;&#26679;&#24335;&#12290;setq&#24403;&#21069;buffer&#29983;&#25928;&#65292;&#19981;&#33021;&#20840;&#23616;&#29983;&#25928;</span>

<span style="color: #b22222;">;;</span><span style="color: #b22222;">(set-face-attribute 'default nil :height 150) ; &#20462;&#25913;&#23383;&#21495;&#65292;&#22823;&#23567;&#20026;16pt</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">&#35753;&#40736;&#26631;&#28378;&#21160;&#26356;&#22909;&#29992;&#12290;&#40664;&#35748;&#28378;&#21160;&#24456;&#24555;</span>
(<span style="color: #a020f0;">setq</span> mouse-wheel-scroll-amount '(3 ((shift) . 1) ((control) . nil)))
(<span style="color: #a020f0;">setq</span> mouse-wheel-progressive-speed nil)

(global-hl-line-mode t)                      <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#39640;&#20142;&#24403;&#21069;&#34892;</span>
(<span style="color: #a020f0;">setq</span> make-backup-files nil)                 <span style="color: #b22222;">; </span><span style="color: #b22222;">&#20851;&#38381;&#25991;&#20214;&#33258;&#21160;&#22791;&#20221;&#12290;&#22914;&#26524;&#26159;&#26377;git&#26469;&#31649;&#29702;&#25991;&#20214;&#65292;&#22791;&#20221;&#25991;&#20214;&#27809;&#26377;&#22826;&#22823;&#24847;&#20041;&#12290;~ &#20026;&#21518;&#32512;&#30340;&#25991;&#20214;&#20026;&#33258;&#21160;&#29983;&#25104;&#30340;&#22791;&#20221;&#25991;&#20214;</span>
(<span style="color: #a020f0;">setq</span> auto-save-default nil)   <span style="color: #b22222;">; </span><span style="color: #b22222;">&#20851;&#38381;&#33258;&#21160;&#20445;&#23384;&#25991;&#20214;&#65292;#&#20026;&#21518;&#32512;&#30340;&#25991;&#20214;</span>
(fset 'yes-or-no-p 'y-or-n-p)                <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#26576;&#20010;&#21629;&#20196;&#26102;&#38656;&#35201;&#36755;&#20837; (yes or no) </span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:4a222504-05b5-4a0d-80ab-6cd04ee213a5" class="outline-3">
<h3 id="h:4a222504-05b5-4a0d-80ab-6cd04ee213a5"><span class="section-number-3">1.4.</span> 关于 lexical binding</h3>
<div class="outline-text-3" id="text-h:4a222504-05b5-4a0d-80ab-6cd04ee213a5">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#40664;&#35748;&#27809;&#26377;&#28608;&#27963;&#12290;&#22312;&#25991;&#20214;&#26368;&#24320;&#22836;&#28155;&#21152;&#25991;&#20214;&#20316;&#29992;&#22495;&#30340;&#21464;&#37327;&#35774;&#32622;&#65292;&#35774;&#32622;&#21464;&#37327;&#30340;&#32465;&#23450;&#26041;&#24335;&#12290;&#35774;&#32622;&#22312;&#24403;&#21069;&#25991;&#20214;&#20316;&#29992;&#22495;&#20869;&#26159;&#28608;&#27963;&#30340;&#12290;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">-*- lexical-binding: t -*-</span>
(<span style="color: #a020f0;">let</span> ((x 1))    <span style="color: #b22222;">; </span><span style="color: #b22222;">x is lexically bound.</span>
  (+ x 3))
     &#8658; 4       <span style="color: #b22222;">; </span><span style="color: #b22222;">1 + 3 &#30340;&#20540;&#20026; 4</span>

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">getx</span> ()
  x)            <span style="color: #b22222;">; </span><span style="color: #b22222;">x is used free in this function.</span>

(<span style="color: #a020f0;">let</span> ((x 1))    <span style="color: #b22222;">; </span><span style="color: #b22222;">x is lexically bound. getx &#26159;&#29992;&#19981;&#21040; let &#23450;&#20041;&#30340; x &#30340;</span>
  (getx))
<span style="color: #b22222;">;;</span><span style="color: #b22222;">error&#8594; Symbol's value as variable is void: x</span>
</pre>
</div>

<p>
关于<a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Lexical-Binding.html">lexical binding</a>更多的细节，可以自行阅读 Emacs 的官方文档。程序代码使用 lexical binding 会更利于并发，编辑器会执行一些优化让代码执行的更快。很多插件要求安装 lexical binding。
</p>

<p>
范例：init.el
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">init.el --- Load the full configuration -*- lexical-binding: t -*-</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Commentary:</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This file bootstraps the configuration, which is divided into</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">a number of other files.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Code:</span>

(+ 1 2)

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">init.el ends here</span>
</pre>
</div>

<p>
三个分号开头的注释表示“节”，两个分号开头的注释表示“段落”。（一个分号开头的是一行代码后面的行内注释）。
</p>
</div>
</div>
<div id="outline-container-h:ef17a11a-df61-41c6-8bbd-8d92766b4273" class="outline-3">
<h3 id="h:ef17a11a-df61-41c6-8bbd-8d92766b4273"><span class="section-number-3">1.5.</span> 插件源</h3>
<div class="outline-text-3" id="text-h:ef17a11a-df61-41c6-8bbd-8d92766b4273">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">package</span>)
(<span style="color: #a020f0;">setq</span> package-check-signature nil 
      load-prefer-newer t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20010;&#21035;&#26102;&#20505;&#20250;&#20986;&#29616;&#31614;&#21517;&#26657;&#39564;&#22833;&#36133;</span>
(<span style="color: #a020f0;">setq</span> package-archives
          '((<span style="color: #8b2252;">"melpa"</span>  . <span style="color: #8b2252;">"https://melpa.org/packages/"</span>)
            (<span style="color: #8b2252;">"gnu"</span>    . <span style="color: #8b2252;">"https://elpa.gnu.org/packages/"</span>)
            (<span style="color: #8b2252;">"nongnu"</span> . <span style="color: #8b2252;">"https://elpa.nongnu.org/nongnu/"</span>)))

(<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">bound-and-true-p</span> package--initialized)
  (package-initialize)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#21047;&#26032;&#36719;&#20214;&#28304;&#32034;&#24341;</span>

<span style="color: #b22222;">;;</span><span style="color: #b22222;">&#38450;&#27490;&#21453;&#22797;&#35843;&#29992; package-refresh-contents &#20250;&#24433;&#21709;&#21152;&#36733;&#36895;&#24230;</span>
(<span style="color: #a020f0;">when</span> (not package-archive-contents)
  (package-refresh-contents))

<span style="color: #b22222;">;;</span><span style="color: #b22222;">modeline&#19978;&#26174;&#31034;&#25105;&#30340;&#25152;&#26377;&#30340;&#25353;&#38190;&#21644;&#25191;&#34892;&#30340;&#21629;&#20196;</span>
(package-install 'keycast) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#21253;&#20250;&#23433;&#35013;&#22312;elpa&#30446;&#24405;&#20013;</span>
(keycast-mode-line-mode t)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6483447a-d63f-42b0-8c5c-48eebe7d352c" class="outline-3">
<h3 id="h:6483447a-d63f-42b0-8c5c-48eebe7d352c"><span class="section-number-3">1.6.</span> 安装补全插件</h3>
<div class="outline-text-3" id="text-h:6483447a-d63f-42b0-8c5c-48eebe7d352c">
<p>
<b>Company插件</b>
<a id="org4727033"></a>
</p>

<p>
我的emacs模块配置<a href="#h:completion-company">(<code>init-completion.el</code> 补全 <code>company</code>)</a>
</p>

<p>
他是一个用于代码补全的插件
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#24320;&#21551;&#20840;&#23616; Company &#34917;&#20840;</span>
(package-install 'company)
(global-company-mode 1)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">company mode &#40664;&#35748;&#36873;&#25321;&#19978;&#19968;&#26465;&#21644;&#19979;&#19968;&#26465;&#20505;&#36873;&#39033;&#21629;&#20196; M-n M-p</span>
(define-key company-active-map (kbd <span style="color: #8b2252;">"C-n"</span>) 'company-select-next)
(define-key company-active-map (kbd <span style="color: #8b2252;">"C-p"</span>) 'company-select-previous)
</pre>
</div>

<p>
<b>增强 minibuffer 补全：vertico 和 Orderless</b>
<a id="org04c8521"></a>
</p>

<ul class="org-ul">
<li>我的emacs模块配置<a href="#h:completion-orderless">(<code>init-completion.el</code> minibuffer增强 <code>orderless</code>)</a></li>
<li>我的emacs模块配置<a href="#h:completion-vertico">(<code>init-completion.el</code> minibuffer增强 <code>vertico</code>)</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package-install 'vertico)
(vertico-mode t)

(package-install 'orderless)
(<span style="color: #a020f0;">setq</span> completion-styles '(orderless))
</pre>
</div>

<p>
有了 vertico-mode，把之前的 icomplete-mode 关掉。 补全变为垂直，垂直对于我们是更友好的，所有 minibuffer 的行为的可以补全。如使用 <code>M-x</code> 补全变为垂直,  <code>C-x C-f</code> 增强显示目录下文件、 <code>C-x b</code> 变为垂直。
</p>

<p>
orderless 支持 <code>M-x</code> 模糊搜索，可以无序的。 如 edebug-defun 函数搜索， <code>M-x fun debug</code>
</p>


<p>
<b>配置 Marginalia 增强 minubuffer 的 annotation</b>
<a id="orgb1f5fa5"></a>
</p>

<p>
我的emacs模块配置<a href="#h:completion-marginalia">(<code>init-completion.el</code>  minubuffer增强注释 <code>marginalia</code>)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs">(package-install 'marginalia)
(marginalia-mode t)
</pre>
</div>

<p>
<code>M-x</code> 可以看到它会把命令的注释直接显示在minibuffer中
</p>

<p>
<code>C-h v</code> 查看一个变量的内容，可以发现不用再按回车看到里面的值。直接显示在minibuffer中
</p>

<p>
<code>C-h f</code> 键位绑定都已经在minibuffer中显示出来了
</p>

<p>
<code>C-x C-f</code> 显示文件大小权限等， <code>C-x b</code> 显 buffer 大小状态， <code>C-h f</code> 显示函数快捷键等
</p>

<p>
<b>minibuffer action 和自适应的 context menu：Embark</b>
<a id="orgc4000c0"></a>
</p>

<p>
我的emacs模块配置<a href="#h:completion-embark">(<code>init-completion.el</code> minibuffer增强 <code>embark</code>)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package-install 'embark)
(global-set-key (kbd <span style="color: #8b2252;">"C-;"</span>) 'embark-act)
(<span style="color: #a020f0;">setq</span> prefix-help-command 'embark-prefix-help-command)
</pre>
</div>

<p>
使用
</p>

<p>
光标在函数位置，按 <code>C-;</code> 
</p>
<ul class="org-ul">
<li>RET 查看光标处函数定义文件位置，并打开</li>
<li>c 修改变量的值
<ul class="org-ul">
<li>如 C-h v 变量名，按 C-; c 修改变量的值</li>
</ul></li>
</ul>

<p>
优点：不需要记快捷键了
</p>
<ul class="org-ul">
<li>以前查看函数的绑定键
<ul class="org-ul">
<li><code>C-h b</code> 查看函数快捷键绑定：</li>
<li>以前按 <code>C-x C-h</code> 时，会告诉你 <code>C-x</code> 绑定了哪些快捷键</li>
</ul></li>
<li>设置了 <code>(setq prefix-help-command #'embark-prefix-help-command)</code> 后
<ul class="org-ul">
<li>按 <code>C-x C-h</code> 模糊输入函数名可看到绑定的快捷键，按回车可直接执行命令，就不需要再记快捷键了</li>
</ul></li>
</ul>

<p>
<b>增强文件内搜索和跳转函数定义：Consult</b>
<a id="org46359f1"></a>
</p>

<p>
我的emacs模块配置<a href="#h:completion-consult">(<code>init-completion.el</code> 增强文件内搜索 <code>consult</code>)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(package-install 'consult)
<span style="color: #b22222;">;;</span><span style="color: #b22222;">replace swiper &#21487;&#20197;&#26367;&#20195;&#32769;&#30340; ivy mode &#30340; swiper &#21151;&#33021;</span>
(global-set-key (kbd <span style="color: #8b2252;">"C-s"</span>) 'consult-line)
(global-set-key (kbd <span style="color: #8b2252;">"M-s i"</span>) 'consult-imenu)  <span style="color: #b22222;">;</span><span style="color: #b22222;">&#36339;&#36716;&#20989;&#25968;&#23450;&#20041;</span>
</pre>
</div>

<p>
使用 <code>C-s</code> 搜索的内容就会在minibuffer中垂直显示，使用C-p 或 C-n来上下选择
</p>

<p>
使用 <code>M-s i</code> 跳转函数定义或者org-mode标题
</p>

<p>
这些组合可以秒杀ivy helm这种一统的插件。
</p>

<p>
<b>括号</b>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(electric-pair-mode t)                       <span style="color: #b22222;">; </span><span style="color: #b22222;">&#25324;&#21495;&#34917;&#20840;</span>
(add-hook 'prog-mode-hook #'show-paren-mode) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#32534;&#31243;&#27169;&#24335;&#19979;&#65292;&#20809;&#26631;&#22312;&#25324;&#21495;&#19978;&#26102;&#39640;&#20142;&#21478;&#19968;&#20010;&#25324;&#21495;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a10e6f11-2517-4c48-bcb7-5ee139fa2a2c" class="outline-3">
<h3 id="h:a10e6f11-2517-4c48-bcb7-5ee139fa2a2c"><span class="section-number-3">1.7.</span> 手工安装插件</h3>
<div class="outline-text-3" id="text-h:a10e6f11-2517-4c48-bcb7-5ee139fa2a2c">
<p>
以 <a href="https://github.com/manateelazycat/awesome-tab">awesome-tab</a>  为例
</p>

<p>
创建目录，使用内容Dir包。 <code>C-x d</code> 回车， <code>+</code> 创建目录输入目录名site-lisp 回车， <code>q</code> 退出
</p>

<p>
使用 <code>M-x eshell</code> 克隆代码
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">cd</span> site-lisp
git clone --depth=1 https://github.com/manateelazycat/awesome-tab.git
</pre>
</div>

<p>
配置文件
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'load-path (expand-file-name <span style="color: #8b2252;">"~/.emacs.d/site-lisp/awesome-tab/"</span>))
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">awesome-tab</span>)
(awesome-tab-mode t)

<span style="color: #b22222;">;;</span><span style="color: #b22222;">(use-package awesome-tab</span>
<span style="color: #b22222;">;;  </span><span style="color: #b22222;">:ensure nil</span>
<span style="color: #b22222;">;;  </span><span style="color: #b22222;">:quelpa (awesome-tab :fetcher github :repo "manateelazycat/awesome-tab" :upgrade nil)</span>
<span style="color: #b22222;">;;  </span><span style="color: #b22222;">:init (awesome-tab-mode t)</span>
<span style="color: #b22222;">;;  </span><span style="color: #b22222;">)</span>

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">awesome-tab-buffer-groups</span> ()
<span style="color: #8b2252;">"`</span><span style="color: #008b8b;">awesome-tab-buffer-groups</span><span style="color: #8b2252;">' control buffers' group rules.</span>
<span style="color: #8b2252;">Group awesome-tab with mode if buffer is derived from `</span><span style="color: #008b8b;">eshell-mode</span><span style="color: #8b2252;">' `</span><span style="color: #008b8b;">emacs-lisp-mode</span><span style="color: #8b2252;">' `</span><span style="color: #008b8b;">dired-mode</span><span style="color: #8b2252;">' `</span><span style="color: #008b8b;">org-mode</span><span style="color: #8b2252;">' `</span><span style="color: #008b8b;">magit-mode</span><span style="color: #8b2252;">'.</span>
<span style="color: #8b2252;">All buffer name start with * will group to \"Emacs\".</span>
<span style="color: #8b2252;">Other buffer group by `</span><span style="color: #008b8b;">awesome-tab-get-group-name</span><span style="color: #8b2252;">' with project name."</span>
(list
(<span style="color: #a020f0;">cond</span>
    ((<span style="color: #a020f0;">or</span> (string-equal <span style="color: #8b2252;">"*"</span> (substring (buffer-name) 0 1))
        (memq major-mode '(magit-process-mode
                            magit-status-mode
                            magit-diff-mode
                            magit-log-mode
                            magit-file-mode
                            magit-blob-mode
                            magit-blame-mode)))
    <span style="color: #8b2252;">"Emacs"</span>)
    ((derived-mode-p 'eshell-mode)
    <span style="color: #8b2252;">"EShell"</span>)
    ((derived-mode-p 'dired-mode)
    <span style="color: #8b2252;">"Dired"</span>)
    ((memq major-mode '(org-mode org-agenda-mode diary-mode))
    <span style="color: #8b2252;">"OrgMode"</span>)
    ((derived-mode-p 'eaf-mode)
    <span style="color: #8b2252;">"EAF"</span>)
    (t
    (awesome-tab-get-group-name (current-buffer))))))
</pre>
</div>

<p>
尽量用内置的包。 <code>tab-bar</code>
</p>
</div>
</div>
<div id="outline-container-h:7d42306d-1ba7-468d-b67d-0d2e1894535e" class="outline-3">
<h3 id="h:7d42306d-1ba7-468d-b67d-0d2e1894535e"><span class="section-number-3">1.8.</span> 其他小配置</h3>
<div class="outline-text-3" id="text-h:7d42306d-1ba7-468d-b67d-0d2e1894535e">
<p>
<b>最近打开文件</b>
</p>

<p>
最近打开过文件的选项让我们更快捷的在图形界面的菜单中打开最近 编辑过的文件。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">recentf</span>)
(recentf-mode 1)
(<span style="color: #a020f0;">setq</span> recentf-max-menu-item 10)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36825;&#20010;&#24555;&#25463;&#38190;&#32465;&#23450;&#21487;&#20197;&#29992;&#20043;&#21518;&#30340;&#25554;&#20214; counsel &#20195;&#26367;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(global-set-key (kbd "C-x C-r") 'recentf-open-files)</span>
</pre>
</div>

<p>
使用下面的配置文件将删除功能配置成与其他图形界面的编辑器相同，即当你选中一段文字 之后输入一个字符会替换掉你选中部分的文字。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(delete-selection-mode t)                    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36873;&#20013;&#25991;&#26412;&#21518;&#36755;&#20837;&#25991;&#26412;&#20250;&#26367;&#25442;&#25991;&#26412;&#65288;&#26356;&#31526;&#21512;&#25105;&#20204;&#20064;&#24815;&#20102;&#30340;&#20854;&#23427;&#32534;&#36753;&#22120;&#30340;&#36923;&#36753;&#12290;&#40664;&#35748;&#36873;&#20013;&#25918;&#21518;&#38754;</span>
</pre>
</div>

<p>
下面的这些函数可以让你找到不同函数，变量以及快捷键所定义的文件位置。 因为非常常用 所以我们建议将其设置为与查找文档类似的快捷键（如下所示），
</p>

<p>
可以把它们绑定到配置中
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#26597;&#35810;&#20989;&#25968;&#12289;&#21464;&#37327;&#12289;key &#23450;&#20041;&#30340;&#25991;&#20214;&#20301;&#32622;</span>
(global-set-key (kbd <span style="color: #8b2252;">"C-h C-f"</span>) 'find-function)
(global-set-key (kbd <span style="color: #8b2252;">"C-h C-v"</span>) 'find-variable)
(global-set-key (kbd <span style="color: #8b2252;">"C-h C-k"</span>) 'find-function-on-key)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:2ecf5bf5-4f3f-4ac9-8483-ff26c87b2382" class="outline-3">
<h3 id="h:2ecf5bf5-4f3f-4ac9-8483-ff26c87b2382"><span class="section-number-3">1.9.</span> Emacs作为超级前端</h3>
<div class="outline-text-3" id="text-h:2ecf5bf5-4f3f-4ac9-8483-ff26c87b2382">
<p>
可以非常快的找到文件或目录
</p>
</div>
<div id="outline-container-h:learn-funcs-front-explorer" class="outline-4">
<h4 id="h:learn-funcs-front-explorer"><span class="section-number-4">1.9.1.</span> 使用 Emacs 来打开文件管理器</h4>
<div class="outline-text-4" id="text-h:learn-funcs-front-explorer">
<p>
我的emacs模块配置<a href="#h:j-embark">(<code>j-embark.el</code> 库)</a>
</p>

<p>
windows 用户
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(shell-command-to-string <span style="color: #8b2252;">"explorer.exe C:\\"</span>)

<span style="color: #b22222;">;;</span><span style="color: #b22222;">(shell-command-to-string "explorer.exe ~/.emacs.d") ; windows &#19981;&#35782;&#21035;~</span>

(shell-command-to-string
 (encode-coding-string
  (replace-regexp-in-string <span style="color: #8b2252;">"/"</span> <span style="color: #8b2252;">"\\\\\\\\"</span>
                (format <span style="color: #8b2252;">"explorer.exe %s"</span> (expand-file-name <span style="color: #8b2252;">"~/.emacs.d"</span>)))
  'gbk))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">consult-directory-externally</span> (file)
  <span style="color: #8b2252;">"Open FILE externally using the default application of the system."</span>
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"fOpen externally: "</span>)
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (eq system-type 'windows-nt)
           (fboundp 'w32-shell-execute))
      (shell-command-to-string (encode-coding-string (replace-regexp-in-string <span style="color: #8b2252;">"/"</span> <span style="color: #8b2252;">"\\\\\\\\"</span>
            (format <span style="color: #8b2252;">"explorer.exe %s"</span> (file-name-directory (expand-file-name file)))) <span style="color: #ff0000; font-weight: bold;">'gbk))</span>
    (call-process (<span style="color: #a020f0;">pcase</span> system-type
                    ('darwin <span style="color: #8b2252;">"open"</span>)
                    ('cygwin <span style="color: #8b2252;">"cygstart"</span>)
                    (_ <span style="color: #8b2252;">"xdg-open"</span>))
                  nil 0 nil
                  (file-name-directory (expand-file-name file)))))

(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">embark</span>)
(define-key embark-file-map (kbd <span style="color: #8b2252;">"E"</span>) #'consult-directory-externally)


<span style="color: #b22222;">;;</span><span style="color: #b22222;">&#25171;&#24320;&#24403;&#21069;&#25991;&#20214;&#30340;&#30446;&#24405;</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-open-current-directory</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (consult-directory-externally default-directory))
</pre>
</div>

<p>
快速打开文件所在目录：
</p>
<ul class="org-ul">
<li><code>M-x consult-directory-externally</code> 输入文件路径，如 <code>~/.emacs.d/auto-save-list/.saves-2000-JASPER~</code></li>
<li><code>C-x C-f</code> 选择文件时，可以用embark来打开， <code>C;</code> 选择E，用文件管理器打开对应目录的</li>
</ul>
</div>
</div>
<div id="outline-container-h:learn-completion-minibuffer-4-1" class="outline-4">
<h4 id="h:learn-completion-minibuffer-4-1"><span class="section-number-4">1.9.2.</span> 增强 embark 和 consult，批量搜索替换大杀器</h4>
<div class="outline-text-4" id="text-h:learn-completion-minibuffer-4-1">
<p>
我的emacs模块配置<a href="#h:completion-minibuffer-4-1">(<code>init-completion.el</code> 增强 embark 和 consult，批量搜索替换大杀)</a>
</p>

<p>
性能： grep &lt; ack &lt; ag &lt; ripgrep(rg)
</p>

<p>
使用ripgrep来进行搜索, <code>M-x consult-ripqgrep</code> 搜索hello 会出现报错找不到rg命令。
</p>

<pre class="example" id="org70a377f">
Error running timer: (file-missing "Searching for program" "No such file or directory" "rg")
</pre>

<p>
下载ripgrep: <a href="https://github.com/BurntSushi/ripgrep">https://github.com/BurntSushi/ripgrep</a> msys2 <a href="https://packages.msys2.org/base/mingw-w64-ripgrep">https://packages.msys2.org/base/mingw-w64-ripgrep</a>
</p>

<p>
安装方式：
</p>
<ul class="org-ul">
<li>PC msys2 <code>pacman -S mingw-w64-x86_64-ripgrep</code></li>
<li>PC github release 下载windows包，解压并加入到PARH变量中</li>
<li>Arch Linux  <code>sudo pacman -S ripgrep</code></li>
<li>macOS <code>brew install ripgrep</code></li>
</ul>

<p>
再使用ripgrep来进行搜索, <code>M-x consult-ripgrep</code> 搜索hello ，所有当前目录下包含hello字符串的信息都在minibuffer中展示出来了。 使用 <code>C-n</code> 或 <code>C-p</code> 来预览文件或进入文件里。
</p>

<p>
<b>下面介绍批量修改插件</b>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#25209;&#37327;&#20462;&#25913;</span>
(package-install 'embark-consult)
(package-install 'wgrep)
(<span style="color: #a020f0;">setq</span> wgrep-auto-save-buffer t)

(eval-after-load 'consult
  '(eval-after-load 'embark
     '(progn
        (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">embark-consult</span>)
        (add-hook 'embark-collect-mode-hook #'consult-preview-at-point-mode)))) <span style="color: #b22222;">;</span><span style="color: #b22222;">hook &#31532;&#19968;&#20010;&#21442;&#25968;&#25191;&#34892;&#21069;&#65292;&#20808;&#25191;&#34892;&#31532;2&#20010;&#21442;&#25968;&#30340;&#21151;&#33021;</span>

(define-key minibuffer-local-map (kbd <span style="color: #8b2252;">"C-c C-e"</span>) 'embark-export-write)

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">embark-export-write</span> ()
  <span style="color: #8b2252;">"Export the current vertico results to a writable buffer if possible.</span>
<span style="color: #8b2252;">Supports exporting consult-grep to wgrep, file to wdeired, and consult-location to occur-edit"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">embark</span>)
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">wgrep</span>)
  (<span style="color: #a020f0;">pcase-let</span> ((`(,type . ,candidates)
               (run-hook-with-args-until-success 'embark-candidate-collectors)))
    (<span style="color: #a020f0;">pcase</span> type
      ('consult-grep (<span style="color: #a020f0;">let</span> ((embark-after-export-hook #'wgrep-change-to-wgrep-mode))
                       (embark-export)))
      ('file (<span style="color: #a020f0;">let</span> ((embark-after-export-hook #'wdired-change-to-wdired-mode))
               (embark-export)))
      ('consult-location (<span style="color: #a020f0;">let</span> ((embark-after-export-hook #'occur-edit-mode))
                           (embark-export)))
      (x (<span style="color: #ff0000; font-weight: bold;">user-error</span> <span style="color: #8b2252;">"embark category %S doesn't support writable export"</span> x)))))
</pre>
</div>

<p>
批量替换操作
</p>
<ul class="org-ul">
<li><code>M-x consult-ripgrep</code>  默认会在以 git 为根目录搜索。如 <code>#hello</code> ，搜索包含hello字符的文件。 <code>C-n/C-p</code> 下上搜索同时可以预览。</li>
<li><code>C-c C-e</code> 打开写</li>
<li><code>M-x query-replace-regexp</code> 输入hello 回车， 替换为hello 回车。 按 y 同意当前行替换，n 不同意修改</li>
<li><code>C-c C-c</code> 执行替换，按 q 退出</li>
</ul>


<p>
当前buffer替换操作
</p>
<ul class="org-ul">
<li><code>C-s</code> 搜索， 输入hello</li>
<li><code>C-c C-e</code> 编辑</li>
<li><code>M-x query-replace-regexp</code> 输入要替换的内容</li>
<li><code>C-c C-c</code> 执行替换，按 q 退出</li>
</ul>

<p>
<b>配置搜索中文文件</b>
</p>

<p>
<code>everything</code> 工具可以快速搜索本地文件。下载地址： <a href="https://www.voidtools.com/zh-cn/downloads/">https://www.voidtools.com/zh-cn/downloads/</a>
</p>

<p>
安装好后，同时下载 ES.exe 客户端工具加入环境变量。
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;</span><span style="color: #b22222;">everyting</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">consult-locate</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#37197;&#32622;&#25628;&#32034;&#20013;&#25991;&#25991;&#20214;</span>
(<span style="color: #a020f0;">progn</span>
  (<span style="color: #a020f0;">setq</span> consult-locate-args (encode-coding-string <span style="color: #8b2252;">"es.exe -i -p -r"</span> 'gbk))
  (add-to-list 'process-coding-system-alist '(<span style="color: #8b2252;">"es"</span> gbk . gbk))
  )
(eval-after-load 'consult
  (<span style="color: #a020f0;">progn</span>
      (<span style="color: #a020f0;">setq</span>
        consult-narrow-key <span style="color: #8b2252;">"&lt;"</span>
        consult-line-numbers-widen t
        consult-async-min-input 2         <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#25628;&#32034; 2 &#20010;&#23383;&#31526;&#26174;&#31034;&#36755;&#20986;&#12290;&#40664;&#35748; 3</span>
        consult-async-refresh-delay  0.15
        consult-async-input-throttle 0.2
        consult-async-input-debounce 0.1)
    ))
</pre>
</div>

<p>
操作：
</p>
<ul class="org-ul">
<li>前提：PC 始终打开everything, 转为 <code>ES</code> 会调用everthing</li>
<li><code>M-x consult-locate</code> 回车，输入要搜索的文件如 <code>#init.el</code> 。 可以看到minibuffer中显示的和everthing界面搜索的是一样的。</li>
<li>再输入个#号就可以使用 orderless 的功能进行过滤。如只想看29.4中init.el文件 <code>#init.el#29.4</code> 选中回车即可打开对应文件</li>
</ul>

<p>
使用外部程序打开：
</p>
<ul class="org-ul">
<li><code>M-x consult-locate</code> 回车，输入要搜索的文件. 如搜索projeckt中的txt文件 <code>#\.txt#project</code></li>
<li>使用embark <code>C;</code>  按x使用外部程序打开txt文件</li>
</ul>

<p>
中文搜索操作：
</p>
<ul class="org-ul">
<li><code>M-x consult-locate</code> 回车，输入要搜索的文件. 如 <code>#学习</code></li>
</ul>
</div>
</div>
<div id="outline-container-h:learn-tools-search-pinyin" class="outline-4">
<h4 id="h:learn-tools-search-pinyin"><span class="section-number-4">1.9.3.</span> 使用拼音进行搜索</h4>
<div class="outline-text-4" id="text-h:learn-tools-search-pinyin">
<p>
我的emacs模块配置<a href="#h:completion-consult">(<code>init-completion.el</code> 增强文件内搜索 <code>consult</code>)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20351;&#29992;&#25340;&#38899;&#36827;&#34892;&#25628;&#32034;</span>
(package-install 'pyim)

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">eh-orderless-regexp</span> (orig_func component)
  (<span style="color: #a020f0;">let</span> ((result (funcall orig_func component)))
    (pyim-cregexp-build result)))


(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">toggle-chinese-search</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (not (advice-member-p #'eh-orderless-regexp 'orderless-regexp))
      (advice-add 'orderless-regexp <span style="color: #483d8b;">:around</span> #'eh-orderless-regexp)
    (advice-remove 'orderless-regexp #'eh-orderless-regexp)))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">disable-py-search</span> (<span style="color: #228b22;">&amp;optional</span> args)
  (<span style="color: #a020f0;">if</span> (advice-member-p #'eh-orderless-regexp 'orderless-regexp)
      (advice-remove 'orderless-regexp #'eh-orderless-regexp)))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">(advice-add 'exit-minibuffer :after #'disable-py-search)</span>
(add-hook 'minibuffer-exit-hook 'disable-py-search) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#36864;&#20986;minibuffer&#26102;&#33258;&#21160;&#36864;&#20986;&#25340;&#38899;&#25628;&#32034;</span>

(global-set-key (kbd <span style="color: #8b2252;">"s-p"</span>) 'toggle-chinese-search) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#38656;&#35201;&#26102;&#25171;&#24320;&#25340;&#38899;&#25628;&#32034;&#12290;&#22240;&#20026;&#25340;&#38899;&#25628;&#32034;&#24615;&#33021;&#19981;&#31283;&#23450;</span>
</pre>
</div>

<p>
中文拼音操作：
</p>
<ul class="org-ul">
<li>前提：PC 始终打开everything, 转为ES会调用everthing</li>
<li><code>M-x consult-locate</code> 回车，输入要搜索的文件. 如打包含“学习”的txt文件 <code>#\.txt#</code> 按 <code>s-p</code> 输入 <code>#\.txt#xx</code>  可以看到过滤学习的txt文件</li>
</ul>
</div>
</div>
<div id="outline-container-h:342e2bb3-0963-4047-bbfe-9949e17d186c" class="outline-4">
<h4 id="h:342e2bb3-0963-4047-bbfe-9949e17d186c"><span class="section-number-4">1.9.4.</span> 更换主题</h4>
<div class="outline-text-4" id="text-h:342e2bb3-0963-4047-bbfe-9949e17d186c">
<p>
customize theme 内置主题
</p>

<p>
自带的主题颜色，可以使用 <code>M-x customize themes</code> 图形化来选择，或者使用命令 <code>load-theme 主题</code> 。如 <code>M-x load-theme light-blue</code>
</p>

<ul class="org-ul">
<li>leuven，我最喜欢的亮色主题之一了。其实它也有暗色主题，只是没有内置。</li>
<li>modus，应该是从Emacs 28开始内置的一款包含亮/暗色的主题。非常好，我很喜欢。暗色有的时候，我感觉眼睛有点累。</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(load-theme 'tango-dark)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:78e61272-d6f7-45f9-aeca-948b68f16d02" class="outline-3">
<h3 id="h:78e61272-d6f7-45f9-aeca-948b68f16d02"><span class="section-number-3">1.10.</span> 模块化配置</h3>
<div class="outline-text-3" id="text-h:78e61272-d6f7-45f9-aeca-948b68f16d02">
</div>
<div id="outline-container-h:dcefc61f-9fbc-4c17-b9c6-043b131b3437" class="outline-4">
<h4 id="h:dcefc61f-9fbc-4c17-b9c6-043b131b3437"><span class="section-number-4">1.10.1.</span> 使用多文件存储配置文件</h4>
<div class="outline-text-4" id="text-h:dcefc61f-9fbc-4c17-b9c6-043b131b3437">
<p>
创建 custom.el 文件
</p>

<p>
一些自动生成的配置会自动写到这里。默认是写到init.el文件结尾的。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> custom-file (expand-file-name <span style="color: #8b2252;">"~/custom.el"</span>)) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#27809;&#26377;&#21017;&#33258;&#21160;&#21019;&#24314;</span>
(load custom-file 'no-error 'no-message)
</pre>
</div>

<p>
拆分init.el文件
</p>

<pre class="example" id="orgefad118">
#----------
├── custom.el
├── early-init.el              #启动前初始化
├── init.el                    #主配置
├── lisp
│   ├── init-package.el        #插件源
│   ├── init-basic.el          #默认的配置
│   ├── init-ui.el             #视觉相关
│   ├── init-completion.el     #补全
│   ├── init-tools.el
│   ├── init-org.el
│   ├── init-keybindings.el
│   ├── init-funcs.el          #自定义函数
│   ├── init-c.el
</pre>

<p>
加载配置
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-to-list 'load-path
    (expand-file-name (concat user-emacs-directory <span style="color: #8b2252;">"lisp"</span>)))
</pre>
</div>

<p>
各个文件通过 provide 暴露对外调用的名称。如：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">init-basic</span>)
</pre>
</div>

<p>
然后在 init.el 文件中通过 `require` 调用：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">require 'init-basic
</pre>
</div>
</div>
</div>
<div id="outline-container-h:cb5979bf-baeb-48b0-abd7-0f54495dd006" class="outline-4">
<h4 id="h:cb5979bf-baeb-48b0-abd7-0f54495dd006"><span class="section-number-4">1.10.2.</span> 使用Org-mode 管理 Emacs 配置</h4>
<div class="outline-text-4" id="text-h:cb5979bf-baeb-48b0-abd7-0f54495dd006">
<p>
官方文档：<a href="https://orgmode.org/manual/Extracting-Source-Code.html">https://orgmode.org/manual/Extracting-Source-Code.html</a>
</p>

<p>
Org-mode 下的文学编程将颠覆你对于 Emacs 的看法。因为我们也可以使用 Org 来管理 Emacs 的配置文件。
</p>

<p>
我们可以让我们的配置文件更加清晰有序，并且可以添加很多注释之外的资料、链接等，让我们的配置更加易读和可管理。
</p>

<ul class="org-ul">
<li>创建org文件。如 <code>~/.emacs.d/emacs-config.org</code></li>
<li><p>
代码块
它能够自动的将代码块里的代码，写入到指定的文件里去，不指定默认在当前目录生成与文件同名.el文件。
</p>

<p>
而且它的配置方式也非常灵活：
</p>
<ul class="org-ul">
<li>代码块配置tangle</li>
<li>标题行配置tangle</li>
</ul></li>

<li>执行 <code>M-x org-babel-tangle</code> 命令来触发 tangle 这个动作。</li>
</ul>

<p>
范例-代码块配置tangle
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">+BEGIN_SRC emacs-lisp :tangle ~/.emacs.d/test.el</span>
  (+ 1 2)
<span style="color: #b22222;">#</span><span style="color: #b22222;">+END_SRC</span>
</pre>
</div>

<p>
执行 <code>M-x org-babel-tangle</code> ，代码 (+ 1 2) 将写入到 ~/.emacs.d/test.el 这个文件里。
</p>

<p>
范例-标题行配置tangle
</p>
<div class="org-src-container">
<pre class="src src-sh">* early-init.el
:PROPERTIES:
:HEADER-ARGS: :tangle early-init.el
:END
</pre>
</div>

<p>
支持的参数
</p>
<ul class="org-ul">
<li>代码不写到文件 :tangle no</li>
<li><p>
创建目录,  :mkdir yes
</p>

<p>
<code>C-c C-v C-d</code> org-babel-demarcate-block 代码划分为2块
</p></li>
</ul>

<p>
<b>添加代码块</b>
</p>

<ul class="org-ul">
<li>旧版使用快捷键 <code>&lt; + 快捷码 + TAB</code> 。
<ul class="org-ul">
<li>如代码块 <code>&lt;s + Tab</code> 可以直接插入代码块的代码片段（Snippet）</li>
</ul></li>
<li>从 orgmode 9.2 版本后， <code>org-insert-structure-template</code> 变为 <code>C-c C-,</code> 给出列表选择</li>
</ul>


<p>
还想使用旧版快捷键
<a id="orgce33344"></a>
</p>

<p>
我的emacs模块配置<a href="#h:org-built-in">(<code>init-org.el</code> 内置配置)</a>
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> 'org
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-tempo</span>))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#31105;&#29992;&#24038;&#23574;&#25324;&#21495;</span>
(<span style="color: #a020f0;">setq</span> electric-pair-inhibit-predicate
      `(<span style="color: #a020f0;">lambda</span> (c)
         (<span style="color: #a020f0;">if</span> (char-equal c ?\&lt;) t (,electric-pair-inhibit-predicate c))))

(add-hook 'org-mode-hook
          (<span style="color: #a020f0;">lambda</span> ()
            (<span style="color: #a020f0;">setq-local</span> electric-pair-inhibit-predicate
                        `(<span style="color: #a020f0;">lambda</span> (c)
                           (<span style="color: #a020f0;">if</span> (char-equal c ?\&lt;) t (,electric-pair-inhibit-predicate c))))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> org-src-preserve-indentation t)             <span style="color: #b22222;">; </span><span style="color: #b22222;">&#32534;&#36753;&#28304;&#20195;&#30721;&#26102;&#20445;&#30041;&#21407;&#26377;&#30340;&#32553;&#36827;&#65292;t&#20195;&#34920;&#21551;&#29992;&#35813;&#21151;&#33021;&#12290;&#40664;&#35748;nil&#19981;&#20445;&#30041;. </span>
(<span style="color: #a020f0;">setq</span> org-src-tab-acts-natively t)                <span style="color: #b22222;">; </span><span style="color: #b22222;">&#28304;&#20195;&#30721;&#32534;&#36753;&#27169;&#24335;&#19979;&#65292;Tab&#38190;&#30340;&#34892;&#20026;&#19982;&#21407;&#29983;&#20195;&#30721;&#32534;&#36753;&#22120;&#19968;&#33268;&#65292;t&#20195;&#34920;&#21551;&#29992;&#35813;&#21151;&#33021;,  &#40664;&#35748;t</span>
(<span style="color: #a020f0;">setq</span> org-edit-src-content-indentation 0)          <span style="color: #b22222;">; </span><span style="color: #b22222;">&#20195;&#30721;&#22359;&#37324;&#32553;&#36827;&#65292;0&#19981;&#32553;&#36827;&#65292;&#40664;&#35748;&#26159;2 (&#37325;&#35201;)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:0ef565c4-904d-4863-9c8b-7462407b2659" class="outline-3">
<h3 id="h:0ef565c4-904d-4863-9c8b-7462407b2659"><span class="section-number-3">1.11.</span> 模块列表</h3>
<div class="outline-text-3" id="text-h:0ef565c4-904d-4863-9c8b-7462407b2659">
<p>
1
</p>

<ul class="org-ul">
<li>文件搜索键位绑定 <a href="#h:keybindings-search-file">我的emacs模块配置(<code>init-keybindings.el</code> 文件搜索)</a></li>
</ul>

<p>
2.一些好用的包
</p>

<ul class="org-ul">
<li>restart-emacs</li>

<li>savehist 记住使用过的命令<a href="#h:basic-session">(<code>init-basic.el</code> 历史命令 <code>savehist</code>)</a></li>
<li>显示文件行、列、大小 ，美化状态栏
<ul class="org-ul">
<li>simple<a href="#h:basic-simple">(<code>init-basic.el</code> 内置包 <code>simple</code>)</a></li>
<li>keycast<a href="#h:modeline-keycast">(<code>init-modeline.el</code> 按键显示 <code>keycast</code>)</a></li>
<li>doom-modeline <a href="#h:ui-doom-emacs">(<code>init-ui.el</code> 主题 <code>doom-emacs</code>)</a></li>
</ul></li>
</ul>

<p>
3.org
</p>
<ul class="org-ul">
<li>org todo<a href="#h:org-todo">(<code>init-org.el</code> org todo)</a></li>
<li>org agenda<a href="#h:org-agenda">(<code>init-org.el</code> org agenda)</a></li>
<li>org capture<a href="#h:org-capture">(<code>init-org.el</code> org capture)</a></li>
<li>org effect<a href="#h:org-effect">(<code>init-org.el</code> org effect)</a></li>
<li>org tags<a href="#h:org-tags">(<code>init-org.el</code> org tags)</a></li>
<li>org priority<a href="#h:org-priority">(<code>init-org.el</code> org priority)</a></li>
</ul>

<p>
4
</p>
<ul class="org-ul">
<li>ox-hugo来写博客</li>
<li>eglot emacs29版本内置<a href="#h:c++-eglot">(<code>init-programming.el</code> 代码编写 <code>eglot</code>)</a></li>
</ul>

<p>
5.evil
<a id="orgbdfc449"></a>
</p>

<p>
前期vim用户快速切emacs用户
</p>

<ul class="org-ul">
<li>evil<a href="#h:evil">(<code>init-evil.el</code>)</a></li>
</ul>

<p>
6.精选 packages, 大大提升你的 Emacs 编辑效率
<a id="org226e72b"></a>
</p>

<ul class="org-ul">
<li>多光标操作 iedit &amp; evil-multiedit<a href="#h:tools-iedit">(<code>init-tools.el</code> 多光标操作 iedit &amp; evil-multiedit)</a></li>
<li>expand-region<a href="#h:tools-expand-region">(<code>init-tools.el</code> 快速选中区域 <code>expand-region</code>)</a> <a href="#h:j-expand-region">(<code>j-expand-region.el</code> 库)</a></li>
<li>interactive replace交互式替换文本<a href="#h:evil-init">(<code>init-evil.el</code> 安装)</a> <a href="#h:j-evil">(<code>j-evil.el</code> 库)</a></li>
<li>安装 quelpa 插件<a href="#h:packages-quelpa">(<code>init-packages.el</code> 安装 quelpa 插件)</a></li>
<li>symbol-overlay &amp; highlight-global<a href="#h:j-highlight-global">(<code>j-highlight-global.el</code> 库)</a> <a href="#h:tools-highlight-global">(<code>init-tools.el</code> 文本高亮 <code>symbol-overlay</code> &amp; <code>highlight-global</code>)</a></li>
</ul>

<p>
7.使用 Treesit + eglot 来打造现代编程 IDE
<a id="orgad1f76c"></a>
</p>

<ul class="org-ul">
<li>安装 treesit-auto 插件<a href="#h:c++-treesit-auto">(<code>init-programming.el</code> 语法高亮 <code>treesit-auto</code>)</a></li>
<li>跳转函数列表 consult-imenup<a href="#h:c++-consult-imenu">(<code>init-programming.el</code> 跳转函数列表 consult-imenu)</a></li>
<li>查找定义和引用</li>
<li>添加 snippets 支持</li>
<li>在头文件和源文件之间进行跳转</li>
</ul>

<p>
8.窗口
<a id="org638edf8"></a>
</p>

<ul class="org-ul">
<li>windows<a href="#h:window">(<code>init-window.el</code>)</a></li>
</ul>

<p>
9.工作区间管理
</p>
<ul class="org-ul">
<li>personspace<a href="#h:personspace">(<code>init-persp.el</code> 工作区间管理)</a></li>
</ul>

<p>
10.org 进阶
</p>
<ul class="org-ul">
<li>Org Download<a href="#h:org-jietu">(<code>init-org.el</code> org 截图)</a></li>
<li>Org Protocol<a href="#h:org-protocol">(<code>init-org.el</code> 从网页摘取内容 Org Protocol)</a></li>
<li>Spell checking<a href="#h:org-spell">(<code>init-org.el</code> 拼写检查 Spell checkin)</a></li>
<li>Fanyi Dictionary<a href="#h:org-fanyi">(<code>init-org.el</code> 翻译 Fanyi Dictionar)</a></li>
<li>Some useful keybindings</li>
</ul>

<p>
11.Org Roam
</p>
<ul class="org-ul">
<li>corfu 来进行补全</li>
<li>Org Oram</li>
<li>Org roam UI</li>
</ul>

<p>
12.Emacs 配置问题排查
</p>

<p>
13.优化性能，借鉴其他人的配置
</p>
</div>
</div>
<div id="outline-container-h:ce61a582-6604-448b-8fe4-087ecd41e650" class="outline-3">
<h3 id="h:ce61a582-6604-448b-8fe4-087ecd41e650"><span class="section-number-3">1.12.</span> 清理学习内容</h3>
<div class="outline-text-3" id="text-h:ce61a582-6604-448b-8fe4-087ecd41e650">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(write-region <span style="color: #8b2252;">""</span> nil <span style="color: #8b2252;">"~/.emacs.d/init.el"</span>)
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:680e1564-f032-4677-acdf-1d64b017cdc0" class="outline-2">
<h2 id="h:680e1564-f032-4677-acdf-1d64b017cdc0"><span class="section-number-2">2.</span> Emacs初始化 <code>early-init.el</code></h2>
<div class="outline-text-2" id="text-h:680e1564-f032-4677-acdf-1d64b017cdc0">
<p>
这是 Emacs 在启动时读取的第一个文件。它应该包含不依赖于任何包或 Emacs 帧比例的代码。初始化文件是为了在 Emacs 生成初始化之前设置一些基本的东西
</p>
</div>
<div id="outline-container-h:d5de6908-9c6e-4fdd-8d06-4059f170abfd" class="outline-3">
<h3 id="h:d5de6908-9c6e-4fdd-8d06-4059f170abfd"><span class="section-number-3">2.1.</span> <code>early-init.el</code> 对启动时间和垃圾回收的调整</h3>
<div class="outline-text-3" id="text-h:d5de6908-9c6e-4fdd-8d06-4059f170abfd">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> gc-cons-threshold (* 50 1000 1000))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:package-cache" class="outline-3">
<h3 id="h:package-cache"><span class="section-number-3">2.2.</span> <code>early-init.el</code> 初始化包缓存</h3>
<div class="outline-text-3" id="text-h:package-cache">
<p>
这里使用标准的 <code>package.el</code> 来管理我的Emacs包。
(<a href="#h:package.el"><code>init.el</code> 配置软件包</a>)
</p>
</div>
</div>
</section>
<section id="outline-container-h:84a797ae-9cef-4eb4-8144-4423d96d57d7" class="outline-2">
<h2 id="h:84a797ae-9cef-4eb4-8144-4423d96d57d7"><span class="section-number-2">3.</span> Emacs主配置文件 (<code>init.el</code>)</h2>
<div class="outline-text-2" id="text-h:84a797ae-9cef-4eb4-8144-4423d96d57d7">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">init.el --- The main init entry for Emacs -*- lexical-binding: t -*-</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Commentary:</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This file bootstraps the configuration, which is divided into</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">a number of other files.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Code:</span>


</pre>
</div>
</div>
<div id="outline-container-h:b5675d8d-07b5-4cc1-bb53-2e13d63c652d" class="outline-3">
<h3 id="h:b5675d8d-07b5-4cc1-bb53-2e13d63c652d"><span class="section-number-3">3.1.</span> <code>init.el</code> 加载前自定义配置</h3>
<div class="outline-text-3" id="text-h:b5675d8d-07b5-4cc1-bb53-2e13d63c652d">
</div>
<div id="outline-container-h:307ea5c9-d0cb-4458-8c72-fe27e44a52ba" class="outline-4">
<h4 id="h:307ea5c9-d0cb-4458-8c72-fe27e44a52ba"><span class="section-number-4">3.1.1.</span> <code>init.el</code> 判断操作系统</h4>
<div class="outline-text-4" id="text-h:307ea5c9-d0cb-4458-8c72-fe27e44a52ba">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#21028;&#26029;&#25805;&#20316;&#31995;&#32479;&#65292; &#23450;&#20041;&#19968;&#20010;&#26032;&#21464;&#37327;</span>
(<span style="color: #a020f0;">setq</span> *is-a-mac* (eq system-type 'darwin))
(<span style="color: #a020f0;">setq</span> *win64* (eq system-type 'windows-nt))
(<span style="color: #a020f0;">setq</span> *cygwin* (eq system-type 'cygwin) )
(<span style="color: #a020f0;">setq</span> *linux* (<span style="color: #a020f0;">or</span> (eq system-type 'gnu/linux) (eq system-type 'linux)) )
(<span style="color: #a020f0;">setq</span> *unix* (<span style="color: #a020f0;">or</span> *linux* (eq system-type 'usg-unix-v) (eq system-type 'berkeley-unix)) )
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:8a5ac6bd-d9f2-43f8-b0a4-64c758a747aa" class="outline-3">
<h3 id="h:8a5ac6bd-d9f2-43f8-b0a4-64c758a747aa"><span class="section-number-3">3.2.</span> <code>init.el</code> 基础配置禁用备份和锁定文件</h3>
<div class="outline-text-3" id="text-h:8a5ac6bd-d9f2-43f8-b0a4-64c758a747aa">
<p>
默认情况下，Emacs 会尝试锁定文件，以免它们被其他程序修改。它还保留备份。这些是我不需要的功能
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#31105;&#29992;&#22791;&#20221;&#21644;&#38145;&#23450;&#25991;&#20214;</span>
(<span style="color: #a020f0;">setq</span> make-backup-files nil)
(<span style="color: #a020f0;">setq</span> backup-inhibited nil) <span style="color: #b22222;">; </span><span style="color: #b22222;">Not sure if needed, given `</span><span style="color: #008b8b;">make-backup-files</span><span style="color: #b22222;">'</span>
(<span style="color: #a020f0;">setq</span> create-lockfiles nil)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:10a19e0f-2d8a-4e63-b394-f8eadd628aea" class="outline-3">
<h3 id="h:10a19e0f-2d8a-4e63-b394-f8eadd628aea"><span class="section-number-3">3.3.</span> <code>init.el</code> 指定自定义文件 custom.el</h3>
<div class="outline-text-3" id="text-h:10a19e0f-2d8a-4e63-b394-f8eadd628aea">
<p>
默认情况下，Emacs 将持久自定义写入用户的 init 文件末尾。当用户 <code>M-x customize</code> 或与之相关时，Emacs 都会写这些内容。指定自定义文件位置与init.el区分开。
</p>

<p>
将其放在/tmp目录中以使其成为一次性文件（这是该make-temp-file函数的作用）。
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#25351;&#23450;&#33258;&#24049;&#20041;&#37197;&#32622;, &#36890;&#36807;&#20351;&#23427;&#21464;&#25104;&#19968;&#27425;&#24615;&#30340;&#26469;&#31105;&#29992;&#23427;</span>
(<span style="color: #a020f0;">setq</span> custom-file (make-temp-file <span style="color: #8b2252;">"emacs-custom-"</span>)) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#27809;&#26377;&#21017;&#33258;&#21160;&#21019;&#24314;emacs-custom-&#24320;&#22836;&#38543;&#26426;&#25991;&#20214;</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(load custom-file 'no-error 'no-message)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:fdc495f8-e664-4284-a21d-bd34d0c39823" class="outline-3">
<h3 id="h:fdc495f8-e664-4284-a21d-bd34d0c39823"><span class="section-number-3">3.4.</span> <code>init.el</code> 始终从 <code>*scratch*</code> 缓冲区开始</h3>
<div class="outline-text-3" id="text-h:fdc495f8-e664-4284-a21d-bd34d0c39823">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#22987;&#32456;&#20174; *scratch* &#32531;&#20914;&#21306;&#24320;&#22987;</span>
(<span style="color: #a020f0;">setq</span> initial-buffer-choice t)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:i-dir" class="outline-3">
<h3 id="h:i-dir"><span class="section-number-3">3.5.</span> <code>init.el</code> 加载目录</h3>
<div class="outline-text-3" id="text-h:i-dir">
<p>
加载目录下所有配置
</p>
<dl class="org-dl">
<dt><code>list</code> 目录</dt><dd>各种插件配置</dd>
<dt><code>person</code> 目录</dt><dd>个人的配置</dd>
</dl>

<p>
在 <code>init.el</code> 配置中调用插件<a href="#h:i-modules">(<code>init.el</code> 加载各模块)</a>
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#21152;&#36733;&#30446;&#24405;</span>
(mapc
 (<span style="color: #a020f0;">lambda</span> (string)
   (add-to-list 'load-path (locate-user-emacs-file string)))
 '(<span style="color: #8b2252;">"lisp"</span> <span style="color: #8b2252;">"j-lisp"</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:package.el" class="outline-3">
<h3 id="h:package.el"><span class="section-number-3">3.6.</span> <code>init.el</code> 软件包 (<code>package.el</code>)</h3>
<div class="outline-text-3" id="text-h:package.el">
<p>
package.el 内置于 Emacs 中。我们不需要显式加载它，在需要时会被 use-package 调用。
early-init.el 处激活缓存<a href="#h:package-cache">(<code>early-init.el</code> 初始化包缓存)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#36719;&#20214;&#21253;</span>
(<span style="color: #a020f0;">setq</span> package-vc-register-as-project nil) <span style="color: #b22222;">; </span><span style="color: #b22222;">Emacs 30</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#35774;&#32622;&#25554;&#20214;&#28304;&#20248;&#20808;&#32423;</span>
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">package</span>)
(<span style="color: #a020f0;">setq</span> package-check-signature nil 
      load-prefer-newer t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20010;&#21035;&#26102;&#20505;&#20250;&#20986;&#29616;&#31614;&#21517;&#26657;&#39564;&#22833;&#36133;</span>
(<span style="color: #a020f0;">setq</span> package-archives
      '((<span style="color: #8b2252;">"gnu-elpa"</span> . <span style="color: #8b2252;">"https://elpa.gnu.org/packages/"</span>)
        (<span style="color: #8b2252;">"gnu-elpa-devel"</span> . <span style="color: #8b2252;">"https://elpa.gnu.org/devel/"</span>)
        (<span style="color: #8b2252;">"nongnu"</span> . <span style="color: #8b2252;">"https://elpa.nongnu.org/nongnu/"</span>)
        (<span style="color: #8b2252;">"melpa"</span> . <span style="color: #8b2252;">"https://melpa.org/packages/"</span>)))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#26368;&#22823;&#30340;&#25968;&#23383;&#20248;&#20808;&#65288;&#26410;&#25552;&#21450;&#30340;&#20248;&#20808;&#32423;&#20026; 0&#65289;</span>
(<span style="color: #a020f0;">setq</span> package-archive-priorities
      '((<span style="color: #8b2252;">"gnu-elpa"</span> . 3)
        (<span style="color: #8b2252;">"melpa"</span> . 2)
        (<span style="color: #8b2252;">"nongnu"</span> . 1)))

(<span style="color: #a020f0;">unless</span> (<span style="color: #a020f0;">bound-and-true-p</span> package--initialized)
  (package-initialize)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#21047;&#26032;&#36719;&#20214;&#28304;&#32034;&#24341;</span>

<span style="color: #b22222;">;;</span><span style="color: #b22222;">&#38450;&#27490;&#21453;&#22797;&#35843;&#29992; package-refresh-contents &#20250;&#24433;&#21709;&#21152;&#36733;&#36895;&#24230;</span>
(<span style="color: #a020f0;">when</span> (not package-archive-contents)
  (package-refresh-contents))
</pre>
</div>

<p>
强制指定某些软件的源
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">j-emacs-my-packages</span>
  '(vertico tmr)
  <span style="color: #8b2252;">"List of symbols representing the packages I develop/maintain."</span>)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#25351;&#23450;&#26576;&#20123;&#36719;&#20214;&#20351;&#29992;&#29305;&#28857;&#28304;&#23433;&#35013; </span>
(<span style="color: #a020f0;">setq</span> package-pinned-packages
      `(,@(mapcar
           (<span style="color: #a020f0;">lambda</span> (package)
             (cons package <span style="color: #8b2252;">"gnu-elpa-devel"</span>))
           j-emacs-my-packages)))
</pre>
</div>
</div>
<div id="outline-container-h:4e302b04-678d-492a-941e-5cc805b8f8a2" class="outline-4">
<h4 id="h:4e302b04-678d-492a-941e-5cc805b8f8a2"><span class="section-number-4">3.6.1.</span> <code>init.el</code> use-pacakge 插件</h4>
<div class="outline-text-4" id="text-h:4e302b04-678d-492a-941e-5cc805b8f8a2">
<p>
29版本后内置包
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">make use-package default behavior better</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">with `</span><span style="color: #008b8b;">use-package-always-ensure</span><span style="color: #b22222;">' you won't need ":ensure t" all the time</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">with `</span><span style="color: #008b8b;">use-package-always-defer</span><span style="color: #b22222;">' you won't need ":defer t" all the time</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(setq use-package-always-ensure t           ; &#33258;&#21160;&#23433;&#35013;</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">use-package-always-defer t            ; &#36719;&#20214;&#21253;&#24310;&#36831;&#21152;&#36733; </span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">use-package-enable-imenu-support t</span>
<span style="color: #b22222;">;;      </span><span style="color: #b22222;">use-package-expand-minimally t)</span>
</pre>
</div>

<p>
使用样例
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">xxx&#21253;</span>
(<span style="color: #a020f0;">use-package</span> xxx
  <span style="color: #483d8b;">:ensure</span> nil                          <span style="color: #b22222;">; </span><span style="color: #b22222;">&#30830;&#35748;&#23433;&#35013;&#65292;nil&#34920;&#31034;&#19981;&#38656;&#35201;&#23433;&#35013;&#12290;nil &#21487;&#37197;&#32622;&#20869;&#32622;&#21253;&#12290;</span>
  <span style="color: #483d8b;">:pin</span> melpa                           <span style="color: #b22222;">; </span><span style="color: #b22222;">&#25351;&#21521;&#25554;&#20214;&#28304;</span>
  <span style="color: #483d8b;">:defer</span> nil                           <span style="color: #b22222;">; </span><span style="color: #b22222;">&#26159;&#21542;&#35201;&#24310;&#36831;&#21152;&#36733;</span>
  <span style="color: #483d8b;">:demand</span> nil                          <span style="color: #b22222;">; </span><span style="color: #b22222;">&#26159;&#21542;&#31435;&#21363;&#25191;&#34892;&#65292;t &#21363;&#24573;&#30053;&#24310;&#36831;&#21152;&#36733;</span>
  <span style="color: #483d8b;">:diminish</span> (flymake <span style="color: #8b2252;">" Flym."</span>)         <span style="color: #b22222;">; </span><span style="color: #b22222;">&#29366;&#24577;&#26639;&#26174;&#31034;&#30340;&#26679;&#24335;</span>
  <span style="color: #483d8b;">:after</span> yasnippet                     <span style="color: #b22222;">; </span><span style="color: #b22222;">&#21035;&#30340;&#21253;&#23433;&#35013;&#21518;&#21551;&#21160;. &#22810;&#20010;&#21253;&#29992;&#25324;&#21495;&#25324;&#36215;&#26469;(abc ddd)</span>
  <span style="color: #483d8b;">:custom</span>                              <span style="color: #b22222;">; </span><span style="color: #b22222;">&#30456;&#24403;&#20110;(setq &lt;key&gt; &lt;value&gt;)</span>
  (ivy-use-virtual-buffers t)
  <span style="color: #483d8b;">:hook</span>                                 <span style="color: #b22222;">; </span><span style="color: #b22222;">hook&#27169;&#24335;&#30340;&#32465;&#23450;</span>
  (prog-mode . flycheck-mode)
  <span style="color: #483d8b;">:commands</span> (isearch-moccur isearch-all)    
  <span style="color: #483d8b;">:init</span>                                <span style="color: #b22222;">; </span><span style="color: #b22222;">&#22312;&#21152;&#36733;&#25554;&#20214;&#21069;&#25191;&#34892;&#19968;&#20123;&#21629;&#20196;</span>
  (<span style="color: #a020f0;">setq</span> smooth-scrolling-margin 2)
  <span style="color: #483d8b;">:config</span>                              <span style="color: #b22222;">; </span><span style="color: #b22222;">&#22312;&#21152;&#36733;&#25554;&#20214;&#21518;&#25191;&#34892;&#19968;&#20123;&#21629;&#20196;</span>
  (smooth-scrolling-mode t)
  <span style="color: #483d8b;">:bind</span>                                 <span style="color: #b22222;">; </span><span style="color: #b22222;">&#24555;&#25463;&#38190;&#30340;&#32465;&#23450;&#65292;&#20840;&#23616;</span>
  ((<span style="color: #8b2252;">"&lt;f2&gt;"</span> . xx) (<span style="color: #8b2252;">"M-p"</span> . xx2))
  <span style="color: #483d8b;">:bind</span>                                 <span style="color: #b22222;">; </span><span style="color: #b22222;">&#25351;&#23450;&#26144;&#23556;&#32465;&#23450;, bind&#21487;&#20197;&#20889;&#22810;&#20010; </span>
  ( <span style="color: #483d8b;">:map</span> global-map
    (<span style="color: #8b2252;">"&lt;insert&gt;"</span> . nil)
    (<span style="color: #8b2252;">"&lt;menu&gt;"</span> . nil)
    (<span style="color: #8b2252;">"C-z"</span> . nil) <span style="color: #b22222;">; </span><span style="color: #b22222;">I have a window manager, thanks!</span>
    (<span style="color: #8b2252;">"C-x C-z"</span> . nil) <span style="color: #b22222;">; </span><span style="color: #b22222;">same idea as above</span>
    (<span style="color: #8b2252;">"M-`"</span> . nil)
    (<span style="color: #8b2252;">"M-SPC"</span> . cycle-spacing)
    (<span style="color: #8b2252;">"M-="</span> . count-words)
    <span style="color: #483d8b;">:map</span> prog-mode-map          
    (<span style="color: #8b2252;">"c"</span> . rainbow-mode)
    ))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:i-modules" class="outline-3">
<h3 id="h:i-modules"><span class="section-number-3">3.7.</span> <code>init.el</code> 加载各个模块</h3>
<div class="outline-text-3" id="text-h:i-modules">
<p>
我把配置拆分为几个模块<a href="#h:i-dir">(<code>init.el</code> 加载目录)</a>
</p>

<p>
各个模块都记录在下面<a href="#h:modules">我的 Emacs 模块配置</a>中
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#21152;&#36733;&#27169;&#22359;</span>
(load (locate-user-emacs-file <span style="color: #8b2252;">"jasper-emacs-pre-custom.el"</span>) <span style="color: #483d8b;">:no-error</span> <span style="color: #483d8b;">:no-message</span>)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Packages</span>
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-packages</span>)
(<span style="color: #a020f0;">use-package</span> benchmark-init
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:demand</span> t
  <span style="color: #483d8b;">:config</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">To disable collection of benchmark data after init is done.</span>
  (add-hook 'after-init-hook 'benchmark-init/deactivate))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Core</span>
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-ui</span>)
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-essentials</span>)
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-basic</span>)
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-modeline</span>)
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-completion</span>)
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-evil</span>)
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-tools</span>)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">uis</span>
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-window</span>)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Tools</span>
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-org</span>)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Frameworks</span>
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-persp</span>)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Languages</span>
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-programming</span>)
<span style="color: #b22222;">;; </span><span style="color: #b22222;">personal</span>
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-keybindings</span>)
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">init-funcs</span>)

(load (locate-user-emacs-file <span style="color: #8b2252;">"jasper-emacs-post-custom.el"</span>) <span style="color: #483d8b;">:no-error</span> <span style="color: #483d8b;">:no-message</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:048fe6a9-b02a-46fd-8907-78c8c3366234" class="outline-3">
<h3 id="h:048fe6a9-b02a-46fd-8907-78c8c3366234"><span class="section-number-3">3.8.</span> <code>init.el</code> 计算启动时间</h3>
<div class="outline-text-3" id="text-h:048fe6a9-b02a-46fd-8907-78c8c3366234">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">efs/display-startup-time</span> ()
  (message <span style="color: #8b2252;">"Emacs loaded in %s with %d garbage collections."</span>
           (format <span style="color: #8b2252;">"%.2f seconds"</span>
                   (float-time
                   (time-subtract after-init-time before-init-time)))
           gcs-done))

(add-hook 'emacs-startup-hook #'efs/display-startup-time)


(<span style="color: #a020f0;">setq</span> gc-cons-threshold (* 2 1000 1000))
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:modules" class="outline-2">
<h2 id="h:modules"><span class="section-number-2">4.</span> 我的Emacs模块配置(<code>lisp/</code>)</h2>
<div class="outline-text-2" id="text-h:modules">
<p>
<code>init.el</code> 部分中，通过 <code>load-path</code> 让 Emacs 可以运行他们的代码<a href="#h:i-dir">(<code>init.el</code> 加载目录)</a>。本章的副标题定义了模块，每个模块都加载在我的 <code>init.el</code> 末尾调用<a href="#h:i-modules">(<code>init.el</code> 加载各模块)</a>
</p>
</div>
<div id="outline-container-h:20c90145-9293-4c6e-9ac5-7cd73353ed70" class="outline-3">
<h3 id="h:20c90145-9293-4c6e-9ac5-7cd73353ed70"><span class="section-number-3">4.1.</span> <code>init-packages.el</code></h3>
<div class="outline-text-3" id="text-h:20c90145-9293-4c6e-9ac5-7cd73353ed70">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">config</span>
</pre>
</div>
</div>
<div id="outline-container-h:packages-quelpa" class="outline-4">
<h4 id="h:packages-quelpa"><span class="section-number-4">4.1.1.</span> <code>init-packages.el</code> 安装 quelpa 插件</h4>
<div class="outline-text-4" id="text-h:packages-quelpa">
<p>
在学习章节提到过<a href="#org226e72b">(精选 packages, 大大提升你的 Emacs 编辑效率)</a>
</p>

<p>
emacs30版本提供vc内置包，拉取非elpa源软件包
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;</span><span style="color: #b22222;">(use-package quelpa :ensure t)</span>
(<span style="color: #a020f0;">use-package</span> quelpa
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:commands</span> quelpa
  <span style="color: #483d8b;">:config</span>
  <span style="color: #483d8b;">:custom</span>
  (quelpa-git-clone-depth 1)
  (quelpa-update-melpa-p nil)
  (quelpa-self-upgrade-p nil)
  (quelpa-checkout-melpa-p nil))
(<span style="color: #a020f0;">use-package</span> quelpa-use-package
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:init</span>
  (<span style="color: #a020f0;">setq</span> quelpa-use-package-inhibit-loading-quelpa t)
  <span style="color: #483d8b;">:demand</span> t)

(<span style="color: #a020f0;">unless</span> (package-installed-p 'quelpa-use-package)
  (quelpa
   '(quelpa-use-package
     <span style="color: #483d8b;">:fetcher</span> git
     <span style="color: #483d8b;">:url</span> <span style="color: #8b2252;">"https://github.com/quelpa/quelpa-use-package.git"</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:packages-vc" class="outline-4">
<h4 id="h:packages-vc"><span class="section-number-4">4.1.2.</span> <code>ini-package.el</code> vc <code>package-vc.el</code></h4>
<div class="outline-text-4" id="text-h:packages-vc">
<p>
<a href="https://github.com/slotThe/vc-use-package">https://github.com/slotThe/vc-use-package</a>
</p>

<p>
emacs30版本后vc内置。可以直接使用。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#28155;&#21152;vc&#23439;&#26041;&#20415;&#23433;&#35013;&#38750;elpa&#28304;&#21253;</span>
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">cl-lib</span>)
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">use-package-core</span>)

(<span style="color: #a020f0;">cl-defun</span> <span style="color: #0000ff;">slot/vc-install</span> (<span style="color: #228b22;">&amp;key</span> (fetcher <span style="color: #8b2252;">"github"</span>) repo name rev backend)
  (<span style="color: #a020f0;">let*</span> ((url (format <span style="color: #8b2252;">"https://www.%s.com/%s"</span> fetcher repo))
         (iname (<span style="color: #a020f0;">when</span> name (intern name)))
         (package-name (<span style="color: #a020f0;">or</span> iname (intern (file-name-base repo)))))
    (<span style="color: #a020f0;">unless</span> (package-installed-p package-name)
      (package-vc-install url iname rev backend))))

(<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">package-vc-use-package-keyword</span> <span style="color: #483d8b;">:vc</span>)

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">package-vc-use-package-set-keyword</span> ()
  (<span style="color: #a020f0;">unless</span> (member package-vc-use-package-keyword use-package-keywords)
    (<span style="color: #a020f0;">setq</span> use-package-keywords
          (<span style="color: #a020f0;">let*</span> ((pos (cl-position <span style="color: #483d8b;">:unless</span> use-package-keywords))
                 (head (cl-subseq use-package-keywords 0 (+ 1 pos)))
                 (tail (nthcdr (+ 1 pos) use-package-keywords)))
            (append head (list package-vc-use-package-keyword) tail)))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">use-package-normalize/:vc</span> (name-symbol keyword args)
  (<span style="color: #a020f0;">let</span> ((arg (car args)))
    (<span style="color: #a020f0;">pcase</span> arg
      ((<span style="color: #a020f0;">or</span> `nil `t) (list name-symbol))
      ((pred symbolp) args)
      ((pred listp) (<span style="color: #a020f0;">cond</span>
                     ((listp (car arg)) arg)
                     ((string-match <span style="color: #8b2252;">"^:"</span> (symbol-name (car arg))) (cons name-symbol arg))
                     ((symbolp (car arg)) args)))
      (_ nil))))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">use-package-handler/:vc</span> (name-symbol keyword args rest state)
  (<span style="color: #a020f0;">let</span> ((body (use-package-process-keywords name-symbol rest state)))
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">This happens at macro expansion time, not when the expanded code is</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">compiled or evaluated.</span>
    (<span style="color: #a020f0;">if</span> args
        (use-package-concat
         `((<span style="color: #a020f0;">unless</span> (package-installed-p ',(<span style="color: #a020f0;">pcase</span> (car args)
                                            ((pred symbolp) (car args))
                                            ((pred listp) (car (car args)))))
             (apply #'slot/vc-install ',(cdr args))))
         body)
      body)))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">package-vc-use-package-override-:ensure</span> (func name-symbol keyword ensure rest state)
  (<span style="color: #a020f0;">let</span> ((ensure (<span style="color: #a020f0;">if</span> (plist-member rest <span style="color: #483d8b;">:vc</span>)
                    nil
                  ensure)))
    (funcall func name-symbol keyword ensure rest state)))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">package-vc-use-package-activate-advice</span> ()
  (advice-add
   'use-package-handler/:ensure
   <span style="color: #483d8b;">:around</span>
   #'package-vc-use-package-override-:ensure))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">package-vc-use-package-deactivate-advice</span> ()
  (advice-remove
   'use-package-handler/:ensure
   #'package-vc-use-package-override-:ensure))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">register keyword on require</span>
(package-vc-use-package-set-keyword)
</pre>
</div>


<p>
样例：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> org-roam-ui
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:vc</span> (<span style="color: #483d8b;">:fetcher</span> <span style="color: #8b2252;">"github"</span> <span style="color: #483d8b;">:repo</span> <span style="color: #8b2252;">"org-roam/org-roam-ui"</span>))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span style="color: #8b2252;">"Load init-packages done..."</span>)
(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">init-packages</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:1a9f33d6-5ff3-4048-872d-80243061b6cb" class="outline-3">
<h3 id="h:1a9f33d6-5ff3-4048-872d-80243061b6cb"><span class="section-number-3">4.2.</span> <code>init-ui.el</code></h3>
<div class="outline-text-3" id="text-h:1a9f33d6-5ff3-4048-872d-80243061b6cb">
</div>
<div id="outline-container-h:ui-built-in" class="outline-4">
<h4 id="h:ui-built-in"><span class="section-number-4">4.2.1.</span> <code>init-ui.el</code> 内置配置</h4>
<div class="outline-text-4" id="text-h:ui-built-in">
<p>
在学习章节提到过<a href="#org0f7f12e">(外观配置)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> inhibit-startup-screen t) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#23581;&#35797;&#20851;&#25481;&#21551;&#21160;&#30028;&#38754;</span>
(<span style="color: #a020f0;">setq-default</span> cursor-type 'bar)              <span style="color: #b22222;">; </span><span style="color: #b22222;">&#26356;&#25913;&#20809;&#26631;&#30340;&#26679;&#24335;&#65292;&#40664;&#35748;&#27604;&#36739;&#31895;. &#26356;&#22810;C-h v &#26597;&#35810;&#24110;&#21161;</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(setq cursor-type 'bar)                    ;; &#26356;&#25913;&#20809;&#26631;&#30340;&#26679;&#24335;&#12290;setq&#24403;&#21069;buffer&#29983;&#25928;&#65292;&#19981;&#33021;&#20840;&#23616;&#29983;&#25928;</span>

(global-hl-line-mode t)                      <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#39640;&#20142;&#24403;&#21069;&#34892;</span>

(global-display-line-numbers-mode 1) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#26174;&#31034;&#34892;&#21495; 29&#29256;&#26412;&#12290;29&#20043;&#21069;&#29992;(global-linum-mode 1)</span>
(<span style="color: #a020f0;">setq</span> frame-title-format
      `((buffer-file-name <span style="color: #8b2252;">"%f"</span> <span style="color: #8b2252;">"%b"</span>)
        ,(format <span style="color: #8b2252;">" - GNU Emacs %s"</span> emacs-version)))


<span style="color: #b22222;">;;</span><span style="color: #b22222;">(toggle-frame-maximized)                     ; &#20840;&#23631;&#32534;&#36753;&#22120;</span>
(<span style="color: #a020f0;">setq</span>  initial-frame-alist (<span style="color: #a020f0;">quote</span> ((fullscreen . maximized))))


<span style="color: #b22222;">;;</span><span style="color: #b22222;">(set-face-attribute 'default nil :height 150) ; &#20462;&#25913;&#23383;&#21495;&#65292;&#22823;&#23567;&#20026;16pt</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">&#35753;&#40736;&#26631;&#28378;&#21160;&#26356;&#22909;&#29992;&#12290;&#40664;&#35748;&#28378;&#21160;&#24456;&#24555;</span>
(<span style="color: #a020f0;">setq</span> mouse-wheel-scroll-amount '(3 ((shift) . 1) ((control) . nil)))
(<span style="color: #a020f0;">setq</span> mouse-wheel-progressive-speed nil)

(tool-bar-mode -1)                           <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20851;&#38381;&#24037;&#20855;&#26639;&#65292;tool-bar-mode &#21363;&#20026;&#19968;&#20010; Minor Mode</span>
(scroll-bar-mode -1)                         <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20851;&#38381;&#25991;&#20214;&#28369;&#21160;&#25511;&#20214;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(menu-bar-mode -1)                        ;; &#20851;&#38381;&#33756;&#21333;&#26639; (&#19981;&#20851;&#38381;&#65292;&#20351;&#29992;&#25554;&#20214;&#26102;&#20250;&#29992;&#21040;)</span>


<span style="color: #b22222;">;;</span><span style="color: #b22222;">&#20027;&#39064;</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(load-theme 'tango-dark) ;&#36825;&#37324;&#20351;&#29992;doom-theme</span>


</pre>
</div>
</div>
</div>
<div id="outline-container-h:ui-doom-emacs" class="outline-4">
<h4 id="h:ui-doom-emacs"><span class="section-number-4">4.2.2.</span> <code>init-ui.el</code> 主题 <code>doom-emacs</code></h4>
<div class="outline-text-4" id="text-h:ui-doom-emacs">
<p>
在我的学习文章提到过(<a href="#h:0ef565c4-904d-4863-9c8b-7462407b2659">模块列表</a>)
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36825;&#37324;&#30340;&#25191;&#34892;&#39034;&#24207;&#38750;&#24120;&#37325;&#35201;&#65292;doom-modeline-mode &#30340;&#28608;&#27963;&#26102;&#26426;&#19968;&#23450;&#35201;&#22312;&#35774;&#32622;global-mode-string &#20043;&#21518;&#8216;</span>
(<span style="color: #a020f0;">use-package</span> doom-themes
  <span style="color: #483d8b;">:ensure</span> t)
(load-theme 'doom-one 1)

(<span style="color: #a020f0;">use-package</span> doom-modeline
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:custom-face</span>
  (mode-line ((t (<span style="color: #483d8b;">:height</span> 0.9))))
  (mode-line-inactive ((t (<span style="color: #483d8b;">:height</span> 0.9))))
  <span style="color: #483d8b;">:init</span>
  (doom-modeline-mode t))

(<span style="color: #a020f0;">use-package</span> nerd-icons
  <span style="color: #483d8b;">:ensure</span> t)
</pre>
</div>

<p>
现在更推荐用 <a href="https://github.com/rainstormstudio/nerd-icons.el">rainstormstudio/nerd-icons.el (github.com)</a> 。直接下载一个nerd fonts就可以 (<code>M-x nerd-icons-install-fonts</code>)或者手动下载fonts目录中的 <code>NFM.ttf</code> 。GUI和terminal都可以显示icon，大小也更统一。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36825;&#37324;&#30340;&#25191;&#34892;&#39034;&#24207;&#38750;&#24120;&#37325;&#35201;&#65292;doom-modeline-mode &#30340;&#28608;&#27963;&#26102;&#26426;&#19968;&#23450;&#35201;&#22312;&#35774;&#32622;global-mode-string &#20043;&#21518;&#8216;</span>
(<span style="color: #a020f0;">use-package</span> doom-themes
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:init</span>
  (<span style="color: #a020f0;">if</span> (display-graphic-p)
      (load-theme 'doom-solarized-light t) <span style="color: #b22222;">; </span><span style="color: #b22222;">t&#34920;&#31034;&#33258;&#21160;&#30830;&#35748;&#36816;&#34892;&#20195;&#30721;</span>
    (load-theme 'doom-tomorrow-night t)))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">(set-face-attribute 'default nil :height 150) ; &#20462;&#25913;&#23383;&#21495;&#65292;&#22823;&#23567;&#20026;16pt</span>
(set-face-attribute 'default nil <span style="color: #483d8b;">:height</span> 130) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#20462;&#25913;&#23383;&#21495;&#65292;&#22823;&#23567;&#20026;16pt</span>

(<span style="color: #a020f0;">use-package</span> doom-modeline
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:init</span>
  (<span style="color: #a020f0;">setq</span> doom-modeline-minor-modes t)
  <span style="color: #483d8b;">:custom-face</span>
  (mode-line ((t (<span style="color: #483d8b;">:height</span> 0.95))))
  (mode-line-inactive ((t (<span style="color: #483d8b;">:height</span> 0.95))))
  <span style="color: #483d8b;">:hook</span> (after-init . doom-modeline-mode))
</pre>
</div>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span style="color: #8b2252;">"Load init-ui done..."</span>)
(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">init-ui</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:8c9e81fb-48a0-41da-b9e0-1e3cfdee7f51" class="outline-3">
<h3 id="h:8c9e81fb-48a0-41da-b9e0-1e3cfdee7f51"><span class="section-number-3">4.3.</span> <code>init-essentials.el</code></h3>
<div class="outline-text-3" id="text-h:8c9e81fb-48a0-41da-b9e0-1e3cfdee7f51">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;; </span><span style="color: #b22222;">&#24120;&#35268;&#35774;&#32622;&#21644;&#24120;&#29992;&#33258;&#23450;&#20041;&#20989;&#25968;(j-simple.el)</span>
</pre>
</div>
</div>
<div id="outline-container-h:d5590309-993e-442e-93ac-e0a6d11763af" class="outline-4">
<h4 id="h:d5590309-993e-442e-93ac-e0a6d11763af"><span class="section-number-4">4.3.1.</span> <code>init-essentials.el</code> 自定义命令 <code>j-simple.el</code></h4>
<div class="outline-text-4" id="text-h:d5590309-993e-442e-93ac-e0a6d11763af">
<p>
自定义命令(<a href="#h:1ff292d7-21a0-4f9b-a00d-52a6be5ef3f6"> <code>j-simple.el</code> 库</a>)
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> j-simple
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:demand</span> t
  <span style="color: #483d8b;">:bind</span>
  ( (<span style="color: #8b2252;">"ESC ESC"</span> . j-simple-keyboard-quit-dwim)
    (<span style="color: #8b2252;">"C-g"</span> . j-simple-keyboard-quit-dwim)
    (<span style="color: #8b2252;">"C-M-SPC"</span> . j-simple-mark-sexp)   <span style="color: #b22222;">; </span><span style="color: #b22222;">&#36873;&#20013;&#21306;&#22495;</span>
    ))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span style="color: #8b2252;">"Load init-essentials done..."</span>)
(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">init-essentials</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:eeccf037-bcb1-4a96-b965-0339735c3105" class="outline-3">
<h3 id="h:eeccf037-bcb1-4a96-b965-0339735c3105"><span class="section-number-3">4.4.</span> <code>init-basic.el</code></h3>
<div class="outline-text-3" id="text-h:eeccf037-bcb1-4a96-b965-0339735c3105">
</div>
<div id="outline-container-h:basic-default" class="outline-4">
<h4 id="h:basic-default"><span class="section-number-4">4.4.1.</span> <code>init-basic.el</code> 一些默认的配置</h4>
<div class="outline-text-4" id="text-h:basic-default">
<p>
这里涉及到改键<a href="#h:learn-key">(改键)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#19968;&#20123;&#40664;&#35748;&#30340;&#37197;&#32622;</span>
<span style="color: #b22222;">;;;</span>
(<span style="color: #a020f0;">setq</span> w32-apps-modifier 'super)       <span style="color: #b22222;">;</span><span style="color: #b22222;">PC &#36890;&#36807;SharpKeys&#25913;&#25104;&#20102; Application</span>

(global-set-key (kbd <span style="color: #8b2252;">"s-a"</span>) 'mark-whole-buffer) <span style="color: #b22222;">;;</span><span style="color: #b22222;">&#23545;&#24212;Windows&#19978;&#38754;&#30340;Ctrl-a &#20840;&#36873;</span>
(global-set-key (kbd <span style="color: #8b2252;">"s-c"</span>) 'kill-ring-save) <span style="color: #b22222;">;;</span><span style="color: #b22222;">&#23545;&#24212;Windows&#19978;&#38754;&#30340;Ctrl-c &#22797;&#21046;</span>
(global-set-key (kbd <span style="color: #8b2252;">"s-s"</span>) 'save-buffer) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#23545;&#24212;Windows&#19978;&#38754;&#30340;Ctrl-s &#20445;&#23384;</span>
(global-set-key (kbd <span style="color: #8b2252;">"s-v"</span>) 'yank) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#23545;&#24212;Windows&#19978;&#38754;&#30340;Ctrl-v &#31896;&#36148;</span>
(global-set-key (kbd <span style="color: #8b2252;">"s-z"</span>) 'undo) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#23545;&#24212;Windows&#19978;&#38754;&#30340;Ctrol-z &#25764;&#38144;</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#26597;&#35810;&#20989;&#25968;&#12289;&#21464;&#37327;&#12289;key &#23450;&#20041;&#30340;&#25991;&#20214;&#20301;&#32622;</span>
(global-set-key (kbd <span style="color: #8b2252;">"C-h C-f"</span>) 'find-function)
(global-set-key (kbd <span style="color: #8b2252;">"C-h C-v"</span>) 'find-variable)
(global-set-key (kbd <span style="color: #8b2252;">"C-h C-k"</span>) 'find-function-on-key)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#35774;&#32622;&#31995;&#32479;&#30340;&#32534;&#30721;&#65292;&#36991;&#20813;&#21508;&#22788;&#30340;&#20081;&#30721;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">UTF-8 as the default coding system</span>
(<span style="color: #a020f0;">when</span> (fboundp 'set-charset-priority)
  (set-charset-priority 'unicode))
(prefer-coding-system 'utf-8)
(set-default-coding-systems 'utf-8)
(set-terminal-coding-system 'utf-8)
(set-keyboard-coding-system 'utf-8)
(<span style="color: #a020f0;">setq</span> default-buffer-file-coding-system 'utf-8)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">emoji</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(set-fontset-font "fontset-default"</span>
<span style="color: #b22222;">;;                   </span><span style="color: #b22222;">'unicode</span>
<span style="color: #b22222;">;;                   </span><span style="color: #b22222;">(font-spec :family "Segoe UI Emoji" :size 12))</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">emoji&#34920;&#24773;&#31526;&#21495;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Noto Emoji Font &#26159;google&#24320;&#28304;&#39033;&#30446;https://fonts.google.com/noto/specimen/Noto+Emoji</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Segoe UI Emoji &#23383;&#20307; https://www.freefontdownload.org/ch/segoe-ui-emoji.font</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#19979;&#36733;&#25152;&#26377;&#34920;&#24773;&#31526;&#21495;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">MacOS</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(set-fontset-font t 'symbol (font-spec :family "Apple Color Emoji") nil 'prepend)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Windows</span>
(<span style="color: #a020f0;">when</span> (eq system-type 'windows-nt)
  (set-frame-font <span style="color: #8b2252;">"Segoe UI Emoji-12"</span> nil t))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#24320;&#21551;&#26381;&#21153;</span>
(server-mode 1)

(electric-pair-mode t)                       <span style="color: #b22222;">; </span><span style="color: #b22222;">&#25324;&#21495;&#34917;&#20840;</span>
(add-hook 'prog-mode-hook #'show-paren-mode) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#32534;&#31243;&#27169;&#24335;&#19979;&#65292;&#20809;&#26631;&#22312;&#25324;&#21495;&#19978;&#26102;&#39640;&#20142;&#21478;&#19968;&#20010;&#25324;&#21495;</span>
(delete-selection-mode t)                    <span style="color: #b22222;">; </span><span style="color: #b22222;">&#36873;&#20013;&#25991;&#26412;&#21518;&#36755;&#20837;&#25991;&#26412;&#20250;&#26367;&#25442;&#25991;&#26412;&#65288;&#26356;&#31526;&#21512;&#25105;&#20204;&#20064;&#24815;&#20102;&#30340;&#20854;&#23427;&#32534;&#36753;&#22120;&#30340;&#36923;&#36753;&#12290;&#40664;&#35748;&#36873;&#20013;&#25918;&#21518;&#38754;</span>

(global-auto-revert-mode t)                  <span style="color: #b22222;">; </span><span style="color: #b22222;">&#33258;&#21160;&#21152;&#36733;&#22806;&#37096;&#20462;&#25913;&#36807;&#30340;&#25991;&#20214;</span>
(<span style="color: #a020f0;">setq</span> auto-save-default nil)                 <span style="color: #b22222;">; </span><span style="color: #b22222;">&#20851;&#38381;&#33258;&#21160;&#20445;&#23384;&#25991;&#20214;&#65292;#&#20026;&#21518;&#32512;&#30340;&#25991;&#20214;</span>
(<span style="color: #a020f0;">setq</span> ring-bell-function 'ignore)            <span style="color: #b22222;">; </span><span style="color: #b22222;">&#20851;&#38381;&#25552;&#31034;&#22768;&#38899;</span>
(fset 'yes-or-no-p 'y-or-n-p)                <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#26576;&#20010;&#21629;&#20196;&#26102;&#38656;&#35201;&#36755;&#20837; (yes or no)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:3bd70b80-cd07-4c49-b8c0-202f525a46d6" class="outline-4">
<h4 id="h:3bd70b80-cd07-4c49-b8c0-202f525a46d6"><span class="section-number-4">4.4.2.</span> <code>init-basic.el</code> 最近编辑过的文件 <code>recentf</code></h4>
<div class="outline-text-4" id="text-h:3bd70b80-cd07-4c49-b8c0-202f525a46d6">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#26368;&#36817;&#32534;&#36753;&#36807;&#30340;&#25991;&#20214;</span>
(<span style="color: #a020f0;">use-package</span> recentf
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:bind</span> ((<span style="color: #8b2252;">"C-x C-r"</span> . recentf-open-files))
  <span style="color: #483d8b;">:hook</span> (after-init . recentf-mode)
  <span style="color: #483d8b;">:init</span> (<span style="color: #a020f0;">setq</span> recentf-max-saved-items 300
              recentf-exclude
              '(<span style="color: #8b2252;">"\\.?cache"</span> <span style="color: #8b2252;">".cask"</span> <span style="color: #8b2252;">"url"</span> <span style="color: #8b2252;">"COMMIT_EDITMSG\\'"</span> <span style="color: #8b2252;">"bookmarks"</span>
                <span style="color: #8b2252;">"\\.</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">(?:</span><span style="color: #8b2252;">gz</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">|</span><span style="color: #8b2252;">gif</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">|</span><span style="color: #8b2252;">svg</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">|</span><span style="color: #8b2252;">png</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">|</span><span style="color: #8b2252;">jpe?g</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">|</span><span style="color: #8b2252;">bmp</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">|</span><span style="color: #8b2252;">xpm</span><span style="color: #8b2252; font-weight: bold;">\\</span><span style="color: #8b2252; font-weight: bold;">)</span><span style="color: #8b2252;">$"</span>
                <span style="color: #8b2252;">"\\.?ido\\.last$"</span> <span style="color: #8b2252;">"\\.revive$"</span> <span style="color: #8b2252;">"/G?TAGS$"</span> <span style="color: #8b2252;">"/.elfeed/"</span>
                <span style="color: #8b2252;">"^/tmp/"</span> <span style="color: #8b2252;">"^/var/folders/.+$"</span> <span style="color: #8b2252;">"^/ssh:"</span> <span style="color: #8b2252;">"/persp-confs/"</span>
                (<span style="color: #a020f0;">lambda</span> (file) (file-in-directory-p file package-user-dir))))
  <span style="color: #483d8b;">:config</span>
  (<span style="color: #a020f0;">push</span> (expand-file-name recentf-save-file) recentf-exclude)
  (add-to-list 'recentf-filename-handlers #'abbreviate-file-name))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:basic-session" class="outline-4">
<h4 id="h:basic-session"><span class="section-number-4">4.4.3.</span> <code>init-basic.el</code> 历史命令 <code>savehist</code></h4>
<div class="outline-text-4" id="text-h:basic-session">
<p>
在我的学习文章提到过(<a href="#h:0ef565c4-904d-4863-9c8b-7462407b2659">模块列表</a>)
</p>

<p>
savehist-mode  默认开启，重启 emacs 会记住使用过的命令，同时会保存到 <code>~/.emacs.d/history</code> 文件中。 history 文件还保存了 minibuffer 的变量、查找过的文件等。相当于记住了上次的工作状态。
</p>

<p>
save-place-mode 开启后，会记住光标所在文件的位置，下次打开文件时自动光标指向这个位置
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">Save and restore editor sessions between restarts</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#35760;&#20303;&#20351;&#29992;&#36807;&#30340;&#21629;&#20196;</span>
(<span style="color: #a020f0;">use-package</span> savehist
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:hook</span> (after-init . savehist-mode)
  <span style="color: #483d8b;">:init</span> (<span style="color: #a020f0;">setq</span> enable-recursive-minibuffers t <span style="color: #b22222;">; </span><span style="color: #b22222;">Allow commands in minibuffers</span>
              history-length 1000
              savehist-additional-variables '(mark-ring
                                              global-mark-ring
                                              search-ring
                                              regexp-search-ring
                                              extended-command-history)
              savehist-autosave-interval 300)
  )

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#35760;&#20303;&#20809;&#26631;&#25152;&#22312;&#25991;&#20214;&#30340;&#20301;&#32622;</span>
(<span style="color: #a020f0;">use-package</span> saveplace
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:hook</span> (after-init . save-place-mode)) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#22312;emacs&#37197;&#32622;&#23436;&#20840;&#21152;&#36733;&#22909;&#20197;&#21518;&#65292;&#25191;&#34892;save-place-mode</span>
</pre>
</div>

<p>
测试：
</p>
<ul class="org-ul">
<li>记住光标的位置，重启emacs</li>
<li><code>C-x C-f</code> 重新打开该文件，可以看到光标是上次退出的位置。</li>
</ul>
</div>
</div>
<div id="outline-container-h:basic-simple" class="outline-4">
<h4 id="h:basic-simple"><span class="section-number-4">4.4.4.</span> <code>init-basic.el</code> 内置包 <code>simple</code></h4>
<div class="outline-text-4" id="text-h:basic-simple">
<p>
在我的学习文章提到过(<a href="#h:0ef565c4-904d-4863-9c8b-7462407b2659">模块列表</a>)
</p>

<p>
modeline上显示文件大小、列号
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">modeline&#19978;&#26174;&#31034;&#25991;&#20214;&#22823;&#23567;&#12289; &#21015;&#21495;</span>
(<span style="color: #a020f0;">use-package</span> simple
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:hook</span> (after-init . size-indication-mode)
  <span style="color: #483d8b;">:init</span>
  (<span style="color: #a020f0;">progn</span>
    (<span style="color: #a020f0;">setq</span> column-number-mode t)
    ))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:basic-general" class="outline-4">
<h4 id="h:basic-general"><span class="section-number-4">4.4.5.</span> <code>init-basic.el</code> 键位绑定 <code>general</code></h4>
<div class="outline-text-4" id="text-h:basic-general">
<p>
在自定义evil键位绑定用到<a href="#h:evil-custom-keybinding">(<code>init.evil.el</code> 自定义快捷键)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#33258;&#23450;&#20041;&#31867;&#20284;evil&#20013;&#30340;leader&#38190;</span>
(<span style="color: #a020f0;">use-package</span> general
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:init</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#38024;&#23545;evil&#25554;&#20214;&#12290;&#35774;&#32622;&#20102;&#19968;&#20123;&#31867;&#20284;leader&#38190;&#30340;&#20989;&#25968;. &#22914; leader &#20026;&#31354;&#26684;&#23545;&#24212;&#20989;&#25968;global-definer , leader &#20026;&#36887;&#21495;&#23545;&#24212;&#20989;&#25968;global-leader</span>
  (<span style="color: #a020f0;">with-eval-after-load</span> 'evil
    (general-add-hook 'after-init-hook
                      (<span style="color: #a020f0;">lambda</span> (<span style="color: #228b22;">&amp;rest</span> _)
                        (<span style="color: #a020f0;">when-let</span> ((messages-buffer (get-buffer <span style="color: #8b2252;">"*Messages*"</span>)))
                          (<span style="color: #a020f0;">with-current-buffer</span> messages-buffer
                            (evil-normalize-keymaps))))
                      nil
                      nil
                      t))


  (general-create-definer global-definer
    <span style="color: #483d8b;">:keymaps</span> 'override
    <span style="color: #483d8b;">:states</span> '(insert emacs normal hybrid motion visual operator)
    <span style="color: #483d8b;">:prefix</span> <span style="color: #8b2252;">"SPC"</span>
    <span style="color: #483d8b;">:non-normal-prefix</span> <span style="color: #8b2252;">"C-SPC"</span>)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#23450;&#20041;&#19968;&#20010;&#23439;&#12290;&#36825;&#20010;&#23439;&#30340;&#20316;&#29992;&#26159;&#32487;&#25215;global-dfiner&#20989;&#25968;&#30340;leader&#38190;SPC&#31354;&#26684;&#65292;&#25509;&#25910;&#19968;&#20010;inix-key&#21464;&#37327;&#30340;&#20540;&#20026;&#23376;leader</span>
  (<span style="color: #a020f0;">defmacro</span> <span style="color: #0000ff;">+general-global-menu!</span> (name infix-key <span style="color: #228b22;">&amp;rest</span> body)
    <span style="color: #8b2252;">"Create a definer named +general-global-NAME wrapping global-definer.</span>
<span style="color: #8b2252;">Create prefix map: +general-global-NAME. Prefix bindings in BODY with INFIX-KEY."</span>
    (<span style="color: #a020f0;">declare</span> (indent 2))
    `(<span style="color: #a020f0;">progn</span>
       (general-create-definer ,(intern (concat <span style="color: #8b2252;">"+general-global-"</span> name))
         <span style="color: #483d8b;">:wrapping</span> global-definer
         <span style="color: #483d8b;">:prefix-map</span> ',(intern (concat <span style="color: #8b2252;">"+general-global-"</span> name <span style="color: #8b2252;">"-map"</span>))
         <span style="color: #483d8b;">:infix</span> ,infix-key
         <span style="color: #483d8b;">:wk-full-keys</span> nil
         <span style="color: #8b2252;">""</span> '(<span style="color: #483d8b;">:ignore</span> t <span style="color: #483d8b;">:which-key</span> ,name))
       (,(intern (concat <span style="color: #8b2252;">"+general-global-"</span> name))
        ,@body)))

  (general-create-definer global-leader
    <span style="color: #483d8b;">:keymaps</span> 'override
    <span style="color: #483d8b;">:states</span> '(emacs normal hybrid motion visual operator)
    <span style="color: #483d8b;">:prefix</span> <span style="color: #8b2252;">","</span>
    <span style="color: #8b2252;">""</span> '(<span style="color: #483d8b;">:ignore</span> t <span style="color: #483d8b;">:which-key</span> (<span style="color: #a020f0;">lambda</span> (arg) `(,(cadr (split-string (car arg) <span style="color: #8b2252;">" "</span>)) . ,(replace-regexp-in-string <span style="color: #8b2252;">"-mode$"</span> <span style="color: #8b2252;">""</span> (symbol-name major-mode)))))))
</pre>
</div>

<p>
键位绑定示例：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> general
  <span style="color: #483d8b;">:init</span>
  (general-emacs-define-key 'global [remap imenu] 'consult-imenu)
  (general-emacs-define-key 'global [remap apropos] 'consult-apropos)
  (global-definer
    <span style="color: #8b2252;">"!"</span> 'shell-command)

  (+general-global-menu! <span style="color: #8b2252;">"search"</span> <span style="color: #8b2252;">"s"</span>
    <span style="color: #8b2252;">"p"</span> 'consult-ripgrep)

  (+general-global-menu! <span style="color: #8b2252;">"buffer"</span> <span style="color: #8b2252;">"b"</span>
    <span style="color: #8b2252;">"d"</span> 'kill-current-buffer)
</pre>
</div>


<p>
org-mode
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">mode specific major key</span>
(global-leader
  <span style="color: #483d8b;">:major-modes</span>
  '(org-mode t)
  <span style="color: #b22222;">;;</span><span style="color: #b22222;">and the keymaps:</span>
  <span style="color: #483d8b;">:keymaps</span>
  '(org-mode-map)
  <span style="color: #8b2252;">"p"</span> 'org-pomodoro
  <span style="color: #8b2252;">"t"</span> 'org-todo
  <span style="color: #8b2252;">"e"</span> 'org-set-effort)

(global-leader
  <span style="color: #483d8b;">:major-modes</span>
  '(org-agenda-mode t)
  <span style="color: #b22222;">;;</span><span style="color: #b22222;">and the keymaps:</span>
  <span style="color: #483d8b;">:keymaps</span>
  '(org-agenda-mode-map)
  <span style="color: #8b2252;">"d"</span> 'org-agenda-day-view
  <span style="color: #8b2252;">"w"</span> 'org-agenda-week-view
  <span style="color: #8b2252;">","</span> 'org-agenda-priority
  <span style="color: #8b2252;">"e"</span> 'org-agenda-set-effort
  <span style="color: #8b2252;">":"</span> 'org-agenda-set-tags
  <span style="color: #8b2252;">"T"</span> 'org-agenda-show-tags
  <span style="color: #8b2252;">"p"</span> 'org-pomodoro)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span style="color: #8b2252;">"Load init-basic done..."</span>)
(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">init-basic</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:basic-input" class="outline-4">
<h4 id="h:basic-input"><span class="section-number-4">4.4.6.</span> <code>init-basic.el</code> 输入法</h4>
<div class="outline-text-4" id="text-h:basic-input">
</div>
<div id="outline-container-h:a7b816c8-da82-4210-856e-07e2edd6e2c2" class="outline-5">
<h5 id="h:a7b816c8-da82-4210-856e-07e2edd6e2c2"><span class="section-number-5">4.4.6.1.</span> <code>init-basic.el</code> 输入法 <code>pyim</code></h5>
<div class="outline-text-5" id="text-h:a7b816c8-da82-4210-856e-07e2edd6e2c2">
<p>
在学习章节提到过<a href="#h:learn-tools-search-pinyin">(使用拼音进行搜索)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#36755;&#20837;&#27861; (pyim)</span>
(<span style="color: #a020f0;">use-package</span> pyim
  <span style="color: #483d8b;">:ensure</span> t)
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:800b1175-68ac-43cc-a556-6c4e0d2eccbc" class="outline-3">
<h3 id="h:800b1175-68ac-43cc-a556-6c4e0d2eccbc"><span class="section-number-3">4.5.</span> <code>init-modeline.el</code></h3>
<div class="outline-text-3" id="text-h:800b1175-68ac-43cc-a556-6c4e0d2eccbc">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">config</span>
</pre>
</div>
</div>
<div id="outline-container-h:modeline-keycast" class="outline-4">
<h4 id="h:modeline-keycast"><span class="section-number-4">4.5.1.</span> <code>init-modeline.el</code> 按键显示 <code>keycast</code></h4>
<div class="outline-text-4" id="text-h:modeline-keycast">
<p>
在我的学习文章提到过(<a href="#h:0ef565c4-904d-4863-9c8b-7462407b2659">模块列表</a>)
</p>

<p>
modeline上显示我的所有的按键和执行的命令
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">modeline&#19978;&#26174;&#31034;&#25105;&#30340;&#25152;&#26377;&#30340;&#25353;&#38190;&#21644;&#25191;&#34892;&#30340;&#21629;&#20196;</span>
(<span style="color: #a020f0;">use-package</span> keycast
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:init</span> (keycast-mode-line-mode 1)) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#22312;&#26631;&#39064;&#26174;&#31034;</span>
</pre>
</div>

<p>
在使用doom-modeline上面配置会报错。这里用下面的配置
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> keycast
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:config</span>
  (<span style="color: #a020f0;">define-minor-mode</span> <span style="color: #0000ff;">keycast-mode</span>
    <span style="color: #8b2252;">"Show current command and its key binding in the mode line (fix for use with doom-mode-line)."</span>
    <span style="color: #483d8b;">:global</span> t
    (<span style="color: #a020f0;">if</span> keycast-mode
        (add-hook 'pre-command-hook 'keycast--update t)
      (remove-hook 'pre-command-hook 'keycast--update)))
  (add-to-list 'global-mode-string '(<span style="color: #8b2252;">""</span> mode-line-keycast)))
</pre>
</div>

<p>
我的配置如下
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> keycast
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:commands</span> (+toggle-keycast)
  <span style="color: #483d8b;">:config</span>
  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">+toggle-keycast</span>()
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">if</span> (member '(<span style="color: #8b2252;">""</span> keycast-mode-line <span style="color: #8b2252;">" "</span>) global-mode-string)
        (<span style="color: #a020f0;">progn</span> (<span style="color: #a020f0;">setq</span> global-mode-string (delete '(<span style="color: #8b2252;">""</span> keycast-mode-line <span style="color: #8b2252;">" "</span>) global-mode-string))
               (remove-hook 'pre-command-hook 'keycast--update)
               (message <span style="color: #8b2252;">"Keycast OFF"</span>))
      (add-to-list 'global-mode-string '(<span style="color: #8b2252;">""</span> keycast-mode-line <span style="color: #8b2252;">" "</span>))
      (add-hook 'pre-command-hook 'keycast--update t)
      (message <span style="color: #8b2252;">"Keycast ON"</span>))))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36825;&#37324;&#30340;&#25191;&#34892;&#39034;&#24207;&#38750;&#24120;&#37325;&#35201;&#65292;doom-modeline-mode &#30340;&#28608;&#27963;&#26102;&#26426;&#19968;&#23450;&#35201;&#22312;&#35774;&#32622;global-mode-string &#20043;&#21518;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span style="color: #8b2252;">"Load init-modeline done..."</span>)
(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">init-modeline</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:c3c253e7-a1f2-44b3-8e07-adc5ec6271db" class="outline-3">
<h3 id="h:c3c253e7-a1f2-44b3-8e07-adc5ec6271db"><span class="section-number-3">4.6.</span> <code>init-completion.el</code></h3>
<div class="outline-text-3" id="text-h:c3c253e7-a1f2-44b3-8e07-adc5ec6271db">
</div>
<div id="outline-container-h:completion-built-in" class="outline-4">
<h4 id="h:completion-built-in"><span class="section-number-4">4.6.1.</span> <code>init-completion.el</code> 内置补全</h4>
<div class="outline-text-4" id="text-h:completion-built-in">
<p>
在学习章节提到过<a href="#org5843600">(补全)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20869;&#32622;&#34917;&#20840;&#21151;&#33021;n</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(setq tab-always-indent 'complete)           ;; &#20351;&#29992; TAB &#26469;&#21015;&#20986;&#24403;&#21069;&#34917;&#20840;&#36873;&#39033;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:completion-company" class="outline-4">
<h4 id="h:completion-company"><span class="section-number-4">4.6.2.</span> <code>init-completion.el</code> 补全 <code>company</code></h4>
<div class="outline-text-4" id="text-h:completion-company">
<p>
在学习章节提到过<a href="#org4727033">(Company插件)</a>
</p>


<p>
他是一个用于代码补全的插件
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">company &#34917;&#20840;&#12290; &#26367;&#25442;&#26041;&#26696; corfu &#26356;&#36731;&#37327;</span>
(<span style="color: #a020f0;">use-package</span> company
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:init</span>
  (global-company-mode t)                    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20840;&#23616;&#24320;&#21551; company &#34917;&#20840;</span>
  <span style="color: #483d8b;">:config</span>
  (<span style="color: #a020f0;">setq</span> company-idle-delay 0)                <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#34917;&#20840;&#26102;&#38388;&#24555;&#20123;</span>
  (<span style="color: #a020f0;">setq</span> company-minimum-prefix-length 1)     <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#26368;&#23569;&#36755;&#20837;1&#20010;&#23383;&#31526;&#24320;&#21551;</span>
  (<span style="color: #a020f0;">setq</span> company-show-numbers t)              <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#32473;&#36873;&#39033;&#32534;&#21495; (&#25353;&#24555;&#25463;&#38190; M-1&#12289;M-2 &#31561;&#31561;&#26469;&#36827;&#34892;&#36873;&#25321;)</span>
  (<span style="color: #a020f0;">setq</span> company-dabbrev-other-buffers 'all)  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20174;&#25152;&#26377;&#32531;&#20914;&#21306;&#25910;&#38598;&#34917;&#20840;&#20449;&#24687;</span>
  (<span style="color: #a020f0;">setq</span> company-tooltip-align-annotations t) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#21491;&#20391;&#38468;&#21152;&#27880;&#37322;</span>
  (<span style="color: #a020f0;">setq</span> company-selection-wrap-around t)
  (<span style="color: #a020f0;">setq</span> company-transformers '(company-sort-by-occurrence)) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#26681;&#25454;&#36873;&#25321;&#30340;&#39057;&#29575;&#36827;&#34892;&#25490;&#24207;&#65292;&#22914;&#26524;&#19981;&#21916;&#27426;&#21487;&#20197;&#21435;&#25481;</span>
  <span style="color: #483d8b;">:bind</span> (<span style="color: #483d8b;">:map</span> company-active-map
              (<span style="color: #8b2252;">"C-n"</span> . 'company-select-next)
              (<span style="color: #8b2252;">"C-p"</span> . 'company-select-previous)))  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20351;&#29992; `C-n` &#19982; `C-p` &#26469;&#36873;&#25321;&#34917;&#20840;&#39033;&#65292;&#40664;&#35748;&#36873;&#25321;&#19978;&#19968;&#26465;&#21644;&#19979;&#19968;&#26465;&#20505;&#36873;&#39033;&#21629;&#20196; M-n M-p</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:completion-corfu" class="outline-4">
<h4 id="h:completion-corfu"><span class="section-number-4">4.6.3.</span> <code>init-completion.el</code> 补全 <code>corfu</code></h4>
<div class="outline-text-4" id="text-h:completion-corfu">
<p>
<b>安装 corfu 来进行补全</b>
</p>

<p>
之前的company软件包可以去掉了，这个更轻量
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">corfu &#36731;&#37327;&#34917;&#20840;  &#26367;&#20195;company</span>
(<span style="color: #a020f0;">use-package</span> corfu
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:init</span>
  (<span style="color: #a020f0;">progn</span>
    (<span style="color: #a020f0;">setq</span> corfu-auto t)
    (<span style="color: #a020f0;">setq</span> corfu-cycle t)
    (<span style="color: #a020f0;">setq</span> corfu-quit-at-boundary t)
    (<span style="color: #a020f0;">setq</span> corfu-quit-no-match t)
    (<span style="color: #a020f0;">setq</span> corfu-preview-current nil)
    (<span style="color: #a020f0;">setq</span> corfu-min-width 80)
    (<span style="color: #a020f0;">setq</span> corfu-max-width 100)
    (<span style="color: #a020f0;">setq</span> corfu-auto-delay 0.2)
    (<span style="color: #a020f0;">setq</span> corfu-auto-prefix 1)
    (<span style="color: #a020f0;">setq</span> corfu-on-exact-match nil)
    (global-corfu-mode)
    ))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:completion-orderless" class="outline-4">
<h4 id="h:completion-orderless"><span class="section-number-4">4.6.4.</span> <code>init-completion.el</code> minibuffer增强 <code>orderless</code></h4>
<div class="outline-text-4" id="text-h:completion-orderless">
<p>
在学习章节提到过<a href="#org04c8521">(增强 minibuffer 补全：vertico 和 Orderless)</a>
</p>

<p>
orderless 支持 <code>M-x</code> 模糊搜索，可以无序的。 如 edebug-defun 函数搜索， <code>M-x fun debug</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">minibuffer&#22686;&#24378;&#65292;&#27169;&#31946;&#25628;&#32034; (orderless)</span>
(<span style="color: #a020f0;">use-package</span> orderless
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:after</span> minibuffer
  <span style="color: #483d8b;">:custom</span>
  (completion-styles '(orderless basic))
  (completion-category-overrides '((file (styles basic partial-completion))))
  (orderless-component-separator #'orderless-escapable-split-on-space))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:completion-consult" class="outline-4">
<h4 id="h:completion-consult"><span class="section-number-4">4.6.5.</span> <code>init-completion.el</code> 增强文件内搜索 <code>consult</code></h4>
<div class="outline-text-4" id="text-h:completion-consult">
<p>
在学习章节提到过<a href="#org46359f1">(增强文件内搜索和跳转函数定义：Consult)</a>
</p>


<p>
性能： grep &lt; ack &lt; ag &lt; ripgrep(rg)
</p>

<p>
使用ripgrep来进行搜索, <code>M-x consult-ripqgrep</code> 搜索hello 会出现报错找不到rg命令。
</p>

<pre class="example" id="org3f4a0a2">
Error running timer: (file-missing "Searching for program" "No such file or directory" "rg")
</pre>

<p>
下载ripgrep: <a href="https://github.com/BurntSushi/ripgrep">https://github.com/BurntSushi/ripgrep</a> msys2 <a href="https://packages.msys2.org/base/mingw-w64-ripgrep">https://packages.msys2.org/base/mingw-w64-ripgrep</a>
</p>

<p>
安装方式：
</p>
<ul class="org-ul">
<li>PC msys2 <code>pacman -S mingw-w64-x86_64-ripgrep</code></li>
<li>PC github release 下载windows包，解压并加入到PARH变量中</li>
<li>Arch Linux  <code>sudo pacman -S ripgrep</code></li>
<li>macOS <code>brew install ripgrep</code></li>
</ul>

<p>
再使用ripgrep来进行搜索, <code>M-x consult-ripgrep</code> 搜索hello ，所有当前目录下包含hello字符串的信息都在minibuffer中展示出来了。 使用 <code>C-n</code> 或 <code>C-p</code> 来预览文件或进入文件里。
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#22686;&#24378;&#25991;&#20214;&#20869;&#25628;&#32034;&#21644;&#36339;&#36716;&#20989;&#25968;&#23450;&#20041;(consult.el)</span>
(<span style="color: #a020f0;">use-package</span> consult
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #b22222;">;;</span><span style="color: #b22222;">replace swiper &#21487;&#20197;&#26367;&#20195;&#32769;&#30340; ivy mode &#30340; swiper &#21151;&#33021;</span>
  <span style="color: #483d8b;">:bind</span> (
         (<span style="color: #8b2252;">"C-s"</span> . consult-line) <span style="color: #b22222;">;; </span><span style="color: #b22222;">replace swipe</span>
         (<span style="color: #8b2252;">"M-s i"</span> . consult-imenu)  <span style="color: #b22222;">;</span><span style="color: #b22222;">&#36339;&#36716;&#20989;&#25968;&#23450;&#20041;</span>
         <span style="color: #b22222;">;;</span><span style="color: #b22222;">("C-x b" .  consult-buffer) ;; &#22810;&#26174;&#31034;&#26368;&#36817;&#25171;&#24320;&#25991;&#20214;&#12290;&#26367;&#25442;&#40664;&#35748; C-x b buffer</span>
         <span style="color: #b22222;">;;</span><span style="color: #b22222;">("C-c p s" . consult-ripgrep) ;;  &#26597;&#25214;&#25991;&#20214;&#20869;&#23481;&#65292;&#38656;&#35201;&#23433;&#35013; ripgrep &#21629;&#20196;</span>
         )
  )
</pre>
</div>

<p>
使用 <code>C-s</code> 搜索的内容就会在minibuffer中垂直显示，使用C-p 或 C-n来上下选择
</p>

<p>
使用 <code>M-s i</code> 跳转函数定义或者org-mode标题
</p>


<p>
<b>配置搜索中文文件</b>
</p>

<p>
everythin工具可以快速搜索本地文件。下载地址： <a href="https://www.voidtools.com/zh-cn/downloads/">https://www.voidtools.com/zh-cn/downloads/</a>
</p>

<p>
安装好后，同时下载 ES.exe 客户端工具加入环境变量。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#37197;&#32622;&#25628;&#32034;&#20013;&#25991;&#25991;&#20214;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">PC&#25552;&#21069;&#23433;&#35013; everyting &#21450;&#20854;&#23458;&#25143;&#31471;ES. &#21033;&#29992;M-x consult-locate&#25628;&#32034;</span>
(<span style="color: #a020f0;">progn</span>
  (<span style="color: #a020f0;">setq</span> consult-locate-args (encode-coding-string <span style="color: #8b2252;">"es.exe -i -p -r"</span> 'gbk))
  (add-to-list 'process-coding-system-alist '(<span style="color: #8b2252;">"es"</span> gbk . gbk))
  )
(eval-after-load 'consult
  (<span style="color: #a020f0;">progn</span>
      (<span style="color: #a020f0;">setq</span>
        consult-narrow-key <span style="color: #8b2252;">"&lt;"</span>
        consult-line-numbers-widen t
        consult-async-min-input 2         <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#25628;&#32034; 2 &#20010;&#23383;&#31526;&#26174;&#31034;&#36755;&#20986;&#12290;&#40664;&#35748; 3</span>
        consult-async-refresh-delay  0.15
        consult-async-input-throttle 0.2
        consult-async-input-debounce 0.1)
      ))
</pre>
</div>

<p>
操作：
</p>
<ul class="org-ul">
<li>前提：PC 始终打开everything, 转为ES会调用everthing</li>
<li><code>M-x consult-locate</code> 回车，输入要搜索的文件如 <code>#init.el</code> 。 可以看到minibuffer中显示的和everthing界面搜索的是一样的。</li>
<li>再输入个#号就可以使用 orderless 的功能进行过滤。如只想看29.4中init.el文件 <code>#init.el#29.4</code> 选中回车即可打开对应文件</li>
</ul>

<p>
使用外部程序打开：
</p>
<ul class="org-ul">
<li><code>M-x consult-locate</code> 回车，输入要搜索的文件. 如搜索projeckt中的txt文件 <code>#\.txt#project</code></li>
<li>使用embark <code>C;</code>  按x使用外部程序打开txt文件</li>
</ul>

<p>
中文搜索操作：
</p>
<ul class="org-ul">
<li><code>M-x consult-locate</code> 回车，输入要搜索的文件. 如 <code>#学习</code></li>
</ul>

<p>
<b>使用拼音进行搜索</b>
</p>

<p>
在学习章节提到过<a href="#h:learn-tools-search-pinyin">(使用拼音进行搜索)</a>
</p>

<p>
中文拼音操作：
</p>
<ul class="org-ul">
<li>前提：PC 始终打开everything, 转为ES会调用everthing</li>
<li><code>M-x consult-locate</code> 回车，输入要搜索的文件. 如打包含“学习”的txt文件 <code>#\.txt#</code> 按 <code>s-p</code> 输入 <code>#\.txt#xx</code>  可以看到过滤学习的txt文件</li>
</ul>


<p>
<b>修复consult-ripgrep搜索不了问题</b>
</p>

<p>
windows上有时，consult-ripgrep搜索不了
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">make consult-ripgrep work &#26377;&#26102;consult-ripgrep&#25628;&#32034;&#19981;&#20102;</span>
(<span style="color: #a020f0;">cond</span>
 <span style="color: #b22222;">;; </span><span style="color: #b22222;">macOS</span>
 ((eq system-type 'darwin)
  <span style="color: #8b2252;">"afplay"</span>)
 <span style="color: #b22222;">;; </span><span style="color: #b22222;">Windows</span>
 ((eq system-type 'windows-nt)
  (add-to-list 'process-coding-system-alist 
               '(<span style="color: #8b2252;">"[rR][gG]"</span> . (utf-8-dos . windows-1251-dos)))
  )
 (t
  <span style="color: #8b2252;">"Nothing"</span>))
</pre>
</div>



<p>
完整配置, 增加了中文搜索<a href="#h:j-consult">(<code>j-consult.el</code> 库)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#22686;&#24378;&#25991;&#20214;&#20869;&#25628;&#32034;&#21644;&#36339;&#36716;&#20989;&#25968;&#23450;&#20041;(consult.el and j-consult.el)</span>
(<span style="color: #a020f0;">use-package</span> consult
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:hook</span> (completion-list-mode . consult-preview-at-point-mode)
  <span style="color: #b22222;">;;</span><span style="color: #b22222;">replace swiper &#21487;&#20197;&#26367;&#20195;&#32769;&#30340; ivy mode &#30340; swiper &#21151;&#33021;</span>
  <span style="color: #483d8b;">:bind</span>
  ( <span style="color: #483d8b;">:map</span> global-map
    (<span style="color: #8b2252;">"M-g M-g"</span> . consult-goto-line)
    (<span style="color: #8b2252;">"C-s"</span> . consult-line) <span style="color: #b22222;">;; </span><span style="color: #b22222;">replace swipe</span>
    (<span style="color: #8b2252;">"M-s i"</span> . consult-imenu)  <span style="color: #b22222;">;</span><span style="color: #b22222;">&#36339;&#36716;&#20989;&#25968;&#23450;&#20041;</span>
    <span style="color: #b22222;">;;</span><span style="color: #b22222;">("C-x b" .  consult-buffer) ;; &#22810;&#26174;&#31034;&#26368;&#36817;&#25171;&#24320;&#25991;&#20214;&#12290;&#26367;&#25442;&#40664;&#35748; C-x b buffer</span>
    <span style="color: #b22222;">;;</span><span style="color: #b22222;">("C-c p s" . consult-ripgrep) ;;  &#26597;&#25214;&#25991;&#20214;&#20869;&#23481;&#65292;&#38656;&#35201;&#23433;&#35013; ripgrep &#21629;&#20196;</span>
    )
  <span style="color: #483d8b;">:config</span>
  (<span style="color: #a020f0;">setq</span>
   consult-narrow-key <span style="color: #8b2252;">"&lt;"</span>
   consult-line-numbers-widen t
   consult-async-min-input 2         <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#25628;&#32034; 2 &#20010;&#23383;&#31526;&#26174;&#31034;&#36755;&#20986;&#12290;&#40664;&#35748; 3</span>
   consult-async-refresh-delay  0.15
   consult-async-input-throttle 0.2
   consult-async-input-debounce 0.1
   consult-line-start-from-top t)
  )

(<span style="color: #a020f0;">use-package</span> j-consult
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #b22222;">;;</span><span style="color: #b22222;">:after (consult orderless)</span>
  <span style="color: #b22222;">;;</span><span style="color: #b22222;">:demand t</span>
  <span style="color: #483d8b;">:config</span>

  (<span style="color: #a020f0;">setq</span>
   consult-narrow-key <span style="color: #8b2252;">"&lt;"</span>
   consult-line-numbers-widen t
   consult-async-min-input 5         <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#25628;&#32034; 2 &#20010;&#23383;&#31526;&#26174;&#31034;&#36755;&#20986;&#12290;&#40664;&#35748; 3</span>
   consult-async-refresh-delay  0.15
   consult-async-input-throttle 0.2
   consult-async-input-debounce 0.1
   consult-line-start-from-top t)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20351;&#29992;&#25340;&#38899;&#36827;&#34892;&#25628;&#32034;&#25991;&#20214; (pyim)</span>
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">pyim</span>)

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">eh-orderless-regexp</span> (orig_func component)
    (<span style="color: #a020f0;">let</span> ((result (funcall orig_func component)))
      (pyim-cregexp-build result)))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">toggle-chinese-search</span> ()
    (<span style="color: #a020f0;">interactive</span>)
    (<span style="color: #a020f0;">if</span> (not (advice-member-p #'eh-orderless-regexp 'orderless-regexp))
        (advice-add 'orderless-regexp <span style="color: #483d8b;">:around</span> #'eh-orderless-regexp)
      (advice-remove 'orderless-regexp #'eh-orderless-regexp)))

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">disable-py-search</span> (<span style="color: #228b22;">&amp;optional</span> args)
    (<span style="color: #a020f0;">if</span> (advice-member-p #'eh-orderless-regexp 'orderless-regexp)
        (advice-remove 'orderless-regexp #'eh-orderless-regexp)))

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(advice-add 'exit-minibuffer :after #'disable-py-search)</span>
  (add-hook 'minibuffer-exit-hook 'disable-py-search) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#36864;&#20986;minibuffer&#26102;&#33258;&#21160;&#36864;&#20986;&#25340;&#38899;&#25628;&#32034;</span>

  (global-set-key (kbd <span style="color: #8b2252;">"s-p"</span>) 'toggle-chinese-search) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#38656;&#35201;&#26102;&#25171;&#24320;&#25340;&#38899;&#25628;&#32034;&#12290;&#22240;&#20026;&#25340;&#38899;&#25628;&#32034;&#24615;&#33021;&#19981;&#31283;&#23450;</span>
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-h:completion-embark" class="outline-4">
<h4 id="h:completion-embark"><span class="section-number-4">4.6.6.</span> <code>init-completion.el</code> minibuffer增强 <code>embark</code></h4>
<div class="outline-text-4" id="text-h:completion-embark">
<p>
在学习章节提到过<a href="#orgc4000c0">(minibuffer action 和自适应的 context menu：Embark)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">minibuffer&#25805;&#20316;&#25193;&#23637; &#65288;embark.el and j-embark.el)</span>
(<span style="color: #a020f0;">use-package</span> embark
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:defer</span> 1
  <span style="color: #483d8b;">:init</span>
  (<span style="color: #a020f0;">setq</span> which-key-use-C-h-commands nil
        <span style="color: #b22222;">;; </span><span style="color: #b22222;">press C-h after a prefix key, it shows all the possible key bindings and let you choose what you want</span>
        prefix-help-command #'embark-prefix-help-command)
  <span style="color: #483d8b;">:bind</span>
  ( <span style="color: #483d8b;">:map</span> minibuffer-local-map
    (<span style="color: #8b2252;">"C-;"</span> . embark-act)         <span style="color: #b22222;">;; </span><span style="color: #b22222;">pick some comfortable binding</span>
   )) <span style="color: #b22222;">;; </span><span style="color: #b22222;">alternative for `</span><span style="color: #008b8b;">describe-bindings</span><span style="color: #b22222;">'</span>
</pre>
</div>

<p>
使用
</p>

<p>
光标在函数位置，按 <code>C-;</code> 
</p>
<ul class="org-ul">
<li>RET 查看光标处函数定义文件位置，并打开</li>
<li>c 修改变量的值
<ul class="org-ul">
<li>如 C-h v 变量名，按 C-; c 修改变量的值</li>
</ul></li>
</ul>

<p>
优点：不需要记快捷键了
</p>
<ul class="org-ul">
<li>以前查看函数的绑定键
<ul class="org-ul">
<li><code>C-h b</code> 查看函数快捷键绑定：</li>
<li>以前按 <code>C-x C-h</code> 时，会告诉你 <code>C-x</code> 绑定了哪些快捷键</li>
</ul></li>
<li>设置了 <code>(setq prefix-help-command #'embark-prefix-help-command)</code> 后
<ul class="org-ul">
<li>按 <code>C-x C-h</code> 模糊输入函数名可看到绑定的快捷键，按回车可直接执行命令，就不需要再记快捷键了</li>
</ul></li>
</ul>

<p>
这些组合可以秒杀ivy helm这种一统的插件。
</p>
</div>
<div id="outline-container-h:completion-minibuffer-4-1" class="outline-5">
<h5 id="h:completion-minibuffer-4-1"><span class="section-number-5">4.6.6.1.</span> <code>init-completion.el</code> 增强 <code>embark</code> 和 <code>consult</code> ，批量搜索替换大杀器</h5>
<div class="outline-text-5" id="text-h:completion-minibuffer-4-1">
<p>
在学习章节提到过<a href="#h:learn-completion-minibuffer-4-1">(增强 embark 和 consult，批量搜索替换大杀器)</a>
</p>

<p>
<b>下面介绍批量修改插件</b>
</p>

<p>
<a href="#h:j-embark">(<code>j-embark.el</code> 库)</a>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#25209;&#37327;&#20462;&#25913;&#25991;&#20214;&#20869;&#23481;</span>
(<span style="color: #a020f0;">use-package</span> embark-consult
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:after</span> (embark consult)
  <span style="color: #483d8b;">:demand</span>
  <span style="color: #483d8b;">:config</span>
  (add-hook 'embark-collect-mode-hook #'consult-preview-at-point-mode) <span style="color: #b22222;">;</span><span style="color: #b22222;">hook &#31532;&#19968;&#20010;&#21442;&#25968;&#25191;&#34892;&#21069;&#65292;&#20808;&#25191;&#34892;&#31532;2&#20010;&#21442;&#25968;&#30340;&#21151;&#33021;</span>
  )

(<span style="color: #a020f0;">use-package</span> wgrep
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:commands</span> wgrep-change-to-wgrep-mode
  <span style="color: #483d8b;">:config</span> (<span style="color: #a020f0;">setq</span> wgrep-auto-save-buffer t))

(<span style="color: #a020f0;">use-package</span> j-embark
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:after</span> embark
  <span style="color: #483d8b;">:bind</span>
  ( <span style="color: #483d8b;">:map</span> minibuffer-local-map
    (<span style="color: #8b2252;">"C-c C-e"</span> . my/embark-export-write) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#25171;&#24320;&#20889;&#65292;&#37197;&#21512;query-replace-regexp&#23454;&#29616;&#25991;&#26412;&#26367;&#25442;</span>
    <span style="color: #483d8b;">:map</span> embark-file-map <span style="color: #b22222;">; </span><span style="color: #b22222;">&#25171;&#24320;pc&#25991;&#20214;&#31649;&#29702;&#22120;</span>
    (<span style="color: #8b2252;">"E"</span> . my/consult-directory-externally)
    ))
</pre>
</div>

<p>
批量替换操作
</p>
<ul class="org-ul">
<li><code>M-x consult-ripgrep</code>  默认会在以 git 为根目录搜索。如 <code>#hello</code> ，搜索包含hello字符的文件。 <code>C-n/C-p</code> 下上搜索同时可以预览。</li>
<li><code>C-c C-e</code> 打开写</li>
<li><code>M-x query-replace-regexp</code> 输入hello 回车， 替换为hello 回车。 按 y 同意当前行替换，n 不同意修改</li>
<li><code>C-c C-c</code> 执行替换，按 q 退出</li>
</ul>


<p>
当前buffer替换操作
</p>
<ul class="org-ul">
<li><code>C-s</code> 搜索， 输入hello</li>
<li><code>C-c C-e</code> 编辑</li>
<li><code>M-x query-replace-regexp</code> 输入要替换的内容</li>
<li><code>C-c C-c</code> 执行替换，按 q 退出</li>
</ul>

<p>
快速打开文件所在目录：
</p>
<ul class="org-ul">
<li><code>M-x my/consult-directory-externally</code> 输入文件路径，如 <code>~/.emacs.d/auto-save-list/.saves-2000-JASPER~</code></li>
<li><code>C-x C-f</code> 选择文件时，可以用embark来打开， <code>C;</code> 选择E，用文件管理器打开对应目录的</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:completion-marginalia" class="outline-4">
<h4 id="h:completion-marginalia"><span class="section-number-4">4.6.7.</span> <code>init-completion.el</code> minubuffer增强注释 <code>marginalia</code></h4>
<div class="outline-text-4" id="text-h:completion-marginalia">
<p>
在学习章节提到过<a href="#orgb1f5fa5">(配置 Marginalia 增强 minubuffer 的 annotation)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">Minubuffer &#35814;&#32454;&#30340;&#27880;&#37322;&#20449;&#24687; (marginalia.el)</span>
(<span style="color: #a020f0;">use-package</span> marginalia
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:defer</span> 1
  <span style="color: #483d8b;">:config</span>
  (<span style="color: #a020f0;">setq</span> marginalia-max-relative-age 0) <span style="color: #b22222;">; </span><span style="color: #b22222;">absolute time</span>
  (marginalia-mode 1))
</pre>
</div>

<p>
<code>M-x</code> 可以看到它会把命令的注释直接显示在minibuffer中
</p>

<p>
<code>C-h v</code> 查看一个变量的内容，可以发现不用再按回车看到里面的值。直接显示在minibuffer中
</p>

<p>
<code>C-h f</code> 键位绑定都已经在minibuffer中显示出来了
</p>

<p>
<code>C-x C-f</code> 显示文件大小权限等， <code>C-x b</code> 显 buffer 大小状态， <code>C-h f</code> 显示函数快捷键等
</p>
</div>
</div>
<div id="outline-container-h:completion-vertico" class="outline-4">
<h4 id="h:completion-vertico"><span class="section-number-4">4.6.8.</span> <code>init-completion.el</code> minibuffer增强 <code>vertico</code></h4>
<div class="outline-text-4" id="text-h:completion-vertico">
<p>
在学习章节提到过<a href="#org04c8521">(增强 minibuffer 补全：vertico 和 Orderless)</a>
</p>

<p>
有了 vertico-mode，把之前的 icomplete-mode 关掉。 补全变为垂直，垂直对于我们是更友好的，所有 minibuffer 的行为的可以补全。如使用 <code>M-x</code> 补全变为垂直,  <code>C-x C-f</code> 增强显示目录下文件、 <code>C-x b</code> 变为垂直。
</p>

<p>
orderless 支持 <code>M-x</code> 模糊搜索，可以无序的。 如 edebug-defun 函数搜索， <code>M-x fun debug</code>
</p>

<p>
我更喜欢用下下面的配置：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">Minibuffer &#22402;&#30452;&#34917;&#20840;&#24067;&#23616;(vertico)</span>
(<span style="color: #a020f0;">use-package</span> vertico
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:hook</span> (after-init . vertico-mode)
  <span style="color: #483d8b;">:config</span>
  (<span style="color: #a020f0;">setq</span> vertico-resize nil
        vertico-count 17
        vertico-cycle t)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Cleans up path when moving directories with shadowed paths syntax, e.g.</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">cleans ~/foo/bar/// to /, and ~/foo/bar/~/ to ~/.</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36866;&#21512;vim&#29992;&#25143;&#20064;&#24815;&#65292;&#19978;&#19979;&#31227;&#21160; C-k, C-j </span>
  (add-hook 'rfn-eshadow-update-overlay-hook #'vertico-directory-tidy)
  (add-hook 'minibuffer-setup-hook #'vertico-repeat-save)
  (define-key vertico-map (kbd <span style="color: #8b2252;">"C-j"</span>) 'vertico-next)
  (define-key vertico-map (kbd <span style="color: #8b2252;">"C-'"</span>) 'vertico-quick-jump)
  (define-key vertico-map (kbd <span style="color: #8b2252;">"C-k"</span>) 'vertico-previous)
  (define-key vertico-map [backspace] #'vertico-directory-delete-char)
  (define-key vertico-map (kbd <span style="color: #8b2252;">"s-SPC"</span>) #'+vertico/embark-preview)
  )
</pre>
</div>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span style="color: #8b2252;">"Load init-completion done..."</span>)
(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">init-completion</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:evil" class="outline-3">
<h3 id="h:evil"><span class="section-number-3">4.7.</span> <code>init-evil.el</code></h3>
<div class="outline-text-3" id="text-h:evil">
<p>
在学习章节提到过<a href="#orgbdfc449">(evil)</a>
</p>
</div>
<div id="outline-container-h:evil-init" class="outline-4">
<h4 id="h:evil-init"><span class="section-number-4">4.7.1.</span> <code>init-evil.el</code> 安装</h4>
<div class="outline-text-4" id="text-h:evil-init">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">evil </span>
(<span style="color: #a020f0;">use-package</span> evil
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:init</span>
  (<span style="color: #a020f0;">setq</span> evil-want-keybinding nil) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#19981;&#20351;&#29992;&#33258;&#24102;&#30340;&#38190;&#20301;&#32465;&#23450;&#12290;&#40664;&#35748;&#21152;&#36733;&#19981;&#21516;&#27169;&#24335;&#19979;&#38190;&#20301;&#32465;&#23450;</span>
  (<span style="color: #a020f0;">setq</span> evil-want-C-u-scroll t) <span style="color: #b22222;">;</span><span style="color: #b22222;">C-u &#23454;&#29616;&#21521;&#19978;&#28378;&#21160;&#12290;&#40664;&#35748;C-u &#26159;emacs&#20013;&#30340;&#21151;&#33021;</span>
  (evil-mode)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">https://emacs.stackexchange.com/questions/46371/how-can-i-get-ret-to-follow-org-mode-links-when-using-evil-mode</span>
  (<span style="color: #a020f0;">with-eval-after-load</span> 'evil-maps
    (define-key evil-motion-state-map (kbd <span style="color: #8b2252;">"RET"</span>) nil)) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#22914;&#26524;&#26377;&#38142;&#25509;&#65292;&#25353;&#22238;&#36710;&#33021;&#35775;&#38382;&#36825;&#20010;&#38142;&#25509;</span>
  )
</pre>
</div>


<p>
安装undo-tree
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">evil &#20351;&#29992;undo-tree&#26469;&#31649;&#29702;undo redo</span>
(<span style="color: #a020f0;">use-package</span> undo-tree
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:diminish</span>
  <span style="color: #483d8b;">:init</span>
  (global-undo-tree-mode 1)
  (<span style="color: #a020f0;">setq</span> undo-tree-auto-save-history nil)
  (evil-set-undo-system 'undo-tree))
</pre>
</div>

<p>
<b>Emacs中使用vim和外部使用vim的区别</b>
</p>

<p>
vim 中有normal和insert模式，在emacs中是各种state, 如 noarmal state, insert state
</p>

<dl class="org-dl">
<dt>Normal State (N)</dt><dd>这是 Evil 默认的“静止状态”，其中定义了 vi 绑定的主体。 <code>M-x evil-normal-state</code></dd>

<dt>Insert State (I)</dt><dd>这是插入文本的状态，其中未修改的键将在缓冲区中插入相应的字符。</dd>

<dt>Emacs State (E)</dt><dd>一种尽可能接近默认 Emacs 行为的状态，通过 <code>C-z</code> 从emacs和 vi 相互切换。</dd>

<dt>Visual State (V)</dt><dd>用于选择文本区域的状态。</dd>

<dt>Motion State (M) 运动状态 （M）</dt><dd>一种特殊状态，适用于只读缓冲区，其中运动可用，但编辑操作不可用。只读的文档一般都是Motion state 如帮助文档。 <code>M-x evil-motion-state</code></dd>

<dt>Replace State (R) 替换状态 （R）</dt><dd>一种特殊状态，与插入状态非常相似，只不过它替换文本而不是插入。 按住大写的 <code>R</code> , 一直替换状态</dd>
</dl>


<p>
<b>Evil 基础用法</b>
</p>

<p>
增删改查 (text-obj, commands, replace)
</p>
<ul class="org-ul">
<li>text-obj 更好地操作文本
<ul class="org-ul">
<li>选中单词 viw</li>
<li>删除单词 diw</li>
</ul></li>
<li>跳到r字符的位置： fr</li>
<li>commands
<ul class="org-ul">
<li><code>:</code> 进行命令行模式。 :%s/commands/111/ 可以替换, 按 u 回退</li>
</ul></li>
</ul>

<p>
evil-guide: <a href="https://github.com/noctuid/evil-guide.git">https://github.com/noctuid/evil-guide.git</a>
</p>

<p>
上述文档花2小时认真读就可以完全从vim用户切到emacs上使用了。
</p>


<p>
<b>interactive replace 交互式替换文本</b>
</p>

<p>
在学习章节提到过<a href="#org226e72b">(精选 packages, 大大提升你的 Emacs 编辑效率)</a>
</p>

<p>
交互式替换文本. 在evil模式中，选中的单词填写在 <code>:%s/&lt;word&gt;//</code> 中
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my/evil-quick-replace</span> (beg end )
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"r"</span>)
  (<span style="color: #a020f0;">when</span> (evil-visual-state-p)
    (evil-exit-visual-state)
    (<span style="color: #a020f0;">let</span> ((selection (regexp-quote (buffer-substring-no-properties beg end))))
      (<span style="color: #a020f0;">setq</span> command-string (format <span style="color: #8b2252;">"%%s /%s//g"</span> selection))
      (<span style="color: #a020f0;">minibuffer-with-setup-hook</span>
          (<span style="color: #a020f0;">lambda</span> () (backward-char 2))
        (evil-ex command-string)))))

(define-key evil-visual-state-map (kbd <span style="color: #8b2252;">"C-r"</span>) 'my/evil-quick-replace)
</pre>
</div>

<p>
交互式替换文本操作：
</p>
<ul class="org-ul">
<li><code>SPC v</code> 或者选中要替换的字符串，按 <code>C-r</code> 替换</li>
</ul>

<p>
比较全的evil配置
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">evil </span>
(<span style="color: #a020f0;">use-package</span> evil
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:init</span>
  (<span style="color: #a020f0;">setq</span> evil-want-keybinding nil) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#19981;&#20351;&#29992;&#33258;&#24102;&#30340;&#38190;&#20301;&#32465;&#23450;&#12290;&#40664;&#35748;&#21152;&#36733;&#19981;&#21516;&#27169;&#24335;&#19979;&#38190;&#20301;&#32465;&#23450;</span>
  (<span style="color: #a020f0;">setq</span> evil-want-C-u-scroll t) <span style="color: #b22222;">;</span><span style="color: #b22222;">C-u &#23454;&#29616;&#21521;&#19978;&#28378;&#21160;&#12290;&#40664;&#35748;C-u &#26159;emacs&#20013;&#30340;&#21151;&#33021;</span>
  (evil-mode)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">https://emacs.stackexchange.com/questions/46371/how-can-i-get-ret-to-follow-org-mode-links-when-using-evil-mode</span>
  (<span style="color: #a020f0;">with-eval-after-load</span> 'evil-maps
    (define-key evil-motion-state-map (kbd <span style="color: #8b2252;">"RET"</span>) nil)) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#22914;&#26524;&#26377;&#38142;&#25509;&#65292;&#25353;&#22238;&#36710;&#33021;&#35775;&#38382;&#36825;&#20010;&#38142;&#25509;</span>

  <span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#33258;&#23450;&#20041;&#35774;&#32622;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#22312;&#36827;&#34892;&#25554;&#20837;&#27169;&#24335;&#21518;&#65292;&#24076;&#26395;&#20351;&#29992;emacs&#30340;&#24555;&#25463;&#38190;&#65292;&#32780;&#21448;&#19981;&#24076;&#26395;&#36827;&#20837; Emacs State</span>
  (setcdr evil-insert-state-map nil)
  (define-key evil-insert-state-map [escape] 'evil-normal-state) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#25353; [Esc] &#22238;&#21040;normal state. &#19979;&#38754;&#20250;&#20171;&#32461;&#26356;&#26041;&#20415;&#30340;evil-escape&#25554;&#20214;</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#21152;&#31354;&#34892;, &#40664;&#35748; o + Esc &#38656;&#35201;2&#27425;&#25805;&#20316;. &#19979;&#38754;&#30340;&#35774;&#32622;&#30452;&#25509;&#22312;normal &#27169;&#24335;&#20013;&#25805;&#20316;</span>
  (define-key evil-normal-state-map (kbd <span style="color: #8b2252;">"[ SPC"</span>) (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>) (evil-insert-newline-above) (forward-line))) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#21521;&#19978;&#21152;&#31354;&#34892;</span>
  (define-key evil-normal-state-map (kbd <span style="color: #8b2252;">"] SPC"</span>) (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>) (evil-insert-newline-below) (forward-line -1))) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#21521;&#19978;&#21152;&#31354;&#34892;</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#22312;normal state&#20013;&#20999;&#25442;&#19981;&#21516;&#30340;buffer</span>
  (define-key evil-normal-state-map (kbd <span style="color: #8b2252;">"[ b"</span>) 'previous-buffer) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#20999;&#21040;&#21069;&#19968;&#20010;buffer</span>
  (define-key evil-normal-state-map (kbd <span style="color: #8b2252;">"] b"</span>) 'next-buffer)
  (define-key evil-motion-state-map (kbd <span style="color: #8b2252;">"[ b"</span>) 'previous-buffer)
  (define-key evil-motion-state-map (kbd <span style="color: #8b2252;">"] b"</span>) 'next-buffer)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#22312;dired&#27169;&#24335;&#19979;&#65292;&#28155;&#21152;&#24555;&#25463;&#38190;</span>
  (evil-define-key 'normal dired-mode-map <span style="color: #b22222;">; </span><span style="color: #b22222;">&#21482;&#20462;&#25913;dired&#27169;&#24335;&#19979;normal&#27169;&#24335;&#30340;&#24555;&#25463;&#38190;&#32465;&#23450;</span>
    (kbd <span style="color: #8b2252;">"&lt;RET&gt;"</span>) 'dired-find-alternate-file
    (kbd <span style="color: #8b2252;">"C-k"</span>) 'dired-up-directory <span style="color: #b22222;">;</span><span style="color: #b22222;">&#24448;&#19978;&#19968;&#32423;&#30446;&#24405;</span>
    <span style="color: #8b2252;">"`"</span> 'dired-open-term
    <span style="color: #8b2252;">"q"</span> 'quit-window <span style="color: #b22222;">; </span><span style="color: #b22222;">q &#36864;&#20986;&#12290;&#40664;&#35748;&#27809;&#26377;&#12290; &#21487;&#20197;&#26597;&#30475;emacs state&#19979;&#30340;q&#32465;&#23450;&#30340;&#20989;&#25968; =C-x d= &#36827;&#20837;dired&#65292; =C-z= &#36827;&#20837;emacs state&#65292; =C-h k= &#25353; q &#21487;&#26597;&#21040;&#23545;&#24212;&#30340;&#20989;&#25968;&#20026; quit-window</span>
    <span style="color: #8b2252;">"o"</span> 'dired-find-file-other-window <span style="color: #b22222;">; </span><span style="color: #b22222;">&#22312;&#21478;&#22806;&#19968;&#20010;&#31383;&#21475;&#25171;&#24320;&#25991;&#20214;</span>
    <span style="color: #8b2252;">"z"</span> 'dired-get-size
    <span style="color: #8b2252;">")"</span> 'dired-omit-mode)
  )


(<span style="color: #a020f0;">use-package</span> j-evil
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:bind</span>
  ( <span style="color: #483d8b;">:map</span> evil-visual-state-map 
  (<span style="color: #8b2252;">"C-r"</span> . my/evil-quick-replace) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#20132;&#20114;&#24335;&#26367;&#25442;&#25991;&#26412; &#36873;&#20013;&#25991;&#26412;C-r, :%s/&lt;words&gt;//</span>
  ))

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">evil &#20351;&#29992;undo-tree&#26469;&#31649;&#29702;undo redo</span>
(<span style="color: #a020f0;">use-package</span> undo-tree
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:diminish</span>
  <span style="color: #483d8b;">:init</span>
  (global-undo-tree-mode 1)
  (<span style="color: #a020f0;">setq</span> undo-tree-auto-save-history nil)
  (evil-set-undo-system 'undo-tree))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:evil-custom-keybinding" class="outline-4">
<h4 id="h:evil-custom-keybinding"><span class="section-number-4">4.7.2.</span> <code>init.evil.el</code> 自定义快捷键</h4>
<div class="outline-text-4" id="text-h:evil-custom-keybinding">
<p>
<b>定义不同 state 下面的快捷键</b>
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#33258;&#23450;&#20041;&#35774;&#32622;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#22312;&#36827;&#34892;&#25554;&#20837;&#27169;&#24335;&#21518;&#65292;&#24076;&#26395;&#20351;&#29992;emacs&#30340;&#24555;&#25463;&#38190;&#65292;&#32780;&#21448;&#19981;&#24076;&#26395;&#36827;&#20837; Emacs State</span>
(setcdr evil-insert-state-map nil)
(define-key evil-insert-state-map [escape] 'evil-normal-state) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#25353; [Esc] &#22238;&#21040;normal state</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#21152;&#31354;&#34892;, &#40664;&#35748; o + Esc &#38656;&#35201;2&#27425;&#25805;&#20316;. &#19979;&#38754;&#30340;&#35774;&#32622;&#30452;&#25509;&#22312;normal &#27169;&#24335;&#20013;&#25805;&#20316;</span>
(define-key evil-normal-state-map (kbd <span style="color: #8b2252;">"[ SPC"</span>) (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>) (evil-insert-newline-above) (forward-line))) <span style="color: #b22222;">; </span><span style="color: #b22222;">[ + &#31354;&#26684;&#65292;&#21521;&#19978;&#21152;&#31354;&#34892;</span>
(define-key evil-normal-state-map (kbd <span style="color: #8b2252;">"] SPC"</span>) (<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>) (evil-insert-newline-below) (forward-line -1))) <span style="color: #b22222;">; </span><span style="color: #b22222;">[ + &#31354;&#26684;&#65292;&#21521;&#19978;&#21152;&#31354;&#34892;</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#22312;normal state&#20013;&#20999;&#25442;&#19981;&#21516;&#30340;buffer</span>
(define-key evil-normal-state-map (kbd <span style="color: #8b2252;">"[ b"</span>) 'previous-buffer) <span style="color: #b22222;">; </span><span style="color: #b22222;">[ + b &#20999;&#21040;&#21069;&#19968;&#20010;buffer</span>
(define-key evil-normal-state-map (kbd <span style="color: #8b2252;">"] b"</span>) 'next-buffer)
(define-key evil-motion-state-map (kbd <span style="color: #8b2252;">"[ b"</span>) 'previous-buffer)
(define-key evil-motion-state-map (kbd <span style="color: #8b2252;">"] b"</span>) 'next-buffer)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#22312;dired&#27169;&#24335;&#19979;&#65292;&#28155;&#21152;&#24555;&#25463;&#38190;</span>
(evil-define-key 'normal dired-mode-map <span style="color: #b22222;">; </span><span style="color: #b22222;">&#21482;&#20462;&#25913;dired&#27169;&#24335;&#19979;normal&#27169;&#24335;&#30340;&#24555;&#25463;&#38190;&#32465;&#23450;</span>
  (kbd <span style="color: #8b2252;">"&lt;RET&gt;"</span>) 'dired-find-alternate-file
  (kbd <span style="color: #8b2252;">"C-k"</span>) 'dired-up-directory <span style="color: #b22222;">;</span><span style="color: #b22222;">&#24448;&#19978;&#19968;&#32423;&#30446;&#24405;</span>
  <span style="color: #8b2252;">"`"</span> 'dired-open-term
  <span style="color: #8b2252;">"q"</span> 'quit-window <span style="color: #b22222;">; </span><span style="color: #b22222;">q &#36864;&#20986;&#12290;&#40664;&#35748;&#27809;&#26377;&#12290; &#21487;&#20197;&#26597;&#30475;emacs state&#19979;&#30340;q&#32465;&#23450;&#30340;&#20989;&#25968; =C-x d= &#36827;&#20837;dired&#65292; =C-z= &#36827;&#20837;emacs state&#65292; =C-h k= &#25353; q &#21487;&#26597;&#21040;&#23545;&#24212;&#30340;&#20989;&#25968;&#20026; quit-window</span>
  <span style="color: #8b2252;">"o"</span> 'dired-find-file-other-window <span style="color: #b22222;">; </span><span style="color: #b22222;">&#22312;&#21478;&#22806;&#19968;&#20010;&#31383;&#21475;&#25171;&#24320;&#25991;&#20214;</span>
  <span style="color: #8b2252;">"z"</span> 'dired-get-size
  <span style="color: #8b2252;">")"</span> 'dired-omit-mode)
</pre>
</div>


<p>
<b>spacemacs like 快捷键如何定义</b>
</p>

<p>
general插件中global-definer在init-basic.el中定义<a href="#h:basic-general">(<code>init-basic.el</code> 键位绑定 <code>general</code>)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> general
  <span style="color: #483d8b;">:init</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">global-definer &#23545;&#24212;leader&#38190;&#20026;&#31354;&#26684;</span>
  (global-definer
    <span style="color: #8b2252;">"!"</span> 'shell-command <span style="color: #b22222;">;</span><span style="color: #b22222;">&#31354;&#26684;+! SPC ! &#36827;&#20837;shell&#21629;&#20196;&#34892;</span>
    <span style="color: #8b2252;">"SPC"</span> 'execute-extended-command <span style="color: #b22222;">; </span><span style="color: #b22222;">&#25353;2&#19979;&#31354;&#26684;SPC-SPC&#23601;&#21487;&#20197;&#23454;&#29616; M-x &#30340;&#25928;&#26524;</span>
    <span style="color: #8b2252;">"'"</span> 'vertico-repeat
    <span style="color: #8b2252;">"+"</span> 'text-scale-increase
    <span style="color: #8b2252;">"-"</span> 'text-scale-decrease
    <span style="color: #8b2252;">"u"</span> 'universal-argument <span style="color: #b22222;">;</span><span style="color: #b22222;">SPC u &#30456;&#24403;&#20110;emacs&#30340;C-u </span>
    <span style="color: #8b2252;">"hdf"</span> 'describe-function <span style="color: #b22222;">;</span><span style="color: #b22222;">SPC hdf &#30456;&#24403;&#20110;emacs&#30340;C-h f</span>
    <span style="color: #8b2252;">"hdv"</span> 'describe-variable <span style="color: #b22222;">;</span><span style="color: #b22222;">SPC hdv &#30456;&#24403;&#20110;emacs&#30340;C-h v</span>
    <span style="color: #8b2252;">"hdk"</span> 'describe-key <span style="color: #b22222;">;</span><span style="color: #b22222;">SPC hdk &#30456;&#24403;&#20110;emacs&#30340;C-h k</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#26597;&#30475;init-funcs.el &#33258;&#23450;&#20041;&#20989;&#25968;</span>
    <span style="color: #8b2252;">"hh"</span> 'my/highlight-dwim <span style="color: #b22222;">;</span><span style="color: #b22222;">SPC hh &#39640;&#20142;&#36873;&#20013;&#21306;&#22495;&#24182;&#26631;&#19978;&#39068;&#33394;</span>
    <span style="color: #8b2252;">"hc"</span> 'my/clearn-highlight <span style="color: #b22222;">;</span><span style="color: #b22222;">SPC hc &#28165;&#38500;&#39640;&#20142;&#39068;&#33394;</span>
    <span style="color: #8b2252;">"v"</span> 'er/expand-region <span style="color: #b22222;">;</span><span style="color: #b22222;">SPC v &#25193;&#22823;&#21306;&#22495;</span>
    )
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">leader &#38190;&#20026;SPC&#31354;&#26684;&#65292;&#23376;leader&#38190;&#20026;b. &#22914; SPC b b&#26597;&#30475;buffer&#32531;&#20914;&#21306;</span>
  (+general-global-menu! <span style="color: #8b2252;">"buffer"</span> <span style="color: #8b2252;">"b"</span>
    <span style="color: #8b2252;">"d"</span> 'kill-current-buffer
    <span style="color: #8b2252;">"b"</span> '(consult-buffer <span style="color: #483d8b;">:which-key</span> <span style="color: #8b2252;">"consult buffer"</span>) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#26597;&#30475;buffer&#32531;&#20914;&#21306;</span>
    <span style="color: #8b2252;">"B"</span> 'switch-to-buffer
    <span style="color: #8b2252;">"p"</span> 'previous-buffer
    <span style="color: #8b2252;">"R"</span> 'rename-buffer
    <span style="color: #8b2252;">"M"</span> '((<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>) (switch-to-buffer <span style="color: #8b2252;">"*Messages*"</span>)) 
          <span style="color: #483d8b;">:which-key</span> <span style="color: #8b2252;">"messages-buffer"</span>) <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC b M&#26597;&#30475;*Message*&#32531;&#20914;&#21306;</span>
    <span style="color: #8b2252;">"n"</span> 'next-buffer
    <span style="color: #8b2252;">"i"</span> 'ibuffer
    <span style="color: #8b2252;">"f"</span> 'my-open-current-directory
    <span style="color: #8b2252;">"k"</span> 'kill-buffer

    <span style="color: #8b2252;">"y"</span> 'copy-buffer-name
    <span style="color: #8b2252;">"K"</span> 'kill-other-buffers)
  )
</pre>
</div>

<p>
我的emacs模块配置<a href="#h:keybindings-general">(<code>init-keybindings.el</code> 键位绑定 <code>general</code>)</a>
</p>

<p>
参考配置： <a href="https://github.com/zilongshanren/emacs.d/blob/eglot/lisp/init-keybindings.el">https://github.com/zilongshanren/emacs.d/blob/eglot/lisp/init-keybindings.el</a> 实现自己的文件、窗口、项目多种快捷键绑定
</p>
</div>
</div>
<div id="outline-container-h:36d15ff2-87fc-47f2-a385-ddca88f7c2f0" class="outline-4">
<h4 id="h:36d15ff2-87fc-47f2-a385-ddca88f7c2f0"><span class="section-number-4">4.7.3.</span> 相关插件列表</h4>
<div class="outline-text-4" id="text-h:36d15ff2-87fc-47f2-a385-ddca88f7c2f0">
</div>
<div id="outline-container-h:2186eba8-72bf-4c04-b439-168680e1055e" class="outline-5">
<h5 id="h:2186eba8-72bf-4c04-b439-168680e1055e"><span class="section-number-5">4.7.3.1.</span> evil-escape插件回退到normal state</h5>
<div class="outline-text-5" id="text-h:2186eba8-72bf-4c04-b439-168680e1055e">
<p>
任何状态下按 <code>kj</code> 就能回到normal state。很实用，相当于把esc键集中在右手, 一只手就可以操作vim常用功能。
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">kj &#36864;&#22238;&#21040;&#26222;&#36890;&#27169;&#24335;</span>
(<span style="color: #a020f0;">use-package</span> evil-escape
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:init</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">{{ https://github.com/syl20bnr/evil-escape</span>
  (<span style="color: #a020f0;">setq-default</span> evil-escape-delay 0.3)
  (<span style="color: #a020f0;">setq</span> evil-escape-excluded-major-modes '(dired-mode))
  (<span style="color: #a020f0;">setq-default</span> evil-escape-key-sequence <span style="color: #8b2252;">"kj"</span>)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">disable evil-escape when input method is on</span>
  (evil-escape-mode 1)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">}}</span>
)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ff29f09d-cec5-488a-a62e-2e96a9327958" class="outline-5">
<h5 id="h:ff29f09d-cec5-488a-a62e-2e96a9327958"><span class="section-number-5">4.7.3.2.</span> evil-anzu</h5>
<div class="outline-text-5" id="text-h:ff29f09d-cec5-488a-a62e-2e96a9327958">
<p>
小功能ui。 当用 <code>Shift *</code> 查找单词重复出现几次时，下方状态栏会多一个标识显示，显示当前重复出现单词的位置和总重复次数。
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;</span><span style="color: #b22222;">&#19979;&#26041;&#29366;&#24577;&#26639;&#26174;&#31034;&#21333;&#35789;&#37325;&#22797;&#20986;&#29616;&#20301;&#32622;</span>
(<span style="color: #a020f0;">use-package</span> evil-anzu
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:after</span> evil
  <span style="color: #483d8b;">:diminish</span>
  <span style="color: #483d8b;">:demand</span> t
  <span style="color: #483d8b;">:init</span>
  (global-anzu-mode t))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:4ab86f63-e3dc-4b10-a730-72d12d10555a" class="outline-5">
<h5 id="h:4ab86f63-e3dc-4b10-a730-72d12d10555a"><span class="section-number-5">4.7.3.3.</span> evil-collections</h5>
<div class="outline-text-5" id="text-h:4ab86f63-e3dc-4b10-a730-72d12d10555a">
<p>
使用社区的按键绑定。相对稳定不会改变
</p>

<p>
同时可以设置不同模式中默认的evil状态
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#20351;&#29992;&#31038;&#21306;&#31283;&#23450;&#30340;&#25353;&#38190;&#32465;&#23450;&#12290; &#24182;&#35774;&#32622;&#19981;&#21516;&#27169;&#24335;&#20013;&#40664;&#35748;&#30340;evil&#29366;&#24577;</span>
(<span style="color: #a020f0;">use-package</span> evil-collection
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:after</span> evil
  <span style="color: #483d8b;">:config</span>
  (<span style="color: #a020f0;">setq</span> evil-collection-mode-list (remove 'lispy evil-collection-mode-list)) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#31227;&#38500;&#31038;&#21306;&#20013;&#25554;&#20214;&#30340;&#25913;&#38190;&#23545;&#20320;&#38190;&#20301;&#24433;&#21709;</span>
  (evil-collection-init)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#35774;&#32622;&#36827;&#20837;mode&#26102;&#23545;&#24212;&#30340;vim &#27169;&#24335;</span>
  (<span style="color: #a020f0;">cl-loop</span> for (mode . state) in
           '((org-agenda-mode . normal) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#36827;&#20837;agenda&#26102;&#40664;&#35748;Normal State&#29366;&#24577;</span>
             (Custom-mode . emacs)
             (eshell-mode . emacs) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#36827;&#20837;eshell&#27169;&#24335;&#26102;&#40664;&#35748;Emacs State&#29366;&#24577;</span>
             (makey-key-mode . motion))
           do (evil-set-initial-state mode state)))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:efec661d-88ef-4d35-8545-e33a71e60c04" class="outline-5">
<h5 id="h:efec661d-88ef-4d35-8545-e33a71e60c04"><span class="section-number-5">4.7.3.4.</span> evil-surround</h5>
<div class="outline-text-5" id="text-h:efec661d-88ef-4d35-8545-e33a71e60c04">
<p>
S用法，选中一个单词后加引号。
</p>
<ul class="org-ul">
<li><code>viw S "</code> 相当于原生vim text object用法 <code>viw Shift i "</code> 操作</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">S&#29992;&#27861;&#65292;&#36873;&#20013;&#19968;&#20010;&#21333;&#35789;&#21518;&#21152;&#24341;&#21495;&#12290;viw S " &#30456;&#24403;&#20110;&#21407;&#29983;vim text object&#29992;&#27861; viw Shift i " </span>
(<span style="color: #a020f0;">use-package</span> evil-surround
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:init</span>
  (global-evil-surround-mode 1))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:5748be0d-f8c4-45d6-89c0-3fd42e880a2c" class="outline-5">
<h5 id="h:5748be0d-f8c4-45d6-89c0-3fd42e880a2c"><span class="section-number-5">4.7.3.5.</span> evil-nerd-commenter</h5>
<div class="outline-text-5" id="text-h:5748be0d-f8c4-45d6-89c0-3fd42e880a2c">
<p>
对不同语言加的注释
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#28155;&#21152;&#19981;&#21516;&#35821;&#35328;&#30340;&#27880;&#37322;</span>
(<span style="color: #a020f0;">use-package</span> evil-nerd-commenter
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:init</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">normal &#25110; visual &#27169;&#24335;&#19979;&#25353; ,/ &#21487;&#21152;&#27880;&#37322;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">(define-key evil-normal-state-map (kbd ",ci") 'evilnc-comment-or-uncomment-lines)</span>
  (define-key evil-normal-state-map (kbd <span style="color: #8b2252;">",/"</span>) 'evilnc-comment-or-uncomment-lines)
  (define-key evil-visual-state-map (kbd <span style="color: #8b2252;">","</span>) 'evilnc-comment-or-uncomment-lines)
  )
</pre>
</div>

<p>
操作：加注释
</p>
<ul class="org-ul">
<li>单行注释， <code>,/</code></li>
<li>多行注释，选中行 <code>,/</code></li>
</ul>
</div>
</div>
<div id="outline-container-h:c63ca6bf-d489-49a3-90b9-0826c2bc5f20" class="outline-5">
<h5 id="h:c63ca6bf-d489-49a3-90b9-0826c2bc5f20"><span class="section-number-5">4.7.3.6.</span> evil-snipe</h5>
<div class="outline-text-5" id="text-h:c63ca6bf-d489-49a3-90b9-0826c2bc5f20">
<p>
小功能ui。高亮查找的字符。 如查找m字符。 <code>fm</code> 当前行的m字符高亮。按 <code>;</code> 重复查找动作
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> evil-snipe
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:diminish</span>
  <span style="color: #483d8b;">:init</span>
  (evil-snipe-mode +1)
  (evil-snipe-override-mode +1))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:270a82c8-9426-4829-b6b8-2037a2121fdf" class="outline-5">
<h5 id="h:270a82c8-9426-4829-b6b8-2037a2121fdf"><span class="section-number-5">4.7.3.7.</span> evil-matchit</h5>
<div class="outline-text-5" id="text-h:270a82c8-9426-4829-b6b8-2037a2121fdf">
<p>
按 <code>%</code> 可以在函数、括号之间跳转
</p>

<p>
参考我的文章<a href="http://xuchangwei.com/lisp/coding-emacs/coding-emacs.html#h:vscode-symbol-jump">(如何提高编程速度)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#25353; % &#21487;&#20197;&#22312;&#20989;&#25968;&#12289;&#25324;&#21495;&#20043;&#38388;&#36339;&#36716;</span>
(<span style="color: #a020f0;">use-package</span> evil-matchit
  <span style="color: #483d8b;">:ensure</span>
  <span style="color: #483d8b;">:init</span>
  (global-evil-matchit-mode 1))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:78a0a60e-dfaf-4aeb-9f4d-6bbaefd6ae1d" class="outline-4">
<h4 id="h:78a0a60e-dfaf-4aeb-9f4d-6bbaefd6ae1d"><span class="section-number-4">4.7.4.</span> 高阶用法（自定义 text-obj 或者 自定义 commands)</h4>
<div class="outline-text-4" id="text-h:78a0a60e-dfaf-4aeb-9f4d-6bbaefd6ae1d">
<ul class="org-ul">
<li><a href="https://github.com/noctuid/evil-guide#modes">https://github.com/noctuid/evil-guide#modes</a></li>
<li><a href="https://evil.readthedocs.io/en/latest/overview.html">https://evil.readthedocs.io/en/latest/overview.html</a></li>
</ul>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span style="color: #8b2252;">"Load init-evil done..."</span>)
(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">init-evil</span>)
</pre>
</div>

<p>
<b>我的建议</b>
</p>

<p>
使用emacs原生按键。 用多了evil，你还是个vim用户，无法轻松操作无配置或精简内置配置的emacs。
</p>
</div>
</div>
</div>
<div id="outline-container-h:b9b5d584-8a46-49ab-91c7-94c1503a12f5" class="outline-3">
<h3 id="h:b9b5d584-8a46-49ab-91c7-94c1503a12f5"><span class="section-number-3">4.8.</span> <code>init-tools.el</code></h3>
<div class="outline-text-3" id="text-h:b9b5d584-8a46-49ab-91c7-94c1503a12f5">
</div>
<div id="outline-container-h:tools-iedit" class="outline-4">
<h4 id="h:tools-iedit"><span class="section-number-4">4.8.1.</span> <code>init-tools.el</code> 多光标操作 <code>iedit</code> &amp; <code>evil-multiedit</code></h4>
<div class="outline-text-4" id="text-h:tools-iedit">
<p>
在学习章节提到过<a href="#org226e72b">(精选 packages, 大大提升你的 Emacs 编辑效率)</a>
</p>

<p>
此插件需要配合着evil插件使用。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#22810;&#20809;&#26631;&#25805;&#20316; iedit &amp; evil-multiedit</span>
(<span style="color: #a020f0;">use-package</span> iedit
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:init</span>
  (<span style="color: #a020f0;">setq</span> iedit-toggle-key-default nil)
  <span style="color: #483d8b;">:config</span>
  (define-key iedit-mode-keymap (kbd <span style="color: #8b2252;">"M-h"</span>) 'iedit-restrict-function)
  (define-key iedit-mode-keymap (kbd <span style="color: #8b2252;">"M-i"</span>) 'iedit-restrict-current-line))

(<span style="color: #a020f0;">use-package</span> evil-multiedit
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:commands</span> (evil-multiedit-default-keybinds)
  <span style="color: #483d8b;">:init</span>
  (evil-multiedit-default-keybinds))
</pre>
</div>

<p>
edit操作：
</p>
<ul class="org-ul">
<li>evil normal 状态下，选中单词 <code>viw</code> 再按 <code>R</code>. 进入 <code>evil-multiedit</code> 模式。 这时选中区域高亮，同时下方状态栏显示单词出现次数和当前所在位置</li>
<li>在 <code>evil-multiedit</code> 模式下，使用vim方式操作。如
<ul class="org-ul">
<li><code>gg</code> 到匹配单词的第一次出现位置; <code>大G</code> 到匹配单词的最后一个; 按 <code>0</code> 光标跳到当前匹单词的开头</li>
<li><code>i</code> 插入模式输入字符，所有匹配的单词跟着一直修改</li>
<li>esc 回到normal模式，按 <code>C-g</code> 退出edit模式</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-h:tools-expand-region" class="outline-4">
<h4 id="h:tools-expand-region"><span class="section-number-4">4.8.2.</span> <code>init-tools.el</code> 快速选中区域 <code>expand-region</code></h4>
<div class="outline-text-4" id="text-h:tools-expand-region">
<p>
在学习章节提到过<a href="#org226e72b">(精选 packages, 大大提升你的 Emacs 编辑效率)</a>
</p>

<p>
快速选中区域
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> expand-region
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:config</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#23450;&#20041;&#23376;&#33756;&#21333;</span>
  (<span style="color: #a020f0;">defadvice</span> <span style="color: #0000ff;">er/prepare-for-more-expansions-internal</span>
      (around helm-ag/prepare-for-more-expansions-internal activate)
    ad-do-it
    (<span style="color: #a020f0;">let</span> ((new-msg (concat (car ad-return-value)
                           <span style="color: #8b2252;">", H to highlight in buffers"</span>
                           <span style="color: #8b2252;">", / to search in project, "</span>
                           <span style="color: #8b2252;">"e iedit mode in functions"</span>
                           <span style="color: #8b2252;">"f to search in files, "</span>
                           <span style="color: #8b2252;">"b to search in opened buffers"</span>))
          (new-bindings (cdr ad-return-value)))
      (<span style="color: #a020f0;">cl-pushnew</span>  <span style="color: #b22222;">; </span><span style="color: #b22222;">&#39640;&#20142;</span>
       '(<span style="color: #8b2252;">"H"</span> (<span style="color: #a020f0;">lambda</span> ()
               (<span style="color: #a020f0;">interactive</span>)
               (call-interactively
                'my/highlight-dwim))) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#33258;&#23450;&#24211;j-highlight-global</span>
       new-bindings)
      (<span style="color: #a020f0;">cl-pushnew</span> <span style="color: #b22222;">; </span><span style="color: #b22222;">&#26597;&#25214;&#24403;&#21069;&#39033;&#30446;(git&#39033;&#30446;)&#30446;&#24405;&#20013;&#21305;&#37197;&#36873;&#20013;&#23383;&#31526;&#20018;&#30340;&#25991;&#20214;</span>
       '(<span style="color: #8b2252;">"/"</span> (<span style="color: #a020f0;">lambda</span> ()
               (<span style="color: #a020f0;">interactive</span>)
               (call-interactively
                'my/search-project-for-symbol-at-point))) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#33258;&#23450;&#24211;j-expand-region</span>
       new-bindings)
      (<span style="color: #a020f0;">cl-pushnew</span> <span style="color: #b22222;">; </span><span style="color: #b22222;">&#31561;&#21516;&#20110;evil multiedit &#20013; R &#25805;</span>
       '(<span style="color: #8b2252;">"e"</span> (<span style="color: #a020f0;">lambda</span> ()
               (<span style="color: #a020f0;">interactive</span>)
               (call-interactively
                'evil-multiedit-match-all)))
       new-bindings)
      (<span style="color: #a020f0;">cl-pushnew</span>
       '(<span style="color: #8b2252;">"f"</span> (<span style="color: #a020f0;">lambda</span> ()
               (<span style="color: #a020f0;">interactive</span>)
               (call-interactively
                'find-file)))
       new-bindings)
      (<span style="color: #a020f0;">cl-pushnew</span>  <span style="color: #b22222;">; </span><span style="color: #b22222;">&#25628;&#32034;&#36873;&#20013;&#30340;&#23383;&#31526;</span>
       '(<span style="color: #8b2252;">"b"</span> (<span style="color: #a020f0;">lambda</span> ()
               (<span style="color: #a020f0;">interactive</span>)
               (call-interactively
                'consult-line)))
       new-bindings)
      (<span style="color: #a020f0;">setq</span> ad-return-value (cons new-msg new-bindings)))))


(<span style="color: #a020f0;">use-package</span> j-expand-region
  <span style="color: #483d8b;">:ensure</span> nil)
</pre>
</div>

<p>
扩大缩小区域操作：
</p>
<ul class="org-ul">
<li>选中字符或光标位置</li>
<li><code>M-x er/expand-region</code> 扩大区域。 回车回车扩大； - 减号缩小区域；0 重置 /查找</li>
<li>在expand-region下，又自定义快捷键绑定可以方便操作。</li>
</ul>

<p>
添加一个快捷键<a href="#h:keybindings-general">(<code>init-keybindings.el</code> 键位绑定 <code>general</code>)</a>，让标记和搜索功能更方便<a href="#h:j-expand-region">(<code>j-expand-region.el</code> 库)</a>： 
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my/search-project-for-symbol-at-point</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (use-region-p)
      (<span style="color: #a020f0;">progn</span>
        (consult-ripgrep (project-root (project-current))
                         (buffer-substring (region-beginning) (region-end))))))

(global-definer
  <span style="color: #8b2252;">"hc"</span> 'my/clearn-highlight
  <span style="color: #8b2252;">"hH"</span> 'my/highlight-dwim
  <span style="color: #8b2252;">"v"</span> 'er/expand-region
  )
</pre>
</div>

<p>
扩大区域快捷操作：
</p>
<ul class="org-ul">
<li><code>SPC v</code> 扩大区域. 之后可以使用 - 缩小区域</li>
<li><code>SPC v e</code> 等同于evil multiedit<a href="#h:tools-iedit">(<code>init-tools.el</code> 多光标操作 <code>iedit</code> &amp; <code>evil-multiedit</code>)</a>中的 R 操作</li>
<li><code>SPC v f</code> 调用 <code>find-file</code> 函数查找文件</li>
<li><code>SPC v /</code> 查找当前项目(git项目)目录中匹配选中字符串的文件<a href="#h:j-expand-region">(<code>j-expand-region.el</code> 库)</a></li>
<li><code>SPC v b</code> 调用 <code>consult-line</code> 查找当前文件中匹配选中字符串的行</li>
<li><code>SPC v H</code> 文本高亮请阅读<a href="#h:tools-highlight-global">(<code>init-tools.el</code> 文本高亮 <code>symbol-overlay</code> &amp; <code>highlight-global</code>)</a></li>
</ul>
</div>
</div>
<div id="outline-container-h:tools-highlight-global" class="outline-4">
<h4 id="h:tools-highlight-global"><span class="section-number-4">4.8.3.</span> <code>init-tools.el</code> 文本高亮 <code>symbol-overlay</code> &amp; <code>highlight-global</code></h4>
<div class="outline-text-4" id="text-h:tools-highlight-global">
<p>
在学习章节提到过<a href="#org226e72b">(精选 packages, 大大提升你的 Emacs 编辑效率)</a>
</p>

<p>
高亮插件
</p>

<p>
highlight-global是github插件，使用quelpa插件辅助安装<a href="#h:packages-quelpa">(<code>init-packages.el</code> 安装 quelpa 插)</a> , 自定义了高亮函数<a href="#h:j-highlight-global">(<code>j-highlight-global.el</code> 库)</a>做为快捷键引用<a href="#h:tools-expand-region">(<code>init-tools.el</code> 快速选中区域 <code>expand-region</code>)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> highlight-global
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:commands</span> (highlight-frame-toggle)
  <span style="color: #483d8b;">:quelpa</span> (highlight-global <span style="color: #483d8b;">:fetcher</span> github <span style="color: #483d8b;">:repo</span> <span style="color: #8b2252;">"glen-dai/highlight-global"</span> <span style="color: #483d8b;">:upgrade</span> nil)
  <span style="color: #483d8b;">:config</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#39640;&#20142;&#40664;&#35748;&#38543;&#26426;&#32418;&#12289;&#31881;&#12289;&#34013;&#12289;&#38738;&#12289;&#32043;&#31561;&#39068;&#33394;&#24490;&#29615;</span>
  (<span style="color: #a020f0;">progn</span>
    (<span style="color: #a020f0;">setq-default</span> highlight-faces
                  '(('hi-red-b . 0)
                    ('hi-aquamarine . 0)
                    ('hi-pink . 0)
                    ('hi-blue-b . 0)))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> symbol-overlay
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:config</span>
  (define-key symbol-overlay-map (kbd <span style="color: #8b2252;">"h"</span>) 'nil))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> j-highlight-global
  <span style="color: #483d8b;">:ensure</span> nil)
</pre>
</div>

<p>
高亮插件操作：
</p>
<ul class="org-ul">
<li><code>SPC v H</code> 选中部分以一种颜色高亮。重复操作可以看到不高亮颜色。
<ul class="org-ul">
<li>场景：查找代码或日志时，标记重点区域</li>
<li>general 快捷键 <code>SPC v</code> <code>SPC hh</code></li>
</ul></li>
<li><code>M-x clear-highlight-frame</code> 清除颜色，或者 <code>SPC hc</code> 清除高亮颜色</li>
</ul>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span style="color: #8b2252;">"Load init-tools done..."</span>)
(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">init-tools</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:window" class="outline-3">
<h3 id="h:window"><span class="section-number-3">4.9.</span> <code>init-window.el</code></h3>
<div class="outline-text-3" id="text-h:window">
<p>
在学习中提供过<a href="#org638edf8">(窗口)</a>
</p>

<p>
Evil 的窗口选择操作
C-w h/j/j/k
</p>
</div>
<div id="outline-container-h:526c9704-5d7a-47e9-96ca-8310e01fa809" class="outline-4">
<h4 id="h:526c9704-5d7a-47e9-96ca-8310e01fa809"><span class="section-number-4">4.9.1.</span> <code>init-window.el</code> <code>window numbering</code></h4>
<div class="outline-text-4" id="text-h:526c9704-5d7a-47e9-96ca-8310e01fa809">
<ul class="org-ul">
<li><a href="https://github.com/nschum/window-numbering.el">https://github.com/nschum/window-numbering.el</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#20999;&#25442;&#31383;&#21475;</span>
(<span style="color: #a020f0;">use-package</span> window-numbering
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:init</span>
  <span style="color: #483d8b;">:hook</span> (after-init . window-numbering-mode))
</pre>
</div>

<ul class="org-ul">
<li>切换窗口 <code>M-&lt;窗口编号&gt;</code></li>
</ul>

<p>
定义快捷键
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-definer
  <span style="color: #8b2252;">"0"</span> 'select-window-0
  <span style="color: #8b2252;">"1"</span> 'select-window-1
  <span style="color: #8b2252;">"2"</span> 'select-window-2
  <span style="color: #8b2252;">"3"</span> 'select-window-3
  <span style="color: #8b2252;">"4"</span> 'select-window-4
  <span style="color: #8b2252;">"5"</span> 'select-window-5
  )

(+general-global-menu! <span style="color: #8b2252;">"window"</span> <span style="color: #8b2252;">"w"</span>
  <span style="color: #8b2252;">"/"</span> 'split-window-right
  <span style="color: #8b2252;">"-"</span> 'split-window-below
  <span style="color: #8b2252;">"m"</span> 'delete-other-windows
</pre>
</div>

<ul class="org-ul">
<li>左右分屏 <code>SPC w /</code></li>
<li>上下分屏 <code>SPC w -</code></li>
<li>删除所有其他窗口 <code>SPC w m</code></li>
</ul>
</div>
</div>
<div id="outline-container-h:98d343f7-9e3d-43b7-8402-a4b3ee20db5b" class="outline-4">
<h4 id="h:98d343f7-9e3d-43b7-8402-a4b3ee20db5b"><span class="section-number-4">4.9.2.</span> <code>init-window.el</code> <code>es-windows</code></h4>
<div class="outline-text-4" id="text-h:98d343f7-9e3d-43b7-8402-a4b3ee20db5b">
<ul class="org-ul">
<li><a href="https://github.com/sabof/es-windows">https://github.com/sabof/es-windows</a></li>
</ul>

<p>
可以交换窗口、删除窗口、分屏
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#21487;&#20197;&#20132;&#25442;&#31383;&#21475;&#12289;&#21024;&#38500;&#31383;&#21475;&#12289;&#20998;&#23631;</span>
(<span style="color: #a020f0;">use-package</span> es-windows
  <span style="color: #483d8b;">:ensure</span> t)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ec506a8e-4641-40a6-800a-a13ba8187433" class="outline-4">
<h4 id="h:ec506a8e-4641-40a6-800a-a13ba8187433"><span class="section-number-4">4.9.3.</span> <code>init-window.el</code> <code>Buffer move</code></h4>
<div class="outline-text-4" id="text-h:ec506a8e-4641-40a6-800a-a13ba8187433">
<ul class="org-ul">
<li><a href="https://github.com/nschum/window-numbering.el">https://github.com/nschum/window-numbering.el</a></li>
</ul>

<p>
移动窗口  
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">config</span>
(<span style="color: #a020f0;">use-package</span> buffer-move
  <span style="color: #483d8b;">:ensure</span> t)
</pre>
</div>

<p>
<code>SPC w s</code> 指定交的换窗口
</p>
</div>
</div>
<div id="outline-container-h:f27bcd87-7576-4c88-94b5-cd0c3760b649" class="outline-4">
<h4 id="h:f27bcd87-7576-4c88-94b5-cd0c3760b649"><span class="section-number-4">4.9.4.</span> <code>init-window.el</code> <code>Resize windows</code></h4>
<div class="outline-text-4" id="text-h:f27bcd87-7576-4c88-94b5-cd0c3760b649">
<ul class="org-ul">
<li><a href="https://github.com/dpsutton/resize-window">https://github.com/dpsutton/resize-window</a></li>
</ul>

<p>
调整窗口大小
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#35843;&#25972;&#31383;&#21475;&#22823;&#23567;</span>
(<span style="color: #a020f0;">use-package</span> resize-window
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:init</span>
  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">resize-window-dispatch-alist</span>
    '((?n resize-window--enlarge-down <span style="color: #8b2252;">" &#21521;&#19979;Resize - Expand down "</span> t)
      (?p resize-window--enlarge-up <span style="color: #8b2252;">" &#21521;&#19978;Resize - Expand up"</span> t)
      (?f resize-window--enlarge-horizontally <span style="color: #8b2252;">" &#25918;&#22823;Resize - horizontally"</span> t)
      (?b resize-window--shrink-horizontally <span style="color: #8b2252;">" &#32553;&#23567;Resize - shrink horizontally"</span> t)
      (?r resize-window--reset-windows <span style="color: #8b2252;">" &#37325;&#32622;Resize - reset window layout"</span> nil)
      (?w resize-window--cycle-window-positive <span style="color: #8b2252;">"  &#36873;&#25321;&#20998;&#23631;Resize - cycle window"</span> nil)
      (?W resize-window--cycle-window-negative <span style="color: #8b2252;">" Resize - cycle window"</span> nil)
      (?2 split-window-below <span style="color: #8b2252;">" &#27700;&#24179;Split window horizontally"</span> nil)
      (?3 split-window-right <span style="color: #8b2252;">" &#22402;&#30452;Slit window vertically"</span> nil)
      (?0 resize-window--delete-window <span style="color: #8b2252;">" &#21024;&#38500;Delete window"</span> nil)
      (?K resize-window--kill-other-windows <span style="color: #8b2252;">" Kill other windows (save state)"</span> nil)
      (?y resize-window--restore-windows <span style="color: #8b2252;">" &#24674;&#22797;(when state) Restore window configuration"</span> nil)
      (?? resize-window--display-menu <span style="color: #8b2252;">" Resize - display menu"</span> nil))
    <span style="color: #8b2252;">"List of actions for `resize-window-dispatch-default.</span>
<span style="color: #8b2252;">Main data structure of the dispatcher with the form:</span>
<span style="color: #8b2252;">\(char function documentation match-capitals</span><span style="color: #ff0000; font-weight: bold;">\</span><span style="color: #8b2252;">)"</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ca4c214b-2e05-4d97-95cf-9fd95fd01771" class="outline-4">
<h4 id="h:ca4c214b-2e05-4d97-95cf-9fd95fd01771"><span class="section-number-4">4.9.5.</span> <code>init-window.el</code> <code>Winner(builtin)</code></h4>
<div class="outline-text-4" id="text-h:ca4c214b-2e05-4d97-95cf-9fd95fd01771">
<p>
内置插件。用来切换2个不同窗口布局
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#20869;&#32622;&#25554;&#20214;&#12290;&#29992;&#26469;&#20999;&#25442;2&#20010;&#19981;&#21516;&#31383;&#21475;&#24067;&#23616;</span>
(<span style="color: #a020f0;">use-package</span> winner
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:commands</span> (winner-undo winner-redo)
  <span style="color: #483d8b;">:hook</span> (after-init . winner-mode)
  <span style="color: #483d8b;">:init</span> (<span style="color: #a020f0;">setq</span> winner-boring-buffers '(<span style="color: #8b2252;">"*Completions*"</span>
                                      <span style="color: #8b2252;">"*Compile-Log*"</span>
                                      <span style="color: #8b2252;">"*inferior-lisp*"</span>
                                      <span style="color: #8b2252;">"*Fuzzy Completions*"</span>
                                      <span style="color: #8b2252;">"*Apropos*"</span>
                                      <span style="color: #8b2252;">"*Help*"</span>
                                      <span style="color: #8b2252;">"*cvs*"</span>
                                      <span style="color: #8b2252;">"*Buffer List*"</span>
                                      <span style="color: #8b2252;">"*Ibuffer*"</span>
                                      <span style="color: #8b2252;">"*esh command on file*"</span>)))
</pre>
</div>

<ul class="org-ul">
<li>&rsquo;winner-undo           ; SPC w u 返回布局</li>
<li>&rsquo;winner-redo           ; SPC w z 撤销返回布局。 和返回布局结合实现2个布局间切换</li>
</ul>
</div>
</div>
<div id="outline-container-h:7c339d63-4318-4073-b826-b7a6eca2b694" class="outline-4">
<h4 id="h:7c339d63-4318-4073-b826-b7a6eca2b694"><span class="section-number-4">4.9.6.</span> <code>init-window.el</code> 关闭弹窗 <code>Popper</code></h4>
<div class="outline-text-4" id="text-h:7c339d63-4318-4073-b826-b7a6eca2b694">
<ul class="org-ul">
<li><a href="https://github.com/karthink/popper">https://github.com/karthink/popper</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">Enforce rules for popups</span>
(<span style="color: #a020f0;">use-package</span> popper
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:defines</span> popper-echo-dispatch-actions
  <span style="color: #483d8b;">:commands</span> popper-group-by-directory
  <span style="color: #483d8b;">:bind</span> (<span style="color: #483d8b;">:map</span> popper-mode-map
              (<span style="color: #8b2252;">"s-`"</span> . popper-toggle-latest)
              (<span style="color: #8b2252;">"s-o"</span>   . popper-cycle)
              (<span style="color: #8b2252;">"M-`"</span> . popper-toggle-type))
  <span style="color: #483d8b;">:hook</span> (emacs-startup . popper-mode)
  <span style="color: #483d8b;">:init</span>
  (<span style="color: #a020f0;">setq</span> popper-reference-buffers
        '(<span style="color: #8b2252;">"\\*Messages\\*"</span>
          <span style="color: #8b2252;">"Output\\*$"</span> <span style="color: #8b2252;">"\\*Pp Eval Output\\*$"</span>
          <span style="color: #8b2252;">"\\*Compile-Log\\*"</span>
          <span style="color: #8b2252;">"\\*Completions\\*"</span>
          <span style="color: #8b2252;">"\\*Warnings\\*"</span>
          <span style="color: #8b2252;">"\\*Flymake diagnostics.*\\*"</span>
          <span style="color: #8b2252;">"\\*Async Shell Command\\*"</span>
          <span style="color: #8b2252;">"\\*Apropos\\*"</span>
          <span style="color: #8b2252;">"\\*Backtrace\\*"</span>
          <span style="color: #8b2252;">"\\*prodigy\\*"</span>
          <span style="color: #8b2252;">"\\*Calendar\\*"</span>
          <span style="color: #8b2252;">"\\*Embark Actions\\*"</span>
          <span style="color: #8b2252;">"\\*Finder\\*"</span>
          <span style="color: #8b2252;">"\\*Kill Ring\\*"</span>
          <span style="color: #8b2252;">"\\*Embark Export:.*\\*"</span>
          <span style="color: #8b2252;">"\\*Edit Annotation.*\\*"</span>
          <span style="color: #8b2252;">"\\*Flutter\\*"</span>
          bookmark-bmenu-mode
          comint-mode
          compilation-mode
          help-mode helpful-mode
          tabulated-list-mode
          Buffer-menu-mode
          occur-mode
          gnus-article-mode devdocs-mode
          grep-mode occur-mode rg-mode deadgrep-mode ag-mode pt-mode
          ivy-occur-mode ivy-occur-grep-mode
          process-menu-mode list-environment-mode cargo-process-mode
          youdao-dictionary-mode osx-dictionary-mode fanyi-mode

          <span style="color: #8b2252;">"^\\*eshell.*\\*.*$"</span> eshell-mode
          <span style="color: #8b2252;">"^\\*shell.*\\*.*$"</span>  shell-mode
          <span style="color: #8b2252;">"^\\*terminal.*\\*.*$"</span> term-mode
          <span style="color: #8b2252;">"^\\*vterm.*\\*.*$"</span>  vterm-mode

          <span style="color: #8b2252;">"\\*DAP Templates\\*$"</span> dap-server-log-mode
          <span style="color: #8b2252;">"\\*ELP Profiling Restuls\\*"</span> profiler-report-mode
          <span style="color: #8b2252;">"\\*Flycheck errors\\*$"</span> <span style="color: #8b2252;">" \\*Flycheck checker\\*$"</span>
          <span style="color: #8b2252;">"\\*Paradox Report\\*$"</span> <span style="color: #8b2252;">"\\*package update results\\*$"</span> <span style="color: #8b2252;">"\\*Package-Lint\\*$"</span>
          <span style="color: #8b2252;">"\\*[Wo]*Man.*\\*$"</span>
          <span style="color: #8b2252;">"\\*ert\\*$"</span> overseer-buffer-mode
          <span style="color: #8b2252;">"\\*gud-debug\\*$"</span>
          <span style="color: #8b2252;">"\\*lsp-help\\*$"</span> <span style="color: #8b2252;">"\\*lsp session\\*$"</span>
          <span style="color: #8b2252;">"\\*quickrun\\*$"</span>
          <span style="color: #8b2252;">"\\*tldr\\*$"</span>
          <span style="color: #8b2252;">"\\*vc-.*\\*$"</span>
          <span style="color: #8b2252;">"\\*eldoc\\*"</span>
          <span style="color: #8b2252;">"^\\*elfeed-entry\\*$"</span>
          <span style="color: #8b2252;">"^\\*macro expansion\\**"</span>

          <span style="color: #8b2252;">"\\*Agenda Commands\\*"</span> <span style="color: #8b2252;">"\\*Org Select\\*"</span> <span style="color: #8b2252;">"\\*Capture\\*"</span> <span style="color: #8b2252;">"^CAPTURE-.*\\.org*"</span>
          <span style="color: #8b2252;">"\\*Gofmt Errors\\*$"</span> <span style="color: #8b2252;">"\\*Go Test\\*$"</span> godoc-mode
          <span style="color: #8b2252;">"\\*docker-containers\\*"</span> <span style="color: #8b2252;">"\\*docker-images\\*"</span> <span style="color: #8b2252;">"\\*docker-networks\\*"</span> <span style="color: #8b2252;">"\\*docker-volumes\\*"</span>
          <span style="color: #8b2252;">"\\*prolog\\*"</span> inferior-python-mode inf-ruby-mode swift-repl-mode
          <span style="color: #8b2252;">"\\*rustfmt\\*$"</span> rustic-compilation-mode rustic-cargo-clippy-mode))

  (<span style="color: #a020f0;">when</span> (display-grayscale-p)
    (<span style="color: #a020f0;">setq</span> popper-mode-line
          '(<span style="color: #483d8b;">:eval</span>
            (concat
             (propertize <span style="color: #8b2252;">" "</span> 'face 'mode-line-emphasis)
             (propertize <span style="color: #8b2252;">" "</span> 'face 'mode-line-emphasis)))))

  (<span style="color: #a020f0;">setq</span> popper-echo-dispatch-actions t)
  (<span style="color: #a020f0;">setq</span> popper-group-function nil)
  <span style="color: #483d8b;">:config</span>
  (popper-echo-mode 1)

  (with-no-warnings
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my-popper-fit-window-height</span> (win)
      <span style="color: #8b2252;">"Determine the height of popup window WIN by fitting it to the buffer's content."</span>
      (fit-window-to-buffer
       win
       (floor (frame-height) 3)
       (floor (frame-height) 3)))
    (<span style="color: #a020f0;">setq</span> popper-window-height #'my-popper-fit-window-height)

    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">popper-close-window-hack</span> (<span style="color: #228b22;">&amp;rest</span> _)
      <span style="color: #8b2252;">"Close popper window via `</span><span style="color: #008b8b;">C-g</span><span style="color: #8b2252;">'."</span>
      <span style="color: #b22222;">;; </span><span style="color: #b22222;">`</span><span style="color: #008b8b;">C-g</span><span style="color: #b22222;">' can deactivate region</span>
      (<span style="color: #a020f0;">when</span> (<span style="color: #a020f0;">and</span> (called-interactively-p 'interactive)
                 (not (region-active-p))
                 popper-open-popup-alist)
        (<span style="color: #a020f0;">let</span> ((window (caar popper-open-popup-alist)))
          (<span style="color: #a020f0;">when</span> (window-live-p window)
            (delete-window window)))))
    (advice-add #'keyboard-quit <span style="color: #483d8b;">:before</span> #'popper-close-window-hack)))
</pre>
</div>

<p>
<b>按键绑定</b>
</p>

<p>
我的模块化配置<a href="#h:keybindings-general">(<code>init-keybindings.el</code> 键位绑定 <code>general</code>)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-definer
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36825;&#37324;&#26159;&#20854;&#20182;&#30340;&#24555;&#25463;&#38190;</span>
  <span style="color: #8b2252;">"0"</span> 'select-window-0  <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC 0 &#20999;0&#21495;&#31383;&#21475;</span>
  <span style="color: #8b2252;">"1"</span> 'select-window-1  <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC 1 &#20999;1&#21495;&#31383;&#21475;</span>
  <span style="color: #8b2252;">"2"</span> 'select-window-2
  <span style="color: #8b2252;">"3"</span> 'select-window-3
  <span style="color: #8b2252;">"4"</span> 'select-window-4
  <span style="color: #8b2252;">"5"</span> 'select-window-5)

(+general-global-menu! <span style="color: #8b2252;">"window"</span> <span style="color: #8b2252;">"w"</span>
  <span style="color: #8b2252;">"/"</span> 'split-window-right   <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w / &#24038;&#21491;&#20998;&#23631;</span>
  <span style="color: #8b2252;">"-"</span> 'split-window-below   <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w - &#19978;&#19979;&#20998;&#23631;</span>
  <span style="color: #8b2252;">"m"</span> 'delete-other-windows <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w m &#20165;&#20445;&#30041;&#24403;&#21069;&#31383;&#21475;</span>
  <span style="color: #8b2252;">"u"</span> 'winner-undo           <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w u &#36820;&#22238;&#24067;&#23616;</span>
  <span style="color: #8b2252;">"z"</span> 'winner-redo           <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w z &#25764;&#38144;&#36820;&#22238;&#24067;&#23616;&#12290; &#21644;&#36820;&#22238;&#24067;&#23616;&#32467;&#21512;&#23454;&#29616;2&#20010;&#24067;&#23616;&#38388;&#20999;&#25442;</span>
  <span style="color: #8b2252;">"w"</span> 'esw/select-window     <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w w &#36873;&#25321;&#20998;&#23631;&#26041;&#24335; &gt;&#21521;&#21491;&#20998;&#65292;&lt;&#21521;&#24038;&#20998;&#65292;^&#21521;&#19978;&#20998;&#65292;v&#21521;&#19979;&#20998;</span>
  <span style="color: #8b2252;">"s"</span> 'esw/swap-two-windows  <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w s &#20132;&#25442;&#31383;&#21475; </span>
  <span style="color: #8b2252;">"d"</span> 'esw/delete-window     <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w d &#21024;&#38500;&#25351;&#23450;&#31383;&#21475;</span>
  <span style="color: #8b2252;">"="</span> 'balance-windows-area  <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w = &#31561;&#23485;&#24067;&#23616;</span>
  <span style="color: #8b2252;">"r"</span> 'esw/move-window
  <span style="color: #8b2252;">"x"</span> 'resize-window         <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w x &#35843;&#25972;&#31383;&#21475;&#22823;&#23567;&#12290;&#22914;f&#27700;&#24179;&#21464;&#22823;&#65307;b&#32553;&#23567;&#65307;n&#21521;&#19979;&#25193;&#65307;p&#21521;&#19978;&#25193;&#65307;</span>
  <span style="color: #8b2252;">"H"</span> 'buf-move-left         <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w H &#21491;&#36793;&#31383;&#21475;&#24038;&#31227;</span>
  <span style="color: #8b2252;">"L"</span> 'buf-move-right        <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w L &#31383;&#21475;&#21491;&#31227;</span>
  <span style="color: #8b2252;">"J"</span> 'buf-move-down         <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w J &#31383;&#21475;&#19979;&#31227;</span>
  <span style="color: #8b2252;">"K"</span> 'buf-move-up)          <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w K &#31383;&#21475;&#19978;&#31227;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span style="color: #8b2252;">"Load init-window done..."</span>)
(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">init-window</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:org" class="outline-3">
<h3 id="h:org"><span class="section-number-3">4.10.</span> <code>init-org.el</code></h3>
<div class="outline-text-3" id="text-h:org">
</div>
<div id="outline-container-h:org-built-in" class="outline-4">
<h4 id="h:org-built-in"><span class="section-number-4">4.10.1.</span> <code>init-org.el</code> 内置配置</h4>
<div class="outline-text-4" id="text-h:org-built-in">
<p>
在学习章节提到过<a href="#orgce33344">(learn org)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">config</span>

(<span style="color: #a020f0;">with-eval-after-load</span> 'org  <span style="color: #b22222;">; </span><span style="color: #b22222;">&#21551;&#21160;org&#25991;&#20214;&#26102;&#21152;&#36733;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20351;&#29992;&#26087;&#29256;&#24555;&#25463;&#38190;&lt;s +Tab</span>
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-tempo</span>)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20854;&#20182;</span>
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-protocol</span>) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#21152;&#36733;&#20869;&#32622;&#21253;, &#22312;&#25688;&#21462;&#32593;&#39029;&#20869;&#23481;&#26102;&#20250;&#29992;&#21040;</span>
  (<span style="color: #a020f0;">setq</span> org-image-actual-width nil) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#20869;&#23884;&#22270;&#29255;&#26159;&#21542;&#26174;&#31034;&#23454;&#38469;&#23485;&#24230;, &#40664;&#35748;&#20026;t</span>
  (<span style="color: #a020f0;">setq</span> org-return-follows-link t)  <span style="color: #b22222;">; </span><span style="color: #b22222;">&#38142;&#25509;&#20301;&#32622;&#22238;&#36710;&#65292;&#20351;&#29992;&#22806;&#37096;&#31243;&#24207;&#25171;&#24320;</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#31105;&#29992;&#24038;&#23574;&#25324;&#21495;</span>
  (<span style="color: #a020f0;">setq</span> electric-pair-inhibit-predicate
        `(<span style="color: #a020f0;">lambda</span> (c)
           (<span style="color: #a020f0;">if</span> (char-equal c ?\&lt;) t (,electric-pair-inhibit-predicate c))))

  (add-hook 'org-mode-hook
            (<span style="color: #a020f0;">lambda</span> ()
              (<span style="color: #a020f0;">setq-local</span> electric-pair-inhibit-predicate
                          `(<span style="color: #a020f0;">lambda</span> (c)
                             (<span style="color: #a020f0;">if</span> (char-equal c ?\&lt;) t (,electric-pair-inhibit-predicate c))))))
)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:bd869f5d-b960-4a71-a831-455165c3b55e" class="outline-4">
<h4 id="h:bd869f5d-b960-4a71-a831-455165c3b55e"><span class="section-number-4">4.10.2.</span> <code>init-org.el</code> 安装最新org包</h4>
<div class="outline-text-4" id="text-h:bd869f5d-b960-4a71-a831-455165c3b55e">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#23433;&#35013; org&#65292;&#36825;&#20010;&#37197;&#32622;&#19968;&#23450;&#35201;&#37197;&#32622;&#22312; use-package &#30340;&#21021;&#22987;&#21270;&#20043;&#21069;&#65292;&#21542;&#21017;&#26080;&#27861;&#27491;&#24120;&#23433;&#35013;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(assq-delete-all 'org package--builtins)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(assq-delete-all 'org package--builtin-versions)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(use-package org</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">:pin gnu-elpa</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">:ensure t)</span>

(<span style="color: #a020f0;">use-package</span> org-contrib  <span style="color: #b22222;">;</span><span style="color: #b22222;">&#38750;org&#30340;&#23448;&#26041;&#36129;&#29486;&#30340;&#25554;&#20214;</span>
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:pin</span> nongnu)

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Org-mode (personal information manager)</span>
(<span style="color: #a020f0;">use-package</span> org
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:init</span>
  (<span style="color: #a020f0;">setq</span> org-imenu-depth 7)

  (add-to-list 'safe-local-variable-values '(org-hide-leading-stars . t))
  (add-to-list 'safe-local-variable-values '(org-hide-macro-markers . t))
  <span style="color: #483d8b;">:bind</span>
  ( <span style="color: #483d8b;">:map</span> global-map
    (<span style="color: #8b2252;">"C-c l"</span> . org-store-link) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#23384;&#20648;&#24403;&#21069;&#36830;&#25509;</span>
    (<span style="color: #8b2252;">"C-c o"</span> . org-open-at-point-global)
    <span style="color: #483d8b;">:map</span> org-mode-map
    (<span style="color: #8b2252;">"C-c M-l"</span> . org-insert-last-stored-link) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#25554;&#20837;&#26368;&#36817;&#23384;&#20648;&#30340;&#36830;&#25509;</span>
    (<span style="color: #8b2252;">"C-c C-M-l"</span> . org-toggle-link-display) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#26174;&#31034;&#36830;&#25509;&#20869;&#23481;</span>
    <span style="color: #483d8b;">:map</span> ctl-x-x-map
    (<span style="color: #8b2252;">"i"</span> . j-org-id-headlines) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#20026;&#26631;&#39064;&#21019;&#24314;&#23646;&#24615;CUSTOM_ID</span>
    (<span style="color: #8b2252;">"h"</span> . j-org-ox-html)      <span style="color: #b22222;">; </span><span style="color: #b22222;">org&#23548;&#20986;&#20026;html</span>
    ))
<span style="color: #b22222;">;;;; </span><span style="color: #b22222;">links</span>
(<span style="color: #a020f0;">use-package</span> org
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:config</span>
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">j-org</span>) <span style="color: #b22222;">; </span><span style="color: #b22222;">for the above commands</span>

  (<span style="color: #a020f0;">setq</span> org-link-context-for-files t)
  (<span style="color: #a020f0;">setq</span> org-link-keep-stored-after-insertion nil)
  (<span style="color: #a020f0;">setq</span> org-id-link-to-org-use-id 'create-if-interactive-and-no-custom-id))

<span style="color: #b22222;">;;;; </span><span style="color: #b22222;">code blocks</span>
(<span style="color: #a020f0;">use-package</span> org
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:config</span>
  <span style="color: #b22222;">;;</span><span style="color: #b22222;">(setq org-confirm-babel-evaluate nil)             ; &#20351;&#29992;Babel&#25191;&#34892;&#20195;&#30721;&#22359;&#26102;, &#26159;&#21542;&#24377;&#20986;&#30830;&#35748;&#23545;&#35805;&#26694;. nil &#31105;&#27490;&#24377;&#20986;, &#40664;&#35748;t&#24377;&#20986;</span>
  <span style="color: #b22222;">;;</span><span style="color: #b22222;">(setq org-src-window-setup 'current-window)       ; &#28304;&#20195;&#30721;&#31383;&#21475;&#30340;&#24067;&#23616;&#20301;&#32622;. &#40664;&#35748; 'reorganize-frame &#20391;&#36793;&#12290; 'current-window &#24403;&#21069;&#31383;&#21475; </span>
  <span style="color: #b22222;">;;</span><span style="color: #b22222;">(setq org-edit-src-persistent-message nil)        ; &#32534;&#36753;&#28304;&#20195;&#30721;&#26102;&#26174;&#31034;&#25345;&#20037;&#30340;&#28040;&#24687;&#12290;nil &#19981;&#26174;&#31034;, &#40664;&#35748; t</span>
  <span style="color: #b22222;">;;</span><span style="color: #b22222;">(setq org-src-fontify-natively t)                 ; &#28304;&#20195;&#30721;&#26412;&#22320;&#39640;&#20142;&#12290;&#40664;&#35748;t</span>
  (<span style="color: #a020f0;">setq</span> org-src-preserve-indentation t)             <span style="color: #b22222;">; </span><span style="color: #b22222;">&#32534;&#36753;&#28304;&#20195;&#30721;&#26102;&#20445;&#30041;&#21407;&#26377;&#30340;&#32553;&#36827;&#65292;t&#20195;&#34920;&#21551;&#29992;&#35813;&#21151;&#33021;&#12290;&#40664;&#35748;nil&#19981;&#20445;&#30041;. </span>
  (<span style="color: #a020f0;">setq</span> org-src-tab-acts-natively t)                <span style="color: #b22222;">; </span><span style="color: #b22222;">&#28304;&#20195;&#30721;&#32534;&#36753;&#27169;&#24335;&#19979;&#65292;Tab&#38190;&#30340;&#34892;&#20026;&#19982;&#21407;&#29983;&#20195;&#30721;&#32534;&#36753;&#22120;&#19968;&#33268;&#65292;t&#20195;&#34920;&#21551;&#29992;&#35813;&#21151;&#33021;,  &#40664;&#35748;t</span>
  (<span style="color: #a020f0;">setq</span> org-edit-src-content-indentation 0))          <span style="color: #b22222;">; </span><span style="color: #b22222;">&#20195;&#30721;&#22359;&#37324;&#32553;&#36827;&#65292;0&#19981;&#32553;&#36827;&#65292;&#40664;&#35748;&#26159;2(&#37325;&#35201;)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:0934bafe-c508-40e7-8312-64fcb0af71fe" class="outline-4">
<h4 id="h:0934bafe-c508-40e7-8312-64fcb0af71fe"><span class="section-number-4">4.10.3.</span> <code>init-org.el</code> org 编程语言支持</h4>
<div class="outline-text-4" id="text-h:0934bafe-c508-40e7-8312-64fcb0af71fe">
<p>
参考：<a href="https://orgmode.org/worg/org-contrib/babel/languages/">Babel: Languages</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">Bael: Languages</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">https://orgmode.org/worg/org-contrib/babel/languages/</span>
(org-babel-do-load-languages
 'org-babel-load-languages
 '((perl . t)
   (ruby . t)
   (shell . t)
   (dot . t)
   <span style="color: #b22222;">;; </span><span style="color: #b22222;">(typescript . t)</span>
   (js . t)
   (latex .t)
   (python . t)
   (emacs-lisp . t)
   (plantuml . t)
   (C . t)
   (ditaa . t)))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:org-todo" class="outline-4">
<h4 id="h:org-todo"><span class="section-number-4">4.10.4.</span> <code>init-org.el</code> org todo</h4>
<div class="outline-text-4" id="text-h:org-todo">
<p>
在我的学习文章提到过(<a href="#h:0ef565c4-904d-4863-9c8b-7462407b2659">模块列表</a>)
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span style="color: #a020f0;">with-eval-after-load</span> 'org  <span style="color: #b22222;">; </span><span style="color: #b22222;">&#21551;&#21160;org&#25991;&#20214;&#26102;&#21152;&#36733;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#33258;&#23450;&#20041;org todo  C-c C-t </span>
  (<span style="color: #a020f0;">setq</span> org-todo-keywords
        (<span style="color: #a020f0;">quote</span> ((sequence <span style="color: #8b2252;">"TODO(t)"</span> <span style="color: #8b2252;">"STARTED(s)"</span> <span style="color: #8b2252;">"|"</span> <span style="color: #8b2252;">"DONE(d!/!)"</span>)
                (sequence <span style="color: #8b2252;">"WAITING(w@/!)"</span> <span style="color: #8b2252;">"SOMEDAY(S)"</span> <span style="color: #8b2252;">"|"</span> <span style="color: #8b2252;">"CANCELLED(c@/!)"</span> <span style="color: #8b2252;">"MEETING(m)"</span> <span style="color: #8b2252;">"PHONE(p)"</span>))))
)
</pre>
</div>

<p>
以上代码让你在为一个标题提供待办事项状态时添加了一个键序列，你可以键入 <code>C-c C-t</code> 来查看效果。
</p>

<p>
其中 <code>@</code> 代表记录日志，而 <code>!</code> 代表记录时间戳，你也可以让他们具有两种功能: <code>TODO(t@/!)</code>
</p>

<p>
<b>任务进度</b> ：
</p>

<p>
创建文件 <code>~/gtd.org</code>
</p>
<div class="org-src-container">
<pre class="src src-org"><span style="color: #0000ff;">* WAITING Daily routine</span>
- <span style="font-weight: bold;">[ ]</span> leetcode
- <span style="font-weight: bold;">[ ]</span> execrcise
</pre>
</div>


<div class="org-src-container">
<pre class="src src-org"><span style="color: #0000ff;">* </span><span style="color: #ff0000; font-weight: bold;">TODO</span><span style="color: #0000ff;"> Daily routine </span><span style="color: #228b22; font-weight: bold;">[100%]</span>
<span style="color: #a020f0;">SCHEDULED:</span> <span style="color: #a020f0; text-decoration: underline;">&lt;2022-06-10 Fri 10:00 +1d&gt;</span>
<span style="color: #0000ff;">:PROPERTIES:</span>
<span style="color: #a020f0;">:LAST_REPEAT:</span> <span style="color: #a020f0; background-color: #ffffff; text-decoration: underline;">[2022-06-09 Thu 02:31]</span>
<span style="color: #0000ff;">:END:</span>
- State "DONE"       from "TODO"       <span style="color: #a020f0; text-decoration: underline;">[2022-06-09 Thu 02:31]</span>
- State "TODO"       from "WAITING"    <span style="color: #a020f0; text-decoration: underline;">[2022-06-09 Thu 02:26]</span>
- <span style="font-weight: bold;">[X]</span> leetcode
- <span style="font-weight: bold;">[X]</span> execrcise
</pre>
</div>

<ul class="org-ul">
<li><code>C-c C-s</code> 开始计划： <code>&lt;2022-06-09 Thu 10:00&gt;</code> 10点</li>

<li>每天 10 点做：需要 <code>+d</code> 加一天 <code>SCHEDULED: &lt;2022-06-09 Thu 10:00 +1d&gt;</code> ，后面在 agenda 中会用到</li>

<li>完成情况进度：每一项任务使用复选框，todo 部分加 <code>[%]</code> ，复选框使用 <code>C-c C-c</code> 打 叉 表示完成。</li>
</ul>

<p>
标记完成：=C-c C-t d= ，可以看到 <code>SCHEDULED</code> 时间自动加 1 <code>SCHEDULED: &lt;2022-06-10 Fri 10:00 +1d&gt;</code>
</p>

<div class="org-src-container">
<pre class="src src-org"><span style="color: #0000ff;">* </span><span style="color: #ff0000; font-weight: bold;">TODO</span><span style="color: #0000ff;"> Daily routine </span><span style="color: #228b22; font-weight: bold;">[100%]</span>
<span style="color: #a020f0;">SCHEDULED:</span> <span style="color: #a020f0; text-decoration: underline;">&lt;2022-06-10 Fri 10:00 +1d&gt;</span>
<span style="color: #0000ff;">:PROPERTIES:</span>
<span style="color: #a020f0;">:LAST_REPEAT:</span> <span style="color: #a020f0; background-color: #ffffff; text-decoration: underline;">[2022-06-09 Thu 02:31]</span>
<span style="color: #0000ff;">:END:</span>
- State "DONE"       from "TODO"       <span style="color: #a020f0; text-decoration: underline;">[2022-06-09 Thu 02:31]</span>
- State "TODO"       from "WAITING"    <span style="color: #a020f0; text-decoration: underline;">[2022-06-09 Thu 02:26]</span>
- <span style="font-weight: bold;">[X]</span> leetcode
- <span style="font-weight: bold;">[X]</span> execrcise
</pre>
</div>

<p>
不过进入新的计划，每一项还需要新状态。这很麻烦，所以这边用另一个插件包 org-contrib。
目的是要引入 check list
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">with-eval-after-load</span> 'org
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#24341;&#20837;checklist, &#33258;&#21160;&#26356;&#26032;&#29366;&#24577;</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">org-set-property &#28155;&#21152; RESET_CHECK_BOXS, &#35774;&#32622;&#20026;t</span>
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-checklist</span>)
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">need repeat task and properties</span>
  (<span style="color: #a020f0;">setq</span> org-log-done t)
  (<span style="color: #a020f0;">setq</span> org-log-into-drawer t)

)
</pre>
</div>

<p>
通过 <code>M-x org-set-property</code>  添加 <code>RESET_CHECK_BOXES</code> 。 <code>RESET_CHECK_BOXES</code>  设置为 <code>t</code> 开启， 会在 <code>PROPERTIES</code> 中增加属性。
</p>

<p>
当 <code>C-c C-t d</code> 把标题设置为 DONE，自动进入下一个时间点。 这对自定义一些重复性工作比较方便。
</p>


<div class="org-src-container">
<pre class="src src-org"><span style="color: #0000ff;">* </span><span style="color: #ff0000; font-weight: bold;">TODO</span><span style="color: #0000ff;"> Daily routine </span><span style="color: #ff0000; font-weight: bold;">[0%]</span>
<span style="color: #a020f0;">SCHEDULED:</span> <span style="color: #a020f0; text-decoration: underline;">&lt;2022-06-15 Wed 10:00 +1d&gt;</span>
<span style="color: #0000ff;">:PROPERTIES:</span>
<span style="color: #a020f0;">:LAST_REPEAT:</span> <span style="color: #a020f0; background-color: #ffffff; text-decoration: underline;">[2022-06-09 Thu 07:24]</span>
<span style="color: #a020f0;">:RESET_CHECK_BOXES:</span> <span style="color: #000000; background-color: #ffffff;">t</span>
<span style="color: #0000ff;">:END:</span>
- State "DONE"       from "TODO"       <span style="color: #a020f0; text-decoration: underline;">[2022-06-09 Thu 07:24]</span>
- State "DONE"       from "TODO"       <span style="color: #a020f0; text-decoration: underline;">[2022-06-09 Thu 02:31]</span>
- State "TODO"       from "WAITING"    <span style="color: #a020f0; text-decoration: underline;">[2022-06-09 Thu 02:26]</span>
- <span style="font-weight: bold;">[ ]</span> leetcode
- <span style="font-weight: bold;">[ ]</span> execrcise
</pre>
</div>

<p>
每次完成任务会自动插入完成状态，使用下面设置可以隐藏到 <code>PROPERTIES</code> 里：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">need repeat task and properties</span>
(<span style="color: #a020f0;">setq</span> org-log-done t)
(<span style="color: #a020f0;">setq</span> org-log-into-drawer t)
</pre>
</div>

<p>
使用 <code>C-c C-t d</code> 完成任务， 完成状态会增加到 <code>LOGBOOK</code> 属性中。把之前的状态手动移过来。
</p>
<div class="org-src-container">
<pre class="src src-org"><span style="color: #0000ff;">* </span><span style="color: #ff0000; font-weight: bold;">TODO</span><span style="color: #0000ff;"> Daily routine </span><span style="color: #ff0000; font-weight: bold;">[0%]</span>
<span style="color: #a020f0;">SCHEDULED:</span> <span style="color: #a020f0; text-decoration: underline;">&lt;2022-06-17 Fri 10:00 +1d&gt;</span>
<span style="color: #0000ff;">:PROPERTIES:</span>
<span style="color: #a020f0;">:LAST_REPEAT:</span> <span style="color: #a020f0; background-color: #ffffff; text-decoration: underline;">[2022-06-09 Thu 07:44]</span>
<span style="color: #a020f0;">:RESET_CHECK_BOXES:</span> <span style="color: #000000; background-color: #ffffff;">t</span>
<span style="color: #0000ff;">:END:</span>
<span style="color: #0000ff;">:LOGBOOK:</span>
- State "DONE"       from "TODO"       <span style="color: #a020f0; text-decoration: underline;">[2022-06-09 Thu 07:44]</span>
- State "DONE"       from "TODO"       <span style="color: #a020f0; text-decoration: underline;">[2022-06-09 Thu 07:34]</span>
- State "DONE"       from "TODO"       <span style="color: #a020f0; text-decoration: underline;">[2022-06-09 Thu 07:24]</span>
- State "DONE"       from              <span style="color: #a020f0; text-decoration: underline;">[2022-06-09 Thu 03:03]</span>
- State "DONE"       from              <span style="color: #a020f0; text-decoration: underline;">[2022-06-09 Thu 02:50]</span>
- State "DONE"       from "TODO"       <span style="color: #a020f0; text-decoration: underline;">[2022-06-09 Thu 02:31]</span>
- State "TODO"       from "WAITING"    <span style="color: #a020f0; text-decoration: underline;">[2022-06-09 Thu 02:26]</span>  
<span style="color: #0000ff;">:END:</span>
- <span style="font-weight: bold;">[ ]</span> leetcode
- <span style="font-weight: bold;">[ ]</span> execrcise
</pre>
</div>
</div>
</div>
<div id="outline-container-h:org-agenda" class="outline-4">
<h4 id="h:org-agenda"><span class="section-number-4">4.10.5.</span> <code>init-org.el</code> org agenda</h4>
<div class="outline-text-4" id="text-h:org-agenda">
<p>
相当于有一个日历实时告诉你每天要做什么。通过 <code>M-x org-agenda</code> 来打开. 这里需要一个存放日程的目录，同时绑定快捷键 <code>C-c a</code> 方便查看。
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#26085;&#21382;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">C-c C-s schedule</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">C-c C-d deadline</span>
(global-set-key (kbd <span style="color: #8b2252;">"C-c a"</span>) 'org-agenda)
(<span style="color: #a020f0;">setq</span> org-agenda-files '(<span style="color: #8b2252;">"~/gtd.org"</span>)) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#23450;&#20041; agenda &#25991;&#20214;&#65292;&#21487;&#20197;&#26159;&#22810;&#20010;</span>
(<span style="color: #a020f0;">setq</span> org-agenda-span 'day) <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#25353;&#22825;&#35266;&#23519;</span>
</pre>
</div>

<p>
基本操作：
</p>
<ul class="org-ul">
<li><code>C-c a a</code>  可以看到每周日程。</li>
<li><code>f/b</code> 下一个/上一个阶段安排, <code>d/w</code> 天/周视图，=n/p= 上/下移动光标</li>
<li>在 <code>~/gtd.org</code> 设置 deadline <code>C-c C-d</code> ，在日程中也能看到。</li>
</ul>
</div>
</div>
<div id="outline-container-h:org-capture" class="outline-4">
<h4 id="h:org-capture"><span class="section-number-4">4.10.6.</span> <code>init-org.el</code> org capture</h4>
<div class="outline-text-4" id="text-h:org-capture">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> org-capture-templates
      '((<span style="color: #8b2252;">"t"</span> <span style="color: #8b2252;">"Todo"</span> entry (file+headline <span style="color: #8b2252;">"~/gtd.org"</span> <span style="color: #8b2252;">"Workspace"</span>)
         <span style="color: #8b2252;">"* TODO [#B] %?\n  %i\n %U"</span>
         <span style="color: #483d8b;">:empty-lines</span> 1)))

(global-set-key (kbd <span style="color: #8b2252;">"C-c r"</span>) 'org-capture)
</pre>
</div>

<p>
这个模板包含五个部分，分别是
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">模板组成</td>
<td class="org-left">对应默认模板中的内容</td>
<td class="org-left">描述</td>
</tr>

<tr>
<td class="org-left">key</td>
<td class="org-left">&ldquo;t&rdquo;</td>
<td class="org-left">用来选择模板的字符</td>
</tr>

<tr>
<td class="org-left">description</td>
<td class="org-left">&ldquo;Todo&rdquo;</td>
<td class="org-left">展示用的模板描述</td>
</tr>

<tr>
<td class="org-left">type</td>
<td class="org-left">entry</td>
<td class="org-left">新增内容的类型</td>
</tr>

<tr>
<td class="org-left">target</td>
<td class="org-left">(file+headline &ldquo;~/gtd.org&rdquo; &ldquo;Workspace&rdquo;)</td>
<td class="org-left">新增内容的存储位置</td>
</tr>

<tr>
<td class="org-left">template</td>
<td class="org-left">&ldquo;* TODO [#B] %?\n  %i\n %U&rdquo;</td>
<td class="org-left">新增内容的模板</td>
</tr>
</tbody>
</table>

<p>
新增内容的模板:
</p>
<ul class="org-ul">
<li>&ldquo;%?&rdquo; 是一个更特殊的标记，它不会产生任何内容，当所有其他的特殊标记都展开完毕或者输入完毕后，光标将会停留在这个标记所在的位置。</li>
<li>%i 可以插入一段初始化内容</li>
<li>%U  当前包含日期和时间的未激活的 timestamp，如: <span class="timestamp-wrapper"><span class="timestamp">[2018-03-04 周日 19:26] </span></span></li>
</ul>

<p>
定义捕获模板，绑定到快捷键 <code>C-c r</code> 。 更写详细的参考官方文档。
</p>

<p>
操作：
</p>
<ul class="org-ul">
<li><code>C-c a t</code> 向指定文件中写内容。 <code>C-c C-c</code> 完成. 会记录到gtd.org文件中</li>
<li>在文件中设置开始时间 <code>C-c C-s</code> 21:00 点， 再执行 <code>C-c a a</code> 就可看到日程更新了。</li>
</ul>

<p>
我用以下配置
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> org-capture-templates
      '((<span style="color: #8b2252;">"t"</span> <span style="color: #8b2252;">"Todo"</span> entry (file+headline <span style="color: #8b2252;">"~/gtd.org"</span> <span style="color: #8b2252;">"Workspace"</span>)
         <span style="color: #8b2252;">"* TODO [#B] %?\n  %i\n %U"</span>
         <span style="color: #483d8b;">:empty-lines</span> 1)
        <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#29992;&#26469;&#25688;&#21462;&#32593;&#39029;&#20869;&#23481;</span>
        (<span style="color: #8b2252;">"x"</span> <span style="color: #8b2252;">"Web Collections"</span> entry
         (file+headline org-agenda-file-note <span style="color: #8b2252;">"Web"</span>)
         <span style="color: #8b2252;">"* %U %:annotation\n\n%:initial\n\n%?"</span>)
        ))

(<span style="color: #a020f0;">setq</span> org-agenda-file-note (expand-file-name <span style="color: #8b2252;">"~/notes.org"</span>)) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#20445;&#23384;&#32593;&#39029;&#20869;&#23481;</span>

(global-set-key (kbd <span style="color: #8b2252;">"C-c r"</span>) 'org-capture)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:org-effect" class="outline-4">
<h4 id="h:org-effect"><span class="section-number-4">4.10.7.</span> <code>init-org.el</code> org effect</h4>
<div class="outline-text-4" id="text-h:org-effect">
<p>
设置任务完成需要的时间。
</p>

<p>
在 agenda view 中,  <code>e</code> 键可以设置effort, 按 <code>_</code> (org-agenda-filter-by-effort) 可以过滤指定effort 的heading
</p>

<p>
范例:设置 30分钟任务
</p>
<ul class="org-ul">
<li>进入agenda <code>C-c a a</code></li>
<li>设置完成任务需要30分钟，按 <code>e</code> 输入 <code>00:30</code></li>
<li>过滤 1 小时内能完成任务，按 <code>_</code>  输入 <code>&lt;</code> 选择 [4]1:00 对应的数字 4</li>
</ul>
</div>
</div>
<div id="outline-container-h:org-tags" class="outline-4">
<h4 id="h:org-tags"><span class="section-number-4">4.10.8.</span> <code>init-org.el</code> org tags</h4>
<div class="outline-text-4" id="text-h:org-tags">
<p>
在 agenda view 中添加tag, 使用 <code>:</code> , 也可以 <code>M-x org-agenda-set-tags</code> 添加。
</p>
</div>
</div>
<div id="outline-container-h:org-priority" class="outline-4">
<h4 id="h:org-priority"><span class="section-number-4">4.10.9.</span> <code>init-org.el</code> org priority</h4>
<div class="outline-text-4" id="text-h:org-priority">
<p>
有三种优先级模式，A-C，若不指定优先级，&rsquo;B&rsquo;等级是默认的。
</p>
<ul class="org-ul">
<li><code>C-c ,</code> 或者  <code>M-x org-priority</code>  : 设置当前标题的优先级，键入A-C设置级别，或者键入SPC清除标记</li>
<li id="S-UP/DOWN ">提升/降低当前标题的优先级</li>
</ul>

<p>
设置agenda中优先级A的为“重要且紧急的事”
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> org-agenda-custom-commands
      '((<span style="color: #8b2252;">"c"</span> <span style="color: #8b2252;">"&#37325;&#35201;&#19988;&#32039;&#24613;&#30340;&#20107;"</span>
         ((tags-todo <span style="color: #8b2252;">"+PRIORITY=\"A\""</span>)))
        <span style="color: #b22222;">;; </span><span style="color: #b22222;">...other commands here</span>
        ))
</pre>
</div>

<p>
查看重要且紧急的事：
</p>
<ul class="org-ul">
<li>进行agenda  视图 <code>C-c a a=，设置优先级A， 按 =,</code>  逗号，输入a。</li>
<li>查看重要且紧急的事，=C-c a c= 展示重要且紧急的事（必须有 TODO 状态）。</li>
</ul>
</div>
</div>
<div id="outline-container-h:org-jietu" class="outline-4">
<h4 id="h:org-jietu"><span class="section-number-4">4.10.10.</span> <code>init-org.el</code> org 截图</h4>
<div class="outline-text-4" id="text-h:org-jietu">
<p>
在我的学习文章提到过(<a href="#h:0ef565c4-904d-4863-9c8b-7462407b2659">模块列表</a>)
</p>

<ul class="org-ul">
<li>org-download 29版本支持不友好</li>
<li>自定义函数，灵活点</li>
</ul>

<p>
<b>org-download</b>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#25130;&#22270;</span>
(<span style="color: #a020f0;">use-package</span> org-download
    <span style="color: #483d8b;">:ensure</span> t
    <span style="color: #483d8b;">:demand</span> t
    <span style="color: #483d8b;">:after</span> org
    <span style="color: #483d8b;">:config</span>
    (add-hook 'dired-mode-hook 'org-download-enable)
    (<span style="color: #a020f0;">setq</span> org-download-screenshot-method <span style="color: #8b2252;">"powershell -c Add-Type -AssemblyName System.Windows.Forms;$image = [Windows.Forms.Clipboard]::GetImage();$image.Save('</span><span style="color: #008b8b;">%s</span><span style="color: #8b2252;">', [System.Drawing.Imaging.ImageFormat]::Png)"</span>)
    (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">org-download-annotate-default</span> (link)
      <span style="color: #8b2252;">"Annotate LINK with the time of download."</span>
      (make-string 0 ?\s))
    (<span style="color: #a020f0;">setq</span> org-download-image-attr-list
            `(,(concat <span style="color: #8b2252;">"\n#+DOWNLOADED: screenshot @ "</span>
                     (format-time-string <span style="color: #8b2252;">"%Y-%m-%d %a %H:%M:%S"</span> (current-time))
                     <span style="color: #8b2252;">"\n#+CAPTION: \n#+ATTR_ORG: :width 80%"</span>
                     <span style="color: #8b2252;">"\n#+ATTR_HTML: :width 80%"</span>)))
    (<span style="color: #a020f0;">setq-default</span> org-download-heading-lvl nil
                  org-download-image-dir <span style="color: #8b2252;">"./images"</span>
                  <span style="color: #b22222;">;; </span><span style="color: #b22222;">org-download-screenshot-method "screencapture -i %s"</span>
                    org-download-timestamp <span style="color: #8b2252;">"%Y%m%d_%H%M%S_"</span>
                  org-download-screenshot-file (expand-file-name <span style="color: #8b2252;">"screenshot.jpg"</span> temporary-file-directory)))

</pre>
</div>

<p>
安装截图工具
</p>
<ul class="org-ul">
<li>Linux / MacOS
<ul class="org-ul">
<li>snipaste</li>
</ul></li>
<li>pc
<ul class="org-ul">
<li>系统截图工具 <code>&lt;Win&gt;+&lt;shift&gt;+s</code></li>
<li><code>pacman -S mingw-w64-x86_64-imagemagick</code></li>
</ul></li>
</ul>

<p>
使用方法
</p>
<ul class="org-ul">
<li>使用系统截图工具 (<code>Windows</code> 下用 <code>&lt;Win&gt;+&lt;shift&gt;+s</code>) 将截图保存到剪贴板</li>
<li><code>M-x org-download-screenshot</code> 将剪贴板中图片粘贴到org文件中.</li>
</ul>

<p>
org-toggle-inline-images
</p>


<p>
<b>自定义函数</b>
</p>

<ul class="org-ul">
<li>j-org-download.el<a href="#h:j-org-download">(<code>j-org-download.el</code> 库)</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#25130;&#22270;</span>
(<span style="color: #a020f0;">use-package</span> j-org-download
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:demand</span> t
  <span style="color: #483d8b;">:bind</span>
  (<span style="color: #8b2252;">"&lt;f2&gt;"</span> . my/org-insert-clipboard-image))
</pre>
</div>

<p>
提示输入图片显示大小，默认800px, 可以指定如 80%显示。
</p>

<p>
可以使用压缩工具来压缩图片，这样使用的ffmpeg媒体流处理工具。官方下载安装配置path路径就可使用。
</p>


<p>
<b>改变图片大小</b>
</p>

<p>
显示和关闭内嵌图片 <code>M-x org-toggle-inline-images</code>
</p>

<pre class="example" id="org36de5a3">
#+CAPTION:  &lt;图片标题&gt;
#+ATTR_ORG: :width 800px
#+ATTR_HTML: :width 800px
</pre>


<p>
默认在org中 <code>org-image-actual-width</code> 变量值t, 显示的图片大小是实际图片大小.
修改变量的值，按指定大小显示。
</p>

<pre class="example" id="orgc59092f">
- 配置文件中设置变量的值
(setq org-image-actual-width nil)

- 单独为文件设置局部变量，方法是在 org 文件的第1行加下面内容
# -*- org-image-actual-width: nil; -*-
</pre>

<p>
<b>使用yasnippets创建图片属性段</b>
</p>


<ul class="org-ul">
<li><p>
<code>M-x yas-new-snippet</code> 创建新代码片段
</p>

<pre class="example" id="orgd2a745c">
# -*- mode: snippet -*-
# key: imw
# name: image-width
# --
#+DOWNLOADED: screenshot @ `(format-time-string "%Y%m%d %a %H:%M:%S" (current-time))`
#+CAPTION: $0
#+ATTR_ORG: :width ${1:80%}
#+ATTR_HTML: :width ${2:80%}
</pre>

<p>
<code>$0</code> 光标位置， <code>$1..n</code> 使用tab, shift-tab切换占位符位置，可以设置默认值如 <code>${1:aa}</code>
</p>

<p>
<code>`()`</code> 可以写lisp语法
</p></li>
<li><code>C-c C-c=完成编程，选择片段生效的模式，保存指定位置 =~/.emacs.d/snippets/org-mode/&lt;name&gt;</code></li>
<li><code>M-x yas-describe-tables</code> 查看</li>
<li><code>M-x yas-visit-snippet-file</code> 编辑</li>
</ul>

<p>
imw后按TAB键补全
</p>
<pre class="example" id="org9045ffc">
#+DOWNLOADED: screenshot @ 20240728 周日 12:29:42
#+CAPTION: 
#+ATTR_ORG: :width 80%
#+ATTR_HTML: :width 80%
</pre>
</div>
</div>
<div id="outline-container-h:org-protocol" class="outline-4">
<h4 id="h:org-protocol"><span class="section-number-4">4.10.11.</span> <code>init-org.el</code> 从网页摘取内容 Org Protocol</h4>
<div class="outline-text-4" id="text-h:org-protocol">
<p>
在我的学习文章提到过(<a href="#h:0ef565c4-904d-4863-9c8b-7462407b2659">模块列表</a>)
</p>

<p>
官方文档：<a href="https://orgmode.org/worg/org-contrib/org-protocol.html">https://orgmode.org/worg/org-contrib/org-protocol.html</a>
</p>

<p>
从网页摘取内容
</p>

<p>
1.Step 1: Get emacsclient to work
</p>

<p>
设置快速打开emacs. Emacs 需要开启 Server Mode，代码如下：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(server-mode 1)
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-protocol</span>) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#21152;&#36733;&#20869;&#32622;&#21253;</span>
</pre>
</div>


<p>
2.创建注册表文件 org-protocol.reg
</p>

<p>
指定emacsclientw位置
</p>

<p>
PC
</p>
<pre class="example" id="org3e850cc">
Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\org-protocol]
"URL Protocol"=""
@="URL:Org Protocol"

[HKEY_CLASSES_ROOT\org-protocol\shell]

[HKEY_CLASSES_ROOT\org-protocol\shell\open]

[HKEY_CLASSES_ROOT\org-protocol\shell\open\command]
@="\"D:\\msys64\\mingw64\\bin\\emacsclientw.exe\"  \"%1\""
</pre>

<p>
双击注册文件运行。
</p>

<p>
3.add org templates
</p>

<p>
定义capture模板，用来快速摘取网页内容<a href="#h:org-capture">(<code>init-org.el</code> org capture)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> org-agenda-file-note (expand-file-name <span style="color: #8b2252;">"~/notes.org"</span>))
(<span style="color: #a020f0;">setq</span> org-capture-templates
      '(
        (<span style="color: #8b2252;">"x"</span> <span style="color: #8b2252;">"Web Collections"</span> entry
         (file+headline org-agenda-file-note <span style="color: #8b2252;">"Web"</span>)
         <span style="color: #8b2252;">"* %U %:annotation\n\n%:initial\n\n%?"</span>)
        ))
</pre>
</div>

<p>
4.add chrome bookmark
</p>

<p>
在chrome浏览器上添加新标签，将下面js代码复制进行地址，标签名自定义，保存
</p>

<pre class="example" id="org19a6d39">
javascript:location.href='org-protocol://capture?template=x&amp;url=%27+encodeURIComponent(location.href)+%27&amp;title=%27+encodeURIComponent(document.title)+%27&amp;body=%27+encodeURIComponent(function(){var html = "";var sel = window.getSelection();if (sel.rangeCount) {var container = document.createElement("div");for (var i = 0, len = sel.rangeCount; i &lt; len; ++i) {container.appendChild(sel.getRangeAt(i).cloneContents());}html = container.innerHTML;}var dataDom = document.createElement(%27div%27);dataDom.innerHTML = html;dataDom.querySelectorAll(%27a%27).forEach(function(item, idx) {console.log(%27find a link%27);var url = new URL(item.href, window.location.href).href;var content = item.innerText;item.innerText = %27[[%27+url+%27][%27+content+%27]]%27;});[%27p%27, %27h1%27, %27h2%27, %27h3%27, %27h4%27].forEach(function(tag, idx){dataDom.querySelectorAll(tag).forEach(function(item, index) {var content = item.innerHTML.trim();if (content.length &gt; 0) {item.innerHTML = content + %27&amp;#13;&amp;#10;';}});});return dataDom.innerText.trim();}())
</pre>

<p>
使用： 选中网页文字, 点击标签。网页的内容就会写到org-capture中，=C-c C-c= 完成，
内容被保存在 <code>~/notes.org</code>
</p>

<p>
5.return follow link
</p>

<p>
在org中的光标在连接位置回车不能打开链接。如下设置回车后可在浏览器中打开。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">setq</span> org-return-follows-link t)  <span style="color: #b22222;">; </span><span style="color: #b22222;">&#38142;&#25509;&#20301;&#32622;&#22238;&#36710;&#65292;&#20351;&#29992;&#22806;&#37096;&#31243;&#24207;&#25171;&#24320;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:org-spell" class="outline-4">
<h4 id="h:org-spell"><span class="section-number-4">4.10.12.</span> <code>init-org.el</code> 拼写检查 Spell checking</h4>
<div class="outline-text-4" id="text-h:org-spell">
<p>
在我的学习文章提到过(<a href="#h:0ef565c4-904d-4863-9c8b-7462407b2659">模块列表</a>)
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> flyspell-correct
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:init</span>)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">ispell &#20026;&#20869;&#32622;&#21253;&#65292;&#38656;&#35201;&#20351;&#29992;&#22806;&#37096;&#31243;&#24207;&#26469;&#20570;&#35821;&#27861;&#26816;&#26597;</span>
(<span style="color: #a020f0;">use-package</span> ispell
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:init</span>
  (<span style="color: #a020f0;">setq</span> ispell-program-name <span style="color: #8b2252;">"aspell"</span>)
  (<span style="color: #a020f0;">dolist</span> (hook '(text-mode-hook))
    (add-hook hook (<span style="color: #a020f0;">lambda</span> () (flyspell-mode 1))))
  (<span style="color: #a020f0;">setq</span> ispell-personal-dictionary <span style="color: #8b2252;">"d:/msys64/mingw64/lib/aspell-0.60/en_GB"</span>)
  )

(define-key evil-insert-state-map (kbd <span style="color: #8b2252;">"C-;"</span>) 'flyspell-correct-previous)
</pre>
</div>

<p>
<b>Install spell</b>
</p>

<p>
PC: mysys2 中安装
</p>
<div class="org-src-container">
<pre class="src src-sh">pacman -S mingw64/mingw-w64-x86_64-aspell    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31243;&#24207;</span>
pacman -S mingw64/mingw-w64-x86_64-aspell-en <span style="color: #b22222;">#</span><span style="color: #b22222;">&#33521;&#35821;&#35821;&#27861;&#26816;&#26597;&#25991;&#20214;</span>
</pre>
</div>

<p>
<b>Configuration</b>
</p>

<p>
1.add &ldquo;*C:\msys64\mingw64\bin&rdquo; to to PATH
2.Error: The file &ldquo;c:\msys64\mingw64/lib/aspell-0.60/﻿en_US&rdquo; can not be opened for reading.
</p>

<p>
使用：
</p>
<ul class="org-ul">
<li><code>M-x ispell-minor-mode</code> <code>flyspell-mode</code> 手动激活</li>
<li><code>M-x flyspell-correct-previous</code> 或使用绑定的快捷键 <code>C;</code> 选择正常的拼写</li>
</ul>
</div>
</div>
<div id="outline-container-h:org-fanyi" class="outline-4">
<h4 id="h:org-fanyi"><span class="section-number-4">4.10.13.</span> <code>init-org.el</code> 翻译 Fanyi Dictionary</h4>
<div class="outline-text-4" id="text-h:org-fanyi">
<p>
在我的学习文章提到过(<a href="#h:0ef565c4-904d-4863-9c8b-7462407b2659">模块列表</a>)
</p>

<p>
有多种翻译工具，这里使用fanyi软件包
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#26377;&#36947;&#32763;&#35793;</span>
(<span style="color: #a020f0;">use-package</span> youdao-dictionary
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:commands</span> (youdao-dictionary-search-at-point+)
  <span style="color: #483d8b;">:init</span>
  (global-set-key (kbd <span style="color: #8b2252;">"C-c y"</span>) 'youdao-dictionary-search-at-point+))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">fanyi&#32763;&#35793;</span>
(<span style="color: #a020f0;">use-package</span> fanyi
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:custom</span>
  (fanyi-providers '(<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#28023;&#35789;</span>
                     <span style="color: #b22222;">;; </span><span style="color: #b22222;">fanyi-haici-provider</span>
                     <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#26377;&#36947;&#21516;&#20041;&#35789;&#35789;&#20856;</span>
                     fanyi-youdao-thesaurus-provider
                     <span style="color: #b22222;">;; </span><span style="color: #b22222;">Etymonline</span>
                     fanyi-etymon-provider
                     <span style="color: #b22222;">;; </span><span style="color: #b22222;">Longman</span>
                     <span style="color: #b22222;">;; </span><span style="color: #b22222;">fanyi-longman-provider)</span>
                   )))
</pre>
</div>

<p>
fanyi使用
</p>
<ul class="org-ul">
<li>光标停在单词处执行 <code>M-x fanyi-dwim2</code></li>
</ul>

<p>
<b>Some useful keybindings</b>
</p>

<pre class="example" id="org11fecc5">
C-RET  for creating new headlines
M-RET  for creating new lists
M-left/right/up/down
</pre>
</div>
</div>
<div id="outline-container-h:005568af-5e29-4582-9ba1-85eb4a7c4bc2" class="outline-4">
<h4 id="h:005568af-5e29-4582-9ba1-85eb4a7c4bc2"><span class="section-number-4">4.10.14.</span> <code>init-org.el</code> 双链笔记 <code>org-Roam</code></h4>
<div class="outline-text-4" id="text-h:005568af-5e29-4582-9ba1-85eb4a7c4bc2">
<p>
双链笔记系统
</p>

<p>
<b>安装 Org Oram</b>
</p>

<p>
在 HOME 新建一个 org 目录夹，用来存储你的 org roam 笔记。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> org-roam
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:custom</span>
  (org-roam-directory (file-truename <span style="color: #8b2252;">"~/org"</span>))  <span style="color: #b22222;">; </span><span style="color: #b22222;">&#40664;&#35748;&#31508;&#35760;&#30446;&#24405;&#65292;&#25552;&#21069;&#25163;&#21160;&#21019;&#24314;&#22909;</span>
  <span style="color: #483d8b;">:bind</span> ((<span style="color: #8b2252;">"C-c n l"</span> . org-roam-buffer-toggle)  <span style="color: #b22222;">; </span><span style="color: #b22222;">&#26174;&#31034;&#21453;&#21521;&#38142;&#25509;</span>
         (<span style="color: #8b2252;">"C-c n f"</span> . org-roam-node-find)      <span style="color: #b22222;">; </span><span style="color: #b22222;">&#26597;&#25214;</span>
         (<span style="color: #8b2252;">"C-c n g"</span> . org-roam-graph)
         (<span style="color: #8b2252;">"C-c n i"</span> . org-roam-node-insert)    <span style="color: #b22222;">; </span><span style="color: #b22222;">&#25554;&#20837;</span>
         (<span style="color: #8b2252;">"C-c n c"</span> . org-roam-capture)        <span style="color: #b22222;">; </span><span style="color: #b22222;">&#25429;&#33719;</span>
         <span style="color: #b22222;">;; </span><span style="color: #b22222;">Dailies</span>
         (<span style="color: #8b2252;">"C-c n j"</span> . org-roam-dailies-capture-today)) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#35760;&#26085;&#24535;&#21151;&#33021;</span>
  <span style="color: #483d8b;">:config</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">If you're using a vertical completion framework, you might want a more informative completion interface</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#21487;&#20197;&#25353;&#26631;&#39064;&#25628;&#32034;&#12289;tags&#25628;&#32034;</span>
  (<span style="color: #a020f0;">setq</span> org-roam-node-display-template (concat <span style="color: #8b2252;">"${title:*} "</span> (propertize <span style="color: #8b2252;">"${tags:10}"</span> 'face 'org-tag)))
  (org-roam-db-autosync-mode)    <span style="color: #b22222;">; </span><span style="color: #b22222;">&#21047;&#26032;&#25968;&#25454; sqlite3 &#24211; ~/.emacs.d/org-roam.db</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">If using org-roam-protocol</span>
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">org-roam-protocol</span>))
</pre>
</div>

<p>
<b>Org roam 基本使用</b>
</p>

<p>
新建笔记和查找笔记
</p>

<ul class="org-ul">
<li>org-roam-node-find(<code>C-c n f</code>) 如果没有，会创建新节点. 如节点名为 Elisp
<ul class="org-ul">
<li>输入节点名， <code>Alt-回车</code> 创建</li>
</ul></li>
<li>在新建节点上 <code>C-c C-c</code> 保存</li>
<li><p>
org-roam-capture(<code>C-c n c</code>)
</p>

<p>
创建一条新笔记. 未来可以预设不同主题的默认模板. 每一条笔记就是一个 org 文件
</p></li>

<li><p>
org-roam-insert(<code>C-c n i</code>)
</p>

<p>
插入一条笔记的链接
</p>

<p>
在查找笔记时利用 org-roam-find 的界面
</p>

<p>
若笔记不存在, 则利用 org-roam-capture 的界面创建笔记
</p></li>

<li><code>C-c C-k</code> 删除当前capture</li>
</ul>

<p>
加tags
</p>
<ul class="org-ul">
<li>添加tag <code>M-x org-roam-tag-add</code> , 使用 C-c n f 可以看到对应的tag</li>
</ul>

<p>
建立笔记引用
</p>

<pre class="example" id="orge9ef8dc">
[[]]
如：
[[输入要引用的节点名称，自动补全]]
</pre>

<p>
查找引用
</p>
<ul class="org-ul">
<li><code>M-x org-roam-buffer-toggle</code></li>
</ul>

<p>
已有的 headline 转换为一个节点
</p>
<ul class="org-ul">
<li><code>M-x org-id-get-create</code>  标题下会多个ID，</li>
<li>=M-x refile node 把当前标题移动一个已存在节点上.</li>
</ul>

<p>
刷新数据库
</p>

<p>
所有文件都保存后刷新库
</p>

<ul class="org-ul">
<li>自动更新: 通过 (org-roam-db-autosync-mode) 实现</li>
<li>手动更新 <code>M-x org-roam-db-sync</code></li>
</ul>
</div>
<div id="outline-container-h:d15ff21d-1471-4613-9ec9-8a9273665175" class="outline-5">
<h5 id="h:d15ff21d-1471-4613-9ec9-8a9273665175"><span class="section-number-5">4.10.14.1.</span> <code>init-org.el</code> org <code>org-roam-ui</code></h5>
<div class="outline-text-5" id="text-h:d15ff21d-1471-4613-9ec9-8a9273665175">
<p>
org-roam-ui 在pc下安装存在问题。系统默认按linux 系统安装tar解压. windows 上面需要使用 system32/tar 这个程序去解压。
</p>

<p>
解决方式： 使用vc来安装. 在emacs30已经集成(package-vc.el)
</p>


<p>
方法如下
</p>

<p>
<b>直接从 github 安装插件</b>
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> org-roam-ui
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:vc</span> (<span style="color: #483d8b;">:fetcher</span> <span style="color: #8b2252;">"github"</span> <span style="color: #483d8b;">:repo</span> <span style="color: #8b2252;">"org-roam/org-roam-ui"</span>))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> org-roam-ui
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:after</span> org-roam)
</pre>
</div>

<p>
鼠标操作, 节点右键从emacs中打开笔记
</p>

<p>
可视化
</p>

<p>
实时显示链接
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span style="color: #8b2252;">"Load init-org done..."</span>)
(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">init-org</span>)
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:personspace" class="outline-3">
<h3 id="h:personspace"><span class="section-number-3">4.11.</span> <code>init-persp.el</code> 工作区间管理</h3>
<div class="outline-text-3" id="text-h:personspace">
<p>
在我的学习文章提到过(<a href="#h:0ef565c4-904d-4863-9c8b-7462407b2659">模块列表</a>)
</p>
</div>
<div id="outline-container-h:dbb5227a-09bd-44ff-a2c9-59ab9c5b6f11" class="outline-4">
<h4 id="h:dbb5227a-09bd-44ff-a2c9-59ab9c5b6f11"><span class="section-number-4">4.11.1.</span> <code>init-window.el</code> 窗口 <code>tab-bar(built-in)</code></h4>
<div class="outline-text-4" id="text-h:dbb5227a-09bd-44ff-a2c9-59ab9c5b6f11">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> tab-bar
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:init</span>
  (tab-bar-mode t)
  (<span style="color: #a020f0;">setq</span> tab-bar-new-tab-choice <span style="color: #8b2252;">"*scratch*"</span>) <span style="color: #b22222;">;; </span><span style="color: #b22222;">buffer to show in new tabs</span>
  (<span style="color: #a020f0;">setq</span> tab-bar-close-button-show nil)      <span style="color: #b22222;">;; </span><span style="color: #b22222;">hide tab close / X button</span>
  (<span style="color: #a020f0;">setq</span> tab-bar-show 1)                     <span style="color: #b22222;">;; </span><span style="color: #b22222;">hide bar if &lt;= 1 tabs open</span>
  (<span style="color: #a020f0;">setq</span> tab-bar-format '(tab-bar-format-tabs tab-bar-separator))

  (custom-set-faces
   '(tab-bar ((t (<span style="color: #483d8b;">:inherit</span> mode-line))))
   '(tab-bar-tab ((t (<span style="color: #483d8b;">:inherit</span> mode-line <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"#993644"</span>))))
   '(tab-bar-tab-inactive ((t (<span style="color: #483d8b;">:inherit</span> mode-line-inactive <span style="color: #483d8b;">:foreground</span> <span style="color: #8b2252;">"black"</span>)))))

  (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">ct/circle-numbers-alist</span>
    '((0 . <span style="color: #8b2252;">"&#9450;"</span>)
      (1 . <span style="color: #8b2252;">"&#9312;"</span>)
      (2 . <span style="color: #8b2252;">"&#9313;"</span>)
      (3 . <span style="color: #8b2252;">"&#9314;"</span>)
      (4 . <span style="color: #8b2252;">"&#9315;"</span>)
      (5 . <span style="color: #8b2252;">"&#9316;"</span>)
      (6 . <span style="color: #8b2252;">"&#9317;"</span>)
      (7 . <span style="color: #8b2252;">"&#9318;"</span>)
      (8 . <span style="color: #8b2252;">"&#9319;"</span>)
      (9 . <span style="color: #8b2252;">"&#9320;"</span>))
    <span style="color: #8b2252;">"Alist of integers to strings of circled unicode numbers."</span>)

  (<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">ct/tab-bar-tab-name-format-default</span> (tab i)
    (<span style="color: #a020f0;">let</span> ((current-p (eq (car tab) 'current-tab))
          (tab-num (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> tab-bar-tab-hints (&lt; i 10))
                       (alist-get i ct/circle-numbers-alist) <span style="color: #8b2252;">""</span>)))
      (propertize
       (concat tab-num
               <span style="color: #8b2252;">" "</span>
               (alist-get 'name tab)
               (<span style="color: #a020f0;">or</span> (<span style="color: #a020f0;">and</span> tab-bar-close-button-show
                        (not (eq tab-bar-close-button-show
                                 (<span style="color: #a020f0;">if</span> current-p 'non-selected 'selected)))
                        tab-bar-close-button)
                   <span style="color: #8b2252;">""</span>)
               <span style="color: #8b2252;">" "</span>)
       'face (funcall tab-bar-tab-face-function tab))))
  (<span style="color: #a020f0;">setq</span> tab-bar-tab-name-format-function #'ct/tab-bar-tab-name-format-default)
  (<span style="color: #a020f0;">setq</span> tab-bar-tab-hints t))
</pre>
</div>

<p>
配置生效后，可以看到窗口上方有tab页。
</p>

<p>
通过 <code>M-x tab-bar-new-tab</code> 生成一个的 <code>tab-bar</code> 。
</p>

<p>
<code>M-x tab-bar-rename</code> 保持tab-bar名字不变，不跟随文件变化 。
</p>
</div>
</div>
<div id="outline-container-h:persp-tabspaces" class="outline-4">
<h4 id="h:persp-tabspaces"><span class="section-number-4">4.11.2.</span> <code>init-persp.el</code> 工作区间 <code>tabspaces</code></h4>
<div class="outline-text-4" id="text-h:persp-tabspaces">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> tabspaces
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">use this next line only if you also use straight, otherwise ignore it.</span>
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:hook</span> (after-init . tabspaces-mode) <span style="color: #b22222;">;; </span><span style="color: #b22222;">use this only if you want the minor-mode loaded at startup.</span>
  <span style="color: #483d8b;">:defer</span> t
  <span style="color: #483d8b;">:commands</span> (tabspaces-switch-or-create-workspace
             tabspaces-open-or-create-project-and-workspace)
  <span style="color: #483d8b;">:custom</span>
  (tabspaces-use-filtered-buffers-as-default t)
  (tabspaces-default-tab <span style="color: #8b2252;">"Default"</span>)
  (tabspaces-remove-to-default t)
  (tabspaces-include-buffers '(<span style="color: #8b2252;">"*scratch*"</span>))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">maybe slow &#20851;&#38381;emacs&#21518;&#33258;&#21160;&#24674;&#22797;&#24037;&#20316;&#31354;&#38388;&#12290;&#24597;&#24433;&#21709;&#24615;&#33021;&#21487;&#20197;&#27880;&#37322;&#25481;</span>
  <span style="color: #b22222;">;;</span><span style="color: #b22222;">(tabspaces-session t)</span>
  <span style="color: #b22222;">;;</span><span style="color: #b22222;">(tabspaces-session-auto-restore t)</span>
  <span style="color: #483d8b;">:config</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Filter Buffers for Consult-Buffer</span>

  (<span style="color: #a020f0;">with-eval-after-load</span> 'consult
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">hide full buffer list (still available with "b" prefix)</span>
    (consult-customize consult--source-buffer <span style="color: #483d8b;">:hidden</span> nil <span style="color: #483d8b;">:default</span> nil)
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">set consult-workspace buffer list</span>
    (<span style="color: #a020f0;">defvar</span> <span style="color: #a0522d;">consult--source-workspace</span>
      (list <span style="color: #483d8b;">:name</span> <span style="color: #8b2252;">"Workspace Buffers"</span>
            <span style="color: #483d8b;">:narrow</span> ?w
            <span style="color: #483d8b;">:history</span> 'buffer-name-history
            <span style="color: #483d8b;">:category</span> 'buffer
            <span style="color: #483d8b;">:state</span> #'consult--buffer-state
            <span style="color: #483d8b;">:default</span> t
            <span style="color: #483d8b;">:items</span> (<span style="color: #a020f0;">lambda</span> () (consult--buffer-query
                               <span style="color: #483d8b;">:predicate</span> #'tabspaces--local-buffer-p
                               <span style="color: #483d8b;">:sort</span> 'visibility
                               <span style="color: #483d8b;">:as</span> #'buffer-name)))

      <span style="color: #8b2252;">"Set workspace buffer list for consult-buffer."</span>)
    (add-to-list 'consult-buffer-sources 'consult--source-workspace)))
</pre>
</div>

<p>
重启或执行 <code>M-x tabspaces-mode</code> 生效。
</p>

<p>
<code>C-x b</code> 打开缓冲区，发现多了一个 <code>Workspace Buffer</code> ，这里的buffer优先使用。
</p>


<p>
<b>按键绑定</b>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(+general-global-menu! <span style="color: #8b2252;">"layout"</span> <span style="color: #8b2252;">"l"</span>
  <span style="color: #8b2252;">"l"</span> 'tabspaces-switch-or-create-workspace
  <span style="color: #8b2252;">"L"</span> 'tabspaces-restore-session
  <span style="color: #8b2252;">"p"</span> 'tabspaces-open-or-create-project-and-workspace
  <span style="color: #8b2252;">"f"</span> 'tabspaces-project-switch-project-open-file
  <span style="color: #8b2252;">"s"</span> 'tabspaces-save-session
  <span style="color: #8b2252;">"B"</span> 'tabspaces-switch-buffer-and-tab
  <span style="color: #8b2252;">"b"</span> 'tabspaces-switch-to-buffer
  <span style="color: #8b2252;">"R"</span> 'tab-rename
  <span style="color: #8b2252;">"TAB"</span> 'tab-bar-switch-to-recent-tab
  <span style="color: #8b2252;">"r"</span> 'tabspaces-remove-current-buffer
  <span style="color: #8b2252;">"k"</span> 'tabspaces-close-workspace)
</pre>
</div>

<p>
<b>工作流</b>
</p>

<p>
每一个工作空间都可以有布局
</p>



<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span style="color: #8b2252;">"Load init-persp done..."</span>)
(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">init-persp</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:48550b88-bb99-44c6-a4a3-2442cc2d0443" class="outline-3">
<h3 id="h:48550b88-bb99-44c6-a4a3-2442cc2d0443"><span class="section-number-3">4.12.</span> <code>init-programming.el</code></h3>
<div class="outline-text-3" id="text-h:48550b88-bb99-44c6-a4a3-2442cc2d0443">
</div>
<div id="outline-container-h:c++" class="outline-4">
<h4 id="h:c++"><span class="section-number-4">4.12.1.</span> <code>init-programming.el</code> c++</h4>
<div class="outline-text-4" id="text-h:c++">
</div>
<div id="outline-container-h:c++-eglot" class="outline-5">
<h5 id="h:c++-eglot"><span class="section-number-5">4.12.1.1.</span> <code>init-programming.el</code> 代码编写 <code>eglot</code></h5>
<div class="outline-text-5" id="text-h:c++-eglot">
<p>
在我的学习文章提到过(<a href="#h:0ef565c4-904d-4863-9c8b-7462407b2659">模块列表</a>)
</p>

<p>
使用 eglot 来编写、运行和调试 C/C++ 代码
</p>

<p>
<b>安装 mysys2</b>
</p>

<p>
1.下载 <a href="https://www.msys2.org/">https://www.msys2.org/</a>
</p>

<p>
2.安装 C/C++ 必要的软件工具
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;c++&#24517;&#35201;&#36719;&#20214; gcc gdb make clang clang-tool</span>
pacman -Syu
pacman -S mingw-w64-x86_64-gcc mingw-w64-x86_64-gdb make mingw-w64-x86_64-clang mingw-w64-x86_64-clang-tools-extra
</pre>
</div>

<p>
3.设置环境变量
</p>
<pre class="example" id="orgf65e668">
d:\msys64\mingw64\bin
d:\msys64\usr\bin
</pre>

<p>
<b>安装 eglot(Emacs 29 自带 eglot)</b>
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">c++ eglot</span>
(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">eglot</span>)
(add-to-list 'eglot-server-programs '((c++-mode c-mode) <span style="color: #8b2252;">"clangd"</span>))
(add-hook 'c-mode-hook #'eglot-ensure)
(add-hook 'c++-mode-hook #'eglot-ensure)
</pre>
</div>

<p>
测试一段c++代码
</p>

<p>
<code>~/test.cpp</code>
在emacs菜单栏flymake可以列出所有问题
</p>

<p>
<b>一键运行代码</b>
</p>

<p>
1.安装 quickrun:
</p>

<p>
可以运行任意一个单文件程序
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;; </span><span style="color: #b22222;">&#36816;&#34892;&#20219;&#24847;&#21333;&#25991;&#20214;&#31243;&#24207; &#24555;&#25463;&#38190;F5</span>
(<span style="color: #a020f0;">use-package</span> quickrun
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:commands</span> (quickrun)
  <span style="color: #483d8b;">:init</span>
  (quickrun-add-command <span style="color: #8b2252;">"c++/c1z"</span>
    '((<span style="color: #483d8b;">:command</span> . <span style="color: #8b2252;">"g++"</span>)
      (<span style="color: #483d8b;">:exec</span> . (<span style="color: #8b2252;">"%c -std=c++1z %o -o %e %s"</span>
                <span style="color: #8b2252;">"%e %a"</span>))
      (<span style="color: #483d8b;">:remove</span> . (<span style="color: #8b2252;">"%e"</span>)))
    <span style="color: #483d8b;">:default</span> <span style="color: #8b2252;">"c++"</span>))
(global-set-key (kbd <span style="color: #8b2252;">"&lt;f5&gt;"</span>) 'quickrun)
</pre>
</div>

<p>
<b>使用 gdb 调试</b>
</p>

<ol class="org-ol">
<li>运行 <code>M-x compile</code>, 输入 g++ -g -o test.o test.cpp #-g编译时生成调试信息</li>
<li>使用 <code>M-x gud-gdb</code> 输入 gdb ./test.o</li>
<li>常用调试命令</li>
</ol>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">name</td>
<td class="org-left">function</td>
</tr>

<tr>
<td class="org-left">list</td>
<td class="org-left">显示源代码</td>
</tr>

<tr>
<td class="org-left">break</td>
<td class="org-left">新增断点， break main, break 12（行号）</td>
</tr>

<tr>
<td class="org-left">info</td>
<td class="org-left">查看断点或者局部变量信息 info breakpoints, info locals</td>
</tr>

<tr>
<td class="org-left">run</td>
<td class="org-left">开始调试</td>
</tr>

<tr>
<td class="org-left">next</td>
<td class="org-left">类似 step over</td>
</tr>

<tr>
<td class="org-left">step</td>
<td class="org-left">跳转到函数内部</td>
</tr>

<tr>
<td class="org-left">continue</td>
<td class="org-left">继续运行到下一个断点</td>
</tr>

<tr>
<td class="org-left">quit</td>
<td class="org-left">退出调试</td>
</tr>

<tr>
<td class="org-left">watch</td>
<td class="org-left">内存断点</td>
</tr>

<tr>
<td class="org-left">display</td>
<td class="org-left">类似 IDE 里面的 watch 功能</td>
</tr>

<tr>
<td class="org-left">break 11 if xxx</td>
<td class="org-left">条件断点</td>
</tr>
</tbody>
</table>


<ul class="org-ul">
<li>list 显示源代码</li>
<li>break 11 在第11行打断点</li>
<li>break 12 在第12行打断点.
<ul class="org-ul">
<li>如果有函数名add，也可以给函数下断点 b add;</li>
<li>条件断点 b 20 if i == 2500 在第20行i等于时加断点</li>
</ul></li>
<li>info breakpoints 查看断点信息</li>
<li>run 调试，程序停在第一个断点位置</li>
<li>print myVec的值</li>
<li>next下一个</li>
<li>print myVec的值,发生变化</li>
<li>continue 运行到下一个断点</li>
</ul>

<pre class="example" id="org8f2668f">
(gdb) list
1	#include&lt;iostream&gt;
2	#include&lt;iterator&gt;
3	#include&lt;vector&gt;
4	
5	using namespace std;
6	
7	int main()
8	{
9	  vector&lt;int&gt; myVec;
10	  myVec.push_back(2);
(gdb) 
11	  myVec.push_back(3);
12	  cout &lt;&lt; "Hello World"&lt;&lt;endl;
13	  
14	  cout &lt;&lt;"vect size: "&lt;&lt;myVec.size() &lt;&lt;endl;
15	  return 0;
16	}
(gdb) break 11
Breakpoint 1 at 0x140001483: file test.cpp, line 11.
(gdb) break 12
Breakpoint 2 at 0x14000149a: file test.cpp, line 12.
(gdb) info breakpoints
Num     Type           Disp Enb Address            What
1       breakpoint     keep y   0x0000000140001483 in main() at test.cpp:11
2       breakpoint     keep y   0x000000014000149a in main() at test.cpp:12
(gdb) run
Starting program: d:\tmp\emacs\test.o 
[New Thread 7812.0x4d34]
[New Thread 7812.0x4864]
[New Thread 7812.0x3bdc]

Thread 1 hit Breakpoint 1, main () at test.cpp:11
11	  myVec.push_back(3);
(gdb) print myVec
$1 = std::vector of length 1, capacity 1 = {2}
(gdb) next

Thread 1 hit Breakpoint 2, main () at test.cpp:12
12	  cout &lt;&lt; "Hello World"&lt;&lt;endl;
(gdb) print myVec
$2 = std::vector of length 2, capacity 2 = {2, 3}
(gdb) continue
Continuing.
Hello World
vect size: 2
[Thread 7812.0x4d34 exited with code 0]
[Thread 7812.0x4864 exited with code 0]
[Thread 7812.0x3bdc exited with code 0]
[Inferior 1 (process 7812) exited normally]
(gdb) 
</pre>

<p>
使用 Treesit + eglot 来打造现代编程 IDE
</p>

<p>
Emacs29新特性介绍：<a href="https://emacs.liujiacai.net/post/031-emacs-29-feature-preview/">https://emacs.liujiacai.net/post/031-emacs-29-feature-preview/</a>
</p>
</div>
</div>
<div id="outline-container-h:c++-treesit-auto" class="outline-5">
<h5 id="h:c++-treesit-auto"><span class="section-number-5">4.12.1.2.</span> <code>init-programming.el</code> 语法高亮 <code>treesit-auto</code></h5>
<div class="outline-text-5" id="text-h:c++-treesit-auto">
<p>
在我的学习文章提到过(<a href="#h:0ef565c4-904d-4863-9c8b-7462407b2659">模块列表</a>)
</p>

<p>
<a href="https://github.com/renzmann/treesit-auto">https://github.com/renzmann/treesit-auto</a>
</p>

<p>
语法高亮, <code>*ts-mode</code> , 性能要比原生的好。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">treesit-auto</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#35821;&#27861;&#39640;&#20142;, *ts-mode , M-x treesit-auto-install-all</span>
(<span style="color: #a020f0;">use-package</span> treesit-auto
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:demand</span> t
  <span style="color: #483d8b;">:config</span>
  (<span style="color: #a020f0;">setq</span> treesit-auto-install 'prompt)
  (global-treesit-auto-mode))
</pre>
</div>

<p>
安装完之后运行 <code>M-x treesit-auto-install-all</code> , 它自动下载编译好的各种语言 <code>.dll</code> 文件, 文件安装在 <code>~/.emacs.d/tree-sitter</code>
</p>

<p>
重启emacs，打开一个c++程序，查看当前的主模式 <code>C-h v</code> major=mode 可以看到是 <code>c++-ts-mode</code> ，而不是原先的 <code>c++-mode</code>
</p>

<p>
默认情况下，treesit会对所有语言做映射 <code>*ts.mode</code>, 如果需要指定某些语言不映射，可这样写
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> treesit-auto
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:demand</span> t
  <span style="color: #483d8b;">:config</span>
  (<span style="color: #a020f0;">progn</span>
  (<span style="color: #a020f0;">setq</span> treesit-font-lock-level 4) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#20219;&#24847;&#33021;&#39640;&#20142;&#30340;&#37117;&#39640;&#20142;</span>
  (add-to-list 'major-mode-remap-alist '(c++-mode . c++-ts-mode)) <span style="color: #b22222;">;</span><span style="color: #b22222;">&#25351;&#23450;&#19981;&#26144;&#23556;</span>
  )
  <span style="color: #483d8b;">:config</span>
  (global-treesit-auto-mode)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c++-consult-imenu" class="outline-5">
<h5 id="h:c++-consult-imenu"><span class="section-number-5">4.12.1.3.</span> <code>init-programming.el</code> 跳转函数列表 consult-imenu</h5>
<div class="outline-text-5" id="text-h:c++-consult-imenu">
<p>
在学习章节提到过<a href="#orgad1f76c">(使用 Treesit + eglot 来打造现代编程 IDE)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(+general-global-menu! <span style="color: #8b2252;">"search"</span> <span style="color: #8b2252;">"s"</span>
  <span style="color: #8b2252;">"j"</span> 'consult-imenu
  <span style="color: #8b2252;">"p"</span> 'consult-ripgrep
  <span style="color: #8b2252;">"k"</span> 'consult-keep-lines
  <span style="color: #8b2252;">"f"</span> 'consult-focus-lines)
</pre>
</div>

<p>
上面配置在我的emacs模块配置<a href="#h:keybindings-general">（=init-keybindings.el= 键位绑定 =general=）</a>
</p>

<p>
修改了j对应自定义了my/imenu函数<a href="#h:j-consult">(<code>j-consult.el</code> 库)</a>
</p>

<p>
范例：跳转函数列表操作
</p>
<ul class="org-ul">
<li><code>SPC s j</code> 跳转函数列表</li>
</ul>
</div>
</div>
<div id="outline-container-h:2be86b5f-655e-4bd6-b2a8-c39eb68c690f" class="outline-5">
<h5 id="h:2be86b5f-655e-4bd6-b2a8-c39eb68c690f"><span class="section-number-5">4.12.1.4.</span> <code>init-programming.el</code> 查找定义和引用</h5>
<div class="outline-text-5" id="text-h:2be86b5f-655e-4bd6-b2a8-c39eb68c690f">
<p>
vim 模式是
</p>
<ul class="org-ul">
<li>gd 跳转函数定义</li>
<li>gr 查找函数引用</li>
<li>C-o 返回</li>
</ul>

<p>
使用 ctrl-o 返回
</p>

<pre class="example" id="org54e2eee">
(global-definer
  "gg" 'xref-find-definitions
  "gr" 'xref-find-references
</pre>
</div>
</div>
<div id="outline-container-h:0adb5e48-1781-4780-a991-0ac87c8ae529" class="outline-5">
<h5 id="h:0adb5e48-1781-4780-a991-0ac87c8ae529"><span class="section-number-5">4.12.1.5.</span> <code>init-programming.el</code> 添加 snippets 支持</h5>
<div class="outline-text-5" id="text-h:0adb5e48-1781-4780-a991-0ac87c8ae529">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> yasnippet
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:hook</span> ((prog-mode . yas-minor-mode)
         (org-mode . yas-minor-mode))
  <span style="color: #483d8b;">:init</span>
  <span style="color: #483d8b;">:config</span>
  (<span style="color: #a020f0;">progn</span>
    (<span style="color: #a020f0;">setq</span> hippie-expand-try-functions-list
          '(yas/hippie-try-expand
            try-complete-file-name-partially
            try-expand-all-abbrevs
            try-expand-dabbrev
            try-expand-dabbrev-all-buffers
            try-expand-dabbrev-from-kill
            try-complete-lisp-symbol-partially
            try-complete-lisp-symbol))))

(<span style="color: #a020f0;">use-package</span> yasnippet-snippets
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:after</span> yasnippet)
</pre>
</div>

<p>
自定义代码片段
</p>
<ul class="org-ul">
<li><p>
<code>M-x yas-new-snippet</code> 创建新代码片段
</p>
<pre class="example" id="org1bce726">
# -*- mode: snippet -*-
# name: &lt;name&gt;  指Snippet的名称
# key: &lt;key&gt;  指Snippet的名称
# contributor : Jasper Hsu &lt;xcwhome@163.com&gt;  作者信息
# --
`(message "hello from my yasnippet")`$0
Hello ${1:world)
</pre>

<p>
<code>$0</code> 光标位置， <code>$1..n</code> 使用tab, shift-tab切换占位符位置，可以设置默认值如 <code>${1:aa}</code>
</p>

<p>
<code>`()`</code> 可以写lisp语法
</p></li>
<li><code>C-c C-c=完成编程，选择片段生效的模式，保存指定位置 =~/.emacs.d/snippets/&lt;xxx&gt;-mode/&lt;name&gt;</code></li>
<li><code>M-x yas-describe-tables</code> 查看</li>
<li><code>M-x yas-visit-snippet-file</code> 编辑</li>
</ul>
</div>
</div>
<div id="outline-container-h:cc34dec7-c21d-47ef-8cc1-519de991bd8d" class="outline-5">
<h5 id="h:cc34dec7-c21d-47ef-8cc1-519de991bd8d"><span class="section-number-5">4.12.1.6.</span> <code>init-programming.el</code> 在头文件和源文件之间进行跳转</h5>
<div class="outline-text-5" id="text-h:cc34dec7-c21d-47ef-8cc1-519de991bd8d">
<p>
ff-find-related-file
</p>
</div>
</div>
</div>
<div id="outline-container-h:8c03c26f-8593-46d5-a278-ff1f2d20dbef" class="outline-4">
<h4 id="h:8c03c26f-8593-46d5-a278-ff1f2d20dbef"><span class="section-number-4">4.12.2.</span> <code>init-programming.el</code> python</h4>
<div class="outline-text-4" id="text-h:8c03c26f-8593-46d5-a278-ff1f2d20dbef">
<p>
python-mode
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> python
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:hook</span> (inferior-python-mode . (<span style="color: #a020f0;">lambda</span> ()
                                  (process-query-on-exit-flag
                                   (get-process <span style="color: #8b2252;">"Python"</span>))))
  <span style="color: #483d8b;">:init</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Disable readline based native completion</span>
  (<span style="color: #a020f0;">setq</span> python-shell-completion-native-enable nil)
  <span style="color: #483d8b;">:config</span>
  (global-leader
    <span style="color: #483d8b;">:major-modes</span>
    '(python-mode t)
    <span style="color: #b22222;">;;</span><span style="color: #b22222;">and the keymaps:</span>
    <span style="color: #483d8b;">:keymaps</span>
    '(python-mode-map)
    <span style="color: #8b2252;">"e"</span> 'live-py-set-version)
  (<span style="color: #a020f0;">setq</span> python-shell-interpreter <span style="color: #8b2252;">"python3"</span>)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">Live Coding in Python</span>
  (<span style="color: #a020f0;">use-package</span> live-py-mode <span style="color: #483d8b;">:ensure</span> t))
</pre>
</div>

<p>
rust-mode
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(global-leader
  <span style="color: #483d8b;">:major-modes</span>
  '(rust-mode t)
  <span style="color: #b22222;">;;</span><span style="color: #b22222;">and the keymaps:</span>
  <span style="color: #483d8b;">:keymaps</span>
  '(rust-mode-map)
  <span style="color: #8b2252;">"="</span> 'rust-format-buffer
  <span style="color: #8b2252;">"c"</span> 'rust-compile
  <span style="color: #8b2252;">"r"</span> 'rust-run
  <span style="color: #8b2252;">"t"</span> 'rust-test)
</pre>
</div>



<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span style="color: #8b2252;">"Load init-programming done..."</span>)
(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">init-programming</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:696bce89-99d1-4716-80c0-cf1b36844fa8" class="outline-3">
<h3 id="h:696bce89-99d1-4716-80c0-cf1b36844fa8"><span class="section-number-3">4.13.</span> <code>init-keybindings.el</code></h3>
<div class="outline-text-3" id="text-h:696bce89-99d1-4716-80c0-cf1b36844fa8">
</div>
<div id="outline-container-h:keybindings-search-file" class="outline-4">
<h4 id="h:keybindings-search-file"><span class="section-number-4">4.13.1.</span> <code>init-keybindings.el</code> 文件搜索</h4>
<div class="outline-text-4" id="text-h:keybindings-search-file">
<p>
配置划分成不同文件，好以后方式方便查找
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">config</span>
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#25991;&#20214;&#25628;&#32034;</span>
(global-set-key (kbd <span style="color: #8b2252;">"C-c p f"</span>) 'project-find-file) <span style="color: #b22222;">;;   </span><span style="color: #b22222;">&#26597;&#25214;&#25991;&#20214;&#65292;&#40664;&#35748;&#32465;&#23450;&#22312; C-x p f</span>
(global-set-key (kbd <span style="color: #8b2252;">"C-c p s"</span>) 'consult-ripgrep)  <span style="color: #b22222;">;;  </span><span style="color: #b22222;">&#26597;&#25214;&#25991;&#20214;&#20869;&#23481;</span>
</pre>
</div>

<p>
C-c 是给用户定义的快捷键，p 代表 project ， f 代表 find-file
</p>

<p>
consult-ripgrep 需要安装 consult 和 ripgrep ， 方便查找关键字
</p>

<p>
操作：快速找到文件
</p>
<ul class="org-ul">
<li><code>C-c p f</code> 选择目标目录, 回车 如 <code>~/.emacs.d</code></li>
<li>输入要查找文件名对应的关键字符，即可打开文件。 如打开 <code>~/.emacs.d/lisp/init-basic.el</code> 文件， 输入basic即可</li>
</ul>
</div>
</div>
<div id="outline-container-h:keybindings-general" class="outline-4">
<h4 id="h:keybindings-general"><span class="section-number-4">4.13.2.</span> <code>init-keybindings.el</code> 键位绑定 <code>general</code></h4>
<div class="outline-text-4" id="text-h:keybindings-general">
<p>
在我的学习文章提到过(<a href="#h:0ef565c4-904d-4863-9c8b-7462407b2659">模块列表</a>)
</p>

<p>
general插件中global-definer在init-basic.el中定义<a href="#h:basic-general">(<code>init-basic.el</code> general)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> general
  <span style="color: #483d8b;">:init</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">global-definer &#23545;&#24212;leader&#38190;&#20026;&#31354;&#26684; SPC</span>
  (global-definer
    <span style="color: #8b2252;">"!"</span> 'shell-command                <span style="color: #b22222;">; </span><span style="color: #b22222;">&#31354;&#26684;+! SPC ! &#36827;&#20837;shell&#21629;&#20196;&#34892;</span>
    <span style="color: #8b2252;">"SPC"</span> 'execute-extended-command   <span style="color: #b22222;">; </span><span style="color: #b22222;">&#25353;2&#19979;&#31354;&#26684;SPC-SPC&#23601;&#21487;&#20197;&#23454;&#29616; M-x &#30340;&#25928;&#26524;</span>
    <span style="color: #8b2252;">"TAB"</span> 'spacemacs/alternate-buffer <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC TAB &#22312;&#26368;&#36817;&#30340;2&#20010;buffer&#20043;&#38388;&#20999;&#25442;</span>
    <span style="color: #8b2252;">"'"</span> 'vertico-repeat
    <span style="color: #8b2252;">"+"</span> 'text-scale-increase   <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC + &#25918;&#22823;&#65292;&#30456;&#24403;&#20110;C-x C-+</span>
    <span style="color: #8b2252;">"-"</span> 'text-scale-decrease   <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC - &#32553;&#23567;</span>
    <span style="color: #8b2252;">"u"</span> 'universal-argument    <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC u &#30456;&#24403;&#20110;emacs&#30340;C-u </span>
    <span style="color: #8b2252;">"hdf"</span> 'describe-function   <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC hdf &#30456;&#24403;&#20110;emacs&#30340;C-h f</span>
    <span style="color: #8b2252;">"hdv"</span> 'describe-variable   <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC hdv &#30456;&#24403;&#20110;emacs&#30340;C-h v</span>
    <span style="color: #8b2252;">"hdk"</span> 'describe-key        <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC hdk &#30456;&#24403;&#20110;emacs&#30340;C-h k</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#26597;&#30475;&#33258;&#23450;&#20041;&#20989;&#25968;&#24211;j-highlight-global, j-expand-region</span>
    <span style="color: #8b2252;">"hh"</span> 'my/highlight-dwim    <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC hh &#39640;&#20142;&#36873;&#20013;&#21306;&#22495;&#24182;&#26631;&#19978;&#39068;&#33394;</span>
    <span style="color: #8b2252;">"hc"</span> 'my/clearn-highlight  <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC hc &#28165;&#38500;&#39640;&#20142;&#39068;&#33394;</span>
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20999;&#25442;&#31383;&#21475;</span>
    <span style="color: #8b2252;">"v"</span> 'er/expand-region      <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC v &#25193;&#22823;&#21306;&#22495;</span>
    <span style="color: #8b2252;">"0"</span> 'select-window-0       <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC 0 &#20999;0&#21495;&#31383;&#21475;</span>
    <span style="color: #8b2252;">"1"</span> 'select-window-1       <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC 1 &#20999;1&#21495;&#31383;&#21475;</span>
    <span style="color: #8b2252;">"2"</span> 'select-window-2
    <span style="color: #8b2252;">"3"</span> 'select-window-3
    <span style="color: #8b2252;">"4"</span> 'select-window-4
    <span style="color: #8b2252;">"5"</span> 'select-window-5
    <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20989;&#25968;&#23450;&#20041;&#12289;&#24341;&#29992;&#36339;&#36716;</span>
    <span style="color: #8b2252;">"gg"</span> 'xref-find-definitions
    <span style="color: #8b2252;">"gr"</span> 'xref-find-references
    )
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#23376;&#33756;&#21333;</span>
  <span style="color: #b22222;">;;</span><span style="color: #b22222;">(+general-global-menu! "&lt;name&gt;" "&lt;keyword&gt;" </span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">leader &#38190;&#20026;SPC&#31354;&#26684;&#65292;name&#20026;&#25551;&#36848;&#65292;&#23376;leader&#38190;&#20026;keyword. &#22914; SPC b b&#26597;&#30475;buffer&#32531;&#20914;&#21306;</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">SPC s &#38024;&#23545;&#20989;&#25968;&#21015;&#34920;&#36339;&#36716;&#30340;&#24555;&#25463;&#38190;</span>
  (+general-global-menu! <span style="color: #8b2252;">"search"</span> <span style="color: #8b2252;">"s"</span>
    <span style="color: #8b2252;">"j"</span> 'my/imenu              <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC s j &#20989;&#25968;&#21015;&#34920;&#36339;&#36716;(&#24120;&#29992;)</span>
    <span style="color: #8b2252;">"p"</span> 'consult-ripgrep       <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC s p &#26597;&#25214;&#25991;&#20214;&#20869;&#23481;(&#24120;&#29992;)</span>
    <span style="color: #8b2252;">"k"</span> 'consult-keep-lines    <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC s k &#26597;&#25214;&#30340;&#20869;&#23481;&#35206;&#30422;&#25972;&#20010;&#25991;&#20214;</span>
    <span style="color: #8b2252;">"f"</span> 'consult-focus-lines)  <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC s f &#22312;&#36873;&#20013;&#21306;&#22495;&#65292;&#38544;&#34255;&#21305;&#37197;&#23383;&#31526;&#30340;&#34892;. &#20877;&#27425;&#25191;&#34892;&#24674;&#22797;&#26174;&#31034;</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">SPC b &#38024;&#23545;buffer&#32531;&#20914;&#21306;&#30340;&#24555;&#25463;&#38190;</span>
  (+general-global-menu! <span style="color: #8b2252;">"buffer"</span> <span style="color: #8b2252;">"b"</span>
    <span style="color: #8b2252;">"d"</span> 'kill-current-buffer
    <span style="color: #8b2252;">"b"</span> '(consult-buffer <span style="color: #483d8b;">:which-key</span> <span style="color: #8b2252;">"consult buffer"</span>) <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC b b &#26597;&#30475;buffer&#32531;&#20914;&#21306;(&#24120;&#29992;)</span>
    <span style="color: #8b2252;">"B"</span> 'switch-to-buffer
    <span style="color: #8b2252;">"p"</span> 'previous-buffer
    <span style="color: #8b2252;">"R"</span> 'rename-buffer
    <span style="color: #8b2252;">"M"</span> '((<span style="color: #a020f0;">lambda</span> () (<span style="color: #a020f0;">interactive</span>) (switch-to-buffer <span style="color: #8b2252;">"*Messages*"</span>)) 
          <span style="color: #483d8b;">:which-key</span> <span style="color: #8b2252;">"messages-buffer"</span>) <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC b M&#26597;&#30475;*Message*&#32531;&#20914;&#21306;(&#24120;&#29992; &#37197;&#21512;SPC b b&#24555;&#36895;&#20999;&#25442;)</span>
    <span style="color: #8b2252;">"n"</span> 'next-buffer
    <span style="color: #8b2252;">"i"</span> 'ibuffer
    <span style="color: #8b2252;">"f"</span> 'my-open-current-directory <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC b f &#20174;&#22806;&#37096;&#25171;&#24320;&#24403;&#21069;buffer&#23545;&#24212;&#30340;&#30446;&#24405; </span>
    <span style="color: #8b2252;">"k"</span> 'kill-buffer
    <span style="color: #8b2252;">"y"</span> 'fast/copy-buffer-name
    <span style="color: #8b2252;">"K"</span> 'fast/kill-other-buffers)

  (+general-global-menu! <span style="color: #8b2252;">"layout"</span> <span style="color: #8b2252;">"l"</span>
    <span style="color: #8b2252;">"l"</span> 'tabspaces-switch-or-create-workspace           <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC l l &#20999;&#25442;&#24037;&#20316;&#31354;&#38388;(1)</span>
    <span style="color: #8b2252;">"L"</span> 'tabspaces-restore-session                      <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC l L &#24674;&#22797;&#24037;&#20316;&#31354;&#38388;(5)</span>
    <span style="color: #8b2252;">"p"</span> 'tabspaces-open-or-create-project-and-workspace <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC l p &#25171;&#24320;&#19968;&#20010;&#30446;&#24405;&#24182;&#21019;&#24314;workspace(3)</span>
    <span style="color: #8b2252;">"f"</span> 'tabspaces-project-switch-project-open-file
    <span style="color: #8b2252;">"s"</span> 'tabspaces-save-session                         <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC l s &#20445;&#23384;&#24037;&#20316;&#31354;&#38388;(4)</span>
    <span style="color: #8b2252;">"B"</span> 'tabspaces-switch-buffer-and-tab
    <span style="color: #8b2252;">"b"</span> 'tabspaces-switch-to-buffer
    <span style="color: #8b2252;">"R"</span> 'tab-rename                                     <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC l R &#37325;&#21629;&#21517;tab-bar</span>
    <span style="color: #8b2252;">"TAB"</span> 'tab-bar-switch-to-recent-tab                 <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC l TAB &#22312;&#20004;&#20010;&#25384;&#30528;&#26368;&#36817;&#30340;&#31354;&#38388;&#36827;&#34892;&#20999;&#25442;(2)</span>
    <span style="color: #8b2252;">"r"</span> 'tabspaces-remove-current-buffer
    <span style="color: #8b2252;">"k"</span> 'tabspaces-close-workspace)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">SPC f &#38024;&#23545;&#25991;&#20214;&#24555;&#25463;&#38190;</span>
  (+general-global-menu! <span style="color: #8b2252;">"file"</span> <span style="color: #8b2252;">"f"</span>
    <span style="color: #8b2252;">"f"</span> 'find-file               <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC f f &#26597;&#25214;&#25991;&#20214;</span>
    <span style="color: #8b2252;">"r"</span> 'consult-recent-file     <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC f r &#21015;&#20986;&#26368;&#36817;&#25171;&#24320;&#36807;&#30340;&#25991;&#20214;(&#24120;&#29992;)</span>
    <span style="color: #8b2252;">"L"</span> 'consult-locate          <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC f L &#25991;&#20214;&#26597;&#25214;</span>
    <span style="color: #8b2252;">"d"</span> 'consult-dir
    <span style="color: #8b2252;">"ed"</span> 'fast/open-my-init-file
    <span style="color: #8b2252;">"s"</span> 'save-buffer             <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC f s &#20445;&#23384;&#25991;&#20214;</span>
    <span style="color: #8b2252;">"w"</span> 'sudo-edit
    <span style="color: #8b2252;">"S"</span> 'save-some-buffers
    <span style="color: #8b2252;">"j"</span>  'dired-jump             <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC f j &#36339;&#21040;&#30446;&#24405;</span>
    <span style="color: #8b2252;">"y"</span> 'fast/copy-file-name
    <span style="color: #8b2252;">"R"</span> 'my/rename-current-buffer-file
    <span style="color: #8b2252;">"k"</span> 'my/delete-file-and-buffer
    <span style="color: #8b2252;">"!"</span> 'my/exec-shell-on-buffer)

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">SPC w &#38024;&#23545;&#31383;&#21475;&#30340;&#24555;&#25463;&#38190;</span>
  (+general-global-menu! <span style="color: #8b2252;">"window"</span> <span style="color: #8b2252;">"w"</span>
    <span style="color: #8b2252;">"/"</span> 'split-window-right    <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w / &#24038;&#21491;&#20998;&#23631;</span>
    <span style="color: #8b2252;">"-"</span> 'split-window-below    <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w - &#19978;&#19979;&#20998;&#23631;</span>
    <span style="color: #8b2252;">"m"</span> 'delete-other-windows  <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w m &#20165;&#20445;&#30041;&#24403;&#21069;&#31383;&#21475;</span>
    <span style="color: #8b2252;">"u"</span> 'winner-undo           <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w u &#36820;&#22238;&#24067;&#23616;</span>
    <span style="color: #8b2252;">"z"</span> 'winner-redo           <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w z &#25764;&#38144;&#36820;&#22238;&#24067;&#23616;&#12290; &#21644;&#36820;&#22238;&#24067;&#23616;&#32467;&#21512;&#23454;&#29616;2&#20010;&#24067;&#23616;&#38388;&#20999;&#25442;</span>
    <span style="color: #8b2252;">"w"</span> 'esw/select-window     <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w w &#36873;&#25321;&#20998;&#23631;&#26041;&#24335; &gt;&#21521;&#21491;&#20998;&#65292;&lt;&#21521;&#24038;&#20998;&#65292;^&#21521;&#19978;&#20998;&#65292;v&#21521;&#19979;&#20998;</span>
    <span style="color: #8b2252;">"s"</span> 'esw/swap-two-windows  <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w s &#20132;&#25442;&#31383;&#21475; </span>
    <span style="color: #8b2252;">"d"</span> 'esw/delete-window     <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w d &#21024;&#38500;&#25351;&#23450;&#31383;&#21475;</span>
    <span style="color: #8b2252;">"="</span> 'balance-windows-area  <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w = &#31561;&#23485;&#24067;&#23616;</span>
    <span style="color: #8b2252;">"r"</span> 'esw/move-window
    <span style="color: #8b2252;">"x"</span> 'resize-window         <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w x &#35843;&#25972;&#31383;&#21475;&#22823;&#23567;&#12290;&#22914;f&#27700;&#24179;&#21464;&#22823;&#65307;b&#32553;&#23567;&#65307;n&#21521;&#19979;&#25193;&#65307;p&#21521;&#19978;&#25193;&#65307;</span>
    <span style="color: #8b2252;">"H"</span> 'buf-move-left         <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w H &#21491;&#36793;&#31383;&#21475;&#24038;&#31227;</span>
    <span style="color: #8b2252;">"L"</span> 'buf-move-right        <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w L &#31383;&#21475;&#21491;&#31227;</span>
    <span style="color: #8b2252;">"J"</span> 'buf-move-down         <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w J &#31383;&#21475;&#19979;&#31227;</span>
    <span style="color: #8b2252;">"K"</span> 'buf-move-up)          <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC w K &#31383;&#21475;&#19978;&#31227;</span>

  <span style="color: #b22222;">;; </span><span style="color: #b22222;">SPC p &#38024;&#23545;&#39033;&#30446;&#30340;&#24555;&#25463;&#38190;</span>
  (+general-global-menu! <span style="color: #8b2252;">"project"</span> <span style="color: #8b2252;">"p"</span>
    <span style="color: #8b2252;">"f"</span> 'project-find-file    <span style="color: #b22222;">; </span><span style="color: #b22222;">SPC p f &#22312;&#39033;&#30446;&#20013;&#24555;&#36895;&#25214;&#21040;&#25991;&#20214;(&#24120;&#29992;)</span>
    <span style="color: #8b2252;">"r"</span> 'consult-recent-file
    <span style="color: #8b2252;">"s"</span> 'project-find-regexp
    <span style="color: #8b2252;">"d"</span> 'project-dired
    <span style="color: #8b2252;">"b"</span> 'consult-project-buffer
    <span style="color: #8b2252;">"e"</span> 'project-eshell
    <span style="color: #8b2252;">"m"</span> 'my/project-run-makefile-target
    <span style="color: #8b2252;">"c"</span> 'project-compile
    <span style="color: #8b2252;">"t"</span> 'my/project-citre
    <span style="color: #8b2252;">"p"</span> 'project-switch-project
    <span style="color: #8b2252;">"i"</span> 'my/project-info
    <span style="color: #8b2252;">"a"</span> 'project-remember-projects-under
    <span style="color: #8b2252;">"x"</span> 'project-forget-project)
  )
</pre>
</div>

<p>
参考配置： <a href="https://github.com/zilongshanren/emacs.d/blob/eglot/lisp/init-keybindings.el">https://github.com/zilongshanren/emacs.d/blob/eglot/lisp/init-keybindings.el</a> 实现自己的文件、窗口、项目多种快捷键绑定
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span style="color: #8b2252;">"Load init-keybindings done..."</span>)
(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">init-keybindings</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:05e889c3-381b-4d1a-8647-9df6277d8301" class="outline-3">
<h3 id="h:05e889c3-381b-4d1a-8647-9df6277d8301"><span class="section-number-3">4.14.</span> <code>init-funcs.el</code></h3>
<div class="outline-text-3" id="text-h:05e889c3-381b-4d1a-8647-9df6277d8301">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;</span><span style="color: #b22222;">(defun open-init-file()</span>
<span style="color: #b22222;">;;  </span><span style="color: #b22222;">(interactive)</span>
<span style="color: #b22222;">;;  </span><span style="color: #b22222;">(find-file "~/.emacs.d/init.el"))</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;;;; </span><span style="color: #b22222;">&#36825;&#19968;&#34892;&#20195;&#30721;&#65292;&#23558;&#20989;&#25968; open-init-file &#32465;&#23450;&#21040; &lt;f4&gt; &#38190;&#19978;</span>
<span style="color: #b22222;">;;</span><span style="color: #b22222;">(global-set-key (kbd "&lt;f4&gt;") 'open-init-file)</span>


<span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#24555;&#25463;&#20351;&#29992;emacs</span>
(<span style="color: #a020f0;">use-package</span> j-emacs-fast
  <span style="color: #483d8b;">:ensure</span> nil
  <span style="color: #483d8b;">:demand</span> t
  <span style="color: #483d8b;">:diminish</span>
  <span style="color: #483d8b;">:bind</span> 
  ( <span style="color: #483d8b;">:map</span> global-map
    (<span style="color: #8b2252;">"&lt;f4&gt;"</span> . fast/open-my-init-file) <span style="color: #b22222;">; </span><span style="color: #b22222;">&#24555;&#36895;&#25171;&#24320;&#37197;&#32622;&#25991;&#20214;</span>
    ))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span style="color: #8b2252;">"Load init-funcs done..."</span>)
(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">init-funcs</span>)
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:19b981f0-0e13-46d5-b573-9d8e52aefd33" class="outline-2">
<h2 id="h:19b981f0-0e13-46d5-b573-9d8e52aefd33"><span class="section-number-2">5.</span> 我的自定义库(<code>j-lisp/</code>)</h2>
<div class="outline-text-2" id="text-h:19b981f0-0e13-46d5-b573-9d8e52aefd33">
<p>
一个自定义库会对某一个软件包做扩展，软件包配置文件会分别引用它们。
</p>
</div>
<div id="outline-container-h:1ff292d7-21a0-4f9b-a00d-52a6be5ef3f6" class="outline-3">
<h3 id="h:1ff292d7-21a0-4f9b-a00d-52a6be5ef3f6"><span class="section-number-3">5.1.</span> <code>j-simple.el</code> 库</h3>
<div class="outline-text-3" id="text-h:1ff292d7-21a0-4f9b-a00d-52a6be5ef3f6">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-simple.el --- Extensions for Consult -*- lexical-binding: t -*-</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Copyright (C) 2024  Jasper Hsu</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Author: Jasper Hsu <a href="mailto:xcwhome%40163.com">&lt;xcwhome@163.com&gt;</a></span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">URL: https://xuchangwei.com/lisp/jasper-emacs.html</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Version: 0.1.0</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Package-Requires: ((emacs "30.1"))</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This file is NOT part of GNU Emacs.</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is free software; you can redistribute it and/or modify</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">it under the terms of the GNU General Public License as published by</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">the Free Software Foundation, either version 3 of the License, or (at</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">your option) any later version.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is distributed in the hope that it will be useful,</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">GNU General Public License for more details.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">You should have received a copy of the GNU General Public License</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">along with this program.  If not, see <a href="https://www.gnu.org/licenses/">&lt;https://www.gnu.org/licenses/&gt;</a>.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Commentary:</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Remember that every piece of Elisp that I write is for my own</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">educational and recreational purposes.  I do not recommend that</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">you copy any of this if you are not certain of what it does.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Code:</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Commands</span>

<span style="color: #b22222;">;;;; </span><span style="color: #b22222;">General commands</span>

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">j-simple--mark</span> (bounds)
  <span style="color: #8b2252;">"Mark between BOUNDS as a cons cell of beginning and end positions."</span>
  (push-mark (car bounds))
  (goto-char (cdr bounds))
  (activate-mark))

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">autoload&#36825;&#26159;&#19968;&#20010;&#25991;&#26723;&#23383;&#31526;&#20018;&#30340;&#21069;&#32512;&#65292;&#34920;&#31034;&#36825;&#20010;&#20989;&#25968;&#21487;&#20197;&#36890;&#36807; Emacs &#30340;&#33258;&#21160;&#21152;&#36733;&#26426;&#21046;&#34987;&#21152;&#36733;&#12290;&#24403;&#29992;&#25143;&#22312; Emacs &#21629;&#20196;&#34892;&#20013;&#36755;&#20837;&#20989;&#25968;&#21517;&#26102;&#65292;Emacs &#20250;&#23581;&#35797;&#33258;&#21160;&#21152;&#36733;&#36825;&#20010;&#20989;&#25968;&#30340;&#23450;&#20041;&#12290;</span>
<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">j-simple-mark-sexp</span> ()
  <span style="color: #8b2252;">"Mark symbolic expression at or near point.</span>
<span style="color: #8b2252;">Repeat to extend the region forward to the next symbolic</span>
<span style="color: #8b2252;">expression. &#36873;&#20013;&#21306;&#22495;"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (region-active-p)
           (eq last-command this-command))
      (<span style="color: #a020f0;">ignore-errors</span> (forward-sexp 1))
    (<span style="color: #a020f0;">when-let</span> ((thing (<span style="color: #a020f0;">cond</span>
                       ((thing-at-point 'url) 'url)
                       ((thing-at-point 'sexp) 'sexp)
                       ((thing-at-point 'string) 'string)
                       ((thing-at-point 'word) 'word))))
      (j-simple--mark (bounds-of-thing-at-point thing)))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">j-simple-keyboard-quit-dwim</span> ()
  <span style="color: #8b2252;">"Do-What-I-Mean behaviour for a general `</span><span style="color: #008b8b;">keyboard-quit</span><span style="color: #8b2252;">'.</span>

<span style="color: #8b2252;">The generic `</span><span style="color: #008b8b;">keyboard-quit</span><span style="color: #8b2252;">' does not do the expected thing when</span>
<span style="color: #8b2252;">the minibuffer is open.  Whereas we want it to close the</span>
<span style="color: #8b2252;">minibuffer, even without explicitly focusing it.</span>

<span style="color: #8b2252;">The DWIM behaviour of this command is as follows:</span>

<span style="color: #8b2252;">- When the region is active, disable it.</span>
<span style="color: #8b2252;">- When a minibuffer is open, but not focused, close the minibuffer.</span>
<span style="color: #8b2252;">- When the Completions buffer is selected, close it.</span>
<span style="color: #8b2252;">- In every other case use the regular `</span><span style="color: #008b8b;">keyboard-quit</span><span style="color: #8b2252;">'."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">cond</span>
   ((region-active-p)
    (keyboard-quit))
   ((derived-mode-p 'completion-list-mode)
    (delete-completion-window))
   ((&gt; (minibuffer-depth) 0)
    (abort-recursive-edit))
   (t
    (keyboard-quit))))

(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">j-simple</span>)
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-simple.el ends here</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:j-consult" class="outline-3">
<h3 id="h:j-consult"><span class="section-number-3">5.2.</span> <code>j-consult.el</code> 库</h3>
<div class="outline-text-3" id="text-h:j-consult">
<ul class="org-ul">
<li>我的emacs模块配置<a href="#h:completion-consult">(<code>init-completion.el</code> 增强文件内搜索 <code>consult</code>)</a></li>
<li>跳转函数列表 consult-imenup<a href="#h:c++-consult-imenu">(<code>init-programming.el</code> 跳转函数列表 consult-imenu)</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-consult.el --- Extensions for Consult -*- lexical-binding: t -*-</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Copyright (C) 2024  Jasper Hsu</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Author: Jasper Hsu <a href="mailto:xcwhome%40163.com">&lt;xcwhome@163.com&gt;</a></span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">URL: https://xuchangwei.com/lisp/jasper-emacs.html</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Version: 0.1.0</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Package-Requires: ((emacs "30.1"))</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This file is NOT part of GNU Emacs.</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is free software; you can redistribute it and/or modify</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">it under the terms of the GNU General Public License as published by</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">the Free Software Foundation, either version 3 of the License, or (at</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">your option) any later version.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is distributed in the hope that it will be useful,</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">GNU General Public License for more details.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">You should have received a copy of the GNU General Public License</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">along with this program.  If not, see <a href="https://www.gnu.org/licenses/">&lt;https://www.gnu.org/licenses/&gt;</a>.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Commentary:</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Remember that every piece of Elisp that I write is for my own</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">educational and recreational purposes.  I do not recommend that</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">you copy any of this if you are not certain of what it does.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Code:</span>

<span style="color: #b22222;">;;;; </span><span style="color: #b22222;">&#37197;&#32622;&#25628;&#32034;&#20013;&#25991;&#25991;&#20214;</span>

(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">consult</span>)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">PC&#25552;&#21069;&#23433;&#35013; everyting &#21450;&#20854;&#23458;&#25143;&#31471;ES. &#21033;&#29992;M-x consult-locate&#25628;&#32034;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#22914; #&#23398;&#20064;#.txt</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(progn</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(setq consult-locate-args (encode-coding-string "es.exe -i -p -r" 'gbk))</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">(add-to-list 'process-coding-system-alist '("es" gbk . gbk))</span>
<span style="color: #b22222;">;;   </span><span style="color: #b22222;">)</span>
  (<span style="color: #a020f0;">if</span> (eq system-type 'windows-nt)
      (<span style="color: #a020f0;">progn</span>
        (add-to-list 'process-coding-system-alist '(<span style="color: #8b2252;">"es"</span> gbk . gbk))
        (add-to-list 'process-coding-system-alist '(<span style="color: #8b2252;">"explorer"</span> gbk . gbk))
        (<span style="color: #a020f0;">setq</span> consult-locate-args (encode-coding-string <span style="color: #8b2252;">"es.exe -i -p -r"</span> 'gbk))))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">make consult-ripgrep work &#26377;&#26102;consult-ripgrep&#25628;&#32034;&#19981;&#20102;</span>
(<span style="color: #a020f0;">cond</span>
 <span style="color: #b22222;">;; </span><span style="color: #b22222;">macOS</span>
 ((eq system-type 'darwin)
  <span style="color: #8b2252;">"afplay"</span>)
 <span style="color: #b22222;">;; </span><span style="color: #b22222;">Windows</span>
 ((eq system-type 'windows-nt)
  (add-to-list 'process-coding-system-alist 
               '(<span style="color: #8b2252;">"[rR][gG]"</span> . (utf-8-dos . windows-1251-dos)))
  )
 (t
  <span style="color: #8b2252;">"Nothing"</span>))

<span style="color: #b22222;">;;;; </span><span style="color: #b22222;">&#20989;&#25968;&#23450;&#20041;&#36339;&#36716;</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my/imenu</span> ()
  <span style="color: #8b2252;">"&#36339;&#36716;&#20989;&#25968;&#21015;&#34920;&#65292;&#24403;&#27169;&#24335;&#20026;org-mode&#36339;&#36716;&#26631;&#39064;&#21015;&#34920;"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (eq major-mode #'org-mode)
      (call-interactively #'consult-org-heading)
    (call-interactively #'consult-imenu)))

(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">j-consult</span>)
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-consult.el ends here</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:j-embark" class="outline-3">
<h3 id="h:j-embark"><span class="section-number-3">5.3.</span> <code>j-embark.el</code> 库</h3>
<div class="outline-text-3" id="text-h:j-embark">
<p>
我的emacs模块配置<a href="#h:completion-embark">(<code>init-completion.el</code> minibuffer增强 <code>embark</code>)</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-embark.el --- Extensions for Embark -*- lexical-binding: t -*-</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Copyright (C) 2024  Jasper Hsu</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Author: Jasper Hsu <a href="mailto:xcwhome%40163.com">&lt;xcwhome@163.com&gt;</a></span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">URL: https://xuchangwei.com/lisp/jasper-emacs.html</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Version: 0.1.0</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Package-Requires: ((emacs "30.1"))</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This file is NOT part of GNU Emacs.</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is free software; you can redistribute it and/or modify</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">it under the terms of the GNU General Public License as published by</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">the Free Software Foundation, either version 3 of the License, or (at</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">your option) any later version.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is distributed in the hope that it will be useful,</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">GNU General Public License for more details.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">You should have received a copy of the GNU General Public License</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">along with this program.  If not, see <a href="https://www.gnu.org/licenses/">&lt;https://www.gnu.org/licenses/&gt;</a>.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Commentary:</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Remember that every piece of Elisp that I write is for my own</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">educational and recreational purposes.  I do not recommend that</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">you copy any of this if you are not certain of what it does.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Code:</span>

(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">embark</span>)


<span style="color: #b22222;">;;;; </span><span style="color: #b22222;">&#25209;&#37327;&#25913;&#20889;; &#37197;&#21512;query-replace-regexp&#23454;&#29616;&#25991;&#26412;&#26367;&#25442;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#33539;&#20363;&#65306;&#25209;&#37327;&#26367;&#25442;&#25805;&#20316;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">- ~M-x consult-ripgrep~  &#40664;&#35748;&#20250;&#22312;&#20197; git &#20026;&#26681;&#30446;&#24405;&#25628;&#32034;&#12290;&#22914; =#hello= &#65292;&#25628;&#32034;&#21253;&#21547;hello&#23383;&#31526;&#30340;&#25991;&#20214;&#12290; ~C-n/C-p~ &#19979;&#19978;&#25628;&#32034;&#21516;&#26102;&#21487;&#20197;&#39044;&#35272;&#12290;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">- ~C-c C-e~ &#25171;&#24320;&#20889;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">- ~M-x query-replace-regexp~ &#36755;&#20837;hello &#22238;&#36710;&#65292; &#26367;&#25442;&#20026;hello &#22238;&#36710;&#12290; &#25353; y &#21516;&#24847;&#24403;&#21069;&#34892;&#26367;&#25442;&#65292;n &#19981;&#21516;&#24847;&#20462;&#25913;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">- ~C-c C-c~ &#25191;&#34892;&#26367;&#25442;&#65292;&#25353; q &#36864;&#20986;</span>
<span style="color: #b22222;">;; </span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#33539;&#20363;&#65306;&#24403;&#21069;buffer&#26367;&#25442;&#25805;&#20316;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">- =C-s= &#25628;&#32034;&#65292; &#36755;&#20837;hello</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">- =C-c C-e= &#32534;&#36753;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">- ~M-x query-replace-regexp~ &#36755;&#20837;&#35201;&#26367;&#25442;&#30340;&#20869;&#23481;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">- ~C-c C-c~ &#25191;&#34892;&#26367;&#25442;&#65292;&#25353; q &#36864;&#20986;</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my/embark-export-write</span>()
 <span style="color: #8b2252;">"Export the current vertico results to a writable buffer if</span>
<span style="color: #8b2252;">possible.Supports exporting</span>
<span style="color: #8b2252;">consult-grep to wgrep, file to</span>
<span style="color: #8b2252;">wdeired, and consult-location to occur-edit."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">embark</span>)
  (<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">wgrep</span>)
  (<span style="color: #a020f0;">pcase-let</span> ((`(,type . ,candidates)
               (run-hook-with-args-until-success 'embark-candidate-collectors)))
    (<span style="color: #a020f0;">pcase</span> type
      ('consult-grep (<span style="color: #a020f0;">let</span> ((embark-after-export-hook #'wgrep-change-to-wgrep-mode))
                       (embark-export)))
      ('file (<span style="color: #a020f0;">let</span> ((embark-after-export-hook #'wdired-change-to-wdired-mode))
               (embark-export)))
      ('consult-location (<span style="color: #a020f0;">let</span> ((embark-after-export-hook #'occur-edit-mode))
                           (embark-export)))
      (x (<span style="color: #ff0000; font-weight: bold;">user-error</span> <span style="color: #8b2252;">"embark category %S doesn't support writable export"</span> x)))))



<span style="color: #b22222;">;;;; </span><span style="color: #b22222;">&#20351;&#29992; Emacs &#25171;&#24320;windows&#25991;&#20214;&#31649;&#29702;&#22120;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#20989;&#25968;&#22312;embark-file-map &#26144;&#23556;&#20026;E</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">(define-key embark-file-map (kbd "E") #'consult-directory-externally)</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#33539;&#20363;: &#24555;&#36895;&#25171;&#24320;&#25991;&#20214;&#25152;&#22312;&#30446;&#24405;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">- =M-x my/consult-directory-externally= &#36755;&#20837;&#25991;&#20214;&#36335;&#24452;&#65292;&#22914; =~/.emacs.d/auto-save-list/.saves-2000-JASPER~=</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">- =C-x C-f= &#36873;&#25321;&#25991;&#20214;&#26102;&#65292;&#21487;&#20197;&#29992;embark&#26469;&#25171;&#24320;&#65292; =C;= &#36873;&#25321;E&#65292;&#29992;&#25991;&#20214;&#31649;&#29702;&#22120;&#25171;&#24320;&#23545;&#24212;&#30446;&#24405;&#30340;</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my/consult-directory-externally</span> (file)
  <span style="color: #8b2252;">"Open FILE externally using the default application of the system."</span>
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"fOpen externally: "</span>)
  (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> (eq system-type 'windows-nt)
           (fboundp 'w32-shell-execute))
      (shell-command-to-string (encode-coding-string (replace-regexp-in-string <span style="color: #8b2252;">"/"</span> <span style="color: #8b2252;">"\\\\\\\\"</span>
      <span style="color: #b22222;">;;</span><span style="color: #b22222;">(shell-command-to-string (encode-coding-string (replace-regexp-in-string "/" "\\\\"</span>
            (format <span style="color: #8b2252;">"explorer.exe %s"</span> (file-name-directory (expand-file-name file)))) <span style="color: #ff0000; font-weight: bold;">'gbk))</span>
    (call-process (<span style="color: #a020f0;">pcase</span> system-type
                    ('darwin <span style="color: #8b2252;">"open"</span>)
                    ('cygwin <span style="color: #8b2252;">"cygstart"</span>)
                    (_ <span style="color: #8b2252;">"xdg-open"</span>))
                  nil 0 nil
                  (file-name-directory (expand-file-name file)))))

<span style="color: #b22222;">;;</span><span style="color: #b22222;">&#25171;&#24320;&#24403;&#21069;&#25991;&#20214;&#30340;&#30446;&#24405;</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my/open-current-directory</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (consult-directory-externally default-directory))

(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">j-embark</span>)
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-embark.el ends here</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:j-expand-region" class="outline-3">
<h3 id="h:j-expand-region"><span class="section-number-3">5.4.</span> <code>j-expand-region.el</code> 库</h3>
<div class="outline-text-3" id="text-h:j-expand-region">
<ul class="org-ul">
<li>expand-region<a href="#h:tools-expand-region">(<code>init-tools.el</code> expand-region)</a> <a href="#h:j-expand-region">(<code>j-expand-region.el</code> 库)</a></li>
</ul>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-expand-region.el --- Extensions for expand-region -*- lexical-binding: t -*-</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Copyright (C) 2024  Jasper Hsu</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Author: Jasper Hsu <a href="mailto:xcwhome%40163.com">&lt;xcwhome@163.com&gt;</a></span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">URL: https://xuchangwei.com/lisp/jasper-emacs.html</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Version: 0.1.0</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Package-Requires: ((emacs "30.1"))</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This file is NOT part of GNU Emacs.</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is free software; you can redistribute it and/or modify</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">it under the terms of the GNU General Public License as published by</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">the Free Software Foundation, either version 3 of the License, or (at</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">your option) any later version.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is distributed in the hope that it will be useful,</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">GNU General Public License for more details.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">You should have received a copy of the GNU General Public License</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">along with this program.  If not, see <a href="https://www.gnu.org/licenses/">&lt;https://www.gnu.org/licenses/&gt;</a>.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Commentary:</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Remember that every piece of Elisp that I write is for my own</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">educational and recreational purposes.  I do not recommend that</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">you copy any of this if you are not certain of what it does.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Code:</span>

(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">expand-region</span>)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my/search-project-for-symbol-at-point</span> ()
  <span style="color: #8b2252;">"&#26597;&#25214;&#24403;&#21069;&#39033;&#30446;(git&#39033;&#30446;)&#30446;&#24405;&#20013;&#21305;&#37197;&#36873;&#20013;&#23383;&#31526;&#20018;&#30340;&#25991;&#20214;"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (use-region-p)
      (<span style="color: #a020f0;">progn</span>
        (consult-ripgrep (project-root (project-current))
                         (buffer-substring (region-beginning) (region-end))))))

(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">j-expand-region</span>)
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-expand-region.el ends here</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:j-evil" class="outline-3">
<h3 id="h:j-evil"><span class="section-number-3">5.5.</span> <code>j-evil.el</code> 库</h3>
<div class="outline-text-3" id="text-h:j-evil">
<ul class="org-ul">
<li>evil<a href="#h:evil">(<code>init-evil.el</code>)</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-evil.el --- Extensions for evil -*- lexical-binding: t -*-</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Copyright (C) 2024  Jasper Hsu</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Author: Jasper Hsu <a href="mailto:xcwhome%40163.com">&lt;xcwhome@163.com&gt;</a></span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">URL: https://xuchangwei.com/lisp/jasper-emacs.html</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Version: 0.1.0</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Package-Requires: ((emacs "30.1"))</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This file is NOT part of GNU Emacs.</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is free software; you can redistribute it and/or modify</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">it under the terms of the GNU General Public License as published by</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">the Free Software Foundation, either version 3 of the License, or (at</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">your option) any later version.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is distributed in the hope that it will be useful,</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">GNU General Public License for more details.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">You should have received a copy of the GNU General Public License</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">along with this program.  If not, see <a href="https://www.gnu.org/licenses/">&lt;https://www.gnu.org/licenses/&gt;</a>.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Commentary:</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Remember that every piece of Elisp that I write is for my own</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">educational and recreational purposes.  I do not recommend that</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">you copy any of this if you are not certain of what it does.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Code:</span>

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my/evil-quick-replace</span> (beg end )
  <span style="color: #8b2252;">"&#20132;&#20114;&#24335;&#26367;&#25442;&#25991;&#26412;"</span>
  (<span style="color: #a020f0;">interactive</span> <span style="color: #8b2252;">"r"</span>)
  (<span style="color: #a020f0;">when</span> (evil-visual-state-p)
    (evil-exit-visual-state)
    (<span style="color: #a020f0;">let</span> ((selection (regexp-quote (buffer-substring-no-properties beg end))))
      (<span style="color: #a020f0;">setq</span> command-string (format <span style="color: #8b2252;">"%%s /%s//g"</span> selection))
      (<span style="color: #a020f0;">minibuffer-with-setup-hook</span>
          (<span style="color: #a020f0;">lambda</span> () (backward-char 2))
        (evil-ex command-string)))))

<span style="color: #b22222;">;;</span><span style="color: #b22222;">(define-key evil-visual-state-map (kbd "C-r") 'my/evil-quick-replace)</span>

(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">j-evil</span>)
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-evil.el ends here</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:j-highlight-global" class="outline-3">
<h3 id="h:j-highlight-global"><span class="section-number-3">5.6.</span> <code>j-highlight-global.el</code> 库</h3>
<div class="outline-text-3" id="text-h:j-highlight-global">
<p>
在我的学习文章提到过(<a href="#h:0ef565c4-904d-4863-9c8b-7462407b2659">模块列表</a>)
</p>

<ul class="org-ul">
<li>symbol-overlay &amp; highlight-global<a href="#h:j-highlight-global">(<code>j-highlight-global.el</code> 库)</a> <a href="#h:tools-highlight-global">(<code>init-tools.el</code> 文本高亮 <code>symbol-overlay</code> &amp; <code>highlight-global</code>)</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-highlight-global.el --- Extensions for highlight-global -*- lexical-binding: t -*-</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Copyright (C) 2024  Jasper Hsu</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Author: Jasper Hsu <a href="mailto:xcwhome%40163.com">&lt;xcwhome@163.com&gt;</a></span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">URL: https://xuchangwei.com/lisp/jasper-emacs.html</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Version: 0.1.0</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Package-Requires: ((emacs "30.1"))</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This file is NOT part of GNU Emacs.</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is free software; you can redistribute it and/or modify</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">it under the terms of the GNU General Public License as published by</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">the Free Software Foundation, either version 3 of the License, or (at</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">your option) any later version.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is distributed in the hope that it will be useful,</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">GNU General Public License for more details.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">You should have received a copy of the GNU General Public License</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">along with this program.  If not, see <a href="https://www.gnu.org/licenses/">&lt;https://www.gnu.org/licenses/&gt;</a>.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Commentary:</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Remember that every piece of Elisp that I write is for my own</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">educational and recreational purposes.  I do not recommend that</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">you copy any of this if you are not certain of what it does.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Code:</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#36873;&#20013;&#25991;&#26412;&#39640;&#20142;&#65292;general&#25554;&#20214;&#20013;&#20570;&#20102;&#38190;&#20301;&#32465;&#23450;</span>

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my/highlight-dwim</span> ()
  <span style="color: #8b2252;">"do what i mean &#22914;&#26524;&#36873;&#20013;&#21306;&#22495;&#35843;&#29992;highlight-frame-toggle&#39640;&#20142;,</span>
<span style="color: #8b2252;">&#27809;&#26377;&#21017;&#35843;&#29992;symbol-overlay&#39640;&#20142;"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if</span> (use-region-p)
      (<span style="color: #a020f0;">progn</span>
        (highlight-frame-toggle)
        (deactivate-mark))
    (symbol-overlay-put)))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my/clearn-highlight</span> ()
  (<span style="color: #a020f0;">interactive</span>)
  (clear-highlight-frame)
  (symbol-overlay-remove-all))

(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">j-highlight-global</span>)
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-highlight-global.el ends here</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:j-org-download" class="outline-3">
<h3 id="h:j-org-download"><span class="section-number-3">5.7.</span> <code>j-org-download.el</code> 库</h3>
<div class="outline-text-3" id="text-h:j-org-download">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-org-download.el --- Extensions for org -*- lexical-binding: t -*-</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Copyright (C) 2024  Jasper Hsu</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Author: Jasper Hsu <a href="mailto:xcwhome%40163.com">&lt;xcwhome@163.com&gt;</a></span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">URL: https://xuchangwei.com/lisp/jasper-emacs.html</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Version: 0.1.0</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Package-Requires: ((emacs "30.1"))</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This file is NOT part of GNU Emacs.</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is free software; you can redistribute it and/or modify</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">it under the terms of the GNU General Public License as published by</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">the Free Software Foundation, either version 3 of the License, or (at</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">your option) any later version.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is distributed in the hope that it will be useful,</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">GNU General Public License for more details.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">You should have received a copy of the GNU General Public License</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">along with this program.  If not, see <a href="https://www.gnu.org/licenses/">&lt;https://www.gnu.org/licenses/&gt;</a>.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Commentary:</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Remember that every piece of Elisp that I write is for my own</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">educational and recreational purposes.  I do not recommend that</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">you copy any of this if you are not certain of what it does.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Code:</span>

<span style="color: #b22222;">;;;; </span><span style="color: #b22222;">&#25130;&#22270;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">&#23558;&#21098;&#20999;&#26495;&#20013;&#20869;&#23481;&#31896;&#36148;&#21040;org&#25991;&#20214;&#20013;</span>

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">my/org-insert-clipboard-image</span> (width)
  <span style="color: #8b2252;">"&#20445;&#23384;&#30446;&#24405; `</span><span style="color: #008b8b;">foldername</span><span style="color: #8b2252;">'</span>
<span style="color: #8b2252;">&#22270;&#29255;&#21517;&#31216; `</span><span style="color: #008b8b;">imgName</span><span style="color: #8b2252;">'</span>
<span style="color: #8b2252;">&#22270;&#29255;&#26174;&#31034;&#19982;&#20851;&#38381; `</span><span style="color: #008b8b;">org-redisplay-inline-images</span><span style="color: #8b2252;">'</span>
<span style="color: #8b2252;">&#22270;&#29255;&#30340;&#36136;&#37327;&#36319;&#26159;&#21542;&#37319;&#29992;&#21387;&#32553;&#26377;&#20851;"</span>
  (<span style="color: #a020f0;">interactive</span> (list
                (read-string (format <span style="color: #8b2252;">"Input image width, default is 800: "</span>)
                             nil nil <span style="color: #8b2252;">"800"</span>)))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#35774;&#32622;&#22270;&#29255;&#23384;&#25918;&#30340;&#25991;&#20214;&#22841;&#20301;&#32622;&#20026; `</span><span style="color: #008b8b;">&#24403;&#21069;Org&#25991;&#20214;&#21516;&#21517;.assets</span><span style="color: #b22222;">'</span>
  (<span style="color: #a020f0;">setq</span> foldername <span style="color: #8b2252;">"./images/"</span>)
  (<span style="color: #a020f0;">if</span> (not (file-exists-p foldername))
      (mkdir foldername))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#35774;&#32622;&#22270;&#29255;&#30340;&#25991;&#20214;&#21517;&#65292;&#26684;&#24335;&#20026; `</span><span style="color: #008b8b;">img_&#24180;&#26376;&#26085;_&#26102;&#20998;&#31186;.png</span><span style="color: #b22222;">'</span>
  (<span style="color: #a020f0;">setq</span> srcImgName (concat <span style="color: #8b2252;">"img_"</span> (format-time-string <span style="color: #8b2252;">"%Y%m%d_%H%M%S"</span>) <span style="color: #8b2252;">"_src.png"</span>))
  (<span style="color: #a020f0;">setq</span> imgName (concat <span style="color: #8b2252;">"img_"</span> (format-time-string <span style="color: #8b2252;">"%Y%m%d_%H%M%S"</span>) <span style="color: #8b2252;">".png"</span>))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#22270;&#29255;&#25991;&#20214;&#30340;&#30456;&#23545;&#36335;&#24452;</span>
  (<span style="color: #a020f0;">setq</span> srcRelativeFilename (concat <span style="color: #8b2252;">"./images/"</span> srcImgName))
  (<span style="color: #a020f0;">setq</span> relativeFilename (concat <span style="color: #8b2252;">"./images/"</span> imgName))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#26681;&#25454;&#19981;&#21516;&#30340;&#25805;&#20316;&#31995;&#32479;&#35774;&#32622;&#19981;&#21516;&#30340;&#21629;&#20196;&#34892;&#24037;&#20855;</span>
  (<span style="color: #a020f0;">cond</span> ((string-equal system-type <span style="color: #8b2252;">"gnu/linux"</span>)
         (shell-command (concat <span style="color: #8b2252;">"xclip -selection clipboard -t image/png -o &gt; "</span> relativeFilename)))
        ((string-equal system-type <span style="color: #8b2252;">"darwin"</span>)
         (shell-command (concat <span style="color: #8b2252;">"pngpaste "</span> relativeFilename)))
        ((string-equal system-type <span style="color: #8b2252;">"windows-nt"</span>)
         <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#21407; (shell-command (concat "powershell -command \"Add-Type -AssemblyName System.Windows.Forms;if ($([System.Windows.Forms.Clipboard]::ContainsImage())) {$image = [System.Windows.Forms.Clipboard]::GetImage();[System.Drawing.Bitmap]$image.Save('"relativeFilename "',[System.Drawing.Imaging.ImageFormat]::Png); Write-Output 'clipboard content saved as file'} else {Write-Output 'clipboard does not contain image data'}\""))))</span>
         <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#31616;&#21333;&#21387;&#32553; (shell-command (concat "powershell -command \"Add-Type -AssemblyName System.Windows.Forms; if ($([System.Windows.Forms.Clipboard]::ContainsImage())) { $image = [System.Windows.Forms.Clipboard]::GetImage(); $image.Save('"srcRelativeFilename "', [System.Drawing.Imaging.ImageFormat]::Png); Write-Output 'Clipboard content saved as file'; &amp; ffmpeg -i "srcRelativeFilename " -q:v 4 -loglevel quiet -y "relativeFilename " } else { Write-Output 'Clipboard does not contain image data' }\""))))</span>
         <span style="color: #b22222;">;; </span><span style="color: #b22222;">(shell-command (concat "powershell -command \"Add-Type -AssemblyName System.Windows.Forms; if ($([System.Windows.Forms.Clipboard]::ContainsImage())) { $image = [System.Windows.Forms.Clipboard]::GetImage(); $image.Save('"srcRelativeFilename "', [System.Drawing.Imaging.ImageFormat]::Png); Write-Output 'Clipboard content saved as file'; &amp; ffmpeg -i "srcRelativeFilename " -q:v 4 -loglevel quiet -y "relativeFilename " ;&amp; Remove-Item -Path "srcRelativeFilename" -Force} else { Write-Output 'Clipboard does not contain image data' }\""))))</span>
         <span style="color: #b22222;">;;</span><span style="color: #b22222;">&#35843;&#33394;&#26495;&#21387;&#32553; (shell-command (concat "powershell -command \"Add-Type -AssemblyName System.Windows.Forms; if ($([System.Windows.Forms.Clipboard]::ContainsImage())) { $image = [System.Windows.Forms.Clipboard]::GetImage(); $image.Save('"srcRelativeFilename "', [System.Drawing.Imaging.ImageFormat]::Png); Write-Output 'Clipboard content saved as file'; ffmpeg -i "srcRelativeFilename " -vf '</span><span style="color: #008b8b;">palettegen=max_colors=256:stats_mode=single</span><span style="color: #b22222;">' -loglevel quiet -y  out_3.png ; ffmpeg -i "srcRelativeFilename " -i out_3.png -lavfi '[0][1:v] paletteuse' -pix_fmt pal8 -loglevel quiet -y "relativeFilename "} else { Write-Output 'Clipboard does not contain image data' }\""))))</span>
         (shell-command (concat <span style="color: #8b2252;">"powershell -command \"Add-Type -AssemblyName System.Windows.Forms; if ($([System.Windows.Forms.Clipboard]::ContainsImage())) { $image = [System.Windows.Forms.Clipboard]::GetImage(); $image.Save('"</span>srcRelativeFilename <span style="color: #8b2252;">"', [System.Drawing.Imaging.ImageFormat]::Png); Write-Output 'Clipboard content saved as file'; ffmpeg -i "</span>srcRelativeFilename <span style="color: #8b2252;">" -vf '</span><span style="color: #008b8b;">palettegen=max_colors=256:stats_mode=single</span><span style="color: #8b2252;">' -loglevel quiet -y  out_3.png ; ffmpeg -i "</span>srcRelativeFilename <span style="color: #8b2252;">" -i out_3.png -lavfi '[0][1:v] paletteuse' -pix_fmt pal8 -loglevel quiet -y "</span>relativeFilename <span style="color: #8b2252;">"; Remove-Item -Path "</span>srcRelativeFilename<span style="color: #8b2252;">" -Force ; Remove-Item -Path out_3.png  -Force} else { Write-Output 'Clipboard does not contain image data' }\""</span>))))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#32473;&#31896;&#36148;&#22909;&#30340;&#22270;&#29255;&#38142;&#25509;&#21152;&#19978;&#23485;&#24230;&#23646;&#24615;&#65292;&#26041;&#20415;&#23548;&#20986;</span>
  (insert (concat <span style="color: #8b2252;">"\n#+DOWNLOADED: screenshot @ "</span>
                  (format-time-string <span style="color: #8b2252;">"%Y-%m-%d %a %H:%M:%S"</span> (current-time))
                  <span style="color: #8b2252;">"\n#+CAPTION: \n#+ATTR_ORG: :width "</span>
                  <span style="color: #8b2252;">"30%"</span>
                  <span style="color: #b22222;">;;</span><span style="color: #b22222;">width</span>
                  <span style="color: #8b2252;">"\n#+ATTR_LATEX: :width "</span>
                  (<span style="color: #a020f0;">if</span> (&gt;= (/ (string-to-number width) 800.0) 1.0)
                      <span style="color: #8b2252;">"1.0"</span>
                    (number-to-string (/ (string-to-number width) 800.0)))
                  <span style="color: #8b2252;">"\\linewidth :float nil\n"</span>
                  <span style="color: #8b2252;">"#+ATTR_HTML: :width "</span>
                  width
                  <span style="color: #8b2252;">"\n[[file:"</span> relativeFilename <span style="color: #8b2252;">"]]\n"</span>))
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">&#37325;&#26032;&#26174;&#31034;&#19968;&#19979;&#22270;&#29255;</span>
  (org-redisplay-inline-images)
  (message <span style="color: #8b2252;">"OKKKKKK"</span>)
  )

<span style="color: #b22222;">;;</span><span style="color: #b22222;">(global-set-key (kbd "&lt;f2&gt;") 'my/org-insert-clipboard-image)</span>


(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">j-org-download</span>)
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-org-download.el ends here</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:j-org" class="outline-3">
<h3 id="h:j-org"><span class="section-number-3">5.8.</span> <code>j-org.el</code> 库</h3>
<div class="outline-text-3" id="text-h:j-org">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-org.el --- Extensions for org -*- lexical-binding: t -*-</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Copyright (C) 2024  Jasper Hsu</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Author: Jasper Hsu <a href="mailto:xcwhome%40163.com">&lt;xcwhome@163.com&gt;</a></span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">URL: https://xuchangwei.com/lisp/jasper-emacs.html</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Version: 0.1.0</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Package-Requires: ((emacs "30.1"))</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This file is NOT part of GNU Emacs.</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is free software; you can redistribute it and/or modify</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">it under the terms of the GNU General Public License as published by</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">the Free Software Foundation, either version 3 of the License, or (at</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">your option) any later version.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is distributed in the hope that it will be useful,</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">GNU General Public License for more details.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">You should have received a copy of the GNU General Public License</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">along with this program.  If not, see <a href="https://www.gnu.org/licenses/">&lt;https://www.gnu.org/licenses/&gt;</a>.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Commentary:</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Remember that every piece of Elisp that I write is for my own</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">educational and recreational purposes.  I do not recommend that</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">you copy any of this if you are not certain of what it does.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Code:</span>

<span style="color: #b22222;">;;;; </span><span style="color: #b22222;">org-export</span>

(<span style="color: #a020f0;">declare-function</span> org-html-export-as-html <span style="color: #8b2252;">"org"</span>)
(<span style="color: #a020f0;">declare-function</span> org-texinfo-export-to-info <span style="color: #8b2252;">"org"</span>)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">j-org-ox-html</span> ()
  <span style="color: #8b2252;">"&#23548;&#20986;&#20026;html</span>
<span style="color: #8b2252;">Streamline HTML export."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (org-html-export-as-html nil nil nil t nil))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">j-org-ox-texinfo</span> ()
  <span style="color: #8b2252;">"&#23548;&#20986;Info</span>
<span style="color: #8b2252;">Streamline Info export."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (org-texinfo-export-to-info))

<span style="color: #b22222;">;;;; </span><span style="color: #b22222;">org-id</span>

(<span style="color: #a020f0;">declare-function</span> org-id-add-location <span style="color: #8b2252;">"org"</span>)
(<span style="color: #a020f0;">declare-function</span> org-with-point-at <span style="color: #8b2252;">"org"</span>)
(<span style="color: #a020f0;">declare-function</span> org-entry-get <span style="color: #8b2252;">"org"</span>)
(<span style="color: #a020f0;">declare-function</span> org-id-new <span style="color: #8b2252;">"org"</span>)
(<span style="color: #a020f0;">declare-function</span> org-entry-put <span style="color: #8b2252;">"org"</span>)

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Original idea:</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;"><a href="https://writequit.org/articles/emacs-org-mode-generate-ids.html">&lt;https://writequit.org/articles/emacs-org-mode-generate-ids.html&gt;</a>.</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">j-org--id-get</span> ()
  <span style="color: #8b2252;">"&#33719;&#21462;&#24403;&#21069;&#30340;CUSTOM_ID</span>
<span style="color: #8b2252;">Get the CUSTOM_ID of the current entry.</span>
<span style="color: #8b2252;">If the entry already has a CUSTOM_ID, return it as-is, else</span>
<span style="color: #8b2252;">create a new one."</span>
  (<span style="color: #a020f0;">let*</span> ((pos (point))
         (id (org-entry-get pos <span style="color: #8b2252;">"CUSTOM_ID"</span>)))
    (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">and</span> id (stringp id) (string-match-p <span style="color: #8b2252;">"\\S-"</span> id))
        id
      (<span style="color: #a020f0;">setq</span> id (org-id-new <span style="color: #8b2252;">"h"</span>))
      (org-entry-put pos <span style="color: #8b2252;">"CUSTOM_ID"</span> id)
      id)))

(<span style="color: #a020f0;">declare-function</span> org-map-entries <span style="color: #8b2252;">"org"</span>)

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">j-org-id-headlines</span> ()
  <span style="color: #8b2252;">"&#28155;&#21152;CUSTOM_ID</span>
<span style="color: #8b2252;">Add missing CUSTOM_ID to all headlines in current file."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (org-map-entries
   (<span style="color: #a020f0;">lambda</span> () (j-org--id-get))))

<span style="color: #b22222;">;;;</span><span style="color: #b22222;">###</span><span style="color: #ff0000; font-weight: bold;">autoload</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">j-org-id-headline</span> ()
  <span style="color: #8b2252;">"Add missing CUSTOM_ID to headline at point."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (j-org--id-get))

(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">j-org</span>)
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-org.el ends here</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:j-emacs-fast" class="outline-3">
<h3 id="h:j-emacs-fast"><span class="section-number-3">5.9.</span> <code>j-emacs-fast.el</code> 库</h3>
<div class="outline-text-3" id="text-h:j-emacs-fast">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-emacs-fast.el --- Extensions for org -*- lexical-binding: t -*-</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Copyright (C) 2024  Jasper Hsu</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">Author: Jasper Hsu <a href="mailto:xcwhome%40163.com">&lt;xcwhome@163.com&gt;</a></span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">URL: https://xuchangwei.com/lisp/jasper-emacs.html</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Version: 0.1.0</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Package-Requires: ((emacs "30.1"))</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This file is NOT part of GNU Emacs.</span>

<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is free software; you can redistribute it and/or modify</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">it under the terms of the GNU General Public License as published by</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">the Free Software Foundation, either version 3 of the License, or (at</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">your option) any later version.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">This program is distributed in the hope that it will be useful,</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">GNU General Public License for more details.</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">You should have received a copy of the GNU General Public License</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">along with this program.  If not, see <a href="https://www.gnu.org/licenses/">&lt;https://www.gnu.org/licenses/&gt;</a>.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Commentary:</span>
<span style="color: #b22222;">;;</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Remember that every piece of Elisp that I write is for my own</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">educational and recreational purposes.  I do not recommend that</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">you copy any of this if you are not certain of what it does.</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Code:</span>

<span style="color: #b22222;">;;;; </span><span style="color: #b22222;">&#25918;&#32622;&#19968;&#20123;&#24555;&#25463;&#20351;&#29992;emacs&#20989;&#25968;</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">Dos2Unix/Unix2Dos</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">fast/dos2unix</span> ()
  <span style="color: #8b2252;">"Convert the current buffer to UNIX file format."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (set-buffer-file-coding-system 'undecided-unix nil))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">fast/unix2dos</span> ()
  <span style="color: #8b2252;">"Convert the current buffer to DOS file format."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (set-buffer-file-coding-system 'undecided-dos nil))


<span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#25991;&#20214;&#25805;&#20316;</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">fast/open-my-init-file</span>()
  <span style="color: #8b2252;">"&#24555;&#36895;&#25171;&#24320;&#20027;&#37197;&#32622;&#25991;&#20214;"</span>
  (<span style="color: #a020f0;">interactive</span>)
  (find-file (expand-file-name <span style="color: #8b2252;">"init.el"</span> user-emacs-directory )))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">fast/copy-file-name</span> ()
  <span style="color: #8b2252;">"&#22797;&#21046;&#25991;&#20214;&#32477;&#23545;&#36335;&#24452;&#65292;&#20351;&#29992; =C-y= &#31896;&#36148;</span>
<span style="color: #8b2252;">Copy the current buffer file name to the clipboard."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">if-let</span> ((filename (<span style="color: #a020f0;">if</span> (equal major-mode 'dired-mode)
                         default-directory
                       (buffer-file-name))))
      (<span style="color: #a020f0;">progn</span>
        (kill-new filename)
        (message <span style="color: #8b2252;">"Copied '</span><span style="color: #008b8b;">%s</span><span style="color: #8b2252;">'"</span> filename))
    (<span style="color: #ff0000; font-weight: bold;">warn</span> <span style="color: #8b2252;">"Current buffer is not attached to a file!"</span>)))

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">buffer&#32531;&#20914;&#21306;</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">fast/copy-buffer-name</span> ()
  <span style="color: #8b2252;">"&#22797;&#21046;&#32531;&#20914;&#21306;&#21517;</span>
<span style="color: #8b2252;">Copy name of the current buffer."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (kill-new (buffer-name)))

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">fast/kill-other-buffers</span> ()
  <span style="color: #8b2252;">"&#26432;&#25481;&#20854;&#20182;&#32531;&#20914;&#21306;</span>
<span style="color: #8b2252;">Kill all other buffers."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (mapc 'kill-buffer
        (delq (current-buffer)
              (cl-remove-if-not 'buffer-file-name (buffer-list)))))

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#36820;&#22238;&#19978;&#19968;&#20010;buffer</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">spacemacs/alternate-buffer</span> (<span style="color: #228b22;">&amp;optional</span> window)
  <span style="color: #8b2252;">"Switch back and forth between current and last buffer in the</span>
<span style="color: #8b2252;">current window.</span>
<span style="color: #8b2252;">If `</span><span style="color: #008b8b;">spacemacs-layouts-restrict-spc-tab</span><span style="color: #8b2252;">' is `</span><span style="color: #008b8b;">t</span><span style="color: #8b2252;">' then this only switches between</span>
<span style="color: #8b2252;">the current layouts buffers."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">cl-destructuring-bind</span> (buf start pos)
      (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">bound-and-true-p</span> spacemacs-layouts-restrict-spc-tab)
          (<span style="color: #a020f0;">let</span> ((buffer-list (persp-buffer-list))
                (my-buffer (window-buffer window)))
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">find buffer of the same persp in window</span>
            (seq-find (<span style="color: #a020f0;">lambda</span> (it) <span style="color: #b22222;">;; </span><span style="color: #b22222;">predicate</span>
                        (<span style="color: #a020f0;">and</span> (not (eq (car it) my-buffer))
                             (member (car it) buffer-list)))
                      (window-prev-buffers)
                      <span style="color: #b22222;">;; </span><span style="color: #b22222;">default if found none</span>
                      (list nil nil nil)))
        (<span style="color: #a020f0;">or</span> (cl-find (window-buffer window) (window-prev-buffers)
                     <span style="color: #483d8b;">:key</span> #'car <span style="color: #483d8b;">:test-not</span> #'eq)
            (list (other-buffer) nil nil)))
    (<span style="color: #a020f0;">if</span> (not buf)
        (message <span style="color: #8b2252;">"Last buffer not found."</span>)
      (set-window-buffer-start-and-point window buf start pos))))

(<span style="color: #a020f0;">provide</span> '<span style="color: #008b8b;">j-emacs-fast</span>)
<span style="color: #b22222;">;;; </span><span style="color: #b22222;">j-emacs-fast.el ends here</span>
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:43ed0760-cc70-475c-9da8-a9caa7f67657" class="outline-2">
<h2 id="h:43ed0760-cc70-475c-9da8-a9caa7f67657"><span class="section-number-2">6.</span> Emacs 配置问题排查</h2>
<div class="outline-text-2" id="text-h:43ed0760-cc70-475c-9da8-a9caa7f67657">
<p>
配置最好用git管理起来。
</p>
</div>
<div id="outline-container-h:2fee1b0f-3633-4d2c-9301-8b08562a07aa" class="outline-3">
<h3 id="h:2fee1b0f-3633-4d2c-9301-8b08562a07aa"><span class="section-number-3">6.1.</span> 配置有问题，启动不了怎么办？</h3>
<div class="outline-text-3" id="text-h:2fee1b0f-3633-4d2c-9301-8b08562a07aa">
<div class="org-src-container">
<pre class="src src-sh">emacs-debug &#8211;init
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a95b56f5-efc0-44a0-b9be-1a054b419bde" class="outline-3">
<h3 id="h:a95b56f5-efc0-44a0-b9be-1a054b419bde"><span class="section-number-3">6.2.</span> 不能安装包，提示签名错误</h3>
<div class="outline-text-3" id="text-h:a95b56f5-efc0-44a0-b9be-1a054b419bde">
<p>
Failed to verify signature archive-contents.sig
</p>

<pre class="example" id="org15bffc8">
(setq package-check-signature nil)
</pre>
</div>
</div>
<div id="outline-container-h:1576a87a-4eda-419a-8e88-46629c6044a4" class="outline-3">
<h3 id="h:1576a87a-4eda-419a-8e88-46629c6044a4"><span class="section-number-3">6.3.</span> 包解压失败，</h3>
<div class="outline-text-3" id="text-h:1576a87a-4eda-419a-8e88-46629c6044a4">
<p>
a pax extended header, 包解压失败，可以使用 use-package :vc 直接安装
</p>

<p>
使用 mysys2 的时候，系统会使用 unix 的 tar 去解压会有问题 windows 上面需要使用 system32/tar 这个程序去解压。
</p>

<p>
解决办法可以是
</p>
<div class="org-src-container">
<pre class="src src-sh">mv /usr/bin/tar /usr/bin/tarbak
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:fcadef90-7310-40d6-aaa0-de74737e0940" class="outline-2">
<h2 id="h:fcadef90-7310-40d6-aaa0-de74737e0940"><span class="section-number-2">7.</span> 优化性能，借鉴其他人的配置</h2>
<div class="outline-text-2" id="text-h:fcadef90-7310-40d6-aaa0-de74737e0940">
<p>
how to Profile performace
</p>
</div>
<div id="outline-container-h:558eed58-5e30-476b-acd3-ad1a46949b1b" class="outline-3">
<h3 id="h:558eed58-5e30-476b-acd3-ad1a46949b1b"><span class="section-number-3">7.1.</span> 运行时性能</h3>
<div class="outline-text-3" id="text-h:558eed58-5e30-476b-acd3-ad1a46949b1b">
<ul class="org-ul">
<li><code>M-x profiler-start</code> 选择cpu+mem</li>
<li>复现卡的操作。比如光标移动卡顿，反复重现</li>
<li><code>M-x profiler-report</code> 打开报告，分析</li>
</ul>
</div>
</div>
<div id="outline-container-h:da6bbc1a-043f-45e9-8aca-f565c8454588" class="outline-3">
<h3 id="h:da6bbc1a-043f-45e9-8aca-f565c8454588"><span class="section-number-3">7.2.</span> 度量启动性能</h3>
<div class="outline-text-3" id="text-h:da6bbc1a-043f-45e9-8aca-f565c8454588">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">use-package</span> benchmark-init
  <span style="color: #483d8b;">:ensure</span> t
  <span style="color: #483d8b;">:demand</span> t
  <span style="color: #483d8b;">:config</span>
  <span style="color: #b22222;">;; </span><span style="color: #b22222;">To disable collection of benchmark data after init is done.</span>
  (add-hook 'after-init-hook 'benchmark-init/deactivate))
</pre>
</div>

<ul class="org-ul">
<li><code>benchmark-init/show-durations-tree</code> 树状展示耗时</li>
<li><code>benchmark-init/show-durations-tabulated</code> 排序展示， 鼠标点击字段进行排序。 分析</li>
</ul>

<p>
启动时间
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">efs/display-startup-time</span> ()
  (message <span style="color: #8b2252;">"&#21551;&#21160;&#21152;&#36733;&#26102;&#38388;Emacs loaded in %s with %d garbage collections."</span>
           (format <span style="color: #8b2252;">"%.2f seconds"</span>
                   (float-time
                   (time-subtract after-init-time before-init-time)))
           gcs-done))

(add-hook 'emacs-startup-hook #'efs/display-startup-time)
</pre>
</div>

<p>
减小gc次数
</p>
<ul class="org-ul">
<li>在开始加载时gc设置大些，加载完成后gc调小</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">beginning of init.el</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">The default is 800 kilobytes.  Measured in bytes.</span>
(<span style="color: #a020f0;">setq</span> gc-cons-threshold (* 50 1000 1000))

<span style="color: #b22222;">;; </span><span style="color: #b22222;">................</span>

<span style="color: #b22222;">;;; </span><span style="color: #b22222;">end of init.el</span>
<span style="color: #b22222;">;; </span><span style="color: #b22222;">Make gc pauses faster by decreasing the threshold.</span>
(<span style="color: #a020f0;">setq</span> gc-cons-threshold (* 2 1000 1000))
</pre>
</div>

<p>
不要加载任何包裹！ 
</p>

<p>
use-package 哪些操作可以优化性能, 几种不同的方法来延迟包加载：
</p>
<ul class="org-ul">
<li>:hook - 首次调用其中一个钩子时，将加载包</li>
<li>:bind - 首次使用其中一个键绑定时，将加载包</li>
<li>:commands - 当使用其中一个命令时，将加载包</li>
<li>:mode - 首次打开具有特定扩展名的文件时，将加载包</li>
<li>:after - 在其他特定包加载后加载此包</li>
<li>:defer - 如果您不使用任何其他选项，则此选项将延迟加载到启动后</li>
</ul>

<p>
<a href="https://systemcrafters.net/emacs-from-scratch/cut-start-up-time-in-half/">https://systemcrafters.net/emacs-from-scratch/cut-start-up-time-in-half/</a>
</p>
</div>
</div>
<div id="outline-container-h:d923bc80-6e8b-4832-b177-156188d0cdad" class="outline-3">
<h3 id="h:d923bc80-6e8b-4832-b177-156188d0cdad"><span class="section-number-3">7.3.</span> 借鉴大佬的配置，作为框架</h3>
<div class="outline-text-3" id="text-h:d923bc80-6e8b-4832-b177-156188d0cdad">
<p>
社区配置
</p>

<p>
Spacemacs &amp; DoomEmacs
</p>

<p>
个人配置
</p>
<ul class="org-ul">
<li><a href="https://github.com/purcell/emacs.d">https://github.com/purcell/emacs.d</a></li>
<li><a href="https://github.com/bbatsov/prelude">https://github.com/bbatsov/prelude</a></li>
<li><a href="https://github.com/bbatsov/prelude">https://github.com/bbatsov/prelude</a></li>
<li><a href="https://github.com/seagle0128/.emacs.d">https://github.com/seagle0128/.emacs.d</a></li>
<li><a href="https://github.com/zilongshanren/emacs.d">https://github.com/zilongshanren/emacs.d</a> （子龙山人）</li>
</ul>
</div>
</div>
<div id="outline-container-h:33962756-e6d0-4b81-887d-cd51a76eded0" class="outline-3">
<h3 id="h:33962756-e6d0-4b81-887d-cd51a76eded0"><span class="section-number-3">7.4.</span> 小技巧：</h3>
<div class="outline-text-3" id="text-h:33962756-e6d0-4b81-887d-cd51a76eded0">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #b22222;">;;; </span><span style="color: #b22222;">&#36820;&#22238;&#19978;&#19968;&#20010;buffer</span>
(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">spacemacs/alternate-buffer</span> (<span style="color: #228b22;">&amp;optional</span> window)
  <span style="color: #8b2252;">"Switch back and forth between current and last buffer in the</span>
<span style="color: #8b2252;">current window.</span>
<span style="color: #8b2252;">If `</span><span style="color: #008b8b;">spacemacs-layouts-restrict-spc-tab</span><span style="color: #8b2252;">' is `</span><span style="color: #008b8b;">t</span><span style="color: #8b2252;">' then this only switches between</span>
<span style="color: #8b2252;">the current layouts buffers."</span>
  (<span style="color: #a020f0;">interactive</span>)
  (<span style="color: #a020f0;">cl-destructuring-bind</span> (buf start pos)
      (<span style="color: #a020f0;">if</span> (<span style="color: #a020f0;">bound-and-true-p</span> spacemacs-layouts-restrict-spc-tab)
          (<span style="color: #a020f0;">let</span> ((buffer-list (persp-buffer-list))
                (my-buffer (window-buffer window)))
            <span style="color: #b22222;">;; </span><span style="color: #b22222;">find buffer of the same persp in window</span>
            (seq-find (<span style="color: #a020f0;">lambda</span> (it) <span style="color: #b22222;">;; </span><span style="color: #b22222;">predicate</span>
                        (<span style="color: #a020f0;">and</span> (not (eq (car it) my-buffer))
                             (member (car it) buffer-list)))
                      (window-prev-buffers)
                      <span style="color: #b22222;">;; </span><span style="color: #b22222;">default if found none</span>
                      (list nil nil nil)))
        (<span style="color: #a020f0;">or</span> (cl-find (window-buffer window) (window-prev-buffers)
                     <span style="color: #483d8b;">:key</span> #'car <span style="color: #483d8b;">:test-not</span> #'eq)
            (list (other-buffer) nil nil)))
    (<span style="color: #a020f0;">if</span> (not buf)
        (message <span style="color: #8b2252;">"Last buffer not found."</span>)
      (set-window-buffer-start-and-point window buf start pos))))
</pre>
</div>

<p>
按键绑定：
</p>

<pre class="example" id="org244af62">
"TAB" 'spacemacs/alternate-buffer
</pre>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>打赏</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>© 2025 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
<!--
<script type="text/javascript" src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/bootstrap@5.2.1/dist/js/bootstrap.min.js"></script>
<div id="back-to-top" class=""><svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg></div>
-->
</div>
</body>
</html>
