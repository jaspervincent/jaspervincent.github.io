<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Python: 面向对象</title>
<meta name="generator" content="Org Mode" />
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<!-- from -->
<!--
<style>#back-to-top{background:#000;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;bottom:20px;-webkit-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);-moz-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);box-shadow:0 2px 5px 0 rgba(0,0,0,.26);color:#fff;cursor:pointer;display:block;height:56px;opacity:1;outline:0;position:fixed;right:20px;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-transition:bottom .2s,opacity .2s;-o-transition:bottom .2s,opacity .2s;-moz-transition:bottom .2s,opacity .2s;transition:bottom .2s,opacity .2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:56px;z-index:1}#back-to-top svg{display:block;fill:currentColor;height:24px;margin:16px auto 0;width:24px}#back-to-top.hidden{bottom:-56px;opacity:0}</style>
-->
<link rel="stylesheet" href="/static/aandds.com/css/main.css">
<link rel="stylesheet" href="/static/aandds.com/css/drollery.min.css">
<script type="text/javascript" src="/static/aandds.com/js/main.js"></script>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Python: 面向对象</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:45e38fa6-5b82-4bc8-a093-4ffda2155162">Python 面向过程编程</a>
<ul>
<li><a href="#h:a963e76e-0efb-497e-a562-88711aeb16fb">Python函数</a>
<ul>
<li><a href="#h:86b3a390-c9c0-4fab-ba81-587b070bb58d">函数</a></li>
<li><a href="#h:67cac823-ffbc-459b-86e8-e0db11990eba">函数定义</a></li>
<li><a href="#h:d265d02b-bbaf-4d4b-b357-056f87bda9d5">函数调用</a></li>
<li><a href="#h:bf3b5c31-469c-4ea3-82eb-88863fa96965">函数参数</a>
<ul>
<li><a href="#h:9411fe31-a09b-401b-ba8c-32664d4e5be9">实参传参方式</a></li>
<li><a href="#h:86d25d1b-7128-428f-94d6-d08a50a57a2c">形参缺省值</a></li>
<li><a href="#h:c51c41fe-83a2-49b9-a1b5-c6b0e8edd0b1">可变参数</a></li>
<li><a href="#h:f7a6566b-96ac-4e22-9cc0-3d991601e1a7">keyword-only参数</a></li>
<li><a href="#h:1b00f1ef-e235-4339-a1f8-84f704a81632">Positional-only参数</a></li>
<li><a href="#h:d1d37262-0f28-42b6-ab68-8cd16c2aae40">参数的混合使用</a></li>
<li><a href="#h:91a6d29e-a457-4500-b064-9e99c0443d3e">参数规则</a></li>
</ul>
</li>
<li><a href="#h:46e748a8-5be0-419a-a88d-f7ca1d7e59bc">参数解构</a></li>
</ul>
</li>
<li><a href="#h:72bc52d3-b311-40cb-9434-deb08c7a3eee">函数返回值</a>
<ul>
<li><a href="#h:fdb5b322-e397-4e79-9749-7bf9a4bab8e5">练习</a></li>
</ul>
</li>
<li><a href="#h:a2d785fc-f136-442c-95c1-2b1a78ad3f44">返回值作用域</a>
<ul>
<li><a href="#h:7e6f4dbc-39ae-48e5-a5bd-fd1ed837bade">函数作用域***</a>
<ul>
<li><a href="#h:225d8ff5-1cfe-45aa-aa1f-4ac6714d0051">作用域</a></li>
<li><a href="#h:3b0629ba-2af4-42d7-9ba1-48ef0cea66f2">作用域分类</a></li>
<li><a href="#h:56d7e856-fa02-4e8b-965e-67cfebe2d5b1">函数嵌套</a>
<ul>
<li><a href="#h:2a18f60a-4d93-4c46-a5d7-d9cff5d9defe">嵌套结构的作用域</a></li>
</ul>
</li>
<li><a href="#h:3a258199-fae2-45b7-9f95-2cf36e129400">内建函数chr, ord</a></li>
<li><a href="#h:636d00c3-0ec1-4451-863f-ef110e2ff27c">一个赋值语句的问题</a></li>
<li><a href="#h:073418d0-6c9b-4f39-a6c2-08b553ab8b95">global语句</a>
<ul>
<li><a href="#h:985b0e7d-59dd-408b-a9c4-bd4a41fa1c90">总结</a></li>
<li><a href="#h:358a5ca3-ba49-4125-93bf-038990a68532">global使用原则</a></li>
</ul>
</li>
<li><a href="#h:c729f5d8-bb61-4850-864e-ddf0e7e13fe2">闭包***</a>
<ul>
<li><a href="#h:5094aa21-f4eb-458f-ba30-8ef5c181e32a">nonlocal语句</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:db599370-595e-48a8-ad1b-d3d5fd39aca2">默认值的作用域</a></li>
<li><a href="#h:a1593c26-9803-4caf-a733-0db0cb2a826e">变量名解析原则LEGB***</a></li>
<li><a href="#h:9e4a921f-9684-406f-a662-a350a7cc4326">函数的销毁</a></li>
</ul>
</li>
<li><a href="#h:51a257f0-78e6-415d-a1bb-586431d7d462">匿名函数</a></li>
<li><a href="#h:d819a71c-37f8-4fdb-8df3-f916a8e4b3c9">递归函数</a>
<ul>
<li><a href="#h:c18765e7-3b34-4c92-b668-fdae10ab7613">函数执行流程</a></li>
<li><a href="#h:81ac7907-acc2-4c9d-bf4f-da340eebff25">递归</a></li>
<li><a href="#h:5939972a-7658-4d82-b11b-e8f5f2bbce5c">斐波那契数列递归</a></li>
<li><a href="#h:8f95c492-4e88-4f2d-8670-dc885f28ff0d">递归要求</a></li>
<li><a href="#h:f051a72d-1ede-444e-8625-5583b447a903">递归效率</a></li>
<li><a href="#h:8a288237-54c5-46e5-b88d-812ea5dc3664">间接递归</a></li>
<li><a href="#h:ae86a78f-85be-4eda-87f8-f59c58bda5fc">总结</a></li>
<li><a href="#h:f8f44951-7431-40dc-a01a-9931b374f642">练习</a>
<ul>
<li><a href="#h:85e5fb59-3fa4-490c-b492-676eebc6d01e">求n的阶乘</a></li>
<li><a href="#h:97e1763f-9fa9-4300-885d-821abd3b8660">解决猴子吃桃问题</a></li>
<li><a href="#h:c47deb52-1968-46b3-997a-f31ba08703fb">将一个数逆序放入列表中</a></li>
<li><a href="#h:9e68a05e-2660-4a7d-9247-106987d690fb">扁平化字典</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:ec7f5561-5ab8-42b9-90e3-eca25103be9a">排序算法-直接插入排序</a>
<ul>
<li><a href="#h:bc597534-3964-4d3e-b7ee-4104d9d03a11">核心算法</a></li>
<li><a href="#h:a478a2bb-ca15-44ac-b815-362e99876e10">算法实现</a></li>
<li><a href="#h:9e0f1767-15eb-41dd-96cf-eeefa60a1509">总结</a></li>
<li><a href="#h:8b2df177-23d5-42de-835e-5f7e0f2c095c">排序稳定性</a></li>
</ul>
</li>
<li><a href="#h:acd7c80d-288b-4f1f-860c-fbc1e4df5450">生成器***</a>
<ul>
<li><a href="#h:7206bd92-f69b-4db7-972d-bfae5060d8cc">生成器函数的执行</a></li>
<li><a href="#h:cb7364fd-cf4d-423c-b960-62081bac852a">生成器应用</a>
<ul>
<li><a href="#h:2f2baef5-5e53-4df7-a4b9-5f3a49f4b660">无限循环</a></li>
<li><a href="#h:666ee958-eded-4518-9c60-5dd4f956e2b7">计数器</a></li>
<li><a href="#h:735f7bdd-fccb-4bea-9251-cfab1df22cab">斐波那契数列</a></li>
<li><a href="#h:7f364245-2fb1-4992-89e5-2fd54d53863f">生成器交互</a></li>
<li><a href="#h:06b43354-c3cf-4fd7-8a69-c4767807aafa">协程Coroutine</a></li>
</ul>
</li>
<li><a href="#h:2f1d2ee7-f111-40c2-b88c-d950891c61ab">yield from语法</a></li>
</ul>
</li>
<li><a href="#h:2382e9cd-51b9-4a45-85e5-08e36fe2afc9">数据结构-非线性数据结构-树</a>
<ul>
<li><a href="#h:e8e5b4f8-d97d-4f4b-b940-5729ed7daf59">树</a>
<ul>
<li><a href="#h:e34bd8af-5a71-4886-9e10-326e2506c324">名词解释</a></li>
<li><a href="#h:a1119391-09a8-4c75-9a1f-88851b5ae802">特点</a></li>
</ul>
</li>
<li><a href="#h:012ec07f-0c4b-4609-b2dc-1ca026a09248">二叉树</a>
<ul>
<li><a href="#h:0163b9f1-ebe2-4350-a527-a619d0b66601">概念</a></li>
<li><a href="#h:599e254f-95ce-4d83-a1b0-f44994f0cdb3">斜树</a></li>
<li><a href="#h:1bb4b1d9-dc0c-4ae0-8b10-b6bf13440d60">满二叉树</a></li>
<li><a href="#h:54f38bed-fe22-4262-81c7-be4fdddfdfc6">完全二叉树</a></li>
<li><a href="#h:8a03113b-914c-46a9-bf76-10340d499877">性质</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:8826aa0a-1eaf-4372-9592-def7c8f92cfa">树的遍历和堆排序</a>
<ul>
<li><a href="#h:43254391-b0ef-4905-81ea-b90280e314cc">二叉树的遍历</a>
<ul>
<li><a href="#h:99c83271-76f0-4155-9426-a8ea0dc1d5e9">树的遍历</a></li>
<li><a href="#h:2d4b9b69-ad74-4d7f-b5bc-ba228e628816">深度优先遍历</a></li>
</ul>
</li>
<li><a href="#h:281898c1-5e6b-4931-bcf6-ff9f54d27965">打印树</a></li>
<li><a href="#h:2f7a4be2-2dd1-4502-a4f3-ffafffb7d5c5">堆排序Heap Sort</a>
<ul>
<li><a href="#h:5c61bf6c-2186-408d-8de2-b190856705a6">堆Heap</a></li>
<li><a href="#h:d0855469-956f-4598-a3d1-2390706ed3c8">算法实现</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:02315aaf-3f3c-4691-b457-e71827690ea5">高阶函数与柯里化</a>
<ul>
<li><a href="#h:2697d864-0f9d-4561-93b7-84ecb7d21679">高阶函数</a>
<ul>
<li><a href="#h:b6eef3b4-c035-4e79-af28-e4ac44ff8180">一等公民</a></li>
<li><a href="#h:5e418ca4-ea02-4722-9b71-e30d7fe9df33">高阶函数</a></li>
<li><a href="#h:9484492c-6951-40a7-a88d-841dd42cee5e">sorted函数原理</a>
<ul>
<li><a href="#h:fe65db62-8d68-498e-8cf3-a0266b3f8e8c">练习：自定义sort函数</a></li>
</ul>
</li>
<li><a href="#h:1b12f625-c4f1-47db-91c2-85fc7f3e18a2">内建高阶函数</a>
<ul>
<li><a href="#h:d66ee062-1184-43a3-a8a1-e94797d9edaa">排序sorted</a></li>
<li><a href="#h:56dd3549-1219-4341-8f79-a8c38d5ebc67">过滤filter</a></li>
<li><a href="#h:1ebea3dd-8216-4006-a068-bfd72d575009">映射map</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:324788b1-5dae-4dc8-bdee-a26d7aa7c37a">柯里化**</a></li>
</ul>
</li>
<li><a href="#h:6dfd77b3-9f53-4201-8f89-905df45bc327">装饰器</a>
<ul>
<li><a href="#h:ad726813-09d4-430e-95b4-7ba2ca5f5648">由来</a></li>
<li><a href="#h:654e47da-697f-42f4-b347-691261e025d7">无参装饰器</a></li>
<li><a href="#h:d34801a4-f12a-43ad-8569-e45471176eeb">带参装饰器</a>
<ul>
<li><a href="#h:8f8e903d-e0fe-4c6b-88ec-56efcbe43dfd">文档字符串</a></li>
<li><a href="#h:0352d3de-dfe0-4c06-adde-14e1dab1330d">装饰器的文档字符串问题</a></li>
<li><a href="#h:61a05c1f-d3bf-4ff3-9b07-ae2bee332bef">带参装饰器</a></li>
<li><a href="#h:136a4643-2ec5-41d1-a410-947f40bc9c0a">属性更新</a></li>
<li><a href="#h:340d2d03-f11d-46d7-95d4-7232f6e6bf35">总结</a></li>
</ul>
</li>
<li><a href="#h:9e5fca43-1d54-4dc5-8e84-cc78036497ad">装饰器进阶</a></li>
</ul>
</li>
<li><a href="#h:c09c8055-cba7-43d0-99db-ba6628d7eb8f">注解annotation</a>
<ul>
<li><a href="#h:3cc957d5-06b8-4c5a-ba44-effd371c2f42">函数注解</a></li>
<li><a href="#h:99862dbf-b87a-43a3-87f5-5f021e39d5a5">类型注解</a></li>
<li><a href="#h:1a13db4c-b6f1-4625-b21a-7027a6d55554">类型检查</a></li>
<li><a href="#h:ce6d23b9-33e1-4b88-8a43-20a72ecc4d83">inspect模块</a></li>
<li><a href="#h:9f99c5fa-6a5b-4344-ad34-23304791e933">参数类型检查</a></li>
</ul>
</li>
<li><a href="#h:7995d01c-976d-44b5-83fa-8ddf1ebe0b7d">functools模块</a>
<ul>
<li><a href="#h:b22eff52-5315-4e45-977d-c4b3e51914c0">reduce</a></li>
<li><a href="#h:e2b71b9b-b300-49b7-a116-399b9441d883">partial</a>
<ul>
<li><a href="#h:2661832c-8e58-4222-ad0a-5281ad197cd5">partial本质</a></li>
</ul>
</li>
<li><a href="#h:3e87602d-6468-41e9-a71d-a3f6503e3eb9"><code>lru_cache</code></a>
<ul>
<li><a href="#h:88ad312c-d110-4e83-b669-6e0bbdc3d9df"><code>lru_cache</code> 本质</a></li>
<li><a href="#h:227d72e1-5a19-4055-8bc8-de9f4524a87d">应用</a></li>
<li><a href="#h:0cb67231-a88c-4963-9916-e20c31fd728f">总结</a></li>
</ul>
</li>
<li><a href="#h:3ae30f2d-5ac4-42a7-bc60-98bdf6d5f2ce">练习</a>
<ul>
<li><a href="#h:5d4f9ad3-6983-4623-a816-706d264be7ba">实现Base64编码</a></li>
<li><a href="#h:c95638fb-42e0-4b10-99bc-1cc888ba58ca">实现一个cache装饰器，实现可过期被清除的功能</a>
<ul>
<li><a href="#h:f30606a9-8906-4291-952f-45573f9f82d1">代码实现</a></li>
<li><a href="#h:65774e9f-e0e4-4d45-874a-21ba6de5eb6d">多个装饰器</a></li>
<li><a href="#h:6128874b-cd3c-4d43-8daa-bb28ca9cbee5">过期功能实现</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:2c7e6f8d-b96f-484a-92c1-8cff7c375b64">装饰器的用途</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:b8dc3f3f-df4d-41f2-9381-934755f9bd88">Python 面向对象编程</a>
<ul>
<li><a href="#h:08dba916-9314-4083-acf5-ee71dcf4902e">语言的分类</a></li>
<li><a href="#h:05f37946-4196-4e54-a9e0-95dedcfc9010">面向对象</a></li>
<li><a href="#h:703b653c-a1e2-43a3-a6b3-b0580745d573">面向对象3要素</a>
<ul>
<li><a href="#h:0eec52a0-db06-49ca-ba66-b2d8e7a82cf2">1. 封装</a></li>
<li><a href="#h:6de35c0f-0b06-46e1-add4-0500f7a3db1f">2. 继承</a></li>
<li><a href="#h:67dc3e5c-6565-4119-b23d-8104124fa3b3">3. 多态</a></li>
</ul>
</li>
<li><a href="#h:4bb5e220-b773-4a12-8ddb-163ed2b994dc">封装</a>
<ul>
<li><a href="#h:7d09b3fe-2a43-43ef-b0a1-e6ec4ecd5883">Python类定义</a></li>
<li><a href="#h:77030670-1f78-4a8f-b37e-7180a00291c6">类及类属性</a></li>
<li><a href="#h:d8290bc9-1431-462a-aa7e-104b8b2def22">实例化</a>
<ul>
<li><a href="#h:532ef4a3-d633-433a-a67a-2acbbded6a98">构造的2个阶段</a></li>
<li><a href="#h:1d64b1ac-fff0-403c-b755-d91a56d60fce">__init__方法</a></li>
<li><a href="#h:0fe489d7-34f9-43c7-8b7a-3a051982391f">实例对象instance</a></li>
<li><a href="#h:dbb088de-045e-4e13-b1b8-dc24a94e9bd2">方法绑定</a></li>
<li><a href="#h:03bccf1c-0777-4dbc-8efb-f13d5e22c59b">self</a></li>
</ul>
</li>
<li><a href="#h:8f83255a-4761-45f5-ab21-c241b1009d44">实例变量和类变量</a></li>
<li><a href="#h:0eca4440-98eb-4d46-b441-4495af00f7ef">特殊属性</a></li>
<li><a href="#h:5bb97101-9833-4512-9cf1-2b1520fa50bd">属性的本质</a>
<ul>
<li>
<ul>
<li><a href="#h:98f5b989-5abd-41b0-aafc-28c8388fa6c5">总结</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:3f6d53bf-22ea-4a7c-b781-81b7ba62d05f">类方法和静态方法</a>
<ul>
<li><a href="#h:e4193cf2-3434-412e-8500-dd5f824dee0c">装饰一个类</a></li>
<li><a href="#h:c6e29535-7964-404a-9d3f-0a27e271d89c">普通方法</a></li>
<li><a href="#类方法">类方法</a></li>
<li><a href="#h:05c275cb-d6c4-458c-a252-9c2d34cc6c99">静态方法</a></li>
<li><a href="#h:2a5be35e-ff37-48ae-9c89-6812410d1efc">方法的调用</a></li>
</ul>
</li>
<li><a href="#h:dcc5d44b-cb57-48df-8b3d-615658ed1e0f">访问控制</a>
<ul>
<li><a href="#h:2942928f-1833-4c3a-87c0-75bd45a41c84">私有（Private）属性</a></li>
<li><a href="#h:74b8d693-58d0-4b86-9f92-647e198add20">私有成员</a></li>
<li><a href="#h:3df9a402-2857-4b54-a61c-06eaacb1c525">私有变量的本质</a></li>
<li><a href="#h:f95159e7-23fe-41e4-924b-7c02b6eb33b7">保护成员</a></li>
<li><a href="#h:7c34aa33-9dbe-49ae-a0fa-fa747b2e3730">访问控制的总结</a></li>
</ul>
</li>
<li><a href="#h:24a2b1d7-9078-4a36-a411-d76c6f713062">补丁</a></li>
<li><a href="#h:46d65227-d516-4146-ab98-9543859f2f84">属性装饰器</a></li>
<li><a href="#h:9be004ed-7bdb-42cd-85e5-567bd48af4a1">对象的销毁</a></li>
<li><a href="#h:37384441-358a-4dfb-89cf-2119580c3245">方法重载(overload)</a></li>
<li><a href="#h:a53285b7-0e5b-4427-bc19-a49e4597edfc">封装</a></li>
<li><a href="#h:0fcc5bb2-8ddf-442e-9a08-7e07e3471966">练习</a>
<ul>
<li><a href="#h:e35bd71c-86b2-4705-8754-5948c13fab24">随机整数生成类</a></li>
<li><a href="#h:435b1f42-045a-4bc3-b92d-145541964da1">打印坐标</a></li>
<li><a href="#h:374a54c6-1cf7-4205-a7a6-96eee828f7d4">车辆信息</a></li>
<li><a href="#h:35f15170-c987-4031-8050-2b04df554c99">实现温度的处理</a></li>
<li><a href="#h:ebd9e7ad-8c36-4c5a-92c5-d4d8a8d6b1f1">模拟购物车购物</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:5eca5e40-4778-4d21-bb0c-86131b389397">类的继承</a>
<ul>
<li><a href="#h:0d4f0780-2993-4973-b4f1-023c07e4f947">基本概念</a></li>
<li><a href="#h:2fca60e4-293e-4f21-87f3-85ced38cc11c">定义</a></li>
<li><a href="#h:e2ddf9d5-4607-4ed3-96d1-85045141073a">python不同版本的类</a></li>
<li><a href="#h:b2a1baae-4457-4cea-a770-bf04b7236ebf">继承中的访问控制</a></li>
<li><a href="#h:c713f83e-983e-49b3-bab2-2a7cb15cd5f5">方法的重写、覆盖override</a>
<ul>
<li><a href="#h:2d18cfb6-e2ac-43f3-843f-a031faa0a8cf">super()</a></li>
</ul>
</li>
<li><a href="#h:bf2618a2-32cd-4b87-80c7-873d551354a7">继承时使用初始化</a>
<ul>
<li><a href="#h:ace0f769-16ff-454f-ac96-36719252cd58">正确初始化</a></li>
</ul>
</li>
<li><a href="#h:fa1ec839-ae26-4a7d-a535-95f257e4e986">单继承</a></li>
<li><a href="#h:f34408cd-280f-4add-bcd7-8c11ea12ae24">多态</a></li>
</ul>
</li>
<li><a href="#h:db87431b-946e-4e2e-b867-ae70edf05e94">多继承</a>
<ul>
<li><a href="#h:44da41e4-6ea9-43e6-be76-816a41f7040f">多继承弊端</a></li>
<li><a href="#h:f49f5b53-0468-4735-a4a6-ae21a07cedef">Python多继承实现</a></li>
<li><a href="#h:5c05ad50-382b-4675-aeb4-774a359e6875">多继承的缺点</a></li>
<li><a href="#h:f41f1157-1a1b-4e4f-9009-58621648b1aa">Mixin</a>
<ul>
<li><a href="#h:1929d90e-fa7b-4544-a563-464803709c9e">Mixin类</a></li>
</ul>
</li>
<li><a href="#h:4cd7c1b5-466d-49f0-b767-ba06566a3cbc">练习</a>
<ul>
<li><a href="#h:e2312756-4426-47ec-87cf-0b132fb962ca">Shape基类</a></li>
<li><a href="#h:3119d7f8-6237-4492-897a-a4e8be02dc44">用面向对象实现LinkedList链表</a>
<ul>
<li><a href="#h:ce5024c3-9fe6-46c3-9116-84389fca1ad2">简单的单向链表</a></li>
<li><a href="#h:87861018-ebb6-42d2-a9b6-f95c7f905d11">简单的双向链表</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:6691fa78-a2a4-4bfd-b10a-e300cff28bd5">Python 异常处理与异常机制</a>
<ul>
<li><a href="#h:7334a11c-9e22-4d37-8f71-8c2ae3bb5511">错误和异常</a></li>
<li><a href="#h:1aeb293d-6a0e-4dc9-804c-634953251cce">产生异常</a></li>
<li><a href="#h:f4e55f1d-f417-4705-b8a5-8b9883857f57">异常的捕获</a>
<ul>
<li><a href="#h:a3232678-966d-4592-8d05-9b1dfd3aaa2e">捕获指定类型的异常</a></li>
</ul>
</li>
<li><a href="#h:7b869503-5bb1-44b3-91c9-aa1da6ec2aab">异常类及继承层次</a></li>
<li><a href="#h:dd991a27-a3eb-4d2f-bae2-69a6e7570b56">BaseException及子类</a>
<ul>
<li><a href="#h:38dc6de5-2107-4338-afaf-93c40d163a76">BasaException</a></li>
<li><a href="#h:bd428d38-14b8-4bce-ac5a-35848c0c4630">SystemExit</a></li>
<li><a href="#h:813de246-8c0e-45bb-9834-1b1aa7529c06">KeyboardInterrupt</a></li>
</ul>
</li>
<li><a href="#h:8c861f5b-bf58-4542-8493-873f77f6d7d8">Exception及子类</a></li>
<li><a href="#h:abdd5af4-3666-4178-84a2-931a00962664">多种捕获</a></li>
<li><a href="#h:8dbf33a8-1145-43b7-a8aa-30a3852bf6ba">as子句</a></li>
<li><a href="#h:85ea5910-ef6d-4695-a2eb-d61aeafb6681">finally子句</a></li>
<li><a href="#h:5301b344-b6a5-47f9-b528-6832a4f106ca">语句嵌套和捕获</a></li>
<li><a href="#h:41e861d6-8770-49bb-8ce3-385d2a76a2c4">else子句</a></li>
<li><a href="#h:261992ac-ee9f-41e0-a230-89a7b615b301">总结</a></li>
</ul>
</li>
<li><a href="#h:1f8a8d56-15fa-410e-95f8-ed27f7fe8fa3">argparse模块和PEP</a>
<ul>
<li><a href="#h:e9cf6749-29d2-4ce4-a79d-120aabcf3ac0">argparse 模块</a>
<ul>
<li><a href="#h:1ad6f38d-3fbe-4839-8eca-be155028a0be">参数分类</a></li>
<li><a href="#h:b58d9956-ba4c-42d9-b912-decb2712edec">基本解析</a></li>
<li><a href="#h:06f7d04c-51ce-4fd8-b19c-0103c7092ee7">解析器的参数</a></li>
<li><a href="#h:1c08ee4f-3aff-420d-81c0-47d7a3e213cb">位置参数解析</a>
<ul>
<li><a href="#h:f5e838fe-0394-4e8c-b054-e33a9d4b3cad">传参</a></li>
<li><a href="#h:1098f498-3980-4894-9bb1-e010a19d4fbd">非必须位置参数</a></li>
</ul>
</li>
<li><a href="#h:f18b8d2c-a195-4dee-a060-3247e7bf1a73">选项参数</a>
<ul>
<li><a href="#h:04f37fa8-95bc-433a-af58-3f385f28de45">-l 的实现</a></li>
<li><a href="#h:511ba43a-5396-41a8-9764-312b6144e42a">-a 的实现</a></li>
</ul>
</li>
<li><a href="#h:778a286c-f4b3-48ee-8470-fb28b84b0ea0">属性名称</a></li>
<li><a href="#h:4ad60119-7742-42a3-a9ff-5bdf0a474edb">练习，实现ls命令功能</a></li>
</ul>
</li>
<li><a href="#h:05e6856d-7237-485f-a969-26edf847627b">PEP</a></li>
</ul>
</li>
<li><a href="#h:c90d2ee7-bd7f-4a3c-abad-45704c8d5298">Python 面向对象高级编程</a>
<ul>
<li><a href="#h:2b3c3076-9d5d-48c7-a84d-076b360e814e">魔术方法</a>
<ul>
<li><a href="#h:71093268-d172-488e-b794-b90e12b622f6">查看属性__dir__()</a></li>
<li><a href="#h:70d1ed1f-7b4f-4301-953b-c19355400999">魔术方法分类</a></li>
<li><a href="#h:e20e8295-207a-457a-9eb9-e64359f66cf1">实例化 <code>__new__,__init__,__del__</code></a></li>
<li><a href="#h:c77ad9df-2ff5-4d30-a572-d3c66461ac49">可视化 <code>__str__,__repr__,__bytes__</code></a></li>
<li><a href="#h:73a84ffe-ba7f-4c92-9809-0cc3d545cde1">hash <code>__hash__</code></a></li>
<li><a href="#h:f9835ac4-09e7-484f-af10-910a7fff9d69">bool <code>__bool__</code></a></li>
<li><a href="#h:83758ac3-caa2-48a0-8dae-ee43ec535ea9">运算符重载</a>
<ul>
<li><a href="#h:7fe046f3-b68f-4862-b104-456fccb1c6e3">运算符重载应用场景</a></li>
<li><a href="#h:86e9e1e2-f2c2-496a-b517-11ba14241149">@functools.total_ordering 装饰器</a></li>
</ul>
</li>
<li><a href="#h:d1c6dd7c-9c01-4c92-aacd-ec90dcf29b2b">容器和大小 <code>__len__,__iter__,__contains__,__getitem__,__setitem__,__missing__</code></a>
<ul>
<li><a href="#h:b459ab85-5593-4c20-a234-a886825df94e">练习</a>
<ul>
<li><a href="#h:cd8ffd0b-16ac-44bb-95ad-3e616909c4e5">购物车</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:e322f45d-0e2d-46ce-bbb1-ec989c2a7798">可调用对象 <code>__call__</code></a>
<ul>
<li><a href="#h:2e6d2024-3965-4bf3-96a5-5e0656d2622e">练习</a>
<ul>
<li><a href="#h:315fc945-db8a-4c57-bfb1-21a3e8c3335b">斐波那契数列</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:bc01a1c5-761d-453f-9786-a2d60a9b8a81">上下文管理 <code>__enter__,__exit__</code></a>
<ul>
<li><a href="#h:96aaa5bf-d020-4b9d-bbb7-9aa7ca793a5b">上下文管理对象</a></li>
<li><a href="#h:aa3005ca-2894-4625-9796-842ed9610c1a">上下文管理的安全性</a></li>
<li><a href="#h:ef4fdd9f-5ed1-43ef-86ec-c72841412441">with语句</a></li>
<li><a href="#h:8abc83a4-0e02-49dc-80e7-3bb86058b8a0">方法的参数</a></li>
<li><a href="#h:555884c8-e4de-4caa-b4ea-aee6e709023f">练习</a></li>
<li><a href="#h:acd886fc-46b0-4736-b8d8-5c84ac20bb1b">上下文应用场景</a></li>
<li><a href="#h:01c08cd7-2455-42b2-8d05-32657e66015b">contextlib.contexmangager</a></li>
</ul>
</li>
<li><a href="#h:ff203385-1da7-4098-8da6-36430273b00b">反射</a>
<ul>
<li><a href="#h:26c87685-f43f-4a4f-8f4d-0056d147e807">概述</a></li>
<li><a href="#h:89f56900-67df-4962-9ece-e1d0359adaff">反射相关的函数和方法</a></li>
<li><a href="#h:56726efd-cd04-4468-af2b-709d0b8ced3a">反射相关的魔术方法 <code>__getattr__(),__setattr__(),__delatrr__()</code></a>
<ul>
<li><a href="#h:334b61b5-847d-4603-a913-3573cec39d84">__getattr__()</a></li>
<li><a href="#h:b1451d06-028d-4c87-aad5-22d1454f4d38">__setattrr__()</a></li>
<li><a href="#h:1f1e39de-b8ac-49eb-ae49-026eb3251a71">__delattr__()</a></li>
<li><a href="#h:c55185a9-49ed-47e9-94b0-52508ab613ee">__getattribute__()</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:e39f5ecc-4ea9-4231-83a1-b7e80d9c36cd">描述器 <code>__get__(),__set__(),__delete__()</code></a>
<ul>
<li><a href="#h:10ef9aa7-2f8e-45cf-b5c7-d7210f719040">描述器的表现</a></li>
<li><a href="#h:3603593d-39e4-4b4b-b4f6-6eb682786b90">描述器定义</a></li>
<li><a href="#h:38ba896a-037d-4f10-b4c2-0570b69f9db7">属性的访问顺序</a>
<ul>
<li><a href="#h:022a55fe-771e-4998-b23d-56157bfd497b"><code>__set__ ,__set_name__</code></a></li>
<li><a href="#h:160dcb11-0e39-4ea4-ada2-2879c1666404">属性的访问顺序</a></li>
</ul>
</li>
<li><a href="#h:3a62ed3b-845a-43a0-90ef-1cc19943454b">Python的描述器</a></li>
<li><a href="#h:a1bd970e-96c7-4b8c-ba39-7bdd0190e8b9">练习</a>
<ul>
<li><a href="#h:c2d8281a-7e46-4170-a0ac-dc373158b4f3">实现StaticMethod装饰器</a></li>
<li><a href="#h:7e82ced2-0a78-4077-a10e-7a1d39896b22">实现ClassMethod装饰器</a></li>
<li><a href="#h:885f330b-caca-408a-9619-053911065266">对实例的数据进行校验</a></li>
<li><a href="#h:31ae878c-d759-409c-8547-3cf1a9dd9af5">将前面的链表，封装成容器</a></li>
<li><a href="#h:1130a306-08c8-4691-b08d-433437353bcf">进阶</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:0ed19208-d8b0-47d2-9edc-90d9db698598">其他杂项</a>
<ul>
<li><a href="#h:84860742-4f8e-43de-99bb-ab08377397c7">trancemalloc</a></li>
<li><a href="#h:75e9d916-d017-4ed6-ada8-1af9f56ff467"><code>__slots__</code></a>
<ul>
<li><a href="#h:1056c072-9cd1-415f-a1b6-1d9030e276f1">问题的引出</a></li>
<li><a href="#h:8074fe44-b418-4d7b-bd61-792240bf1223">继承</a></li>
<li><a href="#h:0662bdda-b814-4c76-b9ae-ff6bf2f405f3">应用场景</a></li>
</ul>
</li>
<li><a href="#h:fc92e7b5-32bb-4763-88b5-30f5fba243b2">未实现和未实现异常</a></li>
<li><a href="#h:e2bdc36d-000d-405e-a52d-d9e88b2469f6">运算符重载中的反向方法</a></li>
<li><a href="#h:b27313b1-ac9e-46de-9e57-c3903bd4450f">Python的对象模型</a></li>
<li><a href="#h:104755fe-e731-44b6-b90b-6b433eedd8de">可迭代对象</a>
<ul>
<li><a href="#h:6b71f3a1-1c24-4325-afcd-f651b5a00eaf">可迭代对象</a></li>
<li><a href="#h:c2ed93a6-10e7-44ae-8348-30c83e744df4">迭代器</a></li>
<li><a href="#h:754862ad-a2e0-4bf3-9d28-b8b68e2f18c6">生成器</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:88a61f4d-58f1-4e33-ad9a-28254bd3bd8e">模块化</a>
<ul>
<li><a href="#h:2bbc6afb-569a-454b-8347-d277a2186dc8">导入语句</a></li>
<li><a href="#h:e5c97c14-1009-4635-8028-4068662a918a">自定义模块</a>
<ul>
<li><a href="#h:cb6691a1-3002-4016-9e81-1c146a98b752">自定义模块命名规范</a></li>
</ul>
</li>
<li><a href="#h:40e867da-e4ce-4786-9953-882b3bb3d137">模块搜索顺序</a></li>
<li><a href="#h:688f9b81-8c64-45ac-882c-e3e8b44b984b">模块重复导入</a></li>
<li><a href="#h:6e4f5279-7b6d-4cf3-b41b-15260eead8e6">模块运行</a>
<ul>
<li><a href="#h:d3053eba-abdf-4c64-934d-89d2dfa61b52"><code>if__name__ == '__main__'</code></a></li>
<li><a href="#h:a0fc17c2-2bff-4c02-bcdb-e27cf1d45f4b">模块的属性</a></li>
</ul>
</li>
<li><a href="#h:da3188cf-05ea-4352-bcc2-1b5f8f7639c5">包</a></li>
<li><a href="#h:78c868db-49dc-4c7f-8981-3457f1c96f51">子模块</a></li>
<li><a href="#h:7cfb8e82-b2f2-427e-80e3-677395cde4c0">模块和包的总结</a></li>
<li><a href="#h:3b8c8bcf-b813-46b1-8acd-1c5ddf61037f">绝对导入、相对导入</a>
<ul>
<li><a href="#h:3bbc17a6-5b66-47cd-ae83-88445865503f">绝对导入</a></li>
<li><a href="#h:b5aecfc3-b485-4a54-a323-48cc13dfaac9">相对导入</a></li>
</ul>
</li>
<li><a href="#h:7bbecdf9-1202-485f-86de-c67ea4312a60">访问控制</a>
<ul>
<li><a href="#h:084ca37c-0c5f-492d-a8fd-de66be8fb0e6">下划线开头的模块名</a></li>
<li><a href="#h:94f46f03-0cd0-4968-851d-9c46dc64988c">模块内的标识符</a></li>
<li><a href="#h:eab188a5-81c9-46d6-8f5e-455fe16c422c">from &#x2026; import * 和__all__</a>
<ul>
<li><a href="#h:e02cdcad-299e-485d-8785-beb39ecb858a">使用from &#x2026; import * 导入</a></li>
<li><a href="#h:e6dea20b-a3dc-402c-8f9f-33c2bf2ebc0e">使用__all__</a></li>
<li><a href="#h:08266993-525e-4ac3-a643-97a0de8cd480">包和子模块</a></li>
<li><a href="#h:97d442d6-7264-4d23-813d-49dce4abfa78">总结</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:dc8c6d86-48d3-42c8-af76-70c81c93e517">模块变量的修改</a></li>
</ul>
</li>
<li><a href="#h:1c491242-2c08-4776-8414-b224610d9db8">包管理</a>
<ul>
<li><a href="#h:a4ca33a7-9443-41d8-9125-73664b46fe9e">为什么使用包管理</a></li>
<li><a href="#h:4c8199e6-ec36-4605-ae09-5cd4968c1240">主要工具</a>
<ul>
<li><a href="#h:4ed3fc8b-4d0f-4651-b02c-3faba8b15db3">distutils</a></li>
<li><a href="#h:3e64046a-302e-413c-819f-1a665f5e5edb">setuptools</a></li>
<li><a href="#h:1bd56ba0-d7ad-438c-a884-c2e489b7debc">pip</a></li>
<li><a href="#h:5fa10588-55f4-4ce0-84a5-5fcc785cd83f">wheel</a></li>
</ul>
</li>
<li><a href="#h:9a994bf4-1455-408f-af3e-ed2ceb02db01">包制作</a>
<ul>
<li><a href="#h:b187cfea-0416-4c83-912f-a070ddabe53b">准备构建包的文件</a></li>
<li><a href="#h:7698e381-4f41-4a77-b3c8-3a8a63e61f62">构建包</a></li>
<li><a href="#h:bca1f2a1-6979-45ad-a8da-6c70ba5eb4c5">上传模块包到PyPI</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:af741a18-83f7-4979-9ef6-228ab9514815">logging日志处理模块</a>
<ul>
<li><a href="#h:1bfa5848-e65d-4312-94da-6fdedc9a6bee">日志级别</a></li>
<li><a href="#h:39311dac-1eeb-42e7-8755-1f47c6da56d8">格式字符串</a></li>
<li><a href="#h:9c7a8f26-522c-4058-a167-d15e2b1e2b22">范例</a>
<ul>
<li><a href="#h:eef7dbb9-6683-47bd-a5db-1b55ae7a4a52">默认级别</a></li>
<li><a href="#h:cf11fa63-6c84-4f00-8043-412a5e2f792e">构建消息</a></li>
<li><a href="#h:0834cf7b-0a4b-4124-ab4e-261c98e91c59">修改日期格式</a></li>
<li><a href="#h:670b26a3-e02a-4dcd-bc2e-8c0df917ca1c">输出到文件</a></li>
</ul>
</li>
<li><a href="#h:3e268c43-4e6e-4e20-a1f7-d07862da81ba">Logger类</a>
<ul>
<li><a href="#h:39cb67b6-1155-44be-8f31-4d0609d4e34d">构造</a></li>
<li><a href="#h:ffa05895-bb5b-4068-9d17-fc3843cf5a36">层次结构</a></li>
<li><a href="#h:11b3867b-825e-4362-a8b4-6360ad67b805">Level级别设置</a></li>
<li><a href="#h:23bebbc7-9ead-4e8b-8cd9-fa007c70ce9c">Handler</a></li>
<li><a href="#h:adff2bd6-1da3-43a5-8659-d3f3f76efb4f">日志流</a>
<ul>
<li><a href="#h:7acdd2dd-b4cf-4046-a687-76ee5450b914">Level的继承</a></li>
<li><a href="#h:74416125-7886-4435-9b65-6bdabb9e5915">继承关系及信息传递</a></li>
</ul>
</li>
<li><a href="#h:9e543d77-87bd-4213-8fc0-9d76b7aa8394">Formatter</a></li>
<li><a href="#h:e6fd47e5-dbbb-4cfa-bb33-3a321d5bccf6">Filter</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:e2969671-8caf-4573-82df-b370d416d835">debuuger</a></li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="./index.html">Python</a></li>
</ul>
<section id="outline-container-h:45e38fa6-5b82-4bc8-a093-4ffda2155162" class="outline-2">
<h2 id="h:45e38fa6-5b82-4bc8-a093-4ffda2155162">Python 面向过程编程</h2>
<div class="outline-text-2" id="text-h:45e38fa6-5b82-4bc8-a093-4ffda2155162">
<p>
主要内容：
</p>
<ul class="org-ul">
<li>函数基本概念、形参、实参</li>
<li>函数的位置参数、关键字参数、参数默认值</li>
<li>函数的可变位置参数、可变关键字参数、Keyword-only 参数</li>
<li>函数的位置传参、关键字传参、参数结构</li>
<li>函数的 Return 语句及返回值</li>
<li>嵌套函数、函数作用域、global、闭包、nonlocal</li>
<li>参数缺省值的常见问题解决办法和__defaults__</li>
<li>LEGB原理</li>
<li>函数执行流程和函数调用原理</li>
<li>递归函数概念和递归性能分析</li>
<li>匿名函数 Lambda 表达式概念及应用</li>
<li>生成器对象和生成器函数及 yield from</li>
<li>高阶函数概念和内建高阶函数应用</li>
<li>函数柯里化、无参装饰器、带参装饰器</li>
<li>装饰器的副作用及解决方法</li>
<li>Python 的参数注解和 Inspect 模块应用</li>
<li>Python 内置全局函数使用</li>
<li>Functools 模块重要函数解析</li>
</ul>
</div>
<div id="outline-container-h:a963e76e-0efb-497e-a562-88711aeb16fb" class="outline-3">
<h3 id="h:a963e76e-0efb-497e-a562-88711aeb16fb">Python函数</h3>
<div class="outline-text-3" id="text-h:a963e76e-0efb-497e-a562-88711aeb16fb">
</div>
<div id="outline-container-h:86b3a390-c9c0-4fab-ba81-587b070bb58d" class="outline-4">
<h4 id="h:86b3a390-c9c0-4fab-ba81-587b070bb58d">函数</h4>
<div class="outline-text-4" id="text-h:86b3a390-c9c0-4fab-ba81-587b070bb58d">
<p>
数学定义
</p>
<ul class="org-ul">
<li>y=f(x) ，y是x的函数，x是自变量。y=f(x0, x1, &#x2026;, xn)</li>
</ul>

<p>
Python函数
</p>
<ul class="org-ul">
<li>由若干语句组成的语句块、函数名称、参数列表构成，它是组织代码的最小单元</li>
<li>完成一定的功能</li>
</ul>

<p>
函数的作用
</p>
<ul class="org-ul">
<li>结构化编程对代码的最基本的 <b>封装</b> ，一般按照功能组织一段代码</li>
<li>封装的目的为了 <b>复用</b> ，减少冗余代码</li>
<li>代码更加简洁美观、可读易懂</li>
</ul>

<p>
函数的分类
</p>
<ul class="org-ul">
<li>内建函数，如max()、reversed()等</li>
<li>库函数，如math.ceil()等</li>
<li>自定义函数，使用def关键字定义</li>
</ul>
</div>
</div>
<div id="outline-container-h:67cac823-ffbc-459b-86e8-e0db11990eba" class="outline-4">
<h4 id="h:67cac823-ffbc-459b-86e8-e0db11990eba">函数定义</h4>
<div class="outline-text-4" id="text-h:67cac823-ffbc-459b-86e8-e0db11990eba">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">&#20989;&#25968;&#21517;</span>(&#21442;&#25968;&#21015;&#34920;):
    &#20989;&#25968;&#20307;&#65288;&#20195;&#30721;&#22359;&#65289;
    [<span style="color: #a020f0;">return</span> &#36820;&#22238;&#20540;]
</pre>
</div>

<ul class="org-ul">
<li>函数名就是标识符，命名要求一样</li>
<li>语句块必须缩进，约定4个空格</li>
<li>Python的函数若没有return语句，会隐式返回一个None值</li>
<li>定义中的参数列表称为 <b>形式参数</b> ，只是一种符号表达（标识符），简称 <code>形参</code></li>
</ul>
</div>
</div>
<div id="outline-container-h:d265d02b-bbaf-4d4b-b357-056f87bda9d5" class="outline-4">
<h4 id="h:d265d02b-bbaf-4d4b-b357-056f87bda9d5">函数调用</h4>
<div class="outline-text-4" id="text-h:d265d02b-bbaf-4d4b-b357-056f87bda9d5">
<ul class="org-ul">
<li>函数定义，只是声明了一个函数，它不能被执行，需要调用执行</li>
<li>调用的方式，就是 <b>函数名后加上小括号</b> ，如有必要在括号内填写上参数</li>
<li>调用时写的参数是 <b>实际参数</b> ，是实实在在传入的值，简称 <code>实参</code></li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20989;&#25968;&#23450;&#20041;&#65292;&#35299;&#26512;&#22120;&#25195;&#36807;&#36825;&#27573;&#20195;&#30721;&#21518;&#65292;&#20250;&#31435;&#21363;&#29983;&#25104;&#19968;&#20010;&#20989;&#25968;&#23545;&#35937;&#65292;&#22312;&#20869;&#23384;&#22534;&#20013;&#65292;&#29992;&#26631;&#35782;&#31526;add&#25351;&#20195;
</span>    <span style="color: #a0522d;">result</span> = x + y <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20989;&#25968;&#20307;
</span>    <span style="color: #a020f0;">return</span> result <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#20540;
</span>
<span style="color: #a0522d;">out</span> = add(4,5) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20989;&#25968;&#35843;&#29992;&#65292;&#21487;&#33021;&#26377;&#36820;&#22238;&#20540;&#65292;&#20351;&#29992;&#21464;&#37327;&#25509;&#25910;&#36825;&#20010;&#36820;&#22238;&#20540;
</span><span style="color: #483d8b;">print</span>(out) <span style="color: #b22222;"># </span><span style="color: #b22222;">print&#20989;&#25968;&#21152;&#19978;&#25324;&#21495;&#20063;&#26159;&#35843;&#29992;
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">callable</span>(add), callabel(a))
<span style="color: #b22222;"># </span><span style="color: #b22222;">True, False</span>
</pre>
</div>

<p>
上面代码解释：
</p>
<ul class="org-ul">
<li>定义一个函数add，及函数名是add，能接受2个形式参数</li>
<li>该函数计算的结果，通过返回值返回，需要return语句</li>
<li>调用时，通过函数名add后加2个实际参数，返回值可使用变量接收</li>
<li><code>函数名也是标识符</code></li>
<li><code>返回值也是值</code></li>
<li>定义需要在调用前，也就是说调用时，已经被定义过了，否则抛NameError异常</li>
<li>函数是 <b>可调用的对象</b> ，callable(add)返回True</li>
</ul>

<p>
看看这个函数是不是通用的？体会一下Python函数的好处
</p>

<ul class="org-ul">
<li>所有灵活性，是有代价的，双刃剑</li>
<li>python 简单，所以类型错误问题。形参和返回值都不要写明类型</li>
<li>python很多问题，都会在运行中显现出来，为时已晚</li>
</ul>
</div>
</div>
<div id="outline-container-h:bf3b5c31-469c-4ea3-82eb-88863fa96965" class="outline-4">
<h4 id="h:bf3b5c31-469c-4ea3-82eb-88863fa96965">函数参数</h4>
<div class="outline-text-4" id="text-h:bf3b5c31-469c-4ea3-82eb-88863fa96965">
<p>
函数在定义时要定义好形式参数，调用时也提供足够的实际参数，一般来说，形参和实参个数要一致（可变参数除外）。
</p>
</div>
<div id="outline-container-h:9411fe31-a09b-401b-ba8c-32664d4e5be9" class="outline-5">
<h5 id="h:9411fe31-a09b-401b-ba8c-32664d4e5be9">实参传参方式</h5>
<div class="outline-text-5" id="text-h:9411fe31-a09b-401b-ba8c-32664d4e5be9">
<p>
1、位置传参
</p>

<p>
定义时def f(x, y, z)， 调用使用 f(1, 3, 5)，按照参数定义顺序传入实参
</p>

<p>
2、关键字传参
</p>

<p>
定义时def f(x, y, z)，调用使用 f(x=1, y=3, z=5)，使用形参的名字来传入实参的方式，如果使用了形参名字，那么 <b>传参顺序就可和定义顺序不同</b>
</p>

<p>
<b>要求位置参数必须在关键字参数之前</b> 传入，位置参数是按位置对应的
</p>

<p>
范例
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#20256;&#21442;&#65292;&#35843;&#29992;&#26102;&#65292;&#20256;&#20837;&#23454;&#38469;&#21442;&#25968;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20256;&#21442; &#23601;2&#31181;&#26041;&#24335;&#65306;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1. &#20301;&#32622;&#20256;&#21442;&#65292;&#21644;&#24418;&#21442;&#20381;&#27425;&#23545;&#24212;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">2. &#20851;&#38190;&#23383;&#20256;&#21442;&#65292;&#25353;&#29031;&#21442;&#25968;&#21517;&#31216;&#23545;&#24212;&#65292;&#19982;&#39034;&#24207;&#26080;&#20851;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#20004;&#31181;&#21487;&#20197;&#28151;&#21512;&#20351;&#29992;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20301;&#32622;&#20256;&#21442;&#65292;&#19981;&#33021;&#36319;&#22312; &#20851;&#38190;&#23383;&#20256;&#21442;&#20043;&#21518;
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
   <span style="color: #483d8b;">print</span>(x,y)
   <span style="color: #a020f0;">return</span> x + y

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35843;&#29992;&#26102;&#65292;&#20256;&#21442;&#65292;&#20256;&#20837;&#23454;&#21442;&#30340;&#31616;&#31216;
</span><span style="color: #a0522d;">result</span> = add(4, 5) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#20256;&#21442;
</span><span style="color: #483d8b;">print</span>(result)
<span style="color: #b22222;">#</span><span style="color: #b22222;">4 5
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">9
</span>
add(x=4, y=5) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20851;&#38190;&#23383;&#20256;&#21442;keyword&#65292;&#25353;&#21442;&#25968;&#21517;&#31216;&#23545;&#24212;&#65292;&#19982;&#39034;&#24207;&#26080;&#20851;
</span>
add(4, y=5) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#30830;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add(x=[4], y=(5,))
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add(y=5, 4) # &#38169;&#35823;&#20256;&#21442;&#12290;&#20301;&#32622;&#20256;&#21442;&#65292;&#19981;&#33021;&#36319;&#22312;&#20851;&#38190;&#23383;&#20043;&#21518;
</span>
<span style="color: #483d8b;">print</span>(add) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25226;&#36825;&#20010;&#26631;&#35782;&#31526;&#23545;&#24212;&#30340;&#23545;&#35937;&#30340;&#23383;&#31526;&#20018;&#34920;&#36798;&#24418;&#24335;&#32473;&#20154;&#30475;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(add), <span style="color: #483d8b;">hex</span>(<span style="color: #483d8b;">id</span>(add)))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;function add at 0x000002AE0CFA6280&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2946565300864 0x2ae0cfa6280
</span>
<span style="color: #a0522d;">d</span> = <span style="color: #483d8b;">dict</span>({<span style="color: #8b2252;">'a'</span>:1}, b=2, a=3) <span style="color: #b22222;"># </span><span style="color: #b22222;">dict &#20013;&#21442;&#25968;&#25353;&#20301;&#32622;&#20256;&#21442;&#12289;&#25353;&#20851;&#38190;&#23383;&#20256;&#21442;
</span><span style="color: #483d8b;">print</span>(d)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: {'a': 3, 'b': 2}</span>
</pre>
</div>

<p>
切记：传参指的是调用时传入实参，就2种方式。
</p>

<p>
下面讲的都是形参定义。
</p>
</div>
</div>
<div id="outline-container-h:86d25d1b-7128-428f-94d6-d08a50a57a2c" class="outline-5">
<h5 id="h:86d25d1b-7128-428f-94d6-d08a50a57a2c">形参缺省值</h5>
<div class="outline-text-5" id="text-h:86d25d1b-7128-428f-94d6-d08a50a57a2c">
<p>
缺省值也称为默认值，可以在函数定义时，为形参增加一个缺省值。其作用：
</p>
<ul class="org-ul">
<li>参数的默认值可以在未传入足够的实参的时候，对没有给定的参数赋值为默认值</li>
<li>参数非常多的时候，并不需要用户每次都输入所有的参数，简化函数调用</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5):
    <span style="color: #a020f0;">return</span> x+y

&#27979;&#35797;&#35843;&#29992; add()&#12289;add(x=5)&#12289;add(y=7)&#12289;add(6, 10)&#12289;add(6, y=7)&#12289;add(x=5, y=6)&#12289;add(y=5, x=6)&#12289;
<span style="color: #b22222;">#</span><span style="color: #b22222;">add(x=5, 6)&#12289;add(11, x=20) &#19981;&#33021;&#22810;&#37325;&#36171;&#20540;&#12289;add(y=8, 4) &#20256;&#21442;&#26102;&#32570;&#30465;&#20540;&#22312;&#21518;&#38754;
</span>
&#33021;&#21542;&#36825;&#26679;&#23450;&#20041; <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y=5) &#25110; <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4,y) &#65311; <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y) &#25253;&#38169;&#65292;&#32570;&#30465;&#20540;&#22312;&#21518;&#38754;
</pre>
</div>

<p>
范例：登录函数
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#23450;&#20041;&#19968;&#20010;&#20989;&#25968;login&#65292;&#21442;&#25968;&#21517;&#31216;&#20026;host&#12289;port&#12289;username&#12289;password
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">login</span>(host=<span style="color: #8b2252;">'localhost'</span>, port=3306, username=<span style="color: #8b2252;">'root'</span>, password=<span style="color: #8b2252;">'root'</span>):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'mysql://{2}:{3}@{0}:{1}/'</span>.<span style="color: #483d8b;">format</span>(host, port, username, password))

login()
login(<span style="color: #8b2252;">'127.0.0.1'</span>)
login(<span style="color: #8b2252;">'127.0.0.1'</span>, 3361, <span style="color: #8b2252;">'wayne'</span>, <span style="color: #8b2252;">'wayne'</span>)
login(<span style="color: #8b2252;">'127.0.0.1'</span>, username=<span style="color: #8b2252;">'wayne'</span>)
login(username=<span style="color: #8b2252;">'wayne'</span>, password=<span style="color: #8b2252;">'wayne'</span>, host=<span style="color: #8b2252;">'www.xxx.com'</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c51c41fe-83a2-49b9-a1b5-c6b0e8edd0b1" class="outline-5">
<h5 id="h:c51c41fe-83a2-49b9-a1b5-c6b0e8edd0b1">可变参数</h5>
<div class="outline-text-5" id="text-h:c51c41fe-83a2-49b9-a1b5-c6b0e8edd0b1">
<p>
需求：写一个函数，可以对多个数累加求和
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">sum</span>(iterable):
    <span style="color: #a0522d;">s</span> = 0
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> iterable:
        <span style="color: #a0522d;">s</span> += x
    <span style="color: #a020f0;">return</span> s

<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">sum</span>([1,3,5]))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">sum</span>(<span style="color: #483d8b;">range</span>(4)))
</pre>
</div>

<p>
上例，传入可迭代对象，并累加每一个元素。
</p>

<p>
也可以使用可变参数完成上面的函数。
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn1</span>(*nums): <span style="color: #b22222;"># </span><span style="color: #b22222;">* &#21487;&#21464;&#24418;&#21442;&#65292;&#21487;&#20197;&#25910;&#22810;&#20010;&#23454;&#21442;&#65292;&#22810;&#20010;&#23454;&#21442;&#34987;&#25910;&#38598;&#21040;&#19968;&#20010;&#20803;&#32452;&#23545;&#35937;&#20013;&#65292;&#20803;&#32452;&#19981;&#21487;&#21464;
</span>    <span style="color: #483d8b;">print</span>(nums, <span style="color: #483d8b;">type</span>(nums))
    <span style="color: #a0522d;">s</span> = 0
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> nums:
        <span style="color: #a0522d;">s</span> += x
    <span style="color: #a020f0;">return</span> s

fn1(1,2,3) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25353;&#29031;&#20301;&#32622;&#20256;&#21442;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: (1, 2, 3) &lt;class 'tuple'&gt;
</span>fn1()
<span style="color: #b22222;">#</span><span style="color: #b22222;">: () &lt;class 'tuple'&gt;</span>
</pre>
</div>

<p>
1、可变位置参数
</p>
<ul class="org-ul">
<li>在形参前使用 * 表示该形参是可变位置参数，可以接受多个实参</li>
<li>它将收集来的实参组织到一个tuple中</li>
</ul>

<p>
2、可变关键字参数
</p>
<ul class="org-ul">
<li>在形参前使用 ** 表示该形参是可变关键字参数，可以接受多个关键字参数</li>
<li>它将收集来的实参的名称和值，组织到一个dict中</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showconfig</span>(**kwargs): <span style="color: #b22222;"># </span><span style="color: #b22222;">*args **kwargs
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(kwargs), kwargs) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#21464;&#20851;&#38190;&#23383;&#21442;&#25968;&#25910;&#38598;&#20851;&#38190;&#23383;&#20256;&#21442;&#65292;&#25910;&#38598;&#25104;&#23383;&#20856; kv&#65292;&#23383;&#20856;&#21487;&#21464;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20869;&#37096;&#65292;&#20320;&#33021;&#20256;&#20837;&#21464;&#37327;&#21517;&#25105;&#20204;&#26377;&#35201;&#27714;&#65292;&#23545;kwargs&#22788;&#29702;&#65292;'username' in kwargs.keys()\pop(key)
</span>    <span style="color: #a020f0;">for</span> k,v <span style="color: #a020f0;">in</span> kwargs.items():
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{}={}'</span>.<span style="color: #483d8b;">format</span>(k,v), end=<span style="color: #8b2252;">', '</span>)

showconfig()
<span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'dict'&gt; {}
</span>
showconfig(host=<span style="color: #8b2252;">'127.0.0.1'</span>, port=8080, username=<span style="color: #8b2252;">'wayne'</span>, password=<span style="color: #8b2252;">'xxx'</span>)
</pre>
</div>

<p>
混合使用
</p>

<div class="org-src-container">
<pre class="src src-python">&#21487;&#20197;&#23450;&#20041;&#20026;&#19979;&#21015;&#26041;&#24335;&#21527;&#65311;
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showconfig</span>(username, password, *args) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#25509;&#21463;&#21487;&#21464;&#20301;&#32622;&#21442;&#25968;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showconfig</span>(username, password, **kwargs) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#25509;&#21463;&#21487;&#21464;&#20851;&#38190;&#23383;&#21442;&#25968;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showconfig</span>(username, *args, **kwargs) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20301;&#32622;&#20256;&#21442;&#34987;args&#21344;&#29992;&#65292;&#20851;&#38190;&#23383;&#20256;&#21442;&#34987;kwargs&#21344;&#29992;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showconfig</span>(username, password, **kwargs, *args) <span style="color: #b22222;"># </span><span style="color: #b22222;">? &#25253;&#38169;&#65292;*args&#22312;&#21069;&#38754;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showconfig</span>(*args, **kwargs) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25509;&#25910;&#25152;&#26377;&#21442;&#25968;</span>
</pre>
</div>

<p>
总结：
</p>
<ul class="org-ul">
<li>有可变位置参数和可变关键字参数</li>
<li>可变位置参数在形参前使用一个星号*</li>
<li>可变关键字参数在形参前使用两个星号**</li>
<li>可变位置参数和可变关键字参数都可以收集若干个实参，可变位置参数收集形成一个tuple，可变</li>
<li>关键字参数收集形成一个dict</li>
<li>混合使用参数的时候，普通参数需要放到参数列表前面，可变参数要放到参数列表的后面，可变位置参数需要在可变关键字参数之前</li>
</ul>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(x, y, *args, **kwargs):
    <span style="color: #b22222;">#</span><span style="color: #b22222;">print(x, y, args, kwargs, sep='\n', end='\n\n')
</span>    <span style="color: #483d8b;">print</span>(x, y, args, kwargs)

<span style="color: #b22222;"># </span><span style="color: #b22222;">fn() fn(range(5)) &#19981;&#33021;&#65292;range(5) &#34920;&#31034;&#19968;&#20010;&#23545;&#35937;
</span>fn(1,2), fn(1,2,3), fn(1,2,3,4), fn(1, 2, a=100)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 2 () {}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 2 (3,) {}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 2 (3, 4) {}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 2 () {'a': 100}
</span>
fn(3, 5, 7, 9, 10, a=1, b=<span style="color: #8b2252;">'abc'</span>)
fn(y=5, a=5, x=4)
fn(3, 5, a=1, b=<span style="color: #8b2252;">'abc'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">fn(x=3, y=8, 7, 9, a=1, b='abc') # ? &#25253;&#38169;&#65292; &#20301;&#32622;&#20256;&#21442;&#20889;&#22312;&#20851;&#38190;&#23383;&#20043;&#21069;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">fn(7, 9, y=5, x=3, a=1, b='abc') # ? &#25668;&#25253;&#38169;&#65292;&#37325;&#22797;&#20256;&#21442;</span>
</pre>
</div>

<p>
fn(x=3, y=8, 7, 9, a=1, b='abc')，错在位置传参必须在关键字传参之前
</p>

<p>
fn(7, 9, y=5, x=3, a=1, b='abc')，错在7和9已经按照位置传参了，x=3、y=5有重复传参了
</p>
</div>
</div>
<div id="outline-container-h:f7a6566b-96ac-4e22-9cc0-3d991601e1a7" class="outline-5">
<h5 id="h:f7a6566b-96ac-4e22-9cc0-3d991601e1a7">keyword-only参数</h5>
<div class="outline-text-5" id="text-h:f7a6566b-96ac-4e22-9cc0-3d991601e1a7">
<p>
先看一段代码
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">keyword-only &#20165;&#20165;&#33021;&#20851;&#38190;&#23383;&#20256;&#21442;&#30340;&#24418;&#21442;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312; * &#21495;&#21518;&#30340;&#21442;&#25968;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(*args, x, y, **kwargs): 
    <span style="color: #483d8b;">print</span>(x, y, args, kwargs, sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>, end=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n\n</span><span style="color: #8b2252;">'</span>)

fn(3, 5) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25253;&#38169;
</span>fn(3, 5, 7) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25253;&#38169;
</span>fn(3, 5, a=1, b=<span style="color: #8b2252;">'abc'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25253;&#38169;
</span>fn(3, 5, y=6, x=7, a=1, b=<span style="color: #8b2252;">'abc'</span>)
</pre>
</div>

<p>
在Python3之后，新增了keyword-only参数。
</p>

<p>
keyword-only参数：在形参定义时，在一个*星号之后，或一个可变位置参数之后，出现的普通参数，就已经不是普通的参数了，称为keyword-only参数。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(*args, x):
    <span style="color: #483d8b;">print</span>(x, args, sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>, end=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n\n</span><span style="color: #8b2252;">'</span>)

fn(3, 5) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25253;&#38169;, 3 5 &#37117;&#20256;&#32473;args&#65292; x y &#27809;&#26377;&#20256;&#21442;
</span>fn(3, 5, 7) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25253;&#38169;
</span>fn(3, 5, x=7)
</pre>
</div>

<p>
keyword-only参数，言下之意就是这个参数必须采用关键字传参。
</p>

<p>
可以认为，上例中，args可变位置参数已经截获了所有位置参数，其后的变量x不可能通过位置传参传入了。
</p>

<p>
思考：def fn(**kwargs, x) 可以吗？ 不可以，直接语法错误
</p>

<div class="org-src-container">
<pre class="src src-pytohn">def fn(**kwargs, x):
    print(x, kwargs, sep='\n', end='\n\n')
</pre>
</div>

<p>
可以认为，kwargs会截获所有关键字传参，就算写了x=5，x也没有机会得到这个值，所以这种语法不存在。
</p>

<p>
keyword-only参数另一种形式
</p>

<p>
'*' 星号后所有的普通参数都成了keyword-only参数。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(*, x, y):
    <span style="color: #483d8b;">print</span>(x, y)
fn(x=6, y=7)
fn(y=8, x=9)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn2</span>(a, *, x, y):
    <span style="color: #483d8b;">print</span>(a, x, y)
fn2(1, y=2, x=3)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 6 7
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 9 8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 3 2</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:1b00f1ef-e235-4339-a1f8-84f704a81632" class="outline-5">
<h5 id="h:1b00f1ef-e235-4339-a1f8-84f704a81632">Positional-only参数</h5>
<div class="outline-text-5" id="text-h:1b00f1ef-e235-4339-a1f8-84f704a81632">
<p>
Python 3.8 开始，增加了最后一种形参类型的定义：Positional-only参数。（2019年10月发布3.8.0）
</p>

<p>
/ 之前接收位置传参。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(a, /):
    <span style="color: #483d8b;">print</span>(a, sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>)

fn(3)
<span style="color: #b22222;">#</span><span style="color: #b22222;">fn(a=4) # &#38169;&#35823;&#65292;&#20165;&#20301;&#32622;&#21442;&#25968;&#65292;&#19981;&#21487;&#20197;&#20351;&#29992;&#20851;&#38190;&#23383;&#20256;&#21442;
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(a, /, b):
    <span style="color: #483d8b;">print</span>(a, b)
fn(1, 2)
fn(1, b=2)
<span style="color: #b22222;">#</span><span style="color: #b22222;">fn(a=1, b=2) #&#25253;&#38169;
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(a, b=2, /):
   <span style="color: #483d8b;">print</span>(a, b)

fn()
<span style="color: #b22222;">#</span><span style="color: #b22222;">fn(1, b=3) #&#25253;&#38169;</span>
</pre>
</div>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(a, b, /, x, y, z=6, *args, m=4, n, **kwargs): <span style="color: #b22222;"># </span><span style="color: #b22222;">*&#21495;&#21518;&#38754;&#65292;&#21482;&#25509;&#25910;&#20851;&#38190;&#23383;&#20256;&#21442;&#12290;n 
</span>    <span style="color: #483d8b;">print</span>(a, b)
    <span style="color: #483d8b;">print</span>(x, y, z)
    <span style="color: #483d8b;">print</span>(args)
    <span style="color: #483d8b;">print</span>(m, n)
    <span style="color: #483d8b;">print</span>(kwargs)

fn(1, 2, 3, 4, 5, 6, n=10)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 2
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 3 4 5
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: (6,)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 4 10
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: {}
</span>
fn(1, 2, n=20, x=5, y=6, t=10
<span style="color: #b22222;">#</span><span style="color: #b22222;">1 2
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">5 6 6
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">()
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">4 20
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">{'t': 10}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d1d37262-0f28-42b6-ab68-8cd16c2aae40" class="outline-5">
<h5 id="h:d1d37262-0f28-42b6-ab68-8cd16c2aae40">参数的混合使用</h5>
<div class="outline-text-5" id="text-h:d1d37262-0f28-42b6-ab68-8cd16c2aae40">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#21464;&#20301;&#32622;&#21442;&#25968;&#12289;keyword-only&#21442;&#25968;&#12289;&#32570;&#30465;&#20540;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(*args, x=5):
    <span style="color: #483d8b;">print</span>(x)
    <span style="color: #483d8b;">print</span>(args)

fn() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#31561;&#20215;&#20110;fn(x=5)
</span>fn(5) <span style="color: #b22222;"># </span><span style="color: #b22222;">5&#32473;&#20102;args
</span>fn(x=6)
fn(1,2,3,x=10)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26222;&#36890;&#21442;&#25968;&#12289;&#21487;&#21464;&#20301;&#32622;&#21442;&#25968;&#12289;keyword-only&#21442;&#25968;&#12289;&#32570;&#30465;&#20540;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(y, *args, x=5):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'x={}, y={}'</span>.<span style="color: #483d8b;">format</span>(x, y))
    <span style="color: #483d8b;">print</span>(args)

fn() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25253;&#38169;&#65292;y &#24517;&#39035;&#32473;
</span>fn(5)
fn(5, 6) <span style="color: #b22222;">#</span><span style="color: #b22222;">6&#32473;&#20102;args
</span>fn(x=6) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25253;&#38169;&#65292;y &#27809;&#32473;
</span>fn(1, 2, 3, x=10) <span style="color: #b22222;">#</span><span style="color: #b22222;">y=1, (2,3)&#32473;&#20102;args, x=10
</span>fn(y=17, 2, 3, x=10) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35821;&#27861;&#38169;&#35823;&#65292;&#20851;&#38190;&#23383;&#22312;&#21518;&#38754;
</span>fn(1, 2, y=3, x=10) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38169;&#35823;&#65292;&#37325;&#22797;&#20256;&#21442;
</span>fn(y=20, x=30)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26222;&#36890;&#21442;&#25968;&#12289;&#32570;&#30465;&#20540;&#12289;&#21487;&#21464;&#20851;&#38190;&#23383;&#21442;&#25968;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(x=5, **kwargs):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'x={}'</span>.<span style="color: #483d8b;">format</span>(x))
    <span style="color: #483d8b;">print</span>(kwargs)

fn()
fn(5)
fn(x=6)
fn(y=3, x=10)
fn(3, y=10)
fn(y=3, z=20)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:91a6d29e-a457-4500-b064-9e99c0443d3e" class="outline-5">
<h5 id="h:91a6d29e-a457-4500-b064-9e99c0443d3e">参数规则</h5>
<div class="outline-text-5" id="text-h:91a6d29e-a457-4500-b064-9e99c0443d3e">
<p>
参数列表参数一般顺序是：positional-only参数、普通参数、缺省参数、可变位置参数、keyword-only参数（可带缺省值）、可变关键字参数。
</p>

<p>
注意：
</p>
<ul class="org-ul">
<li>代码应该易读易懂，而不是为难别人</li>
<li>请按照书写习惯定义函数参数</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">a&#21644;b&#26159;&#20165;&#20301;&#32622;&#21442;&#25968;&#65292;&#21482;&#33021;&#29992;&#22312;python3.8&#21518;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(a, b, /, x, y, z=3, *args, m=4, n, **kwargs):
    <span style="color: #483d8b;">print</span>(a, b)
    <span style="color: #483d8b;">print</span>(x, y, z)
    <span style="color: #483d8b;">print</span>(m, n)
    <span style="color: #483d8b;">print</span>(args)
    <span style="color: #483d8b;">print</span>(kwargs)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">connect</span>(host=<span style="color: #8b2252;">'localhost'</span>, user=<span style="color: #8b2252;">'admin'</span>, password=<span style="color: #8b2252;">'admin'</span>, port=<span style="color: #8b2252;">'3306'</span>,**kwargs):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'mysql://{}:{}@{}:{}/{}'</span>.<span style="color: #483d8b;">format</span>(
        user, password, host, port, kwargs.get(<span style="color: #8b2252;">'db'</span>, <span style="color: #8b2252;">'test'</span>)
    ))

connect(<span style="color: #8b2252;">'127.0.0.1'</span>, <span style="color: #8b2252;">'admin'</span>, <span style="color: #8b2252;">'abcdef'</span>, debug=<span style="color: #008b8b;">True</span>, db=<span style="color: #8b2252;">'blog'</span>)
connect(db=<span style="color: #8b2252;">'cmdb'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21442;&#25968;&#30340;&#32570;&#30465;&#20540;&#25226;&#26368;&#24120;&#29992;&#30340;&#32570;&#30465;&#20540;&#37117;&#20889;&#22909;&#20102;
</span>connect(host=<span style="color: #8b2252;">'192.168.1.123'</span>, db=<span style="color: #8b2252;">'cmdb'</span>)
connect(host=<span style="color: #8b2252;">'192.168.1.123'</span>, db=<span style="color: #8b2252;">'cmdb'</span>, password=<span style="color: #8b2252;">'mysql'</span>)
</pre>
</div>

<ul class="org-ul">
<li>定义最常用参数为普通参数，可不提供缺省值，必须由用户提供。注意这些参数的顺序，最常用的先定义</li>
<li>将必须使用名称的才能使用的参数，定义为keyword-only参数，要求必须使用关键字传参</li>
<li>如果函数有很多参数，无法逐一定义，可使用可变参数。如果需要知道这些参数的意义，则使用可变关键字参数收集</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:46e748a8-5be0-419a-a88d-f7ca1d7e59bc" class="outline-4">
<h4 id="h:46e748a8-5be0-419a-a88d-f7ca1d7e59bc">参数解构</h4>
<div class="outline-text-4" id="text-h:46e748a8-5be0-419a-a88d-f7ca1d7e59bc">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
    <span style="color: #483d8b;">print</span>(x, y)
    <span style="color: #a020f0;">return</span> x + y

add(4, 5)
<span style="color: #b22222;">#</span><span style="color: #b22222;">add((4, 5)) # &#21487;&#20197;&#21527;&#65311; &#19981;&#21487;&#20197;&#65292;&#20803;&#32452;&#31639;&#19968;&#20010;&#21442;&#25968;
</span><span style="color: #a0522d;">t</span> = 4, 5
add(t[0], t[1])

add(*t) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21442;&#25968;&#35299;&#26512;&#65292;&#35843;&#29992;&#26102;&#65292;&#23545;&#23454;&#21442;&#21069;&#21152;&#20837; * &#21495;
</span>add(*(4, 5)), add(*<span style="color: #8b2252;">'ab'</span>), add(*b<span style="color: #8b2252;">'xy'</span>), add(*[4, 5])
add(*{4, 5}) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27880;&#24847;&#26377;&#39034;&#24207;&#21527;&#65311; &#26080;&#24207;
</span>add(*<span style="color: #483d8b;">range</span>(4, 6))

add(*{<span style="color: #8b2252;">'a'</span>:10, <span style="color: #8b2252;">'b'</span>:11}) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#21527;&#65311; &#21487;&#20197;&#65292;&#30456;&#24403;key&#22312;&#35299;&#26500; &gt;3.6&#21518;&#35760;&#20303;&#20102;key&#30340;&#39034;&#24207;&#65292;'ab'
</span>add(**{<span style="color: #8b2252;">'a'</span>:10, <span style="color: #8b2252;">'b'</span>:11}) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#21527;&#65311; &#19981;&#21487;&#20197;&#65292;** &#26159;&#20851;&#38190;&#23383;&#35299;&#26500;&#12290;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">**{'x':1, 'y':2} #&#21442;&#25968;&#35299;&#26500;&#21482;&#33021;&#29992;&#22312;&#23454;&#21442;&#30340;&#20256;&#36882;&#30340;&#26102;&#20505;
</span>add(**{<span style="color: #8b2252;">'x'</span>:100, <span style="color: #8b2252;">'y'</span>:110}) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#21527;&#65311;</span>
</pre>
</div>

<p>
参数解构：
</p>
<ul class="org-ul">
<li>在给函数提供实参的时候，可以在可迭代对象前使用 * 或者 ** 来进行结构的解构，提取出其中所有元素作为函数的实参</li>
<li>使用 * 解构成位置传参</li>
<li>使用 ** 解构成关键字传参</li>
<li>提取出来的元素数目要和参数的要求匹配</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(*nums):
    <span style="color: #a0522d;">result</span> = 0
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> nums:
        <span style="color: #a0522d;">result</span> += x
    <span style="color: #a020f0;">return</span> result

add(1, 2, 3)
add(*[1, 3, 5])
add(*<span style="color: #483d8b;">range</span>(5))
add(*<span style="color: #483d8b;">range</span>(5), 100, *[20]) <span style="color: #b22222;">#</span><span style="color: #b22222;">add(0,1,2,3,4,100,20) # &#23637;&#24320;&#21518;&#20256;&#21442;</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">3.8&#20197;&#21518;&#65292;&#19979;&#38754;&#23601;&#19981;&#21487;&#20197;&#20351;&#29992;&#23383;&#20856;&#35299;&#26500;&#21518;&#30340;&#20851;&#38190;&#23383;&#20256;&#21442;&#20102;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y, /): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20165;&#20301;&#32622;&#24418;&#21442;
</span>    <span style="color: #483d8b;">print</span>(x, y)
    <span style="color: #a020f0;">return</span> x + y

add(**{<span style="color: #8b2252;">'x'</span>:10, <span style="color: #8b2252;">'y'</span>:11}) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25253;&#38169;&#12290; &#20165;&#20301;&#32622;&#20256;&#21442;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:72bc52d3-b311-40cb-9434-deb08c7a3eee" class="outline-3">
<h3 id="h:72bc52d3-b311-40cb-9434-deb08c7a3eee">函数返回值</h3>
<div class="outline-text-3" id="text-h:72bc52d3-b311-40cb-9434-deb08c7a3eee">
<p>
先看几个例子
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">return&#35821;&#21477;&#20043;&#21518;&#21487;&#20197;&#25191;&#34892;&#21527;&#65311;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showplus</span>(x):
    <span style="color: #483d8b;">print</span>(x)
    <span style="color: #a020f0;">return</span> x + 1
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~~end~~'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">return&#20043;&#21518;&#20250;&#25191;&#34892;&#21527;&#65311; &#25191;&#34892;&#19981;&#21040;
</span>
showplus(5)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22810;&#26465;return&#35821;&#21477;&#37117;&#20250;&#25191;&#34892;&#21527;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showplus</span>(x):
    <span style="color: #483d8b;">print</span>(x)
    <span style="color: #a020f0;">return</span> x + 1
    <span style="color: #a020f0;">return</span> x + 2 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#19981;&#21040;
</span>
showplus(5)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#20363;&#22810;&#20010;return&#21487;&#20197;&#25191;&#34892;&#21527;&#65311;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">guess</span>(x):
    <span style="color: #a020f0;">if</span> x &gt; 3:
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&gt; 3"</span>
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&lt;= 3"</span>

<span style="color: #483d8b;">print</span>(guess(10))

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#38754;&#20989;&#25968;&#25191;&#34892;&#30340;&#32467;&#26524;&#26159;&#20160;&#20040;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(x):
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(x):
        <span style="color: #a020f0;">if</span> i &gt; 3:
            <span style="color: #a020f0;">return</span> i
        <span style="color: #a020f0;">else</span>:
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{} is not greater than 3"</span>.<span style="color: #483d8b;">format</span>(x))

<span style="color: #483d8b;">print</span>(fn(5)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#20160;&#20040;&#65311; 4
</span><span style="color: #483d8b;">print</span>(fn(3)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#20160;&#20040;&#65311; &#36820;&#22238;None</span>
</pre>
</div>

<p>
总结
</p>
<ul class="org-ul">
<li>Python函数使用return语句返回“返回值”</li>
<li>所有函数都有返回值，如果没有return语句，隐式调用return None</li>
<li>return 语句并不一定是函数的语句块的最后一条语句</li>
<li>一个函数可以存在多个return语句，但是只有一条可以被执行。如果没有一条return语句被执行到，隐式调用return None</li>
<li>如果有必要，可以显示调用return None，可以简写为return</li>
<li>如果函数执行了return语句，函数就会返回，当前被执行的return语句之后的其它语句就不会被执行了</li>
<li>返回值的作用：结束函数调用、返回“返回值”</li>
</ul>

<p>
能够一次返回多个值吗？
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showvalues</span>():
    <span style="color: #a020f0;">return</span> 1, 3, 5

showvalues() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#20102;&#22810;&#20010;&#20540;&#21527;&#65311; &#19968;&#20010;&#20540;</span>
</pre>
</div>

<ul class="org-ul">
<li>函数不能同时返回多个值</li>
<li>return 1, 3, 5 看似返回多个值，隐式的被python封装成了一个元组</li>
<li>x, y, z = showlist() 使用解构提取返回值更为方便</li>
</ul>
</div>
<div id="outline-container-h:fdb5b322-e397-4e79-9749-7bf9a4bab8e5" class="outline-4">
<h4 id="h:fdb5b322-e397-4e79-9749-7bf9a4bab8e5">练习</h4>
<div class="outline-text-4" id="text-h:fdb5b322-e397-4e79-9749-7bf9a4bab8e5">
<ol class="org-ol">
<li>编写一个函数，能够接受至少2个参数，返回最小值和最大值</li>
<li>完成一个函数，可以接收输入的多个数（命令输入，数字间隔可以使用空格或逗号），每一次都能返回到目前为止的最大值、最小值。</li>
</ol>


<ol class="org-ol">
<li>编写一个函数，能够接受至少2个参数，返回最小值和最大值</li>
</ol>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(*args):
    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">len</span>(args)&lt;2:  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#20248;&#38597;
</span>        <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">TypeError</span>
    <span style="color: #b22222;">#</span><span style="color: #b22222;">pass
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get1</span>(x, y, *args): <span style="color: #b22222;">#</span><span style="color: #b22222;">max, min
</span>    <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">min</span>(x, y, *args), <span style="color: #483d8b;">max</span>(x, y, *args)
get1(4, 5, *<span style="color: #483d8b;">range</span>(5))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#20160;&#20040;&#38382;&#39064;&#65311;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1 &#36941;&#21382;&#20102;2&#27425;&#65292;&#35299;&#20915;&#26041;&#26696;1&#27425;&#36941;&#21382;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">2 &#35299;&#26500;&#30340;&#38382;&#39064;
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get2</span>(x, y, *args):
    <span style="color: #a0522d;">ms</span>, *<span style="color: #a0522d;">_</span>, <span style="color: #a0522d;">mx</span> = <span style="color: #483d8b;">sorted</span>((x,y,*args))
    <span style="color: #a020f0;">return</span> ms, mx

get2(4, 5, *<span style="color: #483d8b;">range</span>(5))

<span style="color: #b22222;"># </span><span style="color: #b22222;">get1 &#26102;&#38388;&#22797;&#26434;&#24230;&#20026; O(2n)&#65292;get2 &#26102;&#38388;&#22797;&#26434;&#24230;0(n^2)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#27979;&#35797;&#20351;&#29992;&#26080;&#24207;&#30340;&#21442;&#25968;&#65292;sorted &#20869;&#37096;&#20570;&#20102;&#20248;&#21270;
</span>
<span style="color: #a0522d;">lst</span>= <span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">range</span>(10000))
<span style="color: #a020f0;">import</span> random
random.shuffle(lst)
random.shuffle(lst)
%%timeit
get1(4,5,*lst) <span style="color: #b22222;">#</span><span style="color: #b22222;">6xxms
</span>
%%timeit
get2(4,5,*lst) <span style="color: #b22222;">#</span><span style="color: #b22222;">1s
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get3</span>(x, y, *args):
    <span style="color: #a0522d;">ms</span>, <span style="color: #a0522d;">mx</span> = <span style="color: #483d8b;">min</span>(args), <span style="color: #483d8b;">max</span>(args)
    <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">min</span>(x,y,ms), <span style="color: #483d8b;">max</span>(x,y,mx)

%%timeit
get3(4,5,*lst) <span style="color: #b22222;">#</span><span style="color: #b22222;">4xxms
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19968;&#27425;&#24615;&#36941;&#21382;&#65292;&#19981;&#20381;&#36182;&#20869;&#24314;&#20989;&#25968;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get4</span>(x, y, *args):
    <span style="color: #a0522d;">min_</span>, <span style="color: #a0522d;">max_</span> = (y, x) <span style="color: #a020f0;">if</span> x &gt; y <span style="color: #a020f0;">else</span> (x, y)
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> args:
        <span style="color: #a020f0;">if</span> x &gt; <span style="color: #483d8b;">max</span>:
            <span style="color: #a0522d;">max_</span> = x
        <span style="color: #a020f0;">elif</span> x &lt; min_:
            <span style="color: #a0522d;">min_</span> = x
    <span style="color: #a020f0;">return</span> min_, max_

%%timeit
get3(4,5,*lst) <span style="color: #b22222;">#</span><span style="color: #b22222;">3xxms</span>
</pre>
</div>


<ol class="org-ol">
<li>完成一个函数，可以接收输入的多个数（命令输入，数字间隔可以使用空格或逗号），每一次都能返回到目前为止的最大值、最小值。</li>
</ol>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">input('&gt;&gt;&gt;').replace(',', ' ').split() #&#21015;&#34920;
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">double_values</span>():
    <span style="color: #a0522d;">mx</span> = <span style="color: #a0522d;">ms</span> = <span style="color: #008b8b;">None</span>
    <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
        <span style="color: #a0522d;">x</span> = <span style="color: #483d8b;">input</span>(<span style="color: #8b2252;">'&gt;&gt;&gt;'</span>).strip()
        <span style="color: #a020f0;">if</span> x == <span style="color: #8b2252;">''</span> <span style="color: #a020f0;">or</span> x == <span style="color: #8b2252;">'quit'</span>:
            <span style="color: #a020f0;">break</span>

        <span style="color: #a0522d;">nums</span> = [<span style="color: #483d8b;">int</span>(t) <span style="color: #a020f0;">for</span> t <span style="color: #a020f0;">in</span> x.replace(<span style="color: #8b2252;">','</span>, <span style="color: #8b2252;">' '</span>).split()] <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#34920;&#65292;&#26377;&#21487;&#33021;&#26159;&#31354;
</span>        <span style="color: #a020f0;">if</span> nums: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35828;&#26126;&#26377;&#25104;&#21151;&#36716;&#25442;&#30340;&#25968;&#25454;&#22312;&#21015;&#34920;&#20013;
</span>            <span style="color: #a020f0;">if</span> mx <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#20294;&#26159;&#31532;&#19968;&#27425;&#65292;&#32780;&#19988;&#31532;&#19968;&#27425;&#26377;&#25968;&#25454;&#25165;&#36827;&#26469;
</span>                <span style="color: #a0522d;">mx</span> = <span style="color: #a0522d;">ms</span> = nums[0]

            <span style="color: #a0522d;">a</span>, <span style="color: #a0522d;">b</span> = <span style="color: #483d8b;">min</span>(nums), <span style="color: #483d8b;">max</span>(nums)
            <span style="color: #a020f0;">if</span> b &gt; mx:
                <span style="color: #a0522d;">mx</span> = b
            <span style="color: #a020f0;">if</span> a &lt; ms:
                <span style="color: #a0522d;">ms</span> = a

            <span style="color: #483d8b;">print</span>(ms, mx)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:a2d785fc-f136-442c-95c1-2b1a78ad3f44" class="outline-3">
<h3 id="h:a2d785fc-f136-442c-95c1-2b1a78ad3f44">返回值作用域</h3>
<div class="outline-text-3" id="text-h:a2d785fc-f136-442c-95c1-2b1a78ad3f44">
</div>
<div id="outline-container-h:7e6f4dbc-39ae-48e5-a5bd-fd1ed837bade" class="outline-4">
<h4 id="h:7e6f4dbc-39ae-48e5-a5bd-fd1ed837bade">函数作用域***</h4>
<div class="outline-text-4" id="text-h:7e6f4dbc-39ae-48e5-a5bd-fd1ed837bade">
</div>
<div id="outline-container-h:225d8ff5-1cfe-45aa-aa1f-4ac6714d0051" class="outline-5">
<h5 id="h:225d8ff5-1cfe-45aa-aa1f-4ac6714d0051">作用域</h5>
<div class="outline-text-5" id="text-h:225d8ff5-1cfe-45aa-aa1f-4ac6714d0051">
<p>
一个标识符的可见范围，这就是标识符的作用域。一般常说的是变量的作用域
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
    <span style="color: #a0522d;">x</span> = 100
<span style="color: #483d8b;">print</span>(x) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#35775;&#38382;&#21040;&#21527;</span>
</pre>
</div>

<p>
上例中x不可以访问到，会抛出异常（NameError: name 'x' is not defined），原因在于函数是一个封装，它会开辟一个 <b>作用域</b> ，x变量被限制在这个作用域中，所以在函数外部x变量 <b>不可见</b> 。
</p>

<p>
注意： <b>每一个函数都会开辟一个作用域</b>
</p>
</div>
</div>
<div id="outline-container-h:3b0629ba-2af4-42d7-9ba1-48ef0cea66f2" class="outline-5">
<h5 id="h:3b0629ba-2af4-42d7-9ba1-48ef0cea66f2">作用域分类</h5>
<div class="outline-text-5" id="text-h:3b0629ba-2af4-42d7-9ba1-48ef0cea66f2">
<ul class="org-ul">
<li>全局作用域
<ul class="org-ul">
<li>在整个程序运行环境中都可见</li>
<li>全局作用域中的变量称为 <b>全局变量</b> global</li>
</ul></li>
<li>局部作用域
<ul class="org-ul">
<li>在函数、类等内部可见</li>
<li>局部作用域中的变量称为 <b>局部变量</b> ，其使用范围不能超过其所在局部作用域</li>
<li>也称为本地作用域local</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#23616;&#37096;&#21464;&#37327;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn1</span>():
    <span style="color: #a0522d;">x</span> = 1 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23616;&#37096;&#20316;&#29992;&#22495;&#65292;x&#20026;&#23616;&#37096;&#21464;&#37327;&#65292;&#20351;&#29992;&#33539;&#22260;&#22312;fn1&#20869;
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn2</span>():
    <span style="color: #483d8b;">print</span>(x) <span style="color: #b22222;"># </span><span style="color: #b22222;">x&#33021;&#25171;&#21360;&#21527;&#65311;&#21487;&#35265;&#21527;&#65311;&#20026;&#20160;&#20040;&#65311; 
</span><span style="color: #483d8b;">print</span>(x) <span style="color: #b22222;"># </span><span style="color: #b22222;">x&#33021;&#25171;&#21360;&#21527;&#65311;&#21487;&#35265;&#21527;&#65311;&#20026;&#20160;&#20040;&#65311; &#19981;&#21487;&#35265;&#65292;x &#30340;&#21487;&#35265;&#33539;&#22260;&#23601;&#22312;fn1&#20989;&#25968;&#37324;&#12290;&#20840;&#23616;&#29615;&#22659;&#20013;&#27809;&#26377;&#23450;&#20041;x</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#20840;&#23616;&#21464;&#37327;
</span><span style="color: #a0522d;">x</span> = 5 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20840;&#23616;&#21464;&#37327;&#65292;&#20063;&#22312;&#20989;&#25968;&#22806;&#23450;&#20041;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
    <span style="color: #a0522d;">y</span> = x + 1
    <span style="color: #483d8b;">print</span>(x) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#35265;&#21527;&#65311;&#20026;&#20160;&#20040;&#65311; &#21487;&#35265;&#12290;&#20989;&#25968;&#23616;&#37096;&#21464;&#37327;&#65292;&#23545;&#22806;&#19981;&#21487;&#35265;&#65307;&#22806;&#37096;&#23545;&#20869;&#21487;&#35265;&#65292;&#21521;&#20869;&#31359;&#36879;
</span>    <span style="color: #483d8b;">print</span>(y)

foo()
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 5
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 6</span>
</pre>
</div>

<ul class="org-ul">
<li>一般来讲外部作用域变量可以在函数内部可见，可以使用</li>
<li>反过来，函数内部的局部变量，不能在函数外部看到</li>
</ul>
</div>
</div>
<div id="outline-container-h:56d7e856-fa02-4e8b-965e-67cfebe2d5b1" class="outline-5">
<h5 id="h:56d7e856-fa02-4e8b-965e-67cfebe2d5b1">函数嵌套</h5>
<div class="outline-text-5" id="text-h:56d7e856-fa02-4e8b-965e-67cfebe2d5b1">
<p>
在一个函数中定义了另外一个函数
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">outer</span>():
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inner</span>():
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"inner"</span>)
    inner()
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"outer"</span>)
outer() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#21527;&#65311; &#21487;&#20197;
</span>inner() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#21527;&#65311; &#20869;&#37096;&#20989;&#25968;&#19981;&#33021;&#22312;&#22806;&#37096;&#30452;&#25509;&#20351;&#29992;&#65292;&#22240;&#20026;&#23427;&#22312;&#20989;&#25968;&#22806;&#37096;&#19981;&#21487;&#35265;</span>
</pre>
</div>

<p>
内部函数inner不能在外部直接使用，会抛NameError异常，因为它在函数外部不可见。
</p>

<p>
其实，inner不过就是一个标识符，就是一个函数outer内部定义的变量而已。
</p>
</div>
<div id="outline-container-h:2a18f60a-4d93-4c46-a5d7-d9cff5d9defe" class="outline-6">
<h6 id="h:2a18f60a-4d93-4c46-a5d7-d9cff5d9defe">嵌套结构的作用域</h6>
<div class="outline-text-6" id="text-h:2a18f60a-4d93-4c46-a5d7-d9cff5d9defe">
<p>
对比下面嵌套结构，代码执行的效果
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">outer1</span>():
    <span style="color: #a0522d;">o</span> = 65
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inner</span>():
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'inner'</span>, o, <span style="color: #483d8b;">chr</span>(o))
    inner()
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'outer'</span>, o, <span style="color: #483d8b;">chr</span>(o))

outer1() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#21518;&#65292;&#25171;&#21360;&#20160;&#20040;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: inner 65 A
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: outer 65 A
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">outer2</span>():
    <span style="color: #a0522d;">o</span> = 65
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inner</span>():
        <span style="color: #a0522d;">o</span> = 97
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'inner'</span>, o, <span style="color: #483d8b;">chr</span>(o))
    inner()
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'outer'</span>, o, <span style="color: #483d8b;">chr</span>(o))

outer2() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#21518;&#65292;&#25171;&#21360;&#20160;&#20040;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: inner 97 a
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: outer 65 A</span>
</pre>
</div>

<p>
从执行的结果来看：
</p>
<ul class="org-ul">
<li>外层变量在内部作用域可见</li>
<li>内层作用域inner中，如果定义了 o = 97 ，相当于在当前函数inner作用域中重新定义了一个新的变量o，但是，这个o并不能覆盖掉外部作用域outer2中的变量o。只不过对于inner函数来说，其只能可见自己作用域中定义的变量o了</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:3a258199-fae2-45b7-9f95-2cf36e129400" class="outline-5">
<h5 id="h:3a258199-fae2-45b7-9f95-2cf36e129400">内建函数chr, ord</h5>
<div class="outline-text-5" id="text-h:3a258199-fae2-45b7-9f95-2cf36e129400">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">内建函数</td>
<td class="org-left">函数签名</td>
<td class="org-left">说明</td>
</tr>

<tr>
<td class="org-left">chr</td>
<td class="org-left">chr(i)</td>
<td class="org-left">通过unicode编码返回对应字符</td>
</tr>

<tr>
<td class="org-left">ord</td>
<td class="org-left">ord(c)</td>
<td class="org-left">获得字符对应的unicode</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">ord</span>(<span style="color: #8b2252;">'&#20013;'</span>), <span style="color: #483d8b;">hex</span>(<span style="color: #483d8b;">ord</span>(<span style="color: #8b2252;">'&#20013;'</span>)), <span style="color: #8b2252;">'&#20013;'</span>.encode(), <span style="color: #8b2252;">'&#20013;'</span>.encode(<span style="color: #8b2252;">'gbk'</span>))

<span style="color: #483d8b;">chr</span>(20013) <span style="color: #b22222;"># </span><span style="color: #b22222;">'&#20013;'
</span><span style="color: #483d8b;">chr</span>(97)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:636d00c3-0ec1-4451-863f-ef110e2ff27c" class="outline-5">
<h5 id="h:636d00c3-0ec1-4451-863f-ef110e2ff27c">一个赋值语句的问题</h5>
<div class="outline-text-5" id="text-h:636d00c3-0ec1-4451-863f-ef110e2ff27c">
<p>
再看下面左右2个函数
</p>

<p>
左边函数：
正常执行，函数外部的变量在函数内部可见
</p>

<p>
右边函数：
执行错误吗，为什么？难道函数内部又不可见了？y = x + 1可以正确执行，可是为什么x += 1却不能正确执行？
</p>

<p>
仔细观察函数2返回的错误指向x += 1，原因是什么呢？
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">x</span> = 5
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
   <span style="color: #a0522d;">x</span> += 1

foo() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25253;&#38169;&#22914;&#19979;&#65292; UnboundLocalError</span>
</pre>
</div>

<p>
原因分析：
</p>
<ul class="org-ul">
<li>x += 1 其实是 x = x + 1</li>
<li>只要有"x="出现，这就是赋值语句。相当于在foo内部定义一个局部变量x，那么foo内部所有x都是这个局部变量x了</li>
<li>x = x + 1 相当于使用了局部变量x，但是这个x还没有完成赋值，就被右边拿来做加1操作了</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">x</span> = 5
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>(): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20989;&#25968;&#34987;&#35299;&#37322;&#22120;&#35299;&#37322;&#65292;foo&#25351;&#21521;&#20989;&#25968;&#23545;&#35937;&#65292;&#21516;&#26102;&#35299;&#37322;&#22120;&#20250;&#29702;&#35299;x&#26159;&#20160;&#20040;&#20316;&#29992;&#22495;
</span>    <span style="color: #483d8b;">print</span>(x) <span style="color: #b22222;"># </span><span style="color: #b22222;">x &#22312;&#20989;&#25968;&#35299;&#26512;&#26102;&#23601;&#34987;&#35299;&#37322;&#22120;&#21028;&#23450;&#20026;&#23616;&#37096;&#21464;&#37327;
</span>    <span style="color: #a0522d;">x</span> += 1 <span style="color: #b22222;"># </span><span style="color: #b22222;">x = x + 1
</span>foo() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35843;&#29992;&#26102;</span>
</pre>
</div>

<p>
如何解决这个常见问题？
</p>
</div>
</div>
<div id="outline-container-h:073418d0-6c9b-4f39-a6c2-08b553ab8b95" class="outline-5">
<h5 id="h:073418d0-6c9b-4f39-a6c2-08b553ab8b95">global语句</h5>
<div class="outline-text-5" id="text-h:073418d0-6c9b-4f39-a6c2-08b553ab8b95">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a0522d;">x</span> = 5
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
    <span style="color: #a020f0;">global</span> x <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20840;&#23616;&#21464;&#37327;&#12290; &#23558;x&#22768;&#26126;&#20026;&#20840;&#23616;&#21464;&#37327;
</span>    <span style="color: #a0522d;">x</span> += 1
    <span style="color: #483d8b;">print</span>(x)

foo()
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 6</span>
</pre>
</div>

<ul class="org-ul">
<li>使用global关键字的变量，将foo内的x声明为使用外部的全局作用域中定义的x</li>
<li>全局作用域中必须有x的定义</li>
</ul>

<p>
如果全局作用域中没有x定义会怎样？
</p>

<p>
注意，下面试验如果在ipython、jupyter中做，上下文运行环境中有可能有x的定义，稍微不注意，就测试不出效果
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26377;&#38169;&#21527;&#65311;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
    <span style="color: #a020f0;">global</span> x
    <span style="color: #a0522d;">x</span> += 1
    <span style="color: #483d8b;">print</span>(x)

foo()
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26377;&#38169;&#21527;&#65311;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
    <span style="color: #a020f0;">global</span> x
    <span style="color: #a0522d;">x</span> = 10
    <span style="color: #a0522d;">x</span> += 1
    <span style="color: #483d8b;">print</span>(x)

foo()
<span style="color: #483d8b;">print</span>(x) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#21527;</span>
</pre>
</div>

<p>
使用global关键字定义的变量，虽然在foo函数中声明，但是这将告诉当前foo函数作用域，这个x变量将使用外部全局作用域中的x。
</p>

<p>
即使是在foo中又写了 x = 10 ，也不会在foo这个局部作用域中定义局部变量x了。
</p>

<p>
使用了global，foo中的x不再是局部变量了，它是全局变量。
</p>
</div>
<div id="outline-container-h:985b0e7d-59dd-408b-a9c4-bd4a41fa1c90" class="outline-6">
<h6 id="h:985b0e7d-59dd-408b-a9c4-bd4a41fa1c90">总结</h6>
<div class="outline-text-6" id="text-h:985b0e7d-59dd-408b-a9c4-bd4a41fa1c90">
<ul class="org-ul">
<li>x+=1 这种是特殊形式产生的错误的原因？先引用后赋值，而python动态语言是赋值才算定义，才能被引用。
解决办法，在这条语句前增加x=0之类的赋值语句，或者使用global 告诉内部作用域，去全局作用域查找变量定义</li>

<li>内部作用域使用 x = 10 之类的赋值语句会重新定义局部作用域使用的变量x，但是，一旦这个作用域中使用 global 声明x为全局的，那么x=5相当于在为全局作用域的变量x赋值</li>
</ul>
</div>
</div>
<div id="outline-container-h:358a5ca3-ba49-4125-93bf-038990a68532" class="outline-6">
<h6 id="h:358a5ca3-ba49-4125-93bf-038990a68532">global使用原则</h6>
<div class="outline-text-6" id="text-h:358a5ca3-ba49-4125-93bf-038990a68532">
<ul class="org-ul">
<li>外部作用域变量会在内部作用域可见，但也不要在这个内部的局部作用域中直接使用，因为函数的目的就是为了封装，尽量与外界隔离</li>

<li>如果函数需要使用外部全局变量，请尽量使用函数的形参定义，并在调用传实参解决</li>
<li>一句话： <b>不用global</b> 。学习它就是为了深入理解变量作用域</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:c729f5d8-bb61-4850-864e-ddf0e7e13fe2" class="outline-5">
<h5 id="h:c729f5d8-bb61-4850-864e-ddf0e7e13fe2">闭包***</h5>
<div class="outline-text-5" id="text-h:c729f5d8-bb61-4850-864e-ddf0e7e13fe2">
<p>
<b>自由变量</b> ：未在本地作用域中定义的变量。例如定义在内层函数外的外层函数的作用域中的变量
</p>

<p>
<b>闭包</b> ：就是一个概念，出现在嵌套函数中，指的是 <b>内层函数引用到了外层函数的自由变量</b> ，就形成了闭包。很多语言都有这个概念，最熟悉就是JavaScript
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">counter</span>():
    <span style="color: #a0522d;">c</span> = [0]
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inc</span>():
        <span style="color: #a0522d;">c</span>[0] += 1
        <span style="color: #a020f0;">return</span> c[0]
    <span style="color: #a020f0;">return</span> inc <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#24847;&#20026;&#20043;&#65292;&#23601;&#26159;&#35201;&#36820;&#22238;&#20989;&#25968;&#65292;&#20989;&#25968;&#29992;foo&#21464;&#37327;&#35760;&#20303;&#65292;c&#38381;&#21253;&#24517;&#38656;&#20445;&#30041;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20986;&#38169;&#21527;&#65311;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#38381;&#21253;&#21527;&#65311;
</span>
<span style="color: #a0522d;">foo</span> = counter() <span style="color: #b22222;">#</span><span style="color: #b22222;">? &#21487;&#25191;&#34892;&#65292;&#19981;&#20986;&#38169;&#12290;foo &#23601;&#26159; inc&#65292;&#20294;&#26159;counter&#24050;&#32463;&#35843;&#29992;&#32467;&#26463;&#65292;&#20869;&#37096;&#23616;&#37096;&#21464;&#37327;&#25353;&#36947;&#29702;&#35201;&#28040;&#20129;
</span><span style="color: #483d8b;">print</span>(foo(), foo()) <span style="color: #b22222;">#</span><span style="color: #b22222;">? 1 2 foo&#25351;&#21521;inc&#20989;&#25968;&#23545;&#35937;&#65292;&#27809;&#26377;&#34987;&#37322;&#25918;&#12290;c[0] &#26159;&#38381;&#21253;&#19978;&#30340;c
</span><span style="color: #a0522d;">c</span> = 100
<span style="color: #483d8b;">print</span>(foo()) <span style="color: #b22222;">#</span><span style="color: #b22222;">? 3 foo&#20013;&#30340;c&#26159;&#23616;&#37096;&#21464;&#37327;&#65292;&#38543;&#30528;counter()&#20989;&#25968;&#25191;&#34892;&#23436;&#65292;c&#26631;&#35782;&#31526;&#24050;&#32463;&#28040;&#20129;&#20102;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">counter</span>():
    <span style="color: #a0522d;">c</span> = [0]
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inc</span>():
        <span style="color: #a0522d;">c</span>[0] += 1 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25253;&#38169;&#21527;&#65311; &#20026;&#20160;&#20040; # line 4
</span>        <span style="color: #a020f0;">return</span> c[0]
    <span style="color: #a020f0;">return</span> inc

<span style="color: #a0522d;">foo</span> = counter() <span style="color: #b22222;"># </span><span style="color: #b22222;">line 8
</span><span style="color: #483d8b;">print</span>(foo(), foo()) <span style="color: #b22222;"># </span><span style="color: #b22222;">line 9
</span><span style="color: #a0522d;">c</span> = 100
<span style="color: #483d8b;">print</span>(foo()) <span style="color: #b22222;"># </span><span style="color: #b22222;">line 11</span>
</pre>
</div>

<p>
上面代码有几个问题：
</p>
<ul class="org-ul">
<li>第4行会报错吗？为什么</li>
<li>第9行打印什么结果？</li>
<li>第11行打印什么结果？</li>
</ul>

<p>
代码分析
</p>
<ul class="org-ul">
<li>第8行会执行counter函数并返回inc对应的函数对象，注意这个函数对象并不释放，因为有foo记着</li>
<li>第4行会报错吗？为什么
<ul class="org-ul">
<li>不会报错，c已经在counter函数中定义过了。而且inc中的使用方式是为c的元素修改值，而不是重新定义c变量</li>
</ul></li>
<li>第9行打印什么结果？
<ul class="org-ul">
<li>打印 1 2</li>
</ul></li>
<li>第11行打印什么结果？
<ul class="org-ul">
<li>打印 3</li>
<li>第9行的c和counter中的c不一样，而inc引用的是自由变量正是counter中的变量c</li>
</ul></li>
</ul>



<figure id="org0213855">
<img src="./images/img_20240425_185828.png" alt="img_20240425_185828.png" width="50%">

</figure>


<p>
这是Python2中实现闭包的方式，Python3还可以使用nonlocal关键字
</p>

<p>
再看下面这段代码，会报错吗？使用global能解决吗？
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">counter</span>():
    <span style="color: #a0522d;">count</span> = 0
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inc</span>():
        <span style="color: #a0522d;">count</span> += 1
        <span style="color: #a020f0;">return</span> count
    <span style="color: #a020f0;">return</span> inc

<span style="color: #a0522d;">foo</span> = counter()
<span style="color: #483d8b;">print</span>(foo(), foo())
</pre>
</div>

<p>
上例一定出错，使用gobal可以解决
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">counter</span>():
    <span style="color: #a020f0;">global</span> count
    <span style="color: #a0522d;">count</span> = 0
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inc</span>():
        <span style="color: #a020f0;">global</span> count
        <span style="color: #a0522d;">count</span> += 1
        <span style="color: #a020f0;">return</span> count
    <span style="color: #a020f0;">return</span> inc

<span style="color: #a0522d;">foo</span> = counter()
<span style="color: #483d8b;">print</span>(foo(), foo())
<span style="color: #a0522d;">count</span> = 100
<span style="color: #483d8b;">print</span>(foo()) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#20960;&#65311;</span>
</pre>
</div>

<p>
上例 <b>使用global解决，这是全局变量的实现，而不是闭包了</b> 。
</p>

<p>
如果要对这个普通变量使用闭包，Python3中可以使用nonlocal关键字。
</p>
</div>
<div id="outline-container-h:5094aa21-f4eb-458f-ba30-8ef5c181e32a" class="outline-6">
<h6 id="h:5094aa21-f4eb-458f-ba30-8ef5c181e32a">nonlocal语句</h6>
<div class="outline-text-6" id="text-h:5094aa21-f4eb-458f-ba30-8ef5c181e32a">
<p>
nonlocal：将变量标记为不在本地作用域定义，而是在 <b>上级的某一级局部作用域</b> 中定义，但 <b>不能是全局作用域</b> 中定义，否则报语法错误。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">counter</span>(): <span style="color: #b22222;">#</span><span style="color: #b22222;">python3 &#20013;&#27604;&#36739;&#31616;&#21333;&#23454;&#29616;&#38381;&#21253;&#26041;&#24335;
</span>    <span style="color: #a0522d;">count</span> = 0
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inc</span>():
        <span style="color: #a020f0;">nonlocal</span> count <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22768;&#26126;&#21464;&#37327;count&#19981;&#26159;&#26412;&#22320;&#21464;&#37327;
</span>        <span style="color: #a0522d;">count</span> += 1
        <span style="color: #a020f0;">return</span> count
    <span style="color: #a020f0;">return</span> inc

<span style="color: #a0522d;">foo</span> = counter()
<span style="color: #483d8b;">print</span>(foo(), foo())
</pre>
</div>

<p>
count 是外层函数的局部变量，被内部函数引用。
</p>

<p>
内部函数使用nonlocal关键字声明count变量在上级作用域而非本地作用域中定义。
</p>

<p>
代码中内层函数引用外部局部作用域中的自由变量，形成闭包。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">func</span>():
    <span style="color: #a020f0;">nonlocal</span> d
    <span style="color: #a0522d;">d</span> = 100
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#30452;&#25509;&#25253;&#35821;&#27861;&#38169;&#35823;&#65292;d &#21521;&#22806;&#25214;&#23601;&#26159;&#20840;&#23616;&#20102;&#12290;nonlocal &#19981;&#33021;&#25214;&#20840;&#23616;&#21464;&#37327;</span>
</pre>
</div>



<figure id="org0d12f20">
<img src="./images/Snipaste_2023-06-07_09-50-30.png" alt="Snipaste_2023-06-07_09-50-30.png" width="50%">

</figure>

<p>
上例是错误的，nonlocal 声明变量 a 不在当前作用域，但是往外就是全局作用域了，所以错误。
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-h:db599370-595e-48a8-ad1b-d3d5fd39aca2" class="outline-4">
<h4 id="h:db599370-595e-48a8-ad1b-d3d5fd39aca2">默认值的作用域</h4>
<div class="outline-text-4" id="text-h:db599370-595e-48a8-ad1b-d3d5fd39aca2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>(x=1):
    <span style="color: #a0522d;">x</span> += 1 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#38382;&#39064;&#21527;&#65311;&#27809;&#26377;&#12290;x= &#20986;&#29616;&#20102;&#65292;x&#23601;&#26159;foo&#20989;&#25968;&#30340;&#23616;&#37096;&#21464;&#37327;
</span>    <span style="color: #483d8b;">print</span>(x)

foo()
foo()
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 2
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo1</span>(y=[]): <span style="color: #b22222;">#</span><span style="color: #b22222;">[]&#26159;&#24341;&#29992;&#31867;&#22411;
</span>    y.append(1) <span style="color: #b22222;"># </span><span style="color: #b22222;">y&#26159;&#23616;&#37096;&#21464;&#37327;&#65292;y&#21442;&#25968;&#19981;&#25552;&#20379;&#23601;&#20351;&#29992;&#32570;&#30465;&#20540;&#65292;&#32570;&#30465;&#20540;&#22312;&#21738;&#37324;&#65311;&#20445;&#23384;&#22312;&#20989;&#25968;&#23545;&#35937;&#19978;
</span>    <span style="color: #483d8b;">print</span>(y)

foo1()
foo1()
<span style="color: #b22222;">#</span><span style="color: #b22222;">print(y) # &#25253;&#38169; NameError&#65292;&#24403;&#21069;&#20316;&#29992;&#22495;&#27809;&#26377;y&#21464;&#37327;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: [1]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: [1, 1]
</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#29992;&#32570;&#30465;&#20540;
</span>foo1([])
foo1([])
foo1([])
<span style="color: #b22222;">#</span><span style="color: #b22222;">: [1]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: [1]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: [1]
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#32570;&#30465;&#20540;
</span><span style="color: #483d8b;">print</span>(foo1.<span style="color: #483d8b;">__defaults__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32570;&#30465;&#20540;&#20445;&#23384;&#22312;&#20803;&#32452;&#20013;&#65292;&#20803;&#32452;1&#20010;&#20803;&#32032;&#65292;&#26159;&#21015;&#34920;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: ([1, 1],)</span>
</pre>
</div>

<p>
为什么第二次调用foo函数打印的是[1,1]？
</p>
<ul class="org-ul">
<li>因为函数也是对象，python把函数的默认值放在了属性中，这个属性就伴随着这个函数对象的整个生命周期</li>
<li>查看 <code>foo.__defaults__</code> 属性</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo2</span>(x=<span style="color: #8b2252;">'abc'</span>, y=123, z=[1,2]):
    <span style="color: #a0522d;">x</span> += <span style="color: #8b2252;">'~'</span>
    <span style="color: #a0522d;">y</span> += 100
    z.append(100)
    <span style="color: #483d8b;">print</span>(x, y, z)

<span style="color: #483d8b;">print</span>(foo2.<span style="color: #483d8b;">__defaults__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20803;&#32452;&#21644;&#39034;&#24207;&#26377;&#20851;&#65292;&#39034;&#24207;&#23545;&#24212;&#24418;&#21442;&#32570;&#30465;&#20540;
</span>foo2()
<span style="color: #483d8b;">print</span>(foo2.<span style="color: #483d8b;">__defaults__</span>) 
foo2()
<span style="color: #b22222;">#</span><span style="color: #b22222;">: ('abc', 123, [1, 2])
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: abc~ 223 [1, 2, 100]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: ('abc', 123, [1, 2, 100])
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: abc~ 223 [1, 2, 100, 100]</span>
</pre>
</div>

<p>
属性 <code>__defaults__</code> 中使用元组保存所有位置参数默认值，它不会因为在函数体内使用了它而发生改变
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo3</span>(x=1, *args, m=10, n, **kwargs):
    <span style="color: #483d8b;">print</span>(x, m, n, args, kwargs)

<span style="color: #483d8b;">print</span>(foo3.<span style="color: #483d8b;">__defaults__</span>, foo3.<span style="color: #483d8b;">__kwdefaults__</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">kwdeaults &#20351;&#29992;&#20102;&#23383;&#20856;
</span>foo3(n=200)
</pre>
</div>

<ul class="org-ul">
<li>属性 <code>__defaults__</code> 中使用元组保存所有位置参数默认值</li>
<li>属性 <code>__kwdefaults__</code> 中使用字典保存所有keyword-only参数的默认值</li>
</ul>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo4</span>(x=[]):
    <span style="color: #a0522d;">x</span> += [1]
    <span style="color: #483d8b;">print</span>(x)

<span style="color: #483d8b;">print</span>(1, foo4())
<span style="color: #483d8b;">print</span>(1, foo4())
<span style="color: #483d8b;">print</span>(foo4.<span style="color: #483d8b;">__defaults__</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: [1]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 None
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: [1, 1]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 None
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: ([1, 1],)
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo5</span>(x=[]):
    <span style="color: #a0522d;">x</span> = x + [1]
    <span style="color: #483d8b;">print</span>(x)

<span style="color: #483d8b;">print</span>(1, foo5())
<span style="color: #483d8b;">print</span>(1, foo5())
<span style="color: #483d8b;">print</span>(foo5.<span style="color: #483d8b;">__defaults__</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: [1]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 None
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: [1]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 None
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: ([],)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a0522d;">x</span> = []
<span style="color: #483d8b;">print</span>(1, <span style="color: #483d8b;">id</span>(x), x)
<span style="color: #a0522d;">x</span> += [1] <span style="color: #b22222;">#</span><span style="color: #b22222;">x.extend([1])
</span><span style="color: #a0522d;">x</span> += [1]
<span style="color: #483d8b;">print</span>(2, <span style="color: #483d8b;">id</span>(x), x)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 1788996419520 []
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2 1788996419520 [1, 1]
</span>
<span style="color: #a0522d;">x</span> = []
<span style="color: #483d8b;">print</span>(1, <span style="color: #483d8b;">id</span>(x), x)
<span style="color: #a0522d;">x</span> = x + [1]  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29983;&#25104;&#19968;&#20010;&#20840;&#26032;&#30340;&#21015;&#34920;&#65292;&#35206;&#30422;x&#12290;
</span><span style="color: #483d8b;">print</span>(2, <span style="color: #483d8b;">id</span>(x), x)
<span style="color: #a0522d;">x</span> = x + [1]
<span style="color: #483d8b;">print</span>(3, <span style="color: #483d8b;">id</span>(x), x)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 1788996832768 []
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2 1788996845440 [1]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 3 1788996419520 [1, 1]</span>
</pre>
</div>

<pre class="example" id="org49c0df0">
x += [1] 和 x = x + [1] 不一样
x += [1] 就地修改
x = x + [1] 生成一个新对象覆盖x
</pre>

<p>
列表的 + 和 += 的区别：
</p>
<ul class="org-ul">
<li>+表示两个列表合并并返回一个全新的列表</li>
<li>+=表示，就地修改前一个列表，在其后追加后一个列表。就是extend方法</li>
</ul>


<p>
对于不可变类型 += 是什么？ 可变类型 += 又是什么？
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a0522d;">a</span> = <span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">range</span>(2))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(a), a)
<span style="color: #a0522d;">a</span> += [10] <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25193;&#23637;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(a), a) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22320;&#22336;&#27809;&#21464;
</span><span style="color: #a0522d;">a</span> = a + [20] <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#26032;&#21015;&#34920;&#65292;&#35206;&#30422;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(a), a) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22320;&#22336;&#21464;&#20102;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2165479670400 [0, 1]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2165479670400 [0, 1, 10]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2165479656960 [0, 1, 10, 20]
</span>

<span style="color: #a0522d;">a</span> = <span style="color: #483d8b;">tuple</span>(<span style="color: #483d8b;">range</span>(2))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(a), a)
<span style="color: #a0522d;">a</span> += (10,) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#20110;&#19981;&#21487;&#21464;&#31867;&#22411;&#20803;&#32452;&#26469;&#35762;&#65292;&#23558; += &#36716;&#21464;&#20026; a = a + (10,)
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(a), a) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22320;&#22336;&#21464;&#20102;
</span><span style="color: #a0522d;">a</span> = a + (20,)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(a), a) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22320;&#22336;&#21464;&#20102;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2165479670336 (0, 1)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2165479519936 (0, 1, 10)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2165479604768 (0, 1, 10, 20)
</span>
<span style="color: #a0522d;">x</span> = 1
<span style="color: #a0522d;">x</span> += 1 <span style="color: #b22222;"># </span><span style="color: #b22222;">x += 1 =&gt; x = x + 1</span>
</pre>
</div>


<pre class="example" id="org88fc188">
对于不可变类型 += 是转变成 = +

对于可变类型 += 分为就地修改和覆盖
</pre>
</div>
</div>
<div id="outline-container-h:a1593c26-9803-4caf-a733-0db0cb2a826e" class="outline-4">
<h4 id="h:a1593c26-9803-4caf-a733-0db0cb2a826e">变量名解析原则LEGB***</h4>
<div class="outline-text-4" id="text-h:a1593c26-9803-4caf-a733-0db0cb2a826e">
<ul class="org-ul">
<li>Local，本地作用域、局部作用域的local命名空间。函数调用时创建，调用结束消亡</li>
<li>Enclosing，Python2.2时引入了嵌套函数，实现了闭包，这个就是嵌套函数的外部函数的命名空间</li>
<li>Global，全局作用域，即一个模块的命名空间。模块被import时创建，解释器退出时消亡</li>
<li>Build-in，内置模块的命名空间，生命周期从python解释器启动时创建到解释器退出时消亡。例如print(open)，print和open都是内置的变量</li>
</ul>

<p>
所以一个名词的查找顺序就是LEGB
</p>


<figure id="org3d5bdee">
<img src="./images/Snipaste_2023-06-07_09-54-20.png" alt="Snipaste_2023-06-07_09-54-20.png" width="50%">

</figure>
</div>
</div>
<div id="outline-container-h:9e4a921f-9684-406f-a662-a350a7cc4326" class="outline-4">
<h4 id="h:9e4a921f-9684-406f-a662-a350a7cc4326">函数的销毁</h4>
<div class="outline-text-4" id="text-h:9e4a921f-9684-406f-a662-a350a7cc4326">
<p>
定义一个函数就是生成一个函数对象，函数名指向的就是函数对象。
</p>

<p>
可以使用del语句删除函数，使其引用计数减1。
</p>

<p>
可以使用同名标识符覆盖原有定义，本质上也是使其引用计数减1。
</p>

<p>
Python程序结束时，所有对象销毁。
</p>

<p>
函数也是对象，也不例外，是否销毁，还是看引用计数是否减为0。
</p>



<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">内建函数</td>
<td class="org-left">函数签名</td>
<td class="org-left">说明</td>
</tr>

<tr>
<td class="org-left">iter</td>
<td class="org-left">iter(iterable)</td>
<td class="org-left">把一个可迭代对象包装成迭代器</td>
</tr>

<tr>
<td class="org-left">next</td>
<td class="org-left">next(iterable[,default])</td>
<td class="org-left">取迭代器下一个元素。如果已经取完，继续取抛StopIteration异常</td>
</tr>

<tr>
<td class="org-left">reversed</td>
<td class="org-left">reversed(seq)</td>
<td class="org-left">返回一个翻转元素的迭代器</td>
</tr>

<tr>
<td class="org-left">enumerate</td>
<td class="org-left">enumerate(seq,start=0)</td>
<td class="org-left">迭代一个可迭代对象，返回一个迭代器。每一个元素都是数字和元素构成的二元组</td>
</tr>
</tbody>
</table>

<p>
迭代器
</p>
<ul class="org-ul">
<li>特殊的对象，一定是可迭代对象，具备可迭代对象的特征</li>
<li>通过iter方法把一个可迭代对象封装成迭代器</li>
<li>通过next方法，获取 迭代器对象的一个元素</li>
<li>生成器对象，就是迭代器对象。但是迭代器对象未必是生成器对象</li>
</ul>

<p>
可迭代对象
</p>
<ul class="org-ul">
<li>能够通过迭代一次次返回不同的元素的对象
<ul class="org-ul">
<li>所谓相同，不是指值是否相同，而是元素在容器中是否是同一个，例如列表中值可以重复的，['a', 'a']，虽然这个列表有2个元素，值一样，但是两个'a'是不同的元素</li>
</ul></li>
<li>可以迭代，但是未必有序，未必可索引</li>
<li>可迭代对象有：list、tuple、string、bytes、bytearray、range、set、dict、生成器、迭代器等</li>
<li>可以使用成员操作符in、not in</li>
<li>对于线性数据结构，in本质上是在遍历对象，时间复杂度为O(n)</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">lst</span> = [1, 3, 5, 7, 9]

<span style="color: #a0522d;">it</span> = <span style="color: #483d8b;">iter</span>(lst) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#19968;&#20010;&#36845;&#20195;&#22120;&#23545;&#35937;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(it))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(it))

<span style="color: #a020f0;">for</span> i, x <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">enumerate</span>(it, 2):
    <span style="color: #483d8b;">print</span>(i, x)
<span style="color: #b22222;">#</span><span style="color: #b22222;">print(next(it)) # StopIteration
</span><span style="color: #483d8b;">print</span>()

<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">reversed</span>(lst):
    <span style="color: #483d8b;">print</span>(x)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#27604;&#36739;&#19979;&#38754;&#30340;&#21306;&#21035;&#65292;&#35828;&#26126;&#21407;&#22240;&#65311;
</span><span style="color: #a0522d;">it</span> = <span style="color: #483d8b;">iter</span>(lst)
<span style="color: #483d8b;">print</span>(1 <span style="color: #a020f0;">in</span> it)
<span style="color: #483d8b;">print</span>(1 <span style="color: #a020f0;">in</span> it)
<span style="color: #483d8b;">print</span>(1 <span style="color: #a020f0;">in</span> lst)
<span style="color: #483d8b;">print</span>(1 <span style="color: #a020f0;">in</span> lst)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:51a257f0-78e6-415d-a1bb-586431d7d462" class="outline-3">
<h3 id="h:51a257f0-78e6-415d-a1bb-586431d7d462">匿名函数</h3>
<div class="outline-text-3" id="text-h:51a257f0-78e6-415d-a1bb-586431d7d462">
<p>
python 中，使用 Lambda表达式构建匿名函数。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">lambda</span> : 0
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a0522d;">fn</span> = <span style="color: #a020f0;">lambda</span> : 0  <span style="color: #b22222;"># </span><span style="color: #b22222;">python &#19981;&#22826;&#25512;&#33616;
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(x):
    <span style="color: #a0522d;">x</span> += 1
    <span style="color: #a020f0;">return</span> x


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(x):
    <span style="color: #a020f0;">return</span> x + 1

<span style="color: #a0522d;">fn</span> = <span style="color: #a020f0;">lambda</span> x: x + 1 <span style="color: #b22222;"># </span><span style="color: #b22222;">lambda&#20013;&#19981;&#33021;&#20986;&#29616;=&#65292;&#26356;&#19981;&#33021;&#20986;&#29616; return&#65292;&#20882;&#21495;&#21518;&#26159;&#19968;&#20010;&#34920;&#36798;&#24335;&#65292;&#34920;&#36798;&#24335;&#35745;&#31639;&#30340;&#32467;&#26524;&#20316;&#20026;&#35813;&#21311;&#21517;&#20989;&#25968;&#30340;&#36820;&#22238;&#20540;
</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>( (<span style="color: #a020f0;">lambda</span> x,y: x + y)(4, 5) )
<span style="color: #483d8b;">print</span>( (<span style="color: #a020f0;">lambda</span> x,y=2: x + y)(x=3) )
<span style="color: #483d8b;">print</span>( (<span style="color: #a020f0;">lambda</span> *,x,y: x + y)(x=3,y=5) ) <span style="color: #b22222;"># </span><span style="color: #b22222;">lambda&#34920;&#36798;&#24335;&#65292;&#19968;&#33324;&#19981;&#36825;&#26679;&#29992;&#65292;&#29992;&#22312;&#39640;&#38454;&#20989;&#25968;&#20013;&#12290;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 5
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 8
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">print( [lambda *args: args](4, 5, 6) ) #&#25253;&#38169;
</span><span style="color: #483d8b;">print</span>( [<span style="color: #a020f0;">lambda</span> *args: args][0](4, 5, 6) )
<span style="color: #b22222;">#</span><span style="color: #b22222;">: (4, 5, 6)
</span>
<span style="color: #a0522d;">g</span> = (<span style="color: #a020f0;">lambda</span> *args: (x <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> args))(1,2,3) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#22120;&#23545;&#35937;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(g))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(g))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 1
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2
</span>
<span style="color: #a020f0;">import</span> random
<span style="color: #a0522d;">g2</span> = (<span style="color: #a020f0;">lambda</span> *args: {x%3 <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> args})(*[random.randint(1, 1000) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5)]) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38598;&#21512;set&#20250;&#21435;&#37325;
</span><span style="color: #483d8b;">print</span>(g2)
</pre>
</div>

<p>
lambda函数应用：
</p>
<ul class="org-ul">
<li>高阶函数</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#23383;&#31526;&#20018;&#27604;&#36739;
</span><span style="color: #a0522d;">s</span> = <span style="color: #483d8b;">sorted</span>([<span style="color: #8b2252;">'a'</span>, 1, <span style="color: #8b2252;">'b'</span>, 12, <span style="color: #8b2252;">'c'</span>, 28], key=<span style="color: #483d8b;">str</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#27599;&#19968;&#20010;&#20803;&#32032;&#20570;str(item)&#65292;&#25509;&#25910;&#19968;&#20010;&#21442;&#25968;&#65292;&#36820;&#22238;&#19968;&#20010;&#23383;&#31526;&#20018;
</span><span style="color: #483d8b;">print</span>(s)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: [1, 12, 28, 'a', 'b', 'c']
</span>
<span style="color: #a0522d;">s</span> = <span style="color: #483d8b;">sorted</span>([<span style="color: #8b2252;">'a'</span>, 1, <span style="color: #8b2252;">'b'</span>, 12, <span style="color: #8b2252;">'c'</span>, 28], key=<span style="color: #a020f0;">lambda</span> item: <span style="color: #483d8b;">str</span>(item)) 
<span style="color: #483d8b;">print</span>(s)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: [1, 12, 28, 'a', 'b', 'c']
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">16&#36827;&#21046;&#27604;&#36739;&#22823;&#23567;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">a</span>(x):
    <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">int</span>(x, 16) <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(x, <span style="color: #483d8b;">str</span>) <span style="color: #a020f0;">else</span> x
<span style="color: #a0522d;">s</span> = <span style="color: #483d8b;">sorted</span>([<span style="color: #8b2252;">'a'</span>, 1, <span style="color: #8b2252;">'b'</span>, 12, <span style="color: #8b2252;">'c'</span>, 28], key=a) 
<span style="color: #483d8b;">print</span>(s)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: [1, 'a', 'b', 12, 'c', 28]
</span>
<span style="color: #a0522d;">s</span> = <span style="color: #483d8b;">sorted</span>([<span style="color: #8b2252;">'a'</span>, 1, <span style="color: #8b2252;">'b'</span>, 12, <span style="color: #8b2252;">'c'</span>, 28], key=<span style="color: #a020f0;">lambda</span> x: <span style="color: #483d8b;">int</span>(x, 16) <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(x, <span style="color: #483d8b;">str</span>) <span style="color: #a020f0;">else</span> x) 
<span style="color: #483d8b;">print</span>(s)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: [1, 'a', 'b', 12, 'c', 28]
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">int</span>(<span style="color: #8b2252;">'a'</span>, 16)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;16&#36827;&#21046;&#25968; a &#36716;&#21464;&#20026;10&#36827;&#21046;&#25968;&#65292;&#20026;10</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">from</span> collections <span style="color: #a020f0;">import</span> defaultdict
<span style="color: #a0522d;">d</span> = defaultdict(<span style="color: #483d8b;">list</span>)
d[0].extend((1,2,3))
<span style="color: #483d8b;">print</span>(d)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: defaultdict(&lt;class 'list'&gt;, {0: [1, 2, 3]})
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#20215;&#20110;
</span><span style="color: #a020f0;">from</span> collections <span style="color: #a020f0;">import</span> defaultdict
<span style="color: #a0522d;">d</span> = defaultdict(<span style="color: #a020f0;">lambda</span> :[]) <span style="color: #b22222;"># </span><span style="color: #b22222;">(lambda :[])()
</span>d[0].extend((1,2,3)) <span style="color: #b22222;">#</span><span style="color: #b22222;">: 0:[]  (lambda :list())() =&gt; []
</span><span style="color: #483d8b;">print</span>(d)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: defaultdict(&lt;function &lt;lambda&gt; at 0x00000297BC826280&gt;, {0: [1, 2, 3]})</span>
</pre>
</div>

<ul class="org-ul">
<li>使用lambda关键字定义匿名函数，格式为 <code>lambda [参数列表]: 表达式</code></li>
<li>参数列表不需要小括号。无参数就不写</li>
<li>冒号用来分割参数列表和表达式部分</li>
<li>不需要使用return。表达式的值，就是匿名函数的返回值。表达式中不能出现等号</li>
<li>lambda表达式(匿名函数) <b>只能写在一行上</b> ，也称为单行函数</li>
</ul>
</div>
</div>
<div id="outline-container-h:d819a71c-37f8-4fdb-8df3-f916a8e4b3c9" class="outline-3">
<h3 id="h:d819a71c-37f8-4fdb-8df3-f916a8e4b3c9">递归函数</h3>
<div class="outline-text-3" id="text-h:d819a71c-37f8-4fdb-8df3-f916a8e4b3c9">
</div>
<div id="outline-container-h:c18765e7-3b34-4c92-b668-fdae10ab7613" class="outline-4">
<h4 id="h:c18765e7-3b34-4c92-b668-fdae10ab7613">函数执行流程</h4>
<div class="outline-text-4" id="text-h:c18765e7-3b34-4c92-b668-fdae10ab7613">
<p>
函数的活动和栈有关。
</p>

<p>
栈是后进先出的数据结构。
</p>

<p>
栈是从底向顶端生长，栈中插入数据称为压栈、入栈，从栈顶弹出数据称为出栈。
</p>

<p>
C语言中，每个栈帧对应着一个未运行完的函数。栈帧中保存了该函数的返回地址和局部变量。
</p>

<p>
函数的每一次调用都会创建一个独立的栈帧(Stack Frame)入栈。
</p>

<p>
因此，可以得到这样一句 <b>不准确</b> 的话： 哪怕是同一个函数两次调用，每一次调用都是独立的，这两次调用没什么关系。
</p>

<p>
注： 函数执行过程辅助网站： <a href="http://pythontutor.com/visualize.html">http://pythontutor.com/visualize.html</a>，请不要过分依赖这个网站
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo1</span>(b, b1=3):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"foo1 called"</span>, b, b1)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo2</span>(c):
    foo3(c)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"foo2 called"</span>, c)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo3</span>(d):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"foo3 called"</span>, d)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">main</span>():
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"main called"</span>)
    foo1(100,101)
    foo2(200)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"main ending"</span>)

main()
<span style="color: #b22222;">#</span><span style="color: #b22222;">: main called
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: foo1 called 100 101
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: foo3 called 200
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: foo2 called 200
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: main ending</span>
</pre>
</div>

<p>
栈
</p>
<pre class="example" id="orga129e3b">
foo3
foo2
main
&lt;moudule&gt;
</pre>
</div>
</div>
<div id="outline-container-h:81ac7907-acc2-4c9d-bf4f-da340eebff25" class="outline-4">
<h4 id="h:81ac7907-acc2-4c9d-bf4f-da340eebff25">递归</h4>
<div class="outline-text-4" id="text-h:81ac7907-acc2-4c9d-bf4f-da340eebff25">
<p>
RECURSION
</p>

<ul class="org-ul">
<li>函数直接或者间接调用自身就是递归</li>
<li>递归需要有边界条件、递归前进段、递归返回段</li>
<li>递归一定要有 <code>边界条件</code></li>
<li>当边界条件不满足的时候，递归前进</li>
<li>当边界条件满足的时候，递归返回</li>
</ul>
</div>
</div>
<div id="outline-container-h:5939972a-7658-4d82-b11b-e8f5f2bbce5c" class="outline-4">
<h4 id="h:5939972a-7658-4d82-b11b-e8f5f2bbce5c">斐波那契数列递归</h4>
<div class="outline-text-4" id="text-h:5939972a-7658-4d82-b11b-e8f5f2bbce5c">
<p>
斐波那契数列Fibonacci number: 1, 1, 2, 3, 5, 8, 13,&#x2026;
</p>

<p>
如果设F(n) 为该数列的第n项( \(n \epsilon n^*\) )，那么这句话可以写成如下形式：F(n)=F(n-1)+F(n-2)
</p>

<p>
有F(0)=0, F(1)=1, F(n)=F(n-1)+F(n-2)
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fib</span>(n):
    <span style="color: #b22222;">#</span><span style="color: #b22222;">a, b = 1, 1
</span>    <span style="color: #a0522d;">a</span> = <span style="color: #a0522d;">b</span> = 1
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(n-2): <span style="color: #b22222;">#</span><span style="color: #b22222;">fib(3) &#24490;&#29615;&#19968;&#19979;
</span>        <span style="color: #a0522d;">a</span>, <span style="color: #a0522d;">b</span> = b, a+b
    <span style="color: #a020f0;">return</span> b

<span style="color: #483d8b;">print</span>(fib(3))
</pre>
</div>


<p>
使用递归
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fib2</span>(n): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36882;&#24402;
</span>    <span style="color: #a020f0;">return</span> fib2(n-1) + fib2(n-2) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36882;&#24402;&#24517;&#38656;&#26377;&#36793;&#30028;&#65292;&#22240;&#20026;&#26632;&#31354;&#38388;&#26377;&#38480;&#12290;
</span>
fib(3) <span style="color: #b22222;"># </span><span style="color: #b22222;">RecursionError &#36882;&#24402;&#24322;&#24120;&#65292;maximum recursion depth exceeded, &#36882;&#24402;&#23618;&#27425;&#22826;&#28145;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26632;&#36229;&#30028;&#65292;Python &#20013;&#20026;&#20102;&#38450;&#27490;&#26632;&#28322;&#20986;&#65292;&#25552;&#20379;&#20102;&#35843;&#29992;&#28145;&#24230;&#38480;&#21046;&#65292;&#40664;&#35748;1000&#65292;IPython 3000</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fib2</span>(n): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36882;&#24402;
</span>    <span style="color: #a020f0;">if</span> n &lt; 3:
        <span style="color: #a020f0;">return</span> 1
    <span style="color: #a020f0;">return</span> fib2(n-1) + fib2(n-2) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36882;&#24402;&#24517;&#38656;&#26377;&#36793;&#30028;&#65292;&#22240;&#20026;&#26632;&#31354;&#38388;&#26377;&#38480;
</span>
<span style="color: #483d8b;">print</span>(fib2(3))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:8f95c492-4e88-4f2d-8670-dc885f28ff0d" class="outline-4">
<h4 id="h:8f95c492-4e88-4f2d-8670-dc885f28ff0d">递归要求</h4>
<div class="outline-text-4" id="text-h:8f95c492-4e88-4f2d-8670-dc885f28ff0d">
<ul class="org-ul">
<li>递归一定要有退出条件，递归调用一定要执行到这个退出条件。没有退出条件的递归调用，就是无限调用</li>
<li>递归调用的深度不宜过深
<ul class="org-ul">
<li>Python 对递归调用的深度做了限制，以保护解释器</li>
<li>超过递归深度限制，抛出RecursionError: maxinum recursion depth exceeded 超出最大深度</li>
<li>sys.getrecursionlimit() 查看深度限制</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-h:f051a72d-1ede-444e-8625-5583b447a903" class="outline-4">
<h4 id="h:f051a72d-1ede-444e-8625-5583b447a903">递归效率</h4>
<div class="outline-text-4" id="text-h:f051a72d-1ede-444e-8625-5583b447a903">
<ul class="org-ul">
<li>循环稍微复杂一些，但是只要不是死循环，可以多次迭代直至算出结果。</li>
<li>fib函数代码极简易懂，但是只能获取到最外层的函数调用，内部递归结果都是中间结果。而且给定一个n都要进行近2n次递归，尝试越深，效率越低。为了获取斐波那契数列需要外面在套一个n次的循环就是更低了。</li>

<li>递归还有深度限制，如果递归复杂，函数反复压栈，栈内存很快溢出了。</li>
</ul>

<p>
思考：这个极简的递归代码能否提高性能呢？？
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fib_v3</span>(n, a=1, b=1):  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#36882;&#24402;&#35843;&#29992;&#27425;&#25968;&#26469;&#27169;&#25311;&#24490;&#29615;&#27425;&#25968;
</span>    <span style="color: #a020f0;">if</span> n &lt; 3:
        <span style="color: #a020f0;">return</span> b <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32047;&#35745;&#35745;&#31639;&#32467;&#26524;
</span>    <span style="color: #a0522d;">a</span>, <span style="color: #a0522d;">b</span> = b, a+b
    <span style="color: #a020f0;">return</span> fib_v3(n-1, a, b)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fib_v3</span>(n, a=1, b=1):  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#36882;&#24402;&#35843;&#29992;&#27425;&#25968;&#26469;&#27169;&#25311;&#24490;&#29615;&#27425;&#25968;
</span>    <span style="color: #a020f0;">if</span> n &lt; 3:
        <span style="color: #a020f0;">return</span> b <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32047;&#35745;&#35745;&#31639;&#32467;&#26524;
</span>    <span style="color: #a020f0;">return</span> fib_v3(n-1, b, a+b)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fib_v3</span>(n, a=1, b=1):  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#36882;&#24402;&#35843;&#29992;&#27425;&#25968;&#26469;&#27169;&#25311;&#24490;&#29615;&#27425;&#25968;
</span>    <span style="color: #a020f0;">if</span> n &lt; 3:
        <span style="color: #a020f0;">return</span> b <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32047;&#35745;&#35745;&#31639;&#32467;&#26524;
</span>    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">return</span> fib_v3(n-1, b, a+b)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fib_v3</span>(n, a=1, b=1):  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#36882;&#24402;&#35843;&#29992;&#27425;&#25968;&#26469;&#27169;&#25311;&#24490;&#29615;&#27425;&#25968;
</span>    <span style="color: #a020f0;">if</span> n &lt; 3:
        <span style="color: #a020f0;">return</span> b <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32047;&#35745;&#35745;&#31639;&#32467;&#26524;
</span>    <span style="color: #a020f0;">return</span> b <span style="color: #a020f0;">if</span> n&lt;3 <span style="color: #a020f0;">else</span> fib_v3(n-1, b, a+b)

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(3, 10):
    <span style="color: #483d8b;">print</span>(i, fib_v3(i))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 3 2
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 4 3
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 5 5
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 6 8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 7 13
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 8 21
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 9 34</span>
</pre>
</div>

<pre class="example" id="org9c4d4a3">
def fib(n):
    #a, b = 1, 1
    a = b = 1
    for i in range(n-2): #fib(3) 循环一下
        a, b = b, a+b
    return b


def fib_v3(n, a=1, b=1):  #用递归调用次数来模拟循环次数
    if n &lt; 3:
        return b # 累计计算结果
    return b if n&lt;3 else fib_v3(n-1, b, a+b)

%%timeit n=101
fib(n) # 8.62us


%%timeit n=101
fib_v3(n) #28.5us 时间消耗在压栈
</pre>
</div>
</div>
<div id="outline-container-h:8a288237-54c5-46e5-b88d-812ea5dc3664" class="outline-4">
<h4 id="h:8a288237-54c5-46e5-b88d-812ea5dc3664">间接递归</h4>
<div class="outline-text-4" id="text-h:8a288237-54c5-46e5-b88d-812ea5dc3664">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo1</span>():
    foo2()

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo2</span>():
    foo1()

foo1()
</pre>
</div>

<p>
间接递归调用，是函数通过别的函数调用了自己，这样是递归。
</p>

<p>
只要是递归调用，不管是直接还是间接，都要注意边界返回问题。但是间接递归调用有时候是非常明显，代码调用复杂时，很难发现出现了递归调用，这是非常危险的。
</p>

<p>
所以，使用良好的代码规范来避免这种递归的发生。
</p>
</div>
</div>
<div id="outline-container-h:ae86a78f-85be-4eda-87f8-f59c58bda5fc" class="outline-4">
<h4 id="h:ae86a78f-85be-4eda-87f8-f59c58bda5fc">总结</h4>
<div class="outline-text-4" id="text-h:ae86a78f-85be-4eda-87f8-f59c58bda5fc">
<ul class="org-ul">
<li>递归是一种很自然的表达，符合逻辑思维</li>
<li>递归相对运行效率低，每一次调用函数都要开辟栈帧</li>
<li>递归有深度限制，如果递归层次太深，函数连续压栈，栈内存很快就溢出了</li>
<li>如果是有限次数的递归，可以使用递归调用，或者使用循环代替，循环代码稍微复杂一些，但是只要不是死循环，可以多次迭代直至算出结果</li>
<li>即使递归代码很简洁，但是 <b>能不用则不用递归</b></li>
</ul>
</div>
</div>
<div id="outline-container-h:f8f44951-7431-40dc-a01a-9931b374f642" class="outline-4">
<h4 id="h:f8f44951-7431-40dc-a01a-9931b374f642">练习</h4>
<div class="outline-text-4" id="text-h:f8f44951-7431-40dc-a01a-9931b374f642">
<p>
使用递归实现
</p>

<ul class="org-ul">
<li>求n的阶乘</li>
<li>将一个数逆序放入列表中，例如1234 =&gt; [4,3,2,1]</li>
<li><p>
解决猴子吃桃问题
</p>

<p>
猴子第一天摘下若干个桃子，当即吃了一半，还不过瘾，又多吃了一个。第二天早上又将剩下的桃子吃掉一半，又多吃了一个。以后每天早上都吃了前一天剩下的一半零一个。到第 10 天早上想吃时，只剩下一个桃子了。求第一天共摘多少个桃子。
</p></li>
</ul>


<p>
递归的解法，一般来说有2种：
</p>
<ol class="org-ol">
<li>一种如同数学公式</li>
<li>一种类似循环，相当于循环的改版，将循环迭代，变成了函数调用压栈</li>
</ol>
</div>
<div id="outline-container-h:85e5fb59-3fa4-490c-b492-676eebc6d01e" class="outline-5">
<h5 id="h:85e5fb59-3fa4-490c-b492-676eebc6d01e">求n的阶乘</h5>
<div class="outline-text-5" id="text-h:85e5fb59-3fa4-490c-b492-676eebc6d01e">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#38454;&#20056;&#20844;&#24335;&#12290;&#19977;&#20803;&#34920;&#36798;&#24335;
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">factorial</span>(n):
<span style="color: #b22222;">#    </span><span style="color: #b22222;">if n == 1:
</span><span style="color: #b22222;">#        </span><span style="color: #b22222;">return 1
</span><span style="color: #b22222;">#    </span><span style="color: #b22222;">elif n == 2:
</span><span style="color: #b22222;">#        </span><span style="color: #b22222;">return 2
</span><span style="color: #b22222;">#    </span><span style="color: #b22222;">if n == 2:
</span><span style="color: #b22222;">#        </span><span style="color: #b22222;">return 2
</span>    <span style="color: #a020f0;">if</span> n &lt; 3:
        <span style="color: #a020f0;">return</span> n
    <span style="color: #a020f0;">return</span> n * factorial(n-1) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20844;&#24335;
</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">factorial</span>(n):
    <span style="color: #a020f0;">return</span> n <span style="color: #a020f0;">if</span> n &lt; 3 <span style="color: #a020f0;">else</span> n * factorial(n-1)

<span style="color: #483d8b;">print</span>(factorial(3))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#24490;&#29615;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">factorial</span>(n=6):
    <span style="color: #a0522d;">p</span> = 1
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(1, n+1):
        <span style="color: #a0522d;">p</span> *= i
    <span style="color: #a020f0;">return</span> p

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">factorial</span>(n=6, p=1): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#19978;&#27425;&#32467;&#26524;&#24102;&#20837;
</span>    <span style="color: #a020f0;">if</span> n == 1:
        <span style="color: #a020f0;">return</span> p
    <span style="color: #a020f0;">return</span> factorial(n-1, p * n)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">factorial</span>(n=6, p=1): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#19978;&#27425;&#32467;&#26524;&#24102;&#20837;
</span>    <span style="color: #a020f0;">return</span> p <span style="color: #a020f0;">if</span> n == 1 <span style="color: #a020f0;">else</span> factorial(n-1, p * n)

<span style="color: #483d8b;">print</span>(factorial(6))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:97e1763f-9fa9-4300-885d-821abd3b8660" class="outline-5">
<h5 id="h:97e1763f-9fa9-4300-885d-821abd3b8660">解决猴子吃桃问题</h5>
<div class="outline-text-5" id="text-h:97e1763f-9fa9-4300-885d-821abd3b8660">
<p>
猴子第一天摘下若干个桃子，当即吃了一半，还不过瘾，又多吃了一个。第二天早上又将剩下的桃子吃掉一半，又多吃了一个。以后每天早上都吃了前一天剩下的一半零一个。到第 10 天早上想吃时，只剩下一个桃子了。求第一天共摘多少个桃子。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#24490;&#29615;&#29256;&#26412;
</span><span style="color: #a020f0;">def</span>  <span style="color: #0000ff;">peach</span>():
    <span style="color: #a0522d;">total</span> = 1
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(9):
        <span style="color: #a0522d;">total</span> = 2*(total + 1)
    <span style="color: #a020f0;">return</span> total

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36882;&#24402;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">peach</span>(days=10):
    <span style="color: #a020f0;">if</span> days == 1:
        <span style="color: #a020f0;">return</span> 1
    <span style="color: #a020f0;">return</span> 2 * (peach(days-1) + 1)

<span style="color: #483d8b;">print</span>(peach())
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 1534</span>
</pre>
</div>

<p>
注意这里必须是10
</p>

<p>
从10到2做了9次， return(peach(days-1) +1)*2 计算，但是还没有边界，再进入函数后立即触发等于1条件返回，所以实际上执行了9次计算，第10次只是为了进函数触发反弹的。
</p>

<p>
换种方式表达
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">peach</span>(days=1):
    <span style="color: #a020f0;">if</span> days == 10:
        <span style="color: #a020f0;">return</span> 1
    <span style="color: #a020f0;">return</span> 2 * (peach(days+1) +1)

<span style="color: #483d8b;">print</span>(peach()) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31532;10&#19979;&#21482;&#26159;&#20026;&#20102;&#36827;&#20837;&#20989;&#25968;&#35299;&#24213;&#21453;&#24377;&#30340;
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">peach</span>(days=9, p=1):
    <span style="color: #a020f0;">if</span> days == 0:
        <span style="color: #a020f0;">return</span> p
    <span style="color: #a020f0;">return</span> peach(days-1, 2*(p+1))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c47deb52-1968-46b3-997a-f31ba08703fb" class="outline-5">
<h5 id="h:c47deb52-1968-46b3-997a-f31ba08703fb">将一个数逆序放入列表中</h5>
<div class="outline-text-5" id="text-h:c47deb52-1968-46b3-997a-f31ba08703fb">
<p>
例如1234 =&gt; [4,3,2,1]
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20869;&#24314;&#20989;&#25968;&#23454;&#29616;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">map</span>(<span style="color: #483d8b;">int</span>, <span style="color: #483d8b;">reversed</span>(<span style="color: #483d8b;">str</span>(1234)))))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: [4, 3, 2, 1]
</span>
<span style="color: #a0522d;">x</span> = 1234
<span style="color: #a020f0;">while</span> x != 0:
    <span style="color: #a0522d;">x</span>, <span style="color: #a0522d;">y</span> = <span style="color: #483d8b;">divmod</span>(x, 10)
    <span style="color: #483d8b;">print</span>(x, y)
    <span style="color: #483d8b;">print</span>(y, <span style="color: #8b2252;">'~~'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23383;&#31526;&#20018;&#36882;&#24402;&#20999;&#29255;
</span><span style="color: #a0522d;">x</span> = <span style="color: #483d8b;">str</span>(1234)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">revert</span>(data):
    <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> data:
        <span style="color: #a020f0;">return</span> []
    <span style="color: #a020f0;">return</span> [data[-1]] + revert(data[:-1])

<span style="color: #483d8b;">print</span>(revert(x))
<span style="color: #b22222;">#</span><span style="color: #b22222;">['4', '3', '2', '1']
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23383;&#31526;&#20018;
</span><span style="color: #a0522d;">x</span> = <span style="color: #483d8b;">str</span>(1234)

<span style="color: #a0522d;">target</span> = []

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">revert</span>(data):

    <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> data:
        <span style="color: #a020f0;">return</span>
    target.append(data[-1])
    <span style="color: #a020f0;">return</span> revert(data[:-1])

revert(x)
<span style="color: #483d8b;">print</span>(target)
<span style="color: #b22222;">#</span><span style="color: #b22222;">['4', '3', '2', '1']
</span><span style="color: #a020f0;">del</span> target

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23383;&#31526;&#20018;
</span><span style="color: #a0522d;">x</span> = <span style="color: #483d8b;">str</span>(1234)
<span style="color: #b22222;">#</span><span style="color: #b22222;">target = []
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">revert</span>(data, target=[]):
    <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> data:
        <span style="color: #a020f0;">return</span> target
    target.append(data[-1])
    <span style="color: #a020f0;">return</span> revert(data[:-1], target)
<span style="color: #483d8b;">print</span>(revert(x))
<span style="color: #b22222;">#</span><span style="color: #b22222;">['4', '3', '2', '1']
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25968;&#20540;
</span><span style="color: #a0522d;">x</span> = 123045
<span style="color: #a0522d;">x</span> = 100

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">revert</span>(data, target=[]):
    <span style="color: #a020f0;">if</span> data == 0:
        <span style="color: #a020f0;">return</span> target
    <span style="color: #a0522d;">x</span>, <span style="color: #a0522d;">y</span> = <span style="color: #483d8b;">divmod</span>(data, 10) <span style="color: #b22222;">#</span><span style="color: #b22222;">10 0; 1 0; 0 1
</span>    target.append(y)
    <span style="color: #a020f0;">return</span> revert(x, target)

<span style="color: #483d8b;">print</span>(revert(x))


<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25968;&#20540;
</span><span style="color: #a0522d;">x</span> = 123045

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">revert</span>(data, target=<span style="color: #008b8b;">None</span>):
    <span style="color: #a020f0;">if</span> target <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
        <span style="color: #a0522d;">target</span> = []
    <span style="color: #a020f0;">if</span> data == 0:
        <span style="color: #a020f0;">return</span> target
    <span style="color: #a0522d;">x</span>, <span style="color: #a0522d;">y</span> = <span style="color: #483d8b;">divmod</span>(data, 10) <span style="color: #b22222;">#</span><span style="color: #b22222;">10 0; 1 0; 0 1
</span>    target.append(y)
    <span style="color: #a020f0;">return</span> revert(x, target)

<span style="color: #483d8b;">print</span>(revert(x))
<span style="color: #483d8b;">print</span>(revert(x, <span style="color: #008b8b;">None</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">[5, 4, 0, 3, 2, 1]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:9e68a05e-2660-4a7d-9247-106987d690fb" class="outline-5">
<h5 id="h:9e68a05e-2660-4a7d-9247-106987d690fb">扁平化字典</h5>
<div class="outline-text-5" id="text-h:9e68a05e-2660-4a7d-9247-106987d690fb">
<p>
例如，源字典 {'a':{'b':1, 'c':2}, 'd':{'e':3, 'f':{'g':4}}}
目标字典 {'a.c':2, 'd.e':3, 'd.f.g':4, 'a.b':1}
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a0522d;">d</span> = {<span style="color: #8b2252;">'a'</span>:{<span style="color: #8b2252;">'b'</span>:1, <span style="color: #8b2252;">'c'</span>:2}, <span style="color: #8b2252;">'d'</span>:{<span style="color: #8b2252;">'e'</span>:3, <span style="color: #8b2252;">'f'</span>:{<span style="color: #8b2252;">'g'</span>:4}}}

<span style="color: #a0522d;">target</span> = {}

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">flat_map</span>(src:<span style="color: #483d8b;">dict</span>): <span style="color: #b22222;"># </span><span style="color: #b22222;">:dict&#21442;&#25968;&#27880;&#35299;&#65292;&#35828;&#26126;src&#30340;&#31867;&#22411;&#65292;&#20294;&#19981;&#24378;&#21046;
</span>    <span style="color: #a020f0;">for</span> k, v <span style="color: #a020f0;">in</span> src.items():
        <span style="color: #483d8b;">print</span>(k)
        <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(v, <span style="color: #483d8b;">dict</span>):
            <span style="color: #483d8b;">print</span>(v, <span style="color: #8b2252;">'recursion'</span>)
            flat_map(v)
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a0522d;">target</span>[k] = v
<span style="color: #483d8b;">print</span>(flat_map(d))
<span style="color: #483d8b;">print</span>(target)
<span style="color: #b22222;">#</span><span style="color: #b22222;">{'b': 1, 'c': 2, 'e': 3, 'g': 4}
</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25913;&#36827;
</span><span style="color: #a0522d;">d</span> = {<span style="color: #8b2252;">'a'</span>:{<span style="color: #8b2252;">'b'</span>:1, <span style="color: #8b2252;">'c'</span>:2}, <span style="color: #8b2252;">'d'</span>:{<span style="color: #8b2252;">'e'</span>:3, <span style="color: #8b2252;">'f'</span>:{<span style="color: #8b2252;">'g'</span>:4}}}
<span style="color: #b22222;">#</span><span style="color: #b22222;">d = {'h': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">d = {'a': {'b':1}}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">d = {'d': {'f':{'g':4}}}
</span><span style="color: #a0522d;">target</span> = {}

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">flat_map</span>(src:<span style="color: #483d8b;">dict</span>, prefix=<span style="color: #8b2252;">''</span>): <span style="color: #b22222;"># </span><span style="color: #b22222;">:dict&#21442;&#25968;&#27880;&#35299;&#65292;&#35828;&#26126;src&#30340;&#31867;&#22411;&#65292;&#20294;&#19981;&#24378;&#21046;
</span>    <span style="color: #a020f0;">for</span> k, v <span style="color: #a020f0;">in</span> src.items():
        <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(v, <span style="color: #483d8b;">dict</span>):
            flat_map(v, prefix + k + <span style="color: #8b2252;">'.'</span>)
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a0522d;">target</span>[prefix + k] = v

<span style="color: #483d8b;">print</span>(flat_map(d))
<span style="color: #483d8b;">print</span>(target)
<span style="color: #b22222;">#</span><span style="color: #b22222;">None
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">{'a.b': 1, 'a.c': 2, 'd.e': 3, 'd.f.g': 4}
</span><span style="color: #a020f0;">del</span> target

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25913;&#36827;
</span><span style="color: #a0522d;">d</span> = {<span style="color: #8b2252;">'a'</span>:{<span style="color: #8b2252;">'b'</span>:1, <span style="color: #8b2252;">'c'</span>:2}, <span style="color: #8b2252;">'d'</span>:{<span style="color: #8b2252;">'e'</span>:3, <span style="color: #8b2252;">'f'</span>:{<span style="color: #8b2252;">'g'</span>:4}}}
<span style="color: #b22222;">#</span><span style="color: #b22222;">target = {}
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">flat_map</span>(src:<span style="color: #483d8b;">dict</span>, target=<span style="color: #008b8b;">None</span>, prefix=<span style="color: #8b2252;">''</span>): <span style="color: #b22222;"># </span><span style="color: #b22222;">:dict&#21442;&#25968;&#27880;&#35299;&#65292;&#35828;&#26126;src&#30340;&#31867;&#22411;&#65292;&#20294;&#19981;&#24378;&#21046;
</span>    <span style="color: #a020f0;">if</span> target <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
        <span style="color: #a0522d;">target</span> = {}
    <span style="color: #a020f0;">for</span> k, v <span style="color: #a020f0;">in</span> src.items():
        <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(v, <span style="color: #483d8b;">dict</span>):
            flat_map(v, target, prefix + k + <span style="color: #8b2252;">'.'</span>)
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a0522d;">target</span>[prefix + k] = v
    <span style="color: #a020f0;">return</span> target

<span style="color: #483d8b;">print</span>(flat_map(d))
<span style="color: #b22222;">#</span><span style="color: #b22222;">{'a.b': 1, 'a.c': 2, 'd.e': 3, 'd.f.g': 4}
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25913;&#36827;&#65292;&#20351;&#29992;&#37117;&#21482;&#38656;&#35201;&#20256;&#20837;&#19968;&#20010;&#21442;&#25968;&#23601;&#22815;&#20102;
</span>
<span style="color: #a0522d;">d</span> = {<span style="color: #8b2252;">'a'</span>:{<span style="color: #8b2252;">'b'</span>:1, <span style="color: #8b2252;">'c'</span>:2}, <span style="color: #8b2252;">'d'</span>:{<span style="color: #8b2252;">'e'</span>:3, <span style="color: #8b2252;">'f'</span>:{<span style="color: #8b2252;">'g'</span>:4}}}
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">flat_map</span>(src:<span style="color: #483d8b;">dict</span>): <span style="color: #b22222;"># </span><span style="color: #b22222;">:dict&#21442;&#25968;&#27880;&#35299;&#65292;&#35828;&#26126;src&#30340;&#31867;&#22411;&#65292;&#20294;&#19981;&#24378;&#21046;
</span>    <span style="color: #a0522d;">target</span> = {}

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_flat</span>(s:<span style="color: #483d8b;">dict</span>, prefix=<span style="color: #8b2252;">''</span>):
        <span style="color: #a020f0;">for</span> k, v <span style="color: #a020f0;">in</span> s.items():
            <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(v, <span style="color: #483d8b;">dict</span>):
                _flat(v, prefix + k + <span style="color: #8b2252;">'.'</span>)
            <span style="color: #a020f0;">else</span>:
                <span style="color: #a0522d;">target</span>[prefix + k] = v

    _flat(src)
    <span style="color: #a020f0;">return</span> target

<span style="color: #483d8b;">print</span>(flat_map(d))
<span style="color: #b22222;">#</span><span style="color: #b22222;">{'a.b': 1, 'a.c': 2, 'd.e': 3, 'd.f.g': 4}</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:ec7f5561-5ab8-42b9-90e3-eca25103be9a" class="outline-3">
<h3 id="h:ec7f5561-5ab8-42b9-90e3-eca25103be9a">排序算法-直接插入排序</h3>
<div class="outline-text-3" id="text-h:ec7f5561-5ab8-42b9-90e3-eca25103be9a">
<ul class="org-ul">
<li>插入排序
<ul class="org-ul">
<li>每一趟都要把待排序数放到有序区中合适的插入位置</li>
</ul></li>
</ul>


<figure id="orgbef1539">
<img src="./images/img_20240428_161728.png" alt="img_20240428_161728.png" width="50%">

</figure>

<pre class="example" id="orgb6da150">
开头的红色数字为哨兵，即待插入值
从第二个数字开始排序即9
第一趟，哨兵9，1和哨兵比较，1小，哨兵插入，本轮比较结束。1,9有序区，后面为无序区
第二趟，哨兵8，9和哨兵比较，大于哨兵9右移，1和哨兵比较，1小，哨兵插入本轮结束
以此类推，直至把最后一个数字入到哨兵并比较、插入完成
</pre>
</div>
<div id="outline-container-h:bc597534-3964-4d3e-b7ee-4104d9d03a11" class="outline-4">
<h4 id="h:bc597534-3964-4d3e-b7ee-4104d9d03a11">核心算法</h4>
<div class="outline-text-4" id="text-h:bc597534-3964-4d3e-b7ee-4104d9d03a11">
<ul class="org-ul">
<li>结果可为升序或降序排列，默认升序排列。以升序为例</li>
<li>扩大有序区，减小无序区。图中绿色部分就是增大的有序区，黑色部分就是减小的无序区</li>
<li>增加一个哨兵位，图中最左端红色数字，其中放置每一趟待比较数值</li>
<li>将哨兵数值与有序区数值从右到左依次比较，找到哨兵位数值合适的插入点</li>
</ul>
</div>
</div>
<div id="outline-container-h:a478a2bb-ca15-44ac-b815-362e99876e10" class="outline-4">
<h4 id="h:a478a2bb-ca15-44ac-b815-362e99876e10">算法实现</h4>
<div class="outline-text-4" id="text-h:a478a2bb-ca15-44ac-b815-362e99876e10">
<ul class="org-ul">
<li>增加哨兵位
<ul class="org-ul">
<li>为了方便，采用列表头部索引 0 位置插入哨兵位</li>
<li>每一次从有序区最右端后的下一个数，即无序区最左端的数放到哨兵位</li>
</ul></li>
<li>比较与挪动
<ul class="org-ul">
<li>从有序区最右端开始，从右至左依次与哨兵比较</li>
</ul></li>
</ul>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a0522d;">nums</span> = [1, 9, 8, 5, 6]
<span style="color: #a020f0;">import</span> random
random.shuffle(nums)
<span style="color: #483d8b;">print</span>(nums)

<span style="color: #a0522d;">nums</span> = [<span style="color: #008b8b;">None</span>] + nums <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21069;&#38754;&#21152;&#21736;&#20853;&#20301;
</span><span style="color: #483d8b;">print</span>(nums, nums[1:])
<span style="color: #a0522d;">length</span> = <span style="color: #483d8b;">len</span>(nums)
<span style="color: #a0522d;">count_move</span> = 0

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(2, length): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25343;&#19968;&#20010;&#25345;&#25490;&#24207;&#25968;
</span>    <span style="color: #a0522d;">nums</span>[0] = nums[i]  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32034;&#24341;0&#20301;&#21736;&#20853;&#65292;&#32034;&#24341;1&#20301;&#20551;&#35774;&#30340;&#26377;&#24207;&#21306;&#65292;&#37117;&#36339;&#36807;
</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21644;&#26377;&#24207;&#21306;&#26368;&#21491;&#31471;&#24320;&#22987;&#27604;&#36739;&#65292;&#30452;&#21040;&#21512;&#36866;&#20301;&#32622;&#25554;&#20837;
</span>    <span style="color: #a0522d;">j</span> = i - 1 <span style="color: #b22222;"># </span><span style="color: #b22222;">j = 2 [8, 1, 9, 8] i&#24038;&#36793;&#30340;&#37027;&#20010;&#25968;&#23601;&#26159;&#26377;&#24207;&#21306;&#26411;&#23614;
</span>    <span style="color: #a020f0;">if</span> nums[j] &gt; nums[0]: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#26368;&#21491;&#31471;&#25968;&#22823;&#20110;&#21736;&#20853;&#25165;&#38656;&#35201;&#25386;&#21160;&#21644;&#25554;&#20837;
</span>        <span style="color: #a020f0;">while</span> nums[j] &gt; nums[0]: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20889;&#25386;&#21160;
</span>            <span style="color: #a0522d;">nums</span>[j+1] = nums[j] <span style="color: #b22222;">#</span><span style="color: #b22222;">[8,1,?,9]
</span>            <span style="color: #a0522d;">j</span> -= 1 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32487;&#32493;&#21521;&#24038;
</span>            <span style="color: #a0522d;">count_move</span> += 1
        <span style="color: #a0522d;">nums</span>[j+1] = nums[0] <span style="color: #b22222;"># </span><span style="color: #b22222;">[8,1,8,9] &#24490;&#29615;&#20013;&#22810;&#20943;&#20102;&#19968;&#27425;j
</span>
<span style="color: #483d8b;">print</span>(nums[1:], count_move)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:9e0f1767-15eb-41dd-96cf-eeefa60a1509" class="outline-4">
<h4 id="h:9e0f1767-15eb-41dd-96cf-eeefa60a1509">总结</h4>
<div class="outline-text-4" id="text-h:9e0f1767-15eb-41dd-96cf-eeefa60a1509">
<ul class="org-ul">
<li>最好情况，正好是升序排列，比较迭代n-1次</li>
<li>最差情况，正好是降序排列，比较迭代1,2,&#x2026;,n-1即n(n-1)/2，数据移动非常多</li>
<li>使用两层嵌套循环，时间复杂度O(n^2)，不要在大规模数据分析使用</li>
<li>稳定排序算法
<ul class="org-ul">
<li>如果待排序序列R中两元素相等，即Ri等于Rj，且i&lt;j，那么排序后这个先后有顺序不变，这种排序算法就称为稳定排序</li>
<li>已经学习过的排序算法哪些是稳定排序，考虑1、1、2排序</li>
</ul></li>
<li>优化
<ul class="org-ul">
<li>如果比较操作耗时大的话，可以采用二分查找来提高效率，即二分查找插入排序</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-h:8b2df177-23d5-42de-835e-5f7e0f2c095c" class="outline-4">
<h4 id="h:8b2df177-23d5-42de-835e-5f7e0f2c095c">排序稳定性</h4>
<div class="outline-text-4" id="text-h:8b2df177-23d5-42de-835e-5f7e0f2c095c">
<ul class="org-ul">
<li>冒泡排序，相同数据不交换，稳定</li>
<li>直接选择排序，相同数据前面的先选择到，排到有序区，不稳定</li>
<li>直接插入排序，相同数据不移动，相对位置不变，稳定</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:acd7c80d-288b-4f1f-860c-fbc1e4df5450" class="outline-3">
<h3 id="h:acd7c80d-288b-4f1f-860c-fbc1e4df5450">生成器***</h3>
<div class="outline-text-3" id="text-h:acd7c80d-288b-4f1f-860c-fbc1e4df5450">
<p>
生成器generator
</p>

<ul class="org-ul">
<li>生成器指的是生成器对象，可以由生成器表达式得到，也可以使用yield关键字编写一个生成器函数， <b>调用这个函数得到一个生成器对象</b></li>
<li>生成器对象，是一个可迭代对象，是一个迭代器</li>
<li>生成器对象，是延迟计算、惰性求值的</li>
</ul>

<p>
<b>生成器函数</b>
</p>

<ul class="org-ul">
<li>函数体中包含yield语句的函数，就是生成器函数，调用后返回生成器对象</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a0522d;">m</span> = (i <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(m))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(m))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(m))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 0
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2
</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>(): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#35201;&#26377;yield&#37117;&#31639;&#29983;&#25104;&#22120;&#20989;&#25968;&#65292;&#27599;&#19968;&#27425;&#29983;&#25104;&#22120;&#20989;&#25968;&#35843;&#29992;&#37117;&#20250;&#20135;&#29983;&#19968;&#20010;&#20840;&#26032;&#30340;&#29983;&#25104;&#22120;&#23545;&#35937;
</span>    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5):
        <span style="color: #a020f0;">yield</span> i <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36935;&#21040;yield&#21518;&#65292;&#25226;yield&#21518;&#30340;&#20540;&#36820;&#22238;&#20986;&#21435;&#65292;&#21516;&#26102;&#26242;&#20572;&#24403;&#21069;&#20989;&#25968;&#25191;&#34892;
</span>
<span style="color: #483d8b;">print</span>(foo())
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(foo()))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(foo()))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(foo()))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;generator object foo at 0x000001CB449BBCF0&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 0
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 0
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 0
</span>
<span style="color: #a0522d;">n</span> = foo()
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(n))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(n))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 0
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1
</span>
<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> n:
    <span style="color: #483d8b;">print</span>(i)
<span style="color: #b22222;">#</span><span style="color: #b22222;">2
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">3
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">4
</span>
<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> n:
    <span style="color: #483d8b;">print</span>(i)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27809;&#25253;&#38169;
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(foo), <span style="color: #483d8b;">type</span>(foo()))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class 'function'&gt; &lt;class 'generator'&gt;</span>
</pre>
</div>

<p>
普通函数调用，函数立即执行直到执行完毕。
</p>

<p>
生成器函数调用，并不会立即执行函数体，而是返回一个生成器对象，需要使用next函数来驱动这个生成器对象，或者使用循环来驱动。
</p>

<p>
生成器表达式和生成器函数都可以得到生成器对象，只不过生成器函数可以写更加复杂的逻辑。
</p>
</div>
<div id="outline-container-h:7206bd92-f69b-4db7-972d-bfae5060d8cc" class="outline-4">
<h4 id="h:7206bd92-f69b-4db7-972d-bfae5060d8cc">生成器函数的执行</h4>
<div class="outline-text-4" id="text-h:7206bd92-f69b-4db7-972d-bfae5060d8cc">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
    <span style="color: #483d8b;">print</span>(1)
    <span style="color: #a020f0;">yield</span> 2
    <span style="color: #483d8b;">print</span>(3)
    <span style="color: #a020f0;">yield</span> 4
    <span style="color: #483d8b;">print</span>(5)
    <span style="color: #a020f0;">yield</span> 6
    <span style="color: #a020f0;">return</span> 7
    <span style="color: #a020f0;">yield</span> 8

<span style="color: #a0522d;">g</span> = foo() <span style="color: #b22222;"># </span><span style="color: #b22222;">g &#26159;&#29983;&#25104;&#22120;&#23545;&#35937;
</span>
<span style="color: #483d8b;">print</span>(g)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(g)) <span style="color: #b22222;">#</span><span style="color: #b22222;">no1 &#25171;&#21360;&#20160;&#20040;&#65292;&#36820;&#22238;&#20160;&#20040;&#12290;&#25171;&#21360;1&#65292;&#36820;&#22238;2
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(g)) <span style="color: #b22222;">#</span><span style="color: #b22222;">no2 &#25171;&#21360;&#20160;&#20040;&#65292;&#36820;&#22238;&#20160;&#20040;&#12290;&#25171;&#21360;3&#65292;&#36820;&#22238;4
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(g)) <span style="color: #b22222;">#</span><span style="color: #b22222;">no3 &#25171;&#21360;&#20160;&#20040;&#65292;&#36820;&#22238;&#20160;&#20040;&#12290;&#25171;&#21360;5&#65292;&#36820;&#22238;6
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(next(g)) #no4 &#25171;&#21360;&#20160;&#20040;&#65292;&#36820;&#22238;&#20160;&#20040;&#12290;&#25253;&#38169;StopIteration&#65292;return &#30340;7&#25343;&#19981;&#21040;&#65292;return &#20989;&#25968;&#23436;&#32467;&#20102;&#12290;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(g, <span style="color: #8b2252;">'end'</span>)) <span style="color: #b22222;">#</span><span style="color: #b22222;">next &#36845;&#20195;&#22120;&#19981;&#24076;&#26395;&#25253;&#38169;&#65292;&#23601;&#32473;&#32570;&#30465;&#20540;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;generator object foo at 0x0000027FE1AC5E40&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 3
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 4
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 5
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 6
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: end</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo2</span>():
    <span style="color: #483d8b;">print</span>(111)
    <span style="color: #a020f0;">yield</span> <span style="color: #8b2252;">'abc'</span>
    <span style="color: #483d8b;">print</span>(222)
    <span style="color: #a020f0;">yield</span>  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20160;&#20040;&#37117;&#19981;&#20889;&#30456;&#24403;&#20110; return
</span>
<span style="color: #a0522d;">g</span> = foo2()
<span style="color: #483d8b;">print</span>(g)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(g))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(g))
<span style="color: #b22222;">#</span><span style="color: #b22222;">print(next(g)) &#25253;&#38169;StopIteration
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;generator object foo2 at 0x00000220BC1F5E40&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 111
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: abc
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 222
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: None</span>
</pre>
</div>

<ul class="org-ul">
<li>在生成器函数中，可以多次yield，每执行一次yield后会暂停执行，把yield表达式的值返回</li>
<li>再次执行会执行到下一个yield语句又会暂停执行</li>
<li>函数返回
<ul class="org-ul">
<li>return 语句依然可以终止函数运行，但return语句的返回值不能获取到</li>
<li>return会导致当前函数返回，无法继续执行，也无法继续获取下一个值，抛出StopIteration异常</li>
<li>如果函数没有显示的return语句，如果生成器函数执行到结尾(相当于执行了return None)，一样会抛出StopIteration异常</li>
</ul></li>
</ul>

<p>
生成器函数
</p>
<ul class="org-ul">
<li>包含yield语句的生成器函数调用后，生成生成器对象的时候， <b>生成器函数的函数体不会立即执行</b></li>
<li>next(generator)会从函数的当前位置向后执行到之后碰到的第一个yield语句，会弹出值，并暂停函数执行</li>
<li>再次调用next函数，和一条一样的处理过程</li>
<li>继续调用next函数，生成器函数如果结束执行了(显示或隐式调用了return语句)，会抛出StopIteration异常</li>
</ul>
</div>
</div>
<div id="outline-container-h:cb7364fd-cf4d-423c-b960-62081bac852a" class="outline-4">
<h4 id="h:cb7364fd-cf4d-423c-b960-62081bac852a">生成器应用</h4>
<div class="outline-text-4" id="text-h:cb7364fd-cf4d-423c-b960-62081bac852a">
</div>
<div id="outline-container-h:2f2baef5-5e53-4df7-a4b9-5f3a49f4b660" class="outline-5">
<h5 id="h:2f2baef5-5e53-4df7-a4b9-5f3a49f4b660">无限循环</h5>
<div class="outline-text-5" id="text-h:2f2baef5-5e53-4df7-a4b9-5f3a49f4b660">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">counter</span>():
    <span style="color: #a0522d;">i</span> = 0
    <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
        <span style="color: #a0522d;">i</span> += 1
        <span style="color: #a020f0;">yield</span> i

<span style="color: #a0522d;">c</span> = counter() <span style="color: #b22222;"># </span><span style="color: #b22222;">c generator object
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(c))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 1
</span>
<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5):
    <span style="color: #483d8b;">print</span>(i, <span style="color: #483d8b;">next</span>(c))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 0 2
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 3
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2 4
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 3 5
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 4 6</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">counter</span>():
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inc</span>():
        <span style="color: #a0522d;">i</span> = 0
        <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
            <span style="color: #a0522d;">i</span> += 1
            <span style="color: #a020f0;">yield</span> i

    <span style="color: #a0522d;">c</span> = inc()
    <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">next</span>(c)

<span style="color: #a0522d;">g</span> = counter() <span style="color: #b22222;"># </span><span style="color: #b22222;">function
</span><span style="color: #483d8b;">print</span>(g)
<span style="color: #483d8b;">print</span>(g)

<span style="color: #b22222;">#</span><span style="color: #b22222;">: 1
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:666ee958-eded-4518-9c60-5dd4f956e2b7" class="outline-5">
<h5 id="h:666ee958-eded-4518-9c60-5dd4f956e2b7">计数器</h5>
<div class="outline-text-5" id="text-h:666ee958-eded-4518-9c60-5dd4f956e2b7">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">counter</span>():
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inc</span>():
        <span style="color: #a0522d;">i</span> = 0
        <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
            <span style="color: #a0522d;">i</span> += 1
            <span style="color: #a020f0;">yield</span> i

    <span style="color: #a0522d;">c</span> = inc()
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>():
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">next</span>(c) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#38381;&#21253;&#65292;c&#23545;&#24212;&#30340;&#23545;&#35937;&#19981;&#33021;&#37322;&#25918;
</span>    <span style="color: #a020f0;">return</span> fn

<span style="color: #a0522d;">foo2</span> = counter() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#20160;&#20040;
</span><span style="color: #483d8b;">print</span>(foo2())
<span style="color: #483d8b;">print</span>(foo2())

<span style="color: #b22222;">#</span><span style="color: #b22222;">: 1
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">counter</span>():
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inc</span>():
        <span style="color: #a0522d;">i</span> = 0
        <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
            <span style="color: #a0522d;">i</span> += 1
            <span style="color: #a020f0;">yield</span> i

    <span style="color: #a0522d;">c</span> = inc()
<span style="color: #b22222;">#    </span><span style="color: #b22222;">def fn():
</span><span style="color: #b22222;">#        </span><span style="color: #b22222;">return next(c) #&#26377;&#38381;&#21253;&#65292;c&#23545;&#24212;&#30340;&#23545;&#35937;&#19981;&#33021;&#37322;&#25918;
</span><span style="color: #b22222;">#    </span><span style="color: #b22222;">return fn
</span>    <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">lambda</span> : <span style="color: #483d8b;">next</span>(c)


<span style="color: #a0522d;">f</span> = counter() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#20160;&#20040;
</span><span style="color: #483d8b;">print</span>(f())
<span style="color: #483d8b;">print</span>(f())
<span style="color: #483d8b;">print</span>(f())

<span style="color: #b22222;">#</span><span style="color: #b22222;">: 1
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 3</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:735f7bdd-fccb-4bea-9251-cfab1df22cab" class="outline-5">
<h5 id="h:735f7bdd-fccb-4bea-9251-cfab1df22cab">斐波那契数列</h5>
<div class="outline-text-5" id="text-h:735f7bdd-fccb-4bea-9251-cfab1df22cab">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fib</span>():
    <span style="color: #a0522d;">a</span> = 0
    <span style="color: #a0522d;">b</span> = 1
    <span style="color: #a020f0;">yield</span> b
    <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
        <span style="color: #a0522d;">a</span>, <span style="color: #a0522d;">b</span> = b, a+b
        <span style="color: #a020f0;">yield</span> b

<span style="color: #a0522d;">f</span> = fib()
<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5):
    <span style="color: #483d8b;">print</span>(i+1, <span style="color: #483d8b;">next</span>(f))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 1
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2 1
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 3 2
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 4 3
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 5 5</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:7f364245-2fb1-4992-89e5-2fd54d53863f" class="outline-5">
<h5 id="h:7f364245-2fb1-4992-89e5-2fd54d53863f">生成器交互</h5>
<div class="outline-text-5" id="text-h:7f364245-2fb1-4992-89e5-2fd54d53863f">
<p>
python 还提供了一个和生成器对象交互的方法send，该方法可以和生成器沟通。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">bar</span>():
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(3):
        <span style="color: #a0522d;">x</span> = <span style="color: #a020f0;">yield</span> 100
        <span style="color: #483d8b;">print</span>(x, <span style="color: #8b2252;">'+++'</span>)

<span style="color: #a0522d;">g</span> = bar()
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(g)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25171;&#21360;&#65292;&#36820;&#22238;100&#12290;yield 100 &#25243;&#20986;&#21518;&#65292;&#26242;&#20572;&#20102;&#12290;next &#20989;&#25968;&#21482;&#33021;&#39537;&#21160;&#36845;&#20195;&#22120;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(g)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;None +++&#65292;&#36820;&#22238;100
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(g)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;None +++&#65292;&#36820;&#22238;100
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(next(g)) #&#25171;&#21360;None +++&#65292;&#25253;&#38169; StopIteration
</span>

<span style="color: #a0522d;">g</span> = bar()
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(g)) 
<span style="color: #483d8b;">print</span>(g.send(1)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;1 +++&#65292;&#36820;&#22238;100&#12290;&#39537;&#21160;&#65292;send&#30340;&#23454;&#21442;&#20316;&#20026;yield&#35821;&#21477;&#30340;&#34920;&#36798;&#24335;&#30340;&#36820;&#22238;&#20540;
</span><span style="color: #483d8b;">print</span>(g.send(<span style="color: #8b2252;">'abc'</span>)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;abc +++&#65292;&#36820;&#22238;100</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">counter</span>():
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inc</span>():
        <span style="color: #a0522d;">i</span> = 0
        <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
            <span style="color: #a0522d;">i</span> += 1
            <span style="color: #a0522d;">response</span> = <span style="color: #a020f0;">yield</span> i
            <span style="color: #a020f0;">if</span> response <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #008b8b;">None</span>:
                <span style="color: #a0522d;">i</span> = response

    <span style="color: #a0522d;">c</span> = inc()
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(reset=<span style="color: #008b8b;">False</span>):
        <span style="color: #a020f0;">return</span> c.send(0) <span style="color: #a020f0;">if</span> reset <span style="color: #a020f0;">else</span> <span style="color: #483d8b;">next</span>(c)
    <span style="color: #a020f0;">return</span> fn

<span style="color: #a0522d;">g</span> = counter()
<span style="color: #483d8b;">print</span>(g)
<span style="color: #483d8b;">print</span>(g())
<span style="color: #483d8b;">print</span>(g(<span style="color: #008b8b;">True</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#37325;&#32622; i = 0
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;function counter.&lt;locals&gt;.fn at 0x0000029F98069550&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1
</span>
<span style="color: #483d8b;">print</span>(g())
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 2</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">counter</span>():
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inc</span>():
        <span style="color: #a0522d;">i</span> = 0
        <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
            <span style="color: #a0522d;">i</span> += 1
            <span style="color: #a0522d;">response</span> = <span style="color: #a020f0;">yield</span> i
            <span style="color: #a020f0;">if</span> response <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #008b8b;">None</span>:
                <span style="color: #a0522d;">i</span> = response

    <span style="color: #a0522d;">c</span> = inc()
<span style="color: #b22222;">#    </span><span style="color: #b22222;">def fn(reset=False):
</span><span style="color: #b22222;">#        </span><span style="color: #b22222;">return c.send(0) if reset else next(c)
</span><span style="color: #b22222;">#    </span><span style="color: #b22222;">return fn
</span>    <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">lambda</span> <span style="color: #a0522d;">reset</span>=<span style="color: #008b8b;">False</span>, <span style="color: #a0522d;">start</span>=0: c.send(start) <span style="color: #a020f0;">if</span> reset <span style="color: #a020f0;">else</span> <span style="color: #483d8b;">next</span>(c)

<span style="color: #a0522d;">g</span> = counter()
<span style="color: #483d8b;">print</span>(g)
<span style="color: #483d8b;">print</span>(g())
<span style="color: #483d8b;">print</span>(g(<span style="color: #008b8b;">True</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#37325;&#32622; i = 0
</span><span style="color: #483d8b;">print</span>(g())
<span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;function counter.&lt;locals&gt;.&lt;lambda&gt; at 0x000002A189F39550&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2</span>
</pre>
</div>

<ul class="org-ul">
<li>调用send方法，就可以把send的实参传给yield语句做结果，这个结果可以在等式右边被赋值给其它变量</li>
<li>send和next一样可以推动生成器启动并执行</li>
</ul>
</div>
</div>
<div id="outline-container-h:06b43354-c3cf-4fd7-8a69-c4767807aafa" class="outline-5">
<h5 id="h:06b43354-c3cf-4fd7-8a69-c4767807aafa">协程Coroutine</h5>
<div class="outline-text-5" id="text-h:06b43354-c3cf-4fd7-8a69-c4767807aafa">
<ul class="org-ul">
<li>生成器的高级用法</li>
<li>它比进程、线程轻量级，是在用户空间调度函数的一个实现</li>
<li>python3 asyncio就是协程实现，已经加入到标准库</li>
<li>python3.5使用async、await关键字直接原生支持协程</li>
<li><p>
协程调度器实现思路
</p>

<p>
有2个生成器A、B
</p>

<p>
next(A)后，A执行到了yield语句暂停，然后去执行next(B)，B执行到yield语句也暂停，然后再次调用next(A)，再试用next(B)在，周而复始，就实现了调度的效果
</p>

<p>
可以引入调度的策略实现切换的方式
</p></li>
<li>协程是一种非抢占式调度</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:2f1d2ee7-f111-40c2-b88c-d950891c61ab" class="outline-4">
<h4 id="h:2f1d2ee7-f111-40c2-b88c-d950891c61ab">yield from语法</h4>
<div class="outline-text-4" id="text-h:2f1d2ee7-f111-40c2-b88c-d950891c61ab">
<p>
从python3.3开始增加了yield from语法，使用 <code>yield from iterable</code> 等价于 <code>for item in iterable</code>
</p>

<p>
yield from就是一个简化语法的语法糖。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#19968;&#20010;&#21487;&#36845;&#20195;&#23545;&#35937;range&#23545;&#35937;&#36827;&#34892;yield&#23427;&#30340;&#27599;&#19968;&#20010;&#20803;&#32032;
</span>        <span style="color: #a020f0;">yield</span> i

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#20215;&#20110;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
    <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">from</span> <span style="color: #483d8b;">range</span>(5)

<span style="color: #a0522d;">g</span> = foo()
<span style="color: #483d8b;">print</span>(g)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(g))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(g))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;generator object foo at 0x00000284F5655E40&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 0
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:2382e9cd-51b9-4a45-85e5-08e36fe2afc9" class="outline-3">
<h3 id="h:2382e9cd-51b9-4a45-85e5-08e36fe2afc9">数据结构-非线性数据结构-树</h3>
<div class="outline-text-3" id="text-h:2382e9cd-51b9-4a45-85e5-08e36fe2afc9">
</div>
<div id="outline-container-h:e8e5b4f8-d97d-4f4b-b940-5729ed7daf59" class="outline-4">
<h4 id="h:e8e5b4f8-d97d-4f4b-b940-5729ed7daf59">树</h4>
<div class="outline-text-4" id="text-h:e8e5b4f8-d97d-4f4b-b940-5729ed7daf59">
<p>
定义： 树是非线性结构，是n个(n&gt;=0)元素的集合
</p>

<p>
n为0时，称为空树
</p>

<p>
树中只有一个特殊的没有前驱的元素，称为树的根Root。
</p>

<p>
树中除了根结点外，其余元素只能有 <b>一个前驱</b> ，可以有零个或多个后继。如果有多个前驱就不是树了，而是图。
</p>

<p>
递归定义：树T是n(n&gt;=0)个元素的集合。n=0时，称为空树。
</p>

<p>
有且只有一个特殊元素根，剩余元素都可以被划分为m个互不相交的集合T1、T2、T3、&#x2026;、Tm，而每一个集合都是树，称为T的子树Subtree。
</p>

<p>
子树也有自己的根。
</p>
</div>
<div id="outline-container-h:e34bd8af-5a71-4886-9e10-326e2506c324" class="outline-5">
<h5 id="h:e34bd8af-5a71-4886-9e10-326e2506c324">名词解释</h5>
<div class="outline-text-5" id="text-h:e34bd8af-5a71-4886-9e10-326e2506c324">
<ul class="org-ul">
<li>结点：树中的数据元素</li>
<li>结点的度degree：结点拥有的子树的数目称为度，记作d(v)</li>
<li>叶子结点：结点的度为0，称为叶子结点leaf、终端结点、末端结点</li>
<li>分支结点：结点的度不为0，称为非终端结点或分支结点</li>
<li>分支：结点之间的关系</li>
<li>内部结点：除根结点外的分支结点，当然也不包含叶子结点</li>
<li>树的 <b>度</b> 是树内各结点的度的最大值。D结点度最大为3，树的度数就是3</li>
</ul>



<figure id="orge249789">
<img src="./images/img_20240511_203840.png" alt="img_20240511_203840.png" width="50%">

</figure>

<pre class="example" id="org5bd7967">
A,B,C,D,E,F,G,H,I,j 都叫树的结点

结点有度数，结点分几个叉就是几度。如A结点分2叉，度数为2

G,H,I,J,F都是叶子结点，它们度数为0，没有子结点

结点之间的关系，B是A的分支

内部结点，在根结点和叶子结点之间的部分

树的度数，树内哪个结点的度数最大就是树的度数。
</pre>

<ul class="org-ul">
<li>孩子(儿子Child)结点：结点的子树的根结点称为结点的孩子</li>
<li>双亲(父Parent)结点：一个结点是它各子树的根结点的双亲</li>
<li>兄弟(Sibling)结点：具有相同双亲结点的结点</li>
<li>祖先结点：从根结点到该结点所经分支上所有结点。A、B、D都是G的祖先结点</li>
<li>子孙结点：结点的所有子树上的结点都称为该结点的子孙。B的子孙是D,G,H,I</li>
<li>结点的层次(Level)：根节点为第一层，根的孩子为第二层，以此类推，记作L(v)。如A第一层，B,C第二层，D,E,F第三层</li>
<li>树的深度(高度Depth)：树的层次的最大值。上图的树深度为4</li>
<li>堂兄弟：双亲在同一层的结点</li>

<li>有序树：结点的子树是有顺序的（兄弟有大小，有先后次序），不能交换。</li>
<li>无序树：结点的子树是有无序的，可以交换。</li>

<li>路径：树中k个结点n1,n2,&#x2026;,nk，满足ni是n(i+1)的双亲，成为n1到nk的一条路径。就是一条线串下来的，前一个都是后一个的父(前驱)结点。如A,B,D,I一条路径</li>
<li>路径长度=路径上结点数-1，也是分支数。如A,B,D,I一条路径，路径长度为3</li>

<li>森林：m(m&gt;=0)棵不相交的树的集合
<ul class="org-ul">
<li>对于结点而言，其子树的集合就是森林。A结点的2棵子树的集合就是森林。</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-h:a1119391-09a8-4c75-9a1f-88851b5ae802" class="outline-5">
<h5 id="h:a1119391-09a8-4c75-9a1f-88851b5ae802">特点</h5>
<div class="outline-text-5" id="text-h:a1119391-09a8-4c75-9a1f-88851b5ae802">
<ul class="org-ul">
<li>唯一的根</li>
<li>子树不相交</li>
<li>除了根以外，每个元素只能有一个前驱，可以有零个或多个后继</li>
<li>根结点没有双亲结点(前驱)，叶子结点没有孩子结点(后继)</li>
<li>vi是vj的双亲，则L(vi)=L(vj)-1，也就是说双亲比孩子结点的层次小1</li>
</ul>

<p>
堂兄弟的双亲是兄弟关系吗？
</p>

<p>
堂兄弟定义是，双亲结点是同一层的节点。上图G和J是堂兄弟，因为他们的双亲结点D和E在第三层，依然是堂兄弟。因此，堂兄弟的双亲不一定是兄弟关系。
</p>
</div>
</div>
</div>
<div id="outline-container-h:012ec07f-0c4b-4609-b2dc-1ca026a09248" class="outline-4">
<h4 id="h:012ec07f-0c4b-4609-b2dc-1ca026a09248">二叉树</h4>
<div class="outline-text-4" id="text-h:012ec07f-0c4b-4609-b2dc-1ca026a09248">
</div>
<div id="outline-container-h:0163b9f1-ebe2-4350-a527-a619d0b66601" class="outline-5">
<h5 id="h:0163b9f1-ebe2-4350-a527-a619d0b66601">概念</h5>
<div class="outline-text-5" id="text-h:0163b9f1-ebe2-4350-a527-a619d0b66601">
<ul class="org-ul">
<li>每个结点最多2棵子树</li>
<li>二叉树不存在度数大于2的结点</li>
<li>它是有序树，左子树、右子树是顺序的，不能交换次序</li>
<li>即使某个结点只有一棵子树，也要确定它是左子树还是右子树</li>
</ul>

<p>
二叉树的五种基本形态：
</p>
<ul class="org-ul">
<li>空二叉树</li>
<li>只有一个根结点</li>
<li>根结点只有左子树</li>
<li>根结点只有右子树</li>
<li>根结点有左子树和右子树</li>
</ul>
</div>
</div>
<div id="outline-container-h:599e254f-95ce-4d83-a1b0-f44994f0cdb3" class="outline-5">
<h5 id="h:599e254f-95ce-4d83-a1b0-f44994f0cdb3">斜树</h5>
<div class="outline-text-5" id="text-h:599e254f-95ce-4d83-a1b0-f44994f0cdb3">
<p>
左斜树，所有结点都只有左子树；右斜树，所有节点都只有右子树
</p>
</div>
</div>
<div id="outline-container-h:1bb4b1d9-dc0c-4ae0-8b10-b6bf13440d60" class="outline-5">
<h5 id="h:1bb4b1d9-dc0c-4ae0-8b10-b6bf13440d60">满二叉树</h5>
<div class="outline-text-5" id="text-h:1bb4b1d9-dc0c-4ae0-8b10-b6bf13440d60">
<ul class="org-ul">
<li>一棵二叉树的所有分支结构都存在左子树和右子树，并且所有叶子结点只存在在最下面一层</li>
<li>同样深度二叉树中，满二叉树结点最多</li>
<li>k为深度( \(1 \leq k \leq n\) )，则结点总数为 \(2^k - 1\)</li>
<li>如下图，一个深度为4的15个结点的满二叉树</li>
</ul>



<figure id="org0de1ef9">
<img src="./images/img_20240511_213732.png" alt="img_20240511_213732.png" width="50%">

</figure>
</div>
</div>
<div id="outline-container-h:54f38bed-fe22-4262-81c7-be4fdddfdfc6" class="outline-5">
<h5 id="h:54f38bed-fe22-4262-81c7-be4fdddfdfc6">完全二叉树</h5>
<div class="outline-text-5" id="text-h:54f38bed-fe22-4262-81c7-be4fdddfdfc6">
<p>
完全二叉树Complete Binary Tree
</p>

<ul class="org-ul">
<li>若二叉树的深度为k，二叉树的层数人1到k-1层的结点数都达到了最大个数，在第k层的所有结点都集中在最左边，这就是完全二叉树</li>
<li>完全二叉树由满二叉树引出</li>
<li>满二叉树一定是完全二叉树，但完全二叉树不一定是满二叉树</li>
<li>k为深度( \(1 \leq k \leq n\) )，则结点总数最大值为 \(2^k -1\) ，当达到最大值的时候就是满二叉树</li>
</ul>

<p>
下图三个树都是完全二叉树，最下一层的叶子结点都连续的集中在左边
</p>



<figure id="org9ef3c4a">
<img src="./images/img_20240511_220135.png" alt="img_20240511_220135.png" width="50%">

</figure>
</div>
</div>
<div id="outline-container-h:8a03113b-914c-46a9-bf76-10340d499877" class="outline-5">
<h5 id="h:8a03113b-914c-46a9-bf76-10340d499877">性质</h5>
<div class="outline-text-5" id="text-h:8a03113b-914c-46a9-bf76-10340d499877">
<ul class="org-ul">
<li>性质1：在二叉树的第i层上至多有 \(2^(i-1)\) 个结点(i&gt;=1)</li>
<li>性质2：深度为k的二叉树，至多有 \(2^k -1\) 个结点(k&gt;=1)
<ul class="org-ul">
<li>一层 2-1 = 1</li>
<li>二层 4-1 = 1+2 = 3</li>
<li>三层 8-1 = 1+2+4 = 7</li>
</ul></li>
<li>性质3：对任何一棵二叉树T，如果其终端结点数为n0，度数为2的结点为n2，则有n0=n2+1
<ul class="org-ul">
<li>换句话说，就是叶子结点数-1就等于度数为2的结点数</li>
<li>证明
<ul class="org-ul">
<li>总结点数为n=n0+n1+n2，n1为度数为1的结点总数</li>
<li>一棵树的分支数为n-1，因为除了根结点外，其余结点都有一个分支，即n0+n1+n2-1</li>
<li>分支数还等于 <code>n0*0+n1*1+n2*2</code> ，n2是2分支结点所以乘以2，2*n2+n1</li>
<li>可得2*n2+n1=n0+n1+n2-1 =&gt; n2 = n0-1</li>
</ul></li>
</ul></li>
</ul>


<p>
其他性质：
</p>
<ul class="org-ul">
<li>高度为k的二叉树，至少有k个结点</li>
<li>含有n (n&gt;=1) 的结点的二叉树高度至多为n。和上句一个意思</li>
<li>含有n (n&gt;=1) 的结点的二叉树高度至多为n，最小为math.cel( \(log_2(n+1)\) )，不小于对数值的最小整数，向上取整
<ul class="org-ul">
<li>假设高度为h，2^h-1 = n =&gt; h = \(log_2(n+1)\) ，层次数是取整。如果是8个节点，3.1699就要向上取整为4，为4层</li>
</ul></li>
<li>性质4：具有n个结点的完全二叉树的深度为 \(int(log_2n)+1\) 或者math.cel( \(log_2(n+1)\) )</li>
<li>性质5：
<ul class="org-ul">
<li>如果有一棵n个结点的完全二叉树(深度为性质4)，结点按照层序编号</li>
<li>如果i=1，则结点i是二叉树的根，无双亲；如果i&gt;1，则其双亲是int(i/2)，向下取整。就是子节点的编号整除2得到的就是父结点的编号。父结点如果是i，那么左孩子结点就是2i，右孩子结点就是2i+1</li>
<li>如果2i&gt;n，则结点i无左孩子，即结点i为叶子结点；否则其左孩子结点在编号为2i</li>
<li>如果2i+1&gt;n，则结点i无右孩子，注意这里并不能说明结点i没有孩子；否则右孩子结点存在</li>
</ul></li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-h:8826aa0a-1eaf-4372-9592-def7c8f92cfa" class="outline-3">
<h3 id="h:8826aa0a-1eaf-4372-9592-def7c8f92cfa">树的遍历和堆排序</h3>
<div class="outline-text-3" id="text-h:8826aa0a-1eaf-4372-9592-def7c8f92cfa">
</div>
<div id="outline-container-h:43254391-b0ef-4905-81ea-b90280e314cc" class="outline-4">
<h4 id="h:43254391-b0ef-4905-81ea-b90280e314cc">二叉树的遍历</h4>
<div class="outline-text-4" id="text-h:43254391-b0ef-4905-81ea-b90280e314cc">
<p>
遍历: 迭代所有元素一遍
</p>
</div>
<div id="outline-container-h:99c83271-76f0-4155-9426-a8ea0dc1d5e9" class="outline-5">
<h5 id="h:99c83271-76f0-4155-9426-a8ea0dc1d5e9">树的遍历</h5>
<div class="outline-text-5" id="text-h:99c83271-76f0-4155-9426-a8ea0dc1d5e9">
<p>
对树中所有元素不重复地访问一遍，也称作扫描
</p>

<p>
广度优先遍历
</p>
<ul class="org-ul">
<li>层序遍历</li>
</ul>


<figure id="org7776001">
<img src="./images/20230725175837977.png" alt="20230725175837977.png" width="50%">

</figure>

<p>
深度优先遍历
</p>
<ul class="org-ul">
<li>前序遍历</li>
<li>中序遍历</li>
<li>后序遍历</li>
</ul>

<p>
遍历序列
</p>
<ul class="org-ul">
<li>将树中所有元素遍历一遍后，得到的元素的序列。将层次结构转换成了线性结构</li>
</ul>

<p>
层序遍历
</p>
<ul class="org-ul">
<li>按照树的层次，从第一层开始，自左向右遍历元素</li>
<li>遍历序列
<ul class="org-ul">
<li>ABCDEFGHI</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-h:2d4b9b69-ad74-4d7f-b5bc-ba228e628816" class="outline-5">
<h5 id="h:2d4b9b69-ad74-4d7f-b5bc-ba228e628816">深度优先遍历</h5>
<div class="outline-text-5" id="text-h:2d4b9b69-ad74-4d7f-b5bc-ba228e628816">
<ul class="org-ul">
<li>设树的根结点为D，左子树为L，右子树为R，且要求L一定在R之前，则有下面几种遍历方式：
<ul class="org-ul">
<li>前序遍历，也叫先序遍历、也叫先根遍历，DLR</li>
<li>中序遍历，也叫中根遍历，LDR</li>
<li>后序遍历，也叫后根遍历，LRD</li>
</ul></li>
</ul>

<p>
前序遍历DLR
</p>
<ul class="org-ul">
<li>从根结点开始，先左子树后右子树</li>
<li>每个子树内部依然是先根结点，再左子树后右子树。递归遍历</li>
<li>遍历序列
<ul class="org-ul">
<li>A BDGH CEIF</li>
</ul></li>
</ul>


<figure id="orgca954b7">
<img src="./images/20230725180126795.png" alt="20230725180126795.png" width="50%">

</figure>

<p>
中序遍历LDR
</p>
<ul class="org-ul">
<li>从根结点的左子树开始遍历，然后是根结点，再右子树</li>
<li>每个子树内部，也是先左子树，后根结点，再右子树。对遍历</li>
<li>遍历序列
<ul class="org-ul">
<li>左图：GDHB A IECF</li>
<li>右图：GDHB A EICF</li>
</ul></li>
</ul>


<figure id="orgb942ce0">
<img src="./images/20230725184518047-635470053.png" alt="20230725184518047-635470053.png" width="50%">

</figure>

<p>
后序遍历LRD
</p>
<ul class="org-ul">
<li>先左子树，后右子树，再根结点</li>
<li>每个子树内部依然是先左子树，后右子树，再根结点。递归遍历</li>
<li>遍历序列
<ul class="org-ul">
<li>GHDB IEFC A</li>
</ul></li>
</ul>


<figure id="org8a8b759">
<img src="./images/20230725184606920-1703560985.png" alt="20230725184606920-1703560985.png" width="50%">

</figure>
</div>
</div>
</div>
<div id="outline-container-h:281898c1-5e6b-4931-bcf6-ff9f54d27965" class="outline-4">
<h4 id="h:281898c1-5e6b-4931-bcf6-ff9f54d27965">打印树</h4>
<div class="outline-text-4" id="text-h:281898c1-5e6b-4931-bcf6-ff9f54d27965">
<pre class="example" id="orga524677">
origin = [30, 20, 80, 40, 50, 10, 60, 70, 90]
              90
      70              80
  40      50      10      60
30  20
</pre>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23621;&#20013;&#25171;&#21360;
</span><span style="color: #a020f0;">import</span> math

<span style="color: #a0522d;">origin</span> = [10, 20, 30]

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print_tree</span>(array: <span style="color: #483d8b;">list</span>):
    <span style="color: #a0522d;">length</span> = <span style="color: #483d8b;">len</span>(array)
    <span style="color: #a0522d;">depth</span> = math.ceil(math.log2(length + 1)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23618;&#25968;&#12290; #ceil&#21521;&#19978;&#21462;&#25972;&#65292;log2&#21462;&#20197;2&#20026;&#24213;&#30340;&#23545;&#25968;
</span>
    <span style="color: #a0522d;">index</span> = 0
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(depth): <span style="color: #b22222;">#</span><span style="color: #b22222;">0 1 2 3
</span>        <span style="color: #a020f0;">for</span> j <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(2 ** i): <span style="color: #b22222;"># </span><span style="color: #b22222;">1, 2
</span>            <span style="color: #483d8b;">print</span>(array[index], end=<span style="color: #8b2252;">' '</span>)
            <span style="color: #a0522d;">index</span> += 1
        <span style="color: #483d8b;">print</span>()

print_tree(origin)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">10
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">20 30</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23621;&#20013;&#25171;&#21360;
</span><span style="color: #a020f0;">import</span> math

<span style="color: #b22222;"># </span><span style="color: #b22222;">origin = [10, 20, 30]
</span><span style="color: #a0522d;">origin</span> = <span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">range</span>(10, 100, 10))

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print_tree</span>(array: <span style="color: #483d8b;">list</span>):
    <span style="color: #a0522d;">length</span> = <span style="color: #483d8b;">len</span>(array)
    <span style="color: #a0522d;">depth</span> = math.ceil(math.log2(length + 1)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23618;&#25968;&#12290; #ceil&#21521;&#19978;&#21462;&#25972;&#65292;log2&#21462;&#20197;2&#20026;&#24213;&#30340;&#23545;&#25968;
</span>
    <span style="color: #a0522d;">index</span> = 0
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(depth): <span style="color: #b22222;">#</span><span style="color: #b22222;">0 1 2 3
</span>        <span style="color: #a020f0;">for</span> j <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(2 ** i): <span style="color: #b22222;"># </span><span style="color: #b22222;">1, 2
</span>            <span style="color: #483d8b;">print</span>(array[index], end=<span style="color: #8b2252;">' '</span>)
            <span style="color: #a0522d;">index</span> += 1
            <span style="color: #a020f0;">if</span> index &gt;= length:
                <span style="color: #a020f0;">break</span>
        <span style="color: #483d8b;">print</span>()

<span style="color: #483d8b;">print</span>(origin)
print_tree(origin)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[10, 20, 30, 40, 50, 60, 70, 80, 90]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">10 
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">20 30 
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">40 50 60 70 
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">80 90 </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23621;&#20013;&#25171;&#21360;
</span><span style="color: #a020f0;">import</span> math

<span style="color: #b22222;"># </span><span style="color: #b22222;">origin = [10, 20, 30]
</span><span style="color: #a0522d;">origin</span> = <span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">range</span>(10, 100, 10))

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print_tree</span>(array:<span style="color: #483d8b;">list</span>, unit_width=2):
    <span style="color: #8b2252;">"""
    &#31532;1&#23618; &#32467;&#28857;&#25968; 2^1 - 1 = 1
    &#31532;2&#23618; &#32467;&#28857;&#25968; 2^2 - 1 = 3
    &#31532;3&#23618; &#32467;&#28857;&#25968; 2^3 - 1 = 7
    &#31532;4&#23618; &#32467;&#28857;&#25968; 2^4 - 1 = 15
    """</span>
    <span style="color: #a0522d;">length</span> = <span style="color: #483d8b;">len</span>(array) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38271;&#24230;
</span>    <span style="color: #a0522d;">depth</span> = math.ceil(math.log2(length + 1)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23618;&#25968;&#12290; #ceil&#21521;&#19978;&#21462;&#25972;&#65292;log2&#21462;&#20197;2&#20026;&#24213;&#30340;&#23545;&#25968;
</span>    <span style="color: #a0522d;">width</span> = 2 ** depth - 1 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23485;&#24230;
</span>    <span style="color: #483d8b;">print</span>(length, depth, width)

    <span style="color: #a0522d;">index</span> = 0
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(depth): <span style="color: #b22222;">#</span><span style="color: #b22222;">0 1 2 3
</span>        <span style="color: #a020f0;">for</span> j <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(2 ** i): <span style="color: #b22222;"># </span><span style="color: #b22222;">1, 2
</span>            <span style="color: #483d8b;">print</span>(array[index], end=<span style="color: #8b2252;">' '</span>)
            <span style="color: #a0522d;">index</span> += 1
            <span style="color: #a020f0;">if</span> index &gt;= length:
                <span style="color: #a020f0;">break</span>
        <span style="color: #483d8b;">print</span>()

<span style="color: #483d8b;">print</span>(origin)
print_tree(origin)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[10, 20, 30, 40, 50, 60, 70, 80, 90]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">9 4 15
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">10 
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">20 30 
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">40 50 60 70 
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">80 90 </span>
</pre>
</div>

<p>
居中打印
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23621;&#20013;&#25171;&#21360;
</span><span style="color: #a020f0;">import</span> math

<span style="color: #b22222;"># </span><span style="color: #b22222;">origin = [10, 20, 30]
</span><span style="color: #a0522d;">origin</span> = <span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">range</span>(10, 100, 10))

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print_tree</span>(array:<span style="color: #483d8b;">list</span>, unit_width=2):
    <span style="color: #8b2252;">"""
    &#31532;1&#23618; &#32467;&#28857;&#25968; 2^1 - 1 = 1
    &#31532;2&#23618; &#32467;&#28857;&#25968; 2^2 - 1 = 3
    &#31532;3&#23618; &#32467;&#28857;&#25968; 2^3 - 1 = 7
    &#31532;4&#23618; &#32467;&#28857;&#25968; 2^4 - 1 = 15
    """</span>
    <span style="color: #a0522d;">length</span> = <span style="color: #483d8b;">len</span>(array) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38271;&#24230;
</span>    <span style="color: #a0522d;">depth</span> = math.ceil(math.log2(length + 1)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23618;&#25968;&#12290; #ceil&#21521;&#19978;&#21462;&#25972;&#65292;log2&#21462;&#20197;2&#20026;&#24213;&#30340;&#23545;&#25968;
</span>    <span style="color: #a0522d;">width</span> = 2 ** depth - 1 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23485;&#24230;
</span>    <span style="color: #483d8b;">print</span>(length, depth, width)

    <span style="color: #a0522d;">index</span> = 0
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(depth): <span style="color: #b22222;">#</span><span style="color: #b22222;">0 1 2 3
</span>        <span style="color: #a020f0;">for</span> j <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(2 ** i): <span style="color: #b22222;"># </span><span style="color: #b22222;">1, 2
</span>            <span style="color: #b22222;"># </span><span style="color: #b22222;">print(array[index], end=' ')
</span>            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{:#^{}}"</span>.<span style="color: #483d8b;">format</span>(array[index], width * unit_width), end=<span style="color: #8b2252;">''</span>)
            <span style="color: #a0522d;">index</span> += 1
            <span style="color: #a020f0;">if</span> index &gt;= length:
                <span style="color: #a020f0;">break</span>
        <span style="color: #483d8b;">print</span>()

<span style="color: #483d8b;">print</span>(origin)
print_tree(origin)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[10, 20, 30, 40, 50, 60, 70, 80, 90]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">9 4 15
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">##############10##############
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">##############20############################30##############
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">##############40############################50############################60############################70##############
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">##############80############################90##############</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23621;&#20013;&#25171;&#21360;
</span><span style="color: #a020f0;">import</span> math

<span style="color: #b22222;"># </span><span style="color: #b22222;">origin = [10, 20, 30]
</span><span style="color: #a0522d;">origin</span> = <span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">range</span>(10, 100, 10))

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print_tree</span>(array:<span style="color: #483d8b;">list</span>, unit_width=2):
    <span style="color: #8b2252;">"""
    &#31532;1&#23618; &#32467;&#28857;&#25968; 2^1 - 1 = 1
    &#31532;2&#23618; &#32467;&#28857;&#25968; 2^2 - 1 = 3
    &#31532;3&#23618; &#32467;&#28857;&#25968; 2^3 - 1 = 7
    &#31532;4&#23618; &#32467;&#28857;&#25968; 2^4 - 1 = 15
    """</span>
    <span style="color: #a0522d;">length</span> = <span style="color: #483d8b;">len</span>(array) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38271;&#24230;
</span>    <span style="color: #a0522d;">depth</span> = math.ceil(math.log2(length + 1)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23618;&#25968;&#12290; #ceil&#21521;&#19978;&#21462;&#25972;&#65292;log2&#21462;&#20197;2&#20026;&#24213;&#30340;&#23545;&#25968;
</span>    <span style="color: #a0522d;">width</span> = 2 ** depth - 1 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23485;&#24230;
</span>    <span style="color: #483d8b;">print</span>(length, depth, width)

    <span style="color: #a0522d;">index</span> = 0
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(depth): <span style="color: #b22222;">#</span><span style="color: #b22222;">0 1 2 3
</span>        <span style="color: #a020f0;">for</span> j <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(2 ** i): <span style="color: #b22222;"># </span><span style="color: #b22222;">1, 2
</span>            <span style="color: #b22222;"># </span><span style="color: #b22222;">print(array[index], end=' ')
</span>            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{:#^{}}"</span>.<span style="color: #483d8b;">format</span>(array[index], width * unit_width), end=<span style="color: #8b2252;">' '</span>*unit_width)
            <span style="color: #a0522d;">index</span> += 1
            <span style="color: #a020f0;">if</span> index &gt;= length:
                <span style="color: #a020f0;">break</span>
        <span style="color: #a0522d;">width</span> //= 2
        <span style="color: #483d8b;">print</span>()

<span style="color: #483d8b;">print</span>(origin)
print_tree(origin)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[10, 20, 30, 40, 50, 60, 70, 80, 90]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">9 4 15
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">##############10##############  
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">######20######  ######30######  
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">##40##  ##50##  ##60##  ##70##  
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">80  90  </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{:^{}}"</span>.<span style="color: #483d8b;">format</span>(array[index], width * unit_width), end=<span style="color: #8b2252;">' '</span>*unit_width)

<span style="color: #b22222;">#               </span><span style="color: #b22222;">10                
</span><span style="color: #b22222;">#       </span><span style="color: #b22222;">20              30        
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">40      50      60      70    
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">80  90  </span>
</pre>
</div>

<p>
居中打印-补空格方法
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23621;&#20013;&#25171;&#21360;-&#34917;&#31354;&#26684;&#27861;
</span><span style="color: #a020f0;">import</span> math

<span style="color: #a0522d;">origin</span> = [<span style="color: #008b8b;">None</span>, 10, 20, 30, 40, 50, 60, 70, 80, 90]

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print_tree</span>(array:<span style="color: #483d8b;">list</span>, unit_width=2):
    <span style="color: #8b2252;">"""
    &#31532;1&#23618; &#32467;&#28857;&#25968; 2^1 - 1 = 1
    &#31532;2&#23618; &#32467;&#28857;&#25968; 2^2 - 1 = 3
    &#31532;3&#23618; &#32467;&#28857;&#25968; 2^3 - 1 = 7
    &#31532;4&#23618; &#32467;&#28857;&#25968; 2^4 - 1 = 15

            &#21069;&#31354;&#26684;    &#38388;&#38548;&#31354;&#26684;(&#20803;&#32032;&#20043;&#38388;)  &#20999;&#29255;
    &#27599;1&#23618; 4  7=2**3-1  ?    15=2**4-1 &#22240;&#20026;&#21482;&#26377;&#19968;&#20010;&#20803;&#32032;&#65292;&#19981;&#29992;&#20851;&#24515; 1:2 10
    &#27599;2&#23618; 3  3=2**2-1  7=2*3+1 2**3-1  2:4 20 30
    &#27599;3&#23618; 2  1=2**1-1  3=2*1+1 2**2-1  4:8 40 50 60 80
    &#27599;4&#23618; 1  0=2**0-1  1=2*0+1 2**1-1  8:16
    """</span>
    <span style="color: #a0522d;">length</span> = <span style="color: #483d8b;">len</span>(array)<span style="color: #b22222;">#</span><span style="color: #b22222;">&#38271;&#24230;
</span>    <span style="color: #a0522d;">depth</span> = math.ceil(math.log2(length)) <span style="color: #b22222;">#</span><span style="color: #b22222;">4
</span>    <span style="color: #a0522d;">width</span> = 2 ** depth - 1 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23485;&#24230;
</span>    <span style="color: #a0522d;">start</span> = 1
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(depth, 0, -1): <span style="color: #b22222;">#</span><span style="color: #b22222;">4 3 2 1
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35299;&#20915;&#21069;&#23548;&#31354;&#26684;
</span>        <span style="color: #a0522d;">pre</span> = 2 ** (i - 1) - 1
        <span style="color: #483d8b;">print</span>(pre * unit_width * <span style="color: #8b2252;">' '</span>, end=<span style="color: #8b2252;">''</span>)
        <span style="color: #a0522d;">interval</span> = (2 * pre + 1) * unit_width * <span style="color: #8b2252;">' '</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38388;&#38548;&#23383;&#31526;
</span>        <span style="color: #a0522d;">end</span> = start + start
        <span style="color: #483d8b;">print</span>(interval.join(<span style="color: #483d8b;">map</span>(<span style="color: #483d8b;">str</span>, array[start:end])))
        <span style="color: #a0522d;">start</span> = end

<span style="color: #483d8b;">print</span>(origin)
print_tree(origin)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[None, 10, 20, 30, 40, 50, 60, 70, 80, 90]
</span><span style="color: #b22222;">#               </span><span style="color: #b22222;">10
</span><span style="color: #b22222;">#       </span><span style="color: #b22222;">20              30
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">40      50      60      70
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">80  90</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23621;&#20013;&#25171;&#21360;-&#34917;&#31354;&#26684;&#27861;
</span><span style="color: #a020f0;">import</span> math

<span style="color: #a0522d;">origin</span> = [<span style="color: #008b8b;">None</span>, 10, 20, 30, 40, 50, 60, 70, 80, 90]

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print_tree</span>(array:<span style="color: #483d8b;">list</span>, unit_width=2):
    <span style="color: #8b2252;">"""
    &#31532;1&#23618; &#32467;&#28857;&#25968; 2^1 - 1 = 1
    &#31532;2&#23618; &#32467;&#28857;&#25968; 2^2 - 1 = 3
    &#31532;3&#23618; &#32467;&#28857;&#25968; 2^3 - 1 = 7
    &#31532;4&#23618; &#32467;&#28857;&#25968; 2^4 - 1 = 15

            &#21069;&#31354;&#26684;    &#38388;&#38548;&#31354;&#26684;(&#20803;&#32032;&#20043;&#38388;)  &#20999;&#29255;
    &#27599;1&#23618; 4  7=2**3-1  ?    15=2**4-1 &#22240;&#20026;&#21482;&#26377;&#19968;&#20010;&#20803;&#32032;&#65292;&#19981;&#29992;&#20851;&#24515; 1:2 10
    &#27599;2&#23618; 3  3=2**2-1  7=2*3+1 2**3-1  2:4 20 30
    &#27599;3&#23618; 2  1=2**1-1  3=2*1+1 2**2-1  4:8 40 50 60 80
    &#27599;4&#23618; 1  0=2**0-1  1=2*0+1 2**1-1  8:16
    """</span>
    <span style="color: #a0522d;">length</span> = <span style="color: #483d8b;">len</span>(array)<span style="color: #b22222;">#</span><span style="color: #b22222;">&#38271;&#24230;
</span>    <span style="color: #a0522d;">depth</span> = math.ceil(math.log2(length)) <span style="color: #b22222;">#</span><span style="color: #b22222;">4
</span>    <span style="color: #a0522d;">start</span> = 1
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(depth, 0, -1): <span style="color: #b22222;">#</span><span style="color: #b22222;">4 3 2 1
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35299;&#20915;&#21069;&#23548;&#31354;&#26684;
</span>        <span style="color: #a0522d;">pre</span> = 2 ** (i - 1) - 1
        <span style="color: #483d8b;">print</span>(pre * unit_width * <span style="color: #8b2252;">' '</span>, end=<span style="color: #8b2252;">''</span>)
        <span style="color: #a0522d;">interval</span> = (2 * pre + 1) * unit_width * <span style="color: #8b2252;">' '</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38388;&#38548;&#23383;&#31526;
</span>        <span style="color: #a0522d;">end</span> = start + start
        <span style="color: #483d8b;">print</span>(interval.join(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> x: <span style="color: #8b2252;">"{:{}}"</span>.<span style="color: #483d8b;">format</span>(x, unit_width), array[start:end])))
        <span style="color: #a0522d;">start</span> = end

<span style="color: #a0522d;">origin</span> = [<span style="color: #008b8b;">None</span>] + <span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">range</span>(10, 30))
<span style="color: #483d8b;">print</span>(origin)
print_tree(origin, 1)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[None, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29]
</span><span style="color: #b22222;">#                </span><span style="color: #b22222;">10
</span><span style="color: #b22222;">#        </span><span style="color: #b22222;">11               12
</span><span style="color: #b22222;">#    </span><span style="color: #b22222;">13       14       15       16
</span><span style="color: #b22222;">#  </span><span style="color: #b22222;">17   18   19   20   21   22   23   24
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">25 26 27 28 29</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:2f7a4be2-2dd1-4502-a4f3-ffafffb7d5c5" class="outline-4">
<h4 id="h:2f7a4be2-2dd1-4502-a4f3-ffafffb7d5c5">堆排序Heap Sort</h4>
<div class="outline-text-4" id="text-h:2f7a4be2-2dd1-4502-a4f3-ffafffb7d5c5">
</div>
<div id="outline-container-h:5c61bf6c-2186-408d-8de2-b190856705a6" class="outline-5">
<h5 id="h:5c61bf6c-2186-408d-8de2-b190856705a6">堆Heap</h5>
<div class="outline-text-5" id="text-h:5c61bf6c-2186-408d-8de2-b190856705a6">
<ul class="org-ul">
<li>堆是一个完全二叉树</li>
<li>每个非叶子结点都要大于或者等于其左右孩子结点的值称为大顶堆</li>
<li>每个非叶子结点都要小鱼或者等于其左右孩子结点的值称为小顶堆</li>
<li>根结点一定是大顶堆中的最大值，一定是小顶堆中的最小值</li>
</ul>

<p>
大顶堆
</p>
<ul class="org-ul">
<li>完全二叉树的每个非叶子结点都要大于或者等于其左右孩子结点的值称为大顶堆</li>
<li>根结点一定是大顶堆中的最大值</li>
</ul>

<pre class="example" id="org30519d7">
              90
      70              80
  40      50      10      60
30  20
</pre>

<p>
小顶堆
</p>
<ul class="org-ul">
<li>完全二叉树的每个非叶子结点都要小于或者等于其左右孩子结点的值称为小顶堆</li>
<li>根结点一定是小顶堆中的最小值</li>
</ul>

<pre class="example" id="org8198b4b">
              10
      30              20
  60      80      40      50
90  70
</pre>
</div>
</div>
<div id="outline-container-h:d0855469-956f-4598-a3d1-2390706ed3c8" class="outline-5">
<h5 id="h:d0855469-956f-4598-a3d1-2390706ed3c8">算法实现</h5>
<div class="outline-text-5" id="text-h:d0855469-956f-4598-a3d1-2390706ed3c8">
<p>
1.构建完全二叉树
</p>

<ul class="org-ul">
<li>待排序数字为 30，20，80，40，50，10，60，70，90</li>
<li>构建一个完全二叉树存放数据，并根绝性质5对元素编号，放入顺序的数据结构中</li>
<li>构造一个列表为[0,30,20,80,40,50,10,60,70,90]</li>

<li><p>
核心算法
</p>

<p>
对于堆排序的核心算法就是堆结点的调整
</p>
<ul class="org-ul">
<li>度数为2的结点A，如果它的左右孩子结点的最大值比它大的，将这个最大值和该结点 <b>交换</b></li>
<li>度数为1的结点A，如果它的左孩子的值大于它，则 <b>交换</b></li>
<li>如果结点A被交换到新的位置，还需要和其孩子结点重复上面的过程</li>
</ul></li>
</ul>

<p>
单节点代码
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#               </span><span style="color: #b22222;">30
</span><span style="color: #b22222;">#       </span><span style="color: #b22222;">20              80
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">40      50      10      60
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">70  90
</span><span style="color: #a020f0;">import</span> math

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print_tree</span>(array,unit_width=2):
    <span style="color: #8b2252;">'''
     i  &#21069;&#31354;&#26684;      &#20803;&#32032;&#38388;
   1 3  7=2**3-1  0 2*7+1 2*&#21069;&#31354;&#26684;+1
   2 2  3=2**2-1  7=2**3+1
   3 1  1=2**1-1  3=2**1+1
   4 0  0=2**0-1  1=2*0+1
    '''</span>
    <span style="color: #a0522d;">length</span> = <span style="color: #483d8b;">len</span>(array)
    <span style="color: #a0522d;">start</span> = 1
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22240;&#20026;&#20351;&#29992;&#26102;&#21069;&#38754;&#34917;0&#20102;,&#19981;&#28982;&#24212;&#35813;&#26159;math.ceil(math.log2(len(array)+1)
</span>    <span style="color: #a0522d;">depth</span> = math.ceil(math.log2(length)) <span style="color: #b22222;"># </span><span style="color: #b22222;">4
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">print(depth)
</span>    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(depth, 0, -1):
        <span style="color: #a0522d;">pre</span> = 2 ** (i - 1) - 1
        <span style="color: #483d8b;">print</span>(pre * unit_width * <span style="color: #8b2252;">' '</span>, end=<span style="color: #8b2252;">""</span>)
        <span style="color: #a0522d;">interval</span> = (2 * pre + 1) * unit_width * <span style="color: #8b2252;">' '</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38388;&#38548;&#23383;&#31526;
</span>        <span style="color: #a0522d;">end</span> = start + start
        <span style="color: #483d8b;">print</span>(interval.join(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> x: <span style="color: #8b2252;">"{:{}}"</span>.<span style="color: #483d8b;">format</span>(x, unit_width), array[start:end])))
        <span style="color: #a0522d;">start</span> = end


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20026;&#20102;&#21644;&#32534;&#30721;&#23545;&#24212;&#65292;&#22686;&#21152;&#19968;&#20010;&#26080;&#29992;&#30340;0&#22312;&#39318;&#20301;
</span><span style="color: #a0522d;">origin</span> = [<span style="color: #008b8b;">None</span>, 30, 20, 80, 40, 50, 10, 60, 70, 90]

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">heap_adjust</span>(i, n, array:<span style="color: #483d8b;">list</span>):
    <span style="color: #a020f0;">if</span> 2*i &lt;= n: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#23450;&#26377;&#24038;&#23401;&#23376;&#33410;&#28857;
</span>        <span style="color: #a0522d;">lchild_index</span> = 2 * i
        <span style="color: #a0522d;">max_child_index</span> = lchild_index <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20551;&#23450;&#23401;&#23376;&#33410;&#28857;&#20013;&#24038;&#23401;&#23376;&#30446;&#21069;&#26368;&#22823;
</span>        <span style="color: #a020f0;">if</span> lchild_index + 1 &lt;= n <span style="color: #a020f0;">and</span> array[lchild_index + 1] &gt; array[lchild_index]: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23384;&#22312;&#21491;&#23401;&#23376;&#33410;&#28857;
</span>            <span style="color: #a0522d;">max_child_index</span> = lchild_index + 1

        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21644;&#33258;&#24049;&#30340;&#26681;&#27604;&#36739;
</span>        <span style="color: #a020f0;">if</span> array[max_child_index] &gt; array[i]:
            <span style="color: #a0522d;">array</span>[<span style="color: #a0522d;">i</span>], <span style="color: #a0522d;">array</span>[max_child_index] = array[max_child_index], array[i]

heap_adjust(4, 9, origin)
print_tree(origin)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;">#               </span><span style="color: #b22222;">30
</span><span style="color: #b22222;">#       </span><span style="color: #b22222;">20              80
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">90      50      10      60
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">70  40</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#               </span><span style="color: #b22222;">30
</span><span style="color: #b22222;">#       </span><span style="color: #b22222;">20              80
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">40      50      10      60
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">70  90
</span><span style="color: #a020f0;">import</span> math

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print_tree</span>(array,unit_width=2):
    <span style="color: #8b2252;">'''
     i  &#21069;&#31354;&#26684;      &#20803;&#32032;&#38388;
   1 3  7=2**3-1  0 2*7+1 2*&#21069;&#31354;&#26684;+1
   2 2  3=2**2-1  7=2**3+1
   3 1  1=2**1-1  3=2**1+1
   4 0  0=2**0-1  1=2*0+1
    '''</span>
    <span style="color: #a0522d;">length</span> = <span style="color: #483d8b;">len</span>(array)
    <span style="color: #a0522d;">start</span> = 1
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22240;&#20026;&#20351;&#29992;&#26102;&#21069;&#38754;&#34917;0&#20102;,&#19981;&#28982;&#24212;&#35813;&#26159;math.ceil(math.log2(len(array)+1)
</span>    <span style="color: #a0522d;">depth</span> = math.ceil(math.log2(length)) <span style="color: #b22222;"># </span><span style="color: #b22222;">4
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">print(depth)
</span>    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(depth, 0, -1):
        <span style="color: #a0522d;">pre</span> = 2 ** (i - 1) - 1
        <span style="color: #483d8b;">print</span>(pre * unit_width * <span style="color: #8b2252;">' '</span>, end=<span style="color: #8b2252;">""</span>)
        <span style="color: #a0522d;">interval</span> = (2 * pre + 1) * unit_width * <span style="color: #8b2252;">' '</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38388;&#38548;&#23383;&#31526;
</span>        <span style="color: #a0522d;">end</span> = start + start
        <span style="color: #483d8b;">print</span>(interval.join(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> x: <span style="color: #8b2252;">"{:{}}"</span>.<span style="color: #483d8b;">format</span>(x, unit_width), array[start:end])))
        <span style="color: #a0522d;">start</span> = end


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20026;&#20102;&#21644;&#32534;&#30721;&#23545;&#24212;&#65292;&#22686;&#21152;&#19968;&#20010;&#26080;&#29992;&#30340;0&#22312;&#39318;&#20301;
</span><span style="color: #a0522d;">origin</span> = [<span style="color: #008b8b;">None</span>, 30, 20, 80, 40, 50, 10, 60, 70, 90]
<span style="color: #a0522d;">total</span> = <span style="color: #483d8b;">len</span>(origin) - 1

<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">heap_adjust</span>(i, n, array:<span style="color: #483d8b;">list</span>):
    <span style="color: #a020f0;">while</span> 2*i &lt;= n: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#23450;&#26377;&#24038;&#23401;&#23376;&#33410;&#28857;
</span>        <span style="color: #a0522d;">lchild_index</span> = 2 * i
        <span style="color: #a0522d;">max_child_index</span> = lchild_index <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20551;&#23450;&#23401;&#23376;&#33410;&#28857;&#20013;&#24038;&#23401;&#23376;&#30446;&#21069;&#26368;&#22823;
</span>        <span style="color: #a020f0;">if</span> lchild_index + 1 &lt;= n <span style="color: #a020f0;">and</span> array[lchild_index + 1] &gt; array[lchild_index]: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23384;&#22312;&#21491;&#23401;&#23376;&#33410;&#28857;
</span>            <span style="color: #a0522d;">max_child_index</span> = lchild_index + 1

        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21644;&#33258;&#24049;&#30340;&#26681;&#27604;&#36739;
</span>        <span style="color: #a020f0;">if</span> array[max_child_index] &gt; array[i]:
            <span style="color: #a0522d;">array</span>[<span style="color: #a0522d;">i</span>], <span style="color: #a0522d;">array</span>[max_child_index] = array[max_child_index], array[i]
            <span style="color: #a0522d;">i</span> = max_child_index
        <span style="color: #b22222;"># </span><span style="color: #b22222;">else:
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">break
</span>        time.sleep(1)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 5)

heap_adjust(total//2, total, origin)
<span style="color: #b22222;"># </span><span style="color: #b22222;">heap_adjust(1, 9, origin)
</span>print_tree(origin)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)

<span style="color: #b22222;">#</span><span style="color: #b22222;">origin&#21464;&#25104;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">-----
</span><span style="color: #b22222;">#               </span><span style="color: #b22222;">30
</span><span style="color: #b22222;">#       </span><span style="color: #b22222;">20              80
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">90      50      10      60
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">70  40
</span>
heap_adjust(4, 9, origin)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27515;&#24490;&#29615;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">-----
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">-----
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">-----</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#               </span><span style="color: #b22222;">30
</span><span style="color: #b22222;">#       </span><span style="color: #b22222;">20              80
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">40      50      10      60
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">70  90
</span><span style="color: #a020f0;">import</span> math

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print_tree</span>(array,unit_width=2):
    <span style="color: #8b2252;">'''
     i  &#21069;&#31354;&#26684;      &#20803;&#32032;&#38388;
   1 3  7=2**3-1  0 2*7+1 2*&#21069;&#31354;&#26684;+1
   2 2  3=2**2-1  7=2**3+1
   3 1  1=2**1-1  3=2**1+1
   4 0  0=2**0-1  1=2*0+1
    '''</span>
    <span style="color: #a0522d;">length</span> = <span style="color: #483d8b;">len</span>(array)
    <span style="color: #a0522d;">start</span> = 1
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22240;&#20026;&#20351;&#29992;&#26102;&#21069;&#38754;&#34917;0&#20102;,&#19981;&#28982;&#24212;&#35813;&#26159;math.ceil(math.log2(len(array)+1)
</span>    <span style="color: #a0522d;">depth</span> = math.ceil(math.log2(length)) <span style="color: #b22222;"># </span><span style="color: #b22222;">4
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">print(depth)
</span>    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(depth, 0, -1):
        <span style="color: #a0522d;">pre</span> = 2 ** (i - 1) - 1
        <span style="color: #483d8b;">print</span>(pre * unit_width * <span style="color: #8b2252;">' '</span>, end=<span style="color: #8b2252;">""</span>)
        <span style="color: #a0522d;">interval</span> = (2 * pre + 1) * unit_width * <span style="color: #8b2252;">' '</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38388;&#38548;&#23383;&#31526;
</span>        <span style="color: #a0522d;">end</span> = start + start
        <span style="color: #483d8b;">print</span>(interval.join(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> x: <span style="color: #8b2252;">"{:{}}"</span>.<span style="color: #483d8b;">format</span>(x, unit_width), array[start:end])))
        <span style="color: #a0522d;">start</span> = end


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20026;&#20102;&#21644;&#32534;&#30721;&#23545;&#24212;&#65292;&#22686;&#21152;&#19968;&#20010;&#26080;&#29992;&#30340;0&#22312;&#39318;&#20301;
</span><span style="color: #a0522d;">origin</span> = [<span style="color: #008b8b;">None</span>, 30, 20, 80, 40, 50, 10, 60, 70, 90]
<span style="color: #a0522d;">total</span> = <span style="color: #483d8b;">len</span>(origin) - 1


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">heap_adjust</span>(i, n, array:<span style="color: #483d8b;">list</span>):
    <span style="color: #a020f0;">while</span> 2*i &lt;= n: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#23450;&#26377;&#24038;&#23401;&#23376;&#33410;&#28857;
</span>        <span style="color: #a0522d;">lchild_index</span> = 2 * i
        <span style="color: #a0522d;">max_child_index</span> = lchild_index <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20551;&#23450;&#23401;&#23376;&#33410;&#28857;&#20013;&#24038;&#23401;&#23376;&#30446;&#21069;&#26368;&#22823;
</span>        <span style="color: #a020f0;">if</span> lchild_index + 1 &lt;= n <span style="color: #a020f0;">and</span> array[lchild_index + 1] &gt; array[lchild_index]: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23384;&#22312;&#21491;&#23401;&#23376;&#33410;&#28857;
</span>            <span style="color: #a0522d;">max_child_index</span> = lchild_index + 1

        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21644;&#33258;&#24049;&#30340;&#26681;&#27604;&#36739;
</span>        <span style="color: #a020f0;">if</span> array[max_child_index] &gt; array[i]:
            <span style="color: #a0522d;">array</span>[<span style="color: #a0522d;">i</span>], <span style="color: #a0522d;">array</span>[max_child_index] = array[max_child_index], array[i]
            <span style="color: #a0522d;">i</span> = max_child_index
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">break</span>

heap_adjust(total//2, total, origin)
<span style="color: #b22222;"># </span><span style="color: #b22222;">heap_adjust(1, 9, origin)
</span>print_tree(origin)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
</pre>
</div>

<p>
目前为止也只是解决了 <b>单个结点的调整</b> ，下面要使用循环来依次解决比起始结点编号小的结点。
</p>

<p>
2.构建大顶堆
</p>


<ul class="org-ul">
<li>起点结点的选择
<ul class="org-ul">
<li>从完全二叉树的最后一个结点的双亲结点开始，即最后一层的最右边叶子结点的父结点开始</li>
<li>结点数为n，则起始结点的编号为n//2(性质5)，由于构造了一个前置为0，所以编号和列表的
索引正好重合，但是，元素个数n等于列表长度减1.</li>
</ul></li>

<li>下一个结点的选择
<ul class="org-ul">
<li>从起始结点开始向左找其同层结点，到头后再从上一层的最右边结点开始继续向左逐个查找，直至根结点</li>
</ul></li>
</ul>

<pre class="example" id="org2950a28">
              30
      20              80
  40      50      10      60
70  90
</pre>

<p>
3.大顶堆的目标
</p>

<p>
确保每个非叶子结点的都比其左右孩子结点的值大
</p>

<pre class="example" id="orge5aa3cf">
              90
      70              80
  60      10      40      50
30  20
</pre>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#               </span><span style="color: #b22222;">30
</span><span style="color: #b22222;">#       </span><span style="color: #b22222;">20              80
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">40      50      10      60
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">70  90
</span><span style="color: #a020f0;">import</span> math

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print_tree</span>(array,unit_width=2):
    <span style="color: #8b2252;">'''
     i  &#21069;&#31354;&#26684;      &#20803;&#32032;&#38388;
   1 3  7=2**3-1  0 2*7+1 2*&#21069;&#31354;&#26684;+1
   2 2  3=2**2-1  7=2**3+1
   3 1  1=2**1-1  3=2**1+1
   4 0  0=2**0-1  1=2*0+1
    '''</span>
    <span style="color: #a0522d;">length</span> = <span style="color: #483d8b;">len</span>(array)
    <span style="color: #a0522d;">start</span> = 1
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22240;&#20026;&#20351;&#29992;&#26102;&#21069;&#38754;&#34917;0&#20102;,&#19981;&#28982;&#24212;&#35813;&#26159;math.ceil(math.log2(len(array)+1)
</span>    <span style="color: #a0522d;">depth</span> = math.ceil(math.log2(length)) <span style="color: #b22222;"># </span><span style="color: #b22222;">4
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">print(depth)
</span>    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(depth, 0, -1):
        <span style="color: #a0522d;">pre</span> = 2 ** (i - 1) - 1
        <span style="color: #483d8b;">print</span>(pre * unit_width * <span style="color: #8b2252;">' '</span>, end=<span style="color: #8b2252;">""</span>)
        <span style="color: #a0522d;">interval</span> = (2 * pre + 1) * unit_width * <span style="color: #8b2252;">' '</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38388;&#38548;&#23383;&#31526;
</span>        <span style="color: #a0522d;">end</span> = start + start
        <span style="color: #483d8b;">print</span>(interval.join(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> x: <span style="color: #8b2252;">"{:{}}"</span>.<span style="color: #483d8b;">format</span>(x, unit_width), array[start:end])))
        <span style="color: #a0522d;">start</span> = end


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20026;&#20102;&#21644;&#32534;&#30721;&#23545;&#24212;&#65292;&#22686;&#21152;&#19968;&#20010;&#26080;&#29992;&#30340;0&#22312;&#39318;&#20301;
</span><span style="color: #a0522d;">origin</span> = [<span style="color: #008b8b;">None</span>, 30, 20, 80, 40, 50, 10, 60, 70, 90]
<span style="color: #a0522d;">total</span> = <span style="color: #483d8b;">len</span>(origin) - 1
print_tree(origin)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">heap_adjust</span>(i, n, array:<span style="color: #483d8b;">list</span>):
    <span style="color: #a020f0;">while</span> 2*i &lt;= n: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#23450;&#26377;&#24038;&#23401;&#23376;&#33410;&#28857;
</span>        <span style="color: #a0522d;">lchild_index</span> = 2 * i
        <span style="color: #a0522d;">max_child_index</span> = lchild_index <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20551;&#23450;&#23401;&#23376;&#33410;&#28857;&#20013;&#24038;&#23401;&#23376;&#30446;&#21069;&#26368;&#22823;
</span>        <span style="color: #a020f0;">if</span> lchild_index + 1 &lt;= n <span style="color: #a020f0;">and</span> array[lchild_index + 1] &gt; array[lchild_index]: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23384;&#22312;&#21491;&#23401;&#23376;&#33410;&#28857;
</span>            <span style="color: #a0522d;">max_child_index</span> = lchild_index + 1

        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21644;&#33258;&#24049;&#30340;&#26681;&#27604;&#36739;
</span>        <span style="color: #a020f0;">if</span> array[max_child_index] &gt; array[i]:
            <span style="color: #a0522d;">array</span>[<span style="color: #a0522d;">i</span>], <span style="color: #a0522d;">array</span>[max_child_index] = array[max_child_index], array[i]
            <span style="color: #a0522d;">i</span> = max_child_index
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">break</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">heap_adjust(total//2, total, origin)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;"># heap_adjust(1, 9, origin)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print_tree(origin)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print('-' * 30)
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26500;&#24314;&#22823;&#39030;&#22534;&#12289;&#22823;&#26681;&#22534;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">max_heap</span>(n, array:<span style="color: #483d8b;">list</span>):
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(n // 2, 0, -1):
        heap_adjust(i, n, array)
    <span style="color: #a020f0;">return</span> array

max_heap(total, origin)
print_tree(origin)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"="</span> * 30)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;">#               </span><span style="color: #b22222;">30
</span><span style="color: #b22222;">#       </span><span style="color: #b22222;">20              80
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">40      50      10      60
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">70  90
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;">#               </span><span style="color: #b22222;">90
</span><span style="color: #b22222;">#       </span><span style="color: #b22222;">70              80
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">40      50      10      60
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">20  30
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">==============================</span>
</pre>
</div>

<p>
4.排序
</p>

<ul class="org-ul">
<li>将大顶堆根结点逐个最大值和最后一个叶子结点交换，那么最后一个叶子结点就是最大值，将这个叶子结点排除在待排序结点之外</li>
<li>从根结点开始（新的根结点），重新调整为大顶堆后，重复上一步</li>
</ul>



<figure id="org543f092">
<img src="./images/img_20250228_151738.png" alt="img_20250228_151738.png" width="50%">

</figure>

<ul class="org-ul">
<li>堆顶和最后一个结点交换，并排序最后一个结点</li>
</ul>



<figure id="org5482f4d">
<img src="./images/img_20250228_151816.png" alt="img_20250228_151816.png" width="50%">

</figure>



<figure id="org9b3f3d1">
<img src="./images/img_20250228_152802.png" alt="img_20250228_152802.png" width="50%">

</figure>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#               </span><span style="color: #b22222;">30
</span><span style="color: #b22222;">#       </span><span style="color: #b22222;">20              80
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">40      50      10      60
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">70  90
</span><span style="color: #a020f0;">import</span> math

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print_tree</span>(array,unit_width=2):
    <span style="color: #8b2252;">'''
     i  &#21069;&#31354;&#26684;      &#20803;&#32032;&#38388;
   1 3  7=2**3-1  0 2*7+1 2*&#21069;&#31354;&#26684;+1
   2 2  3=2**2-1  7=2**3+1
   3 1  1=2**1-1  3=2**1+1
   4 0  0=2**0-1  1=2*0+1
    '''</span>
    <span style="color: #a0522d;">length</span> = <span style="color: #483d8b;">len</span>(array)
    <span style="color: #a0522d;">start</span> = 1
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22240;&#20026;&#20351;&#29992;&#26102;&#21069;&#38754;&#34917;0&#20102;,&#19981;&#28982;&#24212;&#35813;&#26159;math.ceil(math.log2(len(array)+1)
</span>    <span style="color: #a0522d;">depth</span> = math.ceil(math.log2(length)) <span style="color: #b22222;"># </span><span style="color: #b22222;">4
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">print(depth)
</span>    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(depth, 0, -1):
        <span style="color: #a0522d;">pre</span> = 2 ** (i - 1) - 1
        <span style="color: #483d8b;">print</span>(pre * unit_width * <span style="color: #8b2252;">' '</span>, end=<span style="color: #8b2252;">""</span>)
        <span style="color: #a0522d;">interval</span> = (2 * pre + 1) * unit_width * <span style="color: #8b2252;">' '</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38388;&#38548;&#23383;&#31526;
</span>        <span style="color: #a0522d;">end</span> = start + start
        <span style="color: #483d8b;">print</span>(interval.join(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> x: <span style="color: #8b2252;">"{:{}}"</span>.<span style="color: #483d8b;">format</span>(x, unit_width), array[start:end])))
        <span style="color: #a0522d;">start</span> = end


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20026;&#20102;&#21644;&#32534;&#30721;&#23545;&#24212;&#65292;&#22686;&#21152;&#19968;&#20010;&#26080;&#29992;&#30340;0&#22312;&#39318;&#20301;
</span><span style="color: #a0522d;">origin</span> = [<span style="color: #008b8b;">None</span>, 30, 20, 80, 40, 50, 10, 60, 70, 90]
<span style="color: #a0522d;">total</span> = <span style="color: #483d8b;">len</span>(origin) - 1
print_tree(origin)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">heap_adjust</span>(i, n, array:<span style="color: #483d8b;">list</span>):
    <span style="color: #a020f0;">while</span> 2*i &lt;= n: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#23450;&#26377;&#24038;&#23401;&#23376;&#33410;&#28857;
</span>        <span style="color: #a0522d;">lchild_index</span> = 2 * i
        <span style="color: #a0522d;">max_child_index</span> = lchild_index <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20551;&#23450;&#23401;&#23376;&#33410;&#28857;&#20013;&#24038;&#23401;&#23376;&#30446;&#21069;&#26368;&#22823;
</span>        <span style="color: #a020f0;">if</span> lchild_index + 1 &lt;= n <span style="color: #a020f0;">and</span> array[lchild_index + 1] &gt; array[lchild_index]: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23384;&#22312;&#21491;&#23401;&#23376;&#33410;&#28857;
</span>            <span style="color: #a0522d;">max_child_index</span> = lchild_index + 1

        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21644;&#33258;&#24049;&#30340;&#26681;&#27604;&#36739;
</span>        <span style="color: #a020f0;">if</span> array[max_child_index] &gt; array[i]:
            <span style="color: #a0522d;">array</span>[<span style="color: #a0522d;">i</span>], <span style="color: #a0522d;">array</span>[max_child_index] = array[max_child_index], array[i]
            <span style="color: #a0522d;">i</span> = max_child_index
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">break</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">heap_adjust(total//2, total, origin)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;"># heap_adjust(1, 9, origin)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print_tree(origin)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print('-' * 30)
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26500;&#24314;&#22823;&#39030;&#22534;&#12289;&#22823;&#26681;&#22534;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">max_heap</span>(n, array:<span style="color: #483d8b;">list</span>):
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(n // 2, 0, -1):
        heap_adjust(i, n, array)
    <span style="color: #a020f0;">return</span> array

max_heap(total, origin)
print_tree(origin)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"="</span> * 30)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25490;&#24207;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">sort</span>(n, array:<span style="color: #483d8b;">list</span>):
    <span style="color: #a020f0;">while</span> n &gt; 1:
        <span style="color: #a0522d;">array</span>[1], <span style="color: #a0522d;">array</span>[n] = array[n], array[1] <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22534;&#39030;&#21644;&#26368;&#21518;&#19968;&#20010;&#32467;&#28857;&#20132;&#25442;
</span>        <span style="color: #a0522d;">n</span> -= 1
        <span style="color: #a020f0;">if</span> n == 2 <span style="color: #a020f0;">and</span> array[n] &gt;= array[n - 1]:
            <span style="color: #a020f0;">break</span>
        heap_adjust(1, n, array)
    <span style="color: #a020f0;">return</span> array

print_tree(sort(total, origin))
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"-"</span>*30)
<span style="color: #483d8b;">print</span>(origin[1:])


<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;">#               </span><span style="color: #b22222;">30
</span><span style="color: #b22222;">#       </span><span style="color: #b22222;">20              80
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">40      50      10      60
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">70  90
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;">#               </span><span style="color: #b22222;">90
</span><span style="color: #b22222;">#       </span><span style="color: #b22222;">70              80
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">40      50      10      60
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">20  30
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;">#               </span><span style="color: #b22222;">10
</span><span style="color: #b22222;">#       </span><span style="color: #b22222;">20              30
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">40      50      60      70
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">80  90
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[10, 20, 30, 40, 50, 60, 70, 80, 90]</span>
</pre>
</div>


<p>
总结
</p>
<ul class="org-ul">
<li>是利用堆性质的一种选择排序，在堆顶选出最大值或者最小值</li>
<li>时间复杂度
<ul class="org-ul">
<li>堆排序的时间复杂度为O(nlogn)</li>
<li>由于堆排序对原始记录的排序状态并不敏感，因此它无论是最好、最坏和平均时间复杂度均为O(nlogn)</li>
</ul></li>
</ul>

<p>
空间复杂度
</p>
<ul class="org-ul">
<li>只是使用了一个交换用的空间，空间复杂度就是O(1)</li>
<li>稳定性</li>
<li>不稳定的排序算法</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-h:02315aaf-3f3c-4691-b457-e71827690ea5" class="outline-3">
<h3 id="h:02315aaf-3f3c-4691-b457-e71827690ea5">高阶函数与柯里化</h3>
<div class="outline-text-3" id="text-h:02315aaf-3f3c-4691-b457-e71827690ea5">
</div>
<div id="outline-container-h:2697d864-0f9d-4561-93b7-84ecb7d21679" class="outline-4">
<h4 id="h:2697d864-0f9d-4561-93b7-84ecb7d21679">高阶函数</h4>
<div class="outline-text-4" id="text-h:2697d864-0f9d-4561-93b7-84ecb7d21679">
</div>
<div id="outline-container-h:b6eef3b4-c035-4e79-af28-e4ac44ff8180" class="outline-5">
<h5 id="h:b6eef3b4-c035-4e79-af28-e4ac44ff8180">一等公民</h5>
<div class="outline-text-5" id="text-h:b6eef3b4-c035-4e79-af28-e4ac44ff8180">
<ul class="org-ul">
<li>函数在Python是一等公民(First-Class Object)</li>
<li>函数也是对象，是可调用对象</li>

<li>函数可以作为普通变量，也可以作为函数的参数、返回值</li>
</ul>
</div>
</div>
<div id="outline-container-h:5e418ca4-ea02-4722-9b71-e30d7fe9df33" class="outline-5">
<h5 id="h:5e418ca4-ea02-4722-9b71-e30d7fe9df33">高阶函数</h5>
<div class="outline-text-5" id="text-h:5e418ca4-ea02-4722-9b71-e30d7fe9df33">
<p>
高阶函数(High-order Function)
</p>

<ul class="org-ul">
<li>数学概念 y = f(g(x))</li>
<li>在数学和计算科学中，高阶函数应当是至少满足下面一个条件的函数
<ul class="org-ul">
<li>接受一个或多个函数作为参数</li>
<li>输出一个函数</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">abc</span>():
    <span style="color: #a020f0;">pass</span>

<span style="color: #483d8b;">print</span>(abc, <span style="color: #483d8b;">type</span>(abc), abc.<span style="color: #483d8b;">__name__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">abc.__name__ &#34920;&#31034;abc&#30340;&#21517;&#23383;&#26159;&#20160;&#20040;&#65311;&#26159;&#19968;&#20010;&#23383;&#31526;&#20018;&#12290;type(abc)&#20013;abc&#26159;&#26631;&#35782;&#31526;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;function abc at 0x0000020652EA6280&gt; &lt;class 'function'&gt; abc</span>
</pre>
</div>

<p>
观察下面的函数定义，回答问题
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">counter</span>(base):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inc</span>(step=1):
        <span style="color: #a0522d;">base</span> += step
        <span style="color: #a020f0;">return</span> base
    <span style="color: #a020f0;">return</span> inc

<span style="color: #b22222;">#</span><span style="color: #b22222;">1 &#26159;&#39640;&#38454;&#20989;&#25968;&#21527;&#65311;&#20026;&#20160;&#20040;&#12290;&#26159;&#65292;return inc &#36755;&#20986;&#20989;&#25968;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">2 &#26377;&#27809;&#26377;&#23884;&#22871;&#20989;&#25968;&#65292;&#26377;&#38381;&#21253;&#21527;&#65311;base += step,&#29992;&#21040;base&#65292;&#22240;&#20026;base&#26159;&#24418;&#21442;&#65292;&#24418;&#21442;&#23601;&#26159;&#23616;&#37096;&#21464;&#37327;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">3 &#20195;&#30721;&#23545;&#21527;&#65311;&#22914;&#26524;&#19981;&#23545;&#65292;&#24590;&#20040;&#25913;&#12290;&#19981;&#23545;
</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">counter</span>(base):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inc</span>(step=1):
        <span style="color: #a020f0;">nonlocal</span> base <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22768;&#26126;base&#19981;&#26159;&#26412;&#22320;&#21464;&#37327;
</span>        <span style="color: #a0522d;">base</span> += step
        <span style="color: #a020f0;">return</span> base
    <span style="color: #a020f0;">return</span> inc

<span style="color: #a0522d;">c</span> = counter(10)
<span style="color: #483d8b;">print</span>(c())
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 11
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">4 f1 == f2?
</span><span style="color: #a0522d;">f1</span> = counter(10) <span style="color: #b22222;">#</span><span style="color: #b22222;">f1 -&gt; inc &#25152;&#25351;&#21521;&#30340;&#23545;&#35937;&#65292;inc&#26631;&#35782;&#31526;&#38543;&#30528;counter&#35843;&#29992;&#32467;&#26463;&#32780;&#28040;&#20129;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">inc&#25152;&#25351;&#21521;
</span><span style="color: #a0522d;">f2</span> = counter(10)
<span style="color: #483d8b;">print</span>(f1 == f2) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20989;&#25968;&#27809;&#27861;&#27604;&#36739;&#20869;&#23481;&#65292;&#20195;&#34920;f1 is f2
</span><span style="color: #483d8b;">print</span>(f1 <span style="color: #a020f0;">is</span> f2)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: False
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: False</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:9484492c-6951-40a7-a88d-841dd42cee5e" class="outline-5">
<h5 id="h:9484492c-6951-40a7-a88d-841dd42cee5e">sorted函数原理</h5>
<div class="outline-text-5" id="text-h:9484492c-6951-40a7-a88d-841dd42cee5e">
</div>
<div id="outline-container-h:fe65db62-8d68-498e-8cf3-a0266b3f8e8c" class="outline-6">
<h6 id="h:fe65db62-8d68-498e-8cf3-a0266b3f8e8c">练习：自定义sort函数</h6>
<div class="outline-text-6" id="text-h:fe65db62-8d68-498e-8cf3-a0266b3f8e8c">
<p>
仿照内建函数sorted，请自行实现一个sort函数(不使用内建函数)，能够为列表元素排序。
</p>

<p>
思考：通过练习，思考sorted函数的实现原理，map、filter函数的实现原理
</p>

<p>
<b>思考</b> ：
</p>
<ul class="org-ul">
<li>内建函数sorted函数，它返回一个新列表，使用reverse可以设置升序或降序，使用key可以设置一个用于比较的函数(自定义函数也要实现这些功能)</li>
<li>新建一个列表，遍历原列表，和新列表中的当前值依次比较，决定待插入数插入到新列表的什么位置</li>
</ul>

<pre class="example" id="orgaf19c0e">
sorted(iterable, *, key=None, reverse=False)
</pre>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">sort</span>(iterable, *, key=<span style="color: #008b8b;">None</span>, reverse=<span style="color: #008b8b;">False</span>):
    <span style="color: #a0522d;">newlist</span> = []
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#38754;&#26159;&#31639;&#27861;&#65292;&#20174;&#21407;&#21015;&#34920;iterable&#20013;&#36941;&#21382;&#20803;&#32032;&#65292;&#27599;&#19968;&#20010;&#20803;&#32032;&#36880;&#20010;&#25554;&#20837;&#21040;newlist&#20013;&#21512;&#36866;&#30340;&#20301;&#32622;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#19968;&#20010;&#21319;&#24207;&#25110;&#38477;&#24207;&#30340;newlist
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#21487;&#20197;&#65292;&#20808;&#23454;&#29616;reverse
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#21487;&#20197;&#65292;&#20877;&#23454;&#29616; key
</span>
    <span style="color: #a020f0;">return</span> newlist <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#24207;&#30340;&#21015;&#34920;
</span>


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">sort</span>(iterable, *, key=<span style="color: #008b8b;">None</span>, reverse=<span style="color: #008b8b;">False</span>):  <span style="color: #b22222;">#</span><span style="color: #b22222;">[1, 2, 3]
</span>    <span style="color: #a0522d;">newlist</span> = []
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#38754;&#26159;&#31639;&#27861;&#65292;&#20174;&#21407;&#21015;&#34920;iterable&#20013;&#36941;&#21382;&#20803;&#32032;&#65292;&#27599;&#19968;&#20010;&#20803;&#32032;&#36880;&#20010;&#25554;&#20837;&#21040;newlist&#20013;&#21512;&#36866;&#30340;&#20301;&#32622;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#19968;&#20010;&#21319;&#24207;&#25110;&#38477;&#24207;&#30340;newlist
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#21487;&#20197;&#65292;&#20808;&#23454;&#29616;reverse
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#21487;&#20197;&#65292;&#20877;&#23454;&#29616; key
</span>
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> iterable: <span style="color: #b22222;">#</span><span style="color: #b22222;">x 1
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312;newlist&#24403;&#20013;&#65292;&#20174;&#31532;&#19968;&#20010;&#20803;&#32032;&#24320;&#22987;&#65292;&#19968;&#23450;&#35201;&#20445;&#35777;&#26377;&#24207;&#65292;&#21487;&#20197;&#35748;&#20026;newlist&#23601;&#26159;&#26377;&#24207;&#21306;
</span>        <span style="color: #a020f0;">for</span> i, y <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">enumerate</span>(newlist):
            <span style="color: #a020f0;">pass</span>
        <span style="color: #a020f0;">else</span>:
            newlist.append(x) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31532;&#19968;&#20010;&#20803;&#32032;
</span>
    <span style="color: #a020f0;">return</span> newlist <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#24207;&#30340;&#21015;&#34920;
</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26680;&#24515;&#31639;&#27861;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">sort</span>(iterable, *, key=<span style="color: #008b8b;">None</span>, reverse=<span style="color: #008b8b;">False</span>):  <span style="color: #b22222;">#</span><span style="color: #b22222;">[1, 2, 3]
</span>    <span style="color: #a0522d;">newlist</span> = []
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#38754;&#26159;&#31639;&#27861;&#65292;&#20174;&#21407;&#21015;&#34920;iterable&#20013;&#36941;&#21382;&#20803;&#32032;&#65292;&#27599;&#19968;&#20010;&#20803;&#32032;&#36880;&#20010;&#25554;&#20837;&#21040;newlist&#20013;&#21512;&#36866;&#30340;&#20301;&#32622;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#19968;&#20010;&#21319;&#24207;&#25110;&#38477;&#24207;&#30340;newlist
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#21487;&#20197;&#65292;&#20808;&#23454;&#29616;reverse
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#21487;&#20197;&#65292;&#20877;&#23454;&#29616; key
</span>
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> iterable: <span style="color: #b22222;">#</span><span style="color: #b22222;">x 1
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312;newlist&#24403;&#20013;&#65292;&#20174;&#31532;&#19968;&#20010;&#20803;&#32032;&#24320;&#22987;&#65292;&#19968;&#23450;&#35201;&#20445;&#35777;&#26377;&#24207;&#65292;&#21487;&#20197;&#35748;&#20026;newlist&#23601;&#26159;&#26377;&#24207;&#21306;
</span>        <span style="color: #a020f0;">for</span> i, y <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">enumerate</span>(newlist):

            <span style="color: #b22222;">#</span><span style="color: #b22222;">if x &gt; y: # &#38477;&#24207;
</span>            <span style="color: #a020f0;">if</span> x &lt; y: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21319;&#24207;
</span>                newlist.insert(i,x) <span style="color: #b22222;"># </span><span style="color: #b22222;">[2, 1]
</span>                <span style="color: #a020f0;">break</span>
        <span style="color: #a020f0;">else</span>:
            newlist.append(x) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31532;&#19968;&#20010;&#20803;&#32032;
</span>
    <span style="color: #a020f0;">return</span> newlist <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#24207;&#30340;&#21015;&#34920;
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">sorted</span>(<span style="color: #483d8b;">reversed</span>(<span style="color: #483d8b;">range</span>(5))))
<span style="color: #483d8b;">print</span>(sort(<span style="color: #483d8b;">reversed</span>(<span style="color: #483d8b;">range</span>(5))))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: [0, 1, 2, 3, 4]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: [0, 1, 2, 3, 4]
</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21319;&#24207;&#21644;&#38477;&#24207;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">sort</span>(iterable, *, key=<span style="color: #008b8b;">None</span>, reverse=<span style="color: #008b8b;">False</span>):  <span style="color: #b22222;">#</span><span style="color: #b22222;">[1, 2, 3]
</span>    <span style="color: #a0522d;">newlist</span> = []
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#38754;&#26159;&#31639;&#27861;&#65292;&#20174;&#21407;&#21015;&#34920;iterable&#20013;&#36941;&#21382;&#20803;&#32032;&#65292;&#27599;&#19968;&#20010;&#20803;&#32032;&#36880;&#20010;&#25554;&#20837;&#21040;newlist&#20013;&#21512;&#36866;&#30340;&#20301;&#32622;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#19968;&#20010;&#21319;&#24207;&#25110;&#38477;&#24207;&#30340;newlist
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#21487;&#20197;&#65292;&#20808;&#23454;&#29616;reverse
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#21487;&#20197;&#65292;&#20877;&#23454;&#29616; key
</span>
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> iterable: <span style="color: #b22222;">#</span><span style="color: #b22222;">x 1
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312;newlist&#24403;&#20013;&#65292;&#20174;&#31532;&#19968;&#20010;&#20803;&#32032;&#24320;&#22987;&#65292;&#19968;&#23450;&#35201;&#20445;&#35777;&#26377;&#24207;&#65292;&#21487;&#20197;&#35748;&#20026;newlist&#23601;&#26159;&#26377;&#24207;&#21306;
</span>        <span style="color: #a020f0;">for</span> i, y <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">enumerate</span>(newlist):
            <span style="color: #a0522d;">comp</span> = x &gt; y <span style="color: #a020f0;">if</span> reverse <span style="color: #a020f0;">else</span> x &lt; y
            <span style="color: #b22222;">#</span><span style="color: #b22222;">if x &gt; y: # &#38477;&#24207;; if x &lt; y: # &#21319;&#24207;
</span>            <span style="color: #a020f0;">if</span> comp:
                newlist.insert(i,x) <span style="color: #b22222;"># </span><span style="color: #b22222;">[2, 1]
</span>                <span style="color: #a020f0;">break</span>
        <span style="color: #a020f0;">else</span>:
            newlist.append(x) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31532;&#19968;&#20010;&#20803;&#32032;
</span>
    <span style="color: #a020f0;">return</span> newlist <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#24207;&#30340;&#21015;&#34920;
</span>
<span style="color: #483d8b;">print</span>(sort([5,4,3,2,1], reverse=<span style="color: #008b8b;">True</span>))
<span style="color: #483d8b;">print</span>(sort([5,4,3,2,1], reverse=<span style="color: #008b8b;">False</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: [5, 4, 3, 2, 1]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: [1, 2, 3, 4, 5]
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">key&#27604;&#36739;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">sort</span>(iterable, *, key=<span style="color: #008b8b;">None</span>, reverse=<span style="color: #008b8b;">False</span>):  <span style="color: #b22222;">#</span><span style="color: #b22222;">[1, 2, 3]
</span>    <span style="color: #a0522d;">newlist</span> = []
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#38754;&#26159;&#31639;&#27861;&#65292;&#20174;&#21407;&#21015;&#34920;iterable&#20013;&#36941;&#21382;&#20803;&#32032;&#65292;&#27599;&#19968;&#20010;&#20803;&#32032;&#36880;&#20010;&#25554;&#20837;&#21040;newlist&#20013;&#21512;&#36866;&#30340;&#20301;&#32622;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#19968;&#20010;&#21319;&#24207;&#25110;&#38477;&#24207;&#30340;newlist
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#21487;&#20197;&#65292;&#20808;&#23454;&#29616;reverse
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#21487;&#20197;&#65292;&#20877;&#23454;&#29616; key
</span>
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> iterable: <span style="color: #b22222;">#</span><span style="color: #b22222;">x 1
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312;newlist&#24403;&#20013;&#65292;&#20174;&#31532;&#19968;&#20010;&#20803;&#32032;&#24320;&#22987;&#65292;&#19968;&#23450;&#35201;&#20445;&#35777;&#26377;&#24207;&#65292;&#21487;&#20197;&#35748;&#20026;newlist&#23601;&#26159;&#26377;&#24207;&#21306;
</span>        <span style="color: #a0522d;">cx</span> = key(x)
        <span style="color: #a020f0;">for</span> i, y <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">enumerate</span>(newlist):
            <span style="color: #b22222;">#</span><span style="color: #b22222;">cx = key(x)
</span>            <span style="color: #a0522d;">cy</span> = key(y)
            <span style="color: #a0522d;">comp</span> = cx &gt; cy <span style="color: #a020f0;">if</span> reverse <span style="color: #a020f0;">else</span> cx &lt; cy <span style="color: #b22222;">#</span><span style="color: #b22222;">x &gt; y: # &#38477;&#24207;; x &lt; y: # &#21319;&#24207;
</span>            <span style="color: #a020f0;">if</span> comp:
                newlist.insert(i,x) <span style="color: #b22222;"># </span><span style="color: #b22222;">[2, 1]
</span>                <span style="color: #a020f0;">break</span>
        <span style="color: #a020f0;">else</span>:
            newlist.append(x) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31532;&#19968;&#20010;&#20803;&#32032;
</span>
    <span style="color: #a020f0;">return</span> newlist <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#24207;&#30340;&#21015;&#34920;
</span>
<span style="color: #483d8b;">print</span>(sort([<span style="color: #8b2252;">'1'</span>, 2, <span style="color: #8b2252;">'3'</span>, <span style="color: #8b2252;">'4'</span>], key=<span style="color: #483d8b;">str</span>)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20250;&#25226;&#20803;&#32032;&#19968;&#20010;&#20010;str(item)
</span><span style="color: #483d8b;">print</span>(sort([<span style="color: #8b2252;">'1'</span>, 2, <span style="color: #8b2252;">'3'</span>, <span style="color: #8b2252;">'4'</span>], key=<span style="color: #a020f0;">lambda</span> x: <span style="color: #483d8b;">str</span>(x))) <span style="color: #b22222;">#</span><span style="color: #b22222;">def fn(x) :pass fn(item)
</span><span style="color: #483d8b;">print</span>(sort([<span style="color: #8b2252;">'1'</span>, 2, <span style="color: #8b2252;">'3'</span>, <span style="color: #8b2252;">'4'</span>], key=<span style="color: #483d8b;">int</span>)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20250;&#25226;&#20803;&#32032;&#19968;&#20010;&#20010;str(item)
</span><span style="color: #483d8b;">print</span>(sort([<span style="color: #8b2252;">'a'</span>, 1, 2, <span style="color: #8b2252;">'b'</span>, 12, <span style="color: #8b2252;">'c'</span>, 32], key=<span style="color: #a020f0;">lambda</span> x: <span style="color: #483d8b;">int</span>(x, 16) <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(x, <span style="color: #483d8b;">str</span>) <span style="color: #a020f0;">else</span> x)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25972;&#25968;&#27604;&#36739;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: ['1', 2, '3', '4']
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: ['1', 2, '3', '4']
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: ['1', 2, '3', '4']
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: [1, 2, 'a', 'b', 12, 'c', 32]</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:1b12f625-c4f1-47db-91c2-85fc7f3e18a2" class="outline-5">
<h5 id="h:1b12f625-c4f1-47db-91c2-85fc7f3e18a2">内建高阶函数</h5>
<div class="outline-text-5" id="text-h:1b12f625-c4f1-47db-91c2-85fc7f3e18a2">
</div>
<div id="outline-container-h:d66ee062-1184-43a3-a8a1-e94797d9edaa" class="outline-6">
<h6 id="h:d66ee062-1184-43a3-a8a1-e94797d9edaa">排序sorted</h6>
<div class="outline-text-6" id="text-h:d66ee062-1184-43a3-a8a1-e94797d9edaa">
<p>
定义 <code>sorted(iterable, *, key=None, reverse=False) -&gt; list</code> ，不在赘
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a0522d;">lst</span> = [1,2,3,4,5]
<span style="color: #483d8b;">sorted</span>(lst, key=<span style="color: #a020f0;">lambda</span> x:6-x) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#26032;&#21015;&#34920;
</span>lst.sort(key=<span style="color: #a020f0;">lambda</span> x: 6-x) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23601;&#22320;&#20462;&#25913;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:56dd3549-1219-4341-8f79-a8c38d5ebc67" class="outline-6">
<h6 id="h:56dd3549-1219-4341-8f79-a8c38d5ebc67">过滤filter</h6>
<div class="outline-text-6" id="text-h:56dd3549-1219-4341-8f79-a8c38d5ebc67">
<ul class="org-ul">
<li>定义 <code>filter(function, iterable)</code></li>
<li>对可迭代对象进行遍历，返回一个迭代器</li>
<li>function参数是一个参数的函数，且返回值应当是bool类型，或其返回值等效布尔值</li>
<li>function参数如果是None，可迭代对象的每一个元素自身等效布尔值</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">filter</span>(<span style="color: #008b8b;">None</span>, [1,2,3,4,5])))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: [1, 2, 3, 4, 5]
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">filter</span>(<span style="color: #008b8b;">None</span>, <span style="color: #483d8b;">range</span>(-5, 5)))) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21333;&#21333;&#26159; 0 &#19981;&#35265;&#20102;&#65292;&#20026;&#20160;&#20040;&#65311;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: [-5, -4, -3, -2, -1, 1, 2, 3, 4]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;filter&#31532;&#19968;&#20010;&#21442;&#25968;&#20026;None&#65292;&#21487;&#36845;&#20195;&#23545;&#35937;&#30340;&#25152;&#26377;&#20803;&#32032;&#65292;&#25353;&#29031;&#26412;&#36523;&#30340;&#31561;&#25928;True&#25110;False&#65292;&#22914;&#26524;&#31561;&#25928;False&#65292;&#23601;&#19981;&#35201;&#20102;&#12290;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">filter</span>(<span style="color: #a020f0;">lambda</span> x: x%3==0, [1,4,7,9,-3,-12]))) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21333;&#21442;&#20989;&#25968;&#21644;sorted&#30340;key&#19968;&#26679;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: [9, -3, -12]
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">def filter(function or None, iterable): #&#31614;&#21517;&#65292;&#36807;&#28388;&#65292;&#25226;&#31526;&#21512;&#26465;&#20214;&#30340;&#30041;&#19979;&#65292;&#25226;&#19981;&#31526;&#21512;&#30340;&#31579;&#25481;&#65292;&#36820;&#22238;&#24816;&#24615;&#36845;&#20195;&#22120;
</span><span style="color: #b22222;">#    </span><span style="color: #b22222;">pass
</span>
</pre>
</div>

<ul class="org-ul">
<li>sorted 函数处理过一个列表后，排序生成的新列表和原列表元素个数一致吗？ 一致的</li>
<li>filter 处理一个列表后，迭代出的元素个数和原列表一致吗？过滤，不一定一致</li>
</ul>
</div>
</div>
<div id="outline-container-h:1ebea3dd-8216-4006-a068-bfd72d575009" class="outline-6">
<h6 id="h:1ebea3dd-8216-4006-a068-bfd72d575009">映射map</h6>
<div class="outline-text-6" id="text-h:1ebea3dd-8216-4006-a068-bfd72d575009">
<p>
map 把一个列表的所有元素，一个都不能少，从一种形式转换到另一种形式
</p>

<ul class="org-ul">
<li>定义 <code>map(function, *iterable) -map object</code></li>
<li>对多个可迭代对象的元素，按照指定的函数进行映射</li>
<li>返回一个迭代器</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">conding: utf-8
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(<span style="color: #483d8b;">map</span>(<span style="color: #483d8b;">str</span>, <span style="color: #483d8b;">range</span>(5))))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 0
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">map</span>(<span style="color: #483d8b;">str</span>, <span style="color: #483d8b;">range</span>(5))))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: ['0', '1', '2', '3', '4']
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> x: <span style="color: #483d8b;">chr</span>(x+65), <span style="color: #483d8b;">range</span>(5))))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: ['A', 'B', 'C', 'D', 'E']
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> x: x, <span style="color: #483d8b;">range</span>(5))))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: [0, 1, 2, 3, 4]
</span>

<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> x,y: (x,y), <span style="color: #8b2252;">'abcde'</span>, <span style="color: #483d8b;">range</span>(5))))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dict</span>(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> x,y: (x,y), <span style="color: #8b2252;">'abcde'</span>, <span style="color: #483d8b;">range</span>(5))))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dict</span>(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> x,y: (x,<span style="color: #483d8b;">str</span>(y+100)), <span style="color: #8b2252;">'abcde'</span>, <span style="color: #483d8b;">range</span>(5))))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: [('a', 0), ('b', 1), ('c', 2), ('d', 3), ('e', 4)]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: {'a': 0, 'b': 1, 'c': 2, 'd': 3, 'e': 4}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: {'a': '100', 'b': '101', 'c': '102', 'd': '103', 'e': '104'}</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:324788b1-5dae-4dc8-bdee-a26d7aa7c37a" class="outline-4">
<h4 id="h:324788b1-5dae-4dc8-bdee-a26d7aa7c37a">柯里化**</h4>
<div class="outline-text-4" id="text-h:324788b1-5dae-4dc8-bdee-a26d7aa7c37a">
<ul class="org-ul">
<li>指的是将原来接受两个参数的函数变成新的接受一个参数的函数的过程。新的函数返回一个以原有第二个参数为参数的函数</li>

<li>z = f(x, y) 转换成 z = f(x)(y)的形式</li>
</ul>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x,y):
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(add(4, 5))

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(y):
        <span style="color: #a020f0;">return</span> x + y
    <span style="color: #a020f0;">return</span> fn

add(4)(5)
<span style="color: #a0522d;">fn</span> = add(4)
<span style="color: #a0522d;">result</span> = fn(5)
<span style="color: #483d8b;">print</span>(result)
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26607;&#37324;&#21270;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add(4)(5,6)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add(4)(5)(6)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add(4,5)(6)
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(y,z):
        <span style="color: #a020f0;">return</span> x+y+z 
    <span style="color: #a020f0;">return</span> fn
<span style="color: #483d8b;">print</span>(add(4)(5,6))

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inner</span>(z):
        <span style="color: #a020f0;">return</span> x + y +z
    <span style="color: #a020f0;">return</span> inner
<span style="color: #483d8b;">print</span>(add(4,5)(6))

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inner</span>(y):
        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inner2</span>(z):
            <span style="color: #a020f0;">return</span> x + y + z
        <span style="color: #a020f0;">return</span> inner2
    <span style="color: #a020f0;">return</span> inner

<span style="color: #483d8b;">print</span>(add(4)(5)(6))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:6dfd77b3-9f53-4201-8f89-905df45bc327" class="outline-3">
<h3 id="h:6dfd77b3-9f53-4201-8f89-905df45bc327">装饰器</h3>
<div class="outline-text-3" id="text-h:6dfd77b3-9f53-4201-8f89-905df45bc327">
</div>
<div id="outline-container-h:ad726813-09d4-430e-95b4-7ba2ca5f5648" class="outline-4">
<h4 id="h:ad726813-09d4-430e-95b4-7ba2ca5f5648">由来</h4>
<div class="outline-text-4" id="text-h:ad726813-09d4-430e-95b4-7ba2ca5f5648">
<p>
<b>演化装饰前</b>
</p>

<ol class="org-ol">
<li>提供一个函数logger完成记录功能</li>
</ol>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#35013;&#39280;&#22120;&#65292;&#29992;&#26469;&#35013;&#39280;&#30340;&#65292;&#19968;&#33324;&#26469;&#35762;&#35013;&#39280;&#20989;&#25968;&#25110;&#31867;&#12289;
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19994;&#21153;&#21151;&#33021;&#21152;&#27861;&#65292;&#22686;&#21152;&#19968;&#20010;&#21151;&#33021;&#65306;&#33021;&#19981;&#33021;&#35760;&#24405;&#19968;&#19979;&#35843;&#29992;&#21442;&#25968;
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'add function called. x={}, y={}'</span>.<span style="color: #483d8b;">format</span>(x, y)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38750;&#19994;&#21153;&#21151;&#33021;&#20195;&#30721;&#20889;&#22312;&#19994;&#21153;&#20195;&#30721;&#20013;&#65292;&#19981;&#22909;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20405;&#20837;&#24335;&#20195;&#30721;&#65292;&#21093;&#31163;&#19981;&#26131;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#25442;&#19968;&#31181;&#24605;&#32500;&#65292;A&#20989;&#25968;&#38656;&#35201;&#35760;&#24405;&#65292;B&#20989;&#25968;&#20063;&#35201;&#35760;&#24405;&#65292;&#35760;&#24405;&#21151;&#33021;&#20063;&#19981;&#23646;&#20110;A&#21644;B&#30340;&#19994;&#21153;&#21151;&#33021;&#65292;&#32780;&#19988;&#23427;&#26159;A&#21644;B&#30340;&#20844;&#29992;&#30340;&#21151;&#33021;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#26377;C&#20989;&#25968;&#65292;&#20063;&#38656;&#35201;&#27492;&#21151;&#33021;&#24590;&#20040;&#21150;&#65311;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25277;&#21462;&#20986;&#35760;&#24405;&#21151;&#33021;&#65292;&#24418;&#25104;&#19968;&#20010;&#20989;&#25968;
</span>    <span style="color: #a020f0;">return</span> x + y

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
    <span style="color: #a020f0;">return</span> x + y
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38543;&#20415;&#21738;&#20010;&#20989;&#25968;fn
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">print('&#35843;&#29992;&#21069;&#22686;&#24378;&#21151;&#33021;')
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} function called. x={}, y={}'</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, 4, 5))
    <span style="color: #a0522d;">ret</span> = fn(4, 5)
    <span style="color: #b22222;">#</span><span style="color: #b22222;">print('&#35843;&#29992;&#21518;&#22686;&#24378;&#21151;&#33021;')
</span>    <span style="color: #a020f0;">return</span> ret

logger(add)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: add function called. x=4, y=5</span>
</pre>
</div>

<ol class="org-ol">
<li>解决传参问题</li>
</ol>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#35013;&#39280;&#22120;&#65292;&#29992;&#26469;&#35013;&#39280;&#30340;&#65292;&#19968;&#33324;&#26469;&#35762;&#35013;&#39280;&#20989;&#25968;&#25110;&#31867;&#12289;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#35299;&#20915;&#21442;&#25968;&#38382;&#39064;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
    <span style="color: #a020f0;">return</span> x + y
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn, x, y): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38543;&#20415;&#21738;&#20010;&#20989;&#25968;fn
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">print('&#35843;&#29992;&#21069;&#22686;&#24378;&#21151;&#33021;')
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} function called. x={}, y={}'</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, x, y))
    <span style="color: #a0522d;">ret</span> = fn(x, y) <span style="color: #b22222;">#</span><span style="color: #b22222;">add(4, 5)
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">print('&#35843;&#29992;&#21518;&#22686;&#24378;&#21151;&#33021;')
</span>    <span style="color: #a020f0;">return</span> ret

logger(add, x=10, y=11)

<span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y, *z):
    <span style="color: #a020f0;">return</span> x + y + <span style="color: #483d8b;">sum</span>(z)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn, *args, **kwargs): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38543;&#20415;&#21738;&#20010;&#20989;&#25968;fn
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">print('&#35843;&#29992;&#21069;&#22686;&#24378;&#21151;&#33021;')
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} function called. {}, {}'</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, args, kwargs))
    <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs) <span style="color: #b22222;"># </span><span style="color: #b22222;">*args &#21464;&#25104;&#20301;&#32622;&#20256;&#21442;&#65292; **kwargs &#21464;&#25104;&#20851;&#38190;&#23383;&#20256;&#21442;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">print('&#35843;&#29992;&#21518;&#22686;&#24378;&#21151;&#33021;')
</span>    <span style="color: #a020f0;">return</span> ret

logger(add, x=10, y=11)
logger(add, 10, y=11)
logger(add, 4, 5, 6, 7)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: add function called. (), {'x': 10, 'y': 11}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: add function called. (10,), {'y': 11}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: add function called. (4, 5, 6, 7), {}</span>
</pre>
</div>

<ol class="org-ol">
<li>柯里化</li>
</ol>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#35013;&#39280;&#22120;&#65292;&#29992;&#26469;&#35013;&#39280;&#30340;&#65292;&#19968;&#33324;&#26469;&#35762;&#35013;&#39280;&#20989;&#25968;&#25110;&#31867;&#12289;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26607;&#37324;&#21270;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y, *z):
    <span style="color: #a020f0;">return</span> x + y + <span style="color: #483d8b;">sum</span>(z)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38543;&#20415;&#21738;&#20010;&#20989;&#25968;fn
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">print('&#35843;&#29992;&#21069;&#22686;&#24378;&#21151;&#33021;')
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} function called. {}, {}'</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, args, kwargs))
        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs) <span style="color: #b22222;"># </span><span style="color: #b22222;">*args &#21464;&#25104;&#20301;&#32622;&#20256;&#21442;&#65292; **kwargs &#21464;&#25104;&#20851;&#38190;&#23383;&#20256;&#21442;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">print('&#35843;&#29992;&#21518;&#22686;&#24378;&#21151;&#33021;')
</span>        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

logger(add)(x=10, y=11)
logger(add)(10, y=11)
logger(add)(4, 5, 6, 7)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: add function called. (), {'x': 10, 'y': 11}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: add function called. (10,), {'y': 11}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: add function called. (4, 5, 6, 7), {}</span>
</pre>
</div>

<p>
调用
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#35013;&#39280;&#22120;&#65292;&#29992;&#26469;&#35013;&#39280;&#30340;&#65292;&#19968;&#33324;&#26469;&#35762;&#35013;&#39280;&#20989;&#25968;&#25110;&#31867;&#12289;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
    <span style="color: #a020f0;">return</span> x + y 
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn): <span style="color: #b22222;"># </span><span style="color: #b22222;">fn &lt;= add &#25351;&#21521;&#30340;&#20989;&#25968;&#23545;&#35937;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38543;&#20415;&#21738;&#20010;&#20989;&#25968;fn
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">print('&#35843;&#29992;&#21069;&#22686;&#24378;&#21151;&#33021;')
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} function called. {}, {}'</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, args, kwargs))
        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs) <span style="color: #b22222;"># </span><span style="color: #b22222;">*args &#21464;&#25104;&#20301;&#32622;&#20256;&#21442;&#65292; **kwargs &#21464;&#25104;&#20851;&#38190;&#23383;&#20256;&#21442;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">print('&#35843;&#29992;&#21518;&#22686;&#24378;&#21151;&#33021;')
</span>        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #a0522d;">newfunc</span> = logger(add) <span style="color: #b22222;"># </span><span style="color: #b22222;">newfunc == wrapper fn &lt;=add
</span><span style="color: #a0522d;">result</span> = newfunc(1, 2)
<span style="color: #483d8b;">print</span>(result)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: add function called. (1, 2), {}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 3</span>
</pre>
</div>

<p>
变换
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#35013;&#39280;&#22120;&#65292;&#29992;&#26469;&#35013;&#39280;&#30340;&#65292;&#19968;&#33324;&#26469;&#35762;&#35013;&#39280;&#20989;&#25968;&#25110;&#31867;&#12289;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;"># </span><span style="color: #b22222;">add &#25351;&#21521; -&gt; addr1 &#20869;&#23384;&#22320;&#22336;
</span>    <span style="color: #a020f0;">return</span> x + y 
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn): <span style="color: #b22222;"># </span><span style="color: #b22222;">fn &lt;= add &#25351;&#21521;&#30340;&#20989;&#25968;&#23545;&#35937; logger -&gt; addr2 &#20869;&#23384;&#22320;&#22336;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38543;&#20415;&#21738;&#20010;&#20989;&#25968;fn
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">wrapper -&gt; addr3 &#20869;&#23384;&#22320;&#22336;&#65292;&#25226;fn&#23545;&#24212;&#30340;&#20989;&#25968;&#23545;&#35937;&#22256;&#22312;wrapper&#20989;&#25968;&#30340;&#23646;&#24615;&#19978;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">addr3&#23545;&#35937;&#30340;&#23646;&#24615;&#19978;&#35760;&#24405;&#30528;&#38381;&#21253;&#65292;fn&#25351;&#21521;addr1
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">print('&#35843;&#29992;&#21069;&#22686;&#24378;&#21151;&#33021;')
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} function called. {}, {}'</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, args, kwargs))
        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs) <span style="color: #b22222;"># </span><span style="color: #b22222;">fn&#26159;&#21407;&#26469;&#30340;&#20989;&#25968;&#65292;&#20026;&#20160;&#20040;&#65311;&#24341;&#29992;&#35745;&#25968;&#65292;&#38381;&#21253;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">print('&#35843;&#29992;&#21518;&#22686;&#24378;&#21151;&#33021;')
</span>        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #b22222;">#</span><span style="color: #b22222;">newfunc = logger(add) # newfunc == wrapper fn &lt;=add
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">result = newfunc(1, 2)
</span><span style="color: #a0522d;">add</span> = logger(add) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21491;&#36793;&#20808;&#20570;&#65292;add&#30446;&#21069;&#26159;addr1&#65292;&#36171;&#20540;&#21363;&#23450;&#20041; add = wrapper |addr3|
</span><span style="color: #a0522d;">result</span> = add(1,200)
<span style="color: #483d8b;">print</span>(result)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: add function called. (1, 200), {}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 201</span>
</pre>
</div>

<ol class="org-ol">
<li>引用装饰器，装饰器是一种语法。</li>
</ol>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#35013;&#39280;&#22120;&#65292;&#29992;&#26469;&#35013;&#39280;&#30340;&#65292;&#19968;&#33324;&#26469;&#35762;&#35013;&#39280;&#20989;&#25968;&#25110;&#31867;&#12289;
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn): <span style="color: #b22222;"># </span><span style="color: #b22222;">fn &lt;= add &#25351;&#21521;&#30340;&#20989;&#25968;&#23545;&#35937; logger -&gt; addr2 &#20869;&#23384;&#22320;&#22336;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38543;&#20415;&#21738;&#20010;&#20989;&#25968;fn
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">wrapper -&gt; addr3 &#20869;&#23384;&#22320;&#22336;&#65292;&#25226;fn&#23545;&#24212;&#30340;&#20989;&#25968;&#23545;&#35937;&#22256;&#22312;wrapper&#20989;&#25968;&#30340;&#23646;&#24615;&#19978;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">addr3&#23545;&#35937;&#30340;&#23646;&#24615;&#19978;&#35760;&#24405;&#30528;&#38381;&#21253;&#65292;fn&#25351;&#21521;addr1
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">print('&#35843;&#29992;&#21069;&#22686;&#24378;&#21151;&#33021;')
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} function called. {}, {}'</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, args, kwargs))
        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs) <span style="color: #b22222;"># </span><span style="color: #b22222;">fn&#26159;&#21407;&#26469;&#30340;&#20989;&#25968;&#65292;&#20026;&#20160;&#20040;&#65311;&#24341;&#29992;&#35745;&#25968;&#65292;&#38381;&#21253;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">print('&#35843;&#29992;&#21518;&#22686;&#24378;&#21151;&#33021;')
</span>        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@logger</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35013;&#39280;&#22120;&#35821;&#27861;&#65292;&#31561;&#20215;&#20110; add = logger(add) # @logger&#31216;&#20026;&#26080;&#21442;&#35013;&#39280;&#22120;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;"># </span><span style="color: #b22222;">add &#25351;&#21521; -&gt; addr1 &#20869;&#23384;&#22320;&#22336;
</span>    <span style="color: #a020f0;">return</span> x + y 

<span style="color: #b22222;">#</span><span style="color: #b22222;">add = logger(add) #&#21491;&#36793;&#20808;&#20570;&#65292;add&#30446;&#21069;&#26159;addr1&#65292;&#36171;&#20540;&#21363;&#23450;&#20041; add = wrapper |addr3|
</span><span style="color: #a0522d;">result</span> = add(1,200)
<span style="color: #483d8b;">print</span>(result)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: add function called. (1, 200), {}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 201</span>
</pre>
</div>

<pre class="example" id="orgc3fc007">
@标识符
标识符指向一个函数，用一个函数来装饰它下面的函数，logger函数称为装饰器函数，add称为被装饰或被包装函数
logger习惯上称为wrapper
add习惯上 wrapped
本质上来看，无参装饰器 logger实际上是 等效为一个参数的函数

无参装饰器 logger
@logger 会把它下面紧挨着的函数的标识符提上来作为它的实参 xyz = logger(xyz)
def xyz():
    pass
</pre>
</div>
</div>
<div id="outline-container-h:654e47da-697f-42f4-b347-691261e025d7" class="outline-4">
<h4 id="h:654e47da-697f-42f4-b347-691261e025d7">无参装饰器</h4>
<div class="outline-text-4" id="text-h:654e47da-697f-42f4-b347-691261e025d7">
<ul class="org-ul">
<li>上例的装饰器语法，称为无参装饰器</li>
<li>@符号后是一个函数</li>
<li>虽然是 <b>无参装饰器</b> ，但是@后的函数本质上是 <code>单参函数</code></li>
<li>上例的logger函数是一个高阶函数</li>
</ul>


<p>
范例：日志记录装饰器实现
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #b22222;">#</span><span style="color: #b22222;">print('&#35843;&#29992;&#21069;&#22686;&#24378;&#21151;&#33021;')
</span>        <span style="color: #a0522d;">start</span> = datetime.datetime.now()
        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">print('&#35843;&#29992;&#21518;&#22686;&#24378;&#21151;&#33021;')
</span>        <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Function {} took {:.2f}s."</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, delta))
        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@logger</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#20215;&#20110; add = logger(add) # @logger&#31216;&#20026;&#26080;&#21442;&#35013;&#39280;&#22120; add = wrapper
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
    time.sleep(2)
    <span style="color: #a020f0;">return</span> x + y 

<span style="color: #a0522d;">result</span> = add(1,200)
<span style="color: #483d8b;">print</span>(result)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: Function add took 2.01s.
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 201</span>
</pre>
</div>

<p>
装饰器本质
</p>
<ul class="org-ul">
<li>习惯上add函数被称为被包装函数wrapped，增强它的函数称为包装器、包装函数wrapper</li>
<li>包装的目的是增强，而不是破坏，采用非侵入式代码</li>
<li>在原代码前或后加入增强代码</li>
<li>装饰器如同画框，装饰器可以更换，如同更换画框，画不变。也可以画框不变，更换画。也可以画框外再加其它装饰</li>
</ul>
</div>
</div>
<div id="outline-container-h:d34801a4-f12a-43ad-8569-e45471176eeb" class="outline-4">
<h4 id="h:d34801a4-f12a-43ad-8569-e45471176eeb">带参装饰器</h4>
<div class="outline-text-4" id="text-h:d34801a4-f12a-43ad-8569-e45471176eeb">
</div>
<div id="outline-container-h:8f8e903d-e0fe-4c6b-88ec-56efcbe43dfd" class="outline-5">
<h5 id="h:8f8e903d-e0fe-4c6b-88ec-56efcbe43dfd">文档字符串</h5>
<div class="outline-text-5" id="text-h:8f8e903d-e0fe-4c6b-88ec-56efcbe43dfd">
<ul class="org-ul">
<li>Python文档字符串Ducumentation Strings</li>
<li>在函数（类、模块）语句块的第一行，且习惯是多行的文本，所以多用三引号</li>
<li>文档字符串也算是合法的一条语句</li>
<li>惯例是首字母大写，第一行写概述，空一行，第三行写详描述</li>
<li>可以使用特殊属性 <code>__doc__</code> 访问这个文档</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x,y):
    <span style="color: #8b2252;">"""Add function

    x int:
    y int:
    return int:
    """</span>

    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{}'s doc = {}"</span>.<span style="color: #483d8b;">format</span>(add.<span style="color: #483d8b;">__name__</span>, add.<span style="color: #483d8b;">__doc__</span>))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">help</span>(add))


<span style="color: #b22222;">#</span><span style="color: #b22222;">add's doc = Add function
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;">#    </span><span style="color: #b22222;">x int:
</span><span style="color: #b22222;">#    </span><span style="color: #b22222;">y int:
</span><span style="color: #b22222;">#    </span><span style="color: #b22222;">return int:
</span><span style="color: #b22222;">#    </span><span style="color: #b22222;">
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">Help on function add in module __main__:
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add(x, y)
</span><span style="color: #b22222;">#    </span><span style="color: #b22222;">Add function
</span><span style="color: #b22222;">#    </span><span style="color: #b22222;">
</span><span style="color: #b22222;">#    </span><span style="color: #b22222;">x int:
</span><span style="color: #b22222;">#    </span><span style="color: #b22222;">y int:
</span><span style="color: #b22222;">#    </span><span style="color: #b22222;">return int:
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">None</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:0352d3de-dfe0-4c06-adde-14e1dab1330d" class="outline-5">
<h5 id="h:0352d3de-dfe0-4c06-adde-14e1dab1330d">装饰器的文档字符串问题</h5>
<div class="outline-text-5" id="text-h:0352d3de-dfe0-4c06-adde-14e1dab1330d">
<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn):
   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs): 
      <span style="color: #8b2252;">"""Wrapper function +++"""</span>
      <span style="color: #a0522d;">start</span> = datetime.datetime.now()
      <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
      <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
      <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Function {} took {}s"</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, delta))

      <span style="color: #a020f0;">return</span> ret
   <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@logger</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;">#</span><span style="color: #b22222;">add = logger(add) =&gt; add = wrapper
</span>   <span style="color: #8b2252;">"""Add function~~~"""</span>
   time.sleep(2)
   <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(add.<span style="color: #483d8b;">__name__</span>, add.<span style="color: #483d8b;">__doc__</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: wrapper Wrapper function +++</span>
</pre>
</div>

<p>
被装饰后，发现add的函数名和文档都变了。如何解决？
</p>

<p>
函数也是对象，特殊属性也是属性，也可以被覆盖。现在访问add函数实际上是wrapper函数，所以使用原来定义的add函数的名称和文档属性覆盖wrapper的对应属性就可以了。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> time

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20266;&#35013; &#20989;&#25968;&#21517;&#23383;&#21644;&#25991;&#26723;
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn):
   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs): 
      <span style="color: #8b2252;">"""Wrapper function +++"""</span>
      <span style="color: #a0522d;">start</span> = datetime.datetime.now()
      <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
      <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
      <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Function {} took {}s"</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, delta))

      <span style="color: #a020f0;">return</span> ret
   <span style="color: #483d8b;">print</span>(wrapper.<span style="color: #483d8b;">__name__</span>, <span style="color: #8b2252;">'***'</span>, wrapper.<span style="color: #483d8b;">__doc__</span>)
   wrapper.<span style="color: #483d8b;">__name__</span> = fn.<span style="color: #483d8b;">__name__</span>
   wrapper.<span style="color: #483d8b;">__doc__</span> = fn.<span style="color: #483d8b;">__doc__</span>
   <span style="color: #483d8b;">print</span>(wrapper.<span style="color: #483d8b;">__name__</span>, <span style="color: #8b2252;">'###'</span>, wrapper.<span style="color: #483d8b;">__doc__</span>)
   <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@logger</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;">#</span><span style="color: #b22222;">add = logger(add) =&gt; add = wrapper
</span>   <span style="color: #8b2252;">"""Add function~~~"""</span>
   time.sleep(2)
   <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(add.<span style="color: #483d8b;">__name__</span>, add.<span style="color: #483d8b;">__doc__</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: wrapper *** Wrapper function +++
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: add ### Add function~~~
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: add Add function~~~
</span>


<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20266;&#35013; &#20989;&#25968;&#21517;&#23383;&#21644;&#25991;&#26723;
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn): <span style="color: #b22222;">#</span><span style="color: #b22222;">fn &#34987;&#21253;&#35013;&#20989;&#25968;wrapped
</span>   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21253;&#35013;&#20989;&#25968;wrapper
</span>      <span style="color: #8b2252;">"""Wrapper function +++"""</span>
      <span style="color: #a0522d;">start</span> = datetime.datetime.now()
      <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
      <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
      <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Function {} took {}s"</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, delta))

      <span style="color: #a020f0;">return</span> ret

   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">copy_properties</span>(dst, src):
      <span style="color: #483d8b;">print</span>(dst.<span style="color: #483d8b;">__name__</span>, <span style="color: #8b2252;">'***'</span>, dst.<span style="color: #483d8b;">__doc__</span>)
      dst.<span style="color: #483d8b;">__name__</span> = src.<span style="color: #483d8b;">__name__</span>
      dst.<span style="color: #483d8b;">__doc__</span> = src.<span style="color: #483d8b;">__doc__</span>
      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20854;&#20182;&#23646;&#24615;&#35206;&#30422;&#30053;&#21435;
</span>      <span style="color: #483d8b;">print</span>(dst.<span style="color: #483d8b;">__name__</span>, <span style="color: #8b2252;">'###'</span>, dst.<span style="color: #483d8b;">__doc__</span>)

   copy_properties(wrapper, fn)
   <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@logger</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;">#</span><span style="color: #b22222;">add = logger(add) =&gt; add = wrapper
</span>   <span style="color: #8b2252;">"""Add function~~~"""</span>
   time.sleep(2)
   <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(add.<span style="color: #483d8b;">__name__</span>, add.<span style="color: #483d8b;">__doc__</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: wrapper *** Wrapper function +++
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: add ### Add function~~~
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: add Add function~~~
</span>


<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23646;&#24615;&#25335;&#36125;&#36890;&#29992;&#20989;&#25968;
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">copy_properties</span>(dst, src):
   <span style="color: #483d8b;">print</span>(dst.<span style="color: #483d8b;">__name__</span>, <span style="color: #8b2252;">'***'</span>, dst.<span style="color: #483d8b;">__doc__</span>)
   dst.<span style="color: #483d8b;">__name__</span> = src.<span style="color: #483d8b;">__name__</span>
   dst.<span style="color: #483d8b;">__doc__</span> = src.<span style="color: #483d8b;">__doc__</span>
   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20854;&#20182;&#23646;&#24615;&#35206;&#30422;&#30053;&#21435;
</span>   <span style="color: #483d8b;">print</span>(dst.<span style="color: #483d8b;">__name__</span>, <span style="color: #8b2252;">'###'</span>, dst.<span style="color: #483d8b;">__doc__</span>)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn): <span style="color: #b22222;">#</span><span style="color: #b22222;">fn &#34987;&#21253;&#35013;&#20989;&#25968;wrapped
</span>   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21253;&#35013;&#20989;&#25968;wrapper
</span>      <span style="color: #8b2252;">"""Wrapper function +++"""</span>
      <span style="color: #a0522d;">start</span> = datetime.datetime.now()
      <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
      <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
      <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Function {} took {}s"</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, delta))

      <span style="color: #a020f0;">return</span> ret

   copy_properties(wrapper, fn)
   <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@logger</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;">#</span><span style="color: #b22222;">add = logger(add) =&gt; add = wrapper
</span>   <span style="color: #8b2252;">"""Add function~~~"""</span>
   time.sleep(2)
   <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(add.<span style="color: #483d8b;">__name__</span>, add.<span style="color: #483d8b;">__doc__</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:61a05c1f-d3bf-4ff3-9b07-ae2bee332bef" class="outline-5">
<h5 id="h:61a05c1f-d3bf-4ff3-9b07-ae2bee332bef">带参装饰器</h5>
<div class="outline-text-5" id="text-h:61a05c1f-d3bf-4ff3-9b07-ae2bee332bef">
<p>
柯里化
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">copy_properties</span>(dst): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26607;&#37324;&#21270;
</span>   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_copy</span>(src):
      dst.<span style="color: #483d8b;">__name__</span> = src.<span style="color: #483d8b;">__name__</span>
      dst.<span style="color: #483d8b;">__doc__</span> = src.<span style="color: #483d8b;">__doc__</span>
      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20854;&#20182;&#23646;&#24615;&#35206;&#30422;&#30053;&#21435;
</span>   <span style="color: #a020f0;">return</span> _copy

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn): <span style="color: #b22222;">#</span><span style="color: #b22222;">fn &#34987;&#21253;&#35013;&#20989;&#25968;wrapped
</span>   <span style="color: #b22222;">#</span><span style="color: #b22222;">@copy_properties(fn) #&#24102;&#21442;&#35013;&#39280;&#22120;
</span>   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21253;&#35013;&#20989;&#25968;wrapper
</span>      <span style="color: #8b2252;">"""Wrapper function +++"""</span>
      <span style="color: #a0522d;">start</span> = datetime.datetime.now()
      <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
      <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
      <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Function {} took {}s"</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, delta))

      <span style="color: #a020f0;">return</span> ret

   <span style="color: #b22222;">#</span><span style="color: #b22222;">copy_properties(wrapper, fn)
</span>   copy_properties(wrapper)(fn) <span style="color: #b22222;"># </span><span style="color: #b22222;">_copy(fn)
</span>   <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@logger</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;">#</span><span style="color: #b22222;">add = logger(add) =&gt; add = wrapper
</span>   <span style="color: #8b2252;">"""Add function~~~"""</span>
   time.sleep(2)
   <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(add.<span style="color: #483d8b;">__name__</span>, add.<span style="color: #483d8b;">__doc__</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: add Add function~~~</span>
</pre>
</div>

<p>
带参装饰器
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> time

<span style="color: #b22222;">#</span><span style="color: #b22222;">def copy_properties(dst): #&#26607;&#37324;&#21270;
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">def _copy(src):
</span><span style="color: #b22222;">#      </span><span style="color: #b22222;">dst.__name__ = src.__name__
</span><span style="color: #b22222;">#      </span><span style="color: #b22222;">dst.__doc__ = src.__doc__
</span><span style="color: #b22222;">#      </span><span style="color: #b22222;">#&#20854;&#20182;&#23646;&#24615;&#35206;&#30422;&#30053;&#21435;
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">return _copy
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">def copy_properties(src): #&#26607;&#37324;&#21270;&#65292;&#36866;&#24212;&#35013;&#39280;&#22120;&#30340;&#20351;&#29992;&#35843;&#25972;&#19968;&#19979;&#24418;&#21442;
</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">def _copy(dst):
</span><span style="color: #b22222;">#      </span><span style="color: #b22222;">dst.__name__ = src.__name__
</span><span style="color: #b22222;">#      </span><span style="color: #b22222;">dst.__doc__ = src.__doc__
</span><span style="color: #b22222;">#      </span><span style="color: #b22222;">#&#20854;&#20182;&#23646;&#24615;&#35206;&#30422;&#30053;&#21435;
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">return _copy
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">copy_properties</span>(src): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26607;&#37324;&#21270;&#65292;&#36866;&#24212;&#35013;&#39280;&#22120;&#30340;&#20351;&#29992;&#35843;&#25972;&#19968;&#19979;&#24418;&#21442;
</span>   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_copy</span>(dst):
      dst.<span style="color: #483d8b;">__name__</span> = src.<span style="color: #483d8b;">__name__</span>
      dst.<span style="color: #483d8b;">__doc__</span> = src.<span style="color: #483d8b;">__doc__</span>
      <span style="color: #a020f0;">return</span> dst  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#19968;&#21477;&#36820;&#22238;&#20540;&#29305;&#21035;&#37325;&#35201;
</span>      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20854;&#20182;&#23646;&#24615;&#35206;&#30422;&#30053;&#21435;
</span>   <span style="color: #a020f0;">return</span> _copy
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn): <span style="color: #b22222;">#</span><span style="color: #b22222;">fn &#34987;&#21253;&#35013;&#20989;&#25968;wrapped
</span>   <span style="color: #b22222;">#</span><span style="color: #b22222;">@copy_properties(fn) #&#24102;&#21442;&#35013;&#39280;&#22120; #&#31561;&#20215;&#20110; wrapper = copy_properties(wrapper)(fn)
</span>   <span style="color: #228b22;">@copy_properties</span>(fn) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24102;&#21442;&#35013;&#39280;&#22120; #&#31561;&#20215;&#20110; wrapper = copy_properties(fn)(wrapper)
</span>   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35013;&#39280;&#22120;&#35821;&#27861;&#26159;&#25226;&#19979;&#38754;&#30340;&#20989;&#25968;&#30340;&#26631;&#35782;&#31526;&#25552;&#19978;&#26469;&#20316;&#20026;&#23454;&#21442;&#65292;&#21363;copy_properties(fn)(wrapper) -&gt; _copy(wrapper) =&gt; wrapper = wrapper
</span>   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21253;&#35013;&#20989;&#25968;wrapper
</span>      <span style="color: #8b2252;">"""Wrapper function +++"""</span>
      <span style="color: #a0522d;">start</span> = datetime.datetime.now()
      <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
      <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
      <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Function {} took {}s"</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, delta))

      <span style="color: #a020f0;">return</span> ret

   <span style="color: #b22222;">#</span><span style="color: #b22222;">copy_properties(wrapper)(fn) # _copy(fn)
</span>   <span style="color: #b22222;">#</span><span style="color: #b22222;">copy_properties(fn)(wrapper) # _copy(wrapper)
</span>   <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@logger</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;">#</span><span style="color: #b22222;">add = logger(add) =&gt; add = wrapper
</span>   <span style="color: #8b2252;">"""Add function~~~"""</span>
   time.sleep(2)
   <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(add.<span style="color: #483d8b;">__name__</span>, add.<span style="color: #483d8b;">__doc__</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25253;&#38169;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">Traceback (most recent call last):
</span><span style="color: #b22222;">#  </span><span style="color: #b22222;">File "&lt;stdin&gt;", line 41, in &lt;module&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">AttributeError: 'NoneType' object has no attribute '__name__'
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#22240;&#20026;@copy_properties(fn) &#21363; copy_properties(fn)(wrapper) -&gt; _copy(wrapper) =&gt; wrapper = wrapper
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">_copy(wrapper)&#36820;&#22238;None&#65292;None&#26159;&#27809;&#26377;__name__&#21644;__doc__&#30340;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#35299;&#20915; _copy(dst): &#36820;&#22238; return dst</span>
</pre>
</div>

<p>
像 <code>@copy_properties(fn)</code> 这种在装饰器后面跟着参数的装饰器称为 <b>带参装饰器</b> 。
</p>

<p>
logger设定一个阈值，对执行时长超过阈值的记录一下。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">copy_properties</span>(src): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26607;&#37324;&#21270;
</span>   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_copy</span>(dst):
      dst.<span style="color: #483d8b;">__name__</span> = src.<span style="color: #483d8b;">__name__</span>
      dst.<span style="color: #483d8b;">__doc__</span> = src.<span style="color: #483d8b;">__doc__</span>
      <span style="color: #a020f0;">return</span> dst  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#19968;&#21477;&#36820;&#22238;&#20540;&#29305;&#21035;&#37325;&#35201;
</span>      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20854;&#20182;&#23646;&#24615;&#35206;&#30422;&#30053;&#21435;
</span>   <span style="color: #a020f0;">return</span> _copy
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn): <span style="color: #b22222;">#</span><span style="color: #b22222;">fn &#34987;&#21253;&#35013;&#20989;&#25968;wrapped
</span>   <span style="color: #228b22;">@copy_properties</span>(fn) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24102;&#21442;&#35013;&#39280;&#22120; #&#31561;&#20215;&#20110; wrapper = copy_properties(fn)(wrapper)
</span>   <span style="color: #b22222;">#</span><span style="color: #b22222;">copy_properties(fn)(wrapper) -&gt; _copy(wrapper) =&gt; wrapper = wrapper
</span>   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21253;&#35013;&#20989;&#25968;wrapper
</span>      <span style="color: #8b2252;">"""Wrapper function +++"""</span>
      <span style="color: #a0522d;">start</span> = datetime.datetime.now()
      <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
      <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
      <span style="color: #a0522d;">duration</span> = 5 <span style="color: #b22222;"># </span><span style="color: #b22222;">s
</span>      <span style="color: #a020f0;">if</span> delta &gt; duration:
         <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Function {} took {}s. Slow"</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, delta))
      <span style="color: #a020f0;">else</span>:
         <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Function {} took {}s. Fast"</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, delta))
      <span style="color: #a020f0;">return</span> ret
   <span style="color: #b22222;">#</span><span style="color: #b22222;">wrapper = copy_properties(fn)(wrapper) # _copy(wrapper)
</span>   <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@logger</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;">#</span><span style="color: #b22222;">add = logger(add) =&gt; add = wrapper
</span>   <span style="color: #8b2252;">"""Add function~~~"""</span>
   time.sleep(6)
   <span style="color: #a020f0;">return</span> x + y

add(4, 5)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: Function add took 6.012711s. Slow
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#38408;&#20540;&#25552;&#20986;&#26469;&#65292;&#26607;&#37324;&#21270;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">copy_properties</span>(src): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26607;&#37324;&#21270;
</span>   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_copy</span>(dst):
      dst.<span style="color: #483d8b;">__name__</span> = src.<span style="color: #483d8b;">__name__</span>
      dst.<span style="color: #483d8b;">__doc__</span> = src.<span style="color: #483d8b;">__doc__</span>
      <span style="color: #a020f0;">return</span> dst  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#19968;&#21477;&#36820;&#22238;&#20540;&#29305;&#21035;&#37325;&#35201;
</span>      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20854;&#20182;&#23646;&#24615;&#35206;&#30422;&#30053;&#21435;
</span>   <span style="color: #a020f0;">return</span> _copy

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(duration):
   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_logger</span>(fn): <span style="color: #b22222;">#</span><span style="color: #b22222;">fn &#34987;&#21253;&#35013;&#20989;&#25968;wrapped
</span>      <span style="color: #228b22;">@copy_properties</span>(fn) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24102;&#21442;&#35013;&#39280;&#22120; #&#31561;&#20215;&#20110; wrapper = copy_properties(fn)(wrapper)
</span>      <span style="color: #b22222;">#</span><span style="color: #b22222;">copy_properties(fn)(wrapper) -&gt; _copy(wrapper) =&gt; wrapper = wrapper
</span>      <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21253;&#35013;&#20989;&#25968;wrapper
</span>         <span style="color: #8b2252;">"""Wrapper function +++"""</span>
         <span style="color: #a0522d;">start</span> = datetime.datetime.now()
         <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
         <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
         <span style="color: #b22222;">#</span><span style="color: #b22222;">duration = 5 # s
</span>         <span style="color: #b22222;">#</span><span style="color: #b22222;">if delta &gt; duration:
</span>         <span style="color: #b22222;">#   </span><span style="color: #b22222;">print("Function {} took {}s. Slow".format(fn.__name__, delta))
</span>         <span style="color: #b22222;">#</span><span style="color: #b22222;">else:
</span>         <span style="color: #b22222;">#   </span><span style="color: #b22222;">print("Function {} took {}s. Fast".format(fn.__name__, delta))
</span>         <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Function {} took {}s. {}"</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, delta, <span style="color: #8b2252;">"Slow"</span> <span style="color: #a020f0;">if</span> delta &gt; duration <span style="color: #a020f0;">else</span> <span style="color: #8b2252;">"Fast"</span>))

         <span style="color: #a020f0;">return</span> ret
      <span style="color: #b22222;">#</span><span style="color: #b22222;">wrapper = copy_properties(fn)(wrapper) # _copy(wrapper)
</span>      <span style="color: #a020f0;">return</span> wrapper
   <span style="color: #a020f0;">return</span> _logger

<span style="color: #228b22;">@logger</span>(5) <span style="color: #b22222;"># </span><span style="color: #b22222;">add = logger(5)(add) -&gt; add = _logger(add) -&gt; add = wrapper
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;">#</span><span style="color: #b22222;">add = logger(add) =&gt; add = wrapper
</span>   <span style="color: #8b2252;">"""Add function~~~"""</span>
   time.sleep(2)
   <span style="color: #a020f0;">return</span> x + y

add(4, 5)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: Function add took 6.005283s. Slow</span>
</pre>
</div>

<p>
如果超出阈值，记录，为了灵活，我们对超出阈值的信息使用一个函数记录
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">copy_properties</span>(src): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26607;&#37324;&#21270;
</span>   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_copy</span>(dst):
      dst.<span style="color: #483d8b;">__name__</span> = src.<span style="color: #483d8b;">__name__</span>
      dst.<span style="color: #483d8b;">__doc__</span> = src.<span style="color: #483d8b;">__doc__</span>
      <span style="color: #a020f0;">return</span> dst  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#19968;&#21477;&#36820;&#22238;&#20540;&#29305;&#21035;&#37325;&#35201;
</span>      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20854;&#20182;&#23646;&#24615;&#35206;&#30422;&#30053;&#21435;
</span>   <span style="color: #a020f0;">return</span> _copy

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(duration, output=<span style="color: #a020f0;">lambda</span> name, delta: <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} took {:.2f}s. slow'</span>.<span style="color: #483d8b;">format</span>(name, delta))):
   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_logger</span>(fn): <span style="color: #b22222;">#</span><span style="color: #b22222;">fn &#34987;&#21253;&#35013;&#20989;&#25968;wrapped
</span>      <span style="color: #228b22;">@copy_properties</span>(fn) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24102;&#21442;&#35013;&#39280;&#22120; #&#31561;&#20215;&#20110; wrapper = copy_properties(fn)(wrapper)
</span>      <span style="color: #b22222;">#</span><span style="color: #b22222;">copy_properties(fn)(wrapper) -&gt; _copy(wrapper) =&gt; wrapper = wrapper
</span>      <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21253;&#35013;&#20989;&#25968;wrapper
</span>         <span style="color: #8b2252;">"""Wrapper function +++"""</span>
         <span style="color: #a0522d;">start</span> = datetime.datetime.now()
         <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
         <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#36229;&#20986;&#38408;&#20540;&#65292;&#35760;&#24405;&#65292;&#20026;&#20102;&#28789;&#27963;&#65292;&#25105;&#20204;&#23545;&#36229;&#20986;&#38408;&#20540;&#30340;&#20449;&#24687;&#20351;&#29992;&#19968;&#20010;&#20989;&#25968;&#35760;&#24405;
</span>         <span style="color: #a020f0;">if</span> delta &gt; duration:
            output(fn.<span style="color: #483d8b;">__name__</span>, delta) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21457;&#32593;&#32476;&#12289;&#35760;&#24405;&#25991;&#20214;&#12289;&#25511;&#21046;&#21488;&#12290;&#20989;&#25968;&#21517;&#12289;delta
</span>
         <span style="color: #a020f0;">return</span> ret
      <span style="color: #b22222;">#</span><span style="color: #b22222;">wrapper = copy_properties(fn)(wrapper) # _copy(wrapper)
</span>      <span style="color: #a020f0;">return</span> wrapper
   <span style="color: #a020f0;">return</span> _logger

<span style="color: #228b22;">@logger</span>(1) <span style="color: #b22222;"># </span><span style="color: #b22222;">add = logger(1, output)(add) -&gt; add = _logger(add) -&gt; add = wrapper
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;">#</span><span style="color: #b22222;">add = logger(add) =&gt; add = wrapper
</span>   <span style="color: #8b2252;">"""Add function~~~"""</span>
   time.sleep(2)
   <span style="color: #a020f0;">return</span> x + y

add(4, 5)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: add took 2.01s. slow</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:136a4643-2ec5-41d1-a410-947f40bc9c0a" class="outline-5">
<h5 id="h:136a4643-2ec5-41d1-a410-947f40bc9c0a">属性更新</h5>
<div class="outline-text-5" id="text-h:136a4643-2ec5-41d1-a410-947f40bc9c0a">
<p>
上例中copy_properties是通用功能，标准库中functools已经提供了
</p>

<p>
<code>functools.update_wrapper(wrapper, wrapped, assigned=WRAPPER_ASSIGNMENTS, updated=WRAPPER_UPDATES)</code>
</p>

<ul class="org-ul">
<li>类似copy_properties功能</li>
<li>wrapper包装函数、被更新者，wrapped被包装函数、数据源</li>
<li>元组WRAPPER_ASSIGNMENTS中要被覆盖的属性，有模块名 <code>__module__</code> ，名称 <code>__name__</code> ，限定名 <code>__qualname__</code> ，文档 <code>__doc__</code> ，参数注解 <code>__annotations__</code></li>
<li>元组WRAPPER_UPDATES中要被更新的属性， <code>__dict__</code> 属性字典</li>
<li>增加一个 <code>__wrapped__</code> 属性，保留着wrapped函数</li>
</ul>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> update_wrapper

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">copy_properties</span>(src): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26607;&#37324;&#21270;
</span>   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_copy</span>(dst):
      dst.<span style="color: #483d8b;">__name__</span> = src.<span style="color: #483d8b;">__name__</span>
      dst.<span style="color: #483d8b;">__doc__</span> = src.<span style="color: #483d8b;">__doc__</span>
      <span style="color: #a020f0;">return</span> dst  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#19968;&#21477;&#36820;&#22238;&#20540;&#29305;&#21035;&#37325;&#35201;
</span>      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20854;&#20182;&#23646;&#24615;&#35206;&#30422;&#30053;&#21435;
</span>   <span style="color: #a020f0;">return</span> _copy

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">copy_properties</span>(wrapper, wrapped): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26607;&#37324;&#21270; update_wrapper(wrapper, wrapped,
</span>   <span style="color: #a0522d;">assigned</span> = (<span style="color: #8b2252;">'__name__'</span>, <span style="color: #8b2252;">'__doc__'</span>)
   wrapper.<span style="color: #483d8b;">__name__</span> = wrapped.<span style="color: #483d8b;">__name__</span>
   wrapper.<span style="color: #483d8b;">__doc__</span> = wrapped.<span style="color: #483d8b;">__doc__</span>

   wrapper.<span style="color: #a0522d;">__wrapped__</span> = wrapped <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;&#20989;&#25968;&#23545;&#35937;&#19978;&#33258;&#23450;&#20041;&#19968;&#20010;&#29305;&#27530;&#23646;&#24615;&#65292;&#35760;&#24405;&#34987;&#21253;&#35013;&#32773;fn
</span>
   <span style="color: #a020f0;">return</span> wrapper 

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(duration, output=<span style="color: #a020f0;">lambda</span> name, delta: <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} took {:.2f}s. slow'</span>.<span style="color: #483d8b;">format</span>(name, delta))):
   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_logger</span>(fn): <span style="color: #b22222;">#</span><span style="color: #b22222;">fn &#34987;&#21253;&#35013;&#20989;&#25968;wrapped
</span>      <span style="color: #b22222;">#</span><span style="color: #b22222;">@copy_properties(fn) #&#24102;&#21442;&#35013;&#39280;&#22120; #&#31561;&#20215;&#20110; wrapper = copy_properties(fn)(wrapper)
</span>      <span style="color: #b22222;">#</span><span style="color: #b22222;">opy_properties(fn)(wrapper) -&gt; _copy(wrapper) =&gt; wrapper = wrapper
</span>      <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21253;&#35013;&#20989;&#25968;wrapper
</span>         <span style="color: #8b2252;">"""Wrapper function +++"""</span>
         <span style="color: #a0522d;">start</span> = datetime.datetime.now()
         <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
         <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#36229;&#20986;&#38408;&#20540;&#65292;&#35760;&#24405;&#65292;&#20026;&#20102;&#28789;&#27963;&#65292;&#25105;&#20204;&#23545;&#36229;&#20986;&#38408;&#20540;&#30340;&#20449;&#24687;&#20351;&#29992;&#19968;&#20010;&#20989;&#25968;&#35760;&#24405;
</span>         <span style="color: #a020f0;">if</span> delta &gt; duration:
            output(fn.<span style="color: #483d8b;">__name__</span>, delta) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21457;&#32593;&#32476;&#12289;&#35760;&#24405;&#25991;&#20214;&#12289;&#25511;&#21046;&#21488;&#12290;&#20989;&#25968;&#21517;&#12289;delta
</span>
         <span style="color: #a020f0;">return</span> ret
      <span style="color: #b22222;">#</span><span style="color: #b22222;">wrapper = copy_properties(fn)(wrapper) # _copy(wrapper)
</span>      update_wrapper(wrapper, fn)
      <span style="color: #a020f0;">return</span> wrapper
   <span style="color: #a020f0;">return</span> _logger

<span style="color: #228b22;">@logger</span>(1) <span style="color: #b22222;"># </span><span style="color: #b22222;">add = logger(1, output)(add) -&gt; add = _logger(add) -&gt; add = wrapper
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;">#</span><span style="color: #b22222;">add = logger(add) =&gt; add = wrapper
</span>   <span style="color: #8b2252;">"""Add function~~~"""</span>
   time.sleep(2)
   <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(add.<span style="color: #483d8b;">__name__</span>, add.<span style="color: #483d8b;">__doc__</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: add Add function~~~
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add(4, 5)</span>
</pre>
</div>

<p>
functools模块提供了一个wraps装饰器函数，本质上调用的是update_wrapper，它就是一个属性复制函数
</p>

<p>
<code>wraps(wrapped, assigned=WRAPPER_ASSIGNMENTS, updated=WRAPPER_UPDATES)</code>
</p>

<ul class="org-ul">
<li>缺少wrapper</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> update_wrapper, wraps

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">copy_properties</span>(src): <span style="color: #b22222;">#</span><span style="color: #b22222;">wraps &#20559;&#20989;&#25968;&#23454;&#29616;
</span>   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_copy</span>(dst):
      dst.<span style="color: #483d8b;">__name__</span> = src.<span style="color: #483d8b;">__name__</span>
      dst.<span style="color: #483d8b;">__doc__</span> = src.<span style="color: #483d8b;">__doc__</span>
      <span style="color: #a020f0;">return</span> dst  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#19968;&#21477;&#36820;&#22238;&#20540;&#29305;&#21035;&#37325;&#35201;
</span>      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20854;&#20182;&#23646;&#24615;&#35206;&#30422;&#30053;&#21435;
</span>   <span style="color: #a020f0;">return</span> _copy

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">copy_properties</span>(wrapper, wrapped): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26607;&#37324;&#21270; update_wrapper(wrapper, wrapped,
</span>   <span style="color: #a0522d;">assigned</span> = (<span style="color: #8b2252;">'__name__'</span>, <span style="color: #8b2252;">'__doc__'</span>)
   wrapper.<span style="color: #483d8b;">__name__</span> = wrapped.<span style="color: #483d8b;">__name__</span>
   wrapper.<span style="color: #483d8b;">__doc__</span> = wrapped.<span style="color: #483d8b;">__doc__</span>

   wrapper.<span style="color: #a0522d;">__wrapped__</span> = wrapped <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;&#20989;&#25968;&#23545;&#35937;&#19978;&#33258;&#23450;&#20041;&#19968;&#20010;&#29305;&#27530;&#23646;&#24615;&#65292;&#35760;&#24405;&#34987;&#21253;&#35013;&#32773;fn
</span>
   <span style="color: #a020f0;">return</span> wrapper 

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(duration, output=<span style="color: #a020f0;">lambda</span> name, delta: <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} took {:.2f}s. slow'</span>.<span style="color: #483d8b;">format</span>(name, delta))):
   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_logger</span>(fn): <span style="color: #b22222;">#</span><span style="color: #b22222;">fn &#34987;&#21253;&#35013;&#20989;&#25968;wrapped
</span>      <span style="color: #b22222;">#</span><span style="color: #b22222;">@copy_properties(fn) #&#24102;&#21442;&#35013;&#39280;&#22120; #&#31561;&#20215;&#20110; wrapper = copy_properties(fn)(wrapper)
</span>      <span style="color: #b22222;">#</span><span style="color: #b22222;">opy_properties(fn)(wrapper) -&gt; _copy(wrapper) =&gt; wrapper = wrapper
</span>      <span style="color: #228b22;">@wraps</span>(fn) <span style="color: #b22222;">#</span><span style="color: #b22222;">wraps = wraps(fn)(wrapper) &#20063;&#23601;&#26159;wraps(fn)&#24517;&#39035;&#36820;&#22238;&#31561;&#25928;&#20110;&#19968;&#20010;&#21333;&#21442;&#20989;&#25968;
</span>      <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21253;&#35013;&#20989;&#25968;wrapper
</span>         <span style="color: #8b2252;">"""Wrapper function +++"""</span>
         <span style="color: #a0522d;">start</span> = datetime.datetime.now()
         <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
         <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#36229;&#20986;&#38408;&#20540;&#65292;&#35760;&#24405;&#65292;&#20026;&#20102;&#28789;&#27963;&#65292;&#25105;&#20204;&#23545;&#36229;&#20986;&#38408;&#20540;&#30340;&#20449;&#24687;&#20351;&#29992;&#19968;&#20010;&#20989;&#25968;&#35760;&#24405;
</span>         <span style="color: #a020f0;">if</span> delta &gt; duration:
            output(fn.<span style="color: #483d8b;">__name__</span>, delta) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21457;&#32593;&#32476;&#12289;&#35760;&#24405;&#25991;&#20214;&#12289;&#25511;&#21046;&#21488;&#12290;&#20989;&#25968;&#21517;&#12289;delta
</span>
         <span style="color: #a020f0;">return</span> ret
      <span style="color: #b22222;">#</span><span style="color: #b22222;">wrapper = copy_properties(fn)(wrapper) # _copy(wrapper)
</span>      <span style="color: #b22222;">#</span><span style="color: #b22222;">update_wrapper(wrapper, fn)
</span>      <span style="color: #a020f0;">return</span> wrapper
   <span style="color: #a020f0;">return</span> _logger

<span style="color: #228b22;">@logger</span>(1) <span style="color: #b22222;"># </span><span style="color: #b22222;">add = logger(1, output)(add) -&gt; add = _logger(add) -&gt; add = wrapper
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;">#</span><span style="color: #b22222;">add = logger(add) =&gt; add = wrapper
</span>   <span style="color: #8b2252;">"""Add function~~~"""</span>
   time.sleep(2)
   <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(add.<span style="color: #483d8b;">__name__</span>, add.<span style="color: #483d8b;">__doc__</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: add Add function~~~
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add(4, 5)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:340d2d03-f11d-46d7-95d4-7232f6e6bf35" class="outline-5">
<h5 id="h:340d2d03-f11d-46d7-95d4-7232f6e6bf35">总结</h5>
<div class="outline-text-5" id="text-h:340d2d03-f11d-46d7-95d4-7232f6e6bf35">
<ul class="org-ul">
<li>@之后不是一个单独的标识符，是一个函数调用</li>
<li>函数调用的返回值又是一个函数，此函数是一个无参装饰器</li>
<li>带参装饰器，可以有任意个参数
<ul class="org-ul">
<li>@func()</li>
<li>@func(1)</li>
<li>@func(1,2)</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:9e5fca43-1d54-4dc5-8e84-cc78036497ad" class="outline-4">
<h4 id="h:9e5fca43-1d54-4dc5-8e84-cc78036497ad">装饰器进阶</h4>
<div class="outline-text-4" id="text-h:9e5fca43-1d54-4dc5-8e84-cc78036497ad">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn): <span style="color: #b22222;">#</span><span style="color: #b22222;">logger&#20840;&#23616;&#26631;&#35782;&#31526;&#65292;&#19968;&#20010;&#20989;&#25968;&#23545;&#35937;
</span>   <span style="color: #228b22;">@wraps</span>(fn) <span style="color: #b22222;">#</span><span style="color: #b22222;">wrapper = wraps(fn)(wrapper) =&gt; wrapper = wrapper
</span>   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):  <span style="color: #b22222;">#</span><span style="color: #b22222;">logger&#25191;&#34892;&#26102;&#65292;&#20020;&#26102;&#21019;&#24314;&#20869;&#37096;&#20989;&#25968;&#23545;&#35937;&#65292;&#22914;&#21516;&#23616;&#37096;&#21464;&#37327;&#19968;&#26679;
</span>      <span style="color: #8b2252;">"""Wrapper function +++"""</span>
      <span style="color: #a0522d;">start</span> = datetime.datetime.now()
      <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
      <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
      <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Function {} took {}s"</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, delta))
      <span style="color: #a020f0;">return</span> ret
   <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@logger</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">add = logger(add) =&gt; add = wrapper1 &#27492;wrapper&#38750;&#24444;wrapper
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20869;&#23384;&#20013;&#20135;&#29983;&#19968;&#20010;&#20840;&#23616;&#23545;&#35937;add&#20989;&#25968;&#23545;&#35937;
</span>   <span style="color: #8b2252;">"""Add function~~~"""</span>
   <span style="color: #a020f0;">return</span> x + y

<span style="color: #228b22;">@logger</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">sub = logger(sub) =&gt; sub = wrapper2 # &#20989;&#25968;&#30340;&#27599;&#19968;&#27425;&#35843;&#29992;&#20043;&#38388;&#27809;&#20160;&#20040;&#20851;&#31995;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">sub</span>(x, y):
   <span style="color: #8b2252;">"Sub function +++"</span>
   <span style="color: #a020f0;">return</span> x - y

<span style="color: #483d8b;">print</span>(add.<span style="color: #483d8b;">__name__</span>, sub.<span style="color: #483d8b;">__name__</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: add sub</span>
</pre>
</div>

<ul class="org-ul">
<li>add函数、sub函数执行过吗？logger什么时候执行？logger执行过几次？
<ul class="org-ul">
<li>add,sub函数没执行过，打印属性不代表调用，add(4,5)这种才是调用。 @logger时执行，logger 执行过2次</li>
</ul></li>
<li>wraps装饰器执行过几次？ 2次</li>
<li>wrapper的 <code>__name__</code> 等属性被覆盖过几次？ 2次，各是个的</li>
<li><code>add.__name__</code> 打印什么名称？ add</li>
<li><code>sub.__name__</code> 打印什么名称？ sub</li>
</ul>

<p>
参考：
</p>

<p>
装饰器超详细教学，用尽毕生所学给你解释清楚，以后再也不迷茫了！
</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/GSdEK-JTKiw?si=qukKa7CFcAPgtGTM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
</div>
</div>
</div>
<div id="outline-container-h:c09c8055-cba7-43d0-99db-ba6628d7eb8f" class="outline-3">
<h3 id="h:c09c8055-cba7-43d0-99db-ba6628d7eb8f">注解annotation</h3>
<div class="outline-text-3" id="text-h:c09c8055-cba7-43d0-99db-ba6628d7eb8f">
<p>
Python 是动态语言，变量可以随时被赋值并改变类型，也就是说Python的变量是运行时决定的。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(add(4, 5))
<span style="color: #483d8b;">print</span>(add(<span style="color: #8b2252;">'ab'</span>, <span style="color: #8b2252;">'cd'</span>))
<span style="color: #483d8b;">print</span>(add([10], [11]))

<span style="color: #483d8b;">print</span>(add(4, <span style="color: #8b2252;">'abc'</span>)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#21040;&#36816;&#34892;&#26102;&#65292;&#26080;&#27861;&#21028;&#26029;&#31867;&#22411;&#26159;&#21542;&#27491;&#30830;</span>
</pre>
</div>

<p>
动态语言缺点：
</p>
<ul class="org-ul">
<li>难发现：由于不能做任何类型检查，往往到了运行时问题才显现出来，或到了线上运行时才暴露出来</li>
<li>难使用：函数使用者看到函数时，并不知道函数设计者的意图，如果没有详尽的文档，使用者只能猜测数据的类型。对于一个新的API，使用都往往不知道该怎么使用，对于返回的类型更是不知道该怎么使用</li>
</ul>

<p>
动态类型对类型的约束不强，在小规模开发危害不大，但是随着python的广泛使用，这种缺点确实对大项目的开发危害非常大。
</p>

<p>
如何解决这种问题？
</p>
<ul class="org-ul">
<li>文档字符串。对函数、类、模块使用详尽的使用描述、举例，让使用者使用帮助就能知道使用方式。但是，大多数项目管理不严格，可能文档不全，或者项目发生变动后，文档没有更新等等。</li>
<li>类型注解：函数注解、变量注解</li>
</ul>
</div>
<div id="outline-container-h:3cc957d5-06b8-4c5a-ba44-effd371c2f42" class="outline-4">
<h4 id="h:3cc957d5-06b8-4c5a-ba44-effd371c2f42">函数注解</h4>
<div class="outline-text-4" id="text-h:3cc957d5-06b8-4c5a-ba44-effd371c2f42">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x:<span style="color: #483d8b;">int</span>, y) -&gt; <span style="color: #483d8b;">int</span>:  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20989;&#25968;&#27880;&#35299;&#20063;&#26159;&#38750;&#24378;&#21046;&#24615;&#31867;&#22411;&#35201;&#27714;&#65292;&#20165;&#20165;&#26159;&#19968;&#31181;&#22768;&#26126;
</span>    <span style="color: #8b2252;">"""

    :param x:
    :param y:
    :return:
    """</span>

    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">help</span>(add)
<span style="color: #483d8b;">print</span>(add(4,5))
<span style="color: #483d8b;">print</span>(add((4,), (5,)))
</pre>
</div>

<p>
函数注解
</p>
<ul class="org-ul">
<li>3.5版本引入</li>
<li>对函数的形参和返回值的类型说明</li>
<li>只是对函数形参类型、返回值类型做的辅助的说明，非强制类型约束</li>
<li>第三方工具，例如Pycharm就可以根据类型注解进行代码分析，发现隐藏的Bug</li>
<li>函数注解存放在函数的属性 <code>__annotations__</code>  中，字典类型</li>
</ul>
</div>
</div>
<div id="outline-container-h:99862dbf-b87a-43a3-87f5-5f021e39d5a5" class="outline-4">
<h4 id="h:99862dbf-b87a-43a3-87f5-5f021e39d5a5">类型注解</h4>
<div class="outline-text-4" id="text-h:99862dbf-b87a-43a3-87f5-5f021e39d5a5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">3.6
</span>
<span style="color: #a0522d;">i</span>:<span style="color: #483d8b;">int</span> = 123
<span style="color: #a0522d;">i</span> = <span style="color: #8b2252;">'abc'</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38750;&#24378;&#21046;&#32422;&#26463;
</span><span style="color: #a0522d;">s</span>:<span style="color: #483d8b;">str</span> = 200
<span style="color: #a0522d;">k</span>:<span style="color: #483d8b;">str</span> = 300 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38750;&#24378;&#21046;
</span><span style="color: #483d8b;">print</span>(i,s,k)
</pre>
</div>

<ul class="org-ul">
<li>3.6版本引入</li>
<li>对变量类型说明，非强制约束</li>
<li>第三方工具可以进行类型分析和推断</li>
</ul>
</div>
</div>
<div id="outline-container-h:1a13db4c-b6f1-4625-b21a-7027a6d55554" class="outline-4">
<h4 id="h:1a13db4c-b6f1-4625-b21a-7027a6d55554">类型检查</h4>
<div class="outline-text-4" id="text-h:1a13db4c-b6f1-4625-b21a-7027a6d55554">
<p>
函数传参经常传错，如何检查？
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x:<span style="color: #483d8b;">int</span>, y) -&gt; <span style="color: #483d8b;">int</span>:  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20989;&#25968;&#27880;&#35299;&#20063;&#26159;&#38750;&#24378;&#21046;&#24615;&#31867;&#22411;&#35201;&#27714;&#65292;&#20165;&#20165;&#26159;&#19968;&#31181;&#22768;&#26126;
</span>    <span style="color: #8b2252;">"""

    :param x:
    :param y:
    :return:
    """</span>

    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36825;&#31181;&#26816;&#26597;&#26159;&#36890;&#29992;&#30340;&#21151;&#33021;&#65292;&#26159;n&#20010;&#20989;&#25968;&#37117;&#21487;&#20197;&#25317;&#26377;&#30340;&#21151;&#33021;&#65292;&#32780;&#19988;&#26816;&#26597;&#26159;&#38750;&#19994;&#21153;&#20195;&#30721;---&#20856;&#22411;&#30340;&#35013;&#39280;&#22120;&#35813;&#20570;&#30340;
</span>    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(x, <span style="color: #483d8b;">int</span>) <span style="color: #a020f0;">and</span> <span style="color: #483d8b;">isinstance</span>(y, <span style="color: #483d8b;">int</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26816;&#26597;&#26041;&#26696;&#65292;&#30828;&#32534;&#30721;
</span>        <span style="color: #a0522d;">r</span> = x + y
        <span style="color: #a020f0;">return</span> r 
    <span style="color: #a020f0;">else</span>:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'error'</span>)
        <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">TypeError</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">built-in &#21152;&#36733;&#26102;&#65292;&#21152;&#36733;&#20869;&#24314;&#20989;&#25968;&#12289;&#24322;&#24120;&#31867;
</span>
<span style="color: #483d8b;">print</span>(add(<span style="color: #8b2252;">'abc'</span>, <span style="color: #8b2252;">'xyz'</span>))
</pre>
</div>

<p>
可以在函数内部写isinstance来判断参数类型是否正确，但是检查可以看做不是业务代码，写在里面就是侵入式代码。那如何更加灵活的检查呢？
</p>

<ul class="org-ul">
<li>非侵入代码</li>
<li>动态获取待检查的函数的参数类型注解</li>
<li>当函数调用传入实参时，和类型注解比对</li>
</ul>

<p>
能否使用函数的 <code>__annotations__</code> 属性吗？虽然python 3.6之后，字典记录了录入序，但是我们还是要认为字典字段是无有顺序的。那如何和按位置传实参对应呢？
</p>

<p>
使用inspect模块
</p>
</div>
</div>
<div id="outline-container-h:ce6d23b9-33e1-4b88-8a43-20a72ecc4d83" class="outline-4">
<h4 id="h:ce6d23b9-33e1-4b88-8a43-20a72ecc4d83">inspect模块</h4>
<div class="outline-text-4" id="text-h:ce6d23b9-33e1-4b88-8a43-20a72ecc4d83">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> inspect

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(inspect.isfunction(add))
<span style="color: #483d8b;">print</span>(inspect.isgenerator(i <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(10)))
<span style="color: #483d8b;">print</span>(inspect.isclass(add))
<span style="color: #483d8b;">print</span>(inspect.isbuiltin(<span style="color: #483d8b;">print</span>))
<span style="color: #483d8b;">print</span>(inspect.ismodule(inspect))
<span style="color: #483d8b;">print</span>(inspect.signature(add)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#33719;&#21462;&#20989;&#25968;&#23545;&#35937;&#30340;&#31614;&#21517;&#20449;&#24687;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: True
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: True
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: False
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: True
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: True
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: (x, y)
</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x:<span style="color: #483d8b;">int</span>, y:<span style="color: #483d8b;">int</span>) -&gt; <span style="color: #483d8b;">int</span>:
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #a0522d;">sig</span> = inspect.signature(add) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#33719;&#21462;&#31614;&#21517;
</span><span style="color: #483d8b;">print</span>(sig)
<span style="color: #483d8b;">print</span>(add.<span style="color: #483d8b;">__annotations__</span>)
<span style="color: #483d8b;">print</span>(sig.return_annotation) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#20540;&#27880;&#35299;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: (x: int, y: int) -&gt; int
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: {'x': &lt;class 'int'&gt;, 'y': &lt;class 'int'&gt;, 'return': &lt;class 'int'&gt;}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class 'int'&gt;
</span>
<span style="color: #483d8b;">print</span>(sig.parameters) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23646;&#24615;&#65292;&#25152;&#26377;&#21442;&#25968; #OrderedDict&#26377;&#24207;&#23383;&#20856;&#65292;&#35760;&#24405;&#20102;kv&#30340;&#24405;&#20837;&#24207;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">(x&#24418;&#21442;&#30340;&#21517;&#31216;&#23383;&#31526;&#20018;, Parameter&#31867;&#22411;&#30340;&#23545;&#35937;)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">OrderedDict([('x', &lt;Parameter "x: int"&gt;), ('y', &lt;Parameter "y: int"&gt;)])
</span>
<span style="color: #a020f0;">for</span> k,v <span style="color: #a020f0;">in</span> sig.parameters.items():
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(k), k)
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(v), v)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class 'str'&gt; x
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class 'inspect.Parameter'&gt; x: int
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class 'str'&gt; y
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class 'inspect.Parameter'&gt; y: int</span>
</pre>
</div>

<ul class="org-ul">
<li>inspect.isfunction(add)，是否是函数</li>
<li>inspect.ismethod(add)，是否是类的方法</li>
<li>inspect.isgenerator(add)，是否是生成器对象</li>
<li>inspect.isgeneratorfunction(add)，是否是生成器函数</li>
<li>inspect.isclass(add)，是否是类</li>
<li>inspect.ismodule(inspect)，是否是模块</li>
<li>inspect.isbuiltin(print)，是否是内建对象</li>
</ul>

<p>
还有很多is函数，需要时查阅inspect模块帮助
</p>

<p>
inspect.signature(callable, *, follow_wrapped=True)
</p>
<ul class="org-ul">
<li>获取可调用对象的签名</li>
<li>3.5增加 <code>follow_wrapped</code> ，如果使用functools的wraps或 <code>update_wrapper</code> ， <code>follow_wrapped</code> 为True跟进被包装函数的 <code>__wrapped__</code> ，也就是去获取真正的被包装函数的签名</li>
</ul>

<p>
inspect.Parameter
</p>
<ul class="org-ul">
<li>4个属性
<ul class="org-ul">
<li>name，参数名，字符串</li>
<li>default，缺少值</li>
<li>annotation，类型注解</li>
<li>kind，类型
<ul class="org-ul">
<li><code>POSITIONAL_ONLY</code> ，只接受仅位置传参</li>
<li><code>POSITIONAL_OR_KEYWORD</code> ，可以接受关键字或位置传参</li>
<li><code>VAR_POSITIONAL</code> ，可变位置参数，对应 *args</li>
<li><code>KEYWORD_ONLY</code> ，对应 * 或者 *args之后出现的非可变关键字形参，只接受关键传参</li>
<li><code>VAR_KEYWORD</code> ，可变关键字参数，对应 **kwargs</li>
</ul></li>
<li>empty，特殊类，用来标记default属性或annotation属性为空</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">3.8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">a</span>(x:<span style="color: #483d8b;">int</span>, /, y:<span style="color: #483d8b;">int</span>=5, *args, m:<span style="color: #483d8b;">int</span>=10, n:<span style="color: #483d8b;">str</span>, **kwargs):
    <span style="color: #483d8b;">print</span>(x,y,m,n,args,kwargs)

<span style="color: #a020f0;">import</span> inspect

<span style="color: #a0522d;">sig</span> = inspect.signature(a)
<span style="color: #483d8b;">print</span>(sig)

<span style="color: #a020f0;">for</span> k,v <span style="color: #a020f0;">in</span> sig.parameters.items():
    <span style="color: #483d8b;">print</span>(k, v.name, v.default, v.annotation, <span style="color: #483d8b;">type</span>(v.annotation), v.kind, sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\t</span><span style="color: #8b2252;">'</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: (x: int, /, y: int = 5, *args, m: int = 10, n: str, **kwargs)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: x    x       &lt;class 'inspect._empty'&gt;        &lt;class 'int'&gt;   &lt;class 'type'&gt;  POSITIONAL_ONLY
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: y    y       5       &lt;class 'int'&gt;   &lt;class 'type'&gt;  POSITIONAL_OR_KEYWORD
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: args args    &lt;class 'inspect._empty'&gt;        &lt;class 'inspect._empty'&gt;        &lt;class 'type'&gt;  VAR_POSITIONAL
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: m    m       10      &lt;class 'int'&gt;   &lt;class 'type'&gt;  KEYWORD_ONLY
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: n    n       &lt;class 'inspect._empty'&gt;        &lt;class 'str'&gt;   &lt;class 'type'&gt;  KEYWORD_ONLY
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: kwargs       kwargs  &lt;class 'inspect._empty'&gt;        &lt;class 'inspect._empty'&gt;        &lt;class 'type'&gt;  VAR_KEYWORD</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:9f99c5fa-6a5b-4344-ad34-23304791e933" class="outline-4">
<h4 id="h:9f99c5fa-6a5b-4344-ad34-23304791e933">参数类型检查</h4>
<div class="outline-text-4" id="text-h:9f99c5fa-6a5b-4344-ad34-23304791e933">
<p>
有如下函数
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y:<span style="color: #483d8b;">int</span>=7) -&gt; <span style="color: #483d8b;">int</span>:
    <span style="color: #a020f0;">return</span> x + y

add(4, 5)
add(<span style="color: #8b2252;">'abc'</span>, <span style="color: #8b2252;">'xyz'</span>)
</pre>
</div>

<p>
请检查用户的输入是否符合参数类型注解的要求
</p>

<p>
分析：
</p>
<ul class="org-ul">
<li>调用时，用户才会传实参，才能判断实参是否符合类型要求</li>
<li>调用时，让用户感觉上还是调用原函数</li>
<li>如果类型不符，提示用户</li>
</ul>

<p>
先实现对add函数的参数类型提取
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> inspect


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">check</span>(fn):
    <span style="color: #483d8b;">print</span>(fn.<span style="color: #483d8b;">__annotations__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#26159;&#23383;&#20856;&#65292;&#26080;&#24207;
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x:<span style="color: #483d8b;">int</span>, y:<span style="color: #483d8b;">int</span>) -&gt; <span style="color: #483d8b;">int</span>:  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20989;&#25968;&#27880;&#35299;&#20063;&#26159;&#38750;&#24378;&#21046;&#24615;&#31867;&#22411;&#35201;&#27714;&#65292;&#20165;&#20165;&#26159;&#19968;&#31181;&#22768;&#26126;
</span>    <span style="color: #8b2252;">"""

    :param x:
    :param y:
    :return:
    """</span>

    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36825;&#31181;&#26816;&#26597;&#26159;&#36890;&#29992;&#30340;&#21151;&#33021;&#65292;&#26159;n&#20010;&#20989;&#25968;&#37117;&#21487;&#20197;&#25317;&#26377;&#30340;&#21151;&#33021;&#65292;&#32780;&#19988;&#26816;&#26597;&#26159;&#38750;&#19994;&#21153;&#20195;&#30721;---&#20856;&#22411;&#30340;&#35013;&#39280;&#22120;&#35813;&#20570;&#30340;
</span>    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(x, <span style="color: #483d8b;">int</span>) <span style="color: #a020f0;">and</span> <span style="color: #483d8b;">isinstance</span>(y, <span style="color: #483d8b;">int</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26816;&#26597;&#26041;&#26696;&#65292;&#30828;&#32534;&#30721;
</span>        <span style="color: #a0522d;">r</span> = x + y
        <span style="color: #a020f0;">return</span> r 
    <span style="color: #a020f0;">else</span>:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'error'</span>)
        <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">TypeError</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">built-in &#21152;&#36733;&#26102;&#65292;&#21152;&#36733;&#20869;&#24314;&#20989;&#25968;&#12289;&#24322;&#24120;&#31867;
</span>
<span style="color: #a0522d;">sig</span> = inspect.signature(add)
<span style="color: #a0522d;">params</span> = sig.parameters <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24405;&#20837;&#24207;
</span><span style="color: #483d8b;">print</span>(params)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: OrderedDict([('x', &lt;Parameter "x: int"&gt;), ('y', &lt;Parameter "y: int"&gt;)])
</span><span style="color: #a020f0;">for</span> k,v <span style="color: #a020f0;">in</span> params.items():
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(k), k)
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(v), v.name, v.default, v.kind, v.annotation)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'str'&gt; x
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'inspect.Parameter'&gt; x &lt;class 'inspect._empty'&gt; POSITIONAL_OR_KEYWORD &lt;class 'int'&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'str'&gt; y
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'inspect.Parameter'&gt; y &lt;class 'inspect._empty'&gt; POSITIONAL_OR_KEYWORD &lt;class 'int'&gt;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">print(add('abc', 'xyz'))</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> inspect


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">check</span>(fn):
    <span style="color: #a0522d;">sig</span> = inspect.signature(add)
    <span style="color: #a0522d;">params</span> = sig.parameters <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24405;&#20837;&#24207;
</span>    <span style="color: #483d8b;">print</span>(params)
    <span style="color: #b22222;">#</span><span style="color: #b22222;">: OrderedDict([('x', &lt;Parameter "x: int"&gt;), ('y', &lt;Parameter "y: int"&gt;)])
</span>    <span style="color: #a020f0;">for</span> k,v <span style="color: #a020f0;">in</span> params.items():
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(k), k)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(v), v.name, v.default, v.kind, v.annotation)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x:<span style="color: #483d8b;">int</span>, y:<span style="color: #483d8b;">int</span>) -&gt; <span style="color: #483d8b;">int</span>:  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20989;&#25968;&#27880;&#35299;&#20063;&#26159;&#38750;&#24378;&#21046;&#24615;&#31867;&#22411;&#35201;&#27714;&#65292;&#20165;&#20165;&#26159;&#19968;&#31181;&#22768;&#26126;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36825;&#31181;&#26816;&#26597;&#26159;&#36890;&#29992;&#30340;&#21151;&#33021;&#65292;&#26159;n&#20010;&#20989;&#25968;&#37117;&#21487;&#20197;&#25317;&#26377;&#30340;&#21151;&#33021;&#65292;&#32780;&#19988;&#26816;&#26597;&#26159;&#38750;&#19994;&#21153;&#20195;&#30721;---&#20856;&#22411;&#30340;&#35013;&#39280;&#22120;&#35813;&#20570;&#30340;
</span>    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(x, <span style="color: #483d8b;">int</span>) <span style="color: #a020f0;">and</span> <span style="color: #483d8b;">isinstance</span>(y, <span style="color: #483d8b;">int</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26816;&#26597;&#26041;&#26696;&#65292;&#30828;&#32534;&#30721;
</span>        <span style="color: #a0522d;">r</span> = x + y
        <span style="color: #a020f0;">return</span> r 
    <span style="color: #a020f0;">else</span>:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'error'</span>)
        <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">TypeError</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">built-in &#21152;&#36733;&#26102;&#65292;&#21152;&#36733;&#20869;&#24314;&#20989;&#25968;&#12289;&#24322;&#24120;&#31867;
</span>
check(add)
<span style="color: #483d8b;">print</span>(add(4, 5))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: OrderedDict([('x', &lt;Parameter "x: int"&gt;), ('y', &lt;Parameter "y: int"&gt;)])
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'str'&gt; x
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'inspect.Parameter'&gt; x &lt;class 'inspect._empty'&gt; POSITIONAL_OR_KEYWORD &lt;class 'int'&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'str'&gt; y
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'inspect.Parameter'&gt; y &lt;class 'inspect._empty'&gt; POSITIONAL_OR_KEYWORD &lt;class 'int'&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 9</span>
</pre>
</div>

<p>
先解决按位置传参
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> inspect
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">check</span>(fn):
    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):

        <span style="color: #a0522d;">sig</span> = inspect.signature(fn)
        <span style="color: #a0522d;">params</span> = sig.parameters <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24405;&#20837;&#24207;
</span>        <span style="color: #483d8b;">print</span>(params)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">: OrderedDict([('x', &lt;Parameter "x: int"&gt;), ('y', &lt;Parameter "y: int"&gt;)])
</span>        <span style="color: #a020f0;">for</span> k,v <span style="color: #a020f0;">in</span> params.items():
            <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(k), k)
            <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(v), v.name, v.default, v.kind, v.annotation)

        <span style="color: #483d8b;">print</span>(args, kwargs)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">OrereDict(
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">[('x', &lt;Parameter "x: int"&gt;), ('y', &lt;Parameter "y: int"&gt;)])
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">(4, 5)
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20248;&#20808;&#35299;&#20915; &#25353;&#20301;&#32622;&#20256;&#21442;&#65292;&#20063;&#23601;&#26159;args
</span>        <span style="color: #a0522d;">values</span> = <span style="color: #483d8b;">list</span>(params.values()) <span style="color: #b22222;">#</span><span style="color: #b22222;">[x, y]
</span>        <span style="color: #483d8b;">print</span>(values)
        <span style="color: #a020f0;">for</span> i,x <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">enumerate</span>(args):
            <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(x, values[i].annotation):
                <span style="color: #483d8b;">print</span>(values[i].name, x, <span style="color: #8b2252;">'ok'</span>)
            <span style="color: #a020f0;">else</span>:
                <span style="color: #483d8b;">print</span>(values[i].name, x, <span style="color: #8b2252;">'error'</span>)

        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@check</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">add = check(add)
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x:<span style="color: #483d8b;">int</span>, y:<span style="color: #483d8b;">int</span>) -&gt; <span style="color: #483d8b;">int</span>:  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20989;&#25968;&#27880;&#35299;&#20063;&#26159;&#38750;&#24378;&#21046;&#24615;&#31867;&#22411;&#35201;&#27714;&#65292;&#20165;&#20165;&#26159;&#19968;&#31181;&#22768;&#26126;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36825;&#31181;&#26816;&#26597;&#26159;&#36890;&#29992;&#30340;&#21151;&#33021;&#65292;&#26159;n&#20010;&#20989;&#25968;&#37117;&#21487;&#20197;&#25317;&#26377;&#30340;&#21151;&#33021;&#65292;&#32780;&#19988;&#26816;&#26597;&#26159;&#38750;&#19994;&#21153;&#20195;&#30721;---&#20856;&#22411;&#30340;&#35013;&#39280;&#22120;&#35813;&#20570;&#30340;
</span>    <span style="color: #a0522d;">r</span> = x + y
    <span style="color: #a020f0;">return</span> r 

add(4, 5) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24863;&#35273;&#19978;&#23601;&#36319;&#20351;&#29992;&#21407;&#26469;&#30340;add&#19968;&#26679;&#65292;logger&#30340;&#20351;&#29992;&#65292;wrapper(4, 5) =&gt; add(4, 5)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: OrderedDict([('x', &lt;Parameter "x: int"&gt;), ('y', &lt;Parameter "y: int"&gt;)])
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'str'&gt; x
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'inspect.Parameter'&gt; x &lt;class 'inspect._empty'&gt; POSITIONAL_OR_KEYWORD &lt;class 'int'&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'str'&gt; y
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'inspect.Parameter'&gt; y &lt;class 'inspect._empty'&gt; POSITIONAL_OR_KEYWORD &lt;class 'int'&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: (4, 5) {}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: [&lt;Parameter "x: int"&gt;, &lt;Parameter "y: int"&gt;]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: x 4 ok
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: y 5 ok</span>
</pre>
</div>

<p>
解决关键字传参
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> inspect
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">check</span>(fn):
    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):

        <span style="color: #a0522d;">sig</span> = inspect.signature(fn)
        <span style="color: #a0522d;">params</span> = sig.parameters <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24405;&#20837;&#24207;
</span>        <span style="color: #483d8b;">print</span>(params)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">: OrderedDict([('x', &lt;Parameter "x: int"&gt;), ('y', &lt;Parameter "y: int"&gt;)])
</span>        <span style="color: #a020f0;">for</span> k,v <span style="color: #a020f0;">in</span> params.items():
            <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(k), k)
            <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(v), v.name, v.default, v.kind, v.annotation)

        <span style="color: #483d8b;">print</span>(args, kwargs)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">OrereDict(
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">[('x', &lt;Parameter "x: int"&gt;), ('y', &lt;Parameter "y: int"&gt;)])
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">(4, 5)
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20248;&#20808;&#35299;&#20915; &#25353;&#20301;&#32622;&#20256;&#21442;&#65292;&#20063;&#23601;&#26159;args
</span>        <span style="color: #a0522d;">values</span> = <span style="color: #483d8b;">list</span>(params.values()) <span style="color: #b22222;">#</span><span style="color: #b22222;">[x, y]
</span>        <span style="color: #483d8b;">print</span>(values)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">: [&lt;Parameter "x: int"&gt;, &lt;Parameter "y: int"&gt;]
</span>        <span style="color: #a020f0;">for</span> i,x <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">enumerate</span>(args):
            <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(x, values[i].annotation):
                <span style="color: #483d8b;">print</span>(values[i].name, x, <span style="color: #8b2252;">'ok'</span>)
            <span style="color: #a020f0;">else</span>:
                <span style="color: #483d8b;">print</span>(values[i].name, x, <span style="color: #8b2252;">'error'</span>)

        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20851;&#38190;&#23383;&#20256;&#21442; {'x': 4, 'y': 5} kwargs params
</span>        <span style="color: #a020f0;">for</span> k, v <span style="color: #a020f0;">in</span> kwargs.items():
            <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(v, params[k].annotation):
                <span style="color: #483d8b;">print</span>(params[k].name, v, <span style="color: #8b2252;">'ok'</span>)
            <span style="color: #a020f0;">else</span>:
                <span style="color: #483d8b;">print</span>(params[k].name, v, <span style="color: #8b2252;">'error'</span>)

        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@check</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">add = check(add)
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x:<span style="color: #483d8b;">int</span>, y:<span style="color: #483d8b;">int</span>) -&gt; <span style="color: #483d8b;">int</span>:  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20989;&#25968;&#27880;&#35299;&#20063;&#26159;&#38750;&#24378;&#21046;&#24615;&#31867;&#22411;&#35201;&#27714;&#65292;&#20165;&#20165;&#26159;&#19968;&#31181;&#22768;&#26126;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36825;&#31181;&#26816;&#26597;&#26159;&#36890;&#29992;&#30340;&#21151;&#33021;&#65292;&#26159;n&#20010;&#20989;&#25968;&#37117;&#21487;&#20197;&#25317;&#26377;&#30340;&#21151;&#33021;&#65292;&#32780;&#19988;&#26816;&#26597;&#26159;&#38750;&#19994;&#21153;&#20195;&#30721;---&#20856;&#22411;&#30340;&#35013;&#39280;&#22120;&#35813;&#20570;&#30340;
</span>    <span style="color: #a0522d;">r</span> = x + y
    <span style="color: #a020f0;">return</span> r 

<span style="color: #b22222;">#</span><span style="color: #b22222;">add(4, 5) #&#24863;&#35273;&#19978;&#23601;&#36319;&#20351;&#29992;&#21407;&#26469;&#30340;add&#19968;&#26679;&#65292;logger&#30340;&#20351;&#29992;&#65292;wrapper(4, 5) =&gt; add(4, 5)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: OrderedDict([('x', &lt;Parameter "x: int"&gt;), ('y', &lt;Parameter "y: int"&gt;)])
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'str'&gt; x
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'inspect.Parameter'&gt; x &lt;class 'inspect._empty'&gt; POSITIONAL_OR_KEYWORD &lt;class 'int'&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'str'&gt; y
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'inspect.Parameter'&gt; y &lt;class 'inspect._empty'&gt; POSITIONAL_OR_KEYWORD &lt;class 'int'&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: (4, 5) {}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: [&lt;Parameter "x: int"&gt;, &lt;Parameter "y: int"&gt;]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: x 4 ok
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: y 5 ok
</span>
add(y=5, x=4)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: OrderedDict([('x', &lt;Parameter "x: int"&gt;), ('y', &lt;Parameter "y: int"&gt;)])
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'str'&gt; x
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'inspect.Parameter'&gt; x &lt;class 'inspect._empty'&gt; POSITIONAL_OR_KEYWORD &lt;class 'int'&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'str'&gt; y
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;class 'inspect.Parameter'&gt; y &lt;class 'inspect._empty'&gt; POSITIONAL_OR_KEYWORD &lt;class 'int'&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: () {'y': 5, 'x': 4}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: [&lt;Parameter "x: int"&gt;, &lt;Parameter "y: int"&gt;]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: y 5 ok
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: x 4 ok
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">add(y='xyz', x='abc')
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: y xyz error
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: x abc error</span>
</pre>
</div>

<p>
add函数中x没有函数注解时
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> inspect
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">check</span>(fn):
    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):

        <span style="color: #a0522d;">sig</span> = inspect.signature(fn)
        <span style="color: #a0522d;">params</span> = sig.parameters <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24405;&#20837;&#24207;
</span>        <span style="color: #a0522d;">values</span> = <span style="color: #483d8b;">list</span>(params.values()) <span style="color: #b22222;">#</span><span style="color: #b22222;">[x, y]
</span>        <span style="color: #483d8b;">print</span>(values)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">: [&lt;Parameter "x: int"&gt;, &lt;Parameter "y: int"&gt;]
</span>        <span style="color: #a020f0;">for</span> i,x <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">enumerate</span>(args):
            <span style="color: #a020f0;">if</span> values[i].annotation <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> values[i].empty <span style="color: #a020f0;">and</span> <span style="color: #a020f0;">not</span> <span style="color: #483d8b;">isinstance</span>(x, values[i].annotation):
                <span style="color: #483d8b;">print</span>(values[i].name, x, <span style="color: #8b2252;">'error'</span>)

        <span style="color: #a020f0;">for</span> k, v <span style="color: #a020f0;">in</span> kwargs.items():
            <span style="color: #a020f0;">if</span> params[k].annotation <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> inspect._empty <span style="color: #a020f0;">and</span> <span style="color: #a020f0;">not</span> <span style="color: #483d8b;">isinstance</span>(v, params[k].annotation):
                <span style="color: #483d8b;">print</span>(params[k].name, v, <span style="color: #8b2252;">'error'</span>)

        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#20540;&#26816;&#26597;
</span>        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@check</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">add = check(add)
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y:<span style="color: #483d8b;">int</span>) -&gt; <span style="color: #483d8b;">int</span>:  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20989;&#25968;&#27880;&#35299;&#20063;&#26159;&#38750;&#24378;&#21046;&#24615;&#31867;&#22411;&#35201;&#27714;&#65292;&#20165;&#20165;&#26159;&#19968;&#31181;&#22768;&#26126;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36825;&#31181;&#26816;&#26597;&#26159;&#36890;&#29992;&#30340;&#21151;&#33021;&#65292;&#26159;n&#20010;&#20989;&#25968;&#37117;&#21487;&#20197;&#25317;&#26377;&#30340;&#21151;&#33021;&#65292;&#32780;&#19988;&#26816;&#26597;&#26159;&#38750;&#19994;&#21153;&#20195;&#30721;---&#20856;&#22411;&#30340;&#35013;&#39280;&#22120;&#35813;&#20570;&#30340;
</span>    <span style="color: #a0522d;">r</span> = x + y
    <span style="color: #a020f0;">return</span> r 

<span style="color: #b22222;">#</span><span style="color: #b22222;">add(4, 5) #&#24863;&#35273;&#19978;&#23601;&#36319;&#20351;&#29992;&#21407;&#26469;&#30340;add&#19968;&#26679;&#65292;logger&#30340;&#20351;&#29992;&#65292;wrapper(4, 5) =&gt; add(4, 5)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add(y=5, x=4)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add(y='xyz', x='abc')
</span>
add(4, y=5)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:7995d01c-976d-44b5-83fa-8ddf1ebe0b7d" class="outline-3">
<h3 id="h:7995d01c-976d-44b5-83fa-8ddf1ebe0b7d">functools模块</h3>
<div class="outline-text-3" id="text-h:7995d01c-976d-44b5-83fa-8ddf1ebe0b7d">
</div>
<div id="outline-container-h:b22eff52-5315-4e45-977d-c4b3e51914c0" class="outline-4">
<h4 id="h:b22eff52-5315-4e45-977d-c4b3e51914c0">reduce</h4>
<div class="outline-text-4" id="text-h:b22eff52-5315-4e45-977d-c4b3e51914c0">
<ul class="org-ul">
<li>functools.reduce(function, iterable[, initial])</li>
<li>就是减少的意思</li>
<li>初始值没有提供就在可迭代对象中取一个</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> <span style="color: #483d8b;">reduce</span>

<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">sum</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;built-in function sum&gt; sum&#23545;&#21487;&#36845;&#20195;&#23545;&#35937;&#27714;&#21644;
</span><span style="color: #a0522d;">s</span> = <span style="color: #483d8b;">sum</span>(<span style="color: #483d8b;">range</span>(10))
<span style="color: #483d8b;">print</span>(s)

<span style="color: #a0522d;">s</span> = <span style="color: #483d8b;">reduce</span>(<span style="color: #a020f0;">lambda</span> x: x, <span style="color: #483d8b;">range</span>(10))
<span style="color: #483d8b;">print</span>(s) <span style="color: #b22222;">#</span><span style="color: #b22222;">TypeError: &lt;lambda&gt;() takes 1 positional argument but 2 were given</span>
</pre>
</div>

<p>
从上面的异常推断lambda应该2个参数
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> <span style="color: #483d8b;">reduce</span>

<span style="color: #a0522d;">s</span> = <span style="color: #483d8b;">reduce</span>(<span style="color: #a020f0;">lambda</span> x,y: <span style="color: #483d8b;">print</span>(x,y), <span style="color: #483d8b;">range</span>(10))
<span style="color: #483d8b;">print</span>(s)<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25226;&#19978;&#19968;&#27425;&#32467;&#26524;&#24102;&#20837;&#19979;&#19968;&#27425;&#65292;&#20294;&#31532;&#19968;&#27425;&#20363;&#22806;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">0 1
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">None 2
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">None 3
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">None 4
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">None 5
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">None 6
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">None 7
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">None 8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">None 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">None #&#36820;&#22238;&#20540;&#20026;None
</span>
<span style="color: #a0522d;">s</span> = <span style="color: #483d8b;">reduce</span>(<span style="color: #a020f0;">lambda</span> x,y: 100, <span style="color: #483d8b;">range</span>(10))
<span style="color: #483d8b;">print</span>(s)
<span style="color: #b22222;">#</span><span style="color: #b22222;">100
</span>

<span style="color: #a0522d;">s</span> = <span style="color: #483d8b;">reduce</span>(<span style="color: #a020f0;">lambda</span> x,y: (x,y), <span style="color: #483d8b;">range</span>(10))
<span style="color: #483d8b;">print</span>(s)
<span style="color: #b22222;">#</span><span style="color: #b22222;">(((((((((0, 1), 2), 3), 4), 5), 6), 7), 8), 9)
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(x, y):
    <span style="color: #483d8b;">print</span>(x, y)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #a0522d;">s</span> = <span style="color: #483d8b;">reduce</span>(fn, <span style="color: #483d8b;">range</span>(10))
<span style="color: #483d8b;">print</span>(s)
<span style="color: #b22222;">#</span><span style="color: #b22222;">0 1
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1 2
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">3 3
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">6 4
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">10 5
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">15 6
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">21 7
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">28 8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">36 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">45
</span>

<span style="color: #a0522d;">s</span> = <span style="color: #483d8b;">reduce</span>(fn, <span style="color: #483d8b;">range</span>(10), 100) <span style="color: #b22222;"># </span><span style="color: #b22222;">100 &#26159;&#21021;&#20540;&#32473;x
</span><span style="color: #483d8b;">print</span>(s)
<span style="color: #b22222;">#</span><span style="color: #b22222;">100 0
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">100 1
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">101 2
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">103 3
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">106 4
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">110 5
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">115 6
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">121 7
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">128 8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">136 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">145</span>
</pre>
</div>

<p>
sum只能求和，reduce能做更加复杂的迭代计算
</p>

<p>
范例：5的阶乘
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> <span style="color: #483d8b;">reduce</span> 
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">reduce</span>(<span style="color: #a020f0;">lambda</span> x,y: x*y, <span style="color: #483d8b;">range</span>(1,6)))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 120</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:e2b71b9b-b300-49b7-a116-399b9441d883" class="outline-4">
<h4 id="h:e2b71b9b-b300-49b7-a116-399b9441d883">partial</h4>
<div class="outline-text-4" id="text-h:e2b71b9b-b300-49b7-a116-399b9441d883">
<p>
偏函数
</p>
<ul class="org-ul">
<li>把函数部分参数固定下来，相当于为部分的参数添加固定的默认值，形成一个新函数，并返回这个新函数</li>
<li>这个新函数是对原函数的封装</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
    <span style="color: #483d8b;">print</span>(x, y)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> partial

<span style="color: #a0522d;">newfunc</span> = partial(add, y=5) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30456;&#24403;&#20110;&#22266;&#23450;&#20102;y&#30340;&#21442;&#25968;&#65292;&#30456;&#24403;&#20110;&#32473;&#20102;y&#32570;&#23569;&#20540;
</span>
<span style="color: #483d8b;">print</span>(newfunc(4), newfunc(x=6), newfunc(y=10, x=11), newfunc(11, y=10))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 4 5
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 6 5
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 11 10
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 11 10
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 9 11 21 21
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">print(newfunc(3, 4)) #&#30456;&#24403;&#20110;add(3,4,y=5)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">TypeError: add() got multiple values for argument 'y'
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20160;&#20040;&#20250;&#25253;&#38169;&#65311; &#26597;&#30475;&#20989;&#25968;&#31614;&#21517;
</span><span style="color: #a020f0;">import</span> inspect
<span style="color: #483d8b;">print</span>(inspect.signature(add))
<span style="color: #483d8b;">print</span>(inspect.signature(newfunc))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: (x, y)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: (x, *, y=5)
</span>
<span style="color: #a0522d;">newadd</span> = partial(add, 10) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30456;&#24403;&#20110;x=10
</span><span style="color: #483d8b;">print</span>(newadd(11))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 10 11
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 21
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(newadd(20,21)) #add(10,20,21) TypeError: add() takes 2 positional arguments but 3 were given
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(newadd(x=4)) #add(10, ?, x=4) TypeError: add() got multiple values for argument 'x'
</span><span style="color: #483d8b;">print</span>(inspect.signature(newadd))
<span style="color: #b22222;">#</span><span style="color: #b22222;">(y)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y, *args):
    <span style="color: #483d8b;">print</span>(x, y, args)
    <span style="color: #a020f0;">return</span> x + y + <span style="color: #483d8b;">sum</span>(args)

<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> partial
<span style="color: #a020f0;">import</span> inspect

<span style="color: #a0522d;">newadd</span> = partial(add, 1)
<span style="color: #483d8b;">print</span>(inspect.signature(newadd)) <span style="color: #b22222;">#</span><span style="color: #b22222;">: (y, *args)
</span>
<span style="color: #a0522d;">newadd</span> = partial(add, 1, 2)
<span style="color: #483d8b;">print</span>(inspect.signature(newadd)) <span style="color: #b22222;">#</span><span style="color: #b22222;">: (*args)
</span>
<span style="color: #a0522d;">newadd</span> = partial(add, y=2)
<span style="color: #483d8b;">print</span>(inspect.signature(newadd)) <span style="color: #b22222;">#</span><span style="color: #b22222;">: (x, *, y=2)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">newadd(1,3,5,7,9) #&#25253;&#38169;&#65292;y&#22266;&#23450;&#20102;&#65292;&#21518;&#38754;args&#23601;&#27809;&#27861;&#32473;&#20102; TypeError: add() got multiple values for argument 'y'
</span>
<span style="color: #a0522d;">newadd</span> = partial(add, 1,2,3,4,5)
<span style="color: #483d8b;">print</span>(inspect.signature(newadd)) <span style="color: #b22222;">#</span><span style="color: #b22222;">: (*args)
</span>newadd()
newadd(10)
newadd(1, 2)
<span style="color: #b22222;">#</span><span style="color: #b22222;">:1 2 (3, 4, 5)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 2 (3, 4, 5, 10)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 2 (3, 4, 5, 1, 2)
</span>

<span style="color: #a0522d;">newadd</span> = partial(add, y=20, x=10)
<span style="color: #483d8b;">print</span>(inspect.signature(newadd)) <span style="color: #b22222;">#</span><span style="color: #b22222;">: (*, x=10, y=20)
</span>newadd()
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 10 20 ()
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">newadd(1, 2) #&#25253;&#38169; TypeError: add() got multiple values for argument 'y'
</span>newadd(x=1, y=2)
<span style="color: #b22222;">#</span><span style="color: #b22222;">1 2 ()
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">newadd(x=3, y=4, 5, 6, 7) #&#25253;&#38169; &#20851;&#38190;&#23383;&#20256;&#21442;&#19981;&#33021;&#25918;&#22312;&#20301;&#32622;&#20256;&#21442;&#20043;&#21069; SyntaxError: positional argument follows keyword argument
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">newadd(5, 6, 7, x=3, y=4) #&#25253;&#38169; TypeError: add() got multiple values for argument 'y'</span>
</pre>
</div>
</div>
<div id="outline-container-h:2661832c-8e58-4222-ad0a-5281ad197cd5" class="outline-5">
<h5 id="h:2661832c-8e58-4222-ad0a-5281ad197cd5">partial本质</h5>
<div class="outline-text-5" id="text-h:2661832c-8e58-4222-ad0a-5281ad197cd5">
<p>
python帮助文档检索partial，找到(in module functools)，查看等价对象
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">partial</span>(func, /, *args, **keywords):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">newfunc</span>(*fargs, **fkeywords):
        <span style="color: #a0522d;">newkeywords</span> = {**keywords, **fkeywords}
        <span style="color: #a020f0;">return</span> func(*args, *fargs, **newkeywords)
    newfunc.<span style="color: #a0522d;">func</span> = func
    newfunc.<span style="color: #a0522d;">args</span> = args
    newfunc.<span style="color: #a0522d;">keywords</span> = keywords
    <span style="color: #a020f0;">return</span> newfunc
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> partial

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">partial</span>(func, /, *args, **keywords): <span style="color: #b22222;">#</span><span style="color: #b22222;">add, (), {x:10, y:20}
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">newfunc</span>(*fargs, **fkeywords): <span style="color: #b22222;">#</span><span style="color: #b22222;">newfunc&#35806;&#29983;&#20102;
</span>        <span style="color: #a0522d;">newkeywords</span> = {**keywords, **fkeywords}
        <span style="color: #a020f0;">return</span> func(*args, *fargs, **newkeywords)
    newfunc.<span style="color: #a0522d;">func</span> = func <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#21521;&#21407;&#20989;&#25968;
</span>    newfunc.<span style="color: #a0522d;">args</span> = args <span style="color: #b22222;">#</span><span style="color: #b22222;">args kwargs&#20998;&#21035;&#35760;&#24405;&#20102;&#20256;&#20837;&#30340;&#23454;&#21442;
</span>    newfunc.<span style="color: #a0522d;">keywords</span> = keywords
    <span style="color: #a020f0;">return</span> newfunc

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y, *args):
    <span style="color: #483d8b;">print</span>(x, y, args)
    <span style="color: #a020f0;">return</span> x + y + <span style="color: #483d8b;">sum</span>(args)

<span style="color: #a0522d;">newadd</span> = partial(add, y=20, x=10) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#26032;&#20989;&#25968;
</span><span style="color: #483d8b;">print</span>(newadd.func, <span style="color: #483d8b;">hex</span>(<span style="color: #483d8b;">id</span>(add)))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: &lt;function add at 0x0000026283C36280&gt; 0x26283c36280
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20998;&#26512;&#22914;&#20309;&#35843;&#29992;
</span>newadd(4, 5) <span style="color: #b22222;">#</span><span style="color: #b22222;">add(4,5,x=10, y=20)
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">partial</span>(func, /, *args, **keywords): <span style="color: #b22222;">#</span><span style="color: #b22222;">add, (), {x:10, y:20}
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">newfunc</span>(*fargs, **fkeywords): <span style="color: #b22222;">#</span><span style="color: #b22222;">newfunc&#35806;&#29983;&#20102; newfunc(4, 5) (4,5) {}
</span>        <span style="color: #a0522d;">newkeywords</span> = {**keywords, **fkeywords} <span style="color: #b22222;">#</span><span style="color: #b22222;">{x:10, y:20}
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#20320;&#22266;&#23450;&#30340;&#26102;&#20505;&#65292;&#20851;&#38190;&#23383;&#20256;&#21442;&#65292;&#21518;&#26399;&#36824;&#21487;&#20197;&#26356;&#26032;&#23427;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#22266;&#23450;&#20102;&#25353;&#20301;&#32622;&#20256;&#21442;&#65292;&#23558;&#21069;&#21518;2&#27425;&#20301;&#32622;&#20256;&#21442;&#37117;&#35299;&#24320;&#65292;&#25226;&#20851;&#38190;&#23383;&#20256;&#21442;&#20063;&#35299;&#24320;
</span>        <span style="color: #a020f0;">return</span> func(*args, *fargs, **newkeywords) <span style="color: #b22222;">#</span><span style="color: #b22222;">retrun add(4,5, x=10, y=20)
</span>    newfunc.<span style="color: #a0522d;">func</span> = func <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#21521;&#21407;&#20989;&#25968;
</span>    newfunc.<span style="color: #a0522d;">args</span> = args <span style="color: #b22222;">#</span><span style="color: #b22222;">args kwargs&#20998;&#21035;&#35760;&#24405;&#20102;&#20256;&#20837;&#30340;&#23454;&#21442;
</span>    newfunc.<span style="color: #a0522d;">keywords</span> = keywords
    <span style="color: #a020f0;">return</span> newfunc
</pre>
</div>


<p>
functools中wraps采用了partial偏函数
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">update_wrapper</span>(wrapper,
                   wrapped,
                   assigned = WRAPPER_ASSIGNMENTS,
                   updated = WRAPPER_UPDATES):
    <span style="color: #a020f0;">pass</span>
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wraps</span>(wrapped,
          assigned = WRAPPER_ASSIGNMENTS,
          updated = WRAPPER_UPDATES):
    <span style="color: #a0522d;">newfunc</span> = partial(update_wrapper, wrapped=wrapped,
                   assigned=assigned, updated=updated) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22266;&#23450;&#20102;3&#21442;
</span>    <span style="color: #a020f0;">return</span> newfunc

wraps(fn) =&gt; newfunc &#26377;&#19968;&#20010;&#21442;&#25968;wrapper
wraps(fn)(wrapper) =&gt; newfunc(wrapper)
<span style="color: #a020f0;">return</span> func(*args, *fargs, **newkeywords)
<span style="color: #a020f0;">return</span> update_wrapper(wrapper, wrapped=fn, assigned=assigned, updated=updated)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:3e87602d-6468-41e9-a71d-a3f6503e3eb9" class="outline-4">
<h4 id="h:3e87602d-6468-41e9-a71d-a3f6503e3eb9"><code>lru_cache</code></h4>
<div class="outline-text-4" id="text-h:3e87602d-6468-41e9-a71d-a3f6503e3eb9">
<p>
<code>@functools.lru_cache(maxsize=128, typed=False)</code>
</p>

<ul class="org-ul">
<li>lru即Least-recently-used，最近最少使用。cache缓存</li>
<li>如果maxsize设置为None，则禁用LRU功能，并且缓存可以无限制增长。当maxsize是二的幂时，LRU功能执行得最好</li>
<li>如果typed设置为True，则不同类型的函数参数将单独缓存。例如，f(3)和f(3.0)将被视为具有不同结果的不同调用</li>
<li>Python3.8简化了调用，可以使用</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> functools

<span style="color: #228b22;">@functools.lru_cache</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>():
    <span style="color: #a020f0;">pass</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#20215;&#20110;
</span><span style="color: #228b22;">@functools.lru_cache</span>(128)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>():
    <span style="color: #a020f0;">pass</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> lru_cache
<span style="color: #a020f0;">import</span> time


<span style="color: #228b22;">@lru_cache</span>() <span style="color: #b22222;"># </span><span style="color: #b22222;">maxsize = 128 # &#22914;&#26524;&#26159;None &#26080;&#38480;&#22823; typed=False
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
    time.sleep(2)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(1, add(4, 5)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24314;&#31435;&#20102;&#35843;&#29992;&#20449;&#24687;&#65288;&#36755;&#20837;&#65289;&#21644;&#32467;&#26524;&#65288;&#36755;&#20986;&#65289;&#30340;&#23545;&#24212;&#20851;&#31995;&#65292;&#23601;&#35201;&#29992;&#23383;&#20856;&#65311;key hash
</span><span style="color: #483d8b;">print</span>(2, add(4, 5)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31532;2&#27425;&#21644;&#31532;3&#27425;&#26681;&#26412;&#27809;&#26377;&#35843;&#29992;add&#65292;&#27809;&#26377;&#35745;&#31639;&#65292;&#29992;&#21040;&#20102;&#36825;&#20010;&#23383;&#20856;&#65292;&#32531;&#23384;cache&#65292;&#32531;&#23384;&#21629;&#20013;
</span><span style="color: #483d8b;">print</span>(3, add(4, 5))
<span style="color: #483d8b;">print</span>(3, add(4.0, 5.0)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21644;add(4,5)&#31561;&#20215;&#65292;&#21629;&#20013;&#20102;&#12290;&#22914;&#26524;typed=True&#23601;&#19981;&#31561;&#20215;&#20102;&#65292;&#20250;&#35745;&#31639;
</span><span style="color: #483d8b;">print</span>(4, add(4, 6)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35745;&#31639;&#20102;
</span><span style="color: #483d8b;">print</span>(5, add()) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30456;&#24403;&#20110;add(4, 5) &#65292; &#21448;&#35745;&#31639;&#20102;
</span><span style="color: #483d8b;">print</span>(6, add(4)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30456;&#24403;&#20110;add(4, 5) &#65292; &#21448;&#35745;&#31639;&#20102;
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
<span style="color: #483d8b;">print</span>(7, add(x=4, y=5)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35745;&#31639;&#20102;
</span><span style="color: #483d8b;">print</span>(8, add(y=5, x=4)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35745;&#31639;&#20102;
</span><span style="color: #483d8b;">print</span>(9, add(4, y=5)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35745;&#31639;&#20102;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">2 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">3 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">3 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">4 10
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">5 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">6 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">7 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">8 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">9 9</span>
</pre>
</div>

<p>
应用
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> lru_cache

<span style="color: #228b22;">@lru_cache</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26000;&#27874;&#37027;&#22865;&#25968;&#21015; fib(b) = fib(n-1) + fib(n-2) &#36825;&#20010;&#29256;&#26412;&#32972;&#36807;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fib</span>(n): <span style="color: #b22222;">#</span><span style="color: #b22222;">n &gt;= 1
</span>    <span style="color: #a020f0;">return</span> 1 <span style="color: #a020f0;">if</span> n &lt;3 <span style="color: #a020f0;">else</span> fib(n-1) + fib(n-2)

<span style="color: #483d8b;">print</span>(fib(35))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 9227465
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;&#20160;&#20040;&#31639;&#36825;&#20040;&#24555;&#65311; &#31354;&#38388;&#25442;&#26102;&#38388;&#12290;&#35745;&#31639;&#30340;&#32467;&#26524;&#37117;&#34987;&#32531;&#23384;&#19979;&#26469;&#65292;&#36825;&#27425;&#21482;&#26159;&#21629;&#20013;&#20102;&#12290;</span>
</pre>
</div>
</div>
<div id="outline-container-h:88ad312c-d110-4e83-b669-6e0bbdc3d9df" class="outline-5">
<h5 id="h:88ad312c-d110-4e83-b669-6e0bbdc3d9df"><code>lru_cache</code> 本质</h5>
<div class="outline-text-5" id="text-h:88ad312c-d110-4e83-b669-6e0bbdc3d9df">
<ul class="org-ul">
<li>内部使用了一个字典</li>
</ul>

<p>
key是怎么来的？
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> lru_cache 

<span style="color: #228b22;">@lru_cache</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">fn = lru_cache(fn)
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>():
    <span style="color: #a020f0;">pass</span>

<span style="color: #228b22;">@lru_cache</span>() <span style="color: #b22222;"># </span><span style="color: #b22222;">fn = lru_cache()(fn) # fn = lru_cache(128, False)(fn)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">add = lru_cache()(add) =&gt; add decorating_function(add)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add = wrapper =&gt; _lru_cache_wrapper(add, maxsize, typed, _CacheInfo)
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>():
    <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">lru_cache</span>(maxsize=128, typed=<span style="color: #008b8b;">False</span>):
    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(maxsize, <span style="color: #483d8b;">int</span>):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">Negative maxsize is treated as 0
</span>        <span style="color: #a020f0;">if</span> maxsize &lt; 0:
            <span style="color: #a0522d;">maxsize</span> = 0
    <span style="color: #a020f0;">elif</span> <span style="color: #483d8b;">callable</span>(maxsize) <span style="color: #a020f0;">and</span> <span style="color: #483d8b;">isinstance</span>(typed, <span style="color: #483d8b;">bool</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">python 3.8 &#22686;&#21152;&#30340;&#20195;&#30721;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">The user_function was passed in directly via the maxsize argument
</span>        <span style="color: #a0522d;">user_function</span>, <span style="color: #a0522d;">maxsize</span> = maxsize, 128 <span style="color: #b22222;">#</span><span style="color: #b22222;">
</span>        <span style="color: #a0522d;">wrapper</span> = _lru_cache_wrapper(user_function, maxsize, typed, _CacheInfo)
        <span style="color: #a020f0;">return</span> update_wrapper(wrapper, user_function)
    <span style="color: #a020f0;">elif</span> maxsize <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #008b8b;">None</span>:
        <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">TypeError</span>(
            <span style="color: #8b2252;">'Expected first argument to be an integer, a callable, or None'</span>)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">decorating_function</span>(user_function):
        <span style="color: #a0522d;">wrapper</span> = _lru_cache_wrapper(user_function, maxsize, typed, _CacheInfo)
        <span style="color: #a020f0;">return</span> update_wrapper(wrapper, user_function)

    <span style="color: #a020f0;">return</span> decorating_function

...

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_lru_cache_wrapper</span>(user_function, maxsize, typed, _CacheInfo):
    <span style="color: #b22222;"># </span><span style="color: #b22222;">Constants shared by all lru cache instances:
</span>    <span style="color: #a0522d;">sentinel</span> = <span style="color: #483d8b;">object</span>()          <span style="color: #b22222;"># </span><span style="color: #b22222;">unique object used to signal cache misses
</span>    <span style="color: #a0522d;">make_key</span> = _make_key         <span style="color: #b22222;"># </span><span style="color: #b22222;">build a key from the function arguments
</span>...

    <span style="color: #a020f0;">elif</span> maxsize <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:

        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwds):
            <span style="color: #b22222;"># </span><span style="color: #b22222;">Simple caching without ordering or size limit
</span>            <span style="color: #a020f0;">nonlocal</span> hits, misses
            <span style="color: #a0522d;">key</span> = make_key(args, kwds, typed)

...
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_make_key</span>(args, kwds, typed,
             kwd_mark = (<span style="color: #483d8b;">object</span>(),),
             fasttypes = {<span style="color: #483d8b;">int</span>, <span style="color: #483d8b;">str</span>},
             <span style="color: #483d8b;">tuple</span>=<span style="color: #483d8b;">tuple</span>, <span style="color: #483d8b;">type</span>=<span style="color: #483d8b;">type</span>, <span style="color: #483d8b;">len</span>=<span style="color: #483d8b;">len</span>):
    <span style="color: #a0522d;">key</span> = args
    <span style="color: #a020f0;">if</span> kwds:
        <span style="color: #a0522d;">key</span> += kwd_mark
        <span style="color: #a020f0;">for</span> item <span style="color: #a020f0;">in</span> kwds.items():
            <span style="color: #a0522d;">key</span> += item
    <span style="color: #a020f0;">if</span> typed:
        <span style="color: #a0522d;">key</span> += <span style="color: #483d8b;">tuple</span>(<span style="color: #483d8b;">type</span>(v) <span style="color: #a020f0;">for</span> v <span style="color: #a020f0;">in</span> args)
        <span style="color: #a020f0;">if</span> kwds:
            <span style="color: #a0522d;">key</span> += <span style="color: #483d8b;">tuple</span>(<span style="color: #483d8b;">type</span>(v) <span style="color: #a020f0;">for</span> v <span style="color: #a020f0;">in</span> kwds.values())
    <span style="color: #a020f0;">elif</span> <span style="color: #483d8b;">len</span>(key) == 1 <span style="color: #a020f0;">and</span> <span style="color: #483d8b;">type</span>(key[0]) <span style="color: #a020f0;">in</span> fasttypes:
        <span style="color: #a020f0;">return</span> key[0]
    <span style="color: #a020f0;">return</span> _HashedSeq(key)

</pre>
</div>

<ul class="org-ul">
<li>key 是由 <code>_make_key</code> 函数构造出来</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> _make_key

<span style="color: #483d8b;">print</span>(_make_key((4, 5), {}, <span style="color: #008b8b;">False</span>))
<span style="color: #483d8b;">print</span>(_make_key((4,), {<span style="color: #8b2252;">'y'</span>: 5}, <span style="color: #008b8b;">False</span>))
<span style="color: #483d8b;">print</span>(_make_key((), {<span style="color: #8b2252;">'x'</span>:4, <span style="color: #8b2252;">'y'</span>: 5}, <span style="color: #008b8b;">False</span>))
<span style="color: #483d8b;">print</span>(_make_key((4, 5), {}, <span style="color: #008b8b;">True</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: [4, 5]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: [4, &lt;object object at 0x0000020BD8EC4E90&gt;, 'y', 5]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: [&lt;object object at 0x0000020BD8EC4E90&gt;, 'x', 4, 'y', 5]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: [4, 5, &lt;class 'int'&gt;, &lt;class 'int'&gt;]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:227d72e1-5a19-4055-8bc8-de9f4524a87d" class="outline-5">
<h5 id="h:227d72e1-5a19-4055-8bc8-de9f4524a87d">应用</h5>
<div class="outline-text-5" id="text-h:227d72e1-5a19-4055-8bc8-de9f4524a87d">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> lru_cache

<span style="color: #228b22;">@lru_cache</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26000;&#27874;&#37027;&#22865;&#25968;&#21015; fib(b) = fib(n-1) + fib(n-2) &#36825;&#20010;&#29256;&#26412;&#32972;&#36807;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fib</span>(n): <span style="color: #b22222;">#</span><span style="color: #b22222;">n &gt;= 1
</span>    <span style="color: #a020f0;">return</span> 1 <span style="color: #a020f0;">if</span> n &lt;3 <span style="color: #a020f0;">else</span> fib(n-1) + fib(n-2)

<span style="color: #483d8b;">print</span>(fib(35))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 9227465
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;&#20160;&#20040;&#31639;&#36825;&#20040;&#24555;&#65311; &#31354;&#38388;&#25442;&#26102;&#38388;&#12290;&#35745;&#31639;&#30340;&#32467;&#26524;&#37117;&#34987;&#32531;&#23384;&#19979;&#26469;&#65292;&#36825;&#27425;&#21482;&#26159;&#21629;&#20013;&#20102;&#12290;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> lru_cache
<span style="color: #a020f0;">import</span> datetime

<span style="color: #b22222;">#</span><span style="color: #b22222;">maxsize cache = {} &#23383;&#20856;&#30340;&#22823;&#23567;&#19978;&#38480;&#65292;kv&#23545;&#26377;&#20010;50&#20010;&#19978;&#38480;&#65292;LRU
</span><span style="color: #228b22;">@lru_cache</span>(50) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26000;&#27874;&#37027;&#22865;&#25968;&#21015; fib(b) = fib(n-1) + fib(n-2) &#36825;&#20010;&#29256;&#26412;&#32972;&#36807;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fib</span>(n): <span style="color: #b22222;">#</span><span style="color: #b22222;">n &gt;= 1
</span>    <span style="color: #a020f0;">return</span> 1 <span style="color: #a020f0;">if</span> n &lt;3 <span style="color: #a020f0;">else</span> fib(n-1) + fib(n-2)

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> [35, 101]: 
    <span style="color: #a0522d;">start</span> = datetime.datetime.now()
    <span style="color: #483d8b;">print</span>(fib(i))
    <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
    <span style="color: #483d8b;">print</span>(i, delta)

<span style="color: #b22222;">#</span><span style="color: #b22222;">: 9227465
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 35 0.0
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 573147844013817084101
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 101 0.0
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;&#20160;&#20040;&#31639;&#36825;&#20040;&#24555;&#65311; &#31354;&#38388;&#25442;&#26102;&#38388;&#12290;&#35745;&#31639;&#30340;&#32467;&#26524;&#37117;&#34987;&#32531;&#23384;&#19979;&#26469;&#65292;&#36825;&#27425;&#21482;&#26159;&#21629;&#20013;&#20102;&#12290;</span>
</pre>
</div>

<p>
斐波那契数列 有循环版、递归版、生成器版、递归加lru_cache版本
</p>

<p>
什么时候用缓存？
</p>
<ul class="org-ul">
<li>不变。恒久不变，一段时间内，不变化，给定一个值，返回一个恒久不变值；幂等性，给定一个输入，一定返回一个不变的结果</li>
<li>计算代价高。但是，给你一个输入，得到的结果需要时间长，空间换时间，输入key -&gt; value字典</li>
<li>使用频度。在一段时间内，使用频率高，空间换时间，kv</li>
</ul>
</div>
</div>
<div id="outline-container-h:0cb67231-a88c-4963-9916-e20c31fd728f" class="outline-5">
<h5 id="h:0cb67231-a88c-4963-9916-e20c31fd728f">总结</h5>
<div class="outline-text-5" id="text-h:0cb67231-a88c-4963-9916-e20c31fd728f">
<p>
lru_cache装饰器应用：
</p>
<ul class="org-ul">
<li>使用前提
<ul class="org-ul">
<li>同样的函数参数一定得到同样的结果，至少是一段时间内，同样输入得到同样结果</li>
<li>计算代价高，函数执行时间很长</li>
<li>需要多次执行，每一次计算代价高</li>
</ul></li>
<li>本质是建立函数调用的参数到返回值的映射</li>
<li>缺点
<ul class="org-ul">
<li>不支持缓存过期，key无法过期、失效</li>
<li>不支持清除操作</li>
<li>不支持分布式，是一个单机的缓存</li>
</ul></li>
<li>适应场景，单机上需要空间换时间的地方，可以缓存来将计算变成快速的查询</li>
</ul>

<p>
学习 <code>lru_cache</code> 可以让我们了解缓存背后的原理
</p>
</div>
</div>
</div>
<div id="outline-container-h:3ae30f2d-5ac4-42a7-bc60-98bdf6d5f2ce" class="outline-4">
<h4 id="h:3ae30f2d-5ac4-42a7-bc60-98bdf6d5f2ce">练习</h4>
<div class="outline-text-4" id="text-h:3ae30f2d-5ac4-42a7-bc60-98bdf6d5f2ce">
</div>
<div id="outline-container-h:5d4f9ad3-6983-4623-a816-706d264be7ba" class="outline-5">
<h5 id="h:5d4f9ad3-6983-4623-a816-706d264be7ba">实现Base64编码</h5>
<div class="outline-text-5" id="text-h:5d4f9ad3-6983-4623-a816-706d264be7ba">
<p>
<a href="https://en.wikipedia.org/wiki/Base64">https://en.wikipedia.org/wiki/Base64</a>
</p>

<p>
用6位就可以表达所有的数值。
</p>


<figure id="org4945822">
<img src="./images/img_20240605_083033.png" alt="img_20240605_083033.png" width="50%">

</figure>

<p>
边界：最大的值不能超过6位
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">base64&#32534;&#30721;
</span><span style="color: #a020f0;">import</span> base64

<span style="color: #b22222;">#</span><span style="color: #b22222;">s = 'abc' # &#20869;&#37096;&#29992;&#30340;unicode
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(base64.b64encode(s)) #&#25253;&#38169;TypeError: a bytes-like object is required, not 'str'
</span>
<span style="color: #a0522d;">s</span> = b<span style="color: #8b2252;">'abc'</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20869;&#37096;&#29992;&#30340;unicode b'YWJj' #&#20869;&#23384;&#20013;&#22823;&#31471; 0x616263
</span><span style="color: #483d8b;">print</span>(base64.b64encode(s))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: b'YWJj'
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;base64&#30721;&#34920;
</span><span style="color: #a020f0;">from</span> string <span style="color: #a020f0;">import</span> ascii_lowercase, ascii_uppercase
<span style="color: #a0522d;">alphabet</span> = ascii_uppercase + ascii_lowercase + <span style="color: #8b2252;">'0123456789+/'</span>
<span style="color: #483d8b;">print</span>(alphabet)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/</span>
</pre>
</div>

<p>
base64转换原理
</p>
<div class="org-src-container">
<pre class="src src-sh">0x 61         62         63  big
0b 0110 0001  0110 0010  0110 0011       <span style="color: #b22222;">#</span><span style="color: #b22222;">3*8 24bits
</span>0b   011000   010110    001001   100011  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21464;&#25104;6&#20301;&#19968;&#27573;
</span>0b 00011000 00010110  00001001 00100011  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21464;&#25104;6&#20301;&#19968;&#27573;&#65292;&#21069;&#38754;&#34917;2&#20010;0&#23545;&#25968;&#20540;&#27809;&#26377;&#24433;&#21709;
</span>0x 18       16        9        23        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36716;&#25104;16&#36827;&#21046;&#65292;&#20877;&#26597;&#23545;&#24212;base64&#30721;&#34920;
</span>   24       22        9        35        <span style="color: #b22222;">#</span><span style="color: #b22222;">10&#36827;&#21046;&#34920;&#36798;
</span>   Y        W         J        j         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;base64&#30721;&#34920;&#23545;&#24212;&#30340;&#20540;
</span>
3*8 24bits -&gt; 4*6bits
</pre>
</div>

<p>
先拿到第一个字符
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a020f0;">import</span> base64

<span style="color: #a0522d;">alphabet</span> = <span style="color: #8b2252;">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>


<span style="color: #b22222;">#</span><span style="color: #b22222;">print(8 &gt;&gt; 1, 0b1000 &gt;&gt; 1) #0b0100
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(8 &gt;&gt; 2, 0b1000 &gt;&gt; 2) #0b10
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(0b1000000000 &gt;&gt; 5)
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 4 4
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 2 2
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 16
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">b64encode</span>(src:<span style="color: #483d8b;">str</span>, encoding=<span style="color: #8b2252;">'utf-8'</span>) -&gt;<span style="color: #483d8b;">bytes</span>:
    <span style="color: #b22222;">#</span><span style="color: #b22222;">3&#23383;&#33410;&#26029;&#24320;&#65292;4 * 6 -&gt; 4 * 8 bits&#21069;&#38754;&#34917;&#38646;&#65292;&#31227;&#20301;&#35745;&#31639;&#27491;&#22909;&#65292;&#31616;&#21333;&#25928;&#29575;&#39640;
</span>    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(src, <span style="color: #483d8b;">str</span>):
        <span style="color: #a0522d;">_src</span> = src.encode(encoding=encoding)
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">None</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25925;&#24847;&#36820;&#22238;None&#23601;&#26159;&#21578;&#35785;&#20320;&#65292;&#25105;&#19981;&#36820;&#22238;bytes&#31867;&#22411;&#25968;&#25454;b''
</span>
    <span style="color: #b22222;">#</span><span style="color: #b22222;">print(_src &gt;&gt; 18) #: b'abc' 0x61 62 63 b'\x616263' bytes&#31867;&#22411;&#19981;&#25903;&#25345;&#31227;&#20301;&#65292;&#25972;&#25968;&#25903;&#25345;&#12290;
</span>    <span style="color: #483d8b;">print</span>(_src) <span style="color: #b22222;">#</span><span style="color: #b22222;">: b'abc' 0x61 62 63 b'\x616263' bytes&#31867;&#22411;&#19981;&#25903;&#25345;&#31227;&#20301;&#65292;&#25972;&#25968;&#25903;&#25345;&#12290;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25972;&#25968;&#25903;&#25345; &gt;&gt;
</span>    <span style="color: #a0522d;">b</span> = <span style="color: #483d8b;">int</span>.from_bytes(_src, <span style="color: #8b2252;">'big'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">bytes&#36716;int
</span>    <span style="color: #483d8b;">print</span>(b, <span style="color: #483d8b;">hex</span>(b), b &gt;&gt; 18) <span style="color: #b22222;">#</span><span style="color: #b22222;">24 - 18 = 6 # &#36820;&#22238;int&#31867;&#22411;&#65292;&#33267;&#23569;&#35748;&#20026;&#20320;&#26159;&#19968;&#20010;&#23383;&#33410;&#30340;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">0b 011000 &gt;&gt;18  010110  001001 100011
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">0b 00011000
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">0x 18
</span>    <span style="color: #a0522d;">index</span> = b &gt;&gt; 18
    <span style="color: #b22222;">#</span><span style="color: #b22222;">: 6382179 0x616263 24
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">index  base64 &#20013;&#20351;&#29992;index&#25214;&#21040;&#23383;&#31526;
</span>    <span style="color: #483d8b;">print</span>(alphabet[index]) <span style="color: #b22222;">#</span><span style="color: #b22222;">: Y &#22788;&#29702;&#30340;&#31532;&#19968;&#20010;&#23383;&#31526;&#20986;&#26469;&#20102;&#12290;
</span>
<span style="color: #483d8b;">print</span>(b64encode(<span style="color: #8b2252;">'abc'</span>))

</pre>
</div>

<p>
拿到第二第三个字符
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #483d8b;">print</span>(8 &gt;&gt; 1, 0b1000 &gt;&gt; 1) <span style="color: #b22222;">#</span><span style="color: #b22222;">0b0100
</span><span style="color: #483d8b;">print</span>(8 &gt;&gt; 2, 0b1000 &gt;&gt; 2) <span style="color: #b22222;">#</span><span style="color: #b22222;">0b10
</span><span style="color: #483d8b;">print</span>(0b1000000000 &gt;&gt; 5)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: 4 4
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2 2
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 16
</span>
<span style="color: #483d8b;">print</span>(0b1 &lt;&lt; 1) <span style="color: #b22222;"># </span><span style="color: #b22222;">0b10 &#24038;&#31227;1&#20301;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 2
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#19982;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">x &amp; 0x0000000000000000000111111
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">3 &amp; 0x3F
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">0b 011000 010110  001001 100011  &gt;&gt; 12 #abc&#20808;&#21491;&#31227;12&#20301;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">0b 011000 010110 &amp; 0x3F #&#21435;&#25481;&#21069;6&#20301;&#65292;&#20301;&#19982;0x3F&#65292;&#25343;&#21040;&#26368;&#21518;6&#20301;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">0b 000000 111111 #0x3F
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">ob 010110 #&#32467;&#26524;&#25343;&#21040;&#21518;6&#20301;&#65292;&#21363;&#31532;&#20108;&#20010;&#23383;&#31526;
</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31532;&#19977;&#20010;&#23383;&#31526;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">0b 011000 010110  001001 100011  &gt;&gt; 6#&#20808;&#21491;&#31227;6&#20301;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">0b 011000 010110  001001 &amp; 0x3F  #&#20301;&#19982;0x3F&#65292;&#25343;&#21040;&#26368;&#21518;6&#20301;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">0b 000000 000000  111111 #0x3F
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">0b 001001 #9</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span>
<span style="color: #a020f0;">import</span> base64

<span style="color: #a0522d;">alphabet</span> = <span style="color: #8b2252;">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>


<span style="color: #b22222;">#</span><span style="color: #b22222;">print(8 &gt;&gt; 1, 0b1000 &gt;&gt; 1) #0b0100
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(8 &gt;&gt; 2, 0b1000 &gt;&gt; 2) #0b10
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(0b1000000000 &gt;&gt; 5)
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 4 4
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 2 2
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 16
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">b64encode</span>(src:<span style="color: #483d8b;">str</span>, encoding=<span style="color: #8b2252;">'utf-8'</span>) -&gt;<span style="color: #483d8b;">bytes</span>:
    <span style="color: #b22222;">#</span><span style="color: #b22222;">3&#23383;&#33410;&#26029;&#24320;&#65292;4 * 6 -&gt; 4 * 8 bits&#21069;&#38754;&#34917;&#38646;&#65292;&#31227;&#20301;&#35745;&#31639;&#27491;&#22909;&#65292;&#31616;&#21333;&#25928;&#29575;&#39640;
</span>    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(src, <span style="color: #483d8b;">str</span>):
        <span style="color: #a0522d;">_src</span> = src.encode(encoding=encoding)
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">None</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25925;&#24847;&#36820;&#22238;None&#23601;&#26159;&#21578;&#35785;&#20320;&#65292;&#25105;&#19981;&#36820;&#22238;bytes&#31867;&#22411;&#25968;&#25454;b''
</span>
    <span style="color: #b22222;">#</span><span style="color: #b22222;">print(_src &gt;&gt; 18) #: b'abc' 0x61 62 63 b'\x616263' bytes&#31867;&#22411;&#19981;&#25903;&#25345;&#31227;&#20301;&#65292;&#25972;&#25968;&#25903;&#25345;&#12290;
</span>    <span style="color: #483d8b;">print</span>(_src) <span style="color: #b22222;">#</span><span style="color: #b22222;">: b'abc' 0x61 62 63 b'\x616263' bytes&#31867;&#22411;&#19981;&#25903;&#25345;&#31227;&#20301;&#65292;&#25972;&#25968;&#25903;&#25345;&#12290;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25972;&#25968;&#25903;&#25345; &gt;&gt;
</span>    <span style="color: #a0522d;">b</span> = <span style="color: #483d8b;">int</span>.from_bytes(_src, <span style="color: #8b2252;">'big'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">bytes&#36716;int
</span>    <span style="color: #483d8b;">print</span>(b, <span style="color: #483d8b;">hex</span>(b), b &gt;&gt; 18) <span style="color: #b22222;">#</span><span style="color: #b22222;">24 - 18 = 6 # &#36820;&#22238;int&#31867;&#22411;&#65292;&#33267;&#23569;&#35748;&#20026;&#20320;&#26159;&#19968;&#20010;&#23383;&#33410;&#30340;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">0b 011000 &gt;&gt;18  010110  001001 100011
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">0b 00011000
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">0x 18
</span>    <span style="color: #a0522d;">index</span> = b &gt;&gt; 18 &amp; 0x3F <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#19981;&#20889;&amp; 0x3F&#65292;&#26080;&#29992;&#21151;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">: 6382179 0x616263 24
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">index  base64 &#20013;&#20351;&#29992;index&#25214;&#21040;&#23383;&#31526;
</span>    <span style="color: #483d8b;">print</span>(alphabet[index]) <span style="color: #b22222;">#</span><span style="color: #b22222;">: Y &#22788;&#29702;&#30340;&#31532;&#19968;&#20010;&#23383;&#31526;&#20986;&#26469;&#20102;&#12290;
</span>
    <span style="color: #a0522d;">index</span> = b &gt;&gt; 12 &amp; 0x3F
    <span style="color: #483d8b;">print</span>(alphabet[index]) <span style="color: #b22222;">#</span><span style="color: #b22222;">: W &#22788;&#29702;&#30340;&#31532;&#20108;&#20010;&#23383;&#31526;&#20986;&#26469;&#20102;&#12290;
</span>
    <span style="color: #a0522d;">index</span> = b &gt;&gt; 6 &amp; 0x3F
    <span style="color: #483d8b;">print</span>(alphabet[index]) <span style="color: #b22222;">#</span><span style="color: #b22222;">: J &#22788;&#29702;&#30340;&#31532;&#19977;&#20010;&#23383;&#31526;&#20986;&#26469;&#20102;&#12290;
</span>
    <span style="color: #a0522d;">index</span> = b &gt;&gt; 0 &amp; 0x3F
    <span style="color: #483d8b;">print</span>(alphabet[index]) <span style="color: #b22222;">#</span><span style="color: #b22222;">: J &#22788;&#29702;&#30340;&#26368;&#21518;&#23383;&#31526;&#20986;&#26469;&#20102;&#12290;
</span>
<span style="color: #483d8b;">print</span>(b64encode(<span style="color: #8b2252;">'abc'</span>))

</pre>
</div>

<p>
找规律
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> base64

<span style="color: #a0522d;">alphabet</span> = <span style="color: #8b2252;">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">print(8 &gt;&gt; 1, 0b1000 &gt;&gt; 1) #0b0100
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(8 &gt;&gt; 2, 0b1000 &gt;&gt; 2) #0b10
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(0b1000000000 &gt;&gt; 5)
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 4 4
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 2 2
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 16
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">b64encode</span>(src:<span style="color: #483d8b;">str</span>, encoding=<span style="color: #8b2252;">'utf-8'</span>) -&gt;<span style="color: #483d8b;">bytes</span>:
    <span style="color: #b22222;">#</span><span style="color: #b22222;">3&#23383;&#33410;&#26029;&#24320;&#65292;4 * 6 -&gt; 4 * 8 bits&#21069;&#38754;&#34917;&#38646;&#65292;&#31227;&#20301;&#35745;&#31639;&#27491;&#22909;&#65292;&#31616;&#21333;&#25928;&#29575;&#39640;
</span>    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(src, <span style="color: #483d8b;">str</span>):
        <span style="color: #a0522d;">_src</span> = src.encode(encoding=encoding)
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">None</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25925;&#24847;&#36820;&#22238;None&#23601;&#26159;&#21578;&#35785;&#20320;&#65292;&#25105;&#19981;&#36820;&#22238;bytes&#31867;&#22411;&#25968;&#25454;b''
</span>
    <span style="color: #483d8b;">print</span>(_src) <span style="color: #b22222;">#</span><span style="color: #b22222;">: b'abc' 0x61 62 63 b'\x616263' bytes&#31867;&#22411;&#19981;&#25903;&#25345;&#31227;&#20301;&#65292;&#25972;&#25968;&#25903;&#25345;&#12290;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25972;&#25968;&#25903;&#25345; &gt;&gt;
</span>    <span style="color: #a0522d;">b</span> = <span style="color: #483d8b;">int</span>.from_bytes(_src, <span style="color: #8b2252;">'big'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">bytes&#36716;int
</span>
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(18, -1, -6):
        <span style="color: #b22222;">#</span><span style="color: #b22222;">print(b, hex(b), b &gt;&gt; 18) #24 - 18 = 6 # &#36820;&#22238;int&#31867;&#22411;&#65292;&#33267;&#23569;&#35748;&#20026;&#20320;&#26159;&#19968;&#20010;&#23383;&#33410;&#30340;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">index = b &gt;&gt; i &amp; 0x3F #&#26080;&#29992;&#21151; 18
</span>        <span style="color: #a0522d;">index</span> = b &gt;&gt; i <span style="color: #a020f0;">if</span> <span style="color: #a0522d;">i</span> = 18 <span style="color: #a020f0;">else</span> b &gt;&gt; i &amp; 0x3F <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22788;&#29702;&#26080;&#29992;&#21151;&#38382;&#39064;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">index  base64 &#20013;&#20351;&#29992;index&#25214;&#21040;&#23383;&#31526;
</span>        <span style="color: #483d8b;">print</span>(alphabet[index]) <span style="color: #b22222;">#</span><span style="color: #b22222;">: Y &#22788;&#29702;&#30340;&#31532;&#19968;&#20010;&#25968;&#23383;&#20986;&#26469;&#20102;&#12290;
</span>
<span style="color: #483d8b;">print</span>(b64encode(<span style="color: #8b2252;">'abc'</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: b'abc'
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: Y
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: W
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: J
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: j
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: None</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> base64

<span style="color: #a0522d;">alphabet</span> = b<span style="color: #8b2252;">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">print(8 &gt;&gt; 1, 0b1000 &gt;&gt; 1) #0b0100
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(8 &gt;&gt; 2, 0b1000 &gt;&gt; 2) #0b10
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(0b1000000000 &gt;&gt; 5)
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 4 4
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 2 2
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 16
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">b64encode</span>(src:<span style="color: #483d8b;">str</span>, encoding=<span style="color: #8b2252;">'utf-8'</span>) -&gt;<span style="color: #483d8b;">bytes</span>:
    <span style="color: #b22222;">#</span><span style="color: #b22222;">3&#23383;&#33410;&#26029;&#24320;&#65292;4 * 6 -&gt; 4 * 8 bits&#21069;&#38754;&#34917;&#38646;&#65292;&#31227;&#20301;&#35745;&#31639;&#27491;&#22909;&#65292;&#31616;&#21333;&#25928;&#29575;&#39640;
</span>    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(src, <span style="color: #483d8b;">str</span>):
        <span style="color: #a0522d;">_src</span> = src.encode(encoding=encoding)
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">None</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25925;&#24847;&#36820;&#22238;None&#23601;&#26159;&#21578;&#35785;&#20320;&#65292;&#25105;&#19981;&#36820;&#22238;bytes&#31867;&#22411;&#25968;&#25454;b''
</span>
    <span style="color: #a0522d;">ret</span> = <span style="color: #483d8b;">bytearray</span>() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30446;&#26631;
</span>    <span style="color: #483d8b;">print</span>(_src) <span style="color: #b22222;">#</span><span style="color: #b22222;">: b'abc' 0x61 62 63 b'\x616263' bytes&#31867;&#22411;&#19981;&#25903;&#25345;&#31227;&#20301;&#65292;&#25972;&#25968;&#25903;&#25345;&#12290;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25972;&#25968;&#25903;&#25345; &gt;&gt;
</span>    <span style="color: #a0522d;">b</span> = <span style="color: #483d8b;">int</span>.from_bytes(_src, <span style="color: #8b2252;">'big'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">bytes&#36716;int
</span>
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(18, -1, -6):
        <span style="color: #b22222;">#</span><span style="color: #b22222;">print(b, hex(b), b &gt;&gt; 18) #24 - 18 = 6 # &#36820;&#22238;int&#31867;&#22411;&#65292;&#33267;&#23569;&#35748;&#20026;&#20320;&#26159;&#19968;&#20010;&#23383;&#33410;&#30340;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">index = b &gt;&gt; i &amp; 0x3F #&#26080;&#29992;&#21151; 18
</span>        <span style="color: #a0522d;">index</span> = b &gt;&gt; i <span style="color: #a020f0;">if</span> i == 18 <span style="color: #a020f0;">else</span> b &gt;&gt; i &amp; 0x3F <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22788;&#29702;&#26080;&#29992;&#21151;&#38382;&#39064;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">index  base64 &#20013;&#20351;&#29992;index&#25214;&#21040;&#23383;&#31526;
</span>        <span style="color: #483d8b;">print</span>(alphabet[index]) <span style="color: #b22222;">#</span><span style="color: #b22222;">: Y &#22788;&#29702;&#30340;&#31532;&#19968;&#20010;&#23383;&#31526;&#20986;&#26469;&#20102;&#12290;bytes&#30340;&#32034;&#24341;&#36820;&#22238;&#25972;&#25968;&#12290;&#36820;&#22238;&#23383;&#31526;&#23545;&#24212;&#30340;&#25972;&#25968;&#20986;&#26469;
</span>        ret.append(alphabet[index]) <span style="color: #b22222;">#</span><span style="color: #b22222;">ret.append()&#36861;&#21152;&#30340;&#26159;&#23383;&#33410;&#65292;&#19981;&#26159;&#23383;&#31526;&#20018;&#65292;&#38656;&#35201;&#25226;alphabet&#21464;&#37327;&#25442;&#25104;bytes&#31867;&#22411;&#65292;bytes&#30340;&#32034;&#24341;&#36820;&#22238;&#25972;&#25968;
</span>    <span style="color: #a020f0;">return</span> ret

<span style="color: #483d8b;">print</span>(b64encode(<span style="color: #8b2252;">'abc'</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: b'abc'
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 89
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 87
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 74
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 106
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: bytearray(b'YWJj')</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> base64

<span style="color: #a0522d;">alphabet</span> = b<span style="color: #8b2252;">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">print(8 &gt;&gt; 1, 0b1000 &gt;&gt; 1) #0b0100
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(8 &gt;&gt; 2, 0b1000 &gt;&gt; 2) #0b10
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(0b1000000000 &gt;&gt; 5)
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 4 4
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 2 2
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 16
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">b64encode</span>(src, encoding=<span style="color: #8b2252;">'utf-8'</span>) -&gt;<span style="color: #483d8b;">bytes</span>:
    <span style="color: #b22222;">#</span><span style="color: #b22222;">3&#23383;&#33410;&#26029;&#24320;&#65292;4 * 6 -&gt; 4 * 8 bits&#21069;&#38754;&#34917;&#38646;&#65292;&#31227;&#20301;&#35745;&#31639;&#27491;&#22909;&#65292;&#31616;&#21333;&#25928;&#29575;&#39640;
</span>    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(src, <span style="color: #483d8b;">str</span>):
        <span style="color: #a0522d;">_src</span> = src.encode(encoding=encoding)
    <span style="color: #a020f0;">elif</span> <span style="color: #483d8b;">isinstance</span>(src, (<span style="color: #483d8b;">bytes</span>, <span style="color: #483d8b;">bytearray</span>)):
        <span style="color: #a0522d;">_src</span> = <span style="color: #483d8b;">bytes</span>(src)
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">None</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25925;&#24847;&#36820;&#22238;None&#23601;&#26159;&#21578;&#35785;&#20320;&#65292;&#25105;&#19981;&#36820;&#22238;bytes&#31867;&#22411;&#25968;&#25454;b''
</span>
    <span style="color: #a0522d;">ret</span> = <span style="color: #483d8b;">bytearray</span>() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30446;&#26631;
</span>    <span style="color: #483d8b;">print</span>(_src) <span style="color: #b22222;">#</span><span style="color: #b22222;">: b'abc' 0x61 62 63 b'\x616263' bytes&#31867;&#22411;&#19981;&#25903;&#25345;&#31227;&#20301;&#65292;&#25972;&#25968;&#25903;&#25345;&#12290;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25972;&#25968;&#25903;&#25345; &gt;&gt;
</span>    <span style="color: #a0522d;">b</span> = <span style="color: #483d8b;">int</span>.from_bytes(_src, <span style="color: #8b2252;">'big'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">bytes&#36716;int
</span>
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(18, -1, -6):
        <span style="color: #b22222;">#</span><span style="color: #b22222;">print(b, hex(b), b &gt;&gt; 18) #24 - 18 = 6 # &#36820;&#22238;int&#31867;&#22411;&#65292;&#33267;&#23569;&#35748;&#20026;&#20320;&#26159;&#19968;&#20010;&#23383;&#33410;&#30340;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">index = b &gt;&gt; i &amp; 0x3F #&#26080;&#29992;&#21151; 18
</span>        <span style="color: #a0522d;">index</span> = b &gt;&gt; i <span style="color: #a020f0;">if</span> i == 18 <span style="color: #a020f0;">else</span> b &gt;&gt; i &amp; 0x3F <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22788;&#29702;&#26080;&#29992;&#21151;&#38382;&#39064;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">index  base64 &#20013;&#20351;&#29992;index&#25214;&#21040;&#23383;&#31526;
</span>        <span style="color: #483d8b;">print</span>(alphabet[index]) <span style="color: #b22222;">#</span><span style="color: #b22222;">: Y &#22788;&#29702;&#30340;&#31532;&#19968;&#20010;&#23383;&#31526;&#20986;&#26469;&#20102;&#12290;bytes&#30340;&#32034;&#24341;&#36820;&#22238;&#25972;&#25968;&#12290;&#36820;&#22238;&#23383;&#31526;&#23545;&#24212;&#30340;&#25972;&#25968;&#20986;&#26469;
</span>        ret.append(alphabet[index]) <span style="color: #b22222;">#</span><span style="color: #b22222;">ret.append()&#36861;&#21152;&#30340;&#26159;&#23383;&#33410;&#65292;&#19981;&#26159;&#23383;&#31526;&#20018;&#65292;&#38656;&#35201;&#25226;alphabet&#21464;&#37327;&#25442;&#25104;bytes&#31867;&#22411;&#65292;bytes&#30340;&#32034;&#24341;&#36820;&#22238;&#25972;&#25968;
</span>    <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">bytes</span>(ret) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;bytes&#31867;&#22411;
</span>
<span style="color: #483d8b;">print</span>(b64encode(<span style="color: #8b2252;">'abc'</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">: b'abc'
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 89
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 87
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 74
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 106
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: b'YWJj'</span>
</pre>
</div>

<p>
3个字节转base64正好每6位一组；2个字节转base64缺少的补0，全0用=等号表示；4个字节一样，余一个字节，缺少补0.
</p>



<figure id="org9524ec9">
<img src="./images/img_20240607_083706.png" alt="img_20240607_083706.png" width="50%">

</figure>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> base64
<span style="color: #a0522d;">s</span> = b<span style="color: #8b2252;">'abcd'</span>
<span style="color: #483d8b;">print</span>(base64.b64encode(s))
<span style="color: #483d8b;">print</span>()

<span style="color: #a0522d;">alphabet</span> = b<span style="color: #8b2252;">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">print(8 &gt;&gt; 1, 0b1000 &gt;&gt; 1) #0b0100
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(8 &gt;&gt; 2, 0b1000 &gt;&gt; 2) #0b10
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(0b1000000000 &gt;&gt; 5)
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 4 4
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 2 2
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 16
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">b'abcd'
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">b64encode</span>(src, encoding=<span style="color: #8b2252;">'utf-8'</span>) -&gt;<span style="color: #483d8b;">bytes</span>:
    <span style="color: #b22222;">#</span><span style="color: #b22222;">3&#23383;&#33410;&#26029;&#24320;&#65292;4 * 6 -&gt; 4 * 8 bits&#21069;&#38754;&#34917;&#38646;&#65292;&#31227;&#20301;&#35745;&#31639;&#27491;&#22909;&#65292;&#31616;&#21333;&#25928;&#29575;&#39640;
</span>    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(src, <span style="color: #483d8b;">str</span>):
        <span style="color: #a0522d;">_src</span> = src.encode(encoding=encoding)
    <span style="color: #a020f0;">elif</span> <span style="color: #483d8b;">isinstance</span>(src, (<span style="color: #483d8b;">bytes</span>, <span style="color: #483d8b;">bytearray</span>)):
        <span style="color: #a0522d;">_src</span> = <span style="color: #483d8b;">bytes</span>(src)
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">None</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25925;&#24847;&#36820;&#22238;None&#23601;&#26159;&#21578;&#35785;&#20320;&#65292;&#25105;&#19981;&#36820;&#22238;bytes&#31867;&#22411;&#25968;&#25454;b''
</span>
    <span style="color: #a0522d;">ret</span> = <span style="color: #483d8b;">bytearray</span>() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30446;&#26631;
</span>    <span style="color: #a0522d;">length</span> = <span style="color: #483d8b;">len</span>(_src) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23383;&#31526;&#20018;&#38271;&#24230;
</span>
    <span style="color: #a020f0;">for</span> offset <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(0, length, 3):
        <span style="color: #b22222;">#</span><span style="color: #b22222;">print(_src[offset:offset+3])
</span>        <span style="color: #a0522d;">triple</span> = _src[offset:offset+3]

        <span style="color: #483d8b;">print</span>(triple, <span style="color: #483d8b;">len</span>(triple)) <span style="color: #b22222;">#</span><span style="color: #b22222;">: b'abc' 0x61 62 63 b'\x616263' bytes&#31867;&#22411;&#19981;&#25903;&#25345;&#31227;&#20301;&#65292;&#25972;&#25968;&#25903;&#25345;&#12290;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#19981;&#28385;&#36275;3&#20010;&#23383;&#31526;&#65292;&#34917;0&#20195;&#26367;
</span>        <span style="color: #a0522d;">r</span> = 3 - <span style="color: #483d8b;">len</span>(triple)
        <span style="color: #a020f0;">if</span> r:
            <span style="color: #a0522d;">triple</span> += b<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\x00</span><span style="color: #8b2252;">'</span> * r  <span style="color: #b22222;">#</span><span style="color: #b22222;">null &#23383;&#31526;&#29992;ascii&#30721;&#34920;&#31034;\x00
</span>        <span style="color: #483d8b;">print</span>(triple, <span style="color: #483d8b;">len</span>(triple))

        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25972;&#25968;&#25903;&#25345; &gt;&gt;
</span>        <span style="color: #a0522d;">b</span> = <span style="color: #483d8b;">int</span>.from_bytes(triple, <span style="color: #8b2252;">'big'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">bytes&#36716;int
</span>
        <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(18, -1, -6):
            <span style="color: #b22222;">#</span><span style="color: #b22222;">print(b, hex(b), b &gt;&gt; 18) #24 - 18 = 6 # &#36820;&#22238;int&#31867;&#22411;&#65292;&#33267;&#23569;&#35748;&#20026;&#20320;&#26159;&#19968;&#20010;&#23383;&#33410;&#30340;
</span>            <span style="color: #b22222;">#</span><span style="color: #b22222;">index = b &gt;&gt; i &amp; 0x3F #&#26080;&#29992;&#21151; 18
</span>            <span style="color: #a0522d;">index</span> = b &gt;&gt; i <span style="color: #a020f0;">if</span> i == 18 <span style="color: #a020f0;">else</span> b &gt;&gt; i &amp; 0x3F <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22788;&#29702;&#26080;&#29992;&#21151;&#38382;&#39064;
</span>            <span style="color: #483d8b;">print</span>(index)
            <span style="color: #b22222;"># </span><span style="color: #b22222;">index  base64 &#20013;&#20351;&#29992;index&#25214;&#21040;&#23383;&#31526;
</span>            ret.append(alphabet[index]) <span style="color: #b22222;">#</span><span style="color: #b22222;">ret.append()&#36861;&#21152;&#30340;&#26159;&#23383;&#33410;&#65292;&#19981;&#26159;&#23383;&#31526;&#20018;&#65292;&#38656;&#35201;&#25226;alphabet&#21464;&#37327;&#25442;&#25104;bytes&#31867;&#22411;&#65292;bytes&#30340;&#32034;&#24341;&#36820;&#22238;&#25972;&#25968;
</span>            <span style="color: #483d8b;">print</span>(ret)
        <span style="color: #a020f0;">if</span> r:
            <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(r):   <span style="color: #b22222;">#</span><span style="color: #b22222;">range(2) 0, 1 -1, -2
</span>                <span style="color: #a0522d;">ret</span>[-i-1] = 0x3D  <span style="color: #b22222;"># </span><span style="color: #b22222;">= &#31561;&#21495;&#30340;ascii&#30721;0x3d
</span>
    <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">bytes</span>(ret) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;bytes&#31867;&#22411;
</span>
<span style="color: #483d8b;">print</span>(b64encode(s))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#24456;&#22810;base64&#32534;&#36807;&#30721;&#30340;&#23383;&#31526;&#20018;&#65292;&#21487;&#20197;&#30475;&#21040;&#27809;&#26377;=&#65292;&#20026;&#20160;&#20040;&#65311; &#22240;&#20026;&#26377;&#30340;&#21435;&#25481;&#20102;&#12290;</span>
</pre>
</div>

<pre class="example" id="org64763e0">
b'YWJjZA=='

b'abc' 3
b'abc' 3
24
bytearray(b'Y')
22
bytearray(b'YW')
9
bytearray(b'YWJ')
35
bytearray(b'YWJj')
b'd' 1
b'd\x00\x00' 3
25
bytearray(b'YWJjZ')
0
bytearray(b'YWJjZA')
0
bytearray(b'YWJjZAA')
0
bytearray(b'YWJjZAAA')
b'YWJjZA=='
</pre>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> base64
<span style="color: #a0522d;">s</span> = b<span style="color: #8b2252;">'abcd'</span>
<span style="color: #483d8b;">print</span>(base64.b64encode(s))
<span style="color: #483d8b;">print</span>()

<span style="color: #a0522d;">alphabet</span> = b<span style="color: #8b2252;">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">print(8 &gt;&gt; 1, 0b1000 &gt;&gt; 1) #0b0100
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(8 &gt;&gt; 2, 0b1000 &gt;&gt; 2) #0b10
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(0b1000000000 &gt;&gt; 5)
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 4 4
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 2 2
</span><span style="color: #b22222;">##</span><span style="color: #b22222;">: 16
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">b'abcd'
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">b64encode</span>(src, encoding=<span style="color: #8b2252;">'utf-8'</span>) -&gt;<span style="color: #483d8b;">bytes</span>:
    <span style="color: #b22222;">#</span><span style="color: #b22222;">3&#23383;&#33410;&#26029;&#24320;&#65292;4 * 6 -&gt; 4 * 8 bits&#21069;&#38754;&#34917;&#38646;&#65292;&#31227;&#20301;&#35745;&#31639;&#27491;&#22909;&#65292;&#31616;&#21333;&#25928;&#29575;&#39640;
</span>    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(src, <span style="color: #483d8b;">str</span>):
        <span style="color: #a0522d;">_src</span> = src.encode(encoding=encoding)
    <span style="color: #a020f0;">elif</span> <span style="color: #483d8b;">isinstance</span>(src, (<span style="color: #483d8b;">bytes</span>, <span style="color: #483d8b;">bytearray</span>)):
        <span style="color: #a0522d;">_src</span> = <span style="color: #483d8b;">bytes</span>(src)
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">None</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25925;&#24847;&#36820;&#22238;None&#23601;&#26159;&#21578;&#35785;&#20320;&#65292;&#25105;&#19981;&#36820;&#22238;bytes&#31867;&#22411;&#25968;&#25454;b''
</span>
    <span style="color: #a0522d;">ret</span> = <span style="color: #483d8b;">bytearray</span>() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30446;&#26631;
</span>    <span style="color: #a0522d;">length</span> = <span style="color: #483d8b;">len</span>(src) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23383;&#31526;&#20018;&#38271;&#24230;
</span>
    <span style="color: #a020f0;">for</span> offset <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(0, length, 3):
        <span style="color: #b22222;">#</span><span style="color: #b22222;">print(_src[offset:offset+3])
</span>        <span style="color: #a0522d;">triple</span> = _src[offset:offset+3]

        <span style="color: #483d8b;">print</span>(triple, <span style="color: #483d8b;">len</span>(triple)) <span style="color: #b22222;">#</span><span style="color: #b22222;">: b'abc' 0x61 62 63 b'\x616263' bytes&#31867;&#22411;&#19981;&#25903;&#25345;&#31227;&#20301;&#65292;&#25972;&#25968;&#25903;&#25345;&#12290;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#19981;&#28385;&#36275;3&#20010;&#23383;&#31526;&#65292;&#34917;0&#20195;&#26367;
</span>        <span style="color: #a0522d;">r</span> = 3 - <span style="color: #483d8b;">len</span>(triple)
        <span style="color: #a020f0;">if</span> r:
            <span style="color: #a0522d;">triple</span> += b<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\x00</span><span style="color: #8b2252;">'</span> * r  <span style="color: #b22222;">#</span><span style="color: #b22222;">null &#23383;&#31526;&#29992;ascii&#30721;&#34920;&#31034;\x00
</span>        <span style="color: #483d8b;">print</span>(triple, <span style="color: #483d8b;">len</span>(triple))

        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25972;&#25968;&#25903;&#25345; &gt;&gt;
</span>        <span style="color: #a0522d;">b</span> = <span style="color: #483d8b;">int</span>.from_bytes(triple, <span style="color: #8b2252;">'big'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">bytes&#36716;int
</span>
        <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(18, -1, -6):
            <span style="color: #b22222;">#</span><span style="color: #b22222;">print(b, hex(b), b &gt;&gt; 18) #24 - 18 = 6 # &#36820;&#22238;int&#31867;&#22411;&#65292;&#33267;&#23569;&#35748;&#20026;&#20320;&#26159;&#19968;&#20010;&#23383;&#33410;&#30340;
</span>            <span style="color: #b22222;">#</span><span style="color: #b22222;">index = b &gt;&gt; i &amp; 0x3F #&#26080;&#29992;&#21151; 18
</span>            <span style="color: #a0522d;">index</span> = b &gt;&gt; i <span style="color: #a020f0;">if</span> i == 18 <span style="color: #a020f0;">else</span> b &gt;&gt; i &amp; 0x3F <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22788;&#29702;&#26080;&#29992;&#21151;&#38382;&#39064;
</span>            <span style="color: #483d8b;">print</span>(index)
            <span style="color: #b22222;"># </span><span style="color: #b22222;">index  base64 &#20013;&#20351;&#29992;index&#25214;&#21040;&#23383;&#31526;
</span>            ret.append(alphabet[index]) <span style="color: #b22222;">#</span><span style="color: #b22222;">ret.append()&#36861;&#21152;&#30340;&#26159;&#23383;&#33410;&#65292;&#19981;&#26159;&#23383;&#31526;&#20018;&#65292;&#38656;&#35201;&#25226;alphabet&#21464;&#37327;&#25442;&#25104;bytes&#31867;&#22411;&#65292;bytes&#30340;&#32034;&#24341;&#36820;&#22238;&#25972;&#25968;
</span>            <span style="color: #483d8b;">print</span>(ret)
        <span style="color: #a020f0;">if</span> r:
            <span style="color: #b22222;"># </span><span style="color: #b22222;">for i in range(r):   #range(2) 0, 1 -1, -2
</span>            <span style="color: #b22222;">#     </span><span style="color: #b22222;">ret[-i-1] = 0x3D  # = &#31561;&#21495;&#30340;ascii&#30721;0x3d
</span>            <span style="color: #a0522d;">ret</span>[-r:] = b<span style="color: #8b2252;">'='</span> * r    <span style="color: #b22222;">#</span><span style="color: #b22222;">b'YWJjZA=='
</span>            <span style="color: #b22222;">#</span><span style="color: #b22222;">ret = ret[:-r]  #  b'YWJjZA'               
</span>    <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">bytes</span>(ret) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;bytes&#31867;&#22411;
</span>
<span style="color: #483d8b;">print</span>(b64encode(s))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#24456;&#22810;base64&#32534;&#36807;&#30721;&#30340;&#23383;&#31526;&#20018;&#65292;&#21487;&#20197;&#30475;&#21040;&#27809;&#26377;=&#65292;&#20026;&#20160;&#20040;&#65311; &#22240;&#20026;&#26377;&#30340;&#21435;&#25481;&#20102;&#12290;</span>
</pre>
</div>

<pre class="example" id="org4063f23">
b'YWJjZA=='

b'abc' 3
b'abc' 3
24
bytearray(b'Y')
22
bytearray(b'YW')
9
bytearray(b'YWJ')
35
bytearray(b'YWJj')
b'd' 1
b'd\x00\x00' 3
25
bytearray(b'YWJjZ')
0
bytearray(b'YWJjZA')
0
bytearray(b'YWJjZAA')
0
bytearray(b'YWJjZAAA')
b'YWJjZA=='
</pre>


<p>
最终
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> base64

<span style="color: #a0522d;">alphabet</span> = b<span style="color: #8b2252;">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">b'abcd'
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">b64encode</span>(src, encoding=<span style="color: #8b2252;">'utf-8'</span>) -&gt;<span style="color: #483d8b;">bytes</span>:
    <span style="color: #b22222;">#</span><span style="color: #b22222;">3&#23383;&#33410;&#26029;&#24320;&#65292;4 * 6 -&gt; 4 * 8 bits&#21069;&#38754;&#34917;&#38646;&#65292;&#31227;&#20301;&#35745;&#31639;&#27491;&#22909;&#65292;&#31616;&#21333;&#25928;&#29575;&#39640;
</span>    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(src, <span style="color: #483d8b;">str</span>):
        <span style="color: #a0522d;">_src</span> = src.encode(encoding=encoding)
    <span style="color: #a020f0;">elif</span> <span style="color: #483d8b;">isinstance</span>(src, (<span style="color: #483d8b;">bytes</span>, <span style="color: #483d8b;">bytearray</span>)):
        <span style="color: #a0522d;">_src</span> = <span style="color: #483d8b;">bytes</span>(src)
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">None</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25925;&#24847;&#36820;&#22238;None&#23601;&#26159;&#21578;&#35785;&#20320;&#65292;&#25105;&#19981;&#36820;&#22238;bytes&#31867;&#22411;&#25968;&#25454;b''
</span>
    <span style="color: #a0522d;">ret</span> = <span style="color: #483d8b;">bytearray</span>() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30446;&#26631;
</span>    <span style="color: #a0522d;">length</span> = <span style="color: #483d8b;">len</span>(_src) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23383;&#31526;&#20018;&#38271;&#24230;
</span>
    <span style="color: #a020f0;">for</span> offset <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(0, length, 3):
        <span style="color: #a0522d;">triple</span> = _src[offset:offset+3]

        <span style="color: #a0522d;">r</span> = 3 - <span style="color: #483d8b;">len</span>(triple)
        <span style="color: #a020f0;">if</span> r:
            <span style="color: #a0522d;">triple</span> += b<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\x00</span><span style="color: #8b2252;">'</span> * r  <span style="color: #b22222;">#</span><span style="color: #b22222;">null &#23383;&#31526;&#29992;ascii&#30721;&#34920;&#31034;\x00
</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25972;&#25968;&#25903;&#25345; &gt;&gt;
</span>        <span style="color: #a0522d;">b</span> = <span style="color: #483d8b;">int</span>.from_bytes(triple, <span style="color: #8b2252;">'big'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">bytes&#36716;int
</span>        <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(18, -1, -6):
            <span style="color: #a0522d;">index</span> = b &gt;&gt; i <span style="color: #a020f0;">if</span> i == 18 <span style="color: #a020f0;">else</span> b &gt;&gt; i &amp; 0x3F 
            ret.append(alphabet[index]) 
        <span style="color: #a020f0;">if</span> r:
            <span style="color: #a0522d;">ret</span>[-r:] = b<span style="color: #8b2252;">'='</span> * r    <span style="color: #b22222;">#</span><span style="color: #b22222;">b'YWJjZA=='
</span>            <span style="color: #b22222;">#</span><span style="color: #b22222;">ret = ret[:-r]  #  b'YWJjZA'               
</span>    <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">bytes</span>(ret) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;bytes&#31867;&#22411;
</span>
<span style="color: #a020f0;">for</span> s <span style="color: #a020f0;">in</span> [<span style="color: #8b2252;">'a'</span>, <span style="color: #8b2252;">'`'</span>, <span style="color: #8b2252;">'ab'</span>, <span style="color: #8b2252;">'abc'</span>, <span style="color: #8b2252;">''</span>, <span style="color: #8b2252;">'&#21704;&#21834;c'</span>, <span style="color: #8b2252;">'aa'</span>]:
    <span style="color: #483d8b;">print</span>(base64.b64encode(s.encode()))
    <span style="color: #483d8b;">print</span>(base64.urlsafe_b64encode(s.encode()))  <span style="color: #b22222;">#</span><span style="color: #b22222;">url&#23383;&#31526;&#20013;&#65292;&#29992;-&#20943;&#21495;&#26367;&#20195;+&#21152;&#21495;&#65292;&#29992;_&#19979;&#21010;&#32447;&#26367;&#20195;/&#26012;&#26464;
</span>    <span style="color: #483d8b;">print</span>(b64encode(s))
    <span style="color: #483d8b;">print</span>()
</pre>
</div>

<pre class="example" id="org191458a">
b'YQ=='
b'YQ=='
b'YQ=='

b'YA=='
b'YA=='
b'YA=='

b'YWI='
b'YWI='
b'YWI='

b'YWJj'
b'YWJj'
b'YWJj'

b''
b''
b''

b'5ZOI5ZWKYw=='
b'5ZOI5ZWKYw=='
b'5ZOI5ZWKYw=='

b'YWE='
b'YWE='
b'YWE='

</pre>
</div>
</div>
<div id="outline-container-h:c95638fb-42e0-4b10-99bc-1cc888ba58ca" class="outline-5">
<h5 id="h:c95638fb-42e0-4b10-99bc-1cc888ba58ca">实现一个cache装饰器，实现可过期被清除的功能</h5>
<div class="outline-text-5" id="text-h:c95638fb-42e0-4b10-99bc-1cc888ba58ca">
<p>
简化设计，函数的形参定义不包含可变位置参数、可变关键词参数和keyword-only参数，可以不考虑缓存大小，也不用考虑缓存满了之后的换出问题。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#36827;&#38454;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5):
    time.sleep(3)
    <span style="color: #a020f0;">return</span> x + y

&#20197;&#19979;6&#31181;&#65292;&#21487;&#20197;&#35748;&#20026;&#26159;&#21516;&#19968;&#31181;&#35843;&#29992;
<span style="color: #483d8b;">print</span>(1, add(4,5))
<span style="color: #483d8b;">print</span>(2, add(4))
<span style="color: #483d8b;">print</span>(3, add(y=5))
<span style="color: #483d8b;">print</span>(4, add(x=4, y=5))
<span style="color: #483d8b;">print</span>(5, add(y=5, x=4))
<span style="color: #483d8b;">print</span>(6, add( ))
</pre>
</div>

<p>
缓存应用场景
</p>
<pre class="example" id="orge2f130d">
1. 同样的函数参数一定得到同样的结果，至少是一段时间内，同样输入得到同样的结果
2. 计算代价高，函数执行时间长
3. 需要多次执行，每一次执行代价高

Cache广泛的应用在企业级应用，地位极其重要。使用缓存可以提高查询速度，用内存空间换查询、加载数据的时间。
</pre>

<p>
数据结构选择
</p>
<pre class="example" id="org9e0c51d">
输入一致，输出一致。

基于上面分析，此数据结构应用是字典。
通过一个key，对应一个value
key是参数列表组成的结构，value是函数返回值

本次的难点在于key如何处理
</pre>

<p>
Key的存储
</p>
<pre class="example" id="orgc330303">
数据结构选取字典，那么在python中key必须是hashable。

key能适应位置传参和关键字传参提供的实参。
- 位置传参本身就是有顺序的
- 关键字传参可以无序，可以考虑使用字典收集。无序如何解决？
- OrderedDict可以吗？可以，它记录key的录入顺序
- 不用OrderedDict可以吗？可以，对字典kv对按照key排序
</pre>

<p>
key的异同
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#36827;&#38454;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5):
    time.sleep(3)
    <span style="color: #a020f0;">return</span> x + y

&#20197;&#19979;6&#31181;&#65292;&#21487;&#20197;&#35748;&#20026;&#26159;&#21516;&#19968;&#31181;&#35843;&#29992;
<span style="color: #483d8b;">print</span>(1, add(4,5))
<span style="color: #483d8b;">print</span>(2, add(4))
<span style="color: #483d8b;">print</span>(3, add(y=5))
<span style="color: #483d8b;">print</span>(4, add(x=4, y=5))
<span style="color: #483d8b;">print</span>(5, add(y=5, x=4))
<span style="color: #483d8b;">print</span>(6, add( ))
</pre>
</div>

<pre class="example" id="org4b7a665">
可以认为
- 以上都不同。因为参数传输方式不同，或参数顺序不同，或不传实参而使用缺省值
- 1、4、5参数相同，因为实参相同，只是传参方式不同、参数顺序不同；2、3、6都不同，因为传参不一样
- 以上都相同。本质上最后使用的值都是x=4, y=5

lru_cache对以上6种都认为不相同。源码中，单独处理了位置传参和关键字传参。

如何实现以上6种都一样呢？

由于使用了缺省值，所以考虑使用inspect模块。
</pre>


<p>
key的要求
</p>

<pre class="example" id="orgc8fe190">
key就必须是hashable。

由于key是实参或缺省值凑在一起的，所以必须不包含不可hash类型数据。lru_cache无法实现，我们
也无法实现。所以，对于实参中有不可hash类型数据的，不可以实现缓存
</pre>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> functools
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add1</span>(x, y):
    <span style="color: #a020f0;">return</span> y

<span style="color: #483d8b;">print</span>(add1([], 5))  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;5
</span>
<span style="color: #228b22;">@functools.lru_cache</span>()
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y=5):
    time.sleep(3)
    <span style="color: #a020f0;">return</span> y

<span style="color: #483d8b;">print</span>(add(4))  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;5
</span>
add([], 5)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25253;&#38169;&#65292;key&#26159;&#19981;&#21487;hash&#30340;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: TypeError: unhashable type: 'list'</span>
</pre>
</div>



<p>
key算法设计
</p>

<pre class="example" id="org59c6bf5">
inspect模块获取函数签名后，取parameters，这是一个有序字典，会保存所有参数的信息。

构建一个字典target，按照位置顺序从args中依次对应参数名和传入的实参，组成kv对，
存入target字典中。

kwargs所有值update到target字典中

使用缺省值，需要从签名中提取。
</pre>


<p>
调用方式
</p>

<pre class="example" id="org06d9542">
普通的函数调用可以，但是过于明显，最好类似lru_cache的方式，让调用者无察觉的使用缓存。
构建装饰器函数。
代码模板如下：
</pre>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps

<span style="color: #b22222;">#</span><span style="color: #b22222;">cache = {} #&#20840;&#23616;&#21464;&#37327;&#65292;&#21487;&#20197;&#65292;&#20294;&#26159;&#19981;&#22909;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">my_cache</span>(fn):
    <span style="color: #a0522d;">local_cache</span> = {}  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#35013;&#39280;&#19968;&#20010;&#20989;&#25968;&#65292;&#37117;&#26377;&#27492;&#20989;&#25968;&#30340;&#29420;&#31435;&#30340;cache
</span>    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">makekey &#22788;&#29702;key
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23383;&#20856;&#25918;&#21738;&#65311;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">cache = {} #&#20989;&#25968;&#35843;&#29992;&#26102;&#25165;&#20135;&#29983;&#30340;&#65292;&#19981;&#35201;&#25918;&#36825;
</span>        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)

        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@my_cache</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5):   <span style="color: #b22222;">#</span><span style="color: #b22222;">add = wrapper add = my_cache(add)
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
    time.sleep(3)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(1, add(4,5))
<span style="color: #483d8b;">print</span>(3, add(y=5))
<span style="color: #483d8b;">print</span>(4, add(x=4, y=5))
</pre>
</div>

<p>
目标
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5): 
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
    time.sleep(3)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(1, add(4,5))
<span style="color: #483d8b;">print</span>(2, add(4))
<span style="color: #483d8b;">print</span>(3, add(y=5))
<span style="color: #483d8b;">print</span>(4, add(x=4, y=5))
<span style="color: #483d8b;">print</span>(5, add(y=5, x=4))
<span style="color: #483d8b;">print</span>(6, add( ))
</pre>
</div>
</div>
<div id="outline-container-h:f30606a9-8906-4291-952f-45573f9f82d1" class="outline-6">
<h6 id="h:f30606a9-8906-4291-952f-45573f9f82d1">代码实现</h6>
<div class="outline-text-6" id="text-h:f30606a9-8906-4291-952f-45573f9f82d1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps

<span style="color: #b22222;">#</span><span style="color: #b22222;">cache = {} #&#20840;&#23616;&#21464;&#37327;&#65292;&#21487;&#20197;&#65292;&#20294;&#26159;&#19981;&#22909;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">my_cache</span>(fn):
    <span style="color: #a0522d;">local_cache</span> = {}  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#35013;&#39280;&#19968;&#20010;&#20989;&#25968;&#65292;&#37117;&#26377;&#27492;&#20989;&#25968;&#30340;&#29420;&#31435;&#30340;cache
</span>    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">makekey &#22788;&#29702;key
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23383;&#20856;&#25918;&#21738;&#65311;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">cache = {} #&#20989;&#25968;&#35843;&#29992;&#26102;&#25165;&#20135;&#29983;&#30340;&#65292;&#19981;&#35201;&#25918;&#36825;
</span>        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)

        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@my_cache</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5):   <span style="color: #b22222;">#</span><span style="color: #b22222;">add = wrapper add = my_cache(add)
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
    time.sleep(3)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(1, add(4,5))
<span style="color: #483d8b;">print</span>(3, add(y=5))
<span style="color: #483d8b;">print</span>(4, add(x=4, y=5))
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21442;&#25968;&#22788;&#29702;
</span>
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps
<span style="color: #a020f0;">import</span> inspect

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">my_cache</span>(fn):
    <span style="color: #a0522d;">local_cache</span> = {}  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#35013;&#39280;&#19968;&#20010;&#20989;&#25968;&#65292;&#37117;&#26377;&#27492;&#20989;&#25968;&#30340;&#29420;&#31435;&#30340;cache
</span>    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">makekey &#22788;&#29702;key
</span>        <span style="color: #a0522d;">sig</span> = inspect.signature(fn)
        <span style="color: #a0522d;">params</span> = sig.parameters  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#30340;OrderedDict
</span>        <span style="color: #483d8b;">print</span>(args, kwargs)

        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#20256;&#21442;&#65292;&#21464;&#37327;&#21517;&#30340;&#23545;&#24212;
</span>        <span style="color: #a0522d;">names</span>  = <span style="color: #483d8b;">list</span>(params.keys())
        <span style="color: #a020f0;">for</span> v <span style="color: #a020f0;">in</span> args:
            <span style="color: #483d8b;">print</span>(v)

        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)

        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@my_cache</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5):   <span style="color: #b22222;">#</span><span style="color: #b22222;">add = wrapper add = my_cache(add)
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
    time.sleep(3)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(1, add(4,5))
<span style="color: #b22222;">#</span><span style="color: #b22222;">print(3, add(y=5))
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(4, add(x=4, y=5))
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20986;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: (4, 5) {}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 4
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 5
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: ==============================
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 9</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21442;&#25968;&#22788;&#29702;- &#20301;&#32622;&#20256;&#21442; &#36319;&#21517;&#31216;&#23545;&#24212;
</span>
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps
<span style="color: #a020f0;">import</span> inspect

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">my_cache</span>(fn):
    <span style="color: #a0522d;">local_cache</span> = {}  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#35013;&#39280;&#19968;&#20010;&#20989;&#25968;&#65292;&#37117;&#26377;&#27492;&#20989;&#25968;&#30340;&#29420;&#31435;&#30340;cache
</span>    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">makekey &#22788;&#29702;key
</span>        <span style="color: #a0522d;">target</span> = {} <span style="color: #b22222;">#</span><span style="color: #b22222;">key &#23383;&#20856;&#26080;&#24207;
</span>

        <span style="color: #a0522d;">sig</span> = inspect.signature(fn)
        <span style="color: #a0522d;">params</span> = sig.parameters  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#30340;OrderedDict
</span>        <span style="color: #483d8b;">print</span>(args, kwargs)

        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#20256;&#21442;&#65292;&#21464;&#37327;&#21517;&#30340;&#23545;&#24212;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">names  = list(params.keys())
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">for i, v in enumerate(args):
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">print(i,v, names[i])
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">target[names[i]] = v
</span>        target.update(<span style="color: #483d8b;">zip</span>(params.keys(), args))
        <span style="color: #b22222;"># </span><span style="color: #b22222;">update(&#20108;&#20803;&#32452;&#30340;&#21487;&#36845;&#20195;&#23545;&#35937;&#65292;k1=v1, k2=v2) update(mapping, k1=v1, k2=v2)
</span>

        <span style="color: #483d8b;">print</span>(target)

        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)

        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@my_cache</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5):   <span style="color: #b22222;">#</span><span style="color: #b22222;">add = wrapper add = my_cache(add)
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
    time.sleep(3)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(1, add(4,5))
<span style="color: #b22222;">#</span><span style="color: #b22222;">print(3, add(y=5))
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(4, add(x=4, y=5))
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20986;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: (4, 5) {}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: {'x': 4, 'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: ==============================
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 9</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21442;&#25968;&#22788;&#29702;-&#20851;&#38190;&#23383;&#20256;&#21442;
</span>
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps
<span style="color: #a020f0;">import</span> inspect

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">my_cache</span>(fn):
    <span style="color: #a0522d;">local_cache</span> = {}  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#35013;&#39280;&#19968;&#20010;&#20989;&#25968;&#65292;&#37117;&#26377;&#27492;&#20989;&#25968;&#30340;&#29420;&#31435;&#30340;cache
</span>    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">makekey &#22788;&#29702;key
</span>        <span style="color: #a0522d;">target</span> = {} <span style="color: #b22222;">#</span><span style="color: #b22222;">key &#23383;&#20856;&#26080;&#24207;
</span>

        <span style="color: #a0522d;">sig</span> = inspect.signature(fn)
        <span style="color: #a0522d;">params</span> = sig.parameters  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#30340;OrderedDict
</span>        <span style="color: #483d8b;">print</span>(args, kwargs)

        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#20256;&#21442;&#65292;&#21464;&#37327;&#21517;&#30340;&#23545;&#24212;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">names  = list(params.keys())
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">for i, v in enumerate(args):
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">print(i,v, names[i])
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">target[names[i]] = v
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">target.update(zip(params.keys(), args))
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">update(&#20108;&#20803;&#32452;&#30340;&#21487;&#36845;&#20195;&#23545;&#35937;&#65292;k1=v1, k2=v2) update(mapping, k1=v1, k2=v2)
</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20851;&#38190;&#23383;&#20256;&#21442;&#65292;&#20081;&#24207;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">for k,v in kwargs.items():
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">target[k] = v
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">target.update(kwargs)
</span>        target.update(<span style="color: #483d8b;">zip</span>(params.keys(), args), **kwargs)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;target.update(zip(params.keys(), args)) &#21644; target.update(kwargs)&#21512;&#19968;&#36215;
</span>
        <span style="color: #483d8b;">print</span>(target)

        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)

        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@my_cache</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5):   <span style="color: #b22222;">#</span><span style="color: #b22222;">add = wrapper add = my_cache(add)
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
    time.sleep(1)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(1, add(4,5))
<span style="color: #483d8b;">print</span>(3, add(y=5))
<span style="color: #483d8b;">print</span>(4, add(x=4, y=5))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20986;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">(4, 5) {}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">{'x': 4, 'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">() {'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">{'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">3 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">() {'x': 4, 'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">{'x': 4, 'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">4 9</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21442;&#25968;&#22788;&#29702;-&#32570;&#30465;&#20540;
</span>
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps
<span style="color: #a020f0;">import</span> inspect

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">my_cache</span>(fn):
    <span style="color: #a0522d;">local_cache</span> = {}  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#35013;&#39280;&#19968;&#20010;&#20989;&#25968;&#65292;&#37117;&#26377;&#27492;&#20989;&#25968;&#30340;&#29420;&#31435;&#30340;cache
</span>    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">makekey &#22788;&#29702;key
</span>        <span style="color: #a0522d;">target</span> = {} <span style="color: #b22222;">#</span><span style="color: #b22222;">key &#23383;&#20856;&#26080;&#24207;
</span>

        <span style="color: #a0522d;">sig</span> = inspect.signature(fn)
        <span style="color: #a0522d;">params</span> = sig.parameters  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#30340;OrderedDict
</span>        <span style="color: #483d8b;">print</span>(args, kwargs)

        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#20256;&#21442;&#65292;&#21464;&#37327;&#21517;&#30340;&#23545;&#24212;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">names  = list(params.keys())
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">for i, v in enumerate(args):
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">print(i,v, names[i])
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">target[names[i]] = v
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">target.update(zip(params.keys(), args))
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">update(&#20108;&#20803;&#32452;&#30340;&#21487;&#36845;&#20195;&#23545;&#35937;&#65292;k1=v1, k2=v2) update(mapping, k1=v1, k2=v2)
</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20851;&#38190;&#23383;&#20256;&#21442;&#65292;&#20081;&#24207;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">for k,v in kwargs.items():
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">target[k] = v
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">target.update(kwargs)
</span>        target.update(<span style="color: #483d8b;">zip</span>(params.keys(), args), **kwargs)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;target.update(zip(params.keys(), args)) &#21644; target.update(kwargs)&#21512;&#19968;&#36215;
</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32570;&#30465;&#20540; add(y=5) add()
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">for k in (params.keys() - target.keys()):
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">target[k] = params[k].default
</span>        target.update(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> k:(k, params[k].default), params.keys() - target.keys()))

        <span style="color: #b22222;"># </span><span style="color: #b22222;">for k,v in params.items():
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">if k not in target.keys():
</span>        <span style="color: #b22222;">#         </span><span style="color: #b22222;">target[k] = v.default
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">target.update({k:v.default for k,v in params.items() if k not in target.keys()})
</span>
        <span style="color: #483d8b;">print</span>(target)

        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)

        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@my_cache</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5):   <span style="color: #b22222;">#</span><span style="color: #b22222;">add = wrapper add = my_cache(add)
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
    time.sleep(1)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(1, add(4,5))
<span style="color: #483d8b;">print</span>(3, add(y=5))
<span style="color: #483d8b;">print</span>(4, add(x=4, y=5))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20986;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">(4, 5) {}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">{'x': 4, 'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">() {'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">{'y': 5, 'x': 4}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">3 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">() {'x': 4, 'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">{'x': 4, 'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">4 9</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#25490;&#24207;
</span>
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps
<span style="color: #a020f0;">import</span> inspect

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">my_cache</span>(fn):
    <span style="color: #a0522d;">local_cache</span> = {}  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#35013;&#39280;&#19968;&#20010;&#20989;&#25968;&#65292;&#37117;&#26377;&#27492;&#20989;&#25968;&#30340;&#29420;&#31435;&#30340;cache
</span>    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">makekey &#22788;&#29702;key
</span>        <span style="color: #a0522d;">target</span> = {} <span style="color: #b22222;">#</span><span style="color: #b22222;">key &#23383;&#20856;&#26080;&#24207;
</span>

        <span style="color: #a0522d;">sig</span> = inspect.signature(fn)
        <span style="color: #a0522d;">params</span> = sig.parameters  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#30340;OrderedDict
</span>        <span style="color: #483d8b;">print</span>(args, kwargs)

        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#20256;&#21442;&#65292;&#21464;&#37327;&#21517;&#30340;&#23545;&#24212;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">names  = list(params.keys())
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">for i, v in enumerate(args):
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">print(i,v, names[i])
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">target[names[i]] = v
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">target.update(zip(params.keys(), args))
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">update(&#20108;&#20803;&#32452;&#30340;&#21487;&#36845;&#20195;&#23545;&#35937;&#65292;k1=v1, k2=v2) update(mapping, k1=v1, k2=v2)
</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20851;&#38190;&#23383;&#20256;&#21442;&#65292;&#20081;&#24207;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">for k,v in kwargs.items():
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">target[k] = v
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">target.update(kwargs)
</span>        target.update(<span style="color: #483d8b;">zip</span>(params.keys(), args), **kwargs)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;target.update(zip(params.keys(), args)) &#21644; target.update(kwargs)&#21512;&#19968;&#36215;
</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32570;&#30465;&#20540; add(y=5) add()
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">for k in (params.keys() - target.keys()):
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">target[k] = params[k].default
</span>        target.update(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> k:(k, params[k].default), params.keys() - target.keys()))

        <span style="color: #b22222;"># </span><span style="color: #b22222;">for k,v in params.items():
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">if k not in target.keys():
</span>        <span style="color: #b22222;">#         </span><span style="color: #b22222;">target[k] = v.default
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">target.update({k:v.default for k,v in params.items() if k not in target.keys()})
</span>
        <span style="color: #483d8b;">print</span>(target)

        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">sorted</span>(target.items()))

        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)

        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@my_cache</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5):   <span style="color: #b22222;">#</span><span style="color: #b22222;">add = wrapper add = my_cache(add)
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
    time.sleep(1)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(1, add(4,5))
<span style="color: #483d8b;">print</span>(3, add(y=5))
<span style="color: #483d8b;">print</span>(4, add(x=4, y=5))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20986;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">(4, 5) {}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">{'x': 4, 'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">[('x', 4), ('y', 5)]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">() {'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">{'y': 5, 'x': 4}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">[('x', 4), ('y', 5)]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">3 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">() {'x': 4, 'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">{'x': 4, 'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">[('x', 4), ('y', 5)]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">4 9</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21435;&#25481;&#22810;&#20313;&#27880;&#37322;
</span>
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps
<span style="color: #a020f0;">import</span> inspect

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">my_cache</span>(fn):
    <span style="color: #a0522d;">local_cache</span> = {}  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#35013;&#39280;&#19968;&#20010;&#20989;&#25968;&#65292;&#37117;&#26377;&#27492;&#20989;&#25968;&#30340;&#29420;&#31435;&#30340;cache
</span>    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">makekey &#22788;&#29702;key
</span>        <span style="color: #a0522d;">target</span> = {} <span style="color: #b22222;">#</span><span style="color: #b22222;">key &#23383;&#20856;&#26080;&#24207;
</span>
        <span style="color: #a0522d;">sig</span> = inspect.signature(fn)
        <span style="color: #a0522d;">params</span> = sig.parameters  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#30340;OrderedDict
</span>        <span style="color: #483d8b;">print</span>(args, kwargs)

        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#20256;&#21442; &#21644; &#20851;&#38190;&#23383;&#20256;&#21442;
</span>        target.update(<span style="color: #483d8b;">zip</span>(params.keys(), args), **kwargs)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;target.update(zip(params.keys(), args)) &#21644; target.update(kwargs)&#21512;&#19968;&#36215;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32570;&#30465;&#20540; add(y=5) add()
</span>        target.update(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> k:(k, params[k].default), params.keys() - target.keys()))

        <span style="color: #a0522d;">key</span> = <span style="color: #483d8b;">tuple</span>(<span style="color: #483d8b;">sorted</span>(target.items()))
        <span style="color: #483d8b;">print</span>(key)

        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)

        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@my_cache</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5):   <span style="color: #b22222;">#</span><span style="color: #b22222;">add = wrapper add = my_cache(add)
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
    time.sleep(1)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(1, add(4,5))
<span style="color: #483d8b;">print</span>(3, add(y=5))
<span style="color: #483d8b;">print</span>(4, add(x=4, y=5))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20986;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">(4, 5) {}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">(('x', 4), ('y', 5))
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">() {'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">(('x', 4), ('y', 5))
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">3 9
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">() {'x': 4, 'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">(('x', 4), ('y', 5))
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">4 9</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#20309;&#30693;&#36947;&#32531;&#23384;&#20102;
</span>
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps
<span style="color: #a020f0;">import</span> inspect

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">my_cache</span>(fn):
    <span style="color: #a0522d;">local_cache</span> = {}  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#35013;&#39280;&#19968;&#20010;&#20989;&#25968;&#65292;&#37117;&#26377;&#27492;&#20989;&#25968;&#30340;&#29420;&#31435;&#30340;cache
</span>    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">makekey &#22788;&#29702;key
</span>        <span style="color: #a0522d;">target</span> = {} <span style="color: #b22222;">#</span><span style="color: #b22222;">key &#23383;&#20856;&#26080;&#24207;
</span>
        <span style="color: #a0522d;">sig</span> = inspect.signature(fn)
        <span style="color: #a0522d;">params</span> = sig.parameters  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#30340;OrderedDict
</span>        <span style="color: #483d8b;">print</span>(args, kwargs)

        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#20256;&#21442; &#21644; &#20851;&#38190;&#23383;&#20256;&#21442;
</span>        target.update(<span style="color: #483d8b;">zip</span>(params.keys(), args), **kwargs)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;target.update(zip(params.keys(), args)) &#21644; target.update(kwargs)&#21512;&#19968;&#36215;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32570;&#30465;&#20540; add(y=5) add()
</span>        target.update(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> k:(k, params[k].default), params.keys() - target.keys()))

        <span style="color: #a0522d;">key</span> = <span style="color: #483d8b;">tuple</span>(<span style="color: #483d8b;">sorted</span>(target.items()))

        <span style="color: #a020f0;">if</span> key <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">in</span> local_cache.keys():
            <span style="color: #a0522d;">local_cache</span>[key] = fn(*args, **kwargs)

        <span style="color: #a020f0;">return</span> key, local_cache[key]
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@my_cache</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5):   <span style="color: #b22222;">#</span><span style="color: #b22222;">add = wrapper add = my_cache(add)
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
    time.sleep(3)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(1, add(4,5))
<span style="color: #483d8b;">print</span>(3, add(y=5))
<span style="color: #483d8b;">print</span>(4, add(x=4, y=5))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20986;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: (4, 5) {}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: ==============================
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 1 ((('x', 4), ('y', 5)), 9)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: () {'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 3 ((('x', 4), ('y', 5)), 9)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: () {'x': 4, 'y': 5}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: 4 ((('x', 4), ('y', 5)), 9)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:65774e9f-e0e4-4d45-874a-21ba6de5eb6d" class="outline-6">
<h6 id="h:65774e9f-e0e4-4d45-874a-21ba6de5eb6d">多个装饰器</h6>
<div class="outline-text-6" id="text-h:65774e9f-e0e4-4d45-874a-21ba6de5eb6d">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26102;&#38388;&#35745;&#31639;
</span>
<span style="color: #a020f0;">import</span> time, datetime
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps
<span style="color: #a020f0;">import</span> inspect

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #483d8b;">print</span>(1111)
        <span style="color: #a0522d;">start</span> = datetime.datetime.now()
        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
        <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
        <span style="color: #483d8b;">print</span>(fn.<span style="color: #483d8b;">__name__</span>, delta)
        <span style="color: #483d8b;">print</span>(4444)
        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">my_cache</span>(fn):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
    <span style="color: #a0522d;">local_cache</span> = {}  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#35013;&#39280;&#19968;&#20010;&#20989;&#25968;&#65292;&#37117;&#26377;&#27492;&#20989;&#25968;&#30340;&#29420;&#31435;&#30340;cache
</span>    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #483d8b;">print</span>(2222)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">makekey &#22788;&#29702;key
</span>        <span style="color: #a0522d;">target</span> = {} <span style="color: #b22222;">#</span><span style="color: #b22222;">key &#23383;&#20856;&#26080;&#24207;
</span>        <span style="color: #a0522d;">sig</span> = inspect.signature(fn)
        <span style="color: #a0522d;">params</span> = sig.parameters  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#30340;OrderedDict
</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#20256;&#21442; &#21644; &#20851;&#38190;&#23383;&#20256;&#21442;
</span>        target.update(<span style="color: #483d8b;">zip</span>(params.keys(), args), **kwargs)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;target.update(zip(params.keys(), args)) &#21644; target.update(kwargs)&#21512;&#19968;&#36215;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32570;&#30465;&#20540; add(y=5) add()
</span>        target.update(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> k:(k, params[k].default), params.keys() - target.keys()))
        <span style="color: #a0522d;">key</span> = <span style="color: #483d8b;">tuple</span>(<span style="color: #483d8b;">sorted</span>(target.items()))

        <span style="color: #a020f0;">if</span> key <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">in</span> local_cache.keys():
            <span style="color: #a0522d;">local_cache</span>[key] = fn(*args, **kwargs)

        <span style="color: #483d8b;">print</span>(3333)
        <span style="color: #a020f0;">return</span> key, local_cache[key]
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@logger</span>  <span style="color: #b22222;"># </span><span style="color: #b22222;">2 add = logger(add)
</span><span style="color: #228b22;">@my_cache</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">1 add = my_cache(add)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#26377;&#22810;&#20010;&#35013;&#39280;&#22120;&#35805;&#65292;&#35013;&#39280;&#36807;&#31243;&#65292;&#30001;&#36817;&#21450;&#36828;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5):   <span style="color: #b22222;">#</span><span style="color: #b22222;">add = my_cache(add) =&gt; add = wrapper
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~'</span> * 30)
    time.sleep(3)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(1, add(4,5))
<span style="color: #483d8b;">print</span>(3, add(y=5))
<span style="color: #483d8b;">print</span>(4, add(x=4, y=5))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20986;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1111
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">2222
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">3333
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add 3.000647
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">4444
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1 ((('x', 4), ('y', 5)), 9)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1111
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">2222
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">3333
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add 7.9e-05
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">4444
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">3 ((('x', 4), ('y', 5)), 9)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1111
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">2222
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">3333
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add 3.8e-05
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">4444
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">4 ((('x', 4), ('y', 5)), 9)</span>
</pre>
</div>

<p>
多个装饰器，谁在装饰谁？ 怎么判断？
</p>

<p>
离得近的先装饰，离得远的后装饰。可以在装饰器函数里print()不同输出来判断。
</p>

<p>
调用时从外层向内层调用。先logger再my_cache再add
</p>
</div>
</div>
<div id="outline-container-h:6128874b-cd3c-4d43-8daa-bb28ca9cbee5" class="outline-6">
<h6 id="h:6128874b-cd3c-4d43-8daa-bb28ca9cbee5">过期功能实现</h6>
<div class="outline-text-6" id="text-h:6128874b-cd3c-4d43-8daa-bb28ca9cbee5">
<p>
清除的时机
</p>
<pre class="example" id="orgf9b5cd8">
设置kv失效时间
1 到点过期
2 相对于当前多少秒过期
  2.1 记录起始时间和持续时长 now - start &gt; duration
  2.2 只记录到点时间  now &gt; end
统一设定5秒过期；也可以对每一个kv对单独设定过期时间

</pre>

<p>
过期时间存储
</p>
<pre class="example" id="org80019a7">
过期时间放在哪里？ kye中，value中？

放在key中无法匹配key了，因为你不知道存储key时的时间，就无法匹配。所以适合存储在value中。

value设置时间
1 key =&gt; (v, createtimestamp)
  适合key过期时间都是统一的设定

2 key =&gt; (v, createtimestamp, duration)
  duration是过期时间，这样每一个key就可以单独控制过期时间。在这种设计中，-1可以表示永远
  不过期，0可以表示立即过期，正整数表示持续一段时间过期
</pre>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">value &#35760;&#24405;&#36807;&#26399;&#26102;&#38388;
</span>
<span style="color: #a020f0;">import</span> time, datetime
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps
<span style="color: #a020f0;">import</span> inspect

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn):
    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #a0522d;">start</span> = datetime.datetime.now()
        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
        <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
        <span style="color: #483d8b;">print</span>(fn.<span style="color: #483d8b;">__name__</span>, delta)
        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">my_cache</span>(duration=5):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_cache</span>(fn):
        <span style="color: #a0522d;">local_cache</span> = {}  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#35013;&#39280;&#19968;&#20010;&#20989;&#25968;&#65292;&#37117;&#26377;&#27492;&#20989;&#25968;&#30340;&#29420;&#31435;&#30340;cache
</span>        <span style="color: #228b22;">@wraps</span>(fn)
        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
            <span style="color: #b22222;"># </span><span style="color: #b22222;">makekey &#22788;&#29702;key
</span>            <span style="color: #a0522d;">target</span> = {} <span style="color: #b22222;">#</span><span style="color: #b22222;">key &#23383;&#20856;&#26080;&#24207;
</span>            <span style="color: #a0522d;">sig</span> = inspect.signature(fn)
            <span style="color: #a0522d;">params</span> = sig.parameters  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#30340;OrderedDict
</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#20256;&#21442; &#21644; &#20851;&#38190;&#23383;&#20256;&#21442;
</span>            target.update(<span style="color: #483d8b;">zip</span>(params.keys(), args), **kwargs)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;target.update(zip(params.keys(), args)) &#21644; target.update(kwargs)&#21512;&#19968;&#36215;
</span>            <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32570;&#30465;&#20540; add(y=5) add()
</span>            target.update(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> k:(k, params[k].default), params.keys() - target.keys()))
            <span style="color: #a0522d;">key</span> = <span style="color: #483d8b;">tuple</span>(<span style="color: #483d8b;">sorted</span>(target.items()))

            <span style="color: #a020f0;">if</span> key <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">in</span> local_cache.keys():
                <span style="color: #a0522d;">local_cache</span>[key] = fn(*args, **kwargs), datetime.datetime.now().timestamp()

            <span style="color: #a020f0;">return</span> key, local_cache[key]
        <span style="color: #a020f0;">return</span> wrapper
    <span style="color: #a020f0;">return</span> _cache

<span style="color: #228b22;">@logger</span>  <span style="color: #b22222;"># </span><span style="color: #b22222;">2 add = logger(add)
</span><span style="color: #228b22;">@my_cache</span>() <span style="color: #b22222;"># </span><span style="color: #b22222;">1 add = my_cache(5)(add)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#26377;&#22810;&#20010;&#35013;&#39280;&#22120;&#35805;&#65292;&#35013;&#39280;&#36807;&#31243;&#65292;&#30001;&#36817;&#21450;&#36828;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5):   <span style="color: #b22222;">#</span><span style="color: #b22222;">add = my_cache(add) =&gt; add = wrapper
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~'</span> * 30)
    time.sleep(3)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(1, add(4,5))
<span style="color: #483d8b;">print</span>(3, add(y=5))
<span style="color: #483d8b;">print</span>(4, add(x=4, y=5))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20986;</span>
</pre>
</div>

<pre class="example" id="org877217f">
如何消除过期时间？
1 懒处理，不满不管；过期了，什么时候用cache，遍历清除
    大小128个kv，提交一个数据，没满，不管，新增或覆盖
        提交一个数据，满了，遍历，但是发现一个过期的，删除过期的，增加这个新kv。退出

2 用一个新的线程经常遍历字典，移除过期的kv。多线程问题，加锁，效率较低。
</pre>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#28165;&#38500;&#36807;&#26399;cache
</span>
<span style="color: #a020f0;">import</span> time, datetime
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps
<span style="color: #a020f0;">import</span> inspect

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn):
    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #a0522d;">start</span> = datetime.datetime.now()
        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
        <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
        <span style="color: #483d8b;">print</span>(fn.<span style="color: #483d8b;">__name__</span>, delta)
        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">my_cache</span>(duration=5):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_cache</span>(fn):
        <span style="color: #a0522d;">local_cache</span> = {}  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#35013;&#39280;&#19968;&#20010;&#20989;&#25968;&#65292;&#37117;&#26377;&#27492;&#20989;&#25968;&#30340;&#29420;&#31435;&#30340;cache
</span>        <span style="color: #228b22;">@wraps</span>(fn)
        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#28165;&#38500;cache
</span>            <span style="color: #a0522d;">expire_keys</span>  = []
            <span style="color: #a020f0;">for</span> k, (_, stamp) <span style="color: #a020f0;">in</span> local_cache.items(): <span style="color: #b22222;"># </span><span style="color: #b22222;">item =&gt; (k, v) =&gt; (k, (result, stamp))
</span>                <span style="color: #a0522d;">now</span> = datetime.datetime.now().timestamp()
                <span style="color: #a020f0;">if</span> now - stamp &gt; duration:  <span style="color: #b22222;"># </span><span style="color: #b22222;">now -stamp &#20540;&#30340;&#33539;&#22260;&#65311; &#27491;&#25968; &#36127;&#25968; &#36824;&#26159; 0 &#65311;
</span>                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#21487;&#33021;&#20986;&#29616;&#36127;&#25968;&#65292;&#20986;&#38169;&#30340;&#26102;&#20505;&#12290;&#26102;&#38388;&#20081;&#25481;&#20102;
</span>                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#37096;&#32626;&#29615;&#22659;&#20013;&#65292;&#26497;&#26377;&#21487;&#33021;&#20986;&#29616;&#26102;&#38388;&#20081;&#25481;&#20102;&#65292;&#21487;&#33021;&#20986;&#29616;&#36127;&#25968;&#65292;&#22810;&#26426;&#37096;&#32626;&#37117;&#38656;&#35201;&#24320;&#21551;&#26102;&#38388;&#21516;&#27493;&#26381;&#21153;
</span>                    expire_keys.append(k)
            <span style="color: #a020f0;">for</span> k <span style="color: #a020f0;">in</span> expire_keys:
                local_cache.pop(k)

            <span style="color: #b22222;"># </span><span style="color: #b22222;">makekey &#22788;&#29702;key
</span>            <span style="color: #a0522d;">target</span> = {} <span style="color: #b22222;">#</span><span style="color: #b22222;">key &#23383;&#20856;&#26080;&#24207;
</span>            <span style="color: #a0522d;">sig</span> = inspect.signature(fn)
            <span style="color: #a0522d;">params</span> = sig.parameters  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#30340;OrderedDict
</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#20256;&#21442; &#21644; &#20851;&#38190;&#23383;&#20256;&#21442;
</span>            target.update(<span style="color: #483d8b;">zip</span>(params.keys(), args), **kwargs)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;target.update(zip(params.keys(), args)) &#21644; target.update(kwargs)&#21512;&#19968;&#36215;
</span>            <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32570;&#30465;&#20540; add(y=5) add()
</span>            target.update(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> k:(k, params[k].default), params.keys() - target.keys()))
            <span style="color: #a0522d;">key</span> = <span style="color: #483d8b;">tuple</span>(<span style="color: #483d8b;">sorted</span>(target.items()))

            <span style="color: #a020f0;">if</span> key <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">in</span> local_cache.keys():
                <span style="color: #a0522d;">local_cache</span>[key] = fn(*args, **kwargs), datetime.datetime.now().timestamp()

            <span style="color: #a020f0;">return</span> key, local_cache[key]
        <span style="color: #a020f0;">return</span> wrapper
    <span style="color: #a020f0;">return</span> _cache

<span style="color: #228b22;">@logger</span>  <span style="color: #b22222;"># </span><span style="color: #b22222;">2 add = logger(add)
</span><span style="color: #228b22;">@my_cache</span>(duration=1) <span style="color: #b22222;"># </span><span style="color: #b22222;">1 add = my_cache(5)(add)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#26377;&#22810;&#20010;&#35013;&#39280;&#22120;&#35805;&#65292;&#35013;&#39280;&#36807;&#31243;&#65292;&#30001;&#36817;&#21450;&#36828;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5):   <span style="color: #b22222;">#</span><span style="color: #b22222;">add = my_cache(add) =&gt; add = wrapper
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~'</span> * 30)
    time.sleep(3)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(1, add(4,5))
time.sleep(3)
<span style="color: #483d8b;">print</span>(2, add(4))
<span style="color: #483d8b;">print</span>(3, add(y=5))
<span style="color: #483d8b;">print</span>(4, add(x=4, y=5))
<span style="color: #483d8b;">print</span>(5, add(y=5, x=4))
<span style="color: #483d8b;">print</span>(6, add( ))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20986;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add 3.000532
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1 ((('x', 4), ('y', 5)), (9, 1736095337.504812))
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add 3.000323
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">2 ((('x', 4), ('y', 5)), (9, 1736095343.505797))
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add 0.000101
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">3 ((('x', 4), ('y', 5)), (9, 1736095343.505797))
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add 5e-05
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">4 ((('x', 4), ('y', 5)), (9, 1736095343.505797))
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add 4.1e-05
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">5 ((('x', 4), ('y', 5)), (9, 1736095343.505797))
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add 3.5e-05
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">6 ((('x', 4), ('y', 5)), (9, 1736095343.505797))</span>
</pre>
</div>

<p>
抽象函数
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">coding: utf-8
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#28165;&#38500;&#36807;&#26399;cache
</span>
<span style="color: #a020f0;">import</span> time, datetime
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps
<span style="color: #a020f0;">import</span> inspect


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">logger</span>(fn):
    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #a0522d;">start</span> = datetime.datetime.now()
        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
        <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
        <span style="color: #483d8b;">print</span>(fn.<span style="color: #483d8b;">__name__</span>, delta)
        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_clear</span>(cache,duration):
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#28165;&#38500;cache
</span>    <span style="color: #a0522d;">expire_keys</span> = []
    <span style="color: #a020f0;">for</span> k, (_, stamp) <span style="color: #a020f0;">in</span> cache.items():  <span style="color: #b22222;"># </span><span style="color: #b22222;">item =&gt; (k, v) =&gt; (k, (result, stamp))
</span>        <span style="color: #a0522d;">now</span> = datetime.datetime.now().timestamp()
        <span style="color: #a020f0;">if</span> now - stamp &gt; duration:  <span style="color: #b22222;"># </span><span style="color: #b22222;">now -stamp &#20540;&#30340;&#33539;&#22260;&#65311; &#27491;&#25968; &#36127;&#25968; &#36824;&#26159; 0 &#65311;
</span>            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26377;&#21487;&#33021;&#20986;&#29616;&#36127;&#25968;&#65292;&#20986;&#38169;&#30340;&#26102;&#20505;&#12290;&#26102;&#38388;&#20081;&#25481;&#20102;
</span>            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#37096;&#32626;&#29615;&#22659;&#20013;&#65292;&#26497;&#26377;&#21487;&#33021;&#20986;&#29616;&#26102;&#38388;&#20081;&#25481;&#20102;&#65292;&#21487;&#33021;&#20986;&#29616;&#36127;&#25968;&#65292;&#22810;&#26426;&#37096;&#32626;&#37117;&#38656;&#35201;&#24320;&#21551;&#26102;&#38388;&#21516;&#27493;&#26381;&#21153;
</span>            expire_keys.append(k)
    <span style="color: #a020f0;">for</span> k <span style="color: #a020f0;">in</span> expire_keys:
        cache.pop(k)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_make_key</span>(fn, args, kwargs):
    <span style="color: #b22222;"># </span><span style="color: #b22222;">makekey &#22788;&#29702;key
</span>    <span style="color: #a0522d;">target</span> = {}  <span style="color: #b22222;"># </span><span style="color: #b22222;">key &#23383;&#20856;&#26080;&#24207;
</span>    <span style="color: #a0522d;">sig</span> = inspect.signature(fn)
    <span style="color: #a0522d;">params</span> = sig.parameters  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#30340;OrderedDict
</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#20256;&#21442; &#21644; &#20851;&#38190;&#23383;&#20256;&#21442;
</span>    target.update(<span style="color: #483d8b;">zip</span>(params.keys(), args),
                  **kwargs)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;target.update(zip(params.keys(), args)) &#21644; target.update(kwargs)&#21512;&#19968;&#36215;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32570;&#30465;&#20540; add(y=5) add()
</span>    target.update(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> k: (k, params[k].default), params.keys() - target.keys()))
    <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">tuple</span>(<span style="color: #483d8b;">sorted</span>(target.items()))

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">my_cache</span>(duration=5):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_cache</span>(fn):
        <span style="color: #a0522d;">local_cache</span> = {}  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#35013;&#39280;&#19968;&#20010;&#20989;&#25968;&#65292;&#37117;&#26377;&#27492;&#20989;&#25968;&#30340;&#29420;&#31435;&#30340;cache
</span>        <span style="color: #228b22;">@wraps</span>(fn)
        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
            _clear(local_cache, duration)
            <span style="color: #a0522d;">key</span> = _make_key(fn, args, kwargs)
            <span style="color: #a020f0;">if</span> key <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">in</span> local_cache.keys():
                <span style="color: #a0522d;">local_cache</span>[key] = fn(*args, **kwargs), datetime.datetime.now().timestamp()
            <span style="color: #a020f0;">return</span> key, local_cache[key]
        <span style="color: #a020f0;">return</span> wrapper
    <span style="color: #a020f0;">return</span> _cache

<span style="color: #228b22;">@logger</span>  <span style="color: #b22222;"># </span><span style="color: #b22222;">2 add = logger(add)
</span><span style="color: #228b22;">@my_cache</span>(duration=1)  <span style="color: #b22222;"># </span><span style="color: #b22222;">1 add = my_cache(5)(add)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#26377;&#22810;&#20010;&#35013;&#39280;&#22120;&#35805;&#65292;&#35013;&#39280;&#36807;&#31243;&#65292;&#30001;&#36817;&#21450;&#36828;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x=4, y=5):  <span style="color: #b22222;"># </span><span style="color: #b22222;">add = my_cache(add) =&gt; add = wrapper
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~'</span> * 30)
    time.sleep(3)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(1, add(4, 5))
time.sleep(3)
<span style="color: #483d8b;">print</span>(2, add(4))
<span style="color: #483d8b;">print</span>(3, add(y=5))
<span style="color: #483d8b;">print</span>(4, add(x=4, y=5))
<span style="color: #483d8b;">print</span>(5, add(y=5, x=4))
<span style="color: #483d8b;">print</span>(6, add())

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20986;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add 3.000611
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1 ((('x', 4), ('y', 5)), (9, 1736096540.518239))
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add 3.000949
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">2 ((('x', 4), ('y', 5)), (9, 1736096546.519906))
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add 0.000248
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">3 ((('x', 4), ('y', 5)), (9, 1736096546.519906))
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add 0.000143
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">4 ((('x', 4), ('y', 5)), (9, 1736096546.519906))
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add 0.000114
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">5 ((('x', 4), ('y', 5)), (9, 1736096546.519906))
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">add 0.000128
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">6 ((('x', 4), ('y', 5)), (9, 1736096546.519906))</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:2c7e6f8d-b96f-484a-92c1-8cff7c375b64" class="outline-4">
<h4 id="h:2c7e6f8d-b96f-484a-92c1-8cff7c375b64">装饰器的用途</h4>
<div class="outline-text-4" id="text-h:2c7e6f8d-b96f-484a-92c1-8cff7c375b64">
<p>
装饰器是AOP面向切面编程 Aspect Oriented Programming的思想的体现。
</p>

<pre class="example" id="orgb945c42">
面向对象往往需要通过继承或者组合依赖等方式调用一些功能，这些功能的代码往往可能在多个类中出现，
例如logger功能代码。这样造成代码的重复，增加了耦合。logger的改变影响所有使用它的类或方法。

而AOP在需要的类或方法上切下，前后的切入点可以加入增强的功能。让调用者和被调用者解耦。

这是一种不修改原来的业务代码，给程序动态添加功能的技术。
例如logger函数就是对业务函数增加日志的功能，而业务函数中应该把与业务无关的日志功能剥离干净。
</pre>

<p>
装饰器的应用场景
</p>
<ul class="org-ul">
<li>日志、监控、权限、审计、参数检查、路由等处理。这些功能与业务功能无关，是很多业务都需要的公有的功能，所以适合独立出来，需要的时候，对目标对象进行增强。</li>
</ul>
</div>
</div>
</div>
</section>
<section id="outline-container-h:b8dc3f3f-df4d-41f2-9381-934755f9bd88" class="outline-2">
<h2 id="h:b8dc3f3f-df4d-41f2-9381-934755f9bd88">Python 面向对象编程</h2>
<div class="outline-text-2" id="text-h:b8dc3f3f-df4d-41f2-9381-934755f9bd88">
<p>
主要内容
</p>
<ul class="org-ul">
<li>面向对象的分析与设计 OOA&amp;D</li>
<li>面向对象三要素</li>
<li>类的实现方法</li>
<li>类属性定义</li>
<li>类方法和静态方法</li>
<li>类成员的本质</li>
<li>类实例化含义</li>
<li>实例仳的过程</li>
<li>Self 的理解与使用</li>
<li>实例属性</li>
<li>子类与继承</li>
<li>子类实例化与构造器调用</li>
<li>Super 的理解与使用</li>
<li>Overload 与 Override</li>
<li>新式类和古典类</li>
<li>多重继承</li>
<li>多重继承的歧义与解决</li>
<li>多继承应用 Mixin</li>
<li>成员访问控制</li>
</ul>
</div>
<div id="outline-container-h:08dba916-9314-4083-acf5-ee71dcf4902e" class="outline-3">
<h3 id="h:08dba916-9314-4083-acf5-ee71dcf4902e">语言的分类</h3>
<div class="outline-text-3" id="text-h:08dba916-9314-4083-acf5-ee71dcf4902e">
<p>
面向机器
-抽象成机器指令，机器容易理解
</p>
<ul class="org-ul">
<li>代表：汇编语言</li>
</ul>

<p>
面向过程
</p>
<ul class="org-ul">
<li>问题规模小，可以步骤化，按部就班处理</li>
<li>代表：C语言</li>
</ul>

<p>
面向对象OOP
</p>
<ul class="org-ul">
<li>随着计算机需要解决的问题的规模扩大，情况越来越复杂。需要很多人、很多部门协作，面向过程编程不太合适了</li>
<li>代表：C++、Java、Python等</li>
</ul>
</div>
</div>
<div id="outline-container-h:05f37946-4196-4e54-a9e0-95dedcfc9010" class="outline-3">
<h3 id="h:05f37946-4196-4e54-a9e0-95dedcfc9010">面向对象</h3>
<div class="outline-text-3" id="text-h:05f37946-4196-4e54-a9e0-95dedcfc9010">
<p>
什么是面向对象？
</p>

<p>
面向对象是一种认识世界、分析世界的方法论。将万事万物抽象为各种对象
</p>

<p>
类class
</p>
<ul class="org-ul">
<li>类是抽象的概念，是万事万物的抽象，是一类事物的共同特征的集合</li>
<li>用计算机语言来描述类，是 <b>属性</b> 和 <b>方法</b> 的集合</li>
</ul>

<p>
对象instance、object
</p>
<ul class="org-ul">
<li>对象是类的具象，是一个实体</li>
<li>对于我们每个人这个个体，都是抽象概念人类的不同的 <b>实体</b></li>
</ul>

<p>
范例
</p>
<pre class="example" id="orge325547">
你吃鱼
你，就是对象；鱼，也是对象；吃就是动作
你是具体的人，是具体的对象。你属于人类，人类是个抽象的概念，是无数具体人的个体的抽象。
鱼，也是具体的对象，就是你吃了具体的鱼。这条鱼属于鱼类，鱼类是无数的鱼抽象出来的概念。
吃，是动作，也是操作，也是方法，这个吃是你的动作，也就是人类具体的方法。如果反过来，鱼吃人。吃就是鱼类的动作了。
吃，这个动作，很多动物都具有的动作，人类和鱼类都属于动物类，而动物类是抽象的概念，是动物都有
吃的动作，但是吃法不同而已。
你驾驶汽车，这个车也是车类的具体的对象（实例），驾驶这个动作是鱼类不具有的，是人类具有的方法。
</pre>

<ul class="org-ul">
<li><b>属性</b>: 它是对象状态的抽象，用数据结构来描述</li>
<li><b>操作</b>: 它是对象行为的抽象，用操作名和实现该操作的方法来描述</li>
</ul>

<pre class="example" id="orgd3ac6da">
每个人都是人类的一个单独的实例，都有自己的名字、身高、体重等信息，这些信息是个人的属性，
但是，这些信息不能保存在人类中，因为人类是抽象的概念，不能保留每个具体的个体的值。
而人类的实例，是具体的人，他可以储存这些具体的属性，而且可以不同人有不同的属性。
</pre>

<p>
哲学
</p>
<ul class="org-ul">
<li>一切皆对象</li>
<li>对象是数据和操作的封装</li>
<li>对象是独立的，但是对象之间可以相互作用</li>
<li>目前OOP是最接近人类认知的编程范式</li>
</ul>
</div>
</div>
<div id="outline-container-h:703b653c-a1e2-43a3-a6b3-b0580745d573" class="outline-3">
<h3 id="h:703b653c-a1e2-43a3-a6b3-b0580745d573">面向对象3要素</h3>
<div class="outline-text-3" id="text-h:703b653c-a1e2-43a3-a6b3-b0580745d573">
</div>
<div id="outline-container-h:0eec52a0-db06-49ca-ba66-b2d8e7a82cf2" class="outline-4">
<h4 id="h:0eec52a0-db06-49ca-ba66-b2d8e7a82cf2">1. 封装</h4>
<div class="outline-text-4" id="text-h:0eec52a0-db06-49ca-ba66-b2d8e7a82cf2">
<ul class="org-ul">
<li>组装：将数据和操作组装到一起</li>
<li>隐藏数据：对外只暴露一些接口，通过接口访问对象。比如驾驶员使用汽车，不需要了解汽车的机动原理，会用就行</li>
</ul>
</div>
</div>
<div id="outline-container-h:6de35c0f-0b06-46e1-add4-0500f7a3db1f" class="outline-4">
<h4 id="h:6de35c0f-0b06-46e1-add4-0500f7a3db1f">2. 继承</h4>
<div class="outline-text-4" id="text-h:6de35c0f-0b06-46e1-add4-0500f7a3db1f">
<ul class="org-ul">
<li>多复用，继承来的就不用自己写了</li>
<li>多继承少修改，OCP（Open-closed Principle），使用继承来改变，来体现个性</li>
</ul>
</div>
</div>
<div id="outline-container-h:67dc3e5c-6565-4119-b23d-8104124fa3b3" class="outline-4">
<h4 id="h:67dc3e5c-6565-4119-b23d-8104124fa3b3">3. 多态</h4>
<div class="outline-text-4" id="text-h:67dc3e5c-6565-4119-b23d-8104124fa3b3">
<ul class="org-ul">
<li>面向对象编程最灵活的地方，动态绑定</li>
</ul>

<pre class="example" id="org6b97d33">
人类就是封装；
人类继承自动物类，孩子继承父母特征。分为单一继承、多继承；
多态，继承自动物类的人类、猫类的操作“吃”不同。
</pre>
</div>
</div>
</div>
<div id="outline-container-h:4bb5e220-b773-4a12-8ddb-163ed2b994dc" class="outline-3">
<h3 id="h:4bb5e220-b773-4a12-8ddb-163ed2b994dc">封装</h3>
<div class="outline-text-3" id="text-h:4bb5e220-b773-4a12-8ddb-163ed2b994dc">
<p>
封装就是定义类，将属性和操作组织在一起。
</p>
</div>
<div id="outline-container-h:7d09b3fe-2a43-43ef-b0a1-e6ec4ecd5883" class="outline-4">
<h4 id="h:7d09b3fe-2a43-43ef-b0a1-e6ec4ecd5883">Python类定义</h4>
<div class="outline-text-4" id="text-h:7d09b3fe-2a43-43ef-b0a1-e6ec4ecd5883">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">ClassName</span>:
    &#35821;&#21477;&#22359;
</pre>
</div>

<ol class="org-ol">
<li>必须使用class关键字</li>
<li>类名强烈建议使用 <b>大驼峰</b> 命名方式，即每个单词首字母大写。其本质就是一个标识符</li>
<li>类定义完成后，就产生了一个 <b>类对象</b> ，绑定到了标识符ClassName上</li>
</ol>

<p>
范例
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">__name__ &#23450;&#20041;&#25191;&#34892;&#20043;&#21518;&#65292;&#20250;&#24471;&#21040;&#19968;&#20010;&#31867;&#23545;&#35937;
</span>    <span style="color: #8b2252;">"""An example of class"""</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showme</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19968;&#20010;&#20989;&#25968;&#23450;&#20041;&#22312;&#31867;&#20013;&#65292;&#20064;&#24815;&#31216;&#20026;&#31867;&#26041;&#27861;&#12290;&#25104;&#21592;&#26041;&#27861;
</span>        <span style="color: #8b2252;">"Showme method"</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;&#19981;&#33021;&#30452;&#25509;&#22312;&#22806;&#37096;&#35843;&#29992;&#65292;&#38656;&#35201;&#20511;&#21161;&#38480;&#23450;&#21517;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">__name__</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">?
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21462;&#31867;&#30340;&#30456;&#20851;&#23646;&#24615;
</span><span style="color: #483d8b;">print</span>(Person) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#31867;&#23545;&#35937; &lt;class '__main__.Person'&gt;
</span><span style="color: #483d8b;">print</span>(Person.<span style="color: #483d8b;">__name__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#31867;&#21517;&#65292;str Person &#25104;&#21592;&#23646;&#24615; double under&#21452;&#19979;&#21010;&#32447;
</span><span style="color: #483d8b;">print</span>(Person.__class__, <span style="color: #483d8b;">type</span>(Person)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#31867;&#23545;&#35937;&#21462;type&#65292;&#20004;&#31181;&#20889;&#27861;&#26159;&#19968;&#22238;&#20107;&#12290;&lt;class 'type'&gt; &lt;class 'type'&gt;
</span><span style="color: #483d8b;">print</span>(Person.<span style="color: #483d8b;">__doc__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#30340;&#25991;&#26723; An example of class
</span><span style="color: #483d8b;">print</span>(Person.showme) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;function Person.showme at 0x00000173E7C07A60&gt;
</span><span style="color: #483d8b;">print</span>(Person.showme.<span style="color: #483d8b;">__qualname__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38480;&#23450;&#21517; Person.showme
</span><span style="color: #483d8b;">print</span>(Person.showme.<span style="color: #483d8b;">__doc__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25991;&#26723; Showme method
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#30340;&#25104;&#21592;&#37117;&#26159;&#36890;&#36807;.&#36816;&#31639;&#31526;&#35775;&#38382;&#30340;&#65292;&#25152;&#20197;&#31867;&#30340;&#25104;&#21592;&#20063;&#21487;&#20197;&#21483;&#31867;&#30340;&#23646;&#24615;&#25110;&#32773;&#31867;&#30340;&#21464;&#37327;&#65292;&#21482;&#26159;&#26377;&#30340;&#23384;&#30340;&#25968;&#25454;&#26377;&#30340;&#23384;&#30340;&#20989;&#25968;&#23545;&#35937;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">.&#36816;&#31639;&#31526;&#65292;&#25104;&#21592;&#36816;&#31639;&#31526;&#65292;&#31867;&#30340;&#25104;&#21592;&#25110;&#23454;&#20363;&#30340;&#25104;&#21592;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21040;&#30446;&#21069;&#20026;&#27490;&#65292;&#26377;Person&#23454;&#20363;&#21527;&#65311;&#27809;&#26377;&#23454;&#20363;
</span>
<span style="color: #a0522d;">tom</span> = Person() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23454;&#20363;&#21270;</span>
</pre>
</div>

<p>
举例
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #8b2252;">"""An exapmle class"""</span>
    <span style="color: #a0522d;">x</span> = <span style="color: #8b2252;">'abc'</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#31867;&#23646;&#24615;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showme</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26041;&#27861;&#65292;&#20063;&#26159;&#31867;&#23646;&#24615;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">__name__</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#31867;&#30340;&#21517;&#31216;
</span>
<span style="color: #483d8b;">print</span>(Person)
<span style="color: #483d8b;">print</span>(Person.<span style="color: #483d8b;">__name__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#21517;&#23383;
</span><span style="color: #483d8b;">print</span>(Person.<span style="color: #483d8b;">__doc__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#25991;&#26723;
</span><span style="color: #483d8b;">print</span>(Person.showme) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#23646;&#24615;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:77030670-1f78-4a8f-b37e-7180a00291c6" class="outline-4">
<h4 id="h:77030670-1f78-4a8f-b37e-7180a00291c6">类及类属性</h4>
<div class="outline-text-4" id="text-h:77030670-1f78-4a8f-b37e-7180a00291c6">
<ul class="org-ul">
<li><code>类对象</code>, 类也是对象，类的定义执行后会生成一个类对象</li>
<li><code>类的属性</code>, 类定义中的变量和类中定义的 <b>方法</b> 都是类的属性</li>
<li><code>类变量</code>, 上例中x是类MyClass的变量</li>
</ul>

<p>
Person中，x、showme都是类的属性， <code>__name__</code> 、 <code>__doc__</code> 是类的特殊属性
</p>

<p>
showme方法是类的属性，如同 <b>吃</b> 是 <b>人类的方法</b> ，但是 <b>每一个具体的人才能吃东西</b> ，也就是说 <b>吃</b> 是人的 <b>实例</b> 能调用的方法。
</p>

<p>
showme是 <code>方法method</code> ，本质上就是普通的函数对象function，它一般要求至少有一个参数。第一个形式参数可以是
self（self只是个惯用标识符，不推荐修改），这个参数位置就留给了self。
</p>

<p>
<code>self 指代当前实例本身</code>
</p>
</div>
</div>
<div id="outline-container-h:d8290bc9-1431-462a-aa7e-104b8b2def22" class="outline-4">
<h4 id="h:d8290bc9-1431-462a-aa7e-104b8b2def22">实例化</h4>
<div class="outline-text-4" id="text-h:d8290bc9-1431-462a-aa7e-104b8b2def22">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">a</span> = Person() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23454;&#20363;&#21270;</span>
</pre>
</div>

<p>
使用上面的语法，在类对象名称后面加上一个括号，就调用类的实例化方法，完成实例化。
</p>

<p>
实例化就真正创建一个该类的对象（实例）。例如
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">tom</span> = Person() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#21516;&#30340;&#23454;&#20363;
</span><span style="color: #a0522d;">jack</span> = Person() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#21516;&#30340;&#23454;&#20363;</span>
</pre>
</div>

<p>
上面的tom、jack 都是Person类的实例，通过实例化生成了2个 <b>不同的</b> 实例。
</p>

<p>
每次实例化后获得 <b>不同的实例</b> ，即使是使用同样的参数实例化，也得到不一样的对象。
</p>

<p>
Python类实例化后，会自动调用 <code>__init__</code> 方法。这个方法第一个形式参数必须留给self，其它参数随意。
</p>

<p>
范例
</p>
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">__name__ &#23450;&#20041;&#25191;&#34892;&#20043;&#21518;&#65292;&#20250;&#24471;&#21040;&#19968;&#20010;&#31867;&#23545;&#35937;
</span>    <span style="color: #8b2252;">"""An example of class"""</span>
    <span style="color: #a0522d;">x</span> = <span style="color: #8b2252;">'abc'</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showme</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19968;&#20010;&#20989;&#25968;&#23450;&#20041;&#22312;&#31867;&#20013;&#65292;&#20064;&#24815;&#31216;&#20026;&#31867;&#26041;&#27861;&#12290;&#25104;&#21592;&#26041;&#27861;
</span>        <span style="color: #8b2252;">"Showme method"</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;&#19981;&#33021;&#30452;&#25509;&#22312;&#22806;&#37096;&#35843;&#29992;&#65292;&#38656;&#35201;&#20511;&#21161;&#38480;&#23450;&#21517;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'showme ++++++'</span>)
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">__name__</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">?
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18): <span style="color: #b22222;">#</span><span style="color: #b22222;">self&#27704;&#36828;&#25351;&#21521;&#24403;&#21069;&#23454;&#20363;&#33258;&#36523;&#65292;java\c++\javascript&#29992;&#30340;&#26159;this
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init ~~~~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name <span style="color: #b22222;">#</span><span style="color: #b22222;">self &#65292;&#24403;&#21069;&#23454;&#20363;&#65292;&#23454;&#20363;&#23646;&#24615;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;&#19979;&#37117;&#26159;&#22312;&#35775;&#38382;&#31867;&#23646;&#24615;
</span><span style="color: #483d8b;">print</span>(Person) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#31867;&#23545;&#35937; &lt;class '__main__.Person'&gt;
</span><span style="color: #483d8b;">print</span>(Person.<span style="color: #483d8b;">__name__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#31867;&#21517;&#65292;str Person &#25104;&#21592;&#23646;&#24615; double under&#21452;&#19979;&#21010;&#32447;
</span><span style="color: #483d8b;">print</span>(Person.__class__, <span style="color: #483d8b;">type</span>(Person)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#31867;&#23545;&#35937;&#21462;type&#65292;&#20004;&#31181;&#20889;&#27861;&#26159;&#19968;&#22238;&#20107;&#12290;&lt;class 'type'&gt; &lt;class 'type'&gt;
</span><span style="color: #483d8b;">print</span>(Person.<span style="color: #483d8b;">__doc__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#30340;&#25991;&#26723; An example of class
</span><span style="color: #483d8b;">print</span>(Person.showme) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;function Person.showme at 0x00000173E7C07A60&gt;
</span><span style="color: #483d8b;">print</span>(Person.showme.<span style="color: #483d8b;">__qualname__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38480;&#23450;&#21517; Person.showme
</span><span style="color: #483d8b;">print</span>(Person.showme.<span style="color: #483d8b;">__doc__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25991;&#26723; Showme method
</span><span style="color: #483d8b;">print</span>(Person.x) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#30340;&#23646;&#24615; abc
</span>
<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'Tom'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">init ~~~~~~~
</span><span style="color: #a0522d;">jerry</span> = Person(<span style="color: #8b2252;">'Tom'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">init ~~~~~~~
</span><span style="color: #483d8b;">print</span>(tom.name, tom.age) <span style="color: #b22222;">#</span><span style="color: #b22222;">Tom 18
</span><span style="color: #483d8b;">print</span>(jerry.name, jerry.age) <span style="color: #b22222;">#</span><span style="color: #b22222;">Tom 18
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(tom), <span style="color: #483d8b;">id</span>(jerry)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#26159;&#21516;&#19968;&#20010;&#23545;&#35937; 1728622263472 1728624259984</span>
</pre>
</div>
</div>
<div id="outline-container-h:532ef4a3-d633-433a-a67a-2acbbded6a98" class="outline-5">
<h5 id="h:532ef4a3-d633-433a-a67a-2acbbded6a98">构造的2个阶段</h5>
<div class="outline-text-5" id="text-h:532ef4a3-d633-433a-a67a-2acbbded6a98">
<ol class="org-ol">
<li>构造实例过程，实例化。如生产线上生成一辆车。调用魔术方法 <code>__new__</code> 返回一个实例</li>
<li>初始化过程，初始化。如对这新车做出场配置。魔术方法 <code>__init__</code> 方法中内容就是出场配置</li>
</ol>

<p>
但是需要注意的是，很多人习惯混用这些词，来代表两个阶段的总称。
</p>

<p>
范例
</p>
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">__name__ &#23450;&#20041;&#25191;&#34892;&#20043;&#21518;&#65292;&#20250;&#24471;&#21040;&#19968;&#20010;&#31867;&#23545;&#35937;
</span>    <span style="color: #8b2252;">"""An example of class"""</span>
    <span style="color: #a0522d;">x</span> = <span style="color: #8b2252;">'abc'</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showme</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19968;&#20010;&#20989;&#25968;&#23450;&#20041;&#22312;&#31867;&#20013;&#65292;&#20064;&#24815;&#31216;&#20026;&#31867;&#26041;&#27861;&#12290;&#25104;&#21592;&#26041;&#27861;
</span>        <span style="color: #8b2252;">"Showme method"</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;&#19981;&#33021;&#30452;&#25509;&#22312;&#22806;&#37096;&#35843;&#29992;&#65292;&#38656;&#35201;&#20511;&#21161;&#38480;&#23450;&#21517;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'showme ++++++'</span>)
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">__name__</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">?
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18): <span style="color: #b22222;">#</span><span style="color: #b22222;">self&#27704;&#36828;&#25351;&#21521;&#24403;&#21069;&#23454;&#20363;&#33258;&#36523;&#65292;java\c++\javascript&#29992;&#30340;&#26159;this
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init ~~~~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name <span style="color: #b22222;">#</span><span style="color: #b22222;">self &#65292;&#24403;&#21069;&#23454;&#20363;&#65292;&#23454;&#20363;&#23646;&#24615;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

<span style="color: #b22222;">#</span><span style="color: #b22222;">Python&#20013;&#23454;&#20363;&#21270;&#20998;2&#20010;&#38454;&#27573;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1 &#26500;&#36896;&#23454;&#20363;&#36807;&#31243;&#65292;&#23454;&#20363;&#21270;&#12290;&#22914;&#29983;&#20135;&#32447;&#19978;&#29983;&#25104;&#19968;&#36742;&#36710;&#12290;&#35843;&#29992;&#39764;&#26415;&#26041;&#27861; __new__ &#36820;&#22238;&#19968;&#20010;&#23454;&#20363;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">2 &#21021;&#22987;&#21270;&#36807;&#31243;&#65292;&#21021;&#22987;&#21270;&#12290;&#22914;&#23545;&#36825;&#26032;&#36710;&#20570;&#20986;&#22330;&#37197;&#32622;&#12290;&#39764;&#26415;&#26041;&#27861; __init__ &#26041;&#27861;&#20013;&#20869;&#23481;&#23601;&#26159;&#20986;&#22330;&#37197;&#32622;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#20005;&#35880;&#21483;&#27861;&#65292;&#28151;&#29992;&#36825;&#20123;&#35789;
</span>
<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'Tom'</span>, 20) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#24335;&#21491;&#36793;&#20570;2&#20010;&#38454;&#27573;&#30340;&#20107;&#24773;&#65306;&#23454;&#20363;&#21270;&#21644;&#21021;&#22987;&#21270;
</span><span style="color: #a0522d;">jerry</span> = Person(<span style="color: #8b2252;">'Tom'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">init ~~~~~~~
</span><span style="color: #483d8b;">print</span>(tom.name, tom.age) <span style="color: #b22222;">#</span><span style="color: #b22222;">Tom 20
</span><span style="color: #483d8b;">print</span>(jerry.name, jerry.age) <span style="color: #b22222;">#</span><span style="color: #b22222;">Tom 18
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(tom), <span style="color: #483d8b;">id</span>(jerry)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#26159;&#21516;&#19968;&#20010;&#23545;&#35937; 1728622263472 1728624259984</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:1d64b1ac-fff0-403c-b755-d91a56d60fce" class="outline-5">
<h5 id="h:1d64b1ac-fff0-403c-b755-d91a56d60fce">__init__方法</h5>
<div class="outline-text-5" id="text-h:1d64b1ac-fff0-403c-b755-d91a56d60fce">
<p>
有些人把Python的 <code>__init__</code> 方法称为构造方法或者构造器。
</p>

<p>
Person() 实例化后，要初始化，要调用的是 <code>__init__(self)</code> 方法，可以不定义，如果没有定义会在实例化
后 <b>隐式</b> 调用其父类的。
</p>

<p>
作用：对实例进行 <code>初始化</code>
</p>

<p>
<code>__init___</code> 方法不能有返回值，只能 return None
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyClass</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init'</span>)

<span style="color: #483d8b;">print</span>(MyClass) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#20250;&#35843;&#29992;
</span><span style="color: #483d8b;">print</span>(MyClass()) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35843;&#29992;__init__
</span><span style="color: #a0522d;">a</span> = MyClass() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35843;&#29992;__init__</span>
</pre>
</div>

<ul class="org-ul">
<li>初始化函数可以多个参数，请注意第一个位置必须是self，例如 <code>__init__(self, name, age)</code></li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">__name__ &#23450;&#20041;&#25191;&#34892;&#20043;&#21518;&#65292;&#20250;&#24471;&#21040;&#19968;&#20010;&#31867;&#23545;&#35937;
</span>    <span style="color: #8b2252;">"""An example of class"""</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18): <span style="color: #b22222;">#</span><span style="color: #b22222;">self&#27704;&#36828;&#25351;&#21521;&#24403;&#21069;&#23454;&#20363;&#33258;&#36523;&#65292;java\c++\javascript&#29992;&#30340;&#26159;this
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init ~~~~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name <span style="color: #b22222;">#</span><span style="color: #b22222;">self &#65292;&#24403;&#21069;&#23454;&#20363;&#65292;&#23454;&#20363;&#23646;&#24615;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showage</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{} is {}"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.name, <span style="color: #a020f0;">self</span>.age))

<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'Tom'</span>, 20) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#24335;&#21491;&#36793;&#20570;2&#20010;&#38454;&#27573;&#30340;&#20107;&#24773;&#65306;&#23454;&#20363;&#21270;&#21644;&#21021;&#22987;&#21270;
</span><span style="color: #a0522d;">jerry</span> = Person(<span style="color: #8b2252;">'jerry'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">init ~~~~~~~
</span>
<span style="color: #483d8b;">print</span>(tom.name, tom.age) <span style="color: #b22222;">#</span><span style="color: #b22222;">Tom 20
</span><span style="color: #483d8b;">print</span>(jerry.name, jerry.age) <span style="color: #b22222;">#</span><span style="color: #b22222;">Tom 18
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;&#38480;&#23450;&#21517;&#35775;&#38382;showage
</span>tom.showage() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#30340;&#23454;&#20363;tom&#26469;&#35775;&#38382;&#23454;&#20363;&#23646;&#24615;&#65292;&#21487;&#20197;&#12290;self &#25351;&#23450; tom &#36820;&#22238;Tom is 20
</span>jerry.showage() <span style="color: #b22222;">#</span><span style="color: #b22222;">jerry is 18
</span>jerry.<span style="color: #a0522d;">age</span> += 1
</pre>
</div>
</div>
</div>
<div id="outline-container-h:0fe489d7-34f9-43c7-8b7a-3a051982391f" class="outline-5">
<h5 id="h:0fe489d7-34f9-43c7-8b7a-3a051982391f">实例对象instance</h5>
<div class="outline-text-5" id="text-h:0fe489d7-34f9-43c7-8b7a-3a051982391f">
<ul class="org-ul">
<li>上例中，Person类实例化后一定会获得一个类的实例，就是 <code>实例对象</code></li>
<li>上例中的tom、jerry就是Person类的实例</li>
</ul>

<p>
<code>__init__ 方法的第一参数 self 就是指代某一个实例自身</code>
</p>

<ul class="org-ul">
<li>执行 <code>Person('Tom' 20)</code> 时，调用 <code>__name__()</code> 方法。 self.name就是tom对象的name，
name是保存在了tom对象上，而不是Person类上。所以，称为 <code>实例变量</code></li>

<li>类实例化后，得到一个实例对象，调用方法时采用tom.showage()的方式，
但是showage方法的形参需要一个形参self，我们并没有提供，并没有报错，为什么？

<ul class="org-ul">
<li>因为是通过tom点来做的，tom虽然是限定名，但也已经说了是哪个实例在调用，
这个self就是tom，tom.showage()调用时，由解释器把方法的调用者tom实例作为第一参数self的实参传入。</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-h:dbb088de-045e-4e13-b1b8-dc24a94e9bd2" class="outline-5">
<h5 id="h:dbb088de-045e-4e13-b1b8-dc24a94e9bd2">方法绑定</h5>
<div class="outline-text-5" id="text-h:dbb088de-045e-4e13-b1b8-dc24a94e9bd2">
<p>
采用tom.showage()的方法调用时，实例对象会 <b>绑定</b> 到方法上。这个self就是tom， <b>指向当前调用该方法的实例本身</b> 。
</p>

<p>
tom.showage()调用时，会把方法的调用者tom实例作为第一参数self的实参传入 <code>__init__()</code> 方法.
</p>

<p>
范例
</p>
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">__name__ &#23450;&#20041;&#25191;&#34892;&#20043;&#21518;&#65292;&#20250;&#24471;&#21040;&#19968;&#20010;&#31867;&#23545;&#35937;
</span>    <span style="color: #8b2252;">"""An example of class"""</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18): <span style="color: #b22222;">#</span><span style="color: #b22222;">self&#27704;&#36828;&#25351;&#21521;&#24403;&#21069;&#23454;&#20363;&#33258;&#36523;&#65292;java\c++\javascript&#29992;&#30340;&#26159;this
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init ~~~~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name <span style="color: #b22222;">#</span><span style="color: #b22222;">self &#65292;&#24403;&#21069;&#23454;&#20363;&#65292;&#23454;&#20363;&#23646;&#24615;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showage</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{} is {}"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.name, <span style="color: #a020f0;">self</span>.age))

<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'Tom'</span>, 20) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#24335;&#21491;&#36793;&#20570;2&#20010;&#38454;&#27573;&#30340;&#20107;&#24773;&#65306;&#23454;&#20363;&#21270;&#21644;&#21021;&#22987;&#21270;
</span><span style="color: #a0522d;">jerry</span> = Person(<span style="color: #8b2252;">'jerry'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">init ~~~~~~~
</span>
<span style="color: #483d8b;">print</span>(tom.showage)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#23454;&#20363;.showage&#65288;showage&#23450;&#20041;&#22312;&#31867;&#20013;&#65292;showage&#26159;&#31867;&#23646;&#24615;&#65289;&#65292;python&#20250;&#24471;&#21040;&#19968;&#20010;&#32465;&#23450;bound method
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;tom&#23454;&#20363;&#32465;&#23450;&#21040;&#20102;&#31867;&#23646;&#24615;showage&#26041;&#27861;&#19978;&#20102;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#20320;&#35843;&#29992;&#35813;&#26041;&#27861;&#26102;&#65292;&#35299;&#37322;&#22120;&#25226;&#31532;&#19968;&#21442;&#25968;self&#20351;&#29992;&#23454;&#21442;tom&#27880;&#20837;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(tom), <span style="color: #483d8b;">hex</span>(<span style="color: #483d8b;">id</span>(tom)))
tom.showage() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30456;&#24403;&#20110;&#35843;&#29992; showage(tom) &#35299;&#37322;&#22120;&#33258;&#24049;&#30340;&#34892;&#20026;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;bound method Person.showage of &lt;__main__.Person object at 0x000001FE76C27CB0&gt;&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2192425778352 0x1fe76c27cb0</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:03bccf1c-0777-4dbc-8efb-f13d5e22c59b" class="outline-5">
<h5 id="h:03bccf1c-0777-4dbc-8efb-f13d5e22c59b">self</h5>
<div class="outline-text-5" id="text-h:03bccf1c-0777-4dbc-8efb-f13d5e22c59b">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">__name__ &#23450;&#20041;&#25191;&#34892;&#20043;&#21518;&#65292;&#20250;&#24471;&#21040;&#19968;&#20010;&#31867;&#23545;&#35937;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18): <span style="color: #b22222;">#</span><span style="color: #b22222;">self&#27704;&#36828;&#25351;&#21521;&#24403;&#21069;&#23454;&#20363;&#33258;&#36523;&#65292;java\c++\javascript&#29992;&#30340;&#26159;this
</span>        <span style="color: #483d8b;">print</span>(1, <span style="color: #8b2252;">'init ~~~~'</span>, <span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name <span style="color: #b22222;">#</span><span style="color: #b22222;">self &#65292;&#24403;&#21069;&#23454;&#20363;&#65292;&#23454;&#20363;&#23646;&#24615;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showme</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(2, <span style="color: #8b2252;">'who am i = {}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>)))

<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'Tom'</span>)
<span style="color: #483d8b;">print</span>(3, tom.name, <span style="color: #483d8b;">id</span>(tom))
tom.showme() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32465;&#23450;tom&#35775;&#38382;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1 init ~~~~ 2004157758976
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">3 Tom 2004157758976
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2 who am i = 2004157758976</span>
</pre>
</div>

<p>
上例说明，self就是调用者，就是tom对应的实例对象。
</p>

<p>
self这个名字只是一个惯例，它可以修改，但是请不要修改，否则影响代码的可读性
</p>
</div>
</div>
</div>
<div id="outline-container-h:8f83255a-4761-45f5-ab21-c241b1009d44" class="outline-4">
<h4 id="h:8f83255a-4761-45f5-ab21-c241b1009d44">实例变量和类变量</h4>
<div class="outline-text-4" id="text-h:8f83255a-4761-45f5-ab21-c241b1009d44">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">__name__ &#23450;&#20041;&#25191;&#34892;&#20043;&#21518;&#65292;&#20250;&#24471;&#21040;&#19968;&#20010;&#31867;&#23545;&#35937;
</span>    <span style="color: #a0522d;">age</span> = 3
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name): <span style="color: #b22222;">#</span><span style="color: #b22222;">self&#27704;&#36828;&#25351;&#21521;&#24403;&#21069;&#23454;&#20363;&#33258;&#36523;&#65292;java\c++\javascript&#29992;&#30340;&#26159;this
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name <span style="color: #b22222;">#</span><span style="color: #b22222;">self &#65292;&#24403;&#21069;&#23454;&#20363;&#65292;&#23454;&#20363;&#23646;&#24615;
</span>
<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'tom'</span>)
<span style="color: #483d8b;">print</span>(tom.name, tom.age) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21644;tom&#27809;&#26377;age&#65292;&#25152;&#20197;&#25214;&#21040;&#20102;&#31867;&#23646;&#24615; 3
</span>
<span style="color: #a0522d;">jerry</span> = Person(<span style="color: #8b2252;">'jerry'</span>)
<span style="color: #483d8b;">print</span>(jerry.name, jerry.age)

Person.<span style="color: #a0522d;">age</span> = 30  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#37325;&#26032;&#23450;&#20041;&#31867;&#23646;&#24615;
</span><span style="color: #483d8b;">print</span>(Person.age, tom.age, jerry.age)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">tom 3
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">jerry 3
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">30 30 30
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#30340;&#23646;&#24615;&#65292;&#23454;&#20363;&#21487;&#20197;&#20849;&#20139;&#12290;&#26159;&#31867;&#30340;&#65292;&#23601;&#26159;&#22823;&#23478;&#30340;
</span><span style="color: #b22222;">#</span>
</pre>
</div>

<ul class="org-ul">
<li><code>实例变量是每一个实例自己的变量，是自己独有的</code></li>
<li><code>类变量是类的变量，是类的所有实例共享的属性和方法</code></li>
</ul>
</div>
</div>
<div id="outline-container-h:0eca4440-98eb-4d46-b441-4495af00f7ef" class="outline-4">
<h4 id="h:0eca4440-98eb-4d46-b441-4495af00f7ef">特殊属性</h4>
<div class="outline-text-4" id="text-h:0eca4440-98eb-4d46-b441-4495af00f7ef">
<pre class="example" id="org6fa4729">
__name__  对象名
__class__  对象类型
__dict__  对象的属性的字典
__qualname__ 类的限定名
</pre>

<p>
注意：
Python中每一种对象都拥有不同的属性。函数、类都是对象，类的实例也是对象。
</p>
</div>
</div>
<div id="outline-container-h:5bb97101-9833-4512-9cf1-2b1520fa50bd" class="outline-4">
<h4 id="h:5bb97101-9833-4512-9cf1-2b1520fa50bd">属性的本质</h4>
<div class="outline-text-4" id="text-h:5bb97101-9833-4512-9cf1-2b1520fa50bd">
<p>
举例
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">__name__ &#23450;&#20041;&#25191;&#34892;&#20043;&#21518;&#65292;&#20250;&#24471;&#21040;&#19968;&#20010;&#31867;&#23545;&#35937;
</span>    <span style="color: #a0522d;">age</span> = 3
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name): <span style="color: #b22222;">#</span><span style="color: #b22222;">self&#27704;&#36828;&#25351;&#21521;&#24403;&#21069;&#23454;&#20363;&#33258;&#36523;&#65292;java\c++\javascript&#29992;&#30340;&#26159;this
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name <span style="color: #b22222;">#</span><span style="color: #b22222;">self &#65292;&#24403;&#21069;&#23454;&#20363;&#65292;&#23454;&#20363;&#23646;&#24615;
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'class info~~~~~'</span>)
<span style="color: #483d8b;">print</span>(Person) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class '__main__.Person'&gt;
</span><span style="color: #483d8b;">print</span>(Person.<span style="color: #483d8b;">__name__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">Person
</span><span style="color: #483d8b;">print</span>(Person.__class__, <span style="color: #483d8b;">type</span>(Person), Person.__class__ <span style="color: #a020f0;">is</span> <span style="color: #483d8b;">type</span>(Person)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21516;&#19968;&#31867;&#22411; &lt;class 'type'&gt; &lt;class 'type'&gt; True
</span><span style="color: #483d8b;">print</span>(Person.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#30340;&#23383;&#20856;&#65292;&#30475;&#21040;&#20102;age&#12289;__doc__&#12289;__init__
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'__module__': '__main__', '__firstlineno__': 1, 'age': 3, '__init__': &lt;function Person.__init__ at 0x0000019AAD044680&gt;, '__static_attributes__': ('name',), '__dict__': &lt;attribute '__dict__' of 'Person' objects&gt;, '__weakref__': &lt;attribute '__weakref__' of 'Person' objects&gt;, '__doc__': None}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#19978;&#38754;&#25152;&#26377;&#30340;key&#37117;&#26159;&#23383;&#31526;&#20018;
</span><span style="color: #483d8b;">print</span>(Person.__init__) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26631;&#35782;&#31526;&#65292;&#25104;&#21592;&#36816;&#31639;&#31526;.&#26469;&#35775;&#38382;&#65292;&#36825;&#31181;&#21483;&#23646;&#24615;&#35775;&#38382;&#25110;&#32773;&#25104;&#21592;&#35775;&#38382; &lt;function Person.__init__ at 0x0000019AAD044680&gt;
</span><span style="color: #483d8b;">print</span>(Person.__init__.<span style="color: #483d8b;">__name__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">__init__&#30340;&#21517;&#23383;&#26159;&#23383;&#31526;&#20018;  __init__
</span>
<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'tom'</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#30340;&#23646;&#24615;&#65292;&#23454;&#20363;&#21487;&#20197;&#20849;&#20139;&#12290;&#26159;&#31867;&#30340;&#65292;&#23601;&#26159;&#22823;&#23478;&#30340;&#12290;&#31867;&#23646;&#24615;&#22312;&#31867;&#23383;&#20856;&#20013;&#23384;&#20648;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23454;&#20363;&#23646;&#24615;&#65292;&#23384;&#22312;&#23454;&#20363;&#30340;&#23383;&#20856;&#20013;&#65292;&#25105;&#30340;&#23601;&#26159;&#25105;&#30340;&#12290;&#25105;&#27809;&#26377;&#65292;&#38382;&#31867;&#35201;&#65292;&#31867;&#27809;&#26377;&#65292;&#25243;&#24322;&#24120;AttributeError&#12290;
</span><span style="color: #483d8b;">print</span>(tom) <span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;__main__.Person object at 0x000002299F947CB0&gt;
</span><span style="color: #483d8b;">print</span>(tom.__class__, <span style="color: #483d8b;">type</span>(tom), tom.__class__ <span style="color: #a020f0;">is</span> <span style="color: #483d8b;">type</span>(tom)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class '__main__.Person'&gt; &lt;class '__main__.Person'&gt; True
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(tom).<span style="color: #483d8b;">__name__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">Person
</span><span style="color: #483d8b;">print</span>(tom.__class__.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35775;&#38382;&#23454;&#20363;&#30340;&#31867;&#22411;&#30340;&#23383;&#20856;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'__module__': '__main__', '__firstlineno__': 1, 'age': 3, '__init__': &lt;function Person.__init__ at 0x0000019AAD044680&gt;, '__static_attributes__': ('name',), '__dict__': &lt;attribute '__dict__' of 'Person' objects&gt;, '__weakref__': &lt;attribute '__weakref__' of 'Person' objects&gt;, '__doc__': None}
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
<span style="color: #483d8b;">print</span>(tom.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23454;&#20363;&#23383;&#20856;&#23384;&#20648;&#23454;&#20363;&#33258;&#24049;&#30340;&#23646;&#24615; {'name': 'tom'}
</span>
<span style="color: #a0522d;">jerry</span> = Person(<span style="color: #8b2252;">'jerry'</span>)
<span style="color: #483d8b;">print</span>(jerry.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">{'name': 'jerry'}</span>
</pre>
</div>


<p>
上例中，可以看到类属性保存在类的 <code>__dict__</code> 中，实例属性保存在实例的 <code>__dict__</code> 中，如果从实例访问类的属性，
也可以借助 <code>__class__</code> 找到所属的类，再通过类来访问类属性，例如 <code>tom.__class__.age</code>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a0522d;">age</span> = 3
    <span style="color: #a0522d;">height</span> = 170

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'Tom'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23454;&#20363;&#21270;&#12289;&#21021;&#22987;&#21270;
</span><span style="color: #a0522d;">jack</span> = Person(<span style="color: #8b2252;">'jack'</span>, 20)

Person.<span style="color: #a0522d;">age</span> = 30
<span style="color: #483d8b;">print</span>(1, Person.age, tom.age, jack.age)  <span style="color: #b22222;">#  </span><span style="color: #b22222;">30, 18, 20
</span><span style="color: #483d8b;">print</span>(2, Person.height, tom.height, jack.height) <span style="color: #b22222;"># </span><span style="color: #b22222;">170, 170, 170
</span>jack.<span style="color: #a0522d;">height</span> = 175 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36171;&#20540;&#21363;&#23450;&#20041;&#65292;&#23454;&#20363;&#23646;&#24615;&#65292;&#20250;&#25918;&#22312;&#23454;&#20363;&#23383;&#20856;&#20013;
</span><span style="color: #483d8b;">print</span>(3, Person.height, tom.height, jack.height) <span style="color: #b22222;"># </span><span style="color: #b22222;">170, 170, 175
</span>
tom.<span style="color: #a0522d;">height</span> += 10 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#24335;&#21491;&#36793;&#31867;&#30340;&#23646;&#24615;&#20540;&#21152;10&#65292;&#36171;&#20540;&#32473;&#23454;&#20363;&#23646;&#24615;
</span><span style="color: #483d8b;">print</span>(4, Person.height, tom.height, jack.height) <span style="color: #b22222;"># </span><span style="color: #b22222;">170, 180, 175
</span>
Person.<span style="color: #a0522d;">height</span> += 15
<span style="color: #483d8b;">print</span>(5, Person.height, tom.height, jack.height) <span style="color: #b22222;"># </span><span style="color: #b22222;">185, 180, 175
</span>
Person.<span style="color: #a0522d;">weight</span> = 70 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#23646;&#24615;&#65292;&#25918;&#22312;&#31867;&#23383;&#20856;&#20013;
</span><span style="color: #483d8b;">print</span>(6, Person.weight, tom.weight, jack.weight) <span style="color: #b22222;"># </span><span style="color: #b22222;">70, 70, 70
</span>
<span style="color: #483d8b;">print</span>(7, tom.<span style="color: #483d8b;">__dict__</span>[<span style="color: #8b2252;">'height'</span>]) <span style="color: #b22222;"># </span><span style="color: #b22222;">180
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(8, tom.__dict__['weight']) # KeyError</span>
</pre>
</div>
</div>
<div id="outline-container-h:98f5b989-5abd-41b0-aafc-28c8388fa6c5" class="outline-6">
<h6 id="h:98f5b989-5abd-41b0-aafc-28c8388fa6c5">总结</h6>
<div class="outline-text-6" id="text-h:98f5b989-5abd-41b0-aafc-28c8388fa6c5">
<ol class="org-ol">
<li>是类的，也是这个类所有实例的，其实例都可以访问</li>
<li>是实例的，就是这个实例自己的，通过类访问不到</li>
<li>类变量是属于类的变量，这个类的所有实例可以 <b>共享</b> 这个变量</li>
<li>对象（实例或类）可以动态的给自己增加一个属性（赋值即定义一个新属性）</li>
<li><code>实例.__dict__[变量名]</code> 和 <code>实例.变量名</code>
都可以访问到实例自己的属性（注意这两种访问是有本质区别的）</li>
<li>实例的同名变量会 <code>隐藏</code> 掉类变量，或者说是覆盖了这个类变量。但是注意类变量还在那里，并没有真正被覆盖</li>
</ol>

<p>
<code>实例属性的查找顺序</code>
</p>

<ul class="org-ul">
<li>指的是实例使用 <code>.点号</code> 来访问属性，会先找自己的 <code>__dict__</code>, 如果没有，然后通过属性 <code>__class__</code> 找到自己的类，再去类的 <code>__dict__</code> 中找</li>
</ul>

<p>
注意：如果实例使用 <code>__dict__[变量名]</code> 访问变量，将不会按照上面的查找顺序找变量了，这是指明使用 <code>字典的key</code> 查找，不是属性查找
</p>

<p>
一般来说， <code>类变量可使用全大写来命名</code>
</p>
</div>
</div>
</div>
<div id="outline-container-h:3f6d53bf-22ea-4a7c-b781-81b7ba62d05f" class="outline-4">
<h4 id="h:3f6d53bf-22ea-4a7c-b781-81b7ba62d05f">类方法和静态方法</h4>
<div class="outline-text-4" id="text-h:3f6d53bf-22ea-4a7c-b781-81b7ba62d05f">
<p>
前面的例子中定义的 <code>__init__</code> 等方法，这些方法本身都是类的属性，第一个参数必须是self，而self必须指向一个对象，也就是类实例化之后，由实例来调用这个方法。
</p>
</div>
<div id="outline-container-h:e4193cf2-3434-412e-8500-dd5f824dee0c" class="outline-5">
<h5 id="h:e4193cf2-3434-412e-8500-dd5f824dee0c">装饰一个类</h5>
<div class="outline-text-5" id="text-h:e4193cf2-3434-412e-8500-dd5f824dee0c">
<p>
需求，为一个类通过装饰，增加一些类属性。例如能否给一个类增加一个NAME类属性并提供属性值
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#22686;&#21152;&#31867;&#21464;&#37327;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add_name</span>(name, cls):
    cls.<span style="color: #a0522d;">NAME</span> = name <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21160;&#24577;&#22686;&#21152;&#31867;&#23646;&#24615;
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25913;&#36827;&#35013;&#39280;&#22120;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add_name</span>(name):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(cls):
        cls.<span style="color: #a0522d;">NAME</span> = name
        <span style="color: #a020f0;">return</span> cls
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@add_name</span>(<span style="color: #8b2252;">'Tom'</span>)
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a0522d;">AGE</span> = 3

<span style="color: #483d8b;">print</span>(Person.NAME)
</pre>
</div>

<ul class="org-ul">
<li>之所以能够装饰，本质上是为类对象动态的添加了一个属性，而Person这个标识符指向这个类对象</li>
</ul>
</div>
</div>
<div id="outline-container-h:c6e29535-7964-404a-9d3f-0a27e271d89c" class="outline-5">
<h5 id="h:c6e29535-7964-404a-9d3f-0a27e271d89c">普通方法</h5>
<div class="outline-text-5" id="text-h:c6e29535-7964-404a-9d3f-0a27e271d89c">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #b22222;"># </span><span style="color: #b22222;">def method(self):
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">print('&#26222;&#36890;&#26041;&#27861;&#65292; &#23454;&#20363;&#26041;&#27861;', self)
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">normal_function</span>():
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#26222;&#36890;&#26041;&#27861;'</span>)

Person.normal_function() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238; &#26222;&#36890;&#26041;&#27861;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1 Person.normal_function &#25214;&#31867;&#23646;&#24615;&#65292;&#25214;&#21040;&#20102;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">2 fn() &#23545;&#30340;&#65292;&#27809;&#38382;&#39064;&#65292;&#22240;&#20026;&#26080;&#21442;&#65292;&#19968;&#20010;&#20351;&#29992;&#31867;&#38480;&#23450;&#21517;&#30340;&#26222;&#36890;&#20989;&#25968;&#35843;&#29992;&#32610;&#20102;
</span>
Person().normal_function() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25253;&#38169;TypeError: Person.normal_function() takes 0 positional arguments but 1 was given
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1 Person().normal_function &#23454;&#20363;.&#23646;&#24615;  &#23454;&#20363;&#23646;&#24615;&#30340;&#25628;&#32034;&#35268;&#21017;&#65292;&#25214;&#19981;&#21040;&#21435;&#31867;&#19978;&#25214;&#35813;&#23646;&#24615;&#65292;fn
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#30001;&#20110;normal_function&#26159;&#31867;&#23646;&#24615;&#65292;&#28982;&#21518;&#36890;&#36807;&#23454;&#20363;&#35843;&#29992;&#35813;&#31867;&#23646;&#24615;&#65292;&#25152;&#20197;&#36820;&#22238;&#19981;&#20165;&#20165;&#26159;&#19968;&#20010;&#26222;&#36890;&#20989;&#25968;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26159;boud method  self -&gt; Person()
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">2 Person().normal_function() &#35843;&#29992;&#26159;&#23454;&#38469;&#35299;&#37322;&#22120;&#20026;&#20320;&#27880;&#20837;&#31532;&#19968;&#20010;&#21442;&#25968;Person()
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">Person().normal_function&#20182;&#27809;&#26377;&#24418;&#21442;&#65292;Person()&#26080;&#27861;&#21487;&#27880;&#20837;</span>
</pre>
</div>

<p>
注意：虽然语法是对的，但是，没有人么用，也就是说 <b>禁止</b> 这么写
</p>
</div>
</div>
<div id="outline-container-类方法" class="outline-5">
<h5 id="类方法">类方法</h5>
<div class="outline-text-5" id="text-类方法">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #b22222;"># </span><span style="color: #b22222;">def method(self):
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">print('&#26222;&#36890;&#26041;&#27861;&#65292; &#23454;&#20363;&#26041;&#27861;', self)
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">def normal_function():
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">print('&#26222;&#36890;&#26041;&#27861;')
</span>    @<span style="color: #483d8b;">classmethod</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20869;&#24314;&#20989;&#25968;&#65292;&#35013;&#39280;&#22120;&#20869;&#37096;&#33719;&#21462;&#20102;&#31867;&#22411;&#20449;&#24687;&#65292;&#24182;&#32465;&#23450;&#36825;&#20010;&#31867;&#22411;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">cls_mtd</span>(cls): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#23646;&#24615;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#31867;&#26041;&#27861;'</span>,cls) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27880;&#20837;&#31867;&#22411;
</span>
Person.cls_mtd() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#31867;&#35843;&#29992;&#26041;&#27861;&#65292;&#21487;&#20197; #&#31867;&#26041;&#27861; &lt;class '__main__.Person'&gt;
</span>Person().cls_mtd() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#30340;&#23454;&#20363;.cls_mtd()&#65292; &#21487;&#20197; #&#31867;&#26041;&#27861; &lt;class '__main__.Person'&gt;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#27880;&#20837;
</span><span style="color: #483d8b;">print</span>(Person.cls_mtd) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32465;&#23450;&#31867; &lt;bound method Person.cls_mtd of &lt;class '__main__.Person'&gt;&gt;
</span><span style="color: #483d8b;">print</span>(Person().cls_mtd) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26412;&#26469;&#32465;&#23450;&#23454;&#20363;&#30340;&#31867;&#22411; &lt;bound method Person.cls_mtd of &lt;class '__main__.Person'&gt;&gt;</span>
</pre>
</div>

<ol class="org-ol">
<li>在类定义中，使用 <code>@classmethod</code> 装饰器修饰的方法</li>
<li>必须至少有一个参数，且第一个参数留给了cls，cls指代调用者即类对象自身</li>
<li>cls这个标识符可以是任意合法名称，但是为了易读，请不要修改</li>
<li>通过cls可以直接操作类的属性</li>

<li><p>
注意：无法通过cls操作类的实例
</p>

<p>
类方法，类似于C++、Java中的静态方法
</p></li>
</ol>
</div>
</div>
<div id="outline-container-h:05c275cb-d6c4-458c-a252-9c2d34cc6c99" class="outline-5">
<h5 id="h:05c275cb-d6c4-458c-a252-9c2d34cc6c99">静态方法</h5>
<div class="outline-text-5" id="text-h:05c275cb-d6c4-458c-a252-9c2d34cc6c99">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">method</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#26222;&#36890;&#26041;&#27861;&#65292; &#23454;&#20363;&#26041;&#27861;'</span>, <span style="color: #a020f0;">self</span>)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">def normal_function():
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">print('&#26222;&#36890;&#26041;&#27861;')
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">@classmethod #&#20869;&#24314;&#20989;&#25968;&#65292;&#35013;&#39280;&#22120;&#20869;&#37096;&#33719;&#21462;&#20102;&#31867;&#22411;&#20449;&#24687;&#65292;&#24182;&#32465;&#23450;&#36825;&#20010;&#31867;&#22411;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">def cls_mtd(cls): #&#31867;&#23646;&#24615;
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">print('&#31867;&#26041;&#27861;',cls) #&#27880;&#20837;&#31867;&#22411;
</span>
    @<span style="color: #483d8b;">staticmethod</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35013;&#39280;&#22120;&#65292;&#20869;&#24314;&#20989;&#25968;&#12290;&#35843;&#29992;&#20989;&#25968;&#65292;&#23601;&#27809;&#26377;&#32465;&#23450;&#25928;&#26524;&#65292;&#19981;&#20250;&#27880;&#20837;&#31532;&#19968;&#21442;&#25968;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">static_mtd</span>():
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#38745;&#24577;&#26041;&#27861;~~~~'</span>)

Person.static_mtd() <span style="color: #b22222;">#</span><span style="color: #b22222;">
</span>Person().static_mtd() <span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #483d8b;">print</span>(Person.static_mtd) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;function Person.static_mtd at 0x00000284C59E39C0&gt;
</span><span style="color: #483d8b;">print</span>(Person().static_mtd) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;function Person.static_mtd at 0x00000284C59E39C0&gt;
</span><span style="color: #483d8b;">print</span>(Person.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">{'__module__': '__main__', '__firstlineno__': 1, 'static_mtd': &lt;staticmethod(&lt;function Person.static_mtd at 0x00000284C59E39C0&gt;)&gt;, '__static_attributes__': (), '__dict__': &lt;attribute '__dict__' of 'Person' objects&gt;, '__weakref__': &lt;attribute '__weakref__' of 'Person' objects&gt;, '__doc__': None}
</span>

<span style="color: #a0522d;">tom</span> = Person()
tom.method() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238; &#26222;&#36890;&#26041;&#27861;&#65292; &#23454;&#20363;&#26041;&#27861; &lt;__main__.Person object at 0x000001E98D997390&gt;
</span><span style="color: #483d8b;">print</span>(Person.method) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;function Person.method at 0x000001E98D9C39C0&gt;
</span><span style="color: #483d8b;">print</span>(Person().method) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238; &lt;bound method Person.method of &lt;__main__.Person object at 0x000001E98D829E00&gt;&gt;
</span>Person.method(Person()) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238; &#26222;&#36890;&#26041;&#27861;&#65292; &#23454;&#20363;&#26041;&#27861; &lt;__main__.Person object at 0x000001E98D829E00&gt;
</span>Person.method(<span style="color: #483d8b;">str</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238; &#26222;&#36890;&#26041;&#27861;&#65292; &#23454;&#20363;&#26041;&#27861; &lt;class 'str'&gt;
</span>Person.method([1,2,3]) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238; &#26222;&#36890;&#26041;&#27861;&#65292; &#23454;&#20363;&#26041;&#27861; [1, 2, 3]
</span>Person.method(tom) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26222;&#36890;&#35775;&#38382;&#65292;&#27809;&#26377;&#32465;&#12290;&#20294;&#26159;&#25928;&#26524;&#21644; tom.method() &#31561;&#20215;</span>
</pre>
</div>

<ol class="org-ol">
<li>在类定义中，使用 @staticmethod 装饰器修饰的方法</li>
<li><p>
调用时，不会隐式的传入参数
</p>

<p>
静态方法，只是表明这个方法属于这个名词空间。函数归在一起，方便组织管理
</p></li>
</ol>
</div>
</div>
<div id="outline-container-h:2a5be35e-ff37-48ae-9c89-6812410d1efc" class="outline-5">
<h5 id="h:2a5be35e-ff37-48ae-9c89-6812410d1efc">方法的调用</h5>
<div class="outline-text-5" id="text-h:2a5be35e-ff37-48ae-9c89-6812410d1efc">
<ul class="org-ul">
<li>类几乎可以调用所有内部定义的方法，但是调用普通的方法时会报错，原因是第一参数必须是类的实例</li>
<li>实例也几乎可以调用所有的方法，普通的函数的调用一般不可能出现，因为不允许这么定义</li>
</ul>

<p>
总结：
</p>
<ul class="org-ul">
<li>类除了普通方法都可以调用，普通方法需要对象的实例作为第一参数</li>
<li>实例可以调用所有类中定义的方法（包括类方法、静态方法），普通方法传入实例自身，静态方法和类方法需要找到实例的类</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">method</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{}"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>))
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{}"</span>.<span style="color: #483d8b;">format</span>(__class__))
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{}"</span>.<span style="color: #483d8b;">format</span>(__class__.<span style="color: #483d8b;">__name__</span>))
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{}"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">__name__</span>))

<span style="color: #a0522d;">tom</span> = Person()
tom.method()
Person.method(1)
Person.method(tom)
tom.__class__.method(tom)
</pre>
</div>

<ul class="org-ul">
<li>tom.method()调用的时候，会绑定实例，调用method方法时，实例tom会注到method中，这样第一参数就满足了。</li>
<li>Person.method()，使用类调用，不会有实例绑定，调用method方法时，就缺少了第一参数，可以手动的填入</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:dcc5d44b-cb57-48df-8b3d-615658ed1e0f" class="outline-4">
<h4 id="h:dcc5d44b-cb57-48df-8b3d-615658ed1e0f">访问控制</h4>
<div class="outline-text-4" id="text-h:dcc5d44b-cb57-48df-8b3d-615658ed1e0f">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">growup</span>(<span style="color: #a020f0;">self</span>, i=1):
        <span style="color: #a020f0;">if</span> i &gt; 0 <span style="color: #a020f0;">and</span> i &lt; 150: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25511;&#21046;&#36923;&#36753;
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> += 1

<span style="color: #a0522d;">p1</span> = Person(<span style="color: #8b2252;">'tom'</span>)
p1.growup(20) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#24120;&#30340;&#33539;&#22260;
</span><span style="color: #483d8b;">print</span>(p1.age) <span style="color: #b22222;"># </span><span style="color: #b22222;">19
</span>p1.<span style="color: #a0522d;">age</span> = 160 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36229;&#36807;&#20102;&#33539;&#22260;&#65292;&#24182;&#32469;&#36807;&#20102;&#25511;&#21046;&#36923;&#36753;
</span><span style="color: #483d8b;">print</span>(p1.age) <span style="color: #b22222;"># </span><span style="color: #b22222;">160</span>
</pre>
</div>

<p>
上例，本来是想通过方法控制属性，但是由于属性在外部可以访问，或者说可见，就可以
直接绕过方法，直接修改这个属性。
</p>

<p>
Python提供了私有属性可以解决这个问题
</p>
</div>
<div id="outline-container-h:2942928f-1833-4c3a-87c0-75bd45a41c84" class="outline-5">
<h5 id="h:2942928f-1833-4c3a-87c0-75bd45a41c84">私有（Private）属性</h5>
<div class="outline-text-5" id="text-h:2942928f-1833-4c3a-87c0-75bd45a41c84">
<p>
使用 <code>__</code> 双下划线开头的属性名，就是私有属性
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">growup</span>(<span style="color: #a020f0;">self</span>, i=1):
        <span style="color: #a020f0;">if</span> i &gt; 0 <span style="color: #a020f0;">and</span> i &lt; 150: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25511;&#21046;&#36923;&#36753;
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> += 1

<span style="color: #a0522d;">p1</span> = Person(<span style="color: #8b2252;">'tom'</span>)
p1.growup(20) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#24120;&#30340;&#33539;&#22260;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(p1.__age) # &#35775;&#38382;&#19981;&#21040;</span>
</pre>
</div>

<ul class="org-ul">
<li>通过实验可以看出，外部已经访问不到 <code>__age</code> 了，age根本就没有定义，更是访问不到。</li>
<li>那么，如何访问这个私有变量 <code>__age</code> 呢？</li>
</ul>

<p>
使用方法访问
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">growup</span>(<span style="color: #a020f0;">self</span>, i=1):
        <span style="color: #a020f0;">if</span> i &gt; 0 <span style="color: #a020f0;">and</span> i &lt; 150: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25511;&#21046;&#36923;&#36753;
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> += 1

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">getage</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__age

<span style="color: #483d8b;">print</span>(Person(<span style="color: #8b2252;">'tom'</span>).getage()) <span style="color: #b22222;"># </span><span style="color: #b22222;">18</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:74b8d693-58d0-4b86-9f92-647e198add20" class="outline-5">
<h5 id="h:74b8d693-58d0-4b86-9f92-647e198add20">私有成员</h5>
<div class="outline-text-5" id="text-h:74b8d693-58d0-4b86-9f92-647e198add20">
<p>
在Python中，在类变量或实例变量前使用两个下划线的变量，称为私有成员，包括私有属性、私有方法。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23646;&#24615;&#20351;&#29992;&#20102;&#21452;&#19979;&#21010;&#32447;&#21152;&#23646;&#24615;&#21517;&#30340;&#26041;&#24335;&#65292;self._Person__age = age
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__growup</span>(<span style="color: #a020f0;">self</span>, i=1): <span style="color: #b22222;"># </span><span style="color: #b22222;">_Person__growup
</span>        <span style="color: #a020f0;">if</span> i &gt; 1 <span style="color: #a020f0;">and</span> i &lt; 150: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25511;&#21046;&#36923;&#36753;
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> += 1 <span style="color: #b22222;"># </span><span style="color: #b22222;">self._Person__age += 1
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">getage</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">public
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__age <span style="color: #b22222;">#</span><span style="color: #b22222;">private &#31561;&#20215; self._Person__age
</span>
<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'tom'</span>)
<span style="color: #483d8b;">print</span>(tom.getage()) <span style="color: #b22222;">#</span><span style="color: #b22222;">18
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(tom.age) #&#25253;&#38169; AttributeError: 'Person' object has no attribute 'age'
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(tom.__age) #&#25253;&#38169; AttributeError: 'Person' object has no attribute '__age'
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">tom.__growup(20) #&#25253;&#38169; AttributeError: 'Person' object has no attribute '__growup'
</span>
tom.<span style="color: #a0522d;">__age</span> = 101 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36171;&#20540;&#21363;&#23450;&#20041;&#65292;&#27809;&#26377;&#25913;&#21517;&#65292;&#22240;&#20026;&#22312;&#31867;&#22806;&#12290;
</span><span style="color: #483d8b;">print</span>(tom.__age) <span style="color: #b22222;">#</span><span style="color: #b22222;">101
</span><span style="color: #483d8b;">print</span>(tom.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">{'name': 'tom', '_Person__age': 18, '__age': 101}
</span><span style="color: #483d8b;">print</span>(tom.getage()) <span style="color: #b22222;">#</span><span style="color: #b22222;">18</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:3df9a402-2857-4b54-a61c-06eaacb1c525" class="outline-5">
<h5 id="h:3df9a402-2857-4b54-a61c-06eaacb1c525">私有变量的本质</h5>
<div class="outline-text-5" id="text-h:3df9a402-2857-4b54-a61c-06eaacb1c525">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">Python&#23545;&#35937;&#27169;&#22411;&#20351;&#29992;&#20102;&#23383;&#20856;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#31169;&#26377;&#25104;&#21592; __&#25104;&#21592;&#21517;&#65292;&#22914;&#26524;&#22312;&#31867;&#20013;&#23450;&#20041;&#65292;&#37117;&#20250;&#34987;&#35299;&#37322;&#22120;&#25913;&#21517;&#65292;_&#24403;&#21069;&#31867;+&#31169;&#26377;&#25104;&#21592;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;&#19978;&#38754;&#30340;&#25913;&#21517;&#26041;&#26696;&#20043;&#21518;&#65292;&#36896;&#25104;&#19968;&#31181;&#22312;&#31867;&#22806;&#26080;&#27861;&#20351;&#29992; &#38480;&#23450;&#21517;.__&#25104;&#21592;&#21517; &#35775;&#38382;&#21040;&#23646;&#24615;&#30340;&#29616;&#35937;&#65292;&#38544;&#34255;&#12290;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20307;&#20250;&#19968;&#19979;&#65292;&#20160;&#20040;&#21483;&#20570;&#31169;&#26377;&#65292;&#19981;&#20844;&#24320;&#30340;&#12290;&#31163;&#24320;&#20102;&#31867;&#23450;&#20041;&#29615;&#22659;&#65292;&#19981;&#33021;&#35775;&#38382;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">Python&#30340;&#31867;&#23383;&#20856;&#12289;&#23454;&#20363;&#23383;&#20856;&#26159;&#20844;&#24320;&#30340;&#65292;&#25152;&#20197;&#21487;&#20197;&#35775;&#38382;&#12290;&#20294;&#26159;&#20854;&#20182;&#39640;&#32423;&#35821;&#35328;&#65292;&#31169;&#26377;&#30340;&#26080;&#27861;&#35775;&#38382;&#12290;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#21040;&#19975;&#19981;&#24471;&#20197;&#65292;&#19981;&#35201;&#29992;&#36825;&#31181;&#26041;&#24335;&#35775;&#38382;
</span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23646;&#24615;&#20351;&#29992;&#20102;&#21452;&#19979;&#21010;&#32447;&#21152;&#23646;&#24615;&#21517;&#30340;&#26041;&#24335;&#65292;self._Person__age = age
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__growup</span>(<span style="color: #a020f0;">self</span>, i=1): <span style="color: #b22222;"># </span><span style="color: #b22222;">_Person__growup
</span>        <span style="color: #a020f0;">if</span> i &gt; 1 <span style="color: #a020f0;">and</span> i &lt; 150: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25511;&#21046;&#36923;&#36753;
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> += 1 <span style="color: #b22222;"># </span><span style="color: #b22222;">self._Person__age += 1
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">getage</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">public
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__age <span style="color: #b22222;">#</span><span style="color: #b22222;">private &#31561;&#20215; self._Person__age
</span>
<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'tom'</span>)
<span style="color: #483d8b;">print</span>(tom.getage()) <span style="color: #b22222;">#</span><span style="color: #b22222;">18
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(tom.age) #&#25253;&#38169; AttributeError: 'Person' object has no attribute 'age'
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print(tom.__age) #&#25253;&#38169; AttributeError: 'Person' object has no attribute '__age'
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">tom.__growup(20) #&#25253;&#38169; AttributeError: 'Person' object has no attribute '__growup'
</span>
tom.<span style="color: #a0522d;">__age</span> = 101 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36171;&#20540;&#21363;&#23450;&#20041;&#65292;&#27809;&#26377;&#25913;&#21517;&#65292;&#22240;&#20026;&#22312;&#31867;&#22806;&#12290;
</span><span style="color: #483d8b;">print</span>(tom.__age) <span style="color: #b22222;">#</span><span style="color: #b22222;">101
</span><span style="color: #483d8b;">print</span>(tom.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">{'name': 'tom', '_Person__age': 18, '__age': 101}
</span><span style="color: #483d8b;">print</span>(tom.getage()) <span style="color: #b22222;">#</span><span style="color: #b22222;">18
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31169;&#26377;&#30340;&#22312;&#22806;&#37096;&#23601;&#19981;&#35201;&#36825;&#31181;&#26041;&#24335;&#35775;&#38382;&#65292;&#29992;&#20844;&#24320;&#30340;
</span><span style="color: #483d8b;">print</span>(tom.__class__.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">{'__module__': '__main__', '__firstlineno__': 4, '__init__': &lt;function Person.__init__ at 0x0000028065194680&gt;, '_Person__growup': &lt;function Person.__growup at 0x0000028065194D60&gt;, 'getage': &lt;function Person.getage at 0x00000280652F71A0&gt;, '__static_attributes__': ('__age', 'name'), '__dict__': &lt;attribute '__dict__' of 'Person' objects&gt;, '__weakref__': &lt;attribute '__weakref__' of 'Person' objects&gt;, '__doc__': None}
</span><span style="color: #483d8b;">print</span>(tom._Person__growup(50)) <span style="color: #b22222;">#</span><span style="color: #b22222;">19</span>
</pre>
</div>

<p>
秘密都在 <code>__dict__</code> 中，原来私有成员都被改名了。
</p>

<p>
私有变量的本质：
</p>
<ul class="org-ul">
<li>类定义的时候，如果声明一个实例变量的时候，使用双下划线，Python解释器会将其 <code>改名</code> ，转换名称为
<code>_类名__变量名</code> 的名称，使用原来的名字访问不到了</li>
</ul>

<p>
使用私有变量变更名，修改其属性
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__growup</span>(<span style="color: #a020f0;">self</span>, i=1):
        <span style="color: #a020f0;">if</span> i &gt; 0 <span style="color: #a020f0;">and</span> i &lt; 150: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25511;&#21046;&#36923;&#36753;
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> += 1

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">getage</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__age

<span style="color: #a0522d;">p1</span> = Person(<span style="color: #8b2252;">'tom'</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#30452;&#25509;&#20462;&#25913;&#31169;&#26377;&#21464;&#37327;
</span>p1.<span style="color: #a0522d;">_Person__age</span> = 15
<span style="color: #483d8b;">print</span>(p1.getage()) <span style="color: #b22222;"># </span><span style="color: #b22222;">15
</span><span style="color: #483d8b;">print</span>(p1.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">{'name': 'tom', '_Person__age': 15, '__age': 28}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:f95159e7-23fe-41e4-924b-7c02b6eb33b7" class="outline-5">
<h5 id="h:f95159e7-23fe-41e4-924b-7c02b6eb33b7">保护成员</h5>
<div class="outline-text-5" id="text-h:f95159e7-23fe-41e4-924b-7c02b6eb33b7">
<p>
在变量名前使用一个 <code>_</code> 下划线，称为保护成员。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_getname</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27809;&#25913;&#21517;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._name

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">getage</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;"># </span><span style="color: #b22222;">
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__age

<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'tom'</span>)
<span style="color: #483d8b;">print</span>(tom._name, tom._getname())  <span style="color: #b22222;">#</span><span style="color: #b22222;">tom tom
</span><span style="color: #483d8b;">print</span>(tom.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#  </span><span style="color: #b22222;">{'_name': 'tom', '_Person__age': 18}
</span><span style="color: #483d8b;">print</span>(Person.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">{'__module__': '__main__', '__firstlineno__': 1, '__init__': &lt;function Person.__init__ at 0x00000146586D1440&gt;, '_getname': &lt;function Person._getname at 0x00000146588AC540&gt;, 'getage': &lt;function Person.getage at 0x0000014658914F40&gt;, '__static_attributes__': ('__age', '_name'), '__dict__': &lt;attribute '__dict__' of 'Person' objects&gt;, '__weakref__': &lt;attribute '__weakref__' of 'Person' objects&gt;, '__doc__': None}</span>
</pre>
</div>

<ul class="org-ul">
<li>可以看出，保护成员没有改名，解释器不做任何特殊处理。</li>
<li>这只是开发者共同的约定，看见这种变量，就如同私有变量，不要直接使用。</li>
</ul>
</div>
</div>
<div id="outline-container-h:7c34aa33-9dbe-49ae-a0fa-fa747b2e3730" class="outline-5">
<h5 id="h:7c34aa33-9dbe-49ae-a0fa-fa747b2e3730">访问控制的总结</h5>
<div class="outline-text-5" id="text-h:7c34aa33-9dbe-49ae-a0fa-fa747b2e3730">
<p>
在Python中使用 <code>_=单下划线 或者 =__</code> 双下划线来标识一个成员被保护或者被私有化隐藏起来。
</p>

<p>
但是，不管使用什么样的访问控制，都不能真正的阻止用户修改类的成员。Python中没有绝对的安全的保护成员或者私有成员。
</p>

<p>
因此，前导的下划线只是一种警告或者提醒，遵守这个约定。除非真有必要，不要修改或者使用保护成员或者私有成员，更不要修改它们。
</p>
</div>
</div>
</div>
<div id="outline-container-h:24a2b1d7-9078-4a36-a411-d76c6f713062" class="outline-4">
<h4 id="h:24a2b1d7-9078-4a36-a411-d76c6f713062">补丁</h4>
<div class="outline-text-4" id="text-h:24a2b1d7-9078-4a36-a411-d76c6f713062">
<p>
可以通过修改或者替换类的成员。使用者调用的方式没有改变，但是，类提供的功能可能已经改变了。
</p>

<p>
猴子补丁（Monkey Patch）： <code>（慎用）</code>
</p>
<ul class="org-ul">
<li>在运行时，对属性、方法、函数等进行动态替换。</li>
<li>其目的往往是为了通过替换、修改来增强、扩展原有代码的能力。</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">t1.py
</span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_score</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">from mysql&#25968;&#25454;&#24211;
</span>        <span style="color: #a020f0;">return</span> {<span style="color: #8b2252;">'English'</span>:25, <span style="color: #8b2252;">'Chinese'</span>:20}

<span style="color: #b22222;"># </span><span style="color: #b22222;">t2.py
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_score</span>(<span style="color: #a020f0;">self</span>):
    <span style="color: #a020f0;">return</span> {<span style="color: #8b2252;">'English'</span>:80, <span style="color: #8b2252;">'Chinese'</span>:76}

<span style="color: #b22222;"># </span><span style="color: #b22222;">t3.py
</span><span style="color: #a020f0;">from</span> t1 <span style="color: #a020f0;">import</span> Person
<span style="color: #a020f0;">from</span> t2 <span style="color: #a020f0;">import</span> get_score

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">mokeypatch4Person</span>(cls):
    cls.<span style="color: #a0522d;">get_score</span> = get_score

mokeypatch4Person(Person)

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">"__main__"</span>:
    <span style="color: #483d8b;">print</span>(Person().get_score()) 

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#32467;&#26524;
</span>{<span style="color: #8b2252;">'English'</span>: 80, <span style="color: #8b2252;">'Chinese'</span>: 76}
</pre>
</div>

<ul class="org-ul">
<li>上例中，假设Person类get_score方法是从数据库拿数据，但是测试的时候，不方便</li>
<li>为了测试时方便，使用猴子补丁，替换了get_score方法，返回模拟的数据</li>
</ul>
</div>
</div>
<div id="outline-container-h:46d65227-d516-4146-ab98-9543859f2f84" class="outline-4">
<h4 id="h:46d65227-d516-4146-ab98-9543859f2f84">属性装饰器</h4>
<div class="outline-text-4" id="text-h:46d65227-d516-4146-ab98-9543859f2f84">
<p>
一般好的设计是：把实例的某些属性保护起来，不让外部直接访问，外部使用 <code>getter</code> 读取属性和 <code>setter</code> 方法设置属性。
</p>

<ul class="org-ul">
<li>Python提供了属性property装饰器</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age

    @<span style="color: #483d8b;">property</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#35835;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">age</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__age

    <span style="color: #228b22;">@age.setter</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20889;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">age</span>(<span style="color: #a020f0;">self</span>, age):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age

    <span style="color: #228b22;">@age.deleter</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">age</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">del self.__age
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'del'</span>)

<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'Tom'</span>)
<span style="color: #483d8b;">print</span>(tom.age) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#21040;&#20102;getter 18
</span>tom.<span style="color: #a0522d;">age</span> = 20  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#21040;&#20102;stter
</span><span style="color: #483d8b;">print</span>(tom.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">{'name': 'Tom', '_Person__age': 20}
</span><span style="color: #483d8b;">print</span>(tom.age) <span style="color: #b22222;"># </span><span style="color: #b22222;">20
</span><span style="color: #a020f0;">del</span> tom.age <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;@age.deleter&#19979;&#20989;&#25968;&#65292;&#25171;&#21360;del</span>
</pre>
</div>

<p>
特别注意: 使用property装饰器的时候这三个方法同名
</p>

<p>
property装饰器
</p>
<ul class="org-ul">
<li>后面跟的函数名就是以后的属性名。它就是getter。这个必须有，有了它至少是只读属性</li>
<li>setter装饰器
<ul class="org-ul">
<li>与属性名同名，且接收2个参数，第一个是self，第二个是将要赋值的值。有了它，属性可写</li>
</ul></li>
<li>deleter装饰器
<ul class="org-ul">
<li>可以控制是否删除属性。很少用</li>
</ul></li>
<li>property装饰器必须在前，setter、deleter装饰器在后</li>
<li>property装饰器能通过简单的方式，把对方法的操作变成对属性的访问，并起到了一定隐藏效果</li>
</ul>

<p>
其它的写法
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">getage</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">setage</span>(<span style="color: #a020f0;">self</span>, age):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">delage</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">def self.__age
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'del'</span>)

    <span style="color: #a0522d;">age</span> = <span style="color: #483d8b;">property</span>(getage, setage, delage, <span style="color: #8b2252;">'age property'</span>)

<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'Tom'</span>)
<span style="color: #483d8b;">print</span>(tom.age) <span style="color: #b22222;"># </span><span style="color: #b22222;">18
</span>tom.<span style="color: #a0522d;">age</span> = 20
<span style="color: #483d8b;">print</span>(tom.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">{'name': 'Tom', '_Person__age': 20}
</span><span style="color: #483d8b;">print</span>(tom.age) <span style="color: #b22222;"># </span><span style="color: #b22222;">20
</span><span style="color: #a020f0;">del</span> tom.age <span style="color: #b22222;"># </span><span style="color: #b22222;">del</span>
</pre>
</div>

<p>
还可以如下
</p>

<div class="org-src-container">
<pre class="src src-python"> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age

    <span style="color: #a0522d;">age</span> = <span style="color: #483d8b;">property</span>(<span style="color: #a020f0;">lambda</span> <span style="color: #a020f0;">self</span>:<span style="color: #a020f0;">self</span>.__age)

<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'Tom'</span>)
<span style="color: #483d8b;">print</span>(tom.age) <span style="color: #b22222;"># </span><span style="color: #b22222;">18</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:9be004ed-7bdb-42cd-85e5-567bd48af4a1" class="outline-4">
<h4 id="h:9be004ed-7bdb-42cd-85e5-567bd48af4a1">对象的销毁</h4>
<div class="outline-text-4" id="text-h:9be004ed-7bdb-42cd-85e5-567bd48af4a1">
<ul class="org-ul">
<li>类中可以定义 <code>__del__</code> 方法，称为析构函数（方法）</li>
<li>作用：销毁类的实例的时候调用，以释放占用的资源。其中就放些清理资源的代码，比如释放连接</li>
<li>注意这个方法不能引起对象的真正销毁，只是对象销毁的时候会自动调用它</li>
<li>使用del语句删除实例，引用计数减1。当引用计数为0时，会自动调用
<code>__del__</code> 方法。
由于Python实现了垃圾回收机制，不能确定对象何时执行垃圾回收</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__del__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'delete {}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.name))

<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'tom'</span>)
tom.__del__() <span style="color: #b22222;"># </span><span style="color: #b22222;">delete tom
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'======statr======'</span>)
<span style="color: #a0522d;">tom2</span> = tom
<span style="color: #a0522d;">tom3</span> = tom
<span style="color: #a020f0;">del</span> tom
<span style="color: #483d8b;">print</span>(2, <span style="color: #8b2252;">'del'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">2 del
</span><span style="color: #a020f0;">del</span> tom2 <span style="color: #b22222;"># </span><span style="color: #b22222;">delete tom
</span><span style="color: #a020f0;">del</span> tom3
</pre>
</div>

<p>
由于垃圾回收对象销毁时，才会真正清理对象，还会在回收对象之前自动调用
<code>__del__</code> 方法，除非你明确知道自 己的目的，建议不要手动调用这个方法。
</p>
</div>
</div>
<div id="outline-container-h:37384441-358a-4dfb-89cf-2119580c3245" class="outline-4">
<h4 id="h:37384441-358a-4dfb-89cf-2119580c3245">方法重载(overload)</h4>
<div class="outline-text-4" id="text-h:37384441-358a-4dfb-89cf-2119580c3245">
<ul class="org-ul">
<li>其他面向对象的高级语言中，会有重载的概念</li>
<li>所谓重载，就是同一个方法名，但是参数个数、类型不一样，就是同一个方法的重载</li>
<li>Python没有重载</li>
<li>Python不需要重载</li>
<li>Python中，方法（函数）定义中，形参非常灵活，不需要指定类型（就算指定了也只是一个说明而非约束），参数个数也不固定（可变参数）。</li>
<li>一个函数的定义可以实现很多种不同形式实参的调用。所以Python不需要方法的重载。</li>
<li>或者说Python语法本身就实现了其它语言的重载。</li>
</ul>
</div>
</div>
<div id="outline-container-h:a53285b7-0e5b-4427-bc19-a49e4597edfc" class="outline-4">
<h4 id="h:a53285b7-0e5b-4427-bc19-a49e4597edfc">封装</h4>
<div class="outline-text-4" id="text-h:a53285b7-0e5b-4427-bc19-a49e4597edfc">
<p>
面向对象的三要素之一，封装Encapsulation
</p>

<ul class="org-ul">
<li>将数据和操作组织到类中，即属性和方法</li>
<li>将数据隐藏起来，给使用者提供操作（方法）。使用者通过操作就可以获取或者修改数据。getter和setter。</li>
<li>通过访问控制，暴露适当的数据和操作给用户，该隐藏的隐藏起来，例如保护成员或私有成员。</li>
</ul>
</div>
</div>
<div id="outline-container-h:0fcc5bb2-8ddf-442e-9a08-7e07e3471966" class="outline-4">
<h4 id="h:0fcc5bb2-8ddf-442e-9a08-7e07e3471966">练习</h4>
<div class="outline-text-4" id="text-h:0fcc5bb2-8ddf-442e-9a08-7e07e3471966">
</div>
<div id="outline-container-h:e35bd71c-86b2-4705-8754-5948c13fab24" class="outline-5">
<h5 id="h:e35bd71c-86b2-4705-8754-5948c13fab24">随机整数生成类</h5>
<div class="outline-text-5" id="text-h:e35bd71c-86b2-4705-8754-5948c13fab24">
<p>
可以指定一批生成的个数，可以指定数值的范围，可以调整每批生成数字的个数。
</p>

<p>
设计类
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450;&#21021;&#22987;&#21270;&#33539;&#22260;&#65292;&#24320;&#22987;&#12289;&#32447;&#26463;&#12289;&#20010;&#25968;
</span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">RandomGen</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, start=1, end=100, count=10):
        <span style="color: #a020f0;">pass</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">generate</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span>

<span style="color: #a0522d;">gen1</span> = RandomGen()
<span style="color: #483d8b;">print</span>(gen1.generate())
<span style="color: #483d8b;">print</span>(gen1.generate())

<span style="color: #a0522d;">gen2</span> = RandomGen(1,10)
<span style="color: #483d8b;">print</span>(gen2.generate())
<span style="color: #483d8b;">print</span>(gen2.generate())
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> random

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">RandomGen</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, start=1, end=100, count=10):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">start</span> = start
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">end</span> = end
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">count</span> = count

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">generate</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> [random.randint(<span style="color: #a020f0;">self</span>.start, <span style="color: #a020f0;">self</span>.end) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(<span style="color: #a020f0;">self</span>.count)]

<span style="color: #a0522d;">gen1</span> = RandomGen()
<span style="color: #483d8b;">print</span>(gen1.generate())
<span style="color: #483d8b;">print</span>(gen1.generate())
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[61, 42, 1, 77, 97, 86, 25, 8, 2, 29]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[50, 73, 78, 60, 67, 9, 54, 82, 12, 10]
</span>
<span style="color: #a0522d;">gen2</span> = RandomGen(1,10)
<span style="color: #483d8b;">print</span>(gen2.generate())
<span style="color: #483d8b;">print</span>(gen2.generate())
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[1, 6, 1, 10, 2, 1, 3, 5, 6, 3]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[2, 6, 8, 2, 3, 5, 2, 1, 10, 6]</span>
</pre>
</div>

<p>
也可以是通过类可能直接访问的工具函数
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> random

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#36807;&#31867;&#21487;&#20197;&#30452;&#25509;&#35775;&#38382;&#30340;&#24037;&#20855;&#20989;&#25968;
</span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">RandomGen</span>:
    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">generate</span>(cls, start=1, end=100, count=10):
        <span style="color: #a020f0;">return</span> [random.randint(start, end) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(count)]

<span style="color: #483d8b;">print</span>(RandomGen.generate())
<span style="color: #483d8b;">print</span>(RandomGen().generate(1,5,3))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[69, 67, 64, 44, 53, 69, 13, 22, 83, 83]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[4, 5, 2]</span>
</pre>
</div>

<p>
生成器方式
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> random

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">RandomGen</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, start=1, end=100, count=10):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">start</span> = start
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">end</span> = end
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">count</span> = count

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">generate</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> (random.randint(<span style="color: #a020f0;">self</span>.start, <span style="color: #a020f0;">self</span>.end) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(<span style="color: #a020f0;">self</span>.count))

<span style="color: #a0522d;">r</span> = RandomGen()
<span style="color: #483d8b;">print</span>(*r.generate())
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">list</span>(r.generate()))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">91 8 77 25 29 8 24 45 42 66
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[43, 79, 80, 43, 63, 21, 15, 51, 40, 87]</span>
</pre>
</div>

<p>
生成器函数方式
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> random

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">RandomGen</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, start=1, end=100, count=10):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">start</span> = start
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">end</span> = end
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">count</span> = count
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_gen</span> = <span style="color: #a020f0;">self</span>._generate()

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_generate</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#22120;&#20989;&#25968;
</span>        <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#27425;&#29983;&#25104;&#19968;&#20010;&#25968;&#25454;
</span>            <span style="color: #a020f0;">yield</span> random.randint(<span style="color: #a020f0;">self</span>.start, <span style="color: #a020f0;">self</span>.end)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">generate</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31435;&#21363;&#36820;&#22238;count&#20010;&#25968;&#25454;&#30340;&#21015;&#34920;
</span>        <span style="color: #a020f0;">return</span> [<span style="color: #483d8b;">next</span>(<span style="color: #a020f0;">self</span>._gen) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(<span style="color: #a020f0;">self</span>.count)]

<span style="color: #a0522d;">r</span> = RandomGen()
<span style="color: #483d8b;">print</span>(r.generate())
<span style="color: #483d8b;">print</span>(r.generate())
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">91 8 77 25 29 8 24 45 42 66
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[43, 79, 80, 43, 63, 21, 15, 51, 40, 87]</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> random

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">RandomGen</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, start=1, end=100, count=10):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">start</span> = start
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">end</span> = end
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">count</span> = count
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_gen</span> = <span style="color: #a020f0;">self</span>._generate()

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_generate</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#22120;&#20989;&#25968;
</span>        <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#27425;&#29983;&#25104;&#19968;&#25209;&#25351;&#23450;&#20010;&#25968;&#30340;&#25968;&#25454;
</span>            <span style="color: #a020f0;">yield</span> [random.randint(<span style="color: #a020f0;">self</span>.start, <span style="color: #a020f0;">self</span>.end) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(<span style="color: #a020f0;">self</span>.count)]

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">generate</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31435;&#21363;&#36820;&#22238;count&#20010;&#25968;&#25454;&#30340;&#21015;&#34920;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">next</span>(<span style="color: #a020f0;">self</span>._gen)

<span style="color: #a0522d;">r</span> = RandomGen()
<span style="color: #483d8b;">print</span>(r.generate())
r.<span style="color: #a0522d;">count</span> = 4
<span style="color: #483d8b;">print</span>(r.generate())
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[52, 25, 43, 96, 56, 46, 8, 61, 37, 30]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[54, 77, 55, 8]</span>
</pre>
</div>

<p>
count改成保护属性
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> random

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">RandomGen</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, start=1, end=100, count=10):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">start</span> = start
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">end</span> = end
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_count</span> = count <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38544;&#34255;count
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_gen</span> = <span style="color: #a020f0;">self</span>._generate()

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_generate</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#22120;&#20989;&#25968;
</span>        <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#27425;&#29983;&#25104;&#19968;&#25209;&#25351;&#23450;&#20010;&#25968;&#30340;&#25968;&#25454;
</span>            <span style="color: #a020f0;">yield</span> [random.randint(<span style="color: #a020f0;">self</span>.start, <span style="color: #a020f0;">self</span>.end) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(<span style="color: #a020f0;">self</span>._count)]

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">generate</span>(<span style="color: #a020f0;">self</span>, count=0): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31435;&#21363;&#36820;&#22238;count&#20010;&#25968;&#25454;&#30340;&#21015;&#34920;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">c = self._count if count &lt;= 0 else count
</span>        <span style="color: #a020f0;">if</span> count &gt;0:
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_count</span> = count
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">next</span>(<span style="color: #a020f0;">self</span>._gen)

<span style="color: #a0522d;">r</span> = RandomGen()
<span style="color: #483d8b;">print</span>(r.generate())
<span style="color: #483d8b;">print</span>(r.generate(2))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[42, 18, 13, 50, 58, 7, 100, 32, 17, 13]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[39, 70]</span>
</pre>
</div>

<p>
count使用属性装饰器
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> random

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">RandomGen</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, start=1, end=100, count=10):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">start</span> = start
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">end</span> = end
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_count</span> = count <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38544;&#34255;count
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_gen</span> = <span style="color: #a020f0;">self</span>._generate()

    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;&#23646;&#24615;&#35013;&#39280;&#22120;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_generate</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#22120;&#20989;&#25968;
</span>        <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#27425;&#29983;&#25104;&#19968;&#25209;&#25351;&#23450;&#20010;&#25968;&#30340;&#25968;&#25454;
</span>            <span style="color: #a020f0;">yield</span> [random.randint(<span style="color: #a020f0;">self</span>.start, <span style="color: #a020f0;">self</span>.end) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(<span style="color: #a020f0;">self</span>.count)] <span style="color: #b22222;">#</span><span style="color: #b22222;">self._count &#25913;&#25104;self.count
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">generate</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31435;&#21363;&#36820;&#22238;count&#20010;&#25968;&#25454;&#30340;&#21015;&#34920;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">next</span>(<span style="color: #a020f0;">self</span>._gen)

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">count</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._count
    <span style="color: #228b22;">@count.setter</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">count</span>(<span style="color: #a020f0;">self</span>, value):
        <span style="color: #a020f0;">if</span> value &gt; 0:
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_count</span> = value

<span style="color: #a0522d;">r</span> = RandomGen()
<span style="color: #483d8b;">print</span>(r.generate())
r.<span style="color: #a0522d;">count</span> = 2
<span style="color: #483d8b;">print</span>(r.generate())
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[42, 18, 13, 50, 58, 7, 100, 32, 17, 13]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[39, 70]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:435b1f42-045a-4bc3-b92d-145541964da1" class="outline-5">
<h5 id="h:435b1f42-045a-4bc3-b92d-145541964da1">打印坐标</h5>
<div class="outline-text-5" id="text-h:435b1f42-045a-4bc3-b92d-145541964da1">
<p>
使用上题中的类，随机生成20个数字，两两配对形成二维坐标系的坐标，把这些坐标组织起来，并打印输出。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x, y):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">y</span> = y
</pre>
</div>

<p>
方法1
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> random

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">RandomGen</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, start=1, end=100, count=10):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">start</span> = start
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">end</span> = end
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_count</span> = count <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38544;&#34255;count
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_gen</span> = <span style="color: #a020f0;">self</span>._generate()

    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;&#23646;&#24615;&#35013;&#39280;&#22120;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_generate</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#22120;&#20989;&#25968;
</span>        <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#27425;&#29983;&#25104;&#19968;&#25209;&#25351;&#23450;&#20010;&#25968;&#30340;&#25968;&#25454;
</span>            <span style="color: #a020f0;">yield</span> [random.randint(<span style="color: #a020f0;">self</span>.start, <span style="color: #a020f0;">self</span>.end) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(<span style="color: #a020f0;">self</span>.count)] <span style="color: #b22222;">#</span><span style="color: #b22222;">self._count &#25913;&#25104;self.count
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">generate</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31435;&#21363;&#36820;&#22238;count&#20010;&#25968;&#25454;&#30340;&#21015;&#34920;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">next</span>(<span style="color: #a020f0;">self</span>._gen)

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">count</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._count
    <span style="color: #228b22;">@count.setter</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">count</span>(<span style="color: #a020f0;">self</span>, value):
        <span style="color: #a020f0;">if</span> value &gt; 0:
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_count</span> = value


<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x, y):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">y</span> = y

    <span style="color: #b22222;">#</span><span style="color: #b22222;">str repr &#39764;&#26415;&#26041;&#27861; &#37325;&#20889;&#20102;&#36825;&#20010;&#26041;&#27861;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&lt;Point {} {}&gt;"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.x, <span style="color: #a020f0;">self</span>.y)

<span style="color: #a0522d;">r</span> = RandomGen()
<span style="color: #a0522d;">points</span> = [Point(x, y) <span style="color: #a020f0;">for</span> x,y <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">zip</span>(r.generate(), r.generate())]
<span style="color: #b22222;"># </span><span style="color: #b22222;">for p in points:
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">print(p.x, p.y, p)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">#&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;"># 1 7 &lt;Point 1 7&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;"># 13 19 &lt;Point 13 19&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;"># 59 28 &lt;Point 59 28&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;"># ......
</span><span style="color: #483d8b;">print</span>(*points, sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;Point 54 94&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;Point 69 38&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;Point 27 13&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;Point 84 20&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;Point 36 97&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;Point 24 58&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;Point 4 90&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;Point 95 16&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;Point 24 83&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;Point 90 63&gt;</span>
</pre>
</div>

<p>
方法2：命名元组方式
</p>

<p>
什么是命名元组
</p>
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #a020f0;">from</span> collections <span style="color: #a020f0;">import</span> OrderedDict, defaultdict, namedtuple

<span style="color: #a0522d;">x</span>  = namedtuple(<span style="color: #8b2252;">'Point'</span>, <span style="color: #8b2252;">'x y'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#19968;&#20010;&#31867;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(x)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class 'type'&gt; &#35828;&#26126;&#20160;&#20040;&#65311;
</span><span style="color: #483d8b;">print</span>(x) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class '__main__.Point'&gt; x&#26159;&#26631;&#35782;&#31526;&#65292;&#25351;&#21521;&#19968;&#20010;&#31867;&#23545;&#35937;&#65292;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Point&#26159;&#31867;&#30340;&#21517;&#31216;&#23383;&#31526;&#20018;&#65292;x&#21644;y&#26159;&#23646;&#24615;&#21517;&#31216;
</span>
<span style="color: #a0522d;">Point</span> = namedtuple(<span style="color: #8b2252;">'Point'</span>, <span style="color: #8b2252;">'x,y'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#21464;&#21527;&#65311; &#23646;&#24615;&#19981;&#21487;&#21464;&#65292;&#36820;&#22238;&#31867;&#22411;&#65292;&#36825;&#20010;&#31867;&#22411;&#26159;tuple&#31867;&#22411;&#30340;&#23376;&#31867;
</span><span style="color: #a0522d;">p1</span> = Point(4, 5)
<span style="color: #483d8b;">print</span>(p1) <span style="color: #b22222;">#</span><span style="color: #b22222;">Point(x=4, y=5)
</span><span style="color: #a0522d;">p2</span> = Point(15, 16)
<span style="color: #483d8b;">print</span>(p2) <span style="color: #b22222;">#</span><span style="color: #b22222;">Point(x=15, y=16)
</span><span style="color: #483d8b;">print</span>(Point.mro()) <span style="color: #b22222;">#</span><span style="color: #b22222;">[&lt;class '__main__.Point'&gt;, &lt;class 'tuple'&gt;, &lt;class 'object'&gt;]
</span><span style="color: #483d8b;">print</span>(Point.__bases__) <span style="color: #b22222;">#</span><span style="color: #b22222;">(&lt;class 'tuple'&gt;,)
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">class x: #x &#26631;&#35782;&#31526;&#65292;&#31867;&#30340;&#21517;&#31216;&#26159;&#23383;&#31526;&#20018;'x'
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">def __init__(self, x, y):
</span><span style="color: #b22222;">#         </span><span style="color: #b22222;">self.x = x
</span><span style="color: #b22222;">#         </span><span style="color: #b22222;">self.y = y
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">def a(): #a &#26631;&#35782;&#31526;&#65292;&#20989;&#25968;&#21517;&#31216;&#23383;&#31526;&#20018;'a'
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">pass
</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">Point &#26631;&#35782;&#31526;&#65292;&#31867;&#30340;&#21517;&#31216;&#26159;&#23383;&#31526;&#20018;'Point'
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x, y):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">y</span> = y
<span style="color: #a0522d;">p3</span> = Point(15, 16)
<span style="color: #483d8b;">print</span>(p3) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;__main__.Point object at 0x0000026F68F97CB0&gt;
</span><span style="color: #483d8b;">print</span>(p3.x, p3.y) <span style="color: #b22222;">#</span><span style="color: #b22222;">15 16</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> random

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">RandomGen</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, start=1, end=100, count=10):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">start</span> = start
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">end</span> = end
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_count</span> = count <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38544;&#34255;count
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_gen</span> = <span style="color: #a020f0;">self</span>._generate()

    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;&#23646;&#24615;&#35013;&#39280;&#22120;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_generate</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#22120;&#20989;&#25968;
</span>        <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#27425;&#29983;&#25104;&#19968;&#25209;&#25351;&#23450;&#20010;&#25968;&#30340;&#25968;&#25454;
</span>            <span style="color: #a020f0;">yield</span> [random.randint(<span style="color: #a020f0;">self</span>.start, <span style="color: #a020f0;">self</span>.end) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(<span style="color: #a020f0;">self</span>.count)] <span style="color: #b22222;">#</span><span style="color: #b22222;">self._count &#25913;&#25104;self.count
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">generate</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31435;&#21363;&#36820;&#22238;count&#20010;&#25968;&#25454;&#30340;&#21015;&#34920;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">next</span>(<span style="color: #a020f0;">self</span>._gen)

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">count</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._count
    <span style="color: #228b22;">@count.setter</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">count</span>(<span style="color: #a020f0;">self</span>, value):
        <span style="color: #a020f0;">if</span> value &gt; 0:
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_count</span> = value


<span style="color: #b22222;">#</span><span style="color: #b22222;">nametuple &#21629;&#21517;&#20803;&#32452;
</span><span style="color: #a020f0;">from</span> collections <span style="color: #a020f0;">import</span> namedtuple

<span style="color: #a0522d;">Point</span> =namedtuple(<span style="color: #8b2252;">'P'</span>, <span style="color: #8b2252;">'x y'</span>)

<span style="color: #a0522d;">r</span> = RandomGen()
<span style="color: #a0522d;">points</span> = [Point(x, y) <span style="color: #a020f0;">for</span> x,y <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">zip</span>(r.generate(), r.generate())]
<span style="color: #483d8b;">print</span>(*points, sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=81, y=48)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=23, y=45)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=11, y=21)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=89, y=29)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=42, y=38)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=69, y=19)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=3, y=94)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=98, y=80)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=19, y=8)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=71, y=73)</span>
</pre>
</div>

<p>
zip换成map函数
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> random

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">RandomGen</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, start=1, end=100, count=10):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">start</span> = start
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">end</span> = end
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_count</span> = count <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38544;&#34255;count
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_gen</span> = <span style="color: #a020f0;">self</span>._generate()

    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;&#23646;&#24615;&#35013;&#39280;&#22120;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_generate</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#22120;&#20989;&#25968;
</span>        <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#27425;&#29983;&#25104;&#19968;&#25209;&#25351;&#23450;&#20010;&#25968;&#30340;&#25968;&#25454;
</span>            <span style="color: #a020f0;">yield</span> [random.randint(<span style="color: #a020f0;">self</span>.start, <span style="color: #a020f0;">self</span>.end) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(<span style="color: #a020f0;">self</span>.count)] <span style="color: #b22222;">#</span><span style="color: #b22222;">self._count &#25913;&#25104;self.count
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">generate</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31435;&#21363;&#36820;&#22238;count&#20010;&#25968;&#25454;&#30340;&#21015;&#34920;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">next</span>(<span style="color: #a020f0;">self</span>._gen)

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">count</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._count
    <span style="color: #228b22;">@count.setter</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">count</span>(<span style="color: #a020f0;">self</span>, value):
        <span style="color: #a020f0;">if</span> value &gt; 0:
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_count</span> = value


<span style="color: #b22222;"># </span><span style="color: #b22222;">class Point:
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">def __init__(self, x, y):
</span><span style="color: #b22222;">#         </span><span style="color: #b22222;">self.x = x
</span><span style="color: #b22222;">#         </span><span style="color: #b22222;">self.y = y
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">#str repr &#39764;&#26415;&#26041;&#27861; &#37325;&#20889;&#20102;&#36825;&#20010;&#26041;&#27861;
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">def __repr__(self):
</span><span style="color: #b22222;">#         </span><span style="color: #b22222;">return "&lt;Point {} {}&gt;".format(self.x, self.y)
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">nametuple &#21629;&#21517;&#20803;&#32452;
</span><span style="color: #a020f0;">from</span> collections <span style="color: #a020f0;">import</span> namedtuple

<span style="color: #a0522d;">Point</span> =namedtuple(<span style="color: #8b2252;">'P'</span>, <span style="color: #8b2252;">'x y'</span>)

<span style="color: #a0522d;">r</span> = RandomGen()
<span style="color: #a0522d;">points</span> = [Point(x, y) <span style="color: #a020f0;">for</span> x,y <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">zip</span>(r.generate(), r.generate())]
<span style="color: #a0522d;">points</span> = <span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> x,y: Point(x,y), r.generate(), r.generate())
<span style="color: #b22222;"># </span><span style="color: #b22222;">for p in points:
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">print(p.x, p.y, p)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">#&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;"># 1 7 &lt;Point 1 7&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;"># 13 19 &lt;Point 13 19&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;"># 59 28 &lt;Point 59 28&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;"># ......
</span><span style="color: #483d8b;">print</span>(*points, sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=81, y=48)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=23, y=45)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=11, y=21)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=89, y=29)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=42, y=38)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=69, y=19)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=3, y=94)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=98, y=80)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=19, y=8)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">P(x=71, y=73)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:374a54c6-1cf7-4205-a7a6-96eee828f7d4" class="outline-5">
<h5 id="h:374a54c6-1cf7-4205-a7a6-96eee828f7d4">车辆信息</h5>
<div class="outline-text-5" id="text-h:374a54c6-1cf7-4205-a7a6-96eee828f7d4">
<p>
记录车的品牌Mark、颜色color、价格price、速度speed等特征，并实现增加车辆信息，显示全部车辆信息的功能。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Car</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, mark, speed, price, color):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">mark</span> = mark
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">speed</span> = speed
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">price</span> = price
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">color</span> = color
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">str</span>(<span style="color: #483d8b;">sorted</span>(<span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">__dict__</span>.items())) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25110;&#32773;return str(self.__dict__)
</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">CarInfoMgr</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__info</span> = [] <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23450;&#20041;&#19968;&#20010;&#23481;&#22120;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add_car</span>(<span style="color: #a020f0;">self</span>, car:Car):
        <span style="color: #a020f0;">self</span>.__info.append(car)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_all</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">len</span>(<span style="color: #a020f0;">self</span>):
            <span style="color: #a020f0;">pass</span>
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__info

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__len__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">len</span>(<span style="color: #a020f0;">self</span>.__info)

<span style="color: #a0522d;">mgr</span> = CarInfoMgr()
<span style="color: #a0522d;">car</span> = Car(<span style="color: #8b2252;">'Audi'</span>, 200, 20, <span style="color: #8b2252;">'red'</span>)
mgr.add_car(car)
mgr.add_car(Car(<span style="color: #8b2252;">'RedFlag'</span>, 300, 40, <span style="color: #8b2252;">'Black'</span>))

<span style="color: #483d8b;">print</span>(*mgr.get_all(), sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[('color', 'red'), ('mark', 'Audi'), ('price', 20), ('speed', 200)]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[('color', 'Black'), ('mark', 'RedFlag'), ('price', 40), ('speed', 300)]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:35f15170-c987-4031-8050-2b04df554c99" class="outline-5">
<h5 id="h:35f15170-c987-4031-8050-2b04df554c99">实现温度的处理</h5>
<div class="outline-text-5" id="text-h:35f15170-c987-4031-8050-2b04df554c99">
<p>
实现华氏温度和摄氏温度的转换
</p>

<p>
\(^\circ C = 5 \times ( ^\circ F - 32 ) / 9\)
</p>

<p>
\(^\circ F = 9 \times  \ ^\circ C / 5 + 32\)
</p>

<p>
完成以上转换后，增加与开氏温度的转换， \(K = ^\circ C + 273.15\)
</p>


<p>
思路：工具类不需要实例化
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Temperature</span>:
    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">c2f</span>(cls, c):
        <span style="color: #a020f0;">pass</span>

    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">f2c</span>(cls, f):
        <span style="color: #a020f0;">pass</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Temperature</span>:
    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">c2f</span>(cls, c):
        <span style="color: #a020f0;">return</span> 9 * c /5 + 32

    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">f2c</span>(cls, f):
        <span style="color: #a020f0;">return</span> (f - 32) * 5 / 9

    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">c2k</span>(cls, c):
        <span style="color: #a020f0;">return</span> c + 273.15

    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">k2c</span>(cls, k):
        <span style="color: #a020f0;">return</span> k - 273.15

    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21326;&#27663;&#28201;&#24230;&#21644;&#24320;&#27663;&#28201;&#24230;&#22914;&#20309;&#36716;&#25442;&#65311;
</span>
<span style="color: #483d8b;">print</span>(Temperature.c2f(40))
<span style="color: #483d8b;">print</span>(Temperature.f2c(104))
<span style="color: #483d8b;">print</span>(Temperature.c2k(40))
<span style="color: #483d8b;">print</span>(Temperature.k2c(313.15))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Temperature</span>:
    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">c2f</span>(cls, c):
        <span style="color: #a020f0;">return</span> 9 * c /5 + 32

    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">f2c</span>(cls, f):
        <span style="color: #a020f0;">return</span> (f - 32) * 5 / 9

    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">c2k</span>(cls, c):
        <span style="color: #a020f0;">return</span> c + 273.15

    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">k2c</span>(cls, k):
        <span style="color: #a020f0;">return</span> k - 273.15

    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21326;&#27663;&#28201;&#24230;&#21644;&#24320;&#27663;&#28201;&#24230;&#22914;&#20309;&#36716;&#25442;&#65311;
</span>    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">f2k</span>(cls, f):
        <span style="color: #a020f0;">return</span> cls.c2k(cls.f2c(f))  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26680;&#24515;&#65292;&#26368;&#24120;&#29992;&#30340;&#28201;&#24230;&#20307;&#31995;&#26159;&#25668;&#27663;&#24230;
</span>
    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">k2f</span>(cls,k):
        <span style="color: #a020f0;">return</span> cls.c2f(cls.k2c(k))

<span style="color: #483d8b;">print</span>(Temperature.c2f(40))
<span style="color: #483d8b;">print</span>(Temperature.f2c(104))
<span style="color: #483d8b;">print</span>(Temperature.c2k(40))
<span style="color: #483d8b;">print</span>(Temperature.k2c(313.15))
<span style="color: #483d8b;">print</span>(Temperature.f2k(104))
<span style="color: #483d8b;">print</span>(Temperature.k2f(313.15))
</pre>
</div>

<p>
利用属性装饰器, 完善
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Temperature</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, t, unit=<span style="color: #8b2252;">'c'</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_c</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_k</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_f</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20013;&#36716;&#30340;&#28201;&#24230;&#26159;&#25668;&#27663;&#24230;
</span>        <span style="color: #a020f0;">if</span> unit == <span style="color: #8b2252;">'k'</span>:
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_k</span> = t
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_c</span> = <span style="color: #a020f0;">self</span>.k2c(t)
        <span style="color: #a020f0;">elif</span> unit == <span style="color: #8b2252;">'f'</span>:
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_f</span> = t
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_c</span> = <span style="color: #a020f0;">self</span>.f2c(t)
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_c</span> = t

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">c</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._c

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">f</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>._f <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_f</span> = <span style="color: #a020f0;">self</span>.c2f(<span style="color: #a020f0;">self</span>.c)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._f

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">k</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>._k <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_k</span> = <span style="color: #a020f0;">self</span>.c2k(<span style="color: #a020f0;">self</span>.c)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._k

    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">c2f</span>(cls, c):
        <span style="color: #a020f0;">return</span> 9 * c /5 + 32

    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">f2c</span>(cls, f):
        <span style="color: #a020f0;">return</span> (f - 32) * 5 / 9

    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">c2k</span>(cls, c):
        <span style="color: #a020f0;">return</span> c + 273.15

    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">k2c</span>(cls, k):
        <span style="color: #a020f0;">return</span> k - 273.15

    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21326;&#27663;&#28201;&#24230;&#21644;&#24320;&#27663;&#28201;&#24230;&#22914;&#20309;&#36716;&#25442;&#65311;
</span>    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">f2k</span>(cls, f):
        <span style="color: #a020f0;">return</span> cls.c2k(cls.f2c(f))  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26680;&#24515;&#65292;&#26368;&#24120;&#29992;&#30340;&#28201;&#24230;&#20307;&#31995;&#26159;&#25668;&#27663;&#24230;
</span>
    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">k2f</span>(cls,k):
        <span style="color: #a020f0;">return</span> cls.c2f(cls.k2c(k))

<span style="color: #b22222;"># </span><span style="color: #b22222;">print(Temperature.c2f(40))
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(Temperature.f2c(104))
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(Temperature.c2k(40))
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(Temperature.k2c(313.15))
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(Temperature.f2k(104))
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(Temperature.k2f(313.15))
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#38656;&#27714; &#20808;&#32473;&#20320;&#19968;&#20010;&#26576;&#21333;&#20301;&#30340;&#28201;&#24230;&#65292;&#20808;&#23384;&#30528;&#65292;&#20294;&#24182;&#19981;&#30528;&#24613;&#30693;&#36947;&#26410;&#26469;&#38656;&#35201;&#20160;&#20040;&#21333;&#20301;&#30340;&#28201;&#24230;
</span><span style="color: #a0522d;">t</span> = Temperature(40, <span style="color: #8b2252;">'c'</span>)
<span style="color: #483d8b;">print</span>(t.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">{'_c': 40, '_k': None, '_f': None}
</span><span style="color: #483d8b;">print</span>(t.k) <span style="color: #b22222;">#</span><span style="color: #b22222;">313.15
</span><span style="color: #483d8b;">print</span>(t.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">{'_c': 40, '_k': 313.15, '_f': None}
</span><span style="color: #483d8b;">print</span>(t.f) <span style="color: #b22222;">#</span><span style="color: #b22222;">104.0
</span><span style="color: #483d8b;">print</span>(t.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">{'_c': 40, '_k': 313.15, '_f': 104.0}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ebd9e7ad-8c36-4c5a-92c5-d4d8a8d6b1f1" class="outline-5">
<h5 id="h:ebd9e7ad-8c36-4c5a-92c5-d4d8a8d6b1f1">模拟购物车购物</h5>
<div class="outline-text-5" id="text-h:ebd9e7ad-8c36-4c5a-92c5-d4d8a8d6b1f1">
<p>
思路
</p>

<p>
购物车是购物，分解得到两个对象，购物车，物品。一个操作：买
</p>

<p>
购买不是购物车的行为，其实是人的行为，但是对于购物车来说就是增加add.
</p>

<p>
商品有很多种类，商品的属性多种多样，怎么解决?
</p>

<p>
购物车可以加入很多不同的商品，如何实现？
</p>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36141;&#29289;&#36710;&#36141;&#29289;
</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Item</span>:
    <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Cart</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">items</span> = []

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(<span style="color: #a020f0;">self</span>, item:Item):
        <span style="color: #a020f0;">self</span>.items.append(item)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_all</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.items
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36141;&#29289;&#36710;&#36141;&#29289;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#33021;&#35774;&#35745;&#25152;&#26377;&#30340;&#21830;&#21697;&#31867;&#65292;&#32479;&#19968;&#35774;&#35745;
</span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Color</span>:
    <span style="color: #a0522d;">RED</span> = 0
    <span style="color: #a0522d;">BLUE</span> = 1
    <span style="color: #a0522d;">BLACK</span> = 2

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Item</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, price, **kwargs):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">price</span> = price
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__spec</span> = kwargs
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">color</span> = Color.BLUE
        <span style="color: #a020f0;">if</span> <span style="color: #8b2252;">'color'</span> <span style="color: #a020f0;">in</span> kwargs.keys():
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">color</span> = kwargs[<span style="color: #8b2252;">'color'</span>]
            kwargs.pop(<span style="color: #8b2252;">'color'</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">str</span>(<span style="color: #483d8b;">dict</span>(color=<span style="color: #a020f0;">self</span>.color, **<span style="color: #a020f0;">self</span>.__spec))

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Cart</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">items</span> = []

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(<span style="color: #a020f0;">self</span>, item:Item):
        <span style="color: #a020f0;">self</span>.items.append(item)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_all</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.items

<span style="color: #a0522d;">mycart</span> = Cart()

<span style="color: #a0522d;">phone</span> = Item(<span style="color: #8b2252;">'P30'</span>, 3000, color=Color.RED, memory=<span style="color: #8b2252;">'4G'</span>)

mycart.add(phone)
mycart.add(Item(<span style="color: #8b2252;">'RedFlag'</span>, 40000, color=Color.BLACK, year=2015))
<span style="color: #483d8b;">print</span>(mycart.get_all())
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[{'color': 0, 'memory': '4G'}, {'color': 2, 'year': 2015}]</span>
</pre>
</div>

<p>
注意，上面的代码只是一个非常简单的实现，生成环境实现购物车的增删改查，要考虑很多。
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-h:5eca5e40-4778-4d21-bb0c-86131b389397" class="outline-3">
<h3 id="h:5eca5e40-4778-4d21-bb0c-86131b389397">类的继承</h3>
<div class="outline-text-3" id="text-h:5eca5e40-4778-4d21-bb0c-86131b389397">
</div>
<div id="outline-container-h:0d4f0780-2993-4973-b4f1-023c07e4f947" class="outline-4">
<h4 id="h:0d4f0780-2993-4973-b4f1-023c07e4f947">基本概念</h4>
<div class="outline-text-4" id="text-h:0d4f0780-2993-4973-b4f1-023c07e4f947">
<p>
面向对象三要素之一，继承Inheritance
</p>

<pre class="example" id="org883e8cc">
人类和猫类都继承自动物类
个体继承自父母，继承了父母的一部分特征，但也可以有自己的个性
</pre>

<p>
在面向对象的世界中，从父类继承，就可以直接拥有父类的属性和方法，这样可以减少代码、多复用。子类可以定义自己的属性和方法
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Animal</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">shout</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} shouts'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.__class__.<span style="color: #483d8b;">__name__</span>))

<span style="color: #a0522d;">a</span> = Animal()
a.shout()

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Cat</span>(Animal): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32487;&#25215;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">pass
</span>
<span style="color: #a0522d;">c</span> = Cat()
c.shout()
</pre>
</div>

<ul class="org-ul">
<li><p>
继承
class Cat(Animal) 这种形式就是父类继承，括号中写上继承的类的列表
</p>

<p>
继承可以让子类从父类获取特征（属性和方法）
</p></li>

<li>父类
Animal就是Cat的父类，也称为基类、超类</li>
<li>子类
Cat就是Animal的子类，也称为派生类</li>
</ul>
</div>
</div>
<div id="outline-container-h:2fca60e4-293e-4f21-87f3-85ced38cc11c" class="outline-4">
<h4 id="h:2fca60e4-293e-4f21-87f3-85ced38cc11c">定义</h4>
<div class="outline-text-4" id="text-h:2fca60e4-293e-4f21-87f3-85ced38cc11c">
<p>
格式如下
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">&#23376;&#31867;&#21517;</span>(&#22522;&#31867;1[,&#22522;&#31867;2,...]):
    &#35821;&#21477;&#22359;
</pre>
</div>


<p>
如果类定义时，没有基类列表，等同于继承自object。在Python3中，object类是所有对象的 <b>根基类</b>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">pass</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#31561;&#20215;&#20110;
</span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>(<span style="color: #483d8b;">object</span>):
    <span style="color: #a020f0;">pass</span>
</pre>
</div>

<p>
注意，上例在Python2中，两种写法是不同的
</p>

<p>
Python支持多继承，继承也可以多级
</p>

<p>
查看继承的特殊属性和方法有
</p>
<pre class="example" id="org23032bd">
__bases__        #类的基类元组
__base__         #类的基类元组第一项
__mro__          #显示方法查找顺序，返回基类的元组
mro()方法        #同上，返回列表
__subclass__()   #类的子类列表
</pre>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Animal</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">shout</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} shouts'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.__class__.<span style="color: #483d8b;">__name__</span>))

<span style="color: #a0522d;">a</span> = Animal(<span style="color: #8b2252;">'A'</span>)
a.shout()

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Cat</span>(Animal): <span style="color: #a020f0;">pass</span>

<span style="color: #a0522d;">c</span> = Cat(<span style="color: #8b2252;">'cat'</span>)
c.shout()

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Dog</span>(Animal): <span style="color: #a020f0;">pass</span>

<span style="color: #a0522d;">d</span> = Dog(<span style="color: #8b2252;">'dog'</span>)
d.shout()

<span style="color: #483d8b;">print</span>(Dog.__bases__) <span style="color: #b22222;">#</span><span style="color: #b22222;">(&lt;class '__main__.Animal'&gt;,) &#30452;&#25509;&#30340;&#29238;&#31867;&#65292;&#23450;&#20041;&#26102;&#30452;&#25509;&#20889;&#20986;&#30340;&#29238;&#31867;&#30340;&#21015;&#34920;
</span><span style="color: #483d8b;">print</span>(Dog.__base__) <span style="color: #b22222;">#</span><span style="color: #b22222;">Dog.__bases__[0] &#20803;&#32452;&#31532;&#19968;&#39033; &lt;class '__main__.Animal'&gt;
</span><span style="color: #483d8b;">print</span>(Animal.__bases__) <span style="color: #b22222;">#</span><span style="color: #b22222;">(&lt;class 'object'&gt;,)
</span><span style="color: #483d8b;">print</span>(Animal.__subclasses__()) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#20986;&#23376;&#31867; [&lt;class '__main__.Cat'&gt;, &lt;class '__main__.Dog'&gt;]
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">bool</span>.__bases__) <span style="color: #b22222;">#</span><span style="color: #b22222;">(&lt;class 'int'&gt;,)
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">int</span>.__subclasses__()) <span style="color: #b22222;">#</span><span style="color: #b22222;">[&lt;class 'bool'&gt;]
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #483d8b;">print</span>(Cat.__mro__)<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#26041;&#27861;&#30340;&#26597;&#25214;&#39034;&#24207;&#65292;&#36820;&#22238;&#22522;&#31867;&#30340;&#20803;&#32452;
</span><span style="color: #483d8b;">print</span>(Cat.mro()) <span style="color: #b22222;">#</span><span style="color: #b22222;">mro&#29992;&#22312;&#31867;&#19978;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:e2ddf9d5-4607-4ed3-96d1-85045141073a" class="outline-4">
<h4 id="h:e2ddf9d5-4607-4ed3-96d1-85045141073a">python不同版本的类</h4>
<div class="outline-text-4" id="text-h:e2ddf9d5-4607-4ed3-96d1-85045141073a">
<p>
Python2.2之前类是没有共同的祖先的，之后，引入object类，它是所有类的共同祖先类object。
</p>

<p>
python2中做了兼容，分为古典类（旧式类）和新式类
</p>

<p>
python3中全部是新式类。新式类都是继承自object的，新式类可以使用super
</p>

<p>
python3
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>: <span style="color: #a020f0;">pass</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>(<span style="color: #483d8b;">object</span>): <span style="color: #a020f0;">pass</span>

<span style="color: #483d8b;">print</span>(A.__bases__)  <span style="color: #b22222;">#</span><span style="color: #b22222;">(&lt;class 'object'&gt;,)
</span><span style="color: #483d8b;">print</span>(B.__bases__) <span style="color: #b22222;">#</span><span style="color: #b22222;">(&lt;class 'object'&gt;,)
</span><span style="color: #483d8b;">print</span>(A.mro()) <span style="color: #b22222;">#</span><span style="color: #b22222;">[&lt;class '__main__.A'&gt;, &lt;class 'object'&gt;]
</span><span style="color: #483d8b;">print</span>(B.mro()) <span style="color: #b22222;">#</span><span style="color: #b22222;">[&lt;class '__main__.B'&gt;, &lt;class 'object'&gt;]
</span>
<span style="color: #a0522d;">a</span> = A()
<span style="color: #483d8b;">print</span>(a.__class__) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class '__main__.A'&gt;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(a)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class '__main__.A'&gt;
</span>
<span style="color: #a0522d;">b</span> = B()
<span style="color: #483d8b;">print</span>(b.__class__) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class '__main__.B'&gt;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(b)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class '__main__.B'&gt;</span>
</pre>
</div>

<p>
python2
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">python2
</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>: <span style="color: #a020f0;">pass</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>(<span style="color: #483d8b;">object</span>): <span style="color: #a020f0;">pass</span>

<span style="color: #483d8b;">print</span>(A.__bases__)  <span style="color: #b22222;">#</span><span style="color: #b22222;">()
</span><span style="color: #483d8b;">print</span>(B.__bases__) <span style="color: #b22222;">#</span><span style="color: #b22222;">(&lt;type 'object'&gt;,)
</span><span style="color: #483d8b;">print</span>(A.mro()) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25253;&#38169;  AttributeError: class A has no attribute 'mro'
</span><span style="color: #483d8b;">print</span>(B.mro()) <span style="color: #b22222;">#</span><span style="color: #b22222;">[&lt;class '__main__.B'&gt;, &lt;type 'object'&gt;]
</span>
<span style="color: #a0522d;">a</span> = A()
<span style="color: #483d8b;">print</span>(a.__class__) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class '__main__.A' at 0x000xxxx&gt;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(a)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;type 'instance'&gt;
</span>
<span style="color: #a0522d;">b</span> = B()
<span style="color: #483d8b;">print</span>(b.__class__) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class '__main__.B'&gt;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(b)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class '__main__.B'&gt;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b2a1baae-4457-4cea-a770-bf04b7236ebf" class="outline-4">
<h4 id="h:b2a1baae-4457-4cea-a770-bf04b7236ebf">继承中的访问控制</h4>
<div class="outline-text-4" id="text-h:b2a1baae-4457-4cea-a770-bf04b7236ebf">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Animal</span>:
    <span style="color: #a0522d;">__COUNT</span> = 100 <span style="color: #b22222;"># </span><span style="color: #b22222;">_Animal__COUNT
</span>    <span style="color: #a0522d;">HEIGHT</span> = 0

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>,age, weight, height):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__COUNT</span> += 1 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36171;&#20540;&#21363;&#23450;&#20041;&#65292;&#25918;&#22312;&#20102;&#23454;&#20363;&#23383;&#20856;&#20013;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25913;&#21517; self._Animal__COUNT =  self._Animal__COUNT + 1
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__weight</span> = weight
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">HEIGHT</span> = height

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">eat</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} eat'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.__class__.<span style="color: #483d8b;">__name__</span>))

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__getweight</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">self</span>.__weight)

    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showcount1</span>(cls):
        <span style="color: #483d8b;">print</span>(cls)
        <span style="color: #483d8b;">print</span>(cls.<span style="color: #483d8b;">__dict__</span>)
        <span style="color: #483d8b;">print</span>(cls.__COUNT)

    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__showcount2</span>(cls):
        <span style="color: #483d8b;">print</span>(cls.__COUNT)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showcount3</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">self</span>.__COUNT) <span style="color: #b22222;">#</span><span style="color: #b22222;">c._Animal__COUNT
</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Cat</span>(Animal):
    <span style="color: #a0522d;">NAME</span> = <span style="color: #8b2252;">'CAT'</span>
    <span style="color: #a0522d;">__COUNT</span> = 200 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25913;&#21517;&#65292; _Cat__COUNT = 200
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">c = Cat() # __init__ &#20989;&#25968;&#21442;&#25968;&#38169;&#35823;
</span><span style="color: #a0522d;">c</span> = Cat(3, 5, 15)
c.eat() <span style="color: #b22222;"># </span><span style="color: #b22222;">Cat eat
</span><span style="color: #483d8b;">print</span>(c.HEIGHT) <span style="color: #b22222;">#  </span><span style="color: #b22222;">15
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">print(c.__COUNT) #&#25253;&#38169; AttributeError, &#31169;&#26377;&#25104;&#21592;&#19981;&#33021;&#30452;&#25509;&#35775;&#38382;&#65292;&#21487;&#36890;&#36807;c._Animal__COUNT&#35775;&#38382;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">c.__getweight() #&#31169;&#26377;&#23646;&#24615;&#19981;&#33021;&#30452;&#25509;&#35775;&#38382;&#12290;&#21487;&#36890;&#36807;c._Animal__getweight()&#35775;&#38382;
</span>
c.showcount1()
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#32467;&#26524;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23454;&#20363;&#35843;&#29992;&#26041;&#27861;&#65292;showcount1&#22312;&#29238;&#31867;&#20013;&#26377;&#65292;&#19988;&#26159;&#31867;&#26041;&#27861;&#65292;&#32465;&#23450;&#31867;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20174;c&#23454;&#20363;&#19978;&#25343;&#65292;&#21363;type(c) c.__class__ =&gt; Cat , showcount1(cls)&#27880;&#20837;&#30340;&#31532;&#19968;&#21442;&#25968;&#23601;&#26159;Cat
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">cls.__COUNT &#30456;&#24403;&#20110;&#35775;&#38382;&#30340;Cat._Animal__COUNT
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Cat&#31867;&lt;class '__main__.Cat'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Cat&#31867;&#23383;&#20856;{'__module__': '__main__', '__firstlineno__': 30, 'NAME': 'CAT', '_Cat__COUNT': 200, '__static_attributes__': (), '__doc__': None}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">100
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">c.__showcount2() #&#25253;&#38169;&#65292;&#31169;&#26377;&#23646;&#24615;&#12290;&#36890;&#36807; c._Animal__showcount2()
</span>c._Animal__showcount2() <span style="color: #b22222;">#</span><span style="color: #b22222;">100
</span>
c.showcount3() <span style="color: #b22222;"># </span><span style="color: #b22222;">101
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23454;&#20363;&#21270;2&#20010;&#38454;&#27573;&#65292;&#20808;&#23454;&#20363;&#21270;&#35843;&#29992;__new__&#26041;&#27861;&#65292;&#21482;&#26377;object&#31867;&#26377;&#36825;&#20010;&#26041;&#27861;&#65292; Cat -&gt; Animal -&gt; object
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">Cat&#27809;&#26377;&#21021;&#22987;&#21270;&#26041;&#27861;&#65292;Animal&#26377;&#21021;&#22987;&#21270;&#26041;&#27861;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">self.__COUNT &#23454;&#20363;&#23383;&#20856;&#20013;&#26377;&#19981;&#31649;&#31867;&#35201;&#20102;
</span><span style="color: #483d8b;">print</span>(c.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">{'_Animal__COUNT': 101, 'age': 3, '_Animal__weight': 5, 'HEIGHT': 15}
</span>
<span style="color: #483d8b;">print</span>(c._Cat__COUNT) <span style="color: #b22222;">#</span><span style="color: #b22222;">200
</span><span style="color: #483d8b;">print</span>(c._Animal__COUNT) <span style="color: #b22222;">#</span><span style="color: #b22222;">101
</span><span style="color: #483d8b;">print</span>(c.NAME) <span style="color: #b22222;">#</span><span style="color: #b22222;">CAT
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;&#20986;&#23383;&#20856;&#37117;&#26126;&#30333;&#20102;
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{}'</span>.<span style="color: #483d8b;">format</span>(Animal.<span style="color: #483d8b;">__dict__</span>))
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{}'</span>.<span style="color: #483d8b;">format</span>(Cat.<span style="color: #483d8b;">__dict__</span>))
<span style="color: #483d8b;">print</span>(c.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #483d8b;">print</span>(c.__class__.mro()) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;&#26597;&#25214;&#39034;&#24207;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'__module__': '__main__', '__firstlineno__': 1, '_Animal__COUNT': 100, 'HEIGHT': 0, '__init__': &lt;function Animal.__init__ at 0x00000192AC147A60&gt;, 'eat': &lt;function Animal.eat at 0x00000192AC154680&gt;, '_Animal__getweight': &lt;function Animal.__getweight at 0x00000192AC154D60&gt;, 'showcount1': &lt;classmethod(&lt;function Animal.showcount1 at 0x00000192AC2B71A0&gt;)&gt;, '_Animal__showcount2': &lt;classmethod(&lt;function Animal.__showcount2 at 0x00000192AC2B7240&gt;)&gt;, 'showcount3': &lt;function Animal.showcount3 at 0x00000192AC2B72E0&gt;, '__static_attributes__': ('HEIGHT', '__weight', 'age'), '__dict__': &lt;attribute '__dict__' of 'Animal' objects&gt;, '__weakref__': &lt;attribute '__weakref__' of 'Animal' objects&gt;, '__doc__': None}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'__module__': '__main__', '__firstlineno__': 32, 'NAME': 'CAT', '_Cat__COUNT': 200, '__static_attributes__': (), '__doc__': None}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'_Animal__COUNT': 101, 'age': 3, '_Animal__weight': 5, 'HEIGHT': 15}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[&lt;class '__main__.Cat'&gt;, &lt;class '__main__.Animal'&gt;, &lt;class 'object'&gt;]</span>
</pre>
</div>

<ul class="org-ul">
<li>从父类继承，自己没有的，就可以到父类中找。</li>

<li>私有的都是不可以访问的，但是本质上依然是改了名称放在这个属性所在的类或实例的__dict__中。
知道这个新名称就可以直接找到这个隐藏的变量，这是黑魔法，慎用。</li>
</ul>

<p>
总结：
</p>
<ul class="org-ul">
<li>继承时，公有成员、子类和实例都可以随意访问；私有成员被隐藏，子类和实例不可直接访问，但
私有变量所在的类内的方法中可以访问这个私有变量</li>
<li>Python通过自己一套实现，实现和其他语言一样的面向对象的继承机制。</li>
</ul>

<p>
实例属性查找顺序
</p>
<pre class="example" id="orgdd235de">
实例的__dict__ --&gt; 类__dict__ --&gt; 如果有继承 --&gt; 父类__dict__

如果搜索这些地方后没有找到就会抛异常，先找到就立即返回
</pre>
</div>
</div>
<div id="outline-container-h:c713f83e-983e-49b3-bab2-2a7cb15cd5f5" class="outline-4">
<h4 id="h:c713f83e-983e-49b3-bab2-2a7cb15cd5f5">方法的重写、覆盖override</h4>
<div class="outline-text-4" id="text-h:c713f83e-983e-49b3-bab2-2a7cb15cd5f5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Animal</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">shout</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Animal shouts'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Cat</span>(Animal):
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35206;&#30422;&#20102;&#29238;&#31867;&#26041;&#27861;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">shout</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'miao'</span>)

<span style="color: #a0522d;">a</span> = Animal()
a.shout() <span style="color: #b22222;">#</span><span style="color: #b22222;">: Animal shouts
</span><span style="color: #a0522d;">c</span> = Cat() <span style="color: #b22222;"># </span><span style="color: #b22222;">Animal shouts
</span>c.shout() <span style="color: #b22222;"># </span><span style="color: #b22222;">miao
</span>
<span style="color: #483d8b;">print</span>(a.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #483d8b;">print</span>(c.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #483d8b;">print</span>(Animal.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #483d8b;">print</span>(Cat.<span style="color: #483d8b;">__dict__</span>)
</pre>
</div>

<ul class="org-ul">
<li>Cat中能够有覆盖自己的方法?</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Animal</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">shout</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Animal shouts'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Cat</span>(Animal):
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35206;&#30422;&#20102;&#29238;&#31867;&#30340;&#26041;&#27861;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">shout</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'miao'</span>)

    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35206;&#30422;&#20102;&#33258;&#36523;&#30340;&#26041;&#27861;&#65292;&#26174;&#31034;&#35843;&#29992;&#20102;&#29238;&#31867;&#30340;&#26041;&#27861;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">shout</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">super</span>()) <span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;super: &lt;class 'Cat'&gt;, &lt;Cat object&gt;&gt;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">super</span>(Cat, <span style="color: #a020f0;">self</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;super: &lt;class 'Cat'&gt;, &lt;Cat object&gt;&gt;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">super</span>(<span style="color: #a020f0;">self</span>.__class__, <span style="color: #a020f0;">self</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;super: &lt;class 'Cat'&gt;, &lt;Cat object&gt;&gt;
</span>
        <span style="color: #483d8b;">super</span>().shout() <span style="color: #b22222;"># </span><span style="color: #b22222;">Animal shouts
</span>        <span style="color: #483d8b;">super</span>(Cat, <span style="color: #a020f0;">self</span>).shout() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#31561;&#20215;&#20110;super() # Animal shouts
</span>        <span style="color: #a020f0;">self</span>.__class__.__base__.shout(<span style="color: #a020f0;">self</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25512;&#33616; # Animal shouts
</span>

<span style="color: #a0522d;">a</span> = Animal()
a.shout() <span style="color: #b22222;"># </span><span style="color: #b22222;">Animal shouts
</span><span style="color: #a0522d;">c</span> = Cat() 
c.shout() <span style="color: #b22222;"># </span><span style="color: #b22222;">miao
</span>
<span style="color: #483d8b;">print</span>(a.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #483d8b;">print</span>(c.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #483d8b;">print</span>(Animal.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #483d8b;">print</span>(Cat.<span style="color: #483d8b;">__dict__</span>)
</pre>
</div>
</div>
<div id="outline-container-h:2d18cfb6-e2ac-43f3-843f-a031faa0a8cf" class="outline-5">
<h5 id="h:2d18cfb6-e2ac-43f3-843f-a031faa0a8cf">super()</h5>
<div class="outline-text-5" id="text-h:2d18cfb6-e2ac-43f3-843f-a031faa0a8cf">
<ul class="org-ul">
<li>可以访问到父类的类属性</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Animal</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">shout</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Animal shouts'</span>)


<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Cat</span>(Animal):
    <span style="color: #b22222;"># </span><span style="color: #b22222;">def shout(self): #&#23436;&#20840; &#35206;&#30422;
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">print('miao')
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">shout</span>(<span style="color: #a020f0;">self</span>):  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32487;&#25215;&#24182;&#21457;&#25196;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">super() -&gt; same as super(__class__, &lt;first argument&gt;)
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">super(type) -&gt; unbound super object
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">super(type, obj) -&gt; bound super object; requires isinstance(obj, type)
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">super(type, type2) -&gt; bound super object; requires issubclass(type2, type)
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~~~'</span>)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">super</span>())
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">super</span>(Cat, <span style="color: #a020f0;">self</span>))  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#21069;&#31867; super(__class__, self)
</span>
        <span style="color: #483d8b;">super</span>().shout() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#20840;&#23454;&#29616;&#65292;&#20808;&#35843;&#29992;&#29238;&#31867;&#30340;&#26041;&#27861;&#65292;&#25191;&#34892;&#33258;&#24049;&#30340;&#20195;&#30721;
</span>        <span style="color: #483d8b;">super</span>(Cat, <span style="color: #a020f0;">self</span>).shout() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19982;super().shout()&#31561;&#20215;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">Cat.__base__.shout(self) #self.__class__.__base__.shout(self) &#40635;&#28902;&#19981;&#25512;&#33616;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'miao'</span>)

<span style="color: #a0522d;">c</span> = Cat()
c.shout()
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;super: &lt;class 'Cat'&gt;, &lt;Cat object&gt;&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;super: &lt;class 'Cat'&gt;, &lt;Cat object&gt;&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Animal shouts
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Animal shouts
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">miao
</span>
<span style="color: #483d8b;">print</span>(Animal.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #483d8b;">print</span>(Cat.<span style="color: #483d8b;">__dict__</span>)
</pre>
</div>

<p>
如果是类方法和静态方法？
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Animal</span>:
    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">class_method</span>(cls):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'class_method_animal'</span>)

    @<span style="color: #483d8b;">staticmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">static_method</span>():
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'static_method_animal'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Cat</span>(Animal):
    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">class_method</span>(cls):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'class_method_cat'</span>)

    @<span style="color: #483d8b;">staticmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">static_method</span>():
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'static_method_cat'</span>)

<span style="color: #a0522d;">c</span> = Cat()
c.class_method() <span style="color: #b22222;"># </span><span style="color: #b22222;">class_method_cat
</span>c.static_method() <span style="color: #b22222;"># </span><span style="color: #b22222;">static_method_cat
</span>
<span style="color: #483d8b;">print</span>(Cat.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #483d8b;">print</span>(Animal.<span style="color: #483d8b;">__dict__</span>)

Cat.static_method() <span style="color: #b22222;"># </span><span style="color: #b22222;">static_method_cat
</span>Animal.static_method() <span style="color: #b22222;"># </span><span style="color: #b22222;">static_method_animal</span>
</pre>
</div>

<p>
静态方法和类方法，是特殊方法，也是类属性，这些方法都可以覆盖，原理都一样，属性字典的搜索顺序
</p>
</div>
</div>
</div>
<div id="outline-container-h:bf2618a2-32cd-4b87-80c7-873d551354a7" class="outline-4">
<h4 id="h:bf2618a2-32cd-4b87-80c7-873d551354a7">继承时使用初始化</h4>
<div class="outline-text-4" id="text-h:bf2618a2-32cd-4b87-80c7-873d551354a7">
<ul class="org-ul">
<li>初始化只跟实例字典相关</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>,a, d=10):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">a</span> = a
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">d</span> = d

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>(A):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, b, c):
        <span style="color: #b22222;">#</span><span style="color: #b22222;">A.__init__(self, b + c, b - c)
</span>        <span style="color: #483d8b;">super</span>().__init__(<span style="color: #a020f0;">self</span>, b + c, b - c) <span style="color: #b22222;">#</span><span style="color: #b22222;">super(B, self) &#20256;&#36882;&#32473;&#29238;&#31867;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">b</span> = b
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">c</span> = c

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">printv</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">self</span>.b) <span style="color: #b22222;"># </span><span style="color: #b22222;">200
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">self</span>.a) <span style="color: #b22222;"># </span><span style="color: #b22222;">500
</span>
<span style="color: #a0522d;">f</span> = B(200, 300)
<span style="color: #483d8b;">print</span>(f.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">{'a': 500, 'd': -100, 'b': 200, 'c': 300}
</span><span style="color: #483d8b;">print</span>(f.__class__.__bases__) <span style="color: #b22222;"># </span><span style="color: #b22222;">(&lt;class '__main__.A'&gt;,)
</span>f.printv()
</pre>
</div>

<ul class="org-ul">
<li>如果父类定义了=__init__=方法，应该在子类的__init__中调用它</li>
<li>那么，子类什么时候自动调用父类的__init__方法呢？</li>
</ul>

<p>
示例1
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">a1</span> = <span style="color: #8b2252;">'a1'</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">a2</span> = <span style="color: #8b2252;">'a2'</span>
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init in A'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>(A):
   <span style="color: #a020f0;">pass</span>

<span style="color: #a0522d;">b</span> = B() <span style="color: #b22222;"># </span><span style="color: #b22222;">init in A
</span><span style="color: #483d8b;">print</span>(b.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">{'a1': 'a1', 'a2': 'a2'}</span>
</pre>
</div>

<p>
B实例的初始化会自动调用基类A的=__init__=方法，所以=print('init in A')=会打印出来
</p>

<p>
示例2
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">a1</span> = <span style="color: #8b2252;">'a1'</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">a2</span> = <span style="color: #8b2252;">'a2'</span>
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init in A'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>(A):
   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
       <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">b1</span> = <span style="color: #8b2252;">'b1'</span>
       <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init in B'</span>)

<span style="color: #a0522d;">b</span> = B() <span style="color: #b22222;"># </span><span style="color: #b22222;">init in B
</span><span style="color: #483d8b;">print</span>(b.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">{'b1': 'b1'}</span>
</pre>
</div>

<p>
B实例一旦定义了初始化=__init__=方法，就不会自动调用父类的初始化=__init__=方法，需要手动调用
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">a1</span> = <span style="color: #8b2252;">'a1'</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">a2</span> = <span style="color: #8b2252;">'a2'</span>
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init in A'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>(A):
   <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
       <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">b1</span> = <span style="color: #8b2252;">'b1'</span>
       <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init in B'</span>)
       A.__init__(<span style="color: #a020f0;">self</span>)

<span style="color: #a0522d;">b</span> = B() <span style="color: #b22222;"># </span><span style="color: #b22222;">init in B
</span>
<span style="color: #483d8b;">print</span>(b.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27880;&#24847;&#30475;__a2
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init in A
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'b1': 'b1', 'a1': 'a1', '_A__a2': 'a2'}</span>
</pre>
</div>
</div>
<div id="outline-container-h:ace0f769-16ff-454f-ac96-36719252cd58" class="outline-5">
<h5 id="h:ace0f769-16ff-454f-ac96-36719252cd58">正确初始化</h5>
<div class="outline-text-5" id="text-h:ace0f769-16ff-454f-ac96-36719252cd58">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Animal</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, age):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init in Animal'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">show</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">self</span>.age)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Cat</span>(Animal):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, age, weight):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35843;&#29992;&#29238;&#31867;&#30340;__init__&#26041;&#27861;&#30340;&#39034;&#24207;&#26377;&#26102;&#20915;&#23450;&#30528;show&#26041;&#27861;&#30340;&#32467;&#26524;
</span>        <span style="color: #483d8b;">super</span>().__init__(age)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init in Cat'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age + 1
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">weight</span> = weight
        <span style="color: #483d8b;">super</span>().__init__(age)

<span style="color: #a0522d;">c</span> = Cat(10, 5)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init in Animal
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init in Cat
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init in Animal
</span>c.show() <span style="color: #b22222;">#</span><span style="color: #b22222;">10</span>
</pre>
</div>

<ul class="org-ul">
<li>注意，调用父类的 <code>__init__</code> 方法，出现在不同的位置，可能导致出现不同的结果</li>
<li>将上例中所有的实例属性改成私有变量</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Animal</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, age):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init in Animal'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">show</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">self</span>.__age)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Cat</span>(Animal):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, age, weight):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35843;&#29992;&#29238;&#31867;&#30340;__init__&#26041;&#27861;&#30340;&#39034;&#24207;&#26377;&#26102;&#20915;&#23450;&#30528;show&#26041;&#27861;&#30340;&#32467;&#26524;
</span>        <span style="color: #483d8b;">super</span>().__init__(age)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init in Cat'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age + 1
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__weight</span> = weight
        <span style="color: #483d8b;">super</span>().__init__(age)

<span style="color: #a0522d;">c</span> = Cat(10, 5)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init in Animal
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init in Cat
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init in Animal
</span>c.show() <span style="color: #b22222;"># </span><span style="color: #b22222;">10
</span>
<span style="color: #483d8b;">print</span>(c.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">{'_Animal__age': 10, '_Cat__age': 11, '_Cat__weight': 5}</span>
</pre>
</div>

<ul class="org-ul">
<li>上例中打印10，原因看 <code>__dict__</code> 就知道了。因为父类Animal的show方法中 <code>_age</code> 会被解释为 <code>_Animal__age</code> ，因此显示的是10，而不是11</li>
<li>这样的设计不好，Cat的实例c应该显示自己的属性值更好</li>
</ul>

<p>
解决的办法：
</p>

<ul class="org-ul">
<li>一个原则，自己的私有属性，就该自己的方法读取和修改，不要借助其他类的方法，即使是父类或者派生类的方法</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:fa1ec839-ae26-4a7d-a535-95f257e4e986" class="outline-4">
<h4 id="h:fa1ec839-ae26-4a7d-a535-95f257e4e986">单继承</h4>
<div class="outline-text-4" id="text-h:fa1ec839-ae26-4a7d-a535-95f257e4e986">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Animal</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">shout</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Animal shouts'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Cat</span>(Animal):
    <span style="color: #a020f0;">pass</span>

<span style="color: #a0522d;">a</span> = Animal()
a.shout() <span style="color: #b22222;"># </span><span style="color: #b22222;">Animal shouts
</span><span style="color: #a0522d;">c</span> = Cat()
c.shout() <span style="color: #b22222;"># </span><span style="color: #b22222;">Animal shouts</span>
</pre>
</div>

<p>
上面例子中，类的继承列表只有一个类，这种继承为单一继承。
</p>

<p>
继承的用途：在子类上实例对基类的增强，实现多态。
</p>
</div>
</div>
<div id="outline-container-h:f34408cd-280f-4add-bcd7-8c11ea12ae24" class="outline-4">
<h4 id="h:f34408cd-280f-4add-bcd7-8c11ea12ae24">多态</h4>
<div class="outline-text-4" id="text-h:f34408cd-280f-4add-bcd7-8c11ea12ae24">
<p>
在面向对象中，父类通过继承联系在一起，如果可能通过一套方法，就可以实现不同表现，就是多态。
</p>
</div>
</div>
</div>
<div id="outline-container-h:db87431b-946e-4e2e-b867-ae70edf05e94" class="outline-3">
<h3 id="h:db87431b-946e-4e2e-b867-ae70edf05e94">多继承</h3>
<div class="outline-text-3" id="text-h:db87431b-946e-4e2e-b867-ae70edf05e94">
<p>
一个类继承自多个类就是多继承，它将具有多个类的特征。
</p>
</div>
<div id="outline-container-h:44da41e4-6ea9-43e6-be76-816a41f7040f" class="outline-4">
<h4 id="h:44da41e4-6ea9-43e6-be76-816a41f7040f">多继承弊端</h4>
<div class="outline-text-4" id="text-h:44da41e4-6ea9-43e6-be76-816a41f7040f">
<ul class="org-ul">
<li>多继承很好的模拟了世界，因为事物很少是单一继承，但是舍弃简单，必然引入复杂性，带来了冲突。</li>
<li>多继承的实现会导致编译器设计的复杂度增加，所以有些高级编程语言舍弃了类的多继承。</li>
<li>C++支持多继承；Java舍弃了多继承。</li>
<li>Java中，一个类可以实现多个接口，一个接口也可以继承多个接口。Java的接口很纯粹，只是方法的声明，继承者必须实现这些方法，就具有了这些能力，就能干什么。</li>
<li>多继承可能会带来二义性，实现多继承的语言，要解决二义性，深度优先或者广度优先。</li>
</ul>
</div>
</div>
<div id="outline-container-h:f49f5b53-0468-4735-a4a6-ae21a07cedef" class="outline-4">
<h4 id="h:f49f5b53-0468-4735-a4a6-ae21a07cedef">Python多继承实现</h4>
<div class="outline-text-4" id="text-h:f49f5b53-0468-4735-a4a6-ae21a07cedef">

<figure id="orgb55208c">
<img src="./images/img_20250113_111827.png" alt="img_20250113_111827.png" width="50%">

</figure>


<p>
左图是多继承（菱形继承），右图是单一继承
</p>

<p>
多继承带来路径选择问题, 究竟是继承哪个父类的特征呢？
</p>

<p>
Python使用MRO（method resolution order方法解析顺序）解决基类搜索顺序问题。
</p>
<ul class="org-ul">
<li>历史原因，MRO有三个搜索算法：
<ol class="org-ol">
<li>经典算法，按照定义从左到右，深度优先策略。2.2版本之前

<ul class="org-ul">
<li>左图的MRO是MyClass,D,B,A,C,A</li>
</ul></li>

<li>新式类算法，是经典算法的升级，深度优先，重复的只保留最后一个。2.2版本

<ul class="org-ul">
<li>左图的MRO是MyClass,D,B,C,A,object</li>
</ul></li>

<li>C3算法，在类被创建出来的时候，就计算出一个MRO有序列表。2.3之后，Python3唯一支持的算法

<ul class="org-ul">
<li>左图中的MRO是MyClass,D,B,C,A,object的列表</li>
<li>C3算法解决多继承的二义性</li>
</ul></li>
</ol></li>
</ul>

<p>
经典算法有很大的问题，如果C中有就去覆盖了A的方法，也不会访问到C的方法，因为先访问A的（深度优先）。
</p>

<p>
新式类算法，依然采用深度优先，解决了重复问题，但是同经典算法一样，没有解决继承的单调性。
</p>

<ul class="org-ul">
<li>C3算法，解决了继承的单调性，它阻止创建之前版本产生二义性的代码。求得的MRO本质是为了线性化，且确定了顺序。</li>
<li>单调性：假设有A、B、C三个类，C的mro是[C, A, B]，那么C的子类的mro中，A、B的顺序一致就是单调的。</li>
</ul>
</div>
</div>
<div id="outline-container-h:5c05ad50-382b-4675-aeb4-774a359e6875" class="outline-4">
<h4 id="h:5c05ad50-382b-4675-aeb4-774a359e6875">多继承的缺点</h4>
<div class="outline-text-4" id="text-h:5c05ad50-382b-4675-aeb4-774a359e6875">
<p>
当类很多，继承复杂的情况下， 继承路径太多，很难说清什么样的继承路径。
Python语法是允许多继承，但Python代码是解释执行，只有执行到的时候，才发现错误。
</p>

<p>
团队协助开发，如果引入多继承，那代码就不可控。
</p>

<p>
不管编程语言是否支持多继承，都应当避免多继承。
</p>

<p>
Python的面向对象，我们看到的太灵活了，太开放了，所以要团队守规矩。
</p>
</div>
</div>
<div id="outline-container-h:f41f1157-1a1b-4e4f-9009-58621648b1aa" class="outline-4">
<h4 id="h:f41f1157-1a1b-4e4f-9009-58621648b1aa">Mixin</h4>
<div class="outline-text-4" id="text-h:f41f1157-1a1b-4e4f-9009-58621648b1aa">
<p>
文档document类是其他所有文档类的抽象基类。Word，pdf是document的子类。
</p>

<p>
需求：为document子类提供打印能力。
</p>

<p>
思路1：在document中提供print方法。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Document</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>,content):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">content</span> = content

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#25171;&#21360;'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Word</span>(Document):<span style="color: #a020f0;">pass</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Pdf</span>(Document):<span style="color: #a020f0;">pass</span>

<span style="color: #a0522d;">w</span> = Word(<span style="color: #8b2252;">'test word'</span>)
w.<span style="color: #483d8b;">print</span>()
<span style="color: #a0522d;">p</span> = Pdf(<span style="color: #8b2252;">"test pdf"</span>)
p.<span style="color: #483d8b;">print</span>()
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22522;&#31867;&#25552;&#20379;&#30340;&#26041;&#27861;&#19981;&#24212;&#35813;&#20855;&#20307;&#23454;&#29616;&#65292;&#22240;&#20026;&#23427;&#26410;&#24517;&#36866;&#21512;&#23376;&#31867;&#30340;&#25171;&#21360;&#65292;&#23376;&#31867;&#20013;&#38656;&#35201;&#35206;&#30422;&#37325;&#20889;&#12290;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">print&#31639;&#26159;&#19968;&#31181;&#33021;&#21147;&#8212;&#8212;&#25171;&#21360;&#33021;&#21147;&#65292;&#19981;&#26159;&#25152;&#26377;&#30340;document&#30340;&#23376;&#31867;&#37117;&#38656;&#35201;&#30340;&#65292;&#25152;&#20197;&#65292;&#20174;&#36825;&#20010;&#35282;&#24230;&#20986;&#21457;&#65292;&#26377;&#28857;&#38382;&#39064;&#12290;</span>
</pre>
</div>


<p>
思路2： 需要打印的子类上增加
</p>

<p>
如果在现有子类上直接增加，违反了OCP原则，所以应该继承后增加
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Document</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>,content):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">content</span> = content

    <span style="color: #b22222;"># </span><span style="color: #b22222;">def print(self):
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">print('&#25171;&#21360;')
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26410;&#23454;&#29616;&#30340;&#26041;&#27861;&#65292;&#25277;&#35937;&#26041;&#27861;&#65292;&#35268;&#33539;&#23376;&#31867;&#34892;&#20026;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">pass #&#22522;&#31867;&#19981;&#23454;&#29616;.
</span>        <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">NotImplementedError</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25243;&#24322;&#24120;&#65292;&#26410;&#23454;&#29616;&#24322;&#24120;
</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Word</span>(Document):<span style="color: #a020f0;">pass</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Pdf</span>(Document):<span style="color: #a020f0;">pass</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#19978;&#38754;&#37117;&#26159;&#31532;&#19977;&#26041;&#24211;&#65292;&#20320;&#35273;&#24471;&#19981;&#21512;&#36866;&#65292;&#33258;&#24049;&#32487;&#25215;&#35206;&#30422;&#23601;&#26159;&#20102;
</span><span style="color: #b22222;">## </span><span style="color: #b22222;">OCP&#21407;&#21017;&#65292;&#37117;&#24212;&#35813;&#32487;&#25215;&#21518;&#35206;&#30422;
</span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">PrintableWord</span>(Word):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">self</span>.content, <span style="color: #8b2252;">'~~~'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PrintablePdf</span>(Pdf):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">self</span>.content, <span style="color: #8b2252;">'+++'</span>)

<span style="color: #a0522d;">w</span> = Word(<span style="color: #8b2252;">'test word'</span>)
w.<span style="color: #483d8b;">print</span>()
<span style="color: #a0522d;">p</span> = Pdf(<span style="color: #8b2252;">"test pdf"</span>)
p.<span style="color: #483d8b;">print</span>()
</pre>
</div>

<p>
思路3：装饰器
</p>

<p>
用装饰器增强一个类，把功能给类附加上去，那个类需要，就装饰它。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Document</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>,content):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">content</span> = content

    <span style="color: #b22222;"># </span><span style="color: #b22222;">def print(self):
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">print('&#25171;&#21360;')
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">def print(self): #&#26410;&#23454;&#29616;&#30340;&#26041;&#27861;&#65292;&#25277;&#35937;&#26041;&#27861;&#65292;&#35268;&#33539;&#23376;&#31867;&#34892;&#20026;
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">#pass #&#22522;&#31867;&#19981;&#23454;&#29616;.
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">raise NotImplementedError #&#25243;&#24322;&#24120;&#65292;&#26410;&#23454;&#29616;&#24322;&#24120;
</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Word</span>(Document):<span style="color: #a020f0;">pass</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Pdf</span>(Document):<span style="color: #a020f0;">pass</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#19978;&#38754;&#37117;&#26159;&#31532;&#19977;&#26041;&#24211;&#65292;&#20320;&#35273;&#24471;&#19981;&#21512;&#36866;&#65292;&#33258;&#24049;&#32487;&#25215;&#35206;&#30422;&#23601;&#26159;&#20102;
</span><span style="color: #b22222;">## </span><span style="color: #b22222;">OCP&#21407;&#21017;&#65292;&#37117;&#24212;&#35813;&#32487;&#25215;&#21518;&#35206;&#30422;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;&#21151;&#33021;&#19981;&#26159;&#26680;&#24515;&#19994;&#21153;&#21151;&#33021;&#65292;&#20063;&#19981;&#26159;&#25152;&#26377;&#30340;&#23376;&#31867;&#37117;&#38656;&#35201;&#30340;&#65292;&#35841;&#38656;&#35201;&#32473;&#35841;&#65292;&#32570;&#20160;&#20040;&#34917;&#20160;&#20040;&#65292;&#29992;&#35013;&#39280;&#22120;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">printable</span>(cls):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_print</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36991;&#20813;&#36882;&#24402;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">self</span>.content, <span style="color: #8b2252;">'~~~'</span>)
    <span style="color: #b22222;">#</span><span style="color: #b22222;">cls.print = lambda self: print(self.content&#65292; '~~~')
</span>    cls.<span style="color: #483d8b;">print</span> = _print
    <span style="color: #a020f0;">return</span> cls

<span style="color: #228b22;">@printable</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PrintableWord</span>(Word):
    <span style="color: #a020f0;">pass</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">def print(self):
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">print(self.content, '~~~')
</span>
<span style="color: #228b22;">@printable</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PrintablePdf</span>(Pdf): <span style="color: #a020f0;">pass</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">def print(self):
</span><span style="color: #b22222;">#         </span><span style="color: #b22222;">print(self.content, '+++')
</span>
<span style="color: #a0522d;">pw</span> = PrintableWord(<span style="color: #8b2252;">'test pw~~~'</span>)
pw.<span style="color: #483d8b;">print</span>()  <span style="color: #b22222;">#</span><span style="color: #b22222;">: test pw~~~ ~~~
</span>
<span style="color: #a0522d;">ppdf</span> = PrintablePdf(<span style="color: #8b2252;">'test pfd +++'</span>)
ppdf.<span style="color: #483d8b;">print</span>() <span style="color: #b22222;">#</span><span style="color: #b22222;">: test pfd +++ ~~~
</span>

</pre>
</div>

<p>
思路4：Mixin
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Document</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>,content):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">content</span> = content

    <span style="color: #b22222;"># </span><span style="color: #b22222;">def print(self):
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">print('&#25171;&#21360;')
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">def print(self): #&#26410;&#23454;&#29616;&#30340;&#26041;&#27861;&#65292;&#25277;&#35937;&#26041;&#27861;&#65292;&#35268;&#33539;&#23376;&#31867;&#34892;&#20026;
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">#pass #&#22522;&#31867;&#19981;&#23454;&#29616;.
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">raise NotImplementedError #&#25243;&#24322;&#24120;&#65292;&#26410;&#23454;&#29616;&#24322;&#24120;
</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Word</span>(Document):<span style="color: #a020f0;">pass</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Pdf</span>(Document):<span style="color: #a020f0;">pass</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#19978;&#38754;&#37117;&#26159;&#31532;&#19977;&#26041;&#24211;&#65292;&#20320;&#35273;&#24471;&#19981;&#21512;&#36866;&#65292;&#33258;&#24049;&#32487;&#25215;&#35206;&#30422;&#23601;&#26159;&#20102;
</span><span style="color: #b22222;">## </span><span style="color: #b22222;">OCP&#21407;&#21017;&#65292;&#37117;&#24212;&#35813;&#32487;&#25215;&#21518;&#35206;&#30422;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;&#21151;&#33021;&#19981;&#26159;&#26680;&#24515;&#19994;&#21153;&#21151;&#33021;&#65292;&#20063;&#19981;&#26159;&#25152;&#26377;&#30340;&#23376;&#31867;&#37117;&#38656;&#35201;&#30340;&#65292;&#35841;&#38656;&#35201;&#32473;&#35841;&#65292;&#32570;&#20160;&#20040;&#34917;&#20160;&#20040;&#65292;&#29992;&#35013;&#39280;&#22120;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">Mixin &#32570;&#20160;&#20040;&#34917;&#20160;&#20040; &#31867;&#23601;&#21487;&#20197;&#32487;&#25215;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">printable</span>(cls):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_print</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36991;&#20813;&#36882;&#24402;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">self</span>.content, <span style="color: #8b2252;">'~~~'</span>)
    <span style="color: #b22222;">#</span><span style="color: #b22222;">cls.print = lambda self: print(self.content&#65292; '~~~')
</span>    cls.<span style="color: #483d8b;">print</span> = _print
    <span style="color: #a020f0;">return</span> cls

<span style="color: #228b22;">@printable</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PrintableWord</span>(Word):
    <span style="color: #a020f0;">pass</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">def print(self):
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">print(self.content, '~~~')
</span>
<span style="color: #a0522d;">pw</span> = PrintableWord(<span style="color: #8b2252;">'test pw~~~'</span>)
pw.<span style="color: #483d8b;">print</span>()  <span style="color: #b22222;">#</span><span style="color: #b22222;">: test pw~~~ ~~~
</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PrintableMixin</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">self</span>.content, <span style="color: #8b2252;">'+++'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PrintableWordMixin</span>(PrintableMixin, Pdf): <span style="color: #a020f0;">pass</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#26159;&#22810;&#32487;&#25215;
</span><span style="color: #483d8b;">print</span>(PrintableWordMixin.mro()) <span style="color: #b22222;">#</span><span style="color: #b22222;">: [&lt;class '__main__.PrintableWordMixin'&gt;, &lt;class '__main__.PrintableMixin'&gt;, &lt;class '__main__.Pdf'&gt;, &lt;class '__main__.Document'&gt;, &lt;class 'object'&gt;]
</span><span style="color: #483d8b;">print</span>(PrintableWordMixin.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">: {'__module__': '__main__', '__firstlineno__': 38, '__static_attributes__': (), '__doc__': None}
</span><span style="color: #483d8b;">print</span>(PrintableMixin.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">: {'__module__': '__main__', '__firstlineno__': 34, 'print': &lt;function PrintableMixin.print at 0x00000193BED91B20&gt;, '__static_attributes__': (), '__dict__': &lt;attribute '__dict__' of 'PrintableMixin' objects&gt;, '__weakref__': &lt;attribute '__weakref__' of 'PrintableMixin' objects&gt;, '__doc__': None}
</span>
<span style="color: #a0522d;">pwm</span> = PrintableWordMixin(<span style="color: #8b2252;">'test pdf mix***'</span>)
pwm.<span style="color: #483d8b;">print</span>()  <span style="color: #b22222;">#</span><span style="color: #b22222;">: test pdf mix*** +++
</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">SuperPrintableMix</span>(PrintableMixin):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#36229;&#32423;&#25171;&#21360;&#24320;&#22987;~~~'</span>)
        <span style="color: #483d8b;">super</span>().<span style="color: #483d8b;">print</span>()
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#36229;&#32423;&#25171;&#21360;&#32467;&#26463;~~~'</span>)


<span style="color: #a020f0;">class</span> <span style="color: #228b22;">SuperPrintableWordMixin</span>(SuperPrintableMix, Pdf): <span style="color: #a020f0;">pass</span>

<span style="color: #a0522d;">spwm</span> = SuperPrintableWordMixin(<span style="color: #8b2252;">'super print ^^^'</span>)
spwm.<span style="color: #483d8b;">print</span>()
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &#36229;&#32423;&#25171;&#21360;&#24320;&#22987;~~~
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: super print ^^^ +++
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">: &#36229;&#32423;&#25171;&#21360;&#32467;&#26463;~~~
</span><span style="color: #483d8b;">print</span>(SuperPrintableWordMixin.mro())
<span style="color: #b22222;">#</span><span style="color: #b22222;">: [&lt;class '__main__.SuperPrintableWordMixin'&gt;, &lt;class '__main__.SuperPrintableMix'&gt;, &lt;class '__main__.PrintableMixin'&gt;, &lt;class '__main__.Pdf'&gt;, &lt;class '__main__.Document'&gt;, &lt;class 'object'&gt;]</span>
</pre>
</div>
</div>
<div id="outline-container-h:1929d90e-fa7b-4544-a563-464803709c9e" class="outline-5">
<h5 id="h:1929d90e-fa7b-4544-a563-464803709c9e">Mixin类</h5>
<div class="outline-text-5" id="text-h:1929d90e-fa7b-4544-a563-464803709c9e">
<ul class="org-ul">
<li>Mixin本质上就是多继承实现的</li>
<li>Mixin体现的是一种组合的设计模式</li>
<li>在面向对象的设计中，一个复杂的类，往往需要很多功能，而这些功能有来自不同的类提供，这就需要很多的类组合在一起</li>
<li>从设计模式的角度来说，多组合，少继承</li>
</ul>


<p>
Mixin类的使用原则
</p>
<ul class="org-ul">
<li>Mixin类中不应该显式的出现__init__初始化方法</li>
<li>Mixin类通常不能独立工作，因为它是准备混入别的类中的部分功能实现</li>
<li>Mixin类的祖先类也应是Mixin类</li>
</ul>

<p>
使用时，Mixin类通常在继承列表的第一个位置, 例如 <code>class PrintableWordMixin(PrintableMixin, Pdf): pass</code>
</p>

<p>
Mixin类和装饰器
</p>
<ul class="org-ul">
<li>这两种方式都可以使用，看个人喜好</li>
<li>如果还需要继承就得使用Mixin类的方式</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:4cd7c1b5-466d-49f0-b767-ba06566a3cbc" class="outline-4">
<h4 id="h:4cd7c1b5-466d-49f0-b767-ba06566a3cbc">练习</h4>
<div class="outline-text-4" id="text-h:4cd7c1b5-466d-49f0-b767-ba06566a3cbc">
</div>
<div id="outline-container-h:e2312756-4426-47ec-87cf-0b132fb962ca" class="outline-5">
<h5 id="h:e2312756-4426-47ec-87cf-0b132fb962ca">Shape基类</h5>
<div class="outline-text-5" id="text-h:e2312756-4426-47ec-87cf-0b132fb962ca">
<p>
要求所有子类都必须提供面积的计算，子类有三角形、矩形、圆。
</p>
<ul class="org-ul">
<li>上题圆类的数据可序列化</li>
</ul>

<p>
三角形面积&#x2013;海伦公式
</p>

<p>
假设在平面内，有一个三角形，边长分别为a、b、c，三角形的面积S可由以下公式求得：
</p>

\begin{equation*}
S \quad = \quad \sqrt{p(p-a)(p-b)(p-c)}
\end{equation*}

<p>
而公式里的p为半周长（周长的一半）：
</p>

<p>
\(p =   \frac{ ( a + b + c  ) }{2}\)
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Shape</span>:
    <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Triangle</span>(Shape):
    <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Rectangle</span>(Shape):
    <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Circle</span>(Shape):
    <span style="color: #a020f0;">pass</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> math

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Shape</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">area</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">NotImplementedError</span>(<span style="color: #8b2252;">'&#22522;&#31867;&#26410;&#23454;&#29616;'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Triangle</span>(Shape):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, a, b, c):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">a</span> = a
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">b</span> = b
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">c</span> = c

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">area</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a0522d;">p</span> = (<span style="color: #a020f0;">self</span>.a + <span style="color: #a020f0;">self</span>.b + <span style="color: #a020f0;">self</span>.c) / 2
        <span style="color: #a020f0;">return</span> math.sqrt(p * (p - <span style="color: #a020f0;">self</span>.a) * (p - <span style="color: #a020f0;">self</span>.b) * (p - <span style="color: #a020f0;">self</span>.c))

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Rectangle</span>(Shape):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, width, height):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">width</span> = width
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">height</span> = height

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">area</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.width * <span style="color: #a020f0;">self</span>.height

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Circle</span>(Shape):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, radius):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">r</span> = radius

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">area</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> 3.14 * <span style="color: #a020f0;">self</span>.r * <span style="color: #a020f0;">self</span>.r

<span style="color: #a0522d;">shapes</span> = [Triangle(3,4,5), Rectangle(4, 5), Circle(4)]
<span style="color: #a020f0;">for</span> s <span style="color: #a020f0;">in</span> shapes:
    <span style="color: #483d8b;">print</span>(s.area())
</pre>
</div>

<p>
利用属性装饰器
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> math

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Shape</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">area</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">NotImplementedError</span>(<span style="color: #8b2252;">'&#22522;&#31867;&#26410;&#23454;&#29616;'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Triangle</span>(Shape):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, a, b, c):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__a</span> = a
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__b</span> = b
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__c</span> = c
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__area</span> = <span style="color: #008b8b;">None</span>

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">a</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__a
    <span style="color: #228b22;">@a.setter</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">a</span>(<span style="color: #a020f0;">self</span>, value):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__a</span> = value
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__area</span> = <span style="color: #008b8b;">None</span>
    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">b</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__b
    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">c</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__c

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">area</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.__area <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
            <span style="color: #a0522d;">p</span> = (<span style="color: #a020f0;">self</span>.a + <span style="color: #a020f0;">self</span>.b + <span style="color: #a020f0;">self</span>.c) / 2
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__area</span> = math.sqrt(p * (p - <span style="color: #a020f0;">self</span>.a) * (p - <span style="color: #a020f0;">self</span>.b) * (p - <span style="color: #a020f0;">self</span>.c))
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__area

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Rectangle</span>(Shape):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, width, height):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">width</span> = width
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">height</span> = height

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">area</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.width * <span style="color: #a020f0;">self</span>.height

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Circle</span>(Shape):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, radius):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">r</span> = radius

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">area</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> 3.14 * <span style="color: #a020f0;">self</span>.r * <span style="color: #a020f0;">self</span>.r

<span style="color: #a0522d;">shapes</span> = [Triangle(3,4,5), Rectangle(4, 5), Circle(4)]
<span style="color: #a020f0;">for</span> s <span style="color: #a020f0;">in</span> shapes:
    <span style="color: #483d8b;">print</span>(s.area())

<span style="color: #a0522d;">t</span> = shapes[0]
<span style="color: #483d8b;">print</span>(t.area())
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> math

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Shape</span>:
    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">area</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">NotImplementedError</span>(<span style="color: #8b2252;">'&#22522;&#31867;&#26410;&#23454;&#29616;'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Triangle</span>(Shape):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, a, b, c):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__a</span> = a
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__b</span> = b
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__c</span> = c
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__area</span> = <span style="color: #008b8b;">None</span>

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">a</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__a
    <span style="color: #228b22;">@a.setter</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">a</span>(<span style="color: #a020f0;">self</span>, value):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__a</span> = value
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__area</span> = <span style="color: #008b8b;">None</span>
    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">b</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__b
    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">c</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__c

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">area</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.__area <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
            <span style="color: #a0522d;">p</span> = (<span style="color: #a020f0;">self</span>.a + <span style="color: #a020f0;">self</span>.b + <span style="color: #a020f0;">self</span>.c) / 2
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__area</span> = math.sqrt(p * (p - <span style="color: #a020f0;">self</span>.a) * (p - <span style="color: #a020f0;">self</span>.b) * (p - <span style="color: #a020f0;">self</span>.c))
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__area

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Rectangle</span>(Shape):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, width, height):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">width</span> = width
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">height</span> = height

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">area</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.width * <span style="color: #a020f0;">self</span>.height

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Circle</span>(Shape):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, radius):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">r</span> = radius

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">area</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> 3.14 * <span style="color: #a020f0;">self</span>.r * <span style="color: #a020f0;">self</span>.r

<span style="color: #a0522d;">shapes</span> = [Triangle(3,4,5), Rectangle(4, 5), Circle(4)]
<span style="color: #a020f0;">for</span> s <span style="color: #a020f0;">in</span> shapes:
    <span style="color: #483d8b;">print</span>(s.area)

<span style="color: #a0522d;">t</span> = shapes[0]
t.<span style="color: #a0522d;">a</span> = 5
<span style="color: #483d8b;">print</span>(t.area)
</pre>
</div>

<p>
圆类的数据可序列化。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> math
<span style="color: #a020f0;">import</span> json
<span style="color: #a020f0;">import</span> msgpack

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Shape</span>:
    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">area</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">NotImplementedError</span>(<span style="color: #8b2252;">'&#22522;&#31867;&#26410;&#23454;&#29616;'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Triangle</span>(Shape):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, a, b, c):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__a</span> = a
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__b</span> = b
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__c</span> = c
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__area</span> = <span style="color: #008b8b;">None</span>

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">a</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__a
    <span style="color: #228b22;">@a.setter</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">a</span>(<span style="color: #a020f0;">self</span>, value):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__a</span> = value
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__area</span> = <span style="color: #008b8b;">None</span>
    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">b</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__b
    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">c</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__c

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">area</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.__area <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
            <span style="color: #a0522d;">p</span> = (<span style="color: #a020f0;">self</span>.a + <span style="color: #a020f0;">self</span>.b + <span style="color: #a020f0;">self</span>.c) / 2
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__area</span> = math.sqrt(p * (p - <span style="color: #a020f0;">self</span>.a) * (p - <span style="color: #a020f0;">self</span>.b) * (p - <span style="color: #a020f0;">self</span>.c))
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__area

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Rectangle</span>(Shape):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, width, height):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">width</span> = width
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">height</span> = height

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">area</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.width * <span style="color: #a020f0;">self</span>.height

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Circle</span>(Shape):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, radius):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">r</span> = radius

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">area</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> 3.14 * <span style="color: #a020f0;">self</span>.r * <span style="color: #a020f0;">self</span>.r

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">SerializableMixin</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">dumps</span>(<span style="color: #a020f0;">self</span>, <span style="color: #483d8b;">type</span>=<span style="color: #8b2252;">'json'</span>):
        <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">type</span> == <span style="color: #8b2252;">'json'</span>:
            <span style="color: #a020f0;">return</span> json.dumps(<span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">__dict__</span>)
        <span style="color: #a020f0;">elif</span> <span style="color: #483d8b;">type</span> == <span style="color: #8b2252;">'msgpack'</span>:
            <span style="color: #a020f0;">return</span> msgpack.dumps(<span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">__dict__</span>)
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">TypeError</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">SerializableCircleMixin</span>(SerializableMixin, Circle): <span style="color: #a020f0;">pass</span>

<span style="color: #a0522d;">shapes</span> = [Triangle(3,4,5), Rectangle(4, 5), SerializableCircleMixin(4)]
<span style="color: #a020f0;">for</span> s <span style="color: #a020f0;">in</span> shapes:
    <span style="color: #483d8b;">print</span>(s.area)

<span style="color: #a0522d;">c</span> = shapes[2]
<span style="color: #483d8b;">print</span>(c.dumps()) <span style="color: #b22222;">#</span><span style="color: #b22222;">{"r": 4}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:3119d7f8-6237-4492-897a-a4e8be02dc44" class="outline-5">
<h5 id="h:3119d7f8-6237-4492-897a-a4e8be02dc44">用面向对象实现LinkedList链表</h5>
<div class="outline-text-5" id="text-h:3119d7f8-6237-4492-897a-a4e8be02dc44">
<ul class="org-ul">
<li>单向链表实现append，iternodes方法。</li>

<li>双向链表实现append，pop，insert，remove，iternodes方法。</li>
</ul>



<figure id="orgf718bba">
<img src="./images/img_20250114_164505.png" alt="img_20250114_164505.png" width="50%">

</figure>



<figure id="org36a643e">
<img src="./images/img_20250114_164506.png" alt="img_20250114_164506.png" width="50%">

</figure>

<p>
对于链表来说
</p>
<ul class="org-ul">
<li>每一个结点是一个独立的对象，结点自己知道内容是什么，下一跳是什么。</li>
<li>而链表则是一个容器，它内部装着一个个结点对象。</li>
<li>不管是单向还是双向，建议加一个尾tail，方便追加元素。</li>
</ul>

<p>
所以，建议设计2个类，一个是结点Node类，一个是链表LinkedList类。
</p>

<p>
如同一个箱子是容器，里面放的小球就是一个个节点。
</p>

<p>
如同一串珠子，节点对象是一个个小珠子，每一颗珠子关联其前后的珠子，所以珠子形成了串珠的概念，相当于容器。
一串珠子可以从固定的一头提起，这是单向链表；如果这串珠子可以从两头中的任意一头提起，这就是双向链表。
</p>
</div>
<div id="outline-container-h:ce5024c3-9fe6-46c3-9116-84389fca1ad2" class="outline-6">
<h6 id="h:ce5024c3-9fe6-46c3-9116-84389fca1ad2">简单的单向链表</h6>
<div class="outline-text-6" id="text-h:ce5024c3-9fe6-46c3-9116-84389fca1ad2">
<p>
增加append和iternodes
</p>


<p>
1.设置两个类
item元素本身，next为下一个元素
</p>

<p>
2.设置头head和尾tail，初始为None
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21333;&#21521;&#38142;&#34920;
</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Node</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, item, <span style="color: #483d8b;">next</span>=<span style="color: #008b8b;">None</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">item</span> = item
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span> = <span style="color: #483d8b;">next</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">str</span>(<span style="color: #a020f0;">self</span>.item)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">LinkedList</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = <span style="color: #008b8b;">None</span>
</pre>
</div>


<p>
3.尾部追加实现
</p>

<ul class="org-ul">
<li>假设1个都没有，头尾都不动，上一个是None，下一个也是None</li>
<li>假设有一个或多个，只需动尾部</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Node</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, item, <span style="color: #483d8b;">next</span>=<span style="color: #008b8b;">None</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">item</span> = item
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span> = <span style="color: #483d8b;">next</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">str</span>(<span style="color: #a020f0;">self</span>.item)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">LinkedList</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = <span style="color: #008b8b;">None</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">append</span>(<span style="color: #a020f0;">self</span>, value):
        <span style="color: #a0522d;">node</span> = Node(value) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#19968;&#20010;&#26159;None&#30340;&#32467;&#28857;
</span>
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.tail <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">empty
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = node
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = node
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">self</span>.tail.<span style="color: #483d8b;">next</span> = node
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = node
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>
</pre>
</div>

<p>
4.遍历链表
</p>
<ul class="org-ul">
<li>从头开始遍历，如果头是None，则不进入循环</li>
<li>判断下一个是否为None</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Node</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, item, <span style="color: #483d8b;">next</span>=<span style="color: #008b8b;">None</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">item</span> = item
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span> = <span style="color: #483d8b;">next</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">str</span>(<span style="color: #a020f0;">self</span>.item)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">LinkedList</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = <span style="color: #008b8b;">None</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">append</span>(<span style="color: #a020f0;">self</span>, value):
        <span style="color: #a0522d;">node</span> = Node(value) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#19968;&#20010;&#26159;None&#30340;&#32467;&#28857;
</span>
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.tail <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">empty
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = node
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = node
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">self</span>.tail.<span style="color: #483d8b;">next</span> = node
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = node
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">iternodes</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25552;&#37266;&#20320;&#36820;&#22238;&#19968;&#20010;&#24816;&#24615;&#23545;&#35937;
</span>        <span style="color: #a0522d;">current</span> = <span style="color: #a020f0;">self</span>.head
        <span style="color: #a020f0;">while</span> current:
            <span style="color: #a020f0;">yield</span> current
            <span style="color: #a0522d;">current</span> = current.<span style="color: #483d8b;">next</span>

<span style="color: #a0522d;">ll</span> = LinkedList()
ll.append(4).append(5).append(6) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38142;&#24335;&#32534;&#31243;
</span>
<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> ll.iternodes():
    <span style="color: #483d8b;">print</span>(x)
</pre>
</div>

<p>
5.链式编程，增加add函数
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Node</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, item, <span style="color: #483d8b;">next</span>=<span style="color: #008b8b;">None</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">item</span> = item
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span> = <span style="color: #483d8b;">next</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">str</span>(<span style="color: #a020f0;">self</span>.item)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">LinkedList</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = <span style="color: #008b8b;">None</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">append</span>(<span style="color: #a020f0;">self</span>, value):
        <span style="color: #a0522d;">node</span> = Node(value) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#19968;&#20010;&#26159;None&#30340;&#32467;&#28857;
</span>
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.tail <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">empty
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = node
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = node
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">self</span>.tail.<span style="color: #483d8b;">next</span> = node
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = node
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">iternodes</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25552;&#37266;&#20320;&#36820;&#22238;&#19968;&#20010;&#24816;&#24615;&#23545;&#35937;
</span>        <span style="color: #a0522d;">current</span> = <span style="color: #a020f0;">self</span>.head
        <span style="color: #a020f0;">while</span> current:
            <span style="color: #a020f0;">yield</span> current
            <span style="color: #a0522d;">current</span> = current.<span style="color: #483d8b;">next</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__add__</span>(<span style="color: #a020f0;">self</span>, item):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.append(item)

<span style="color: #a0522d;">ll</span> = LinkedList()
ll.append(4).append(5).append(6) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38142;&#24335;&#32534;&#31243;
</span>ll.append(7) + 8 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35843;&#29992;add&#20989;&#25968;
</span>ll + 9 + 10 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35843;&#29992;add&#20989;&#25968;
</span>
<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> ll.iternodes():
    <span style="color: #483d8b;">print</span>(x)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:87861018-ebb6-42d2-a9b6-f95c7f905d11" class="outline-6">
<h6 id="h:87861018-ebb6-42d2-a9b6-f95c7f905d11">简单的双向链表</h6>
<div class="outline-text-6" id="text-h:87861018-ebb6-42d2-a9b6-f95c7f905d11">
<p>
1.设置两个类
</p>
<ul class="org-ul">
<li>item元素本身，next为下一个元素，上一个元素prev</li>
</ul>


<p>
2.设置展示格式
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Node</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, item, <span style="color: #483d8b;">next</span>=<span style="color: #008b8b;">None</span>, prev=<span style="color: #008b8b;">None</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">item</span> = item
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span> = <span style="color: #483d8b;">next</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">Node instance
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">prev</span> = prev <span style="color: #b22222;"># </span><span style="color: #b22222;">Node instance
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"{} &lt;== {} ==&gt; {}"</span>.<span style="color: #483d8b;">format</span>(
            <span style="color: #a020f0;">self</span>.prev.item <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.prev <span style="color: #a020f0;">else</span> <span style="color: #008b8b;">None</span>,
            <span style="color: #a020f0;">self</span>.item, 
            <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span>.item <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span> <span style="color: #a020f0;">else</span> <span style="color: #008b8b;">None</span>
        )
</pre>
</div>

<p>
3.设置头和尾
</p>

<p>
4.尾部追加和add实现
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Node</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, item, <span style="color: #483d8b;">next</span>=<span style="color: #008b8b;">None</span>, prev=<span style="color: #008b8b;">None</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">item</span> = item
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span> = <span style="color: #483d8b;">next</span>  <span style="color: #b22222;"># </span><span style="color: #b22222;">Node instance
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">prev</span> = prev  <span style="color: #b22222;"># </span><span style="color: #b22222;">Node instance
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"{} &lt;== {} ==&gt; {}"</span>.<span style="color: #483d8b;">format</span>(
            <span style="color: #a020f0;">self</span>.prev.item <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.prev <span style="color: #a020f0;">else</span> <span style="color: #008b8b;">None</span>,
            <span style="color: #a020f0;">self</span>.item,
            <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span>.item <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span> <span style="color: #a020f0;">else</span> <span style="color: #008b8b;">None</span>
        )


<span style="color: #a020f0;">class</span> <span style="color: #228b22;">LinkedList</span>:  <span style="color: #b22222;"># </span><span style="color: #b22222;">Double
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = <span style="color: #008b8b;">None</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">append</span>(<span style="color: #a020f0;">self</span>, value):
        <span style="color: #a0522d;">node</span> = Node(value)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#19968;&#20010;&#26159;None&#30340;&#32467;&#28857;
</span>
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.tail <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:  <span style="color: #b22222;"># </span><span style="color: #b22222;">empty
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = node
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">self</span>.tail.<span style="color: #483d8b;">next</span> = node  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24403;&#21069;&#32467;&#28857;&#30340;&#19979;&#19968;&#20010;
</span>            node.<span style="color: #a0522d;">prev</span> = <span style="color: #a020f0;">self</span>.tail
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = node
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__add__</span>(<span style="color: #a020f0;">self</span>, item):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.append(item)
</pre>
</div>

<p>
5.insert 插入
</p>

<p>
6.pop 尾部弹出
</p>

<p>
7.remove 移除
</p>

<p>
7.iternodes 遍历
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Node</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, item, <span style="color: #483d8b;">next</span>=<span style="color: #008b8b;">None</span>, prev=<span style="color: #008b8b;">None</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">item</span> = item
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span> = <span style="color: #483d8b;">next</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">Node instance
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">prev</span> = prev <span style="color: #b22222;"># </span><span style="color: #b22222;">Node instance
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"{} &lt;== {} ==&gt; {}"</span>.<span style="color: #483d8b;">format</span>(
            <span style="color: #a020f0;">self</span>.prev.item <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.prev <span style="color: #a020f0;">else</span> <span style="color: #008b8b;">None</span>,
            <span style="color: #a020f0;">self</span>.item,
            <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span>.item <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span> <span style="color: #a020f0;">else</span> <span style="color: #008b8b;">None</span>
        )

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">LinkedList</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = <span style="color: #008b8b;">None</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">append</span>(<span style="color: #a020f0;">self</span>, value):
        <span style="color: #a0522d;">node</span> = Node(value) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#19968;&#20010;&#26159;None&#30340;&#32467;&#28857;
</span>
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.tail <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">empty
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = node
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">self</span>.tail.<span style="color: #483d8b;">next</span> = node
            node.<span style="color: #a0522d;">prev</span> = <span style="color: #a020f0;">self</span>.tail
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = node
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__add__</span>(<span style="color: #a020f0;">self</span>, item):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.append(item)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">insert</span>(<span style="color: #a020f0;">self</span>, index, value):
        <span style="color: #a020f0;">if</span> index &lt; 0:
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">IndexError</span>(<span style="color: #8b2252;">'Wrong index. Not negative index {}'</span>.<span style="color: #483d8b;">format</span>(index))

        <span style="color: #a0522d;">current</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">for</span> i,node <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">enumerate</span>(<span style="color: #a020f0;">self</span>.iternodes()):
            <span style="color: #a020f0;">if</span> i == index:
                <span style="color: #a0522d;">current</span> = node <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25214;&#21040;&#20102;&#20301;&#32622;
</span>                <span style="color: #a020f0;">break</span>
        <span style="color: #a020f0;">else</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#33021;&#25191;&#34892;self&#23376;&#21477;&#65292;&#35828;&#26126;&#65311; &#27809;&#26377;&#25214;&#21040;&#65292;&#36229;&#30028;&#20102;
</span>            <span style="color: #a020f0;">self</span>.append(value) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27809;&#25214;&#21040;,&#24403;&#20570;&#23614;&#37096;&#36861;&#21152;
</span>            <span style="color: #a020f0;">return</span>

        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25214;&#21040;&#20102;,&#23481;&#22120;&#38750;&#31354;&#65292;&#23601;&#20934;&#22791;&#22312;&#20013;&#38388;&#26576;&#20010;&#20301;&#32622;&#25554;&#20837;&#25968;&#25454;
</span>        <span style="color: #a0522d;">newnode</span> = Node(value)
        <span style="color: #a0522d;">prev</span> = current.prev
        <span style="color: #b22222;"># </span><span style="color: #b22222;">next = current
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">1 &#24320;&#22836;&#25554;&#20837;
</span>        <span style="color: #a020f0;">if</span> prev <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">i==0  index==0  self.head==current
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = newnode
        <span style="color: #a020f0;">else</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">2 &#38750;&#24320;&#22836;
</span>            newnode.<span style="color: #a0522d;">prev</span> = prev
            prev.<span style="color: #483d8b;">next</span> = newnode
        newnode.<span style="color: #483d8b;">next</span> = current
        current.<span style="color: #a0522d;">prev</span> = newnode

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">pop</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.tail <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">Exception</span>(<span style="color: #8b2252;">"empty"</span>)

        <span style="color: #a0522d;">tail</span> = <span style="color: #a020f0;">self</span>.tail <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24403;&#21069;&#23614;&#24052;&#20803;&#32032;
</span>        <span style="color: #a0522d;">prev</span> = tail.prev <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21069;&#23614;&#24052;&#19968;&#20010;&#20803;&#32032;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">1 only one &#25913;&#22836;&#23614;; 2 &#19981;&#27490;&#19968;&#20010;&#65292;&#25913;&#23614;
</span>        <span style="color: #a020f0;">if</span> prev <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">self.head.next is None
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = <span style="color: #008b8b;">None</span>
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">else</span>:
            prev.<span style="color: #483d8b;">next</span> = <span style="color: #008b8b;">None</span>
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = prev

        <span style="color: #a0522d;">value</span> = tail.item
        <span style="color: #a020f0;">return</span> value

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">remove</span>(<span style="color: #a020f0;">self</span>, index):
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.tail <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">Exception</span>(<span style="color: #8b2252;">"empty"</span>)

        <span style="color: #a020f0;">if</span> index &lt; 0:
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">IndexError</span>(<span style="color: #8b2252;">'Wrong index. Not negative index {}'</span>.<span style="color: #483d8b;">format</span>(index))

        <span style="color: #a0522d;">current</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">for</span> i,node <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">enumerate</span>(<span style="color: #a020f0;">self</span>.iternodes()):
            <span style="color: #a020f0;">if</span> i == index:
                <span style="color: #a0522d;">current</span> = node
                <span style="color: #a020f0;">break</span>
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">IndexError</span>(<span style="color: #8b2252;">'Out of range. index={}'</span>.<span style="color: #483d8b;">format</span>(index)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27809;&#25214;&#21040;
</span>
        <span style="color: #a0522d;">prev</span> = current.prev <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#21069;&#34987;&#31227;&#38500;&#33410;&#28857;&#30340;&#19978;&#19968;&#20010;
</span>        <span style="color: #483d8b;">next</span> = current.<span style="color: #483d8b;">next</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#21069;&#34987;&#31227;&#38500;&#33410;&#28857;&#30340;&#19979;&#19968;&#20010;
</span>
        <span style="color: #a020f0;">if</span> prev <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span> <span style="color: #a020f0;">and</span> <span style="color: #483d8b;">next</span> <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#26377;&#19968;&#20010; # self.head == self.tail
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = <span style="color: #008b8b;">None</span>
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">elif</span> prev <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22836;&#37096;&#31227;&#38500;
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = <span style="color: #483d8b;">next</span>
            <span style="color: #483d8b;">next</span>.<span style="color: #a0522d;">prev</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">elif</span> <span style="color: #483d8b;">next</span> <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23614;&#37096;&#31227;&#38500;
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = prev
            prev.<span style="color: #483d8b;">next</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">else</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20013;&#38388;&#31227;&#38500;
</span>            prev.<span style="color: #483d8b;">next</span> = <span style="color: #483d8b;">next</span>
            <span style="color: #483d8b;">next</span>.<span style="color: #a0522d;">prev</span> = prev

        <span style="color: #a020f0;">del</span> current <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21024;&#38500;&#20020;&#26102;&#21464;&#37327;,&#20943;&#23569;&#24341;&#29992;&#35745;&#25968;,&#37322;&#25918;&#20869;&#23384;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">iternodes</span>(<span style="color: #a020f0;">self</span>, reverse=<span style="color: #008b8b;">False</span>):
        <span style="color: #a0522d;">current</span> = <span style="color: #a020f0;">self</span>.tail <span style="color: #a020f0;">if</span> reverse <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">self</span>.head
        <span style="color: #a020f0;">while</span> current:
            <span style="color: #a020f0;">yield</span> current
            <span style="color: #a0522d;">current</span> = current.prev <span style="color: #a020f0;">if</span> reverse <span style="color: #a020f0;">else</span> current.<span style="color: #483d8b;">next</span>

<span style="color: #a0522d;">ll</span> = LinkedList() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23454;&#20363;&#21270;
</span>ll.append(0).append(1).append(2)
ll.insert(2, 4)
ll.pop()
ll.remove(0)
<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> ll.iternodes(): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20498;&#24207;&#36941;&#21382;
</span>    <span style="color: #483d8b;">print</span>(x)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span>*30)
<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> ll.iternodes(<span style="color: #008b8b;">True</span>): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#24207;&#36941;&#21382;
</span>    <span style="color: #483d8b;">print</span>(x)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">None &lt;== 1 ==&gt; 4
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1 &lt;== 4 ==&gt; None
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1 &lt;== 4 ==&gt; None
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">None &lt;== 1 ==&gt; 4</span>
</pre>
</div>


<p>
双向链表容器化
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Node</span>:
    <span style="color: #a0522d;">__slots__</span> = <span style="color: #8b2252;">'item next prev'</span>.split()

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, item, <span style="color: #483d8b;">next</span>=<span style="color: #008b8b;">None</span>, prev=<span style="color: #008b8b;">None</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">item</span> = item
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span> = <span style="color: #483d8b;">next</span>  <span style="color: #b22222;"># </span><span style="color: #b22222;">Node instance
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">prev</span> = prev  <span style="color: #b22222;"># </span><span style="color: #b22222;">Node instance
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"{} &lt;== {} ==&gt; {}"</span>.<span style="color: #483d8b;">format</span>(
            <span style="color: #a020f0;">self</span>.prev.item <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.prev <span style="color: #a020f0;">else</span> <span style="color: #008b8b;">None</span>,
            <span style="color: #a020f0;">self</span>.item,
            <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span>.item <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span> <span style="color: #a020f0;">else</span> <span style="color: #008b8b;">None</span>
        )


<span style="color: #a020f0;">class</span> <span style="color: #228b22;">LinkedList</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_size</span> = 0

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">append</span>(<span style="color: #a020f0;">self</span>, value):
        <span style="color: #a0522d;">node</span> = Node(value)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#19968;&#20010;&#26159;None&#30340;&#32467;&#28857;
</span>
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.tail <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:  <span style="color: #b22222;"># </span><span style="color: #b22222;">empty
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = node
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">self</span>.tail.<span style="color: #483d8b;">next</span> = node
            node.<span style="color: #a0522d;">prev</span> = <span style="color: #a020f0;">self</span>.tail
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = node
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_size</span> += 1
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__add__</span>(<span style="color: #a020f0;">self</span>, item):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.append(item)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">insert</span>(<span style="color: #a020f0;">self</span>, index, value):
        <span style="color: #a020f0;">if</span> index &gt;= <span style="color: #483d8b;">len</span>(<span style="color: #a020f0;">self</span>):
            <span style="color: #a020f0;">self</span>.append(value)
            <span style="color: #a020f0;">return</span>

        <span style="color: #a020f0;">if</span> index &lt; -<span style="color: #483d8b;">len</span>(<span style="color: #a020f0;">self</span>):
            <span style="color: #a0522d;">index</span> = 0
        <span style="color: #a0522d;">current</span> = <span style="color: #a020f0;">self</span>[index]

        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25214;&#21040;&#20102;,&#23481;&#22120;&#38750;&#31354;
</span>        <span style="color: #a0522d;">newnode</span> = Node(value)
        <span style="color: #a0522d;">prev</span> = current.prev
        <span style="color: #483d8b;">next</span> = current
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24320;&#22836;&#25554;&#20837;
</span>        <span style="color: #a020f0;">if</span> prev <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:  <span style="color: #b22222;"># </span><span style="color: #b22222;">i==0  index==0  self.head==current
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = newnode
        <span style="color: #a020f0;">else</span>:  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38750;&#24320;&#22836;
</span>            newnode.<span style="color: #a0522d;">prev</span> = prev
            prev.<span style="color: #483d8b;">next</span> = newnode
        newnode.<span style="color: #483d8b;">next</span> = <span style="color: #483d8b;">next</span>
        <span style="color: #483d8b;">next</span>.<span style="color: #a0522d;">prev</span> = newnode
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_size</span> += 1

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">pop</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.tail <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">Exception</span>(<span style="color: #8b2252;">"empty"</span>)

        <span style="color: #a0522d;">node</span> = <span style="color: #a020f0;">self</span>.tail  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24403;&#21069;&#20803;&#32032;
</span>        <span style="color: #a0522d;">prev</span> = node.prev  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21069;&#19968;&#20010;&#20803;&#32032;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">only one
</span>        <span style="color: #a020f0;">if</span> prev <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:  <span style="color: #b22222;"># </span><span style="color: #b22222;">self.head.next is None
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = <span style="color: #008b8b;">None</span>
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">else</span>:
            prev.<span style="color: #483d8b;">next</span> = <span style="color: #008b8b;">None</span>
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = prev

        <span style="color: #a0522d;">value</span> = node.item
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_size</span> -= 1
        <span style="color: #a020f0;">return</span> value

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">remove</span>(<span style="color: #a020f0;">self</span>, index):
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.tail <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">Exception</span>(<span style="color: #8b2252;">"empty"</span>)

        <span style="color: #a0522d;">current</span> = <span style="color: #a020f0;">self</span>[index]

        <span style="color: #a0522d;">prev</span> = current.prev
        <span style="color: #483d8b;">next</span> = current.<span style="color: #483d8b;">next</span>

        <span style="color: #a020f0;">if</span> prev <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span> <span style="color: #a020f0;">and</span> <span style="color: #483d8b;">next</span> <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#26377;&#19968;&#20010; # self.head == self.tail
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = <span style="color: #008b8b;">None</span>
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">elif</span> prev <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22836;&#37096;&#31227;&#38500;
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = <span style="color: #483d8b;">next</span>
            <span style="color: #483d8b;">next</span>.<span style="color: #a0522d;">prev</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">elif</span> <span style="color: #483d8b;">next</span> <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23614;&#37096;&#31227;&#38500;
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = prev
            prev.<span style="color: #483d8b;">next</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">else</span>:  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20013;&#38388;&#31227;&#38500;
</span>            prev.<span style="color: #483d8b;">next</span> = <span style="color: #483d8b;">next</span>
            <span style="color: #483d8b;">next</span>.<span style="color: #a0522d;">prev</span> = prev
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_size</span> -= 1
        <span style="color: #a020f0;">del</span> current  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21024;&#38500;&#20020;&#26102;&#21464;&#37327;,&#20943;&#23569;&#24341;&#29992;&#35745;&#25968;,&#37322;&#25918;&#20869;&#23384;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">iternodes</span>(<span style="color: #a020f0;">self</span>, reverse=<span style="color: #008b8b;">False</span>):
        <span style="color: #a0522d;">current</span> = <span style="color: #a020f0;">self</span>.tail <span style="color: #a020f0;">if</span> reverse <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">self</span>.head
        <span style="color: #a020f0;">while</span> current:
            <span style="color: #a020f0;">yield</span> current
            <span style="color: #a0522d;">current</span> = current.prev <span style="color: #a020f0;">if</span> reverse <span style="color: #a020f0;">else</span> current.<span style="color: #483d8b;">next</span>

    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23481;&#22120;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__len__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._size

    <span style="color: #a0522d;">size</span> = <span style="color: #483d8b;">property</span>(<span style="color: #a020f0;">lambda</span> <span style="color: #a020f0;">self</span>: <span style="color: #a020f0;">self</span>._size)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__getitem__</span>(<span style="color: #a020f0;">self</span>, index):
        <span style="color: #a020f0;">if</span> index &gt;= <span style="color: #483d8b;">len</span>(<span style="color: #a020f0;">self</span>) <span style="color: #a020f0;">or</span> index &lt; -<span style="color: #483d8b;">len</span>(<span style="color: #a020f0;">self</span>):
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">IndexError</span>(<span style="color: #8b2252;">'out of index : {}'</span>.<span style="color: #483d8b;">format</span>(index))

        <span style="color: #a0522d;">reverse</span> = <span style="color: #008b8b;">True</span> <span style="color: #a020f0;">if</span> index &lt; 0 <span style="color: #a020f0;">else</span> <span style="color: #008b8b;">False</span>
        <span style="color: #a0522d;">start</span> = 1 <span style="color: #a020f0;">if</span> index &lt; 0 <span style="color: #a020f0;">else</span> 0

        <span style="color: #a020f0;">for</span> i, node <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">enumerate</span>(<span style="color: #a020f0;">self</span>.iternodes(reverse), start):  <span style="color: #b22222;"># </span><span style="color: #b22222;">index &gt;=0
</span>            <span style="color: #a020f0;">if</span> i == <span style="color: #483d8b;">abs</span>(index):
                <span style="color: #a020f0;">return</span> node

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__setitem__</span>(<span style="color: #a020f0;">self</span>, index, value):  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25913;
</span>        <span style="color: #a020f0;">self</span>[index].<span style="color: #a0522d;">item</span> = value

    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27492;&#39764;&#26415;&#26041;&#27861;&#21487;&#20197;&#19981;&#23454;&#29616;,&#20294;&#26159;&#35201;&#20351;&#29992;reversed&#20869;&#24314;&#20989;&#25968;,&#24517;&#39035;&#26377;__len__&#21644;__getitem__
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__reversed__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">yield from self.iternodes(True)
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.iternodes(<span style="color: #008b8b;">True</span>)

    <span style="color: #b22222;"># </span><span style="color: #b22222;">def __iter__(self):
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">return self.iternodes()
</span>
    <span style="color: #a0522d;">__iter__</span> = iternodes

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__contains__</span>(<span style="color: #a020f0;">self</span>, item):
        <span style="color: #a0522d;">current</span> = <span style="color: #a020f0;">self</span>.head
        <span style="color: #a020f0;">while</span> current:
            <span style="color: #a020f0;">if</span> item == current.item:
                <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">True</span>
            <span style="color: #a0522d;">current</span> = current.<span style="color: #483d8b;">next</span>
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">False</span>


<span style="color: #a0522d;">ll</span> = LinkedList()

ll.append(0)
ll + 1 + 2 + 3
ll.insert(2, 4)
ll.pop()
ll.remove(0)
<span style="color: #a0522d;">ll</span>[1] = 6

<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> ll.iternodes():  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20498;&#24207;&#36941;&#21382;
</span>    <span style="color: #483d8b;">print</span>(x)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> ll.iternodes(<span style="color: #008b8b;">True</span>):  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#24207;&#36941;&#21382;
</span>    <span style="color: #483d8b;">print</span>(x)

<span style="color: #483d8b;">print</span>(2 <span style="color: #a020f0;">in</span> ll)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">len</span>(ll), ll[1])

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">None &lt;= = 1 == &gt; 6
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1 &lt;= = 6 == &gt; 2
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">6 &lt;= = 2 == &gt; None
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">6 &lt;= = 2 == &gt; None
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1 &lt;= = 6 == &gt; 2
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">None &lt;= = 1 == &gt; 6
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">True
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">3
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1 &lt;= = 6 == &gt; 2</span>
</pre>
</div>


<p>
Python系统编程
</p>
<ul class="org-ul">
<li>正则</li>
<li>文件处理</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-h:6691fa78-a2a4-4bfd-b10a-e300cff28bd5" class="outline-2">
<h2 id="h:6691fa78-a2a4-4bfd-b10a-e300cff28bd5">Python 异常处理与异常机制</h2>
<div class="outline-text-2" id="text-h:6691fa78-a2a4-4bfd-b10a-e300cff28bd5">
<p>
主要内容：
</p>
<ul class="org-ul">
<li>异常的工作机制</li>
<li>异常的语法</li>
<li>Python异常类结构</li>
<li>捕获异常</li>
<li>抛出与转移异常</li>
<li>Try/except/else 理解与使用</li>
<li>Try/finally 理解与使用</li>
<li><p>
With 语句及其异常域内存管理机制
</p>

<p>
参考：<a href="https://docs.python.org/zh-cn/3/tutorial/errors.html">https://docs.python.org/zh-cn/3/tutorial/errors.html</a>
</p></li>
</ul>
</div>
<div id="outline-container-h:7334a11c-9e22-4d37-8f71-8c2ae3bb5511" class="outline-3">
<h3 id="h:7334a11c-9e22-4d37-8f71-8c2ae3bb5511">错误和异常</h3>
<div class="outline-text-3" id="text-h:7334a11c-9e22-4d37-8f71-8c2ae3bb5511">
<p>
错误 Error
</p>
<ul class="org-ul">
<li>逻辑错误：算法写错了，例如加法写成了减法</li>
<li>笔误：例如变量名写错了，语法错误</li>
<li>函数或类使用错误，其实这也属于逻辑错误</li>
<li>总之，错误是可以避免的</li>
</ul>

<p>
异常 Exception
</p>
<ul class="org-ul">
<li>本意就是意外情况</li>
<li>这有个前提，没有出现上面说的错误，也就是说程序写的没有问题，但是在某些情况下，会出现一些意外，导致程序无法正常的执行下去</li>
<li>例如open函数操作一个文件，文件不存在，或者创建一个文件时已经存在了，或者访问一个网络文件，突然断网了，这就是异常，是个意外的情况</li>
<li>异常不可能避免</li>
</ul>

<p>
错误和异常
</p>
<ul class="org-ul">
<li>在高级编程语言中，一般都有错误和异常的概念，异常是可以捕获，并被处理的，但是错误是不能被捕获的</li>
</ul>

<p>
范例：对比异常和错误
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #483d8b;">print</span>( 1/ 0) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38500;0&#24322;&#24120;
</span>
<span style="color: #a020f0;">def</span> 1a(): <span style="color: #a020f0;">pass</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35821;&#27861;&#38169;&#35823;
</span>
<span style="color: #a020f0;">with</span> <span style="color: #483d8b;">open</span>(<span style="color: #8b2252;">'test'</span>) <span style="color: #a020f0;">as</span> f: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25243;&#20986;&#24322;&#24120;  &#25991;&#20214;&#19981;&#23384;&#22312;
</span>    <span style="color: #483d8b;">print</span>(f)
    f.write(<span style="color: #8b2252;">'abc'</span>)
</pre>
</div>

<p>
一个健壮的程序
</p>
<ul class="org-ul">
<li>应尽可能避免错误</li>
<li>尽可能捕获、处理各种异常</li>
</ul>
</div>
</div>
<div id="outline-container-h:1aeb293d-6a0e-4dc9-804c-634953251cce" class="outline-3">
<h3 id="h:1aeb293d-6a0e-4dc9-804c-634953251cce">产生异常</h3>
<div class="outline-text-3" id="text-h:1aeb293d-6a0e-4dc9-804c-634953251cce">
<p>
产生：
</p>
<ul class="org-ul">
<li>raise 语句显式的抛出异常</li>
<li>Python解释器自己检测到异常并引发它</li>
</ul>

<p>
范例: 检测到异常
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~~~~'</span>)
    1/0  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38500;&#38646;&#24322;&#24120;
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'----'</span>)

foo() <span style="color: #b22222;">#</span><span style="color: #b22222;">ZeroDivisionError: division by zero</span>
</pre>
</div>

<p>
范例: raise 主动抛出异常
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~~~~'</span>)
    <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">TypeError</span>
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'----'</span>)

foo() <span style="color: #b22222;">#</span><span style="color: #b22222;">TypeError</span>
</pre>
</div>

<p>
程序会在异常抛出的地方中断执行，如果不捕获，就会提前结束程序（其实是终止当前线程的执行）
</p>
</div>
</div>
<div id="outline-container-h:f4e55f1d-f417-4705-b8a5-8b9883857f57" class="outline-3">
<h3 id="h:f4e55f1d-f417-4705-b8a5-8b9883857f57">异常的捕获</h3>
<div class="outline-text-3" id="text-h:f4e55f1d-f417-4705-b8a5-8b9883857f57">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">try</span>:
        &#24453;&#25429;&#33719;&#24322;&#24120;&#30340;&#20195;&#30721;&#22359;
<span style="color: #a020f0;">except</span> [&#24322;&#24120;&#31867;&#22411;]:
        &#24322;&#24120;&#30340;&#22788;&#29702;&#20195;&#30721;&#22359;
</pre>
</div>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~~~~'</span>)
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">TypeError</span>
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'++++'</span>)
    <span style="color: #a020f0;">except</span>:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#20135;&#29983;&#24322;&#24120;&#20102;'</span>)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'----'</span>)

foo()
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'==end=='</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#20135;&#29983;&#24322;&#24120;&#20102;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">----
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">==end==</span>
</pre>
</div>
<p>
上例执行到raise时产生异常并抛出，由于使用了try…except语句块则捕捉到了这个异常，异常生成位置之后语句将不再执行，转而执行对应的except部分的语句，最后执行try&#x2026;except语句块之外的语句
</p>
</div>
<div id="outline-container-h:a3232678-966d-4592-8d05-9b1dfd3aaa2e" class="outline-4">
<h4 id="h:a3232678-966d-4592-8d05-9b1dfd3aaa2e">捕获指定类型的异常</h4>
<div class="outline-text-4" id="text-h:a3232678-966d-4592-8d05-9b1dfd3aaa2e">
<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">LEGB B&#20869;&#24314;&#20989;&#25968;&#12289;&#24322;&#24120;&#31867;&#12290;&#35299;&#37322;&#22120;&#21551;&#21160;&#26102;&#65292;&#23601;&#38656;&#35201;&#21152;&#36733;&#25152;&#26377;built-ins&#20869;&#23481;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>(a):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~~~~'</span>)
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">b</span> = 1/a <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38500;&#20197;0&#20250;&#25243;&#20986;&#38500;&#38646;&#24322;&#24120;&#31867;&#30340;&#23454;&#20363;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">raise TypeError
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'++++'</span>)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">except ZeroDivisionError: #&#25105;&#21482;&#20851;&#24515;&#21644;&#22788;&#29702;&#38500;&#38646;&#24322;&#24120; &#38500;&#38646;&#24322;&#24120;&#26159;&#31639;&#27861;&#24322;&#24120;&#30340;&#23376;&#31867; isinstance(&#24322;&#24120;&#23454;&#20363;, &#24322;&#24120;&#31867;&#22411;&#21644;&#24322;&#24120;&#31867;&#22411;&#30340;&#29238;&#31867;)
</span>    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">ArithmeticError</span>:
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24322;&#24120;&#26159;&#26377;&#20256;&#25215;&#32487;&#25215;&#65292;&#23376;&#31867;&#21482;&#38656;&#35201;&#35206;&#30422;&#29238;&#31867;&#30340;&#37096;&#20998;&#26041;&#27861;&#23601;&#21487;&#20197;&#20102;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#20135;&#29983;&#20102;&#38500;&#38646;&#24322;&#24120;&#20102;'</span>)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'----'</span>)

foo(0)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'==end=='</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#20135;&#29983;&#20102;&#38500;&#38646;&#24322;&#24120;&#20102;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">----
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">==end==</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:7b869503-5bb1-44b3-91c9-aa1da6ec2aab" class="outline-3">
<h3 id="h:7b869503-5bb1-44b3-91c9-aa1da6ec2aab">异常类及继承层次</h3>
<div class="outline-text-3" id="text-h:7b869503-5bb1-44b3-91c9-aa1da6ec2aab">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">Python&#24322;&#24120;&#30340;&#32487;&#25215;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">https://docs.python.org/zh-cn/3/tutorial/errors.html
</span>
BaseException             <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25152;&#26377;&#24322;&#24120;&#36890;&#29992;&#30340;&#22522;&#31867;
</span> &#9500;&#9472;&#9472; BaseExceptionGroup
 &#9500;&#9472;&#9472; GeneratorExit
 &#9500;&#9472;&#9472; KeyboardInterrupt    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38190;&#30424;&#20013;&#26029;
</span> &#9500;&#9472;&#9472; SystemExit           <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31995;&#32479;&#36864;&#20986;
</span> &#9492;&#9472;&#9472; Exception            <span style="color: #b22222;">#</span><span style="color: #b22222;">&#33258;&#24049;&#20889;&#30340;&#25152;&#26377;&#24322;&#24120;&#31867;&#65292;&#20174;&#36825;&#37324;&#24320;&#22987;&#32487;&#25215;
</span>      &#9500;&#9472;&#9472; ArithmeticError                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31639;&#26415;&#24322;&#24120;
</span>      &#9474;    &#9500;&#9472;&#9472; FloatingPointError           <span style="color: #b22222;">#</span><span style="color: #b22222;">&#28014;&#28857;&#25968;&#24322;&#24120;
</span>      &#9474;    &#9500;&#9472;&#9472; OverflowError                <span style="color: #b22222;">#</span><span style="color: #b22222;">&#28322;&#20986;&#24322;&#24120;
</span>      &#9474;    &#9492;&#9472;&#9472; ZeroDivisionError            <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38500;&#38646;&#24322;&#24120;
</span>      &#9500;&#9472;&#9472; AssertionError
      &#9500;&#9472;&#9472; AttributeError
      &#9500;&#9472;&#9472; BufferError
      &#9500;&#9472;&#9472; EOFError
      &#9500;&#9472;&#9472; ExceptionGroup [BaseExceptionGroup]
      &#9500;&#9472;&#9472; ImportError
      &#9474;    &#9492;&#9472;&#9472; ModuleNotFoundError
      &#9500;&#9472;&#9472; LookupError                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25214;&#20301;&#32622;&#25214;&#19981;&#30528;
</span>      &#9474;    &#9500;&#9472;&#9472; IndexError                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36229;&#30028;
</span>      &#9474;    &#9492;&#9472;&#9472; KeyError                     <span style="color: #b22222;">#</span><span style="color: #b22222;">key&#25214;&#19981;&#21040;
</span>      &#9500;&#9472;&#9472; MemoryError                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20869;&#23384;&#24322;&#24120;
</span>      &#9500;&#9472;&#9472; NameError                         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21517;&#31216;&#19981;&#23384;&#22312;
</span>      &#9474;    &#9492;&#9472;&#9472; UnboundLocalError
      &#9500;&#9472;&#9472; OSError                           <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25805;&#20316;&#31995;&#32479;&#37324;&#30340;&#38169;&#35823;
</span>      &#9474;    &#9500;&#9472;&#9472; BlockingIOError
      &#9474;    &#9500;&#9472;&#9472; ChildProcessError            <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23376;&#36827;&#31243;&#38169;&#35823;
</span>      &#9474;    &#9500;&#9472;&#9472; ConnectionError
      &#9474;    &#9474;    &#9500;&#9472;&#9472; BrokenPipeError
      &#9474;    &#9474;    &#9500;&#9472;&#9472; ConnectionAbortedError
      &#9474;    &#9474;    &#9500;&#9472;&#9472; ConnectionRefusedError
      &#9474;    &#9474;    &#9492;&#9472;&#9472; ConnectionResetError
      &#9474;    &#9500;&#9472;&#9472; FileExistsError              <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25991;&#20214;&#24050;&#23384;&#22312;
</span>      &#9474;    &#9500;&#9472;&#9472; FileNotFoundError            <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25991;&#20214;&#19981;&#23384;&#22312;
</span>      &#9474;    &#9500;&#9472;&#9472; InterruptedError
      &#9474;    &#9500;&#9472;&#9472; IsADirectoryError
      &#9474;    &#9500;&#9472;&#9472; NotADirectoryError
      &#9474;    &#9500;&#9472;&#9472; PermissionError
      &#9474;    &#9500;&#9472;&#9472; ProcessLookupError
      &#9474;    &#9492;&#9472;&#9472; TimeoutError
      &#9500;&#9472;&#9472; ReferenceError
      &#9500;&#9472;&#9472; RuntimeError                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36816;&#34892;&#26102;&#24322;&#24120;
</span>      &#9474;    &#9500;&#9472;&#9472; NotImplementedError
      &#9474;    &#9500;&#9472;&#9472; PythonFinalizationError
      &#9474;    &#9492;&#9472;&#9472; RecursionError               <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36882;&#24402;&#24322;&#24120;
</span>      &#9500;&#9472;&#9472; StopAsyncIteration
      &#9500;&#9472;&#9472; StopIteration                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36845;&#20195;&#27425;&#25968;&#36229;&#20986;
</span>      &#9500;&#9472;&#9472; SyntaxError                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35821;&#27861;&#38169;&#35823;
</span>      &#9474;    &#9492;&#9472;&#9472; IndentationError
      &#9474;         &#9492;&#9472;&#9472; TabError
      &#9500;&#9472;&#9472; SystemError
      &#9500;&#9472;&#9472; TypeError
      &#9500;&#9472;&#9472; ValueError
      &#9474;    &#9492;&#9472;&#9472; UnicodeError
      &#9474;         &#9500;&#9472;&#9472; UnicodeDecodeError
      &#9474;         &#9500;&#9472;&#9472; UnicodeEncodeError
      &#9474;         &#9492;&#9472;&#9472; UnicodeTranslateError
      &#9492;&#9472;&#9472; Warning
           &#9500;&#9472;&#9472; BytesWarning
           &#9500;&#9472;&#9472; DeprecationWarning
           &#9500;&#9472;&#9472; EncodingWarning
           &#9500;&#9472;&#9472; FutureWarning
           &#9500;&#9472;&#9472; ImportWarning
           &#9500;&#9472;&#9472; PendingDeprecationWarning
           &#9500;&#9472;&#9472; ResourceWarning
           &#9500;&#9472;&#9472; RuntimeWarning
           &#9500;&#9472;&#9472; SyntaxWarning
           &#9500;&#9472;&#9472; UnicodeWarning
           &#9492;&#9472;&#9472; UserWarning
</pre>
</div>
</div>
</div>
<div id="outline-container-h:dd991a27-a3eb-4d2f-bae2-69a6e7570b56" class="outline-3">
<h3 id="h:dd991a27-a3eb-4d2f-bae2-69a6e7570b56">BaseException及子类</h3>
<div class="outline-text-3" id="text-h:dd991a27-a3eb-4d2f-bae2-69a6e7570b56">
</div>
<div id="outline-container-h:38dc6de5-2107-4338-afaf-93c40d163a76" class="outline-4">
<h4 id="h:38dc6de5-2107-4338-afaf-93c40d163a76">BasaException</h4>
<div class="outline-text-4" id="text-h:38dc6de5-2107-4338-afaf-93c40d163a76">
<p>
所有内建异常类的基类是BasaException
</p>
</div>
</div>
<div id="outline-container-h:bd428d38-14b8-4bce-ac5a-35848c0c4630" class="outline-4">
<h4 id="h:bd428d38-14b8-4bce-ac5a-35848c0c4630">SystemExit</h4>
<div class="outline-text-4" id="text-h:bd428d38-14b8-4bce-ac5a-35848c0c4630">
<p>
sys.exit()函数引发的异常，异常不捕获处理，就直接交给Python解释器，解释器推出
</p>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> sys

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
sys.<span style="color: #008b8b;">exit</span>(100)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~'</span> * 30) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#20250;&#25191;&#34892;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#25429;&#33719;&#24322;&#24120;
</span><span style="color: #a020f0;">import</span> sys

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #a020f0;">try</span>:
    sys.<span style="color: #008b8b;">exit</span>(100) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27491;&#24120;&#36864;&#20986;
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~'</span> * 30)
<span style="color: #a020f0;">except</span> <span style="color: #228b22;">SystemExit</span>:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'system exits'</span>)

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">system exits
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">==============================</span>
</pre>
</div>

<p>
如果except语句捕获了异常，则继续向后面执行，如果没有捕获住该异常SystemExit，解释器直接退出程序
</p>

<p>
注意捕获前后程序退出状态码的变化。
</p>
</div>
</div>
<div id="outline-container-h:813de246-8c0e-45bb-9834-1b1aa7529c06" class="outline-4">
<h4 id="h:813de246-8c0e-45bb-9834-1b1aa7529c06">KeyboardInterrupt</h4>
<div class="outline-text-4" id="text-h:813de246-8c0e-45bb-9834-1b1aa7529c06">
<p>
对应的捕获用户终端行为Ctrl + C
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
            time.sleep(1)
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'___+++---'</span>)
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">KeyboardInterrupt</span>:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Ctrl + c'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33050;&#26412;&#22312;&#32456;&#31471;&#21629;&#20196;&#34892;&#25191;&#34892;&#65292; python t.py
</span>
foo()
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32456;&#31471;&#25191;&#34892;&#65292;&#25353;Ctrl&#21152;c&#21518;&#65292;&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">(.venv) PS D:\project\pyprojs&gt; python .\py-new\test.py
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">___+++---
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">___+++---
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Ctrl + c</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:8c861f5b-bf58-4542-8493-873f77f6d7d8" class="outline-3">
<h3 id="h:8c861f5b-bf58-4542-8493-873f77f6d7d8">Exception及子类</h3>
<div class="outline-text-3" id="text-h:8c861f5b-bf58-4542-8493-873f77f6d7d8">
<p>
Exception是所有内建的、非系统退出的异常的基类，自定义异常应该继承自它
</p>

<p>
SyntaxError 语法错误
</p>
<ul class="org-ul">
<li>Python将这种错误也归到异常类下面的Exception下的子类，但是这种错误是不可捕获的</li>
</ul>

<p>
ArithmeticError
</p>
<ul class="org-ul">
<li>所有算术计算引发的异常，其子类有除零异常等</li>
</ul>

<p>
LookupError
</p>
<ul class="org-ul">
<li>使用映射的键或序列的索引无效时引发的异常的基类：IndexError，KeyError</li>
</ul>

<p>
自定义异常类
</p>
<ul class="org-ul">
<li>从Exception继承的类</li>
</ul>

<p>
范例：自定义异常类
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyException</span>(<span style="color: #228b22;">Exception</span>):
    <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">try</span>:
    <span style="color: #a020f0;">raise</span> MyException()
<span style="color: #a020f0;">except</span> MyException: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25429;&#33719;&#33258;&#23450;&#20041;&#24322;&#24120;
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'catch the exception'</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:abdd5af4-3666-4178-84a2-931a00962664" class="outline-3">
<h3 id="h:abdd5af4-3666-4178-84a2-931a00962664">多种捕获</h3>
<div class="outline-text-3" id="text-h:abdd5af4-3666-4178-84a2-931a00962664">
<p>
except可以指定捕获的类型，捕获多种异常
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> sys

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyException</span>(<span style="color: #228b22;">Exception</span>):
    <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">try</span>:
    <span style="color: #a0522d;">a</span> = 1/0
    <span style="color: #a020f0;">raise</span> MyException
    <span style="color: #483d8b;">open</span>(<span style="color: #8b2252;">'t1'</span>)
    sys.<span style="color: #008b8b;">exit</span>(1)
<span style="color: #a020f0;">except</span> <span style="color: #228b22;">ZeroDivisionError</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">if elif &#20998;&#25903;&#21482;&#36827;&#19968;&#20010;&#65292;except&#31867;&#20284;
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'zero'</span>)
<span style="color: #a020f0;">except</span> <span style="color: #228b22;">ArithmeticError</span>:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'ari'</span>)
<span style="color: #a020f0;">except</span> MyException:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'catch my exception'</span>)
<span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span>:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'excption'</span>)
<span style="color: #a020f0;">except</span>:    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22823;&#23567;&#36890;&#21507; if elif ... else &#32570;&#30465;&#25429;&#33719;&#65292;&#21487;&#20197;&#27809;&#26377;
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'sysexit'</span>)
</pre>
</div>

<p>
捕获规则
</p>
<ul class="org-ul">
<li>捕获是从上到下依次比较，如果匹配，则执行匹配的except语句块</li>
<li>如果被一个except语句捕获，其他except语句就不会再次捕获了</li>
<li>如果没有任何一个except语句捕获到这个异常，则该异常向外抛出</li>
<li>except: 称为缺省捕获，缺省捕获必须是最后一个捕获语句</li>
</ul>

<p>
捕获的原则
</p>
<ul class="org-ul">
<li>从小到大，从具体异常到宽泛的异常</li>
</ul>
</div>
</div>
<div id="outline-container-h:8dbf33a8-1145-43b7-a8aa-30a3852bf6ba" class="outline-3">
<h3 id="h:8dbf33a8-1145-43b7-a8aa-30a3852bf6ba">as子句</h3>
<div class="outline-text-3" id="text-h:8dbf33a8-1145-43b7-a8aa-30a3852bf6ba">
<p>
先来看一个例子
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:<span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">try</span>:
    <span style="color: #b22222;"># </span><span style="color: #b22222;">1/0
</span>    <span style="color: #a020f0;">raise</span> 1
    <span style="color: #b22222;"># </span><span style="color: #b22222;">raise 'abc'
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">raise {}
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">raise A
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">raise A()
</span><span style="color: #a020f0;">except</span>:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'catch the exception'</span>)
</pre>
</div>

<p>
被抛出的异常，应该是异常类的实例，可以使用as子句获得这个对象
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyException</span>(<span style="color: #228b22;">Exception</span>):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, code, message):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">code</span> = code
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">message</span> = message

<span style="color: #a020f0;">try</span>:
    <span style="color: #a020f0;">raise</span> MyException
    <span style="color: #b22222;">#</span><span style="color: #b22222;">raise&#21518;&#21487;&#20197;&#36319;&#23454;&#20363;&#25110;&#32773;&#24322;&#24120;&#31867;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24322;&#24120;&#31867;&#23454;&#20363;&#21270;&#21021;&#22987;&#21270;&#65292; &#27491;&#24120;&#24212;&#35813; raise MyException(400, '')
</span><span style="color: #a020f0;">except</span> MyException <span style="color: #a020f0;">as</span> e:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'my exception +++'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">MyException.__init__() missing 2 required positional arguments: 'code' and 'message'
</span>
<span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
    <span style="color: #483d8b;">print</span>(e) <span style="color: #b22222;">#</span><span style="color: #b22222;">MyException.__init__() missing 2 required positional arguments: 'code' and 'message'
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#38750;&#31995;&#32479;&#36864;&#20986;&#30340;&#24322;&#24120;&#31867;&#37117;&#26159;&#25105;&#30340;&#23376;&#31867;&#30340;&#23454;&#20363;'</span>)
<span style="color: #a020f0;">except</span>:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'===end==='</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">MyException.__init__() missing 2 required positional arguments: 'code' and 'message'
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#38750;&#31995;&#32479;&#36864;&#20986;&#30340;&#24322;&#24120;&#31867;&#37117;&#26159;&#25105;&#30340;&#23376;&#31867;&#30340;&#23454;&#20363;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyException</span>(<span style="color: #228b22;">Exception</span>):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, code=404, message=<span style="color: #8b2252;">'NotFound'</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">code</span> = code
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">message</span> = message

<span style="color: #a020f0;">try</span>:
    <span style="color: #a020f0;">raise</span> MyException
    <span style="color: #b22222;">#</span><span style="color: #b22222;">raise MyException() #&#30452;&#25509;&#20889;&#31867;&#22411;&#30456;&#24403;&#20110;&#26080;&#21442;&#26500;&#36896;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">raise&#21518;&#21487;&#20197;&#36319;&#23454;&#20363;&#25110;&#32773;&#24322;&#24120;&#31867;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24322;&#24120;&#31867;&#23454;&#20363;&#21270;&#21021;&#22987;&#21270;&#65292; &#27491;&#24120;&#24212;&#35813; raise MyException(400, '')
</span><span style="color: #a020f0;">except</span> MyException <span style="color: #a020f0;">as</span> e:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'my exception +++'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">MyException.__init__() missing 2 required positional arguments: 'code' and 'message'
</span>
<span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
    <span style="color: #483d8b;">print</span>(e) <span style="color: #b22222;">#</span><span style="color: #b22222;">MyException.__init__() missing 2 required positional arguments: 'code' and 'message'
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#38750;&#31995;&#32479;&#36864;&#20986;&#30340;&#24322;&#24120;&#31867;&#37117;&#26159;&#25105;&#30340;&#23376;&#31867;&#30340;&#23454;&#20363;'</span>)
<span style="color: #a020f0;">except</span>:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'===end==='</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">my exception +++</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyException</span>(<span style="color: #228b22;">Exception</span>):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, code, message=<span style="color: #8b2252;">'NotFound'</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">code</span> = code
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">message</span> = message

<span style="color: #a020f0;">try</span>:
    <span style="color: #a020f0;">raise</span> MyException(404, <span style="color: #8b2252;">'Not'</span>)
    <span style="color: #b22222;">#</span><span style="color: #b22222;">raise MyException() #&#30452;&#25509;&#20889;&#31867;&#22411;&#30456;&#24403;&#20110;&#26080;&#21442;&#26500;&#36896;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">raise&#21518;&#21487;&#20197;&#36319;&#23454;&#20363;&#25110;&#32773;&#24322;&#24120;&#31867;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24322;&#24120;&#31867;&#23454;&#20363;&#21270;&#21021;&#22987;&#21270;&#65292; &#27491;&#24120;&#24212;&#35813; raise MyException(400, '')
</span><span style="color: #a020f0;">except</span> MyException <span style="color: #a020f0;">as</span> e:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'my exception +++'</span>)
    <span style="color: #483d8b;">print</span>(e.code, e.message) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#21462;&#21040;&#24322;&#24120;&#31867;&#22411;&#30340;&#23646;&#24615; 404 Not
</span>
<span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
    <span style="color: #483d8b;">print</span>(e)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#38750;&#31995;&#32479;&#36864;&#20986;&#30340;&#24322;&#24120;&#31867;&#37117;&#26159;&#25105;&#30340;&#23376;&#31867;&#30340;&#23454;&#20363;'</span>)
<span style="color: #a020f0;">except</span>:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'===end==='</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">my exception +++
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">404 Not
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">raise&#23376;&#21477;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">- raise &#21518;&#21487;&#20197;&#20889;&#20063;&#21487;&#20197;&#19981;&#20889;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">- raise &#24517;&#39035;&#20889;Exception&#25110;&#20854;&#23376;&#31867;&#30340;&#23454;&#20363;&#65292;&#22914;&#26524;&#20889;&#30340;&#26159;&#21069;&#38754;&#36825;&#20123;&#31867;&#30340;&#31867;&#65292;&#23454;&#38469;&#19978;&#20250;&#35843;&#29992;&#35813;&#31867;&#30340;&#26080;&#21442;&#26500;&#36896;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">- raise&#21518;&#20160;&#20040;&#37117;&#19981;&#20889;&#65292;&#19968;&#33324;&#19981;&#29992;&#65292;&#25243;&#20986;&#24403;&#21069;&#28608;&#27963;&#30340;&#24322;&#24120;</span>
</pre>
</div>

<p>
raise语句
</p>
<ul class="org-ul">
<li>raise后要求应该是BaseException类的子类或实例，如果是类，将被无参实例化。自定义应该是Exception子类</li>
<li>raise后什么都没有，表示抛出最近一个被激活的异常，如果没有被激活的异常，则抛类型异常。这种方式很少用</li>
</ul>
</div>
</div>
<div id="outline-container-h:85ea5910-ef6d-4695-a2eb-d61aeafb6681" class="outline-3">
<h3 id="h:85ea5910-ef6d-4695-a2eb-d61aeafb6681">finally子句</h3>
<div class="outline-text-3" id="text-h:85ea5910-ef6d-4695-a2eb-d61aeafb6681">
<p>
finally最终，即最后一定要执行的，try&#x2026;finally语句块中，不管是否发生了异常，都要执行finally的部分
</p>

<p>
范例
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">try</span>:
    <span style="color: #a0522d;">f</span> = <span style="color: #483d8b;">open</span>(<span style="color: #8b2252;">'test.txt'</span>)
<span style="color: #a020f0;">except</span> <span style="color: #228b22;">FileNotFoundError</span> <span style="color: #a020f0;">as</span> e:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} {} {}'</span>.<span style="color: #483d8b;">format</span>(e.__class__, e.errno, e.strerror))
<span style="color: #a020f0;">finally</span>:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#28165;&#29702;&#24037;&#20316;'</span>)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">f.close()
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class 'FileNotFoundError'&gt; 2 No such file or directory
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#28165;&#29702;&#24037;&#20316;</span>
</pre>
</div>

<p>
注意上例中的f的作用域，解决的办法是在外部定义f
</p>

<p>
finally中一般放置资源的清理、释放工作的语句
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">f</span> = <span style="color: #008b8b;">None</span>
<span style="color: #a020f0;">try</span>:
    <span style="color: #a0522d;">f</span> = <span style="color: #483d8b;">open</span>(<span style="color: #8b2252;">'test.txt'</span>)
<span style="color: #a020f0;">except</span> <span style="color: #228b22;">FileNotFoundError</span> <span style="color: #a020f0;">as</span> e:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} {} {}'</span>.<span style="color: #483d8b;">format</span>(e.__class__, e.errno, e.strerror))
<span style="color: #a020f0;">finally</span>:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#28165;&#29702;&#24037;&#20316;'</span>)
    <span style="color: #a020f0;">if</span> f:
        f.close()
</pre>
</div>

<p>
也可以在finally中再次捕获异常
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">try</span>:
    <span style="color: #a0522d;">f</span> = <span style="color: #483d8b;">open</span>(<span style="color: #8b2252;">'test.txt'</span>)
<span style="color: #a020f0;">except</span> <span style="color: #228b22;">FileNotFoundError</span> <span style="color: #a020f0;">as</span> e:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{}'</span>.<span style="color: #483d8b;">format</span>(e))
<span style="color: #a020f0;">finally</span>:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#28165;&#29702;&#24037;&#20316;'</span>)
    <span style="color: #a020f0;">try</span>:  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24322;&#24120;&#25429;&#33719; &#23884;&#22871;
</span>        f.close()
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #483d8b;">print</span>(e)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;
</span>[Errno 2] No such <span style="color: #483d8b;">file</span> <span style="color: #a020f0;">or</span> directory: <span style="color: #8b2252;">'test.txt'</span>
&#28165;&#29702;&#24037;&#20316;
name <span style="color: #8b2252;">'f'</span> <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> defined
</pre>
</div>
</div>
</div>
<div id="outline-container-h:5301b344-b6a5-47f9-b528-6832a4f106ca" class="outline-3">
<h3 id="h:5301b344-b6a5-47f9-b528-6832a4f106ca">语句嵌套和捕获</h3>
<div class="outline-text-3" id="text-h:5301b344-b6a5-47f9-b528-6832a4f106ca">
<ul class="org-ul">
<li>异常语句内部可以嵌入到try块、except块、finally块</li>
<li>异常在内部产生后，如果没有捕获到，就会继续向外抛出</li>
<li>如果外部也没能捕获到，将继续再向外抛出，直至异常代码所在线程，导致线程崩溃</li>
<li>finally中有return、break语句，则异常就不会继续向外抛出</li>
</ul>

<p>
范例: finally中有return、break语句，则异常就不会继续向外抛出
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">ret</span> = 1 / 0
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">KeyError</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #483d8b;">print</span>(e)
    <span style="color: #a020f0;">finally</span>:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'inner fin'</span>)
        <span style="color: #a020f0;">return</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24322;&#24120;&#34987;&#20002;&#24323;
</span><span style="color: #a020f0;">try</span>:
    foo()
<span style="color: #a020f0;">except</span>:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'outer catch'</span>)
<span style="color: #a020f0;">finally</span>:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'outer fin'</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;
</span>inner fin
outer fin
</pre>
</div>


<p>
范例：finally和try里都有return
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>():
    <span style="color: #a020f0;">try</span>:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'aaa'</span>)
        <span style="color: #a020f0;">return</span> 11 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#33324;&#24773;&#20917;&#19979;&#65292;return&#35821;&#21477;&#20250;&#31435;&#21363;&#36820;&#22238;&#65292;&#25152;&#20197;&#31532;&#19968;&#20010;return&#26377;&#25928;
</span>    <span style="color: #a020f0;">except</span>:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'bbb'</span>)
    <span style="color: #a020f0;">finally</span>:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'ccc'</span>)
        <span style="color: #a020f0;">return</span> 22 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30001;&#20110;&#19978;&#38754;&#30340;return&#22312;try&#37324;&#38754;&#65292;&#36824;&#26377;&#20010;return&#22312;finally&#37324;&#38754;&#65292;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32780;&#19988;finally&#19981;&#31649;try&#37324;&#38754;&#26159;&#21542;&#26377;&#24322;&#24120;&#37117;&#20250;&#25191;&#34892;&#65292;&#20197;&#26368;&#21518;&#30340;return&#26377;&#25928;
</span>    <span style="color: #a020f0;">return</span> 33

<span style="color: #483d8b;">print</span>(fn())
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">aaa
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">ccc
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">22</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:41e861d6-8770-49bb-8ce3-385d2a76a2c4" class="outline-3">
<h3 id="h:41e861d6-8770-49bb-8ce3-385d2a76a2c4">else子句</h3>
<div class="outline-text-3" id="text-h:41e861d6-8770-49bb-8ce3-385d2a76a2c4">
<p>
在except之后，finally之前
</p>

<p>
没有异常的时候会执行else语句
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">try</span>:
    <span style="color: #a0522d;">ret</span> = 1 * 0
<span style="color: #a020f0;">except</span> <span style="color: #228b22;">ArithmeticError</span> <span style="color: #a020f0;">as</span> e:
    <span style="color: #483d8b;">print</span>(e)
<span style="color: #a020f0;">else</span>:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'ok'</span>)
<span style="color: #a020f0;">finally</span>:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'fin'</span>)
</pre>
</div>

<p>
esle子句没有任何异常发生，则执行
</p>
</div>
</div>
<div id="outline-container-h:261992ac-ee9f-41e0-a230-89a7b615b301" class="outline-3">
<h3 id="h:261992ac-ee9f-41e0-a230-89a7b615b301">总结</h3>
<div class="outline-text-3" id="text-h:261992ac-ee9f-41e0-a230-89a7b615b301">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">try</span>:
    &lt;&#35821;&#21477;&gt;   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36816;&#34892;&#21035;&#30340;&#20195;&#30721;
</span><span style="color: #a020f0;">except</span> &lt;&#24322;&#24120;&#31867;&gt;:
    &lt;&#35821;&#21477;&gt;   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25429;&#33719;&#26576;&#31181;&#31867;&#22411;&#30340;&#24322;&#24120;
</span><span style="color: #a020f0;">except</span> &lt;&#24322;&#24120;&#31867;&gt; <span style="color: #a020f0;">as</span> &lt;&#21464;&#37327;&#21517;&gt;:
    &lt;&#35821;&#21477;&gt;   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25429;&#33719;&#26576;&#31181;&#31867;&#22411;&#30340;&#24322;&#24120;&#24182;&#33719;&#24471;&#23545;&#35937;
</span><span style="color: #a020f0;">else</span>:
    &lt;&#35821;&#21477;&gt;   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#27809;&#26377;&#24322;&#24120;&#21457;&#29983;
</span><span style="color: #a020f0;">finally</span>:
    &lt;&#35821;&#21477;&gt;   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36864;&#20986;try&#26102;&#24635;&#20250;&#25191;&#34892;</span>
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:1f8a8d56-15fa-410e-95f8-ed27f7fe8fa3" class="outline-2">
<h2 id="h:1f8a8d56-15fa-410e-95f8-ed27f7fe8fa3">argparse模块和PEP</h2>
<div class="outline-text-2" id="text-h:1f8a8d56-15fa-410e-95f8-ed27f7fe8fa3">
</div>
<div id="outline-container-h:e9cf6749-29d2-4ce4-a79d-120aabcf3ac0" class="outline-3">
<h3 id="h:e9cf6749-29d2-4ce4-a79d-120aabcf3ac0">argparse 模块</h3>
<div class="outline-text-3" id="text-h:e9cf6749-29d2-4ce4-a79d-120aabcf3ac0">
<p>
参数解析，3.2版本后出现。
</p>

<p>
官方文档：<a href="https://docs.python.org/3/library/argparse.html">https://docs.python.org/3/library/argparse.html</a>
</p>
</div>
<div id="outline-container-h:1ad6f38d-3fbe-4839-8eca-be155028a0be" class="outline-4">
<h4 id="h:1ad6f38d-3fbe-4839-8eca-be155028a0be">参数分类</h4>
<div class="outline-text-4" id="text-h:1ad6f38d-3fbe-4839-8eca-be155028a0be">
<p>
参数分为：
</p>
<ul class="org-ul">
<li>位置参数：参数放在那里，就要对应一个参数位置。例如/etc就是对应一个参数位置</li>
<li>选项参数：必须通过前面的 - 的短选项或者  &#x2013; 长选项然后后面的才算它的参数，当然短选项后面也可以没有参数。</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">ls -l /etc
<span style="color: #b22222;"># </span><span style="color: #b22222;">-l &#26159;&#36873;&#39033;&#21442;&#25968;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">/etc&#26159;&#20301;&#32622;&#21442;&#25968;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b58d9956-ba4c-42d9-b912-decb2712edec" class="outline-4">
<h4 id="h:b58d9956-ba4c-42d9-b912-decb2712edec">基本解析</h4>
<div class="outline-text-4" id="text-h:b58d9956-ba4c-42d9-b912-decb2712edec">
<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#33719;&#24471;&#19968;&#20010;&#21442;&#25968;&#35299;&#26512;&#22120;
</span>parser.print_help() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">usage: test.py [-h]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">options:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-h, --help  show this help message and exit</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:06f7d04c-51ce-4fd8-b19c-0103c7092ee7" class="outline-4">
<h4 id="h:06f7d04c-51ce-4fd8-b19c-0103c7092ee7">解析器的参数</h4>
<div class="outline-text-4" id="text-h:06f7d04c-51ce-4fd8-b19c-0103c7092ee7">
<ul class="org-ul">
<li>prog - 程序的名称 (默认值: os.path.basename(sys.argv[0]))</li>

<li>description - 要在参数帮助信息之前显示的文本（默认：无文本）</li>

<li>add_help - 为解析器添加一个 -h/&#x2013;help 选项（默认值： True）</li>
</ul>

<p>
范例
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">False</span>
)
parser.print_help()
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">usage: ls
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">List information about the FILEs (the current directory by default)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:1c08ee4f-3aff-420d-81c0-47d7a3e213cb" class="outline-4">
<h4 id="h:1c08ee4f-3aff-420d-81c0-47d7a3e213cb">位置参数解析</h4>
<div class="outline-text-4" id="text-h:1c08ee4f-3aff-420d-81c0-47d7a3e213cb">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">False</span>
)
parser.add_argument(<span style="color: #8b2252;">'path'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20301;&#32622;&#21442;&#25968;&#65292;&#24517;&#39035;&#20889;&#21442;&#25968;
</span>parser.print_help() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #a0522d;">args</span> = parser.parse_args() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512;
</span><span style="color: #483d8b;">print</span>(args) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;Namespace&#31867;&#22411;&#23454;&#20363;&#65292;&#23454;&#20363;&#26377;&#23646;&#24615;&#65292;&#23646;&#24615;&#26159;&#21442;&#25968;
</span><span style="color: #483d8b;">print</span>(args.path)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">(.venv) PS D:\project\pyproj&gt; python .\test.py d:/
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">usage: ls path
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">List information about the FILEs (the current directory by default)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">positional arguments:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">path
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='d:/')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">d:/</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">usage: ls [-h] path

[xx] <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#26377;&#21487;&#26080;
</span>path <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24517;&#39035;&#25552;&#20379;</span>
</pre>
</div>
</div>
<div id="outline-container-h:f5e838fe-0394-4e8c-b054-e33a9d4b3cad" class="outline-5">
<h5 id="h:f5e838fe-0394-4e8c-b054-e33a9d4b3cad">传参</h5>
<div class="outline-text-5" id="text-h:f5e838fe-0394-4e8c-b054-e33a9d4b3cad">
<pre class="example" id="org5e9d539">
parse_args(self, args=None, namespace=None)
</pre>

<ul class="org-ul">
<li>args参数列表，一个可迭代对象。内部会把可迭代对象转换成list。</li>
<li>如果为None则使用命令行传入参数，非None则使用args参数的可迭代对象。</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">False</span>
)
parser.add_argument(<span style="color: #8b2252;">'path'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20301;&#32622;&#21442;&#25968;&#65292;&#24517;&#39035;&#20889;&#21442;&#25968;
</span>parser.print_help() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span>

<span style="color: #a0522d;">args</span> = parser.parse_args((<span style="color: #8b2252;">'o:/abc'</span>,)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512;
</span><span style="color: #483d8b;">print</span>(args, args.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;Namespace&#31867;&#22411;&#23454;&#20363;&#65292;&#23454;&#20363;&#26377;&#23646;&#24615;&#65292;&#23646;&#24615;&#26159;&#21442;&#25968;
</span><span style="color: #483d8b;">print</span>(args.path)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">usage: ls path
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">List information about the FILEs (the current directory by default)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">positional arguments:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">path
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='o:/abc') {'path': 'o:/abc'}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">o:/abc</span>
</pre>
</div>


<p>
Namespace(path='d:/')里面的path参数存储在一个Namespace对象的属性上，可以
通过Namespace对象属性来访问，如args.path
</p>
</div>
</div>
<div id="outline-container-h:1098f498-3980-4894-9bb1-e010a19d4fbd" class="outline-5">
<h5 id="h:1098f498-3980-4894-9bb1-e010a19d4fbd">非必须位置参数</h5>
<div class="outline-text-5" id="text-h:1098f498-3980-4894-9bb1-e010a19d4fbd">
<p>
上面代码必须输入位置参数，否则会报错。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">True</span>
)
parser.add_argument(<span style="color: #8b2252;">'path'</span>, nargs=<span style="color: #8b2252;">'?'</span>, default=<span style="color: #8b2252;">'.'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Path help'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20301;&#32622;&#21442;&#25968;,&#21487;&#26377;&#21487;&#26080;&#65292;&#32570;&#30465;&#20540;&#65292;&#24110;&#21161;
</span>parser.print_help() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(('o:/abc',)) #&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512; python t.py o:/abc
</span><span style="color: #a0522d;">args</span> = parser.parse_args() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512; python t.py
</span><span style="color: #483d8b;">print</span>(args, args.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;Namespace&#31867;&#22411;&#23454;&#20363;&#65292;&#23454;&#20363;&#26377;&#23646;&#24615;&#65292;&#23646;&#24615;&#26159;&#21442;&#25968;
</span><span style="color: #483d8b;">print</span>(args.path)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">usage: ls [-h] [path]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">List information about the FILEs (the current directory by default)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">positional arguments:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">path        Path help
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">options:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-h, --help  show this help message and exit
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.') {'path': '.'}</span>
</pre>
</div>

<p>
可以看出path也变成可选的位置参数，没有提供就使用默认值 <code>.点号</code> 表示当前路径。
</p>
<ul class="org-ul">
<li>help 表示帮助文档中这个参数的描述</li>
<li>nargs 表示这个参数接收结果参数
<ul class="org-ul">
<li>? 表示可有可无</li>
<li>+ 表示至少一个</li>
<li>* 可以任意个</li>
<li>数字表示必须是指定数目个</li>
</ul></li>
<li>default 表示如果不提供该参数，就使用这个值。一般和 ?、* 配合，因为它们都可以
不提供位置参数，不提供就是缺省值</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:f18b8d2c-a195-4dee-a060-3247e7bf1a73" class="outline-4">
<h4 id="h:f18b8d2c-a195-4dee-a060-3247e7bf1a73">选项参数</h4>
<div class="outline-text-4" id="text-h:f18b8d2c-a195-4dee-a060-3247e7bf1a73">
</div>
<div id="outline-container-h:04f37fa8-95bc-433a-af58-3f385f28de45" class="outline-5">
<h5 id="h:04f37fa8-95bc-433a-af58-3f385f28de45">-l 的实现</h5>
<div class="outline-text-5" id="text-h:04f37fa8-95bc-433a-af58-3f385f28de45">
<div class="org-src-container">
<pre class="src src-python">parser.add_argument(<span style="color: #8b2252;">'-l'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Long list format'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">l&#23646;&#24615;&#21517;
</span>parser.add_argument(<span style="color: #8b2252;">'-l'</span>, action=<span style="color: #8b2252;">'store_const'</span>, const=22) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25552;&#20379; -l &#36873;&#39033;&#65292;&#23545;&#24212;&#23646;&#24615;&#20540;&#20026;22&#65307; &#21542;&#21017;&#65292;&#23545;&#24212;&#20540;&#20026;None</span>
</pre>
</div>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">True</span>
)
parser.add_argument(<span style="color: #8b2252;">'path'</span>, nargs=<span style="color: #8b2252;">'?'</span>, default=<span style="color: #8b2252;">'.'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Path help'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20301;&#32622;&#21442;&#25968;,&#21487;&#26377;&#21487;&#26080;&#65292;&#32570;&#30465;&#20540;&#65292;&#24110;&#21161;
</span>parser.add_argument(<span style="color: #8b2252;">'-l'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Long list format'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">l&#23646;&#24615;&#21517;
</span>parser.print_help() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(('o:/abc', '-l')) #&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512; python t.py o:/abc -l
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args('-l o:/tmp'.split()) # python t.py -l o:/tmp
</span><span style="color: #a0522d;">args</span> = parser.parse_args() <span style="color: #b22222;"># </span><span style="color: #b22222;">python t.py .
</span><span style="color: #a0522d;">args</span> = parser.parse_args([<span style="color: #8b2252;">'-l'</span>]) <span style="color: #b22222;"># </span><span style="color: #b22222;">python t.py -l
</span><span style="color: #483d8b;">print</span>(args) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;Namespace&#31867;&#22411;&#23454;&#20363;&#65292;&#23454;&#20363;&#26377;&#23646;&#24615;&#65292;&#23646;&#24615;&#26159;&#21442;&#25968;
</span><span style="color: #483d8b;">print</span>(args.path)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">usage: ls [-h] [-l] [path]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">List information about the FILEs (the current directory by default)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">positional arguments:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">path        Path help
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">options:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-h, --help  show this help message and exit
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-l          Long list format
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.', l=True)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">.</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">True</span>
)
parser.add_argument(<span style="color: #8b2252;">'path'</span>, nargs=<span style="color: #8b2252;">'?'</span>, default=<span style="color: #8b2252;">'.'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Path help'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20301;&#32622;&#21442;&#25968;,&#21487;&#26377;&#21487;&#26080;&#65292;&#32570;&#30465;&#20540;&#65292;&#24110;&#21161;
</span>parser.add_argument(<span style="color: #8b2252;">'-l'</span>, action=<span style="color: #8b2252;">'store_const'</span>, const=22, default=33, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Long list format'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">l&#23646;&#24615;&#21517; store_const &#23384;&#19968;&#20010;&#24120;&#37327;
</span>parser.print_help() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(('o:/abc', '-l')) #&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512; python t.py o:/abc -l
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args('-l o:/tmp'.split()) # python t.py -l o:/tmp
</span><span style="color: #a0522d;">args</span> = parser.parse_args() <span style="color: #b22222;"># </span><span style="color: #b22222;">python t.py .
</span><span style="color: #a0522d;">args</span> = parser.parse_args([]) <span style="color: #b22222;"># </span><span style="color: #b22222;">python t.py -l 33 .
</span><span style="color: #483d8b;">print</span>(args) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;Namespace&#31867;&#22411;&#23454;&#20363;&#65292;&#23454;&#20363;&#26377;&#23646;&#24615;&#65292;&#23646;&#24615;&#26159;&#21442;&#25968;
</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">usage: ls [-h] [-l] [path]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">List information about the FILEs (the current directory by default)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">positional arguments:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">path        Path help
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">options:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-h, --help  show this help message and exit
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-l          Long list format
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.', l=33)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:511ba43a-5396-41a8-9764-312b6144e42a" class="outline-5">
<h5 id="h:511ba43a-5396-41a8-9764-312b6144e42a">-a 的实现</h5>
<div class="outline-text-5" id="text-h:511ba43a-5396-41a8-9764-312b6144e42a">
<pre class="example" id="org78153b3">
parser.add_argument('-a', '--all', action='store_true')  #长短选项同时给
</pre>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">True</span>
)
parser.add_argument(<span style="color: #8b2252;">'path'</span>, nargs=<span style="color: #8b2252;">'?'</span>, default=<span style="color: #8b2252;">'.'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Path help'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20301;&#32622;&#21442;&#25968;,&#21487;&#26377;&#21487;&#26080;&#65292;&#32570;&#30465;&#20540;&#65292;&#24110;&#21161;
</span>parser.add_argument(<span style="color: #8b2252;">'-l'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Long list format'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">l&#23646;&#24615;&#21517;
</span>parser.add_argument(<span style="color: #8b2252;">'-a'</span>, <span style="color: #8b2252;">'--all'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Do not ignore entries starting with .'</span>)
parser.print_help() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(('o:/abc', '-l')) #&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512; python t.py o:/abc -l
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args('-l o:/tmp'.split()) # python t.py -l o:/tmp
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args() # python t.py .
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(['-la']) # Namespace(path='.', l=True, all=True)
</span><span style="color: #a0522d;">args</span> = parser.parse_args([<span style="color: #8b2252;">'-l'</span>, <span style="color: #8b2252;">'-a'</span>]) <span style="color: #b22222;">#</span><span style="color: #b22222;">Namespace(path='.', l=True, all=True)
</span><span style="color: #483d8b;">print</span>(args) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;Namespace&#31867;&#22411;&#23454;&#20363;&#65292;&#23454;&#20363;&#26377;&#23646;&#24615;&#65292;&#23646;&#24615;&#26159;&#21442;&#25968;
</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">usage: ls [-h] [-l] [-a] [path]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">List information about the FILEs (the current directory by default)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">positional arguments:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">path        Path help
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">options:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-h, --help  show this help message and exit
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-l          Long list format
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-a, --all   Do not ignore entries starting with .
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.', l=True, all=True)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:778a286c-f4b3-48ee-8470-fb28b84b0ea0" class="outline-4">
<h4 id="h:778a286c-f4b3-48ee-8470-fb28b84b0ea0">属性名称</h4>
<div class="outline-text-4" id="text-h:778a286c-f4b3-48ee-8470-fb28b84b0ea0">
<p>
参数都Namespace对象的属性，如果想指定这些属性名，可以使用dest
</p>

<div class="org-src-container">
<pre class="src src-python">parser.add_argument(<span style="color: #8b2252;">'-l'</span>, action=<span style="color: #8b2252;">'store_true'</span>, dest=<span style="color: #8b2252;">'longfmt'</span>) 
</pre>
</div>

<p>
范例
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">True</span>
)
parser.add_argument(<span style="color: #8b2252;">'path'</span>, nargs=<span style="color: #8b2252;">'?'</span>, default=<span style="color: #8b2252;">'.'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Path help'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20301;&#32622;&#21442;&#25968;,&#21487;&#26377;&#21487;&#26080;&#65292;&#32570;&#30465;&#20540;&#65292;&#24110;&#21161;
</span>parser.add_argument(<span style="color: #8b2252;">'-l'</span>, action=<span style="color: #8b2252;">'store_true'</span>, dest=<span style="color: #8b2252;">'longfmt'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Long list format'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">l&#23646;&#24615;&#21517;
</span>parser.add_argument(<span style="color: #8b2252;">'-a'</span>, <span style="color: #8b2252;">'--all'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Do not ignore entries starting with .'</span>)
parser.print_help() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(('o:/abc', '-l')) #&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512; python t.py o:/abc -l
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args('-l o:/tmp'.split()) # python t.py -l o:/tmp
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args() # python t.py .
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(['-la']) # Namespace(path='.', l=True, all=True)
</span><span style="color: #a0522d;">args</span> = parser.parse_args([<span style="color: #8b2252;">'-l'</span>, <span style="color: #8b2252;">'-a'</span>]) <span style="color: #b22222;">#</span><span style="color: #b22222;">Namespace(path='.', l=True, all=True)
</span><span style="color: #483d8b;">print</span>(args) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;Namespace&#31867;&#22411;&#23454;&#20363;&#65292;&#23454;&#20363;&#26377;&#23646;&#24615;&#65292;&#23646;&#24615;&#26159;&#21442;&#25968;
</span><span style="color: #483d8b;">print</span>(args.longfmt)


<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">usage: ls [-h] [-l] [-a] [path]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">List information about the FILEs (the current directory by default)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">positional arguments:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">path        Path help
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">options:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-h, --help  show this help message and exit
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-l          Long list format
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-a, --all   Do not ignore entries starting with .
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.', longfmt=True, all=True)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">True</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:4ad60119-7742-42a3-a9ff-5bdf0a474edb" class="outline-4">
<h4 id="h:4ad60119-7742-42a3-a9ff-5bdf0a474edb">练习，实现ls命令功能</h4>
<div class="outline-text-4" id="text-h:4ad60119-7742-42a3-a9ff-5bdf0a474edb">
<p>
实例-l -a 和 &#x2013;all -h选项
</p>
<ul class="org-ul">
<li>实现显示路径下的文件列表</li>
<li>-a和&#x2013;all 显示包含.开头的文件</li>
<li>-l 详细列表显示</li>
<li>-h和-l配合，人性化显示文件大小</li>
<li>显示文件类型
<ul class="org-ul">
<li>c 字符</li>
<li>d 目录</li>
<li>普通文件</li>
<li>l 链接文件</li>
<li>b 块设备</li>
<li>s socket 文件</li>
<li>p 管道文件，即FIFO</li>
</ul></li>
</ul>

<p>
列出目录
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse
<span style="color: #a020f0;">from</span> pathlib <span style="color: #a020f0;">import</span> Path

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">True</span>
)
parser.add_argument(<span style="color: #8b2252;">'path'</span>, nargs=<span style="color: #8b2252;">'?'</span>, default=<span style="color: #8b2252;">'.'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Path help'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20301;&#32622;&#21442;&#25968;,&#21487;&#26377;&#21487;&#26080;&#65292;&#32570;&#30465;&#20540;&#65292;&#24110;&#21161;
</span>parser.add_argument(<span style="color: #8b2252;">'-l'</span>, action=<span style="color: #8b2252;">'store_true'</span>, dest=<span style="color: #8b2252;">'longfmt'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Long list format'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">l&#23646;&#24615;&#21517;
</span>parser.add_argument(<span style="color: #8b2252;">'-a'</span>, <span style="color: #8b2252;">'--all'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Do not ignore entries starting with .'</span>)
parser.print_help() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(('o:/abc', '-l')) #&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512; python t.py o:/abc -l
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args('-l o:/tmp'.split()) # python t.py -l o:/tmp
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args() # python t.py .
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(['-la']) # Namespace(path='.', l=True, all=True)
</span><span style="color: #a0522d;">args</span> = parser.parse_args([<span style="color: #8b2252;">'-l'</span>, <span style="color: #8b2252;">'-a'</span>]) <span style="color: #b22222;">#</span><span style="color: #b22222;">Namespace(path='.', l=True, all=True)
</span><span style="color: #483d8b;">print</span>(args) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;Namespace&#31867;&#22411;&#23454;&#20363;&#65292;&#23454;&#20363;&#26377;&#23646;&#24615;&#65292;&#23646;&#24615;&#26159;&#21442;&#25968;
</span><span style="color: #483d8b;">print</span>(args.longfmt)


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">list_dir</span>(path:<span style="color: #483d8b;">str</span>):
    <span style="color: #a0522d;">p</span> = Path(path)
    <span style="color: #a020f0;">if</span> p.is_dir():
        <span style="color: #a020f0;">for</span> f <span style="color: #a020f0;">in</span> p.iterdir():
            <span style="color: #483d8b;">print</span>(f)
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">pass</span>

list_dir(args.path)
</pre>
</div>

<p>
解决-a参数
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse
<span style="color: #a020f0;">from</span> pathlib <span style="color: #a020f0;">import</span> Path

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">True</span>
)
parser.add_argument(<span style="color: #8b2252;">'path'</span>, nargs=<span style="color: #8b2252;">'?'</span>, default=<span style="color: #8b2252;">'.'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Path help'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20301;&#32622;&#21442;&#25968;,&#21487;&#26377;&#21487;&#26080;&#65292;&#32570;&#30465;&#20540;&#65292;&#24110;&#21161;
</span>parser.add_argument(<span style="color: #8b2252;">'-l'</span>, action=<span style="color: #8b2252;">'store_true'</span>, dest=<span style="color: #8b2252;">'longfmt'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Long list format'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">l&#23646;&#24615;&#21517;
</span>parser.add_argument(<span style="color: #8b2252;">'-a'</span>, <span style="color: #8b2252;">'--all'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Do not ignore entries starting with .'</span>)
parser.print_help() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(('o:/abc', '-l')) #&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512; python t.py o:/abc -l
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args('-l o:/tmp'.split()) # python t.py -l o:/tmp
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args() # python t.py .
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(['-la']) # Namespace(path='.', l=True, all=True)
</span><span style="color: #a0522d;">args</span> = parser.parse_args([<span style="color: #8b2252;">'-l'</span>, <span style="color: #8b2252;">'-a'</span>]) <span style="color: #b22222;">#</span><span style="color: #b22222;">Namespace(path='.', l=True, all=True)
</span><span style="color: #483d8b;">print</span>(args) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;Namespace&#31867;&#22411;&#23454;&#20363;&#65292;&#23454;&#20363;&#26377;&#23646;&#24615;&#65292;&#23646;&#24615;&#26159;&#21442;&#25968;
</span><span style="color: #483d8b;">print</span>(args.longfmt)


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">list_dir</span>(path:<span style="color: #483d8b;">str</span> , <span style="color: #483d8b;">all</span>=<span style="color: #008b8b;">False</span>): <span style="color: #b22222;"># </span><span style="color: #b22222;">-a
</span>    <span style="color: #a0522d;">p</span> = Path(path)
    <span style="color: #a020f0;">if</span> p.is_dir(): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#20801;&#35768;&#21015;&#20986;&#30446;&#24405; #&#24590;&#20040;&#30693;&#36947;&#23427;&#26159;&#38544;&#34255;&#25991;&#20214;&#65311;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">for f in p.iterdir():
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;"># print(f, type(f), f.name, type(f.name))
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">if not all and f.name.startswith('.'):
</span>        <span style="color: #b22222;">#         </span><span style="color: #b22222;">continue
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;"># print(f.name)
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">yield f.name
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">yeild from filter(lambda f: not (not all and f.name.startswith('.')), p.iterdir())
</span>        <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">from</span> <span style="color: #483d8b;">filter</span>(<span style="color: #a020f0;">lambda</span> f: <span style="color: #483d8b;">all</span> <span style="color: #a020f0;">or</span> <span style="color: #a020f0;">not</span> f.name.startswith(<span style="color: #8b2252;">'.'</span>), p.iterdir())
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">pass</span>

<span style="color: #483d8b;">print</span>(*list_dir(args.path, args.<span style="color: #483d8b;">all</span>), sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>)
</pre>
</div>

<p>
解决长格式
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse
<span style="color: #a020f0;">from</span> pathlib <span style="color: #a020f0;">import</span> Path

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">True</span>
)
parser.add_argument(<span style="color: #8b2252;">'path'</span>, nargs=<span style="color: #8b2252;">'?'</span>, default=<span style="color: #8b2252;">'.'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Path help'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20301;&#32622;&#21442;&#25968;,&#21487;&#26377;&#21487;&#26080;&#65292;&#32570;&#30465;&#20540;&#65292;&#24110;&#21161;
</span>parser.add_argument(<span style="color: #8b2252;">'-l'</span>, action=<span style="color: #8b2252;">'store_true'</span>, dest=<span style="color: #8b2252;">'longfmt'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Long list format'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">l&#23646;&#24615;&#21517;
</span>parser.add_argument(<span style="color: #8b2252;">'-a'</span>, <span style="color: #8b2252;">'--all'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Do not ignore entries starting with .'</span>)
parser.print_help() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(('o:/abc', '-l')) #&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512; python t.py o:/abc -l
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args('-l o:/tmp'.split()) # python t.py -l o:/tmp
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args() # python t.py .
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(['-la']) # Namespace(path='.', l=True, all=True)
</span><span style="color: #a0522d;">args</span> = parser.parse_args([<span style="color: #8b2252;">'-l'</span>, <span style="color: #8b2252;">'-a'</span>]) <span style="color: #b22222;">#</span><span style="color: #b22222;">Namespace(path='.', l=True, all=True)
</span><span style="color: #483d8b;">print</span>(args) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;Namespace&#31867;&#22411;&#23454;&#20363;&#65292;&#23454;&#20363;&#26377;&#23646;&#24615;&#65292;&#23646;&#24615;&#26159;&#21442;&#25968;
</span><span style="color: #483d8b;">print</span>(args.longfmt)


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">list_dir</span>(path:<span style="color: #483d8b;">str</span> , <span style="color: #483d8b;">all</span>=<span style="color: #008b8b;">False</span>): <span style="color: #b22222;"># </span><span style="color: #b22222;">-a
</span>    <span style="color: #a0522d;">p</span> = Path(path)
    <span style="color: #a020f0;">if</span> p.is_dir(): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#20801;&#35768;&#21015;&#20986;&#30446;&#24405; #&#24590;&#20040;&#30693;&#36947;&#23427;&#26159;&#38544;&#34255;&#25991;&#20214;&#65311;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">for f in p.iterdir():
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;"># print(f, type(f), f.name, type(f.name))
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">if not all and f.name.startswith('.'):
</span>        <span style="color: #b22222;">#         </span><span style="color: #b22222;">continue
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;"># print(f.name)
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">yield f.name
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">yeild from filter(lambda f: not (not all and f.name.startswith('.')), p.iterdir())
</span>        <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">from</span> <span style="color: #483d8b;">filter</span>(<span style="color: #a020f0;">lambda</span> f: <span style="color: #483d8b;">all</span> <span style="color: #a020f0;">or</span> <span style="color: #a020f0;">not</span> f.name.startswith(<span style="color: #8b2252;">'.'</span>), p.iterdir())
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">pass</span>

<span style="color: #483d8b;">print</span>(*list_dir(args.path, args.<span style="color: #483d8b;">all</span>), sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>)
<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> list_dir(args.path):
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(x), x.name, <span style="color: #483d8b;">str</span>(x)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class 'pathlib._local.WindowsPath'&gt; t.py t.py
</span>    <span style="color: #a020f0;">break</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_get_type</span>(f:Path):
    <span style="color: #a020f0;">if</span> f.is_dir():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'d'</span>
    <span style="color: #a020f0;">elif</span> f.is_symlink():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'l'</span>
    <span style="color: #a020f0;">elif</span> f.is_socket():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'s'</span>
    <span style="color: #a020f0;">elif</span> f.is_fifo():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'p'</span>
    <span style="color: #a020f0;">elif</span> f.is_block_device():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'b'</span>
    <span style="color: #a020f0;">elif</span> f.is_char_device():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'c'</span>
    <span style="color: #a020f0;">elif</span> f.is_fifo():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'p'</span>
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'-'</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">modelist = ['---', '--x', '-w-', '-wx', 'r--', 'r-x', 'rw-', 'rwx']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">modelist = dict(zip('01234567', modelist)) 
</span><span style="color: #a0522d;">modelist</span> ={<span style="color: #8b2252;">'0'</span>: <span style="color: #8b2252;">'---'</span>, <span style="color: #8b2252;">'1'</span>: <span style="color: #8b2252;">'--x'</span>, <span style="color: #8b2252;">'2'</span>: <span style="color: #8b2252;">'-w-'</span>, <span style="color: #8b2252;">'3'</span>: <span style="color: #8b2252;">'-wx'</span>, <span style="color: #8b2252;">'4'</span>: <span style="color: #8b2252;">'r--'</span>, <span style="color: #8b2252;">'5'</span>: <span style="color: #8b2252;">'r-x'</span>, <span style="color: #8b2252;">'6'</span>: <span style="color: #8b2252;">'rw-'</span>, <span style="color: #8b2252;">'7'</span>: <span style="color: #8b2252;">'rwx'</span>}

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_get_mode_str</span>(mode:<span style="color: #483d8b;">int</span>):
    <span style="color: #483d8b;">print</span>(mode, <span style="color: #483d8b;">type</span>(mode), <span style="color: #483d8b;">oct</span>(mode)[-3:])
    <span style="color: #a0522d;">mstr</span> = <span style="color: #8b2252;">''</span>
    <span style="color: #a020f0;">for</span> c <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">oct</span>(mode)[-3:]:
        <span style="color: #a0522d;">mstr</span> += modelist[c]
    <span style="color: #a020f0;">return</span> mstr

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">list_detail</span>(path:<span style="color: #483d8b;">str</span>, <span style="color: #483d8b;">all</span>=<span style="color: #008b8b;">False</span>, detail=<span style="color: #008b8b;">False</span>):
    <span style="color: #a0522d;">p</span> = Path(path)
    <span style="color: #a020f0;">if</span> p.is_dir(): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#20801;&#35768;&#21015;&#20986;&#30446;&#24405; #&#24590;&#20040;&#30693;&#36947;&#23427;&#26159;&#38544;&#34255;&#25991;&#20214;&#65311;
</span>        <span style="color: #a020f0;">for</span> f <span style="color: #a020f0;">in</span> p.absolute().iterdir():
            <span style="color: #b22222;"># </span><span style="color: #b22222;">print(f, type(f), f.name, type(f.name))
</span>            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> <span style="color: #483d8b;">all</span> <span style="color: #a020f0;">and</span> f.name.startswith(<span style="color: #8b2252;">'.'</span>):
                <span style="color: #a020f0;">continue</span>
            <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38271;&#26684;&#24335; -rw-r--r-- 1 Administrator 197121 62 Feb 26 17:35 __main__.log
</span>            <span style="color: #b22222;">#       </span><span style="color: #b22222;">type  mode  &#30828;&#38142;&#25509;  owner  group  size  mtime  name
</span>            <span style="color: #a0522d;">st</span> = f.stat()
            <span style="color: #483d8b;">print</span>(st)
            <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25991;&#20214;&#31867;&#22411;&#65311; #mode &#31639;&#27861;
</span>            <span style="color: #a0522d;">typ</span> = _get_type(f)
            <span style="color: #a0522d;">mode</span> = _get_mode_str(st.st_mode) <span style="color: #b22222;">#</span><span style="color: #b22222;">33206 -&gt; oct()
</span>            <span style="color: #a020f0;">yield</span> typ, mode

        <span style="color: #b22222;"># </span><span style="color: #b22222;">yield from map(lambda x: x.name, filter(lambda f: all or not f.name.startswith('.'), p.absolute().iterdir()))
</span>    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> list_detail(args.path, args.<span style="color: #483d8b;">all</span>, args.longfmt):
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(x), x)
    <span style="color: #a020f0;">break</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">usage: ls [-h] [-l] [-a] [path]
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">List information about the FILEs (the current directory by default)
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">positional arguments:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">path        Path help
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">options:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-h, --help  show this help message and exit
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-l          Long list format
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-a, --all   Do not ignore entries starting with .
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.', longfmt=True, all=True)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">True
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">t.py
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;class 'pathlib._local.WindowsPath'&gt; t.py t.py
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">os.stat_result(st_mode=33206, st_ino=281474976809275, st_dev=515109334059982733, st_nlink=1, st_uid=0, st_gid=0, st_size=3536, st_atime=1740649238, st_mtime=1740649236, st_ctime=1740549471)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">33206 &lt;class 'int'&gt; 666
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;class 'tuple'&gt; ('-', 'rw-rw-rw-')</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse
<span style="color: #a020f0;">from</span> pathlib <span style="color: #a020f0;">import</span> Path

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">True</span>
)
parser.add_argument(<span style="color: #8b2252;">'path'</span>, nargs=<span style="color: #8b2252;">'?'</span>, default=<span style="color: #8b2252;">'.'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Path help'</span>)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#21442;&#25968;,&#21487;&#26377;&#21487;&#26080;&#65292;&#32570;&#30465;&#20540;&#65292;&#24110;&#21161;
</span>parser.add_argument(<span style="color: #8b2252;">'-l'</span>, action=<span style="color: #8b2252;">'store_true'</span>, dest=<span style="color: #8b2252;">'longfmt'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Long list format'</span>)  <span style="color: #b22222;"># </span><span style="color: #b22222;">l&#23646;&#24615;&#21517;
</span>parser.add_argument(<span style="color: #8b2252;">'-a'</span>, <span style="color: #8b2252;">'--all'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Do not ignore entries starting with .'</span>)
parser.print_help()  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(('o:/abc', '-l')) #&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512; python t.py o:/abc -l
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args('-l o:/tmp'.split()) # python t.py -l o:/tmp
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args() # python t.py .
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(['-la']) # Namespace(path='.', l=True, all=True)
</span><span style="color: #a0522d;">args</span> = parser.parse_args([<span style="color: #8b2252;">'-l'</span>, <span style="color: #8b2252;">'-a'</span>])  <span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.', l=True, all=True)
</span><span style="color: #483d8b;">print</span>(args)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;Namespace&#31867;&#22411;&#23454;&#20363;&#65292;&#23454;&#20363;&#26377;&#23646;&#24615;&#65292;&#23646;&#24615;&#26159;&#21442;&#25968;
</span><span style="color: #483d8b;">print</span>(args.longfmt)


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">list_dir</span>(path: <span style="color: #483d8b;">str</span>, <span style="color: #483d8b;">all</span>=<span style="color: #008b8b;">False</span>):  <span style="color: #b22222;"># </span><span style="color: #b22222;">-a
</span>    <span style="color: #a0522d;">p</span> = Path(path)
    <span style="color: #a020f0;">if</span> p.is_dir():  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#20801;&#35768;&#21015;&#20986;&#30446;&#24405; #&#24590;&#20040;&#30693;&#36947;&#23427;&#26159;&#38544;&#34255;&#25991;&#20214;&#65311;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">for f in p.iterdir():
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;"># print(f, type(f), f.name, type(f.name))
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">if not all and f.name.startswith('.'):
</span>        <span style="color: #b22222;">#         </span><span style="color: #b22222;">continue
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;"># print(f.name)
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">yield f.name
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">yeild from filter(lambda f: not (not all and f.name.startswith('.')), p.iterdir())
</span>        <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">from</span> <span style="color: #483d8b;">filter</span>(<span style="color: #a020f0;">lambda</span> f: <span style="color: #483d8b;">all</span> <span style="color: #a020f0;">or</span> <span style="color: #a020f0;">not</span> f.name.startswith(<span style="color: #8b2252;">'.'</span>), p.iterdir())
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">pass</span>


<span style="color: #483d8b;">print</span>(*list_dir(args.path, args.<span style="color: #483d8b;">all</span>), sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>)
<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> list_dir(args.path):
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(x), x.name, <span style="color: #483d8b;">str</span>(x))  <span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;class 'pathlib._local.WindowsPath'&gt; t.py t.py
</span>    <span style="color: #a020f0;">break</span>


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_get_type</span>(f: Path):
    <span style="color: #a020f0;">if</span> f.is_dir():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'d'</span>
    <span style="color: #a020f0;">elif</span> f.is_symlink():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'l'</span>
    <span style="color: #a020f0;">elif</span> f.is_socket():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'s'</span>
    <span style="color: #a020f0;">elif</span> f.is_fifo():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'p'</span>
    <span style="color: #a020f0;">elif</span> f.is_block_device():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'b'</span>
    <span style="color: #a020f0;">elif</span> f.is_char_device():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'c'</span>
    <span style="color: #a020f0;">elif</span> f.is_fifo():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'p'</span>
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'-'</span>


<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21462;&#26435;&#38480;&#26041;&#27861;1
</span><span style="color: #b22222;"># </span><span style="color: #b22222;"># modelist = ['---', '--x', '-w-', '-wx', 'r--', 'r-x', 'rw-', 'rwx']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;"># modelist = dict(zip('01234567', modelist)) 
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">modelist ={'0': '---', '1': '--x', '2': '-w-', '3': '-wx', '4': 'r--', '5': 'r-x', '6': 'rw-', '7': 'rwx'}
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">def _get_mode_str(mode:int):
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">print(mode, type(mode), oct(mode)[-3:]) #33206 &lt;class 'int'&gt; 666
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">mstr = ''
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">for c in oct(mode)[-3:]:
</span><span style="color: #b22222;">#         </span><span style="color: #b22222;">mstr += modelist[c]
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">return mstr
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21462;&#26435;&#38480;&#26041;&#27861;2
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">modelist = 'rwxrwxrwx' #rwx 1&#20026;&#23545;&#24212;&#20301;&#32622;&#20540;&#65292;0&#20026;&#31354;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">def _get_mode_str(mode:int):
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">print(mode, type(mode), bin(mode)[-9:], '{:09b}'.format(mode)) #110 110 110 &#26159;0b1000000110110110&#30340;&#21518;9&#20301;
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">mstr = ''
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">for i,c in enumerate('{:09b}'.format(mode)[-9:]): #110110110
</span><span style="color: #b22222;">#         </span><span style="color: #b22222;">mstr += modelist[i] if c == '1' else '-'
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">return mstr
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21462;&#26435;&#38480;&#26041;&#27861;3-&#31227;&#20301;
</span><span style="color: #a0522d;">modelist</span> = <span style="color: #8b2252;">'rwxrwxrwx'</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_get_mode_str</span>(mode:<span style="color: #483d8b;">int</span>):
    <span style="color: #b22222;"># </span><span style="color: #b22222;">print(mode, type(mode), bin(mode)[-9:], '{:09b}'.format(mode), mode &amp; 0o777) #&#20301;&#19982;&#65292;&#21482;&#35201;&#21518;9&#20301;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31227;&#20301;&#35745;&#31639;
</span>    <span style="color: #a0522d;">mstr</span> = <span style="color: #8b2252;">''</span>
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(8, -1, -1):
        <span style="color: #a0522d;">mstr</span> += modelist[8-i] <span style="color: #a020f0;">if</span> mode &gt;&gt; i &amp; 1 <span style="color: #a020f0;">else</span> <span style="color: #8b2252;">'-'</span>
    <span style="color: #a020f0;">return</span> mstr

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">list_detail</span>(path: <span style="color: #483d8b;">str</span>, <span style="color: #483d8b;">all</span>=<span style="color: #008b8b;">False</span>, detail=<span style="color: #008b8b;">False</span>):
    <span style="color: #a0522d;">p</span> = Path(path)
    <span style="color: #a020f0;">if</span> p.is_dir():  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#20801;&#35768;&#21015;&#20986;&#30446;&#24405; #&#24590;&#20040;&#30693;&#36947;&#23427;&#26159;&#38544;&#34255;&#25991;&#20214;&#65311;
</span>        <span style="color: #a020f0;">for</span> f <span style="color: #a020f0;">in</span> p.absolute().iterdir():
            <span style="color: #b22222;"># </span><span style="color: #b22222;">print(f, type(f), f.name, type(f.name))
</span>            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> <span style="color: #483d8b;">all</span> <span style="color: #a020f0;">and</span> f.name.startswith(<span style="color: #8b2252;">'.'</span>):
                <span style="color: #a020f0;">continue</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38271;&#26684;&#24335; -rw-r--r-- 1 Administrator 197121 62 Feb 26 17:35 __main__.log
</span>            <span style="color: #b22222;">#       </span><span style="color: #b22222;">type  mode  &#30828;&#38142;&#25509;  owner  group  size  mtime  name
</span>            <span style="color: #a0522d;">st</span> = f.stat()
            <span style="color: #483d8b;">print</span>(st)
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25991;&#20214;&#31867;&#22411;&#65311; #mode &#31639;&#27861;
</span>            <span style="color: #a0522d;">typ</span> = _get_type(f)
            <span style="color: #a0522d;">mode</span> = _get_mode_str(st.st_mode)  <span style="color: #b22222;"># </span><span style="color: #b22222;">33206 -&gt; oct()
</span>            <span style="color: #a020f0;">yield</span> typ+mode

        <span style="color: #b22222;"># </span><span style="color: #b22222;">yield from map(lambda x: x.name, filter(lambda f: all or not f.name.startswith('.'), p.absolute().iterdir()))
</span>    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">pass</span>


<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> list_detail(args.path, args.<span style="color: #483d8b;">all</span>, args.longfmt):
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(x), x)
    <span style="color: #a020f0;">break</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;class 'str'&gt; drwxrwxrwx</span>
</pre>
</div>

<p>
直接使用stat模块中的filemode方法
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse
<span style="color: #a020f0;">from</span> pathlib <span style="color: #a020f0;">import</span> Path
<span style="color: #a020f0;">from</span> stat <span style="color: #a020f0;">import</span> filemode

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">True</span>
)
parser.add_argument(<span style="color: #8b2252;">'path'</span>, nargs=<span style="color: #8b2252;">'?'</span>, default=<span style="color: #8b2252;">'.'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Path help'</span>)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#21442;&#25968;,&#21487;&#26377;&#21487;&#26080;&#65292;&#32570;&#30465;&#20540;&#65292;&#24110;&#21161;
</span>parser.add_argument(<span style="color: #8b2252;">'-l'</span>, action=<span style="color: #8b2252;">'store_true'</span>, dest=<span style="color: #8b2252;">'longfmt'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Long list format'</span>)  <span style="color: #b22222;"># </span><span style="color: #b22222;">l&#23646;&#24615;&#21517;
</span>parser.add_argument(<span style="color: #8b2252;">'-a'</span>, <span style="color: #8b2252;">'--all'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Do not ignore entries starting with .'</span>)
parser.print_help()  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(('o:/abc', '-l')) #&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512; python t.py o:/abc -l
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args('-l o:/tmp'.split()) # python t.py -l o:/tmp
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args() # python t.py .
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(['-la']) # Namespace(path='.', l=True, all=True)
</span><span style="color: #a0522d;">args</span> = parser.parse_args([<span style="color: #8b2252;">'-l'</span>, <span style="color: #8b2252;">'-a'</span>])  <span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.', l=True, all=True)
</span><span style="color: #483d8b;">print</span>(args)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;Namespace&#31867;&#22411;&#23454;&#20363;&#65292;&#23454;&#20363;&#26377;&#23646;&#24615;&#65292;&#23646;&#24615;&#26159;&#21442;&#25968;
</span><span style="color: #483d8b;">print</span>(args.longfmt)


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">list_dir</span>(path: <span style="color: #483d8b;">str</span>, <span style="color: #483d8b;">all</span>=<span style="color: #008b8b;">False</span>):  <span style="color: #b22222;"># </span><span style="color: #b22222;">-a
</span>    <span style="color: #a0522d;">p</span> = Path(path)
    <span style="color: #a020f0;">if</span> p.is_dir():  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#20801;&#35768;&#21015;&#20986;&#30446;&#24405; #&#24590;&#20040;&#30693;&#36947;&#23427;&#26159;&#38544;&#34255;&#25991;&#20214;&#65311;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">for f in p.iterdir():
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;"># print(f, type(f), f.name, type(f.name))
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">if not all and f.name.startswith('.'):
</span>        <span style="color: #b22222;">#         </span><span style="color: #b22222;">continue
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;"># print(f.name)
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">yield f.name
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">yeild from filter(lambda f: not (not all and f.name.startswith('.')), p.iterdir())
</span>        <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">from</span> <span style="color: #483d8b;">filter</span>(<span style="color: #a020f0;">lambda</span> f: <span style="color: #483d8b;">all</span> <span style="color: #a020f0;">or</span> <span style="color: #a020f0;">not</span> f.name.startswith(<span style="color: #8b2252;">'.'</span>), p.iterdir())
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">pass</span>


<span style="color: #483d8b;">print</span>(*list_dir(args.path, args.<span style="color: #483d8b;">all</span>), sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>)
<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> list_dir(args.path):
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(x), x.name, <span style="color: #483d8b;">str</span>(x))  <span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;class 'pathlib._local.WindowsPath'&gt; t.py t.py
</span>    <span style="color: #a020f0;">break</span>


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_get_type</span>(f: Path):
    <span style="color: #a020f0;">if</span> f.is_dir():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'d'</span>
    <span style="color: #a020f0;">elif</span> f.is_symlink():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'l'</span>
    <span style="color: #a020f0;">elif</span> f.is_socket():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'s'</span>
    <span style="color: #a020f0;">elif</span> f.is_fifo():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'p'</span>
    <span style="color: #a020f0;">elif</span> f.is_block_device():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'b'</span>
    <span style="color: #a020f0;">elif</span> f.is_char_device():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'c'</span>
    <span style="color: #a020f0;">elif</span> f.is_fifo():
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'p'</span>
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'-'</span>


<span style="color: #b22222;"># </span><span style="color: #b22222;"># modelist = ['---', '--x', '-w-', '-wx', 'r--', 'r-x', 'rw-', 'rwx']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;"># modelist = dict(zip('01234567', modelist))
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">modelist = {'0': '---', '1': '--x', '2': '-w-', '3': '-wx', '4': 'r--', '5': 'r-x', '6': 'rw-', '7': 'rwx'}
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">def _get_mode_str(mode: int):
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">print(mode, type(mode), oct(mode)[-3:])
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">mstr = ''
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">for c in oct(mode)[-3:]:
</span><span style="color: #b22222;">#         </span><span style="color: #b22222;">mstr += modelist[c]
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">return mstr
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26041;&#27861;3-&#31227;&#20301;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">modelist = 'rwxrwxrwx'
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">def _get_mode_str(mode:int):
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;"># print(mode, type(mode), bin(mode)[-9:], '{:09b}'.format(mode), mode &amp; 0o777) #&#20301;&#19982;&#65292;&#21482;&#35201;&#21518;9&#20301;
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">#&#31227;&#20301;&#35745;&#31639;
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">mstr = ''
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">for i in range(8, -1, -1):
</span><span style="color: #b22222;">#         </span><span style="color: #b22222;">mstr += modelist[8-i] if mode &gt;&gt; i &amp; 1 else '-'
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">return mstr
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">list_detail</span>(path: <span style="color: #483d8b;">str</span>, <span style="color: #483d8b;">all</span>=<span style="color: #008b8b;">False</span>, detail=<span style="color: #008b8b;">False</span>):
    <span style="color: #a0522d;">p</span> = Path(path)
    <span style="color: #a020f0;">if</span> p.is_dir():  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#20801;&#35768;&#21015;&#20986;&#30446;&#24405; #&#24590;&#20040;&#30693;&#36947;&#23427;&#26159;&#38544;&#34255;&#25991;&#20214;&#65311;
</span>        <span style="color: #a020f0;">for</span> f <span style="color: #a020f0;">in</span> p.absolute().iterdir():
            <span style="color: #b22222;"># </span><span style="color: #b22222;">print(f, type(f), f.name, type(f.name))
</span>            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> <span style="color: #483d8b;">all</span> <span style="color: #a020f0;">and</span> f.name.startswith(<span style="color: #8b2252;">'.'</span>):
                <span style="color: #a020f0;">continue</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38271;&#26684;&#24335; -rw-r--r-- 1 Administrator 197121 62 Feb 26 17:35 __main__.log
</span>            <span style="color: #b22222;">#       </span><span style="color: #b22222;">type  mode  &#30828;&#38142;&#25509;  owner  group  size  mtime  name
</span>            <span style="color: #a0522d;">st</span> = f.stat()
            <span style="color: #483d8b;">print</span>(st)
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25991;&#20214;&#31867;&#22411;&#65311; #mode &#31639;&#27861;
</span>            <span style="color: #b22222;"># </span><span style="color: #b22222;">typ = _get_type(f)
</span>            <span style="color: #b22222;"># </span><span style="color: #b22222;">mode = _get_mode_str(st.st_mode)  # 33206 -&gt; oct()
</span>            <span style="color: #a020f0;">yield</span> filemode(st.st_mode)

        <span style="color: #b22222;"># </span><span style="color: #b22222;">yield from map(lambda x: x.name, filter(lambda f: all or not f.name.startswith('.'), p.absolute().iterdir()))
</span>    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">pass</span>


<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> list_detail(args.path, args.<span style="color: #483d8b;">all</span>, args.longfmt):
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(x), x)
    <span style="color: #a020f0;">break</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse
<span style="color: #a020f0;">from</span> pathlib <span style="color: #a020f0;">import</span> Path
<span style="color: #a020f0;">from</span> stat <span style="color: #a020f0;">import</span> filemode
<span style="color: #a020f0;">import</span> datetime

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">True</span>
)
parser.add_argument(<span style="color: #8b2252;">'path'</span>, nargs=<span style="color: #8b2252;">'?'</span>, default=<span style="color: #8b2252;">'.'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Path help'</span>)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#21442;&#25968;,&#21487;&#26377;&#21487;&#26080;&#65292;&#32570;&#30465;&#20540;&#65292;&#24110;&#21161;
</span>parser.add_argument(<span style="color: #8b2252;">'-l'</span>, action=<span style="color: #8b2252;">'store_true'</span>, dest=<span style="color: #8b2252;">'longfmt'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Long list format'</span>)  <span style="color: #b22222;"># </span><span style="color: #b22222;">l&#23646;&#24615;&#21517;
</span>parser.add_argument(<span style="color: #8b2252;">'-a'</span>, <span style="color: #8b2252;">'--all'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Do not ignore entries starting with .'</span>)
parser.print_help()  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(('o:/abc', '-l')) #&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512; python t.py o:/abc -l
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args('-l o:/tmp'.split()) # python t.py -l o:/tmp
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args() # python t.py .
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(['-l', '-a'])  # Namespace(path='.', l=True, all=True)
</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">list_detail</span>(path: <span style="color: #483d8b;">str</span>, <span style="color: #483d8b;">all</span>=<span style="color: #008b8b;">False</span>, detail=<span style="color: #008b8b;">False</span>):
    <span style="color: #a0522d;">p</span> = Path(path)
    <span style="color: #a020f0;">if</span> p.is_dir():  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#20801;&#35768;&#21015;&#20986;&#30446;&#24405; #&#24590;&#20040;&#30693;&#36947;&#23427;&#26159;&#38544;&#34255;&#25991;&#20214;&#65311;
</span>        <span style="color: #a020f0;">for</span> f <span style="color: #a020f0;">in</span> p.absolute().iterdir():
            <span style="color: #b22222;"># </span><span style="color: #b22222;">print(f, type(f), f.name, type(f.name))
</span>            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> <span style="color: #483d8b;">all</span> <span style="color: #a020f0;">and</span> f.name.startswith(<span style="color: #8b2252;">'.'</span>):
                <span style="color: #a020f0;">continue</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38271;&#26684;&#24335; -rw-r--r-- 1 Administrator 197121 62 Feb 26 17:35 __main__.log
</span>            <span style="color: #b22222;">#       </span><span style="color: #b22222;">type  mode  &#30828;&#38142;&#25509;  owner  group  size  mtime  name
</span>            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> detail:
                <span style="color: #a020f0;">yield</span> (f.name,)
            <span style="color: #a020f0;">else</span>:
                <span style="color: #a0522d;">st</span> = f.stat()
                <span style="color: #b22222;"># </span><span style="color: #b22222;">print(st)
</span>                <span style="color: #a0522d;">size</span> = st.st_size
                <span style="color: #a0522d;">mtime</span> = <span style="color: #8b2252;">"{:%Y-%m-%d %H:%M:%S}"</span>.<span style="color: #483d8b;">format</span>(datetime.datetime.fromtimestamp(st.st_mtime))
                <span style="color: #a020f0;">yield</span> filemode(st.st_mode), st.st_nlink, st.st_uid, st.st_gid, size, mtime, f.name
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    <span style="color: #a0522d;">args</span> = parser.parse_args([<span style="color: #8b2252;">'-la'</span>])  <span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.', longfmt=True, all=True)
</span>    <span style="color: #483d8b;">print</span>(args)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;Namespace&#31867;&#22411;&#23454;&#20363;&#65292;&#23454;&#20363;&#26377;&#23646;&#24615;&#65292;&#23646;&#24615;&#26159;&#21442;&#25968;
</span>
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> list_detail(args.path, args.<span style="color: #483d8b;">all</span>, args.longfmt):
        <span style="color: #483d8b;">print</span>(x)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">break
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">usage: ls [-h] [-l] [-a] [path]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">List information about the FILEs (the current directory by default)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">positional arguments:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">path        Path help
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">options:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-h, --help  show this help message and exit
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-l          Long list format
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-a, --all   Do not ignore entries starting with .
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.', longfmt=True, all=True)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('drwxrwxrwx', 1, 0, 0, 0, '2025-02-27 00:16:42', 'm')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, 191, '2025-01-06 23:37:23', 'mysql.ini')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, 17772, '2025-01-08 20:39:39', 'sample.txt')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, 250, '2025-01-07 00:44:02', 't.ini')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, 1082, '2025-01-14 21:51:12', 't2.py')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, 2133, '2025-02-27 21:25:42', 'test.py')</span>
</pre>
</div>

<p>
-r 排序
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse
<span style="color: #a020f0;">from</span> pathlib <span style="color: #a020f0;">import</span> Path
<span style="color: #a020f0;">from</span> stat <span style="color: #a020f0;">import</span> filemode
<span style="color: #a020f0;">import</span> datetime

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">True</span>
)
parser.add_argument(<span style="color: #8b2252;">'path'</span>, nargs=<span style="color: #8b2252;">'?'</span>, default=<span style="color: #8b2252;">'.'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Path help'</span>)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#21442;&#25968;,&#21487;&#26377;&#21487;&#26080;&#65292;&#32570;&#30465;&#20540;&#65292;&#24110;&#21161;
</span>parser.add_argument(<span style="color: #8b2252;">'-l'</span>, action=<span style="color: #8b2252;">'store_true'</span>, dest=<span style="color: #8b2252;">'longfmt'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Long list format'</span>)  <span style="color: #b22222;"># </span><span style="color: #b22222;">l&#23646;&#24615;&#21517;
</span>parser.add_argument(<span style="color: #8b2252;">'-a'</span>, <span style="color: #8b2252;">'--all'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Do not ignore entries starting with .'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">-r reverse &#25353;&#25991;&#20214;&#21517;&#31216;&#25490;&#24207;
</span>parser.add_argument(<span style="color: #8b2252;">'-r'</span>, <span style="color: #8b2252;">'--reverse'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'reverse order while sorting'</span>)
parser.print_help()  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(('o:/abc', '-l')) #&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512; python t.py o:/abc -l
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args('-l o:/tmp'.split()) # python t.py -l o:/tmp
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args() # python t.py .
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(['-l', '-a'])  # Namespace(path='.', l=True, all=True)
</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">list_detail</span>(path: <span style="color: #483d8b;">str</span>, <span style="color: #483d8b;">all</span>=<span style="color: #008b8b;">False</span>, detail=<span style="color: #008b8b;">False</span>, reverse=<span style="color: #008b8b;">False</span>):
    <span style="color: #a0522d;">p</span> = Path(path)
    <span style="color: #a020f0;">if</span> p.is_dir():  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#20801;&#35768;&#21015;&#20986;&#30446;&#24405; #&#24590;&#20040;&#30693;&#36947;&#23427;&#26159;&#38544;&#34255;&#25991;&#20214;&#65311;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">for f in p.absolute().iterdir():
</span>        <span style="color: #a020f0;">for</span> f <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">sorted</span>(p.iterdir(), key=<span style="color: #a020f0;">lambda</span> f: f.name, reverse=reverse):
            <span style="color: #b22222;"># </span><span style="color: #b22222;">print(f, type(f), f.name, type(f.name))
</span>            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> <span style="color: #483d8b;">all</span> <span style="color: #a020f0;">and</span> f.name.startswith(<span style="color: #8b2252;">'.'</span>):
                <span style="color: #a020f0;">continue</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38271;&#26684;&#24335; -rw-r--r-- 1 Administrator 197121 62 Feb 26 17:35 __main__.log
</span>            <span style="color: #b22222;">#       </span><span style="color: #b22222;">type  mode  &#30828;&#38142;&#25509;  owner  group  size  mtime  name
</span>            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> detail:
                <span style="color: #a020f0;">yield</span> (f.name,)
            <span style="color: #a020f0;">else</span>:
                <span style="color: #a0522d;">st</span> = f.stat()
                <span style="color: #b22222;"># </span><span style="color: #b22222;">print(st)
</span>                <span style="color: #a0522d;">size</span> = st.st_size
                <span style="color: #a0522d;">mtime</span> = <span style="color: #8b2252;">"{:%Y-%m-%d %H:%M:%S}"</span>.<span style="color: #483d8b;">format</span>(datetime.datetime.fromtimestamp(st.st_mtime))
                <span style="color: #a020f0;">yield</span> filemode(st.st_mode), st.st_nlink, st.st_uid, st.st_gid, size, mtime, f.name
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    <span style="color: #a0522d;">args</span> = parser.parse_args([<span style="color: #8b2252;">'-lar'</span>])  <span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.', longfmt=True, all=True)
</span>    <span style="color: #483d8b;">print</span>(args)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;Namespace&#31867;&#22411;&#23454;&#20363;&#65292;&#23454;&#20363;&#26377;&#23646;&#24615;&#65292;&#23646;&#24615;&#26159;&#21442;&#25968;
</span>
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> list_detail(args.path, args.<span style="color: #483d8b;">all</span>, args.longfmt, args.reverse):
        <span style="color: #483d8b;">print</span>(x)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">break
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">usage: ls [-h] [-l] [-a] [-r] [path]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">List information about the FILEs (the current directory by default)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">positional arguments:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">path           Path help
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">options:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-h, --help     show this help message and exit
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-l             Long list format
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-a, --all      Do not ignore entries starting with .
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-r, --reverse  reverse order while sorting
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.', longfmt=True, all=True, reverse=True)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, 3149, '2025-02-28 00:28:52', 'test.py')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, 1082, '2025-01-14 21:51:12', 't2.py')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, 250, '2025-01-07 00:44:02', 't.ini')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, 17772, '2025-01-08 20:39:39', 'sample.txt')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, 191, '2025-01-06 23:37:23', 'mysql.ini')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('drwxrwxrwx', 1, 0, 0, 0, '2025-02-27 00:16:42', 'm')</span>
</pre>
</div>

<p>
排序方法2
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse
<span style="color: #a020f0;">from</span> pathlib <span style="color: #a020f0;">import</span> Path
<span style="color: #a020f0;">from</span> stat <span style="color: #a020f0;">import</span> filemode
<span style="color: #a020f0;">import</span> datetime

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">True</span>
)
parser.add_argument(<span style="color: #8b2252;">'path'</span>, nargs=<span style="color: #8b2252;">'?'</span>, default=<span style="color: #8b2252;">'.'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Path help'</span>)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#21442;&#25968;,&#21487;&#26377;&#21487;&#26080;&#65292;&#32570;&#30465;&#20540;&#65292;&#24110;&#21161;
</span>parser.add_argument(<span style="color: #8b2252;">'-l'</span>, action=<span style="color: #8b2252;">'store_true'</span>, dest=<span style="color: #8b2252;">'longfmt'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Long list format'</span>)  <span style="color: #b22222;"># </span><span style="color: #b22222;">l&#23646;&#24615;&#21517;
</span>parser.add_argument(<span style="color: #8b2252;">'-a'</span>, <span style="color: #8b2252;">'--all'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Do not ignore entries starting with .'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">-r reverse &#25353;&#25991;&#20214;&#21517;&#31216;&#25490;&#24207;
</span>parser.add_argument(<span style="color: #8b2252;">'-r'</span>, <span style="color: #8b2252;">'--reverse'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'reverse order while sorting'</span>)
parser.print_help()  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(('o:/abc', '-l')) #&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512; python t.py o:/abc -l
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args('-l o:/tmp'.split()) # python t.py -l o:/tmp
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args() # python t.py .
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(['-l', '-a'])  # Namespace(path='.', l=True, all=True)
</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">list_detail</span>(path: <span style="color: #483d8b;">str</span>, <span style="color: #483d8b;">all</span>=<span style="color: #008b8b;">False</span>, detail=<span style="color: #008b8b;">False</span>, reverse=<span style="color: #008b8b;">False</span>):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_listdir</span>(path, <span style="color: #483d8b;">all</span>, detail, reverse):
        <span style="color: #a0522d;">p</span> = Path(path)
        <span style="color: #a020f0;">if</span> p.is_dir():  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#20801;&#35768;&#21015;&#20986;&#30446;&#24405; #&#24590;&#20040;&#30693;&#36947;&#23427;&#26159;&#38544;&#34255;&#25991;&#20214;&#65311;
</span>            <span style="color: #a020f0;">for</span> f <span style="color: #a020f0;">in</span> p.absolute().iterdir():
            <span style="color: #b22222;"># </span><span style="color: #b22222;">for f in sorted(p.iterdir(), key=lambda f: f.name, reverse=reverse):
</span>                <span style="color: #b22222;"># </span><span style="color: #b22222;">print(f, type(f), f.name, type(f.name))
</span>                <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> <span style="color: #483d8b;">all</span> <span style="color: #a020f0;">and</span> f.name.startswith(<span style="color: #8b2252;">'.'</span>):
                    <span style="color: #a020f0;">continue</span>
                <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38271;&#26684;&#24335; -rw-r--r-- 1 Administrator 197121 62 Feb 26 17:35 __main__.log
</span>                <span style="color: #b22222;">#       </span><span style="color: #b22222;">type  mode  &#30828;&#38142;&#25509;  owner  group  size  mtime  name
</span>                <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> detail:
                    <span style="color: #a020f0;">yield</span> (f.name,)
                <span style="color: #a020f0;">else</span>:
                    <span style="color: #a0522d;">st</span> = f.stat()
                    <span style="color: #b22222;"># </span><span style="color: #b22222;">print(st)
</span>                    <span style="color: #a0522d;">size</span> = st.st_size
                    <span style="color: #a0522d;">mtime</span> = <span style="color: #8b2252;">"{:%Y-%m-%d %H:%M:%S}"</span>.<span style="color: #483d8b;">format</span>(datetime.datetime.fromtimestamp(st.st_mtime))
                    <span style="color: #a020f0;">yield</span> filemode(st.st_mode), st.st_nlink, st.st_uid, st.st_gid, size, mtime, f.name
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">pass</span>

    <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">sorted</span>(_listdir(path, <span style="color: #483d8b;">all</span>, detail, reverse), key=<span style="color: #a020f0;">lambda</span> x: x[-1], reverse=reverse)

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    <span style="color: #a0522d;">args</span> = parser.parse_args([<span style="color: #8b2252;">'-lar'</span>])  <span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.', longfmt=True, all=True)
</span>    <span style="color: #483d8b;">print</span>(args)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;Namespace&#31867;&#22411;&#23454;&#20363;&#65292;&#23454;&#20363;&#26377;&#23646;&#24615;&#65292;&#23646;&#24615;&#26159;&#21442;&#25968;
</span>
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> list_detail(args.path, args.<span style="color: #483d8b;">all</span>, args.longfmt, args.reverse):
        <span style="color: #483d8b;">print</span>(x)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">break
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">usage: ls [-h] [-l] [-a] [-r] [path]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">List information about the FILEs (the current directory by default)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">positional arguments:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">path           Path help
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">options:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-h, --help     show this help message and exit
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-l             Long list format
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-a, --all      Do not ignore entries starting with .
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-r, --reverse  reverse order while sorting
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.', longfmt=True, all=True, reverse=True)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, 3448, '2025-02-28 00:33:43', 'test.py')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, 1082, '2025-01-14 21:51:12', 't2.py')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, 250, '2025-01-07 00:44:02', 't.ini')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, 17772, '2025-01-08 20:39:39', 'sample.txt')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, 191, '2025-01-06 23:37:23', 'mysql.ini')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('drwxrwxrwx', 1, 0, 0, 0, '2025-02-27 00:16:42', 'm')</span>
</pre>
</div>

<p>
-h 人类可读
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse
<span style="color: #a020f0;">from</span> pathlib <span style="color: #a020f0;">import</span> Path
<span style="color: #a020f0;">from</span> stat <span style="color: #a020f0;">import</span> filemode
<span style="color: #a020f0;">import</span> datetime

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">False</span>
)
parser.add_argument(<span style="color: #8b2252;">'path'</span>, nargs=<span style="color: #8b2252;">'?'</span>, default=<span style="color: #8b2252;">'.'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Path help'</span>)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#21442;&#25968;,&#21487;&#26377;&#21487;&#26080;&#65292;&#32570;&#30465;&#20540;&#65292;&#24110;&#21161;
</span>parser.add_argument(<span style="color: #8b2252;">'-l'</span>, action=<span style="color: #8b2252;">'store_true'</span>, dest=<span style="color: #8b2252;">'longfmt'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Long list format'</span>)  <span style="color: #b22222;"># </span><span style="color: #b22222;">l&#23646;&#24615;&#21517;
</span>parser.add_argument(<span style="color: #8b2252;">'-a'</span>, <span style="color: #8b2252;">'--all'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Do not ignore entries starting with .'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">-r reverse &#25353;&#25991;&#20214;&#21517;&#31216;&#25490;&#24207;
</span>parser.add_argument(<span style="color: #8b2252;">'-r'</span>, <span style="color: #8b2252;">'--reverse'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'reverse order while sorting'</span>)
parser.add_argument(<span style="color: #8b2252;">'-h'</span>, <span style="color: #8b2252;">'--human-readable'</span>, dest=<span style="color: #8b2252;">'human'</span>, action=<span style="color: #8b2252;">'store_true'</span>)
parser.add_argument(<span style="color: #8b2252;">'--help'</span>)
parser.print_help()  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(('o:/abc', '-l')) #&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512; python t.py o:/abc -l
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args('-l o:/tmp'.split()) # python t.py -l o:/tmp
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args() # python t.py .
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(['-l', '-a'])  # Namespace(path='.', l=True, all=True)
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_get_size</span>(size:<span style="color: #483d8b;">int</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22810;&#23569;&#23383;&#33410;
</span>    <span style="color: #a0522d;">units</span> = <span style="color: #8b2252;">' KM'</span>
    <span style="color: #a0522d;">depth</span> = 0
    <span style="color: #a020f0;">while</span> size &gt;= 1000 <span style="color: #a020f0;">and</span> depth &lt; <span style="color: #483d8b;">len</span>(units):
        <span style="color: #a0522d;">size</span> //= 1000
        <span style="color: #a0522d;">depth</span> += 1
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"{}{}"</span>.<span style="color: #483d8b;">format</span>(size, units[depth] <span style="color: #a020f0;">if</span> depth <span style="color: #a020f0;">else</span> <span style="color: #8b2252;">''</span>)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_listdir</span>(path, <span style="color: #483d8b;">all</span>, detail, reverse, human):
    <span style="color: #a0522d;">p</span> = Path(path)
    <span style="color: #a020f0;">if</span> p.is_dir():  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#20801;&#35768;&#21015;&#20986;&#30446;&#24405; #&#24590;&#20040;&#30693;&#36947;&#23427;&#26159;&#38544;&#34255;&#25991;&#20214;&#65311;
</span>        <span style="color: #a020f0;">for</span> f <span style="color: #a020f0;">in</span> p.absolute().iterdir():
            <span style="color: #b22222;"># </span><span style="color: #b22222;">for f in sorted(p.iterdir(), key=lambda f: f.name, reverse=reverse):
</span>            <span style="color: #b22222;"># </span><span style="color: #b22222;">print(f, type(f), f.name, type(f.name))
</span>            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> <span style="color: #483d8b;">all</span> <span style="color: #a020f0;">and</span> f.name.startswith(<span style="color: #8b2252;">'.'</span>):
                <span style="color: #a020f0;">continue</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38271;&#26684;&#24335; -rw-r--r-- 1 Administrator 197121 62 Feb 26 17:35 __main__.log
</span>            <span style="color: #b22222;">#       </span><span style="color: #b22222;">type  mode  &#30828;&#38142;&#25509;  owner  group  size  mtime  name
</span>            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> detail:
                <span style="color: #a020f0;">yield</span> (f.name,)
            <span style="color: #a020f0;">else</span>:
                <span style="color: #a0522d;">st</span> = f.stat()
                <span style="color: #b22222;"># </span><span style="color: #b22222;">print(st)
</span>                <span style="color: #a0522d;">size</span> = _get_size(st.st_size) <span style="color: #a020f0;">if</span> human <span style="color: #a020f0;">else</span> st.st_size
                <span style="color: #a0522d;">mtime</span> = <span style="color: #8b2252;">"{:%Y-%m-%d %H:%M:%S}"</span>.<span style="color: #483d8b;">format</span>(datetime.datetime.fromtimestamp(st.st_mtime))
                <span style="color: #a020f0;">yield</span> filemode(st.st_mode), st.st_nlink, st.st_uid, st.st_gid, size, mtime, f.name
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">list_detail</span>(path: <span style="color: #483d8b;">str</span>, <span style="color: #483d8b;">all</span>=<span style="color: #008b8b;">False</span>, detail=<span style="color: #008b8b;">False</span>, reverse=<span style="color: #008b8b;">False</span>, human=<span style="color: #008b8b;">False</span>):
    <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">sorted</span>(_listdir(path, <span style="color: #483d8b;">all</span>, detail, reverse, human), key=<span style="color: #a020f0;">lambda</span> x: x[-1], reverse=reverse)

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    <span style="color: #a0522d;">args</span> = parser.parse_args([<span style="color: #8b2252;">'-lar'</span>, <span style="color: #8b2252;">'-h'</span>])  <span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.', longfmt=True, all=True)
</span>    <span style="color: #483d8b;">print</span>(args)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;Namespace&#31867;&#22411;&#23454;&#20363;&#65292;&#23454;&#20363;&#26377;&#23646;&#24615;&#65292;&#23646;&#24615;&#26159;&#21442;&#25968;
</span>
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> list_detail(args.path, args.<span style="color: #483d8b;">all</span>, args.longfmt, args.reverse, args.human):
        <span style="color: #483d8b;">print</span>(x)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">break
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">usage: ls [-l] [-a] [-r] [-h] [--help HELP] [path]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">List information about the FILEs (the current directory by default)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">positional arguments:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">path                  Path help
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">options:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-l                    Long list format
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-a, --all             Do not ignore entries starting with .
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-r, --reverse         reverse order while sorting
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-h, --human-readable
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">--help HELP
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.', longfmt=True, all=True, reverse=True, human=True, help=None)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, '3K', '2025-02-28 00:59:15', 'test.py')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, '1K', '2025-01-14 21:51:12', 't2.py')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, '250', '2025-01-07 00:44:02', 't.ini')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, '17K', '2025-01-08 20:39:39', 'sample.txt')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, '191', '2025-01-06 23:37:23', 'mysql.ini')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('drwxrwxrwx', 1, 0, 0, '0', '2025-02-27 00:16:42', 'm')</span>
</pre>
</div>

<p>
处理uid, gid
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> argparse
<span style="color: #a020f0;">from</span> pathlib <span style="color: #a020f0;">import</span> Path
<span style="color: #a020f0;">from</span> stat <span style="color: #a020f0;">import</span> filemode
<span style="color: #a020f0;">import</span> datetime

<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser(
    prog=<span style="color: #8b2252;">'ls'</span>,
    description=<span style="color: #8b2252;">'List information about the FILEs (the current directory by default)'</span>,
    add_help=<span style="color: #008b8b;">False</span>
)
parser.add_argument(<span style="color: #8b2252;">'path'</span>, nargs=<span style="color: #8b2252;">'?'</span>, default=<span style="color: #8b2252;">'.'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Path help'</span>)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20301;&#32622;&#21442;&#25968;,&#21487;&#26377;&#21487;&#26080;&#65292;&#32570;&#30465;&#20540;&#65292;&#24110;&#21161;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">? &#27809;&#26377;&#21017;&#29992;.  * &#21487;&#20197;&#20219;&#24847;&#20010;&#65292;&#22914;&#26524;&#25910;&#38598;&#20102;&#23601;&#26159;&#21015;&#34920;
</span>parser.add_argument(<span style="color: #8b2252;">'-l'</span>, action=<span style="color: #8b2252;">'store_true'</span>, dest=<span style="color: #8b2252;">'longfmt'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Long list format'</span>)  <span style="color: #b22222;"># </span><span style="color: #b22222;">l&#23646;&#24615;&#21517;
</span>parser.add_argument(<span style="color: #8b2252;">'-a'</span>, <span style="color: #8b2252;">'--all'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'Do not ignore entries starting with .'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">-r reverse &#25353;&#25991;&#20214;&#21517;&#31216;&#25490;&#24207;
</span>parser.add_argument(<span style="color: #8b2252;">'-r'</span>, <span style="color: #8b2252;">'--reverse'</span>, action=<span style="color: #8b2252;">'store_true'</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">'reverse order while sorting'</span>)
parser.add_argument(<span style="color: #8b2252;">'-h'</span>, <span style="color: #8b2252;">'--human-readable'</span>, dest=<span style="color: #8b2252;">'human'</span>, action=<span style="color: #8b2252;">'store_true'</span>)
parser.add_argument(<span style="color: #8b2252;">'--help'</span>)
parser.print_help()  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#24110;&#21161;
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(('o:/abc', '-l')) #&#20351;&#29992;&#35299;&#26512;&#22120;&#65292;&#35299;&#26512;&#21442;&#25968;&#65292;&#30495;&#27491;&#30340;&#35299;&#26512; python t.py o:/abc -l
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args('-l o:/tmp'.split()) # python t.py -l o:/tmp
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args() # python t.py .
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">args = parser.parse_args(['-l', '-a'])  # Namespace(path='.', l=True, all=True)
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_get_size</span>(size:<span style="color: #483d8b;">int</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22810;&#23569;&#23383;&#33410;
</span>    <span style="color: #a0522d;">units</span> = <span style="color: #8b2252;">' KM'</span>
    <span style="color: #a0522d;">depth</span> = 0
    <span style="color: #a020f0;">while</span> size &gt;= 1000 <span style="color: #a020f0;">and</span> depth &lt; <span style="color: #483d8b;">len</span>(units):
        <span style="color: #a0522d;">size</span> //= 1000
        <span style="color: #a0522d;">depth</span> += 1
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"{}{}"</span>.<span style="color: #483d8b;">format</span>(size, units[depth] <span style="color: #a020f0;">if</span> depth <span style="color: #a020f0;">else</span> <span style="color: #8b2252;">''</span>)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_listdir</span>(path, <span style="color: #483d8b;">all</span>, detail, reverse, human):
    <span style="color: #a0522d;">p</span> = Path(path)
    <span style="color: #a020f0;">if</span> p.is_dir():  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#20801;&#35768;&#21015;&#20986;&#30446;&#24405; #&#24590;&#20040;&#30693;&#36947;&#23427;&#26159;&#38544;&#34255;&#25991;&#20214;&#65311;
</span>        <span style="color: #a020f0;">for</span> f <span style="color: #a020f0;">in</span> p.absolute().iterdir():
            <span style="color: #b22222;"># </span><span style="color: #b22222;">for f in sorted(p.iterdir(), key=lambda f: f.name, reverse=reverse):
</span>            <span style="color: #b22222;"># </span><span style="color: #b22222;">print(f, type(f), f.name, type(f.name))
</span>            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> <span style="color: #483d8b;">all</span> <span style="color: #a020f0;">and</span> f.name.startswith(<span style="color: #8b2252;">'.'</span>):
                <span style="color: #a020f0;">continue</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38271;&#26684;&#24335; -rw-r--r-- 1 Administrator 197121 62 Feb 26 17:35 __main__.log
</span>            <span style="color: #b22222;">#       </span><span style="color: #b22222;">type  mode  &#30828;&#38142;&#25509;  owner  group  size  mtime  name
</span>            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> detail:
                <span style="color: #a020f0;">yield</span> (f.name,)
            <span style="color: #a020f0;">else</span>:
                <span style="color: #a0522d;">st</span> = f.stat()
                <span style="color: #b22222;"># </span><span style="color: #b22222;">print(st)
</span>                <span style="color: #a0522d;">size</span> = _get_size(st.st_size) <span style="color: #a020f0;">if</span> human <span style="color: #a020f0;">else</span> st.st_size
                <span style="color: #a0522d;">mtime</span> = <span style="color: #8b2252;">"{:%Y-%m-%d %H:%M:%S}"</span>.<span style="color: #483d8b;">format</span>(datetime.datetime.fromtimestamp(st.st_mtime))
                <span style="color: #a020f0;">yield</span> filemode(st.st_mode), st.st_nlink, st.st_uid, st.st_gid, size, mtime, f.name
                <span style="color: #a020f0;">yield</span> filemode(st.st_mode), st.st_nlink, f.owner(), f.group(), size, mtime, f.name <span style="color: #b22222;">#</span><span style="color: #b22222;">linux
</span>    <span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">list_detail</span>(path: <span style="color: #483d8b;">str</span>, <span style="color: #483d8b;">all</span>=<span style="color: #008b8b;">False</span>, detail=<span style="color: #008b8b;">False</span>, reverse=<span style="color: #008b8b;">False</span>, human=<span style="color: #008b8b;">False</span>):
    <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">sorted</span>(_listdir(path, <span style="color: #483d8b;">all</span>, detail, reverse, human), key=<span style="color: #a020f0;">lambda</span> x: x[-1], reverse=reverse)

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    <span style="color: #a0522d;">args</span> = parser.parse_args([<span style="color: #8b2252;">'-lar'</span>, <span style="color: #8b2252;">'-h'</span>])  <span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.', longfmt=True, all=True)
</span>    <span style="color: #483d8b;">print</span>(args)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;Namespace&#31867;&#22411;&#23454;&#20363;&#65292;&#23454;&#20363;&#26377;&#23646;&#24615;&#65292;&#23646;&#24615;&#26159;&#21442;&#25968;
</span>
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> list_detail(args.path, args.<span style="color: #483d8b;">all</span>, args.longfmt, args.reverse, args.human):
        <span style="color: #483d8b;">print</span>(x)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">break
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">usage: ls [-l] [-a] [-r] [-h] [--help HELP] [path]
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">List information about the FILEs (the current directory by default)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">positional arguments:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">path                  Path help
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">options:
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-l                    Long list format
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-a, --all             Do not ignore entries starting with .
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-r, --reverse         reverse order while sorting
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">-h, --human-readable
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">--help HELP
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Namespace(path='.', longfmt=True, all=True, reverse=True, human=True, help=None)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, '3K', '2025-02-28 00:59:15', 'test.py')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, '1K', '2025-01-14 21:51:12', 't2.py')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, '250', '2025-01-07 00:44:02', 't.ini')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, '17K', '2025-01-08 20:39:39', 'sample.txt')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('-rw-rw-rw-', 1, 0, 0, '191', '2025-01-06 23:37:23', 'mysql.ini')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('drwxrwxrwx', 1, 0, 0, '0', '2025-02-27 00:16:42', 'm')</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:05e6856d-7237-485f-a969-26edf847627b" class="outline-3">
<h3 id="h:05e6856d-7237-485f-a969-26edf847627b">PEP</h3>
<div class="outline-text-3" id="text-h:05e6856d-7237-485f-a969-26edf847627b">
<p>
PEP 是每一个 Python 程序员必须知道的。
</p>

<p>
<a href="https://peps.python.org/">https://peps.python.org/</a>
</p>


<p>
PEP 是 Python Enhancement Proposals 的缩写（Python 增强提案）。一个PEP是一份为 Python 社区提供各种
增强功能的技术规格，也是提交新特性，以便让社区指出问题，精确化技术文档的提案。
</p>

<p>
每个 Python 版本的新特性或变化都是将 PEP 提案通过社区决策层讨论、投票决议，通过后才有我们看到的
功能变化。
</p>

<p>
Guido van Possum 被戏称为“仁慈的独裁者“（benevolent dictator for life, BDFL）。他会亲自签署并确认每一份 PEP。
但在 2018 年 7 月，由于 PEP 572(Assignment Expressions)这个提案，他已经卸任 BDFL。没有继任者，没有管理
原则，PEP 路在何方？
</p>

<ul class="org-ul">
<li>PEP 0：文档索引</li>
<li>PEP 1：协议指南</li>
<li>PEP 8：编码风格</li>
<li>PEP 20：Python 之禅</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> this

Beautiful <span style="color: #a020f0;">is</span> better than ugly.
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20248;&#32654;&#32988;&#20110;&#19985;&#38475;&#65288;Python&#20197;&#32534;&#20889;&#20248;&#32654;&#30340;&#20195;&#30721;&#20026;&#30446;&#26631;&#65289;
</span>
Explicit <span style="color: #a020f0;">is</span> better than implicit.
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26126;&#30830;&#32988;&#20110;&#38544;&#26214;&#65288;&#20248;&#32654;&#30340;&#20195;&#30721;&#24212;&#24403;&#26159;&#26126;&#20102;&#30340;&#65292;&#21629;&#21517;&#35268;&#33539;&#65292;&#39118;&#26684;&#30456;&#20284;&#65289;
</span>
Simple <span style="color: #a020f0;">is</span> better than <span style="color: #483d8b;">complex</span>.
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#31616;&#21333;&#32988;&#20110;&#22797;&#26434;&#65288;&#20248;&#32654;&#30340;&#20195;&#30721;&#24212;&#24403;&#26159;&#31616;&#27905;&#30340;&#65292;&#19981;&#35201;&#26377;&#22797;&#26434;&#30340;&#20869;&#37096;&#23454;&#29616;&#65289;
</span>
Complex <span style="color: #a020f0;">is</span> better than complicated.
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22797;&#26434;&#32988;&#20110;&#20940;&#20081;&#65288;&#22914;&#26524;&#22797;&#26434;&#19981;&#21487;&#36991;&#20813;&#65292;&#37027;&#20195;&#30721;&#38388;&#20063;&#19981;&#33021;&#26377;&#38590;&#25026;&#30340;&#20851;&#31995;&#65292;&#35201;&#20445;&#25345;&#25509;&#21475;&#31616;&#27905;&#65289;
</span>
Flat <span style="color: #a020f0;">is</span> better than nested.
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25153;&#24179;&#32988;&#20110;&#23884;&#22871;&#65288;&#20248;&#32654;&#30340;&#20195;&#30721;&#24212;&#24403;&#26159;&#25153;&#24179;&#30340;&#65292;&#19981;&#33021;&#26377;&#22826;&#22810;&#30340;&#23884;&#22871;&#65289;
</span>
Sparse <span style="color: #a020f0;">is</span> better than dense.
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#30041;&#30333;&#32988;&#20110;&#32039;&#20945;&#65288;&#20248;&#32654;&#30340;&#20195;&#30721;&#26377;&#36866;&#24403;&#30340;&#31354;&#30333;&#65292;&#19981;&#35201;&#22882;&#26395;&#19968;&#34892;&#20195;&#30721;&#35299;&#20915;&#38382;&#39064;&#65289;
</span>
Readability counts.
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#35835;&#24615;&#24456;&#37325;&#35201;&#65288;&#20248;&#32654;&#30340;&#20195;&#30721;&#26159;&#21487;&#35835;&#30340;&#65289;
</span>
Special cases aren<span style="color: #8b2252;">'t special enough to break the rules.
Although practicality beats purity.
# &#21363;&#20415;&#20551;&#20511;&#29305;&#20363;&#30340;&#23454;&#29992;&#24615;&#20043;&#21517;&#65292;&#20063;&#19981;&#21487;&#36829;&#32972;&#36825;&#20123;&#35268;&#21017;&#65288;&#36825;&#20123;&#35268;&#21017;&#33267;&#39640;&#26080;&#19978;&#65289;

Errors should never pass silently.
Unless explicitly silenced.
# &#19981;&#35201;&#21253;&#23481;&#25152;&#26377;&#38169;&#35823;&#65292;&#38500;&#38750;&#20320;&#30830;&#23450;&#38656;&#35201;&#36825;&#26679;&#20570;&#65288;&#31934;&#20934;&#22320;&#25429;&#33719;&#24322;&#24120;&#65292;&#19981;&#20889;Exception:pass&#39118;&#26684;&#20195;&#30721;&#65289;

In the face of ambiguity, refuse the temptation to guess.
# &#38754;&#23545;&#22810;&#31181;&#21487;&#33021;&#65292;&#19981;&#35201;&#38752;&#29468;
There should be one-- and preferably only one --obvious way to do it.
# &#32780;&#26159;&#23613;&#37327;&#25214;&#19968;&#31181;&#65292;&#26368;&#22909;&#26159;&#21807;&#19968;&#19968;&#31181;&#26126;&#26174;&#30340;&#35299;&#20915;&#26041;&#26696;&#65288;&#22914;&#26524;&#19981;&#30830;&#23450;&#65292;&#23601;&#29992;&#31351;&#20030;&#27861;&#65289;

Although that way may not be obvious at first unless you'</span>re Dutch.
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#34429;&#28982;&#36825;&#24182;&#19981;&#23481;&#26131;&#65292;&#22240;&#20026;&#20320;&#19981;&#26159; Python &#20043;&#29238;&#65288;&#36825;&#37324;&#30340;Dutch&#26159;&#25351;Python&#20043;&#29238;Guido Van Rossum&#65292;&#20182;&#26159;&#33655;&#20848;&#20154;&#12290;&#65289;
</span>
Now <span style="color: #a020f0;">is</span> better than never.
Although never <span style="color: #a020f0;">is</span> often better than *right* now.
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#29616;&#22312;&#34892;&#21160;&#32988;&#36807;&#27704;&#19981;&#24320;&#22987;&#65292;&#20294;&#26159;&#19981;&#20551;&#24605;&#32034;&#23601;&#21160;&#25163;&#36824;&#19981;&#22914;&#19981;&#20570;&#65288;&#21160;&#25163;&#20043;&#21069;&#35201;&#32454;&#24605;&#37327;&#65289;
</span>
If the implementation <span style="color: #a020f0;">is</span> hard to explain, it<span style="color: #8b2252;">'s a bad idea.
If the implementation is easy to explain, it may be a good idea.
# &#22914;&#26524;&#20320;&#30340;&#23454;&#29616;&#24456;&#38590;&#21521;&#21035;&#20154;&#35299;&#37322;&#65292;&#36825;&#24448;&#24448;&#19981;&#26159;&#19968;&#20010;&#22909;&#30340;&#26041;&#26696;&#65307;&#22914;&#26524;&#20320;&#30340;&#23454;&#29616;&#24456;&#23481;&#26131;&#21521;&#21035;&#20154;&#35299;&#37322;&#65292;&#36825;&#21487;&#33021;&#26159;&#20010;&#22909;&#30340;&#26041;&#26696;&#12290;&#65288;&#26041;&#26696;&#27979;&#35780;&#26631;&#20934;&#65289;

Namespaces are one honking great idea -- let'</span>s do more of those!
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21629;&#21517;&#31354;&#38388;&#26159;&#19968;&#31181;&#32477;&#22937;&#30340;&#29702;&#24565;&#65292;&#25105;&#20204;&#24212;&#24403;&#22810;&#21152;&#21033;&#29992;&#65288;&#20513;&#23548;&#19982;&#21495;&#21484;&#65289;</span>
</pre>
</div>

<p>
PEP8016
</p>

<p>
Python社区治理方案，这是Python之父卸任BDFL之后，社区从几种方案中投票胜出的方案。
</p>

<p>
PEP 8016 治理方案采用指导委员会模式，其特点是引导治理的迭代，该方案由 Nathaniel J. Smith 和 Donald Stuﬀt 提出。
</p>

<p>
PEP 8016 中提出了不信任投票，也就是弹劾机制，可将任期内的当权者赶下台；它严格限定了在委员会里，只允 许少于 50% 的成员是企业（5 人委员会里最多有 2 个）；并且关注到核心开发者的选举/淘汰、如何更新治理提案等问题。
</p>

<p>
而且，PEP 8016 中也提出了新的 PEP 流程，目前的 PEP 流程是提案人确定 PEP 的选题方向，提案人负责收集与 整合来自整个社区的反馈。然后，相关领域的专家们汇总全部讨论，并开启为期 14 天的审查，之后进行社区投 票。如果一个 PEP 很有争议，任何专家成员都可发起动议来拒绝通过它，这需要超过 2/3 的票数。
</p>

<p>
PEP 8016 的 PEP 流程：指导委员会在必要时可直接地批准/否决 PEP，但最好是设置流程来避免这样做决策，例如，将决策权委派给团队或者 BDFL 代表。
</p>

<p>
2019 年 2 月 4 日，为期2周的投票后，Python 社区选出来了指导委员会的5名成员。
</p>


<p>
5人分别是：
</p>
<ul class="org-ul">
<li>Barry Warsaw：自 1995 年起成为核心开发者之一，荣获 2014 年的弗兰克·威利森纪念奖。业余爱好是音乐和太极。</li>
<li>Brett Cannon：自2003年起成为核心开发者之一，荣获 2016 年的弗兰克·威利森纪念奖。曾担任 Python 软 件基金会的执行副主席。目前供职于微软，负责 VSCode 的 Python 插件项目。</li>
<li>Carol Willing：Python 核心开发者，Jupyter 核心开发者及 Jupyter 的指导委员会成员。自由职业，兴趣在于 科研及教育项目。</li>
<li>Guido van Rossum：Python 的创始人，被称为“Python 之父”，长期领导 Python 社区的发展，直到此次的 退位风波。</li>
<li>Nick Coghlan：自2005年起成为核心开发者之一。</li>
</ul>
</div>
</div>
</section>
<section id="outline-container-h:c90d2ee7-bd7f-4a3c-abad-45704c8d5298" class="outline-2">
<h2 id="h:c90d2ee7-bd7f-4a3c-abad-45704c8d5298">Python 面向对象高级编程</h2>
<div class="outline-text-2" id="text-h:c90d2ee7-bd7f-4a3c-abad-45704c8d5298">
<p>
主要内容：
</p>
<ul class="org-ul">
<li>命名空间与模块与包管理</li>
<li><span class="underline"><span class="underline">init</span></span>.py 文件</li>
<li>Python 包格式、管理工具和程序打包分发</li>
<li>Python 动态模块加载技术</li>
<li>运算符重载</li>
<li>实例化方法本质</li>
<li>上下文管理</li>
<li>可调用对象</li>
<li>可视化方法</li>
</ul>
</div>
<div id="outline-container-h:2b3c3076-9d5d-48c7-a84d-076b360e814e" class="outline-3">
<h3 id="h:2b3c3076-9d5d-48c7-a84d-076b360e814e">魔术方法</h3>
<div class="outline-text-3" id="text-h:2b3c3076-9d5d-48c7-a84d-076b360e814e">
<p>
<a href="https://docs.python.org/3.13/reference/datamodel.html#special-method-names">Python 语言参考手册-3.3特殊方法名称</a>
</p>
</div>
<div id="outline-container-h:71093268-d172-488e-b794-b90e12b622f6" class="outline-4">
<h4 id="h:71093268-d172-488e-b794-b90e12b622f6">查看属性__dir__()</h4>
<div class="outline-text-4" id="text-h:71093268-d172-488e-b794-b90e12b622f6">
<p>
dir(obj)对于不同类型的对象obj具有不同的行为：
</p>
<ul class="org-ul">
<li>如果对象是模块对象，返回的列表包含模块的属性名和变量名</li>
<li>如果对象是类型或者说是类对象，返回的列表包含类的属性名，及它的祖先类的属性名</li>
<li>如果是类的实例
<ul class="org-ul">
<li>有 __dir__方法，返回可迭代对象的返回值</li>
<li>没有__dir__方法，则尽可能收集实例的属性名、类的属性和祖先类的属性名</li>
</ul></li>
<li>如果obj不写，返回列表包含内容不同
<ul class="org-ul">
<li>在模块中，返回模块的属性和变量名</li>
<li>在函数中，返回本地作用域的变量名</li>
<li>在方法中，返回本地作用域的变量名</li>
</ul></li>
</ul>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">方法</th>
<th scope="col" class="org-left">意义</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>__dir__</code></td>
<td class="org-left">返回类或者对象的所有成员名称列表</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">dir()函数操作实例就是调用 <code>__dir__()</code></td>
</tr>
</tbody>
</table>

<p>
如果dir[obj]参数obj包含方法__dir__()，该方法将被调用。如果参数obj不包含__dir__()，该方法将最
大限度地收集属性信息。
</p>

<p>
范例: 如果对象是模块对象，返回的列表包含模块的属性名和变量名
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">t1.py
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~~~~~~~~~~~~~~~'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#30452;&#25509;&#22312;t1.py&#19978;&#36816;&#34892;&#65292;&#24403;&#21069;&#27169;&#22359;&#21517;&#20250;&#34987;&#26367;&#25442;&#20026;__main__
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">dir() &#36319;&#25152;&#22788;&#20301;&#32622;&#26377;&#20851;&#65292;&#36820;&#22238;&#23646;&#24615;&#21517;&#31216;&#30340;&#21015;&#34920;&#65292;&#34920;&#31034;&#36825;&#20123;&#21517;&#31216;&#37117;&#26159;&#27169;&#22359;&#30340;&#21464;&#37327;&#65292;&#37117;&#27169;&#22359;&#30340;&#23646;&#24615;
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"moudule'name = {}, {}"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">__name__</span>, <span style="color: #483d8b;">dir</span>()))

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Animal</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = 20
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">weight</span> = 80
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"moudule'name = {}, {}"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">__name__</span>, <span style="color: #483d8b;">dir</span>()))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">~~~~~~~~~~~~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">moudule'name = __main__, ['__annotations__', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">moudule'name = __main__, ['Animal', '__annotations__', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__']</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #a020f0;">import</span> t1 <span style="color: #b22222;">#</span><span style="color: #b22222;">t1&#27169;&#22359;&#21517;&#65292;&#21152;&#36733;&#27169;&#22359;&#65292;&#25191;&#34892;&#27169;&#22359;&#65292;t1&#26159;&#20840;&#23616;&#21464;&#37327;
</span><span style="color: #a020f0;">from</span> t1 <span style="color: #a020f0;">import</span> Animal <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23548;&#20837;&#27169;&#22359;&#65292;&#21516;&#19968;&#27169;&#22359;&#21482;&#33021;&#23548;&#20837;&#19968;&#27425;&#19981;&#22815;&#20102;
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Cat</span>(t1.Animal): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#36807;from t1 import Animal&#65292; &#21487;&#20889;&#25104;class Cat(Animal)
</span>    <span style="color: #a0522d;">x</span> = <span style="color: #8b2252;">'abc'</span>
    <span style="color: #a0522d;">y</span> = <span style="color: #8b2252;">'cat class'</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"moudule'name = {}, {}"</span>.<span style="color: #483d8b;">format</span>(t1.<span style="color: #483d8b;">__name__</span>, <span style="color: #483d8b;">dir</span>(t1))) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#35937;&#26159;&#27169;&#22359;&#23545;&#35937;&#65292;&#36820;&#22238;&#30340;&#21015;&#34920;&#21253;&#21547;&#27169;&#22359;&#30340;&#23646;&#24615;&#21517;&#21644;&#21464;&#37327;&#21517;
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"moudule'name = {}, {}"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">__name__</span>, <span style="color: #483d8b;">dir</span>()))
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'*'</span> * 30)

<span style="color: #483d8b;">print</span>(Cat, Cat.mro())
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>(Cat)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#35937;&#26159;&#31867;&#22411;&#25110;&#32773;&#35828;&#26159;&#31867;&#23545;&#35937;&#65292;&#36820;&#22238;&#30340;&#21015;&#34920;&#21253;&#21547;&#31867;&#30340;&#23646;&#24615;&#21517;&#65292;&#21450;&#23427;&#30340;&#31062;&#20808;&#31867;&#30340;&#23646;&#24615;&#21517;
</span><span style="color: #a0522d;">tom</span> = Cat(<span style="color: #8b2252;">'tom'</span>)
<span style="color: #483d8b;">print</span>(tom)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>(tom))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">sorted</span>(tom.<span style="color: #483d8b;">__dict__</span>.keys() | Cat.<span style="color: #483d8b;">__dict__</span>.keys()
             | Animal.<span style="color: #483d8b;">__dict__</span>.keys()
             | <span style="color: #483d8b;">object</span>.<span style="color: #483d8b;">__dict__</span>.keys()
             ))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">~~~~~~~~~~~~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">moudule'name = t1, ['__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">moudule'name = t1, ['Animal', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">moudule'name = t1, ['Animal', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">moudule'name = __main__, ['Animal', 'Cat', '__annotations__', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__', 't1']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">******************************
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;class '__main__.Cat'&gt; [&lt;class '__main__.Cat'&gt;, &lt;class 't1.Animal'&gt;, &lt;class 'object'&gt;]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">['__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__weakref__', 'x', 'y']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;__main__.Cat object at 0x00000260F31F7CB0&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">['_Animal__age', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__weakref__', '_name', 'weight', 'x', 'y']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">['_Animal__age', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__weakref__', '_name', 'weight', 'x', 'y']
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;'</span>)
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Dog</span>(Animal):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__dir__</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#20010;&#39764;&#26415;&#26041;&#27861;self&#65292;&#21644;&#24403;&#21069;&#23454;&#20363;&#26377;&#20851;
</span>        <span style="color: #a020f0;">return</span> [123] <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#19968;&#20010;&#21487;&#36845;&#20195;&#23545;&#35937;&#65292;&#37324;&#38754;&#24212;&#35813;&#26159;&#23383;&#31526;&#20018;
</span>
<span style="color: #a0522d;">dog</span> = Dog(<span style="color: #8b2252;">'snoopy'</span>)
<span style="color: #483d8b;">print</span>(dog)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>(dog))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>(Dog))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;__main__.Dog object at 0x000002685DC27E00&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[123]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">['__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__firstlineno__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__static_attributes__', '__str__', '__subclasshook__', '__weakref__']</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">show</span>(<span style="color: #a020f0;">self</span>, a, b=1):
        <span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">self</span>, a, b)
        <span style="color: #a0522d;">c</span> = 200
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>()) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#34920;&#29616;&#20160;&#20040;&#65292;&#20989;&#25968;&#20013;&#65292;&#25910;&#38598; &#23616;&#37096;&#21464;&#37327;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">locals</span>()) <span style="color: #b22222;">#</span><span style="color: #b22222;">locals() &#20869;&#24314;&#20989;&#25968;&#65292;&#26412;&#22320;&#30340;&#65292;&#23616;&#37096;&#21464;&#37327;&#30340;&#23383;&#20856;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">globals</span>()) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20869;&#24314;&#20989;&#25968;&#65292;&#20840;&#23616;&#30340;&#65292;&#24403;&#21069;&#27169;&#22359;&#30340;&#25152;&#26377;&#23646;&#24615;&#23383;&#20856;
</span>
A().show(100)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">b</span>(x=123, y=<span style="color: #8b2252;">'abc'</span>):
    <span style="color: #a0522d;">z</span> = [1,1,1]
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>())  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#34920;&#29616;&#20160;&#20040;&#65292;&#20989;&#25968;&#20013;&#65292;&#25910;&#38598; &#23616;&#37096;&#21464;&#37327;
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">locals</span>())  <span style="color: #b22222;"># </span><span style="color: #b22222;">locals() &#20869;&#24314;&#20989;&#25968;&#65292;&#26412;&#22320;&#30340;&#65292;&#23616;&#37096;&#21464;&#37327;&#30340;&#23383;&#20856;
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">globals</span>())  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20869;&#24314;&#20989;&#25968;&#65292;&#20840;&#23616;&#30340;&#65292;&#24403;&#21069;&#27169;&#22359;&#30340;&#25152;&#26377;&#23646;&#24615;&#23383;&#20856;
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'*'</span> * 30)
b()

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>())
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">sorted</span>(<span style="color: #483d8b;">locals</span>().keys()))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">sorted</span>(<span style="color: #483d8b;">locals</span>().keys()))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;__main__.A object at 0x0000028A31727E00&gt; 100 1
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">['a', 'b', 'c', 'self']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'self': &lt;__main__.A object at 0x0000028A31727E00&gt;, 'a': 100, 'b': 1, 'c': 200}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'__name__': '__main__', '__doc__': None, '__package__': None, '__loader__': &lt;_frozen_importlib_external.SourceFileLoader object at 0x0000028A318D44B0&gt;, '__spec__': None, '__annotations__': {}, '__builtins__': &lt;module 'builtins' (built-in)&gt;, '__file__': 'D:\\project\\pyproj\\t3.py', '__cached__': None, 'A': &lt;class '__main__.A'&gt;}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">******************************
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">['x', 'y', 'z']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'x': 123, 'y': 'abc', 'z': [1, 1, 1]}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'__name__': '__main__', '__doc__': None, '__package__': None, '__loader__': &lt;_frozen_importlib_external.SourceFileLoader object at 0x0000028A318D44B0&gt;, '__spec__': None, '__annotations__': {}, '__builtins__': &lt;module 'builtins' (built-in)&gt;, '__file__': 'D:\\project\\pyproj\\t3.py', '__cached__': None, 'A': &lt;class '__main__.A'&gt;, 'b': &lt;function b at 0x0000028A318BF240&gt;}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">['A', '__annotations__', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__', 'b']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">['A', '__annotations__', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__', 'b']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">['A', '__annotations__', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__', 'b']</span>
</pre>
</div>

<p>
内建函数：
</p>
<ul class="org-ul">
<li>locals() 返回当前作用域中的变量字典</li>
<li>globals() 返回当前模块全局变量的字典</li>
</ul>
</div>
</div>
<div id="outline-container-h:70d1ed1f-7b4f-4301-953b-c19355400999" class="outline-4">
<h4 id="h:70d1ed1f-7b4f-4301-953b-c19355400999">魔术方法分类</h4>
<div class="outline-text-4" id="text-h:70d1ed1f-7b4f-4301-953b-c19355400999">
<p>
分类
</p>
<ul class="org-ul">
<li>创建、初始化与销毁
<ul class="org-ul">
<li><code>__new__</code></li>
<li><code>__init__与__del__</code></li>
</ul></li>
<li>可视化</li>
<li>hash</li>
<li>bool</li>
<li>运算符重载</li>
<li>容器和大小</li>
<li>可调用对象</li>
<li>上下文管理</li>
<li>反射</li>
<li>描述器</li>
<li>其他杂项</li>
</ul>
</div>
</div>
<div id="outline-container-h:e20e8295-207a-457a-9eb9-e64359f66cf1" class="outline-4">
<h4 id="h:e20e8295-207a-457a-9eb9-e64359f66cf1">实例化 <code>__new__,__init__,__del__</code></h4>
<div class="outline-text-4" id="text-h:e20e8295-207a-457a-9eb9-e64359f66cf1">
<ul class="org-ul">
<li>创建、初始化与销毁
<ul class="org-ul">
<li><code>__new__</code></li>
<li><code>__init__与__del__</code></li>
</ul></li>
</ul>

<pre class="example" id="org6e4b8ee">
这3个方法分别是用来创建、初始化和销毁的。销毁是析构方法。
对于一个实例的创建过程来讲，实例上是分2步，第1步通过 __new__ 方法得一个实例，第2步__init__方法，它是当我们
创建一个实例后还不能直接给用户使用还需要初始化属性，这时候我们会写self.xx等于xx。相当于做出厂配置，因为
python是动态语言，动态地添加属性。__init__方法不能有返回值。最后我们就拿到了一个实例，这个实例是在内存
中创建出来的。

实例消亡跟引用计数相关，一个对象引用计数为0时，python会在适当时候垃圾回收。垃圾回收在调用它之前会
调用__del__方法
</pre>

<p>
<code>__new__</code>
</p>
<ul class="org-ul">
<li>实例化一个对象</li>
<li>该方法需要返回一个值，如果该值不是cls的实例，则不会调用__init__</li>
<li>该方法永远都是静态方法</li>
</ul>

<p>
__new__方法很少使用，即使创建了该方法，也会使用return super().__new__(cls) 基类object的__new__方法来创建实例并返回
</p>


<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__new__</span>(cls, *args, **kwargs):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A new ~~~~~~~~~~~~'</span>)
        <span style="color: #483d8b;">print</span>(cls) <span style="color: #b22222;">#</span><span style="color: #b22222;">cls &#20026;&#24403;&#21069;&#31867;
</span>        <span style="color: #483d8b;">print</span>(args)
        <span style="color: #a0522d;">args</span> =(<span style="color: #8b2252;">'jerry'</span>,)
        <span style="color: #483d8b;">print</span>(kwargs)
        <span style="color: #a0522d;">kwargs</span>[<span style="color: #8b2252;">'age'</span>] = 30
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return object.__new__(cls) #&#20351;&#29992;cls A&#31867;&#23545;&#35937;&#65292;&#27169;&#26495;&#65292;&#26500;&#24314;&#19968;&#20010;&#23454;&#20363;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">super</span>().__new__(cls)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return None
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A init _________'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

<span style="color: #a0522d;">t</span> = A(<span style="color: #8b2252;">'tom'</span>, age=20)
<span style="color: #483d8b;">print</span>(t)
<span style="color: #483d8b;">print</span>(t.name, t.age)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A new ~~~~~~~~~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;class '__main__.A'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('tom',)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'age': 20}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A init _________
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;__main__.A object at 0x0000022D37C97E00&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">tom 20</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c77ad9df-2ff5-4d30-a572-d3c66461ac49" class="outline-4">
<h4 id="h:c77ad9df-2ff5-4d30-a572-d3c66461ac49">可视化 <code>__str__,__repr__,__bytes__</code></h4>
<div class="outline-text-4" id="text-h:c77ad9df-2ff5-4d30-a572-d3c66461ac49">
<p>
<code>__str__</code>
</p>
<ul class="org-ul">
<li>str()函数、format()函数、print()函数调用，需要返回对象的字符串表达。如果没有定义，就去调用__repr__方法返回字符串表达，如果__repr__没有定义，直接返回对象的内存地址信息</li>
</ul>

<p>
<code>__repr__</code>
</p>
<ul class="org-ul">
<li>内建函数repr()对一个对象获取字符串表达</li>
<li>调用__repr__方法返回字符串表达，如果__repr__也没有定义，就直接返回object的定义，就是显示内存地址信息</li>
</ul>

<p>
<code>__bytes__</code>
</p>
<ul class="org-ul">
<li>bytes()函数调用，返回一个对象的bytes表达，即返回bytes对象</li>
</ul>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=19):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'repr: {},{}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.name, <span style="color: #a020f0;">self</span>.age)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__str__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'str: {},{}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.name, <span style="color: #a020f0;">self</span>.age)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__bytes__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return "{} is {}".format(self.name, self.age).encode()
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">return str(self).encode()
</span>        <span style="color: #a020f0;">import</span> json
        <span style="color: #a020f0;">return</span> json.dumps(<span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">__dict__</span>).encode()

<span style="color: #483d8b;">print</span>(A(<span style="color: #8b2252;">'tom'</span>)) <span style="color: #b22222;">#</span><span style="color: #b22222;">print&#20316;&#29992;&#20110;&#36825;&#20010;&#23454;&#20363; # str print format &#36825;&#20010;&#19977;&#20010;&#20989;&#25968;&#20248;&#20808;&#20351;&#29992; __str__&#65292;&#22914;&#26524;&#27809;&#26377;&#21017;&#20351;&#29992;__repr__&#65292;&#22914;&#27809;&#26377;&#21017;&#35843;&#29992;object
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{}'</span>.<span style="color: #483d8b;">format</span>(A(<span style="color: #8b2252;">'tom'</span>)))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">str</span>(A(<span style="color: #8b2252;">'tom'</span>))) <span style="color: #b22222;">#</span><span style="color: #b22222;">str&#20351;&#29992;&#20110;&#36825;&#20010;&#23454;&#20363;&#19978;
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
<span style="color: #483d8b;">print</span>([A(<span style="color: #8b2252;">'tom'</span>)]) <span style="color: #b22222;">#</span><span style="color: #b22222;">[]&#20351;&#29992;__str__&#65292;&#20294;&#20854;&#20869;&#37096;&#20351;&#29992;__repr__
</span><span style="color: #483d8b;">print</span>([<span style="color: #483d8b;">str</span>(A(<span style="color: #8b2252;">'tom'</span>))]) <span style="color: #b22222;">#</span><span style="color: #b22222;">[]&#20351;&#29992;__str__&#65292;&#20854;&#20013;&#20803;&#32032;&#20351;&#29992;str()&#20989;&#25968;&#20063;&#35843;&#29992;__str__
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">bytes</span>(A(<span style="color: #8b2252;">'tom'</span>)))

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">str: tom,19
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">str: tom,19
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">str: tom,19
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[repr: tom,19]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">['str: tom,19']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">b'{"name": "tom", "age": 19}'</span>
</pre>
</div>

<p>
注意不能通过判断是否带引号来判断输出值的类型，类型判断要使用type或者isinstance
</p>
</div>
</div>
<div id="outline-container-h:73a84ffe-ba7f-4c92-9809-0cc3d545cde1" class="outline-4">
<h4 id="h:73a84ffe-ba7f-4c92-9809-0cc3d545cde1">hash <code>__hash__</code></h4>
<div class="outline-text-4" id="text-h:73a84ffe-ba7f-4c92-9809-0cc3d545cde1">
<pre class="example" id="orge5d63c6">
__hash__
内建函数hash()调用的返回值，返回一个整数，如果定义个方法该类的实例就可hash
</pre>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">hash</span>(1))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">hash</span>(<span style="color: #8b2252;">'tom'</span>))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">hash</span>((<span style="color: #8b2252;">'tom'</span>,)))
</pre>
</div>

<p>
上例中，A的实例放在set中，他们hash值是相同的，并没有去重
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.name

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__hash__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> 1

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__eq__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"id(self)"</span>, <span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"id(other)"</span>, <span style="color: #483d8b;">id</span>(other))
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.name == other.name

<span style="color: #a0522d;">a1</span> = A(<span style="color: #8b2252;">'tom'</span>)
<span style="color: #a0522d;">a2</span> = A(<span style="color: #8b2252;">'tom'</span>)
<span style="color: #a0522d;">s</span> = {a1, a2}  <span style="color: #b22222;">#</span><span style="color: #b22222;">hash&#22320;&#22336;&#30456;&#21516;&#65292;hash&#20540;&#30456;&#21516;&#65292;hash&#20914;&#31361;&#65307;&#36824;&#35201;&#30475;&#20869;&#23481;&#26159;&#21542;&#30456;&#21516;
</span>                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#20215;&#20110; a1.__eq__(a2) True
</span><span style="color: #483d8b;">print</span>(s) <span style="color: #b22222;">#</span><span style="color: #b22222;">??? {tom at 2237306535424}
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
<span style="color: #483d8b;">print</span>(a1 == a2) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#20215;&#20110; a1.__eq__(a2) True
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">set&#21435;&#37325;&#21407;&#29702;&#65292;&#31532;&#19968;&#27493;&#24517;&#39035;&#27714;hash&#65292;hash&#20914;&#31361;&#25165;&#38656;&#35201;&#21435;&#37325;&#12290;&#31532;&#20108;&#27493;&#21435;&#37325; &#27604;&#36739;&#20869;&#23481;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">id(self) 2237306535424
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">id(other) 2237308499152
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{tom at 2237306535424}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">id(self) 2237306535424
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">id(other) 2237308499152
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">True</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"{} at {}"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.name, <span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__hash__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> 1

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__eq__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"id(self)"</span>, <span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"id(other)"</span>, <span style="color: #483d8b;">id</span>(other))
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.name == other.name

<span style="color: #a0522d;">a1</span> = A(<span style="color: #8b2252;">'tom'</span>)
<span style="color: #a0522d;">a2</span> = A(<span style="color: #8b2252;">'tom'</span>)
<span style="color: #a0522d;">s</span> = {a1, a2}  <span style="color: #b22222;">#</span><span style="color: #b22222;">hash&#22320;&#22336;&#30456;&#21516;&#65292;hash&#20540;&#30456;&#21516;&#65292;hash&#20914;&#31361;&#65307;&#36824;&#35201;&#30475;&#20869;&#23481;&#26159;&#21542;&#30456;&#21516;
</span>              <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#20215;&#20110; a1.__eq__(a2) True
</span><span style="color: #483d8b;">print</span>(s) <span style="color: #b22222;">#</span><span style="color: #b22222;">??? {tom at 2306495249920}
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
<span style="color: #483d8b;">print</span>(a1 == a2) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#20215;&#20110; a1.__eq__(a2) True
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">set&#21435;&#37325;&#21407;&#29702;&#65292;&#31532;&#19968;&#27493;&#24517;&#39035;&#27714;hash&#65292;hash&#20914;&#31361;&#25165;&#38656;&#35201;&#21435;&#37325;&#12290;&#31532;&#20108;&#27493;&#21435;&#37325; &#27604;&#36739;&#20869;&#23481;
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~'</span> * 30)
<span style="color: #a0522d;">jerry</span> = A(<span style="color: #8b2252;">'jerry'</span>)
<span style="color: #a0522d;">s</span> = {a1, a2, jerry}
<span style="color: #483d8b;">print</span>(s)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">id(self) 2306495249920
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">id(other) 2306496492432
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{tom at 2306495249920}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">id(self) 2306495249920
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">id(other) 2306496492432
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">True
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">id(self) 2306495249920
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">id(other) 2306496492432
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">id(self) 2306495249920
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">id(other) 2306496492752
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{tom at 2306495249920, jerry at 2306496492752}</span>
</pre>
</div>

<pre class="example" id="orgbdfc61f">
__eq__
对应==操作符，判断2个对象是否相等，返回bool值
定义了这个方法，如果不提供__hash__方法，那么实例将不可hash
</pre>

<p>
<code>__hash__</code> 方法只是返回一个 hash 值作为 set 的 key，但是去重，还需要 <code>__eq__</code> 来判断 2 个对象是否相等
</p>

<p>
hash 值相等，只是 hash 冲突，并不能说明两个对象是相等的
</p>

<p>
因此，一般来说提供 <code>__hash__</code> 方法是为了作为set或者dict的key，如果去重要同时提供__eq__方法
</p>

<p>
去重需要提供__eq__方法
</p>

<p>
思考：
</p>
<ul class="org-ul">
<li>list类实例为什么不可hash？
<ul class="org-ul">
<li>源码中有一句__hash__ = None，也就是如果调用__hash__()相当于None()，一定报错</li>
<li>所有类都继承object，而这个类是具有__hash__()方法的，如果一个类不能被hash，就把__hash__设置为None</li>
</ul></li>

<li>functolls.lru_chche使用到的functools.HashedSwq类继承自list，为什么可hash?
<ul class="org-ul">
<li>_HashedSeq类提供了__hash__方法，这个方法实际上计算的是元组的hahs值</li>
</ul></li>
</ul>


<p>
练习
</p>
<ul class="org-ul">
<li>设计二维坐标类Point，使其成为可hash类型，并比较2个坐标的实例是否相等</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x, y):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">y</span> = y

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__hash__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">hash</span>((<span style="color: #a020f0;">self</span>.x,<span style="color: #a020f0;">self</span>.y))

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__eq__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.x == other.x <span style="color: #a020f0;">and</span> <span style="color: #a020f0;">self</span>.y == other.y

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&lt;Point ({}:{})&gt; id:{}"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.x, <span style="color: #a020f0;">self</span>.y, <span style="color: #483d8b;">hex</span>(<span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>)))

<span style="color: #a0522d;">p1</span> = Point(4, 5)
<span style="color: #a0522d;">p2</span> = Point(4, 5)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">hash</span>(p1)) <span style="color: #b22222;"># </span><span style="color: #b22222;">-1009709641759730766
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">hash</span>(p2)) <span style="color: #b22222;"># </span><span style="color: #b22222;">-1009709641759730766
</span>
<span style="color: #483d8b;">print</span>(p1 <span style="color: #a020f0;">is</span> p2) <span style="color: #b22222;"># </span><span style="color: #b22222;">False
</span><span style="color: #483d8b;">print</span>(p1 == p2) <span style="color: #b22222;"># </span><span style="color: #b22222;">True
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">hex</span>(<span style="color: #483d8b;">id</span>(p1)),<span style="color: #483d8b;">hex</span>(<span style="color: #483d8b;">id</span>(p2))) <span style="color: #b22222;"># </span><span style="color: #b22222;">0x1ad611b7cb0 0x1ad61427610
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">set</span>((p1, p2))) <span style="color: #b22222;">#</span><span style="color: #b22222;">{&lt;Point (4:5)&gt; id:0x1ad611b7cb0}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:f9835ac4-09e7-484f-af10-910a7fff9d69" class="outline-4">
<h4 id="h:f9835ac4-09e7-484f-af10-910a7fff9d69">bool <code>__bool__</code></h4>
<div class="outline-text-4" id="text-h:f9835ac4-09e7-484f-af10-910a7fff9d69">
<pre class="example" id="orgff5d0d5">
__bool__
内建函数bool()，或者对象放在逻辑表达式的位置，调用这个函数返回布尔值
没有定义__bool__()，就找__len__()返回长度，非0为真
如果__len__()没有定义，那么所有实例都返回真
</pre>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:<span style="color: #a020f0;">pass</span>

<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">bool</span>(A())) <span style="color: #b22222;"># </span><span style="color: #b22222;">True
</span>
<span style="color: #a020f0;">if</span> A():
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Real A'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">Real A
</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__bool__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">False</span>

<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">bool</span>(B)) <span style="color: #b22222;"># </span><span style="color: #b22222;">True
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">bool</span>(B())) <span style="color: #b22222;"># </span><span style="color: #b22222;">False
</span><span style="color: #a020f0;">if</span> B():
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Real B'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">C</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__len__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> 0

<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">bool</span>(C())) <span style="color: #b22222;"># </span><span style="color: #b22222;">False
</span><span style="color: #a020f0;">if</span> C():
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Real C'</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:83758ac3-caa2-48a0-8dae-ee43ec535ea9" class="outline-4">
<h4 id="h:83758ac3-caa2-48a0-8dae-ee43ec535ea9">运算符重载</h4>
<div class="outline-text-4" id="text-h:83758ac3-caa2-48a0-8dae-ee43ec535ea9">
<p>
operator模块提供以下的特殊方法，可以将类的实例使用下面的操作符来操作
</p>

<pre class="example" id="orgb1cdb39">
1.比较运算符
&lt;,&lt;=,==,&gt;,&gt;=,!=

__lt__,__le__,__eq__, __gt__,__ge__,__ne__


2.算数运算符，移位、位运算也有对应的方法

+, -, *, /, %, //, **, divmod  

__add__,__sub__,__mul__,__truediv__,__mod__,__floordiv__,__pow__,__divmod__


3.in-place 就地修改
+=, -=,*=,/=,%=,//=,**=

__iadd__,__isub__,__imul__, __itruediv__,__impd__,__ifloordiv__,__ipow__
</pre>

<p>
范例：实现Person类的2个实例相减
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age=18):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__sub__</span>(<span style="color: #a020f0;">self</span>, other): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21452;&#30446;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.age - other.age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__isub__</span>(<span style="color: #a020f0;">self</span>, other): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#27809;&#26377;&#23450;&#20041;__isub__&#65292;&#21017;&#20250;&#35843;&#29992;__sub__
</span>        <span style="color: #a020f0;">return</span> Person(<span style="color: #a020f0;">self</span>.name, <span style="color: #a020f0;">self</span>.age - other.age) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#19968;&#20010;&#20840;&#26032;&#30340;&#23454;&#20363;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&lt;Person {} {}&gt;"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.name, <span style="color: #a020f0;">self</span>.age)

<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'tom'</span>, 20)
<span style="color: #a0522d;">jerry</span> = Person(<span style="color: #8b2252;">'jerry'</span>)

<span style="color: #483d8b;">print</span>(tom - jerry) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20250;&#36716;&#21270;&#25104; tom.__sub__(jerry) -&gt; 2
</span><span style="color: #483d8b;">print</span>(tom, jerry) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;Person tom 20&gt; &lt;Person jerry 18&gt;
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)

<span style="color: #a0522d;">tom</span> -= jerry <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;__isub__&#26041;&#27861;&#65292;tom = tom.__isub__(jerry)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#27809;&#26377;__isub__&#26041;&#27861;&#65292;&#35843;&#29992;__sub__&#26041;&#27861; tom = tom - jerry =&gt; tom = tom.__sub__(jerry)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(tom, type(tom)) #2 &lt;class 'int'&gt;
</span><span style="color: #483d8b;">print</span>(tom, <span style="color: #483d8b;">type</span>(tom)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;Person tom 2&gt; &lt;class '__main__.Person'&gt;</span>
</pre>
</div>

<ul class="org-ul">
<li>__isub__方法定义，一般会in-place就地来修改自身</li>
<li>如果没有定义__isub__方法，则会调用__sub__</li>
</ul>

<p>
练习
</p>
<pre class="example" id="org569b32b">
完成Point类设计，实现判断点相等的方法，并完成向量的加法

在直角坐标系里，定义原点为向量的起点。两个向量和与差的坐标分别等于这两个向量相应坐标的和与差。

若向量的表示为(x,y)形式，
A(X1,Y1) B(X2,Y2) , 则A+B=（X1+X2, Y1+Y2), A-B= (X1-X2, Y1-Y2)
</pre>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x, y):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">y</span> = y

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__eq__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.x == other.x <span style="color: #a020f0;">and</span> <span style="color: #a020f0;">self</span>.y == other.y

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__add__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #a020f0;">return</span> Point(<span style="color: #a020f0;">self</span>.x + other.x, <span style="color: #a020f0;">self</span>.y + other.y)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__iadd__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> += other.x
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">y</span> += other.y
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(<span style="color: #a020f0;">self</span>,other):
        <span style="color: #a020f0;">return</span> (<span style="color: #a020f0;">self</span>.x + other.x, <span style="color: #a020f0;">self</span>.y + other.y)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return self + other
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;Point: {},{}&gt; {}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.x, <span style="color: #a020f0;">self</span>.y, <span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #a0522d;">p1</span> = Point(4,5)
<span style="color: #a0522d;">p2</span> = Point(4,5)
<span style="color: #483d8b;">print</span>(p1, p2) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;Point: 4,5&gt; 2663588724224 &lt;Point: 4,5&gt; 2663590688272
</span>
<span style="color: #483d8b;">print</span>(p1.add(p2)) <span style="color: #b22222;">#</span><span style="color: #b22222;">(8, 10)
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992;&#36816;&#31639;&#31526;&#37325;&#36733;&#65292;&#26356;&#20687;&#26159;&#22312;&#20889;&#25968;&#23398;&#20844;&#24335;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">+ &#36820;&#22238;&#19968;&#20010;&#20840;&#26032;&#30340;&#22352;&#26631;&#23545;&#35937;
</span><span style="color: #483d8b;">print</span>(p1 + p2) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;Point: 8,10&gt; 2663590688592
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">+= &#23601;&#22320;&#20462;&#25913;
</span><span style="color: #a0522d;">p1</span> += p2
<span style="color: #483d8b;">print</span>(p1, p2) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;Point: 8,10&gt; 2663588724224 &lt;Point: 4,5&gt; 2663590688272</span>
</pre>
</div>
</div>
<div id="outline-container-h:7fe046f3-b68f-4862-b104-456fccb1c6e3" class="outline-5">
<h5 id="h:7fe046f3-b68f-4862-b104-456fccb1c6e3">运算符重载应用场景</h5>
<div class="outline-text-5" id="text-h:7fe046f3-b68f-4862-b104-456fccb1c6e3">
<p>
往往是用面向对象实现的类，需要做大量的运算，而运算符是这种运算在数学上
最常见的表达方式。例如，上例中的对+进行了运算符重载，实现了Point类的二
元操作，重新定义为Point + Point
</p>

<p>
提供运算符重载，比直接提供加法方法要更加合适该领域内使用者的习惯
</p>

<p>
int类，几乎实现了所有操作符，可以作为参考
</p>
</div>
</div>
<div id="outline-container-h:86e9e1e2-f2c2-496a-b517-11ba14241149" class="outline-5">
<h5 id="h:86e9e1e2-f2c2-496a-b517-11ba14241149">@functools.total_ordering 装饰器</h5>
<div class="outline-text-5" id="text-h:86e9e1e2-f2c2-496a-b517-11ba14241149">
<p>
<code>__lt__,__le__,__eq__,__gt__,__ge__</code> 是比较大小必须实现的方法，但是全部写完太麻烦，使用
@functools.total_ordering 装饰器就可以大小简化代码。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> functools

<span style="color: #228b22;">@functools.total_ordering</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__eq__</span>(<span style="color: #a020f0;">self</span>, other): <span style="color: #b22222;"># </span><span style="color: #b22222;">eq &#21644; ne &#24517;&#39035;&#25552;&#20379;&#19968;&#20010;&#31561;&#25110;&#32773;&#19981;&#31561;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.age == other.age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__gt__</span>(<span style="color: #a020f0;">self</span>, other): <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &#22823;&#20110;&#30693;&#36947;&#20102;&#65292; &lt; &#23567;&#20110;&#20250;&#34987;&#25512;&#23548;&#20986;&#26469;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.age &gt; other.age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__ge__</span>(<span style="color: #a020f0;">self</span>, other): <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;= &#22823;&#20110;&#31561;&#20110;&#30693;&#36947;&#20102;&#65292; =&lt; &#23567;&#20110;&#31561;&#20110;&#34987;&#33258;&#21160;&#25512;&#23548;&#20986;&#26469;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.age &gt;= other.age

<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'tom'</span>, 20)
<span style="color: #a0522d;">jack</span> = Person(<span style="color: #8b2252;">'jack'</span>, 16)

<span style="color: #483d8b;">print</span>(tom == jack) <span style="color: #b22222;"># </span><span style="color: #b22222;">False #&#22914;&#26524;&#27809;&#26377;eq&#65292;&#20250;&#29992;object&#31867;&#20013;&#25552;&#20379;&#30340;eq&#12290;
</span><span style="color: #483d8b;">print</span>(tom != jack) <span style="color: #b22222;"># </span><span style="color: #b22222;">True
</span>
<span style="color: #483d8b;">print</span>(tom &gt; jack) <span style="color: #b22222;"># </span><span style="color: #b22222;">True
</span><span style="color: #483d8b;">print</span>(tom &lt; jack) <span style="color: #b22222;"># </span><span style="color: #b22222;">False
</span>
<span style="color: #483d8b;">print</span>(tom &gt;= jack) <span style="color: #b22222;"># </span><span style="color: #b22222;">True
</span><span style="color: #483d8b;">print</span>(tom &lt;= jack) <span style="color: #b22222;"># </span><span style="color: #b22222;">False</span>
</pre>
</div>

<p>
上例中大小简化代码，但是一般来说比较实现等于或者小于方法也就够用了，其它可以不实现，所以这个
装饰器只是看着很美好，且可能会带来性能问题，建议需要什么方法就自己创建，少用装饰器。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, age):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__eq__</span>(<span style="color: #a020f0;">self</span>, other): <span style="color: #b22222;"># </span><span style="color: #b22222;">eq &#21644; ne &#24517;&#39035;&#25552;&#20379;&#19968;&#20010;&#31561;&#25110;&#32773;&#19981;&#31561;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.age == other.age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__gt__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.age &gt; other.age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__ge__</span>(<span style="color: #a020f0;">self</span>, other): 
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.age &gt;= other.age

<span style="color: #a0522d;">tom</span> = Person(<span style="color: #8b2252;">'tom'</span>, 20)
<span style="color: #a0522d;">jack</span> = Person(<span style="color: #8b2252;">'jack'</span>, 16)

<span style="color: #483d8b;">print</span>(tom == jack) <span style="color: #b22222;"># </span><span style="color: #b22222;">False #&#22914;&#26524;&#27809;&#26377;eq&#65292;&#20250;&#29992;object&#31867;&#20013;&#25552;&#20379;&#30340;eq&#12290;
</span><span style="color: #483d8b;">print</span>(tom != jack) <span style="color: #b22222;"># </span><span style="color: #b22222;">True
</span>
<span style="color: #483d8b;">print</span>(tom &gt; jack) <span style="color: #b22222;"># </span><span style="color: #b22222;">True
</span><span style="color: #483d8b;">print</span>(tom &lt; jack) <span style="color: #b22222;"># </span><span style="color: #b22222;">False
</span>
<span style="color: #483d8b;">print</span>(tom &gt;= jack) <span style="color: #b22222;"># </span><span style="color: #b22222;">True
</span><span style="color: #483d8b;">print</span>(tom &lt;= jack) <span style="color: #b22222;"># </span><span style="color: #b22222;">False</span>
</pre>
</div>

<pre class="example" id="orge0e4c3f">
__eq__等于可以推断不等于
__gt__大于可以推断小于
__ge__大于等于可以推断小于等于
也就是用这3个方法，就可以把所有比较解决了，所以total_ordering可以不使用。
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d1c6dd7c-9c01-4c92-aacd-ec90dcf29b2b" class="outline-4">
<h4 id="h:d1c6dd7c-9c01-4c92-aacd-ec90dcf29b2b">容器和大小 <code>__len__,__iter__,__contains__,__getitem__,__setitem__,__missing__</code></h4>
<div class="outline-text-4" id="text-h:d1c6dd7c-9c01-4c92-aacd-ec90dcf29b2b">
<pre class="example" id="orgca72339">
__len__
内建函数len()，返回对象的长度（&gt;=0的整数），如果把对象当做容器类型看，就如同list或者dict
bool()函数调用的时候，如果没有__bool()方法，则会看__len()__方法是否存在，存在返回非0为真

__iter__ 
迭代容器时，调用，返回一个新的迭代器对象

__contains__
in成员运算符，没有实现，就调用__iter__方法遍历

__getitem__
实现self[key]访问。序列对象，key接受整数位索引，或者切片
对于set和dict，key为hashable。key不存在引发KeyError异常

__setitem__
和__getitem__的访问类似，是设置值的方法

__missing__
字典或其子类使用__getitem__()调用时，key不存在执行该方法
</pre>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>(<span style="color: #483d8b;">dict</span>):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__missing__</span>(<span style="color: #a020f0;">self</span>, key):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Missing key :'</span>, key)
        <span style="color: #a020f0;">return</span> 0

<span style="color: #a0522d;">a</span> = A()
<span style="color: #483d8b;">print</span>(a[<span style="color: #8b2252;">'k'</span>])

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;
</span>Missing key : k
0
</pre>
</div>
</div>
<div id="outline-container-h:b459ab85-5593-4c20-a234-a886825df94e" class="outline-5">
<h5 id="h:b459ab85-5593-4c20-a234-a886825df94e">练习</h5>
<div class="outline-text-5" id="text-h:b459ab85-5593-4c20-a234-a886825df94e">
</div>
<div id="outline-container-h:cd8ffd0b-16ac-44bb-95ad-3e616909c4e5" class="outline-6">
<h6 id="h:cd8ffd0b-16ac-44bb-95ad-3e616909c4e5">购物车</h6>
<div class="outline-text-6" id="text-h:cd8ffd0b-16ac-44bb-95ad-3e616909c4e5">
<ul class="org-ul">
<li>将购物车类改造成方便操作的容器类</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Cart</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">items</span> = []

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__len__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">len</span>(<span style="color: #a020f0;">self</span>.items)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">additem</span>(<span style="color: #a020f0;">self</span>, item):
        <span style="color: #a020f0;">self</span>.items.append(item)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return self + item &#36816;&#29992;&#36816;&#31639;&#31526;&#30340;&#37325;&#36733;&#65292;&#20250;&#35843;&#29992;__add__&#26041;&#27861;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__iter__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">yield from self.items
</span>        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">iter</span>(<span style="color: #a020f0;">self</span>.items)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__getitem__</span>(<span style="color: #a020f0;">self</span>, index): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32034;&#24341;&#35775;&#38382;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.items[index]

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__setitem__</span>(<span style="color: #a020f0;">self</span>, key, value): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32034;&#24341;&#36171;&#20540;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">items</span>[key] = value

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__str__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">str</span>(<span style="color: #a020f0;">self</span>.items)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__add__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #a020f0;">self</span>.items.append(other)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>

<span style="color: #a0522d;">cart</span> = Cart()
cart.additem(1)
cart.additem(<span style="color: #8b2252;">'abc'</span>)
cart.additem(3)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#38271;&#24230;&#12289;bool
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">len</span>(cart)) <span style="color: #b22222;"># </span><span style="color: #b22222;">3
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">bool</span>(cart)) <span style="color: #b22222;"># </span><span style="color: #b22222;">True
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36845;&#20195;
</span><span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> cart:
    <span style="color: #483d8b;">print</span>(x) <span style="color: #b22222;"># </span><span style="color: #b22222;">1 abc 3
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">in
</span><span style="color: #483d8b;">print</span>(3 <span style="color: #a020f0;">in</span> cart) <span style="color: #b22222;">#</span><span style="color: #b22222;">True
</span><span style="color: #483d8b;">print</span>(2 <span style="color: #a020f0;">in</span> cart) <span style="color: #b22222;">#</span><span style="color: #b22222;">False
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#32034;&#24341;&#25805;&#20316;
</span><span style="color: #483d8b;">print</span>(cart[1]) <span style="color: #b22222;">#</span><span style="color: #b22222;">abc
</span><span style="color: #a0522d;">cart</span>[1] = <span style="color: #8b2252;">'xyz'</span>
<span style="color: #483d8b;">print</span>(cart) <span style="color: #b22222;"># </span><span style="color: #b22222;">[1, 'xyz', 3]
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#38142;&#24335;&#32534;&#31243;&#23454;&#29616;&#21152;&#27861;
</span><span style="color: #483d8b;">print</span>(cart.additem(1).additem(<span style="color: #8b2252;">'abc'</span>).additem(3)) <span style="color: #b22222;">#</span><span style="color: #b22222;">[1, 'xyz', 3, 1, 'abc', 3]
</span><span style="color: #483d8b;">print</span>(cart + 4 + 5 + 6) <span style="color: #b22222;"># </span><span style="color: #b22222;">[1, 'xyz', 3, 1, 'abc', 3, 4, 5, 6]
</span><span style="color: #483d8b;">print</span>(cart.__add__(17).__add__(18)) <span style="color: #b22222;"># </span><span style="color: #b22222;">[1, 'xyz', 3, 1, 'abc', 3, 4, 5, 6, 17, 18]</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:e322f45d-0e2d-46ce-bbb1-ec989c2a7798" class="outline-4">
<h4 id="h:e322f45d-0e2d-46ce-bbb1-ec989c2a7798">可调用对象 <code>__call__</code></h4>
<div class="outline-text-4" id="text-h:e322f45d-0e2d-46ce-bbb1-ec989c2a7798">
<p>
Python中一切皆对象，函数也不例外
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
    <span style="color: #483d8b;">print</span>(foo.<span style="color: #483d8b;">__module__</span>, foo.<span style="color: #483d8b;">__name__</span>)

foo() <span style="color: #b22222;"># </span><span style="color: #b22222;">__main__ foo
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#31561;&#20215;&#20110;
</span>foo.__call__() <span style="color: #b22222;"># </span><span style="color: #b22222;">__main__ foo</span>
</pre>
</div>

<ul class="org-ul">
<li>函数即对象，对象foo加上()，就是调用此函数对象的__call__()方法</li>
</ul>


<pre class="example" id="org7bfe9bd">
__call__    类中定义一个该方法，实例就可以像函数一样调用
</pre>

<p>
可调用对象，定义一个类，并实例化得到其实例，将实例像函数一样调用
</p>

<p>
范例
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__call__</span>(<span style="color: #a020f0;">self</span>, *args, **kwargs):
        <span style="color: #483d8b;">print</span>(args, kwargs)

<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">callable</span>(A())) <span style="color: #b22222;">#</span><span style="color: #b22222;">A&#30340;&#23454;&#20363;&#26159;&#21542;&#26159;&#21487;&#35843;&#29992;&#23545;&#35937; True
</span><span style="color: #a0522d;">a</span> = A()
a() <span style="color: #b22222;">#</span><span style="color: #b22222;">() {}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>:
    <span style="color: #a020f0;">pass</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">def __call__(self, *args, **kwargs):
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">print(args, kwargs)
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">callable</span>(B)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#26159;&#21542;&#26159;&#21487;&#35843;&#29992;&#23545;&#35937; True
</span><span style="color: #483d8b;">print</span>(B()) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;__main__.A object at 0x000001DF1FA87CB0&gt;</span>
</pre>
</div>

<p>
有哪些是可调用对象?
</p>
<ul class="org-ul">
<li>函数、方法，类，类的实例(如果实现了__call__的方法)</li>
<li>以上3种都可以使用装饰器，混合起来就很难看懂了。</li>
</ul>
</div>
<div id="outline-container-h:2e6d2024-3965-4bf3-96a5-5e0656d2622e" class="outline-5">
<h5 id="h:2e6d2024-3965-4bf3-96a5-5e0656d2622e">练习</h5>
<div class="outline-text-5" id="text-h:2e6d2024-3965-4bf3-96a5-5e0656d2622e">
</div>
<div id="outline-container-h:315fc945-db8a-4c57-bfb1-21a3e8c3335b" class="outline-6">
<h6 id="h:315fc945-db8a-4c57-bfb1-21a3e8c3335b">斐波那契数列</h6>
<div class="outline-text-6" id="text-h:315fc945-db8a-4c57-bfb1-21a3e8c3335b">
<ul class="org-ul">
<li>定义一个斐波那契数列的类，方便调用，计算第n项</li>
<li>增加迭代的方法、返回容器长度、支持索引的方法</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Fib</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">items</span> = [0, 1, 1]

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__call__</span>(<span style="color: #a020f0;">self</span>, index):
        <span style="color: #a020f0;">if</span> index &lt; 0:
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">IndexError</span>(<span style="color: #8b2252;">'Wrong Index'</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">if index &lt; len(self.items):
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">return self.items[index]
</span>
        <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(<span style="color: #483d8b;">len</span>(<span style="color: #a020f0;">self</span>.items), index+1):
            <span style="color: #a020f0;">self</span>.items.append(<span style="color: #a020f0;">self</span>.items[i-1] + <span style="color: #a020f0;">self</span>.items[i-2])
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.items[index]

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__str__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"{}"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.items)

    <span style="color: #a0522d;">__repr__</span> = __str__

<span style="color: #a0522d;">fib</span> = Fib()
<span style="color: #483d8b;">print</span>(fib(5)) <span style="color: #b22222;"># </span><span style="color: #b22222;">5
</span><span style="color: #483d8b;">print</span>(fib) <span style="color: #b22222;">#</span><span style="color: #b22222;">[0, 1, 1, 2, 3, 5]</span>
</pre>
</div>
<p>
在上例基础上，增加迭代的方法、返回容器长度、支持索引的方法
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Fib</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">items</span> = [0, 1, 1]

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__call__</span>(<span style="color: #a020f0;">self</span>, index):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>[index]

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__iter__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">iter</span>(<span style="color: #a020f0;">self</span>.items)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__len__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">len</span>(<span style="color: #a020f0;">self</span>.items)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__getitem__</span>(<span style="color: #a020f0;">self</span>, index):
        <span style="color: #a020f0;">if</span> index &lt; 0:
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">IndexError</span>(<span style="color: #8b2252;">'Wrong Index'</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">if index &lt; len(self.items):
</span>        <span style="color: #b22222;">#     </span><span style="color: #b22222;">return self.items[index]
</span>
        <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(<span style="color: #483d8b;">len</span>(<span style="color: #a020f0;">self</span>), index+1):
            <span style="color: #a020f0;">self</span>.items.append(<span style="color: #a020f0;">self</span>.items[i-1] + <span style="color: #a020f0;">self</span>.items[i-2])
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.items[index]

    <span style="color: #b22222;"># </span><span style="color: #b22222;">__call__ = __getitem__
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__str__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">str</span>(<span style="color: #a020f0;">self</span>.items)

    <span style="color: #a0522d;">__repr__</span> = __str__

<span style="color: #a0522d;">fib</span> = Fib()
<span style="color: #483d8b;">print</span>(fib(5), <span style="color: #483d8b;">len</span>(fib)) <span style="color: #b22222;"># </span><span style="color: #b22222;">5 6
</span><span style="color: #483d8b;">print</span>(fib(10), <span style="color: #483d8b;">len</span>(fib)) <span style="color: #b22222;"># </span><span style="color: #b22222;">55 11
</span><span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> fib:
    <span style="color: #483d8b;">print</span>(x)

<span style="color: #483d8b;">print</span>(fib[5], fib[6]) <span style="color: #b22222;"># </span><span style="color: #b22222;">5 8</span>
</pre>
</div>

<p>
可以看出使用类来实现斐波那契数列也是非常好的实现，还可以缓存数据，便于检索
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-h:bc01a1c5-761d-453f-9786-a2d60a9b8a81" class="outline-4">
<h4 id="h:bc01a1c5-761d-453f-9786-a2d60a9b8a81">上下文管理 <code>__enter__,__exit__</code></h4>
<div class="outline-text-4" id="text-h:bc01a1c5-761d-453f-9786-a2d60a9b8a81">
<p>
文件IO操作可以对文件对象使用上下文管理，使用with..
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">with</span> <span style="color: #483d8b;">open</span>(<span style="color: #8b2252;">'test'</span>) <span style="color: #a020f0;">as</span> f:
    <span style="color: #a020f0;">pass</span>
</pre>
</div>

<p>
仿照上例写一个自己的类，实现上下文管理
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>&#65306;
    <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">with</span> Point() <span style="color: #a020f0;">as</span> p: <span style="color: #b22222;"># </span><span style="color: #b22222;">AttributeError: __exit__
</span>    <span style="color: #a020f0;">pass</span>
</pre>
</div>

<p>
提示属性错误，没有__exit__，看了需要这个属性
某些版本会显示没有__enter__
</p>
</div>
<div id="outline-container-h:96aaa5bf-d020-4b9d-bbb7-9aa7ca793a5b" class="outline-5">
<h5 id="h:96aaa5bf-d020-4b9d-bbb7-9aa7ca793a5b">上下文管理对象</h5>
<div class="outline-text-5" id="text-h:96aaa5bf-d020-4b9d-bbb7-9aa7ca793a5b">
<p>
当一个对象同时实现了__enter()__和__exit__()方法，它就属于上下文管理的对象
</p>

<pre class="example" id="org8c36e8f">
__enter__   进入与此对象相关的上下文。如果存在该方法，with语法会把该方法的返回值作为绑定到as子句中指定的变量上
__exit__    退出与此对象相关的上下文
</pre>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>():
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init ========='</span>)
        time.sleep(1)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init over ====='</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__enter__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'enter ========'</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__exit__</span>(<span style="color: #a020f0;">self</span>, exc_type, exc_val, exc_tb):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'exit ========='</span>)

<span style="color: #a020f0;">with</span> Point() <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">p</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">p = Point().__enter__()
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'in with ========='</span>)
    time.sleep(2)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'with over ========'</span>)

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'======end======'</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init =========
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init over =====
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">enter ========
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">in with =========
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">with over ========
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">exit =========
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">======end======</span>
</pre>
</div>

<ul class="org-ul">
<li>实例化对象的时候，并不会调用enter，进入with语句块调用__enter__方法，然后执行语句体，最后离开with语句块的时候，调用__exit__方法</li>
<li>with可以开启一个上下文运行环境，在执行前做一些准备工作，执行后做一些首位工作。</li>
<li>注意，with并不开启一个新的作用域</li>
</ul>
</div>
</div>
<div id="outline-container-h:aa3005ca-2894-4625-9796-842ed9610c1a" class="outline-5">
<h5 id="h:aa3005ca-2894-4625-9796-842ed9610c1a">上下文管理的安全性</h5>
<div class="outline-text-5" id="text-h:aa3005ca-2894-4625-9796-842ed9610c1a">
<p>
异常对上下文的影响
</p>

<p>
虽然有异常弹出，但是enter和exit照样执行， <b>上下文管理是安全的</b>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>():
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init ========='</span>)
        time.sleep(1)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init over ====='</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__enter__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'enter ========'</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__exit__</span>(<span style="color: #a020f0;">self</span>, exc_type, exc_val, exc_tb):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'exit ========='</span>)

<span style="color: #a020f0;">with</span> Point() <span style="color: #a020f0;">as</span> p:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'in with ========='</span>)
    <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">Exception</span>(<span style="color: #8b2252;">'error'</span>)
    time.sleep(2)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'with over ========'</span>)

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'======end======'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36755;&#20986;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init =========
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init over =====
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">enter ========
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">in with =========
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">exit =========
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Traceback (most recent call last):
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">File "D:\project\pyproj\t1.py", line 17, in &lt;module&gt;
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">raise Exception('error')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Exception: error</span>
</pre>
</div>

<p>
极端的例子
</p>

<ul class="org-ul">
<li>调用sys.exit()，它会退出当前解释器</li>
<li>打开python解释器，在里面输入 sys.exit()，窗口直接关闭，也就是说碰到这一句，Python运行环境直接退出</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>():
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init ========='</span>)
        time.sleep(1)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init over ====='</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__enter__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'enter ========'</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__exit__</span>(<span style="color: #a020f0;">self</span>, exc_type, exc_val, exc_tb):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'exit ========='</span>)

<span style="color: #a020f0;">with</span> Point() <span style="color: #a020f0;">as</span> p:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'in with ========='</span>)
    <span style="color: #a020f0;">import</span> sys
    sys.<span style="color: #008b8b;">exit</span>(1)
    time.sleep(2)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'with over ========'</span>)

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'======end======'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init =========
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init over =====
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">enter ========
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">in with =========
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">exit =========</span>
</pre>
</div>

<ul class="org-ul">
<li>从执行结果来看，依然执行了__exit__函数，哪怕是退出Python运行环境</li>
<li>说明上下文管理很安全</li>
</ul>
</div>
</div>
<div id="outline-container-h:ef4fdd9f-5ed1-43ef-86ec-c72841412441" class="outline-5">
<h5 id="h:ef4fdd9f-5ed1-43ef-86ec-c72841412441">with语句</h5>
<div class="outline-text-5" id="text-h:ef4fdd9f-5ed1-43ef-86ec-c72841412441">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>():
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init'</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__enter__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'enter'</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__exit__</span>(<span style="color: #a020f0;">self</span>, exc_type, exc_val, exc_tb):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'exit'</span>)

<span style="color: #a0522d;">f</span> = <span style="color: #483d8b;">open</span>(<span style="color: #8b2252;">'t3.py'</span>)
<span style="color: #a020f0;">with</span> f <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">p</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#25991;&#20214;&#23545;&#35937;&#35843;&#29992;__enter__()   p = open('t3.py')
</span>    <span style="color: #483d8b;">print</span>(f)
    <span style="color: #483d8b;">print</span>(p)
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(f), <span style="color: #483d8b;">id</span>(p)) <span style="color: #b22222;">#</span><span style="color: #b22222;">2811630081568 2811630081568
</span>    <span style="color: #483d8b;">print</span>(1,f <span style="color: #a020f0;">is</span> p) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#20160;&#20040; True
</span>    <span style="color: #483d8b;">print</span>(2,f == p) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#20160;&#20040; True
</span>
<span style="color: #a0522d;">p</span> = Point()
<span style="color: #b22222;">#</span><span style="color: #b22222;">f = p.__enter__()
</span><span style="color: #a020f0;">with</span> p <span style="color: #a020f0;">as</span> f:  <span style="color: #b22222;">#</span><span style="color: #b22222;">with&#25805;&#20316;&#20250;&#35843;&#29992;&#23454;&#20363;&#30340;__enter__&#26041;&#27861;, as&#23376;&#21477;&#21518;&#30340;&#26631;&#35782;&#31526;&#20250;&#24471;&#21040; __enter__ &#36820;&#22238;&#20540;
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'in with-----'</span>)
    <span style="color: #483d8b;">print</span>(p) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;__main__.Point object at 0x000001E4AAD57CB0&gt;
</span>    <span style="color: #483d8b;">print</span>(f) <span style="color: #b22222;">#</span><span style="color: #b22222;">None
</span>    <span style="color: #483d8b;">print</span>(3,p <span style="color: #a020f0;">is</span> f, <span style="color: #8b2252;">'++++'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">False ++++
</span>    <span style="color: #483d8b;">print</span>(4,p == f) <span style="color: #b22222;"># </span><span style="color: #b22222;">__eq__ p.__eq__(f) -&gt; object.__eq__(self, other) &#36716;&#32780;&#35843;is&#26041;&#27861;
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'with over'</span>)

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'======end======'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;_io.TextIOWrapper name='t3.py' mode='r' encoding='cp936'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;_io.TextIOWrapper name='t3.py' mode='r' encoding='cp936'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1779374446112 1779374446112
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1 True
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2 True
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">enter
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">in with-----
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;__main__.Point object at 0x0000019E4ADA7CB0&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">None
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">3 False ++++
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">4 False
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">with over
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">exit
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">======end======</span>
</pre>
</div>

<p>
问题在于__enter__方法上，它将自己的返回值赋给f。修改上例
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>():
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init'</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__enter__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'enter'</span>)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22686;&#21152;&#36820;&#22238;&#20540;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__exit__</span>(<span style="color: #a020f0;">self</span>, exc_type, exc_val, exc_tb):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'exit'</span>)

<span style="color: #a0522d;">f</span> = <span style="color: #483d8b;">open</span>(<span style="color: #8b2252;">'t3.py'</span>)
<span style="color: #a020f0;">with</span> f <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">p</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#25991;&#20214;&#23545;&#35937;&#35843;&#29992;__enter__()   p = open('t3.py')
</span>    <span style="color: #483d8b;">print</span>(f)
    <span style="color: #483d8b;">print</span>(p)
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(f), <span style="color: #483d8b;">id</span>(p)) <span style="color: #b22222;">#</span><span style="color: #b22222;">2811630081568 2811630081568
</span>    <span style="color: #483d8b;">print</span>(1,f <span style="color: #a020f0;">is</span> p) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#20160;&#20040; True
</span>    <span style="color: #483d8b;">print</span>(2,f == p) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#20160;&#20040; True
</span>
<span style="color: #a0522d;">p</span> = Point()
<span style="color: #b22222;">#</span><span style="color: #b22222;">f = p.__enter__()  f = p
</span><span style="color: #a020f0;">with</span> p <span style="color: #a020f0;">as</span> f:  <span style="color: #b22222;">#</span><span style="color: #b22222;">with&#25805;&#20316;&#20250;&#35843;&#29992;&#23454;&#20363;&#30340;__enter__&#26041;&#27861;, as&#23376;&#21477;&#21518;&#30340;&#26631;&#35782;&#31526;&#20250;&#24471;&#21040; __enter__ &#36820;&#22238;&#20540;
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'in with-----'</span>)
    <span style="color: #483d8b;">print</span>(p) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;__main__.Point object at 0x000001E4AAD57CB0&gt;
</span>    <span style="color: #483d8b;">print</span>(f) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;__main__.Point object at 0x0000016C32497CB0&gt;
</span>    <span style="color: #483d8b;">print</span>(3,p <span style="color: #a020f0;">is</span> f, <span style="color: #8b2252;">'++++'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">True ++++
</span>    <span style="color: #483d8b;">print</span>(4,p == f) <span style="color: #b22222;"># </span><span style="color: #b22222;">__eq__ p.__eq__(f) -&gt; object.__eq__(self, other) &#36716;&#32780;&#35843;is&#26041;&#27861;
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'with over'</span>)

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'======end======'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;_io.TextIOWrapper name='t3.py' mode='r' encoding='cp936'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;_io.TextIOWrapper name='t3.py' mode='r' encoding='cp936'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1564213859872 1564213859872
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1 True
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2 True
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">enter
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">in with-----
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;__main__.Point object at 0x0000016C32497CB0&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;__main__.Point object at 0x0000016C32497CB0&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">3 True ++++
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">4 True
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">with over
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">exit
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">======end======</span>
</pre>
</div>

<p>
with语句，会调用with后的对象的__enter__方法，如果有as，则将该方法的返回值赋给as子句的变量
</p>

<p>
上例，可以等价为f = p.__enter__()
</p>
</div>
</div>
<div id="outline-container-h:8abc83a4-0e02-49dc-80e7-3bb86058b8a0" class="outline-5">
<h5 id="h:8abc83a4-0e02-49dc-80e7-3bb86058b8a0">方法的参数</h5>
<div class="outline-text-5" id="text-h:8abc83a4-0e02-49dc-80e7-3bb86058b8a0">
<p>
__enter__方法 没有其他参数
</p>

<p>
__exit__方法有3个参数
</p>

<p>
__exit__(self, exc_type, exc_value, traceback)
</p>

<p>
这三个参数都与异常有关。
</p>

<p>
如果该上下文退出时没有异常，这3个参数都为None
</p>

<p>
如果有异常，参数意义如下：
</p>
<ul class="org-ul">
<li>exc_type，异常类型</li>
<li>exc_value，异常的值</li>
<li>traceback，异常的追踪信息</li>
</ul>

<p>
__exit__方法返回一个等效True的值，则压制异常；否则，继续抛出异常
</p>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>():
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init'</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__enter__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'enter'</span>)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22686;&#21152;&#36820;&#22238;&#20540;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__exit__</span>(<span style="color: #a020f0;">self</span>, exc_type, exc_val, exc_tb):
        <span style="color: #483d8b;">print</span>(1, exc_type)
        <span style="color: #483d8b;">print</span>(2, exc_val)
        <span style="color: #483d8b;">print</span>(3, exc_tb)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'exit'</span>)
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'abc'</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">eixt&#30340;&#36820;&#22238;&#20540;&#31561;&#25928;&#20026;True&#65292;&#23558;&#21387;&#21046;&#25253;&#38169;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">return None # 0 # []  &#31561;&#25928;&#20026;False&#65292;&#26080;&#27861;&#25318;&#25130;&#24322;&#24120;
</span>
<span style="color: #a0522d;">p</span> = Point()
<span style="color: #a020f0;">with</span> p <span style="color: #a020f0;">as</span> f:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'in with-----'</span>)
    <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">Exception</span>(<span style="color: #8b2252;">'Error'</span>)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'with over'</span>)

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'======end======'</span>)


<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">enter
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">in with-----
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1 &lt;class 'Exception'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2 Error
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">3 &lt;traceback object at 0x000001F47A7E7B40&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">exit
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">======end======</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:555884c8-e4de-4caa-b4ea-aee6e709023f" class="outline-5">
<h5 id="h:555884c8-e4de-4caa-b4ea-aee6e709023f">练习</h5>
<div class="outline-text-5" id="text-h:555884c8-e4de-4caa-b4ea-aee6e709023f">
<p>
为加法函数计时
</p>

<ul class="org-ul">
<li>方法1、使用装饰器显示该函数的执行市场</li>
<li>方法2、使用上下文管理方法来显示该函数的执行时长</li>
</ul>


<p>
装饰器实现
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35013;&#39280;&#22120;&#23454;&#29616;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">timeit</span>(fn):
    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #a0522d;">start</span> = datetime.datetime.now()
        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
        <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{} took {}s. ~~~~"</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, delta))
        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@timeit</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
    time.sleep(2)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
add(4, 5)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">add took 2.000634s. ~~~~</span>
</pre>
</div>

<p>
上下文实现
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35013;&#39280;&#22120;&#23454;&#29616;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">timeit</span>(fn):
    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #a0522d;">start</span> = datetime.datetime.now()
        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
        <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{} took {}s. ~~~~"</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, delta))
        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@timeit</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
    time.sleep(2)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #b22222;"># </span><span style="color: #b22222;">add(4, 5)
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">add took 2.000634s. ~~~~
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#19978;&#19979;&#25991;&#31649;&#29702;&#23454;&#29616;&#20026;&#21152;&#27861;&#20989;&#25968;&#35745;&#26102;
</span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Timeit</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, fn):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">fn</span> = fn

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__enter__</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24320;&#22987;&#35745;&#26102;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">start</span> = datetime.datetime.now()
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.fn

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__exit__</span>(<span style="color: #a020f0;">self</span>, exc_type, exc_val, exc_tb): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35745;&#31639;&#24046;&#20540;
</span>        <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - <span style="color: #a020f0;">self</span>.start).total_seconds()
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{} took {}s. ++++"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.fn.<span style="color: #483d8b;">__name__</span>, delta))

<span style="color: #a020f0;">with</span> Timeit(add) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">f</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">f = Timeit().__enter__()
</span>    add(4, 5)
    f(4, 5)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">add took 2.000524s. ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">add took 2.000139s. ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">add took 4.000771s. ++++</span>
</pre>
</div>

<p>
可调用对象实现
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35013;&#39280;&#22120;&#23454;&#29616;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">timeit</span>(fn):
    <span style="color: #228b22;">@wraps</span>(fn)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args, **kwargs):
        <span style="color: #a0522d;">start</span> = datetime.datetime.now()
        <span style="color: #a0522d;">ret</span> = fn(*args, **kwargs)
        <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{} took {}s. ~~~~"</span>.<span style="color: #483d8b;">format</span>(fn.<span style="color: #483d8b;">__name__</span>, delta))
        <span style="color: #a020f0;">return</span> ret
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@timeit</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
    time.sleep(2)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #b22222;"># </span><span style="color: #b22222;">add(4, 5)
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#35843;&#29992;&#23545;&#35937;&#23454;&#29616;&#20026;&#21152;&#27861;&#20989;&#25968;&#35745;&#26102;
</span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Timeit</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, fn):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__fn</span> = fn

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__enter__</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24320;&#22987;&#35745;&#26102;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">start</span> = datetime.datetime.now()
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return self.fn
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__exit__</span>(<span style="color: #a020f0;">self</span>, exc_type, exc_val, exc_tb): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35745;&#31639;&#24046;&#20540;
</span>        <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - <span style="color: #a020f0;">self</span>.start).total_seconds()
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{} took {}s. ++++"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.__fn.<span style="color: #483d8b;">__name__</span>, delta))

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__call__</span>(<span style="color: #a020f0;">self</span>, *args, **kwargs):
        <span style="color: #a0522d;">ret</span> = <span style="color: #a020f0;">self</span>.__fn(*args, **kwargs)
        <span style="color: #a020f0;">return</span> ret

<span style="color: #a020f0;">with</span> Timeit(add) <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">f</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">f = Timeit().__enter__()
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">add(4, 5)
</span>    f(4, 5)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">add took 2.000402s. ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">add took 2.000492s. ++++</span>
</pre>
</div>


<p>
类当装饰器使用
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> datetime

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#24403;&#35013;&#39280;&#22120;&#20351;&#29992;
</span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Timeit</span>:
    <span style="color: #8b2252;">"""Timeit class doc"""</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, fn):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__fn</span> = fn

<span style="color: #228b22;">@Timeit</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#20215;&#24335; add = Timeit(add)
</span>    <span style="color: #8b2252;">"""add function doc"""</span>
    time.sleep(2)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #483d8b;">print</span>(add.<span style="color: #483d8b;">__doc__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">Timeit class doc &#25991;&#26723;&#19981;&#23545;&#65292;&#24590;&#20040;&#25913;
</span><span style="color: #483d8b;">print</span>(add.<span style="color: #483d8b;">__name__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21517;&#23383;&#65311; &#25253;&#38169;</span>
</pre>
</div>

<p>
解决文档字符串的问题
</p>

<p>
方法1-直接修改__doc__
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TimeIt</span>:
  <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, fn=<span style="color: #008b8b;">None</span>):
    <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__fn</span> = fn
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25226;&#20989;&#25968;&#23545;&#35937;&#30340;&#25991;&#26723;&#23383;&#31526;&#20018;&#36171;&#32473;&#31867;
</span>    <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">__doc__</span> = fn.__foc__
    <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__name</span> = <span style="color: #a020f0;">self</span>.__fn.<span style="color: #483d8b;">__name__</span>
</pre>
</div>

<p>
方法2-使用functools.wraps函数
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#24403;&#35013;&#39280;&#22120;&#20351;&#29992;
</span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Timeit</span>:
    <span style="color: #8b2252;">"""Timeit class doc"""</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, fn):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__fn</span> = fn
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25226;&#20989;&#25968;&#23545;&#35937;&#30340;&#25991;&#26723;&#23383;&#31526;&#20018;&#36171;&#32473;&#31867;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">self.__doc__ = fn.__doc__
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">self.__name__ = fn.__name__
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">update_wrapper(self, fn)
</span>        wraps(fn)(<span style="color: #a020f0;">self</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__enter__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">start</span> = datetime.datetime.now()
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__fn

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__exit__</span>(<span style="color: #a020f0;">self</span>, exc_type, exc_val, exc_tb):
        <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - <span style="color: #a020f0;">self</span>.start).total_seconds()
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{} took {}s"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.__fn.<span style="color: #483d8b;">__name__</span>, delta))

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__call__</span>(<span style="color: #a020f0;">self</span>, *args, **kwargs):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">start</span> = datetime.datetime.now()
        <span style="color: #a0522d;">ret</span> = <span style="color: #a020f0;">self</span>.__fn(*args, **kwargs)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - <span style="color: #a020f0;">self</span>.start).total_seconds()
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Timeis call. {}'s result={}, delta={}"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.__fn.<span style="color: #483d8b;">__name__</span>, ret,<span style="color: #a020f0;">self</span>.delta))
        <span style="color: #a020f0;">return</span> ret

<span style="color: #228b22;">@Timeit</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#20215;&#24335; add = Timeit(add)
</span>    <span style="color: #8b2252;">"""add function doc"""</span>
    time.sleep(2)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #483d8b;">print</span>(add.<span style="color: #483d8b;">__doc__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25991;&#26723;&#19981;&#23545;&#65292;&#24590;&#20040;&#25913; Timeit obj.__doc__
</span><span style="color: #483d8b;">print</span>(add.<span style="color: #483d8b;">__name__</span>) 
<span style="color: #483d8b;">print</span>(add(4,5))


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">add function doc
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">add
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Timeis call. add's result=9, delta=2.000169
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">9</span>
</pre>
</div>


<p>
上面的类即可以用在上下文管理，又可以用作装饰器
</p>
</div>
</div>
<div id="outline-container-h:acd886fc-46b0-4736-b8d8-5c84ac20bb1b" class="outline-5">
<h5 id="h:acd886fc-46b0-4736-b8d8-5c84ac20bb1b">上下文应用场景</h5>
<div class="outline-text-5" id="text-h:acd886fc-46b0-4736-b8d8-5c84ac20bb1b">
<ul class="org-ul">
<li><p>
增强功能
</p>

<p>
在代码执行的前后增加代码，以增强其功能。类似装饰器的功能
</p></li>

<li><p>
资源管理
</p>

<p>
打开了资源需要关闭，例如文件对象、网络连接、数据库连接等
</p></li>

<li><p>
权限验证
</p>

<p>
在执行代码之前，做权限的验证，在__enter__中处理
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:01c08cd7-2455-42b2-8d05-32657e66015b" class="outline-5">
<h5 id="h:01c08cd7-2455-42b2-8d05-32657e66015b">contextlib.contexmangager</h5>
<div class="outline-text-5" id="text-h:01c08cd7-2455-42b2-8d05-32657e66015b">
<p>
它是一个装饰器实现上下文管理，装饰一个 <b>函数</b> ，而不用像类一样实现__enter__和__exit__方法
</p>

<ul class="org-ul">
<li>对下面的函数有要求，必须有yield，也就是这个函数必须返回一个生成器，且只有yield一个值</li>
<li>这个装饰器接受一个生成器对象作为参数</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> contextlib <span style="color: #a020f0;">import</span> contextmanager

<span style="color: #228b22;">@contextmanager</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'enter ~~~~'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30456;&#24403;&#20110;__enter__()
</span>    <span style="color: #a020f0;">yield</span>  <span style="color: #b22222;"># </span><span style="color: #b22222;">yield 5, yield&#30340;&#20540;&#21482;&#33021;&#26377;&#19968;&#20010;&#65292;&#20316;&#20026;__enter__&#26041;&#27861;&#30340;&#36820;&#22238;&#20540;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">yield [1,2]
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'exit ~~~~'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30456;&#24403;&#20110; __exit__()
</span>
<span style="color: #483d8b;">print</span>(foo()) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;contextlib._GeneratorContextManager object at 0x000001DED1617CB0&gt;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#26377;&#29992;with&#35821;&#27861;&#25165;&#33021;&#36215;&#20316;&#29992;
</span><span style="color: #a020f0;">with</span> foo() <span style="color: #a020f0;">as</span> <span style="color: #a0522d;">f</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">f = yield&#20540;
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'with ~~~~'</span>)
    <span style="color: #483d8b;">print</span>(f)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;contextlib._GeneratorContextManager object at 0x000001E2C04D7CB0&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">enter ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">with ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">None
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">exit ~~~~</span>
</pre>
</div>

<p>
<b>as后的f接受yield语句的返回值</b>
</p>

<ul class="org-ul">
<li>上面程序如果打开 raise Exception()语句，则print('exit')不会执行</li>
<li>解决办法：增加try finally</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> contextlib <span style="color: #a020f0;">import</span> contextmanager

<span style="color: #228b22;">@contextmanager</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'enter ~~~~'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30456;&#24403;&#20110;__enter__()
</span>    <span style="color: #a020f0;">try</span>:
        <span style="color: #a020f0;">yield</span>  <span style="color: #b22222;"># </span><span style="color: #b22222;">yield 5, yield&#30340;&#20540;&#21482;&#33021;&#26377;&#19968;&#20010;&#65292;&#20316;&#20026;__enter__&#26041;&#27861;&#30340;&#36820;&#22238;&#20540;
</span>    <span style="color: #a020f0;">finally</span>:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'exit ~~~~'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30456;&#24403;&#20110; __exit__()
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#26377;&#29992;with&#35821;&#27861;&#25165;&#33021;&#36215;&#20316;&#29992;
</span><span style="color: #a020f0;">with</span> foo() <span style="color: #a020f0;">as</span> f:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'with start ~~~~'</span>)
    1/0
    <span style="color: #b22222;"># </span><span style="color: #b22222;">raise Exception()
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'with end ~~~~'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">enter ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">with start ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">exit ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Traceback (most recent call last):
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">File "D:\project\pyproj\t1.py", line 14, in &lt;module&gt;
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">1/0
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">~^~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">ZeroDivisionError: division by zero</span>
</pre>
</div>

<p>
上例当yield发生处为生成器函数增加了上下文管理。这就是为函数增加上下文机制的方式
</p>

<ul class="org-ul">
<li>把yield之前的当做__enter__方法执行</li>
<li>把yield之后的当做__exit__方法执行</li>
<li>把yield的值作为__enter__的返回值</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">from</span> contextlib <span style="color: #a020f0;">import</span> contextmanager

<span style="color: #228b22;">@contextmanager</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">timeit</span>():
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'enter ~~~~'</span>)
    <span style="color: #a0522d;">start</span> = datetime.datetime.now()
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a020f0;">yield</span>  <span style="color: #b22222;"># </span><span style="color: #b22222;">yield 5, yield&#30340;&#20540;&#21482;&#33021;&#26377;&#19968;&#20010;&#65292;&#20316;&#20026;__enter__&#26041;&#27861;&#30340;&#36820;&#22238;&#20540;
</span>    <span style="color: #a020f0;">finally</span>:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'exit ~~~~'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30456;&#24403;&#20110; __exit__()
</span>        <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'timeit delta = {}s'</span>.<span style="color: #483d8b;">format</span>(delta))

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
    <span style="color: #8b2252;">"""add function doc"""</span>
    time.sleep(2)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #a020f0;">with</span> timeit() <span style="color: #a020f0;">as</span> f:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'with start ~~~~'</span>)
    add(4, 5)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'with end ~~~~'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">enter ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">with start ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">with end ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">exit ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">timeit delta = 2.000897s</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">from</span> contextlib <span style="color: #a020f0;">import</span> contextmanager

<span style="color: #228b22;">@contextmanager</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">timeit</span>(fn):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'enter ~~~~'</span>)
    <span style="color: #a0522d;">start</span> = datetime.datetime.now()
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a020f0;">yield</span> fn <span style="color: #b22222;"># </span><span style="color: #b22222;">yield 5, yield&#30340;&#20540;&#21482;&#33021;&#26377;&#19968;&#20010;&#65292;&#20316;&#20026;__enter__&#26041;&#27861;&#30340;&#36820;&#22238;&#20540;
</span>    <span style="color: #a020f0;">finally</span>:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'exit ~~~~'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30456;&#24403;&#20110; __exit__()
</span>        <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'timeit delta = {}s'</span>.<span style="color: #483d8b;">format</span>(delta))

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
    <span style="color: #8b2252;">"""add function doc"""</span>
    time.sleep(2)
    <span style="color: #a020f0;">return</span> x + y

<span style="color: #a020f0;">with</span> timeit(add) <span style="color: #a020f0;">as</span> f:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'with start ~~~~'</span>)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">add(4, 5)
</span>    f(4, 5)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'with end ~~~~'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">enter ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">with start ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">with end ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">exit ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">timeit delta = 2.00045s</span>
</pre>
</div>

<p>
总结
</p>

<p>
如果业务逻辑加单可以使用函数加contextlib.contextmanager装饰器方式，如果业务复杂，用类的方式加__enter__和__exit__方法方便
</p>
</div>
</div>
</div>
<div id="outline-container-h:ff203385-1da7-4098-8da6-36430273b00b" class="outline-4">
<h4 id="h:ff203385-1da7-4098-8da6-36430273b00b">反射</h4>
<div class="outline-text-4" id="text-h:ff203385-1da7-4098-8da6-36430273b00b">
</div>
<div id="outline-container-h:26c87685-f43f-4a4f-8f4d-0056d147e807" class="outline-5">
<h5 id="h:26c87685-f43f-4a4f-8f4d-0056d147e807">概述</h5>
<div class="outline-text-5" id="text-h:26c87685-f43f-4a4f-8f4d-0056d147e807">
<p>
运行时，区别于编译时，指的是程序被加载到内存中执行的时候
</p>

<p>
反射，reflection，指的是运行时获取类型定义信息
</p>

<p>
一个对象能够在运行时，像照镜子一样，反射处其类型信息
</p>

<p>
简单说，在python中，能够通过一个对象，找出其type、class、attribute或method的能力，称为反射或者自省
</p>

<p>
具有反射能力的函数有type()、isinstance()、callable()、dir()、getattr()等
</p>
</div>
</div>
<div id="outline-container-h:89f56900-67df-4962-9ece-e1d0359adaff" class="outline-5">
<h5 id="h:89f56900-67df-4962-9ece-e1d0359adaff">反射相关的函数和方法</h5>
<div class="outline-text-5" id="text-h:89f56900-67df-4962-9ece-e1d0359adaff">
<p>
需求: 有一个Point类，查看它实例的属性，并修改它。动态为实例增加属性
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x, y):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">y</span> = y

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__str__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"Point({}, {})"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.x, <span style="color: #a020f0;">self</span>.y)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">show</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">self</span>.x, <span style="color: #a020f0;">self</span>.y)

<span style="color: #a0522d;">p</span> = Point(4, 5)
<span style="color: #483d8b;">print</span>(p) <span style="color: #b22222;"># </span><span style="color: #b22222;">Point(4, 5)
</span><span style="color: #483d8b;">print</span>(p.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">{'x': 4, 'y': 5}
</span>p.<span style="color: #483d8b;">__dict__</span>[<span style="color: #8b2252;">'y'</span>] = 16 <span style="color: #b22222;"># </span><span style="color: #b22222;">{'x': 4, 'y': 16}
</span><span style="color: #483d8b;">print</span>(p.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">{'x': 4, 'y': 16, 'z': 10}
</span>p.<span style="color: #a0522d;">z</span> = 10
<span style="color: #483d8b;">print</span>(p.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>(p)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#25490;&#24207;&#36807;&#30340;p&#30340;&#23646;&#24615;&#21015;&#34920; ordered list
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">sorted</span>(p.__dir__())) <span style="color: #b22222;">#</span><span style="color: #b22222;">list</span>
</pre>
</div>

<p>
上例通过属性字典__dict__来访问对象的属性，本质上也是利用的反射的能力。
</p>


<p>
但是，上面的例子中，访问的访问不优雅，Python提供了内置的函数
</p>

<p>
<b>内建函数</b>
</p>
<pre class="example" id="orgde92560">
getattr(object,name[,default])  通过name返回object的属性值。当属性不存在，将使用default返回，如果没有default，则抛出AttributeError。name必须为字符串

setattr(object,name,value)  object的属性存在，则覆盖，不存在，新增

hasattr(object,name)  判断对象是否有这个名字的属性，name必须为字符串
</pre>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x, y):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">y</span> = y

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">show</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&lt;Point {},{}&gt;"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.x, <span style="color: #a020f0;">self</span>.y)

    <span style="color: #a0522d;">__str__</span> = show

<span style="color: #a0522d;">p</span> = Point(4, 5)
<span style="color: #483d8b;">print</span>(p.x, p.y, p.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#26367;&#25442;&#20026;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">getattr</span>(p, <span style="color: #8b2252;">'x'</span>), <span style="color: #483d8b;">getattr</span>(p, <span style="color: #8b2252;">'y'</span>), <span style="color: #483d8b;">getattr</span>(p, <span style="color: #8b2252;">'__dict__'</span>))

p.<span style="color: #a0522d;">z</span> = 10
<span style="color: #483d8b;">print</span>(p.z)
<span style="color: #483d8b;">print</span>(p.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#26367;&#25442;&#20026;
</span><span style="color: #483d8b;">setattr</span>(p, <span style="color: #8b2252;">'z'</span>, 10)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">getattr</span>(p, <span style="color: #8b2252;">'z'</span>))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">getattr</span>(p, <span style="color: #8b2252;">'__dict__'</span>))


p.<span style="color: #483d8b;">__dict__</span>[<span style="color: #8b2252;">'y'</span>] = 100
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#26367;&#25442;&#20026;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">getattr(p, '__dict__')['y'] = 100
</span><span style="color: #483d8b;">setattr</span>(p, <span style="color: #8b2252;">'y'</span>, 200)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21160;&#24577;&#35843;&#29992;&#26041;&#27861;
</span><span style="color: #a020f0;">if</span> <span style="color: #483d8b;">hasattr</span>(p, <span style="color: #8b2252;">'show'</span>):
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">getattr</span>(p, <span style="color: #8b2252;">'show'</span>)()) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;Point 4,200&gt;
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21160;&#24577;&#22686;&#21152;&#26041;&#27861;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#20026;&#31867;&#22686;&#21152;&#26041;&#27861;
</span><span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> <span style="color: #483d8b;">hasattr</span>(Point, <span style="color: #8b2252;">'add'</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#23646;&#24615;, &#21160;&#24577;&#22686;&#21152;&#31867;&#23646;&#24615;&#65292;&#20351;&#29992;.&#36816;&#31639;&#31526;&#25110;&#32773;getattr&#36890;&#36807;&#31867;&#30340;&#23454;&#20363;&#35775;&#38382;&#65292;&#37117;&#21487;&#20197;&#26377;&#32465;&#23450;&#25928;&#26524;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">Point.add = lambda self, other: Point(self.x + other.y, self.x + other.y)
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#26367;&#25442;&#20026;
</span>    <span style="color: #483d8b;">setattr</span>(Point, <span style="color: #8b2252;">'add'</span>, <span style="color: #a020f0;">lambda</span> <span style="color: #a020f0;">self</span>, other: Point(<span style="color: #a020f0;">self</span>.x + other.x, <span style="color: #a020f0;">self</span>.y + other.y))

<span style="color: #a0522d;">p2</span> = Point(10, 10)
<span style="color: #483d8b;">print</span>(p.add(p2).show())  <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;Point 14,210&gt;
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20026;&#23454;&#20363;&#22686;&#21152;&#26041;&#27861;&#65292;&#26410;&#32465;&#23450;
</span><span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> <span style="color: #483d8b;">hasattr</span>(p, <span style="color: #8b2252;">'sub'</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#36807;&#23454;&#20363;&#23646;&#24615;&#35843;&#29992;&#35813;&#26041;&#27861;&#65292;&#27809;&#26377;&#32465;&#23450;&#25928;&#26524;
</span>    <span style="color: #483d8b;">setattr</span>(p, <span style="color: #8b2252;">'sub'</span>, <span style="color: #a020f0;">lambda</span> <span style="color: #a020f0;">self</span>, other: Point(<span style="color: #a020f0;">self</span>.x - other.x, <span style="color: #a020f0;">self</span>.y - other.y))
<span style="color: #483d8b;">print</span>(p.sub(p, p2))
<span style="color: #483d8b;">print</span>(p.sub) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;function &lt;lambda&gt; at 0x00000121BB3D8CC0&gt;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">4 5 {'x': 4, 'y': 5}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">4 5 {'x': 4, 'y': 5}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">10
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'x': 4, 'y': 5, 'z': 10}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">10
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'x': 4, 'y': 5, 'z': 10}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;Point 4,200&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;Point 14,210&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;Point -6,190&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;function &lt;lambda&gt; at 0x00000121BB3D8CC0&gt;</span>
</pre>
</div>

<p>
思考
</p>
<ul class="org-ul">
<li><p>
这种动态增加属性的方式和装饰器修饰一个类、Mixin方式的差异?
</p>

<p>
这种动态增删属性的方式是运行时改变类或者实例的方式，但是装饰器或Mixin都是定义时就决定了，因此反射能力具有更大的灵活性
</p></li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20266;&#20195;&#30721;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">decr</span>(cls):
    cls.<span style="color: #a0522d;">prop</span> = <span style="color: #8b2252;">'abc'</span>
    <span style="color: #a020f0;">return</span> cls
<span style="color: #228b22;">@decr</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23450;&#20041;&#26102;
</span>    <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Minxin</span>:
    <span style="color: #a020f0;">pass</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20889;&#28151;&#21512;&#21151;&#33021;
</span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>(Minxin, A): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23450;&#20041;&#26102;
</span>    <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
    <span style="color: #a0522d;">propname</span> = <span style="color: #483d8b;">input</span>(<span style="color: #8b2252;">'&gt;&gt;&gt;'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36816;&#34892;&#26102;
</span>    <span style="color: #a0522d;">value</span> = <span style="color: #483d8b;">input</span>(<span style="color: #8b2252;">'&gt;&gt;&gt;'</span>)
    <span style="color: #a0522d;">typ</span> = <span style="color: #483d8b;">input</span>(<span style="color: #8b2252;">'&gt;&gt;&gt;'</span>) @<span style="color: #8b2252;">'int'</span> -&gt; <span style="color: #483d8b;">int</span>
    <span style="color: #483d8b;">setattr</span>(B, propname, typ(value)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36816;&#34892;&#26102;&#25105;&#20204;&#21487;&#20197;&#21160;&#24577;&#25913;&#21464;&#19968;&#20010;&#31867;&#12290;&#28789;&#27963;</span>
</pre>
</div>

<p>
学完以上就可以阅读 <code>from functools import update_wrapper</code> 的源代码了。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">WRAPPER_ASSIGNMENTS</span> = (<span style="color: #8b2252;">'__module__'</span>, <span style="color: #8b2252;">'__name__'</span>, <span style="color: #8b2252;">'__qualname__'</span>, <span style="color: #8b2252;">'__doc__'</span>,
                       <span style="color: #8b2252;">'__annotations__'</span>, <span style="color: #8b2252;">'__type_params__'</span>)
<span style="color: #a0522d;">WRAPPER_UPDATES</span> = (<span style="color: #8b2252;">'__dict__'</span>,)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">update_wrapper</span>(wrapper,
                   wrapped,
                   assigned = WRAPPER_ASSIGNMENTS,
                   updated = WRAPPER_UPDATES):
    <span style="color: #8b2252;">"""Update a wrapper function to look like the wrapped function

       wrapper is the function to be updated
       wrapped is the original function
       assigned is a tuple naming the attributes assigned directly
       from the wrapped function to the wrapper function (defaults to
       functools.WRAPPER_ASSIGNMENTS)
       updated is a tuple naming the attributes of the wrapper that
       are updated with the corresponding attribute from the wrapped
       function (defaults to functools.WRAPPER_UPDATES)
    """</span>
    <span style="color: #a020f0;">for</span> attr <span style="color: #a020f0;">in</span> assigned:
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a0522d;">value</span> = <span style="color: #483d8b;">getattr</span>(wrapped, attr)
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">AttributeError</span>:
            <span style="color: #a020f0;">pass</span>
        <span style="color: #a020f0;">else</span>:
            <span style="color: #483d8b;">setattr</span>(wrapper, attr, value)
    <span style="color: #a020f0;">for</span> attr <span style="color: #a020f0;">in</span> updated:
        <span style="color: #483d8b;">getattr</span>(wrapper, attr).update(<span style="color: #483d8b;">getattr</span>(wrapped, attr, {}))
    <span style="color: #b22222;"># </span><span style="color: #b22222;">Issue #17482: set __wrapped__ last so we don't inadvertently copy it
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">from the wrapped function when updating __dict__
</span>    wrapper.<span style="color: #a0522d;">__wrapped__</span> = wrapped
    <span style="color: #b22222;"># </span><span style="color: #b22222;">Return the wrapper so this can be used as a decorator via partial()
</span>    <span style="color: #a020f0;">return</span> wrapper
</pre>
</div>
</div>
</div>
<div id="outline-container-h:56726efd-cd04-4468-af2b-709d0b8ced3a" class="outline-5">
<h5 id="h:56726efd-cd04-4468-af2b-709d0b8ced3a">反射相关的魔术方法 <code>__getattr__(),__setattr__(),__delatrr__()</code></h5>
<div class="outline-text-5" id="text-h:56726efd-cd04-4468-af2b-709d0b8ced3a">
<p>
__getattr__()、__setattrr__()、__delattr__()
</p>
</div>
<div id="outline-container-h:334b61b5-847d-4603-a913-3573cec39d84" class="outline-6">
<h6 id="h:334b61b5-847d-4603-a913-3573cec39d84">__getattr__()</h6>
<div class="outline-text-6" id="text-h:334b61b5-847d-4603-a913-3573cec39d84">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Base</span>:
    <span style="color: #a0522d;">n</span> = 77

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>(Base):
    <span style="color: #a0522d;">z</span> = 66

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x, y):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">y</span> = y

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">show</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">self</span>.x, <span style="color: #a020f0;">self</span>.y)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__getattr__</span>(<span style="color: #a020f0;">self</span>, item):
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#20102;&#36825;&#20010;&#26041;&#27861;&#65292;&#19981;&#26159;&#36890;&#36807;&#23454;&#20363;&#35775;&#38382;&#23646;&#24615;&#23601;&#35843;&#29992;&#30340;&#65292;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32780;&#26159;&#36890;&#36807;&#23454;&#20363;&#35775;&#38382;&#24341;&#21457;AttribueError,&#22914;&#26524;&#26377;&#27492;&#39764;&#26415;&#26041;&#27861;&#65292;&#21017;&#35843;&#29992;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(item)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23646;&#24615;&#21517;&#31216;&#23383;&#31526;&#20018;&#65292;&#21453;&#23556;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"missing ~~~~ {}"</span>.<span style="color: #483d8b;">format</span>(item)  <span style="color: #b22222;"># </span><span style="color: #b22222;">item&#20160;&#20040;&#31867;&#22411;&#65311; str
</span>
<span style="color: #a0522d;">p1</span> = Point(4,5)
<span style="color: #483d8b;">print</span>(Point.n, Point.z) <span style="color: #b22222;">#</span><span style="color: #b22222;">77 66
</span><span style="color: #483d8b;">print</span>(p1.x) <span style="color: #b22222;"># </span><span style="color: #b22222;">4
</span><span style="color: #483d8b;">print</span>(p1.z) <span style="color: #b22222;"># </span><span style="color: #b22222;">66
</span><span style="color: #483d8b;">print</span>(p1.n) <span style="color: #b22222;"># </span><span style="color: #b22222;">77
</span><span style="color: #483d8b;">print</span>(p1.y) <span style="color: #b22222;"># </span><span style="color: #b22222;">5
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(p1.item) #&#22914;&#26524;&#27809;&#26377;__getattr__&#65292;&#23646;&#24615;&#30340;&#25628;&#32034;&#39034;&#24207;&#20013;&#25214;&#19981;&#21040;&#65292;&#23601;&#25253;AttributeError
</span><span style="color: #483d8b;">print</span>(p1.item) <span style="color: #b22222;">#</span><span style="color: #b22222;">missing ~~~~ item
</span><span style="color: #483d8b;">print</span>(p1.xyz) <span style="color: #b22222;">#</span><span style="color: #b22222;">missing ~~~~ xyz</span>
</pre>
</div>

<p>
实例属性会按照继承关系找，如果找不到，就会执行__getattr__()方法，如果没有这个方法，就会抛出AttrbuteError异常表示找不到属性
</p>

<p>
查找属性的顺序：
</p>

<ul class="org-ul">
<li>instance.__dict__ &#x2013;&gt; instance.__class__.__dict__ &#x2013;&gt; 继承的祖先类(直到object)的__dict &#x2013;&gt; 找不到调用__getattr__() &#x2013;&gt; 其他补充</li>
</ul>
</div>
</div>
<div id="outline-container-h:b1451d06-028d-4c87-aad5-22d1454f4d38" class="outline-6">
<h6 id="h:b1451d06-028d-4c87-aad5-22d1454f4d38">__setattrr__()</h6>
<div class="outline-text-6" id="text-h:b1451d06-028d-4c87-aad5-22d1454f4d38">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Base</span>:
    <span style="color: #a0522d;">n</span> = 77

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>(Base):
    <span style="color: #a0522d;">z</span> = 66

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x, y):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init start ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#23454;&#20363;&#36171;&#20540;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">y</span> = y
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init end ~~~~'</span>)

    <span style="color: #b22222;"># </span><span style="color: #b22222;">def __getattr__(self, item): #&#36890;&#36807;&#23454;&#20363;&#25214;&#19981;&#21040;&#23646;&#24615;&#25253;AttributeError&#65292;&#21017;&#36827;&#20837;&#36825;&#20010;&#26041;&#27861;
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">pass
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__setattr__</span>(<span style="color: #a020f0;">self</span>, key, value): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#35201;&#26159;&#23454;&#20363;&#30340;&#23646;&#24615;&#36171;&#20540;&#23601;&#35843;&#29992;&#23427;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'setattr ~~~'</span>, key)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">super().__setattr__(key, value)
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">__dict__</span>[key] = value


<span style="color: #a0522d;">p1</span> = Point(4,5)
<span style="color: #483d8b;">print</span>(p1.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;__setattr__&#26041;&#27861;&#20869;&#23481;&#20026; pass&#65292; &#21017;&#23454;&#20363;&#27809;&#26377;&#23646;&#24615;&#20102; &#65371;&#65373;
</span><span style="color: #483d8b;">print</span>(1, p1.x) <span style="color: #b22222;"># </span><span style="color: #b22222;">4
</span><span style="color: #483d8b;">print</span>(2, p1.y) <span style="color: #b22222;"># </span><span style="color: #b22222;">5
</span><span style="color: #483d8b;">print</span>(3, p1.z) <span style="color: #b22222;"># </span><span style="color: #b22222;">66
</span><span style="color: #483d8b;">print</span>(4, p1.n) <span style="color: #b22222;"># </span><span style="color: #b22222;">77
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(5, p1.xyz) #&#25214;&#19981;&#21040;&#23646;&#24615;&#25253;AttributeError&#65292;&#36827;&#34892;&#20837;__getattr__&#26041;&#27861;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init start ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">setattr ~~~ x
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">setattr ~~~ y
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init end ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'x': 4, 'y': 5}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1 4
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2 5
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">3 66
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">4 77</span>
</pre>
</div>

<p>
实例通过.点号设置属性，例如self.x = x属性赋值，就会调用__setattr__()，属性要加到实例的__dict__中，就需要自己完成
</p>


<p>
<span class="underline"><span class="underline">setattr__()方法，可以拦截对实例属性的增加、修改操作，如果要设置生效，需要自己操作实例的__dict</span></span>
</p>


<p>
范例： __getattr__和__setattr__综合使用
</p>

<p>
将字典换掉
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Base</span>:
    <span style="color: #a0522d;">n</span> = 77

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>(Base):
    <span style="color: #a0522d;">z</span> = 66
    <span style="color: #a0522d;">d</span> = {}
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x, y):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init start ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#23454;&#20363;&#36171;&#20540;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">self.y = y
</span>        <span style="color: #483d8b;">setattr</span>(<span style="color: #a020f0;">self</span>, <span style="color: #8b2252;">'y'</span>, y) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#25928; self.y = y
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">__dict__</span>[<span style="color: #8b2252;">'a'</span>] = <span style="color: #8b2252;">'aaa'</span>
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init end ~~~~'</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__getattr__</span>(<span style="color: #a020f0;">self</span>, key): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#36807;&#23454;&#20363;&#25214;&#19981;&#21040;&#23646;&#24615;&#25253;AttributeError&#65292;&#21017;&#36827;&#20837;&#36825;&#20010;&#26041;&#27861;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'missing prop = {}'</span>.<span style="color: #483d8b;">format</span>(key))
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.d[key]

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__setattr__</span>(<span style="color: #a020f0;">self</span>, key, value): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#35201;&#26159;&#23454;&#20363;&#30340;&#23646;&#24615;&#36171;&#20540;&#23601;&#35843;&#29992;&#23427;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'setattr ~~~'</span>, key)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">super().__setattr__(key, value)
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">self.__dict__[key] = value
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">d</span>[key] = value

<span style="color: #a0522d;">p1</span> = Point(4,5)
<span style="color: #483d8b;">print</span>(1, p1.x) <span style="color: #b22222;"># </span><span style="color: #b22222;">1 4
</span><span style="color: #483d8b;">print</span>(2, p1.y) <span style="color: #b22222;"># </span><span style="color: #b22222;">2 5
</span><span style="color: #483d8b;">print</span>(3, p1.a) <span style="color: #b22222;"># </span><span style="color: #b22222;">3 aaa
</span><span style="color: #483d8b;">print</span>(4, p1.n) <span style="color: #b22222;"># </span><span style="color: #b22222;">4 77
</span><span style="color: #483d8b;">print</span>(p1.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #483d8b;">print</span>(Point.<span style="color: #483d8b;">__dict__</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init start ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">setattr ~~~ x
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">setattr ~~~ y
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init end ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">missing prop = x
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1 4
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">missing prop = y
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2 5
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">3 aaa
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">4 77
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'a': 'aaa'}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'__module__': '__main__', '__firstlineno__': 4, 'z': 66, 'd': {'x': 4, 'y': 5}, '__init__': &lt;function Point.__init__ at 0x0000018C9E3C4680&gt;, '__getattr__': &lt;function Point.__getattr__ at 0x0000018C9E3C4D60&gt;, '__setattr__': &lt;function Point.__setattr__ at 0x0000018C9E5271A0&gt;, '__static_attributes__': ('x',), '__doc__': None}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:1f1e39de-b8ac-49eb-ae49-026eb3251a71" class="outline-6">
<h6 id="h:1f1e39de-b8ac-49eb-ae49-026eb3251a71">__delattr__()</h6>
<div class="outline-text-6" id="text-h:1f1e39de-b8ac-49eb-ae49-026eb3251a71">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Base</span>:
    <span style="color: #a0522d;">n</span> = 77

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>(Base):
    <span style="color: #a0522d;">z</span> = 66
    <span style="color: #a0522d;">d</span> = {}
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x, y):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init start ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#23454;&#20363;&#36171;&#20540;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">self.y = y
</span>        <span style="color: #483d8b;">setattr</span>(<span style="color: #a020f0;">self</span>, <span style="color: #8b2252;">'y'</span>, y) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#25928; self.y = y
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">__dict__</span>[<span style="color: #8b2252;">'a'</span>] = <span style="color: #8b2252;">'aaa'</span>
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init end ~~~~'</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__getattr__</span>(<span style="color: #a020f0;">self</span>, key): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#36807;&#23454;&#20363;&#25214;&#19981;&#21040;&#23646;&#24615;&#25253;AttributeError&#65292;&#21017;&#36827;&#20837;&#36825;&#20010;&#26041;&#27861;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'missing prop = {}'</span>.<span style="color: #483d8b;">format</span>(key))
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.d[key]

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__setattr__</span>(<span style="color: #a020f0;">self</span>, key, value): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#35201;&#26159;&#23454;&#20363;&#30340;&#23646;&#24615;&#36171;&#20540;&#23601;&#35843;&#29992;&#23427;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'setattr ~~~'</span>, key)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">super().__setattr__(key, value)
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">self.__dict__[key] = value
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">d</span>[key] = value

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__delattr__</span>(<span style="color: #a020f0;">self</span>, item): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#36807;&#23454;&#20363;&#21024;&#38500;&#23646;&#24615;&#65292;&#36827;&#20837;&#36825;&#20010;&#26041;&#27861;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'cannot del {}'</span>.<span style="color: #483d8b;">format</span>(item))

<span style="color: #a0522d;">p1</span> = Point(4,5)
<span style="color: #483d8b;">print</span>(Point.<span style="color: #483d8b;">__dict__</span>.keys())
<span style="color: #b22222;"># </span><span style="color: #b22222;">del Point.z
</span><span style="color: #a020f0;">del</span> p1.abc
<span style="color: #a020f0;">del</span> p1.x
<span style="color: #a020f0;">del</span> p1.z
<span style="color: #483d8b;">print</span>(Point.<span style="color: #483d8b;">__dict__</span>.keys())


<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init start ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">setattr ~~~ x
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">setattr ~~~ y
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init end ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">dict_keys(['__module__', '__firstlineno__', 'z', 'd', '__init__', '__getattr__', '__setattr__', '__delattr__', '__static_attributes__', '__doc__'])
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">cannot del abc
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">cannot del x
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">cannot del z
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">dict_keys(['__module__', '__firstlineno__', 'z', 'd', '__init__', '__getattr__', '__setattr__', '__delattr__', '__static_attributes__', '__doc__'])</span>
</pre>
</div>

<p>
可以阻止通过实例来删除属性的操作。但是通过类依然可以删除属性
</p>
</div>
</div>
<div id="outline-container-h:c55185a9-49ed-47e9-94b0-52508ab613ee" class="outline-6">
<h6 id="h:c55185a9-49ed-47e9-94b0-52508ab613ee">__getattribute__()</h6>
<div class="outline-text-6" id="text-h:c55185a9-49ed-47e9-94b0-52508ab613ee">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Base</span>:
    <span style="color: #a0522d;">n</span> = 77

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>(Base):
    <span style="color: #a0522d;">z</span> = 66
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x, y):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init start ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#23454;&#20363;&#36171;&#20540;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">y</span> = y
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init end ~~~~'</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__getattr__</span>(<span style="color: #a020f0;">self</span>, key): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#36807;&#23454;&#20363;&#25214;&#19981;&#21040;&#23646;&#24615;&#25253;AttributeError&#65292;&#21017;&#36827;&#20837;&#36825;&#20010;&#26041;&#27861;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'missing prop = {}'</span>.<span style="color: #483d8b;">format</span>(key))

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__setattr__</span>(<span style="color: #a020f0;">self</span>, key, value):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'setattr ++++'</span>)
        <span style="color: #483d8b;">super</span>().__setattr__(key, value)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__getattribute__</span>(<span style="color: #a020f0;">self</span>, item):
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25214;&#23646;&#24615;&#37117;&#36827;&#20837;&#36825;&#20010;&#26041;&#27861;, &#25130;&#32993;&#20102;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#20010;&#39764;&#26415;&#26041;&#27861;&#65292;&#19968;&#33324;&#19981;&#29992;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#20889;&#20102;&#65292;&#19968;&#23450;&#26159;&#36890;&#36807;&#23454;&#20363;&#35775;&#38382;&#23646;&#24615;&#30340;&#31532;&#19968;&#31449;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'*** {} ***'</span>.<span style="color: #483d8b;">format</span>(item))

<span style="color: #a0522d;">p1</span> = Point(4,5)
<span style="color: #483d8b;">print</span>(1, p1.x)
<span style="color: #483d8b;">print</span>(2, p1.y)
<span style="color: #483d8b;">print</span>(3, p1.z)
<span style="color: #483d8b;">print</span>(Point.z, Point.n)
<span style="color: #483d8b;">print</span>(4, p1.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">4 None
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">object</span>.__getattribute__(p1, <span style="color: #8b2252;">'__dict__'</span>)) <span style="color: #b22222;">#</span><span style="color: #b22222;">{'x': 4, 'y': 5}
</span>


<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init start ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">setattr ++++
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">setattr ++++
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init end ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">*** x ***
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1 None
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">*** y ***
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2 None
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">*** z ***
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">3 None
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">66 77
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">*** __dict__ ***
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">4 None
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'x': 4, 'y': 5}</span>
</pre>
</div>

<p>
实例的所有的属性访问，第一个都会调用__getattribute__方法，它阻止了属性的查找，该方法应该返回（计算后的）值或者抛出一个AttributeError异常
</p>

<ul class="org-ul">
<li>它的return值将作为属性查找的结果</li>
<li>如果抛出AttributeError异常，则会直接调用__getattr__方法，表示属性没有找到</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Base</span>:
    <span style="color: #a0522d;">n</span> = 77

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Point</span>(Base):
    <span style="color: #a0522d;">z</span> = 66
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x, y):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init start ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#23454;&#20363;&#36171;&#20540;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">y</span> = y
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'init end ~~~~'</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__getattr__</span>(<span style="color: #a020f0;">self</span>, key): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#36807;&#23454;&#20363;&#25214;&#19981;&#21040;&#23646;&#24615;&#25253;AttributeError&#65292;&#21017;&#36827;&#20837;&#36825;&#20010;&#26041;&#27861;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'missing prop = {}'</span>.<span style="color: #483d8b;">format</span>(key))

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__getattribute__</span>(<span style="color: #a020f0;">self</span>, item):
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25214;&#23646;&#24615;&#37117;&#36827;&#20837;&#36825;&#20010;&#26041;&#27861;, &#25130;&#32993;&#20102;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#20010;&#39764;&#26415;&#26041;&#27861;&#65292;&#19968;&#33324;&#19981;&#29992;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#20889;&#20102;&#65292;&#19968;&#23450;&#26159;&#36890;&#36807;&#23454;&#20363;&#35775;&#38382;&#23646;&#24615;&#30340;&#31532;&#19968;&#31449;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'*** {} ***'</span>.<span style="color: #483d8b;">format</span>(item))
        <span style="color: #b22222;"># </span><span style="color: #b22222;">raise AttributeError('&#25214;&#19981;&#21040;&#20102;') #&#26377;__getattr__&#23601;&#35843;&#29992;&#65292;&#27809;&#26377;&#25243;&#24322;&#24120;AttributeError
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">return self.__dict__[item] # &#36882;&#24402;&#25253;&#38169; RecursionError
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">return object.__getattribute__(self, item) #&#40664;&#35748;&#26041;&#24335;&#65292;&#23646;&#24615;&#25628;&#32034;&#26041;&#24335;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">super</span>().__getattribute__(item)

<span style="color: #a0522d;">p1</span> = Point(4,5)
<span style="color: #483d8b;">print</span>(1, p1.x)
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(2, p1.y)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(3, p1.z)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(Point.z, Point.n)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(4, p1.__dict__) #4 None
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(object.__getattribute__(p1, '__dict__')) #{'x': 4, 'y': 5}
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init start ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">init end ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">*** x ***
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1 4</span>
</pre>
</div>

<p>
__getattribute__方法中为了避免在该方法中无限的递归，它的实现应该永远调用基类的同名方法打以访问需要的任何属性，例如object.__getattribute__(self, item)
</p>

<p>
除非明确地知道__getattribute__方法用来做什么，否则不要使用它
</p>


<p>
<b>总结</b>
</p>

<pre class="example" id="orgdc43ac0">
魔术方法  意义
__getattr__() 当通过搜索实例、实例的类及祖先类查不到属性，就会调用此方法
__setattr__() 通过.点访问实例属性，进行增加、修改都要调用它
__delattr__() 当通过实例来删除属性时调用此方法
__getattribute__()  实例所有的属性调用都从这个方法开始


属性查找顺序：
实例调用__getattribute__() --&gt; instance.__dict__ --&gt; instance.__class__.__dict__ --&gt; 继承的祖先类(直到object)的__dict__–&gt;调用__getattr__()
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:e39f5ecc-4ea9-4231-83a1-b7e80d9c36cd" class="outline-4">
<h4 id="h:e39f5ecc-4ea9-4231-83a1-b7e80d9c36cd">描述器 <code>__get__(),__set__(),__delete__()</code></h4>
<div class="outline-text-4" id="text-h:e39f5ecc-4ea9-4231-83a1-b7e80d9c36cd">
</div>
<div id="outline-container-h:10ef9aa7-2f8e-45cf-b5c7-d7210f719040" class="outline-5">
<h5 id="h:10ef9aa7-2f8e-45cf-b5c7-d7210f719040">描述器的表现</h5>
<div class="outline-text-5" id="text-h:10ef9aa7-2f8e-45cf-b5c7-d7210f719040">
<p>
用到的魔术方法：__get__()、__set__()、__delete__()
</p>

<p>
方法签名如下
</p>
<ul class="org-ul">
<li>object.__get__(self, instance, owner)</li>
<li>object.__set__(self, instance, owner)</li>
<li>object.__delete__(self, instance)</li>
<li>self值当前实例，调用者</li>
<li>instance是owner的实例</li>
<li>owner是属性的所属的类</li>
</ul>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A init ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">a1</span> = <span style="color: #8b2252;">'a1'</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>:
    <span style="color: #a0522d;">x</span> = A()
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'B init ~~~~'</span>)

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #483d8b;">print</span>(B.x)
<span style="color: #483d8b;">print</span>(B.x.a1)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A init ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;__main__.A object at 0x0000021BDA247CB0&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">a1</span>
</pre>
</div>

<p>
<code>__get__</code>
</p>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A init ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">a1</span> = <span style="color: #8b2252;">'a1'</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return self
</span>        <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>:
    <span style="color: #a0522d;">x</span> = A()
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'B init ~~~~'</span>)

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~'</span> * 30)
<span style="color: #a0522d;">a</span> = A()
<span style="color: #483d8b;">print</span>(a.a1)

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #483d8b;">print</span>(B.x) <span style="color: #b22222;">#</span><span style="color: #b22222;">A&#30340;&#23454;&#20363;, &#30456;&#24403;&#20110; B.x =&gt; A().__get__()
</span><span style="color: #483d8b;">print</span>(B.x.a1)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A init ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A init ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">a1
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">None
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Traceback (most recent call last):
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">File "D:\project\pyproj\t1.py", line 22, in &lt;module&gt;
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">print(B.x.a1)
</span><span style="color: #b22222;">#           </span><span style="color: #b22222;">^^^^^^
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">AttributeError: 'NoneType' object has no attribute 'a1'</span>
</pre>
</div>

<p>
因为定义了__get__方法，类A就是一个描述器，对类B或者类B的实例的x属性读取，成为对A的实例的访问，就会调用__get__方法
</p>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A init ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">a1</span> = <span style="color: #8b2252;">'a1'</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A.__get__ self:{} instance:{} owner:{}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>, instance, owner))
        <span style="color: #b22222;">#</span><span style="color: #b22222;">owner &#23646;&#20027;&#31867;&#65292; B
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;A instance {}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23646;&#20027;&#31867;
</span>    <span style="color: #a0522d;">x</span> = A() <span style="color: #b22222;">#</span><span style="color: #b22222;">A() &#25551;&#36848;&#22120;&#23454;&#20363;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'B init ~~~~'</span>)

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #483d8b;">print</span>(B.x) <span style="color: #b22222;">#</span><span style="color: #b22222;">A&#30340;&#23454;&#20363;, &#30456;&#24403;&#20110; B.x =&gt; A().__get__()
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(B.x.a1)
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A init ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A.__get__ self:&lt;A instance 1494204710064&gt; instance:None owner:&lt;class '__main__.B'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;A instance 1494204710064&gt;</span>
</pre>
</div>

<p>
<b>self、instance、owner三个参数的意思</b>
</p>
<ul class="org-ul">
<li>self 对应都是A的实例</li>
<li>owner 对应都是B类</li>
<li>instance 说明
<ul class="org-ul">
<li>None表示不是B类的实例</li>
</ul></li>
</ul>

<p>
使用返回值解决。返回self，就是A的实例，该实例有a1属性，返回正常
</p>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A init ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">a1</span> = <span style="color: #8b2252;">'a1'</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A.__get__ self:{} instance:{} owner:{}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>, instance, owner))
        <span style="color: #b22222;">#</span><span style="color: #b22222;">owner &#23646;&#20027;&#31867;&#65292; B
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;A instance {}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23646;&#20027;&#31867;
</span>    <span style="color: #a0522d;">x</span> = A() <span style="color: #b22222;">#</span><span style="color: #b22222;">A() &#25551;&#36848;&#22120;&#23454;&#20363;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35775;&#38382;B&#25110;&#32773;B&#23454;&#20363;&#23646;&#24615;&#21464;&#25104;&#19968;&#20010;&#20989;&#25968;&#35843;&#29992;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'B init ~~~~'</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;B id={}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #483d8b;">print</span>(B.x) <span style="color: #b22222;">#</span><span style="color: #b22222;">A&#30340;&#23454;&#20363;, &#30456;&#24403;&#20110; B.x =&gt; A().__get__()
</span><span style="color: #483d8b;">print</span>(B.x.a1)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)

<span style="color: #a0522d;">t</span> = B()
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(t))
<span style="color: #483d8b;">print</span>(t.x) <span style="color: #b22222;">#</span><span style="color: #b22222;">t.x -&gt; B.x -&gt; A().__get__()
</span><span style="color: #483d8b;">print</span>(t.x.a1)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A init ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A.__get__ self:&lt;A instance 1886684019888&gt; instance:None owner:&lt;class '__main__.B'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;A instance 1886684019888&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A.__get__ self:&lt;A instance 1886684019888&gt; instance:None owner:&lt;class '__main__.B'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">a1
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">B init ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1886684020224
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A.__get__ self:&lt;A instance 1886684019888&gt; instance:&lt;B id=1886684020224&gt; owner:&lt;class '__main__.B'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;A instance 1886684019888&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A.__get__ self:&lt;A instance 1886684019888&gt; instance:&lt;B id=1886684020224&gt; owner:&lt;class '__main__.B'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">a1</span>
</pre>
</div>

<p>
那么类B的实例属性也可以这样吗？
</p>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A init ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">a1</span> = <span style="color: #8b2252;">'a1'</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A.__get__ self:{} instance:{} owner:{}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>, instance, owner))
        <span style="color: #b22222;">#</span><span style="color: #b22222;">owner &#23646;&#20027;&#31867;&#65292; B
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;A instance {}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23646;&#20027;&#31867;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">x = A() #A() &#25551;&#36848;&#22120;&#23454;&#20363;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'B init ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">y</span> = A() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25551;&#36848;&#22120;&#19981;&#33021;&#29992;&#22312;&#23454;&#20363;&#23646;&#24615;&#19978;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;B id={}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #a0522d;">t</span> = B()
<span style="color: #483d8b;">print</span>(t.y)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">B init ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A init ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;A instance 2048168394240&gt;</span>
</pre>
</div>
<p>
从运行结果可以看出，只要 <b>类属性是类的实例</b> 才行
</p>
</div>
</div>
<div id="outline-container-h:3603593d-39e4-4b4b-b4f6-6eb682786b90" class="outline-5">
<h5 id="h:3603593d-39e4-4b4b-b4f6-6eb682786b90">描述器定义</h5>
<div class="outline-text-5" id="text-h:3603593d-39e4-4b4b-b4f6-6eb682786b90">
<p>
Python中，一个类实现了__get__、__set__、__delete__三个方法中的任何一个方法，就是描述器。实现三个中的某些方法，就支持了描述器协议
</p>

<ul class="org-ul">
<li>仅实现__get__，就是非数据描述符 non-data descriptor</li>
<li>实现了__get__和剩下两个任意一种，就是数据描述符 data descriptor</li>
</ul>

<p>
如果一个类的类属性设置为描述器实例，那么它被称为owner属主。
</p>

<p>
当该类的该类属性被查找、设置、删除时，就会调用描述器相应的方法
</p>
</div>
</div>
<div id="outline-container-h:38ba896a-037d-4f10-b4c2-0570b69f9db7" class="outline-5">
<h5 id="h:38ba896a-037d-4f10-b4c2-0570b69f9db7">属性的访问顺序</h5>
<div class="outline-text-5" id="text-h:38ba896a-037d-4f10-b4c2-0570b69f9db7">
<p>
为上例中的类B增加实例属性x
</p>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A init ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">a1</span> = <span style="color: #8b2252;">'a1'</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A.__get__ self:{} instance:{} owner:{}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>, instance, owner))
        <span style="color: #b22222;">#</span><span style="color: #b22222;">owner &#23646;&#20027;&#31867;&#65292; B
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;A instance {}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23646;&#20027;&#31867;
</span>    <span style="color: #a0522d;">x</span> = A() <span style="color: #b22222;">#</span><span style="color: #b22222;">A() &#25551;&#36848;&#22120;&#23454;&#20363;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35775;&#38382;B&#25110;&#32773;B&#23454;&#20363;&#23646;&#24615;&#21464;&#25104;&#19968;&#20010;&#20989;&#25968;&#35843;&#29992;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'B init ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = <span style="color: #8b2252;">'b.x'</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38750;&#25968;&#25454;&#25551;&#36848;&#22120;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">self.y = A() #&#25551;&#36848;&#22120;&#19981;&#33021;&#29992;&#22312;&#23454;&#20363;&#23646;&#24615;&#19978;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;B id={}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #483d8b;">print</span>(B.x) <span style="color: #b22222;">#</span><span style="color: #b22222;">A&#30340;&#23454;&#20363;, &#30456;&#24403;&#20110; B.x =&gt; A().__get__()
</span><span style="color: #483d8b;">print</span>(B.x.a1)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)

<span style="color: #a0522d;">t</span> = B()
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(t))
<span style="color: #483d8b;">print</span>(t.x) <span style="color: #b22222;">#</span><span style="color: #b22222;">?t.x -&gt; B.x -&gt; A().__get__()
</span>


<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A init ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A.__get__ self:&lt;A instance 2566041795760&gt; instance:None owner:&lt;class '__main__.B'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;A instance 2566041795760&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A.__get__ self:&lt;A instance 2566041795760&gt; instance:None owner:&lt;class '__main__.B'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">a1
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">B init ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2566041796096
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">b.x</span>
</pre>
</div>

<p>
类A只实现了__get__()方法，b.x访问到了实例的属性，而不是描述器
</p>
</div>
<div id="outline-container-h:022a55fe-771e-4998-b23d-56157bfd497b" class="outline-6">
<h6 id="h:022a55fe-771e-4998-b23d-56157bfd497b"><code>__set__ ,__set_name__</code></h6>
<div class="outline-text-6" id="text-h:022a55fe-771e-4998-b23d-56157bfd497b">
<p>
3.6新增描述器方法__set_name__，它在属主类构建的时候就会调用
</p>

<p>
为类A增加__set__方法
</p>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A init ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">a1</span> = <span style="color: #8b2252;">'a1'</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A.__get__ self:{} instance:{} owner:{}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>, instance, owner))
        <span style="color: #b22222;">#</span><span style="color: #b22222;">owner &#23646;&#20027;&#31867;&#65292; B
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__set__</span>(<span style="color: #a020f0;">self</span>, instance, value):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A.set'</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">self.data = value
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">__dict__</span>[<span style="color: #a020f0;">self</span>.prop_name] = value

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__set_name__</span>(<span style="color: #a020f0;">self</span>, owner, name):
        <span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">self</span>, owner, name, <span style="color: #8b2252;">'****'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">prop_name</span> = name

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;A instance {}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23646;&#20027;&#31867;
</span>    <span style="color: #a0522d;">x</span> = A() <span style="color: #b22222;">#</span><span style="color: #b22222;">A() &#25551;&#36848;&#22120;&#23454;&#20363;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35775;&#38382;B&#25110;&#32773;B&#23454;&#20363;&#23646;&#24615;&#21464;&#25104;&#19968;&#20010;&#20989;&#25968;&#35843;&#29992;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'B init ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = <span style="color: #8b2252;">'b.x'</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25968;&#25454;&#25551;&#36848;&#22120;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25968;&#25454;&#25551;&#36848;&#22120;&#65292;&#22914;&#26524;&#36825;&#20010;&#23646;&#24615;x&#26159;&#31867;&#23646;&#24615;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32780;&#31867;&#23646;&#24615;&#26159;&#25551;&#36848;&#22120;&#65292;&#37027;&#20040;&#23454;&#20363;&#23646;&#24615;&#36171;&#20540;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23601;&#25104;&#20102;&#35843;&#29992; A().__set__()
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20248;&#20808;&#32423;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25968;&#25454;&#25551;&#36848;&#22120;&#20248;&#20808;&#32423; &gt; __dict__ &gt; &#38750;&#25968;&#25454;&#25551;&#36848;&#22120;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">self.y = A() #&#25551;&#36848;&#22120;&#19981;&#33021;&#29992;&#22312;&#23454;&#20363;&#23646;&#24615;&#19978;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'B init end ++++'</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;B id={}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #483d8b;">print</span>(B.x) <span style="color: #b22222;">#</span><span style="color: #b22222;">A&#30340;&#23454;&#20363;, &#30456;&#24403;&#20110; B.x =&gt; A().__get__()
</span><span style="color: #483d8b;">print</span>(B.x.a1)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)

<span style="color: #a0522d;">t</span> = B() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23454;&#20363;&#20013;&#31867;&#23646;&#24615;&#26159;&#25551;&#36848;&#22120;&#65292;&#37027;&#20040;&#23454;&#20363;&#23646;&#24615;&#36171;&#20540;&#23601;&#26159;&#25104;&#20102;&#35843;&#29992;A().__set__()
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(t))
<span style="color: #483d8b;">print</span>(t.x) <span style="color: #b22222;">#</span><span style="color: #b22222;">?t.x -&gt; B.x -&gt; A().__get__()
</span><span style="color: #483d8b;">print</span>(t.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #483d8b;">print</span>(t.x.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25968;&#25454;&#25551;&#36848;&#22120;&#65292;t.x&#26159;&#20160;&#20040;
</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A init ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;A instance 2204892888240&gt; &lt;class '__main__.B'&gt; x ****
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A.__get__ self:&lt;A instance 2204892888240&gt; instance:None owner:&lt;class '__main__.B'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;A instance 2204892888240&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A.__get__ self:&lt;A instance 2204892888240&gt; instance:None owner:&lt;class '__main__.B'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">a1
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">B init ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A.set
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">B init end ++++
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2204892888576
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A.__get__ self:&lt;A instance 2204892888240&gt; instance:&lt;B id=2204892888576&gt; owner:&lt;class '__main__.B'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;A instance 2204892888240&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A.__get__ self:&lt;A instance 2204892888240&gt; instance:&lt;B id=2204892888576&gt; owner:&lt;class '__main__.B'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'a1': 'a1', 'prop_name': 'x', 'x': 'b.x'}</span>
</pre>
</div>
<p>
所有的b.x就会访问描述器的__get__()方法，代码中返回的self就是描述器实例，它的实例字典中就保存着a1和data属性，可以打印b.x.__dict__看这些属性
</p>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A init ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">a1</span> = <span style="color: #8b2252;">'a1'</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A.__get__ self:{} instance:{} owner:{}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>, instance, owner))
        <span style="color: #b22222;">#</span><span style="color: #b22222;">owner &#23646;&#20027;&#31867;&#65292; B
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__set__</span>(<span style="color: #a020f0;">self</span>, instance, value):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'A.set'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">data</span> = value
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">__dict__</span>[<span style="color: #a020f0;">self</span>.prop_name] = value

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__set_name__</span>(<span style="color: #a020f0;">self</span>, owner, name):
        <span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">self</span>, owner, name, <span style="color: #8b2252;">'****'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">prop_name</span> = name

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;A instance {}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23646;&#20027;&#31867;
</span>    <span style="color: #a0522d;">x</span> = A() <span style="color: #b22222;">#</span><span style="color: #b22222;">A() &#25551;&#36848;&#22120;&#23454;&#20363;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35775;&#38382;B&#25110;&#32773;B&#23454;&#20363;&#23646;&#24615;&#21464;&#25104;&#19968;&#20010;&#20989;&#25968;&#35843;&#29992;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'B init ~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = <span style="color: #8b2252;">'b.x'</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25968;&#25454;&#25551;&#36848;&#22120;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25968;&#25454;&#25551;&#36848;&#22120;&#65292;&#22914;&#26524;&#36825;&#20010;&#23646;&#24615;x&#26159;&#31867;&#23646;&#24615;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32780;&#31867;&#23646;&#24615;&#26159;&#25551;&#36848;&#22120;&#65292;&#37027;&#20040;&#23454;&#20363;&#23646;&#24615;&#36171;&#20540;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23601;&#25104;&#20102;&#35843;&#29992; A().__set__()
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20248;&#20808;&#32423;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25968;&#25454;&#25551;&#36848;&#22120;&#20248;&#20808;&#32423; &gt; __dict__ &gt; &#38750;&#25968;&#25454;&#25551;&#36848;&#22120;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">self.y = A() #&#25551;&#36848;&#22120;&#19981;&#33021;&#29992;&#22312;&#23454;&#20363;&#23646;&#24615;&#19978;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'B init end ++++'</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;B id={}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #a0522d;">t</span> = B()
t.<span style="color: #a0522d;">x</span> = 500
<span style="color: #483d8b;">print</span>(t.x)
<span style="color: #483d8b;">print</span>(t.x.a1)
<span style="color: #483d8b;">print</span>(t.x.data)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)

B.<span style="color: #a0522d;">x</span> = 600
<span style="color: #483d8b;">print</span>(t.x) <span style="color: #b22222;">#</span><span style="color: #b22222;">600
</span><span style="color: #483d8b;">print</span>(t.x.a1) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25253;&#38169; AttributeError
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A init ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;A instance 2436740906160&gt; &lt;class '__main__.B'&gt; x ****
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">B init ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A.set
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">B init end ++++
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A.set
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A.__get__ self:&lt;A instance 2436740906160&gt; instance:&lt;B id=2436740906496&gt; owner:&lt;class '__main__.B'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;A instance 2436740906160&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A.__get__ self:&lt;A instance 2436740906160&gt; instance:&lt;B id=2436740906496&gt; owner:&lt;class '__main__.B'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">a1
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">A.__get__ self:&lt;A instance 2436740906160&gt; instance:&lt;B id=2436740906496&gt; owner:&lt;class '__main__.B'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">500
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">600
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Traceback (most recent call last):
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">File "D:\project\pyproj\t1.py", line 51, in &lt;module&gt;
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">print(t.x.a1)
</span><span style="color: #b22222;">#           </span><span style="color: #b22222;">^^^^^^
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">AttributeError: 'int' object has no attribute 'a1'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:160dcb11-0e39-4ea4-ada2-2879c1666404" class="outline-6">
<h6 id="h:160dcb11-0e39-4ea4-ada2-2879c1666404">属性的访问顺序</h6>
<div class="outline-text-6" id="text-h:160dcb11-0e39-4ea4-ada2-2879c1666404">
<ul class="org-ul">
<li>实例的__dict__优先于非数据描述器</li>
<li>数据描述器优先于实例的__dict__</li>
</ul>

<p>
__delete__方法有同样的效果，有了这个方法，也就是数据描述器
</p>
</div>
</div>
</div>
<div id="outline-container-h:3a62ed3b-845a-43a0-90ef-1cc19943454b" class="outline-5">
<h5 id="h:3a62ed3b-845a-43a0-90ef-1cc19943454b">Python的描述器</h5>
<div class="outline-text-5" id="text-h:3a62ed3b-845a-43a0-90ef-1cc19943454b">
<p>
描述器在Python中应用非常广泛
</p>

<p>
Python的方法（包括staticmethod()和classmethod()）都实现为非数据描述器。
因此，实例可以重新定义和覆盖方法。这允许单个实例获取与同一类的其他实例
不同的行为
</p>

<p>
property()函数实现为一个数据描述器。因此，实例不能覆盖属性和行为
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>(cls): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38750;&#25968;&#25454;&#25551;&#36848;&#22120;
</span>        <span style="color: #a020f0;">pass</span>

    @<span style="color: #483d8b;">staticmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">bar</span>(): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38750;&#25968;&#25454;&#25551;&#36848;&#22120;
</span>        <span style="color: #a020f0;">pass</span>

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">z</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25968;&#25454;&#25551;&#36848;&#22120;
</span>        <span style="color: #a020f0;">return</span> 5

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">getfoo</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38750;&#25968;&#25454;&#25551;&#36848;&#22120;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.foo

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38750;&#25968;&#25454;&#25551;&#36848;&#22120;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">foo</span> = 100
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">bar</span> = 200
        <span style="color: #b22222;"># </span><span style="color: #b22222;">self.z = 300
</span>
<span style="color: #a0522d;">a</span> = A()
<span style="color: #483d8b;">print</span>(a.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">{'foo': 100, 'bar': 200}
</span><span style="color: #483d8b;">print</span>(A.<span style="color: #483d8b;">__dict__</span>)
</pre>
</div>

<p>
foo、bar都可以在事例中覆盖，但是z不可以
</p>
</div>
</div>
<div id="outline-container-h:a1bd970e-96c7-4b8c-ba39-7bdd0190e8b9" class="outline-5">
<h5 id="h:a1bd970e-96c7-4b8c-ba39-7bdd0190e8b9">练习</h5>
<div class="outline-text-5" id="text-h:a1bd970e-96c7-4b8c-ba39-7bdd0190e8b9">
</div>
<div id="outline-container-h:c2d8281a-7e46-4170-a0ac-dc373158b4f3" class="outline-6">
<h6 id="h:c2d8281a-7e46-4170-a0ac-dc373158b4f3">实现StaticMethod装饰器</h6>
<div class="outline-text-6" id="text-h:c2d8281a-7e46-4170-a0ac-dc373158b4f3">
<p>
实现StaticMethod装饰器，完成staticmethod装饰器的功能
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">StaticMethod</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, fn):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_fn</span> = fn

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">print('get ~~~~')
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._fn

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #228b22;">@StaticMethod</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30456;&#24403;&#20110; foo = StaticMethod(foo) =&gt; foo&#23601;&#26159;StaticMethod&#30340;&#23454;&#20363;&#65292;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">foo&#26159;A&#30340;&#31867;&#23646;&#24615;&#65292;&#31526;&#21512;&#25551;&#36848;&#22120;&#30340;&#23450;&#20041;&#65292;&#25551;&#36848;&#22120;&#23545;&#20110;&#23646;&#20027;&#31867;&#26469;&#35762;&#24517;&#39035;&#26377;&#20010;&#31867;&#23646;&#20027;&#25351;&#21521;&#25551;&#36848;&#22120;&#23454;&#20363;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'static method~~'</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">print(A.__dict__)
</span><span style="color: #483d8b;">print</span>(A.foo)
A.foo()
A().foo()

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;function A.foo at 0x000001EC027CF1A0&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">static method~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">static method~~</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:7e82ced2-0a78-4077-a10e-7a1d39896b22" class="outline-6">
<h6 id="h:7e82ced2-0a78-4077-a10e-7a1d39896b22">实现ClassMethod装饰器</h6>
<div class="outline-text-6" id="text-h:7e82ced2-0a78-4077-a10e-7a1d39896b22">
<p>
实现ClassMethod装饰器，完成classmethod装饰器的功能
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> partial

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">ClassMethod</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, fn):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_fn</span> = fn

    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38750;&#25968;&#25454;&#25551;&#36848;&#22120;  &#21482;&#35201;&#26159;&#26041;&#27861;&#37117;&#26159;&#25551;&#36848;&#22120;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #a0522d;">ret</span> = partial(<span style="color: #a020f0;">self</span>._fn, owner) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22266;&#23450;owner&#36820;&#22238;&#26032;&#20989;&#25968;&#65292;&#21487;&#20197;&#20351;&#29992;&#20559;&#20989;&#25968;
</span>        <span style="color: #a020f0;">return</span> ret

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #228b22;">@ClassMethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">bar</span>(cls): <span style="color: #b22222;">#</span><span style="color: #b22222;">bar = ClassMethod(bar) =&gt; bar&#23601;&#26159;ClassMethod&#30340;&#23454;&#20363;&#65292;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'class method~~'</span>, cls)

<span style="color: #483d8b;">print</span>(A.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #483d8b;">print</span>(A.bar)
A.bar()
A().bar()

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'__module__': '__main__', '__firstlineno__': 12, 'bar': &lt;__main__.ClassMethod object at 0x000002C692A07CB0&gt;, '__static_attributes__': (), '__dict__': &lt;attribute '__dict__' of 'A' objects&gt;, '__weakref__': &lt;attribute '__weakref__' of 'A' objects&gt;, '__doc__': None}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">functools.partial(&lt;function A.bar at 0x000002C692CC8CC0&gt;, &lt;class '__main__.A'&gt;)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">class method~~ &lt;class '__main__.A'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">class method~~ &lt;class '__main__.A'&gt;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:885f330b-caca-408a-9619-053911065266" class="outline-6">
<h6 id="h:885f330b-caca-408a-9619-053911065266">对实例的数据进行校验</h6>
<div class="outline-text-6" id="text-h:885f330b-caca-408a-9619-053911065266">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name:<span style="color: #483d8b;">str</span>, age:<span style="color: #483d8b;">int</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age
</pre>
</div>

<p>
思路：
</p>


<p>
一般方法
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name:<span style="color: #483d8b;">str</span>, age:<span style="color: #483d8b;">int</span>):
        <span style="color: #a0522d;">params</span> = [(name, <span style="color: #483d8b;">str</span>), (age, <span style="color: #483d8b;">int</span>)]
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">self</span>.check_type(params):
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">TypeError</span>()
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">check_type</span>(<span style="color: #a020f0;">self</span>, params): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30828;&#32534;&#30721;&#65292;&#19981;&#22909; 2 &#20405;&#20837;&#24335; &#24456;&#22810;&#37117;&#38656;&#35201;
</span>        <span style="color: #a020f0;">for</span> value, typ <span style="color: #a020f0;">in</span> params:
            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> <span style="color: #483d8b;">isinstance</span>(value, typ):
                <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">False</span>
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">True</span>

<span style="color: #a0522d;">p1</span> = Person(<span style="color: #8b2252;">'tom'</span>, 20)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name:<span style="color: #483d8b;">str</span>, age:<span style="color: #483d8b;">int</span>):
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">self</span>.check_type(name=(name, <span style="color: #483d8b;">str</span>), age=(age, <span style="color: #483d8b;">int</span>)): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30828;&#32534;&#30721;&#65292;&#19981;&#22909; 2 &#20405;&#20837;&#24335; &#24456;&#22810;&#37117;&#38656;&#35201;
</span>            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">TypeError</span>()
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">check_type</span>(<span style="color: #a020f0;">self</span>, **params):
        <span style="color: #a020f0;">for</span> value, typ <span style="color: #a020f0;">in</span> params.values():
            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> <span style="color: #483d8b;">isinstance</span>(value, typ):
                <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">False</span>
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">True</span>

<span style="color: #a0522d;">p1</span> = Person(<span style="color: #8b2252;">'tom'</span>, 20)
</pre>
</div>

<p>
对上面的类的实例的属性name、age进行数据校验
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TypeCheck</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">pass</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #a020f0;">pass</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__set__</span>(<span style="color: #a020f0;">self</span>, instance, value):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'set ~~~~'</span>, instance, value)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a0522d;">name</span> = TypeCheck()
    <span style="color: #b22222;"># </span><span style="color: #b22222;">age = TypeCheck()
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name:<span style="color: #483d8b;">str</span>, age:<span style="color: #483d8b;">int</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36171;&#20540;&#26102;&#65292;&#35843;&#29992;&#25551;&#36848;&#22120;&#30340;set&#26041;&#27861;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

<span style="color: #a0522d;">p1</span> = Person(<span style="color: #8b2252;">'tom'</span>, 20)
<span style="color: #483d8b;">print</span>(p1.name, p1.age)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">set ~~~~ &lt;__main__.Person object at 0x000001F418CF7E00&gt; tom
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">None 20</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TypeCheck</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">pname</span> = <span style="color: #008b8b;">None</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'get ++++'</span>, <span style="color: #a020f0;">self</span>)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.data

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__set__</span>(<span style="color: #a020f0;">self</span>, instance, value):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'set ~~~~'</span>, instance, value)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">data</span> = value

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__set_name__</span>(<span style="color: #a020f0;">self</span>, owner, name):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">pname</span> = name

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&lt;&#25551;&#36848;&#22120;TypeCheck {} id={}&gt;"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.pname, <span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a0522d;">name</span> = TypeCheck() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;Person&#30340;&#27599;&#19968;&#20010;&#31867;&#23646;&#24615;&#26500;&#24314;&#19968;&#20010;&#25551;&#36848;&#22120;&#23454;&#20363;
</span>    <span style="color: #a0522d;">age</span> = TypeCheck()
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name:<span style="color: #483d8b;">str</span>, age:<span style="color: #483d8b;">int</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36171;&#20540;&#26102;&#65292;&#35843;&#29992;&#25551;&#36848;&#22120;&#30340;set&#26041;&#27861;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

<span style="color: #a0522d;">p1</span> = Person(<span style="color: #8b2252;">'tom'</span>, 20)
<span style="color: #483d8b;">print</span>(p1.name, p1.age)
<span style="color: #483d8b;">print</span>(p1.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#34987;&#25551;&#36848;&#22120;&#25130;&#32993;&#20102; {}
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">set ~~~~ &lt;__main__.Person object at 0x000002212E997E00&gt; tom
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">set ~~~~ &lt;__main__.Person object at 0x000002212E997E00&gt; 20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">get ++++ &lt;&#25551;&#36848;&#22120;TypeCheck name id=2341538987184&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">get ++++ &lt;&#25551;&#36848;&#22120;TypeCheck age id=2341540950928&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">tom 20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{}</span>
</pre>
</div>

<p>
解决被截胡的字典__dict__
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TypeCheck</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">pname</span> = <span style="color: #008b8b;">None</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'get ++++'</span>, <span style="color: #a020f0;">self</span>)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.data

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__set__</span>(<span style="color: #a020f0;">self</span>, instance, value):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'set ~~~~'</span>, instance, value)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">data</span> = value
        instance.<span style="color: #483d8b;">__dict__</span>[<span style="color: #a020f0;">self</span>.pname] = value  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#34987;&#25130;&#32993;&#30340;&#23383;&#20856;&#65292;&#26041;&#27861;1 &#21033;&#29992;__set_name__
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__set_name__</span>(<span style="color: #a020f0;">self</span>, owner, name):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">pname</span> = name

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&lt;&#25551;&#36848;&#22120;TypeCheck {} id={}&gt;"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.pname, <span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a0522d;">name</span> = TypeCheck() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;Person&#30340;&#27599;&#19968;&#20010;&#31867;&#23646;&#24615;&#26500;&#24314;&#19968;&#20010;&#25551;&#36848;&#22120;&#23454;&#20363;
</span>    <span style="color: #a0522d;">age</span> = TypeCheck()
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name:<span style="color: #483d8b;">str</span>, age:<span style="color: #483d8b;">int</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36171;&#20540;&#26102;&#65292;&#35843;&#29992;&#25551;&#36848;&#22120;&#30340;set&#26041;&#27861;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

<span style="color: #a0522d;">p1</span> = Person(<span style="color: #8b2252;">'tom'</span>, 20)
<span style="color: #483d8b;">print</span>(p1.name, p1.age)
<span style="color: #483d8b;">print</span>(p1.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#34987;&#25551;&#36848;&#22120;&#25130;&#32993;&#20102;&#65292;&#38656;&#35201;&#20570;&#25104;&#27491;&#24120;&#19968;&#26679;&#30340;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">set ~~~~ &lt;__main__.Person object at 0x000001C06D747E00&gt; tom
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">set ~~~~ &lt;__main__.Person object at 0x000001C06D747E00&gt; 20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">get ++++ &lt;&#25551;&#36848;&#22120;TypeCheck name id=1925981699248&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">get ++++ &lt;&#25551;&#36848;&#22120;TypeCheck age id=1925984056208&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">tom 20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'name': 'tom', 'age': 20}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TypeCheck</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, pname):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">pname</span> = pname

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'get ++++'</span>, <span style="color: #a020f0;">self</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return self.data
</span>        <span style="color: #a020f0;">if</span> instance: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22240;&#20026;&#25551;&#36848;&#22120;&#20063;&#21487;&#20197;&#36890;&#36807;&#31867;&#26469;&#35775;&#38382;&#65292;&#36825;&#37324;&#20570;&#19968;&#19979;&#21028;&#26029;
</span>            <span style="color: #a020f0;">return</span> instance.<span style="color: #483d8b;">__dict__</span>[<span style="color: #a020f0;">self</span>.pname]
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">raise TypeError
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__set__</span>(<span style="color: #a020f0;">self</span>, instance, value):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'set ~~~~'</span>, instance, value)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">self.data = value
</span>        <span style="color: #a020f0;">if</span> instance:
            instance.<span style="color: #483d8b;">__dict__</span>[<span style="color: #a020f0;">self</span>.pname] = value  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#34987;&#25130;&#32993;&#30340;&#23383;&#20856;&#65292;&#26041;&#27861;2 &#21033;&#29992;&#20256;&#21442;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&lt;&#25551;&#36848;&#22120;TypeCheck {} id={}&gt;"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.pname, <span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a0522d;">name</span> = TypeCheck(<span style="color: #8b2252;">'name'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;Person&#30340;&#27599;&#19968;&#20010;&#31867;&#23646;&#24615;&#26500;&#24314;&#19968;&#20010;&#25551;&#36848;&#22120;&#23454;&#20363;
</span>    <span style="color: #a0522d;">age</span> = TypeCheck(<span style="color: #8b2252;">'age'</span>)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name:<span style="color: #483d8b;">str</span>, age:<span style="color: #483d8b;">int</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36171;&#20540;&#26102;&#65292;&#35843;&#29992;&#25551;&#36848;&#22120;&#30340;set&#26041;&#27861;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

<span style="color: #a0522d;">p1</span> = Person(<span style="color: #8b2252;">'tom'</span>, 20)
<span style="color: #483d8b;">print</span>(p1.name, p1.age)
<span style="color: #483d8b;">print</span>(p1.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#34987;&#25551;&#36848;&#22120;&#25130;&#32993;&#20102;&#65292;&#38656;&#35201;&#20570;&#25104;&#27491;&#24120;&#19968;&#26679;&#30340;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">set ~~~~ &lt;__main__.Person object at 0x000001C06D747E00&gt; tom
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">set ~~~~ &lt;__main__.Person object at 0x000001C06D747E00&gt; 20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">get ++++ &lt;&#25551;&#36848;&#22120;TypeCheck name id=1925981699248&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">get ++++ &lt;&#25551;&#36848;&#22120;TypeCheck age id=1925984056208&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">tom 20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'name': 'tom', 'age': 20}</span>
</pre>
</div>

<p>
解决类型处理。
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TypeCheck</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, pname, typ):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">pname</span> = pname
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">type</span> = typ

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'get ++++'</span>, <span style="color: #a020f0;">self</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return self.data
</span>        <span style="color: #a020f0;">if</span> instance: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22240;&#20026;&#25551;&#36848;&#22120;&#20063;&#21487;&#20197;&#36890;&#36807;&#31867;&#26469;&#35775;&#38382;&#65292;&#36825;&#37324;&#20570;&#19968;&#19979;&#21028;&#26029;
</span>            <span style="color: #a020f0;">return</span> instance.<span style="color: #483d8b;">__dict__</span>[<span style="color: #a020f0;">self</span>.pname]
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">raise TypeError
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__set__</span>(<span style="color: #a020f0;">self</span>, instance, value):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'set ~~~~'</span>, instance, value)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">self.data = value
</span>        <span style="color: #a020f0;">if</span> instance:
            <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(value, <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">type</span>):  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22788;&#29702;&#31867;&#22411;
</span>                instance.<span style="color: #483d8b;">__dict__</span>[<span style="color: #a020f0;">self</span>.pname] = value  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#34987;&#25130;&#32993;&#30340;&#23383;&#20856;&#65292;&#26041;&#27861;2 &#21033;&#29992;&#20256;&#21442;
</span>            <span style="color: #a020f0;">else</span>:
                <span style="color: #a020f0;">raise</span>  <span style="color: #228b22;">TypeError</span>(<span style="color: #8b2252;">'{} . {}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.pname, value))

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&lt;&#25551;&#36848;&#22120;TypeCheck {} id={}&gt;"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.pname, <span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a0522d;">name</span> = TypeCheck(<span style="color: #8b2252;">'name'</span>, <span style="color: #483d8b;">str</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25163;&#21160;&#20256;&#20837;&#21517;&#31216;&#21644;&#31867;&#22411;&#65292;&#22909;&#21527;&#65311;
</span>    <span style="color: #a0522d;">age</span> = TypeCheck(<span style="color: #8b2252;">'age'</span>, <span style="color: #483d8b;">int</span>)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name:<span style="color: #483d8b;">str</span>, age:<span style="color: #483d8b;">int</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36171;&#20540;&#26102;&#65292;&#35843;&#29992;&#25551;&#36848;&#22120;&#30340;set&#26041;&#27861;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

<span style="color: #a0522d;">p1</span> = Person(<span style="color: #8b2252;">'tom'</span>, 20)
<span style="color: #483d8b;">print</span>(p1.name, p1.age) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#22411;&#22788;&#29702;
</span><span style="color: #483d8b;">print</span>(p1.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#34987;&#25551;&#36848;&#22120;&#25130;&#32993;&#20102;&#65292;&#38656;&#35201;&#20570;&#25104;&#27491;&#24120;&#19968;&#26679;&#30340;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">set ~~~~ &lt;__main__.Person object at 0x000001C06D747E00&gt; tom
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">set ~~~~ &lt;__main__.Person object at 0x000001C06D747E00&gt; 20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">get ++++ &lt;&#25551;&#36848;&#22120;TypeCheck name id=1925981699248&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">get ++++ &lt;&#25551;&#36848;&#22120;TypeCheck age id=1925984056208&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">tom 20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'name': 'tom', 'age': 20}</span>
</pre>
</div>

<p>
解决硬编码问题，形参的定义：
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> inspect

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">propsinject</span>(cls): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;&#31867;&#23545;&#35937;&#28155;&#21152;&#23646;&#24615;
</span>
    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#20540;&#26159;&#20160;&#20040;
</span>    <span style="color: #a020f0;">return</span> cls

<span style="color: #228b22;">@propsinject</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">Person = propsinject(Person)
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">name = TypeCheck('name', str) #&#25163;&#21160;&#20256;&#20837;&#21517;&#31216;&#21644;&#31867;&#22411;&#65292;&#22909;&#21527;&#65311;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">age = TypeCheck('age', int)
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name:<span style="color: #483d8b;">str</span>, age:<span style="color: #483d8b;">int</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36171;&#20540;&#26102;&#65292;&#35843;&#29992;&#25551;&#36848;&#22120;&#30340;set&#26041;&#27861;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

<span style="color: #a0522d;">sig</span> = inspect.signature(Person)
<span style="color: #483d8b;">print</span>(sig) <span style="color: #b22222;">#</span><span style="color: #b22222;">(name: str, age: int) &#31614;&#21517;&#36319;init&#26377;&#20851;
</span><span style="color: #a0522d;">params</span> = sig.parameters
<span style="color: #483d8b;">print</span>(params) <span style="color: #b22222;">#</span><span style="color: #b22222;">OrderedDict({'name': &lt;Parameter "name: str"&gt;, 'age': &lt;Parameter "age: int"&gt;})</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> inspect

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">TypeCheck</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, pname, typ):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">pname</span> = pname
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">type</span> = typ

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">propsinject</span>(cls): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;&#31867;&#23545;&#35937;&#28155;&#21152;&#23646;&#24615;
</span>    <span style="color: #a0522d;">sig</span> = inspect.signature(cls)
    <span style="color: #483d8b;">print</span>(sig)
    <span style="color: #a0522d;">params</span> = sig.parameters
    <span style="color: #483d8b;">print</span>(params)
    <span style="color: #a020f0;">for</span> name, param <span style="color: #a020f0;">in</span> params.items():
        <span style="color: #483d8b;">print</span>(name, param.name, param.kind, param.annotation, param.default)
        <span style="color: #a020f0;">if</span> param.annotation <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> param.empty:
            <span style="color: #483d8b;">setattr</span>(cls, name, TypeCheck(name, param.annotation))
    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#20540;&#26159;&#20160;&#20040;
</span>    <span style="color: #a020f0;">return</span> cls

<span style="color: #228b22;">@propsinject</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">Person = propsinject(Person)
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">name = TypeCheck('name', str) #&#25163;&#21160;&#20256;&#20837;&#21517;&#31216;&#21644;&#31867;&#22411;&#65292;&#22909;&#21527;&#65311;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">age = TypeCheck('age', int)
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name:<span style="color: #483d8b;">str</span>, age:<span style="color: #483d8b;">int</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36171;&#20540;&#26102;&#65292;&#35843;&#29992;&#25551;&#36848;&#22120;&#30340;set&#26041;&#27861;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age


<span style="color: #483d8b;">print</span>(Person.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#30475;&#21040;&#28155;&#21152;&#31867;&#23646;&#24615;name, age. 'name': &lt;__main__.TypeCheck object at 0x00000212EF0842F0&gt;, 'age': &lt;__main__.TypeCheck object at 0x00000212EEBC7ED0&gt;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">(name: str, age: int)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">OrderedDict({'name': &lt;Parameter "name: str"&gt;, 'age': &lt;Parameter "age: int"&gt;})
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">name name POSITIONAL_OR_KEYWORD &lt;class 'str'&gt; &lt;class 'inspect._empty'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">age age POSITIONAL_OR_KEYWORD &lt;class 'int'&gt; &lt;class 'inspect._empty'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'__module__': '__main__', '__firstlineno__': 20, '__init__': &lt;function Person.__init__ at 0x00000212EF0A0400&gt;, '__static_attributes__': ('age', 'name'), '__dict__': &lt;attribute '__dict__' of 'Person' objects&gt;, '__weakref__': &lt;attribute '__weakref__' of 'Person' objects&gt;, '__doc__': None, 'name': &lt;__main__.TypeCheck object at 0x00000212EF0842F0&gt;, 'age': &lt;__main__.TypeCheck object at 0x00000212EEBC7ED0&gt;}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> inspect

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">TypeCheck</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, pname, typ):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">pname</span> = pname
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">type</span> = typ

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'get ++++'</span>, <span style="color: #a020f0;">self</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return self.data
</span>        <span style="color: #a020f0;">if</span> instance: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22240;&#20026;&#25551;&#36848;&#22120;&#20063;&#21487;&#20197;&#36890;&#36807;&#31867;&#26469;&#35775;&#38382;&#65292;&#36825;&#37324;&#20570;&#19968;&#19979;&#21028;&#26029;
</span>            <span style="color: #a020f0;">return</span> instance.<span style="color: #483d8b;">__dict__</span>[<span style="color: #a020f0;">self</span>.pname]
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">raise TypeError
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__set__</span>(<span style="color: #a020f0;">self</span>, instance, value):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'set ~~~~'</span>, instance, value)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">self.data = value
</span>        <span style="color: #a020f0;">if</span> instance:
            <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(value, <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">type</span>):  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22788;&#29702;&#31867;&#22411;
</span>                instance.<span style="color: #483d8b;">__dict__</span>[<span style="color: #a020f0;">self</span>.pname] = value  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#34987;&#25130;&#32993;&#30340;&#23383;&#20856;&#65292;&#26041;&#27861;2 &#21033;&#29992;&#20256;&#21442;
</span>            <span style="color: #a020f0;">else</span>:
                <span style="color: #a020f0;">raise</span>  <span style="color: #228b22;">TypeError</span>(<span style="color: #8b2252;">'{} . {}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.pname, value))

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&lt;&#25551;&#36848;&#22120;TypeCheck {} id={}&gt;"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.pname, <span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">propsinject</span>(cls): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;&#31867;&#23545;&#35937;&#28155;&#21152;&#23646;&#24615;
</span>    <span style="color: #a0522d;">sig</span> = inspect.signature(cls)
    <span style="color: #a0522d;">params</span> = sig.parameters
    <span style="color: #a020f0;">for</span> name, param <span style="color: #a020f0;">in</span> params.items():
        <span style="color: #b22222;"># </span><span style="color: #b22222;">print(name, param.name, param.kind, param.annotation, param.default)
</span>        <span style="color: #a020f0;">if</span> param.annotation <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> param.empty:
            <span style="color: #483d8b;">setattr</span>(cls, name, TypeCheck(name, param.annotation))
    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#20540;&#26159;&#20160;&#20040;
</span>    <span style="color: #a020f0;">return</span> cls

<span style="color: #228b22;">@propsinject</span>  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#23646;&#24615;&#36890;&#36807;&#35013;&#39280;&#22120;&#21160;&#24577;&#36755;&#20837;
</span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #b22222;"># </span><span style="color: #b22222;">name = TypeCheck('name', str) #&#25163;&#21160;&#20256;&#20837;&#21517;&#31216;&#21644;&#31867;&#22411;&#65292;&#22909;&#21527;&#65311;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">age = TypeCheck('age', int)
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name:<span style="color: #483d8b;">str</span>, age:<span style="color: #483d8b;">int</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36171;&#20540;&#26102;&#65292;&#35843;&#29992;&#25551;&#36848;&#22120;&#30340;set&#26041;&#27861;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

<span style="color: #a0522d;">p1</span> = Person(<span style="color: #8b2252;">'tom'</span>, 20)
<span style="color: #483d8b;">print</span>(p1.name, p1.age) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#22411;&#22788;&#29702;
</span><span style="color: #483d8b;">print</span>(p1.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#34987;&#25551;&#36848;&#22120;&#25130;&#32993;&#20102;&#65292;&#38656;&#35201;&#20570;&#25104;&#27491;&#24120;&#19968;&#26679;&#30340;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">set ~~~~ &lt;__main__.Person object at 0x0000020F4F548440&gt; tom
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">set ~~~~ &lt;__main__.Person object at 0x0000020F4F548440&gt; 20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">get ++++ &lt;&#25551;&#36848;&#22120;TypeCheck name id=2264778703600&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">get ++++ &lt;&#25551;&#36848;&#22120;TypeCheck age id=2264773721808&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">tom 20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'name': 'tom', 'age': 20}</span>
</pre>
</div>

<p>
如果用类做装饰器，该怎么写？
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> inspect

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">TypeCheck</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, pname, typ):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">pname</span> = pname
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">type</span> = typ

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">propsinject</span>(cls): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;&#31867;&#23545;&#35937;&#28155;&#21152;&#23646;&#24615;
</span>    <span style="color: #a0522d;">sig</span> = inspect.signature(cls)
    <span style="color: #a0522d;">params</span> = sig.parameters
    <span style="color: #a020f0;">for</span> name, param <span style="color: #a020f0;">in</span> params.items():
        <span style="color: #b22222;"># </span><span style="color: #b22222;">print(name, param.name, param.kind, param.annotation, param.default)
</span>        <span style="color: #a020f0;">if</span> param.annotation <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> param.empty:
            <span style="color: #483d8b;">setattr</span>(cls, name, TypeCheck(name, param.annotation))
    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#20540;&#26159;&#20160;&#20040;
</span>    <span style="color: #a020f0;">return</span> cls

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PropInject</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, cls):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">cls</span> = propsinject(cls)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__call__</span>(<span style="color: #a020f0;">self</span>, *args, **kwargs):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.cls(*args, **kwargs)

<span style="color: #228b22;">@PropInject</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">Person = PropInject(Person)
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">name = TypeCheck('name', str) #&#25163;&#21160;&#20256;&#20837;&#21517;&#31216;&#21644;&#31867;&#22411;&#65292;&#22909;&#21527;&#65311;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">age = TypeCheck('age', int)
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name:<span style="color: #483d8b;">str</span>, age:<span style="color: #483d8b;">int</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36171;&#20540;&#26102;&#65292;&#35843;&#29992;&#25551;&#36848;&#22120;&#30340;set&#26041;&#27861;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

<span style="color: #483d8b;">print</span>(Person.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">{'cls': &lt;class '__main__.Person'&gt;}
</span><span style="color: #483d8b;">print</span>(Person.cls.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#30475;&#21040;&#28155;&#21152;&#31867;&#23646;&#24615;name, age. 'name': &lt;__main__.TypeCheck object at 0x000001FAF3268440&gt;, 'age': &lt;__main__.TypeCheck object at 0x000001FAF2DA7ED0&gt;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'cls': &lt;class '__main__.Person'&gt;}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'__module__': '__main__', '__firstlineno__': 25, '__init__': &lt;function Person.__init__ at 0x000001FAF32805E0&gt;, '__static_attributes__': ('age', 'name'), '__dict__': &lt;attribute '__dict__' of 'Person' objects&gt;, '__weakref__': &lt;attribute '__weakref__' of 'Person' objects&gt;, '__doc__': None, 'name': &lt;__main__.TypeCheck object at 0x000001FAF3268440&gt;, 'age': &lt;__main__.TypeCheck object at 0x000001FAF2DA7ED0&gt;}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> inspect

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">TypeCheck</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, pname, typ):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">pname</span> = pname
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">type</span> = typ

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'get ++++'</span>, <span style="color: #a020f0;">self</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return self.data
</span>        <span style="color: #a020f0;">if</span> instance: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22240;&#20026;&#25551;&#36848;&#22120;&#20063;&#21487;&#20197;&#36890;&#36807;&#31867;&#26469;&#35775;&#38382;&#65292;&#36825;&#37324;&#20570;&#19968;&#19979;&#21028;&#26029;
</span>            <span style="color: #a020f0;">return</span> instance.<span style="color: #483d8b;">__dict__</span>[<span style="color: #a020f0;">self</span>.pname]
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">raise TypeError
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__set__</span>(<span style="color: #a020f0;">self</span>, instance, value):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'set ~~~~'</span>, instance, value)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">self.data = value
</span>        <span style="color: #a020f0;">if</span> instance:
            <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(value, <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">type</span>):  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22788;&#29702;&#31867;&#22411;
</span>                instance.<span style="color: #483d8b;">__dict__</span>[<span style="color: #a020f0;">self</span>.pname] = value  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#34987;&#25130;&#32993;&#30340;&#23383;&#20856;&#65292;&#26041;&#27861;2 &#21033;&#29992;&#20256;&#21442;
</span>            <span style="color: #a020f0;">else</span>:
                <span style="color: #a020f0;">raise</span>  <span style="color: #228b22;">TypeError</span>(<span style="color: #8b2252;">'{} . {}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.pname, value))

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&lt;&#25551;&#36848;&#22120;TypeCheck {} id={}&gt;"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.pname, <span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">propsinject</span>(cls): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;&#31867;&#23545;&#35937;&#28155;&#21152;&#23646;&#24615;
</span>    <span style="color: #a0522d;">sig</span> = inspect.signature(cls)
    <span style="color: #a0522d;">params</span> = sig.parameters
    <span style="color: #a020f0;">for</span> name, param <span style="color: #a020f0;">in</span> params.items():
        <span style="color: #b22222;"># </span><span style="color: #b22222;">print(name, param.name, param.kind, param.annotation, param.default)
</span>        <span style="color: #a020f0;">if</span> param.annotation <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> param.empty:
            <span style="color: #483d8b;">setattr</span>(cls, name, TypeCheck(name, param.annotation))
    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#20540;&#26159;&#20160;&#20040;
</span>    <span style="color: #a020f0;">return</span> cls

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PropInject</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, cls):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">cls</span> = propsinject(cls)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__call__</span>(<span style="color: #a020f0;">self</span>, *args, **kwargs):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.cls(*args, **kwargs)

<span style="color: #228b22;">@PropInject</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #b22222;"># </span><span style="color: #b22222;">name = TypeCheck('name', str) #&#25163;&#21160;&#20256;&#20837;&#21517;&#31216;&#21644;&#31867;&#22411;&#65292;&#22909;&#21527;&#65311;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">age = TypeCheck('age', int)
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name:<span style="color: #483d8b;">str</span>, age:<span style="color: #483d8b;">int</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36171;&#20540;&#26102;&#65292;&#35843;&#29992;&#25551;&#36848;&#22120;&#30340;set&#26041;&#27861;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">age</span> = age

<span style="color: #a0522d;">p1</span> = Person(<span style="color: #8b2252;">'tom'</span>, 20)
<span style="color: #483d8b;">print</span>(p1.name, p1.age) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31867;&#22411;&#22788;&#29702;
</span><span style="color: #483d8b;">print</span>(p1.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#34987;&#25551;&#36848;&#22120;&#25130;&#32993;&#20102;&#65292;&#38656;&#35201;&#20570;&#25104;&#27491;&#24120;&#19968;&#26679;&#30340;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">set ~~~~ &lt;__main__.Person object at 0x0000020F4F548440&gt; tom
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">set ~~~~ &lt;__main__.Person object at 0x0000020F4F548440&gt; 20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">get ++++ &lt;&#25551;&#36848;&#22120;TypeCheck name id=2264778703600&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">get ++++ &lt;&#25551;&#36848;&#22120;TypeCheck age id=2264773721808&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">tom 20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'name': 'tom', 'age': 20}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:31ae878c-d759-409c-8547-3cf1a9dd9af5" class="outline-6">
<h6 id="h:31ae878c-d759-409c-8547-3cf1a9dd9af5">将前面的链表，封装成容器</h6>
<div class="outline-text-6" id="text-h:31ae878c-d759-409c-8547-3cf1a9dd9af5">
<p>
要求：提供__getitem__、__iter__、__setitem__方法
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Node</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, item, <span style="color: #483d8b;">next</span>=<span style="color: #008b8b;">None</span>, prev=<span style="color: #008b8b;">None</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">item</span> = item
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span> = <span style="color: #483d8b;">next</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">Node instance
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">prev</span> = prev <span style="color: #b22222;"># </span><span style="color: #b22222;">Node instance
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"{} &lt;== {} ==&gt; {}"</span>.<span style="color: #483d8b;">format</span>(
            <span style="color: #a020f0;">self</span>.prev.item <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.prev <span style="color: #a020f0;">else</span> <span style="color: #008b8b;">None</span>,
            <span style="color: #a020f0;">self</span>.item,
            <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span>.item <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">next</span> <span style="color: #a020f0;">else</span> <span style="color: #008b8b;">None</span>
        )

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">LinkedList</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_size</span> = 0

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">append</span>(<span style="color: #a020f0;">self</span>, value):
        <span style="color: #a0522d;">node</span> = Node(value) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#19968;&#20010;&#26159;None&#30340;&#32467;&#28857;
</span>
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.tail <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">empty
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = node
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">self</span>.tail.<span style="color: #483d8b;">next</span> = node
            node.<span style="color: #a0522d;">prev</span> = <span style="color: #a020f0;">self</span>.tail
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = node
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_size</span> += 1
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__add__</span>(<span style="color: #a020f0;">self</span>, item):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.append(item)

    <span style="color: #b22222;"># </span><span style="color: #b22222;">def insert(self, index, value):
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">if index &lt; 0:
</span>    <span style="color: #b22222;">#         </span><span style="color: #b22222;">raise IndexError('Wrong index. Not negative index {}'.format(index))
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">current = None
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">for i,node in enumerate(self.iternodes()):
</span>    <span style="color: #b22222;">#         </span><span style="color: #b22222;">if i == index:
</span>    <span style="color: #b22222;">#             </span><span style="color: #b22222;">current = node #&#25214;&#21040;&#20102;&#20301;&#32622;
</span>    <span style="color: #b22222;">#             </span><span style="color: #b22222;">break
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">else: #&#22914;&#26524;&#33021;&#25191;&#34892;self&#23376;&#21477;&#65292;&#35828;&#26126;&#65311; &#27809;&#26377;&#25214;&#21040;&#65292;&#36229;&#30028;&#20102;
</span>    <span style="color: #b22222;">#         </span><span style="color: #b22222;">return self.append(value) # &#27809;&#25214;&#21040;,&#24403;&#20570;&#23614;&#37096;&#36861;&#21152;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;"># &#25214;&#21040;&#20102;,&#23481;&#22120;&#38750;&#31354;&#65292;&#23601;&#20934;&#22791;&#22312;&#20013;&#38388;&#26576;&#20010;&#20301;&#32622;&#25554;&#20837;&#25968;&#25454;
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">newnode = Node(value)
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">prev = current.prev
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;"># next = current
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">#1 &#24320;&#22836;&#25554;&#20837;
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">if prev is None: # i==0  index==0  self.head==current
</span>    <span style="color: #b22222;">#         </span><span style="color: #b22222;">self.head = newnode
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">else: #2 &#38750;&#24320;&#22836;
</span>    <span style="color: #b22222;">#         </span><span style="color: #b22222;">newnode.prev = prev
</span>    <span style="color: #b22222;">#         </span><span style="color: #b22222;">prev.next = newnode
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">newnode.next = current
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">current.prev = newnode
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">self._size += 1
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">return self
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">insert</span>(<span style="color: #a020f0;">self</span>, index, value):
        <span style="color: #a020f0;">if</span> index &gt; <span style="color: #483d8b;">len</span>(<span style="color: #a020f0;">self</span>):
            <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.append(value)
        <span style="color: #a020f0;">if</span> index &lt; -<span style="color: #483d8b;">len</span>(<span style="color: #a020f0;">self</span>):
            <span style="color: #a0522d;">index</span> = 0

        <span style="color: #a0522d;">current</span> = <span style="color: #a020f0;">self</span>[index]

        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25214;&#21040;&#20102;,&#23481;&#22120;&#38750;&#31354;&#65292;&#23601;&#20934;&#22791;&#22312;&#20013;&#38388;&#26576;&#20010;&#20301;&#32622;&#25554;&#20837;&#25968;&#25454;
</span>        <span style="color: #a0522d;">newnode</span> = Node(value)
        <span style="color: #a0522d;">prev</span> = current.prev
        <span style="color: #b22222;"># </span><span style="color: #b22222;">next = current
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">1 &#24320;&#22836;&#25554;&#20837;
</span>        <span style="color: #a020f0;">if</span> prev <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">i==0  index==0  self.head==current
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = newnode
        <span style="color: #a020f0;">else</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">2 &#38750;&#24320;&#22836;
</span>            newnode.<span style="color: #a0522d;">prev</span> = prev
            prev.<span style="color: #483d8b;">next</span> = newnode
        newnode.<span style="color: #483d8b;">next</span> = current
        current.<span style="color: #a0522d;">prev</span> = newnode
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_size</span> += 1
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">pop</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.tail <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">Exception</span>(<span style="color: #8b2252;">"empty"</span>)

        <span style="color: #a0522d;">tail</span> = <span style="color: #a020f0;">self</span>.tail <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24403;&#21069;&#23614;&#24052;&#20803;&#32032;
</span>        <span style="color: #a0522d;">prev</span> = tail.prev <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21069;&#23614;&#24052;&#19968;&#20010;&#20803;&#32032;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">1 only one &#25913;&#22836;&#23614;; 2 &#19981;&#27490;&#19968;&#20010;&#65292;&#25913;&#23614;
</span>        <span style="color: #a020f0;">if</span> prev <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">self.head.next is None
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = <span style="color: #008b8b;">None</span>
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">else</span>:
            prev.<span style="color: #483d8b;">next</span> = <span style="color: #008b8b;">None</span>
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = prev

        <span style="color: #a0522d;">value</span> = tail.item
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_size</span> -= 1
        <span style="color: #a020f0;">return</span> value

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">remove</span>(<span style="color: #a020f0;">self</span>, index):
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.tail <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">Exception</span>(<span style="color: #8b2252;">"empty"</span>)

        <span style="color: #a0522d;">current</span> = <span style="color: #a020f0;">self</span>[index]

        <span style="color: #a0522d;">prev</span> = current.prev <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#21069;&#34987;&#31227;&#38500;&#33410;&#28857;&#30340;&#19978;&#19968;&#20010;
</span>        <span style="color: #483d8b;">next</span> = current.<span style="color: #483d8b;">next</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#21069;&#34987;&#31227;&#38500;&#33410;&#28857;&#30340;&#19979;&#19968;&#20010;
</span>
        <span style="color: #a020f0;">if</span> prev <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span> <span style="color: #a020f0;">and</span> <span style="color: #483d8b;">next</span> <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#26377;&#19968;&#20010; # self.head == self.tail
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = <span style="color: #008b8b;">None</span>
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">elif</span> prev <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22836;&#37096;&#31227;&#38500;
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">head</span> = <span style="color: #483d8b;">next</span>
            <span style="color: #483d8b;">next</span>.<span style="color: #a0522d;">prev</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">elif</span> <span style="color: #483d8b;">next</span> <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23614;&#37096;&#31227;&#38500;
</span>            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">tail</span> = prev
            prev.<span style="color: #483d8b;">next</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">else</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20013;&#38388;&#31227;&#38500;
</span>            prev.<span style="color: #483d8b;">next</span> = <span style="color: #483d8b;">next</span>
            <span style="color: #483d8b;">next</span>.<span style="color: #a0522d;">prev</span> = prev

        <span style="color: #b22222;"># </span><span style="color: #b22222;">del current # &#21024;&#38500;&#20020;&#26102;&#21464;&#37327;,&#20943;&#23569;&#24341;&#29992;&#35745;&#25968;,&#37322;&#25918;&#20869;&#23384;
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_size</span> -= 1

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">iternodes</span>(<span style="color: #a020f0;">self</span>, reverse=<span style="color: #008b8b;">False</span>):
        <span style="color: #a0522d;">current</span> = <span style="color: #a020f0;">self</span>.tail <span style="color: #a020f0;">if</span> reverse <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">self</span>.head
        <span style="color: #a020f0;">while</span> current:
            <span style="color: #a020f0;">yield</span> current
            <span style="color: #a0522d;">current</span> = current.prev <span style="color: #a020f0;">if</span> reverse <span style="color: #a020f0;">else</span> current.<span style="color: #483d8b;">next</span>

    <span style="color: #b22222;"># </span><span style="color: #b22222;">@property
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">def size(self):
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">return self._size
</span>    <span style="color: #a0522d;">size</span> = <span style="color: #483d8b;">property</span>(<span style="color: #a020f0;">lambda</span> <span style="color: #a020f0;">self</span>: <span style="color: #a020f0;">self</span>._size)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23481;&#22120;&#21270;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__len__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.size

    <span style="color: #b22222;"># </span><span style="color: #b22222;">def __iter__(self): #&#36845;&#20195;&#22120;
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">return self.iternodes()
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">yield from self.iternodes()
</span>
    <span style="color: #a0522d;">__iter__</span> = iternodes <span style="color: #b22222;">#</span><span style="color: #b22222;">&#39640;&#25163;&#20889;&#27861; #self.__iter__() self.iternodes()
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__reversed__</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21453;&#21521;&#36941;&#21382;
</span>        <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">from</span> <span style="color: #a020f0;">self</span>.iternodes(reverse=<span style="color: #008b8b;">True</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return self.iternodes(True)
</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">def __getitem__(self, index):
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">#&#20551;&#35774; index &gt;= 0 &#27491;&#21521;&#36229;&#30028;
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">if index &gt;= len(self):
</span>    <span style="color: #b22222;">#         </span><span style="color: #b22222;">raise IndexError('Wrong Index {}'.format(index))
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">#&#27809;&#26377;&#27491;&#21521;&#36229;&#30028;
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">for i,node in enumerate(self.iternodes()):
</span>    <span style="color: #b22222;">#         </span><span style="color: #b22222;">if i == index:
</span>    <span style="color: #b22222;">#             </span><span style="color: #b22222;">return node
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">######
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">if index &lt; -len(self):
</span>    <span style="color: #b22222;">#         </span><span style="color: #b22222;">raise IndexError('Wrong Index {}'.format(index))
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">for i,node in enumerate(self.iternodes(reverse=True)):
</span>    <span style="color: #b22222;">#         </span><span style="color: #b22222;">if i == -index:
</span>    <span style="color: #b22222;">#             </span><span style="color: #b22222;">return node
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__getitem__</span>(<span style="color: #a020f0;">self</span>, index):
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20551;&#35774; index &gt;= 0 &#27491;&#21521;&#25110;&#36127;&#21521;&#36229;&#30028;
</span>        <span style="color: #a020f0;">if</span> index &gt;= <span style="color: #483d8b;">len</span>(<span style="color: #a020f0;">self</span>) <span style="color: #a020f0;">or</span> index &lt; -<span style="color: #483d8b;">len</span>(<span style="color: #a020f0;">self</span>):
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">IndexError</span>(<span style="color: #8b2252;">'Wrong Index {}'</span>.<span style="color: #483d8b;">format</span>(index))
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27809;&#26377;&#27491;&#21521;&#36229;&#30028;
</span>        <span style="color: #a0522d;">reverse</span> = <span style="color: #008b8b;">True</span> <span style="color: #a020f0;">if</span> index &lt; 0 <span style="color: #a020f0;">else</span> <span style="color: #008b8b;">False</span>
        <span style="color: #a0522d;">start</span> = 1 <span style="color: #a020f0;">if</span> index &lt; 0 <span style="color: #a020f0;">else</span> 0

        <span style="color: #a020f0;">for</span> i, node <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">enumerate</span>(<span style="color: #a020f0;">self</span>.iternodes(reverse), start):  <span style="color: #b22222;"># </span><span style="color: #b22222;">index &gt;=0
</span>            <span style="color: #a020f0;">if</span> i == <span style="color: #483d8b;">abs</span>(index):
                <span style="color: #a020f0;">return</span> node

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__setitem__</span>(<span style="color: #a020f0;">self</span>, index, value):
        <span style="color: #a020f0;">self</span>[index].<span style="color: #a0522d;">item</span> = value

<span style="color: #a0522d;">ll</span> = LinkedList() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23454;&#20363;&#21270;
</span>ll.append(1).append(2).append(3)
<span style="color: #483d8b;">print</span>(*ll)
<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">reversed</span>(ll):
    <span style="color: #483d8b;">print</span>(x)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #483d8b;">print</span>(ll[1])
<span style="color: #483d8b;">print</span>(ll[-1], ll[-3])
<span style="color: #a0522d;">ll</span>[-3] = 100
<span style="color: #483d8b;">print</span>(*ll)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
ll.insert(-10, <span style="color: #8b2252;">'start'</span>).insert(100,<span style="color: #8b2252;">'end'</span>)
<span style="color: #483d8b;">print</span>(*ll)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">None &lt;== 1 ==&gt; 2 1 &lt;== 2 ==&gt; 3 2 &lt;== 3 ==&gt; None
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2 &lt;== 3 ==&gt; None
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1 &lt;== 2 ==&gt; 3
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">None &lt;== 1 ==&gt; 2
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1 &lt;== 2 ==&gt; 3
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2 &lt;== 3 ==&gt; None None &lt;== 1 ==&gt; 2
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">None &lt;== 100 ==&gt; 2 100 &lt;== 2 ==&gt; 3 2 &lt;== 3 ==&gt; None
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">==============================
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">None &lt;== start ==&gt; 100 start &lt;== 100 ==&gt; 2 100 &lt;== 2 ==&gt; 3 2 &lt;== 3 ==&gt; end 3 &lt;== end ==&gt; None</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:1130a306-08c8-4691-b08d-433437353bcf" class="outline-6">
<h6 id="h:1130a306-08c8-4691-b08d-433437353bcf">进阶</h6>
<div class="outline-text-6" id="text-h:1130a306-08c8-4691-b08d-433437353bcf">
<p>
实现类property装饰器，类名称为Property.
</p>

<p>
基本结构如下，是一个数据描述器。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Property</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, fget, fset=<span style="color: #008b8b;">None</span>):
        <span style="color: #a020f0;">pass</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #a020f0;">pass</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__set__</span>(<span style="color: #a020f0;">self</span>, instance, value):
        <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, data):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_data</span> = data

    <span style="color: #228b22;">@Property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">data</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._data

    <span style="color: #228b22;">@data.setter</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">data</span>(<span style="color: #a020f0;">self</span>, value):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_data</span> = value
</pre>
</div>

<p>
内置实例
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_x</span> = x

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">x</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._x

    <span style="color: #228b22;">@x.setter</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">x</span>(<span style="color: #a020f0;">self</span>, value):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_x</span> = value

<span style="color: #a0522d;">a</span> = A(5)
<span style="color: #483d8b;">print</span>(a.x)
<span style="color: #483d8b;">print</span>(a.<span style="color: #483d8b;">__dict__</span>)
a.<span style="color: #a0522d;">x</span> = 100
<span style="color: #483d8b;">print</span>(a.x)
<span style="color: #483d8b;">print</span>(a.<span style="color: #483d8b;">__dict__</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">5
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'_x': 5}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">100
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'_x': 100}</span>
</pre>
</div>

<p>
实现一样的功能
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Property</span>:  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25968;&#25454;&#25551;&#36848;&#22120;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, fn):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__fn</span> = fn

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'get ~~~~'</span>, instance)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'**** {} ****'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.__fn))  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26159;&#26222;&#36890;&#20989;&#25968;A.x, &#27809;&#26377;&#32465;&#23450;&#25928;&#26524;
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__fn(instance)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__set__</span>(<span style="color: #a020f0;">self</span>, instance, value):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'set ~~~~'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_x</span> = x

    <span style="color: #b22222;"># </span><span style="color: #b22222;">x = Property(x)
</span>    <span style="color: #228b22;">@Property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">x</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#20215;&#24335; x = Property(x) #a.x()
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._x

    <span style="color: #b22222;"># </span><span style="color: #b22222;">@x.setter
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">def x(self, value):
</span>    <span style="color: #b22222;">#     </span><span style="color: #b22222;">self._x = value
</span>
<span style="color: #a0522d;">a</span> = A(5)
<span style="color: #483d8b;">print</span>(a.x)
<span style="color: #483d8b;">print</span>(a.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">a.x = 100
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(a.x)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(a.__dict__)
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">get ~~~~ &lt;__main__.A object at 0x0000016DD9CE4EC0&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">**** &lt;function A.x at 0x0000016DD9D1F1A0&gt; ****
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">5
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'_x': 5}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Property</span>:  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25968;&#25454;&#25551;&#36848;&#22120;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, fget, fset=<span style="color: #008b8b;">None</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">fget</span> = fget
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">fset</span> = fset

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__get__</span>(<span style="color: #a020f0;">self</span>, instance, owner):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'get ~~~~'</span>, instance)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'**** {} ****'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.fget))  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26159;&#26222;&#36890;&#20989;&#25968;A.x, &#27809;&#26377;&#32465;&#23450;&#25928;&#26524;
</span>        <span style="color: #a020f0;">if</span> instance:
            <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.fget(instance)
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">None</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__set__</span>(<span style="color: #a020f0;">self</span>, instance, value):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'set ~~~~'</span>)
        <span style="color: #a020f0;">if</span> instance:
            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.fset <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
                <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">AttributeError</span>(<span style="color: #8b2252;">'&#19981;&#33021;&#20462;&#25913;'</span>)
            <span style="color: #a020f0;">else</span>:
                <span style="color: #a020f0;">self</span>.fset(instance, value)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">setter</span>(<span style="color: #a020f0;">self</span>, fn):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">fset</span> = fn
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>


<span style="color: #b22222;"># </span><span style="color: #b22222;">property
</span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_x</span> = x

    <span style="color: #b22222;"># </span><span style="color: #b22222;">x = Property(x)
</span>    <span style="color: #228b22;">@Property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">x</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#20215;&#24335; x = Property(x, None) #a.x()
</span>        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._x

    <span style="color: #b22222;"># </span><span style="color: #b22222;">x = x.setter(x) #x &#24212;&#35813;&#26159;&#20160;&#20040;&#65311; &#24517;&#39035;&#26159;Property&#23454;&#20363;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">x = Property&#23454;&#20363;.setter(x)
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">x = Property&#23454;&#20363;
</span>    <span style="color: #228b22;">@x.setter</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">x</span>(<span style="color: #a020f0;">self</span>, value): <span style="color: #b22222;">#</span><span style="color: #b22222;">x = x.setter(x)
</span>        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_x</span> = value

<span style="color: #a0522d;">a</span> = A(5)
<span style="color: #483d8b;">print</span>(a.x)
<span style="color: #483d8b;">print</span>(a.<span style="color: #483d8b;">__dict__</span>)
a.<span style="color: #a0522d;">x</span> = 5000
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(a.x)
</span><span style="color: #483d8b;">print</span>(a.<span style="color: #483d8b;">__dict__</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">get ~~~~ &lt;__main__.A object at 0x0000017CE52F4D70&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">**** &lt;function A.x at 0x0000017CE532F240&gt; ****
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">5
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'_x': 5}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">set ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'_x': 5000}</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:0ed19208-d8b0-47d2-9edc-90d9db698598" class="outline-4">
<h4 id="h:0ed19208-d8b0-47d2-9edc-90d9db698598">其他杂项</h4>
<div class="outline-text-4" id="text-h:0ed19208-d8b0-47d2-9edc-90d9db698598">
</div>
<div id="outline-container-h:84860742-4f8e-43de-99bb-ab08377397c7" class="outline-5">
<h5 id="h:84860742-4f8e-43de-99bb-ab08377397c7">trancemalloc</h5>
<div class="outline-text-5" id="text-h:84860742-4f8e-43de-99bb-ab08377397c7">
<p>
标准库trancemalloc，可以统计内存使用情况
</p>

<p>
<a href="https://docs.python.org/3/library/tracemalloc.html">https://docs.python.org/3/library/tracemalloc.html</a>
</p>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> tracemalloc <span style="color: #b22222;"># </span><span style="color: #b22222;">from 3.4
</span>
tracemalloc.start() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24320;&#22987;&#36319;&#36394;&#20869;&#23384;&#20998;&#37197;
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">... run your application ...
</span><span style="color: #a0522d;">count</span> = 1000000
<span style="color: #b22222;"># </span><span style="color: #b22222;">count = 2
</span><span style="color: #a0522d;">d</span> = [<span style="color: #483d8b;">dict</span>(<span style="color: #483d8b;">zip</span>(<span style="color: #8b2252;">'xy'</span>,(5, 6))) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(count)] <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23481;&#22120;&#37324;&#25918;&#20102;&#33509;&#24178;&#23383;&#20856; 184MiB [{'x': 5, 'y': 6}, {'x': 5, 'y': 6}]
</span><span style="color: #a0522d;">t</span> = [<span style="color: #483d8b;">tuple</span>(<span style="color: #483d8b;">zip</span>(<span style="color: #8b2252;">'xy'</span>,(5, 6))) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(count)] <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23481;&#22120;&#37324;&#25918;&#20102;&#33509;&#24178;&#20803;&#32452; 168MiB [(('x', 5), ('y', 6)), (('x', 5), ('y', 6))]
</span>
<span style="color: #a0522d;">snapshot</span> = tracemalloc.take_snapshot() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24555;&#29031;&#65292;&#24403;&#21069;&#20869;&#23384;&#20998;&#37197;
</span><span style="color: #a0522d;">top_stats</span> = snapshot.statistics(<span style="color: #8b2252;">'lineno'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24555;&#29031;&#23545;&#35937;&#30340;&#32479;&#35745;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">filename&#65306;&#32479;&#35745;&#25972;&#20010;&#25991;&#20214;&#20869;&#23384;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">lineno&#65306;&#20998;&#24320;&#32479;&#35745;
</span>
<span style="color: #a020f0;">for</span> stat <span style="color: #a020f0;">in</span> top_stats:
    <span style="color: #483d8b;">print</span>(stat)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">D:\project\pyproj\t1.py:8: size=184 MiB, count=1999998, average=96 B
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">D:\project\pyproj\t1.py:9: size=168 MiB, count=3000004, average=59 B
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">D:\project\pyproj\t1.py:6: size=400 B, count=1, average=400 B
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">D:\py\python3130\Lib\tracemalloc.py:558: size=56 B, count=1, average=56 B</span>
</pre>
</div>

<p>
所以可以得知内存使用上字典还是较为占用空间的
</p>
</div>
</div>
<div id="outline-container-h:75e9d916-d017-4ed6-ada8-1af9f56ff467" class="outline-5">
<h5 id="h:75e9d916-d017-4ed6-ada8-1af9f56ff467"><code>__slots__</code></h5>
<div class="outline-text-5" id="text-h:75e9d916-d017-4ed6-ada8-1af9f56ff467">
</div>
<div id="outline-container-h:1056c072-9cd1-415f-a1b6-1d9030e276f1" class="outline-6">
<h6 id="h:1056c072-9cd1-415f-a1b6-1d9030e276f1">问题的引出</h6>
<div class="outline-text-6" id="text-h:1056c072-9cd1-415f-a1b6-1d9030e276f1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = 4
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">y</span> = 5

<span style="color: #a0522d;">a</span> = A()
<span style="color: #483d8b;">print</span>(a.x, a.y)
<span style="color: #483d8b;">print</span>(a.<span style="color: #483d8b;">__dict__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">{'x': 4, 'y': 5} &#22914;&#26524;&#26377;100&#20010; &#23454;&#20363;&#21602;&#65311; &#24590;&#26679;&#20445;&#23384;&#25968;&#25454;&#26356;&#30465;&#20869;&#23384;&#65311; &#20803;&#32452;</span>
</pre>
</div>

<ul class="org-ul">
<li>字典为了提升查询效率，必须用空间换时间</li>
<li>一般来说一个实例，属性多一点，都存储在字典中便于查询，问题不大</li>
<li>但是如果数百万个实例，那么字典占的总空间就有点大</li>
<li>Python提供了__slots__可以把属性字典__dict__省略</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a0522d;">M</span> = <span style="color: #8b2252;">'MN'</span>
    <span style="color: #a0522d;">__slots__</span> = (<span style="color: #8b2252;">'x'</span>, <span style="color: #8b2252;">'y'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20803;&#32452;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">__slots__ = ['x', 'y']  # &#31561;&#21516;&#19978;&#38754;
</span>    <span style="color: #b22222;"># </span><span style="color: #b22222;">__slots__ = 'x', 'y'  # &#31561;&#21516;&#19978;&#38754;. &#31867;&#23646;&#24615;&#65292;&#25511;&#21046;&#23454;&#20363;&#30340;&#23646;&#24615;&#12290;&#22914;&#26524;&#25552;&#20379;&#20102;&#35813;&#31867;&#23646;&#24615;&#65292;&#21017;&#23454;&#20363;&#23383;&#20856;&#40664;&#35748;&#21462;&#28040;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = 4
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">y</span> = 5

<span style="color: #a0522d;">a</span> = A()
<span style="color: #483d8b;">print</span>(a.x, a.y)
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(a.__dict__) #{'x': 4, 'y': 5}
</span><span style="color: #483d8b;">print</span>(a.M)
<span style="color: #b22222;"># </span><span style="color: #b22222;">a.z = 200 #&#19981;&#21487;&#20197;&#65292;&#22240;&#20026;z&#23646;&#24615;&#19981;&#20801;&#35768;
</span>a.<span style="color: #a0522d;">x</span> = 100
<span style="color: #483d8b;">print</span>(a.x)
<span style="color: #483d8b;">print</span>(a.__slots__)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">4 5
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">MN
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">100
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('x', 'y')</span>
</pre>
</div>

<ul class="org-ul">
<li>__slots__告诉解释器，实例的属性都叫什么，一般来说，既然要节约内存，最好还是使用元组比较好</li>
<li>一旦类提供了__slots__，就阻止实例产生__dict__来保存实例的属性</li>
</ul>


<p>
动态增加属性
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#20026;&#23454;&#20363;&#21160;&#24577;&#22686;&#21152;&#23646;&#24615;
</span>a.<span style="color: #a0522d;">newx</span> = 5 <span style="color: #b22222;"># </span><span style="color: #b22222;">AttributeError: 'A' object has no attribute 'newx'
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20026;&#31867;&#21160;&#24577;&#22686;&#21152;&#23646;&#24615;
</span>A.<span style="color: #a0522d;">newx</span> = 5 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25253;&#38169;&#65292;&#22240;&#20026;&#26159;&#31867;&#23646;&#24615;</span>
</pre>
</div>

<p>
说明实例不可以动态增加属性，而类可以
</p>
</div>
</div>
<div id="outline-container-h:8074fe44-b418-4d7b-bd61-792240bf1223" class="outline-6">
<h6 id="h:8074fe44-b418-4d7b-bd61-792240bf1223">继承</h6>
<div class="outline-text-6" id="text-h:8074fe44-b418-4d7b-bd61-792240bf1223">
<p>
使用继承，看看__slots__是否会继承
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a0522d;">M</span> = <span style="color: #8b2252;">'MN'</span>
    <span style="color: #a0522d;">__slots__</span> = <span style="color: #8b2252;">'_x'</span>, <span style="color: #8b2252;">'_y'</span>  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#31561;&#21516;&#19978;&#38754;. &#31867;&#23646;&#24615;&#65292;&#25511;&#21046;&#23454;&#20363;&#30340;&#23646;&#24615;&#12290;&#22914;&#26524;&#25552;&#20379;&#20102;&#35813;&#31867;&#23646;&#24615;&#65292;&#21017;&#23454;&#20363;&#23383;&#20856;&#40664;&#35748;&#21462;&#28040;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_x</span> = 4
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_y</span> = 5

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">x</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._x

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>(A): <span style="color: #b22222;"># </span><span style="color: #b22222;">__slots__ &#19981;&#32487;&#25215;
</span>    <span style="color: #a020f0;">pass</span>

<span style="color: #a0522d;">a</span> = A()
<span style="color: #b22222;"># </span><span style="color: #b22222;">a.z = 300 #&#19981;&#21487;&#20197;
</span>
<span style="color: #a0522d;">b</span> = B()
b.<span style="color: #a0522d;">z</span> = 200
<span style="color: #483d8b;">print</span>(b.z)
<span style="color: #483d8b;">print</span>(b.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #483d8b;">print</span>(b.x)
<span style="color: #483d8b;">print</span>(b._y)
b.<span style="color: #a0522d;">_y</span> = 400
<span style="color: #483d8b;">print</span>(b.<span style="color: #483d8b;">__dict__</span>)
<span style="color: #483d8b;">print</span>(b._y)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">200
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'z': 200}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">4
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">5
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'z': 200}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">400</span>
</pre>
</div>

<p>
结果表明，__slots__不影响子类实例，不会继承下去，除非子类里面自己也定义了__slots__
</p>
</div>
</div>
<div id="outline-container-h:0662bdda-b814-4c76-b9ae-ff6bf2f405f3" class="outline-6">
<h6 id="h:0662bdda-b814-4c76-b9ae-ff6bf2f405f3">应用场景</h6>
<div class="outline-text-6" id="text-h:0662bdda-b814-4c76-b9ae-ff6bf2f405f3">
<p>
使用需要构建在数百万以上众多对象，且内存容量较为紧张，实例的属性简单、固定且不用动态增加的场景
</p>

<p>
可以使用tracemalloc看看内存使用的差异。
</p>

<p>
建议使用stats = snapshot.statistics('filename')查看总内存使用
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> tracemalloc

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a0522d;">M</span> = <span style="color: #8b2252;">'MN'</span>
    <span style="color: #a0522d;">__slots__</span> = <span style="color: #8b2252;">'_x'</span>, <span style="color: #8b2252;">'_y'</span>  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#31561;&#21516;&#19978;&#38754;. &#31867;&#23646;&#24615;&#65292;&#25511;&#21046;&#23454;&#20363;&#30340;&#23646;&#24615;&#12290;&#22914;&#26524;&#25552;&#20379;&#20102;&#35813;&#31867;&#23646;&#24615;&#65292;&#21017;&#23454;&#20363;&#23383;&#20856;&#40664;&#35748;&#21462;&#28040;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_x</span> = 4
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_y</span> = 5

<span style="color: #b22222;"># </span><span style="color: #b22222;">print(a.__dict__) #{'x': 4, 'y': 5} &#22914;&#26524;&#26377;100&#20010; &#23454;&#20363;&#21602;&#65311; &#24590;&#26679;&#20445;&#23384;&#25968;&#25454;&#26356;&#30465;&#20869;&#23384;&#65311; &#20803;&#32452;
</span>
tracemalloc.start()

<span style="color: #a0522d;">instances</span> = [A() <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(1000000)] <span style="color: #b22222;">#</span><span style="color: #b22222;">100&#19975;&#20010;&#23454;&#20363;&#23383;&#20856; 92.0 MiB ,&#20351;&#29992;__slots__ 53.8 MiB
</span>
<span style="color: #a0522d;">snapshot</span> = tracemalloc.take_snapshot() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24555;&#29031;&#65292;&#24403;&#21069;&#20869;&#23384;&#20998;&#37197;
</span><span style="color: #a0522d;">top_stats</span> = snapshot.statistics(<span style="color: #8b2252;">'lineno'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24555;&#29031;&#23545;&#35937;&#30340;&#32479;&#35745;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">filename&#65306;&#32479;&#35745;&#25972;&#20010;&#25991;&#20214;&#20869;&#23384;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">lineno&#65306;&#20998;&#24320;&#32479;&#35745;
</span>
<span style="color: #a020f0;">for</span> stat <span style="color: #a020f0;">in</span> top_stats:
    <span style="color: #483d8b;">print</span>(stat)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#20351;&#29992;__slots__ &#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">D:\project\pyproj\t1.py:15: size=92.0 MiB, count=1000001, average=96 B
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">D:\py\python3130\Lib\tracemalloc.py:558: size=56 B, count=1, average=56 B
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;__slots__ &#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">D:\project\pyproj\t1.py:15: size=53.8 MiB, count=1000001, average=56 B
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">D:\py\python3130\Lib\tracemalloc.py:558: size=56 B, count=1, average=56 B
</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#24212;&#29992;&#22330;&#26223;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1 &#23454;&#20363;&#23646;&#24615;&#31616;&#21333;&#65292;&#22266;&#23450;&#65292;&#24456;&#23569;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2 &#22823;&#37327;&#20351;&#29992;&#65292;&#22914;100&#19975;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">3 &#20869;&#23384;&#32039;&#24352;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:fc92e7b5-32bb-4763-88b5-30f5fba243b2" class="outline-5">
<h5 id="h:fc92e7b5-32bb-4763-88b5-30f5fba243b2">未实现和未实现异常</h5>
<div class="outline-text-5" id="text-h:fc92e7b5-32bb-4763-88b5-30f5fba243b2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #483d8b;">print</span>(<span style="color: #008b8b;">NotImplemented</span>, <span style="color: #483d8b;">type</span>(<span style="color: #008b8b;">NotImplemented</span>)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26410;&#23454;&#29616;&#65292;&#20540; NotImplemented &lt;class 'NotImplementedType'&gt;
</span><span style="color: #483d8b;">print</span>(<span style="color: #228b22;">NotImplementedError</span>, <span style="color: #483d8b;">type</span>(<span style="color: #228b22;">NotImplementedError</span>)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24322;&#24120;&#31867; &lt;class 'NotImplementedError'&gt; &lt;class 'type'&gt;
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #008b8b;">None</span>, <span style="color: #483d8b;">type</span>(<span style="color: #008b8b;">None</span>)) <span style="color: #b22222;">#</span><span style="color: #b22222;">None &lt;class 'NoneType'&gt;
</span>
<span style="color: #a020f0;">try</span>:
    <span style="color: #b22222;"># </span><span style="color: #b22222;">raise NotImplemented # raise&#21518;&#24212;&#35813;&#25918;&#20010;&#24322;&#24120;&#31867;&#65292;&#19981;&#26159;BaseException&#30340;&#23376;&#31867;&#12290; TypeError: exceptions must derive from BaseException
</span>    <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">NotImplementedError</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25243;&#20986; &#26410;&#23454;&#29616;&#24322;&#24120;
</span><span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#26377;&#24322;&#24120;'</span>, e)
</pre>
</div>

<ul class="org-ul">
<li>NotImplemented是个值，单值，是NotImplementedType的实例</li>
<li>NotImplementedError是类型，是异常类，返回type</li>
</ul>
</div>
</div>
<div id="outline-container-h:e2bdc36d-000d-405e-a52d-d9e88b2469f6" class="outline-5">
<h5 id="h:e2bdc36d-000d-405e-a52d-d9e88b2469f6">运算符重载中的反向方法</h5>
<div class="outline-text-5" id="text-h:e2bdc36d-000d-405e-a52d-d9e88b2469f6">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__add__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'add~~~~'</span>)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.x + other.x

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__iadd__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'iadd~~~~'</span>)
        <span style="color: #a020f0;">return</span> A(<span style="color: #a020f0;">self</span>.x + other.x)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__radd__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'radd~~~~'</span>)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.x + other.x

<span style="color: #a0522d;">a</span> = A(4)
<span style="color: #a0522d;">b</span> = A(5)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(a), <span style="color: #483d8b;">id</span>(b))
<span style="color: #483d8b;">print</span>(a + b) <span style="color: #b22222;">#</span><span style="color: #b22222;">add 9  a.__add__(b)
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(a), <span style="color: #483d8b;">id</span>(b))
<span style="color: #a0522d;">a</span> += b <span style="color: #b22222;">#</span><span style="color: #b22222;">iadd #A(9)
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(a), <span style="color: #483d8b;">id</span>(b))
<span style="color: #483d8b;">print</span>(b + a) <span style="color: #b22222;">#</span><span style="color: #b22222;">add 14  b.__add__(a)
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1882495745200 1882498364304
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">add~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">9
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1882495745200 1882498364304
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">iadd~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1882498364624 1882498364304
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">add~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">14</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__add__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'add~~~~'</span>, <span style="color: #a020f0;">self</span>, other)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.x + other.x

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__iadd__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'iadd~~~~'</span>)
        <span style="color: #a020f0;">return</span> A(<span style="color: #a020f0;">self</span>.x + other.x)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__radd__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'radd~~~~'</span>)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.x + other.x

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;A {}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.x)

<span style="color: #a0522d;">a</span> = A(4)
<span style="color: #a0522d;">b</span> = A(5)
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(a + b) #add 9  a.__add__(b)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(b + a) #add 14  b.__add__(a)
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #483d8b;">print</span>(a + 1) <span style="color: #b22222;">#</span><span style="color: #b22222;">a.__add__(1)
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">add~~~~ &lt;A 4&gt; 1
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Traceback (most recent call last):
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">File "D:\project\pyproj\t1.py", line 25, in &lt;module&gt;
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">print(a + 1)
</span><span style="color: #b22222;">#           </span><span style="color: #b22222;">~~^~~
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">File "D:\project\pyproj\t1.py", line 7, in __add__
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">return self.x + other.x
</span><span style="color: #b22222;">#                     </span><span style="color: #b22222;">^^^^^^^
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">AttributeError: 'int' object has no attribute 'x'</span>
</pre>
</div>

<p>
上面可以的看到，1是没有x属性的。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__add__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'add~~~~'</span>, <span style="color: #a020f0;">self</span>, other)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.x + other.x

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__iadd__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'iadd~~~~'</span>)
        <span style="color: #a020f0;">return</span> A(<span style="color: #a020f0;">self</span>.x + other.x)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__radd__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'radd~~~~'</span>)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.x + other.x

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;A {}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.x)

<span style="color: #a0522d;">a</span> = A(4)
<span style="color: #a0522d;">b</span> = A(5)
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(a + b) #add 9  a.__add__(b)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(b + a) #add 14  b.__add__(a)
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(a + 1) #a.__add__(1)
</span><span style="color: #483d8b;">print</span>(1 + a) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35843;&#29992;radd
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">radd~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">Traceback (most recent call last):
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">File "D:\project\pyproj\t1.py", line 26, in &lt;module&gt;
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">print(1 + a)
</span><span style="color: #b22222;">#           </span><span style="color: #b22222;">~~^~~
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">File "D:\project\pyproj\t1.py", line 15, in __radd__
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">return self.x + other.x
</span><span style="color: #b22222;">#                     </span><span style="color: #b22222;">^^^^^^^
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">AttributeError: 'int' object has no attribute 'x'</span>
</pre>
</div>

<p>
为什么会报错：
</p>
<ul class="org-ul">
<li>1 + a等价于1.__add__(a)，也就是int.__add__(1, a)，而int类型实现了__add__方法，做了特殊处理，转而调用了后面的实例的魔术方法 实例a的__radd__方法</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">int</span>.__add__(1, 2)) <span style="color: #b22222;">#</span><span style="color: #b22222;">3 int&#31867;&#22411;&#23454;&#29616;&#20102; + += - &#36825;&#20123;&#26041;&#27861;
</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__radd__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'radd~~~~'</span>)
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'radd^^^^'</span>

<span style="color: #a0522d;">a</span> = A(4)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'abc'</span> + a) <span style="color: #b22222;">#</span><span style="color: #b22222;">str.__add__('abc', a)
</span><span style="color: #483d8b;">print</span>([] + a) <span style="color: #b22222;">#</span><span style="color: #b22222;">list.__add__([], a) &#20869;&#24314;&#25968;&#25454;&#31867;&#22411;</span>
</pre>
</div>

<p>
分析下面例子代码
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__add__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'add~~~~'</span>, <span style="color: #a020f0;">self</span>, other)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.x + other.x

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__iadd__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'iadd~~~~'</span>)
        <span style="color: #a020f0;">return</span> A(<span style="color: #a020f0;">self</span>.x + other.x)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__radd__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'radd~~~~'</span>, <span style="color: #a020f0;">self</span>, other)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.x + other.x

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;A {}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.x)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x

    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35201;&#20040;&#26159;&#26410;&#23454;&#29616;&#65292;&#35201;&#20040;&#26159;&#26410;&#23454;&#29616;&#24322;&#24120;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;B {}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.x)

<span style="color: #a0522d;">a</span> = A(4)
<span style="color: #a0522d;">b</span> = B(10)
<span style="color: #483d8b;">print</span>(a + b) <span style="color: #b22222;">#</span><span style="color: #b22222;">a.__add__(b)
</span><span style="color: #483d8b;">print</span>(b + a) <span style="color: #b22222;">#</span><span style="color: #b22222;">b.__add__(a) ? a.__radd__(?)
</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">add~~~~ &lt;A 4&gt; &lt;B 10&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">14
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">radd~~~~ &lt;A 4&gt; &lt;B 10&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">14</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__add__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'add~~~~'</span>, <span style="color: #a020f0;">self</span>, other)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.x + other.x

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__iadd__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'iadd~~~~'</span>)
        <span style="color: #a020f0;">return</span> A(<span style="color: #a020f0;">self</span>.x + other.x)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__radd__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'radd~~~~'</span>, <span style="color: #a020f0;">self</span>, other)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.x + other.x

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;A {}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.x)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x

    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35201;&#20040;&#26159;&#26410;&#23454;&#29616;&#65292;&#35201;&#20040;&#26159;&#26410;&#23454;&#29616;&#24322;&#24120;
</span>    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__add__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'B add %%%%'</span>, <span style="color: #a020f0;">self</span>, other)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return 1000
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">raise NotImplementedError('&#26410;&#23454;&#29616;&#24322;&#24120;') #&#19981;&#33021;&#29992;&#22312;&#36825;&#65292;&#29992;&#22312;&#25277;&#35937;&#22522;&#31867;&#20013;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">raise NotImplemented  #&#36825;&#37324;&#19981;&#33021;&#29992;raise
</span>        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">NotImplemented</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;B {}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.x)

<span style="color: #a0522d;">a</span> = A(4)
<span style="color: #a0522d;">b</span> = B(10)
<span style="color: #483d8b;">print</span>(a + b) <span style="color: #b22222;">#</span><span style="color: #b22222;">a.__add__(b)
</span><span style="color: #483d8b;">print</span>(b + a) <span style="color: #b22222;">#</span><span style="color: #b22222;">b.__add__(a) ? a.__radd__(?)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#25353;&#36947;&#29702;b.__add__(a)&#65292;&#20294;&#22914;&#26524;&#27809;&#26377;&#23454;&#29616;&#65292;&#36716;&#32780;&#35843;&#29992; a.__radd__(?)
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;b&#26377;__add__&#65292;&#37027;&#20040;&#35843;&#29992;&#23427;&#65292;&#36820;&#22238;&#20540;&#23601;&#26159;&#32467;&#26524;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;b&#26377;__add__&#65292;return NotImplemented&#65292;&#21017;a.__radd__()
</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">add~~~~ &lt;A 4&gt; &lt;B 10&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">14
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">B add %%%%
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">radd~~~~ &lt;A 4&gt; &lt;B 10&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">14</span>
</pre>
</div>

<ul class="org-ul">
<li>b + a 等价于b.__add__(a)，但是类B没有实现__add__方法，反而去找a的__radd__方法</li>
<li>1 + a等价于1.__add__(a)，而int类型实现了__add__方法，不过这个方法对于这种加法的返回值是NotImplemented，解释器发现是这个值，就会发起对第二操作对象的__radd__方法的调用</li>
</ul>

<p>
B类也等价于下面的实现
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, x ):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = x

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__add__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">isinstance</span>(other, <span style="color: #483d8b;">type</span>(<span style="color: #a020f0;">self</span>)):
            <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.x + other.x
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">NotImplemented</span>
</pre>
</div>

<p>
1 + a 用如下方法解决
</p>
<div class="org-src-container">
<pre class="src src-python">
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b27313b1-ac9e-46de-9e57-c3903bd4450f" class="outline-5">
<h5 id="h:b27313b1-ac9e-46de-9e57-c3903bd4450f">Python的对象模型</h5>
<div class="outline-text-5" id="text-h:b27313b1-ac9e-46de-9e57-c3903bd4450f">
<p>
Python的继承层次
</p>
<pre class="example" id="org55df510">
单一继承，多复用，OCP覆盖
多继承，二义性、单调性，C3， mro, 线性化，object
一切类都从object类继承，object也是类，根基类
自定义类
  class A:pass, 新式类，父类就是object
  class B(A):pass, 父类A
type是类，继承关系，父类也是object

子孙类的实例和object
  type(实例) =&gt; 自身的类型
子孙类和object有什么关系
  都是从object派生
object的父类是谁？没有父类
</pre>

<p>
type用来干什么？
</p>
<pre class="example" id="org93efc82">
内建函数，类，元类
判断一个实例的类型
type(A()) =&gt; A类，说明A的实例由A构造实例化
type(A) =&gt; type，A是type的实例，由type构造实例化成的类对象
type(type) =&gt; type，type类对象，有type构造的实例
类对象的类型是type，说明他们都是type的实例
type(object) =&gt; type，object类也是由type构造的类对象
type的父类 object，从object派生
</pre>

<p>
在Python中，任何对象多有类型，可以使用type()或者__class__查看
</p>

<p>
但是类型也是对象即类对象，它也有自己的类型
</p>


<figure id="org080bbfd">
<img src="./images/img_20250218_154241.png" alt="img_20250218_154241.png" width="50%">

</figure>

<p>
所有新类型的缺省类型是type(可以使用元类来改变)
</p>
<ul class="org-ul">
<li>特殊类型type是所有对象的缺省类型，也包括type自己。但它又是一个对象，因此从object继承</li>
<li>特殊类型object是继承树的顶层，它是python所有类型的最终基类</li>
</ul>

<p>
也就是说，继承都来自object，类型都看type。type也是对象继承自object，object也有类型是type。
</p>

<p>
这俩又特殊，type类型是它自己，obkect没有基类
</p>
</div>
</div>
<div id="outline-container-h:104755fe-e731-44b6-b90b-6b433eedd8de" class="outline-5">
<h5 id="h:104755fe-e731-44b6-b90b-6b433eedd8de">可迭代对象</h5>
<div class="outline-text-5" id="text-h:104755fe-e731-44b6-b90b-6b433eedd8de">
</div>
<div id="outline-container-h:6b71f3a1-1c24-4325-afcd-f651b5a00eaf" class="outline-6">
<h6 id="h:6b71f3a1-1c24-4325-afcd-f651b5a00eaf">可迭代对象</h6>
<div class="outline-text-6" id="text-h:6b71f3a1-1c24-4325-afcd-f651b5a00eaf">
<pre class="example" id="org9bcee07">
for in 对象:

列表、元组、set、dict、range、生成器、迭代器，统称为容器，若干个元素
自定义类型，实现 __iter__(self) 返回迭代器，类型的实例就是可迭代对象
可迭代对象，一定在类上实例了__iter__方法
</pre>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">items</span> = [100, 200, 300]

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__iter__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return iter(self.items)
</span>        <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">from</span> <span style="color: #a020f0;">self</span>.items <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#22120;&#23545;&#35937;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__reversed__</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27809;&#26377;&#23454;&#29616;len&#12289;getitem&#39764;&#26415;&#26041;&#27861;
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24517;&#39035;&#36820;&#22238;&#36845;&#20195;&#22120;
</span>        <span style="color: #b22222;"># </span><span style="color: #b22222;">return reversed(self.items) #list&#20869;&#37096;&#32943;&#23450;&#23454;&#29616;&#20102;__reversed__&#26041;&#27861;
</span>        <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">from</span> <span style="color: #483d8b;">reversed</span>(<span style="color: #a020f0;">self</span>.items)


<span style="color: #a0522d;">a</span> = A()
<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> a:
    <span style="color: #483d8b;">print</span>(x)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21453;&#21521;&#36845;&#20195;
</span><span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">reversed</span>(a): <span style="color: #b22222;">#</span><span style="color: #b22222;">reversible
</span>    <span style="color: #483d8b;">print</span>(x)
</pre>
</div>

<p>
类提供了__iter__魔术方法，返回一个可迭代器。类的实例就是可迭代对象，确切地讲是正向迭代。
</p>

<p>
如果提供了__reversed__魔术方法，返回一个迭代器，就可以使用内建函数reversed来逆向迭代。
</p>
</div>
</div>
<div id="outline-container-h:c2ed93a6-10e7-44ae-8348-30c83e744df4" class="outline-6">
<h6 id="h:c2ed93a6-10e7-44ae-8348-30c83e744df4">迭代器</h6>
<div class="outline-text-6" id="text-h:c2ed93a6-10e7-44ae-8348-30c83e744df4">
<p>
<a href="https://docs.python.org/3/glossary.html#term-iterator">https://docs.python.org/3/glossary.html#term-iterator</a>
</p>

<p>
用来表示一连串数据流的对象。 重复调用迭代器的 __next__() 方法 (或将其传给内置函数 next()) 将逐个返回流中的项。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Inc</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">count</span> = -1

    <span style="color: #b22222;"># </span><span style="color: #b22222;">def __iter__(self):
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__next__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> 123

<span style="color: #a0522d;">inc</span> = Inc()
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(inc)) <span style="color: #b22222;">#</span><span style="color: #b22222;">123
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(inc)) <span style="color: #b22222;">#</span><span style="color: #b22222;">123</span>
</pre>
</div>

<p>
for 循环本质
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Inc</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">count</span> = -1

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__iter__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'iter~~~~'</span>)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">self &#26159;&#19981;&#26159;&#36845;&#20195;&#22120;
</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__next__</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36845;&#20195;&#22120;&#65292;&#24517;&#39035;&#26377;__next__&#26041;&#27861;&#65292;&#20294;&#35831;&#25226;__iter__&#20063;&#23454;&#29616;&#20102;
</span>        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'next~~~~'</span>)
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">count</span> += 1
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.count &gt;5:
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">StopIteration</span>
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.count

<span style="color: #a0522d;">inc</span> = Inc()
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(inc) #&lt;__main__.Inc object at 0x000002362A977CB0&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(next(inc)) #0
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(next(inc)) #1
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(next(inc)) #2
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)

<span style="color: #a020f0;">import</span> time
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(inc, <span style="color: #8b2252;">'end____'</span>))
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> inc: <span style="color: #b22222;">#</span><span style="color: #b22222;">inc&#26159;&#36845;&#20195;&#22120;&#65292;&#20294;&#26159;
</span>    time.sleep(1)
    <span style="color: #483d8b;">print</span>(x)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">next</span>(inc, <span style="color: #8b2252;">'end____'</span>))

<span style="color: #b22222;">#</span><span style="color: #b22222;">for &#24490;&#29615;&#26412;&#36136;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">for in &#21487;&#36845;&#20195;&#23545;&#35937;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">1 &#21487;&#36845;&#20195;&#23545;&#35937;__iter__&#25343;&#21040;&#19968;&#20010;&#36845;&#20195;&#22120;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">2 &#23545;&#36845;&#20195;&#22120;.__next__&#36880;&#20010;&#20803;&#32032;&#36845;&#20195;&#65292;&#30452;&#21040;&#20986;StopIterration</span>
</pre>
</div>

<p>
for循环in后面是一个可迭代对象，本质上，调用了__iter__魔术方法拿到了一个迭代器，
for循环驱动的是一个迭代器，相当于不断调用一个迭代器的__next__方法。
</p>
</div>
</div>
<div id="outline-container-h:754862ad-a2e0-4bf3-9d28-b8b68e2f18c6" class="outline-6">
<h6 id="h:754862ad-a2e0-4bf3-9d28-b8b68e2f18c6">生成器</h6>
<div class="outline-text-6" id="text-h:754862ad-a2e0-4bf3-9d28-b8b68e2f18c6">
<ul class="org-ul">
<li>Python中由生成器表达式或生成器函数生成，快速得到迭代器的方式</li>
<li>生成器一定是迭代器，内部实例了迭代器接口。</li>
</ul>

<p>
Python可迭代对象，迭代器，生成器的关系
</p>

<ul class="org-ul">
<li>可迭代对象
<ul class="org-ul">
<li>迭代器
<ul class="org-ul">
<li>生成器对象
<ul class="org-ul">
<li>由生成器表达式或生成器函数得到的</li>
</ul></li>
</ul></li>
</ul></li>
</ul>


<pre class="example" id="org8fb9e5e">

</pre>

<p>
可迭代对象与
</p>
<ul class="org-ul">
<li>能够通过迭代一次次返回不同的元素的对象</li>
<li>所谓相同，不是指值是否相同，而是元素在容器中是否是同一个，例如列表中值可以重复的，['a', 'a']，虽然这个列表有2个元素，值一样，但是两个'a'是不同的元素</li>
<li>可以迭代，但是未必有序，未必可索引</li>
<li>可迭代对象有：list、tuple、string、bytes、bytearray、range、set、dict、生成器、迭代器等</li>
<li>可以使用成员操作符in、not in</li>
<li>对于线性数据结构，in本质上是在遍历对象，时间复杂度为O(n)</li>
</ul>

<p>
迭代器
</p>
<ul class="org-ul">
<li>特殊的对象，一定是可迭代对象，具备可迭代对象的特征</li>
<li>如果一个对象拥有__iter__方法，其是可迭代对象；如果一个对象拥有next方法，其是迭代器。</li>
<li>定义可迭代对象，必须实现__iter__方法；定义迭代器，必须实现__iter__和next方法</li>
</ul>


<p>
生成器generator
</p>

<ul class="org-ul">
<li>生成器指的是生成器对象，可以由生成器表达式得到，也可以使用yield关键字编写一个生成器函数， 调用这个函数得到一个生成器对象</li>
<li>生成器对象，是一个可迭代对象，是一个迭代器</li>
<li>生成器对象，是延迟计算、惰性求值的</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:88a61f4d-58f1-4e33-ad9a-28254bd3bd8e" class="outline-3">
<h3 id="h:88a61f4d-58f1-4e33-ad9a-28254bd3bd8e">模块化</h3>
<div class="outline-text-3" id="text-h:88a61f4d-58f1-4e33-ad9a-28254bd3bd8e">
<p>
一般来说，变成语言中，库、包、模块是同一种概念，是代码组织方式。
</p>

<p>
Python中只有一种模块对象类型，但是为了模块化组织模块的便利，提供了“包”的概念。
</p>

<p>
模块module，指的是Python的源代码文件。
</p>

<p>
包package，指的是模块组织在一起的包名同名的目录及其相关文件。
</p>
</div>
<div id="outline-container-h:2bbc6afb-569a-454b-8347-d277a2186dc8" class="outline-4">
<h4 id="h:2bbc6afb-569a-454b-8347-d277a2186dc8">导入语句</h4>
<div class="outline-text-4" id="text-h:2bbc6afb-569a-454b-8347-d277a2186dc8">
<pre class="example" id="org9bf3182">
import模块1[,模块2,…]   完全导入
import…as…    模块别别名
</pre>

<p>
import语句
</p>
<ol class="org-ol">
<li>找到指定的模块，加载和初始化它，生成模块对象。找不到，抛出异常</li>
<li>在import所在的作用域的局部命名空间中，增加名称和上一步创建的对象关联</li>
</ol>

<p>
单独运行以下例子，体会区别
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> functools <span style="color: #b22222;">#</span><span style="color: #b22222;">import&#21518;&#30475;&#20284;&#26159;&#27169;&#22359;&#31867;&#22411;&#65292;&#20020;&#26102;&#21152;&#36733;&#65292;&#20840;&#23616;&#21464;&#37327;&#20197;&#27169;&#22359;&#20026;&#36793;&#30028;
</span><span style="color: #a020f0;">import</span> os

<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>()) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#31867;&#25110;&#32773;&#23545;&#35937;&#30340;&#25152;&#26377;&#25104;&#21592;&#21517;&#31216;&#21015;&#34920;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(os), os) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#21516;&#30340;&#27169;&#22359;&#25351;&#21521;&#19981;&#21516;&#30340;py&#25991;&#20214;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(functools), functools)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">[... 'functools', 'os']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;class 'module'&gt; &lt;module 'os' (frozen)&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;class 'module'&gt; &lt;module 'functools' from 'D:\\py\\python3130\\Lib\\functools.py'&gt;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> functools <span style="color: #b22222;">#</span><span style="color: #b22222;">import&#21518;&#30475;&#20284;&#26159;&#27169;&#22359;&#31867;&#22411;&#65292;&#20020;&#26102;&#21152;&#36733;&#65292;&#20840;&#23616;&#21464;&#37327;&#20197;&#27169;&#22359;&#20026;&#36793;&#30028;
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>()) <span style="color: #b22222;">#</span><span style="color: #b22222;">[... 'functools']
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(functools), functools) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;class 'module'&gt; &lt;module 'functools' from ''path/to/functools.py'&gt;
</span><span style="color: #483d8b;">print</span>(functools.wraps) <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;function wraps at 0x000001C045DA6D40&gt;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">locals</span>())
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">globals</span>().keys())

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;class 'module'&gt; &lt;module 'functools' from 'D:\\py\\python3130\\Lib\\functools.py'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;function wraps at 0x000001C045DA6D40&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">{'__name__': '__main__', '__doc__': None, '__package__': None, '__loader__': &lt;_frozen_importlib_external.SourceFileLoader object at 0x000001C045CF44B0&gt;, '__spec__': None, '__annotations__': {}, '__builtins__': &lt;module 'builtins' (built-in)&gt;, '__file__': 'D:\\project\\pyproj\\t1.py', '__cached__': None, 'functools': &lt;module 'functools' from 'D:\\py\\python3130\\Lib\\functools.py'&gt;}
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">dict_keys(['__name__', '__doc__', '__package__', '__loader__', '__spec__', '__annotations__', '__builtins__', '__file__', '__cached__', 'functools'])</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> os.path <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23548;&#20837;os.path,os&#21152;&#20837;&#24403;&#21069;&#21517;&#35789;&#31354;&#38388;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>()) <span style="color: #b22222;">#</span><span style="color: #b22222;">[..., 'os']
</span><span style="color: #483d8b;">print</span>(os) <span style="color: #b22222;"># </span><span style="color: #b22222;"># &lt;module 'os' from ''path/to/os.py'&gt;
</span><span style="color: #483d8b;">print</span>(os.path) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23436;&#20840;&#38480;&#23450;&#21517;&#35789;&#35775;&#38382;path</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> os.path <span style="color: #a020f0;">as</span> osp <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23548;&#20837;os.path&#24182;&#36171;&#32473;osp
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>()) <span style="color: #b22222;"># </span><span style="color: #b22222;">[..., 'osp']
</span><span style="color: #483d8b;">print</span>(osp) <span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;mdule 'ntpath' form 'path/to/path.py'&gt;</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">testimport</span>():
  <span style="color: #a020f0;">import</span> os.path <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23616;&#37096;
</span>  <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>())

testimport() <span style="color: #b22222;"># </span><span style="color: #b22222;">['os']
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">globals</span>().keys()) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27809;&#26377;&#8216;os&#8217;,&#20294;&#26377;'testimport'
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">dict_keys(['__name__', '__doc__', '__package__', '__loader__', '__spec__', '__annotations__', '__builtins__', '__file__', '__cached__', 'testimport'])</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> os.stat <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#21487;&#23548;&#20837;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">ModuleNotFoundError: No module named 'os.stat'; 'os' is not a package</span>
</pre>
</div>


<p>
总结
</p>
<ul class="org-ul">
<li>导入顶级模块，其名词会加入到本地名词空间中，并绑定到其模块对象</li>
<li>导入非顶级模块，只将其顶级模块名称加入到本地名词空间中。导入的模块必须使用完全限定名称来访问。</li>
<li>如果使用了as，as后的名词直接绑定到导入的模块对象，并将该名词加入到本地名词空间中</li>
<li>import之后只能是模块类型</li>
</ul>


<p>
导入语句
</p>
<pre class="example" id="org665371d">
from…import…   部分导入
from…import…as… 别名
</pre>

<p>
from语句
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> pathlib <span style="color: #a020f0;">import</span> Path, PosixPath <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312;&#24403;&#21069;&#21517;&#35789;&#31354;&#38388;&#23548;&#20837;&#35813;&#27169;&#22359;&#25351;&#23450;&#30340;&#25104;&#21592;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>()) <span style="color: #b22222;"># </span><span style="color: #b22222;">[..., 'Path', 'PosixPath']</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> pathlib <span style="color: #a020f0;">import</span> * <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312;&#24403;&#21069;&#21517;&#35789;&#31354;&#38388;&#23548;&#20837;&#35813;&#27169;&#22359;&#25152;&#26377;&#20844;&#20849;&#25104;&#21592;&#65288;&#38750;&#19979;&#21010;&#32447;&#24320;&#22836;&#25104;&#21592;&#65289;&#25110;&#25351;&#23450;&#25104;&#21592;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>()) <span style="color: #b22222;"># </span><span style="color: #b22222;">[...&#65292;'Path', 'PosixPath', 'PurePath', 'PurePosixPath', 'PureWindowsPath', 'WindowsPath']</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps <span style="color: #a020f0;">as</span> wr,partial <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21035;&#21517;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>()) <span style="color: #b22222;"># </span><span style="color: #b22222;">[..., 'wr', 'partial]</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> os.path <span style="color: #a020f0;">import</span> exists

<span style="color: #a020f0;">if</span> exists(<span style="color: #8b2252;">'c://'</span>):
  <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Found'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">Found
</span><span style="color: #a020f0;">else</span>:
  <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Not Found'</span>)

<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>()) <span style="color: #b22222;"># </span><span style="color: #b22222;">[..., 'exists']
</span><span style="color: #483d8b;">print</span>(exists) <span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;function exists at 0x000001C57FF9AD08&gt;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">4&#31181;&#26041;&#24335;&#33719;&#24471;&#21516;&#19968;&#20010;&#23545;&#35937;exists
</span><span style="color: #a020f0;">import</span> os

<span style="color: #483d8b;">print</span>(os.path.exists)
<span style="color: #483d8b;">print</span>(exists)
<span style="color: #483d8b;">print</span>(os.path.<span style="color: #483d8b;">__dict__</span>[<span style="color: #8b2252;">'exists'</span>]) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23383;&#31526;&#20018;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">getattr</span>(os.path, <span style="color: #8b2252;">'exists'</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23383;&#31526;&#20018;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#32467;&#26524;&#37117;&#20026;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;built-in function _path_exists&gt;</span>
</pre>
</div>

<p>
总结
</p>
<ul class="org-ul">
<li>找到from子句中指定的模块，加载并初始化它（注意不是导入）</li>
<li>对于import子句后的名词
<ol class="org-ol">
<li>先查from子句导入的模块是否具有该名词的 <b>属性</b></li>
<li>如果不是，则尝试导入该名词的子模块</li>
<li>还没有找到，则抛出ImportError异常</li>
<li>这个名称保存到本地名词空间中，如果有as子句，则使用as子句后的名称</li>
</ol></li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> pathlib <span style="color: #a020f0;">import</span> Path
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(Path), Path)

<span style="color: #a020f0;">import</span> pathlib <span style="color: #a020f0;">as</span> p1
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">id</span>(p1.Path), p1.Path)

<span style="color: #483d8b;">print</span>(p1.Path <span style="color: #a020f0;">is</span> Path)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2856710771152 &lt;class 'pathlib._local.Path'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2856710771152 &lt;class 'pathlib._local.Path'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">True</span>
</pre>
</div>

<p>
可以看出，导入的名词Path和p1.Path是同一个对象
</p>
</div>
</div>
<div id="outline-container-h:e5c97c14-1009-4635-8028-4068662a918a" class="outline-4">
<h4 id="h:e5c97c14-1009-4635-8028-4068662a918a">自定义模块</h4>
<div class="outline-text-4" id="text-h:e5c97c14-1009-4635-8028-4068662a918a">
<p>
自定义模块：.py文件就是一个模块
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">t1.py&#25991;&#20214;
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'This is {} module'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">__name__</span>)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20027;&#27169;&#22359;
</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showmodule</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(1, <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">__module__</span>, <span style="color: #a020f0;">self</span>)
        <span style="color: #483d8b;">print</span>(2, <span style="color: #a020f0;">self</span>.__class__, <span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>.__class__))

<span style="color: #a0522d;">a</span> = A()
a.showmodule()

<span style="color: #b22222;"># </span><span style="color: #b22222;">t2.py&#25991;&#20214;
</span><span style="color: #a020f0;">import</span> t1 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20174;&#30913;&#30424;&#21152;&#36733;&#21040;&#20869;&#23384;&#65292;t1&#27169;&#22359;&#23545;&#35937;&#21019;&#24314;&#65292;t1&#29616;&#22312;&#19981;&#26159;&#20027;&#27169;&#22359;&#65292;&#26159;&#34987;&#23548;&#20837;&#27169;&#22359;&#65292;&#39030;&#23618;&#20195;&#30721;&#34987;&#25191;&#34892;
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #483d8b;">print</span>(t1.A, <span style="color: #483d8b;">id</span>(t1.A), t1.a)

<span style="color: #a0522d;">a</span> = t1.A()
a.showmodule()

<span style="color: #b22222;"># </span><span style="color: #b22222;">t3.py&#25991;&#20214;
</span><span style="color: #a020f0;">from</span> t1 <span style="color: #a020f0;">import</span> A <span style="color: #a020f0;">as</span> cls

<span style="color: #a0522d;">a</span> = cls()
a.showmodule()
</pre>
</div>
</div>
<div id="outline-container-h:cb6691a1-3002-4016-9e81-1c146a98b752" class="outline-5">
<h5 id="h:cb6691a1-3002-4016-9e81-1c146a98b752">自定义模块命名规范</h5>
<div class="outline-text-5" id="text-h:cb6691a1-3002-4016-9e81-1c146a98b752">
<ul class="org-ul">
<li>模块名就是文件名</li>
<li>模块名必须符合标识符的要求，是非数字开头的字母、数字和下划线的组合。
<ul class="org-ul">
<li>如 test-module.py这样的文件名不能作为模块名，也不要使用中文</li>
</ul></li>
<li>不要使用系统模块名来命名，避免冲突</li>
<li>通常模块名为全小写，下划线来分割单词</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:40e867da-e4ce-4786-9953-882b3bb3d137" class="outline-4">
<h4 id="h:40e867da-e4ce-4786-9953-882b3bb3d137">模块搜索顺序</h4>
<div class="outline-text-4" id="text-h:40e867da-e4ce-4786-9953-882b3bb3d137">
<p>
使用sys.path查看搜索顺序
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> sys

<span style="color: #483d8b;">print</span>(*sys.path, sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">for p in sys.path:
</span><span style="color: #b22222;">#     </span><span style="color: #b22222;">print(p)</span>
</pre>
</div>

<p>
返回结果
</p>
<div class="org-src-container">
<pre class="src src-sh">D:\project\pyproj<span style="color: #8b2252;">\.</span>venv\Scripts\python.exe D:\project\pyproj\t1.py 
D:\project\pyproj
D:\project\pyproj
D:\project\pyproj<span style="color: #8b2252;">\.</span>venv\Scripts\python313.zip <span style="color: #b22222;">#</span><span style="color: #b22222;">&#34394;&#25311;&#29615;&#22659;&#65292;&#20869;&#21547;&#26631;&#20934;&#24211;
</span>D:\py\python3130\DLLs <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21160;&#24577;&#24211;
</span>D:\py\python3130\Lib <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38745;&#24577;&#24211;
</span>D:\py\python3130 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31995;&#32479;&#30446;&#24405;
</span>D:\project\pyproj<span style="color: #8b2252;">\.</span>venv <span style="color: #b22222;">#</span><span style="color: #b22222;">&#34394;&#25311;&#29615;&#22659;&#26681;&#30446;&#24405;
</span>D:\project\pyproj<span style="color: #8b2252;">\.</span>venv\Lib\site-packages <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31532;&#19977;&#26041;&#21253;&#23433;&#35013;&#30446;&#24405;</span>
</pre>
</div>

<p>
显示结果为，Python模块的路径搜索顺序
</p>

<p>
当加载一个模块的时候，需要从这些搜索路径中从前到后依次查找，并不搜索这些目录的子目录。
</p>

<p>
搜索到模块就加载，搜索不到就抛异常
</p>

<p>
路径也可以为字典、zip文件、egg文件名。
</p>

<p>
.egg文件，由setuptools库创建的包，第三方库常用的格式。添加了元数据（版本号、依赖项等）信息的zip文件
</p>

<p>
路径顺序为
</p>
<ul class="org-ul">
<li>程序主目录，程序运行的主程序脚本所在的目录</li>
<li>PYTHONPATH目录，环境变量PYTHONPATH设置的目录也是搜索模块的路径</li>
<li>标准库目录，Python自带的模块所在目录</li>
</ul>

<p>
sys.path虽可以被修改，增加新的目录，但不建议修改
</p>
</div>
</div>
<div id="outline-container-h:688f9b81-8c64-45ac-882c-e3e8b44b984b" class="outline-4">
<h4 id="h:688f9b81-8c64-45ac-882c-e3e8b44b984b">模块重复导入</h4>
<div class="outline-text-4" id="text-h:688f9b81-8c64-45ac-882c-e3e8b44b984b">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">t1.py&#25991;&#20214;
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'This is {} module'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">__name__</span>)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20027;&#27169;&#22359;
</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showmodule</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(1, <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">__module__</span>, <span style="color: #a020f0;">self</span>)
        <span style="color: #483d8b;">print</span>(2, <span style="color: #a020f0;">self</span>.__class__, <span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>.__class__))

<span style="color: #a0522d;">a</span> = A()
a.showmodule()

<span style="color: #b22222;"># </span><span style="color: #b22222;">t2.py&#25991;&#20214;
</span><span style="color: #a020f0;">import</span> t1
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #a020f0;">import</span> t1
<span style="color: #a020f0;">import</span> t1
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
</pre>
</div>

<p>
返回结果
</p>
<pre class="example" id="org87b514c">
This is t1 module
1 t1 &lt;t1.A object at 0x0000023478A97E00&gt;
2 &lt;class 't1.A'&gt; 2424389032576
------------------------------
==============================
</pre>

<p>
从执行结果来看，不会产生重复导入的现象。
</p>

<p>
所有加载的模块都会记录在 <b>sys.modules</b> 中，sys.modules是储存已经加载过的所有模块的的字典
</p>

<p>
打印sys.modules可以看到builtins、os、os.path、sys等模块都已经加载了
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">t2.py&#25991;&#20214;
</span><span style="color: #a020f0;">import</span> sys
<span style="color: #483d8b;">print</span>(*sys.modules.items(), sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'t1'</span> <span style="color: #a020f0;">in</span> sys.modules.keys())
<span style="color: #a020f0;">import</span> t1
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'t1'</span> <span style="color: #a020f0;">in</span> sys.modules.keys())

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">False
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">This is t1 module
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">1 t1 &lt;t1.A object at 0x0000016B758B7CB0&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2 &lt;class 't1.A'&gt; 1561048488352
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">True</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6e4f5279-7b6d-4cf3-b41b-15260eead8e6" class="outline-4">
<h4 id="h:6e4f5279-7b6d-4cf3-b41b-15260eead8e6">模块运行</h4>
<div class="outline-text-4" id="text-h:6e4f5279-7b6d-4cf3-b41b-15260eead8e6">
<p>
<code>__name__</code> ，每个模块都会定义一个 <code>__name__</code> 特殊变量来储存当前模块的
名词，如果不指定，则默认为源代码文件名，如果是包则有限定名。
</p>

<p>
解释器初始化的时候，会初始化sys.modules字典（保存已加载的模块），加载
builtins（全局函数、常量）模块、 <code>__main__</code> 模块、sys模块，以及初始化
模块搜索路径sys.path
</p>

<p>
Python是脚本语言，任何一个脚本都可以直接执行，也可以作为模块被导入。
</p>

<p>
当从标准输入（命令行方式敲代码）、脚本（$ python t1.py) 或交互式读取的
时候，会将模块的 <code>__name__</code> 设置为 <code>__main__</code> ，模块的顶层代码就在
<code>__main__</code> 这个作用域中执行。顶层代码：模块中缩进最外层的代码
</p>

<p>
如果是import导入的，其 <code>__name__</code> 默认就是模块名
</p>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">t1.py
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">__name__</span>)

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21028;&#26029;&#27169;&#22359;&#26159;&#21542;&#20197;&#31243;&#24207;&#30340;&#26041;&#24335;&#36816;&#34892; python t1.py
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"in main module running"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31243;&#24207;&#30340;&#26041;&#24335;&#36816;&#34892;&#30340;&#20195;&#30721;
</span>    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27979;&#35797;&#20195;&#30721;
</span><span style="color: #a020f0;">else</span>:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'in module running'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27169;&#22359;&#23548;&#20837;&#30340;&#26041;&#24335;&#36816;&#34892;&#30340;&#20195;&#30721;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">__main__
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">in main module running</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">t2.py&#25991;&#20214;
</span><span style="color: #a020f0;">import</span> t1

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">t1
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">in module running</span>
</pre>
</div>
</div>
<div id="outline-container-h:d3053eba-abdf-4c64-934d-89d2dfa61b52" class="outline-5">
<h5 id="h:d3053eba-abdf-4c64-934d-89d2dfa61b52"><code>if__name__ == '__main__'</code></h5>
<div class="outline-text-5" id="text-h:d3053eba-abdf-4c64-934d-89d2dfa61b52">
<ul class="org-ul">
<li><p>
本模块的功能测试
</p>

<p>
对于非主模块，测试本模块内的函数、类
</p></li>

<li><p>
避免主模块变更的副作用
</p>

<p>
顶层代码，没有封装，主模块使用时没有问题。但是，一旦有了新的主模块，老的主模块成了被导入模块，由于原来代码没有封装，就会一并执行
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:a0fc17c2-2bff-4c02-bcdb-e27cf1d45f4b" class="outline-5">
<h5 id="h:a0fc17c2-2bff-4c02-bcdb-e27cf1d45f4b">模块的属性</h5>
<div class="outline-text-5" id="text-h:a0fc17c2-2bff-4c02-bcdb-e27cf1d45f4b">
<pre class="example" id="org748316b">
__file__  字符串，源文件路径
__cached__  字符串，编译后的字节码文件路径
__spec__  显示模块的规范
__name__  模块名
__package__ 当模块是包，同__name__；否则，可以设置为顶级模块的空字符串
</pre>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>())
<span style="color: #483d8b;">print</span>(*<span style="color: #483d8b;">locals</span>().items(), sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">t3&#27809;&#26377;&#21253;
</span>
<span style="color: #a020f0;">import</span> os
<span style="color: #483d8b;">print</span>(os.path.dirname(__file__))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">['__annotations__', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__name__', '__main__') #&#27169;&#22359;&#21517;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__doc__', None)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__package__', None) #&#24403;&#27169;&#22359;&#26159;&#21253;&#65292;&#21516;__name__&#65307;&#21542;&#21017;&#65292;&#21487;&#20197;&#35774;&#32622;&#20026;&#39030;&#32423;&#27169;&#22359;&#30340;&#31354;&#23383;&#31526;&#20018;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__loader__', &lt;_frozen_importlib_external.SourceFileLoader object at 0x000001E0929644B0&gt;) &#28304;&#20195;&#30721;&#30340;&#21152;&#36733;&#22120;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__spec__', None) #&#26174;&#31034;&#27169;&#22359;&#30340;&#35268;&#33539;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__annotations__', {})
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__builtins__', &lt;module 'builtins' (built-in)&gt;)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__file__', 'D:\\project\\pyproj\\t3.py') #&#28304;&#25991;&#20214;&#36335;&#24452;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__cached__', None) #&#32534;&#35793;&#21518;&#30340;&#23383;&#33410;&#30721;&#25991;&#20214;&#36335;&#24452;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">D:\project\pyproj</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> t1

<span style="color: #a020f0;">for</span> k,v <span style="color: #a020f0;">in</span> t1.<span style="color: #483d8b;">__dict__</span>.items():
    <span style="color: #483d8b;">print</span>(k,<span style="color: #483d8b;">str</span>(v)[:80])

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>(t1))
<span style="color: #a020f0;">for</span> name <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">dir</span>(t1):
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">getattr</span>(t1, name))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:da3188cf-05ea-4352-bcc2-1b5f8f7639c5" class="outline-4">
<h4 id="h:da3188cf-05ea-4352-bcc2-1b5f8f7639c5">包</h4>
<div class="outline-text-4" id="text-h:da3188cf-05ea-4352-bcc2-1b5f8f7639c5">
<ul class="org-ul">
<li>包，特殊的模块</li>
<li>Python模块支持目录</li>
</ul>

<p>
实验
</p>

<p>
新建一个目录m, 使用下面代码
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> m
<span style="color: #483d8b;">print</span>(m, <span style="color: #483d8b;">type</span>(m))
<span style="color: #483d8b;">print</span>(*m.<span style="color: #483d8b;">__dict__</span>.items(), sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">package m , __file__&#21602;&#65311; &#22240;&#20026;&#26159;&#30446;&#24405;&#26377; __path__
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #a020f0;">import</span> t1
<span style="color: #483d8b;">print</span>(*t1.<span style="color: #483d8b;">__dict__</span>.items(), sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">py __file__ &#25991;&#20214;&#36335;&#24452;&#65292;__package__ &#31354;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;module 'm' (namespace) from ['D:\\project\\pyproj\\m', 'D:\\project\\pyproj\\m']&gt; &lt;class 'module'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__name__', 'm')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__doc__', None)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__package__', 'm')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__loader__', &lt;_frozen_importlib_external.NamespaceLoader object at 0x0000023536F97E00&gt;) #&#34987;&#21517;&#23383;&#31354;&#38388;&#21152;&#36733;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__spec__', ModuleSpec(name='m', loader=&lt;......
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__file__', None)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__path__', _NamespacePath(['D:\\project\\pyproj\\m', 'D:\\project\\pyproj\\m']))
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">t1
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">in module running
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__name__', 't1')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__doc__', None)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__package__', '')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__loader__', &lt;_frozen_importlib_external.SourceFileLoader object at 0x0000025C8A3157E0&gt;)
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__spec__', ModuleSpec(name='t1', loader=&lt;_frozen_importlib_external.SourceFileLoader object at 0x0000025C8A3157E0&gt;, origin='D:\\project\\pyproj\\t1.py'))
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__file__', 'D:\\project\\pyproj\\t1.py')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__cached__', 'D:\\project\\pyproj\\__pycache__\\t1.cpython-313.pyc')
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">('__builtins__', {'__name__': ......</span>
</pre>
</div>

<p>
一个目录文件没有__file__，但是有__path__
</p>

<p>
上例中可以看出，可以导入目录m，目录也是文件，所以可以导入。
</p>

<p>
Python为了解决能在目录模块中写代码，建立了一个特殊文件 <code>__init__.py</code> 。
</p>

<div class="org-src-container">
<pre class="src src-sh">(<span style="color: #8b2252;">'__file__'</span>, <span style="color: #8b2252;">'D:\\project\\pyproj\\m\\__init__.py'</span>)
</pre>
</div>

<p>
pycharm中，创建Directory和创建Pyhon pcakage不同，前者是创建普通的目录，后者是创建一个带有__init__.py文件的目录即包。
</p>

<p>
Python中，目录可以作为模块，这就是包，不过代码需要写在该目录下 <code>__init__.py</code> 中。
</p>

<p>
包的 <code>__file__</code> 就指向 <code>__init__.py</code> 这个文件。
</p>
</div>
</div>
<div id="outline-container-h:78c868db-49dc-4c7f-8981-3457f1c96f51" class="outline-4">
<h4 id="h:78c868db-49dc-4c7f-8981-3457f1c96f51">子模块</h4>
<div class="outline-text-4" id="text-h:78c868db-49dc-4c7f-8981-3457f1c96f51">
<p>
包目录下的py文件、子目录都是其子模块
</p>

<pre class="example" id="org1157080">
m
|-- __init__.py
|-- m1.py
|-- m2
  |-- __init__.py
  |-- m21
    |-- __init__.py
  |-- m22.py
</pre>

<p>
如上建立子模块和目录和文件，所有的py文件中都写入代码print(<span class="underline"><span class="underline">name</span></span>)
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#27880;&#24847;&#35266;&#23519;&#24050;&#32463;&#21152;&#36733;&#30340;&#27169;&#22359;&#12289;&#24403;&#21069;&#21517;&#35789;&#31354;&#38388;&#30340;&#21517;&#35789;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">import m
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">import m.m1
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">from m import m1
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">from m.m2 import m21
</span><span style="color: #a020f0;">import</span> m.m2.m21

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>())

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #a020f0;">import</span> sys
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(sys.modules.keys())
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">sorted</span>(<span style="color: #483d8b;">filter</span>(<span style="color: #a020f0;">lambda</span> x:x.startswith(<span style="color: #8b2252;">'m'</span>), sys.modules.keys())))

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">m
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">m.m2
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">m.m2.m21
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">['__annotations__', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__', 'm']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">['m', 'm.m2', 'm.m2.m21', 'marshal']</span>
</pre>
</div>

<p>
删除__init__.py文件，并不影响导入，但不建议这样操作。
</p>
</div>
</div>
<div id="outline-container-h:7cfb8e82-b2f2-427e-80e3-677395cde4c0" class="outline-4">
<h4 id="h:7cfb8e82-b2f2-427e-80e3-677395cde4c0">模块和包的总结</h4>
<div class="outline-text-4" id="text-h:7cfb8e82-b2f2-427e-80e3-677395cde4c0">
<p>
包能够更好的组织模块，尤其是大的模块，其代码行数很多，可以把它拆分成很多子模块，便于使用某些功能就加载相应的子模块
</p>

<p>
包目录中__init__.py是在包第一次导入的时候就会执行，内容可以为空，也可以是用于该包初始化工作的代码，不要删除（低版本不可删除__init__.py文件）
</p>

<p>
<b>导入子模块一定会加载父模块，但导入父模块一定不会导入子模块</b>
</p>

<p>
包目录之间只能使用.点号作为间隔符，表示模块及其子模块的层级关系
</p>

<p>
模块也是封装，如同类、函数，不过它能够封装变量、类、函数
</p>

<p>
模块就是命名空间，其内部的顶层标识符，都是它的属性，可以通过__dict__或dir(module)查看
</p>

<p>
包也是模块，但模块不一定是包，包是特殊的模块，是一种阻止方式，它包含__path__属性
</p>

<p>
范例：
</p>
<ul class="org-ul">
<li><p>
from json import encoder 之后，json.dump 函数用不了，为什么？
</p>

<p>
encoder是进入到名词空间中的，没有json，但是json模块已经加载过了，没有json的引用，无法使用dump函数。
</p></li>

<li><p>
import json.encoder之后呢？json.dump函数能用吗？
</p>

<p>
说明encoder一定是模块，会加载json和encoder2个模块，当前名词空间有json，所以json.dump也能用。
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:3b8c8bcf-b813-46b1-8acd-1c5ddf61037f" class="outline-4">
<h4 id="h:3b8c8bcf-b813-46b1-8acd-1c5ddf61037f">绝对导入、相对导入</h4>
<div class="outline-text-4" id="text-h:3b8c8bcf-b813-46b1-8acd-1c5ddf61037f">
</div>
<div id="outline-container-h:3bbc17a6-5b66-47cd-ae83-88445865503f" class="outline-5">
<h5 id="h:3bbc17a6-5b66-47cd-ae83-88445865503f">绝对导入</h5>
<div class="outline-text-5" id="text-h:3bbc17a6-5b66-47cd-ae83-88445865503f">
<ul class="org-ul">
<li>在import语句或者from导入模块，模块名称最前面不是以.点开头的</li>
<li>绝对导入总是去模块搜索路径中找</li>
</ul>
</div>
</div>
<div id="outline-container-h:b5aecfc3-b485-4a54-a323-48cc13dfaac9" class="outline-5">
<h5 id="h:b5aecfc3-b485-4a54-a323-48cc13dfaac9">相对导入</h5>
<div class="outline-text-5" id="text-h:b5aecfc3-b485-4a54-a323-48cc13dfaac9">
<ul class="org-ul">
<li>只在包内使用，且只能用在from语句中</li>
<li>使用.点号，表示当前目录内</li>
<li>..两点表示上一级目录</li>
<li>&#x2026;三点表示上上一级</li>
<li>只在包内使用，一般 <b>不要在顶层模块中使用相对导入</b></li>
<li>一旦一个模块中使用相对导入，就可以做主模块运行了</li>
</ul>

<p>
范例：a.b.c模块，a、b是目录，c是模块c.py
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">c&#30340;&#20195;&#30721;&#20013;&#65292;&#20351;&#29992;&#20197;&#19979;&#20195;&#30721;
</span><span style="color: #a020f0;">from</span> . <span style="color: #a020f0;">import</span> d <span style="color: #b22222;"># </span><span style="color: #b22222;">imports a.b.d
</span><span style="color: #a020f0;">from</span> .. <span style="color: #a020f0;">import</span> e <span style="color: #b22222;"># </span><span style="color: #b22222;">imports a.e
</span><span style="color: #a020f0;">from</span> .d <span style="color: #a020f0;">import</span> x <span style="color: #b22222;"># </span><span style="color: #b22222;">a.b.d.x
</span><span style="color: #a020f0;">from</span> ..e <span style="color: #a020f0;">import</span> x <span style="color: #b22222;"># </span><span style="color: #b22222;">a.e.x</span>
</pre>
</div>

<p>
使用下面结构的包，体会相对导入的使用
</p>
<div class="org-src-container">
<pre class="src src-sh">m
|-- __init__.py
|-- m1.py
|-- m2
    |-- __init__.py
    |-- m21
        |-- __init__.py
    |-- m22.py
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:7bbecdf9-1202-485f-86de-c67ea4312a60" class="outline-4">
<h4 id="h:7bbecdf9-1202-485f-86de-c67ea4312a60">访问控制</h4>
<div class="outline-text-4" id="text-h:7bbecdf9-1202-485f-86de-c67ea4312a60">
</div>
<div id="outline-container-h:084ca37c-0c5f-492d-a8fd-de66be8fb0e6" class="outline-5">
<h5 id="h:084ca37c-0c5f-492d-a8fd-de66be8fb0e6">下划线开头的模块名</h5>
<div class="outline-text-5" id="text-h:084ca37c-0c5f-492d-a8fd-de66be8fb0e6">
<ul class="org-ul">
<li>_或者__开头的模块都可以导入，因为他们都是合法的标识符，就可以用作模块名</li>
</ul>
</div>
</div>
<div id="outline-container-h:94f46f03-0cd0-4968-851d-9c46dc64988c" class="outline-5">
<h5 id="h:94f46f03-0cd0-4968-851d-9c46dc64988c">模块内的标识符</h5>
<div class="outline-text-5" id="text-h:94f46f03-0cd0-4968-851d-9c46dc64988c">
<p>
范例：创建文件名为_xyz.py或者__xyz.py测试
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">xyz.py
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">__name__</span>)
<span style="color: #a0522d;">A</span> = 5
<span style="color: #a0522d;">_B</span> = 6
<span style="color: #a0522d;">__C</span> = 7
<span style="color: #a0522d;">__my__</span> = 8

<span style="color: #b22222;"># </span><span style="color: #b22222;">abc.py
</span><span style="color: #a020f0;">import</span> xyz

<span style="color: #a020f0;">import</span> sys
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">sorted</span>(sys.modules.keys())) <span style="color: #b22222;"># </span><span style="color: #b22222;">[..., 'xyz']
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>()) <span style="color: #b22222;"># </span><span style="color: #b22222;">[..., 'xyz']
</span>
<span style="color: #483d8b;">print</span>(xyz.A, xyz._B, xyz.__C, xyz.__my__) <span style="color: #b22222;"># </span><span style="color: #b22222;">5 6 7 8 </span>
</pre>
</div>

<p>
普通变量、保护变量、私有变量、特殊变量，都没有被隐藏，也就是说模块内没有私有的变量，在模块中定义不做特殊处理
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> xyz <span style="color: #a020f0;">import</span> A, _B <span style="color: #a020f0;">as</span> B, __my__, __C <span style="color: #a020f0;">as</span> C

<span style="color: #a020f0;">import</span> sys
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">sorted</span>(sys.modules.keys()))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>())

<span style="color: #483d8b;">print</span>(A, B, C, __my__)
</pre>
</div>

<p>
使用from语句依然可以访问所有变量
</p>
</div>
</div>
<div id="outline-container-h:eab188a5-81c9-46d6-8f5e-455fe16c422c" class="outline-5">
<h5 id="h:eab188a5-81c9-46d6-8f5e-455fe16c422c">from &#x2026; import * 和__all__</h5>
<div class="outline-text-5" id="text-h:eab188a5-81c9-46d6-8f5e-455fe16c422c">
</div>
<div id="outline-container-h:e02cdcad-299e-485d-8785-beb39ecb858a" class="outline-6">
<h6 id="h:e02cdcad-299e-485d-8785-beb39ecb858a">使用from &#x2026; import * 导入</h6>
<div class="outline-text-6" id="text-h:e02cdcad-299e-485d-8785-beb39ecb858a">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">xyz.py
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">__name__</span>)
<span style="color: #a0522d;">A</span> = 5
<span style="color: #a0522d;">_B</span> = 6
<span style="color: #a0522d;">__C</span> = 7
<span style="color: #a0522d;">__my__</span> = 8

<span style="color: #b22222;"># </span><span style="color: #b22222;">abc.py
</span><span style="color: #a020f0;">from</span> xyz <span style="color: #a020f0;">import</span> *

<span style="color: #a020f0;">import</span> sys
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">sorted</span>(sys.modules.keys()))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>()) <span style="color: #b22222;"># </span><span style="color: #b22222;">[..., 'A']
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">locals</span>()[<span style="color: #8b2252;">'A'</span>]) <span style="color: #b22222;"># </span><span style="color: #b22222;">5
</span>
<span style="color: #a0522d;">A</span> = 55
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">locals</span>()[<span style="color: #8b2252;">'A'</span>]) <span style="color: #b22222;"># </span><span style="color: #b22222;">55</span>
</pre>
</div>

<p>
结果是只导入了A，下划线开关的都没有导入
</p>
</div>
</div>
<div id="outline-container-h:e6dea20b-a3dc-402c-8f9f-33c2bf2ebc0e" class="outline-6">
<h6 id="h:e6dea20b-a3dc-402c-8f9f-33c2bf2ebc0e">使用__all__</h6>
<div class="outline-text-6" id="text-h:e6dea20b-a3dc-402c-8f9f-33c2bf2ebc0e">
<p>
__all__是一个列表，元素是字符串，每一个元素都是一个模块内的变量名。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">xyz.py
</span><span style="color: #483d8b;">__all__</span> = [<span style="color: #8b2252;">"X"</span>, <span style="color: #8b2252;">"Y"</span>]

<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">__name__</span>)
<span style="color: #a0522d;">A</span> = 5
<span style="color: #a0522d;">_B</span> = 6
<span style="color: #a0522d;">__C</span> = 7

<span style="color: #a0522d;">__my__</span> = 8

<span style="color: #a0522d;">X</span> = 10
<span style="color: #a0522d;">Y</span> = 20

<span style="color: #b22222;"># </span><span style="color: #b22222;">abc.py
</span><span style="color: #a020f0;">from</span> xyz <span style="color: #a020f0;">import</span> *

<span style="color: #a020f0;">import</span> sys
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">sorted</span>(sys.modules.keys()))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>()) <span style="color: #b22222;"># </span><span style="color: #b22222;">[...,'X', 'Y']
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">locals</span>()[<span style="color: #8b2252;">'X'</span>]) <span style="color: #b22222;"># </span><span style="color: #b22222;">10</span>
</pre>
</div>

<p>
修改__all__列表，加入下划线开头变量
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">xyz.py
</span><span style="color: #483d8b;">__all__</span> = [<span style="color: #8b2252;">"X"</span>, <span style="color: #8b2252;">"Y"</span>, <span style="color: #8b2252;">"_B"</span>, <span style="color: #8b2252;">"__C"</span>]

<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">__name__</span>)
<span style="color: #a0522d;">A</span> = 5
<span style="color: #a0522d;">_B</span> = 6
<span style="color: #a0522d;">__C</span> = 7

<span style="color: #a0522d;">__my__</span> = 8

<span style="color: #a0522d;">X</span> = 10
<span style="color: #a0522d;">Y</span> = 20

<span style="color: #b22222;"># </span><span style="color: #b22222;">abc.py
</span><span style="color: #a020f0;">from</span> xyz <span style="color: #a020f0;">import</span> *

<span style="color: #a020f0;">import</span> sys
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">sorted</span>(sys.modules.keys()))
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>()) <span style="color: #b22222;"># </span><span style="color: #b22222;">[..., 'X', 'Y', '_B', '__C']
</span>
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">locals</span>()[<span style="color: #8b2252;">'X'</span>]) <span style="color: #b22222;"># </span><span style="color: #b22222;">10
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">locals</span>()[<span style="color: #8b2252;">'Y'</span>]) <span style="color: #b22222;"># </span><span style="color: #b22222;">20
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">locals</span>()[<span style="color: #8b2252;">'_B'</span>]) <span style="color: #b22222;"># </span><span style="color: #b22222;">6
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">locals</span>()[<span style="color: #8b2252;">'__C'</span>]) <span style="color: #b22222;"># </span><span style="color: #b22222;">7</span>
</pre>
</div>

<p>
可以看到使用from xyz import * 导入__all__列表中的名称
</p>
</div>
</div>
<div id="outline-container-h:08266993-525e-4ac3-a643-97a0de8cd480" class="outline-6">
<h6 id="h:08266993-525e-4ac3-a643-97a0de8cd480">包和子模块</h6>
<div class="outline-text-6" id="text-h:08266993-525e-4ac3-a643-97a0de8cd480">
<div class="org-src-container">
<pre class="src src-sh">m 
|-- __init__.py
|-- m1.py
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">__init__.py
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">__name__</span>)
<span style="color: #a0522d;">x</span> = 1

<span style="color: #b22222;"># </span><span style="color: #b22222;">m1.py&#20013;
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">__name__</span>)
<span style="color: #a0522d;">y</span> = 5
</pre>
</div>

<p>
test.py如何访问到m1.py中的变量y
</p>

<ul class="org-ul">
<li>访问到m.m1变量y的几种实现：</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26041;&#27861;1&#65292;&#30452;&#25509;&#23548;&#20837;m1&#27169;&#22359;
</span><span style="color: #a020f0;">import</span> m.m1
<span style="color: #483d8b;">print</span>(m.m1.y)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26041;&#27861;2&#65292;&#30452;&#25509;&#23548;&#20837;m.m1&#30340;&#23646;&#24615;y
</span><span style="color: #a020f0;">from</span> m.m1 <span style="color: #a020f0;">import</span> y
<span style="color: #483d8b;">print</span>(y)
<span style="color: #a020f0;">from</span> m <span style="color: #a020f0;">import</span> m1
<span style="color: #483d8b;">print</span>(m1.y)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26041;&#27861;3&#65292; from m import *
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">print(dir())
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#35813;&#26041;&#27861;&#23548;&#20837;&#21518;&#65292;&#26080;&#27861;&#30475;&#21040;&#23376;&#27169;&#22359;m1&#65292;&#26080;&#27861;&#35775;&#38382;y
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312;__init__.py&#22686;&#21152;__all_- = ['X','m1']&#65292;&#20351;&#29992;__all__&#25552;&#20379;&#23548;&#20986;&#30340;&#21517;&#31216;
</span><span style="color: #a020f0;">from</span> m <span style="color: #a020f0;">import</span> *
<span style="color: #483d8b;">print</span>(m1.y)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26041;&#27861;4&#65292;&#19981;&#36866;&#29992;__all__
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312;__init__.py&#22686;&#21152;from . import m1
</span><span style="color: #a020f0;">from</span> m <span style="color: #a020f0;">import</span> *
<span style="color: #483d8b;">print</span>(m1.y)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">__init__.py
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">__name__</span>)
<span style="color: #a020f0;">from</span> .m1 <span style="color: #a020f0;">import</span> y <span style="color: #b22222;">#</span><span style="color: #b22222;">m1 y
</span><span style="color: #a0522d;">x</span> = 1
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">dir</span>())

<span style="color: #b22222;">#</span><span style="color: #b22222;">test.py
</span><span style="color: #a020f0;">import</span> m

<span style="color: #483d8b;">print</span>(m.m1.y)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">m
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">m.m1
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">['__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__path__', '__spec__', 'm1', 'x', 'y']
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">5</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:97d442d6-7264-4d23-813d-49dce4abfa78" class="outline-6">
<h6 id="h:97d442d6-7264-4d23-813d-49dce4abfa78">总结</h6>
<div class="outline-text-6" id="text-h:97d442d6-7264-4d23-813d-49dce4abfa78">
<p>
使用from xyz import *导入
</p>
<ol class="org-ol">
<li>如果模块没有__all__，from xyz import *只导入非下划线开头的该模块的变量。如果是包，子模块也不会导入，除非在__all__中设置，或__init__.py中导入它们</li>
<li>如果模块有__all__，from xyz import *只导入__all__列表中指定的名称，哪怕这个名词是下划线开头的，或者是子模块</li>
<li>from xyz import *方式导入，使用简单，但是其副作用是导入大量不需要使
用的变量，甚至有可能造成名词的冲突。而__all__可以控制被导入模块在这
种导入方式下能够提供的变量名词，就是为了复制from xyz import *导入过
多的模块变量，从而避免冲突。因此，编写模块时，应该尽量加入__all__</li>
</ol>

<p>
from module import name1,name2导入
</p>
<ul class="org-ul">
<li>这种方式打导入是明确的，哪怕是导入子模块，或者导入下划线开头的名称，可以有控制的导入名称和其对应的对象</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-h:dc8c6d86-48d3-42c8-af76-70c81c93e517" class="outline-4">
<h4 id="h:dc8c6d86-48d3-42c8-af76-70c81c93e517">模块变量的修改</h4>
<div class="outline-text-4" id="text-h:dc8c6d86-48d3-42c8-af76-70c81c93e517">
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #b22222;"># </span><span style="color: #b22222;">xyz.py
</span><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">__name__</span>)
<span style="color: #a0522d;">X</span> = 10

<span style="color: #b22222;"># </span><span style="color: #b22222;">test2.py
</span><span style="color: #a020f0;">import</span> xyz

<span style="color: #483d8b;">print</span>(xyz.X)

<span style="color: #b22222;"># </span><span style="color: #b22222;">test.py
</span><span style="color: #a020f0;">import</span> xyz

<span style="color: #483d8b;">print</span>(xyz.X)
xyz.<span style="color: #a0522d;">X</span> = 50

<span style="color: #a020f0;">import</span> test2
</pre>
</div>
<p>
模块对象是同一个，因此模块的变量也是同一个，对模块变量的修改，会影响所有使用者
</p>

<ul class="org-ul">
<li>建议不要修改模块的变量</li>
<li>可以通过前面介绍的猴子补丁，也可以通过打补丁的方式，修改模块的变量、类、函数等的内容。</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:1c491242-2c08-4776-8414-b224610d9db8" class="outline-3">
<h3 id="h:1c491242-2c08-4776-8414-b224610d9db8">包管理</h3>
<div class="outline-text-3" id="text-h:1c491242-2c08-4776-8414-b224610d9db8">
</div>
<div id="outline-container-h:a4ca33a7-9443-41d8-9125-73664b46fe9e" class="outline-4">
<h4 id="h:a4ca33a7-9443-41d8-9125-73664b46fe9e">为什么使用包管理</h4>
<div class="outline-text-4" id="text-h:a4ca33a7-9443-41d8-9125-73664b46fe9e">
<p>
Python的模块或者源文件直接可以复制到目标项目目录中，就可以导入使用了。
</p>

<p>
但是为了更多项目调用使用，或者共享给别人，就需要打包，或发布到网络，以便供人使用。
</p>

<p>
目的也是为了复用。
</p>

<p>
Pypi（Python Package Index），公共的模块存储中心， <a href="https://pypi.python.org/pypi">https://pypi.python.org/pypi</a>
</p>
</div>
</div>
<div id="outline-container-h:4c8199e6-ec36-4605-ae09-5cd4968c1240" class="outline-4">
<h4 id="h:4c8199e6-ec36-4605-ae09-5cd4968c1240">主要工具</h4>
<div class="outline-text-4" id="text-h:4c8199e6-ec36-4605-ae09-5cd4968c1240">
</div>
<div id="outline-container-h:4ed3fc8b-4d0f-4651-b02c-3faba8b15db3" class="outline-5">
<h5 id="h:4ed3fc8b-4d0f-4651-b02c-3faba8b15db3">distutils</h5>
<div class="outline-text-5" id="text-h:4ed3fc8b-4d0f-4651-b02c-3faba8b15db3">
<p>
官方库distutils，使用安装脚本setup.py 来构建、安装包。
</p>

<p>
从1998年就是标准库的一部分，直到2000年停止开发。
</p>
</div>
</div>
<div id="outline-container-h:3e64046a-302e-413c-819f-1a665f5e5edb" class="outline-5">
<h5 id="h:3e64046a-302e-413c-819f-1a665f5e5edb">setuptools</h5>
<div class="outline-text-5" id="text-h:3e64046a-302e-413c-819f-1a665f5e5edb">
<p>
它是替代distutils的增强版工具集，包含esay_install工具，使用ez_setup.py文件。支持egg格式的构建和安装。
</p>

<p>
提供查询、下载、安装、构建、发布、管理等包管理功能。
</p>

<p>
setuptools是包管理的核心模块。
</p>

<p>
后来，setuptools开发缓慢了，出现基于setuptools的distribute来替代
setuptools。2013年，这两个项目重新合并，distribute被废弃，setuptools依
然是Python安装打包的标准方式。
</p>


<p>
set.py创建一个源代码分发包的例子
可以再帮助文档chm上搜索索引setup，点击最上面的Distributing Python Modules(Legacy version)，然后选择Writing the Setup Script，参照例子
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> distutils.core <span style="color: #a020f0;">import</span> setup

setup(name=<span style="color: #8b2252;">'Distutils'</span>,
      version=<span style="color: #8b2252;">'1.0'</span>,
      description=<span style="color: #8b2252;">'Python Distribution Utilities'</span>,
      author=<span style="color: #8b2252;">'Greg Ward'</span>,
      author_email=<span style="color: #8b2252;">'gward@python.net'</span>,
      url=<span style="color: #8b2252;">'https://www.python.org/sigs/distutils-sig/'</span>,
      packages=[<span style="color: #8b2252;">'distutils'</span>, <span style="color: #8b2252;">'distutils.command'</span>],
     )
</pre>
</div>

<pre class="example" id="orgc5366fb">
name 名字
version 版本
description 描述信息
author 作者
author_email 作者邮箱
url 包的主页，可以不写
packages = [] 打包列表
packages=[‘distutils’]
指定distutils，就会把distutils所有的非目录子模块打包
packages=[‘distutils’, ‘distutils.command’]
逐级建立目录，但是只把distutils的所有非目录子模块打包，把distutils.command打包
</pre>
</div>
</div>
<div id="outline-container-h:1bd56ba0-d7ad-438c-a884-c2e489b7debc" class="outline-5">
<h5 id="h:1bd56ba0-d7ad-438c-a884-c2e489b7debc">pip</h5>
<div class="outline-text-5" id="text-h:1bd56ba0-d7ad-438c-a884-c2e489b7debc">
<p>
pip目前包管理的事实标准。
</p>

<p>
构建在setuptools之上，替代easy_install的。同样提供丰富的包管理功能
</p>

<p>
Python3.4之前，需要单独安装，从Python3.4开始直接包含在安装文件中
</p>
</div>
</div>
<div id="outline-container-h:5fa10588-55f4-4ce0-84a5-5fcc785cd83f" class="outline-5">
<h5 id="h:5fa10588-55f4-4ce0-84a5-5fcc785cd83f">wheel</h5>
<div class="outline-text-5" id="text-h:5fa10588-55f4-4ce0-84a5-5fcc785cd83f">
<p>
wheel格式定义在PEP427中。
</p>

<p>
wheel是zip打包的扩展名为.whl的文件，文件中不包含.pyc文件.
</p>

<p>
提供bdist_wheel作为setuptools的扩展命令，这个命令可以用来生成新打包格式wheel。
</p>

<p>
pip从1.4版本开始提供了一个wheel子命令来安装wheel包。当然，需要先安装wheel模块。
</p>

<p>
它可以让Python库以二进制形式安装，而不需要再本地编译
</p>


<p>
<a href="https://packaging.python.org/">https://packaging.python.org/</a>
</p>


<p>
<a href="https://packaging.python.org/en/latest/tutorials/packaging-projects/">https://packaging.python.org/en/latest/tutorials/packaging-projects/</a>
</p>
</div>
</div>
</div>
<div id="outline-container-h:9a994bf4-1455-408f-af3e-ed2ceb02db01" class="outline-4">
<h4 id="h:9a994bf4-1455-408f-af3e-ed2ceb02db01">包制作</h4>
<div class="outline-text-4" id="text-h:9a994bf4-1455-408f-af3e-ed2ceb02db01">
<p>
参考：
</p>
<ul class="org-ul">
<li>python-emacs: <a href="https://github.com/jlumpe/python-emacs">https://github.com/jlumpe/python-emacs</a></li>
<li>flask: <a href="https://github.com/pallets/flask">https://github.com/pallets/flask</a></li>
<li>视频：
<ul class="org-ul">
<li><a href="https://youtu.be/jd1aRE5pJWc?si=sug6Mx9y85YhzVSY">从pip到uv：一口气梳理现代Python项目管理全流程</a></li>
<li><a href="https://youtu.be/2m0Ygyzli5I?si=GLUCIrUWPJRmOzZN">build + hatchling 15分钟搞懂Python项目结构和打包</a></li>
</ul></li>
</ul>
</div>
<div id="outline-container-h:b187cfea-0416-4c83-912f-a070ddabe53b" class="outline-5">
<h5 id="h:b187cfea-0416-4c83-912f-a070ddabe53b">准备构建包的文件</h5>
<div class="outline-text-5" id="text-h:b187cfea-0416-4c83-912f-a070ddabe53b">
<p>
文件目录结构
</p>

<div class="org-src-container">
<pre class="src src-sh"> packaging_tutorial/
&#9500;&#9472;&#9472; LICENSE
&#9500;&#9472;&#9472; pyproject.toml
&#9500;&#9472;&#9472; README.md
&#9500;&#9472;&#9472; src/
&#9474;   &#9492;&#9472;&#9472; example_package_YOUR_USERNAME_HERE/
&#9474;       &#9500;&#9472;&#9472; __init__.py
&#9474;       &#9492;&#9472;&#9472; example.py
&#9492;&#9472;&#9472; tests/
</pre>
</div>

<p>
说明：
</p>
<ul class="org-ul">
<li>packaging_tutorial  可以是任意的目录名</li>
<li>pyproject.toml 是打包配置文件</li>
<li>src 里面存放的就是你的程序代码</li>
<li>example_package_YOUR_USERNAME_HERE 需要改成你期望发布的模块包名（官方建议是在包名后面加上自己的用户名，防止和现有库名重复）</li>
<li>LICENSE 是许可信息</li>
<li>README.md 就是 readme 文件。</li>
<li>tests 存放测试文件的目录</li>
</ul>

<p>
build-system 选择构建后端，支持 Hatchling(默认)、setuptools、Flit、PDM
</p>
<div class="org-src-container">
<pre class="src src-sh">[build-system]
<span style="color: #a0522d;">requires</span> = [<span style="color: #8b2252;">"hatchling"</span>]
build-backend = <span style="color: #8b2252;">"hatchling.build"</span>
</pre>
</div>

<p>
pyproject.toml
</p>
<div class="org-src-container">
<pre class="src src-sh">[project]
<span style="color: #a0522d;">name</span> = <span style="color: #8b2252;">"example_package_YOUR_USERNAME_HERE"</span>
<span style="color: #a0522d;">version</span> = <span style="color: #8b2252;">"0.0.1"</span>
<span style="color: #a0522d;">authors</span> = [
  { <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"Example Author"</span>, <span style="color: #a0522d;">email</span>=<span style="color: #8b2252;">"author@example.com"</span> },
]
<span style="color: #a0522d;">description</span> = <span style="color: #8b2252;">"A small example package"</span>
<span style="color: #a0522d;">readme</span> = <span style="color: #8b2252;">"README.md"</span>
requires-python = <span style="color: #8b2252;">"&gt;=3.8"</span>
<span style="color: #a0522d;">classifiers</span> = [
    <span style="color: #8b2252;">"Programming Language :: Python :: 3"</span>,
    <span style="color: #8b2252;">"Operating System :: OS Independent"</span>,
]
<span style="color: #a0522d;">license</span> = <span style="color: #8b2252;">"MIT"</span>
license-files = [<span style="color: #8b2252;">"LICEN[CS]E*"</span>]

[project.urls]
<span style="color: #a0522d;">Homepage</span> = <span style="color: #8b2252;">"https://github.com/pypa/sampleproject"</span>
<span style="color: #a0522d;">Issues</span> = <span style="color: #8b2252;">"https://github.com/pypa/sampleproject/issues"</span>
</pre>
</div>

<p>
说明：
</p>
<ul class="org-ul">
<li>name 是软件包的分配名称。这可以是任何名称，只要它只包含字母、数字、.、_ 和 - 。</li>
<li>version 是包的版本。</li>
<li>authors 用于标识包的作者;您可以为每个作者指定一个姓名和一个电子邮件。您还可以以相同的格式列出维护员。</li>
<li>description 是包的简短单句摘要。</li>
<li>readme 是包含包详细描述的文件的路径。这显示在 PyPI 上的包详细信息页面上。pyproject.toml 指南中还描述了一个更高级的 table 形式。</li>
<li>requires-python 提供项目支持的 Python 版本。</li>
<li><p>
classifiers 为 index 和 pip 提供了一些关于您的包的其他元数据。
</p>

<p>
在这种情况下，该软件包仅与 Python 3 兼容，并且与作系统无关。您应该始终至少包含您的包适用于哪些 Python 版本以及您的包将适用于哪些作系统。有关分类器的完整列表，请参阅 <a href="https://pypi.org/classifiers/">https://pypi.org/classifiers/</a>。
</p></li>
<li>license 是软件包的 SPDX 许可证表达式。尚不支持所有构建后端。</li>
<li>license-files 是许可证文件的 glob 路径列表，相对于 pyproject.toml 所在的目录。尚不支持所有构建后端。</li>
<li>urls 允许您列出任意数量的额外链接以在 PyPI 上显示。通常，这可能是源、文档、问题跟踪器等。</li>
</ul>

<p>
其他请参阅 <a href="https://packaging.python.org/en/latest/guides/writing-pyproject-toml/#writing-pyproject-toml">pyproject.toml 指南</a>
</p>
</div>
</div>
<div id="outline-container-h:7698e381-4f41-4a77-b3c8-3a8a63e61f62" class="outline-5">
<h5 id="h:7698e381-4f41-4a77-b3c8-3a8a63e61f62">构建包</h5>
<div class="outline-text-5" id="text-h:7698e381-4f41-4a77-b3c8-3a8a63e61f62">
<p>
1.安装 build 库
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#39318;&#20808;&#30830;&#20445;&#24744;&#23433;&#35013;&#20102;&#26368;&#26032;&#29256;&#26412;pip
</span>python -m pip install --upgrade pip
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013; build &#24211;
</span>python -m pip install --upgrade build
</pre>
</div>

<p>
2.打包构建
</p>

<p>
切换到 pyproject.toml 文件所在目录，运行下面的指令
</p>
<div class="org-src-container">
<pre class="src src-sh">python -m build
</pre>
</div>

<p>
此命令应输出大量文本，完成后应在 dist 目录中生成两个文件：
</p>
<div class="org-src-container">
<pre class="src src-sh">dist/
&#9500;&#9472;&#9472; example_package_YOUR_USERNAME_HERE-0.0.1-py3-none-any.whl
&#9492;&#9472;&#9472; example_package_YOUR_USERNAME_HERE-0.0.1.tar.gz
</pre>
</div>

<p>
tar.gz 文件是一个源发行版，而 .whl 文件是构建发行版。
</p>
</div>
</div>
<div id="outline-container-h:bca1f2a1-6979-45ad-a8da-6c70ba5eb4c5" class="outline-5">
<h5 id="h:bca1f2a1-6979-45ad-a8da-6c70ba5eb4c5">上传模块包到PyPI</h5>
<div class="outline-text-5" id="text-h:bca1f2a1-6979-45ad-a8da-6c70ba5eb4c5">
<ol class="org-ol">
<li>注册 PyPI 账号</li>
</ol>

<p>
在 PyPI 上注册一个帐号：<a href="https://pypi.org/account/register/">https://pypi.org/account/register/</a>。
按提示完成电子邮件地址验证、以及一些安全设置。
</p>

<p>
2.创建 API Token
</p>

<p>
访问：<a href="https://pypi.org/manage/account/token/">https://pypi.org/manage/account/token/</a>
</p>


<p>
3.创建 .pypirc 文件
</p>

<p>
在系统 HOME 目录创建 .pypirc 配置文件:
</p>

<ul class="org-ul">
<li>Linux : ~/.pypirc</li>
<li>Windows： C:\Users\用户名\.pypirc</li>
</ul>

<p>
文件内容如下：
</p>

<div class="org-src-container">
<pre class="src src-sh">[distutils]
index-servers=pypi

[pypi]
<span style="color: #a0522d;">repository</span> = https://upload.pypi.org/legacy/
<span style="color: #a0522d;">username</span> = __token__
<span style="color: #a0522d;">password</span> = &lt;Token&gt;
</pre>
</div>

<p>
其中，&lt;Token&gt; 改成上一步创建的 token（以pypi-开头的）。如果觉得不安全也可以 username 和 password 两行删除，在后面的上传过程中会提示让手动输入
</p>


<p>
4.安装 twine 库
</p>

<div class="org-src-container">
<pre class="src src-sh">pip install --upgrade twine
</pre>
</div>

<p>
上传模块包
终端里运行下面指令上传 dist 目录的模块包到 PyPI 平台
</p>

<div class="org-src-container">
<pre class="src src-sh">twine upload dist/*
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:af741a18-83f7-4979-9ef6-228ab9514815" class="outline-3">
<h3 id="h:af741a18-83f7-4979-9ef6-228ab9514815">logging日志处理模块</h3>
<div class="outline-text-3" id="text-h:af741a18-83f7-4979-9ef6-228ab9514815">
<p>
官方文档：<a href="https://docs.python.org/3/library/logging.html">https://docs.python.org/3/library/logging.html</a>
</p>
</div>
<div id="outline-container-h:1bfa5848-e65d-4312-94da-6fdedc9a6bee" class="outline-4">
<h4 id="h:1bfa5848-e65d-4312-94da-6fdedc9a6bee">日志级别</h4>
<div class="outline-text-4" id="text-h:1bfa5848-e65d-4312-94da-6fdedc9a6bee">
<div class="org-src-container">
<pre class="src src-sh">&#26085;&#24535;&#32423;&#21035;Level &#25968;&#20540;
CRITICAL      <span style="color: #b22222;">#</span><span style="color: #b22222;">50
</span>ERROR         <span style="color: #b22222;">#</span><span style="color: #b22222;">40
</span>WARNING       <span style="color: #b22222;">#</span><span style="color: #b22222;">30&#65292;&#40664;&#35748;&#32423;&#21035;
</span>INFO          <span style="color: #b22222;">#</span><span style="color: #b22222;">20
</span>DEBUG         <span style="color: #b22222;">#</span><span style="color: #b22222;">10
</span>NOTSET        <span style="color: #b22222;">#</span><span style="color: #b22222;">0</span>
</pre>
</div>


<p>
日志级别指的是产生日志的事件的严重程度
</p>

<p>
设置一个级别后，严重程度低于设置值的日志消息将被忽略
</p>

<p>
级别定义一般都写在配置文件里
</p>

<p>
其方法有：
debug()、 info()、 warning()、 error() 和 critical()
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging

logging.basicConfig(level=logging.INFO)

logging.info(<span style="color: #8b2252;">'test'</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;
</span>INFO:root:test
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging

logging.basicConfig(level=logging.INFO)
logging.info(<span style="color: #8b2252;">'info ~~~~'</span>)      <span style="color: #b22222;">#</span><span style="color: #b22222;">logger&#40664;&#35748;&#25171;&#21360;&#21040;&#25511;&#21046;&#21488;&#65292;info&#23558;&#28040;&#24687;&#21253;&#35013;&#25104;INFO 20
</span>logging.warning(<span style="color: #8b2252;">'waring ~~~~'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32418;&#33394;&#65292;stderr, 30
</span>logging.debug(<span style="color: #8b2252;">'debug ~~~~'</span>)    <span style="color: #b22222;">#</span><span style="color: #b22222;">10 &lt; 30
</span>logging.error(<span style="color: #8b2252;">'errror ~~~~'</span>)   <span style="color: #b22222;">#</span><span style="color: #b22222;">40 &gt; 30  
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32570;&#30465;logger&#40664;&#35748;&#26684;&#24335; &#28040;&#24687;&#32423;&#21035;:&#21517;&#23383;:&#28040;&#24687;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">INFO:root:info ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">WARNING:root:waring ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">ERROR:root:errror ~~~~</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:39311dac-1eeb-42e7-8755-1f47c6da56d8" class="outline-4">
<h4 id="h:39311dac-1eeb-42e7-8755-1f47c6da56d8">格式字符串</h4>
<div class="outline-text-4" id="text-h:39311dac-1eeb-42e7-8755-1f47c6da56d8">
<div class="org-src-container">
<pre class="src src-sh">%(message)s     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26085;&#24535;&#28040;&#24687;&#20869;&#23481;&#12290;he logged message, computed as msg % args. &#24403;&#35843;&#29992;Formatter.format()&#26102;&#35774;&#32622;
</span>%(asctime)s     <span style="color: #b22222;">#</span><span style="color: #b22222;">asctime&#12290;&#21019;&#24314;LogRecord&#26102;&#30340;&#21487;&#35835;&#26102;&#38388;&#12290;&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;&#23427;&#30340;&#26684;&#24335;&#20026;'2003-07-08 16:49:45,896'&#65288;&#36887;&#21495;&#21518;&#38754;&#30340;&#25968;&#23383;&#26159;&#27627;&#31186;&#37096;&#20998;&#30340;&#26102;&#38388;&#65289;
</span>%(funcName)s    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20989;&#25968;&#21517;&#12290;&#26085;&#24535;&#35843;&#29992;&#25152;&#22312;&#30340;&#20989;&#25968;&#21517;
</span>%(levelname)s   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26085;&#24535;&#32423;&#21035;&#21517;&#31216;&#12290; &#28040;&#24687;&#30340;&#32423;&#21035;&#21517;&#31216;'DEBUG', 'INFO', 'WARNING', 'ERROR', 'CRITICAL'
</span>%(levelno)s     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26085;&#35760;&#32423;&#21035;&#25968;&#20540;&#12290;&#28040;&#24687;&#30340;&#32423;&#21035;&#25968;&#23383; &#65292;&#23545;&#24212;DEBUG, INFO, WARNING, ERROR, CRITICAL
</span>%(lineno)d      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#34892;&#21495;&#12290;&#26085;&#24535;&#35843;&#29992;&#25152;&#22312;&#30340;&#28304;&#30721;&#34892;&#21495;
</span>%(module)s      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27169;&#22359;&#12290;  &#27169;&#22359;&#65288;filename&#30340;&#21517;&#23383;&#37096;&#20998;&#65289;
</span>%(process)d     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36827;&#31243; ID
</span>%(thread)d      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32447;&#31243; ID
</span>%(processName)s <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36827;&#31243;&#21517;
</span>%(threadName)s  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32447;&#31243;&#21517;&#23383;
</span>%(name)s        <span style="color: #b22222;">#</span><span style="color: #b22222;">logger&#21517;&#23383;</span>
</pre>
</div>

<p>
注意：funcName、threadName、processName都是小驼峰
</p>
</div>
</div>
<div id="outline-container-h:9c7a8f26-522c-4058-a167-d15e2b1e2b22" class="outline-4">
<h4 id="h:9c7a8f26-522c-4058-a167-d15e2b1e2b22">范例</h4>
<div class="outline-text-4" id="text-h:9c7a8f26-522c-4058-a167-d15e2b1e2b22">
</div>
<div id="outline-container-h:eef7dbb9-6683-47bd-a5db-1b55ae7a4a52" class="outline-5">
<h5 id="h:eef7dbb9-6683-47bd-a5db-1b55ae7a4a52">默认级别</h5>
<div class="outline-text-5" id="text-h:eef7dbb9-6683-47bd-a5db-1b55ae7a4a52">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)-15s</span><span style="color: #008b8b;">\t</span><span style="color: #8b2252;">Thread info:%(thread)d %(threadName)s %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT)

logging.info(<span style="color: #8b2252;">'I am {}'</span>.<span style="color: #483d8b;">format</span>(20))
logging.warning(<span style="color: #8b2252;">'I am {}'</span>.<span style="color: #483d8b;">format</span>(20))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025-02-23 11:28:55,489       Thread info:10584 MainThread I am 20</span>
</pre>
</div>

<p>
由于默认级别是WARNING，所以INFO的结果不显示
</p>
</div>
</div>
<div id="outline-container-h:cf11fa63-6c84-4f00-8043-412a5e2f792e" class="outline-5">
<h5 id="h:cf11fa63-6c84-4f00-8043-412a5e2f792e">构建消息</h5>
<div class="outline-text-5" id="text-h:cf11fa63-6c84-4f00-8043-412a5e2f792e">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)-15s</span><span style="color: #008b8b;">\t</span><span style="color: #8b2252;">Thread info:%(thread)d %(threadName)s %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

logging.info(<span style="color: #8b2252;">'I am {}'</span>.<span style="color: #483d8b;">format</span>(20)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21333;&#19968;&#23383;&#31526;&#20018;
</span>logging.warning(<span style="color: #8b2252;">'I am %d %s'</span>, 20, <span style="color: #8b2252;">'years old.'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">c&#39118;&#26684;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025-02-23 11:37:40,339       Thread info:23112 MainThread I am 20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025-02-23 11:37:40,339       Thread info:23112 MainThread I am 20 years old.</span>
</pre>
</div>

<p>
上例是基本的使用方法，大多数时候，使用的是info，正常运行信息的输出
</p>

<p>
日志级别和格式字符串扩展的例子
</p>

<p>
可插入指定打印字符，使用字典
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)-15s</span><span style="color: #008b8b;">\t</span><span style="color: #8b2252;">Thread info:%(thread)d %(threadName)s %(message)s %(hello)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.WARNING) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32423;&#21035;WARNING
</span>
<span style="color: #a0522d;">d</span> = {<span style="color: #8b2252;">'hello'</span>: <span style="color: #8b2252;">'world'</span>}
logging.info(<span style="color: #8b2252;">'I am {}'</span>.<span style="color: #483d8b;">format</span>(20), extra = d) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32423;&#21035;INFO
</span>logging.warning(<span style="color: #8b2252;">'I am %d %s'</span>, 20, <span style="color: #8b2252;">'years old.'</span>,extra = d) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32423;&#21035;WARNING
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025-02-23 11:38:17,867       Thread info:7220 MainThread I am 20 years old. world</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:0834cf7b-0a4b-4124-ab4e-261c98e91c59" class="outline-5">
<h5 id="h:0834cf7b-0a4b-4124-ab4e-261c98e91c59">修改日期格式</h5>
<div class="outline-text-5" id="text-h:0834cf7b-0a4b-4124-ab4e-261c98e91c59">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging

logging.basicConfig(<span style="color: #483d8b;">format</span>=<span style="color: #8b2252;">'%(asctime)s %(message)s'</span>, datefmt=<span style="color: #8b2252;">'%Y/%m/%d %h:%M:%S'</span>)
logging.warning(<span style="color: #8b2252;">'this event was logged.'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025/02/23 Feb:38:47 this event was logged.</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:670b26a3-e02a-4dcd-bc2e-8c0df917ca1c" class="outline-5">
<h5 id="h:670b26a3-e02a-4dcd-bc2e-8c0df917ca1c">输出到文件</h5>
<div class="outline-text-5" id="text-h:670b26a3-e02a-4dcd-bc2e-8c0df917ca1c">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging

logging.basicConfig(<span style="color: #483d8b;">format</span>=<span style="color: #8b2252;">'%(asctime)s %(message)s'</span>, filename=<span style="color: #8b2252;">'d:/test.log'</span>)
logging.warning(<span style="color: #8b2252;">'this event was logged.'</span>)
</pre>
</div>

<ul class="org-ul">
<li>filename设置日志文件</li>
<li>filemode设置读写模式。默认a，追加模式，将结果写入文件，文件没有 创建文件</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s</span><span style="color: #008b8b;">\x01</span><span style="color: #8b2252;">%(thread)s</span><span style="color: #008b8b;">\x01</span><span style="color: #8b2252;">%(threadName)s</span><span style="color: #008b8b;">\x01</span><span style="color: #8b2252;">%(message)s, %(school)s"</span>  <span style="color: #b22222;">#</span><span style="color: #b22222;">\x01&#21487;&#20197;&#29992;&#26469;&#20999;&#27573;
</span>logging.basicConfig(level=logging.INFO, <span style="color: #483d8b;">format</span>=FORMAT, datefmt=<span style="color: #8b2252;">'%Y&#24180;-%m-%d %H:%M:%S'</span>,
                    filename=<span style="color: #8b2252;">'d:/tmp/test.log'</span>, filemode=<span style="color: #8b2252;">'w'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25991;&#20214;&#40664;&#35748;a&#65292;&#36861;&#21152;&#27169;&#24335;
</span>
<span style="color: #a0522d;">d</span> = {<span style="color: #8b2252;">'school'</span>: <span style="color: #8b2252;">'CN'</span>}
logging.info(<span style="color: #8b2252;">'I am {}'</span>.<span style="color: #483d8b;">format</span>(20), extra=d)
logging.info(<span style="color: #8b2252;">'I am %d %s'</span>, 20, <span style="color: #8b2252;">"years old"</span>, extra=d)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:3e268c43-4e6e-4e20-a1f7-d07862da81ba" class="outline-4">
<h4 id="h:3e268c43-4e6e-4e20-a1f7-d07862da81ba">Logger类</h4>
<div class="outline-text-4" id="text-h:3e268c43-4e6e-4e20-a1f7-d07862da81ba">
<p>
在logging模块中，顶层代码中有
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">root</span> = RootLogger(WARNING) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22823;&#32422;&#22312;1995&#34892;&#22788;&#12290;&#25351;&#23450;&#26681;Logger&#23545;&#35937;&#30340;&#40664;&#35748;&#32423;&#21035;&#12290;&#23601;&#22312;basicConfig&#20989;&#25968;&#19978;&#38754;
</span>Logger.<span style="color: #a0522d;">root</span> = root <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20026;&#31867;Logger&#22686;&#21152;&#31867;&#23646;&#24615;root</span>
</pre>
</div>

<p>
logging模块加载的时候，会创建一个全局对象root，它是一个RootLogger实例，即root logger。根Logger对象的默认级别是WARNING
</p>

<p>
RootLogger类继承自Logger类
</p>

<p>
类Logger初始化方法签名是(name, level=0)
</p>

<p>
类RootLogger初始化方法签名(level)，本质上调用的是 Logger.__init__(self, "root", WARNING)
</p>

<p>
调用logging.basicConfig来调整级别，就是对这个 <code>根Logger</code> 的级别进行修改
</p>
</div>
<div id="outline-container-h:39cb67b6-1155-44be-8f31-4d0609d4e34d" class="outline-5">
<h5 id="h:39cb67b6-1155-44be-8f31-4d0609d4e34d">构造</h5>
<div class="outline-text-5" id="text-h:39cb67b6-1155-44be-8f31-4d0609d4e34d">
<p>
Logger实例的构建，使用Logger类也行，但推荐getLogger函数
</p>

<div class="org-src-container">
<pre class="src src-python">Logger.<span style="color: #a0522d;">manager</span> = Manager(Logger.root) <span style="color: #b22222;"># </span><span style="color: #b22222;">1997&#34892;&#65292;&#20026;Logger&#31867;&#27880;&#20837;&#19968;&#20010;manager&#31867;&#23646;&#24615;
</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">getLogger</span>(name=<span style="color: #008b8b;">None</span>):
    <span style="color: #8b2252;">"""
    Return a logger with the specified name, creating it if necessary.

    If no name is specified, return the root logger.
    """</span>
    <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> name <span style="color: #a020f0;">or</span> <span style="color: #483d8b;">isinstance</span>(name, <span style="color: #483d8b;">str</span>) <span style="color: #a020f0;">and</span> name == root.name:
        <span style="color: #a020f0;">return</span> root <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27809;&#26377;&#25351;&#23450;&#21517;&#31216;&#65292;&#36820;&#22238;&#26681;logger
</span>    <span style="color: #a020f0;">return</span> Logger.manager.getLogger(name)
</pre>
</div>

<p>
使用工厂方法返回一个Logger实例
</p>

<p>
指定name，返回一个名称为name的Logger实例。如果再次使用相同的名字，返回同一个实例。背后使用一个字典保证同一个名称返回同一个Logger实例。
</p>

<p>
未指定name，返回根Logger实例
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">a</span> = logging.Logger(<span style="color: #8b2252;">'hello'</span>, 20)
<span style="color: #a0522d;">b</span> = logging.Logger(<span style="color: #8b2252;">'hello'</span>, 30)
<span style="color: #483d8b;">print</span>(a, <span style="color: #483d8b;">id</span>(a))
<span style="color: #483d8b;">print</span>(b, <span style="color: #483d8b;">id</span>(b))

<span style="color: #a0522d;">c</span> = logging.getLogger(<span style="color: #8b2252;">'hello'</span>)
<span style="color: #a0522d;">d</span> = logging.getLogger(<span style="color: #8b2252;">'hello'</span>)
<span style="color: #483d8b;">print</span>(c, <span style="color: #483d8b;">id</span>(c))
<span style="color: #483d8b;">print</span>(d, <span style="color: #483d8b;">id</span>(d))

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;
</span>&lt;Logger hello (INFO)&gt; 35484168
&lt;Logger hello (WARNING)&gt; 35484560
&lt;Logger hello (WARNING)&gt; 42988600
&lt;Logger hello (WARNING)&gt; 42988600
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ffa05895-bb5b-4068-9d17-fc3843cf5a36" class="outline-5">
<h5 id="h:ffa05895-bb5b-4068-9d17-fc3843cf5a36">层次结构</h5>
<div class="outline-text-5" id="text-h:ffa05895-bb5b-4068-9d17-fc3843cf5a36">
<p>
Logger是层次结构的，使用 . 点号分割，如’a’、‘a.b’或’a.b.c.d’，a是a.b的父parent，a.b是a的子child。对于foo来说，名字为foo.bar、foo.bar.baz、foo.bam都是 foo的后代
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">root</span> = logging.root
<span style="color: #483d8b;">print</span>(root.name, <span style="color: #483d8b;">id</span>(root), <span style="color: #483d8b;">type</span>(root), root.parent) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26681;&#27809;&#26377;&#29238;&#12290; root 2162635612784 &lt;class 'logging.RootLogger'&gt; None
</span>
<span style="color: #a0522d;">log1</span> = logging.getLogger(<span style="color: #483d8b;">__name__</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">__main__ &#27169;&#22359;&#32423;logger, &#22312;&#24403;&#21069;&#27169;&#22359;&#20013;&#37117;&#21487;&#20197;&#20351;&#29992;log1
</span><span style="color: #483d8b;">print</span>(log1.name, <span style="color: #483d8b;">id</span>(log1), <span style="color: #483d8b;">type</span>(log1), log1.parent, <span style="color: #483d8b;">id</span>(log1.parent)) <span style="color: #b22222;">#</span><span style="color: #b22222;">parent &#25351;&#21521; root
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">__main__ 2162630622384 &lt;class 'logging.Logger'&gt; &lt;RootLogger root (WARNING)&gt; 2162635612784
</span>
<span style="color: #a0522d;">log2</span> = logging.getLogger(<span style="color: #8b2252;">'hello'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">parent &#20063;&#26159; root
</span><span style="color: #483d8b;">print</span>(log2.name, log2.parent, <span style="color: #483d8b;">id</span>(log2.parent)) <span style="color: #b22222;">#</span><span style="color: #b22222;">hello &lt;RootLogger root (WARNING)&gt; 2162635612784
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#29238;&#23376;&#20851;&#31995;
</span><span style="color: #a0522d;">log3</span> = logging.getLogger(<span style="color: #483d8b;">__name__</span> + <span style="color: #8b2252;">'.child'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">child&#21487;&#20219;&#24847;&#23383;&#31526;&#20018;.
</span><span style="color: #483d8b;">print</span>(log3.name, log3.parent, <span style="color: #483d8b;">id</span>(log3.parent)) <span style="color: #b22222;"># </span><span style="color: #b22222;">__main__.child &lt;Logger __main__ (WARNING)&gt; 2162630622384</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">root</span> = logging.root
<span style="color: #483d8b;">print</span>(root.name, <span style="color: #483d8b;">id</span>(root), <span style="color: #483d8b;">type</span>(root), root.parent) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26681;&#27809;&#26377;&#29238;&#12290;
</span>
<span style="color: #a0522d;">log1</span> = logging.getLogger(<span style="color: #8b2252;">'s'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">__main__ &#27169;&#22359;&#32423;logger, &#22312;&#24403;&#21069;&#27169;&#22359;&#20013;&#37117;&#21487;&#20197;&#20351;&#29992;log1
</span><span style="color: #483d8b;">print</span>(log1.name, <span style="color: #483d8b;">id</span>(log1), <span style="color: #483d8b;">type</span>(log1), log1.parent, <span style="color: #483d8b;">id</span>(log1.parent)) <span style="color: #b22222;">#</span><span style="color: #b22222;">parent &#25351;&#21521; root
</span>
<span style="color: #a0522d;">log2</span> = logging.getLogger(<span style="color: #8b2252;">'s.s1'</span>)
<span style="color: #483d8b;">print</span>(log2.name, <span style="color: #483d8b;">id</span>(log2), log2.parent, <span style="color: #483d8b;">id</span>(log2.parent))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#29238;&#23376;&#20851;&#31995;
</span><span style="color: #a0522d;">log3</span> = logging.getLogger(<span style="color: #8b2252;">'s.s1.s11'</span>)
<span style="color: #483d8b;">print</span>(log3.name, log3.parent, <span style="color: #483d8b;">id</span>(log3.parent))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524; &#29238;&#23376;&#23385;&#23376;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">: root 1888229155104 &lt;class 'logging.RootLogger'&gt; None
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">: s 1888224898624 &lt;class 'logging.Logger'&gt; &lt;RootLogger root (WARNING)&gt; 1888229155104
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">: s.s1 1888227152016 &lt;Logger s (WARNING)&gt; 1888224898624
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">: s.s1.s11 &lt;Logger s.s1 (WARNING)&gt; 1888227152016</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:11b3867b-825e-4362-a8b4-6360ad67b805" class="outline-5">
<h5 id="h:11b3867b-825e-4362-a8b4-6360ad67b805">Level级别设置</h5>
<div class="outline-text-5" id="text-h:11b3867b-825e-4362-a8b4-6360ad67b805">
<p>
每一个logger实例都有级别
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)-15s</span><span style="color: #008b8b;">\t</span><span style="color: #8b2252;">Thread info: %(thread)d %(threadName)s [%(message)s]'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a0522d;">log1</span> = logging.getLogger(<span style="color: #483d8b;">__name__</span>)
<span style="color: #483d8b;">print</span>(log1.name, <span style="color: #483d8b;">type</span>(log1), log1.level) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26032;&#30340;logger&#23454;&#20363;&#30340;level&#26159;&#20160;&#20040; #__main__ &lt;class 'logging.Logger'&gt; 0
</span>log1.info(<span style="color: #8b2252;">'1 info'</span>)
<span style="color: #483d8b;">print</span>(log1.getEffectiveLevel()) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#31561;&#25928;&#32423;&#21035;,&#20174;&#21738;&#37324;&#26469;&#30340; #20
</span>
log1.setLevel(28) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;logger&#26159;level
</span><span style="color: #483d8b;">print</span>(log1.getEffectiveLevel(), log1.level) <span style="color: #b22222;">#</span><span style="color: #b22222;">28 28
</span>log1.info(<span style="color: #8b2252;">'2 info'</span>)

log1.setLevel(42)
log1.warning(<span style="color: #8b2252;">'3 warning'</span>)
log1.error(<span style="color: #8b2252;">'4 error'</span>)
log1.critical(<span style="color: #8b2252;">'5 critical'</span>)

<span style="color: #a0522d;">root</span> = logging.getLogger() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26681;logger
</span>root.info(<span style="color: #8b2252;">'6 root info'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#24433;&#21709;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025-02-24 23:20:34,215       Thread info: 20352 MainThread [1 info]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025-02-24 23:20:34,215       Thread info: 20352 MainThread [5 critical]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025-02-24 23:20:34,215       Thread info: 20352 MainThread [6 root info]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">__main__ &lt;class 'logging.Logger'&gt; 0
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">28 28</span>
</pre>
</div>

<p>
每一个logger实例，都有一个等效的level。
</p>

<p>
logger对象可以在创建后动态的修改自己的level。
</p>

<p>
等效level决定着logger实例能输出什么级别信息。
</p>

<p>
注意：推荐使用setLevel方法修改级别
</p>
</div>
</div>
<div id="outline-container-h:23bebbc7-9ead-4e8b-8cd9-fa007c70ce9c" class="outline-5">
<h5 id="h:23bebbc7-9ead-4e8b-8cd9-fa007c70ce9c">Handler</h5>
<div class="outline-text-5" id="text-h:23bebbc7-9ead-4e8b-8cd9-fa007c70ce9c">
<p>
Handler 控制日志信息的输出目的地，可以是控制台、文件。
</p>

<ul class="org-ul">
<li>可以单独设置level</li>
<li>可以单独设置格式</li>
<li>可以设置过滤器</li>
</ul>

<p>
Handler类层次
</p>

<ul class="org-ul">
<li>Handler
<ul class="org-ul">
<li>StreamHandler # 不指定使用sys.stderr
<ul class="org-ul">
<li>FileHandler # 文件</li>
<li>_StderrHandler # 标准输出</li>
</ul></li>
<li>NullHandler # 什么都不做</li>
</ul></li>
</ul>

<p>
<b>日志输出其实是Handler做的，也就是真正干活的是Handler</b>
</p>

<p>
在logging.basicConfig函数中，如下：
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">if</span> handlers <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
    <span style="color: #a0522d;">filename</span> = kwargs.pop(<span style="color: #8b2252;">"filename"</span>, <span style="color: #008b8b;">None</span>)
    <span style="color: #a0522d;">mode</span> = kwargs.pop(<span style="color: #8b2252;">"filemode"</span>, <span style="color: #8b2252;">'a'</span>)
    <span style="color: #a020f0;">if</span> filename:
        <span style="color: #a0522d;">h</span> = FileHandler(filename, mode)
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a0522d;">stream</span> = kwargs.pop(<span style="color: #8b2252;">"stream"</span>, <span style="color: #008b8b;">None</span>)
        <span style="color: #a0522d;">h</span> = StreamHandler(stream)
    <span style="color: #a0522d;">handlers</span> = [h]
</pre>
</div>

<p>
如果设置文件名，则为根Logger加一个输出到文件的FileHandler；如果没有设置文件名，则为根
</p>

<p>
Logger加一个StreamHandler，默认输出到sys.stderr
</p>

<p>
也就是说，根logger一定会至少有一个handler的。
</p>

<p>
Handler的初始的level
</p>

<p>
范例：同时输出到多个位置
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s %(name)s %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a0522d;">logger</span> = logging.getLogger(<span style="color: #8b2252;">'test'</span>)
<span style="color: #483d8b;">print</span>(logger.name, <span style="color: #483d8b;">type</span>(logger))

logging.info(<span style="color: #8b2252;">'line 1'</span>)

<span style="color: #a0522d;">handler</span> = logging.FileHandler(<span style="color: #8b2252;">'d:/tmp/l1.log'</span>, <span style="color: #8b2252;">'w'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;handler
</span>logger.addHandler(handler) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32473;logger&#23545;&#35937;&#32465;&#23450;&#19968;&#20010;handler
</span>
logger.info(<span style="color: #8b2252;">'line 2'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25511;&#21046;&#21488;&#36755;&#20986;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">test &lt;class 'logging.Logger'&gt;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025-02-25 00:31:16,225 root line 1
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025-02-25 00:31:16,226 test line 2
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">l1.log&#25991;&#20214;&#20869;&#23481;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">line 2</span>
</pre>
</div>

<p>
Handler 的初始的level是 0
</p>
</div>
</div>
<div id="outline-container-h:adff2bd6-1da3-43a5-8659-d3f3f76efb4f" class="outline-5">
<h5 id="h:adff2bd6-1da3-43a5-8659-d3f3f76efb4f">日志流</h5>
<div class="outline-text-5" id="text-h:adff2bd6-1da3-43a5-8659-d3f3f76efb4f">
</div>
<div id="outline-container-h:7acdd2dd-b4cf-4046-a687-76ee5450b914" class="outline-6">
<h6 id="h:7acdd2dd-b4cf-4046-a687-76ee5450b914">Level的继承</h6>
<div class="outline-text-6" id="text-h:7acdd2dd-b4cf-4046-a687-76ee5450b914">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging

logging.basicConfig(<span style="color: #483d8b;">format</span>=<span style="color: #8b2252;">"%(asctime)s %(name)s [%(message)s]"</span>)

<span style="color: #a0522d;">log1</span> = logging.getLogger(<span style="color: #8b2252;">'s'</span>)
<span style="color: #483d8b;">print</span>(log1.name, log1.level, log1.getEffectiveLevel())
log1.info(<span style="color: #8b2252;">'1 info'</span>)

<span style="color: #a0522d;">log2</span> = logging.getLogger(<span style="color: #8b2252;">'s.s1'</span>)
<span style="color: #483d8b;">print</span>(log2.name, log2.level, log2.getEffectiveLevel())
log2.info(<span style="color: #8b2252;">'2 info'</span>)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)

log1.setLevel(20)
log1.info(<span style="color: #8b2252;">'3 info'</span>)
<span style="color: #483d8b;">print</span>(log1.name, log1.level, log1.getEffectiveLevel())
<span style="color: #483d8b;">print</span>(log2.name, log2.level, log2.getEffectiveLevel())
log2.info(<span style="color: #8b2252;">'4 info'</span>)

log2.setLevel(30)
<span style="color: #483d8b;">print</span>(log2.name, log2.level, log2.getEffectiveLevel())
log2.info(<span style="color: #8b2252;">'5 info'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">s 0 30
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">s.s1 0 30
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025-02-26 14:27:35,816 s [3 info]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">s 20 20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">s.s1 0 20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025-02-26 14:27:35,816 s.s1 [4 info]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">s.s1 30 30</span>
</pre>
</div>


<p>
logger实例
</p>

<ul class="org-ul">
<li>如果不设置level，则初始level为0</li>
<li>如果设置了level，就优先使用自己的level，否则，继承最近的祖先的level</li>
<li>信息是否能够从该logger实例上输出，就是要看当前函数的level是否大于等于logger的有效level，否则输出不了</li>
</ul>
</div>
</div>
<div id="outline-container-h:74416125-7886-4435-9b65-6bdabb9e5915" class="outline-6">
<h6 id="h:74416125-7886-4435-9b65-6bdabb9e5915">继承关系及信息传递</h6>
<div class="outline-text-6" id="text-h:74416125-7886-4435-9b65-6bdabb9e5915">
<ul class="org-ul">
<li>每一个Logger实例的level如同入口，让水流进来，如果这个门槛太高，信息
就进不来。例如log3.warning('log3')，如果log3定义的级别高，就不会有信
息通过log3</li>
<li>如果level没有设置，就用父logger的，如果父logger的level没有设置，继续
找父的父的，最终可以找到root上，如果root设置了就用它的，如果root没有
设置，root的默认值是WARNING</li>
<li>消息传递流程
<ol class="org-ol">
<li>如果消息在某一个logger对象上产生，这个logger就是 <b>当前logger</b> ，首
先消息level要和当前logger的EffectiveLevel比较，如果低于当前logger
的EffectiveLevel，则流程结束；否则生成log记录</li>
<li>日志记录会交给当前logger的所有handler处理，记录还要和每一个handler的级别分别比较，低的不处理，否则按照handler输出日志记录</li>
<li>当前logger的所有handler处理完后，就要看自己的propagate属性，如果是True表示向父logger传递这个日志记录，否则到此流程结束</li>
<li>如果日志记录传递到了父logger，不需要和父logger的level比较，而是直
接交给父的所有handler，父logger成为当前logger。重复2、3步骤，直到
当前logger的父logger是None退出，也就是说当前logger最后一般是root
logger（是否能到root logger要看中间的logger是否允许propagate）</li>
</ol></li>
<li>logger实例初始的propagate属性为True，即允许向父logger传递消息</li>
<li>logging.basicConfig函数
<ul class="org-ul">
<li>如果root没有handler，就默认创建一个StreamHandler，如果设置了
filename，就创建一个FileHandler</li>
<li>如果设置了format参数，就会用它生成一个Formatter对象，否则会生成缺
省Formatter，并把这个formatter加入到刚才创建的handler上，然后把这
些handler加入到root.handlers列表上。level是设置给root logger的</li>
<li>如果root.handlers列表不为空，logging.basicConfig的调用什么都不做</li>
</ul></li>
</ul>

<p>
<a href="https://docs.python.org/3.13/howto/logging.html#logging-flow">官方日志流转图</a>
</p>


<figure id="orgcd90cbf">
<img src="./images/img_20250226_150759.png" alt="img_20250226_150759.png" width="50%">

</figure>


<p>
范例：
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging
logging.basicConfig(level=logging.INFO, <span style="color: #483d8b;">format</span>=<span style="color: #8b2252;">"%(asctime)s %(name)-10s [%(message)s]"</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26681;logger&#25805;&#20316;
</span><span style="color: #a0522d;">root</span> = logging.getLogger()
root.setLevel(logging.ERROR) 
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'root'</span>, root.handlers) <span style="color: #b22222;">#</span><span style="color: #b22222;">root [&lt;StreamHandler &lt;stderr&gt; (NOTSET)&gt;]
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22686;&#21152;handler
</span><span style="color: #a020f0;">import</span> sys
<span style="color: #a0522d;">h0</span> = logging.StreamHandler(sys.stdout)
h0.setLevel(logging.WARNING)
root.addHandler(h0)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'root'</span>, root.handlers)  <span style="color: #b22222;">#</span><span style="color: #b22222;">root [&lt;StreamHandler &lt;stderr&gt; (NOTSET)&gt;, &lt;StreamHandler &lt;stdout&gt; (WARNING)&gt;]
</span>
<span style="color: #a020f0;">for</span> h <span style="color: #a020f0;">in</span> root.handlers:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'root handler = {}, formattrt = {}'</span>.<span style="color: #483d8b;">format</span>(
        h, h.formatter._fmt <span style="color: #a020f0;">if</span> h.formatter <span style="color: #a020f0;">else</span> <span style="color: #8b2252;">''</span>))
<span style="color: #b22222;"># </span><span style="color: #b22222;">root handler = &lt;StreamHandler &lt;stderr&gt; (NOTSET)&gt;, formattrt = %(asctime)s %(name)-10s [%(message)s]      
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">root handler = &lt;StreamHandler &lt;stdout&gt; (WARNING)&gt;, formattrt =
</span>
logging.error(<span style="color: #8b2252;">'root test~~~~~'</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">logger s
</span><span style="color: #a0522d;">log1</span> = logging.getLogger(<span style="color: #8b2252;">'s'</span>)
log1.setLevel(logging.ERROR)
<span style="color: #a0522d;">h1</span> = logging.FileHandler(<span style="color: #8b2252;">'d:/test.log'</span>)
h1.setLevel(logging.WARNING)
log1.addHandler(h1)
<span style="color: #483d8b;">print</span>(log1.name, log1.handlers)
log1.warning(<span style="color: #8b2252;">'s test ------'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#19981;&#20102;&#65292;&#20294;&#26159;&#21019;&#24314;&#20102;&#25991;&#20214;
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)

<span style="color: #b22222;"># </span><span style="color: #b22222;">logger s.s1
</span><span style="color: #a0522d;">log2</span> = logging.getLogger(<span style="color: #8b2252;">'s.s1'</span>)
log2.setLevel(logging.CRITICAL)
<span style="color: #a0522d;">h2</span> = logging.FileHandler(<span style="color: #8b2252;">'d:/test.log'</span>)
h2.setLevel(logging.WARNING)
log2.addHandler(h2)
<span style="color: #483d8b;">print</span>(log2.name, log2.handlers)
log2.error(<span style="color: #8b2252;">'s.s1 test ===='</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#21069;&#32423;&#21035;CRITICAL&#19981;&#21487;&#25171;&#21360;&#65292;&#25991;&#20214;&#31561;&#32423;WARNING&#65292;error&gt;warning&#21487;&#21019;&#24314;&#25991;&#20214;&#65292;&#20294;&#24403;&#21069;logger&#32423;&#21035;&#20026;CRITICAL&#65292;&#19981;&#21487;&#25171;&#21360;
</span><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)

<span style="color: #b22222;"># </span><span style="color: #b22222;">logger s.s1.s2
</span><span style="color: #a0522d;">log3</span> = logging.getLogger(<span style="color: #8b2252;">'s.s1.s2'</span>)
log3.setLevel(logging.INFO)<span style="color: #b22222;"># </span><span style="color: #b22222;">&#32423;&#21035;&#26368;&#20302;
</span><span style="color: #483d8b;">print</span>(log3.getEffectiveLevel())
log3.info(<span style="color: #8b2252;">'s.s1.s2 test info ++++'</span>)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#25171;&#21360;&#12290;&#22240;&#20026;log3.propagate&#40664;&#35748;&#20026;True&#65292;&#20256;&#36882;&#32473;&#29238;&#20316;&#20026;&#24403;&#21069;logger&#27604;&#36739;
</span><span style="color: #483d8b;">print</span>(log3.name, log3.handlers)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">root [&lt;StreamHandler &lt;stderr&gt; (NOTSET)&gt;]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">root [&lt;StreamHandler &lt;stderr&gt; (NOTSET)&gt;, &lt;StreamHandler &lt;stdout&gt; (WARNING)&gt;]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">root handler = &lt;StreamHandler &lt;stderr&gt; (NOTSET)&gt;, formattrt = %(asctime)s %(name)-10s [%(message)s]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">root handler = &lt;StreamHandler &lt;stdout&gt; (WARNING)&gt;, formattrt =
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025-02-26 16:50:43,485 root       [root test~~~~~]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">root test~~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">s [&lt;FileHandler d:\test.log (WARNING)&gt;]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">s.s1 [&lt;FileHandler d:\test.log (WARNING)&gt;]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025-02-26 16:50:43,488 s.s1.s2    [s.s1.s2 test info ++++]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">s.s1.s2 []</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:9e543d77-87bd-4213-8fc0-9d76b7aa8394" class="outline-5">
<h5 id="h:9e543d77-87bd-4213-8fc0-9d76b7aa8394">Formatter</h5>
<div class="outline-text-5" id="text-h:9e543d77-87bd-4213-8fc0-9d76b7aa8394">
<p>
logging的Formatter类，它允许指定某个格式的字符串。如果提供None，那么'%(message)s'将会作为默认值
</p>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">import</span> sys

<span style="color: #a0522d;">FORMATSTR</span> = <span style="color: #8b2252;">"%(asctime)s %(thread)s %(name)-10s [%(message)s]"</span>
logging.basicConfig(level=logging.INFO, 
                    datefmt=<span style="color: #8b2252;">"%Y-%m-%d %H:%M:%S"</span>, <span style="color: #483d8b;">format</span>=FORMATSTR)

<span style="color: #a0522d;">root</span> = logging.getLogger()
<span style="color: #a0522d;">hroot</span> = logging.StreamHandler(sys.stdout)
root.addHandler(hroot)
<span style="color: #a020f0;">for</span> h <span style="color: #a020f0;">in</span> root.handlers:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'root handler = {}, formattrt = {}'</span>.<span style="color: #483d8b;">format</span>(
        h, h.formatter._fmt <span style="color: #a020f0;">if</span> h.formatter <span style="color: #a020f0;">else</span> <span style="color: #8b2252;">'&#31354;&#26684;&#24335;&#20018;'</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">print(log1.handlers[0].formatter)
</span>
logging.info(<span style="color: #8b2252;">'root info ~~~~'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#24320;&#22987;&#35774;&#32622;hroot formatter
</span><span style="color: #a0522d;">f1</span> = logging.Formatter(fmt=<span style="color: #8b2252;">'++ %(asctime)s [%(message)s] ++'</span>)
hroot.setFormatter(f1)

logging.info(<span style="color: #8b2252;">'test string info'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">root handler = &lt;StreamHandler &lt;stderr&gt; (NOTSET)&gt;, formattrt = %(asctime)s %(thread)s %(name)-10s [%(message)s]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">root handler = &lt;StreamHandler &lt;stdout&gt; (NOTSET)&gt;, formattrt = &#31354;&#26684;&#24335;&#20018;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025-02-26 17:44:24 20476 root       [root info ~~~~]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">root info ~~~~
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025-02-26 17:44:24 20476 root       [test string info]
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">++ 2025-02-26 17:44:24,136 [test string info] ++</span>
</pre>
</div>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">import</span> sys

<span style="color: #a0522d;">FORMATSTR</span> = <span style="color: #8b2252;">"%(asctime)s</span><span style="color: #008b8b;">\t</span><span style="color: #8b2252;">%(name)s</span><span style="color: #008b8b;">\t</span><span style="color: #8b2252;">%(thread)s,%(message)s"</span>

logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMATSTR, datefmt=<span style="color: #8b2252;">"%Y/%m/%d %H:%M:%S"</span>, level=logging.INFO)

<span style="color: #a0522d;">log1</span> = logging.getLogger(<span style="color: #8b2252;">'log1'</span>)
log1.<span style="color: #a0522d;">propagate</span> = <span style="color: #008b8b;">True</span>

<span style="color: #a0522d;">h</span> = logging.FileHandler(<span style="color: #8b2252;">'d:/tmp/{}.log'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">__name__</span>))
log1.addHandler(h)
<span style="color: #483d8b;">print</span>(log1.handlers[0].formatter)

<span style="color: #a0522d;">f</span> = logging.Formatter(<span style="color: #8b2252;">'*** %(message)s ***'</span>)
h.setFormatter(f)
<span style="color: #483d8b;">print</span>(log1.handlers[0].formatter._fmt)

h.setLevel(logging.WARNING)

log1.info(<span style="color: #8b2252;">'log1 test info string'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">%(message)s
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">None
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">*** %(message)s ***
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025/02/26 18:04:24     log1    27980,log1 test info string</span>
</pre>
</div>
<p>
import logging
</p>

<p>
修改颜色为黑色, 在logging.basicConfig()增加一句stream=sys.stdout
</p>
<div class="org-src-container">
<pre class="src src-python">logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMATSTR, datefmt=<span style="color: #8b2252;">"%Y/%m/%d %H:%M:%S"</span>, level=logging.INFO,stream=sys.stdout)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">import</span> sys

<span style="color: #a0522d;">FORMATSTR</span> = <span style="color: #8b2252;">"root</span><span style="color: #008b8b;">\t</span><span style="color: #8b2252;">[%(name)s]</span><span style="color: #008b8b;">\t</span><span style="color: #8b2252;">%(thread)s,%(message)s"</span>

logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMATSTR,level=logging.INFO,stream=sys.stdout)

<span style="color: #a0522d;">log1</span> = logging.getLogger(<span style="color: #8b2252;">'log1'</span>)
log1.<span style="color: #a0522d;">propagate</span> = <span style="color: #008b8b;">True</span>

<span style="color: #a0522d;">h</span> = logging.StreamHandler(sys.stdout)
log1.addHandler(h)

<span style="color: #a0522d;">f</span> = logging.Formatter(<span style="color: #8b2252;">'log1</span><span style="color: #008b8b;">\t</span><span style="color: #8b2252;">[%(name)s]</span><span style="color: #008b8b;">\t</span><span style="color: #8b2252;">%(message)s'</span>)
h.setFormatter(f)

<span style="color: #a0522d;">log2</span> = logging.getLogger(<span style="color: #8b2252;">'log1.log2'</span>)

log2.info(<span style="color: #8b2252;">'log2 test info string'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">%(message)s
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">log1    [log1.log2]     log2 test info string
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">root    [log1.log2]     8032,log2 test info string</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:e6fd47e5-dbbb-4cfa-bb33-3a321d5bccf6" class="outline-5">
<h5 id="h:e6fd47e5-dbbb-4cfa-bb33-3a321d5bccf6">Filter</h5>
<div class="outline-text-5" id="text-h:e6fd47e5-dbbb-4cfa-bb33-3a321d5bccf6">
<p>
Filter分为2种：
</p>
<ul class="org-ul">
<li>logger的过滤器，数据必须通过此过滤器，才能交给handlers处理</li>
</ul>

<p>
可以为handler增加过滤器，所以这种过滤器只影响某一个handler，不会影响整个处理流程
如果过滤器增加到logger上，就会影响流程
filter如果为空 恒等True
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging

logging.basicConfig(level=logging.INFO, <span style="color: #483d8b;">format</span>=<span style="color: #8b2252;">"%(asctime)s %(name)-19s [%(message)s]"</span>)

<span style="color: #a0522d;">log1</span> = logging.getLogger(<span style="color: #8b2252;">'s'</span>)
<span style="color: #483d8b;">print</span>(log1.level, log1.getEffectiveLevel()) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32487;&#25215;
</span>
log1.info(<span style="color: #8b2252;">'log1 info test1'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36890;&#36807;
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22686;&#21152;Filter
</span><span style="color: #483d8b;">filter</span> = logging.Filter(<span style="color: #8b2252;">'x'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36807;&#28388;&#22120;
</span>log1.addFilter(<span style="color: #483d8b;">filter</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22686;&#21152;&#36807;&#28388;&#22120;&#21518;&#65292;&#28040;&#24687;&#19981;&#33021;&#36890;&#36807;
</span>log1.info(<span style="color: #8b2252;">'log1 info test2'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#33021;&#36890;&#36807;</span>
</pre>
</div>

<ul class="org-ul">
<li>可以为handler增加过滤器，所以这种过滤器只影响某一个handler，不会影响整个处理流程</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s %(name)-19s [%(message)s]"</span>
logging.basicConfig(level=logging.INFO, <span style="color: #483d8b;">format</span>=FORMAT)

<span style="color: #a0522d;">log1</span> = logging.getLogger(<span style="color: #8b2252;">'s'</span>)
<span style="color: #483d8b;">print</span>(log1.level, log1.getEffectiveLevel()) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32487;&#25215;
</span>log1.addFilter(logging.Filter(<span style="color: #8b2252;">'x'</span>))
log1.info(<span style="color: #8b2252;">'log1 info test1'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#36890;&#36807;
</span>
<span style="color: #a0522d;">log2</span> = logging.getLogger(<span style="color: #8b2252;">'s.s1'</span>)
<span style="color: #483d8b;">print</span>(log2.level, log1.getEffectiveLevel())

<span style="color: #a0522d;">h1</span> = logging.StreamHandler()
<span style="color: #a0522d;">f1</span> = logging.Formatter(<span style="color: #8b2252;">'** %(message)s **'</span>)
h1.setFormatter(f1)
<span style="color: #a0522d;">h2</span> = logging.StreamHandler()
<span style="color: #a0522d;">f2</span> = logging.Formatter(<span style="color: #8b2252;">'++ %(message)s ++'</span>)
h2.setFormatter(f2)
<span style="color: #483d8b;">print</span>(h1.level, h2.level)
h2.addFilter(logging.Filter(<span style="color: #8b2252;">'s'</span>))

log2.addHandler(h1)
log2.addHandler(h2)

log2.info(<span style="color: #8b2252;">'log2 info test string'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20132;&#32473;h1, h2&#24182;&#21521;&#19978;&#20256;&#25773;
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">0 20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">0 20
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">0 0
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">** log2 info test string **
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">++ log2 info test string ++
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2025-02-27 00:15:03,580 s.s1                [log2 info test string]</span>
</pre>
</div>


<p>
过滤器核心源代码, 在logging.Filter类的filter方法中
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Filter</span>(<span style="color: #483d8b;">object</span>):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name=<span style="color: #8b2252;">''</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">nlen</span> = <span style="color: #483d8b;">len</span>(name)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">filter</span>(<span style="color: #a020f0;">self</span>, record):
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.nlen == 0:
            <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">True</span>
        <span style="color: #a020f0;">elif</span> <span style="color: #a020f0;">self</span>.name == record.name:
            <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">True</span>
        <span style="color: #a020f0;">elif</span> record.name.find(<span style="color: #a020f0;">self</span>.name, 0, <span style="color: #a020f0;">self</span>.nlen) != 0:
            <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">False</span>
        <span style="color: #a020f0;">return</span> (record.name[<span style="color: #a020f0;">self</span>.nlen] == <span style="color: #8b2252;">"."</span>)
</pre>
</div>

<p>
record.name.find(self.name, 0, self.nlen) != 0本质上就是等价于record.name.startswith(filter.name)
</p>

<p>
如果上面测试通过，还要求return (record.name[self.nlen] == ".",也就是说不但要以filter.name开头，而且下一个字符必须是.点号，否则返回False。
</p>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-h:e2969671-8caf-4573-82df-b370d416d835" class="outline-2">
<h2 id="h:e2969671-8caf-4573-82df-b370d416d835">debuuger</h2>
<div class="outline-text-2" id="text-h:e2969671-8caf-4573-82df-b370d416d835">
<p>
来学学debugger吧，不能只会用print调试呀！
</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/oyIJOCSgTM0?si=z0PHp2uP0lMLIA66" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

<div class="org-src-container">
<pre class="src src-sh">cat &lt;&lt;\EOF&gt; t.py<span style="color: #ffa54f;">
import inspect

def g(data):
    return data * data

def f(x):
    lst = []
    for i in range(x):
        frame = inspect.currentframe()
        val = g(i)
        lst.append(val)
    retrun lst

f(3)
EOF
</span>
python -m pdb t.py

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26029;&#28857;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26041;&#27861;1-&#28304;&#20195;&#30721;&#20013;&#21152; breakpoint()
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26041;&#27861;2
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">b &#34892;&#21495;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">b &#20195;&#30721;&#21517;&#31216; &#12290; b inspect.currentfram</span>
</pre>
</div>

<ul class="org-ul">
<li>常用调试命令</li>
</ul>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">name</td>
<td class="org-left">function</td>
</tr>

<tr>
<td class="org-left">break</td>
<td class="org-left">新增断点， break main, break 12（行号）</td>
</tr>

<tr>
<td class="org-left">info</td>
<td class="org-left">查看断点或者局部变量信息 info breakpoints, info locals</td>
</tr>

<tr>
<td class="org-left">run</td>
<td class="org-left">开始调试</td>
</tr>

<tr>
<td class="org-left">next</td>
<td class="org-left">类似 step over</td>
</tr>

<tr>
<td class="org-left">step</td>
<td class="org-left">跳转到函数内部</td>
</tr>

<tr>
<td class="org-left">continue</td>
<td class="org-left">继续运行到下一个断点</td>
</tr>

<tr>
<td class="org-left">quit</td>
<td class="org-left">退出调试</td>
</tr>

<tr>
<td class="org-left">watch</td>
<td class="org-left">内存断点</td>
</tr>

<tr>
<td class="org-left">display</td>
<td class="org-left">类似 IDE 里面的 watch 功能</td>
</tr>

<tr>
<td class="org-left">break 11 if xxx</td>
<td class="org-left">条件断点</td>
</tr>

<tr>
<td class="org-left">print 变量名</td>
<td class="org-left">打印</td>
</tr>

<tr>
<td class="org-left">list</td>
<td class="org-left">显示源代码     l . , ll</td>
</tr>

<tr>
<td class="org-left">where</td>
<td class="org-left">查看调用栈</td>
</tr>

<tr>
<td class="org-left">up</td>
<td class="org-left">上一层</td>
</tr>

<tr>
<td class="org-left">down</td>
<td class="org-left">下一层</td>
</tr>

<tr>
<td class="org-left">retval</td>
<td class="org-left">返回值</td>
</tr>

<tr>
<td class="org-left">until</td>
<td class="org-left">运行直到比现在的行数大为止     until 10</td>
</tr>

<tr>
<td class="org-left">return</td>
<td class="org-left">运行到返回为止 return lst</td>
</tr>

<tr>
<td class="org-left">clear</td>
<td class="org-left">删除所有断点。删一个断点 clear 1</td>
</tr>
</tbody>
</table>
</div>
</section>
</div>
<div id="postamble" class="status">
    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>打赏</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>© 2025 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
<!--
<script type="text/javascript" src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/bootstrap@5.2.1/dist/js/bootstrap.min.js"></script>
<div id="back-to-top" class=""><svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg></div>
-->
</div>
</body>
</html>
