<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Python: WEB开发-HTTP协议与WSGI</title>
<meta name="generator" content="Org Mode" />
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<!-- from -->
<!--
<style>#back-to-top{background:#000;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;bottom:20px;-webkit-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);-moz-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);box-shadow:0 2px 5px 0 rgba(0,0,0,.26);color:#fff;cursor:pointer;display:block;height:56px;opacity:1;outline:0;position:fixed;right:20px;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-transition:bottom .2s,opacity .2s;-o-transition:bottom .2s,opacity .2s;-moz-transition:bottom .2s,opacity .2s;transition:bottom .2s,opacity .2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:56px;z-index:1}#back-to-top svg{display:block;fill:currentColor;height:24px;margin:16px auto 0;width:24px}#back-to-top.hidden{bottom:-56px;opacity:0}</style>
-->
<link rel="stylesheet" href="/static/aandds.com/css/main.css">
<link rel="stylesheet" href="/static/aandds.com/css/drollery.min.css">
<script type="text/javascript" src="/static/aandds.com/js/main.js"></script>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Python: WEB开发-HTTP协议与WSGI</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:5b0f0836-81a2-427c-a494-86d02bd2c27a">WEB开发</a>
<ul>
<li><a href="#h:10d65449-96c0-45cc-973e-94d37fdacbcb">CS编程</a></li>
<li><a href="#h:06742056-1478-479c-97e9-c4125af924ad">BS编程</a></li>
</ul>
</li>
<li><a href="#h:4ed871f6-65bd-47f9-b38e-1f5ad01401cd">HTTP协议</a>
<ul>
<li><a href="#h:aaccc5e6-0e73-45dd-8b04-0bcf323b3359">安装httpd</a></li>
<li><a href="#h:634a262f-cbec-46df-9c84-4aeeea0895b3">无状态，有连接和短连接</a></li>
<li><a href="#h:1e5d323a-b74f-4ffa-8efd-5f7fb5147160">协议</a>
<ul>
<li><a href="#h:ae0dc43c-47d6-4c22-a215-87e8ca051bce">URL组成</a></li>
<li><a href="#h:0bc8073c-ae81-4f3f-b8ea-0ab334eeb096">HTTP消息</a>
<ul>
<li><a href="#h:ef6011b3-6df9-4b3b-b397-022f4149e191">请求报文</a></li>
<li><a href="#h:ccc6cad4-02ff-4c5c-9ce9-d54b6b09e1f8">常见传递信息的方式</a></li>
<li><a href="#h:572c0a59-db82-482e-941a-eb718833bdd8">响应报文</a></li>
<li><a href="#h:a7a09fd2-7068-4ff3-b890-5301f756e231">status code状态码</a></li>
</ul>
</li>
<li><a href="#h:3594c6c2-4ca8-4473-b9af-71e2dcbe993a">Cookie技术</a></li>
<li><a href="#h:aa39b629-6950-4aa1-a269-fa367d43ba82">Session技术</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:1c36d79d-6d16-4261-8ae8-e2a407b85d22">WSGI</a>
<ul>
<li><a href="#h:5d20cabd-8d07-4578-9dc0-1c85e8560189">WSGI服务器&#x2013;wsgiref</a></li>
<li><a href="#h:43c964f5-d056-4267-b706-1fe2747e2475">WSGI服务器作用</a></li>
<li><a href="#h:a8cc29e2-8a16-48c0-9182-f31602f75c4c">WSGI APP应用程序端</a>
<ul>
<li><a href="#h:7b7ca0b8-a1c3-4ce3-b103-44375f0a8af1">函数实现</a></li>
<li><a href="#h:4427d308-7907-43ec-a2bf-69e96056565a">类实现</a></li>
<li><a href="#h:1fcad869-693f-41f3-833e-f69134f9cec8">类实现，可调用对象</a></li>
<li><a href="#h:e06f9abf-25b4-4b84-9321-03953d66ddca">自定义 返回头</a></li>
<li><a href="#h:f7a9305d-ee87-48a5-83cf-fc9110d22f5f">environ</a></li>
<li><a href="#h:a42563a4-eb19-4b19-83e2-79ff827e8cbf">start_response</a></li>
</ul>
</li>
<li><a href="#h:23cd6b72-7a1a-4960-a482-7d29874035f0">服务器端</a>
<ul>
<li><a href="#h:9ef1c2e5-0d44-4521-999c-a4c37430c37e">Linux 测试用命令</a></li>
<li><a href="#h:3bc4b5c8-34b5-4a47-ab92-29b1e31580b2">WSGI WEB服务器</a></li>
<li><a href="#h:69d6051b-005d-4ebc-9242-f8fedb1a632a">WSGI APP应用程序</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="./index.html">Python</a></li>
</ul>
<section id="outline-container-h:5b0f0836-81a2-427c-a494-86d02bd2c27a" class="outline-2">
<h2 id="h:5b0f0836-81a2-427c-a494-86d02bd2c27a">WEB开发</h2>
<div class="outline-text-2" id="text-h:5b0f0836-81a2-427c-a494-86d02bd2c27a">
</div>
<div id="outline-container-h:10d65449-96c0-45cc-973e-94d37fdacbcb" class="outline-3">
<h3 id="h:10d65449-96c0-45cc-973e-94d37fdacbcb">CS编程</h3>
<div class="outline-text-3" id="text-h:10d65449-96c0-45cc-973e-94d37fdacbcb">
<p>
CS编程，即客户端、服务器编程。
</p>

<p>
客户端、服务端之间需要使用Socket，约定协议、版本（往往使用的协议是TCP或者UDP），指定地址和端口，就可以通信了。
</p>

<p>
客户端、服务端传输数据，数据可以有一定的格式，双方必须先约定好。
</p>
</div>
</div>
<div id="outline-container-h:06742056-1478-479c-97e9-c4125af924ad" class="outline-3">
<h3 id="h:06742056-1478-479c-97e9-c4125af924ad">BS编程</h3>
<div class="outline-text-3" id="text-h:06742056-1478-479c-97e9-c4125af924ad">
<p>
BS编程，即Browser、Server开发。
</p>

<p>
Browser浏览器，一种特殊的客户端，支持HTTP(s)协议，能够通过URL向服务端发起请求，等待服务端返回HTML等数据，并在浏览器内可视化展示的程序。
</p>

<p>
Server，支持HTTP(s)协议，能够接受众多客户端发起的HTTP协议请求，经过处理，将HTML等数据返回给浏览器。
</p>

<p>
本质上来说，BS是一种特殊的CS，即客户端必须是一种支持HTTP协议且能解析并渲染HTML的软件，服务端必须是能够接收多客户端HTTP访问的服务器软件。
</p>

<p>
HTTP协议底层基于TCP协议实现。
</p>

<p>
BS开发分为两端开发
</p>
<ul class="org-ul">
<li>客户端开发，或称前端开发。HTML、CSS、JavaScript等</li>
<li>服务端开发，Python有WSGI、Django、Flask、Tornado等</li>
</ul>
</div>
</div>
</section>
<section id="outline-container-h:4ed871f6-65bd-47f9-b38e-1f5ad01401cd" class="outline-2">
<h2 id="h:4ed871f6-65bd-47f9-b38e-1f5ad01401cd">HTTP协议</h2>
<div class="outline-text-2" id="text-h:4ed871f6-65bd-47f9-b38e-1f5ad01401cd">
</div>
<div id="outline-container-h:aaccc5e6-0e73-45dd-8b04-0bcf323b3359" class="outline-3">
<h3 id="h:aaccc5e6-0e73-45dd-8b04-0bcf323b3359">安装httpd</h3>
<div class="outline-text-3" id="text-h:aaccc5e6-0e73-45dd-8b04-0bcf323b3359">
<p>
可以安装httpd或nginx等服务端服务程序，通过浏览器访问，观察http协议
</p>
</div>
</div>
<div id="outline-container-h:634a262f-cbec-46df-9c84-4aeeea0895b3" class="outline-3">
<h3 id="h:634a262f-cbec-46df-9c84-4aeeea0895b3">无状态，有连接和短连接</h3>
<div class="outline-text-3" id="text-h:634a262f-cbec-46df-9c84-4aeeea0895b3">
<p>
无连接：HTTP 1.1之前，都是一个请求一个连接，连接用完即刻断开，其实是无连接
</p>
<ul class="org-ul">
<li>有连接：是因为它基于TCP协议，是面向连接的，需要3次握手、4次断开。</li>
<li>短连接：而Tcp的连接创建销毁成本高，对服务器有很大的影响。所以，自Http 1.1开始，支持keep-alive，默认也开启，一个连接打开后，会保持一段时间（可设置），浏览器再访问该服务器就使用这个Tcp连接，减轻了服务器压力，提高了效率。</li>
</ul>

<p>
无状态：指的是服务器无法知道2次请求之间的联系，即使是前后2次同一个浏览器也没有任何数据能够判断出是同一个浏览器的请求。后来可以通过cookie、session来判断。
</p>
</div>
</div>
<div id="outline-container-h:1e5d323a-b74f-4ffa-8efd-5f7fb5147160" class="outline-3">
<h3 id="h:1e5d323a-b74f-4ffa-8efd-5f7fb5147160">协议</h3>
<div class="outline-text-3" id="text-h:1e5d323a-b74f-4ffa-8efd-5f7fb5147160">
<p>
Http协议是无状态协议。
</p>

<p>
同一个客户端的两次请求之间没有任何关系，从服务器端角度来说，它不知道这两个请求来自同一个客户端。
</p>
</div>
<div id="outline-container-h:ae0dc43c-47d6-4c22-a215-87e8ca051bce" class="outline-4">
<h4 id="h:ae0dc43c-47d6-4c22-a215-87e8ca051bce">URL组成</h4>
<div class="outline-text-4" id="text-h:ae0dc43c-47d6-4c22-a215-87e8ca051bce">
<p>
URL可以说就是地址，uniform resource locator 统一资源定位符，每一个链接指向一个资源供客户端访问。
</p>

<div class="org-src-container">
<pre class="src src-sh">schema://host[:port#]/path/.../[;url-params][?query-string][#anchor]

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35299;&#37322;
</span>scheme &#27169;&#24335;&#12289;&#21327;&#35758;
- http&#12289;ftp&#12289;https&#12289;file&#12289;mailto&#31561;&#31561;
host:port
- www.python.org:80 &#65292;80&#31471;&#21475;&#26159;&#40664;&#35748;&#31471;&#21475;&#21487;&#20197;&#19981;&#20889;&#12290;&#22495;&#21517;&#20250;&#20351;&#29992;DNS&#35299;&#26512;&#65292;&#22495;
  &#21517;&#20250;&#35299;&#26512;&#25104;IP&#25165;&#33021;&#20351;&#29992;&#12290;&#23454;&#38469;&#19978;&#20250;&#23545;&#35299;&#26512;&#21518;&#36820;&#22238;&#30340;IP&#30340;TCP&#30340;80&#31471;&#21475;&#21457;&#36215;&#35775;&#38382;
/path/to/resource
- path&#65292;&#25351;&#21521;&#36164;&#28304;&#30340;&#36335;&#24452;
?<span style="color: #a0522d;">key1</span>=value1&amp;<span style="color: #a0522d;">key2</span>=value2
- query string&#65292;&#26597;&#35810;&#23383;&#31526;&#20018;&#65292;&#38382;&#21495;&#29992;&#26469;&#21644;&#36335;&#24452;&#20998;&#24320;&#65292;<span style="color: #a0522d;">&#21518;&#38754;key</span>=value&#24418;&#24335;&#65292;&#19988;&#20351;&#29992;&amp;&#31526;&#21495;&#20998;&#21106;
<span style="color: #b22222;">#</span><span style="color: #b22222;">anchor &#38170;&#28857;</span>
</pre>
</div>

<p>
例如，通过下面的URL访问网页
</p>

<pre class="example" id="orga4540c7">
http://www.bing.com/pathon/index.html?id=5&amp;name=python
</pre>

<p>
访问静态资源时，通过上面这个URL访问的是网站的某路径下的index.html文件，
而这个文件对应磁盘上的真实的文件。就会从磁盘上读取这个文件，并把文件的
内容发回浏览器端。
</p>
</div>
</div>
<div id="outline-container-h:0bc8073c-ae81-4f3f-b8ea-0ab334eeb096" class="outline-4">
<h4 id="h:0bc8073c-ae81-4f3f-b8ea-0ab334eeb096">HTTP消息</h4>
<div class="outline-text-4" id="text-h:0bc8073c-ae81-4f3f-b8ea-0ab334eeb096">
<p>
<a href="https://datatracker.ietf.org/doc/html/rfc7230#section-1.1">https://datatracker.ietf.org/doc/html/rfc7230#section-1.1</a>
</p>

<p>
消息分为Request请求、Response响应
</p>
<ul class="org-ul">
<li>Request：浏览器向服务器发起的请求
<ul class="org-ul">
<li>请求报文由Header消息报头、Body消息正文组成（可选）</li>
<li>请求报文第一行称为请求行</li>
</ul></li>
<li>Response：服务器对客户端请求的响应
<ul class="org-ul">
<li>响应报文由Header消息报头、Body消息正文组成（可选）</li>
<li>响应报头第一行称为状态行</li>
</ul></li>
<li>每一行使用回车和换行符作为结尾</li>
<li>如果有Body部分，Header、Body之间留一行空行，也就是2次回车换行。</li>
</ul>

<pre class="example" id="org673cc67">
"http://www.example.com/hello.txt":

Client request:
 GET /hello.txt HTTP/1.1
 User-Agent: curl/7.16.3 libcurl/7.16.3 OpenSSL/0.9.7l zlib/1.2.3
 Host: www.example.com
 Accept-Language: en, mi


Server response:
 HTTP/1.1 200 OK
 Date: Mon, 27 Jul 2009 12:28:53 GMT
 Server: Apache
 Last-Modified: Wed, 22 Jul 2009 19:15:56 GMT
 ETag: "34aa387-d-1568eb00"
 Accept-Ranges: bytes
 Content-Length: 51
 Vary: Accept-Encoding
 Content-Type: text/plain

 Hello World! My payload includes a trailing CRLF.
</pre>
</div>
<div id="outline-container-h:ef6011b3-6df9-4b3b-b397-022f4149e191" class="outline-5">
<h5 id="h:ef6011b3-6df9-4b3b-b397-022f4149e191">请求报文</h5>
<div class="outline-text-5" id="text-h:ef6011b3-6df9-4b3b-b397-022f4149e191">
<p>
请求消息行：请求方法Method 请求路径 协议版本CRLF
</p>

<p>
请求方法Method
</p>
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">方法</td>
<td class="org-left">说明</td>
</tr>

<tr>
<td class="org-left">GET</td>
<td class="org-left">请求获取URL对应的资源</td>
</tr>

<tr>
<td class="org-left">POST</td>
<td class="org-left">提交数据至服务器端</td>
</tr>

<tr>
<td class="org-left">HEAD</td>
<td class="org-left">和GET类似，不过不返回响应报文的正文</td>
</tr>
</tbody>
</table>

<p>
<a href="https://datatracker.ietf.org/doc/html/rfc2616#section-5.1.1">https://datatracker.ietf.org/doc/html/rfc2616#section-5.1.1</a>
</p>
</div>
</div>
<div id="outline-container-h:ccc6cad4-02ff-4c5c-9ce9-d54b6b09e1f8" class="outline-5">
<h5 id="h:ccc6cad4-02ff-4c5c-9ce9-d54b6b09e1f8">常见传递信息的方式</h5>
<div class="outline-text-5" id="text-h:ccc6cad4-02ff-4c5c-9ce9-d54b6b09e1f8">
<ol class="org-ol">
<li><p>
GET方法使用Query String
</p>

<p>
<a href="http://www.bing.com/pathon/index.html?id=5&amp;name=python&amp;name=linux">http://www.bing.com/pathon/index.html?id=5&amp;name=python&amp;name=linux</a>
</p>

<p>
通过查询字符串在URL中传递参数，而URL在请求报文的头部的第一行
</p></li>

<li><p>
POST方法提交数据
</p>

<p>
请求时提交的数据是在请求报文的正文Body部分
</p>

<div class="org-src-container">
<pre class="src src-sh">&#35831;&#27714;&#28040;&#24687;&#22914;&#19979;
POST /xxx/yyy?<span style="color: #a0522d;">id</span>=5&amp;<span style="color: #a0522d;">name</span>=bing HTTP/1.1
HOST: 127.0.0.1:9999
content-length: 26
content-type: application/x-www-form-urlencoded

<span style="color: #a0522d;">age</span>=5&amp;<span style="color: #a0522d;">weight</span>=80&amp;<span style="color: #a0522d;">height</span>=170
</pre>
</div></li>

<li><p>
URL中本身就包含着信息
</p>

<p>
<a href="http://www.bing.com/python/student/001">http://www.bing.com/python/student/001</a>
</p></li>
</ol>
</div>
</div>
<div id="outline-container-h:572c0a59-db82-482e-941a-eb718833bdd8" class="outline-5">
<h5 id="h:572c0a59-db82-482e-941a-eb718833bdd8">响应报文</h5>
<div class="outline-text-5" id="text-h:572c0a59-db82-482e-941a-eb718833bdd8">
<p>
响应消息行：协议版本 状态码 消息描述CRLF
</p>
</div>
</div>
<div id="outline-container-h:a7a09fd2-7068-4ff3-b890-5301f756e231" class="outline-5">
<h5 id="h:a7a09fd2-7068-4ff3-b890-5301f756e231">status code状态码</h5>
<div class="outline-text-5" id="text-h:a7a09fd2-7068-4ff3-b890-5301f756e231">
<p>
状态码在响应头第一行
</p>
<pre class="example" id="org7de232a">
1xx 提示信息，表示请求已被成功接收，继续处理
2xx 表示正常响应
    200 正常返回了网页内容
3xx 重定向
    301 页面永久性移走，永久重定向。看Location, 返回新的URL，浏览器会根据返回的url发起新的request请求
    302 临时重定向
    304 资源未修改，浏览器使用本地缓存
4xx 客户端请求错误
    404 Not Found，网页找不到，客户端请求的资源有错
    400 请求语法错误
    401 请求要求身份验证
    403 服务器拒绝请求
5xx 服务器端错误
    500 服务器内部错误
    502 上游服务器错误，例如nginx反向代理的时候
</pre>
</div>
</div>
</div>
<div id="outline-container-h:3594c6c2-4ca8-4473-b9af-71e2dcbe993a" class="outline-4">
<h4 id="h:3594c6c2-4ca8-4473-b9af-71e2dcbe993a">Cookie技术</h4>
<div class="outline-text-4" id="text-h:3594c6c2-4ca8-4473-b9af-71e2dcbe993a">
<p>
官方文档：<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Set-Cookie">Set-Cookie</a>
</p>

<ul class="org-ul">
<li>键值对信息</li>
<li>是一种客户端、服务器端传递数据的技术</li>
<li>一般来说cookie信息是在服务器端生成，返回给浏览器端的</li>
<li>浏览器端可以保持这些值，浏览器对同一域发起每一请求时，都会把Cookie信息发给服务器端</li>
<li>服务端收到浏览器端发过来的Cookie，处理这些信息，可以用来判断这次请求是否和之前的请求有关联</li>
</ul>

<p>
曾经Cookie唯一在浏览器端存储数据的手段，目前浏览器端存储数据的方案很多，Cookie正在被淘汰。
</p>

<p>
当服务器收到HTTP请求时，服务器可以在响应头里面添加一个Set-Cookie键值对。
浏览器收到响应后通常会保存这些Cookie，之后对该服务器每一次请求中都通过
Cookie请求头部将Cookie信息发送给服务器。
</p>

<p>
另外，Cookie的过期时间、域、路径、有效期、适用站点都可以根据需要来指定。
</p>

<p>
可以使用 <code>Set－Cookie: NAME=VALUE；Expires=DATE；Path=PATH；Domain=DOMAIN_NAME；SECURE</code>
</p>

<p>
例如：
</p>
<pre class="example" id="orge560c9a">
set-cookie:aliyungf_tc=xxxxw4Y; Path=/; HttpOnly
set-cookie:test_cookie=CheckForPermission; expires=Tue, 19-Mar-2018 15:53:02 GMT; path=/; 
domain=.doubleclick.net

Set-Cookie: BD_HOME=1; path=/
</pre>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">key</th>
<th scope="col" class="org-left">value说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Cookie过期</td>
<td class="org-left">Cookie可以设定过期终止时间，过期后将被浏览器清除</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">如果缺省，Cookie不会持久化，浏览器关闭Cookie消失，称为会话级Cookie</td>
</tr>

<tr>
<td class="org-left">Cookie域</td>
<td class="org-left">域确定有哪些域可以存取这个Cookie</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">缺省设置属性值为当前主机，例如 www.python.org</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">如果设置为 python.org 表示包含子域</td>
</tr>

<tr>
<td class="org-left">Path</td>
<td class="org-left">确定哪些目录及子目录访问可以使用该Cookie</td>
</tr>

<tr>
<td class="org-left">Secure</td>
<td class="org-left">表示Cookie随着HTTPS加密过得请求发送给服务端</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">有些浏览器已经不允许 <a href="http://">http://</a> 协议使用Secure</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">这个Secure不能保证Cookie是安全的，Cookie中不要传输敏感信息</td>
</tr>

<tr>
<td class="org-left">HttpOnly</td>
<td class="org-left">将Cookie设置此标记，就不能被JavaScript访问，只能发给服务器端</td>
</tr>
</tbody>
</table>

<p>
查看Chrome浏览器f12，找到Application中Cookies。
</p>

<pre class="example" id="org8b6fe6c">
Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnly

告诉浏览器端设置这个Cookie的键值对，有过期时间，使用HTTPS加密传输到服
务器端，且不能被浏览器中JS脚本访问该Cookie
</pre>

<pre class="example" id="orgc003599">
Cookie的作用域：Domain和Path定义Cookie的作用域

Domain
domain=www.baidu.com 表示只有该域的URL才能使用
domain=.baidu.com 表示可以包含子域，例如www.baidu.com 、python.baidu.com 等

Path
path=/ 所有/的子路径可以使用
domain=www.baidu.com; path=/webapp 表示只有www.baidu.com/webapp下的URL匹配，
例如http://www.baidu.com/webapp/a.html就可以
</pre>

<p>
缺点
</p>
<ul class="org-ul">
<li>Cookie一般明文传输（Secure是加密传输），安全性极差，不要传输敏感数据</li>
<li>有4kB大小限制</li>
<li>每次请求中都会发送Cookie，增加了流量</li>
</ul>
</div>
</div>
<div id="outline-container-h:aa39b629-6950-4aa1-a269-fa367d43ba82" class="outline-4">
<h4 id="h:aa39b629-6950-4aa1-a269-fa367d43ba82">Session技术</h4>
<div class="outline-text-4" id="text-h:aa39b629-6950-4aa1-a269-fa367d43ba82">
<p>
WEB 服务器端，尤其是动态网页服务端Server，有时需要知道浏览器方是谁，但是HTTP是无状态的，怎么办？
</p>

<p>
服务端会为每一次浏览器端第一次访问生成一个SessionID，用来唯一标识该浏览器，通过Set-Cookie发送到浏览器端。
</p>

<p>
浏览器端收到之后并不永久保持这个Cookie，只是会话级的。浏览器访问服务端时，会使用Cookie，也会带上这个SessionID的Cookie值。
</p>

<div class="org-src-container">
<pre class="src src-sh">Set-Cookie:<span style="color: #a0522d;">JSESSIONID</span>=741248A52EEB83DF182009912A4ABD86.Tomcat1; <span style="color: #a0522d;">Path</span>=/; HttpOnly
</pre>
</div>

<p>
服务端会维持这个SessionID一段时间，如果超时，会清理这些超时没有人访问的SessionID。如果浏览器端发来的SessionID无法在服务端找到，就会自动再次分配新的SessionID，并通过Set-Cookie发送到浏览器端以覆盖原有的存在浏览器中的会话级的SessionID.
</p>
</div>
</div>
</div>
</section>
<section id="outline-container-h:1c36d79d-6d16-4261-8ae8-e2a407b85d22" class="outline-2">
<h2 id="h:1c36d79d-6d16-4261-8ae8-e2a407b85d22">WSGI</h2>
<div class="outline-text-2" id="text-h:1c36d79d-6d16-4261-8ae8-e2a407b85d22">

<figure id="org6b11980">
<img src="./images/img_20250520_102516.png" alt="img_20250520_102516.png" width="50%">

</figure>

<p>
WSGI（Web Server Gateway Interface）主要规定了服务器端和应用程序间的接口。
</p>

<p>
WEB Server主要负责HTTP协议请求和响应，但不一定支持WSGI接口访问。
</p>

<p>
WEBServer集成WSGI模块，比如NGINX.
</p>

<figure id="org6d44d46">
<img src="./images/img_20250520_113549.png" alt="img_20250520_113549.png" width="50%">

</figure>

<p>
start_response解决响应报文头，解决响应报文正文。
</p>
</div>
<div id="outline-container-h:5d20cabd-8d07-4578-9dc0-1c85e8560189" class="outline-3">
<h3 id="h:5d20cabd-8d07-4578-9dc0-1c85e8560189">WSGI服务器&#x2013;wsgiref</h3>
<div class="outline-text-3" id="text-h:5d20cabd-8d07-4578-9dc0-1c85e8560189">
<ul class="org-ul">
<li>wsgiref是Python提供的一个WSGI参考实现库，不适合生产环境使用</li>
<li>wsgiref.simple_server 模块实现一个简单的WSGI HTTP服务器</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#25991;&#26412;&#20363;&#23376;
</span><span style="color: #a020f0;">from</span> wsgiref.simple_server <span style="color: #a020f0;">import</span> make_server,demo_app

<span style="color: #a0522d;">ip</span> = <span style="color: #8b2252;">'127.0.0.1'</span>
<span style="color: #a0522d;">port</span> = 9999
<span style="color: #a0522d;">server</span> = make_server(ip, port, demo_app) <span style="color: #b22222;"># </span><span style="color: #b22222;">demo_app&#24212;&#29992;&#31243;&#24207;&#65292;&#21487;&#35843;&#29992;
</span>server.serve_forever() <span style="color: #b22222;"># </span><span style="color: #b22222;">server.handle_request() &#25191;&#34892;&#19968;&#27425;</span>
</pre>
</div>

<p>
范例
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> wsgiref.simple_server <span style="color: #a020f0;">import</span> make_server, demo_app

<span style="color: #b22222;"># </span><span style="color: #b22222;">1 TCP server HTTP bind listen   ip, port; HTTP &#24212;&#29992;&#23618; &#25991;&#26412; 
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#35299;&#26512;HTTP&#25253;&#25991;&#12289;&#23553;&#35013;Response&#25253;&#25991; &#36825;&#26679;&#25165;&#33021;&#31216;&#20026;WEB HTTP Server
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">2 WSGI &#25903;&#25345;&#25509;&#21475;&#35268;&#33539;, ref &#22522;&#20110; HTTP Server
</span>
<span style="color: #a0522d;">server</span> = make_server(<span style="color: #8b2252;">'127.0.0.1'</span>, 8080, demo_app)
<span style="color: #b22222;"># </span><span style="color: #b22222;">socketserver &#23454;&#29616;&#65292;&#19968;&#20010;&#35831;&#27714;&#23601;&#20351;&#29992;Handler&#31867;&#23454;&#20363;&#21270;&#23545;&#24212;&#19968;&#20010;&#35831;&#27714;&#12290; handler&#26041;&#27861;&#22788;&#29702;&#35831;&#27714;&#65292;App? setup handle finish
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">handle &#19977;&#26679;&#23646;&#24615;&#65292;socket&#23545;&#35937;&#12289;&#23545;&#31471;&#20449;&#24687;&#12289;server
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">server.application=app
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">app&#20013;&#38656;&#35201;&#20934;&#22791;&#20869;&#23481;&#65292;&#22312;return&#20043;&#21069;&#65292;&#38656;&#35201;&#20351;&#29992;start_response&#20989;&#25968;&#20934;&#22791;&#29366;&#24577;&#30721;&#21644;&#22836;&#30340;&#23383;&#27573;&#65292;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">return &#21487;&#36845;&#20195;&#23545;&#35937;&#65292;&#20803;&#32032;&#26159;&#20869;&#23481;&#30340;&#19968;&#37096;&#20998;&#65292;&#20803;&#32032;&#26159;bytes&#31867;&#22411;
</span>server.serve_forever()
</pre>
</div>

<p>
执行结果
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#27983;&#35272;&#22120;&#35775;&#27714;127.0.0.1&#65306;8080&#31471;&#21475;
</span>PS D:\project\pyproj\trae&gt; &amp; D:/py/py313/python.exe d:/project/pyproj/trae/t1.py
127.0.0.1 - - [21/May/2025 13:41:57] <span style="color: #8b2252;">"GET / HTTP/1.1"</span> 200 5386
127.0.0.1 - - [21/May/2025 13:41:57] <span style="color: #8b2252;">"GET /favicon.ico HTTP/1.1"</span> 200 5305
</pre>
</div>

<p>
查看demo_app源码
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">demo_app</span>(environ,start_response):
    <span style="color: #a020f0;">from</span> io <span style="color: #a020f0;">import</span> StringIO
    <span style="color: #a0522d;">stdout</span> = StringIO()
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Hello world!"</span>, <span style="color: #483d8b;">file</span>=stdout)
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">file</span>=stdout)
    <span style="color: #a0522d;">h</span> = <span style="color: #483d8b;">sorted</span>(environ.items())
    <span style="color: #a020f0;">for</span> k,v <span style="color: #a020f0;">in</span> h:
        <span style="color: #483d8b;">print</span>(k,<span style="color: #8b2252;">'='</span>,<span style="color: #483d8b;">repr</span>(v), <span style="color: #483d8b;">file</span>=stdout)
    start_response(<span style="color: #8b2252;">"200 OK"</span>, [(<span style="color: #8b2252;">'Content-Type'</span>,<span style="color: #8b2252;">'text/plain; charset=utf-8'</span>)])
    <span style="color: #a020f0;">return</span> [stdout.getvalue().encode(<span style="color: #8b2252;">"utf-8"</span>)]
</pre>
</div>


<ul class="org-ul">
<li>StringIO 在内存中读写str</li>
<li>print("Hello world!", file=stdout)</li>
<li>将Hello world!内容写入内存中</li>
<li>start_response 构造head</li>
<li>getvalue 把缓冲区的内容全部读取出来，内容必须为btyes</li>
</ul>
</div>
</div>
<div id="outline-container-h:43c964f5-d056-4267-b706-1fe2747e2475" class="outline-3">
<h3 id="h:43c964f5-d056-4267-b706-1fe2747e2475">WSGI服务器作用</h3>
<div class="outline-text-3" id="text-h:43c964f5-d056-4267-b706-1fe2747e2475">
<ul class="org-ul">
<li>监听HTTP服务端口（TCPServer，默认端口80）</li>
<li>接收浏览器端的HTTP请求并解析封装成environ环境数据</li>
<li>负责调用应用程序，将environ数据和start_response方法两个实参传入给Application</li>
<li>将应用程序响应的正文封装成HTTP响应报文返回浏览器端</li>
<li>所有头和内容都是由server来封装</li>
</ul>
</div>
</div>
<div id="outline-container-h:a8cc29e2-8a16-48c0-9182-f31602f75c4c" class="outline-3">
<h3 id="h:a8cc29e2-8a16-48c0-9182-f31602f75c4c">WSGI APP应用程序端</h3>
<div class="outline-text-3" id="text-h:a8cc29e2-8a16-48c0-9182-f31602f75c4c">
<ul class="org-ul">
<li><p>
应用程序应该是一个可调用对象
</p>

<p>
Python中应该是函数、类、实现了 <span class="underline"><span class="underline">call</span></span> 方法的类的实例
</p></li>

<li>这个可调用对象应该接收两个参数</li>
</ul>
</div>
<div id="outline-container-h:7b7ca0b8-a1c3-4ce3-b103-44375f0a8af1" class="outline-4">
<h4 id="h:7b7ca0b8-a1c3-4ce3-b103-44375f0a8af1">函数实现</h4>
<div class="outline-text-4" id="text-h:7b7ca0b8-a1c3-4ce3-b103-44375f0a8af1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> wsgiref.simple_server <span style="color: #a020f0;">import</span> make_server

<span style="color: #a0522d;">return_res</span> = b<span style="color: #8b2252;">'Hello World'</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">application</span>(environ, start_response):
    start_response(<span style="color: #8b2252;">"200 OK"</span>, [(<span style="color: #8b2252;">'Content-Type'</span>, <span style="color: #8b2252;">'text/plain; charset=utf-8'</span>)])
    <span style="color: #a020f0;">return</span> [return_res]

<span style="color: #a0522d;">ip</span> = <span style="color: #8b2252;">'127.0.0.1'</span>
<span style="color: #a0522d;">port</span> = 9999
<span style="color: #a0522d;">server</span> = make_server(ip, port, application) <span style="color: #b22222;"># </span><span style="color: #b22222;">demo_app&#24212;&#29992;&#31243;&#24207;&#65292;&#21487;&#35843;&#29992;
</span>server.serve_forever() <span style="color: #b22222;"># </span><span style="color: #b22222;">server.handle_request() &#25191;&#34892;&#19968;&#27425;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:4427d308-7907-43ec-a2bf-69e96056565a" class="outline-4">
<h4 id="h:4427d308-7907-43ec-a2bf-69e96056565a">类实现</h4>
<div class="outline-text-4" id="text-h:4427d308-7907-43ec-a2bf-69e96056565a">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> wsgiref.simple_server <span style="color: #a020f0;">import</span> make_server

<span style="color: #a0522d;">return_res</span> = b<span style="color: #8b2252;">'Hello World'</span>


<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Application</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, environ, start_response):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">env</span> = environ
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">sr</span> = start_response
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__iter__</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23545;&#35937;&#21487;&#36845;&#20195;
</span>        <span style="color: #a020f0;">self</span>.sr(<span style="color: #8b2252;">"200 OK"</span>, [(<span style="color: #8b2252;">'Content-Type'</span>, <span style="color: #8b2252;">'text/plain; charset=utf-8'</span>)])
        <span style="color: #b22222;">#</span><span style="color: #b22222;">return iter(['&#19968;&#20999;'.encode()])
</span>        <span style="color: #b22222;">#</span><span style="color: #b22222;">yield from ['&#19968;&#20999;'.encode()]
</span>        <span style="color: #a020f0;">yield</span> return_res

<span style="color: #a0522d;">ip</span> = <span style="color: #8b2252;">'127.0.0.1'</span>
<span style="color: #a0522d;">port</span> = 9999
<span style="color: #a0522d;">server</span> = make_server(ip, port, Application) <span style="color: #b22222;"># </span><span style="color: #b22222;">Demo_app&#24212;&#29992;&#31243;&#24207;&#65292;&#21487;&#35843;&#29992;
</span>server.serve_forever() <span style="color: #b22222;"># </span><span style="color: #b22222;">server.handle_request() &#25191;&#34892;&#19968;&#27425;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:1fcad869-693f-41f3-833e-f69134f9cec8" class="outline-4">
<h4 id="h:1fcad869-693f-41f3-833e-f69134f9cec8">类实现，可调用对象</h4>
<div class="outline-text-4" id="text-h:1fcad869-693f-41f3-833e-f69134f9cec8">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> wsgiref.simple_server <span style="color: #a020f0;">import</span> make_server

<span style="color: #a0522d;">return_res</span> = b<span style="color: #8b2252;">'Hello World'</span>


<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Application</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__call__</span>(<span style="color: #a020f0;">self</span>, environ, start_response):
        start_response(<span style="color: #8b2252;">"200 OK"</span>, [(<span style="color: #8b2252;">'Content-Type'</span>, <span style="color: #8b2252;">'text/plain; charset=utf-8'</span>)])
        <span style="color: #a020f0;">return</span> [return_res]

<span style="color: #a0522d;">ip</span> = <span style="color: #8b2252;">'127.0.0.1'</span>
<span style="color: #a0522d;">port</span> = 9999
<span style="color: #a0522d;">server</span> = make_server(ip, port, Application()) <span style="color: #b22222;"># </span><span style="color: #b22222;">Application(e,s)
</span>server.serve_forever() <span style="color: #b22222;"># </span><span style="color: #b22222;">server.handle_request() &#25191;&#34892;&#19968;&#27425;</span>
</pre>
</div>

<ul class="org-ul">
<li>environ和start_response这两个参数名可以是任何合法名，但是一般默认都是这2个名字</li>
<li>应用程序端还有些其他的规定，暂不用关心</li>
</ul>

<p>
注意：第2、第3种实现调用时的不同
</p>
</div>
</div>
<div id="outline-container-h:e06f9abf-25b4-4b84-9321-03953d66ddca" class="outline-4">
<h4 id="h:e06f9abf-25b4-4b84-9321-03953d66ddca">自定义 返回头</h4>
<div class="outline-text-4" id="text-h:e06f9abf-25b4-4b84-9321-03953d66ddca">
<p>
一般自定义习惯用‘X’开头
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> wsgiref.simple_server <span style="color: #a020f0;">import</span> make_server

<span style="color: #a0522d;">return_res</span> = b<span style="color: #8b2252;">'Hello World'</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Application</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__call__</span>(<span style="color: #a020f0;">self</span>, environ, start_response):
        start_response(<span style="color: #8b2252;">"200 OK"</span>, [
            (<span style="color: #8b2252;">'Content-Type'</span>, <span style="color: #8b2252;">'text/plain; charset=utf-8'</span>),
            (<span style="color: #8b2252;">'X-Server'</span>, <span style="color: #8b2252;">'MyDemo_app'</span>)
        ])
        <span style="color: #a020f0;">return</span> [return_res]

<span style="color: #a0522d;">ip</span> = <span style="color: #8b2252;">'127.0.0.1'</span>
<span style="color: #a0522d;">port</span> = 9999
<span style="color: #a0522d;">server</span> = make_server(ip, port, Application()) <span style="color: #b22222;"># </span><span style="color: #b22222;">Application&#24212;&#29992;&#31243;&#24207;&#65292;&#21487;&#35843;&#29992;
</span>server.serve_forever() <span style="color: #b22222;"># </span><span style="color: #b22222;">server.handle_request() &#25191;&#34892;&#19968;&#27425;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:f7a9305d-ee87-48a5-83cf-fc9110d22f5f" class="outline-4">
<h4 id="h:f7a9305d-ee87-48a5-83cf-fc9110d22f5f">environ</h4>
<div class="outline-text-4" id="text-h:f7a9305d-ee87-48a5-83cf-fc9110d22f5f">
<p>
environ是包含Http请求信息的dict字典对象
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">名称</td>
<td class="org-left">含义</td>
</tr>

<tr>
<td class="org-left">REQUEST_METHOD</td>
<td class="org-left">请求方法，GET、POST等</td>
</tr>

<tr>
<td class="org-left">PATH_INFO</td>
<td class="org-left">URL中的路径部分</td>
</tr>

<tr>
<td class="org-left">QUERY_STRING</td>
<td class="org-left">查询字符串</td>
</tr>

<tr>
<td class="org-left">SERVER_NAME,SERVER_PORT</td>
<td class="org-left">服务器名、端口</td>
</tr>

<tr>
<td class="org-left">HTTP_HOST</td>
<td class="org-left">地址和端口</td>
</tr>

<tr>
<td class="org-left">SERVER_PROTOCOL</td>
<td class="org-left">协议</td>
</tr>

<tr>
<td class="org-left">HTTP_USER_AGENT</td>
<td class="org-left">UserAgent信息</td>
</tr>
</tbody>
</table>

<pre class="example" id="org9ec549b">
CONTENT_TYPE = 'text/plain'
HTTP_HOST = '127.0.0.1:9999'
HTTP_USER_AGENT = 'Mozilla/5.0 (Windows; U; Windows NT 6.1; zh-CN) AppleWebKit/537.36 (KHTML, 
like Gecko) Version/5.0.1 Safari/537.36'
PATH_INFO = '/'
QUERY_STRING = ''
REMOTE_ADDR = '127.0.0.1'
REMOTE_HOST = ''
REQUEST_METHOD = 'GET'
SERVER_NAME = 'DESKTOP-D34H5HF'
SERVER_PORT = '9999'
SERVER_PROTOCOL = 'HTTP/1.1'
SERVER_SOFTWARE = 'WSGIServer/0.2'
</pre>

<p>
打印environ信息
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> wsgiref.simple_server <span style="color: #a020f0;">import</span> make_server

<span style="color: #a0522d;">return_res</span> = <span style="color: #8b2252;">'&#20320;&#22909;'</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">application</span>(environ, start_response):
    <span style="color: #483d8b;">print</span>(*environ.items(), sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>)

    start_response(<span style="color: #8b2252;">"200 OK"</span>, [(<span style="color: #8b2252;">'Content-Type'</span>, <span style="color: #8b2252;">'text/plain; charset=utf-8'</span>)])
    <span style="color: #a020f0;">return</span> [return_res.encode(<span style="color: #8b2252;">'utf-8'</span>)]

<span style="color: #a0522d;">ip</span> = <span style="color: #8b2252;">'127.0.0.1'</span>
<span style="color: #a0522d;">port</span> = 9999
<span style="color: #a0522d;">server</span> = make_server(ip, port, application) <span style="color: #b22222;"># </span><span style="color: #b22222;">demo_app&#24212;&#29992;&#31243;&#24207;&#65292;&#21487;&#35843;&#29992;
</span>server.serve_forever() <span style="color: #b22222;"># </span><span style="color: #b22222;">server.handle_request() &#25191;&#34892;&#19968;&#27425;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a42563a4-eb19-4b19-83e2-79ff827e8cbf" class="outline-4">
<h4 id="h:a42563a4-eb19-4b19-83e2-79ff827e8cbf">start_response</h4>
<div class="outline-text-4" id="text-h:a42563a4-eb19-4b19-83e2-79ff827e8cbf">
<p>
它是一个可调用对象。有3个参数，定义如下：
</p>

<div class="org-src-container">
<pre class="src src-python">start_response(status, response_headers, exc_info=<span style="color: #008b8b;">None</span>)
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">参数名称</td>
<td class="org-left">说明</td>
</tr>

<tr>
<td class="org-left">status</td>
<td class="org-left">状态码和状态描述，例如 200 OK</td>
</tr>

<tr>
<td class="org-left">response_headers</td>
<td class="org-left">一个元素为二元组的列表</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">例如[('Content-Type', 'text/plain;charset=utf-8')]</td>
</tr>

<tr>
<td class="org-left">exc_info</td>
<td class="org-left">在错误处理的时候使用</td>
</tr>
</tbody>
</table>

<p>
start_response应该在返回可迭代对象之前调用，因为它返回的是Response Header。返回的可迭代对象是Response Body
</p>
</div>
</div>
</div>
<div id="outline-container-h:23cd6b72-7a1a-4960-a482-7d29874035f0" class="outline-3">
<h3 id="h:23cd6b72-7a1a-4960-a482-7d29874035f0">服务器端</h3>
<div class="outline-text-3" id="text-h:23cd6b72-7a1a-4960-a482-7d29874035f0">
<p>
服务器程序需要调用符合上述定义的可调用对象APP，传入environ、start_response，APP处理后，返回响应头和可迭代对象的正文，由服务器封装返回浏览器端
</p>

<p>
返回网页的例子
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> wsgiref.simple_server <span style="color: #a020f0;">import</span> make_server

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">application</span>(environ, start_response):
    <span style="color: #a0522d;">status</span> = <span style="color: #8b2252;">'200 OK'</span>
    <span style="color: #a0522d;">headers</span> = [(<span style="color: #8b2252;">'Content-Type'</span>, <span style="color: #8b2252;">'text/html;charset=utf-8'</span>)]
    start_response(status, headers)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#21487;&#36845;&#20195;&#23545;&#35937;
</span>    <span style="color: #a0522d;">html</span> = <span style="color: #8b2252;">'&lt;h1&gt;Hello World&lt;/h1&gt;'</span>.encode(<span style="color: #8b2252;">"utf-8"</span>)
    <span style="color: #a020f0;">return</span> [html]

<span style="color: #a0522d;">ip</span> = <span style="color: #8b2252;">'127.0.0.1'</span>
<span style="color: #a0522d;">port</span> = 9999
<span style="color: #a0522d;">server</span> = make_server(ip, port, application)
server.serve_forever() <span style="color: #b22222;"># </span><span style="color: #b22222;">server.handle_request() &#25191;&#34892;&#19968;&#27425;</span>
</pre>
</div>

<p>
simple_server 只是参考用，不能用于生产环境
</p>
</div>
<div id="outline-container-h:9ef1c2e5-0d44-4521-999c-a4c37430c37e" class="outline-4">
<h4 id="h:9ef1c2e5-0d44-4521-999c-a4c37430c37e">Linux 测试用命令</h4>
<div class="outline-text-4" id="text-h:9ef1c2e5-0d44-4521-999c-a4c37430c37e">
<div class="org-src-container">
<pre class="src src-sh">curl -I http://192.168.142.1:9999/xxx?<span style="color: #a0522d;">id</span>=5
curl -X POST http://192.168.142.1:9999/yyy -d <span style="color: #8b2252;">'{"x":2}'</span>

-I &#20351;&#29992;HEAD&#26041;&#27861;
-X &#25351;&#23450;&#26041;&#27861;&#65292;-d&#20256;&#36755;&#25968;&#25454;
</pre>
</div>

<p>
到这里就完成了一个简单的WEB 程序开发
</p>
</div>
</div>
<div id="outline-container-h:3bc4b5c8-34b5-4a47-ab92-29b1e31580b2" class="outline-4">
<h4 id="h:3bc4b5c8-34b5-4a47-ab92-29b1e31580b2">WSGI WEB服务器</h4>
<div class="outline-text-4" id="text-h:3bc4b5c8-34b5-4a47-ab92-29b1e31580b2">
<p>
本质上就是一个TCP服务器，监听在特定端口上
</p>

<p>
支持HTTP协议，能够将HTTP请求报文进行解析，能够把响应数据进行HTTP协议的报文封装并返回浏览器端
</p>

<p>
实现了WSGI协议，该协议约定了和应用程序之间接口（参看PEP333，<a href="https://www.python.org/dev/peps/pep-0333/">https://www.python.org/dev/peps/pep-0333/</a> ）
</p>
</div>
</div>
<div id="outline-container-h:69d6051b-005d-4ebc-9242-f8fedb1a632a" class="outline-4">
<h4 id="h:69d6051b-005d-4ebc-9242-f8fedb1a632a">WSGI APP应用程序</h4>
<div class="outline-text-4" id="text-h:69d6051b-005d-4ebc-9242-f8fedb1a632a">
<ul class="org-ul">
<li>遵从WSGI协议</li>
<li>本身是一个可调用对象</li>
<li>调用start_response，返回响应头部</li>
<li>返回包含正文的可迭代对象</li>
</ul>

<p>
WSGI 框架库往往可以看做增强的更加复杂的Application
</p>
</div>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>打赏</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>© 2025 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
<!--
<script type="text/javascript" src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/bootstrap@5.2.1/dist/js/bootstrap.min.js"></script>
<div id="back-to-top" class=""><svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg></div>
-->
</div>
</body>
</html>
