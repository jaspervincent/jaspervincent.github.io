<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Python: Flask-Web后端框架及其他</title>
<meta name="generator" content="Org Mode" />
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<!-- from -->
<!--
<style>#back-to-top{background:#000;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;bottom:20px;-webkit-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);-moz-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);box-shadow:0 2px 5px 0 rgba(0,0,0,.26);color:#fff;cursor:pointer;display:block;height:56px;opacity:1;outline:0;position:fixed;right:20px;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-transition:bottom .2s,opacity .2s;-o-transition:bottom .2s,opacity .2s;-moz-transition:bottom .2s,opacity .2s;transition:bottom .2s,opacity .2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:56px;z-index:1}#back-to-top svg{display:block;fill:currentColor;height:24px;margin:16px auto 0;width:24px}#back-to-top.hidden{bottom:-56px;opacity:0}</style>
-->
<link rel="stylesheet" href="/static/aandds.com/css/main.css">
<link rel="stylesheet" href="/static/aandds.com/css/drollery.min.css">
<script type="text/javascript" src="/static/aandds.com/js/main.js"></script>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Python: Flask-Web后端框架及其他</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:063f8fb3-8941-4194-986f-af4d0345aeae">Celery调度+Redis安装</a>
<ul>
<li><a href="#h:9f13b1bc-1b9c-4ee5-9f90-9c380a700b01">常用应用</a></li>
<li><a href="#h:f2133bdb-eb52-4366-bee2-456bd8bfaa44">角色</a></li>
<li><a href="#h:e1a64a83-ae9f-4ced-93bf-6f6e106aa689">安装</a></li>
<li><a href="#h:6f37594c-0051-46aa-8746-e5529645b932">测试</a>
<ul>
<li><a href="#h:a49a66e6-d683-403f-9227-058ec79afd58">Redis安装配置</a></li>
<li><a href="#h:c0b21400-af23-4fc4-98f8-18dfea47b6ff">broker配置使用</a></li>
<li><a href="#h:af3524be-95b5-40e9-a562-e542463568a0">Celery使用</a></li>
</ul>
</li>
<li><a href="#h:b6590d7a-c511-49fa-8ec3-24b2b705aab4">发邮件</a>
<ul>
<li><a href="#h:7ccc6bec-6312-45db-82db-6508f564e0be">Celery在Django中的集成方法</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:12e06085-7f88-4855-a857-e26be27b6cdf">flask</a>
<ul>
<li><a href="#h:a6484e80-e259-4c93-ab02-099af2ccd697">安装</a></li>
<li><a href="#h:1fa97270-4557-4b69-8536-d714e5604af0">模板</a></li>
<li><a href="#h:0fc0ab65-1a91-4273-a1b9-6ddbed3020b6">蓝图</a></li>
</ul>
</li>
<li><a href="#h:c94bb4b7-afec-4d8c-8e75-0dd65038cdf7">jQuery</a>
<ul>
<li><a href="#h:642dae9a-efa6-4f2c-bc02-0122418f944d">安装</a>
<ul>
<li><a href="#h:40c83fbf-ad56-4887-b35b-47ed2dcd5a37">API文档</a></li>
</ul>
</li>
<li><a href="#h:add0537c-64ee-4173-90e0-4521da0ac2f8">Flask静态部署</a></li>
<li><a href="#h:b5f466d1-a0dd-49f7-b905-8eeaff7c8924">基本语法</a></li>
<li><a href="#h:54739763-1343-452b-a4e4-d9d3abcb5d70">jQuery元素选择器</a></li>
<li><a href="#h:913c060c-3629-46e6-9ac4-0c947e11dc13">jQuery属性选择器</a></li>
<li><a href="#h:7e824849-dd80-4f17-9a0d-756df257c677">元素包装</a></li>
<li><a href="#h:c054f330-5dd6-4230-a882-c29dd4f2532a">CSS操作</a></li>
<li><a href="#h:a5e15aab-056b-4821-a62f-29d835981245">HTML操作</a></li>
<li><a href="#h:54d97c85-4f94-412b-8ac5-397862c6cb4c">增加节点</a>
<ul>
<li><a href="#h:904cfa16-fd80-4111-8855-1d5fa9679218">内部追加</a></li>
<li><a href="#h:2c823134-1124-4a6e-975c-b58f897bac2f">增加兄弟</a></li>
</ul>
</li>
<li><a href="#h:cd1d6ca0-5848-42a5-ac16-bba22d0d5bd3">attr属性操作</a></li>
<li><a href="#h:e5f82594-88ec-4887-84b7-a32144fce6b7">第几个</a></li>
<li><a href="#h:dec9e5bc-4f1d-4fdb-9e93-cac14326fddd">jQuery事件函数</a></li>
</ul>
</li>
<li><a href="#h:f21e5847-da3c-477c-86c5-e752480d5749">Ajax</a>
<ul>
<li><a href="#h:a9f62ed9-2463-49fe-8270-006e0118490a">GET请求</a></li>
<li><a href="#h:ae5cb067-1270-44d8-a63e-227a40658464">GET请求跨域</a>
<ul>
<li><a href="#h:e94cfd81-ca4c-4955-ab99-e54a8dd6b5dc">跨域CORS</a></li>
<li><a href="#h:63a2e075-df2b-4f54-a102-43ea19c555e0">简单请求</a></li>
<li><a href="#h:8f58767c-ecbb-414d-aaa8-95c4b40026bd">简单请求跨域解决</a></li>
<li><a href="#h:4868b1aa-b0c2-4aeb-b585-3436d4ff58d8">预检请求</a></li>
</ul>
</li>
<li><a href="#h:e4497838-b727-4d26-b31e-d20ff49ea85f">POST请求跨域</a>
<ul>
<li><a href="#h:bff9d3d7-b489-4745-af61-cf58c4dbfb1e">简单请求</a></li>
<li><a href="#h:dfc7ddf9-e2b6-4218-ae84-2ade56c48aa7">预检请求</a></li>
<li><a href="#h:50c1305a-91ec-4a18-8c04-b9e52ec4a96a">Json数据处理</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:84dc065d-d5ab-4be8-91de-04566003412d">其他</a>
<ul>
<li><a href="#h:e5cd9bd4-e10f-417a-96ff-706335cce305">jsonp</a></li>
<li><a href="#h:2bb43c30-a4bb-4722-ba6c-0a6013fb0b0a">Django静态配置</a></li>
<li><a href="#h:b34b302c-ea58-4c61-9a10-1724d2e431d9">练习</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="./index.html">Python</a></li>
</ul>

<p>
Flask框架简单使用
</p>
<section id="outline-container-h:063f8fb3-8941-4194-986f-af4d0345aeae" class="outline-2">
<h2 id="h:063f8fb3-8941-4194-986f-af4d0345aeae">Celery调度+Redis安装</h2>
<div class="outline-text-2" id="text-h:063f8fb3-8941-4194-986f-af4d0345aeae">
<p>
Celery是一个使用Python开发的 <b>分布式任务调度模块</b> ，因此对于大量使用Python构建的系统,使用起来方便。
</p>

<p>
Celery目前爸爸4.x,仅支持Django 1.8以上版本。 Celery3.1只可以支持Django1.8一下版本。
</p>

<ul class="org-ul">
<li>Celery官网<a href="https://docs.celeryq.dev/en/stable/">https://docs.celeryq.dev/en/stable/</a></li>

<li>Celery帮助文档<a href="http://www.celeryproject.org/docs-and-support/">http://www.celeryproject.org/docs-and-support/</a></li>
</ul>

<p>
优点：
</p>
<ol class="org-ol">
<li>简单：调用接口简单易用</li>
<li>高可用：客户端、Worker之间连接自动重试，Broker自身支持HA</li>
<li>快速：单个Celery进程每分钟可用数以百万计的任务</li>
<li>灵活：Celery的每一个部分都能扩展，或直接使用，或用户自己定义。</li>
</ol>
</div>
<div id="outline-container-h:9f13b1bc-1b9c-4ee5-9f90-9c380a700b01" class="outline-3">
<h3 id="h:9f13b1bc-1b9c-4ee5-9f90-9c380a700b01">常用应用</h3>
<div class="outline-text-3" id="text-h:9f13b1bc-1b9c-4ee5-9f90-9c380a700b01">
<p>
Celery可用支持实时异步任务处理，也支持任务的定时调度。
</p>

<ol class="org-ol">
<li>异步发邮件
<ul class="org-ul">
<li>cleery执行队列</li>
</ul></li>
<li>间隔半小时同步天气信息等
<ul class="org-ul">
<li>celery定时操作</li>
</ul></li>
</ol>
</div>
</div>
<div id="outline-container-h:f2133bdb-eb52-4366-bee2-456bd8bfaa44" class="outline-3">
<h3 id="h:f2133bdb-eb52-4366-bee2-456bd8bfaa44">角色</h3>
<div class="outline-text-3" id="text-h:f2133bdb-eb52-4366-bee2-456bd8bfaa44">
<ul class="org-ul">
<li>任务Task: 对应一个Python函数</li>
<li>队列Queue: 待执行任务的队列</li>
<li>工人Worker: 一个新的进程，负者执行任务</li>
<li>代理Broker: 负者调度，在任务环境中使用RabbitMQ、Redis等</li>
</ul>

<p>
Celery需要依靠RabbitMQ等作为消息代理，同时也支持Redis甚至是Mysql、Mongo等，当然，官方默认推荐的是RabbitMQ,如果使用Redis需要配置。
</p>

<p>
本次采用Redis来作为Broker，也是Redis存储任务结果
</p>
</div>
</div>
<div id="outline-container-h:e1a64a83-ae9f-4ced-93bf-6f6e106aa689" class="outline-3">
<h3 id="h:e1a64a83-ae9f-4ced-93bf-6f6e106aa689">安装</h3>
<div class="outline-text-3" id="text-h:e1a64a83-ae9f-4ced-93bf-6f6e106aa689">
<div class="org-src-container">
<pre class="src src-shell">pip install celery
<span style="color: #b22222;">#</span><span style="color: #b22222;">pip install celery==5.5.3
</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#23545;redis&#30340;&#25903;&#25345;&#65292;&#24182;&#33258;&#21160;&#21319;&#32423;&#30456;&#20851;&#20381;&#36182;
</span>pip install -U <span style="color: #8b2252;">"celery[redis]"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6f37594c-0051-46aa-8746-e5529645b932" class="outline-3">
<h3 id="h:6f37594c-0051-46aa-8746-e5529645b932">测试</h3>
<div class="outline-text-3" id="text-h:6f37594c-0051-46aa-8746-e5529645b932">
<p>
Celery库使用前，必须初始化，所得示例叫做”应用application或app”。应用是线程安全的。不同应用在同一进程中，可以使用不同拍照、不同组件、不同结果
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">t2.py
</span><span style="color: #a020f0;">from</span> celery <span style="color: #a020f0;">import</span> Celery

<span style="color: #a0522d;">app</span> = Celery(<span style="color: #8b2252;">'mytask'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">broker='pyamqp://guest@localhost//'
</span>
<span style="color: #228b22;">@app.task</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">hello</span>():
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'hello world'</span>

app.conf.<span style="color: #a0522d;">broker_url</span> = <span style="color: #8b2252;">'redis://localhost:6379/0'</span>

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span>*30)
<span style="color: #483d8b;">print</span>(app) <span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;Celery mytask at 0x1c0e87a4ec0&gt;
</span><span style="color: #483d8b;">print</span>(hello, hello.name) <span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;@task: mytask.hello of mytask at 0x1c0e87a4ec0&gt; mytask.hello
</span><span style="color: #483d8b;">print</span>(app.tasks)    <span style="color: #b22222;"># </span><span style="color: #b22222;">{'mytask.hello': &lt;@task: mytask.hello of mytask at 0x1c0e87a4ec0&gt;, 'celery.chain': ...&#30465;&#30053;}
</span><span style="color: #483d8b;">print</span>(app.timezone) <span style="color: #b22222;"># </span><span style="color: #b22222;">UTC
</span><span style="color: #483d8b;">print</span>(*app.conf.items(), sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>)
</pre>
</div>

<p>
默认使用amqp链接到本地
</p>
<div class="org-src-container">
<pre class="src src-sh">amqp://guest:**[cite/t:@localhost:5672/]/
</pre>
</div>

<p>
本次使用Redis
</p>
</div>
<div id="outline-container-h:a49a66e6-d683-403f-9227-058ec79afd58" class="outline-4">
<h4 id="h:a49a66e6-d683-403f-9227-058ec79afd58">Redis安装配置</h4>
<div class="outline-text-4" id="text-h:a49a66e6-d683-403f-9227-058ec79afd58">
<div class="org-src-container">
<pre class="src src-sh">docker run -d -p 6379:6379 redis
</pre>
</div>

<p>
使用Epel源的rpm安装
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;">#</span><span style="color: #b22222;">redis&#23433;&#35013;&#65292;&#20351;&#29992;&#25552;&#20379;&#30340;rpm&#23433;&#35013;&#65292;redis&#20381;&#36182;jemalloc
</span>yum install redis
<span style="color: #b22222;">#</span><span style="color: #b22222;">yum install jemalloc-3.6.0-1.el7.x86_64.rpm redis-3.2.12-2.el7.x86_64.rpm
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">rpm -pql redis-3.2.12-2.el7.x86_64.rpm
</span>/etc/logrotate.d/redis
/etc/redis-sentinel.conf
/etc/redis.conf
/usr/bin/redis-cli
/usr/bin/redis-sentinel
/usr/bin/redis-server
/usr/lib/systemd/system/redis-sentinel.service
/usr/lib/systemd/system/redis.service

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#32534;&#36753;redis&#37197;&#32622;&#25991;&#20214;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">vi /ect/redis.conf
</span>port 6379 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#21160;&#26102;&#30340;&#40664;&#35748;&#31471;&#21475;
</span>bind 10.0.0.152  <span style="color: #b22222;">#</span><span style="color: #b22222;">redis&#21551;&#21160;&#26102;&#30340;&#20027;&#26426;
</span>protected-mode no <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26159;&#21542;&#24320;&#21551;&#20445;&#25252;&#27169;&#24335;</span>
</pre>
</div>

<p>
启动、停止redis服务
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21551;&#21160;&#26381;&#21153;
</span>systemctl start redis 
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20572;&#27490;&#26381;&#21153;
</span>systemctl stop redis
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#28155;&#21152;&#24320;&#26426;&#21551;&#21160;
</span>systemctl enable redis
</pre>
</div>

<p>
redis desktop manager 是图形界面管理工具
</p>
</div>
</div>
<div id="outline-container-h:c0b21400-af23-4fc4-98f8-18dfea47b6ff" class="outline-4">
<h4 id="h:c0b21400-af23-4fc4-98f8-18dfea47b6ff">broker配置使用</h4>
<div class="outline-text-4" id="text-h:c0b21400-af23-4fc4-98f8-18dfea47b6ff">
<p>
redis链接字符串格式 <code>redis://password@hostname:port/db_number</code>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450;&#26381;&#21153;&#22120;&#30340;redis&#31471;&#21475;6379&#65292;&#20351;&#29992;0&#21495;&#24211;
</span>app.conf.broker_url = <span style="color: #8b2252;">'redis://10.0.0.152:6379/0'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:af3524be-95b5-40e9-a562-e542463568a0" class="outline-4">
<h4 id="h:af3524be-95b5-40e9-a562-e542463568a0">Celery使用</h4>
<div class="outline-text-4" id="text-h:af3524be-95b5-40e9-a562-e542463568a0">
<p>
生成任务
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">t2.py
</span><span style="color: #a020f0;">from</span> celery <span style="color: #a020f0;">import</span> Celery
<span style="color: #a020f0;">import</span> time

<span style="color: #a0522d;">app</span> = Celery(<span style="color: #8b2252;">'t2'</span>)
app.conf.<span style="color: #a0522d;">broker_url</span> = <span style="color: #8b2252;">'redis://10.0.0.152:6379/0'</span> <span style="color: #b22222;">#  </span><span style="color: #b22222;">0&#21495;&#24211;&#23384;&#25191;&#34892;&#20219;&#21153;&#38431;&#21015;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#37325;&#22797;&#25191;&#34892;&#38382;&#39064;&#35299;&#20915;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#36229;&#36807;visibility_timeout&#65292;Celery&#20250;&#35748;&#20026;&#27492;&#20219;&#21153;&#22833;&#36133;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#20250;&#37325;&#20998;&#37197;&#20854;&#20182;worker&#25191;&#34892;&#35813;&#20219;&#21153;&#65292;&#36825;&#26679;&#20250;&#36896;&#25104;&#37325;&#22797;&#25191;&#34892;&#12290;visibility_timeout&#36825;&#20010;&#20540;&#22823;&#19968;&#20123;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#27880;&#24847;&#65292;&#22914;&#26524;&#24930;&#20219;&#21153;&#25191;&#34892;&#26102;&#38271;&#36229;&#36807;visibility_timeout&#20381;&#28982;&#20250;&#22810;&#25191;&#34892;
</span>app.conf.<span style="color: #a0522d;">broker_transport_options</span> = {<span style="color: #8b2252;">"visibility_timeout"</span>:3600*12} <span style="color: #b22222;">#</span><span style="color: #b22222;">12 hours &#20219;&#21153;&#36229;&#26102;&#26102;&#38388;
</span>app.conf.<span style="color: #a0522d;">result_backend</span> = <span style="color: #8b2252;">'redis://10.0.0.152:6379/1'</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">1&#21495;&#24211;&#23384;&#25191;&#34892;&#32467;&#26524;
</span>
app.conf.update(
    enable_utc = <span style="color: #008b8b;">True</span>,
    timezone = <span style="color: #8b2252;">"Asia/Shanghai"</span>
)

<span style="color: #b22222;">#</span><span style="color: #b22222;">@app.task # &#25353;&#21517;&#23383;&#65292;&#20989;&#25968;&#21517;&#23601;&#26159;&#21517;&#23383;
</span><span style="color: #228b22;">@app.task</span>(name=<span style="color: #8b2252;">"my_add"</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;&#20219;&#21153;&#21517;&#31216;
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">@app.task(ingore_result=True)  # &#19981;&#20851;&#24515;&#25191;&#34892;&#32467;&#26524;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x,y):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"start run add x={},y={}"</span>.<span style="color: #483d8b;">format</span>(x,y))
    <span style="color: #a0522d;">ret</span> = x+y
    time.sleep(5)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"end run ret = {}"</span>.<span style="color: #483d8b;">format</span>(ret))
    <span style="color: #a020f0;">return</span> ret

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">"__main__"</span>:
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#28155;&#21152;&#20219;&#21153;&#21040;Broker&#20013;
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'in main. Send task'</span>)
    add.delay(4,5)
    add.apply_async((10,20),countdown=5) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27966;&#21457;&#19968;&#20010;&#20219;&#21153;&#65292;&#24310;&#36831;5&#31186;&#21518;&#25191;&#34892;
</span>    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'end~~~~)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;&#20219;&#21153;&#25918;&#21040;redis&#20013;&#31561;&#24453;&#34987;&#25191;&#34892;
</span>python mytask.py
</pre>
</div>

<p>
目录在新版中，代码中Celery('xx') 中名称必须和当前模块名xx.py一样。
</p>

<p>
注意：上面代码执行，使用add.delay等加入任务到Redis中，在启动celery命令消费Redis的任务，执行并返回结果到Redis中。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#22686;&#21152;&#20219;&#21153;&#30340;&#24120;&#29992;&#26041;&#27861;
</span>T.delay(arg, kwarg=value)
always a shortcut to .apply_async.

T.apply_async((arg,),{<span style="color: #8b2252;">'kwarg'</span>: value})

T.apply_async(countdown=10)
executes 10 seconds <span style="color: #a020f0;">from</span> now.
</pre>
</div>

<p>
<b>执行任务</b>
</p>


<p>
如果在Linux下能出现下面问题，可如下配置
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> celery <span style="color: #a020f0;">import</span> platforms
<span style="color: #b22222;"># </span><span style="color: #b22222;">Linux&#19979;&#65292;&#40664;&#35748;&#19981;&#20801;&#35768;root&#29992;&#25143;&#21551;&#21160;celery&#65292;&#21487;&#20351;&#29992;&#19979;&#38754;&#30340;&#37197;&#32622;
</span>platforms.<span style="color: #a0522d;">C_FORCE_ROOT</span> = <span style="color: #008b8b;">True</span>
</pre>
</div>

<p>
使用命令执行Redis中的任务
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#20840;&#23616;&#35774;&#32622;
</span>-A APP, --app App <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450;app&#21517;&#31216;&#65292;App&#26159;&#27169;&#22359;&#21517;
</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">worker &#25351;&#23450;work&#24037;&#20316;
</span>-l, --loglevel    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450;&#26085;&#24535;&#32423;&#21035; DEBUG/INFO/WARNING/ERROR/CRITICAL/FATAL
</span>-n &#21517;&#31216;           <span style="color: #b22222;">#</span><span style="color: #b22222;">%n&#25351;&#20027;&#26426;&#21517;
</span>--concurrency     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25351;&#23450;&#24182;&#21457;&#22810;&#36827;&#31243;&#25968;&#65292;&#32570;&#30465;&#20540;&#26159;CPU&#25968;
</span>
celery -A my_add worker --loglevel=INFO --concurrency=5 -n worker1@%n
celery -A my_add worker -l info -c 5 -n worker1@%n
</pre>
</div>

<p>
test1是模块名，里面有celery app。
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">变量</th>
<th scope="col" class="org-left">说明</th>
<th scope="col" class="org-left">举例</th>
<th scope="col" class="org-left">表现</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">%h</td>
<td class="org-left">主机host</td>
<td class="org-left">worker1@%h</td>
<td class="org-left">worker1@george.example.com</td>
</tr>

<tr>
<td class="org-left">%n</td>
<td class="org-left">主机名hostname</td>
<td class="org-left">worker1@%n</td>
<td class="org-left">worker1@george</td>
</tr>

<tr>
<td class="org-left">%d</td>
<td class="org-left">域domain</td>
<td class="org-left">worker1@%d</td>
<td class="org-left">worker1@example.com</td>
</tr>
</tbody>
</table>


<p>
windows10 的环境，python3.8环境，使用celery 5.x 的版本，发现任务接收了，但是一直没执行，无返回结果。
</p>
<ul class="org-ul">
<li>早期的celery 3.x版本是可以支持windows 平台的，但是跟python3.8 不兼容了。</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;eventlet&#35299;&#20915;&#38382;&#39064;
</span>pip install eventlet

-P ,--pool &#25351;&#23450;&#36827;&#31243;&#27744;&#23454;&#29616;&#65292;&#40664;&#35748;prefork,windows&#19979;&#20351;&#29992;eventlet
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#37325;&#26032;&#25191;&#34892;&#20219;&#21153;
</span>celery -A my_add worker -P eventlet --loglevel=INFO --concurrency=5 -n worker1@%n
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:b6590d7a-c511-49fa-8ec3-24b2b705aab4" class="outline-3">
<h3 id="h:b6590d7a-c511-49fa-8ec3-24b2b705aab4">发邮件</h3>
<div class="outline-text-3" id="text-h:b6590d7a-c511-49fa-8ec3-24b2b705aab4">
<p>
在用户注册完激活时，或修改了用户信息，遇到故障等情况时，都会发送邮件或发送短信息，这些业务场景不需要一直阻塞等待这些发送任务完成，一般都会采用异步执行。也就是说，都会向队列中添加一个任务后，直接返回。<br>
</p>

<p>
发邮件帮助可以参考 <a href="https://docs.djangoproject.com/en/5.2/topics/email/">https://docs.djangoproject.com/en/5.2/topics/email/</a>
</p>

<p>
Django中发送邮件需要在settings.py中配置如下
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">SMTP
</span><span style="color: #b22222;">## </span><span style="color: #b22222;">qq&#37038;&#20214;&#37197;&#32622;
</span><span style="color: #a0522d;">EMAIL_BACKEND</span> = <span style="color: #8b2252;">'django.core.mail.backends.smtp.EmailBackend'</span>
<span style="color: #a0522d;">EMAIL_HOST</span> = <span style="color: #8b2252;">"smtp.qq.com"</span>
<span style="color: #a0522d;">EMAIL_PORT</span> = 465 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32570;&#30465;25&#65292;SSL&#30340;&#24322;&#27493;465
</span><span style="color: #a0522d;">EMAIL_USE_SSL</span> = <span style="color: #008b8b;">True</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32570;&#30465;False
</span><span style="color: #a0522d;">EMAIL_USE_TLS</span> = <span style="color: #008b8b;">False</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32570;&#30465;&#20540;False
</span><span style="color: #a0522d;">EMAIL_HOST_USER</span> = <span style="color: #8b2252;">"1263351411@qq.com"</span>
<span style="color: #a0522d;">EMAIL_HOST_PASSWORD</span> = <span style="color: #8b2252;">"*************"</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23494;&#30721;&#20026;&#25480;&#26435;&#30721;&#12290;&#21516;&#26102;&#38656;&#35201;&#22312;qq&#37038;&#31665;&#35774;&#32622;&#32418;&#24320;&#36890;POP3/SMTP&#26381;&#21153; &#26381;&#21153;</span>
</pre>
</div>

<p>
注意：不同邮箱服务器配置不太一样。
</p>

<p>
邮件发送测试代码如下：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">user/urls.py &#22686;&#21152;users/sendmail &#36335;&#30001;
</span><span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path
<span style="color: #a020f0;">from</span> .views <span style="color: #a020f0;">import</span> reg, user_login, user_logout, get_captcha, test_filter, get_user, send_email

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">''</span>, reg),
    path(<span style="color: #8b2252;">'login'</span>, user_login, name=<span style="color: #8b2252;">'userlogin'</span>),
    path(<span style="color: #8b2252;">'logout'</span>, user_logout),
    path(<span style="color: #8b2252;">'getcaptcha'</span>, get_captcha),
    path(<span style="color: #8b2252;">'tf'</span>, test_filter), <span style="color: #b22222;"># </span><span style="color: #b22222;">/users/tf
</span>    path(<span style="color: #8b2252;">'&lt;int:id&gt;'</span>, get_user), <span style="color: #b22222;"># </span><span style="color: #b22222;">/users/2
</span>    path(<span style="color: #8b2252;">'sendmail'</span>, send_email)
]
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#  </span><span style="color: #b22222;">&#36825;&#20010;&#20989;&#25968;&#27979;&#35797;&#26102;&#65292;&#21487;&#20197;&#20889;&#22312;&#20219;&#24847;&#27169;&#22359;&#20013;&#65292;&#38656;&#35201;&#26102;&#34987;&#35843;&#29992;&#23601;&#21487;&#20197;&#20102;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">user/views.py
</span><span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpRequest, HttpResponse, JsonResponse
.....

<span style="color: #a020f0;">from</span> django.core.mail <span style="color: #a020f0;">import</span> send_mail
<span style="color: #a020f0;">from</span> django.conf <span style="color: #a020f0;">import</span> settings

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">email</span>(request):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#27979;&#35797;&#37038;&#20214;&#24320;&#22987;&#21457;&#36865;============'</span>)
    send_mail(
        <span style="color: #8b2252;">"&#27979;&#35797;&#37038;&#20214;"</span>,
        <span style="color: #8b2252;">"test"</span>,
        settings.EMAIL_HOST_USER, <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20511;&#29992;&#21738;&#19968;&#20010;&#37038;&#31665;&#32972;&#21518;&#30340;server&#21457;&#36865;
</span>        [<span style="color: #8b2252;">"11111@163.com"</span>], <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30446;&#26631;&#37038;&#31665;&#20204;
</span>        fail_silently=<span style="color: #008b8b;">False</span>,
        html_message=<span style="color: #8b2252;">"""
        &lt;h1&gt;&#27880;&#20876;&#37038;&#20214;&lt;/h1&gt;&lt;br&gt;
        &lt;a href="http://xuchangwei.com/users/active/?token=xxxx&amp;uid=123"&gt;&#28608;&#27963;&lt;/a&gt;
        """</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21033;&#29992;HTML&#30340;&#37038;&#20214;&#27491;&#25991;
</span>    )
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#27979;&#35797;&#37038;&#20214;&#21457;&#36865;&#23436;&#27605;============'</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#27979;&#35797;&#20989;&#25968;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">send_email</span>(request):
    <span style="color: #a020f0;">try</span>:
        email() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21457;&#36865;&#37038;&#20214;&#26102;&#20250;&#38459;&#22622;
</span>    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #483d8b;">print</span>(e)
        <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">"error"</span>:<span style="color: #8b2252;">"&#37038;&#20214;&#21457;&#36865;&#22833;&#36133;"</span>},status=400)
    <span style="color: #a020f0;">return</span> HttpResponse(<span style="color: #8b2252;">"&#21457;&#36865;&#25104;&#21151;"</span>,status=201)
</pre>
</div>
</div>
<div id="outline-container-h:7ccc6bec-6312-45db-82db-6508f564e0be" class="outline-4">
<h4 id="h:7ccc6bec-6312-45db-82db-6508f564e0be">Celery在Django中的集成方法</h4>
<div class="outline-text-4" id="text-h:7ccc6bec-6312-45db-82db-6508f564e0be">
<p>
<a href="https://docs.celeryq.dev/en/stable/django/index.html">https://docs.celeryq.dev/en/stable/django/index.html</a>
</p>

<p>
目录结构
</p>
<div class="org-src-container">
<pre class="src src-sh">- proj/
  - manage.py
  - blog/ <span style="color: #b22222;">#</span><span style="color: #b22222;">Django&#20840;&#23616;&#30446;&#24405;
</span>    - __init__.py
    - settings.py
    - celery.py
    - urls.py
  - app1 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24212;&#29992;&#31243;&#24207;&#30446;&#24405;
</span>    - __init__.py
    - tasks.py
    - view.py
    - models.py
</pre>
</div>

<p>
在Django全局目录中(settings.pys所在目录)
</p>

<p>
1、定义一个celery.py文件
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">blog/celery.py
</span><span style="color: #a020f0;">import</span> os

<span style="color: #a020f0;">from</span> celery <span style="color: #a020f0;">import</span> Celery

<span style="color: #b22222;"># </span><span style="color: #b22222;">Set the default Django settings module for the 'celery' program.
</span>os.environ.setdefault(<span style="color: #8b2252;">'DJANGO_SETTINGS_MODULE'</span>, <span style="color: #8b2252;">'blog.settings'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24517;&#39035;&#20462;&#25913;&#27169;&#22359;&#21517;
</span>
<span style="color: #a0522d;">app</span> = Celery(<span style="color: #8b2252;">'blog'</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">Using a string here means the worker doesn't have to serialize
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">the configuration object to child processes.
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">- namespace='CELERY' means all celery-related configuration keys
</span><span style="color: #b22222;">#   </span><span style="color: #b22222;">should have a `CELERY_` prefix.
</span>app.config_from_object(<span style="color: #8b2252;">'django.conf:settings'</span>, namespace=<span style="color: #8b2252;">'CELERY'</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">Load task modules from all registered Django apps.
</span>app.autodiscover_tasks()

app.conf.<span style="color: #a0522d;">broker_url</span> = <span style="color: #8b2252;">'redis://10.0.0.152:6379/2'</span>
app.conf.<span style="color: #a0522d;">broker_transport_options</span> = {<span style="color: #8b2252;">'visibility_timeout'</span>: 3600*24}  <span style="color: #b22222;"># </span><span style="color: #b22222;">24 hour.
</span>app.conf.<span style="color: #a0522d;">result_backend</span> = <span style="color: #8b2252;">'redis://10.0.0.152:6379/3'</span>
app.conf.update(
    timezone=<span style="color: #8b2252;">'Asia/Shanghai'</span>,
    enable_utc=<span style="color: #008b8b;">True</span>,
)
</pre>
</div>


<p>
2、修改 <code>__init__.py</code> 文件
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> .celery <span style="color: #a020f0;">import</span> app <span style="color: #a020f0;">as</span> celery_app

<span style="color: #483d8b;">__all__</span> = (<span style="color: #8b2252;">'celery_app'</span>,)
</pre>
</div>

<p>
在user应用下
1、新建文件tasks.py中新建任务
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">user/tasks.py
</span><span style="color: #a020f0;">from</span> django.core.mail <span style="color: #a020f0;">import</span> send_mail
<span style="color: #a020f0;">from</span> django.conf <span style="color: #a020f0;">import</span> settings
<span style="color: #a020f0;">from</span> blog.celery <span style="color: #a020f0;">import</span> app
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> time

<span style="color: #228b22;">@app.task</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21464;&#25104;&#20219;&#21153;
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">real_send_mail</span>():
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#27979;&#35797;&#37038;&#20214;&#24320;&#22987;&#21457;&#36865;============'</span>)
    time.sleep(3)
    send_mail(
        <span style="color: #8b2252;">"&#27979;&#35797;&#37038;&#20214;"</span>,
        <span style="color: #8b2252;">"test"</span>,
        settings.EMAIL_HOST_USER, <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20511;&#29992;&#21738;&#19968;&#20010;&#37038;&#31665;&#32972;&#21518;&#30340;server&#21457;&#36865;
</span>        [<span style="color: #8b2252;">"xcwhome@163.com"</span>], <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30446;&#26631;&#37038;&#31665;&#20204;
</span>        fail_silently=<span style="color: #008b8b;">False</span>,
        html_message=<span style="color: #8b2252;">"""
        &lt;h1&gt;&#27880;&#20876;&#37038;&#20214;&lt;/h1&gt;&lt;br&gt;
        {}
        &lt;br&gt;
        &lt;a href="http://xuchangwei.com/users/active/?token=xxxx&amp;uid=123"&gt;&#28608;&#27963;&lt;/a&gt;
        """</span>.<span style="color: #483d8b;">format</span>(datetime.datetime.now())
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21033;&#29992;HTML&#30340;&#37038;&#20214;&#27491;&#25991;
</span>    )
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#27979;&#35797;&#37038;&#20214;&#21457;&#36865;&#23436;&#27605;============'</span>)
</pre>
</div>

<p>
2、views.py视图函数中调用
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">user/views.py
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">...
</span><span style="color: #a020f0;">from</span> .tasks <span style="color: #a020f0;">import</span> real_send_mail
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">send_email</span>(request):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #b22222;"># </span><span style="color: #b22222;">real_send_mail() &#36825;&#26679;&#20889;&#27809;&#26377;&#29992;&#21040;celery
</span>        real_send_mail.delay() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21457;&#20219;&#21153;&#65292; &#19981;&#38656;&#35201;&#31561;&#24453;
</span>    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #483d8b;">print</span>(e)
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST)
    <span style="color: #a020f0;">return</span> HttpResponse(<span style="color: #8b2252;">'&#37038;&#20214;&#24050;&#32463;&#21457;&#36865;&#65292;&#35831;5&#20998;&#38047;&#21518;&#21435;&#37038;&#31665;&#26597;&#25910;&#28608;&#27963;&#65292;&#26377;&#25928;&#26102;&#38388;2&#23567;&#26102;'</span>)
</pre>
</div>

<p>
以后放在注册函数中发送邮件。
</p>

<p>
注意：目前在Python3.7部署时，发邮件可能会报wrap_socket()错。可以使用python3.6版本
</p>

<p>
3、urls.py路由视图函数
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">user/urls.py
</span><span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path
<span style="color: #a020f0;">from</span> .views <span style="color: #a020f0;">import</span> reg, user_login, user_logout, get_captcha, test_filter, get_user, send_email

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">''</span>, reg),
    path(<span style="color: #8b2252;">'login'</span>, user_login, name=<span style="color: #8b2252;">'userlogin'</span>),
    path(<span style="color: #8b2252;">'logout'</span>, user_logout),
    path(<span style="color: #8b2252;">'getcaptcha'</span>, get_captcha),
    path(<span style="color: #8b2252;">'tf'</span>, test_filter), <span style="color: #b22222;"># </span><span style="color: #b22222;">/users/tf
</span>    path(<span style="color: #8b2252;">'&lt;int:id&gt;'</span>, get_user), <span style="color: #b22222;"># </span><span style="color: #b22222;">/users/2
</span>    path(<span style="color: #8b2252;">'sendmail'</span>, send_email)
]
</pre>
</div>


<p>
访问 <a href="http://localhost:8000/users/sendmail">http://localhost:8000/users/sendmail</a> 会调用send_mail视图函数，执行real_send_mail.delay()，会在redis中增加任务。
</p>

<p>
执行任务，下面命令会从redis中拿任务执行
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312;&#39033;&#30446;&#26681;&#30446;&#24405;&#19979;&#25191;&#34892;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">windows &#28155;&#21152; -P eventlet
</span>celery -A blog worker -P eventlet worker -l info -c 4 -n worker@%n
</pre>
</div>

<p>
思考:
</p>
<ul class="org-ul">
<li>Post业务的pub发布功能，它真的是直接把数据提交到数据库当中吗?</li>
<li>这个功能是否适合使用Celery，为什么?</li>
</ul>

<p>
异步的，分库分表。
</p>
</div>
</div>
</div>
</section>
<section id="outline-container-h:12e06085-7f88-4855-a857-e26be27b6cdf" class="outline-2">
<h2 id="h:12e06085-7f88-4855-a857-e26be27b6cdf">flask</h2>
<div class="outline-text-2" id="text-h:12e06085-7f88-4855-a857-e26be27b6cdf">
</div>
<div id="outline-container-h:a6484e80-e259-4c93-ab02-099af2ccd697" class="outline-3">
<h3 id="h:a6484e80-e259-4c93-ab02-099af2ccd697">安装</h3>
<div class="outline-text-3" id="text-h:a6484e80-e259-4c93-ab02-099af2ccd697">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">python -m venv .venv
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">source .venv/bin/activate
</span><span style="color: #b22222;">#</span><span style="color: #b22222;">.\.venv\Scripts\activate # windows
</span>
python -m pip install --upgrade pip
pip install flask
</pre>
</div>

<p>
官方网站：<a href="https://flask.palletsprojects.com/">https://flask.palletsprojects.com/</a>
</p>

<p>
Flask快速入门：
</p>
<ul class="org-ul">
<li><a href="https://docs.jinkan.org/docs/flask/quickstart.html#quickstart">https://docs.jinkan.org/docs/flask/quickstart.html#quickstart</a></li>
</ul>

<p>
<b>快速构建</b>
</p>

<div class="org-src-container">
<pre class="src src-shell">mkdir webapps/static -pv
touch webapps/__init__.py
touch t1.py
</pre>
</div>

<p>
t1.py
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> webapps <span style="color: #a020f0;">import</span> app

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">"__main__"</span>:
    app.run(debug=<span style="color: #008b8b;">True</span>)
    <span style="color: #b22222;">#</span><span style="color: #b22222;">app.run("127.0.0.1",port=8080,debug=True)</span>
</pre>
</div>

<p>
webapps/__init__.py
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> flask <span style="color: #a020f0;">import</span> Flask, Response, Request, jsonify, render_template
<span style="color: #a020f0;">import</span> io

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#24212;&#29992;
</span><span style="color: #a0522d;">app</span> = Flask(<span style="color: #483d8b;">__name__</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36335;&#30001;&#21644;&#35270;&#22270;&#20989;&#25968;
</span><span style="color: #228b22;">@app.route</span>(<span style="color: #8b2252;">"/"</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">hello_world</span>():
    <span style="color: #b22222;"># </span><span style="color: #b22222;">return "&lt;p&gt;Hello, World!&lt;/p&gt;"
</span>    <span style="color: #a020f0;">return</span> Response(<span style="color: #8b2252;">"Hello, flask"</span>, status=200)

<span style="color: #b22222;">#</span><span style="color: #b22222;">@app.route("/json", methods=["GET"]) #&#21015;&#34920;&#20013;&#25351;&#23450;&#22810;&#20010;&#26041;&#27861; GET&#12289;POST
</span><span style="color: #228b22;">@app.route</span>(<span style="color: #8b2252;">"/json"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#34920;&#20013;&#25351;&#23450;&#22810;&#20010;&#26041;&#27861; GET&#12289;POST
</span><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_json</span>():
    <span style="color: #a0522d;">d</span> = {<span style="color: #8b2252;">'a'</span>:1, <span style="color: #8b2252;">'b'</span>:[<span style="color: #8b2252;">'a'</span>, 123, <span style="color: #8b2252;">'xyz'</span>], <span style="color: #8b2252;">'c'</span>:(1,2,3)}
    <span style="color: #a020f0;">return</span> jsonify(d)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#27880;&#20876;2&#20010;&#36335;&#24452;
</span><span style="color: #228b22;">@app.route</span>(<span style="color: #8b2252;">"/info"</span>)
<span style="color: #228b22;">@app.route</span>(<span style="color: #8b2252;">"/i"</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_info</span>():
    <span style="color: #a0522d;">sio</span> = io.StringIO()
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> [
        app.root_path, app.url_map, app.static_folder, app.static_url_path,
        app.view_functions, app.template_folder,
        app.<span style="color: #483d8b;">__dict__</span>.items()
        ]:
        <span style="color: #483d8b;">print</span>(i) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38745;&#24577;&#36335;&#24452; /static/&lt;filename&gt;
</span>        <span style="color: #483d8b;">print</span>(i, <span style="color: #483d8b;">file</span>=sio, end=<span style="color: #8b2252;">'&lt;br&gt;'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">path =&gt; view function
</span>    <span style="color: #a020f0;">return</span> Response(sio.getvalue(), content_type=<span style="color: #8b2252;">'text/html'</span>)
</pre>
</div>


<div class="org-src-container">
<pre class="src src-sh">python  t1.py

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#40664;&#35748;5000&#31471;&#21475;</span>
</pre>
</div>
<p>
访问 <a href="http://localhost:5000/">http://localhost:5000/</a>  
</p>

<p>
<a href="http://localhost:5000/json">http://localhost:5000/json</a>
</p>

<p>
<a href="http://localhost:5000/info">http://localhost:5000/info</a>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #0000ff;">Map</span>([&lt;Rule <span style="color: #8b2252;">'/static/&lt;filename&gt;'</span> (OPTIONS, HEAD, GET) -&gt; static&gt;,
 &lt;Rule <span style="color: #8b2252;">'/'</span> (OPTIONS, HEAD, GET) -&gt; hello_world&gt;,
 &lt;Rule <span style="color: #8b2252;">'/json'</span> (OPTIONS, HEAD, GET) -&gt; get_json&gt;,
 &lt;Rule <span style="color: #8b2252;">'/info'</span> (OPTIONS, HEAD, GET) -&gt; get_info&gt;])
D:\project\pyprojs\trae\flask10\webapps\static
/static
{<span style="color: #8b2252;">'static'</span>: &lt;<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">Flask.__init__.</span>&lt;locals&gt;.&lt;lambda&gt; at 0x000001B88AF34A40&gt;, <span style="color: #8b2252;">'hello_world'</span>: &lt;<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">hello_world</span> at 0x000001B88D956E80&gt;, <span style="color: #8b2252;">'get_json'</span>: &lt;<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">get_json</span> at 0x000001B88D956F20&gt;, <span style="color: #8b2252;">'get_info'</span>: &lt;<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">get_info</span> at 0x000001B88D956FC0&gt;}
templates
<span style="color: #0000ff;">dict_items</span>([(<span style="color: #8b2252;">'import_name'</span>, <span style="color: #8b2252;">'webapps'</span>), (<span style="color: #8b2252;">'_static_ ...&#30465;&#30053;}</span>
</pre>
</div>

<p>
在项目根目录下构建：
</p>
<ul class="org-ul">
<li>webapps包目录，存放flask代码，包内有 <code>__init__.py</code> 文件</li>
<li>templates目录，存放模板文件</li>
<li>static目录，存放js,css等静态文件。其下建立js目录，放入jquery、echarts的js文件</li>
<li>app.py入口文件</li>
</ul>


<p>
说明
</p>
<ul class="org-ul">
<li>应用：创建出来提供WEB服务的实例，也是wsgi的入口</li>
<li>视图函数：执行内部代码输出响应的内容</li>
<li>路由：通过route装饰器创建path到视图函数的映射关系</li>
<li>jsonify(*args, **kwargs) 封装数据返回Json响应报文，但是args和kwargs传参只能选择一种，否则抛异常。</li>
</ul>
</div>
</div>
<div id="outline-container-h:1fa97270-4557-4b69-8536-d714e5604af0" class="outline-3">
<h3 id="h:1fa97270-4557-4b69-8536-d714e5604af0">模板</h3>
<div class="outline-text-3" id="text-h:1fa97270-4557-4b69-8536-d714e5604af0">
<p>
<a href="https://flask.palletsprojects.com/en/stable/quickstart/#rendering-templates">https://flask.palletsprojects.com/en/stable/quickstart/#rendering-templates</a>
</p>

<p>
Flask使用jinja2模板。
</p>

<p>
对于应用app来说其模板是，根目录下的templates,其下新建index.html
</p>

<p>
/templates/index.html文件内容如下
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #0000ff;">html</span> <span style="color: #a0522d;">lang</span>=<span style="color: #8b2252;">"en"</span>&gt;
&lt;<span style="color: #0000ff;">head</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"viewport"</span> <span style="color: #a0522d;">content</span>=<span style="color: #8b2252;">"width=device-width, initial-scale=1.0"</span>&gt;
    &lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Document</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;
&lt;<span style="color: #0000ff;">body</span>&gt;
&#36825;&#26159;&#27169;&#26495;&lt;<span style="color: #0000ff;">br</span>&gt;
    {{test}}~~~&lt;<span style="color: #0000ff;">br</span>&gt;
{% for i in range(1, 10) %}
{{ i }}&lt;<span style="color: #0000ff;">br</span>&gt;
{% endfor %}

{% for i in range(1, 10) %}
{% for j in range(1, 10) %}
{{ i }}*{{ j }}={{ "<span style="color: #a0522d;">%s</span>"|format(i*j) }}&lt;<span style="color: #0000ff;">br</span>&gt;
{% endfor %}
{% endfor %}
&lt;/<span style="color: #0000ff;">body</span>&gt;
&lt;/<span style="color: #0000ff;">html</span>&gt;
</pre>
</div>

<p>
修改 <code>/webapps/__init__.py</code> 使用模板渲染函数。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> flask <span style="color: #a020f0;">import</span> Flask, Response, Request, jsonify, render_template
<span style="color: #a020f0;">import</span> io

<span style="color: #a0522d;">app</span> = Flask(<span style="color: #483d8b;">__name__</span>)

<span style="color: #228b22;">@app.route</span>(<span style="color: #8b2252;">"/"</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">hello_world</span>():
    <span style="color: #b22222;"># </span><span style="color: #b22222;">return "&lt;p&gt;Hello, World!&lt;/p&gt;"
</span>    <span style="color: #a020f0;">return</span> Response(<span style="color: #8b2252;">"Hello, flask"</span>, status=200)

<span style="color: #228b22;">@app.route</span>(<span style="color: #8b2252;">"/json"</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_json</span>():
    <span style="color: #a0522d;">d</span> = {<span style="color: #8b2252;">'a'</span>:1, <span style="color: #8b2252;">'b'</span>:[<span style="color: #8b2252;">'a'</span>, 123, <span style="color: #8b2252;">'xyz'</span>], <span style="color: #8b2252;">'c'</span>:(1,2,3)}
    <span style="color: #a020f0;">return</span> jsonify(d)

<span style="color: #228b22;">@app.route</span>(<span style="color: #8b2252;">"/info"</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_info</span>():
    <span style="color: #a0522d;">sio</span> = io.StringIO()
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> [
        app.root_path, app.url_map, app.static_folder, app.static_url_path,
        app.view_functions, app.template_folder,
        app.<span style="color: #483d8b;">__dict__</span>.items()
        ]:
        <span style="color: #483d8b;">print</span>(i) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38745;&#24577;&#36335;&#24452; /static/&lt;filename&gt;
</span>        <span style="color: #483d8b;">print</span>(i, <span style="color: #483d8b;">file</span>=sio, end=<span style="color: #8b2252;">'&lt;br&gt;'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">path =&gt; view function
</span>    <span style="color: #a020f0;">return</span> Response(sio.getvalue(), content_type=<span style="color: #8b2252;">'text/html'</span>)

<span style="color: #228b22;">@app.route</span>(<span style="color: #8b2252;">'/t'</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">test_template</span>():
    <span style="color: #a020f0;">return</span> render_template(<span style="color: #8b2252;">'index.html'</span>, test=<span style="color: #8b2252;">'abc'</span>)
</pre>
</div>

<p>
jinja2和Django模板语法一致，这里不阐述
</p>

<p>
在app.jinja_loader属性中，有下面的语句
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #228b22;">@locked_cached_property</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">jinja_loader</span>(<span style="color: #a020f0;">self</span>):
    <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.template_folder <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #008b8b;">None</span>:
        <span style="color: #a020f0;">return</span> FileSystemLoader(os.path.join(<span style="color: #a020f0;">self</span>.root_path, <span style="color: #a020f0;">self</span>.template_folder))
</pre>
</div>

<ol class="org-ol">
<li>说明：不管是app，还是bluepoint，都是使用自己的root_path和模板路径拼接成模板路径。</li>
<li>可以通过app或者bluepoint查看 <code>app.jinja_loader.searchpath</code> 模板搜索路径。</li>
<li>可以在jinja2.loaders.FileSystemLoader.get_source函数中下断点看搜索路径。</li>
</ol>
</div>
</div>
<div id="outline-container-h:0fc0ab65-1a91-4273-a1b9-6ddbed3020b6" class="outline-3">
<h3 id="h:0fc0ab65-1a91-4273-a1b9-6ddbed3020b6">蓝图</h3>
<div class="outline-text-3" id="text-h:0fc0ab65-1a91-4273-a1b9-6ddbed3020b6">
<p>
Flask中，基本上都是route装饰器和视图函数的映射，如果函数很多，代码组织结构会非常乱。
</p>

<p>
蓝图Blueprint,就是Flask中 <b>模块化</b> 技术
</p>

<p>
新建webapps/books.py蓝图文件
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">webapps/books.py&#25991;&#20214;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#34013;&#22270;
</span><span style="color: #a020f0;">from</span> flask <span style="color: #a020f0;">import</span> Blueprint, jsonify

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#30456;&#24403;&#20110;&#36825;&#26159;&#19968;&#20010;&#24212;&#29992;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#21333;&#25351;&#23450;&#27169;&#26495;&#36335;&#24452;&#65292;&#22914;&#26524;&#26159;&#30456;&#23545;&#36335;&#24452;&#65292;&#21017;&#34920;&#31034;&#20174;&#39033;&#30446;&#26681;&#30446;&#24405;&#24320;&#22987;
</span><span style="color: #a0522d;">books</span> = Blueprint(<span style="color: #8b2252;">'books'</span>, <span style="color: #483d8b;">__name__</span>, template_folder=<span style="color: #8b2252;">'temp'</span>, url_prefix=<span style="color: #8b2252;">'/books'</span>)

<span style="color: #228b22;">@books.route</span>(<span style="color: #8b2252;">'/'</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_all</span>():
    <span style="color: #a0522d;">d</span> = [
        (1, <span style="color: #8b2252;">'java'</span>, 20),
        (2, <span style="color: #8b2252;">'python'</span>, 30),
        (3, <span style="color: #8b2252;">'c++'</span>, 40),
    ]
    <span style="color: #a020f0;">return</span> jsonify(d)

<span style="color: #228b22;">@books.route</span>(<span style="color: #8b2252;">'/bookinfo'</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_book_info</span>():
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> [books.root_path, books.static_folder, books.static_url_path,
        books.template_folder, books.name, books.url_prefix
    ]:
        <span style="color: #483d8b;">print</span>(x)
    <span style="color: #483d8b;">print</span>()
    <span style="color: #a020f0;">return</span> jsonify({<span style="color: #8b2252;">'a'</span>:<span style="color: #8b2252;">'ok'</span>})
</pre>
</div>

<p>
修改 <code>/webapps/__init__.py</code> 文件如下：在app中注册新建的蓝图文件
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">/webapps/__init__.py
</span><span style="color: #a020f0;">from</span> flask <span style="color: #a020f0;">import</span> Flask, Response, Request, jsonify, render_template
<span style="color: #a020f0;">import</span> io

<span style="color: #a0522d;">app</span> = Flask(<span style="color: #483d8b;">__name__</span>)

<span style="color: #228b22;">@app.route</span>(<span style="color: #8b2252;">"/"</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">hello_world</span>():
    <span style="color: #b22222;"># </span><span style="color: #b22222;">return "&lt;p&gt;Hello, World!&lt;/p&gt;"
</span>    <span style="color: #a020f0;">return</span> Response(<span style="color: #8b2252;">"Hello, flask"</span>, status=200)

<span style="color: #228b22;">@app.route</span>(<span style="color: #8b2252;">"/json"</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_json</span>():
    <span style="color: #a0522d;">d</span> = {<span style="color: #8b2252;">'a'</span>:1, <span style="color: #8b2252;">'b'</span>:[<span style="color: #8b2252;">'a'</span>, 123, <span style="color: #8b2252;">'xyz'</span>], <span style="color: #8b2252;">'c'</span>:(1,2,3)}
    <span style="color: #a020f0;">return</span> jsonify(d)

<span style="color: #228b22;">@app.route</span>(<span style="color: #8b2252;">"/info"</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_info</span>():
    <span style="color: #a0522d;">sio</span> = io.StringIO()
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> [
        app.root_path, app.url_map, app.static_folder, app.static_url_path,
        app.view_functions, app.template_folder,
        app.<span style="color: #483d8b;">__dict__</span>.items()
        ]:
        <span style="color: #483d8b;">print</span>(i) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38745;&#24577;&#36335;&#24452; /static/&lt;filename&gt;
</span>        <span style="color: #483d8b;">print</span>(i, <span style="color: #483d8b;">file</span>=sio, end=<span style="color: #8b2252;">'&lt;br&gt;'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">path =&gt; view function
</span>    <span style="color: #a020f0;">return</span> Response(sio.getvalue(), content_type=<span style="color: #8b2252;">'text/html'</span>)

<span style="color: #228b22;">@app.route</span>(<span style="color: #8b2252;">'/t'</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">test_template</span>():
    <span style="color: #a020f0;">return</span> render_template(<span style="color: #8b2252;">'index.html'</span>, test=<span style="color: #8b2252;">'abc'</span>)

<span style="color: #a020f0;">from</span> .books <span style="color: #a020f0;">import</span> books
app.register_blueprint(books, url_prefix=<span style="color: #8b2252;">'/xyz'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27880;&#20876;&#20248;&#20808;</span>
</pre>
</div>

<p>
注册完成后，启动=/main.py=文件
</p>

<p>
Blueprint构造参数
</p>
<ul class="org-ul">
<li>name: 蓝图名称，注册在app的蓝图字典中用的key</li>
<li>import_name: 用来计算蓝图模块所在路径，一般写 <code>__name__</code></li>
<li>root_path: 指定蓝图模块所在路径，如果None，使用import_name计算得到</li>
<li>template_folder
<ul class="org-ul">
<li>相对于蓝图的root_path，假设就是books.py的目录path1，那么上面的模板文件路径path1/temp/xxx.html</li>
<li>模板是一批搜索路径，会依次搜索这些模板路径，找到第一个返回。如果在找到本蓝图模板之前，有一个同名的模板，那么本蓝图模板文件就不能被找到了</li>
</ul></li>
<li>url_prefix: 指定本蓝图模块的路径前缀，app.register_blueprint注册蓝图时，也可以对当前蓝图指定url_prefix,将覆盖蓝图中的定义。</li>
</ul>

<p>
特别注意，输出的root_path路径，说明蓝图有自己一套路径。
</p>

<p>
最后app.register_blueprint(bpbooks,url_prefix="/bookss"),url_prefix一定要以 <code>/</code> 开始，否则报错，最后路径以注册的 url_prefix为准
</p>
</div>
</div>
</section>
<section id="outline-container-h:c94bb4b7-afec-4d8c-8e75-0dd65038cdf7" class="outline-2">
<h2 id="h:c94bb4b7-afec-4d8c-8e75-0dd65038cdf7">jQuery</h2>
<div class="outline-text-2" id="text-h:c94bb4b7-afec-4d8c-8e75-0dd65038cdf7">
<p>
2006年初发布的一个JavaScript库，极大简化了JS编程。
</p>

<p>
官网：<a href="https://jquery.com/">https://jquery.com/</a>
</p>

<p>
jQuery库包含以下功能:
</p>
<ul class="org-ul">
<li>HTML 元素选取</li>
<li>HTML 元素操作</li>
<li>CSS操作</li>
<li>HTML DOM 遍历和修改</li>
<li>HTML事件函数</li>
<li>JavaScript特效和动画</li>
<li><b>AJAX</b></li>
<li>Utilities</li>
</ul>
<p>
除了上述功能外，它之所以流行，是官方、非官方提供了海量的插件。
</p>
</div>
<div id="outline-container-h:642dae9a-efa6-4f2c-bc02-0122418f944d" class="outline-3">
<h3 id="h:642dae9a-efa6-4f2c-bc02-0122418f944d">安装</h3>
<div class="outline-text-3" id="text-h:642dae9a-efa6-4f2c-bc02-0122418f944d">
<p>
下载jquery: <a href="https://jquery.com/download/">https://jquery.com/download/</a>
</p>

<ul class="org-ul">
<li>jquery.js: 开发用的</li>
<li>jquery.min.js: 是压缩后的的部署用</li>
<li>jquery.min.map: 源码映射</li>
</ul>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"jquery.js"</span>&gt;&lt;/<span style="color: #0000ff;">script</span>&gt;
</pre>
</div>

<p>
flask目录结构
</p>
<div class="org-src-container">
<pre class="src src-sh">WEBAPPS
&#9474;  books.py
&#9474;  __init__.py
&#9474;
&#9500;&#9472;static
&#9474;  &#9492;&#9472;js
&#9474;          jquery-3.7.1.js
&#9474;          jquery-3.7.1.min.js
&#9474;
&#9500;&#9472;templates
&#9474;      index.html
t1.py
</pre>
</div>
</div>
<div id="outline-container-h:40c83fbf-ad56-4887-b35b-47ed2dcd5a37" class="outline-4">
<h4 id="h:40c83fbf-ad56-4887-b35b-47ed2dcd5a37">API文档</h4>
<div class="outline-text-4" id="text-h:40c83fbf-ad56-4887-b35b-47ed2dcd5a37">
<ul class="org-ul">
<li>官方文档：<a href="https://api.jquery.com/">https://api.jquery.com/</a></li>
<li>中文文档：<a href="https://api.jqueryjs.cn/">https://api.jqueryjs.cn/</a></li>
<li>jQuery API 1.11.3 速查表: <a href="http://jquery.yanzhihui.com/">http://jquery.yanzhihui.com/</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:add0537c-64ee-4173-90e0-4521da0ac2f8" class="outline-3">
<h3 id="h:add0537c-64ee-4173-90e0-4521da0ac2f8">Flask静态部署</h3>
<div class="outline-text-3" id="text-h:add0537c-64ee-4173-90e0-4521da0ac2f8">
<div class="org-src-container">
<pre class="src src-sh">(<span style="color: #8b2252;">'root_path'</span>, <span style="color: #8b2252;">'E:\\ClassProjects\\test'</span>)
(<span style="color: #8b2252;">'_static_folder'</span>, <span style="color: #8b2252;">'static'</span>)

(<span style="color: #8b2252;">'url_map'</span>, Map([
...,
&lt;Rule <span style="color: #8b2252;">'/static/&lt;filename&gt;'</span> (OPTIONS, HEAD, GET) -&gt;static&gt;]))
</pre>
</div>

<p>
将js文件、CSS文件一般都是放到static目录中。
</p>

<p>
本次js放到/static/js/jquery.js。
</p>

<p>
修改templates/index.html如下
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #0000ff;">html</span> <span style="color: #a0522d;">lang</span>=<span style="color: #8b2252;">"en"</span>&gt;
&lt;<span style="color: #0000ff;">head</span>&gt;
  &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span>&gt;
  &lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">&#27979;&#35797;</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
  &lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"js/jquery.js"</span>&gt;&lt;/<span style="color: #0000ff;">scr</span>
&lt;/<span style="color: #0000ff;">head</span>&gt;
&lt;<span style="color: #0000ff;">body</span>&gt;
&lt;<span style="color: #0000ff;">h2id</span>=<span style="color: #8b2252;">"root"</span>&gt;&#27979;&#35797;jQuery&lt;/<span style="color: #0000ff;">h2</span>&gt;
&lt;/<span style="color: #0000ff;">body</span>&gt;
&lt;/<span style="color: #0000ff;">html</span>&gt;
</pre>
</div>
<p>
路径写法
</p>

<p>
js/jquery.js表示从当前站点访问路径开始的相对路径，<a href="http://127.0.0.1:8000/js/jquery.js">http://127.0.0.1:8000/js/jquery.js</a> ，找不到返回404。
</p>

<p>
/static/js/jquery.js表示站点根目录下开始，<a href="http://127.0.0.1:8000/static/js/jquery.js">http://127.0.0.1:8000/static/js/jquery.js</a> ，找到返回200。
</p>

<p>
但是上面这种写法是固定死的，可以使用url_for处理。
</p>

<p>
url_for第一个参数写函数，通过函数对象，反查路径映射中的路径。即通过(OPTIONS, HEAD, GET) -&gt;static&gt;查逻辑路径'/st/&lt;filename&gt;'
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #0000ff;">script</span> src={{url_for(<span style="color: #8b2252;">'static'</span>, <span style="color: #a0522d;">filename</span>=<span style="color: #8b2252;">"js/jquery.js"")}}&gt;&lt;/script&gt;</span>
</pre>
</div>

<p>
上面这一句的意思就是通过static反查路径，&lt;Rule'/st/&lt;filename&gt;' (OPTIONS, HEAD, GET) -&gt;static&gt;])
</p>

<p>
在Flask中，可以指定静态目录。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">app</span> = Flask(<span style="color: #8b2252;">'web'</span>, static_folder=<span style="color: #8b2252;">'static'</span>, static_uurl_path=<span style="color: #8b2252;">'/st'</span>)
</pre>
</div>

<ul class="org-ul">
<li>static_url_path: 指的是url中访问路径，可以不写，默认就是/&lt;static_folder&gt;</li>
<li>static_folder: 指的是静态文件的物理放置目录。注意这个目录不要写错。如若没有配置，默认static。如果没有配置static_url_path，默认就是/static</li>
</ul>

<p>
templates/index.js
</p>
<div class="org-src-container">
<pre class="src src-js">&lt;!DOCTYPE html&gt;
&lt;html lang=<span style="color: #8b2252;">"en"</span>&gt;
&lt;head&gt;
    &lt;meta charset=<span style="color: #8b2252;">"UTF-8"</span>&gt;
    &lt;meta name=<span style="color: #8b2252;">"viewport"</span> content=<span style="color: #8b2252;">"width=device-width, initial-scale=1.0"</span>&gt;
    &lt;title&gt;Document&lt;/title&gt;
    &lt;!--&lt;script src=<span style="color: #8b2252;">"/static/js/jquery-3.7.1.js"</span>&gt;&lt;/script&gt;--&gt;
    &lt;script src=<span style="color: #8b2252;">"{{url_for('static', filename='js/jquery-3.7.1.js')}}"</span>&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
{{url_for(<span style="color: #8b2252;">'static'</span>, filename=<span style="color: #8b2252;">'js/jquery-3.7.1.js'</span>)}}

&#36825;&#26159;&#27169;&#26495;&lt;br&gt;
    {{test}}~~~&lt;br&gt;
{% <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> range(1, 10) %}
{{ i }}&lt;br&gt;
{% endfor %}

&lt;/body&gt;
&lt;/html&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b5f466d1-a0dd-49f7-b905-8eeaff7c8924" class="outline-3">
<h3 id="h:b5f466d1-a0dd-49f7-b905-8eeaff7c8924">基本语法</h3>
<div class="outline-text-3" id="text-h:b5f466d1-a0dd-49f7-b905-8eeaff7c8924">
<p>
<code>$(selector).action()</code>
</p>
<ul class="org-ul">
<li>美元符号定义jQuery</li>
<li>选择符(selector)"查询"和"查找"HTML元素</li>
<li>jQuery的action()执行对元素的操作</li>
</ul>

<p>
文档就绪函数
</p>

<p>
为了防止文档加载完之前就允许执行jQuery代码，需要一个网页加载完的才调用的函数。
</p>

<div class="org-src-container">
<pre class="src src-js">$(document).ready(<span style="color: #a020f0;">function</span>(){
    console.log(<span style="color: #8b2252;">'hello jquery'</span>)
});
</pre>
</div>

<p>
可以简写为下面形式
</p>
<div class="org-src-container">
<pre class="src src-js">$(<span style="color: #a020f0;">function</span>(){
<span style="color: #b22222;">/* </span><span style="color: #b22222;">jQuery functions go here&#20934;&#22791;&#23601;&#32490;&#22238;&#35843;&#20989;&#25968;</span><span style="color: #b22222;"> */</span>
});
</pre>
</div>
</div>
</div>
<div id="outline-container-h:54739763-1343-452b-a4e4-d9d3abcb5d70" class="outline-3">
<h3 id="h:54739763-1343-452b-a4e4-d9d3abcb5d70">jQuery元素选择器</h3>
<div class="outline-text-3" id="text-h:54739763-1343-452b-a4e4-d9d3abcb5d70">
<p>
jQuery使用CSS选择器来选取HTML元素。
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">选择器</th>
<th scope="col" class="org-left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">$("р")</td>
<td class="org-left">选取&lt;p&gt;元素</td>
</tr>

<tr>
<td class="org-left">$("p.intro")</td>
<td class="org-left">选取所有class="intro"的&lt;p&gt;元素</td>
</tr>

<tr>
<td class="org-left">$("p#demo")</td>
<td class="org-left">选取所有id="demo"的&lt;p&gt;元素</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-h:913c060c-3629-46e6-9ac4-0c947e11dc13" class="outline-3">
<h3 id="h:913c060c-3629-46e6-9ac4-0c947e11dc13">jQuery属性选择器</h3>
<div class="outline-text-3" id="text-h:913c060c-3629-46e6-9ac4-0c947e11dc13">
<p>
jQuery使用XPath表达式来选择带有给定属性的元素。
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">选择器</th>
<th scope="col" class="org-left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">$("[href]")</td>
<td class="org-left">选取所有带有href属性的元素</td>
</tr>

<tr>
<td class="org-left">$("[href='#']")</td>
<td class="org-left">选取所有带有href值等于"#"的元素</td>
</tr>

<tr>
<td class="org-left">$("[href!='#']")</td>
<td class="org-left">选取所有带有href值不等于"#"的元素</td>
</tr>

<tr>
<td class="org-left">$("[href$='.jpg']")</td>
<td class="org-left">选取所有href值以".jpg"结尾的元素</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-h:7e824849-dd80-4f17-9a0d-756df257c677" class="outline-3">
<h3 id="h:7e824849-dd80-4f17-9a0d-756df257c677">元素包装</h3>
<div class="outline-text-3" id="text-h:7e824849-dd80-4f17-9a0d-756df257c677">
<div class="org-src-container">
<pre class="src src-js">console.log($(<span style="color: #8b2252;">'#root'</span>));<span style="color: #b22222;">// </span><span style="color: #b22222;">jquery&#23545;&#35937;
</span>console.log(document.getElementById(<span style="color: #8b2252;">'root'</span>)); <span style="color: #b22222;">// </span><span style="color: #b22222;">HTML&#20803;&#32032;
</span>console.log($(document.getElementById(<span style="color: #8b2252;">'root'</span>))) <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21253;&#35013;&#25104;jquery&#23545;&#35937;
</span>console.log($(<span style="color: #8b2252;">'div'</span>))<span style="color: #b22222;">// </span><span style="color: #b22222;">div&#26631;&#31614;&#36873;&#25321;&#22120;,&#27880;&#24847;&#21644;&#19979;&#38754;&#30340;&#19981;&#21516;&#20043;&#22788;
</span>console.log($(<span style="color: #8b2252;">'&lt;div/&gt;'</span>)) <span style="color: #b22222;">// </span><span style="color: #b22222;">HTML&#20803;&#32032;&#21253;&#35013;&#25104;jquery&#23545;&#35937;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c054f330-5dd6-4230-a882-c29dd4f2532a" class="outline-3">
<h3 id="h:c054f330-5dd6-4230-a882-c29dd4f2532a">CSS操作</h3>
<div class="outline-text-3" id="text-h:c054f330-5dd6-4230-a882-c29dd4f2532a">
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">var</span> <span style="color: #a0522d;">r</span> = $(<span style="color: #8b2252;">'#root'</span>) <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36873;&#25321;
</span>console.log(r.css(color<span style="color: #8b2252;">'));// &#35835;
r.css('</span>color<span style="color: #8b2252;">', '</span>#F00<span style="color: #8b2252;">')/ // &#20889;
r.css({'</span>background-color<span style="color: #8b2252;">':'</span>#f2f2f2f2<span style="color: #8b2252;">', '</span>color<span style="color: #8b2252;">': #00F'</span>});
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a5e15aab-056b-4821-a62f-29d835981245" class="outline-3">
<h3 id="h:a5e15aab-056b-4821-a62f-29d835981245">HTML操作</h3>
<div class="outline-text-3" id="text-h:a5e15aab-056b-4821-a62f-29d835981245">
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">var</span> <span style="color: #a0522d;">r</span> = $(<span style="color: #8b2252;">'#root'</span>);
console.log(r.html());<span style="color: #b22222;">// </span><span style="color: #b22222;">&#35835;
</span>r.html(<span style="color: #8b2252;">'&lt;span&gt;'</span>+ r.html()+ <span style="color: #8b2252;">'&lt;/span&gt;'</span>); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20889;
</span>console.log(r.html());<span style="color: #b22222;">// </span><span style="color: #b22222;">&#35835;
</span>console.log(r.text());<span style="color: #b22222;">//</span><span style="color: #b22222;">&#21482;&#26377;&#25991;&#26412;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:54d97c85-4f94-412b-8ac5-397862c6cb4c" class="outline-3">
<h3 id="h:54d97c85-4f94-412b-8ac5-397862c6cb4c">增加节点</h3>
<div class="outline-text-3" id="text-h:54d97c85-4f94-412b-8ac5-397862c6cb4c">
</div>
<div id="outline-container-h:904cfa16-fd80-4111-8855-1d5fa9679218" class="outline-4">
<h4 id="h:904cfa16-fd80-4111-8855-1d5fa9679218">内部追加</h4>
<div class="outline-text-4" id="text-h:904cfa16-fd80-4111-8855-1d5fa9679218">
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">var</span> <span style="color: #a0522d;">r</span> = $(<span style="color: #8b2252;">'#root'</span>);
r.append(<span style="color: #8b2252;">'&lt;img /&gt;'</span>);
</pre>
</div>
</div>
</div>
<div id="outline-container-h:2c823134-1124-4a6e-975c-b58f897bac2f" class="outline-4">
<h4 id="h:2c823134-1124-4a6e-975c-b58f897bac2f">增加兄弟</h4>
<div class="outline-text-4" id="text-h:2c823134-1124-4a6e-975c-b58f897bac2f">
<p>
after外部增加兄弟，append内部末尾增加
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">var</span> <span style="color: #a0522d;">r</span> = $(<span style="color: #8b2252;">'#root'</span>);
r.append(<span style="color: #8b2252;">'&lt;img /&gt;'</span>);
r.after(<span style="color: #8b2252;">'&lt;hr&gt;'</span>);
r.append(<span style="color: #8b2252;">'&lt;ul&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;/ul&gt;'</span>);
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:cd1d6ca0-5848-42a5-ac16-bba22d0d5bd3" class="outline-3">
<h3 id="h:cd1d6ca0-5848-42a5-ac16-bba22d0d5bd3">attr属性操作</h3>
<div class="outline-text-3" id="text-h:cd1d6ca0-5848-42a5-ac16-bba22d0d5bd3">
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">var</span> <span style="color: #a0522d;">r</span> = $(<span style="color: #8b2252;">'#root'</span>);
r.append(<span style="color: #8b2252;">'&lt;img /&gt;'</span>);
r.after(<span style="color: #8b2252;">'&lt;hr&gt;'</span>);
r.append(<span style="color: #8b2252;">'&lt;ul&gt;&lt;li&gt;&#34892;1&lt;/li&gt;&lt;li&gt;&#34892;2&lt;/li&gt;&lt;li&gt;&#34892;3&lt;/li&gt;&lt;/ul&gt;'</span>)
$(<span style="color: #8b2252;">'#root img'</span>).attr({
  height:60, width:120, alt: <span style="color: #8b2252;">'jquery logo'</span>,
  src: <span style="color: #8b2252;">'https://api.jquery.com/wp-content/themes/jquery/images/logo-jquery.png'</span>
});
console.log($(<span style="color: #8b2252;">'#root img'</span>).attr(<span style="color: #8b2252;">'alt'</span>));
</pre>
</div>

<p>
removeAttr是移除属性函数。
</p>
</div>
</div>
<div id="outline-container-h:e5f82594-88ec-4887-84b7-a32144fce6b7" class="outline-3">
<h3 id="h:e5f82594-88ec-4887-84b7-a32144fce6b7">第几个</h3>
<div class="outline-text-3" id="text-h:e5f82594-88ec-4887-84b7-a32144fce6b7">
<p>
:odd 奇数，:even偶数，:first第一个
</p>

<div class="org-src-container">
<pre class="src src-js">$(<span style="color: #8b2252;">'#root ul li:first'</span>).css(<span style="color: #8b2252;">'color'</span>, <span style="color: #8b2252;">'#f00'</span>);<span style="color: #b22222;">//</span><span style="color: #b22222;">
</span>$(<span style="color: #8b2252;">'#root ul li:gt(3)'</span>).css(<span style="color: #8b2252;">'color'</span>, <span style="color: #8b2252;">'#f00'</span>);<span style="color: #b22222;">// </span><span style="color: #b22222;">&#22823;&#20110;&#31532;3&#26465;&#24320;&#22987;  gt&#22823;&#20110;,  lt&#23567;&#20110;
</span>$(<span style="color: #8b2252;">'#root ul li:nth-child(2)'</span>).css(<span style="color: #8b2252;">'color'</span>, <span style="color: #8b2252;">'#Ofo'</span>);<span style="color: #b22222;">//</span><span style="color: #b22222;">&#21305;&#37197;1i&#30340;&#29238;ul&#19979;&#30340;1i&#30340;&#31532;&#20960;&#20010;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:dec9e5bc-4f1d-4fdb-9e93-cac14326fddd" class="outline-3">
<h3 id="h:dec9e5bc-4f1d-4fdb-9e93-cac14326fddd">jQuery事件函数</h3>
<div class="outline-text-3" id="text-h:dec9e5bc-4f1d-4fdb-9e93-cac14326fddd">
<p>
<a href="https://api.jqueryjs.cn/category/events/mouse-events/">https://api.jqueryjs.cn/category/events/mouse-events/</a>
</p>

<div class="org-src-container">
<pre class="src src-js">$(<span style="color: #8b2252;">'button.testclick'</span>).click()<span style="color: #b22222;">//</span><span style="color: #b22222;">&#35843;&#29992;click&#20107;&#20214;&#22238;&#35843;&#20989;&#25968;
</span>$(<span style="color: #8b2252;">'button.testclick'</span>).click(<span style="color: #a020f0;">function</span>(){}}} <span style="color: #b22222;">// </span><span style="color: #b22222;">i&#35774;&#32622;click&#20107;&#20214;&#22238;&#35843;&#20989;&#25968;</span>
</pre>
</div>

<p>
为jQuery对象增加事件回调函数
</p>

<p>
tmplates/index.html
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #0000ff;">html</span> <span style="color: #a0522d;">lang</span>=<span style="color: #8b2252;">"en"</span>&gt;
&lt;<span style="color: #0000ff;">head</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"viewport"</span> <span style="color: #a0522d;">content</span>=<span style="color: #8b2252;">"width=device-width, initial-scale=1.0"</span>&gt;
    &lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Document</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
    <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;">&lt;script src="/static/js/jquery-3.7.1.js"&gt;&lt;/script&gt;</span><span style="color: #b22222;">--&gt;</span>
    &lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"{{url_for('static', filename='js/jquery-3.7.1.js')}}"</span>&gt;&lt;/<span style="color: #0000ff;">script</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;
&lt;<span style="color: #0000ff;">body</span>&gt;

&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">'root'</span>&gt;&#36825;&#26159;&#26681;&#20803;&#32032;&lt;/<span style="color: #0000ff;">div</span>&gt;
&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"descriptions"</span>&gt;&lt;<span style="color: #0000ff;">ul</span> /&gt;&lt;/<span style="color: #0000ff;">div</span>&gt;

&lt;/<span style="color: #0000ff;">body</span>&gt;
&lt;/<span style="color: #0000ff;">html</span>&gt;
&lt;<span style="color: #0000ff;">script</span>&gt;
    $(function(){
        console.log('div');
        console.log('&lt;<span style="color: #0000ff;">div</span>&gt;');
        console.log($('div'));  // &#26631;&#31614;&#36873;&#25321;&#22120;
        console.log($('&lt;<span style="color: #0000ff;">div</span> /&gt;')); // &#25226;&#19968;&#20010;&#23383;&#31526;&#20018;&#29702;&#35299;&#20026;html&#65292;&#24182;&#19988;&#22312;&#20869;&#23384;&#20013;&#25226;&#36825;&#20010;&#26631;&#31614;&#23553;&#35013;&#20026;jquery&#23545;&#35937;&#12290;
        console.log(document.getElementById('root'));
        console.log($(document.getElementById('root'))); // &#29616;&#26377;&#30340;&#20803;&#32032;&#23545;&#35937;&#23553;&#35013;&#25104;jquery&#23545;&#35937;

        var btn = $('&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"testarea"</span>&gt;&lt;<span style="color: #0000ff;">span</span>&gt;&#27979;&#35797;&#25991;&#26412;&lt;/<span style="color: #0000ff;">span</span>&gt;&lt;<span style="color: #0000ff;">button</span>&gt;&#25353;&#38062;&lt;/<span style="color: #0000ff;">button</span>&gt;&lt;/<span style="color: #0000ff;">div</span>&gt;')
        $('#root').append(btn)
        var des = $('div.descriptions ul')
        btn.click(function(event){
            console.log(event.target)
            let x = $(event.target) // &#21253;&#35013;&#25104;jquery&#23545;&#35937;
            x.text('&#28857;&#20987;&#27979;&#35797;')
            des.append($('&lt;<span style="color: #0000ff;">li</span>&gt;&#31532;n&#26465;&#35780;&#35770;&lt;/<span style="color: #0000ff;">li</span>&gt;'))
            console.log('&#28857;&#20987;&#20102;')

            $('div.descriptions ul li:lt(3)').css('color', 'red')
            $('div.descriptions ul li:nth-child(2)').css('color', 'green')
        })

        x= $('div.testarea &gt; span').css('color') // &#33719;&#21462;
        console.log(x);
        $('div.testarea &gt; span').css('color', 'red') // &#35774;&#32622;

        var x= $('div.testarea &gt; span')
        console.log(x.css('color'));
        x.css('color', 'blue') // &#35774;&#32622;
        x.css({'color':'green', 'font-size':'20px'}) // &#22810;&#20540;&#35774;&#32622;

        console.log($('div.testarea').html());  // &#21462;&#23436;&#25972;&#30340;html html&#26631;&#31614;&#21644;&#25991;&#26412;
        console.log($('div.testarea').text());  // &#21482;&#21462;&#25991;&#26412;

        x.text('&#27491;&#24335;&#30340;&#25991;&#26412;'); // &#20462;&#25913;&#20869;&#23481;
        x.html('&lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"#"</span>&gt;test text&lt;/<span style="color: #0000ff;">a</span>&gt;')

        $('div.testarea').prepend('&lt;<span style="color: #0000ff;">img</span> /&gt;')
        var img = $('img')
        img.attr({'src':'https://api.jquery.com/wp-content/themes/jquery/images/logo-jquery.png', 
        'alt':'jquery logo', 'width':'30px'})

        console.log($('[alt]').attr('src'));
    })
&lt;/<span style="color: #0000ff;">script</span>&gt;
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:f21e5847-da3c-477c-86c5-e752480d5749" class="outline-2">
<h2 id="h:f21e5847-da3c-477c-86c5-e752480d5749">Ajax</h2>
<div class="outline-text-2" id="text-h:f21e5847-da3c-477c-86c5-e752480d5749">
<p>
jQuery对XMLHttpRequest组件的调用接口实现了封装，更加方便调用。默认是异步请求。
</p>

<p>
<a href="https://api.jqueryjs.cn/category/ajax/shorthand-methods/">https://api.jqueryjs.cn/category/ajax/shorthand-methods/</a>
</p>
</div>
<div id="outline-container-h:a9f62ed9-2463-49fe-8270-006e0118490a" class="outline-3">
<h3 id="h:a9f62ed9-2463-49fe-8270-006e0118490a">GET请求</h3>
<div class="outline-text-3" id="text-h:a9f62ed9-2463-49fe-8270-006e0118490a">
<p>
flask中蓝图代码改动如下
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> flask <span style="color: #a020f0;">import</span> Blueprint, jsonify, render_template, request
<span style="color: #a0522d;">books</span> = Blueprint(<span style="color: #8b2252;">'bp'</span>, <span style="color: #483d8b;">__name__</span>, url_prefix=<span style="color: #8b2252;">'/ooo'</span>, template_folder=<span style="color: #8b2252;">'temp'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#26377;&#33258;&#24049;&#30340;&#38745;&#24577;&#36335;&#24452;&#12289;&#27169;&#26495;&#36335;&#24452;&#12289;root&#36335;&#24452;
</span>
<span style="color: #228b22;">@books.route</span>(<span style="color: #8b2252;">'/'</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">all</span>():
<span style="color: #a0522d;">books</span> = [
{<span style="color: #8b2252;">'id'</span>: O, <span style="color: #8b2252;">'name'</span>: <span style="color: #8b2252;">'python'</span>},
{<span style="color: #8b2252;">'id'</span>: 1, <span style="color: #8b2252;">'name'</span>: <span style="color: #8b2252;">'C++'</span>},
{<span style="color: #8b2252;">'id'</span>: 2, <span style="color: #8b2252;">'name'</span>: <span style="color: #8b2252;">'java'</span>}
]
<span style="color: #483d8b;">print</span>(*<span style="color: #483d8b;">dir</span>(request), sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>)
<span style="color: #483d8b;">print</span>(request.ur1) <span style="color: #b22222;"># </span><span style="color: #b22222;">http://127.0.0.1:5000/bodks/?k1=1&amp;k2=3
</span><span style="color: #483d8b;">print</span>(request.full_path) <span style="color: #b22222;"># </span><span style="color: #b22222;">/books/?k1=1&amp;k2=3
</span><span style="color: #483d8b;">print</span>(request.method) <span style="color: #b22222;"># </span><span style="color: #b22222;">GET
</span><span style="color: #483d8b;">print</span>(request.cookies)
<span style="color: #483d8b;">print</span>(request.args)
<span style="color: #483d8b;">print</span>(request.form)
<span style="color: #483d8b;">print</span>(request.is_json, request.get_json, requesst.json)
<span style="color: #483d8b;">print</span>(request.query_string) <span style="color: #b22222;"># </span><span style="color: #b22222;">b'k1=1&amp;k2=3'
</span><span style="color: #a020f0;">return</span> jsonify(books)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">webapps/books.py&#25991;&#20214;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#34013;&#22270;
</span><span style="color: #a020f0;">from</span> flask <span style="color: #a020f0;">import</span> Blueprint, jsonify, request, Request

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#30456;&#24403;&#20110;&#36825;&#26159;&#19968;&#20010;&#24212;&#29992;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#21333;&#25351;&#23450;&#27169;&#26495;&#36335;&#24452;&#65292;&#22914;&#26524;&#26159;&#30456;&#23545;&#36335;&#24452;&#65292;&#21017;&#34920;&#31034;&#20174;&#39033;&#30446;&#26681;&#30446;&#24405;&#24320;&#22987;
</span><span style="color: #a0522d;">books</span> = Blueprint(<span style="color: #8b2252;">'books'</span>, <span style="color: #483d8b;">__name__</span>, template_folder=<span style="color: #8b2252;">'temp'</span>, url_prefix=<span style="color: #8b2252;">'/books'</span>)

<span style="color: #228b22;">@books.route</span>(<span style="color: #8b2252;">'/'</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_all</span>():
    <span style="color: #a0522d;">d</span> = [
        (1, <span style="color: #8b2252;">'java'</span>, 20),
        (2, <span style="color: #8b2252;">'python'</span>, 30),
        (3, <span style="color: #8b2252;">'c++'</span>, 40),
    ]
    <span style="color: #a0522d;">r</span>:<span style="color: #228b22;">Request</span> = request
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> [
        r.method, r.query_string, r.args, r.path, r.form,
        r.is_json, r.data
    ]:
        <span style="color: #483d8b;">print</span>(x)

    <span style="color: #a020f0;">return</span> jsonify(d) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27983;&#35272;&#22120;&#36820;&#22238;json&#65292;&#21464;&#25104;&#22238;&#35843;&#20989;&#25968;&#30340;&#21442;&#25968;data
</span>
<span style="color: #228b22;">@books.route</span>(<span style="color: #8b2252;">'/bookinfo'</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_book_info</span>():
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> [books.root_path, books.static_folder, books.static_url_path,
        books.template_folder, books.name, books.url_prefix
    ]:
        <span style="color: #483d8b;">print</span>(x)
    <span style="color: #483d8b;">print</span>()
    <span style="color: #a020f0;">return</span> jsonify({<span style="color: #8b2252;">'a'</span>:<span style="color: #8b2252;">'ok'</span>})
</pre>
</div>

<p>
tmplates/index.html
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #0000ff;">html</span> <span style="color: #a0522d;">lang</span>=<span style="color: #8b2252;">"en"</span>&gt;

&lt;<span style="color: #0000ff;">head</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"viewport"</span> <span style="color: #a0522d;">content</span>=<span style="color: #8b2252;">"width=device-width, initial-scale=1.0"</span>&gt;
    &lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Document</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
    &lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"{{url_for('static', filename='js/jquery-3.7.1.js')}}"</span>&gt;&lt;/<span style="color: #0000ff;">script</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;

&lt;<span style="color: #0000ff;">body</span>&gt;

    &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">'root'</span>&gt;&#36825;&#26159;&#26681;&#20803;&#32032;&lt;/<span style="color: #0000ff;">div</span>&gt;
    &lt;<span style="color: #0000ff;">hr</span>&gt;
    &lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"testajax"</span>&gt;&#27979;&#35797;ajax&lt;/<span style="color: #0000ff;">button</span>&gt;

&lt;/<span style="color: #0000ff;">body</span>&gt;

&lt;/<span style="color: #0000ff;">html</span>&gt;
&lt;<span style="color: #0000ff;">script</span>&gt;
    $(function () {

        // $('button.testajax').click(function (event) {
        //     $.get("/books", { k1: "v1", k2: "v2", k2:"v3" }) // &#21464;&#25104;&#20102;query_string http://127.0.0.1:5000/books/?k1=v1<span style="color: #a0522d;">&amp;k2</span>=v3
        //         .done(function (data) { // 2xx
        //             console.log(data);
        //         });
        // })
        $('button.testajax').click(function (event) {
            $.get("/books/?k1=v1<span style="color: #a0522d;">&amp;k2</span>=v2<span style="color: #a0522d;">&amp;k2</span>=v3") // http://127.0.0.1:5000/books/?k1=v1<span style="color: #a0522d;">&amp;k2</span>=v2<span style="color: #a0522d;">&amp;k2</span>=v3
                .done(function (data) { // 2xx
                    console.log(data);
                });
        })

    })
&lt;/<span style="color: #0000ff;">script</span>&gt;
</pre>
</div>

<p>
访问 <a href="http://127.0.0.1:5000/t">http://127.0.0.1:5000/t</a>
</p>
</div>
</div>
<div id="outline-container-h:ae5cb067-1270-44d8-a63e-227a40658464" class="outline-3">
<h3 id="h:ae5cb067-1270-44d8-a63e-227a40658464">GET请求跨域</h3>
<div class="outline-text-3" id="text-h:ae5cb067-1270-44d8-a63e-227a40658464">
<p>
如果你发起HTTP请求时，使用了不同的域名或端口，这就不是同域了。
</p>

<p>
为了演示效果，使用不同域来访问。
</p>

<p>
如果浏览器地址栏使用127.0.0.1，那么Ajax请求就使用localhost。总之两个不一样就行。
</p>

<p>
点击"Ajax GET请求"按钮，发现数据返回了，但是控制台中的数据不能打印了，并报了CORS错误
</p>

<p>
这是HTTP请求跨域访问产生的。
</p>

<p>
请求头如下
</p>
<div class="org-src-container">
<pre class="src src-sh">GET /books/?<span style="color: #a0522d;">k1</span>=1&amp;<span style="color: #a0522d;">k2</span>=3 HTTP/1.1
Host: localhost: 5000
Connection: keep-alive
Accept: */*
Origin: http://127.0.0.1:5000
User-Agent: Mo&#380;illa/5.0 (windows NT 6.1) ApplewebKit/537.36(KHTML, like Gecko)Maxthon/5.0 Chrome/55.0.2883.75 Safari/537.36
DNT: 1
Referer: http://127.0.0.1:5000/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN
</pre>
</div>

<p>
上面是GET请求,跨域请求后,其实数据都已经返回到了浏览器端,但是被浏览器拒绝了。
</p>

<p>
template/index.html
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #0000ff;">html</span> <span style="color: #a0522d;">lang</span>=<span style="color: #8b2252;">"en"</span>&gt;

&lt;<span style="color: #0000ff;">head</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"viewport"</span> <span style="color: #a0522d;">content</span>=<span style="color: #8b2252;">"width=device-width, initial-scale=1.0"</span>&gt;
    &lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Document</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
    &lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"{{url_for('static', filename='js/jquery-3.7.1.js')}}"</span>&gt;&lt;/<span style="color: #0000ff;">script</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;

&lt;<span style="color: #0000ff;">body</span>&gt;

    &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">'root'</span>&gt;&#36825;&#26159;&#26681;&#20803;&#32032;&lt;/<span style="color: #0000ff;">div</span>&gt;
    &lt;<span style="color: #0000ff;">hr</span>&gt;
    &lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"testajax"</span>&gt;&#27979;&#35797;ajax get&lt;/<span style="color: #0000ff;">button</span>&gt;
    &lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"testajaxpost"</span>&gt;&#27979;&#35797;ajax post&lt;/<span style="color: #0000ff;">button</span>&gt;

&lt;/<span style="color: #0000ff;">body</span>&gt;

&lt;/<span style="color: #0000ff;">html</span>&gt;
&lt;<span style="color: #0000ff;">script</span>&gt;
    $(function () {

        // $('button.testajax').click(function (event) {
        //     $.get("/books", { k1: "v1", k2: "v2", k2:"v3" }) // &#21464;&#25104;&#20102;query_string http://127.0.0.1:5000/books/?k1=v1<span style="color: #a0522d;">&amp;k2</span>=v3
        //         .done(function (data) { // 2xx
        //             console.log(data);
        //         });
        // })
        $('button.testajax').click(function (event) {
            $.get("http://localhost:5000/books/?k1=v1<span style="color: #a0522d;">&amp;k2</span>=v2<span style="color: #a0522d;">&amp;k2</span>=v3") // http://127.0.0.1:5000/books/?k1=v1<span style="color: #a0522d;">&amp;k2</span>=v2<span style="color: #a0522d;">&amp;k2</span>=v3
                .done(function (data) { // 2xx
                    console.log(data);
                });
        })
        $('button.testajaxpost').click(function (event) {
            $.post("http://localhost:5000/books/?k1=v1<span style="color: #a0522d;">&amp;k2</span>=v2<span style="color: #a0522d;">&amp;k2</span>=v3", {name:'John', age:20}) // application/x-www-form-urlencoded
                .done(function (data) { // 1xx
                    console.log(data);
                });
        })

    })
&lt;/<span style="color: #0000ff;">script</span>&gt;
</pre>
</div>
</div>
<div id="outline-container-h:e94cfd81-ca4c-4955-ab99-e54a8dd6b5dc" class="outline-4">
<h4 id="h:e94cfd81-ca4c-4955-ab99-e54a8dd6b5dc">跨域CORS</h4>
<div class="outline-text-4" id="text-h:e94cfd81-ca4c-4955-ab99-e54a8dd6b5dc">
<p>
Cross Origin Resource Sharing跨域资源共享，它是使用额外的HT「P头来告诉浏览器准许访问一个与当前所在origin(Domain) <b>不同源</b> 的服务器上特定的资源。
</p>

<p>
<b>不同源</b>: 指的是不同的协议，或不同域，或不同端口。
</p>

<p>
当浏览器从当前所在资源所在源，对不同源的资源发起HTTP请请求的时候，这个HTTP请求就是跨域HTTP请求。
</p>
</div>
</div>
<div id="outline-container-h:63a2e075-df2b-4f54-a102-43ea19c555e0" class="outline-4">
<h4 id="h:63a2e075-df2b-4f54-a102-43ea19c555e0">简单请求</h4>
<div class="outline-text-4" id="text-h:63a2e075-df2b-4f54-a102-43ea19c555e0">
<p>
简单请求:
</p>
<ol class="org-ol">
<li>如果请求方式是，GET、POST、HEAD三种方法之一</li>
<li>Content-Type是，text/plain、multipart/form-data、application/x-www-form-urlencoded(表单请求)三种值之一</li>
</ol>

<p>
简单请求解决方案比较简单，只需要在服务器端响应报文中增加一个首部。
</p>
</div>
</div>
<div id="outline-container-h:8f58767c-ecbb-414d-aaa8-95c4b40026bd" class="outline-4">
<h4 id="h:8f58767c-ecbb-414d-aaa8-95c4b40026bd">简单请求跨域解决</h4>
<div class="outline-text-4" id="text-h:8f58767c-ecbb-414d-aaa8-95c4b40026bd">
<p>
浏览器端请求报文中的首部发送字段Origin首部,服务器端响应首部增加Access-Control-Allow-Origin首部允许即可。
</p>

<p>
books.py
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#34013;&#22270;&#20013;&#20462;&#25913;&#22914;&#19979;
</span><span style="color: #228b22;">@books.route</span>(<span style="color: #8b2252;">'/'</span>, methods=[<span style="color: #8b2252;">'POST'</span>, <span style="color: #8b2252;">'GET'</span>])
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_all</span>():
    <span style="color: #a0522d;">d</span> = [
        (1, <span style="color: #8b2252;">'java'</span>, 20),
        (2, <span style="color: #8b2252;">'python'</span>, 30),
        (3, <span style="color: #8b2252;">'c++'</span>, 40),
    ]
    <span style="color: #a0522d;">r</span>:<span style="color: #228b22;">Request</span> = request
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> [
        r.method, r.query_string, r.args, r.path, r.form,
        r.is_json, r.data <span style="color: #b22222;"># </span><span style="color: #b22222;">request.data &#26159; b''
</span>    ]:
        <span style="color: #483d8b;">print</span>(x)

    <span style="color: #a0522d;">res</span>:<span style="color: #228b22;">Response</span> = jsonify(d)
    res.<span style="color: #a0522d;">headers</span>[<span style="color: #8b2252;">'Access-Control-Allow-Origin'</span>] = <span style="color: #8b2252;">'http://127.0.0.1:5000'</span>
    <span style="color: #a020f0;">return</span> res <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27983;&#35272;&#22120;&#36820;&#22238;json&#65292;&#21464;&#25104;&#22238;&#35843;&#20989;&#25968;&#30340;&#21442;&#25968;data</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">Access-Control-Allow-Origin: *&#24847;&#24605;&#26159;&#20160;&#20040;&#22495;&#37117;&#34987;&#20801;&#35768;;
Access-Control-Allow-origin: http://cici.com&#21482;&#20801;&#35768;&#25351;&#23450;&#22495;&#12290;
res.headers[<span style="color: #8b2252;">'Access-Control-Allow-Origin'</span>] = <span style="color: #8b2252;">'http://127.0.0.1:5000</span>
</pre>
</div>


<p>
发送的数据到了Flask中，使用request.form即可提取。
</p>
</div>
</div>
<div id="outline-container-h:4868b1aa-b0c2-4aeb-b585-3436d4ff58d8" class="outline-4">
<h4 id="h:4868b1aa-b0c2-4aeb-b585-3436d4ff58d8">预检请求</h4>
<div class="outline-text-4" id="text-h:4868b1aa-b0c2-4aeb-b585-3436d4ff58d8">
<p>
如果发送 <b>不是</b> 上面的请求，就是发送预检请求。
</p>

<p>
预检请求需要先使用OPTIONS方法先发送一个预检请求到服务端，看看服务器端是否允许该请求。
</p>
</div>
</div>
</div>
<div id="outline-container-h:e4497838-b727-4d26-b31e-d20ff49ea85f" class="outline-3">
<h3 id="h:e4497838-b727-4d26-b31e-d20ff49ea85f">POST请求跨域</h3>
<div class="outline-text-3" id="text-h:e4497838-b727-4d26-b31e-d20ff49ea85f">
</div>
<div id="outline-container-h:bff9d3d7-b489-4745-af61-cf58c4dbfb1e" class="outline-4">
<h4 id="h:bff9d3d7-b489-4745-af61-cf58c4dbfb1e">简单请求</h4>
<div class="outline-text-4" id="text-h:bff9d3d7-b489-4745-af61-cf58c4dbfb1e">
<p>
templates/index.html
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #0000ff;">html</span> <span style="color: #a0522d;">lang</span>=<span style="color: #8b2252;">"en"</span>&gt;

&lt;<span style="color: #0000ff;">head</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"viewport"</span> <span style="color: #a0522d;">content</span>=<span style="color: #8b2252;">"width=device-width, initial-scale=1.0"</span>&gt;
    &lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Document</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
    &lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"{{url_for('static', filename='js/jquery-3.7.1.js')}}"</span>&gt;&lt;/<span style="color: #0000ff;">script</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;

&lt;<span style="color: #0000ff;">body</span>&gt;

    &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">'root'</span>&gt;&#36825;&#26159;&#26681;&#20803;&#32032;&lt;/<span style="color: #0000ff;">div</span>&gt;
    &lt;<span style="color: #0000ff;">hr</span>&gt;
    &lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"testajax"</span>&gt;&#27979;&#35797;ajax get&lt;/<span style="color: #0000ff;">button</span>&gt;
    &lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"testajaxpost"</span>&gt;&#27979;&#35797;ajax post&lt;/<span style="color: #0000ff;">button</span>&gt;

&lt;/<span style="color: #0000ff;">body</span>&gt;

&lt;/<span style="color: #0000ff;">html</span>&gt;
&lt;<span style="color: #0000ff;">script</span>&gt;
    $(function () {

        // $('button.testajax').click(function (event) {
        //     $.get("/books", { k1: "v1", k2: "v2", k2:"v3" }) // &#21464;&#25104;&#20102;query_string http://127.0.0.1:5000/books/?k1=v1<span style="color: #a0522d;">&amp;k2</span>=v3
        //         .done(function (data) { // 2xx
        //             console.log(data);
        //         });
        // })
        $('button.testajax').click(function (event) {
            $.get("http://localhost:5000/books/?k1=v1<span style="color: #a0522d;">&amp;k2</span>=v2<span style="color: #a0522d;">&amp;k2</span>=v3") // http://127.0.0.1:5000/books/?k1=v1<span style="color: #a0522d;">&amp;k2</span>=v2<span style="color: #a0522d;">&amp;k2</span>=v3
                .done(function (data) { // 2xx
                    console.log(data);
                });
        })
        $('button.testajaxpost').click(function (event) {
            $.post("http://localhost:5000/books/?k1=v1<span style="color: #a0522d;">&amp;k2</span>=v2<span style="color: #a0522d;">&amp;k2</span>=v3", {name:'John', age:20}) // application/x-www-form-urlencoded
                .done(function (data) { // 1xx
                    console.log(data);
                });
        })

    })
&lt;/<span style="color: #0000ff;">script</span>&gt;
</pre>
</div>

<p>
状态码405，说明flask中视图函数的方法不支持POST，增加方法就可以了。@books.route('/', methods=['POST', 'GET'])
</p>

<p>
注意观察请求头，跨域访问依然是简单请求，所以请求头依旧是POST。依然需要
res.headers['Access-Control-Allow-Origin'] = '*'
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">webapps/books.py&#25991;&#20214;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#34013;&#22270;
</span><span style="color: #a020f0;">from</span> flask <span style="color: #a020f0;">import</span> Blueprint, jsonify, request, Request, Response

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#30456;&#24403;&#20110;&#36825;&#26159;&#19968;&#20010;&#24212;&#29992;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#21333;&#25351;&#23450;&#27169;&#26495;&#36335;&#24452;&#65292;&#22914;&#26524;&#26159;&#30456;&#23545;&#36335;&#24452;&#65292;&#21017;&#34920;&#31034;&#20174;&#39033;&#30446;&#26681;&#30446;&#24405;&#24320;&#22987;
</span><span style="color: #a0522d;">books</span> = Blueprint(<span style="color: #8b2252;">'books'</span>, <span style="color: #483d8b;">__name__</span>, template_folder=<span style="color: #8b2252;">'temp'</span>, url_prefix=<span style="color: #8b2252;">'/books'</span>)

<span style="color: #228b22;">@books.route</span>(<span style="color: #8b2252;">'/'</span>, methods=[<span style="color: #8b2252;">'POST'</span>, <span style="color: #8b2252;">'GET'</span>])
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_all</span>():
    <span style="color: #a0522d;">d</span> = [
        (1, <span style="color: #8b2252;">'java'</span>, 20),
        (2, <span style="color: #8b2252;">'python'</span>, 30),
        (3, <span style="color: #8b2252;">'c++'</span>, 40),
    ]
    <span style="color: #a0522d;">r</span>:<span style="color: #228b22;">Request</span> = request
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> [
        r.method, r.query_string, r.args, r.path, r.form,
        r.is_json, r.data <span style="color: #b22222;"># </span><span style="color: #b22222;">request.data &#26159; b''
</span>    ]:
        <span style="color: #483d8b;">print</span>(x)

    <span style="color: #a0522d;">res</span>:<span style="color: #228b22;">Response</span> = jsonify(d)
    res.<span style="color: #a0522d;">headers</span>[<span style="color: #8b2252;">'Access-Control-Allow-Origin'</span>] = <span style="color: #8b2252;">'*'</span>
    <span style="color: #a020f0;">return</span> res <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27983;&#35272;&#22120;&#36820;&#22238;json&#65292;&#21464;&#25104;&#22238;&#35843;&#20989;&#25968;&#30340;&#21442;&#25968;data
</span>
<span style="color: #228b22;">@books.route</span>(<span style="color: #8b2252;">'/bookinfo'</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_book_info</span>():
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> [books.root_path, books.static_folder, books.static_url_path,
        books.template_folder, books.name, books.url_prefix
    ]:
        <span style="color: #483d8b;">print</span>(x)
    <span style="color: #483d8b;">print</span>()
    <span style="color: #a020f0;">return</span> jsonify({<span style="color: #8b2252;">'a'</span>:<span style="color: #8b2252;">'ok'</span>})
</pre>
</div>

<p>
发送的数据到了flask中，使用request.form即可提取。
</p>
</div>
</div>
<div id="outline-container-h:dfc7ddf9-e2b6-4218-ae84-2ade56c48aa7" class="outline-4">
<h4 id="h:dfc7ddf9-e2b6-4218-ae84-2ade56c48aa7">预检请求</h4>
<div class="outline-text-4" id="text-h:dfc7ddf9-e2b6-4218-ae84-2ade56c48aa7">
<p>
POST请求提交JSON数据
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #0000ff;">html</span> <span style="color: #a0522d;">lang</span>=<span style="color: #8b2252;">"en"</span>&gt;

&lt;<span style="color: #0000ff;">head</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"viewport"</span> <span style="color: #a0522d;">content</span>=<span style="color: #8b2252;">"width=device-width, initial-scale=1.0"</span>&gt;
    &lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Document</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
    &lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"{{url_for('static', filename='js/jquery-3.7.1.js')}}"</span>&gt;&lt;/<span style="color: #0000ff;">script</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;

&lt;<span style="color: #0000ff;">body</span>&gt;

    &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">'root'</span>&gt;&#36825;&#26159;&#26681;&#20803;&#32032;&lt;/<span style="color: #0000ff;">div</span>&gt;
    &lt;<span style="color: #0000ff;">hr</span>&gt;
    &lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"testajax"</span>&gt;&#27979;&#35797;ajax get&lt;/<span style="color: #0000ff;">button</span>&gt;
    &lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"testajaxpost"</span>&gt;&#27979;&#35797;ajax post&lt;/<span style="color: #0000ff;">button</span>&gt;
    &lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"testajaxpostjson"</span>&gt;&#27979;&#35797;ajax post json&lt;/<span style="color: #0000ff;">button</span>&gt;

&lt;/<span style="color: #0000ff;">body</span>&gt;

&lt;/<span style="color: #0000ff;">html</span>&gt;
&lt;<span style="color: #0000ff;">script</span>&gt;
    $(function () {

        // $('button.testajax').click(function (event) {
        //     $.get("/books", { k1: "v1", k2: "v2", k2:"v3" }) // &#21464;&#25104;&#20102;query_string http://127.0.0.1:5000/books/?k1=v1<span style="color: #a0522d;">&amp;k2</span>=v3
        //         .done(function (data) { // 2xx
        //             console.log(data);
        //         });
        // })
        $('button.testajax').click(function (event) {
            $.get("http://localhost:5000/books/?k1=v1<span style="color: #a0522d;">&amp;k2</span>=v2<span style="color: #a0522d;">&amp;k2</span>=v3") // http://127.0.0.1:5000/books/?k1=v1<span style="color: #a0522d;">&amp;k2</span>=v2<span style="color: #a0522d;">&amp;k2</span>=v3
                .done(function (data) { // 2xx
                    console.log(data);
                });
        })

        $('button.testajaxpost').click(function (event) {
            $.post("http://localhost:5000/books/?k1=v1<span style="color: #a0522d;">&amp;k2</span>=v2<span style="color: #a0522d;">&amp;k2</span>=v3", { name: 'John', age: 20 }) // application/x-www-form-urlencoded
                .done(function (data) { // 1xx
                    console.log(data);
                });
        })

        $('button.testajaxpostjson').click(function (event) {
            $.ajax({
                type: "POST",
                url: 'http://localhost:5000/books/?k1=v1<span style="color: #a0522d;">&amp;k2</span>=v2<span style="color: #a0522d;">&amp;k2</span>=v3',
                contentType: 'application/json',
                data: { name: 'John', age: 30 },
                success: function (msg){
                    console.log(msg)
                }
            });
        })
    })
&lt;/<span style="color: #0000ff;">script</span>&gt;
</pre>
</div>

<p>
访问 <a href="http://127.0.0.1:5000/t">http://127.0.0.1:5000/t</a>
</p>

<p>
直接点击Ajax POST请求提交Json数据按钮，在浏览器控制台出现CORS错误。
</p>

<p>
在jQuery官方有这么一句
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #0000ff;">contentType</span> (default: <span style="color: #8b2252;">'application/x-www-form-urlencoded; charseet=UTF-8
Type: Boolean or String
When sending data to the server, use this content type. Default is"application/x-www-form
urlencoded; charset=UTF-8", which is fine for most cases. If you eexplicitly pass in a content-type to
$. aj ax (), then it is always sent to the server (even if no data is sentof jQuery 1.6 you can
pass false to tell jQuery to not set any content type header. Note: TheW3C XMLHttp Request
specification dictates that the charset is always UTF-8; specifyinganother charset will not force the
browser to change the encoding. Note: For cross-domain requests, setting the content type to
anything other than application/x-www-form-urlencoded, multipart/form-data, Or text/plain
will trigger the browser to send a preflight OPTIONS request to the serveer.</span>
</pre>
</div>

<p>
也就是说跨域访问如果设置不是这3种Content-Type，也就是不是简单请求，那么会触发preflight OPTIONS请求(预检请求)。
</p>

<p>
请求头如下
</p>
<div class="org-src-container">
<pre class="src src-sh">OPTIONS /books/?<span style="color: #a0522d;">k1</span>=v1&amp;<span style="color: #a0522d;">k2</span>=v2%&amp;<span style="color: #a0522d;">k2</span>=v3 HTTP/1.1
Host: localhost: 5000
Connection: keep-alive
Access-Control-Request-Method: POST
Origin: http://127.0.0.1:5000
X-DevTools-Emulate-Network-Conditions-Client-:Id: a7899476-5a03-4a5e-b588-
f8e1118e6d14
User-Agent: Mozilla/5.0 (windows NT 6.1) Applewebkit)/537.36 (KHTML, like Gecko)Maxthon/5.0 Chrome/55.0.2883.75 Safari/537.36
Access-Control-Request-Headers: content-type
Accept: */*
DNT: 1
Referer: http://127.0.0.1:5000/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN
</pre>
</div>

<p>
解决方案
</p>
<ol class="org-ol">
<li>不跨域，使用同域来访问网页即可</li>
<li>修改视图函数，增加OPTIONS方法支持，并返回相应的访问空制头</li>
</ol>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">webapps/books.py&#25991;&#20214;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#34013;&#22270;
</span><span style="color: #a020f0;">from</span> flask <span style="color: #a020f0;">import</span> Blueprint, jsonify, request, Request, Response

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#30456;&#24403;&#20110;&#36825;&#26159;&#19968;&#20010;&#24212;&#29992;
</span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#20197;&#21333;&#25351;&#23450;&#27169;&#26495;&#36335;&#24452;&#65292;&#22914;&#26524;&#26159;&#30456;&#23545;&#36335;&#24452;&#65292;&#21017;&#34920;&#31034;&#20174;&#39033;&#30446;&#26681;&#30446;&#24405;&#24320;&#22987;
</span><span style="color: #a0522d;">books</span> = Blueprint(<span style="color: #8b2252;">'books'</span>, <span style="color: #483d8b;">__name__</span>, template_folder=<span style="color: #8b2252;">'temp'</span>, url_prefix=<span style="color: #8b2252;">'/books'</span>)

<span style="color: #228b22;">@books.route</span>(<span style="color: #8b2252;">'/'</span>, methods=[<span style="color: #8b2252;">'POST'</span>, <span style="color: #8b2252;">'GET'</span>, <span style="color: #8b2252;">'OPTIONS'</span>])
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_all</span>():
    <span style="color: #a0522d;">d</span> = [
        (1, <span style="color: #8b2252;">'java'</span>, 20),
        (2, <span style="color: #8b2252;">'python'</span>, 30),
        (3, <span style="color: #8b2252;">'c++'</span>, 40),
    ]
    <span style="color: #a0522d;">r</span>:<span style="color: #228b22;">Request</span> = request
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> [
        r.method, r.query_string, r.args, r.path, r.form,
        r.is_json, r.data <span style="color: #b22222;"># </span><span style="color: #b22222;">request.data &#26159; b''
</span>    ]:
        <span style="color: #483d8b;">print</span>(x)

    <span style="color: #a0522d;">res</span>:<span style="color: #228b22;">Response</span> = jsonify(d)
    res.<span style="color: #a0522d;">headers</span>[<span style="color: #8b2252;">'Access-Control-Allow-Origin'</span>] = <span style="color: #8b2252;">'*'</span>
    res.<span style="color: #a0522d;">headers</span>[<span style="color: #8b2252;">'Access-Control-Allow-Headers'</span>] = <span style="color: #8b2252;">'Content-Type'</span>
    <span style="color: #a020f0;">if</span> r.is_json:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span>*30)
        <span style="color: #a020f0;">try</span>:
            <span style="color: #483d8b;">print</span>(r.json)
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            <span style="color: #483d8b;">print</span>(e, <span style="color: #8b2252;">'+++++'</span>)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span>*30)
    <span style="color: #a020f0;">return</span> res <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27983;&#35272;&#22120;&#36820;&#22238;json&#65292;&#21464;&#25104;&#22238;&#35843;&#20989;&#25968;&#30340;&#21442;&#25968;data
</span>
<span style="color: #228b22;">@books.route</span>(<span style="color: #8b2252;">'/bookinfo'</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_book_info</span>():
    <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> [books.root_path, books.static_folder, books.static_url_path,
        books.template_folder, books.name, books.url_prefix
    ]:
        <span style="color: #483d8b;">print</span>(x)
    <span style="color: #483d8b;">print</span>()
    <span style="color: #a020f0;">return</span> jsonify({<span style="color: #8b2252;">'a'</span>:<span style="color: #8b2252;">'ok'</span>})
</pre>
</div>

<p>
跨域访问成功了，注意是2次HTTP请求，第一次就是提起预检请求OPTIONS方法，如果对方允许，才发起第二次POST请求。
</p>
</div>
</div>
<div id="outline-container-h:50c1305a-91ec-4a18-8c04-b9e52ec4a96a" class="outline-4">
<h4 id="h:50c1305a-91ec-4a18-8c04-b9e52ec4a96a">Json数据处理</h4>
<div class="outline-text-4" id="text-h:50c1305a-91ec-4a18-8c04-b9e52ec4a96a">
<p>
服务器端并没有成功的解析出json数据，观察发现发过来的数据不是json。
</p>

<div class="org-src-container">
<pre class="src src-html">$('button.testajaxpostjson').click(function (event) {
    $.ajax({
        type: "POST",
        url: 'http://localhost:5000/books/?k1=v1<span style="color: #a0522d;">&amp;k2</span>=v2<span style="color: #a0522d;">&amp;k2</span>=v3',
        contentType: 'application/json',
        data: JSON.stringify({ name: 'John', age: 30 }),
        success: function (msg){
            console.log(msg)
        }
    });
})
</pre>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-h:84dc065d-d5ab-4be8-91de-04566003412d" class="outline-2">
<h2 id="h:84dc065d-d5ab-4be8-91de-04566003412d">其他</h2>
<div class="outline-text-2" id="text-h:84dc065d-d5ab-4be8-91de-04566003412d">
</div>
<div id="outline-container-h:e5cd9bd4-e10f-417a-96ff-706335cce305" class="outline-3">
<h3 id="h:e5cd9bd4-e10f-417a-96ff-706335cce305">jsonp</h3>
<div class="outline-text-3" id="text-h:e5cd9bd4-e10f-417a-96ff-706335cce305">
<p>
使用XHR不能跨域，前面实验看到了，除非做跨域的处理或者preflight等。
</p>

<p>
但是&lt;script&gt;等标签可以使用 <b>不同域</b> 的文件。
</p>

<p>
为了便于客户端使用数据，逐渐形成了一种非正式传输协议，人们把它称作JSONP，该协议的一个要点就是允许用户传递一个callback参数给服务端，然后服务端返回数据时会将这个callback参数作为函数名来包裹住JSON数据，这样客户端就可以随意定制自己的函数来自动处理返回数据了。
</p>

<p>
使用nginx
</p>

<p>
站点主目录中部署index.html和a.js
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #0000ff;">html</span> <span style="color: #a0522d;">lang</span>=<span style="color: #8b2252;">"en"</span>&gt;
&lt;<span style="color: #0000ff;">head</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"viewport"</span> <span style="color: #a0522d;">content</span>=<span style="color: #8b2252;">"width=device-width, initial-scale=1.0"</span>&gt;
    &lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">cici</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
    &lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"a.js"</span>&gt;&lt;/<span style="color: #0000ff;">script</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;
&lt;<span style="color: #0000ff;">body</span>&gt;

&lt;/<span style="color: #0000ff;">body</span>&gt;
&lt;/<span style="color: #0000ff;">html</span>&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">//</span><span style="color: #b22222;">a.js&#25991;&#20214;&#20013;&#20889;&#19979;&#38754;&#35821;&#21477;
</span>alert(<span style="color: #8b2252;">'test js'</span>);
</pre>
</div>

<p>
这种访问没有跨域问题，注意script标签发起一个新的http连接请求js文件
</p>

<p>
现在把a.js部署到另一个域，修改index.html
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">'http://node1.cici.com/a.js'</span>&gt;&lt;/<span style="color: #0000ff;">script</span>&gt;
</pre>
</div>

<p>
依然可以访问，没有任何问题。但是XHR跨域就需要一些处理了。
</p>

<p>
修改index.html
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #0000ff;">script</span>&gt;
function jsonpcallback(data){/&#26412;&#22320;&#20989;&#25968;
console.log('&#36820;&#22238;&#22788;&#29702;&#30340;&#25968;&#25454;');
console.log(data);
&lt;/<span style="color: #0000ff;">script</span>&gt;
&lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">'http://node1.cici.com/a.js?callback=jsonpcallback'</span>&gt;&lt;/<span style="color: #0000ff;">script</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;
&lt;<span style="color: #0000ff;">body</span>&gt;
&lt;<span style="color: #0000ff;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Welcome to Jsonp</span>&lt;/<span style="color: #0000ff;">h1</span>&gt;
&lt;/<span style="color: #0000ff;">body</span>&gt;
&lt;/<span style="color: #0000ff;">html</span>&gt;
</pre>
</div>

<p>
&lt;script src='http://node1.cici.com/a.js?callback=jsonpcallback'&gt;&lt;/script&gt;告诉服务器端,返回的函数名是什么
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">// </span><span style="color: #b22222;">a.js
</span><span style="color: #b22222;">// </span><span style="color: #b22222;">jsonpcallback
</span>jsonpcallback({a:100, b:<span style="color: #8b2252;">"abc"</span>})
</pre>
</div>

<p>
这样就解决了Ajax跨域访问的问题了。
</p>

<p>
把上例中的约定回调函数、增加script标签访问其他域的代码抽出来，就可以更加灵活的使用了。
</p>

<p>
jQuery的Ajax就提供了这样的处理方式。
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #0000ff;">html</span> <span style="color: #a0522d;">lang</span>=<span style="color: #8b2252;">"en"</span>&gt;

&lt;<span style="color: #0000ff;">head</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"viewport"</span> <span style="color: #a0522d;">content</span>=<span style="color: #8b2252;">"width=device-width, initial-scale=1.0"</span>&gt;
    &lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">cici</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
    &lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"jquery.min.js"</span>&gt;&lt;/<span style="color: #0000ff;">script</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;

&lt;<span style="color: #0000ff;">body</span>&gt;
&lt;/<span style="color: #0000ff;">body</span>&gt;

&lt;/<span style="color: #0000ff;">html</span>&gt;
&lt;<span style="color: #0000ff;">script</span>&gt;
    // function test(data){
    //     sucess(data)
    // }

    $(function () {
        $.ajax({
            type: "GET",
            url: 'http://node1.cici.com/a.js',
            dataType: 'jsonp', // ?callback=xxx.randomnumber
            //jsonp&#22312;jQuery&#20013;&#40664;&#35748;&#24418;&#24335;&#20026;http://nodel.cici.com/a.js6?callback=jQuery&#38543;&#26426;&#25968;
            jsonpCallback: 'jsonpcallback', //&#25351;&#23450;&#36820;&#22238;&#21518;&#35843;&#29992;&#30340;&#20989;&#25968;&#25968;&#21517; ?callback=test
            // jsonp: 'cb',//&#20462;&#25913;&#21442;&#25968;&#21517;callback &#20026; ?cb=jsonpcallback  =&gt; jsonpcallback({a:1, b:['abc', 'xyz']})
            success: function (data) { // &#25343;&#22238;&#30340;&#25968;&#25454;&#20877;&#20256;&#36882;&#32473;&#25104;&#21151;&#22238;&#35843;&#20351;&#29992;
                console.log(data)
            }
        });
        console.log('-'.repeat(30))
    });
&lt;/<span style="color: #0000ff;">script</span>&gt;
</pre>
</div>

<p>
注意:Jsonp <b>只能使用GET方法</b> ，因为它内部使用了script标签的src发起http请求，这不能是POST方法的请求。
</p>

<p>
Ajax使用XHR组件通信，出于安全，一般要求同源策略。
</p>

<p>
JSONP实际上是网页内部动态增加了script标签，并利用了使用src引用静态资源时不受跨域限制的机制。事先写好一个回调函数放在网页中，并在发起HTTP请求时，将回调函数名告知服务器端。服务器端使用这个回调函数名，按照JavaScript语法把数据放在回调函数中。然后将这些内容作为脚本的内容返回浏览器端，浏览器端就可以运行该脚本。jQuery提供了JSONF语法糖，简化了操作。
</p>
</div>
</div>
<div id="outline-container-h:2bb43c30-a4bb-4722-ba6c-0a6013fb0b0a" class="outline-3">
<h3 id="h:2bb43c30-a4bb-4722-ba6c-0a6013fb0b0a">Django静态配置</h3>
<div class="outline-text-3" id="text-h:2bb43c30-a4bb-4722-ba6c-0a6013fb0b0a">
<p>
Django的静态文件配置，如下
1、settings中INSTALLED_APPS确保有django.contrib.staticfiles
</p>

<p>
2、settings中定义静态路径,STATIC_URL='<i>static</i>
</p>

<p>
3、settings中定义
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #a0522d;">STATICFILES_DIRS</span> = [
<span style="color: #0000ff;">os.path.join</span>(BASE_DIR, <span style="color: #8b2252;">"static"</span>),
]
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b34b302c-ea58-4c61-9a10-1724d2e431d9" class="outline-3">
<h3 id="h:b34b302c-ea58-4c61-9a10-1724d2e431d9">练习</h3>
<div class="outline-text-3" id="text-h:b34b302c-ea58-4c61-9a10-1724d2e431d9">
<p>
Ajax方式提交GET方法，从服务器查回数据，使用表格显示,要求使用JS对表格进行动态追加。
</p>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>打赏</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>© 2025 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
<!--
<script type="text/javascript" src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/bootstrap@5.2.1/dist/js/bootstrap.min.js"></script>
<div id="back-to-top" class=""><svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg></div>
-->
</div>
</body>
</html>
