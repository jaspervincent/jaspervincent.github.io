<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Python: Pythoné«˜å¹¶å‘ç¼–ç¨‹</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/font.css"/>
<link rel="stylesheet" type="text/css" href="/static/drollery.e825b870.css"/>
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
</head>
<body>
<header id="preamble" class="status">
<header class="{className}" data-astro-cid-3ef6ksr2>
  <div class=header-branding data-astro-cid-g2lrb5xm>
      <span class=header-text data-astro-cid-g2lrb5xm>
          <span class=dropcap data-astro-cid-g2lrb5xm aria-hidden=true>
              <span class=actual data-astro-cid-g2lrb5xm>J</span>
              <span class=rest data-astro-cid-g2lrb5xm>asper Hsu</span>
              <span class=period data-astro-cid-g2lrb5xm>.</span>
          </span>
          <span class=sr-only data-astro-cid-g2lrb5xm>Drollery</span>
      </span>
      <img alt="Medieval drollery of a knight on a horse" class=spring decoding=async height=250 loading=lazy src=/images/knight-horse.a96eee7d_Z1WCOYs.webp width=68 data-astro-cid-g2lrb5xm>
  </div>

  <nav data-astro-cid-pux6a34n>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/jcodelog.html class=nobracket data-astro-cid-pux6a34n>æŠ€æœ¯</a>
      <span class=flower2 data-astro-cid-pux6a34n>K</span>
      <a href=/reading/index.html class=nobracket data-astro-cid-pux6a34n>é˜…è¯»</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
      <a href=/archives.html class=nobracket data-astro-cid-pux6a34n>å½’æ¡£</a>
      <span class=flower2 data-astro-cid-pux6a34n>L</span>
      <a href=/link/index.html class=nobracket data-astro-cid-pux6a34n>å‹é“¾</a>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/about.html class=nobracket data-astro-cid-pux6a34n>å…³äº</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
  </nav>


  <div class="container" data-astro-cid-3ef6ksr2>
    <p class="info" data-astro-cid-3ef6ksr2>
              ğŸ† æ¬¢è¿æ¥åˆ°æœ¬ç«™ï¼š
              <a href="https://xuchangwei.com/">https://xuchangwei.com/</a>ã€‚
              <strong>å¸Œæœ›è¿™é‡Œæœ‰ä½ æ„Ÿå…´è¶£çš„å†…å®¹</strong>ã€‚
            </p>
  </div>
  <div id=borderArtWrapper class="tt1" data-astro-cid-5hce7sga data-turbo-permanent>
      <script>
          var man, shakeCount = 0, noSound = new Audio("/audio/effects/no.m4a"), screamSound = new Audio("/audio/effects/scream.m4a");
          function animateManShakeHandler() {
              man.removeEventListener("animationend", animateManShakeHandler, !1),
              shakeCount += 1,
              man.classList.remove("shakeMan")
          }
          function animateManFallHandler() {
              man.removeEventListener("animationend", animateManFallHandler, !1),
              man.classList.add("hide")
          }
          function animateMan() {
              man = man ?? document.getElementById("borderMan"),
              3 === shakeCount ? (man.classList.add("fallMan"),
              screamSound.play(),
              man.addEventListener("animationend", animateManFallHandler, !1)) : (man.classList.add("shakeMan"),
              noSound.play(),
              man.addEventListener("animationend", animateManShakeHandler, !1))
          }
      </script>
      <div class=borderArt data-astro-cid-5dda5nwp id=articleBorder>
          <img alt="flowery border with man falling" decoding=async height=620 loading=lazy src=/images/border-vines-no-man.b7d246cc_DRxSe.webp width=909 class=border data-astro-cid-5dda5nwp>
          <div class=fallWrapper data-astro-cid-5dda5nwp>
              <img alt="flowery border with man falling" decoding=async height=292 loading=lazy src=/images/man-no-vines.247a3187_Z2ioXNM.webp width=98 class=man data-astro-cid-5dda5nwp id=borderMan onclick=animateMan()>
          </div>
      </div>
  </div>
</header>
</header>
<main class="container" id="content" class="content">
<header>
<h1 class="title">Python: Pythoné«˜å¹¶å‘ç¼–ç¨‹</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:4b7cff18-1ffe-4d0e-8916-2048cea719b9">å¹¶å‘</a>
<ul>
<li><a href="#h:3f5a0c6f-ada5-419f-8a5c-b88b0589dd5c">å¹¶å‘å’Œå¹¶è¡ŒåŒºåˆ«</a></li>
<li><a href="#h:d4d26198-5d21-4de1-a346-76be0951c2f1">å¹¶å‘çš„è§£å†³</a></li>
<li><a href="#h:e6ff6761-9525-48c7-8be7-36105a92efa4">1ã€é˜Ÿåˆ—ã€ç¼“å†²åŒº</a></li>
<li><a href="#h:53a4f241-3feb-4720-b4f6-5b83147c6ff6">2ã€äº‰æŠ¢</a></li>
<li><a href="#h:c86d06a7-1014-4bb0-be6f-09e470e3c180">3ã€é¢„å¤„ç†</a></li>
<li><a href="#h:8784c5a6-6e22-46d3-8243-f432cff3b9f2">4ã€å¹¶è¡Œ</a></li>
<li><a href="#h:a3a8cc66-6686-42cc-af85-0c4c016f36cf">5ã€æé€Ÿ</a></li>
<li><a href="#h:5f7fb109-95eb-4e05-8f29-7df559eef9ef">6ã€æ¶ˆæ¯ä¸­é—´ä»¶</a></li>
</ul>
</li>
<li><a href="#h:b1f85b48-cfde-4f2f-a587-3e03270d747d">queueæ¨¡å—&#x2013;é˜Ÿåˆ—</a>
<ul>
<li><a href="#h:3ca3c81b-793f-4246-8ddc-f68b41e13775">Queue</a></li>
<li><a href="#h:6deda1e1-7062-4cc3-93de-655062e54483">LifoQueue</a></li>
<li><a href="#h:7b1be691-775f-4341-b9a3-53730cb8f3cd">PriorityQueue</a></li>
</ul>
</li>
<li><a href="#h:54394495-56ac-49b0-8c9b-9091b8c3f907">çº¿ç¨‹</a>
<ul>
<li><a href="#h:da5b7806-7a9d-4232-9154-c00fa6dddf77">è¿›ç¨‹å’Œçº¿ç¨‹</a>
<ul>
<li><a href="#h:b1200606-8276-4937-b0e2-26aa2af21f70">è¿›ç¨‹ã€çº¿ç¨‹çš„ç†è§£</a></li>
<li><a href="#h:70734629-45fc-4d81-b1f3-b06d9ea3e08d">çº¿ç¨‹çš„çŠ¶æ€</a></li>
<li><a href="#h:03d53f0a-fbd9-4182-8758-3cd5af8d7d23">Pythonä¸­çš„è¿›ç¨‹å’Œçº¿ç¨‹</a></li>
</ul>
</li>
<li><a href="#h:d96cf474-80f1-46b2-a0f2-7b293dabf1a7">Pythonçš„çº¿ç¨‹å¼€å‘</a>
<ul>
<li><a href="#h:0280394c-3e47-46db-a401-e5fa67803d48">Threadç±»</a>
<ul>
<li><a href="#h:484ab488-8416-48ee-970e-0efa85f0472a">çº¿ç¨‹å¯åŠ¨</a></li>
<li><a href="#h:47d76164-0f32-44e9-9836-0c88eee3b25c">çº¿ç¨‹é€€å‡º</a></li>
<li><a href="#h:0815293a-7ab2-4d56-a260-de2fe52a9c57">çº¿ç¨‹ä¼ å‚</a></li>
<li><a href="#h:a937c085-ab52-4083-a56d-3d8207a56f86">threadingçš„å±æ€§å’Œæ–¹æ³•</a></li>
<li><a href="#h:fd554e60-2251-46ce-af33-42f12cb87336">Threadå®ä¾‹çš„å±æ€§å’Œæ–¹æ³•</a></li>
</ul>
</li>
<li><a href="#h:fe6e5200-c810-4ebc-8944-8f64f954bfb9">å¤šçº¿ç¨‹</a></li>
<li><a href="#h:17f041eb-2065-4f5a-80c3-e839c2a4564e">daemonçº¿ç¨‹å’Œnon-daemonçº¿ç¨‹</a></li>
<li><a href="#h:d5d7c611-941c-4e80-83cd-b015c799198f">joinæ–¹æ³•</a></li>
<li><a href="#h:7470c0eb-377d-4bfb-a9f1-394440264462">daemonçº¿ç¨‹åº”ç”¨åœºæ™¯</a></li>
</ul>
</li>
<li><a href="#h:1c3888c8-3158-446f-b826-ad6b17d80dc5">threading.localç±»</a></li>
</ul>
</li>
<li><a href="#h:7858a7f9-54f8-4340-9971-7960bc7b7cbe">çº¿ç¨‹åŒæ­¥</a>
<ul>
<li><a href="#h:0fc3d129-cb2d-4552-a23f-bc84812e6bb2">æ¦‚å¿µ</a></li>
<li><a href="#h:7559fa45-c9ab-4dcd-86c5-c10f97a87c14">Event***</a>
<ul>
<li><a href="#h:020e5e30-c1e3-4a48-9c2f-b38b5333a142">ç»ƒä¹ </a></li>
<li><a href="#h:b47efafe-b4bb-436c-a571-aaf31e002259">æ€»ç»“</a></li>
<li><a href="#h:110966fe-7b86-45be-95fb-130b940e0fc3">waitçš„ä½¿ç”¨</a></li>
<li><a href="#h:fbd12a9a-6881-4faa-ba4c-10b5e484d399">å®šæ—¶å™¨ Timer/å»¶è¿Ÿæ‰§è¡Œ</a></li>
</ul>
</li>
<li><a href="#h:3623e19d-a7e2-4cce-b425-aa5f3992cfdc">Lock***</a>
<ul>
<li><a href="#h:6436f3b0-82ed-46c6-97f3-4f14699f8816">ç»ƒä¹ </a></li>
<li><a href="#h:2a04bc2f-514b-4b3b-8860-23fe5eb650fe">åŠ é”ã€è§£é”</a></li>
<li><a href="#h:afacce3f-4f6d-4260-a5b1-1c0bdadbe0a9">é”çš„åº”ç”¨åœºæ™¯</a></li>
<li><a href="#h:49d04d89-0692-4a32-a23f-be635c989c10">éé˜»å¡é”ä½¿ç”¨</a></li>
</ul>
</li>
<li><a href="#h:5a518f40-3c35-416e-b452-0a95f2f294ab">å¯é‡å…¥é”RLock</a></li>
<li><a href="#h:e8ad5263-5245-49ba-b9e6-2ae97f4dd478">Condition</a></li>
<li><a href="#h:1372e12c-5419-4dad-af6c-a9c7ed2e749d">semaphoreä¿¡å·é‡</a>
<ul>
<li><a href="#h:d9bff5d6-b452-4bf2-9ec5-9d3aca8c0850">releaseæ–¹æ³•è¶…ç•Œé—®é¢˜</a></li>
</ul>
</li>
<li><a href="#h:a29d1497-9ab7-4367-8eda-8473e71c53fe">BoundedSemaphoreç±»</a></li>
<li><a href="#h:55bd30b1-c864-40ac-b076-754adce345b7">åº”ç”¨ä¸¾ä¾‹</a></li>
<li><a href="#h:fce456b1-0bca-4620-b27d-04d79f16118f">é—®é¢˜</a>
<ul>
<li><a href="#h:8dbf3134-ac8b-4581-8b66-1dfd6c7017cf">1ã€è¾¹ç•Œé—®é¢˜åˆ†æ</a></li>
<li><a href="#h:4bc251f2-7f15-4404-a5cc-4858c4484545">2ã€æ­£å¸¸ä½¿ç”¨åˆ†æ</a></li>
</ul>
</li>
<li><a href="#h:73137cd7-fd42-408e-a4ec-e8fbaaabcf88">ä¿¡å·é‡å’Œé”</a></li>
<li><a href="#h:bbcab601-a08c-447f-9b11-c44c891cced1">Queueçš„çº¿ç¨‹å®‰å…¨</a></li>
</ul>
</li>
<li><a href="#h:eb43234c-dbde-405c-a13c-f0310203a8da">GILå…¨å±€è§£é‡Šå™¨é”</a></li>
<li><a href="#h:f4b8b789-b110-477c-bf1e-9abdc639b837">å¤šè¿›ç¨‹</a>
<ul>
<li><a href="#h:1bd07f42-95dd-4826-bb5f-31e417dbfb1d">å¤šè¿›ç¨‹</a>
<ul>
<li><a href="#h:46ca9d23-b3ec-4023-aa68-b051d11b7d5d">multiprocessing</a>
<ul>
<li><a href="#h:07b702c2-8bd1-4d00-8584-26e3d8ce39af">Processç±»</a></li>
</ul>
</li>
<li><a href="#h:3585d1d7-7143-4159-95ab-4a82e32db1d9">è¿›ç¨‹é—´åŒæ­¥</a></li>
<li><a href="#h:f49a5ff1-4b19-4fd7-b083-96f58234d4d0">è¿›ç¨‹æ± ä¸¾ä¾‹</a></li>
<li><a href="#h:990dc2ac-90d9-410c-8c60-d3c3205f0886">å¤šè¿›ç¨‹ã€å¤šçº¿ç¨‹çš„é€‰æ‹©</a>
<ul>
<li><a href="#h:4a230ff1-36bf-42ee-ac3d-1d76e3633b19">åº”ç”¨</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:b21f750f-34a4-409d-8b78-c2ef1591ba41">Linuxçš„ç‰¹æ®Šè¿›ç¨‹</a>
<ul>
<li><a href="#h:5be0308a-8e9a-4292-87bc-37dd75458fe6">åƒµå°¸è¿›ç¨‹</a></li>
<li><a href="#h:405524b1-b8da-4cc0-acae-757594a86989">å­¤å„¿è¿›ç¨‹</a></li>
<li><a href="#h:ee05aa27-3ee5-4519-8e42-1ddfc669cf1a">å®ˆæŠ¤è¿›ç¨‹</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:a205ae9f-e7aa-4e6e-be24-23a387b35140">concurrentåŒ…ï¼ˆå¼‚æ­¥å¹¶è¡Œä»»åŠ¡ç¼–ç¨‹æ¨¡å—ï¼‰</a>
<ul>
<li><a href="#h:66c691a6-1da9-47c6-8e13-3712e734b9c2">concurrent.futuresåŒ…</a>
<ul>
<li><a href="#h:5c637564-d745-498f-87ab-74079d5cb582">ThreadPoolExecutorå¯¹è±¡</a></li>
<li><a href="#h:33a732a2-b3c8-44d9-9fbd-27f669ffc8f6">ProcessPoolExecutorå¯¹è±¡</a></li>
<li><a href="#h:7d9a2214-9d22-4c7e-a28e-2a5882065f7c">æ”¯æŒä¸Šä¸‹æ–‡ç®¡ç†</a></li>
<li><a href="#h:c035ffe3-5512-4681-830a-54af10231f88">æ€»ç»“</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../../index.html">Python</a></li>
</ul>


<p>
Python å¤šè¿›ç¨‹ä¸çº¿ç¨‹é«˜å¹¶å‘ç¼–ç¨‹
</p>

<p>
ä¸»è¦å†…å®¹ï¼š
</p>
<ul class="org-ul">
<li>ç†è§£è¿›ç¨‹ä¸çº¿ç¨‹</li>
<li>åˆ›å»ºå¤šçº¿ç¨‹</li>
<li>çº¿ç¨‹çš„å±æ€§</li>
<li>åå°çº¿ç¨‹</li>
<li>äº‹ä»¶ Event</li>
<li>çº¿ç¨‹é”ã€åŠ é”ã€è§£é”ç­–ç•¥</li>
<li>å¯é‡å…¥é”</li>
<li>Condition å’Œ ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹</li>
<li>ä¿¡å·é‡é€šä¿¡ Semaphore</li>
<li>åˆ›å»ºè¿›ç¨‹å’Œæ± </li>
<li>åƒµå°¸è¿›ç¨‹ã€å­¤å„¿è¿›ç¨‹å’Œå®ˆæŠ¤è¿›ç¨‹</li>
<li>é«˜çº§çº¿ç¨‹æ± ã€è¿›ç¨‹æ± å¼‚æ­¥åº“</li>
<li>GILå…¨å±€è§£é‡Šå™¨é”åŸç†</li>
<li>å¤šè¿›ç¨‹ã€å¤šçº¿ç¨‹åº”ç”¨åœºæ™¯</li>
</ul>
<section id="outline-container-h:4b7cff18-1ffe-4d0e-8916-2048cea719b9" class="outline-2">
<h2 id="h:4b7cff18-1ffe-4d0e-8916-2048cea719b9">å¹¶å‘</h2>
<div class="outline-text-2" id="text-h:4b7cff18-1ffe-4d0e-8916-2048cea719b9">
</div>
<div id="outline-container-h:3f5a0c6f-ada5-419f-8a5c-b88b0589dd5c" class="outline-3">
<h3 id="h:3f5a0c6f-ada5-419f-8a5c-b88b0589dd5c">å¹¶å‘å’Œå¹¶è¡ŒåŒºåˆ«</h3>
<div class="outline-text-3" id="text-h:3f5a0c6f-ada5-419f-8a5c-b88b0589dd5c">
<p>
å¹¶è¡Œï¼Œparallel
</p>
<ul class="org-ul">
<li>åŒæ—¶åšæŸäº›äº‹ï¼Œå¯ä»¥äº’ä¸å¹²æ‰°çš„åŒä¸€ä¸ªæ—¶åˆ»åšå‡ ä»¶äº‹</li>
</ul>

<p>
å¹¶å‘ï¼Œconcurrency
</p>
<ul class="org-ul">
<li>ä¹Ÿæ˜¯åŒæ—¶åšæŸäº›äº‹ï¼Œä½†æ˜¯å¼ºè°ƒï¼Œä¸€ä¸ªæ—¶æ®µå†…æœ‰äº‹æƒ…è¦å¤„ç†ã€‚</li>
</ul>

<p>
ä¸¾ä¾‹
</p>
<ul class="org-ul">
<li>é«˜é€Ÿå…¬è·¯çš„è½¦é“ï¼ŒåŒå‘4è½¦é“ï¼Œæ‰€æœ‰è½¦è¾†ï¼ˆæ•°æ®ï¼‰å¯ä»¥äº’ä¸å¹²æ‰°çš„åœ¨è‡ªå·±çš„è½¦é“ä¸Šå¥”è·‘ï¼ˆä¼ è¾“ï¼‰</li>
<li>åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œæ¯æ¡è½¦é“ä¸Šå¯èƒ½åŒæ—¶æœ‰è½¦è¾†åœ¨è·‘ï¼Œæ˜¯åŒæ—¶å‘ç”Ÿçš„æ¦‚å¿µï¼Œè¿™æ˜¯å¹¶è¡Œ</li>
<li>åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œæœ‰è¿™ä¹ˆå¤šè½¦è¦é€šè¿‡ï¼Œè¿™æ˜¯å¹¶å‘</li>
</ul>
</div>
</div>
<div id="outline-container-h:d4d26198-5d21-4de1-a346-76be0951c2f1" class="outline-3">
<h3 id="h:d4d26198-5d21-4de1-a346-76be0951c2f1">å¹¶å‘çš„è§£å†³</h3>
<div class="outline-text-3" id="text-h:d4d26198-5d21-4de1-a346-76be0951c2f1">
<p>
<b>"é£Ÿå ‚æ‰“é¥­æ¨¡å‹"</b>
</p>

<p>
ä¸­åˆ12ç‚¹ï¼Œå¼€é¥­å•¦ï¼Œå¤§å®¶éƒ½æ¶Œå‘é£Ÿå ‚ï¼Œè¿™å°±æ˜¯å¹¶å‘ã€‚å¦‚æœäººå¾ˆå¤šï¼Œå°±æ˜¯é«˜å¹¶å‘
</p>

<p>
æŸä¸ªæ—¶é—´æ®µå†…ï¼Œæ•°æ®æ¶Œæ¥ï¼Œè¿™å°±æ˜¯å¹¶å‘ã€‚å¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œå°±æ˜¯ <b>é«˜å¹¶å‘</b>
</p>
</div>
</div>
<div id="outline-container-h:e6ff6761-9525-48c7-8be7-36105a92efa4" class="outline-3">
<h3 id="h:e6ff6761-9525-48c7-8be7-36105a92efa4">1ã€é˜Ÿåˆ—ã€ç¼“å†²åŒº</h3>
<div class="outline-text-3" id="text-h:e6ff6761-9525-48c7-8be7-36105a92efa4">
<p>
å‡è®¾åªæœ‰ä¸€ä¸ªçª—å£ï¼Œé™†ç»­æ¶Œå…¥é£Ÿå ‚çš„äººï¼Œæ’é˜Ÿæ‰“èœæ˜¯æ¯”è¾ƒå¥½çš„æ–¹å¼ã€‚æ‰€ä»¥ï¼Œæ’é˜Ÿï¼ˆé˜Ÿåˆ—ï¼‰æ˜¯ä¸€ç§å¤©ç„¶è§£å†³å¹¶å‘çš„åŠæ³•ã€‚
</p>

<p>
æ’é˜Ÿå°±æ˜¯æŠŠäººæ’æˆ é˜Ÿåˆ—ï¼Œå…ˆè¿›å…ˆå‡ºï¼Œè§£å†³äº†èµ„æºä½¿ç”¨çš„é—®é¢˜ã€‚æ’æˆçš„é˜Ÿåˆ—ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªç¼“å†²åœ°å¸¦ï¼Œå°±æ˜¯ <b>ç¼“å†²åŒº</b>
</p>

<p>
å‡è®¾å¥³ç”Ÿä¼˜å…ˆï¼Œæ¯æ¬¡éƒ½ä»è¿™ä¸ªé˜Ÿä¼ä¸­ä¼˜å…ˆé€‰å‡ºå¥³ç”Ÿå‡ºæ¥å…ˆæ‰“é¥­ï¼Œè¿™å°±æ˜¯ ä¼˜å…ˆé˜Ÿåˆ—
</p>

<p>
ä¾‹å¦‚queueæ¨¡å—çš„ç±»Queueã€LifoQueueã€PriorityQueueï¼ˆå°é¡¶å †å®ç°ï¼‰
</p>
</div>
</div>
<div id="outline-container-h:53a4f241-3feb-4720-b4f6-5b83147c6ff6" class="outline-3">
<h3 id="h:53a4f241-3feb-4720-b4f6-5b83147c6ff6">2ã€äº‰æŠ¢</h3>
<div class="outline-text-3" id="text-h:53a4f241-3feb-4720-b4f6-5b83147c6ff6">
<p>
åªå¼€ä¸€ä¸ªçª—å£ï¼Œæœ‰å¯èƒ½æ²¡æœ‰ç§©åºï¼Œä¹Ÿå°±æ˜¯è°æŒ¤è¿›å»å°±ç»™è°æ‰“é¥­ã€‚
</p>

<p>
æŒ¤åˆ°çª—å£çš„äººå æ®çª—å£ï¼Œç›´åˆ°æ‰“åˆ°é¥­èœç¦»å¼€ã€‚
</p>

<p>
å…¶ä»–äººç»§ç»­äº‰æŠ¢ï¼Œä¼šæœ‰ä¸€ä¸ªäººå æ®ç€çª—å£ï¼Œå¯ä»¥è§†ä¸ºé”å®šçª—å£ï¼Œçª—å£å°±ä¸èƒ½ä¸ºå…¶ä»–äººæä¾›æœåŠ¡äº†ã€‚è¿™æ˜¯ä¸€ç§ <b>é”æœºåˆ¶</b> ã€‚
</p>

<p>
è°æŠ¢åˆ°èµ„æºå°±ä¸Šé”ï¼Œæ’ä»–æ€§çš„é”ï¼Œå…¶ä»–äººåªèƒ½ç­‰å€™ã€‚
</p>

<p>
äº‰æŠ¢ä¹Ÿæ˜¯ä¸€ç§é«˜å¹¶å‘è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯ï¼Œè¿™æ ·å¯èƒ½ä¸å¥½ï¼Œå› ä¸ºæœ‰å¯èƒ½æœ‰äººå¾ˆé•¿æ—¶é—´æŠ¢ä¸åˆ°ã€‚
</p>
</div>
</div>
<div id="outline-container-h:c86d06a7-1014-4bb0-be6f-09e470e3c180" class="outline-3">
<h3 id="h:c86d06a7-1014-4bb0-be6f-09e470e3c180">3ã€é¢„å¤„ç†</h3>
<div class="outline-text-3" id="text-h:c86d06a7-1014-4bb0-be6f-09e470e3c180">
<p>
å…¶å®æ’é˜Ÿé•¿ä¸æ˜¯é—®é¢˜ï¼Œå°±ç®—2ä¸‡äººæ’æˆä¸€é˜Ÿç­‰åƒé¥­ï¼Œå¦‚æœèƒ½10åˆ†é’Ÿæå®šä¹Ÿè¡Œã€‚é—®é¢˜å°±æ˜¯åœ¨å¤„ç†å¹¶å‘çš„é€Ÿåº¦å¤ªæ…¢äº†ã€‚
</p>

<p>
ç»è¿‡åˆ†æå‘ç°ï¼Œæœ¬é£Ÿå ‚ä¸»è¦æ˜¯æ‰“èœç­‰å€™æ—¶é—´çŸ¿é•¿ï¼Œå› ä¸ºæ¯ä¸ªäººéƒ½æ˜¯ç°åœºç‚¹èœç°åšã€‚
</p>

<p>
é£Ÿå ‚å¯ä»¥æå‰ç»Ÿè®¡å¤§å¤šæ•°äººæœ€çˆ±åƒçš„èœå“ï¼Œå°†æœ€çˆ±åƒçš„80%çš„çƒ­é—¨èœï¼Œæå‰åšå¥½ï¼Œä¿è¯ä¾›åº”ï¼Œ20%çš„å†·é—¨èœï¼Œç°åšã€‚
</p>

<p>
è¿™æ ·å¤§å¤šæ•°äººï¼Œå°±ç®—é”å®šçª—å£ï¼Œä¹Ÿå¾ˆå¿«æ‰“åˆ°é¥­èœèµ°äº†ï¼Œå¿«é€Ÿé‡Šæ”¾çª—å£ã€‚
</p>

<p>
ä¸€ç§æå‰åŠ è½½ç”¨æˆ·éœ€è¦çš„æ•°æ®çš„æ€è·¯ï¼Œ <b>é¢„å¤„ç†</b> æ€æƒ³ï¼Œç¼“å­˜å¸¸ç”¨ã€‚
</p>
</div>
</div>
<div id="outline-container-h:8784c5a6-6e22-46d3-8243-f432cff3b9f2" class="outline-3">
<h3 id="h:8784c5a6-6e22-46d3-8243-f432cff3b9f2">4ã€å¹¶è¡Œ</h3>
<div class="outline-text-3" id="text-h:8784c5a6-6e22-46d3-8243-f432cff3b9f2">
<p>
æˆç™¾ä¸ŠåƒäººåŒæ—¶æ¥åƒé¥­ï¼Œä¸€ä¸ªé˜Ÿä¼æä¸å®šçš„ï¼Œå¤šå¼€æ‰“é¥­çª—å£å½¢æˆå¤šä¸ªé˜Ÿåˆ—ï¼Œå¦‚åŒå¼€å¤šä¸ªè½¦é“ä¸€æ ·ï¼Œå¹¶è¡Œæ‰“èœã€‚
</p>

<p>
å¼€çª—å£å°±å¾—æ‰©å¤§é£Ÿå ‚ï¼Œå¾—å¤šé›‡äººåœ¨æ¯ä¸€ä¸ªçª—å£æä¾›æœåŠ¡ï¼Œé€ æˆ <b>æˆæœ¬ä¸Šå‡</b> ã€‚å°±é«˜é€Ÿå…¬è·¯ä¸€æ ·ï¼Œå¤šè½¦é“æ˜¯å¹¶è¡Œ
æ–¹æ¡ˆï¼Œå¤šè½¦é“æé«˜äº†é€šè¡Œæ•ˆç‡ï¼Œä½†æ˜¯ä¹Ÿæ„å‘³ç€å»ºé€ ç»´æŠ¤æˆæœ¬ä¹Ÿé«˜äº†ã€‚
</p>

<p>
æ—¥å¸¸å¯ä»¥é€šè¿‡è´­ä¹°æ›´å¤šæœåŠ¡å™¨ï¼Œæˆ–å¤šå¼€è¿›ç¨‹ã€çº¿ç¨‹å®ç°å¹¶è¡Œå¤„ç†ï¼Œæ¥è§£å†³å¹¶å‘é—®é¢˜ã€‚
</p>

<p>
æ³¨æ„è¿™äº›éƒ½æ˜¯ <b>æ°´å¹³æ‰©å±•</b> æ€æƒ³ã€‚
</p>

<p>
å¹¶è¡Œæ˜¯è§£å†³å¹¶å‘çš„æ‰‹æ®µä¹‹ä¸€ã€‚
</p>

<p>
æ³¨ï¼š
</p>
<ul class="org-ul">
<li>å¦‚æœçº¿ç¨‹åœ¨å•CPUä¸Šå¤„ç†ï¼Œå°±ä¸æ˜¯çœŸå¹¶è¡Œäº†</li>
<li>ä½†æ˜¯å¤šæ•°æœåŠ¡å™¨éƒ½æ˜¯å¤šCPUçš„ï¼ŒæœåŠ¡çš„éƒ¨ç½²å¾€å¾€æ˜¯å¤šæœºçš„ã€åˆ†å¸ƒå¼çš„ï¼Œè¿™éƒ½æ˜¯å¹¶è¡Œå¤„ç†</li>
</ul>
</div>
</div>
<div id="outline-container-h:a3a8cc66-6686-42cc-af85-0c4c016f36cf" class="outline-3">
<h3 id="h:a3a8cc66-6686-42cc-af85-0c4c016f36cf">5ã€æé€Ÿ</h3>
<div class="outline-text-3" id="text-h:a3a8cc66-6686-42cc-af85-0c4c016f36cf">
<p>
æé«˜å•ä¸ªçª—å£çš„æ‰“é¥­é€Ÿåº¦ï¼Œä¹Ÿæ˜¯è§£å†³å¹¶å‘çš„æ–¹å¼ã€‚
</p>

<p>
æ‰“é¥­äººå‘˜æé«˜å·¥ä½œæŠ€èƒ½ï¼Œæˆ–ä¸ºå•ä¸ªçª—å£é…å¤‡æ›´å¤šçš„æœåŠ¡äººå‘˜ï¼Œéƒ½æ˜¯æé€Ÿçš„åŠæ³•ã€‚
</p>

<p>
æé«˜å•ä¸ªCPUæ€§èƒ½ï¼Œæˆ–å•ä¸ªæœåŠ¡å™¨å®‰è£…æ›´å¤šçš„CPUã€‚
</p>

<p>
è¿™æ˜¯ä¸€ç§ <b>å‚ç›´æ‰©å±•</b> æ€æƒ³
</p>
</div>
</div>
<div id="outline-container-h:5f7fb109-95eb-4e05-8f29-7df559eef9ef" class="outline-3">
<h3 id="h:5f7fb109-95eb-4e05-8f29-7df559eef9ef">6ã€æ¶ˆæ¯ä¸­é—´ä»¶</h3>
<div class="outline-text-3" id="text-h:5f7fb109-95eb-4e05-8f29-7df559eef9ef">
<p>
å¸¸è§çš„æ¶ˆæ¯ä¸­é—´ä»¶æœ‰RabbitMQã€ActiveMQï¼ˆApacheï¼‰ã€RocketMQï¼ˆé˜¿é‡ŒApacheï¼‰ã€kafkaï¼ˆApacheï¼‰ç­‰ã€‚
</p>

<p>
å½“ç„¶è¿˜æœ‰å…¶ä»–æ‰‹æ®µè§£å†³å¹¶å‘é—®é¢˜ï¼Œä½†æ˜¯å·²ç»åˆ—ä¸¾é™¤äº†æœ€å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œä¸€èˆ¬æ¥è¯´ä¸åŒçš„å¹¶å‘åœºæ™¯ç”¨ä¸åŒçš„ç­–ç•¥ï¼Œè€Œç­–ç•¥å¯èƒ½æ˜¯å¤šç§æ–¹å¼çš„ä¼˜åŒ–ç»„åˆ
</p>

<p>
ä¾‹å¦‚å¤šå¼€é£Ÿå ‚ï¼ˆå¤šåœ°ï¼‰ï¼Œä¹Ÿå¯ä»¥æŠŠé£Ÿå ‚å»ºè®¾åˆ°å®¿èˆç”Ÿæ´»åŒºï¼ˆå°±è¿‘ï¼‰ï¼Œæ‰€ä»¥è¯´ï¼ŒæŠ€æœ¯æ¥æºäºç”Ÿæ´»ã€‚
</p>
</div>
</div>
</section>
<section id="outline-container-h:b1f85b48-cfde-4f2f-a587-3e03270d747d" class="outline-2">
<h2 id="h:b1f85b48-cfde-4f2f-a587-3e03270d747d">queueæ¨¡å—&#x2013;é˜Ÿåˆ—</h2>
<div class="outline-text-2" id="text-h:b1f85b48-cfde-4f2f-a587-3e03270d747d">
<p>
queueæ¨¡å—çš„ç±»Queueã€LifoQueueã€PriorityQueueä¸‰ä¸ªç±»ã€‚
</p>
</div>
<div id="outline-container-h:3ca3c81b-793f-4246-8ddc-f68b41e13775" class="outline-3">
<h3 id="h:3ca3c81b-793f-4246-8ddc-f68b41e13775">Queue</h3>
<div class="outline-text-3" id="text-h:3ca3c81b-793f-4246-8ddc-f68b41e13775">
<p>
Queueæ˜¯å…ˆè¿›å…ˆå‡º(first-in first-out)é˜Ÿåˆ—ã€‚
</p>

<p>
queue.Queue(maxsize=0)
</p>
<ul class="org-ul">
<li>åˆ›å»ºFIFOé˜Ÿåˆ—ï¼Œè¿”å›Queueå¯¹è±¡</li>
<li>maxsizeå°äºç­‰äº0ï¼Œé˜Ÿåˆ—é•¿åº¦æ²¡æœ‰é™åˆ¶</li>
</ul>

<p>
Queue.get(block=True, timeout=None)
</p>
<ul class="org-ul">
<li>ä»é˜Ÿåˆ—ä¸­ç§»é™¤å…ƒç´ å¹¶è¿”å›è¿™ä¸ªå…ƒç´ </li>
<li>blockä¸ºé˜»å¡ï¼Œtimeoutä¸ºè¶…æ—¶</li>
<li>å¦‚æœblockä¸ºTrueï¼Œå°±é˜»å¡ï¼Œtimeoutä¸ºNoneå°±æ˜¯ä¸€ç›´é˜»å¡ã€‚</li>
<li>å¦‚æœblockä¸ºTrueï¼Œä½†æ˜¯timeoutæœ‰å€¼ï¼Œå°±é˜»å¡åˆ°ä¸€å®šç§’æ•°æŠ›å‡ºEmptyå¼‚å¸¸</li>
<li>blockä¸ºFalseï¼Œæ˜¯éé˜»å¡ï¼Œtimeoutå°†è¢«å¿½ç•¥ï¼Œè¦ä¹ˆæˆåŠŸè¿”å›ä¸€ä¸ªå…ƒç´ ï¼Œè¦ä¹ˆæŠ›å‡ºemptyå¼‚å¸¸ã€‚</li>
</ul>

<p>
Queue.get_nowait()
</p>
<ul class="org-ul">
<li>ç­‰ä»·äºget(False)ï¼Œä¹Ÿå°±æ˜¯è¯´è¦ä¹ˆæˆåŠŸè¿”å›ä¸€ä¸ªå…ƒç´ ï¼Œè¦ä¹ˆæŠ›å‡ºemptyå¼‚å¸¸</li>
<li>ä½†æ˜¯queueçš„è¿™ç§é˜»å¡æ•ˆæœï¼Œéœ€è¦å¤šçº¿ç¨‹æ¥æ¼”ç¤º</li>
</ul>

<p>
Queue.put(item, block=True, timeout=None)
</p>
<ul class="org-ul">
<li>æŠŠä¸€ä¸ªå…ƒç´ åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­å»</li>
<li>block=True, timeout=Noneï¼Œä¸€ç›´é˜»å¡åˆ°æœ‰ç©ºä½æ”¾å…ƒç´ </li>
<li>block=True, timeout=5ï¼Œé˜»å¡5ç§’å°±æŠ›å‡ºFullå¼‚å¸¸</li>
<li>block=False, timeoutå¤±æ•ˆï¼Œç«‹å³è¿”å›ï¼Œèƒ½å¡è¿›å»å°±å¡ï¼Œä¸èƒ½åˆ™è¿”å›æŠ›å‡ºFullå¼‚å¸¸ã€‚</li>
</ul>

<p>
Queue.put_nowait(item)
</p>
<ul class="org-ul">
<li>ç­‰ä»·äºput(item, False)ï¼Œä¹Ÿå°±æ˜¯èƒ½å¡è¿›å»å°±å¡ï¼Œä¸èƒ½åˆ™è¿”å›æŠ›å‡ºFullå¼‚å¸¸ã€‚</li>
</ul>

<p>
èŒƒä¾‹ï¼š
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> queue <span style="color: #a020f0;">import</span> Queue
<span style="color: #a020f0;">import</span> time  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#28155;&#21152;&#23548;&#20837;time&#27169;&#22359;</span>

<span style="color: #a0522d;">q</span> = Queue()
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23614;&#37096;&#21152;&#20837;&#65292;&#22836;&#37096;&#25343;&#36208;</span>
q.put(1)
q.put(2)
q.put(3)

<span style="color: #483d8b;">print</span>(q.get())
<span style="color: #483d8b;">print</span>(q.get())
<span style="color: #b22222;">#</span><span style="color: #b22222;">print(q.empty()) #&#21028;&#26029;&#38431;&#21015;&#26159;&#21542;&#20026;&#31354;&#65292;&#31354;&#36820;&#22238;False, &#38750;&#31354;&#36820;&#22238;True</span>
<span style="color: #483d8b;">print</span>()
time.sleep(1)   
<span style="color: #483d8b;">print</span>(q.get())

<span style="color: #b22222;"># </span><span style="color: #b22222;">print(q.get()) #&#38431;&#21015;&#26377;&#25968;&#25454;&#65292;&#31435;&#21363;&#33719;&#21462;&#65307;&#27809;&#26377;&#25968;&#25454;&#65292;&#40664;&#35748;&#38459;&#22622;&#31561;&#24453;&#12290;&#20351;&#29992;&#22810;&#32447;&#31243;&#35299;&#20915;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(q.get(timeout=5)) #&#31561;&#20102;5s&#65292;&#31354;&#25163;&#32780;&#24402;&#65292;&#25243;&#20986;Empty&#24322;&#24120;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(q.get(False)) #&#25105;&#19981;&#31561;&#65292;&#26377;&#25343;&#36208;&#65292;&#27809;&#26377;&#25968;&#25454;&#25105;&#20063;&#19981;&#31561;&#65292;&#31354;&#25163;&#32780;&#24402;&#65292;&#25243;&#20986;&#24322;&#24120;Empty</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">1</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">3</span>
</pre>
</div>

<p>
é˜Ÿåˆ—æœ‰æ•°æ®ï¼Œç«‹å³è·å–ï¼›æ²¡æœ‰æ•°æ®ï¼Œé»˜è®¤é˜»å¡ç­‰å¾…ã€‚ä½¿ç”¨å¤šçº¿ç¨‹è§£å†³
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> queue <span style="color: #a020f0;">import</span> Queue
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> threading

<span style="color: #a0522d;">q</span> = Queue()
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23614;&#37096;&#21152;&#20837;&#65292;&#22836;&#37096;&#25343;&#36208;</span>
q.put(1)
q.put(2)
q.put(3)

<span style="color: #483d8b;">print</span>(q.get())
<span style="color: #483d8b;">print</span>(q.get()) 
<span style="color: #483d8b;">print</span>(q.get())

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">put_data</span>():
    time.sleep(5)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~'</span> * 30)
    q.put(<span style="color: #8b2252;">'test'</span>)

<span style="color: #a0522d;">t</span> = threading.Thread(target=put_data)
t.start() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#21160;&#32447;&#31243;</span>

<span style="color: #483d8b;">print</span>(q.get()) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38431;&#21015;&#26377;&#25968;&#25454;&#65292;&#31435;&#21363;&#33719;&#21462;&#65307;&#27809;&#26377;&#25968;&#25454;&#65292;&#40664;&#35748;&#38459;&#22622;&#31561;&#24453;&#12290;&#20351;&#29992;&#22810;&#32447;&#31243;&#35299;&#20915;</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">1</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">3</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">test</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> queue <span style="color: #a020f0;">import</span> Queue

<span style="color: #a0522d;">q</span> = Queue(5)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23614;&#37096;&#21152;&#20837;&#65292;&#22836;&#37096;&#25343;&#36208;</span>
q.put(1)
q.put(2)
q.put(3)
q.put(4)
<span style="color: #483d8b;">print</span>(q.full())
q.put(5)
<span style="color: #483d8b;">print</span>(q.full(), q.qsize())
<span style="color: #b22222;"># </span><span style="color: #b22222;">q.put(6) #&#38431;&#21015;&#28385;&#20102;&#65292;&#40664;&#35748;&#27704;&#20037;&#38459;&#22622;&#65292;&#30452;&#21040;&#26377;&#31354;&#38388;&#20026;&#27490;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">q.put(6, True, timeout=3) #&#22914;&#26524;&#26377;&#31354;&#38388;&#65292;&#21152;&#20837;&#65307;&#21542;&#21017;&#31561;3&#31186;&#65292;3&#31186;&#21518;&#21152;&#20837;&#19981;&#25104;&#21151;&#25243;&#24322;&#24120; queue.Full</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">q.put(6, False) #&#33021;&#21152;&#20837;&#23601;&#31435;&#21363;&#21152;&#20837;&#21040;&#38431;&#21015;&#65307;&#22914;&#26524;&#28385;&#20102;&#65292;&#19981;&#31561;&#24453;&#65292;&#25243;Full&#24322;&#24120;</span>
q.put_nowait(6) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#20215;&#20110;q.put(6, False)</span>

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6deda1e1-7062-4cc3-93de-655062e54483" class="outline-3">
<h3 id="h:6deda1e1-7062-4cc3-93de-655062e54483">LifoQueue</h3>
<div class="outline-text-3" id="text-h:6deda1e1-7062-4cc3-93de-655062e54483">
<p>
åè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œè¿™ä¸ªç±»ç»§æ‰¿è‡ªQueueï¼Œä½¿ç”¨æ–¹å¼åŒQueueã€‚
</p>


<p>
èŒƒä¾‹ï¼š
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> queue <span style="color: #a020f0;">import</span> Queue, LifoQueue

<span style="color: #a0522d;">q</span> = LifoQueue(5) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#37319;&#29992;&#20160;&#20040;&#25968;&#25454;&#32467;&#26500;&#65311; list &#26412;&#36523;&#23601;&#26159;&#26632;&#65292;&#20063;&#21487;&#20197;&#38142;&#34920;&#23454;&#29616;</span>
q.put(1)
q.put(2)
q.put(3)

<span style="color: #483d8b;">print</span>(q.get())
<span style="color: #483d8b;">print</span>(q.get())
<span style="color: #483d8b;">print</span>(q.get())

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">3</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">1</span>
</pre>
</div>

<p>
æºç 
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">LifoQueue</span>(Queue):
    <span style="color: #8b2252;">'''Variant of Queue that retrieves most recently added entries first.'''</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_init</span>(<span style="color: #a020f0;">self</span>, maxsize):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">queue</span> = []

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_qsize</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">len</span>(<span style="color: #a020f0;">self</span>.queue)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_put</span>(<span style="color: #a020f0;">self</span>, item):
        <span style="color: #a020f0;">self</span>.queue.append(item)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_get</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.queue.pop()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35206;&#30422;&#20102;Queue&#31867;&#20013;&#30340;&#26041;&#27861;</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Queue</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">put</span>(<span style="color: #a020f0;">self</span>, item, block=<span style="color: #008b8b;">True</span>, timeout=<span style="color: #008b8b;">None</span>):
        <span style="color: #a020f0;">with</span> <span style="color: #a020f0;">self</span>.not_full:
            ... ...
            <span style="color: #a020f0;">self</span>._put(item)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_init</span>(<span style="color: #a020f0;">self</span>, maxsize):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">queue</span> = deque() <span style="color: #b22222;">#</span><span style="color: #b22222;">Queue&#20351;&#29992;&#30340;&#26159;&#21452;&#31471;&#38431;&#21015;</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_put</span>(<span style="color: #a020f0;">self</span>, item):
        <span style="color: #a020f0;">self</span>.queue.append(item)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:7b1be691-775f-4341-b9a3-53730cb8f3cd" class="outline-3">
<h3 id="h:7b1be691-775f-4341-b9a3-53730cb8f3cd">PriorityQueue</h3>
<div class="outline-text-3" id="text-h:7b1be691-775f-4341-b9a3-53730cb8f3cd">
<p>
ä¼˜å…ˆé˜Ÿåˆ—ï¼Œè¿™ä¸ªç±»ä¹Ÿç»§æ‰¿è‡ªQueueç±»ï¼Œå¹¶é‡å†™å…¥é˜Ÿã€å‡ºé˜Ÿçš„æ–¹æ³•ã€‚
</p>
<ul class="org-ul">
<li>å®ƒé‡Œé¢æ˜¯å †ï¼Œç”¨åˆ—è¡¨å®ç°çš„å †ï¼Œæ„å»ºçš„æ˜¯å°é¡¶å †ã€‚</li>
<li>å…ƒç´ å¯ä»¥å­˜å‚¨ä»»æ„å€¼ï¼Œä½†æ˜¯ä¼˜å…ˆé˜Ÿåˆ—å†…éƒ¨æ˜¯ç›´æ¥è¿›è¡Œå…ƒç´ å¤§å°æ¯”è¾ƒçš„ï¼Œä¸åŒç±»å‹æ¯”è¾ƒå¯èƒ½æŠ›å¼‚å¸¸</li>
<li>å…¥é˜Ÿæ—¶ï¼Œå°†å…ƒç´ åŠ å…¥åˆ°åˆ—è¡¨æœ«å°¾ã€‚ç„¶åè¿›è¡Œå°é¡¶å †è°ƒæ•´ã€‚</li>
<li>å‡ºé˜Ÿæ—¶ï¼Œå°†ç´¢å¼•0å³å †é¡¶å¤„æœ€å°å€¼å¼¹å‡ºï¼Œç„¶åå°†æœ€åä¸€ä¸ªå…ƒç´ æ”¾åˆ°å †é¡¶ï¼Œé‡æ–°å †è°ƒæ•´ã€‚</li>
</ul>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> queue <span style="color: #a020f0;">import</span> Queue, LifoQueue, PriorityQueue

<span style="color: #a0522d;">q</span> = PriorityQueue() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23567;&#39030;&#22534;&#65292;&#20803;&#32032;&#24517;&#39035;&#21487;&#20197;&#27604;&#36739;</span>
q.put(1)
q.put(2)
<span style="color: #b22222;"># </span><span style="color: #b22222;">q.put('tom') # &#25253;&#38169;&#65292;TypeError: '&lt;' not supported between instances of 'str' and 'int'</span>

<span style="color: #483d8b;">print</span>(q.get())
<span style="color: #483d8b;">print</span>(q.get())


<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">1</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2</span>
</pre>
</div>

<p>
è‡ªå®šä¹‰ç±»
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> queue <span style="color: #a020f0;">import</span> Queue, LifoQueue, PriorityQueue

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Student</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name, gender=<span style="color: #8b2252;">'M'</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">gender</span> = gender

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__eq__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'__eq__'</span>, <span style="color: #a020f0;">self</span>.name, other.name)
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.name == other.name <span style="color: #a020f0;">and</span> <span style="color: #a020f0;">self</span>.gender == other.gender

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__lt__</span>(<span style="color: #a020f0;">self</span>, other):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">print('__lt__', self.name, other.name)</span>
        <span style="color: #a0522d;">s1</span> = <span style="color: #8b2252;">"{}:{}"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.gender, <span style="color: #a020f0;">self</span>.name) <span style="color: #b22222;">#</span><span style="color: #b22222;">F:Alice</span>
        <span style="color: #a0522d;">s2</span> = <span style="color: #8b2252;">"{}:{}"</span>.<span style="color: #483d8b;">format</span>(other.gender, other.name)
        <span style="color: #a020f0;">return</span> s1 &lt; s2

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__repr__</span>(<span style="color: #a020f0;">self</span>) -&gt; <span style="color: #483d8b;">str</span>:
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&lt;{} {}&gt;'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #a020f0;">self</span>.name, <span style="color: #a020f0;">self</span>.gender)

<span style="color: #a0522d;">q</span> = PriorityQueue() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23567;&#39030;&#22534;&#65292;&#20803;&#32032;&#24517;&#39035;&#21487;&#20197;&#27604;&#36739;</span>

<span style="color: #a020f0;">for</span> name <span style="color: #a020f0;">in</span> (<span style="color: #8b2252;">'tom'</span>, <span style="color: #8b2252;">'jerry'</span>, <span style="color: #8b2252;">'kite'</span>, <span style="color: #8b2252;">'sam'</span>, <span style="color: #8b2252;">'ben'</span>):
    q.put(Student(name))

q.put(Student(<span style="color: #8b2252;">'Alice'</span>, <span style="color: #8b2252;">'F'</span>))
<span style="color: #483d8b;">print</span>(q.qsize())

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5):
    <span style="color: #483d8b;">print</span>(q.get())


<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">6</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;Alice F&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;ben M&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;jerry M&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;kite M&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;sam M&gt;</span>
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:54394495-56ac-49b0-8c9b-9091b8c3f907" class="outline-2">
<h2 id="h:54394495-56ac-49b0-8c9b-9091b8c3f907">çº¿ç¨‹</h2>
<div class="outline-text-2" id="text-h:54394495-56ac-49b0-8c9b-9091b8c3f907">
</div>
<div id="outline-container-h:da5b7806-7a9d-4232-9154-c00fa6dddf77" class="outline-3">
<h3 id="h:da5b7806-7a9d-4232-9154-c00fa6dddf77">è¿›ç¨‹å’Œçº¿ç¨‹</h3>
<div class="outline-text-3" id="text-h:da5b7806-7a9d-4232-9154-c00fa6dddf77">
<p>
çº¿ç¨‹
</p>
<ul class="org-ul">
<li>åœ¨å®ç°äº†çº¿ç¨‹çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½ã€‚å®ƒè¢«åŒ…å«åœ¨è¿›ç¨‹ä¹‹ä¸­ï¼Œæ˜¯è¿›ç¨‹ä¸­çš„å®é™…è¿ä½œå•ä½ã€‚ä¸€ä¸ªç¨‹åºçš„æ‰§è¡Œå®ä¾‹å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚</li>
</ul>

<p>
è¿›ç¨‹
</p>
<ul class="org-ul">
<li>è¿›ç¨‹ï¼ˆProcessï¼‰æ˜¯è®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ <b>ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½</b> ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç»“æ„çš„åŸºç¡€ã€‚</li>
</ul>

<p>
è¿›ç¨‹å’Œç¨‹åºçš„å…³ç³»
</p>
<ul class="org-ul">
<li>ç¨‹åºæ˜¯æºä»£ç ç¼–è¯‘åçš„æ–‡ä»¶ï¼Œè€Œè¿™äº›æ–‡ä»¶å­˜æ”¾åœ¨ç£ç›˜ä¸Šã€‚å½“ç¨‹åºè¢«æ“ä½œç³»ç»ŸåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå°±æ˜¯è¿›ç¨‹ï¼Œè¿›ç¨‹ä¸­å­˜æ”¾ç€æŒ‡ä»¤å’Œæ•°æ®ï¼ˆèµ„æºï¼‰ï¼Œ <b>å®ƒä¹Ÿæ˜¯çº¿ç¨‹çš„å®¹å™¨</b> ã€‚</li>
</ul>

<p>
Linuxè¿›ç¨‹æœ‰çˆ¶è¿›ç¨‹ã€å­è¿›ç¨‹ï¼ŒWindowsçš„è¿›ç¨‹æ˜¯å¹³ç­‰å…³ç³»ã€‚
</p>

<p>
çº¿ç¨‹ï¼Œæœ‰æ—¶è¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹(Lightweight Processï¼ŒLWPï¼‰ï¼Œæ˜¯ç¨‹åºæ‰§è¡Œæµçš„æœ€å°å•å…ƒã€‚
</p>

<p>
ä¸€ä¸ªæ ‡å‡†çš„çº¿ç¨‹ç”±çº¿ç¨‹IDï¼Œå½“å‰æŒ‡ä»¤æŒ‡é’ˆ(PCï¼‰ã€å¯„å­˜å™¨é›†åˆå’Œå †æ ˆç»„æˆã€‚
</p>

<p>
åœ¨è®¸å¤šç³»ç»Ÿä¸­ï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¯”åˆ›å»ºä¸€ä¸ªè¿›ç¨‹å¿«10-100å€ã€‚
</p>
</div>
<div id="outline-container-h:b1200606-8276-4937-b0e2-26aa2af21f70" class="outline-4">
<h4 id="h:b1200606-8276-4937-b0e2-26aa2af21f70">è¿›ç¨‹ã€çº¿ç¨‹çš„ç†è§£</h4>
<div class="outline-text-4" id="text-h:b1200606-8276-4937-b0e2-26aa2af21f70">
<p>
ç°ä»£æ“ä½œç³»ç»Ÿæå‡ºè¿›ç¨‹çš„æ¦‚å¿µï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½è®¤ä¸ºè‡ªå·±ç‹¬å æ‰€æœ‰çš„è®¡ç®—æœºç¡¬ä»¶èµ„æºã€‚
</p>

<p>
è¿›ç¨‹å°±æ˜¯ç‹¬ç«‹çš„ç‹å›½ï¼Œè¿›ç¨‹é—´ä¸å¯ä»¥éšä¾¿çš„å…±äº«æ•°æ®ã€‚
</p>

<p>
çº¿ç¨‹å°±æ˜¯çœä»½ï¼ŒåŒä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹å¯ä»¥å…±äº«è¿›ç¨‹çš„èµ„æºï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å †æ ˆã€‚
</p>
</div>
</div>
<div id="outline-container-h:70734629-45fc-4d81-b1f3-b06d9ea3e08d" class="outline-4">
<h4 id="h:70734629-45fc-4d81-b1f3-b06d9ea3e08d">çº¿ç¨‹çš„çŠ¶æ€</h4>
<div class="outline-text-4" id="text-h:70734629-45fc-4d81-b1f3-b06d9ea3e08d">
<ul class="org-ul">
<li><p>
å°±ç»ª(Ready)
</p>

<p>
çº¿ç¨‹èƒ½å¤Ÿè¿è¡Œï¼Œä½†åœ¨ç­‰å¾…è¢«è°ƒåº¦ã€‚å¯èƒ½çº¿ç¨‹åˆšåˆšåˆ›å»ºå¯åŠ¨ï¼Œæˆ–åˆšåˆšä»é˜»å¡ä¸­æ¢å¤ï¼Œæˆ–è€…è¢«å…¶ä»–çº¿ç¨‹æŠ¢å 
</p></li>

<li><p>
è¿è¡Œ(Running)
</p>

<p>
çº¿ç¨‹æ­£åœ¨è¿è¡Œ
</p></li>

<li><p>
é˜»å¡(Blocked)
</p>

<p>
çº¿ç¨‹ç­‰å¾…å¤–éƒ¨äº‹ä»¶å‘ç”Ÿè€Œæ— æ³•è¿è¡Œï¼Œå¦‚I/Oæ“ä½œ
</p></li>

<li><p>
ç»ˆæ­¢(Terminated)
</p>

<p>
çº¿ç¨‹å®Œæˆï¼Œæˆ–é€€å‡ºï¼Œæˆ–è¢«å–æ¶ˆ
</p></li>
</ul>



<figure id="org5a83f6b">
<img src="./images/img_20250303_221344.png" alt="img_20250303_221344.png" width="90%">

</figure>
</div>
</div>
<div id="outline-container-h:03d53f0a-fbd9-4182-8758-3cd5af8d7d23" class="outline-4">
<h4 id="h:03d53f0a-fbd9-4182-8758-3cd5af8d7d23">Pythonä¸­çš„è¿›ç¨‹å’Œçº¿ç¨‹</h4>
<div class="outline-text-4" id="text-h:03d53f0a-fbd9-4182-8758-3cd5af8d7d23">
<p>
è¿›ç¨‹ä¼šå¯åŠ¨ä¸€ä¸ªè§£é‡Šå™¨è¿›ç¨‹ï¼Œçº¿ç¨‹å…±äº«ä¸€ä¸ªè§£é‡Šå™¨è¿›ç¨‹
</p>
</div>
</div>
</div>
<div id="outline-container-h:d96cf474-80f1-46b2-a0f2-7b293dabf1a7" class="outline-3">
<h3 id="h:d96cf474-80f1-46b2-a0f2-7b293dabf1a7">Pythonçš„çº¿ç¨‹å¼€å‘</h3>
<div class="outline-text-3" id="text-h:d96cf474-80f1-46b2-a0f2-7b293dabf1a7">
<p>
Pythonçš„çº¿ç¨‹å¼€å‘ä½¿ç”¨æ ‡å‡†åº“threadingã€‚
</p>

<p>
è¿›ç¨‹é çº¿ç¨‹æ‰§è¡Œä»£ç ï¼Œè‡³å°‘æœ‰ä¸€ä¸ª <b>ä¸»çº¿ç¨‹</b> ï¼Œå…¶å®ƒçº¿ç¨‹æ˜¯å·¥ä½œçº¿ç¨‹
</p>

<p>
ä¸»çº¿ç¨‹æ˜¯ç¬¬ä¸€ä¸ªå¯åŠ¨çš„çº¿ç¨‹
</p>

<p>
çˆ¶çº¿ç¨‹ï¼šå¦‚æœçº¿ç¨‹Aä¸­å¯åŠ¨äº†ä¸€ä¸ªçº¿ç¨‹Bï¼ŒAå°±æ˜¯Bçš„çˆ¶çº¿ç¨‹
</p>

<p>
å­çº¿ç¨‹ï¼šBå°±æ˜¯Açš„å­çº¿ç¨‹
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"I'm a working"</span>)
    <span style="color: #a020f0;">pass</span>
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Finished"</span>)

<span style="color: #a0522d;">t</span> = threading.Thread(target=worker, ) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;&#19968;&#20010;&#32447;&#31243;&#23545;&#35937;&#65292;&#27492;&#32447;&#31243;&#26410;&#36816;&#34892;&#12290;&#20027;&#32447;&#31243;</span>
t.start() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#21160;&#19968;&#20010;&#32447;&#31243;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">I'm a working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Finished</span>
</pre>
</div>
</div>
<div id="outline-container-h:0280394c-3e47-46db-a401-e5fa67803d48" class="outline-4">
<h4 id="h:0280394c-3e47-46db-a401-e5fa67803d48">Threadç±»</h4>
<div class="outline-text-4" id="text-h:0280394c-3e47-46db-a401-e5fa67803d48">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, group=<span style="color: #008b8b;">None</span>, target=<span style="color: #008b8b;">None</span>,
       name=<span style="color: #008b8b;">None</span>,args=(), kwargs=<span style="color: #008b8b;">None</span>, *, daemon=<span style="color: #008b8b;">None</span>)


<span style="color: #b22222;">#</span><span style="color: #b22222;">target  &#32447;&#31243;&#35843;&#29992;&#30340;&#23545;&#35937;&#65292;&#23601;&#26159;&#30446;&#26631;&#20989;&#25968;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">name  &#20026;&#32447;&#31243;&#36215;&#20010;&#21517;&#23383;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">args  &#20026;&#30446;&#26631;&#20989;&#25968;&#20256;&#36882;&#23454;&#21442;&#65292;&#20803;&#32452;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">kwargs  &#20026;&#30446;&#26631;&#20989;&#25968;&#20851;&#38190;&#23383;&#20256;&#21442;&#65292;&#23383;&#20856;</span>
</pre>
</div>
</div>
<div id="outline-container-h:484ab488-8416-48ee-970e-0efa85f0472a" class="outline-5">
<h5 id="h:484ab488-8416-48ee-970e-0efa85f0472a">çº¿ç¨‹å¯åŠ¨</h5>
<div class="outline-text-5" id="text-h:484ab488-8416-48ee-970e-0efa85f0472a">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26368;&#31616;&#21333;&#30340;&#32447;&#31243;&#31243;&#24207;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"I'm working"</span>)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Fineshed"</span>)


<span style="color: #a0522d;">t</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32447;&#31243;&#23545;&#35937;</span>
t.start() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21551;&#21160;</span>
</pre>
</div>

<p>
é€šè¿‡threading.Threadåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œtargetæ˜¯ç›®æ ‡å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨nameä¸ºçº¿ç¨‹æŒ‡å®šåç§°
ä½†æ˜¯çº¿ç¨‹æ²¡æœ‰å¯åŠ¨ï¼Œéœ€è¦è°ƒç”¨startæ–¹æ³•
çº¿ç¨‹ä¹‹æ‰€ä»¥æ‰§è¡Œå‡½æ•°ï¼Œæ˜¯å› ä¸ºçº¿ç¨‹ä¸­å°±æ˜¯è¦æ‰§è¡Œä»£ç çš„ï¼Œè€Œæœ€ç®€å•çš„å°è£…å°±æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥è¿˜æ˜¯å‡½æ•°è°ƒç”¨
å‡½æ•°æ‰§è¡Œå®Œï¼Œçº¿ç¨‹ä¹Ÿå°±é€€å‡ºäº†
æ— çº¿å¾ªç¯ï¼Œä¸è®©çº¿ç¨‹é€€å‡º
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
  <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
    time.sleep(1)
      <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"I'm working"</span>)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Fineshed"</span>)

<span style="color: #a0522d;">t</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32447;&#31243;&#23545;&#35937;</span>
t.start() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21551;&#21160; </span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:47d76164-0f32-44e9-9836-0c88eee3b25c" class="outline-5">
<h5 id="h:47d76164-0f32-44e9-9836-0c88eee3b25c">çº¿ç¨‹é€€å‡º</h5>
<div class="outline-text-5" id="text-h:47d76164-0f32-44e9-9836-0c88eee3b25c">
<p>
Pythonæ²¡æœ‰æä¾›çº¿ç¨‹é€€å‡ºçš„æ–¹æ³•ï¼Œçº¿ç¨‹åœ¨ä¸‹é¢æƒ…å†µæ—¶é€€å‡º
</p>
<ol class="org-ol">
<li>çº¿ç¨‹å‡½æ•°å†…è¯­å¥æ‰§è¡Œå®Œæ¯•</li>
<li>çº¿ç¨‹å‡½æ•°ä¸­æŠ›å‡ºæœªå¤„ç†çš„å¼‚å¸¸</li>
</ol>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    <span style="color: #a0522d;">count</span> = 0
    <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
        <span style="color: #a020f0;">if</span> count &gt; 5:
            <span style="color: #b22222;"># </span><span style="color: #b22222;">raise RuntimeError(count) # &#25243;&#24322;&#24120;</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">return #&#20989;&#25968;&#36820;&#22238;</span>
            <span style="color: #a020f0;">break</span>
        time.sleep(1)
        <span style="color: #a0522d;">count</span> += 1
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"I'm working"</span>)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Fineshed"</span>)


<span style="color: #a0522d;">t</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker'</span>)
t.start()

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"===end==="</span>)
</pre>
</div>

<p>
Pythonçš„çº¿ç¨‹æ²¡æœ‰ä¼˜å…ˆçº§ã€æ²¡æœ‰çº¿ç¨‹ç»„çš„æ¦‚å¿µï¼Œä¹Ÿä¸èƒ½è¢«é”€æ¯ã€åœæ­¢ã€æŒ‚èµ·ï¼Œé‚£ä¹Ÿå°±æ²¡æœ‰æ¢å¤ã€ä¸­æ–­äº†ã€‚
</p>
</div>
</div>
<div id="outline-container-h:0815293a-7ab2-4d56-a260-de2fe52a9c57" class="outline-5">
<h5 id="h:0815293a-7ab2-4d56-a260-de2fe52a9c57">çº¿ç¨‹ä¼ å‚</h5>
<div class="outline-text-5" id="text-h:0815293a-7ab2-4d56-a260-de2fe52a9c57">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} + {} = {}'</span>.<span style="color: #483d8b;">format</span>(x, y, x + y), threading.current_thread().ident)


<span style="color: #a0522d;">t1</span> = threading.Thread(target=add, name=<span style="color: #8b2252;">'add1'</span>, args=(4, 5))
t1.start()
time.sleep(2)

<span style="color: #a0522d;">t2</span> = threading.Thread(target=add, name=<span style="color: #8b2252;">'add2'</span>, args=(6,), kwargs={<span style="color: #8b2252;">'y'</span>:7})
t2.start()
time.sleep(2)

<span style="color: #a0522d;">t3</span> = threading.Thread(target=add, name=<span style="color: #8b2252;">'add3'</span>, kwargs={<span style="color: #8b2252;">'x'</span>:8, <span style="color: #8b2252;">'y'</span>:9})
t3.start()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">4 + 5 = 9 11048</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">6 + 7 = 13 15672</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">8 + 9 = 17 21196</span>
</pre>
</div>

<p>
çº¿ç¨‹ä¼ å‚å’Œå‡½æ•°ä¼ å‚æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å‡½æ•°ä¼ å‚
</p>
</div>
</div>
<div id="outline-container-h:a937c085-ab52-4083-a56d-3d8207a56f86" class="outline-5">
<h5 id="h:a937c085-ab52-4083-a56d-3d8207a56f86">threadingçš„å±æ€§å’Œæ–¹æ³•</h5>
<div class="outline-text-5" id="text-h:a937c085-ab52-4083-a56d-3d8207a56f86">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #0000ff;">current_thread</span>()  &#36820;&#22238;&#24403;&#21069;&#32447;&#31243;&#23545;&#35937;
<span style="color: #0000ff;">main_thread</span>() &#36820;&#22238;&#20027;&#32447;&#31243;&#23545;&#35937;
<span style="color: #0000ff;">active_count</span>(&#65289;  &#24403;&#21069;&#22788;&#20110;alive&#29366;&#24577;&#30340;&#32447;&#31243;&#20010;&#25968;
<span style="color: #0000ff;">enumerate</span>() &#36820;&#22238;&#25152;&#26377;&#27963;&#30528;&#30340;&#32447;&#31243;&#30340;&#21015;&#34920;&#65292;&#19981;&#21253;&#25324;&#24050;&#32463;&#32456;&#27490;&#30340;&#32447;&#31243;&#21644;&#26410;&#24320;&#22987;&#30340;&#32447;&#31243;
<span style="color: #0000ff;">get_ident</span>() &#36820;&#22238;&#24403;&#21069;&#32447;&#31243;&#30340;ID&#65292;&#38750;0&#25972;&#25968;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showtreainfo</span>():
    <span style="color: #483d8b;">print</span>(threading.main_thread(), threading.current_thread(),
        threading.active_count(), threading.<span style="color: #483d8b;">enumerate</span>())

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    showtreainfo() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26174;&#31034;&#32447;&#31243;&#20449;&#24687;</span>
    <span style="color: #b22222;">#</span><span style="color: #b22222;">while True:</span>
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5):
        time.sleep(1)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'i am working'</span>)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'finished'</span>)

<span style="color: #a0522d;">t</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32447;&#31243;&#23545;&#35937;</span>
showtreainfo() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26174;&#31034;&#32447;&#31243;&#20449;&#24687;</span>
time.sleep(1)
t.start() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21551;&#21160;&#36816;&#34892;&#19968;&#20010;&#32447;&#31243;</span>

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'===enb==='</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;_MainThread(MainThread, started 24000)&gt; &lt;_MainThread(MainThread, started 24000)&gt; 1 [&lt;_MainThread(MainThread, started 24000)&gt;]</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;_MainThread(MainThread, started 24000)&gt; &lt;Thread(worker, started 16948)&gt; 2 [&lt;_MainThread(MainThread, started 24000)&gt;, &lt;Thread(worker, started 16948)&gt;]</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">===enb===</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i am working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i am working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i am working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i am working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i am working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">finished</span>
</pre>
</div>

<p>
active_countã€enumerateæ–¹æ³•è¿”å›çš„å€¼è¿˜åŒ…æ‹¬ä¸»çº¿ç¨‹
</p>
</div>
</div>
<div id="outline-container-h:fd554e60-2251-46ce-af33-42f12cb87336" class="outline-5">
<h5 id="h:fd554e60-2251-46ce-af33-42f12cb87336">Threadå®ä¾‹çš„å±æ€§å’Œæ–¹æ³•</h5>
<div class="outline-text-5" id="text-h:fd554e60-2251-46ce-af33-42f12cb87336">
<pre class="example" id="org521dda5">
name  åªæ˜¯ä¸€ä¸ªåå­—ï¼Œåªæ˜¯ä¸ªæ ‡è¯†ï¼Œåç§°å¯ä»¥é‡åã€‚getName()ã€setName()è·å–ã€è®¾ç½®è¿™ä¸ªåè¯
ident çº¿ç¨‹IDï¼Œå®ƒæ˜¯é0æ•´æ•°ã€‚çº¿ç¨‹å¯åŠ¨åæ‰ä¼šæœ‰IDï¼Œå¦åˆ™ä¸ºNoneã€‚çº¿ç¨‹é€€å‡ºï¼Œæ­¤IDä¾æ—§å¯ä»¥è®¿é—®ã€‚æ­¤IDå¯ä»¥é‡å¤ä½¿ç”¨
is_alive()  è¿”å›çº¿ç¨‹æ˜¯å¦æ´»ç€
</pre>

<p>
æ³¨æ„ï¼šçº¿ç¨‹çš„nameè¿™æ˜¯ä¸€ä¸ªåç§°ï¼Œå¯ä»¥é‡å¤ï¼›IDå¿…é¡»å”¯ä¸€ï¼Œä½†å¯ä»¥åœ¨çº¿ç¨‹é€€å‡ºåå†åˆ©ç”¨
</p>

<p>
èŒƒä¾‹ï¼š
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(count, name):
    <span style="color: #a0522d;">c</span> = threading.current_thread()
    <span style="color: #483d8b;">print</span>(c.name, c.ident, <span style="color: #8b2252;">'~~~~'</span>, t1, t1 <span style="color: #a020f0;">is</span> c) <span style="color: #b22222;">#</span><span style="color: #b22222;">t1, c&#26159;&#19968;&#20010;&#32447;&#31243;&#23545;&#35937;</span>
    <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
    <span style="color: #b22222;"># </span><span style="color: #b22222;">for i in range(count):</span>
        time.sleep(1)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} working'</span>.<span style="color: #483d8b;">format</span>(name))
        <span style="color: #a0522d;">count</span> += 1
        <span style="color: #a020f0;">if</span> count &gt; 3:
            <span style="color: #a020f0;">break</span>
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Finished'</span>)

<span style="color: #a0522d;">t1</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker1'</span>, args=(0, <span style="color: #8b2252;">'w1'</span>))
<span style="color: #483d8b;">print</span>(t1.name, t1.ident, t1.is_alive(), <span style="color: #8b2252;">'++++'</span>)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32447;&#31243;&#27809;&#26377;&#34987;&#21019;&#24314;&#26159;&#27809;&#26377;&#32447;&#31243;id&#30340;</span>
time.sleep(1)
t1.start() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#21160;&#19968;&#20010;&#32447;&#31243;</span>
time.sleep(1)
<span style="color: #483d8b;">print</span>(t1.name, t1.ident, t1.is_alive(), <span style="color: #8b2252;">'----'</span>)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32447;&#31243;&#34987;&#21019;&#24314;&#21518;&#26377;&#32447;&#31243;id</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'==end=='</span>)
time.sleep(8) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#21069;&#32447;&#31243;&#31561;&#24453;8&#31186;&#65292; </span>
<span style="color: #483d8b;">print</span>(t1.name, t1.ident, t1.is_alive(), <span style="color: #8b2252;">'****'</span>)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32447;&#31243;&#34987;&#21019;&#24314;&#21518;&#26377;&#32447;&#31243;id</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">worker1 None False ++++</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">worker1 25968 ~~~~ &lt;Thread(worker1, started 25968)&gt; True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">worker1 25968 True ----</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">w1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">==end==</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">w1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">w1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">w1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">worker1 25968 False ****</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(count, name):
    <span style="color: #a0522d;">c</span> = threading.current_thread()
    <span style="color: #483d8b;">print</span>(c.name, c.ident, <span style="color: #8b2252;">'~~~~'</span>, t1, t1 <span style="color: #a020f0;">is</span> c) <span style="color: #b22222;">#</span><span style="color: #b22222;">t1, c&#26159;&#19968;&#20010;&#32447;&#31243;&#23545;&#35937;</span>
    <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
    <span style="color: #b22222;"># </span><span style="color: #b22222;">for i in range(count):</span>
        time.sleep(1)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} working'</span>.<span style="color: #483d8b;">format</span>(name))
        <span style="color: #a0522d;">count</span> += 1
        <span style="color: #a020f0;">if</span> count &gt; 3:
            <span style="color: #a020f0;">break</span>
            <span style="color: #b22222;">#</span><span style="color: #b22222;">1/0</span>
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Finished'</span>)

<span style="color: #a0522d;">t1</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker1'</span>, args=(0, <span style="color: #8b2252;">'w1'</span>))
time.sleep(1)
t1.start() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#21160;&#19968;&#20010;&#32447;&#31243;</span>
time.sleep(1)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'==end=='</span>)

<span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20027;&#32447;&#31243;</span>
    time.sleep(1)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} {} {}'</span>.<span style="color: #483d8b;">format</span>(
        t1.name, t1.ident,<span style="color: #8b2252;">'alive'</span> <span style="color: #a020f0;">if</span> t1.is_alive() <span style="color: #a020f0;">else</span> <span style="color: #8b2252;">'dead'</span>))

    <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> t1.is_alive():
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} restart'</span>.<span style="color: #483d8b;">format</span>(t1.name))
        t1.start() <span style="color: #b22222;"># </span><span style="color: #b22222;">RuntimeError: threads can only be started once</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">start&#26041;&#27861;&#23545;&#21516;&#19968;&#20010;&#32447;&#31243;&#23545;&#35937;&#21482;&#33021;&#29992;&#19968;&#27425;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">worker1 22548 ~~~~ &lt;Thread(worker1, started 22548)&gt; True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">w1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">==end==</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">w1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">worker1 22548 alive</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">w1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">worker1 22548 alive</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">w1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">worker1 22548 dead</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">worker1 restart</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Traceback (most recent call last):</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">File "d:\project\pyproj\cursor\t2.py", line 30, in &lt;module&gt;</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">t1.start() # RuntimeError: threads can only be started once</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">~~~~~~~~^^</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">File "D:\py\py313\Lib\threading.py", line 967, in start</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">raise RuntimeError("threads can only be started once")</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">RuntimeError: threads can only be started once</span>
</pre>
</div>

<ul class="org-ul">
<li>start() å¯åŠ¨çº¿ç¨‹ã€‚æ¯ä¸€ä¸ªçº¿ç¨‹å¿…é¡»ä¸”åªèƒ½æ‰§è¡Œè¯¥æ–¹æ³•ä¸€æ¬¡</li>
<li>run() è¿è¡Œçº¿ç¨‹å‡½æ•°</li>
</ul>

<p>
start()æ–¹æ³•ä¼šè°ƒç”¨run()æ–¹æ³•ï¼Œè€Œrun()æ–¹æ³•å¯ä»¥è¿è¡Œå‡½æ•°ã€‚
</p>
</div>
<ul class="org-ul">
<li><a id="h:83c931d0-bfb3-4c1a-acaa-94743407a261"></a>startå’Œrunçš„åŒºåˆ«<br>
<div class="outline-text-6" id="text-h:83c931d0-bfb3-4c1a-acaa-94743407a261">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyThread</span>(threading.Thread):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">start</span>(<span style="color: #a020f0;">self</span>) -&gt; <span style="color: #008b8b;">None</span>: <span style="color: #b22222;">#</span><span style="color: #b22222;">override &#22312;&#36825;&#37324;&#38500;&#20102;&#35206;&#30422;&#65292;&#36824;&#35201;&#35843;&#29992;&#29238;&#31867;&#30340;&#21516;&#21517;&#26041;&#27861;</span>
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'start~~~~'</span>)
        <span style="color: #483d8b;">super</span>().start()

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">run</span>(<span style="color: #a020f0;">self</span>) -&gt; <span style="color: #008b8b;">None</span>:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'run~~~~'</span>)
        <span style="color: #483d8b;">super</span>().run()

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(count, name):
    <span style="color: #483d8b;">print</span>(threading.<span style="color: #483d8b;">enumerate</span>())
    <span style="color: #b22222;"># </span><span style="color: #b22222;">while True:</span>
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(3):
        time.sleep(1)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} working'</span>.<span style="color: #483d8b;">format</span>(name))
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Finished'</span>)

<span style="color: #a0522d;">t1</span> = MyThread(target=worker, name=<span style="color: #8b2252;">'worker1'</span>, args=(0, <span style="color: #8b2252;">'w1'</span>))
time.sleep(1)
<span style="color: #b22222;"># </span><span style="color: #b22222;">t1.start() #&#21551;&#21160;&#19968;&#20010;&#32447;&#31243; -&gt; &#20250;&#35843;&#29992;run&#26041;&#27861;&#65292;&#24182;&#34892;&#12290;start&#24517;&#39035;&#20135;&#29983;&#19968;&#20010;&#25805;&#20316;&#31995;&#32479;&#30340;&#30495;&#27491;&#30340;&#26032;&#32447;&#31243;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">start&#20250;&#38459;&#22622;&#21527;&#65311;&#27809;&#26377;&#65292;&#22240;&#20026;&#23427;&#20250;&#31435;&#21363;&#36820;&#22238;&#12290;</span>
t1.run() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30452;&#25509;&#35843;&#29992;run&#26041;&#27861;. &#21644;start&#26041;&#27861;&#19968;&#26679;&#21482;&#33021;&#29992;&#19968;&#27425;&#12290;&#20018;&#34892;&#25191;&#34892;. &#21482;&#26377;&#19968;&#20010;&#32447;&#31243;&#65292;&#20027;&#12290;&#26680;&#24515;&#35843;&#29992;&#20102;target&#26041;&#27861;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">run &#19981;&#20250;&#20135;&#29983;&#32447;&#31243;&#12290;&#22312;&#19968;&#20010;&#32447;&#31243;&#20869;&#65292;&#31243;&#24207;&#19968;&#23450;&#26159;&#25353;&#39034;&#24207;&#25191;&#34892;&#30340;&#65292;&#19981;&#21487;&#20197;&#24182;&#34892;&#12290;</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'==end=='</span>)


<span style="color: #b22222;">#</span><span style="color: #b22222;">&#30452;&#25509;&#35843;&#29992;run&#26041;&#27861;&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">run~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">[&lt;_MainThread(MainThread, started 29348)&gt;]</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">w1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">w1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">w1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">==end==</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">start&#26041;&#27861;&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">run~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">==end==</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">[&lt;_MainThread(MainThread, started 9192)&gt;, &lt;MyThread(worker1, started 14192)&gt;]</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">w1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">w1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">w1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Finished</span>
</pre>
</div>


<ul class="org-ul">
<li>ä½¿ç”¨startæ–¹æ³•å¯åŠ¨çº¿ç¨‹ï¼Œå¯åŠ¨äº†ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œåå­—å«åšworkerè¿è¡Œã€‚</li>
<li>ä½†æ˜¯ä½¿ç”¨runæ–¹æ³•çš„ï¼Œå¹¶æ²¡æœ‰å¯åŠ¨æ–°çš„çº¿ç¨‹ï¼Œå°±æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨äº†ä¸€ä¸ªæ™®é€šçš„å‡½æ•°è€Œå·²ã€‚</li>
</ul>

<p>
å› æ­¤ï¼Œå¯åŠ¨çº¿ç¨‹è¯·ä½¿ç”¨startæ–¹æ³•ï¼Œä¸”å¯¹äºè¿™ä¸ªçº¿ç¨‹æ¥è¯´ï¼Œstartæ–¹æ³•åªèƒ½è°ƒç”¨ä¸€æ¬¡ã€‚ï¼ˆè®¾ç½®_startedå±æ€§å®ç°ï¼‰
</p>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-h:fe6e5200-c810-4ebc-8944-8f64f954bfb9" class="outline-4">
<h4 id="h:fe6e5200-c810-4ebc-8944-8f64f954bfb9">å¤šçº¿ç¨‹</h4>
<div class="outline-text-4" id="text-h:fe6e5200-c810-4ebc-8944-8f64f954bfb9">
<p>
é¡¾åæ€ä¹‰ï¼Œå¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹è¿è¡Œï¼Œå°±æ˜¯å¤šçº¿ç¨‹ï¼Œå®ç°ä¸€ç§å¹¶å‘ã€‚
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    <span style="color: #a0522d;">t</span> = threading.current_thread()
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5):
        time.sleep(1)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'i an working'</span>, t.name, t.ident)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'finished'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyTread</span>(threading.Thread):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">start</span>(<span style="color: #a020f0;">self</span>) -&gt; <span style="color: #008b8b;">None</span>:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'start~~~~~'</span>)
        <span style="color: #483d8b;">super</span>().start()

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">run</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'run~~~~~'</span>)
        <span style="color: #483d8b;">super</span>().run()

<span style="color: #a0522d;">t1</span> = MyTread(target=worker, name=<span style="color: #8b2252;">'worker1'</span>)
<span style="color: #a0522d;">t2</span> = MyTread(target=worker, name=<span style="color: #8b2252;">'worker2'</span>)
t1.start()
t2.start()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">start~~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">run~~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">start~~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">run~~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working worker1 28736</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working worker2 27012</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working worker1 28736</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working worker2 27012</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working worker2 27012</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working worker1 28736</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working worker1 28736</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working worker2 27012</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working worker1 28736</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working worker2 27012</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">finished</span>
</pre>
</div>

<p>
å¯ä»¥çœ‹åˆ°worker1å’Œwork2äº¤æ›¿æ‰§è¡Œï¼Œæ”¹æˆrunæ–¹æ³•è¯•è¯•çœ‹
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    <span style="color: #a0522d;">t</span> = threading.current_thread()
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5):
        time.sleep(1)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'i an working'</span>, t.name, t.ident)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'finished'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyTread</span>(threading.Thread):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">start</span>(<span style="color: #a020f0;">self</span>) -&gt; <span style="color: #008b8b;">None</span>:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'start~~~~~'</span>)
        <span style="color: #483d8b;">super</span>().start()

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">run</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'run~~~~~'</span>)
        <span style="color: #483d8b;">super</span>().run()

<span style="color: #a0522d;">t1</span> = MyTread(target=worker, name=<span style="color: #8b2252;">'worker1'</span>)
<span style="color: #a0522d;">t2</span> = MyTread(target=worker, name=<span style="color: #8b2252;">'worker2'</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">t1.start()</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t2.start()</span>
t1.run()
t2.run()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">run~~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working MainThread 5904</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working MainThread 5904</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working MainThread 5904</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working MainThread 5904</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working MainThread 5904</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">run~~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working MainThread 5904</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working MainThread 5904</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working MainThread 5904</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working MainThread 5904</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">i an working MainThread 5904</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">finished</span>
</pre>
</div>

<p>
æ²¡æœ‰å¼€æ–°çš„çº¿ç¨‹ï¼Œè¿™å°±æ˜¯æ™®é€šå‡½æ•°è°ƒç”¨ï¼Œæ‰€ä»¥æ‰§è¡Œå®Œt1.run()ï¼Œç„¶åæ‰§è¡Œt2.run()ï¼Œè¿™é‡Œå°±ä¸æ˜¯å¤šçº¿ç¨‹ã€‚
</p>

<p>
å½“ä½¿ç”¨startæ–¹æ³•å¯åŠ¨çº¿ç¨‹åï¼Œè¿›ç¨‹å†…æœ‰å¤šä¸ªæ´»åŠ¨çš„çº¿ç¨‹å¹¶è¡Œçš„å·¥ä½œï¼Œå°±æ˜¯å¤šçº¿ç¨‹ã€‚
</p>

<p>
ä¸€ä¸ªè¿›ç¨‹ä¸­è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶ä½œä¸ºç¨‹åºçš„å…¥å£ï¼Œè¿™ä¸ªçº¿ç¨‹å°±æ˜¯ <b>ä¸»çº¿ç¨‹</b> ã€‚
</p>

<p>
ä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ã€‚
</p>

<p>
å…¶ä»–çº¿ç¨‹ç§°ä¸º <b>å·¥ä½œçº¿ç¨‹</b>
</p>
</div>
</div>
<div id="outline-container-h:17f041eb-2065-4f5a-80c3-e839c2a4564e" class="outline-4">
<h4 id="h:17f041eb-2065-4f5a-80c3-e839c2a4564e">daemonçº¿ç¨‹å’Œnon-daemonçº¿ç¨‹</h4>
<div class="outline-text-4" id="text-h:17f041eb-2065-4f5a-80c3-e839c2a4564e">
<p>
æ³¨æ„ï¼šæœ‰äººç¿»è¯‘æˆåå°çº¿ç¨‹ï¼Œä¹Ÿæœ‰äººç¿»è¯‘æˆå®ˆæŠ¤è¿›ç¨‹ã€‚
</p>

<p>
Pythonä¸­ï¼Œæ„é€ çº¿ç¨‹çš„æ—¶å€™ï¼Œå¯ä»¥è®¾ç½®daemonå±æ€§ï¼Œè¿™ä¸ªå±æ€§å¿…é¡»åœ¨startæ–¹æ³•å‰è®¾ç½®å¥½ã€‚
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#28304;&#30721;Thread&#30340;__init__&#26041;&#27861;&#20013;</span>
<span style="color: #a020f0;">if</span> daemon <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #008b8b;">None</span>:
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_daemonic</span> = daemon <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29992;&#25143;&#35774;&#23450;bool&#20540;</span>
<span style="color: #a020f0;">else</span>:
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_daemonic</span> = current_thread().daemon        
</pre>
</div>

<p>
çº¿ç¨‹daemonå±æ€§ï¼Œå¦‚æœè®¾å®šå°±æ˜¯ç”¨æˆ·çš„è®¾ç½®ï¼Œå¦åˆ™å°±å–å½“å‰çº¿ç¨‹çš„daemonå€¼ã€‚
</p>

<p>
ä¸»çº¿ç¨‹æ˜¯non-daemonçº¿ç¨‹ï¼Œå³daemon = Falseã€‚
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">_MainThread</span>(Thread):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        Thread.__init__(<span style="color: #a020f0;">self</span>, name=<span style="color: #8b2252;">"MainThread"</span>, daemon=<span style="color: #008b8b;">False</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(name, interval=1):
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5):
        time.sleep(interval)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} working'</span>.<span style="color: #483d8b;">format</span>(name))

<span style="color: #a0522d;">t</span> = threading.Thread(target=worker, args=(<span style="color: #8b2252;">'t1'</span>, 1))
t.start()

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'==end=='</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">==end==</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t1 working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t1 working</span>
</pre>
</div>

<p>
å‘ç°çº¿ç¨‹tä¾ç„¶æ‰§è¡Œï¼Œä¸»çº¿ç¨‹å·²ç»æ‰§è¡Œå®Œï¼Œä½†æ˜¯ä¸€ç›´ç­‰ç€çº¿ç¨‹tã€‚
</p>

<p>
ä¿®æ”¹ä¸º t = threading.Thread(target=foo, daemon=True)
</p>

<p>
ç¨‹åºç«‹å³ç»“æŸäº†ï¼Œä¸»çº¿ç¨‹æ ¹æœ¬æ²¡æœ‰ç­‰çº¿ç¨‹tã€‚
</p>

<div class="org-src-container">
<pre class="src src-sh">daemon&#23646;&#24615;        &#34920;&#31034;&#32447;&#31243;&#26159;&#21542;&#26159;daemon&#32447;&#31243;&#65292;&#36825;&#20010;&#20540;&#24517;&#39035;&#22312;start()&#20043;&#21069;&#35774;&#32622;&#65292;&#21542;&#21017;&#24341;&#21457;RuntimeError&#24322;&#24120;
<span style="color: #0000ff;">isDaemon</span>()      &#26159;&#21542;&#26159;daemon&#32447;&#31243;
setDaemon       &#35774;&#32622;&#20026;daemon&#32447;&#31243;&#65292;&#24517;&#39035;&#22312;start&#26041;&#27861;&#20043;&#21069;&#35774;&#32622;
</pre>
</div>


<p>
è§‚å¯Ÿä¸‹é¢ä»£ç ä¸»çº¿ç¨‹ä½•æ—¶ç»“æŸdaemonçº¿ç¨‹
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(name, interval=1):
    <span style="color: #483d8b;">print</span>(name, <span style="color: #8b2252;">'enter~~~~'</span>)
    time.sleep(interval)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} working ++++'</span>.<span style="color: #483d8b;">format</span>(name))

<span style="color: #a0522d;">t1</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'t1'</span>, args=(<span style="color: #8b2252;">'t1'</span>, 1), daemon=<span style="color: #008b8b;">True</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">False non-daemon &#32447;&#31243;&#65292;&#31561;&#21040;&#35813;&#32447;&#31243;&#32467;&#26463;&#36827;&#31243;&#32467;&#26463;&#65307;True daemon</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(t1.daemon, t1.isDaemon())</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t1.daemon = False</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t1.setDaemon(False) #&#21644;t1.daemon = False &#25928;&#26524;&#19968;&#26679;</span>
t1.start()
<span style="color: #b22222;"># </span><span style="color: #b22222;">t1.setDaemon(True) #&#38169;&#65292;&#24517;&#39035;&#25918;&#22312;start&#20043;&#21069;</span>

<span style="color: #a0522d;">t2</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'t2'</span>, args=(<span style="color: #8b2252;">'t2'</span>, 5), daemon=<span style="color: #008b8b;">False</span>)
t2.start()
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'==end=='</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20027;&#32447;&#31243;&#32467;&#26463;&#20102;&#65292;&#26080;&#20107;&#21487;&#20570;</span>
<span style="color: #483d8b;">print</span>(*threading.<span style="color: #483d8b;">enumerate</span>(), sep=<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21807;&#19968;non-daemon&#32447;&#31243;&#20027;&#32447;&#31243;&#26080;&#20107;&#21487;&#20570;&#65292;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t1 enter~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t2 enter~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">==end==</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;_MainThread(MainThread, started 25192)&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;Thread(t1, started daemon 19144)&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;Thread(t2, started 11740)&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t1 working ++++</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t2 working ++++</span>
</pre>
</div>

<p>
ä¸Šä¾‹è¯´æ˜ï¼Œå¦‚æœé™¤ä¸»çº¿ç¨‹ä¹‹å¤–è¿˜æœ‰non-daemonçº¿ç¨‹çš„æ—¶å€™ï¼Œä¸»çº¿ç¨‹é€€å‡ºæ—¶ï¼Œä¹Ÿä¸
ä¼šæ€æ‰æ‰€æœ‰daemonçº¿ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰non-daemonçº¿ç¨‹å…¨éƒ¨ç»“æŸï¼Œå¦‚æœè¿˜æœ‰daemonçº¿
ç¨‹ï¼Œä¸»çº¿ç¨‹éœ€è¦é€€å‡ºï¼ˆä¸»çº¿ç¨‹é€€å‡ºä¹Ÿå¯ä»¥ç†è§£ä¸ºæœ€åä¸€ä¸ªnon-daemonçº¿ç¨‹ä¹Ÿè¦é€€
å‡ºäº†ï¼‰ï¼Œä¼šç»“æŸæ‰€æœ‰daemonçº¿ç¨‹ï¼Œç¨‹åºé€€å‡ºã€‚
</p>

<p>
æ€»ç»“
</p>
<ul class="org-ul">
<li>çº¿ç¨‹å…·æœ‰ä¸€ä¸ªdaemonå±æ€§ï¼Œå¯ä»¥æ‰‹åŠ¨è®¾ç½®ä¸ºTrueæˆ–Falseï¼Œä¹Ÿå¯ä»¥ä¸è®¾ç½®ï¼Œåˆ™å–é»˜è®¤å€¼Noneã€‚</li>
<li>å¦‚æœä¸è®¾ç½®daemonï¼Œå°±å–å½“å‰çº¿ç¨‹çš„daemonæ¥è®¾ç½®å®ƒã€‚</li>
<li>ä¸»çº¿ç¨‹æ˜¯non-daemonçº¿ç¨‹ï¼Œå³daemon = Falseã€‚</li>
<li>ä»ä¸»çº¿ç¨‹åˆ›å»ºçš„æ‰€æœ‰çº¿ç¨‹çš„ä¸è®¾ç½®daemonå±æ€§ï¼Œåˆ™é»˜è®¤éƒ½æ˜¯daemon = Falseï¼Œä¹Ÿå°±æ˜¯non-daemonçº¿ç¨‹ã€‚</li>
<li>Pythonç¨‹åºåœ¨æ²¡æœ‰æ´»ç€çš„non-daemonçº¿ç¨‹è¿è¡Œæ—¶ï¼Œç¨‹åºé€€å‡ºï¼Œä¹Ÿå°±æ˜¯é™¤ä¸»çº¿ç¨‹
ä¹‹å¤–å‰©ä¸‹çš„åªèƒ½éƒ½æ˜¯daemonçº¿ç¨‹ï¼Œä¸»çº¿ç¨‹æ‰èƒ½é€€å‡ºï¼Œå¦åˆ™ä¸»çº¿ç¨‹å°±åªèƒ½ç­‰å¾…ã€‚</li>
</ul>
</div>
</div>
<div id="outline-container-h:d5d7c611-941c-4e80-83cd-b015c799198f" class="outline-4">
<h4 id="h:d5d7c611-941c-4e80-83cd-b015c799198f">joinæ–¹æ³•</h4>
<div class="outline-text-4" id="text-h:d5d7c611-941c-4e80-83cd-b015c799198f">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>(name, timeout):
    time.sleep(timeout)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} working'</span>.<span style="color: #483d8b;">format</span>(name))

<span style="color: #a0522d;">t1</span> = threading.Thread(target=foo, args=(<span style="color: #8b2252;">'t1'</span>, 5), daemon=<span style="color: #008b8b;">True</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35843;&#25442;5&#21644;10&#30475;&#30475;&#25928;&#26524;</span>
t1.start()
t1.join()<span style="color: #b22222;"># </span><span style="color: #b22222;">&#27704;&#20037;&#38459;&#22622;&#65292;&#21040;t1&#32447;&#31243;&#32447;&#26463;&#36816;&#34892;</span>

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Main Thread Exits'</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;</span>
t1 working
Main Thread Exits
</pre>
</div>

<ul class="org-ul">
<li>ä½¿ç”¨äº†joinæ–¹æ³•åï¼Œdaemonçº¿ç¨‹æ‰§è¡Œå®Œäº†ï¼Œä¸»çº¿ç¨‹æ‰é€€å‡ºäº†</li>
<li>å¦‚æœå–æ¶ˆjoinæ–¹æ³•ï¼Œä¸»çº¿ç¨‹æ‰§è¡Œå®Œç›´æ¥é€€å‡º</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>(name, timeout):
    time.sleep(timeout)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} working'</span>.<span style="color: #483d8b;">format</span>(name))

<span style="color: #a0522d;">t1</span> = threading.Thread(target=foo, args=(<span style="color: #8b2252;">'t1'</span>, 5), daemon=<span style="color: #008b8b;">True</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35843;&#25442;5&#21644;10&#30475;&#30475;&#25928;&#26524;</span>
t1.start()
t1.join(2) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20027;&#32447;&#31243;&#31561;&#20102;2&#31186;&#65292;&#38459;&#22622;</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~~~~~~~~~~~'</span>)
t1.join(2)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~~~~~~~~~~~'</span>)

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Main Thread Exits'</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;</span>
~~~~~~~~~~~
~~~~~~~~~~~
Main Thread Exits
</pre>
</div>

<p>
join(timeout=None)ï¼Œæ˜¯çº¿ç¨‹çš„æ ‡å‡†æ–¹æ³•ä¹‹ä¸€
</p>
<ul class="org-ul">
<li>ä¸€ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„joinæ–¹æ³•ï¼Œè°ƒç”¨è€…å°†è¢«é˜»å¡ï¼Œç›´åˆ°è¢«è°ƒç”¨çº¿ç¨‹ç»ˆæ­¢ï¼Œæˆ–é˜»å¡è¶…æ—¶ã€‚</li>
<li>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¢«joinå¤šæ¬¡ã€‚</li>
<li>timeoutå‚æ•°æŒ‡å®šè°ƒç”¨è€…ç­‰å¾…å¤šä¹…ï¼Œæ²¡æœ‰è®¾ç½®è¶…æ—¶ï¼Œå°±ä¸€ç›´ç­‰åˆ°è¢«è°ƒç”¨çº¿ç¨‹ç»“æŸã€‚</li>
<li>è°ƒç”¨è°çš„joinæ–¹æ³•ï¼Œå°±æ˜¯joinè°ï¼Œå°±è¦ç­‰è°ã€‚</li>
</ul>
</div>
</div>
<div id="outline-container-h:7470c0eb-377d-4bfb-a9f1-394440264462" class="outline-4">
<h4 id="h:7470c0eb-377d-4bfb-a9f1-394440264462">daemonçº¿ç¨‹åº”ç”¨åœºæ™¯</h4>
<div class="outline-text-4" id="text-h:7470c0eb-377d-4bfb-a9f1-394440264462">
<p>
ç®€å•æ¥è¯´å°±æ˜¯ï¼Œæœ¬æ¥å¹¶æ²¡æœ‰ daemon threadï¼Œä¸ºäº†ç®€åŒ–ç¨‹åºå‘˜çš„å·¥ä½œï¼Œè®©ä»–ä»¬ä¸
ç”¨å»è®°å½•å’Œç®¡ç†é‚£äº›åå°çº¿ç¨‹ï¼Œåˆ›é€ äº†ä¸€ä¸ª daemon thread çš„æ¦‚å¿µã€‚è¿™ä¸ªæ¦‚å¿µ
å”¯ä¸€çš„ä½œç”¨å°±æ˜¯ï¼Œå½“ä½ æŠŠä¸€ä¸ªçº¿ç¨‹è®¾ç½®ä¸º daemonï¼Œå®ƒå¯ä»¥ä¼šéšä¸»çº¿ç¨‹çš„é€€å‡ºè€Œ
é€€å‡º
</p>

<p>
ä¸»è¦åº”ç”¨åœºæ™¯æœ‰ï¼š
</p>
<ul class="org-ul">
<li>åå°ä»»åŠ¡ã€‚å¦‚å‘é€å¿ƒè·³åŒ…ã€ç›‘æ§ï¼Œè¿™ç§åœºæ™¯æœ€å¤šã€‚</li>
<li>ä¸»çº¿ç¨‹å·¥ä½œæ‰æœ‰ç”¨çš„çº¿ç¨‹ã€‚å¦‚ä¸»çº¿ç¨‹ä¸­ç»´æŠ¤è¿™å…¬å…±çš„èµ„æºï¼Œä¸»çº¿ç¨‹å·²ç»æ¸…ç†äº†ï¼Œå‡†å¤‡é€€å‡ºï¼Œè€Œå·¥ä½œçº¿ç¨‹ä½¿ç”¨è¿™äº›èµ„æºå·¥ä½œä¹Ÿæ²¡æœ‰æ„ä¹‰äº†ï¼Œä¸€èµ·é€€å‡ºæœ€åˆé€‚</li>
<li>éšæ—¶å¯ä»¥è¢«ç»ˆæ­¢çš„çº¿ç¨‹</li>
</ul>

<p>
å¦‚æœä¸»çº¿ç¨‹é€€å‡ºï¼Œæƒ³æ‰€æœ‰å…¶å®ƒå·¥ä½œçº¿ç¨‹ä¸€èµ·é€€å‡ºï¼Œå°±ä½¿ç”¨daemon=Trueæ¥åˆ›å»ºå·¥ä½œçº¿ç¨‹ã€‚
</p>

<p>
æ¯”å¦‚ï¼Œå¼€å¯ä¸€ä¸ªçº¿ç¨‹å®šæ—¶åˆ¤æ–­WEBæœåŠ¡æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œä¸»çº¿ç¨‹é€€å‡ºï¼Œå·¥ä½œçº¿ç¨‹ä¹Ÿ
æ²¡æœ‰å¿…é¡»å­˜åœ¨äº†ï¼Œåº”è¯¥éšç€ä¸»çº¿ç¨‹é€€å‡ºä¸€èµ·é€€å‡ºã€‚è¿™ç§daemonçº¿ç¨‹ä¸€æ—¦åˆ›å»ºï¼Œå°±
å¯ä»¥å¿˜è®°å®ƒäº†ï¼Œåªç”¨å…³å¿ƒä¸»çº¿ç¨‹ä»€ä¹ˆæ—¶å€™é€€å‡ºå°±è¡Œäº†ã€‚
</p>

<p>
daemonçº¿ç¨‹ï¼Œç®€åŒ–äº†ç¨‹åºå‘˜æ‰‹åŠ¨å…³é—­çº¿ç¨‹çš„å·¥ä½œ
</p>

<p>
å¦‚æœåœ¨non-daemonçº¿ç¨‹Aä¸­ï¼Œå¯¹å¦ä¸€ä¸ªdaemonçº¿ç¨‹Bä½¿ç”¨äº†joinæ–¹æ³•ï¼Œè¿™ä¸ªçº¿ç¨‹B
è®¾ç½®æˆdaemonå°±æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰äº†ï¼Œå› ä¸ºnon-daemonçº¿ç¨‹Aæ€»æ˜¯è¦ç­‰å¾…Bã€‚
</p>

<p>
å¦‚æœåœ¨ä¸€ä¸ªdaemonçº¿ç¨‹Cä¸­ï¼Œå¯¹å¦ä¸€ä¸ªdaemonçº¿ç¨‹Dä½¿ç”¨äº†joinæ–¹æ³•ï¼Œåªèƒ½è¯´æ˜C
è¦ç­‰å¾…Dï¼Œä¸»çº¿ç¨‹é€€å‡ºï¼ŒCå’ŒDä¸ç®¡æ˜¯å¦ç»“æŸï¼Œä¹Ÿä¸ç®¡å®ƒä»¬è°ç­‰è°ï¼Œéƒ½è¦è¢«æ€æ‰ã€‚
</p>

<p>
èŒƒä¾‹ï¼š
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker2</span>(name):
    <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
        time.sleep(1)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} working'</span>.<span style="color: #483d8b;">format</span>(name), threading.current_thread().isDaemon())

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker1</span>(name):
    <span style="color: #a0522d;">current</span> = threading.current_thread()
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{}'s daemon = {}"</span>.<span style="color: #483d8b;">format</span>(name, current.isDaemon()))
    <span style="color: #a0522d;">t2</span> = threading.Thread(target=worker2, args=(<span style="color: #8b2252;">'t2'</span>,), name=<span style="color: #8b2252;">'t2'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38544;&#24335; daemon=True&#65292;&#32487;&#25215;&#33258;t1</span>
    t2.start()

<span style="color: #a0522d;">t1</span> = threading.Thread(target=worker1, args=(<span style="color: #8b2252;">'t1'</span>,), daemon=<span style="color: #008b8b;">True</span>, name=<span style="color: #8b2252;">'t1'</span>)
t1.start()

time.sleep(4)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Main Thread Exits'</span>)
<span style="color: #483d8b;">print</span>(threading.active_count(), threading.<span style="color: #483d8b;">enumerate</span>())

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t1 s daemon = True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t2 working True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t2 working True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t2 working True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Main Thread Exits</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2 [&lt;_MainThread(MainThread, started 29620)&gt;, &lt;Thread(t2, started daemon 28036)&gt;]</span>
</pre>
</div>

<p>
ä¸Šä¾‹ï¼Œåªè¦ä¸»çº¿ç¨‹è¦é€€å‡ºï¼Œ2ä¸ªå·¥ä½œçº¿ç¨‹éƒ½ç»“æŸ
</p>

<p>
ä½¿ç”¨joinï¼Œè®©çº¿ç¨‹ä¸ç»“æŸ
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker2</span>(name):
    <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
        time.sleep(1)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} working'</span>.<span style="color: #483d8b;">format</span>(name), threading.current_thread().isDaemon())

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker1</span>(name):
    <span style="color: #a0522d;">current</span> = threading.current_thread()
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"{}'s daemon = {}"</span>.<span style="color: #483d8b;">format</span>(name, current.isDaemon()))
    <span style="color: #a0522d;">t2</span> = threading.Thread(target=worker2, args=(<span style="color: #8b2252;">'t2'</span>,), name=<span style="color: #8b2252;">'t2'</span>, daemon=<span style="color: #008b8b;">True</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38544;&#24335; daemon=True&#65292;&#32487;&#25215;&#33258;t1</span>
    t2.start()
    t2.join() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38459;&#22622;&#65292;&#31561;&#24453;t2&#32467;&#26463;</span>

<span style="color: #a0522d;">t1</span> = threading.Thread(target=worker1, args=(<span style="color: #8b2252;">'t1'</span>,), daemon=<span style="color: #008b8b;">True</span>, name=<span style="color: #8b2252;">'t1'</span>)
t1.start()
t1.join() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38459;&#22622;&#65292;&#31561;&#24453;t1&#32467;&#26463;</span>

time.sleep(4)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Main Thread Exits'</span>)
<span style="color: #483d8b;">print</span>(threading.active_count(), threading.<span style="color: #483d8b;">enumerate</span>())
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:1c3888c8-3158-446f-b826-ad6b17d80dc5" class="outline-3">
<h3 id="h:1c3888c8-3158-446f-b826-ad6b17d80dc5">threading.localç±»</h3>
<div class="outline-text-3" id="text-h:1c3888c8-3158-446f-b826-ad6b17d80dc5">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time 
<span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s %(threadName)s %(thread)d %(message)s"</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO, datefmt=<span style="color: #8b2252;">"%Y-%m-%d %H:%M:%S"</span>)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    <span style="color: #a0522d;">x</span> = 0 <span style="color: #b22222;">#</span><span style="color: #b22222;">x &#38750;&#24120;&#23433;&#20840;</span>
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(1000):
        time.sleep(0.00001)
        <span style="color: #a0522d;">x</span> += 1
    logging.info(<span style="color: #8b2252;">"x = {}"</span>.<span style="color: #483d8b;">format</span>(x))

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(10):
    threading.Thread(target=worker, name=<span style="color: #8b2252;">'w{}'</span>.<span style="color: #483d8b;">format</span>(i)).start()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:51:11 w3 14560 x = 1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:51:11 w0 2604 x = 1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:51:11 w6 11708 x = 1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:51:11 w2 5260 x = 1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:51:11 w9 4248 x = 1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:51:11 w4 12032 x = 1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:51:11 w5 8992 x = 1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:51:11 w8 13044 x = 1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:51:11 w1 15524 x = 1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:51:11 w7 12520 x = 1000</span>
</pre>
</div>

<p>
ä¸Šä¾‹ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å®Œæˆä¸åŒçš„è®¡ç®—ä»»åŠ¡ã€‚
</p>

<p>
xæ˜¯å±€éƒ¨å˜é‡ï¼Œå¯ä»¥çœ‹å‡ºæ¯ä¸€ä¸ªçº¿ç¨‹çš„xæ˜¯ç‹¬ç«‹çš„ï¼Œäº’ä¸å¹²æ‰°çš„
</p>

<ul class="org-ul">
<li>æ”¹é€ æˆå…¨å±€å˜é‡</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time 
<span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s %(threadName)s %(thread)d %(message)s"</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO, datefmt=<span style="color: #8b2252;">"%Y-%m-%d %H:%M:%S"</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">x</span> = 0

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20840;&#23616;&#23545;&#35937;</span>
<span style="color: #a0522d;">global_data</span> = A()
<span style="color: #b22222;"># </span><span style="color: #b22222;">x = 0</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    <span style="color: #b22222;"># </span><span style="color: #b22222;">global x</span>
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(1000):
        time.sleep(0.00001)
        global_data.<span style="color: #a0522d;">x</span> += 1
        <span style="color: #b22222;"># </span><span style="color: #b22222;">x += 1</span>
    logging.info(<span style="color: #8b2252;">"x = {}"</span>.<span style="color: #483d8b;">format</span>(global_data.x))

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(10):
    threading.Thread(target=worker, name=<span style="color: #8b2252;">'w{}'</span>.<span style="color: #483d8b;">format</span>(i)).start()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:46:45 w0 12256 x = 9916</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:46:45 w3 13540 x = 9943</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:46:45 w2 12872 x = 9962</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:46:45 w5 3256 x = 9966</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:46:45 w1 5032 x = 9969</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:46:45 w4 4720 x = 9985</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:46:45 w6 4188 x = 9991</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:46:45 w7 5152 x = 9995</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:46:45 w9 16268 x = 9999</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-05 23:46:45 w8 17668 x = 10000</span>
</pre>
</div>

<p>
ä¸Šä¾‹è™½ç„¶ä½¿ç”¨äº†å…¨å±€å¯¹è±¡ï¼Œä½†æ˜¯çº¿ç¨‹ä¹‹é—´äº’ç›¸å¹²æ‰°ï¼Œå¯¼è‡´äº†ä¸æœŸæœ›çš„ç»“æœã€‚ <b>çº¿ç¨‹ä¸å®‰å…¨</b> ã€‚
</p>

<p>
èƒ½ä¸èƒ½æ—¢ä½¿ç”¨å…¨å±€å¯¹è±¡ï¼Œè¿˜èƒ½ä¿æŒæ¯ä¸ªçº¿ç¨‹ä½¿ç”¨ä¸åŒçš„æ•°æ®å‘¢ï¼Ÿ
</p>

<p>
é€šè¿‡è¿™ä¸ªä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨äº†å¤šçº¿ç¨‹å¯¼è‡´ç»“æœå®Œå…¨ä¸ç¡®å®šï¼ŒåŸå› åœ¨Aç±»ä¸Šï¼Œæˆ‘ä»¬ç§°è¿™ä¸ª <b>çº¿ç¨‹ä¸å®‰å…¨</b> ã€‚
</p>

<blockquote>
<p>
çº¿ç¨‹å®‰å…¨
</p>
<ul class="org-ul">
<li>å¤šçº¿ç¨‹æ‰§è¡Œä¸€æ®µä»£ç ï¼Œä¸äº§ç”Ÿä¸ç¡®å®šçš„ç»“æœï¼Œé‚£è¿™æ®µä»£ç å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>
</ul>
</blockquote>

<p>
pythonæä¾›threading.local ç±»ï¼Œå°†è¿™ä¸ªç±»å®ä¾‹åŒ–å¾—åˆ°ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œä½†æ˜¯ä¸åŒçš„çº¿ç¨‹ä½¿ç”¨è¿™ä¸ªå¯¹è±¡å­˜å‚¨çš„æ•°æ®ã€‚å…¶ä»–çº¿ç¨‹çœ‹ä¸è§ã€‚
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time 
<span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s %(threadName)s %(thread)d %(message)s"</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO, datefmt=<span style="color: #8b2252;">"%Y-%m-%d %H:%M:%S"</span>)


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20840;&#23616;&#23545;&#35937;</span>
<span style="color: #a0522d;">global_data</span> = threading.local()

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    global_data.<span style="color: #a0522d;">x</span> = 0
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(1000):
        time.sleep(0.00001)
        global_data.<span style="color: #a0522d;">x</span> += 1
    logging.info(<span style="color: #8b2252;">"x = {}"</span>.<span style="color: #483d8b;">format</span>(global_data.x))

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(10):
    threading.Thread(target=worker, name=<span style="color: #8b2252;">'w{}'</span>.<span style="color: #483d8b;">format</span>(i)).start()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-06 00:01:48 w2 14064 x = 100</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-06 00:01:48 w4 7008 x = 1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-06 00:01:48 w8 3540 x = 1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-06 00:01:48 w1 19008 x = 100</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-06 00:01:48 w7 14404 x = 100</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-06 00:01:48 w6 1564 x = 1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-06 00:01:48 w0 14412 x = 100</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-06 00:01:48 w3 18144 x = 100</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-06 00:01:48 w5 872 x = 1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-06 00:01:48 w9 3496 x = 1000</span>
</pre>
</div>

<p>
ç»“æœæ˜¾ç¤ºå’Œä½¿ç”¨å±€éƒ¨å˜é‡çš„æ•ˆæœä¸€æ ·ã€‚
</p>

<ul class="org-ul">
<li>å†çœ‹threading.localçš„ä¾‹å­</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a0522d;">X</span> = <span style="color: #8b2252;">'abc'</span>
<span style="color: #a0522d;">global_data</span> = threading.local() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27880;&#24847;&#36825;&#20010;&#23545;&#35937;&#25152;&#22788;&#30340;&#32447;&#31243;</span>
global_data.<span style="color: #a0522d;">x</span> = 100 <span style="color: #b22222;">#</span><span style="color: #b22222;">threading.local &#23545;&#35937;, &#23646;&#24615;&#21019;&#24314;&#22312;&#20160;&#20040;&#32447;&#31243;&#65292;&#20160;&#20040;&#32447;&#31243;&#21487;&#29992;</span>

<span style="color: #483d8b;">print</span>(global_data, <span style="color: #483d8b;">type</span>(global_data), global_data.x)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    <span style="color: #483d8b;">print</span>(X)
    <span style="color: #483d8b;">print</span>(global_data)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">print(global_data.x) # AttributeError: '_thread._local' object has no attribute 'x'</span>
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'in worker'</span>)

worker()
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
threading.Thread(target=worker).start()

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;_thread._local object at 0x0000022C6D77E938&gt; &lt;class '_thread._local'&gt; 100</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">abc</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;_thread._local object at 0x0000022C6D77E938&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">in worker</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">------------------------------</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">abc</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;_thread._local object at 0x0000022C6D77E938&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">in worker</span>
</pre>
</div>

<ul class="org-ul">
<li>å†å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œprint(global_data.x)ä¼šæŠ›AttributeError: '_thread._local' object has no attribute 'x'é”™è¯¯ï¼Œä½†æ˜¯global_dataæ‰“å°æ²¡æœ‰å‡ºé”™ï¼Œè¯´æ˜çœ‹åˆ°global_dataï¼Œè€Œglobal_dataä¸­çš„xçœ‹ä¸åˆ°ï¼Œæ‰€ä»¥è¿™ä¸ªxä¸èƒ½è·¨çº¿ç¨‹ã€‚</li>
<li>threading.localç±»æ„å»ºäº†ä¸€ä¸ªå¤§å­—å…¸ï¼Œå­˜æ”¾æ‰€æœ‰çº¿ç¨‹ç›¸å…³çš„å­—å…¸ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š
<ul class="org-ul">
<li><code>{ id(Thread) -&gt; (ref(Thread), thread-local dict) }</code></li>
<li>æ¯ä¸€çº¿ç¨‹å®ä¾‹çš„idä¸ºkeyï¼Œå…ƒç»„ä¸ºvalue, valueä¸­2éƒ¨åˆ†ä¸ºï¼Œçº¿ç¨‹å¯¹è±¡å¼•ç”¨ï¼Œæ¯ä¸ªçº¿ç¨‹è‡ªå·±çš„å­—å…¸</li>
</ul></li>
</ul>

<p>
æœ¬è´¨
</p>
<ul class="org-ul">
<li>è¿è¡Œæ—¶ï¼Œthreading.localå®ä¾‹å¤„åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ï¼Œå°±ä»å¤§å­—å…¸ä¸­æ‰¾åˆ°å½“å‰çº¿ç¨‹ç›¸å…³é”®å€¼å¯¹ä¸­çš„å­—å…¸ï¼Œè¦†ç›–threading.localå®ä¾‹çš„ <code>__dict__</code></li>
<li>è¿™æ ·å°±å¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ï¼Œå®‰å…¨åœ°ä½¿ç”¨çº¿ç¨‹ç‹¬æœ‰çš„æ•°æ®ï¼Œåšåˆ°äº†çº¿ç¨‹é—´æ•°æ®éš”ç¦»ï¼Œå¦‚åŒæœ¬åœ°å˜é‡ä¸€æ ·å®‰å…¨</li>
</ul>


<p>
threading.local()æºç è§£è¯»
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">local&#28304;&#30721;</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">_localimpl</span>:
    <span style="color: #8b2252;">"""A class managing thread-local dicts"""</span>
    <span style="color: #a0522d;">__slots__</span> = <span style="color: #8b2252;">'key'</span>, <span style="color: #8b2252;">'dicts'</span>, <span style="color: #8b2252;">'localargs'</span>, <span style="color: #8b2252;">'locallock'</span>, <span style="color: #8b2252;">'__weakref__'</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">key</span> = <span style="color: #8b2252;">'_threading_local._localimpl.'</span> + <span style="color: #483d8b;">str</span>(<span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))
        <span style="color: #b22222;"># </span><span style="color: #b22222;">{ id(Thread) -&gt; (ref(Thread), thread-local dict) }</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">dicts</span> = {}

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_dict</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #8b2252;">"""Return the dict for the current thread. Raises KeyError if none</span>
<span style="color: #8b2252;">        defined."""</span>
        <span style="color: #a0522d;">thread</span> = current_thread()
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.dicts[<span style="color: #483d8b;">id</span>(thread)][1]

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">create_dict</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #8b2252;">"""Create a new dict for the current thread, and return it."""</span>
        <span style="color: #a0522d;">localdict</span> = {}
        <span style="color: #a0522d;">key</span> = <span style="color: #a020f0;">self</span>.key
        <span style="color: #a0522d;">thread</span> = current_thread()
        <span style="color: #a0522d;">idt</span> = <span style="color: #483d8b;">id</span>(thread)
        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">local_deleted</span>(_, key=key):
            <span style="color: #a0522d;">thread</span> = wrthread()
            <span style="color: #a020f0;">if</span> thread <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #008b8b;">None</span>:
                <span style="color: #a020f0;">del</span> thread.<span style="color: #483d8b;">__dict__</span>[key]
        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">thread_deleted</span>(_, idt=idt):
            <span style="color: #a0522d;">local</span> = wrlocal()
            <span style="color: #a020f0;">if</span> local <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #008b8b;">None</span>:
                <span style="color: #a0522d;">dct</span> = local.dicts.pop(idt)
        <span style="color: #a0522d;">wrlocal</span> = ref(<span style="color: #a020f0;">self</span>, local_deleted)
        <span style="color: #a0522d;">wrthread</span> = ref(thread, thread_deleted)
        thread.<span style="color: #483d8b;">__dict__</span>[key] = wrlocal
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">dicts</span>[idt] = wrthread, localdict
        <span style="color: #a020f0;">return</span> localdict

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">local</span>:
    <span style="color: #a0522d;">__slots__</span> = <span style="color: #8b2252;">'_local__impl'</span>, <span style="color: #8b2252;">'__dict__'</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__new__</span>(cls, /, *args, **kw):
        <span style="color: #a020f0;">if</span> (args <span style="color: #a020f0;">or</span> kw) <span style="color: #a020f0;">and</span> (cls.__init__ <span style="color: #a020f0;">is</span> <span style="color: #483d8b;">object</span>.__init__):
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">TypeError</span>(<span style="color: #8b2252;">"Initialization arguments are not supported"</span>)
        <span style="color: #a020f0;">self</span> = <span style="color: #483d8b;">object</span>.__new__(cls)
        <span style="color: #a0522d;">impl</span> = _localimpl()
        impl.<span style="color: #a0522d;">localargs</span> = (args, kw)
        impl.<span style="color: #a0522d;">locallock</span> = RLock()
        <span style="color: #483d8b;">object</span>.__setattr__(<span style="color: #a020f0;">self</span>, <span style="color: #8b2252;">'_local__impl'</span>, impl)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">We need to create the thread dict in anticipation of</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">__init__ being called, to make sure we don't call it</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">again ourselves.</span>
        impl.create_dict()
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__getattribute__</span>(<span style="color: #a020f0;">self</span>, name):
        <span style="color: #a020f0;">with</span> _patch(<span style="color: #a020f0;">self</span>):
            <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">object</span>.__getattribute__(<span style="color: #a020f0;">self</span>, name)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__setattr__</span>(<span style="color: #a020f0;">self</span>, name, value):
        <span style="color: #a020f0;">if</span> name == <span style="color: #8b2252;">'__dict__'</span>:
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">AttributeError</span>(
                <span style="color: #8b2252;">"%r object attribute '__dict__' is read-only"</span>
                % <span style="color: #a020f0;">self</span>.__class__.<span style="color: #483d8b;">__name__</span>)
        <span style="color: #a020f0;">with</span> _patch(<span style="color: #a020f0;">self</span>):
            <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">object</span>.__setattr__(<span style="color: #a020f0;">self</span>, name, value)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__delattr__</span>(<span style="color: #a020f0;">self</span>, name):
        <span style="color: #a020f0;">if</span> name == <span style="color: #8b2252;">'__dict__'</span>:
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">AttributeError</span>(
                <span style="color: #8b2252;">"%r object attribute '__dict__' is read-only"</span>
                % <span style="color: #a020f0;">self</span>.__class__.<span style="color: #483d8b;">__name__</span>)
        <span style="color: #a020f0;">with</span> _patch(<span style="color: #a020f0;">self</span>):
            <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">object</span>.__delattr__(<span style="color: #a020f0;">self</span>, name)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">local</span>:
    <span style="color: #a0522d;">__slots__</span> = <span style="color: #8b2252;">'_local__impl'</span>, <span style="color: #8b2252;">'__dict__'</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__new__</span>(cls, /, *args, **kw):
        &#21019;&#24314;local&#30340;&#23454;&#20363;&#24182;&#36820;&#22238;
        local&#23454;&#20363;&#21019;&#24314;&#20102;&#19968;&#20010;&#23646;&#24615;
        <span style="color: #483d8b;">setattr</span>(<span style="color: #a020f0;">self</span>, <span style="color: #8b2252;">'xxx'</span>, value) &#31561;&#20215;self.<span style="color: #a0522d;">xxx</span> =value &#37117;&#26159;&#35201;&#20351;&#29992;&#35813;&#31867;&#22411;&#23450;&#20041;&#30340;
        __setattr__&#26041;&#27861;&#65292;&#26412;&#36136;&#35843;&#29992;&#22522;&#31867;&#30340;&#35813;&#26041;&#27861;&#65292;&#35753;&#20182;&#24110;&#20320;&#23436;&#25104;&#23646;&#24615;&#30340;&#35774;&#32622;&#12290;
        local&#23454;&#20363;&#21019;&#24314;&#20102;_local__impl&#23646;&#24615;&#65292;&#26159;_localimpl&#23454;&#20363;(key, dicts{})
        impl.create_dict()
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__getattribute__</span>(<span style="color: #a020f0;">self</span>, name):
        <span style="color: #a020f0;">with</span> _patch(<span style="color: #a020f0;">self</span>):
            <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">object</span>.__getattribute__(<span style="color: #a020f0;">self</span>, name)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__setattr__</span>(<span style="color: #a020f0;">self</span>, name, value):
        <span style="color: #a020f0;">if</span> name == <span style="color: #8b2252;">'__dict__'</span>:
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">AttributeError</span>(
                <span style="color: #8b2252;">"%r object attribute '__dict__' is read-only"</span>
                % <span style="color: #a020f0;">self</span>.__class__.<span style="color: #483d8b;">__name__</span>)
        <span style="color: #a020f0;">with</span> _patch(<span style="color: #a020f0;">self</span>):
            <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">object</span>.__setattr__(<span style="color: #a020f0;">self</span>, name, value)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">_localimpl</span>:
    <span style="color: #8b2252;">"""A class managing thread-local dicts"""</span>
    <span style="color: #a0522d;">__slots__</span> = <span style="color: #8b2252;">'key'</span>, <span style="color: #8b2252;">'dicts'</span>, <span style="color: #8b2252;">'localargs'</span>, <span style="color: #8b2252;">'locallock'</span>, <span style="color: #8b2252;">'__weakref__'</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">key</span> = <span style="color: #8b2252;">'_threading_local._localimpl.'</span> + <span style="color: #483d8b;">str</span>(<span style="color: #483d8b;">id</span>(<span style="color: #a020f0;">self</span>))
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">dicts</span> = {}

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_dict</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #8b2252;">"""Return the dict for the current thread. Raises KeyError if none</span>
<span style="color: #8b2252;">        defined."""</span>
        <span style="color: #a0522d;">thread</span> = current_thread()
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.dicts[<span style="color: #483d8b;">id</span>(thread)][1]

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">create_dict</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #8b2252;">"""Create a new dict for the current thread, and return it."""</span>
        <span style="color: #a0522d;">localdict</span> = {} <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26412;&#22320;&#23383;&#20856;</span>
        <span style="color: #a0522d;">key</span> = <span style="color: #a020f0;">self</span>.key            <span style="color: #b22222;">#</span><span style="color: #b22222;">str(id(self))</span>
        <span style="color: #a0522d;">thread</span> = current_thread() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#21069;&#32447;&#31243;&#23545;&#35937;</span>
        <span style="color: #a0522d;">idt</span> = <span style="color: #483d8b;">id</span>(thread)          <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32447;&#31243;&#23545;&#35937;&#30340;&#22320;&#22336;</span>
        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">local_deleted</span>(_, key=key):
            <span style="color: #a0522d;">thread</span> = wrthread()
            <span style="color: #a020f0;">if</span> thread <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #008b8b;">None</span>:
                <span style="color: #a020f0;">del</span> thread.<span style="color: #483d8b;">__dict__</span>[key]
        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">thread_deleted</span>(_, idt=idt):
            <span style="color: #a0522d;">local</span> = wrlocal()
            <span style="color: #a020f0;">if</span> local <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #008b8b;">None</span>:
                <span style="color: #a0522d;">dct</span> = local.dicts.pop(idt)
        <span style="color: #a0522d;">wrlocal</span> = ref(<span style="color: #a020f0;">self</span>, local_deleted)     <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20851;&#32852;&#24341;&#26469;</span>
        <span style="color: #a0522d;">wrthread</span> = ref(thread, thread_deleted) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20851;&#32852;&#24341;&#26469;</span>
        thread.<span style="color: #483d8b;">__dict__</span>[key] = wrlocal         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#21069;&#32447;&#31243;&#23545;&#35937;&#23383;&#20856;&#20013;&#22686;&#21152; self.key</span>
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24403;&#21069;&#32447;&#31243;.[str(id(impl))] = </span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">dicts</span>[idt] = wrthread, localdict  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22823;&#23383;&#20856;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">{id(currentthread): (, {})}</span>
        <span style="color: #a020f0;">return</span> localdict

<span style="color: #228b22;">@contextmanager</span>  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19978;&#19979;&#25991;&#20351;&#29992;&#20989;&#25968;&#65292;yeild&#20043;&#21069;&#30456;&#24403;&#20110;enter&#65292;yeild&#36820;&#22238;as</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_patch</span>(<span style="color: #a020f0;">self</span>):  <span style="color: #b22222;">#</span><span style="color: #b22222;">self&#26159;local&#23454;&#20363;</span>
    <span style="color: #a0522d;">impl</span> = <span style="color: #483d8b;">object</span>.__getattribute__(<span style="color: #a020f0;">self</span>, <span style="color: #8b2252;">'_local__impl'</span>)
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">dct</span> = impl.get_dict()  <span style="color: #b22222;">#</span><span style="color: #b22222;">self.dicts[id(currentthread)][1]</span>
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">KeyError</span>:
        <span style="color: #a0522d;">dct</span> = impl.create_dict()  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;&#24403;&#21069;&#32447;&#31243;&#21019;&#24314;&#23567;&#23383;&#20856;</span>
        <span style="color: #a0522d;">args</span>, <span style="color: #a0522d;">kw</span> = impl.localargs
        <span style="color: #a020f0;">self</span>.__init__(*args, **kw)
    <span style="color: #a020f0;">with</span> impl.locallock:
        <span style="color: #483d8b;">object</span>.__setattr__(<span style="color: #a020f0;">self</span>, <span style="color: #8b2252;">'__dict__'</span>, dct) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;local&#23545;&#35937;&#19978;&#20570;&#23567;&#23383;&#20856;&#30340;&#20999;&#25442;</span>
        <span style="color: #a020f0;">yield</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">--------</span>
<span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">import</span> time

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s %(threadName)s %(thread)d %(message)s"</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO, datefmt=<span style="color: #8b2252;">"%Y-%m-%d %H:%M:%S"</span>)

<span style="color: #a0522d;">g_data</span> = threading.loacl() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23646;&#24615;_local__impl -&gt; imple() key, dicts{} #&#22823;&#23383;&#20856;&#20013;&#26377;&#19968;&#20010;&#23567;&#23383;&#20856;&#21644;&#20027;&#32447;&#31243;&#30456;&#20851;</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    g_data.<span style="color: #a0522d;">x</span> = 0 <span style="color: #b22222;"># </span><span style="color: #b22222;">x &#23646;&#24615;&#21644;&#32447;&#31243;&#30456;&#20851;&#65292;&#29992;&#24037;&#20316;&#32447;&#31243;&#30340;&#22320;&#22336;</span>

    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(1000):
        time.sleep(0.0001)
        g_data.<span style="color: #a0522d;">x</span> += 1

    logging.info(<span style="color: #8b2252;">"x = {}"</span>.<span style="color: #483d8b;">format</span>(g_data.x))

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(10):
    threading.Thread(target=worker, name=<span style="color: #8b2252;">'w{}'</span>.<span style="color: #483d8b;">format</span>(i), ).start()
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:7858a7f9-54f8-4340-9971-7960bc7b7cbe" class="outline-2">
<h2 id="h:7858a7f9-54f8-4340-9971-7960bc7b7cbe">çº¿ç¨‹åŒæ­¥</h2>
<div class="outline-text-2" id="text-h:7858a7f9-54f8-4340-9971-7960bc7b7cbe">
</div>
<div id="outline-container-h:0fc3d129-cb2d-4552-a23f-bc84812e6bb2" class="outline-3">
<h3 id="h:0fc3d129-cb2d-4552-a23f-bc84812e6bb2">æ¦‚å¿µ</h3>
<div class="outline-text-3" id="text-h:0fc3d129-cb2d-4552-a23f-bc84812e6bb2">
<p>
çº¿ç¨‹åŒæ­¥ï¼Œçº¿ç¨‹é—´ååŒï¼Œé€šè¿‡æŸç§æŠ€æœ¯ï¼Œè®©ä¸€ä¸ªçº¿ç¨‹è®¿é—®æŸäº›æ•°æ®æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½è®¿é—®è¿™äº›æ•°æ®ï¼Œç›´åˆ°è¯¥çº¿ç¨‹å®Œæˆå¯¹æ•°æ®çš„æ“ä½œã€‚
</p>
</div>
</div>
<div id="outline-container-h:7559fa45-c9ab-4dcd-86c5-c10f97a87c14" class="outline-3">
<h3 id="h:7559fa45-c9ab-4dcd-86c5-c10f97a87c14">Event***</h3>
<div class="outline-text-3" id="text-h:7559fa45-c9ab-4dcd-86c5-c10f97a87c14">
<p>
Eventäº‹ä»¶ï¼Œæ˜¯çº¿ç¨‹é—´é€šä¿¡æœºåˆ¶ä¸­æœ€ç®€å•çš„å®ç°ï¼Œä½¿ç”¨ä¸€ä¸ªå†…éƒ¨çš„æ ‡è®°flagï¼Œé€šè¿‡flagçš„Trueæˆ–Falseçš„å˜åŒ–æ¥è¿›è¡Œæ“ä½œã€‚
</p>

<pre class="example" id="org8288df3">
set()                 æ ‡è®°è®¾ç½®ä¸ºTrue
clear()               æ ‡è®°è®¾ç½®ä¸ºFalse
is_set()              æ ‡è®°æ˜¯å¦ä¸ºTrue
wait(timeout=None)    è®¾ç½®ç­‰å¾…æ ‡è®°ä¸ºTrueçš„æ—¶é•¿ï¼ŒNoneä¸ºæ— é™ç­‰å¾…ã€‚ç­‰åˆ°è¿”å›Trueï¼Œæœªç­‰åˆ°è¶…æ—¶äº†è¿”å›False
</pre>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Event
<span style="color: #a020f0;">import</span> time

<span style="color: #a0522d;">e</span> = Event()

<span style="color: #483d8b;">print</span>(e)
<span style="color: #483d8b;">print</span>(e.is_set()) <span style="color: #b22222;">#</span><span style="color: #b22222;">False</span>
<span style="color: #483d8b;">print</span>(e.wait(1)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38459;&#22622;1&#31186;&#65292;&#22914;&#26524;&#19981;&#20889;&#20250;&#19968;&#30452;&#31561;&#24453;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Event
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">fn</span>(e:Event):
    time.sleep(2)
    e.<span style="color: #483d8b;">set</span>() <span style="color: #b22222;">#</span><span style="color: #b22222;">1</span>


<span style="color: #a0522d;">e</span> = Event()

<span style="color: #483d8b;">print</span>(e)
<span style="color: #483d8b;">print</span>(e.is_set())

threading.Thread(target=fn,args=(e,)).start()

<span style="color: #483d8b;">print</span>(e.wait(5)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38459;&#22622;5&#31186;, &#36825;&#37324;&#31561;&#20102;2&#31186;</span>

e.clear() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#28165;&#31354;&#20107;&#20214;</span>
</pre>
</div>
</div>
<div id="outline-container-h:020e5e30-c1e3-4a48-9c2f-b38b5333a142" class="outline-4">
<h4 id="h:020e5e30-c1e3-4a48-9c2f-b38b5333a142">ç»ƒä¹ </h4>
<div class="outline-text-4" id="text-h:020e5e30-c1e3-4a48-9c2f-b38b5333a142">
<p>
è€æ¿é›‡ä½£äº†ä¸€ä¸ªå·¥äººï¼Œè®©ä»–ç”Ÿäº§æ¯å­ï¼Œè€æ¿ä¸€ç›´ç­‰ç€è¿™ä¸ªå·¥äººï¼Œç›´åˆ°ç”Ÿäº§äº†10ä¸ªæ¯å­
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Event
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s %(threadName)s %(thread)d %(message)s"</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT,level=logging.INFO)

<span style="color: #a0522d;">cups</span> = []
<span style="color: #a0522d;">flag</span> = <span style="color: #008b8b;">False</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">boss</span>():
    logging.info(<span style="color: #8b2252;">"I'm boss, waiting for you"</span>)
    <span style="color: #a020f0;">while</span> <span style="color: #a020f0;">not</span> flag:  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36718;&#35810;</span>
        time.sleep(0.5)
    logging.info(<span style="color: #8b2252;">"Good job."</span>)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(count=10):
    logging.info(<span style="color: #8b2252;">'I</span><span style="color: #008b8b;">\'</span><span style="color: #8b2252;">m worker for you'</span>)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">cups = []</span>
    <span style="color: #a020f0;">global</span> flag
    <span style="color: #a020f0;">while</span> <span style="color: #483d8b;">len</span>(cups) &lt; count:
        time.sleep(0.5)
        cups.append(1)
        logging.info(<span style="color: #8b2252;">'made one cup'</span>)
    <span style="color: #a0522d;">flag</span> = <span style="color: #008b8b;">True</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27880;&#24847;&#36825;&#37324;</span>
    logging.info(<span style="color: #8b2252;">'Finished my job'</span>)

<span style="color: #a0522d;">b</span> = threading.Thread(target=boss, name=<span style="color: #8b2252;">'boss'</span>)
<span style="color: #a0522d;">w</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker'</span>)

b.start()
w.start()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:06:30,864 boss 29476 I'm boss, waiting for you</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:06:30,865 worker 11820 I'm worker for you</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:06:31,366 worker 11820 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:06:31,866 worker 11820 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:06:32,367 worker 11820 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:06:32,869 worker 11820 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:06:33,369 worker 11820 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:06:33,871 worker 11820 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:06:34,372 worker 11820 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:06:34,873 worker 11820 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:06:35,374 worker 11820 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:06:35,875 worker 11820 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:06:35,876 worker 11820 Finished my job</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:06:36,370 boss 29476 Good job.</span>
</pre>
</div>

<p>
ä½¿ç”¨Event
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Event
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s %(threadName)s %(thread)d %(message)s"</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT,level=logging.INFO)


<span style="color: #a0522d;">cups</span> = []
<span style="color: #a0522d;">event</span> = Event()

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">boss</span>(e:Event):
    logging.info(<span style="color: #8b2252;">"I'm boss, waiting for you"</span>)
    e.wait() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#30452;&#31561;&#65292;&#31561;&#21040;0-&gt;1</span>
    logging.info(<span style="color: #8b2252;">"Good job."</span>)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(e:Event, count=10):
    logging.info(<span style="color: #8b2252;">'I</span><span style="color: #008b8b;">\'</span><span style="color: #8b2252;">m worker for you'</span>)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">cups = []</span>
    <span style="color: #a020f0;">global</span> flag
    <span style="color: #a020f0;">while</span> <span style="color: #483d8b;">len</span>(cups) &lt; count:
        time.sleep(0.5)
        cups.append(1)
        logging.info(<span style="color: #8b2252;">'made one cup'</span>)
    e.<span style="color: #483d8b;">set</span>() <span style="color: #b22222;">#</span><span style="color: #b22222;">0 -&gt; 1</span>
    logging.info(<span style="color: #8b2252;">'Finished my job'</span>)

<span style="color: #a0522d;">b</span> = threading.Thread(target=boss, name=<span style="color: #8b2252;">'boss1'</span>, args=(event,))
<span style="color: #a0522d;">w</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker'</span>, args=(event,))

b.start()
threading.Thread(target=boss, name=<span style="color: #8b2252;">'boss2'</span>, args=(event,)).start()
w.start()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:23:11,029 boss1 25008 I'm boss, waiting for you</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:23:11,029 boss2 14672 I'm boss, waiting for you</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:23:11,029 worker 29412 I'm worker for you</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:23:11,530 worker 29412 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:23:12,031 worker 29412 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:23:12,532 worker 29412 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:23:13,033 worker 29412 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:23:13,533 worker 29412 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:23:14,035 worker 29412 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:23:14,536 worker 29412 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:23:15,038 worker 29412 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:23:15,538 worker 29412 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:23:16,039 worker 29412 made one cup</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:23:16,040 worker 29412 Finished my job</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:23:16,040 boss2 14672 Good job.</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-07 14:23:16,040 boss1 25008 Good job.</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b47efafe-b4bb-436c-a571-aaf31e002259" class="outline-4">
<h4 id="h:b47efafe-b4bb-436c-a571-aaf31e002259">æ€»ç»“</h4>
<div class="outline-text-4" id="text-h:b47efafe-b4bb-436c-a571-aaf31e002259">
<ul class="org-ul">
<li>éœ€è¦ä½¿ç”¨åŒä¸€ä¸ªEventå¯¹è±¡çš„æ ‡è®°flag</li>
<li>è°waitå°±æ˜¯ç­‰åˆ°flagå˜ä¸ºTrueï¼Œæˆ–ç­‰åˆ°è¶…æ—¶è¿”å›False</li>
<li>ä¸é™åˆ¶ç­‰å¾…çš„ä¸ªæ•°ï¼Œé€šçŸ¥æ‰€æœ‰ç­‰å¾…è€…</li>
</ul>
</div>
</div>
<div id="outline-container-h:110966fe-7b86-45be-95fb-130b940e0fc3" class="outline-4">
<h4 id="h:110966fe-7b86-45be-95fb-130b940e0fc3">waitçš„ä½¿ç”¨</h4>
<div class="outline-text-4" id="text-h:110966fe-7b86-45be-95fb-130b940e0fc3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Event
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s %(threadName)s %(thread)d %(message)s"</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT,level=logging.INFO)


<span style="color: #a0522d;">cups</span> = []
<span style="color: #a0522d;">event</span> = threading.Event()

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(e:Event, count=10):
    logging.info(<span style="color: #8b2252;">'I</span><span style="color: #008b8b;">\'</span><span style="color: #8b2252;">m worker for you'</span>)
    <span style="color: #a020f0;">while</span> <span style="color: #a020f0;">not</span> event.wait(0.5): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#27425;&#31561;0.5&#31186;&#25191;&#34892;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">time.sleep(0.5)</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">event.wait(0.5)</span>
        cups.append(1)
        logging.info(<span style="color: #8b2252;">'made one cup'</span>)
        <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">len</span>(cups) &gt;= count:
            event.<span style="color: #483d8b;">set</span>()
            <span style="color: #b22222;"># </span><span style="color: #b22222;">break</span>
    logging.info(<span style="color: #8b2252;">'Finished my job'</span>)

<span style="color: #a0522d;">w</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker'</span>, args=(event,))
w.start()
</pre>
</div>

<p>
æˆ–è€…
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(e:Event, count=10):
    logging.info(<span style="color: #8b2252;">'I</span><span style="color: #008b8b;">\'</span><span style="color: #8b2252;">m worker for you'</span>)
    <span style="color: #a020f0;">while</span> <span style="color: #a020f0;">not</span> event.is_set(): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#27425;&#31561;0.5&#31186;&#25191;&#34892;</span>
        time.sleep(0.5)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">event.wait(0.5)</span>
        cups.append(1)
        logging.info(<span style="color: #8b2252;">'made one cup'</span>)
        <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">len</span>(cups) &gt;= count:
            event.<span style="color: #483d8b;">set</span>()
            <span style="color: #b22222;"># </span><span style="color: #b22222;">break</span>
    logging.info(<span style="color: #8b2252;">'Finished my job'</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:fbd12a9a-6881-4faa-ba4c-10b5e484d399" class="outline-4">
<h4 id="h:fbd12a9a-6881-4faa-ba4c-10b5e484d399">å®šæ—¶å™¨ Timer/å»¶è¿Ÿæ‰§è¡Œ</h4>
<div class="outline-text-4" id="text-h:fbd12a9a-6881-4faa-ba4c-10b5e484d399">
<p>
threading.Timerç»§æ‰¿è‡ªThreadï¼Œè¿™ä¸ªç±»ç”¨æ¥å®šä¹‰å»¶è¿Ÿå¤šä¹…åæ‰§è¡Œä¸€ä¸ªå‡½æ•°
</p>

<pre class="example" id="org718122d">
class threading.Timer(interval, function, args=None, kwargs=None)
</pre>

<p>
startæ–¹æ³•æ‰§è¡Œä¹‹åï¼ŒTimerå¯¹è±¡ä¼šå¤„äºç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…äº†intervalç§’ä¹‹åï¼Œå¼€å§‹æ‰§è¡Œfunctionå‡½æ•°çš„
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Timer <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23450;&#26102;&#22120;</span>
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(name):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} is working'</span>.<span style="color: #483d8b;">format</span>(name))
    time.sleep(1)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'finished'</span>)

<span style="color: #a0522d;">t</span> = Timer(3, worker, args=(<span style="color: #8b2252;">'tom'</span>,))  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23450;&#26102;&#22120;&#65292;&#24310;&#36831;3&#31186;&#25191;&#34892;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t.cancel() #&#21462;&#28040;&#23450;&#26102;&#22120;, &#22312;start&#21069;&#65292;&#21518;&#38754;start&#26080;&#25928;&#12290;</span>
t.start()
<span style="color: #b22222;"># </span><span style="color: #b22222;">t.cancel() #&#21462;&#28040;&#23450;&#26102;&#22120;</span>

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'==main exit=='</span>)
</pre>
</div>

<p>
ä¸Šä¾‹ä»£ç å·¥ä½œçº¿ç¨‹æ—©å°±å¯åŠ¨äº†ï¼Œåªä¸è¿‡æ˜¯åœ¨å·¥ä½œçº¿ç¨‹ä¸­å»¶æ—¶äº†3ç§’æ‰æ‰§è¡Œäº†workerå‡½æ•°
</p>

<p>
Timeræ˜¯çº¿ç¨‹Threadçš„å­ç±»ï¼ŒTimerå®ä¾‹å†…éƒ¨æä¾›äº†ä¸€ä¸ªfinishedå±æ€§ï¼Œè¯¥å±æ€§æ˜¯
Eventå¯¹è±¡ã€‚cancelæ–¹æ³•ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨workerå‡½æ•°æ‰§è¡Œå‰å¯¹finishedå±æ€§setæ–¹æ³•
æ“ä½œï¼Œä»è€Œè·³è¿‡äº†workerå‡½æ•°æ‰§è¡Œï¼Œè¾¾åˆ°äº†å–æ¶ˆçš„æ•ˆæœ
</p>

<p>
æ€»ç»“ï¼š
</p>
<ul class="org-ul">
<li>Timeræ˜¯çº¿ç¨‹Threadçš„å­ç±»ï¼Œå°±æ˜¯çº¿ç¨‹ç±»ï¼Œå…·æœ‰çº¿ç¨‹çš„èƒ½åŠ›å’Œç‰¹å¾</li>
<li>å®ƒçš„å®ä¾‹æ˜¯èƒ½å¤Ÿå»¶æ—¶æ‰§è¡Œç›®æ ‡å‡½æ•°çš„çº¿ç¨‹ï¼Œåœ¨çœŸæ­£æ‰§è¡Œç›®æ ‡å‡½æ•°ä¹‹å‰ï¼Œéƒ½å¯ä»¥cancelå®ƒ</li>
<li>cancelæ–¹æ³•æœ¬è´¨ä½¿ç”¨Eventç±»å®ç°ã€‚è¿™å¹¶ä¸æ˜¯è¯´ï¼Œçº¿ç¨‹æä¾›äº†å–æ¶ˆçš„æ–¹æ³•</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:3623e19d-a7e2-4cce-b425-aa5f3992cfdc" class="outline-3">
<h3 id="h:3623e19d-a7e2-4cce-b425-aa5f3992cfdc">Lock***</h3>
<div class="outline-text-3" id="text-h:3623e19d-a7e2-4cce-b425-aa5f3992cfdc">
<p>
é”ï¼Œä¸€æ—¦çº¿ç¨‹è·å¾—é”ï¼Œå…¶å®ƒè¯•å›¾è·å–é”çš„çº¿ç¨‹å°†è¢«é˜»å¡ã€‚
</p>

<p>
é”ï¼šå‡¡æ˜¯å­˜åœ¨å…±äº«èµ„æºäº‰æŠ¢çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨é”ï¼Œä»è€Œä¿è¯åªæœ‰ä¸€ä¸ªä½¿ç”¨è€…å¯ä»¥å®Œå…¨ä½¿ç”¨è¿™ä¸ªèµ„æº
</p>

<pre class="example" id="org4c5a706">
acquire(blocking=True, timeout=-1)
é»˜è®¤é˜»å¡ï¼Œé˜»å¡å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚éé˜»å¡æ—¶ï¼Œtimeoutç¦æ­¢è®¾ç½®
æˆåŠŸè·å–é”ï¼Œè¿”å›Trueï¼Œå¦åˆ™è¿”å›False

release()
é‡Šæ”¾é”ã€‚å¯ä»¥ä»ä»»ä½•çº¿ç¨‹è°ƒç”¨é‡Šæ”¾
å·²ä¸Šé”çš„é”ï¼Œä¼šè¢«é‡ç½®ä¸ºunlockedæœªä¸Šé”çš„é”ä¸Šè°ƒç”¨ï¼ŒæŠ›RuntimeErrorå¼‚å¸¸
</pre>

<p>
é”çš„åŸºæœ¬ä½¿ç”¨
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading 
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Timer

<span style="color: #a0522d;">lock</span> = threading.Lock()

<span style="color: #a0522d;">x</span> = lock.acquire() <span style="color: #b22222;">#</span><span style="color: #b22222;">True &#25343;&#21040;&#20102;</span>
<span style="color: #483d8b;">print</span>(x)
<span style="color: #a0522d;">y</span> = lock.acquire(timeout=2) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25343;&#21040;&#38145;&#21518;&#65292;&#20877;&#25343;&#65292;&#22914;&#26524;&#27809;&#26377;timeout&#65292;&#20250;&#19968;&#30452;&#31561;&#24453;</span>
<span style="color: #483d8b;">print</span>(y)
<span style="color: #a0522d;">z</span> = lock.acquire(<span style="color: #008b8b;">False</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38750;&#38459;&#22622;</span>
<span style="color: #483d8b;">print</span>(z)
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(lock.acquire(False, timeout=2)) #&#25253;&#38169;ValueError&#12290;&#38750;&#38459;&#22622;&#19981;&#21487;&#20197;&#35774;&#32622;&#36229;&#26102;</span>

lock.release() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#37322;&#25918;&#38145;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">False</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">False</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading

<span style="color: #a0522d;">l</span> = threading.Lock()

<span style="color: #483d8b;">print</span>(l.acquire(<span style="color: #008b8b;">False</span>))
<span style="color: #483d8b;">print</span>(l.acquire(<span style="color: #008b8b;">False</span>))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">True</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">False</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading 
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Timer
<span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s %(threadName)s %(thread)d %(message)s"</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a0522d;">lock</span> = threading.Lock()
<span style="color: #a0522d;">x</span> = lock.acquire() <span style="color: #b22222;">#</span><span style="color: #b22222;">True &#25343;&#21040;&#20102;</span>
<span style="color: #483d8b;">print</span>(x)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(l:threading.Lock):
    <span style="color: #a0522d;">name</span> = threading.current_thread().name
    <span style="color: #483d8b;">print</span>(name, <span style="color: #8b2252;">'want to get locker'</span>)
    logging.info(l.acquire())
    <span style="color: #483d8b;">print</span>(name, <span style="color: #8b2252;">'finished'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">lock.release() #&#37322;&#25918;</span>

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5):
    threading.Thread(target=worker, name=<span style="color: #8b2252;">'w{}'</span>.<span style="color: #483d8b;">format</span>(i), args=(lock,)).start()

<span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
    time.sleep(1)
    <span style="color: #a0522d;">cmd</span> = <span style="color: #483d8b;">input</span>(<span style="color: #8b2252;">'&gt;&gt;&gt;'</span>).strip()
    <span style="color: #a020f0;">if</span> cmd == <span style="color: #8b2252;">'r'</span>:
        lock.release()
    <span style="color: #a020f0;">elif</span> cmd == <span style="color: #8b2252;">'quit'</span>:
        <span style="color: #a020f0;">break</span>
    <span style="color: #a020f0;">else</span>:
        <span style="color: #483d8b;">print</span>(threading.<span style="color: #483d8b;">enumerate</span>())
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">True
w0 want to get locker
w1 want to get locker
w2 want to get locker
w3 want to get locker
w4 want to get locker
&gt;&gt;&gt;
[&lt;_MainThread(MainThread, started 19956)&gt;, &lt;Thread(w0, started 13524)&gt;, &lt;Thread(w1, started 18416)&gt;, &lt;Thread(w2, started 16556)&gt;, &lt;Thread(w3, started 12748)&gt;, &lt;Thread(w4, started 2396)&gt;]
&gt;&gt;&gt;r
2025-03-09 11:49:13,210 w0 13524 True
w0 finished
&gt;&gt;&gt;r
2025-03-09 11:49:44,730 w1 18416 True
w1 finished
&gt;&gt;&gt;r
2025-03-09 11:49:59,880 w2 16556 True
w2 finished
&gt;&gt;&gt;r
2025-03-09 11:50:01,878 w3 12748 True
w3 finished
&gt;&gt;&gt;r
2025-03-09 11:50:04,629 w4 2396 True
w4 finished
&gt;&gt;&gt;
[&lt;_MainThread(MainThread, started 19956)&gt;]
&gt;&gt;&gt;r
&gt;&gt;&gt;r
<span style="color: #0000ff;">Traceback</span> (most recent call last):
  File <span style="color: #8b2252;">"d:\project\pyprojs\cursor\t.py"</span>, line 28,<span style="color: #a020f0;"> in</span> &lt;module&gt;
    lock.release()
    ~~~~~~~~~~~~^^
RuntimeError: release unlocked lock
</pre>
</div>

<p>
ä¸Šä¾‹å¯ä»¥çœ‹å‡ºä¸ç®¡åœ¨å“ªä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œåªè¦å¯¹ä¸€ä¸ªå·²ç»ä¸Šé”çš„é”é˜»å¡è¯·æ±‚ï¼Œè¯¥çº¿ç¨‹å°±ä¼šé˜»å¡ã€‚
</p>
</div>
<div id="outline-container-h:6436f3b0-82ed-46c6-97f3-4f14699f8816" class="outline-4">
<h4 id="h:6436f3b0-82ed-46c6-97f3-4f14699f8816">ç»ƒä¹ </h4>
<div class="outline-text-4" id="text-h:6436f3b0-82ed-46c6-97f3-4f14699f8816">
<p>
è®¢å•è¦æ±‚ç”Ÿäº§1000ä¸ªæ¯å­ï¼Œç»„ç»‡10ä¸ªå·¥äººç”Ÿäº§ã€‚è¯·å¿½ç•¥è€æ¿ï¼Œå…³æ³¨å·¥äººç”Ÿæˆæ¯å­
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading 
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Timer
<span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s %(threadName)s %(thread)d %(message)s"</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a0522d;">lock</span> = threading.Lock()
<span style="color: #a0522d;">cups</span> = []

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(l:threading.Lock, count=1000):
    logging.info(<span style="color: #8b2252;">'{} is working'</span>.<span style="color: #483d8b;">format</span>(threading.current_thread().name))
    <span style="color: #a020f0;">while</span> <span style="color: #483d8b;">len</span>(cups) &lt; count:
        time.sleep(0.0001)
        cups.append(1)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">logging.info('made one')</span>
    logging.info(<span style="color: #8b2252;">'{} finishe. cups={}'</span>.<span style="color: #483d8b;">format</span>(threading.current_thread().name, <span style="color: #483d8b;">len</span>(cups)))


<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5):
    threading.Thread(target=worker, name=<span style="color: #8b2252;">'w{}'</span>.<span style="color: #483d8b;">format</span>(i), args=(lock, 1000)).start()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:24:33,671 w0 3844 w0 is working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:24:33,672 w1 21328 w1 is working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:24:33,673 w2 21200 w2 is working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:24:33,673 w3 20700 w3 is working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:24:33,674 w4 20072 w4 is working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:24:33,787 w0 3844 w0 finishe. cups=1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:24:33,788 w4 20072 w4 finishe. cups=1001</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:24:33,788 w3 20700 w3 finishe. cups=1002</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:24:33,788 w1 21328 w1 finishe. cups=1003</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:24:33,788 w2 21200 w2 finishe. cups=1004</span>
</pre>
</div>

<p>
ä¸ºä»€ä¹ˆå¤šç”Ÿäº§äº†ï¼Ÿ å¤šçº¿ç¨‹è°ƒåº¦ï¼Œå¯¼è‡´äº†åˆ¤æ–­å¤±æ•ˆï¼Œå¤šç”Ÿäº§äº†æ¯å­ã€‚å¦‚ä½•ä¿®æ”¹ï¼ŸåŠ é”ã€‚
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading 
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Timer
<span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s %(threadName)s %(thread)d %(message)s"</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a0522d;">lock</span> = threading.Lock()
<span style="color: #a0522d;">cups</span> = []

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(l:threading.Lock, count=1000):
    logging.info(<span style="color: #8b2252;">'{} is working'</span>.<span style="color: #483d8b;">format</span>(threading.current_thread().name))
    <span style="color: #a0522d;">flag</span> = <span style="color: #008b8b;">False</span>
    <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
        l.acquire()         <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21152;&#38145;</span>
        <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">len</span>(cups) &gt;= count:
            <span style="color: #a0522d;">flag</span> = <span style="color: #008b8b;">True</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">l.release()       #1&#37322;&#25918;&#38145;? &#32447;&#31243;&#19981;&#23433;&#20840;&#65292;</span>
        time.sleep(0.001)   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;&#20102;&#30475;&#20986;&#32447;&#31243;&#20999;&#25442;&#25928;&#26524;</span>
        <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> flag:
            cups.append(1)
        l.release()         <span style="color: #b22222;">#</span><span style="color: #b22222;">2&#37322;&#25918;&#38145;?</span>
        <span style="color: #a020f0;">if</span> flag:
            <span style="color: #a020f0;">break</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">l.release()         #3&#37322;&#25918;&#38145;? &#20250;&#27515;&#38145;&#12290; flag=True &#26102;&#65292;&#20250;&#27515;&#38145;&#12290;</span>

    logging.info(<span style="color: #8b2252;">'{} finishe. cups={}'</span>.<span style="color: #483d8b;">format</span>(threading.current_thread().name, <span style="color: #483d8b;">len</span>(cups)))


<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5):
    threading.Thread(target=worker, name=<span style="color: #8b2252;">'w{}'</span>.<span style="color: #483d8b;">format</span>(i), args=(lock, )).start()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:54:13,637 w0 6896 w0 is working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:54:13,638 w1 5812 w1 is working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:54:13,639 w2 21308 w2 is working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:54:13,640 w3 11152 w3 is working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:54:13,640 w4 1556 w4 is working</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:54:15,417 w4 1556 w4 finishe. cups=1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:54:15,419 w0 6896 w0 finishe. cups=1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:54:15,421 w2 21308 w2 finishe. cups=1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:54:15,423 w3 11152 w3 finishe. cups=1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 16:54:15,424 w1 5812 w1 finishe. cups=1000</span>
</pre>
</div>

<p>
ä¸Šä¾‹ä¸­å…±æœ‰ä¸‰å¤„å¯ä»¥é‡Šæ”¾é”ã€‚åªæœ‰ç¬¬äºŒå‡ºé‡Šæ”¾é”çš„ä½ç½®æ­£ç¡®
</p>

<p>
å‡è®¾ä½ç½®1çš„lock.release()åˆé€‚ï¼Œåˆ†æå¦‚ä¸‹ï¼š
</p>

<p>
æœ‰ä¸€ä¸ªæ—¶åˆ»ï¼Œåœ¨æŸä¸€ä¸ªçº¿ç¨‹ä¸­len(cups)æ­£å¥½æ˜¯999ï¼Œflag=Trueï¼Œé‡Šæ”¾é”ï¼Œæ­£å¥½
çº¿ç¨‹è¢«æ‰“æ–­ã€‚å¦ä¸€ä¸ªçº¿ç¨‹åˆ¤æ–­å‘ç°ä¹Ÿæ˜¯999ï¼Œflag=Trueï¼Œå¯èƒ½çº¿ç¨‹è¢«æ‰“æ–­ã€‚å¯èƒ½
å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¹Ÿåˆ¤æ–­æ˜¯999ï¼Œflagä¹Ÿè®¾ç½®ä¸ºTrueã€‚è¿™ä¸‰ä¸ªçº¿ç¨‹åªè¦ç»§ç»­æ‰§è¡Œåˆ°
cups.append(1)ï¼Œä¸€å®šä¼šå¯¼è‡´cupsçš„é•¿åº¦è¶…è¿‡1000çš„ã€‚
</p>

<p>
å‡è®¾ä½ç½®2çš„lock.release()åˆé€‚ï¼Œåˆ†æå¦‚ä¸‹ï¼š
</p>

<p>
åœ¨æŸä¸€ä¸ªæ—¶åˆ»len(cups)ï¼Œæ­£å¥½æ˜¯999ï¼Œflag=Trueï¼Œå…¶å®ƒçº¿ç¨‹è¯•å›¾è®¿é—®è¿™æ®µä»£ç 
çš„çº¿ç¨‹éƒ½é˜»å¡è·å–ä¸åˆ°é”ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹å®‰å…¨çš„å¢åŠ äº†ä¸€ä¸ªæ•°æ®ï¼Œç„¶åé‡Šæ”¾é”ã€‚
å…¶å®ƒçº¿ç¨‹æœ‰ä¸€ä¸ªæŠ¢åˆ°é”ï¼Œä½†å‘ç°å·²ç»1000äº†ï¼Œåªå¥½breakæ‰“å°é€€å‡ºã€‚å†å…¶å®ƒçº¿ç¨‹
éƒ½ä¸€æ ·ï¼Œå‘ç°å·²ç»1000äº†ï¼Œéƒ½é€€å‡ºäº†ã€‚
</p>

<p>
æ‰€ä»¥ä½ç½®2 é‡Šæ”¾é” æ˜¯æ­£ç¡®çš„ã€‚
</p>

<p>
ä½†æ˜¯æˆ‘ä»¬å‘ç°é”ä¿è¯äº†æ•°æ®å®Œæ•´æ€§ï¼Œä½†æ˜¯æ€§èƒ½ä¸‹é™å¾ˆå¤šã€‚
</p>

<p>
ä¸Šä¾‹ä¸­ä½ç½®3ï¼Œif flag:breakæ˜¯ä¸ºäº†ä¿è¯ä½ç½®2çš„releaseæ–¹æ³•è¢«æ‰§è¡Œï¼Œå¦åˆ™ï¼Œå°±å‡ºç°äº†æ­»é”ï¼Œå¾—åˆ°é”çš„æ°¸è¿œæ²¡æœ‰é‡Šæ”¾é”ã€‚
</p>


<p>
è®¡æ•°å™¨ç±»ï¼Œå¯ä»¥åŠ ï¼Œå¯ä»¥å‡ã€‚
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">t.py&#25991;&#20214;</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Balancer</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_value</span> = 0

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inc</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_value</span> += 1

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">dec</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_value</span> -= 1

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">value</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._value

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">run</span>(c:Balancer, count=100):
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(count):
        <span style="color: #a020f0;">for</span> j <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(-50, 50):
            <span style="color: #a020f0;">if</span> j &lt; 0:
                c.dec()
            <span style="color: #a020f0;">else</span>:
                c.inc()

<span style="color: #b22222;">#</span><span style="color: #b22222;">t2.py</span>
<span style="color: #a020f0;">from</span> t <span style="color: #a020f0;">import</span> Balancer, run
<span style="color: #a020f0;">import</span> threading

<span style="color: #a0522d;">c</span> = Balancer()
<span style="color: #a0522d;">threads</span> = 10
<span style="color: #a0522d;">count</span> = 1000 <span style="color: #b22222;">#</span><span style="color: #b22222;">10 &#32467;&#26524;&#26159;0&#65292;100&#32467;&#26524;&#26159;0&#65292; 1000&#32467;&#26524;&#26159;&#65311; &#21487;&#33021;&#26102;&#38388;&#29255;&#29992;&#23436;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22810;&#20010;&#32447;&#31243;&#20013;&#29992;&#21040;&#21516;&#19968;&#20010;&#23545;&#35937;&#65292;&#21487;&#33021;&#20250;&#23548;&#33268;&#25968;&#25454;&#19981;&#19968;&#33268;</span>

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(threads):
    threading.Thread(
        target=run, 
        args=(c, count), 
        name=<span style="color: #8b2252;">'balancer-{}'</span>.<span style="color: #483d8b;">format</span>(i)
    ).start()

<span style="color: #483d8b;">print</span>(c.value)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524; &#21487;&#33021;&#26159;0 &#21487;&#33021;&#26159;&#20854;&#20182;</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">t.py&#25991;&#20214;</span>
<span style="color: #a020f0;">import</span> threading

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Balancer</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_value</span> = 0
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__lock</span> = threading.Lock()

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inc</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.__lock.acquire()
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_value</span> += 1
        <span style="color: #a020f0;">finally</span>:
            <span style="color: #a020f0;">self</span>.__lock.release()

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">dec</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">with</span> <span style="color: #a020f0;">self</span>.__lock:
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_value</span> -= 1

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">value</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">with</span> <span style="color: #a020f0;">self</span>.__lock:
            <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._value <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38656;&#35201;&#21152;&#38145;&#21527;&#65311;</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">run</span>(c:Balancer, count=100):
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(count):
        <span style="color: #a020f0;">for</span> j <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(-50, 50):
            <span style="color: #a020f0;">if</span> j &lt; 0:
                c.dec()
            <span style="color: #a020f0;">else</span>:
                c.inc()

<span style="color: #b22222;">#</span><span style="color: #b22222;">t2.py&#25991;&#20214;</span>
<span style="color: #a020f0;">from</span> t <span style="color: #a020f0;">import</span> Balancer, run
<span style="color: #a020f0;">import</span> threading

<span style="color: #a0522d;">c</span> = Balancer()
<span style="color: #a0522d;">threads</span> = 10
<span style="color: #a0522d;">count</span> = 1000 <span style="color: #b22222;">#</span><span style="color: #b22222;">10 &#32467;&#26524;&#26159;0&#65292;100&#32467;&#26524;&#26159;0&#65292; 1000&#32467;&#26524;&#26159;&#65311; &#21487;&#33021;&#26102;&#38388;&#29255;&#29992;&#23436;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22810;&#20010;&#32447;&#31243;&#20013;&#29992;&#21040;&#21516;&#19968;&#20010;&#23545;&#35937;&#65292;&#21487;&#33021;&#20250;&#23548;&#33268;&#25968;&#25454;&#19981;&#19968;&#33268;</span>

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(threads):
    threading.Thread(
        target=run, 
        args=(c, count), 
        name=<span style="color: #8b2252;">'balancer-{}'</span>.<span style="color: #483d8b;">format</span>(i)
    ).start()

<span style="color: #483d8b;">print</span>(c.value)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32467;&#26524;&#26159; -128 -139 .. &#20026;&#20160;&#20040;&#65311;  &#20027;&#32447;&#31243;&#25552;&#21069;&#35835;&#20102;</span>
</pre>
</div>

<p>
ä¹‹æ‰€ä»¥è¯»å±æ€§çš„æ—¶å€™ä¹Ÿè¦åŠ é”ï¼ŒåŸå› åœ¨äºï¼Œå¦‚æœä¸åŠ é”ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¯»å–åˆ°è„æ•°æ®ã€‚ä¾‹å¦‚å†™æ³•
in, å®ƒä¿®æ”¹äº†ä¸€æ¬¡æ•°æ®ï¼Œè¿™æ˜¯ä¸´æ—¶çš„ä¿®æ”¹ï¼Œå¦‚æœå‡ºç°äº†å¼‚å¸¸ï¼Œè¿™ä¸ªæ•°æ®ä¸€å®šä¸ç®—æ•°ã€‚
</p>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">t.py&#25991;&#20214;</span>
<span style="color: #a020f0;">import</span> threading

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Balancer</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_value</span> = 0
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__lock</span> = threading.Lock()

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inc</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.__lock.acquire()
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_value</span> += 1
        <span style="color: #a020f0;">finally</span>:
            <span style="color: #a020f0;">self</span>.__lock.release()

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">dec</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">with</span> <span style="color: #a020f0;">self</span>.__lock:
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_value</span> -= 1

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">value</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">with</span> <span style="color: #a020f0;">self</span>.__lock:
            <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>._value <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38656;&#35201;&#21152;&#38145;&#21527;&#65311;</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">run</span>(c:Balancer, count=100):
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(count):
        <span style="color: #a020f0;">for</span> j <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(-50, 50):
            <span style="color: #a020f0;">if</span> j &lt; 0:
                c.dec()
            <span style="color: #a020f0;">else</span>:
                c.inc()

<span style="color: #b22222;">#</span><span style="color: #b22222;">t2.py&#25991;&#20214;</span>
<span style="color: #a020f0;">from</span> t <span style="color: #a020f0;">import</span> Balancer, run
<span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a0522d;">c</span> = Balancer()
<span style="color: #a0522d;">threads</span> = 10
<span style="color: #a0522d;">count</span> = 1000 <span style="color: #b22222;">#</span><span style="color: #b22222;">10 &#32467;&#26524;&#26159;0&#65292;100&#32467;&#26524;&#26159;0&#65292; 1000&#32467;&#26524;&#26159;&#65311; &#21487;&#33021;&#26102;&#38388;&#29255;&#29992;&#23436;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22810;&#20010;&#32447;&#31243;&#20013;&#29992;&#21040;&#21516;&#19968;&#20010;&#23545;&#35937;&#65292;&#21487;&#33021;&#20250;&#23548;&#33268;&#25968;&#25454;&#19981;&#19968;&#33268;</span>

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(threads):
    threading.Thread(
        target=run, 
        args=(c, count), 
        name=<span style="color: #8b2252;">'balancer-{}'</span>.<span style="color: #483d8b;">format</span>(i)
    ).start()

<span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
    time.sleep(2)
    <span style="color: #a020f0;">if</span> threading.active_count() == 1:
        <span style="color: #483d8b;">print</span>(c.value)
        <span style="color: #a020f0;">break</span>
    <span style="color: #a020f0;">else</span>: 
        <span style="color: #483d8b;">print</span>(threading.<span style="color: #483d8b;">enumerate</span>())
</pre>
</div>

<p>
è¿”å›ç»“æœ
</p>
<pre class="example" id="orgd88dc9d">
[&lt;_MainThread(MainThread, started 19780)&gt;, &lt;Thread(balancer-1, started 22952)&gt;, &lt;Thread(balancer-2, started 2412)&gt;, &lt;Thread(balancer-3, started 22220)&gt;, &lt;Thread(balancer-4, started 24804)&gt;, &lt;Thread(balancer-5, started 6336)&gt;, &lt;Thread(balancer-6, started 24836)&gt;, &lt;Thread(balancer-7, started 20036)&gt;, &lt;Thread(balancer-8, started 24124)&gt;, &lt;Thread(balancer-9, started 23072)&gt;]
[&lt;_MainThread(MainThread, started 19780)&gt;, &lt;Thread(balancer-1, started 22952)&gt;, &lt;Thread(balancer-2, started 2412)&gt;, &lt;Thread(balancer-3, started 22220)&gt;, &lt;Thread(balancer-4, started 24804)&gt;, &lt;Thread(balancer-5, started 6336)&gt;, &lt;Thread(balancer-6, started 24836)&gt;, &lt;Thread(balancer-7, started 20036)&gt;, &lt;Thread(balancer-8, started 24124)&gt;, &lt;Thread(balancer-9, started 23072)&gt;]
0
</pre>

<p>
å¯¹äºåŒä¸€ä¸ªæ•°æ®ï¼Œå¤šä¸ªçº¿ç¨‹äº‰ç€å†™å…¥ï¼Œä¸€èˆ¬æ¥è¯´éƒ½éœ€è¦åŠ é”ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿå†™å…¥ï¼Œç›´åˆ°
æˆåŠŸå†™å…¥ï¼Œé‡Šæ”¾é”ã€‚
</p>
</div>
</div>
<div id="outline-container-h:2a04bc2f-514b-4b3b-8860-23fe5eb650fe" class="outline-4">
<h4 id="h:2a04bc2f-514b-4b3b-8860-23fe5eb650fe">åŠ é”ã€è§£é”</h4>
<div class="outline-text-4" id="text-h:2a04bc2f-514b-4b3b-8860-23fe5eb650fe">
<p>
ä¸€èˆ¬æ¥è¯´ï¼ŒåŠ é”å°±éœ€è¦è§£é”ï¼Œä½†æ˜¯åŠ é”åè§£é”å‰ï¼Œè¿˜è¦æœ‰ä¸€äº›ä»£ç æ‰§è¡Œï¼Œå°±æœ‰å¯
èƒ½æŠ›å¼‚å¸¸ï¼Œä¸€æ—¦å‡ºç°å¼‚å¸¸ï¼Œé”æ˜¯æ— æ³•é‡Šæ”¾ï¼Œä½†æ˜¯å½“å‰çº¿ç¨‹å¯èƒ½å› ä¸ºè¿™ä¸ªå¼‚å¸¸è¢«ç»ˆ
æ­¢äº†ï¼Œè¿™ä¹Ÿäº§ç”Ÿäº†æ­»é”ã€‚
</p>

<p>
åŠ é”ã€è§£é”å¸¸ç”¨è¯­å¥ï¼š
</p>
<ul class="org-ul">
<li>ä½¿ç”¨try&#x2026;finallyè¯­å¥ä¿è¯é”çš„é‡Šæ”¾</li>
<li>withä¸Šä¸‹æ–‡ç®¡ç†ï¼Œé”å¯¹è±¡æ”¯æŒä¸Šä¸‹æ–‡ç®¡ç†</li>
</ul>
</div>
</div>
<div id="outline-container-h:afacce3f-4f6d-4260-a5b1-1c0bdadbe0a9" class="outline-4">
<h4 id="h:afacce3f-4f6d-4260-a5b1-1c0bdadbe0a9">é”çš„åº”ç”¨åœºæ™¯</h4>
<div class="outline-text-4" id="text-h:afacce3f-4f6d-4260-a5b1-1c0bdadbe0a9">
<p>
é”é€‚ç”¨äºè®¿é—®å’Œä¿®æ”¹åŒä¸€ä¸ªå…±äº«èµ„æºçš„æ—¶å€™ï¼Œå³è¯»å†™åŒä¸€ä¸ªèµ„æºçš„æ—¶å€™ã€‚
</p>

<p>
å¦‚æœå…¨éƒ¨éƒ½æ˜¯è¯»å–åŒä¸€ä¸ªå…±äº«èµ„æºä¸éœ€è¦åŠ é”ï¼Œå› ä¸ºè¿™æ—¶å¯ä»¥è®¤ä¸ºå…±äº«èµ„æºæ˜¯ä¸å¯å˜çš„ï¼Œæ¯ä¸€æ¬¡è¯»å–å®ƒéƒ½æ˜¯ä¸€æ ·çš„å€¼ï¼Œæ‰€ä»¥ä¸ç”¨åŠ é”ã€‚
</p>

<p>
ä½¿ç”¨é”çš„æ³¨æ„äº‹é¡¹ï¼š
</p>
<ul class="org-ul">
<li>å°‘ç”¨é”ï¼Œå¿…è¦æ—¶ç”¨é”ã€‚ä½¿ç”¨äº†é”ï¼Œå¤šçº¿ç¨‹è®¿é—®è¢«é”çš„èµ„æºæ—¶ï¼Œå°±æˆäº†ä¸²è¡Œï¼Œè¦ä¹ˆæ’é˜Ÿæ‰§è¡Œï¼Œè¦ä¹ˆäº‰æŠ¢æ‰§è¡Œ
<ul class="org-ul">
<li>ä¸¾ä¾‹ï¼Œé«˜é€Ÿå…¬è·¯ä¸Šè½¦å¹¶è¡Œè·‘ï¼Œå¯æ˜¯åˆ°äº†çœç•Œåªå¼€æ”¾äº†ä¸€ä¸ªæ”¶è´¹å£ï¼Œè¿‡äº†è¿™ä¸ª
å£ï¼Œè½¦è¾†ä¾ç„¶å¯ä»¥åœ¨å¤šè½¦é“ä¸Šä¸€èµ·è·‘ã€‚è¿‡æ”¶è´¹å£çš„æ—¶å€™ï¼Œå¦‚æœæ’é˜Ÿä¸€è¾†è¾†è¿‡ï¼Œ
åŠ ä¸åŠ é”ä¸€æ ·æ•ˆç‡ç›¸å½“ï¼Œä½†æ˜¯ä¸€æ—¦å‡ºç°äº‰æŠ¢ï¼Œå°±å¿…é¡»åŠ é”ä¸€è¾†è¾†è¿‡ã€‚æ³¨æ„ï¼Œ
ä¸ç®¡åŠ ä¸åŠ é”ï¼Œåªè¦æ˜¯ä¸€è¾†è¾†è¿‡ï¼Œæ•ˆç‡å°±ä¸‹é™äº†</li>
</ul></li>
<li>åŠ é”æ—¶é—´è¶ŠçŸ­è¶Šå¥½ï¼Œä¸éœ€è¦å°±ç«‹å³é‡Šæ”¾é”</li>
<li>ä¸€å®šè¦é¿å…æ­»é”</li>
</ul>

<p>
ä¸ä½¿ç”¨é”ï¼Œæœ‰äº†æ•ˆç‡ï¼Œä½†æ˜¯ç»“æœæ˜¯é”™çš„ã€‚
</p>

<p>
ä½¿ç”¨äº†é”ï¼Œæ•ˆç‡ä½ä¸‹ï¼Œä½†æ˜¯ç»“æœæ˜¯å¯¹çš„ã€‚
</p>

<p>
ä½†æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„æ­£ç¡®æ€§ï¼Œå¿…è¦æ—¶è¿˜æ˜¯å¾—éœ€è¦ä½¿ç”¨é”ã€‚
</p>
</div>
</div>
<div id="outline-container-h:49d04d89-0692-4a32-a23f-be635c989c10" class="outline-4">
<h4 id="h:49d04d89-0692-4a32-a23f-be635c989c10">éé˜»å¡é”ä½¿ç”¨</h4>
<div class="outline-text-4" id="text-h:49d04d89-0692-4a32-a23f-be635c989c10">
</div>
</div>
</div>
<div id="outline-container-h:5a518f40-3c35-416e-b452-0a95f2f294ab" class="outline-3">
<h3 id="h:5a518f40-3c35-416e-b452-0a95f2f294ab">å¯é‡å…¥é”RLock</h3>
<div class="outline-text-3" id="text-h:5a518f40-3c35-416e-b452-0a95f2f294ab">
<p>
å¯é‡å…¥é”ï¼Œæ˜¯çº¿ç¨‹ç›¸å…³çš„é”ã€‚
</p>

<p>
çº¿ç¨‹Aè·å¾—å¯é‡å¤é”ï¼Œå¹¶å¯ä»¥å¤šæ¬¡æˆåŠŸè·å–ï¼Œä¸ä¼šé˜»å¡ã€‚æœ€åè¦åœ¨çº¿ç¨‹Aä¸­åšå’Œacquireæ¬¡æ•°ç›¸åŒçš„releaseã€‚
</p>

<div class="org-src-container">
<pre class="src src-python">
<span style="color: #a020f0;">import</span> threading

<span style="color: #a0522d;">l</span> = threading.RLock()

<span style="color: #483d8b;">print</span>(l.acquire())
<span style="color: #483d8b;">print</span>(l.acquire())
<span style="color: #483d8b;">print</span>(l.release())
<span style="color: #483d8b;">print</span>(l.release())
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(l.release()) #&#25253;&#38169;&#12290;&#25343;&#20960;&#27425;&#38145;&#65292;&#23601;&#35201;&#37322;&#25918;&#20960;&#27425;&#38145;</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">None</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">None</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Traceback (most recent call last):</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">File "d:\project\pyprojs\cursor\t2.py", line 10, in &lt;module&gt;</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">print(l.release())</span>
<span style="color: #b22222;">#           </span><span style="color: #b22222;">~~~~~~~~~^^</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">RuntimeError: cannot release un-acquired lock</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading 
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Timer
<span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s %(threadName)s %(thread)d %(message)s"</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #483d8b;">print</span>(threading.get_ident(), <span style="color: #8b2252;">'++++'</span>)
<span style="color: #a0522d;">lock</span> = threading.RLock()
logging.info(<span style="color: #8b2252;">'{} {}'</span>.<span style="color: #483d8b;">format</span>(lock.acquire(), lock)) <span style="color: #b22222;">#</span><span style="color: #b22222;">True</span>
logging.info(<span style="color: #8b2252;">'-'</span> * 30)
logging.info(<span style="color: #8b2252;">'{} {}'</span>.<span style="color: #483d8b;">format</span>(lock.acquire(), lock)) <span style="color: #b22222;">#</span><span style="color: #b22222;">True</span>


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(l):
    logging.info(<span style="color: #8b2252;">'in worker~~~~'</span>)
    logging.info(threading.get_ident())
    logging.info(l)
    logging.info(l.acquire())
    logging.info(l)
    logging.info(l.acquire())
    logging.info(l)
    logging.info(<span style="color: #8b2252;">'get one lock'</span>)

<span style="color: #a0522d;">t</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'woker'</span>, args=(lock,))
t.start()

time.sleep(3)
logging.info(<span style="color: #8b2252;">'1 {} {}'</span>.<span style="color: #483d8b;">format</span>(lock.release(), lock))
time.sleep(2)
logging.info(<span style="color: #8b2252;">'2 {} {}'</span>.<span style="color: #483d8b;">format</span>(lock.release(), lock))
time.sleep(5)
logging.info(lock)
logging.info(lock.acquire()) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29616;&#22312;&#38145;&#23646;&#24615;woker&#20013;&#65292;&#20869;&#37096;&#27809;&#26377;&#37322;&#25918;&#65292;&#36825;&#37324;&#23601;&#20250;&#19968;&#30452;&#31561;&#24453;</span>

logging.info(<span style="color: #8b2252;">'='</span> * 30) 

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">24540 ++++</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 22:56:50,943 MainThread 24540 True &lt;locked _thread.RLock object owner=24540 count=1 at 0x000001E9ECC3A080&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 22:56:50,944 MainThread 24540 ------------------------------</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 22:56:50,944 MainThread 24540 True &lt;locked _thread.RLock object owner=24540 count=2 at 0x000001E9ECC3A080&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 22:56:50,945 woker 5720 in worker~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 22:56:50,946 woker 5720 5720</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 22:56:50,946 woker 5720 &lt;locked _thread.RLock object owner=24540 count=2 at 0x000001E9ECC3A080&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 22:56:53,946 MainThread 24540 1 None &lt;locked _thread.RLock object owner=24540 count=1 at 0x000001E9ECC3A080&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 22:56:55,947 MainThread 24540 2 None &lt;unlocked _thread.RLock object owner=0 count=0 at 0x000001E9ECC3A080&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 22:56:55,947 woker 5720 True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 22:56:55,948 woker 5720 &lt;locked _thread.RLock object owner=5720 count=1 at 0x000001E9ECC3A080&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 22:56:55,949 woker 5720 True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 22:56:55,949 woker 5720 &lt;locked _thread.RLock object owner=5720 count=2 at 0x000001E9ECC3A080&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 22:56:55,950 woker 5720 get one lock</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-09 22:57:00,949 MainThread 24540 &lt;locked _thread.RLock object owner=5720 count=2 at 0x000001E9ECC3A080&gt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21345;&#36825;&#37324;&#20102;</span>
</pre>
</div>

<p>
å¯é‡å…¥é”æ€»ç»“
</p>
<ul class="org-ul">
<li>ä¸çº¿ç¨‹ç›¸å…³ï¼Œå¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è·å–é”ï¼Œå¹¶å¯ç»§ç»­åœ¨åŒä¸€çº¿ç¨‹ä¸­ä¸é˜»å¡å¤šæ¬¡è·å–é”</li>
<li>å½“é”æœªé‡Šæ”¾å®Œï¼Œå…¶å®ƒçº¿ç¨‹è·å–é”å°±ä¼šé˜»å¡ï¼Œç›´åˆ°å½“å‰æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾å®Œé”</li>
<li>é”éƒ½åº”è¯¥ä½¿ç”¨å®Œåé‡Šæ”¾ã€‚å¯é‡å…¥é”ä¹Ÿæ˜¯é”ï¼Œåº”è¯¥acquireå¤šå°‘æ¬¡ï¼Œå°±releaseå¤šå°‘æ¬¡</li>
</ul>
</div>
</div>
<div id="outline-container-h:e8ad5263-5245-49ba-b9e6-2ae97f4dd478" class="outline-3">
<h3 id="h:e8ad5263-5245-49ba-b9e6-2ae97f4dd478">Condition</h3>
<div class="outline-text-3" id="text-h:e8ad5263-5245-49ba-b9e6-2ae97f4dd478">
<p>
æ„é€ æ–¹æ³• Condition(lock=None)ï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªLockæˆ–RLockå¯¹è±¡ï¼Œé»˜è®¤æ˜¯RLockã€‚
</p>

<pre class="example" id="orgf42c82f">
acquire(*args)            è·å–é”
wait(self, timeout=None)  ç­‰å¾…æˆ–è¶…æ—¶
notify(n=1)               å”¤é†’è‡³å¤šæŒ‡å®šæ•°ç›®ä¸ªæ•°çš„ç­‰å¾…çš„çº¿ç¨‹ï¼Œæ²¡æœ‰ç­‰å¾…çš„çº¿ç¨‹å°±æ²¡æœ‰ä»»ä½•æ“ä½œ
notify_all()              å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹
</pre>

<p>
ConditionåŸºæœ¬ä½¿ç”¨
</p>

<p>
èŒƒä¾‹ï¼šä¸€ä¸ªå·¥äººç”Ÿäº§1000ä¸ªæ¯å­ï¼Œæœ‰2ä¸ªè€æ¿ç­‰åˆ°ä»–ç”Ÿäº§å®Œä¸ºæ­¢ã€‚
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s %(threadName)s %(thread)d %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #b22222;"># </span><span style="color: #b22222;">event = threading.Event()</span>
<span style="color: #a0522d;">cond</span> = threading.Condition()

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">boss</span>():
    logging.info(<span style="color: #8b2252;">'I am watching u'</span>)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">event.wait()</span>
    <span style="color: #a020f0;">with</span> cond:
        logging.info(<span style="color: #8b2252;">'&#25105;&#31561;'</span>)
        cond.wait()
    logging.info(<span style="color: #8b2252;">'Good job'</span>)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(count=1000):
    logging.info(<span style="color: #8b2252;">'Starting......'</span>)
    <span style="color: #a0522d;">cups</span> = []
    <span style="color: #a020f0;">while</span> <span style="color: #483d8b;">len</span>(cups) &lt; count:
        time.sleep(0.0001)
        cups.append(1)
    <span style="color: #a020f0;">with</span> cond:
        <span style="color: #b22222;">#</span><span style="color: #b22222;">cond.notify_all() # &#36890;&#30693;&#25152;&#26377;&#31561;&#24453;&#30340;&#32447;&#31243;</span>
        cond.notify(2) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36890;&#30693;2&#20010;&#32447;&#31243;. 1&#23545;1 &#21333;&#25773;&#65307; 1&#23545;&#22810;&#65292; &#22810;&#25773;&#65292;&#24191;&#25773;&#65292;1&#23545;&#20840;&#20307;</span>

    logging.info(<span style="color: #8b2252;">'finished. cups={}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">len</span>(cups)))
    <span style="color: #b22222;"># </span><span style="color: #b22222;">event.set()</span>

<span style="color: #a0522d;">b1</span> = threading.Thread(target=boss, name=<span style="color: #8b2252;">'b1'</span>)
<span style="color: #a0522d;">b2</span> = threading.Thread(target=boss, name=<span style="color: #8b2252;">'b2'</span>)
b1.start()
b2.start()

<span style="color: #a0522d;">w</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker'</span>)
w.start()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:24:25,399 b1 21400 I am watching u</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:24:25,399 b1 21400 &#25105;&#31561;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:24:25,399 b2 25884 I am watching u</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:24:25,399 b2 25884 &#25105;&#31561;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:24:25,399 worker 27616 Starting......</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:24:25,954 worker 27616 finished. cups=1000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:24:25,954 b2 25884 Good job</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:24:25,954 b1 21400 Good job</span>
</pre>
</div>

<p>
Conditionç”¨äºç”Ÿäº§è€…ã€æ¶ˆè´¹è€…æ¨¡å‹ï¼Œä¸ºäº†è§£å†³ç”Ÿäº§è€…æ¶ˆè´¹è€…é€Ÿåº¦åŒ¹é…é—®é¢˜
</p>

<p>
ä¸‹ä¾‹åªæ˜¯ä¸ºäº†æ¼”ç¤ºï¼Œä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Thread, Event, Condition
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">import</span> random

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s %(threadName)s %(thread)d %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#20135;&#32773;&#28040;&#36153;&#32773;&#27169;&#22411;</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Dispatcher</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">data</span> = <span style="color: #008b8b;">None</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">produce</span>(<span style="color: #a020f0;">self</span>):
        logging.info(<span style="color: #8b2252;">'starting...'</span>)
        <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
            time.sleep(1) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27169;&#25311;&#29983;&#20135;&#36895;&#24230;</span>
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">data</span> = random.randint(1, 50)
            logging.info( <span style="color: #a020f0;">self</span>.data)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">consume</span>(<span style="color: #a020f0;">self</span>):
        logging.info(<span style="color: #8b2252;">'consume...'</span>)
        <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
            time.sleep(0.5) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27169;&#25311;&#28040;&#36153;&#36895;&#24230;&#12290; &#26368;&#22823;&#30340;&#38382;&#39064;&#22312;&#20110;&#65292;&#28040;&#36153;&#32773;&#20027;&#21160;&#36718;&#35810;&#33719;&#21462;&#25968;&#25454;</span>
            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.data:
                <span style="color: #a0522d;">data</span> = <span style="color: #a020f0;">self</span>.data         
                logging.info(<span style="color: #a020f0;">self</span>.data)
                <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">data</span> = <span style="color: #008b8b;">None</span>

<span style="color: #a0522d;">d</span> = Dispatcher()
<span style="color: #a0522d;">p</span> = threading.Thread(target=d.produce, name=<span style="color: #8b2252;">'producer'</span>)
<span style="color: #a0522d;">c</span> = threading.Thread(target=d.consume, name=<span style="color: #8b2252;">'consumer'</span>)
c.start()
p.start()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:42:25,185 consumer 24904 consume...</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:42:25,185 producer 11784 starting...</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:42:26,186 producer 11784 6</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:42:26,687 consumer 24904 6</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:42:27,187 producer 11784 30</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:42:27,187 consumer 24904 30</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:42:28,188 producer 11784 48</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:42:28,188 consumer 24904 48</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:42:29,188 producer 11784 39</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 10:42:29,189 consumer 24904 39</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Thread, Event, Condition
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">import</span> random

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s %(threadName)s %(thread)d %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#20135;&#32773;&#28040;&#36153;&#32773;&#27169;&#22411;</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Dispatcher</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">data</span> = <span style="color: #008b8b;">None</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">event</span> = threading.Event()
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">cond</span> = threading.Condition()

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">produce</span>(<span style="color: #a020f0;">self</span>):
        logging.info(<span style="color: #8b2252;">'starting...'</span>)
        <span style="color: #a020f0;">while</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">self</span>.event.wait(1): <span style="color: #b22222;">#</span><span style="color: #b22222;">self.event.wait(1)&#19981;&#33021;&#25918;&#22312;with&#20013;</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">time.sleep(1) # &#27169;&#25311;&#29983;&#20135;&#36895;&#24230;</span>
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">data</span> = random.randint(1, 50)
            logging.info( <span style="color: #a020f0;">self</span>.data)
            <span style="color: #a020f0;">with</span> <span style="color: #a020f0;">self</span>.cond:
                <span style="color: #b22222;"># </span><span style="color: #b22222;">self.cond.notify_all()</span>
                <span style="color: #a020f0;">self</span>.cond.notify(2)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">consume</span>(<span style="color: #a020f0;">self</span>):
        logging.info(<span style="color: #8b2252;">'consume...'</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">while not self.event.wait(0.3):</span>
            <span style="color: #b22222;"># </span><span style="color: #b22222;">time.sleep(0.5) # &#27169;&#25311;&#28040;&#36153;&#36895;&#24230;&#12290; &#26368;&#22823;&#30340;&#38382;&#39064;&#22312;&#20110;&#65292;&#28040;&#36153;&#32773;&#20027;&#21160;&#36718;&#35810;&#33719;&#21462;&#25968;&#25454;</span>
        <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
            <span style="color: #a020f0;">with</span> <span style="color: #a020f0;">self</span>.cond:
                <span style="color: #a020f0;">self</span>.cond.wait()
            <span style="color: #a0522d;">data</span> = <span style="color: #a020f0;">self</span>.data         
            logging.info(<span style="color: #a020f0;">self</span>.data)
            <span style="color: #b22222;"># </span><span style="color: #b22222;">self.data = None</span>

<span style="color: #a0522d;">d</span> = Dispatcher()
<span style="color: #a0522d;">p</span> = threading.Thread(target=d.produce, name=<span style="color: #8b2252;">'producer'</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22686;&#21152;&#28040;&#36153;&#32773;</span>
<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5):
    <span style="color: #a0522d;">c</span> = threading.Thread(target=d.consume, name=<span style="color: #8b2252;">'consumer{}'</span>.<span style="color: #483d8b;">format</span>(i))
    c.start()
p.start()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:16,733 consumer0 14844 consume...</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:16,733 consumer1 11276 consume...</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:16,734 consumer2 16232 consume...</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:16,734 consumer3 21172 consume...</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:16,734 consumer4 27172 consume...</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:16,734 producer 26236 starting...</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:17,740 producer 26236 17</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:17,741 consumer0 14844 17</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:17,741 consumer1 11276 17</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:18,751 producer 26236 1</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:18,752 consumer3 21172 1</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:18,752 consumer2 16232 1</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:19,761 producer 26236 30</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:19,762 consumer4 27172 30</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:19,762 consumer0 14844 30</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:20,767 producer 26236 49</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:20,768 consumer1 11276 49</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 11:19:20,768 consumer3 21172 49</span>
</pre>
</div>

<p>
è¿™ä¸ªä¾‹å­ï¼Œå¯ä»¥çœ‹åˆ°å®ç°äº†æ¶ˆæ¯çš„ä¸€å¯¹å¤š ï¼Œè¿™å…¶å®å°±æ˜¯å¹¿æ’­æ¨¡å¼ã€‚
</p>

<p>
æ³¨ï¼šä¸Šä¾‹ä¸­ï¼Œç¨‹åºæœ¬èº«ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œç¨‹åºé€»è¾‘æœ‰å¾ˆå¤šç‘•ç–µï¼Œä½†æ˜¯å¯ä»¥å¾ˆå¥½çš„å¸®åŠ©ç†è§£Conditionçš„ä½¿ç”¨å’Œç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ã€‚
</p>


<p>
Conditionæ€»ç»“
</p>
<ul class="org-ul">
<li>Conditionç”¨äºç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ä¸­ï¼Œè§£å†³ç”Ÿäº§è€…æ¶ˆè´¹è€…é€Ÿåº¦åŒ¹é…çš„é—®é¢˜</li>
<li>é‡‡ç”¨äº†é€šçŸ¥æœºåˆ¶ï¼Œéå¸¸æœ‰æ•ˆç‡</li>
</ul>

<p>
ä½¿ç”¨æ–¹å¼
</p>
<ul class="org-ul">
<li>ä½¿ç”¨Conditionï¼Œå¿…é¡»å…ˆacquireï¼Œç”¨å®Œäº†è¦releaseï¼Œå› ä¸ºå†…éƒ¨ä½¿ç”¨äº†é”ï¼Œé»˜è®¤ä½¿ç”¨RLocké”ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨withä¸Šä¸‹æ–‡</li>
<li>æ¶ˆè´¹è€…waitï¼Œç­‰å¾…é€šçŸ¥</li>
<li>ç”Ÿäº§è€…ç”Ÿäº§å¥½æ¶ˆæ¯ï¼Œå¯¹æ¶ˆè´¹è€…å‘é€šçŸ¥ï¼Œå¯ä»¥ä½¿ç”¨notifyæˆ–è€…notify_allæ–¹æ³•</li>
</ul>
</div>
</div>
<div id="outline-container-h:1372e12c-5419-4dad-af6c-a9c7ed2e749d" class="outline-3">
<h3 id="h:1372e12c-5419-4dad-af6c-a9c7ed2e749d">semaphoreä¿¡å·é‡</h3>
<div class="outline-text-3" id="text-h:1372e12c-5419-4dad-af6c-a9c7ed2e749d">
<p>
å’ŒLockå¾ˆåƒï¼Œä¿¡å·é‡å¯¹è±¡å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªå€’è®¡æ•°å™¨ï¼Œæ¯ä¸€æ¬¡acquireéƒ½ä¼šå‡1ï¼Œå½“
acquireæ–¹æ³•å‘ç°è®¡æ•°ä¸º0å°±é˜»å¡è¯·æ±‚çš„çº¿ç¨‹ï¼Œç›´åˆ°å…¶å®ƒçº¿ç¨‹å¯¹ä¿¡å·é‡releaseåï¼Œ
è®¡æ•°å¤§äº0ï¼Œæ¢å¤é˜»å¡çš„çº¿ç¨‹ã€‚
</p>

<pre class="example" id="org14ea6a4">
Semaphore(value=1)     æ„é€ æ–¹æ³•ã€‚valueå°äº0ï¼ŒæŠ›ValueErrorå¼‚å¸¸
acquire(blocking=True, timeout=None)    è·å–ä¿¡å·é‡ï¼Œè®¡æ•°å™¨å‡1ï¼Œè·å–æˆåŠŸè¿”å›True
release()              é‡Šæ”¾ä¿¡å·é‡ï¼Œè®¡æ•°å™¨åŠ 1
</pre>

<p>
èŒƒä¾‹ï¼š
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Thread, Semaphore
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">import</span> random

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s %(threadName)s %(thread)d %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20449;&#21495;&#37327;</span>
<span style="color: #a0522d;">s</span> = threading.Semaphore(3)
logging.info(s.acquire())
logging.info(s._value)
logging.info(s.acquire())
logging.info(s._value)
logging.info(s.acquire())
logging.info(s._value)
logging.info(<span style="color: #8b2252;">'----'</span>)
s.release() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#37322;&#25918;&#19968;&#20010;&#20449;&#21495;&#37327;</span>
s.release()
s.release()
logging.info(s.<span style="color: #483d8b;">__dict__</span>)
s.release()
logging.info(s.<span style="color: #483d8b;">__dict__</span>)
s.release()
logging.info(s.<span style="color: #483d8b;">__dict__</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:25:31,454 MainThread 27692 True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:25:31,455 MainThread 27692 2</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:25:31,455 MainThread 27692 True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:25:31,455 MainThread 27692 1</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:25:31,455 MainThread 27692 True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:25:31,455 MainThread 27692 0</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:25:31,456 MainThread 27692 ----</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:25:31,456 MainThread 27692 {'_cond': &lt;Condition(&lt;unlocked _thread.lock object at 0x000001ADBA3FE590&gt;, 0)&gt;, '_value': 3}    </span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:25:31,456 MainThread 27692 {'_cond': &lt;Condition(&lt;unlocked _thread.lock object at 0x000001ADBA3FE590&gt;, 0)&gt;, '_value': 4}    </span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:25:31,456 MainThread 27692 {'_cond': &lt;Condition(&lt;unlocked _thread.lock object at 0x000001ADBA3FE590&gt;, 0)&gt;, '_value': 5}</span>
</pre>
</div>

<p>
è®¡æ•°å™¨æ°¸è¿œä¸ä¼šä½äº0ï¼Œå› ä¸ºacquireçš„æ—¶å€™ï¼Œå‘ç°æ˜¯0ï¼Œéƒ½ä¼šè¢«é˜»å¡ã€‚
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Thread, Semaphore
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">import</span> random

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s %(threadName)s %(thread)d %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20449;&#21495;&#37327;</span>
<span style="color: #a0522d;">s</span> = threading.Semaphore(3)
logging.info(s.acquire())
logging.info(s._value)
logging.info(s.acquire())
logging.info(s._value)
logging.info(s.acquire())
logging.info(s._value)
logging.info(<span style="color: #8b2252;">'----'</span>)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    logging.info(s)
    logging.info(s.<span style="color: #483d8b;">__dict__</span>)
    logging.info(s.acquire())
    <span style="color: #b22222;"># </span><span style="color: #b22222;">s.release() #&#37322;&#25918;&#19968;&#20010;&#20449;&#21495;&#37327;</span>
    logging.info(<span style="color: #8b2252;">'release s one time'</span>)
    logging.info(s.<span style="color: #483d8b;">__dict__</span>)

threading.Timer(2, worker).start()

time.sleep(3)
<span style="color: #b22222;"># </span><span style="color: #b22222;">logging.info(s.acquire())</span>
s.release() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#37322;&#25918;&#19968;&#20010;&#20449;&#21495;&#37327;</span>
logging.info(s.<span style="color: #483d8b;">__dict__</span>)
logging.info(<span style="color: #8b2252;">'got it'</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:21:31,906 MainThread 28616 True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:21:31,907 MainThread 28616 2</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:21:31,907 MainThread 28616 True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:21:31,907 MainThread 28616 1</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:21:31,907 MainThread 28616 True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:21:31,907 MainThread 28616 0</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:21:31,908 MainThread 28616 ----</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:21:33,923 Thread-1 22360 &lt;threading.Semaphore at 0x1aeb5550590: value=0&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:21:33,924 Thread-1 22360 {'_cond': &lt;Condition(&lt;unlocked _thread.lock object at 0x000001AEB551E390&gt;, 0)&gt;, '_value': 0}      </span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:21:34,908 MainThread 28616 {'_cond': &lt;Condition(&lt;unlocked _thread.lock object at 0x000001AEB551E390&gt;, 0)&gt;, '_value': 1}</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:21:34,909 MainThread 28616 got it</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:21:34,909 Thread-1 22360 True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:21:34,910 Thread-1 22360 release s one time</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:21:34,910 Thread-1 22360 {'_cond': &lt;Condition(&lt;unlocked _thread.lock object at 0x000001AEB551E390&gt;, 0)&gt;, '_value': 0} </span>
</pre>
</div>
</div>
<div id="outline-container-h:d9bff5d6-b452-4bf2-9ec5-9d3aca8c0850" class="outline-4">
<h4 id="h:d9bff5d6-b452-4bf2-9ec5-9d3aca8c0850">releaseæ–¹æ³•è¶…ç•Œé—®é¢˜</h4>
<div class="outline-text-4" id="text-h:d9bff5d6-b452-4bf2-9ec5-9d3aca8c0850">
<p>
å‡è®¾å¦‚æœè¿˜æ²¡æœ‰acquireä¿¡å·é‡ï¼Œå°±releaseï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ
</p>

<p>
ä»ä¸Šä¾‹è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºï¼Œç«Ÿç„¶å†…ç½®è®¡æ•°å™¨è¾¾åˆ°äº†5ï¼Œè¿™æ ·å®é™…ä¸Šè¶…å‡ºæˆ‘ä»¬çš„æœ€å¤§å€¼ï¼Œéœ€è¦è§£å†³è¿™ä¸ªé—®é¢˜
</p>
</div>
</div>
</div>
<div id="outline-container-h:a29d1497-9ab7-4367-8eda-8473e71c53fe" class="outline-3">
<h3 id="h:a29d1497-9ab7-4367-8eda-8473e71c53fe">BoundedSemaphoreç±»</h3>
<div class="outline-text-3" id="text-h:a29d1497-9ab7-4367-8eda-8473e71c53fe">
<p>
æœ‰ç•Œçš„ä¿¡å·é‡ï¼Œä¸å…è®¸ä½¿ç”¨releaseè¶…å‡ºåˆå§‹å€¼çš„èŒƒå›´ï¼Œå¦åˆ™ï¼ŒæŠ›å‡ºValueErrorå¼‚å¸¸
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Thread, Semaphore
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">import</span> random

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s %(threadName)s %(thread)d %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20449;&#21495;&#37327;</span>
<span style="color: #a0522d;">s</span> = threading.BoundedSemaphore(3) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377;&#30028;&#30340;&#20449;&#21495;&#37327;</span>
logging.info(s.acquire())
logging.info(s._value)
logging.info(s.acquire())
logging.info(s._value)
logging.info(s.acquire())
logging.info(s._value)
logging.info(<span style="color: #8b2252;">'----'</span>)
s.release() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#37322;&#25918;&#19968;&#20010;&#20449;&#21495;&#37327;</span>
s.release()
s.release()
logging.info(s.<span style="color: #483d8b;">__dict__</span>)
s.release() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36229;&#30028;&#20102;&#65292;&#25253;&#38169;</span>
logging.info(s.<span style="color: #483d8b;">__dict__</span>)
s.release()
logging.info(s.<span style="color: #483d8b;">__dict__</span>)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:35:55,695 MainThread 12376 True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:35:55,695 MainThread 12376 2</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:35:55,695 MainThread 12376 True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:35:55,695 MainThread 12376 1</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:35:55,695 MainThread 12376 True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:35:55,695 MainThread 12376 0</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:35:55,696 MainThread 12376 ----</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 15:35:55,696 MainThread 12376 {'_cond': &lt;Condition(&lt;unlocked _thread.lock object at 0x0000021BFA58FC90&gt;, 0)&gt;, '_value': 3, '_initial_value': 3}</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Traceback (most recent call last):</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">File "d:\project\pyproj\cursor\t.py", line 23, in &lt;module&gt;</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">s.release()</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">~~~~~~~~~^^</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">File "D:\py\py313\Lib\threading.py", line 576, in release</span>
<span style="color: #b22222;">#     </span><span style="color: #b22222;">raise ValueError("Semaphore released too many times")</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">ValueError: Semaphore released too many times</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:55bd30b1-c864-40ac-b076-754adce345b7" class="outline-3">
<h3 id="h:55bd30b1-c864-40ac-b076-754adce345b7">åº”ç”¨ä¸¾ä¾‹</h3>
<div class="outline-text-3" id="text-h:55bd30b1-c864-40ac-b076-754adce345b7">
<ul class="org-ul">
<li><p>
è¿æ¥æ± 
</p>

<p>
å› ä¸ºèµ„æºæœ‰é™ï¼Œä¸”å¼€å¯ä¸€ä¸ªè¿æ¥æˆæœ¬é«˜ï¼Œæ‰€ä»¥ï¼Œä½¿ç”¨è¿æ¥æ± 
</p></li>

<li><p>
ä¸€ä¸ªç®€å•çš„è¿æ¥æ± 
</p>

<p>
è¿æ¥æ± åº”è¯¥æœ‰å®¹é‡ï¼ˆæ€»æ•°ï¼‰ï¼Œæœ‰ä¸€ä¸ªå·¥å‚æ–¹æ³•å¯ä»¥è·å–è¿æ¥ï¼Œèƒ½å¤ŸæŠŠä¸ç”¨çš„è¿æ¥è¿”å›ï¼Œä¾›å…¶ä»–è°ƒç”¨è€…ä½¿ç”¨
</p></li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Conn</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Pool</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, count:<span style="color: #483d8b;">int</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">count</span> = count
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27744;&#20013;&#25552;&#21069;&#25918;&#30528;&#36830;&#25509;&#22791;&#29992;</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">pool</span> = [<span style="color: #a020f0;">self</span>._connect(<span style="color: #8b2252;">'conn-{}'</span>.<span style="color: #483d8b;">format</span>(i)) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(<span style="color: #a020f0;">self</span>.count)]

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_connect</span>(<span style="color: #a020f0;">self</span>, conn_name):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#36830;&#25509;&#30340;&#26041;&#27861;&#65292;&#36820;&#22238;&#19968;&#20010;&#36830;&#25509;&#23545;&#35937;</span>
        <span style="color: #a020f0;">return</span> Conn(conn_name)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_conn</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20174;&#27744;&#20013;&#25343;&#36208;&#19968;&#20010;&#36830;&#25509;</span>
        <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">len</span>(<span style="color: #a020f0;">self</span>.pool) &gt; 0:
            <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.pool.pop()

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">return_conn</span>(<span style="color: #a020f0;">self</span>, conn:Conn):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21521;&#27744;&#20013;&#36820;&#22238;&#19968;&#20010;&#36830;&#25509;&#23545;&#35937;</span>
        <span style="color: #a020f0;">self</span>.pool.append(conn)
</pre>
</div>

<p>
çœŸæ­£çš„è¿æ¥æ± çš„å®ç°æ¯”ä¸Šé¢çš„ä¾‹å­è¦å¤æ‚çš„å¤šï¼Œè¿™é‡Œåªæ˜¯ç®€å•çš„ä¸€ä¸ªåŠŸèƒ½çš„å®ç°
</p>

<ul class="org-ul">
<li><p>
æœ¬ä¾‹ä¸­ï¼Œget_conn()æ–¹æ³•åœ¨å¤šçº¿ç¨‹çš„æ—¶å€™æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜
</p>

<p>
å‡è®¾æ± ä¸­æ­£å¥½æœ‰ä¸€ä¸ªè¿æ¥ï¼Œæœ‰å¯èƒ½å¤šä¸ªçº¿ç¨‹åˆ¤æ–­æ± çš„é•¿åº¦æ˜¯å¤§äº0çš„ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‹¿èµ°äº†è¿æ¥å¯¹è±¡ï¼Œå…¶ä»–çº¿ç¨‹å†æ¥popå°±ä¼šæŠ›å¼‚å¸¸çš„ã€‚å¦‚ä½•è§£å†³ï¼Ÿ
</p>

<p>
1ã€åŠ é”ï¼Œåœ¨è¯»å†™çš„åœ°æ–¹åŠ é”
</p>

<p>
2ã€ä½¿ç”¨ä¿¡å·é‡Semaphore
</p></li>
</ul>

<p>
èŒƒä¾‹ï¼šåŠ é”æ–¹å¼ï¼Œè¿æ¥æ± 
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Thread, Semaphore
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">import</span> random

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s %(threadName)s %(thread)d %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #b22222;">#</span><span style="color: #b22222;">Pool &#27744;&#65292;&#27744;&#20013;&#36164;&#28304;&#33719;&#24471;&#24456;&#19981;&#23481;&#26131;&#65292;&#20294;&#26159;&#25105;&#20204;&#29992;&#30340;&#24456;&#39057;&#32321;&#65292;&#32780;&#19988;&#36824;&#35201;&#22797;&#29992;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36830;&#25509;&#27744;, &#21019;&#24314;&#36830;&#25509;&#12289;&#32500;&#25252;&#36830;&#25509;&#38750;&#24120;&#28040;&#32791;&#36164;&#28304;&#12290;&#32447;&#31243;&#27744;&#12289;&#36827;&#31243;&#27744;</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Conn</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Pool</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, count:<span style="color: #483d8b;">int</span>=5):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">count</span> = count
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27744;&#20013;&#25552;&#21069;&#25918;&#30528;&#36830;&#25509;&#22791;&#29992;</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">pool</span> = [<span style="color: #a020f0;">self</span>._connect(<span style="color: #8b2252;">'conn-{}'</span>.<span style="color: #483d8b;">format</span>(i)) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(<span style="color: #a020f0;">self</span>.count)]
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_lock</span> = threading.Lock()

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_connect</span>(<span style="color: #a020f0;">self</span>, conn_name):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#36830;&#25509;&#30340;&#26041;&#27861;&#65292;&#36820;&#22238;&#19968;&#20010;&#36830;&#25509;&#23545;&#35937;</span>
        <span style="color: #a020f0;">return</span> Conn(conn_name)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_conn</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20174;&#27744;&#20013;&#25343;&#36208;&#19968;&#20010;&#36830;&#25509;</span>
        <span style="color: #a020f0;">with</span> <span style="color: #a020f0;">self</span>._lock:
            <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">len</span>(<span style="color: #a020f0;">self</span>.pool) &gt; 0:
                <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.pool.pop()

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">return_conn</span>(<span style="color: #a020f0;">self</span>, conn:Conn):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21521;&#27744;&#20013;&#36820;&#22238;&#19968;&#20010;&#36830;&#25509;&#23545;&#35937;</span>
        <span style="color: #a020f0;">with</span> <span style="color: #a020f0;">self</span>._lock:
            <span style="color: #a020f0;">self</span>.pool.append(conn)


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21021;&#22987;&#21270;&#36830;&#25509;&#27744;</span>
<span style="color: #a0522d;">pool</span> = Pool(3)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(pool:Pool):
    <span style="color: #a0522d;">conn</span> = pool.get_conn()
    logging.info(conn)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27169;&#25311;&#20351;&#29992;&#20102;&#19968;&#27573;&#26102;&#38388;</span>
    time.sleep(random.randint(1, 5))
    pool.return_conn(conn)

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(6):
    threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker-{}'</span>.<span style="color: #483d8b;">format</span>(i), args=(pool,)).start()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 17:29:55,987 worker-0 18212 &lt;__main__.Conn object at 0x00000238B7D2EFD0&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 17:29:55,988 worker-1 27588 &lt;__main__.Conn object at 0x00000238B7D2EE90&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 17:29:55,988 worker-2 23464 &lt;__main__.Conn object at 0x00000238B7D36510&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 17:29:55,988 worker-3 28380 None</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 17:29:55,989 worker-4 24136 None</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 17:29:55,989 worker-5 26188 None</span>
</pre>
</div>

<p>
èŒƒä¾‹ï¼šä½¿ç”¨ä¿¡å·é‡å¯¹ä¸Šä¾‹è¿›è¡Œä¿®æ”¹
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Thread, Semaphore
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">import</span> random

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s %(threadName)s %(thread)d %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #b22222;">#</span><span style="color: #b22222;">Pool &#27744;&#65292;&#27744;&#20013;&#36164;&#28304;&#33719;&#24471;&#24456;&#19981;&#23481;&#26131;&#65292;&#20294;&#26159;&#25105;&#20204;&#29992;&#30340;&#24456;&#39057;&#32321;&#65292;&#32780;&#19988;&#36824;&#35201;&#22797;&#29992;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36830;&#25509;&#27744;, &#21019;&#24314;&#36830;&#25509;&#12289;&#32500;&#25252;&#36830;&#25509;&#38750;&#24120;&#28040;&#32791;&#36164;&#28304;&#12290;&#32447;&#31243;&#27744;&#12289;&#36827;&#31243;&#27744;</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Conn</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, name):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Pool</span>:
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, count:<span style="color: #483d8b;">int</span>=5):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">count</span> = count
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27744;&#20013;&#25552;&#21069;&#25918;&#30528;&#36830;&#25509;&#22791;&#29992;</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">pool</span> = [<span style="color: #a020f0;">self</span>._connect(<span style="color: #8b2252;">'conn-{}'</span>.<span style="color: #483d8b;">format</span>(i)) <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(<span style="color: #a020f0;">self</span>.count)]
        <span style="color: #b22222;"># </span><span style="color: #b22222;">self._lock = threading.Lock()</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">self.sema = threading.Semaphore(self.count)</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">sema</span> = threading.BoundedSemaphore(<span style="color: #a020f0;">self</span>.count)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_connect</span>(<span style="color: #a020f0;">self</span>, conn_name):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#36830;&#25509;&#30340;&#26041;&#27861;&#65292;&#36820;&#22238;&#19968;&#20010;&#36830;&#25509;&#23545;&#35937;</span>
        <span style="color: #a020f0;">return</span> Conn(conn_name)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_conn</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20174;&#27744;&#20013;&#25343;&#36208;&#19968;&#20010;&#36830;&#25509;</span>
        <span style="color: #a020f0;">self</span>.sema.acquire()
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.pool.pop()

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">return_conn</span>(<span style="color: #a020f0;">self</span>, conn:Conn):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21521;&#27744;&#20013;&#36820;&#22238;&#19968;&#20010;&#36830;&#25509;&#23545;&#35937;</span>
        <span style="color: #a020f0;">self</span>.pool.append(conn)
        <span style="color: #a020f0;">self</span>.sema.release()


<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21021;&#22987;&#21270;&#36830;&#25509;&#27744;</span>
<span style="color: #a0522d;">pool</span> = Pool(3)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(pool:Pool):
    <span style="color: #a0522d;">conn</span> = pool.get_conn()
    logging.info(conn)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27169;&#25311;&#20351;&#29992;&#20102;&#19968;&#27573;&#26102;&#38388;</span>
    time.sleep(random.randint(1, 5))
    pool.return_conn(conn)

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(6):
    threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker-{}'</span>.<span style="color: #483d8b;">format</span>(i), args=(pool,)).start()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 17:50:03,637 worker-0 28432 &lt;__main__.Conn object at 0x000002C0718F7250&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 17:50:03,637 worker-1 22796 &lt;__main__.Conn object at 0x000002C0718F7110&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 17:50:03,637 worker-2 26252 &lt;__main__.Conn object at 0x000002C0719163C0&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 17:50:06,638 worker-3 14912 &lt;__main__.Conn object at 0x000002C0718F7110&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 17:50:06,638 worker-4 25476 &lt;__main__.Conn object at 0x000002C0719163C0&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 17:50:07,638 worker-5 22960 &lt;__main__.Conn object at 0x000002C0718F7250&gt;</span>
</pre>
</div>

<p>
ä¸Šä¾‹ä¸­ï¼Œä½¿ç”¨ä¿¡å·é‡è§£å†³èµ„æºæœ‰é™çš„é—®é¢˜
</p>

<p>
å¦‚æœæ± ä¸­æœ‰èµ„æºï¼Œè¯·æ±‚è€…è·å–èµ„æºæ—¶ä¿¡å·é‡å‡1ï¼Œæ‹¿èµ°èµ„æºã€‚å½“è¯·æ±‚è¶…è¿‡èµ„æºæ•°ï¼Œ
è¯·æ±‚è€…åªèƒ½ç­‰å¾…ã€‚å½“ä½¿ç”¨è€…ç”¨å®Œå½’è¿˜èµ„æºåä¿¡å·é‡åŠ 1ï¼Œç­‰å¾…çº¿ç¨‹å°±å¯ä»¥è¢«å”¤é†’
æ‹¿èµ°èµ„æº
</p>

<p>
æ³¨æ„ï¼šè¿™ä¸ªè¿æ¥æ± çš„ä¾‹å­ä¸èƒ½ç”¨åˆ°ç”Ÿæˆç¯å¢ƒï¼Œåªæ˜¯ä¸ºäº†è¯´æ˜ä¿¡å·é‡ä½¿ç”¨çš„ä¾‹å­ï¼Œè¿æ¥æ± è¿˜æœ‰å¾ˆå¤šæœªå®ŒæˆåŠŸèƒ½
</p>
</div>
</div>
<div id="outline-container-h:fce456b1-0bca-4620-b27d-04d79f16118f" class="outline-3">
<h3 id="h:fce456b1-0bca-4620-b27d-04d79f16118f">é—®é¢˜</h3>
<div class="outline-text-3" id="text-h:fce456b1-0bca-4620-b27d-04d79f16118f">
<p>
self.conns.append(conn) è¿™ä¸€å¥æœ‰å“ªäº›é—®é¢˜è€ƒè™‘ï¼Ÿ
</p>
</div>
<div id="outline-container-h:8dbf3134-ac8b-4581-8b66-1dfd6c7017cf" class="outline-4">
<h4 id="h:8dbf3134-ac8b-4581-8b66-1dfd6c7017cf">1ã€è¾¹ç•Œé—®é¢˜åˆ†æ</h4>
<div class="outline-text-4" id="text-h:8dbf3134-ac8b-4581-8b66-1dfd6c7017cf">
<p>
return_connæ–¹æ³•å¯ä»¥å•ç‹¬æ‰§è¡Œï¼Œæœ‰å¯èƒ½å¤šå½’è¿˜è¿æ¥ï¼Œä¹Ÿå°±æ˜¯ä¼šå¤šreleaseï¼Œæ‰€ä»¥ï¼Œè¦ç”¨æœ‰ç•Œä¿¡å·é‡
</p>

<p>
BoundedSemaphoreç±»
</p>

<p>
è¿™æ ·ç”¨æœ‰ç•Œä¿¡å·é‡ä¿®æ”¹æºä»£ç ï¼Œä¿è¯å¦‚æœå¤šreturn_connå°±ä¼šæŠ›å¼‚å¸¸
</p>

<pre class="example" id="org3ddfc8f">
self.pool.append(conn)
self.semaphore.release()
</pre>

<p>
å‡è®¾ä¸€ç§æç«¯æƒ…å†µï¼Œè®¡æ•°å™¨è¿˜å·®1å°±å½’è¿˜æ»¡äº†ï¼Œæœ‰ä¸‰ä¸ªçº¿ç¨‹Aã€Bã€Céƒ½æ‰§è¡Œäº†ç¬¬ä¸€å¥ï¼Œéƒ½æ²¡æœ‰æ¥å¾—åŠreleaseï¼Œè¿™æ—¶å€™è½®åˆ°çº¿ç¨‹A releaseï¼Œæ­£å¸¸çš„releaseï¼Œç„¶åè½®åˆ°çº¿ç¨‹Cå…ˆreleaseï¼Œä¸€å®šå‡ºé—®é¢˜ï¼Œè¶…ç•Œäº†ï¼Œç›´æ¥æŠ›å¼‚å¸¸
</p>

<p>
å› æ­¤ä¿¡å·é‡ï¼Œå¯ä»¥ä¿è¯ï¼Œä¸€å®šä¸èƒ½å¤šå½’è¿˜
</p>

<p>
å¦‚æœå½’è¿˜äº†åŒä¸€ä¸ªè¿æ¥å¤šæ¬¡æ€ä¹ˆåŠï¼Œé‡å¤å¾ˆå®¹æ˜“åˆ¤æ–­
</p>

<p>
è¿™ä¸ªç¨‹åºè¿˜ä¸èƒ½åˆ¤æ–­è¿™äº›è¿æ¥æ˜¯ä¸æ˜¯åŸæ¥è‡ªå·±åˆ›å»ºçš„ï¼Œè¿™ä¸æ˜¯ç”Ÿæˆç¯å¢ƒç”¨çš„ä»£ç ï¼Œåªæ˜¯ç®€å•æ¼”ç¤º
</p>
</div>
</div>
<div id="outline-container-h:4bc251f2-7f15-4404-a5cc-4858c4484545" class="outline-4">
<h4 id="h:4bc251f2-7f15-4404-a5cc-4858c4484545">2ã€æ­£å¸¸ä½¿ç”¨åˆ†æ</h4>
<div class="outline-text-4" id="text-h:4bc251f2-7f15-4404-a5cc-4858c4484545">
<p>
æ­£å¸¸ä½¿ç”¨ä¿¡å·é‡ï¼Œéƒ½ä¼šå…ˆè·å–ä¿¡å·é‡ï¼Œç„¶åç”¨å®Œå½’è¿˜
</p>

<p>
åˆ›å»ºå¾ˆå¤šçº¿ç¨‹ï¼Œéƒ½å»è·å–ä¿¡å·é‡ï¼Œæ²¡æœ‰è·å¾—ä¿¡å·é‡çš„çº¿ç¨‹éƒ½é˜»å¡ã€‚èƒ½å½’è¿˜çš„çº¿ç¨‹éƒ½æ˜¯å‰é¢è·å–åˆ°ä¿¡å·é‡çš„çº¿ç¨‹ï¼Œå…¶ä»–æ²¡æœ‰è·å¾—çº¿ç¨‹éƒ½é˜»å¡ç€ã€‚éé˜»å¡çš„çº¿ç¨‹appendåæ‰releaseï¼Œè¿™æ—¶å€™ç­‰å¾…çš„çº¿ç¨‹è¢«å”¤é†’ï¼Œæ‰èƒ½popï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰è·å–ä¿¡å·é‡å°±ä¸èƒ½popï¼Œè¿™æ˜¯å®‰å…¨çš„
</p>

<p>
ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œä¿¡å·é‡æ¯”è®¡ç®—åˆ—è¡¨é•¿åº¦å¥½ï¼Œçº¿ç¨‹å®‰å…¨
</p>
</div>
</div>
</div>
<div id="outline-container-h:73137cd7-fd42-408e-a4ec-e8fbaaabcf88" class="outline-3">
<h3 id="h:73137cd7-fd42-408e-a4ec-e8fbaaabcf88">ä¿¡å·é‡å’Œé”</h3>
<div class="outline-text-3" id="text-h:73137cd7-fd42-408e-a4ec-e8fbaaabcf88">
<p>
ä¿¡å·é‡ï¼Œå¯ä»¥å¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºï¼Œä½†è¿™ä¸ªå…±äº«èµ„æºæ•°é‡æœ‰é™ã€‚
</p>

<p>
é”ï¼Œå¯ä»¥çœ‹åšç‰¹æ®Šçš„ä¿¡å·é‡ï¼Œå³ä¿¡å·é‡è®¡æ•°å™¨åˆå€¼ä¸º1ã€‚åªå…è®¸åŒä¸€ä¸ªæ—¶é—´ä¸€ä¸ªçº¿ç¨‹ç‹¬å èµ„æºã€‚
</p>
</div>
</div>
<div id="outline-container-h:bbcab601-a08c-447f-9b11-c44c891cced1" class="outline-3">
<h3 id="h:bbcab601-a08c-447f-9b11-c44c891cced1">Queueçš„çº¿ç¨‹å®‰å…¨</h3>
<div class="outline-text-3" id="text-h:bbcab601-a08c-447f-9b11-c44c891cced1">
<p>
æ ‡å‡†åº“queueæ¨¡å—ï¼Œæä¾›FIFOçš„Queueã€LIFOçš„é˜Ÿåˆ—ã€ä¼˜å…ˆé˜Ÿåˆ—ã€‚
</p>

<p>
Queueç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé€‚ç”¨äºå¤šçº¿ç¨‹é—´å®‰å…¨çš„äº¤æ¢æ•°æ®ã€‚å†…éƒ¨ä½¿ç”¨äº†Lockå’ŒConditionã€‚
</p>

<p>
ä¸ºä»€ä¹ˆè®²é­”æœ¯æ–¹æ³•æ—¶ï¼Œè¯´å®ç°å®¹å™¨çš„å¤§å°ï¼Œä¸å‡†ç¡®ï¼Ÿ
</p>

<p>
å¦‚æœä¸åŠ é”ï¼Œæ˜¯ä¸å¯èƒ½è·å¾—å‡†ç¡®çš„å¤§å°çš„ï¼Œå› ä¸ºä½ åˆšè¯»å–åˆ°äº†ä¸€ä¸ªå¤§å°ï¼Œè¿˜æ²¡æœ‰å–èµ°æ•°æ®ï¼Œå°±æœ‰å¯èƒ½
è¢«å…¶ä»–çº¿ç¨‹æ”¹äº†ã€‚
</p>

<p>
Queueç±»çš„sizeè™½ç„¶åŠ äº†é”ï¼Œä½†æ˜¯ï¼Œä¾ç„¶ä¸èƒ½ä¿è¯ç«‹å³getã€putå°±èƒ½æˆåŠŸï¼Œå› ä¸ºè¯»å–å¤§å°å’Œgetã€putæ–¹æ³•æ˜¯åˆ†å¼€çš„ã€‚
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> queue

<span style="color: #a0522d;">q</span> = queue.Queue(8)

<span style="color: #a020f0;">if</span> q.qsize == 7:
    q.put() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19978;&#19979;&#20004;&#21477;&#21487;&#33021;&#34987;&#25171;&#26029;</span>

<span style="color: #a020f0;">if</span> q.qsize == 1:
    q.get() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26410;&#24517;&#20250;&#25104;&#21151;</span>
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:eb43234c-dbde-405c-a13c-f0310203a8da" class="outline-2">
<h2 id="h:eb43234c-dbde-405c-a13c-f0310203a8da">GILå…¨å±€è§£é‡Šå™¨é”</h2>
<div class="outline-text-2" id="text-h:eb43234c-dbde-405c-a13c-f0310203a8da">
<p>
å‚è€ƒæ–‡æ¡£ï¼š<a href="https://docs.python.org/3/glossary.html#term-GIL">https://docs.python.org/3/glossary.html#term-GIL</a>
</p>

<blockquote>
<p>
CPython è§£é‡Šå™¨æ‰€é‡‡ç”¨çš„ä¸€ç§æœºåˆ¶ï¼Œå®ƒç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œ
Python bytecodeã€‚æ­¤æœºåˆ¶é€šè¿‡è®¾ç½®å¯¹è±¡æ¨¡å‹ï¼ˆåŒ…æ‹¬ dict ç­‰é‡è¦å†…ç½®ç±»å‹ï¼‰é’ˆ
å¯¹å¹¶å‘è®¿é—®çš„éšå¼å®‰å…¨ç®€åŒ–äº† CPython å®ç°ã€‚ç»™æ•´ä¸ªè§£é‡Šå™¨åŠ é”ä½¿å¾—è§£é‡Šå™¨å¤š
çº¿ç¨‹è¿è¡Œæ›´æ–¹ä¾¿ï¼Œå…¶ä»£ä»·åˆ™æ˜¯ç‰ºç‰²äº†åœ¨å¤šå¤„ç†å™¨ä¸Šçš„å¹¶è¡Œæ€§ã€‚
</p>

<p>
ä¸è¿‡ï¼ŒæŸäº›æ ‡å‡†åº“æˆ–ç¬¬ä¸‰æ–¹åº“çš„æ‰©å±•æ¨¡å—è¢«è®¾è®¡ä¸ºåœ¨æ‰§è¡Œè®¡ç®—å¯†é›†å‹ä»»åŠ¡å¦‚å‹ç¼©æˆ–å“ˆå¸Œæ—¶é‡Šæ”¾ GILã€‚ æ­¤å¤–ï¼Œåœ¨æ‰§è¡Œ I/O æ“ä½œæ—¶ä¹Ÿæ€»æ˜¯ä¼šé‡Šæ”¾ GILã€‚
</p>

<p>
åœ¨ Python 3.13 ä¸­ï¼ŒGIL å¯ä»¥ä½¿ç”¨ &#x2013;disable-gil æ„å»ºé…ç½®é€‰é¡¹æ¥ç¦ç”¨ã€‚ åœ¨
ä½¿ç”¨æ­¤é€‰é¡¹æ„å»º Python ä¹‹åï¼Œä»£ç å¿…é¡»é™„å¸¦ -X gil=0 æˆ–åœ¨è®¾ç½®
PYTHON_GIL=0 ç¯å¢ƒå˜é‡åè¿è¡Œã€‚ æ­¤ç‰¹æ€§å°†ä¸ºå¤šçº¿ç¨‹åº”ç”¨ç¨‹åºå¯ç”¨æ€§èƒ½æå‡å¹¶è®©
é«˜æ•ˆç‡åœ°ä½¿ç”¨å¤šæ ¸ CPU æ›´åŠ å®¹æ˜“ã€‚ è¦äº†è§£è¯¦æƒ…ï¼Œè¯·å‚é˜… PEP 703ã€‚
</p>
</blockquote>

<p>
CPython åœ¨è§£é‡Šå™¨è¿›ç¨‹çº§åˆ«æœ‰ä¸€æŠŠé”ï¼Œå«åšGILï¼Œå³å…¨å±€è§£é‡Šå™¨é”ã€‚
</p>

<p>
GIL ä¿è¯CPythonè¿›ç¨‹ä¸­ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå­—èŠ‚ç ã€‚ç”šè‡³æ˜¯åœ¨å¤šæ ¸CPUçš„æƒ…å†µä¸‹ï¼Œä¹Ÿåªå…è®¸åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªCPUä¸Šè¿è¡Œè¯¥è¿›ç¨‹çš„ä¸€ä¸ªçº¿ç¨‹ã€‚
</p>

<p>
CPythonä¸­
</p>
<ul class="org-ul">
<li>IOå¯†é›†å‹ï¼ŒæŸä¸ªçº¿ç¨‹é˜»å¡ï¼Œå°±ä¼šè°ƒåº¦å…¶ä»–å°±ç»ªçº¿ç¨‹</li>
<li>CPUå¯†é›†å‹ï¼Œå½“å‰çº¿ç¨‹å¯èƒ½ä¼šè¿ç»­çš„è·å¾—GILï¼Œå¯¼è‡´å…¶å®ƒçº¿ç¨‹å‡ ä¹æ— æ³•ä½¿ç”¨CPU</li>
<li>åœ¨CPythonä¸­ç”±äºæœ‰GILå­˜åœ¨ï¼ŒIOå¯†é›†å‹ï¼Œä½¿ç”¨å¤šçº¿ç¨‹è¾ƒä¸ºåˆç®—ï¼›CPUå¯†é›†å‹ï¼Œä½¿ç”¨å¤šè¿›ç¨‹ï¼Œè¦ç»•å¼€GIL</li>
</ul>

<p>
æ–°ç‰ˆCPythonæ­£åœ¨åŠªåŠ›ä¼˜åŒ–GILçš„é—®é¢˜ï¼Œä½†ä¸æ˜¯ç§»é™¤ã€‚
</p>

<p>
å¦‚æœåœ¨æ„å¤šçº¿ç¨‹çš„æ•ˆç‡é—®é¢˜ï¼Œè¯·ç»•è¡Œï¼Œé€‰æ‹©å…¶å®ƒè¯­è¨€erlangã€Goç­‰ã€‚
</p>

<blockquote>
<p>
Pythonä¸­ç»å¤§å¤šæ•°å†…ç½®æ•°æ®ç»“æ„çš„è¯»ã€å†™æ“ä½œéƒ½æ˜¯åŸå­æ“ä½œ
</p>

<p>
ç”±äºGILçš„å­˜åœ¨ï¼ŒPythonçš„å†…ç½®æ•°æ®ç±»å‹åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹çš„æ—¶å€™å°±å˜æˆäº†å®‰å…¨çš„äº†ï¼Œä½†æ˜¯å®é™…ä¸Šå®ƒä»¬æœ¬èº«ä¸æ˜¯çº¿ç¨‹å®‰å…¨ç±»å‹
</p>
</blockquote>

<p>
ä¿ç•™GILçš„åŸå› 
</p>

<p>
GuidoåšæŒçš„ç®€å•å“²å­¦ï¼Œå¯¹äºåˆå­¦è€…é—¨æ§›ä½ï¼Œä¸éœ€è¦é«˜æ·±çš„ç³»ç»ŸçŸ¥è¯†ä¹Ÿèƒ½å®‰å…¨ã€ç®€å•çš„ä½¿ç”¨Pythonã€‚
</p>

<p>
è€Œä¸”ç§»é™¤GILï¼Œä¼šé™ä½CPythonå•çº¿ç¨‹çš„æ‰§è¡Œæ•ˆç‡ã€‚
</p>

<p>
æµ‹è¯•ä¸‹é¢2ä¸ªç¨‹åºï¼Œè¯·é—®ä¸‹é¢çš„ç¨‹åºæ˜¯è®¡ç®—å¯†é›†å‹è¿˜æ˜¯IOå¯†é›†å‹ï¼Ÿ
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> logging


<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s %(threadName)s %(thread)d %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">calc</span>():
    <span style="color: #483d8b;">sum</span> = 0
    <span style="color: #a020f0;">for</span> _ <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(100000000): <span style="color: #b22222;">#</span><span style="color: #b22222;">1&#20159;</span>
        <span style="color: #483d8b;">sum</span> += 1
    logging.info(<span style="color: #483d8b;">sum</span>)

<span style="color: #a0522d;">start</span> = datetime.datetime.now()

calc()
calc()
calc()
calc() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32431;&#20018;&#34892;</span>

<span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#20018;&#34892; &#32791;&#26102;={}s'</span>.<span style="color: #483d8b;">format</span>(delta))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 23:24:49,646 MainThread 15556 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 23:24:55,259 MainThread 15556 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 23:25:00,528 MainThread 15556 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 23:25:06,034 MainThread 15556 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20018;&#34892; &#32791;&#26102;=22.13501s</span>
</pre>
</div>


<p>
ä¸‹ä¾‹ä¸ºcpuå¯†é›†å‹
</p>

<p>
ä¸é€‚åˆç”¨å¤šçº¿ç¨‹æ¥ä½¿ç”¨ã€‚å¯ä»¥ä½¿ç”¨å¤šè¿›ç¨‹
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> logging


<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s %(threadName)s %(thread)d %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">calc</span>():
    <span style="color: #483d8b;">sum</span> = 0
    <span style="color: #a020f0;">for</span> _ <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(100000000): <span style="color: #b22222;">#</span><span style="color: #b22222;">1&#20159;</span>
        <span style="color: #483d8b;">sum</span> += 1
    logging.info(<span style="color: #483d8b;">sum</span>)

<span style="color: #a0522d;">start</span> = datetime.datetime.now()

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#24182;&#34892;&#65292;&#20551;&#24182;&#34892;&#65292;&#22240;&#20026;&#26377;GIL</span>
<span style="color: #a0522d;">c1</span> = threading.Thread(target=calc, name=<span style="color: #8b2252;">'c1'</span>)
<span style="color: #a0522d;">c2</span> = threading.Thread(target=calc, name=<span style="color: #8b2252;">'c2'</span>)
<span style="color: #a0522d;">c3</span> = threading.Thread(target=calc, name=<span style="color: #8b2252;">'c3'</span>)
<span style="color: #a0522d;">c4</span> = threading.Thread(target=calc, name=<span style="color: #8b2252;">'c4'</span>)
c1.start()
c2.start()
c3.start()
c4.start()
c1.join()
c2.join()
c3.join()
c4.join()

<span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#22810;&#32447;&#31243; &#32791;&#26102;={}s'</span>.<span style="color: #483d8b;">format</span>(delta))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 23:34:19,970 c2 5884 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 23:34:20,961 c3 18784 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 23:34:21,008 c4 13032 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 23:34:21,025 c1 3396 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22810;&#32447;&#31243; &#32791;&#26102;=19.013177s</span>
</pre>
</div>

<p>
æ³¨æ„ï¼Œä¸è¦åœ¨ä»£ç ä¸­å‡ºç°printç­‰è®¿é—®IOçš„è¯­å¥ã€‚è®¿é—®IOï¼Œçº¿ç¨‹é˜»å¡ï¼Œä¼šé‡Šæ”¾GILé”ï¼Œå…¶ä»–çº¿ç¨‹è¢«è°ƒåº¦
</p>

<p>
ç¨‹åº1æ˜¯å•çº¿ç¨‹ç¨‹åºï¼Œæ‰€æœ‰calc()ä¾æ¬¡æ‰§è¡Œï¼Œæ ¹æœ¬å°±ä¸æ˜¯å¹¶å‘ã€‚åœ¨ä¸»çº¿ç¨‹å†…ï¼Œå‡½æ•°ä¸²è¡Œæ‰§è¡Œã€‚
</p>

<p>
ç¨‹åº2æ˜¯å¤šçº¿ç¨‹ç¨‹åºï¼Œcalc()æ‰§è¡Œåœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ï¼Œä½†æ˜¯ç”±äºGILçš„å­˜åœ¨ï¼Œçº¿ç¨‹çš„
æ‰§è¡Œå˜æˆäº†å‡å¹¶å‘ã€‚ä½†æ˜¯è¿™äº›çº¿ç¨‹å¯ä»¥è¢«è°ƒåº¦åˆ°ä¸åŒçš„CPUæ ¸å¿ƒä¸Šæ‰§è¡Œï¼Œåªä¸è¿‡
GILè®©åŒä¸€æ—¶é—´è¯¥è¿›ç¨‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¢«æ‰§è¡Œã€‚
</p>

<p>
ä»ä¸¤æ®µç¨‹åºæµ‹è¯•çš„ç»“æœæ¥çœ‹ï¼ŒCPythonä¸­å¤šçº¿ç¨‹æ ¹æœ¬æ²¡æœ‰ä»»ä½•ä¼˜åŠ¿ï¼Œå’Œä¸€ä¸ªçº¿ç¨‹
æ‰§è¡Œæ—¶é—´ç›¸å½“ã€‚å› ä¸ºGILçš„å­˜åœ¨ï¼Œå°¤å…¶æ˜¯åƒä¸Šé¢çš„è®¡ç®—å¯†é›†å‹ç¨‹åºï¼Œå’Œå•çº¿ç¨‹ä¸²
è¡Œæ•ˆæœç›¸å½“ã€‚è¿™æ ·ï¼Œå®é™…ä¸Šå°±æ²¡æœ‰ç”¨ä¸ŠCPUå¤šæ ¸å¿ƒçš„ä¼˜åŠ¿ã€‚
</p>
</div>
</section>
<section id="outline-container-h:f4b8b789-b110-477c-bf1e-9abdc639b837" class="outline-2">
<h2 id="h:f4b8b789-b110-477c-bf1e-9abdc639b837">å¤šè¿›ç¨‹</h2>
<div class="outline-text-2" id="text-h:f4b8b789-b110-477c-bf1e-9abdc639b837">
</div>
<div id="outline-container-h:1bd07f42-95dd-4826-bb5f-31e417dbfb1d" class="outline-3">
<h3 id="h:1bd07f42-95dd-4826-bb5f-31e417dbfb1d">å¤šè¿›ç¨‹</h3>
<div class="outline-text-3" id="text-h:1bd07f42-95dd-4826-bb5f-31e417dbfb1d">
<p>
ç”±äºPythonçš„GILå…¨å±€è§£é‡Šå™¨é”å­˜åœ¨ï¼Œå¤šçº¿ç¨‹æœªå¿…æ˜¯CPUå¯†é›†å‹ç¨‹åºçš„å¥½çš„é€‰æ‹©
å¤šè¿›ç¨‹å¯ä»¥å®Œå…¨ç‹¬ç«‹çš„è¿›ç¨‹ç¯å¢ƒä¸­è¿è¡Œç¨‹åºï¼Œå¯ä»¥è¾ƒå……åˆ†åœ°åˆ©ç”¨å¤šå¤„ç†å™¨
ä½†æ˜¯è¿›ç¨‹æœ¬èº«çš„éš”ç¦»å¸¦æ¥çš„æ•°æ®ä¸å…±äº«ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚è€Œä¸”çº¿ç¨‹æ¯”è¿›ç¨‹è½»é‡çº§
</p>
</div>
<div id="outline-container-h:46ca9d23-b3ec-4023-aa68-b051d11b7d5d" class="outline-4">
<h4 id="h:46ca9d23-b3ec-4023-aa68-b051d11b7d5d">multiprocessing</h4>
<div class="outline-text-4" id="text-h:46ca9d23-b3ec-4023-aa68-b051d11b7d5d">
</div>
<div id="outline-container-h:07b702c2-8bd1-4d00-8584-26e3d8ce39af" class="outline-5">
<h5 id="h:07b702c2-8bd1-4d00-8584-26e3d8ce39af">Processç±»</h5>
<div class="outline-text-5" id="text-h:07b702c2-8bd1-4d00-8584-26e3d8ce39af">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> multiprocessing
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> logging


<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s %(processName)s %(threadName)s %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">calc</span>():
    <span style="color: #483d8b;">sum</span> = 0
    <span style="color: #a020f0;">for</span> _ <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(1000000000): <span style="color: #b22222;">#</span><span style="color: #b22222;">10&#20159;</span>
        <span style="color: #483d8b;">sum</span> += 1
    logging.info(<span style="color: #483d8b;">sum</span>)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36827;&#31243;&#26377;&#27809;&#26377;&#36820;&#22238;&#20540;&#65311;</span>
    <span style="color: #a020f0;">return</span> multiprocessing.current_process().name, <span style="color: #483d8b;">sum</span>

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    <span style="color: #a0522d;">start</span> = datetime.datetime.now()

    <span style="color: #a0522d;">workers</span> = []
    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30495;&#24182;&#34892;&#65292;GIL&#26377;&#24433;&#21709;&#21527;&#65311;</span>
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(4): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#21160;&#20102;4&#20010;&#24037;&#20316;&#36827;&#31243;&#65292;&#29992;&#20182;&#20204;&#30340;&#20027;&#32447;&#31243;&#24037;&#20316;</span>
        <span style="color: #a0522d;">p</span> = multiprocessing.Process(target=calc, name=<span style="color: #8b2252;">'p-{}'</span>.<span style="color: #483d8b;">format</span>(i))
        workers.append(p)
        p.start()

    <span style="color: #a020f0;">for</span> p <span style="color: #a020f0;">in</span> workers:
        p.join()
        <span style="color: #483d8b;">print</span>(p.name, p.exitcode)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26159;&#36820;&#22238;&#20540;&#21527;&#65311;</span>

    <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#22810;&#36827;&#31243; &#32791;&#26102;={}s'</span>.<span style="color: #483d8b;">format</span>(delta))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 23:50:08,891 p-1 MainThread 1000000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 23:50:10,386 p-3 MainThread 1000000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 23:50:12,125 p-2 MainThread 1000000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-10 23:50:15,080 p-0 MainThread 1000000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">p-0 0</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">p-1 0</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">p-2 0</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">p-3 0</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22810;&#36827;&#31243; &#32791;&#26102;=72.92779s</span>
</pre>
</div>

<p>
å¯¹äºä¸Šé¢è¿™ä¸ªç¨‹åºï¼Œåœ¨åŒä¸€ä¸»æœºä¸Šè¿è¡Œæ—¶é•¿çš„å¯¹æ¯”
</p>
<ul class="org-ul">
<li>ä½¿ç”¨å•çº¿ç¨‹ã€å¤šçº¿ç¨‹è·‘äº†4åˆ†é’Ÿå¤š</li>
<li>å¤šè¿›ç¨‹ç”¨äº†1åˆ†åŠ</li>
</ul>

<p>
çœ‹åˆ°äº†å¤šä¸ªè¿›ç¨‹éƒ½åœ¨ä½¿ç”¨CPUï¼Œè¿™æ˜¯çœŸå¹¶è¡Œï¼Œè€Œä¸”è¿›ç¨‹åº“å‡ ä¹æ²¡æœ‰å­¦ä¹ éš¾åº¦ã€‚
</p>

<p>
æ³¨æ„ï¼šå¤šè¿›ç¨‹ä»£ç ä¸€å®šè¦æ”¾åœ¨ <code>__name__ =</code> "<span class="underline"><span class="underline">main</span></span>"= ä¸‹é¢æ‰§è¡Œã€‚
</p>


<p>
åç§°	è¯´æ˜
</p>
<pre class="example" id="org005086f">
pid          è¿›ç¨‹id
exitcode     è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ç 
terminate()  ç»ˆæ­¢æŒ‡å®šçš„è¿›ç¨‹
</pre>
</div>
</div>
</div>
<div id="outline-container-h:3585d1d7-7143-4159-95ab-4a82e32db1d9" class="outline-4">
<h4 id="h:3585d1d7-7143-4159-95ab-4a82e32db1d9">è¿›ç¨‹é—´åŒæ­¥</h4>
<div class="outline-text-4" id="text-h:3585d1d7-7143-4159-95ab-4a82e32db1d9">
<p>
Pythonåœ¨è¿›ç¨‹é—´åŒæ­¥æä¾›äº†å’Œçº¿ç¨‹åŒæ­¥ä¸€æ ·çš„ç±»ï¼Œä½¿ç”¨çš„æ–¹æ³•ä¸€æ ·ï¼Œä½¿ç”¨çš„æ•ˆæœä¹Ÿç±»ä¼¼ã€‚
</p>

<p>
ä¸è¿‡ï¼Œè¿›ç¨‹é—´ä»£ä»·è¦é«˜äºçº¿ç¨‹é—´ï¼Œè€Œä¸”ç³»ç»Ÿåº•å±‚å®ç°æ˜¯ä¸åŒçš„ï¼Œåªä¸è¿‡Pythonå±è”½äº†è¿™äº›ä¸åŒä¹‹å¤„ï¼Œè®©ç”¨æˆ·ç®€å•ä½¿ç”¨å¤šè¿›ç¨‹ã€‚
</p>

<p>
multiprocessingè¿˜æä¾›å…±äº«å†…å­˜ã€æœåŠ¡å™¨è¿›ç¨‹æ¥å…±äº«æ•°æ®ï¼Œè¿˜æä¾›äº†ç”¨äºè¿›ç¨‹é—´é€šè®¯çš„Queueé˜Ÿåˆ—ã€Pipeç®¡é“ã€‚
</p>

<p>
é€šä¿¡æ–¹å¼ä¸åŒ
</p>
<ul class="org-ul">
<li>å¤šè¿›ç¨‹å°±æ˜¯å¯åŠ¨å¤šä¸ªè§£é‡Šå™¨è¿›ç¨‹ï¼Œè¿›ç¨‹é—´é€šä¿¡å¿…é¡»åºåˆ—åŒ–ã€ååºåˆ—åŒ–</li>
<li><p>
æ•°æ®çš„çº¿ç¨‹å®‰å…¨æ€§é—®é¢˜
</p>

<p>
å¦‚æœæ¯ä¸ªè¿›ç¨‹ä¸­æ²¡æœ‰å®ç°å¤šçº¿ç¨‹ï¼ŒGILå¯ä»¥è¯´æ²¡ä»€ä¹ˆç”¨äº†
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:f49a5ff1-4b19-4fd7-b083-96f58234d4d0" class="outline-4">
<h4 id="h:f49a5ff1-4b19-4fd7-b083-96f58234d4d0">è¿›ç¨‹æ± ä¸¾ä¾‹</h4>
<div class="outline-text-4" id="text-h:f49a5ff1-4b19-4fd7-b083-96f58234d4d0">
<p>
multiprocessing.Pool æ˜¯è¿›ç¨‹æ± ç±»
</p>

<pre class="example" id="org9fba4b6">
apply(self, func, args=(), kwds={})      é˜»å¡æ‰§è¡Œï¼Œå¯¼è‡´ä¸»è¿›ç¨‹æ‰§è¡Œå…¶ä»–å­è¿›ç¨‹å°±åƒä¸€ä¸ªä¸ªæ‰§è¡Œ
apply_async(self, func, args=(), kwds={}, callback=None, error_callback=None) ä¸applyæ–¹æ³•ç”¨æ³•ä¸€è‡´ï¼Œéé˜»å¡å¼‚æ­¥æ‰§è¡Œï¼Œå¾—åˆ°ç»“æœåä¼šæ‰§è¡Œå›è°ƒ
close()      å…³é—­æ± ï¼Œæ± ä¸èƒ½å†æ¥å—æ–°çš„ä»»åŠ¡ï¼Œæ‰€æœ‰ä»»åŠ¡å®Œæˆåé€€å‡ºè¿›ç¨‹
terminate()  ç«‹å³ç»“æŸå·¥ä½œè¿›ç¨‹ï¼Œä¸å†å¤„ç†æœªå¤„ç†çš„ä»»åŠ¡
join()       ä¸»è¿›ç¨‹é˜»å¡ç­‰å¾…å­è¿›ç¨‹çš„é€€å‡ºï¼Œ joinæ–¹æ³•è¦åœ¨closeæˆ–terminateä¹‹åä½¿ç”¨
</pre>

<p>
åŒæ­¥è°ƒç”¨
</p>
<ul class="org-ul">
<li>pool.apply åŒæ­¥é˜»å¡çš„æ–¹æ³•ï¼Œå¤šè¿›ç¨‹ä¸²è¡Œ</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> multiprocessing
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> logging


<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s %(processName)s %(threadName)s %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">calc</span>():
    <span style="color: #483d8b;">sum</span> = 0
    <span style="color: #a020f0;">for</span> _ <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(100000000): <span style="color: #b22222;">#</span><span style="color: #b22222;">1&#20159;</span>
        <span style="color: #483d8b;">sum</span> += 1
    logging.info(<span style="color: #483d8b;">sum</span>)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36827;&#31243;&#26377;&#27809;&#26377;&#36820;&#22238;&#20540;&#65311;</span>
    <span style="color: #a020f0;">return</span> multiprocessing.current_process().name, <span style="color: #483d8b;">sum</span>

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    <span style="color: #a0522d;">start</span> = datetime.datetime.now()
    <span style="color: #a0522d;">pool</span> = multiprocessing.Pool(4)

    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(4):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#20540;&#65292;&#21516;&#27493;&#35843;&#29992;&#65292;&#27880;&#24847;&#35266;&#23519;CPU&#20351;&#29992;</span>
        <span style="color: #a0522d;">ret</span> = pool.<span style="color: #483d8b;">apply</span>(calc, ) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21516;&#27493;&#26041;&#27861;&#65292;&#38459;&#22622;&#30340;</span>
        logging.info(<span style="color: #8b2252;">'{1} --- {0}'</span>.<span style="color: #483d8b;">format</span>(ret, <span style="color: #483d8b;">type</span>(ret)))
    pool.close() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#20877;&#25509;&#25910;&#26032;&#30340;&#36827;&#31243;</span>
    pool.join()

    <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#22810;&#36827;&#31243;&#27744; &#21516;&#27493; &#32791;&#26102;={}s'</span>.<span style="color: #483d8b;">format</span>(delta))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:35:09,261 SpawnPoolWorker-1 MainThread 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:35:09,262 MainProcess MainThread &lt;class 'tuple'&gt; --- ('SpawnPoolWorker-1', 100000000)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:35:14,554 SpawnPoolWorker-2 MainThread 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:35:14,554 MainProcess MainThread &lt;class 'tuple'&gt; --- ('SpawnPoolWorker-2', 100000000)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:35:19,411 SpawnPoolWorker-3 MainThread 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:35:19,412 MainProcess MainThread &lt;class 'tuple'&gt; --- ('SpawnPoolWorker-3', 100000000)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:35:24,256 SpawnPoolWorker-4 MainThread 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:35:24,256 MainProcess MainThread &lt;class 'tuple'&gt; --- ('SpawnPoolWorker-4', 100000000)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22810;&#36827;&#31243;&#27744; &#21516;&#27493; &#32791;&#26102;=20.704703s</span>
</pre>
</div>

<p>
å¼‚æ­¥è°ƒç”¨
</p>
<ul class="org-ul">
<li>pool.aaply_async å¼‚æ­¥éé˜»å¡ï¼ŒçœŸå¹¶è¡Œ</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> multiprocessing
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> logging


<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s %(processName)s %(threadName)s %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">calc</span>():
    <span style="color: #483d8b;">sum</span> = 0
    <span style="color: #a020f0;">for</span> _ <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(100000000): <span style="color: #b22222;">#</span><span style="color: #b22222;">1&#20159;</span>
        <span style="color: #483d8b;">sum</span> += 1
    logging.info(<span style="color: #483d8b;">sum</span>)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36827;&#31243;&#26377;&#27809;&#26377;&#36820;&#22238;&#20540;&#65311;</span>
    <span style="color: #a020f0;">return</span> multiprocessing.current_process().name, <span style="color: #483d8b;">sum</span>

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    <span style="color: #a0522d;">start</span> = datetime.datetime.now()
    <span style="color: #a0522d;">pool</span> = multiprocessing.Pool(4)

    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(4):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">ret = pool.apply(calc, ) #&#21516;&#27493;&#26041;&#27861;&#65292;&#38459;&#22622;&#30340;</span>
        <span style="color: #a0522d;">ret</span> = pool.apply_async(calc)  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24322;&#27493;&#26041;&#27861;&#65292;&#27809;&#26377;&#38459;&#22622;</span>
        logging.info(<span style="color: #8b2252;">'{1} --- {0}'</span>.<span style="color: #483d8b;">format</span>(ret, <span style="color: #483d8b;">type</span>(ret)))
    pool.close() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#20877;&#25509;&#25910;&#26032;&#30340;&#36827;&#31243;</span>
    pool.join()

    <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#22810;&#36827;&#31243;&#27744; &#24322;&#27493; &#32791;&#26102;={}s'</span>.<span style="color: #483d8b;">format</span>(delta))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:37:45,966 MainProcess MainThread &lt;class 'multiprocessing.pool.ApplyResult'&gt; --- &lt;multiprocessing.pool.ApplyResult object at 0x000001F2E3C73770&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:37:45,966 MainProcess MainThread &lt;class 'multiprocessing.pool.ApplyResult'&gt; --- &lt;multiprocessing.pool.ApplyResult object at 0x000001F2E3D856D0&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:37:45,966 MainProcess MainThread &lt;class 'multiprocessing.pool.ApplyResult'&gt; --- &lt;multiprocessing.pool.ApplyResult object at 0x000001F2E3D85810&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:37:45,966 MainProcess MainThread &lt;class 'multiprocessing.pool.ApplyResult'&gt; --- &lt;multiprocessing.pool.ApplyResult object at 0x000001F2E3D949D0&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:37:53,632 SpawnPoolWorker-1 MainThread 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:37:53,739 SpawnPoolWorker-3 MainThread 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:37:53,768 SpawnPoolWorker-4 MainThread 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:37:54,047 SpawnPoolWorker-2 MainThread 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22810;&#36827;&#31243;&#27744; &#24322;&#27493; &#32791;&#26102;=8.231741s</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> multiprocessing
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> logging


<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s %(processName)s %(threadName)s %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">calc</span>():
    <span style="color: #483d8b;">sum</span> = 0
    <span style="color: #a020f0;">for</span> _ <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(100000000): <span style="color: #b22222;">#</span><span style="color: #b22222;">1&#20159;</span>
        <span style="color: #483d8b;">sum</span> += 1
    logging.info(<span style="color: #483d8b;">sum</span>)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36827;&#31243;&#26377;&#27809;&#26377;&#36820;&#22238;&#20540;&#65311;</span>
    <span style="color: #a020f0;">return</span> multiprocessing.current_process().name, <span style="color: #483d8b;">sum</span>

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    <span style="color: #a0522d;">start</span> = datetime.datetime.now()
    <span style="color: #a0522d;">pool</span> = multiprocessing.Pool(4)

    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(4):
        <span style="color: #b22222;"># </span><span style="color: #b22222;">ret = pool.apply(calc, ) #&#21516;&#27493;&#26041;&#27861;&#65292;&#38459;&#22622;&#30340;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24322;&#27493;&#25343;&#21040;&#30340;&#36820;&#22238;&#20540;&#26159;&#20160;&#20040;&#65292;&#22238;&#35843;&#36215;&#20102;&#20160;&#20040;&#20316;&#29992;</span>
        <span style="color: #a0522d;">ret</span> = pool.apply_async(
            calc, callback=<span style="color: #a020f0;">lambda</span> value: logging.info(<span style="color: #8b2252;">'**{}**'</span>.<span style="color: #483d8b;">format</span>(value))) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24322;&#27493;&#26041;&#27861;&#65292;&#27809;&#26377;&#38459;&#22622;</span>
        logging.info(<span style="color: #8b2252;">'{1} --- {0}'</span>.<span style="color: #483d8b;">format</span>(ret, <span style="color: #483d8b;">type</span>(ret)))
    pool.close() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19981;&#20877;&#25509;&#25910;&#26032;&#30340;&#36827;&#31243;</span>
    pool.join()

    <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#22810;&#36827;&#31243;&#27744; &#24322;&#27493; &#32791;&#26102;={}s'</span>.<span style="color: #483d8b;">format</span>(delta))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:46:50,627 MainProcess MainThread &lt;class 'multiprocessing.pool.ApplyResult'&gt; --- &lt;multiprocessing.pool.ApplyResult object at 0x0000020A9F203770&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:46:50,627 MainProcess MainThread &lt;class 'multiprocessing.pool.ApplyResult'&gt; --- &lt;multiprocessing.pool.ApplyResult object at 0x0000020A9F2F56D0&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:46:50,627 MainProcess MainThread &lt;class 'multiprocessing.pool.ApplyResult'&gt; --- &lt;multiprocessing.pool.ApplyResult object at 0x0000020A9F2F5810&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:46:50,627 MainProcess MainThread &lt;class 'multiprocessing.pool.ApplyResult'&gt; --- &lt;multiprocessing.pool.ApplyResult object at 0x0000020A9F3048A0&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:47:01,368 SpawnPoolWorker-1 MainThread 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:47:01,369 MainProcess Thread-3 (_handle_results) **('SpawnPoolWorker-1', 100000000)**</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:47:02,295 SpawnPoolWorker-2 MainThread 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:47:02,296 MainProcess Thread-3 (_handle_results) **('SpawnPoolWorker-2', 100000000)**</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:47:02,412 SpawnPoolWorker-4 MainThread 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:47:02,413 MainProcess Thread-3 (_handle_results) **('SpawnPoolWorker-4', 100000000)**</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:47:02,915 SpawnPoolWorker-3 MainThread 100000000</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 00:47:02,918 MainProcess Thread-3 (_handle_results) **('SpawnPoolWorker-3', 100000000)**</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22810;&#36827;&#31243;&#27744; &#24322;&#27493; &#32791;&#26102;=12.441383s</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:990dc2ac-90d9-410c-8c60-d3c3205f0886" class="outline-4">
<h4 id="h:990dc2ac-90d9-410c-8c60-d3c3205f0886">å¤šè¿›ç¨‹ã€å¤šçº¿ç¨‹çš„é€‰æ‹©</h4>
<div class="outline-text-4" id="text-h:990dc2ac-90d9-410c-8c60-d3c3205f0886">
<p>
CPUå¯†é›†å‹
</p>
<ul class="org-ul">
<li>CPythonä¸­ä½¿ç”¨åˆ°äº†GILï¼Œå¤šçº¿ç¨‹çš„æ—¶å€™é”ç›¸äº’ç«äº‰ï¼Œä¸”å¤šæ ¸ä¼˜åŠ¿ä¸èƒ½å‘æŒ¥ï¼Œé€‰ç”¨Pythonå¤šè¿›ç¨‹æ•ˆç‡æ›´é«˜</li>
</ul>

<p>
IOå¯†é›†å‹
</p>
<ul class="org-ul">
<li>åœ¨Pythonä¸­é€‚åˆæ˜¯ç”¨å¤šçº¿ç¨‹ï¼Œå¯ä»¥å‡å°‘å¤šè¿›ç¨‹é—´IOçš„åºåˆ—åŒ–å¼€é”€ã€‚ä¸”åœ¨IOç­‰å¾…çš„æ—¶å€™ï¼Œåˆ‡æ¢åˆ°å…¶ä»–çº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œæ•ˆç‡ä¸é”™ã€‚</li>
</ul>
</div>
<div id="outline-container-h:4a230ff1-36bf-42ee-ac3d-1d76e3633b19" class="outline-5">
<h5 id="h:4a230ff1-36bf-42ee-ac3d-1d76e3633b19">åº”ç”¨</h5>
<div class="outline-text-5" id="text-h:4a230ff1-36bf-42ee-ac3d-1d76e3633b19">
<p>
è¯·æ±‚/åº”ç­”æ¨¡å‹ï¼šWEBåº”ç”¨ä¸­å¸¸è§çš„å¤„ç†æ¨¡å‹
</p>

<p>
masterå¯åŠ¨å¤šä¸ªworkerå·¥ä½œè¿›ç¨‹ï¼Œä¸€èˆ¬å’ŒCPUæ•°ç›®ç›¸åŒã€‚å‘æŒ¥å¤šæ ¸ä¼˜åŠ¿ã€‚
</p>

<p>
workerå·¥ä½œè¿›ç¨‹ä¸­ï¼Œå¾€å¾€éœ€è¦æ“ä½œç½‘ç»œIOå’Œç£ç›˜IOï¼Œå¯åŠ¨å¤šçº¿ç¨‹ï¼Œæé«˜å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚workerå¤„ç†ç”¨æˆ·çš„è¯·æ±‚ï¼Œå¾€å¾€éœ€è¦ç­‰å¾…æ•°æ®ï¼Œå¤„ç†å®Œè¯·æ±‚è¿˜è¦é€šè¿‡ç½‘ç»œIOè¿”å›å“åº”ã€‚
</p>

<p>
è¿™å°±æ˜¯nginxå·¥ä½œæ¨¡å¼
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-h:b21f750f-34a4-409d-8b78-c2ef1591ba41" class="outline-3">
<h3 id="h:b21f750f-34a4-409d-8b78-c2ef1591ba41">Linuxçš„ç‰¹æ®Šè¿›ç¨‹</h3>
<div class="outline-text-3" id="text-h:b21f750f-34a4-409d-8b78-c2ef1591ba41">
<p>
åœ¨Linux/Unixä¸­ï¼Œé€šè¿‡çˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹
</p>
</div>
<div id="outline-container-h:5be0308a-8e9a-4292-87bc-37dd75458fe6" class="outline-4">
<h4 id="h:5be0308a-8e9a-4292-87bc-37dd75458fe6">åƒµå°¸è¿›ç¨‹</h4>
<div class="outline-text-4" id="text-h:5be0308a-8e9a-4292-87bc-37dd75458fe6">
<p>
ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨äº†forkåˆ›å»ºäº†å­è¿›ç¨‹ï¼Œå¦‚æœå­è¿›ç¨‹ç»ˆæ­¢è¿›å…¥åƒµæ­»çŠ¶æ€ï¼Œè€Œçˆ¶è¿›ç¨‹å¹¶
æ²¡æœ‰è°ƒç”¨waitæˆ–è€…waitpidè·å–å­è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œé‚£ä¹ˆå­è¿›ç¨‹ä»ç•™ä¸‹ä¸€ä¸ªæ•°æ®
ç»“æ„ä¿å­˜åœ¨ç³»ç»Ÿä¸­ï¼Œè¿™ç§è¿›ç¨‹ç§°ä¸ºåƒµå°¸è¿›ç¨‹ã€‚
</p>

<p>
åƒµå°¸è¿›ç¨‹ä¼šå ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼Œè¿˜å ç”¨äº†è¿›ç¨‹å·ï¼Œæ‰€ä»¥ä¸€å®šè¦é¿å…å¤§é‡çš„åƒµå°¸è¿›ç¨‹äº§ç”Ÿã€‚æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥é¿å…åƒµå°¸è¿›ç¨‹ã€‚
</p>
</div>
</div>
<div id="outline-container-h:405524b1-b8da-4cc0-acae-757594a86989" class="outline-4">
<h4 id="h:405524b1-b8da-4cc0-acae-757594a86989">å­¤å„¿è¿›ç¨‹</h4>
<div class="outline-text-4" id="text-h:405524b1-b8da-4cc0-acae-757594a86989">
<p>
çˆ¶è¿›ç¨‹é€€å‡ºï¼Œè€Œå®ƒçš„å­è¿›ç¨‹ä»åœ¨è¿è¡Œï¼Œé‚£ä¹ˆè¿™äº›å­è¿›ç¨‹å°±ä¼šæˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚å­¤å„¿è¿›ç¨‹ä¼šè¢«initè¿›ç¨‹ï¼ˆè¿›ç¨‹å·ä¸º1ï¼‰æ”¶å…»ï¼Œå¹¶ç”±initè¿›ç¨‹å¯¹å®ƒä»¬å®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œã€‚
</p>

<p>
initè¿›ç¨‹ä¼šå¾ªç¯è°ƒç”¨waitè¿™äº›å­¤å„¿è¿›ç¨‹ï¼Œæ‰€ä»¥ï¼Œå­¤å„¿è¿›ç¨‹æ²¡æœ‰ä»€ä¹ˆå±å®³ã€‚
</p>
</div>
</div>
<div id="outline-container-h:ee05aa27-3ee5-4519-8e42-1ddfc669cf1a" class="outline-4">
<h4 id="h:ee05aa27-3ee5-4519-8e42-1ddfc669cf1a">å®ˆæŠ¤è¿›ç¨‹</h4>
<div class="outline-text-4" id="text-h:ee05aa27-3ee5-4519-8e42-1ddfc669cf1a">
<p>
å®ƒæ˜¯è¿è¡Œåœ¨åå°çš„ä¸€ç§ç‰¹æ®Šè¿›ç¨‹ã€‚å®ƒç‹¬ç«‹äºæ§åˆ¶ç»ˆç«¯å¹¶å‘¨æœŸæ€§æ‰§è¡ŒæŸç§ä»»åŠ¡æˆ–ç­‰å¾…å¤„ç†æŸäº›äº‹ä»¶ã€‚
</p>

<p>
å®ˆæŠ¤è¿›ç¨‹çš„çˆ¶è¿›ç¨‹æ˜¯initè¿›ç¨‹ï¼Œå› ä¸ºå…¶çˆ¶è¿›ç¨‹å·²ç»æ•…æ„è¢«ç»ˆæ­¢æ‰äº†ã€‚
</p>

<p>
å®ˆæŠ¤è¿›ç¨‹ç›¸å¯¹äºæ™®é€šçš„å­¤å„¿è¿›ç¨‹éœ€è¦åšä¸€äº›ç‰¹æ®Šå¤„ç†ã€‚
</p>
</div>
</div>
</div>
</section>
<section id="outline-container-h:a205ae9f-e7aa-4e6e-be24-23a387b35140" class="outline-2">
<h2 id="h:a205ae9f-e7aa-4e6e-be24-23a387b35140">concurrentåŒ…ï¼ˆå¼‚æ­¥å¹¶è¡Œä»»åŠ¡ç¼–ç¨‹æ¨¡å—ï¼‰</h2>
<div class="outline-text-2" id="text-h:a205ae9f-e7aa-4e6e-be24-23a387b35140">
</div>
<div id="outline-container-h:66c691a6-1da9-47c6-8e13-3712e734b9c2" class="outline-3">
<h3 id="h:66c691a6-1da9-47c6-8e13-3712e734b9c2">concurrent.futuresåŒ…</h3>
<div class="outline-text-3" id="text-h:66c691a6-1da9-47c6-8e13-3712e734b9c2">
<p>
3.2ç‰ˆæœ¬å¼•å…¥çš„æ¨¡å—
</p>

<p>
å¼‚æ­¥å¹¶è¡Œä»»åŠ¡ç¼–ç¨‹æ¨¡å—ï¼Œæä¾›ä¸€ä¸ªé«˜çº§çš„å¼‚æ­¥å¯æ‰§è¡Œçš„ä¾¿åˆ©æ¥å£ã€‚
</p>

<p>
æä¾›äº†2ä¸ªæ± æ‰§è¡Œå™¨
</p>
<ul class="org-ul">
<li>ThreadPoolExecutor å¼‚æ­¥è°ƒç”¨çš„çº¿ç¨‹æ± çš„Executor</li>
<li>ProcessPoolExecutor å¼‚æ­¥è°ƒç”¨çš„è¿›ç¨‹æ± çš„Executor</li>
</ul>
</div>
<div id="outline-container-h:5c637564-d745-498f-87ab-74079d5cb582" class="outline-4">
<h4 id="h:5c637564-d745-498f-87ab-74079d5cb582">ThreadPoolExecutorå¯¹è±¡</h4>
<div class="outline-text-4" id="text-h:5c637564-d745-498f-87ab-74079d5cb582">
<p>
é¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ªæ± çš„æ‰§è¡Œå™¨å¯¹è±¡ï¼ŒExecutorç±»å­ç±»å¯¹è±¡
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #0000ff;">ThreadPoolExecutor</span>(<span style="color: #a0522d;">max_workers</span>=1)   &#27744;&#20013;&#33267;&#22810;&#21019;&#24314;max_workers&#20010;&#32447;&#31243;&#30340;&#27744;&#26469;&#21516;&#26102;&#24322;&#27493;&#25191;&#34892;&#65292;&#36820;&#22238; Executor&#23454;&#20363;
<span style="color: #0000ff;">submit</span>(fn, *args, **kwargs)         &#25552;&#20132;&#25191;&#34892;&#30340;&#20989;&#25968;&#21450;&#20854;&#21442;&#25968;&#65292;&#36820;&#22238;Future&#31867;&#30340;&#23454;&#20363;
<span style="color: #0000ff;">shutdown</span>(<span style="color: #a0522d;">wait</span>=True                  &#28165;&#29702;&#27744;
</pre>
</div>

<p>
Futureç±»
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #a020f0;">done</span>()      &#22914;&#26524;&#35843;&#29992;&#34987;&#25104;&#21151;&#30340;&#21462;&#28040;&#25110;&#32773;&#25191;&#34892;&#23436;&#25104;&#65292;&#36820;&#22238;True, &#21542;&#21017;False. &#19981;&#38459;&#22622;&#12290;
<span style="color: #0000ff;">cancelled</span>() &#22914;&#26524;&#35843;&#29992;&#34987;&#25104;&#21151;&#30340;&#21462;&#28040;&#65292;&#36820;&#22238;True
<span style="color: #0000ff;">running</span>()   &#22914;&#26524;&#27491;&#22312;&#36816;&#34892;&#19988;&#19981;&#33021;&#34987;&#21462;&#28040;&#65292;&#36820;&#22238;True
<span style="color: #0000ff;">cancel</span>()
&#23581;&#35797;&#21462;&#28040;&#35843;&#29992;&#12290;&#22914;&#26524;&#24050;&#32463;&#25191;&#34892;&#19988;&#19981;&#33021;&#21462;&#28040;&#36820;&#22238;False&#65292;&#21542;&#21017;&#36820;&#22238;True&#12290;&#20063;&#23601;&#26159;PENDING&#29366;&#24577;&#30340;&#21487;&#20197;&#21462;&#28040;&#65292;&#23601;&#26159;&#25552;&#20132;&#20102;
&#30340;&#20219;&#21153;&#22788;&#20110;&#39044;&#22791;&#29366;&#24577;&#12290;

<span style="color: #0000ff;">result</span>(<span style="color: #a0522d;">timeout</span>=None) 
&#21462;&#36820;&#22238;&#30340;&#32467;&#26524;&#65292;timeout&#20026;None&#65292;&#19968;&#30452;&#31561;&#24453;&#36820;&#22238;&#65307;timeout&#35774;&#32622;&#21040;&#26399;&#65292;&#25243;&#20986;concurrent.futures.TimeoutError &#24322;&#24120;

<span style="color: #0000ff;">exception</span>(<span style="color: #a0522d;">timeout</span>=None) &#21462;&#36820;&#22238;&#30340;&#24322;&#24120;&#65292;timeout&#20026;None&#65292;&#19968;&#30452;&#31561;&#24453;&#36820;&#22238;&#65307;timeout&#35774;&#32622;&#21040;&#26399;&#65292;&#25243;&#20986;concurrent.futures.TimeoutError &#24322;&#24120;
</pre>
</div>

<p>
ThreadPoolExecutorä¾‹å­
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> concurrent.futures <span style="color: #a020f0;">import</span> ThreadPoolExecutor
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging


<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s [%(processName)s %(process)d] [%(threadName)s %(thread)d]** %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22522;&#26412;&#20351;&#29992;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    logging.info(<span style="color: #8b2252;">'start~~~~'</span>)
    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27491;&#24120;&#25191;&#34892;&#30340;&#20195;&#30721;</span>
    time.sleep(5)
    logging.info(<span style="color: #8b2252;">'finished'</span>)

<span style="color: #a0522d;">executor</span> = ThreadPoolExecutor(1)
<span style="color: #a0522d;">future</span> = executor.submit(worker) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20219;&#21153;&#25552;&#20132;&#21518;&#31435;&#21363;&#21551;&#21160;</span>
<span style="color: #a020f0;">while</span> <span style="color: #a020f0;">not</span> future.done(): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20219;&#21153;&#20570;&#23436;&#20102;&#21527;</span>
    logging.info(<span style="color: #8b2252;">'Not done. {}'</span>.<span style="color: #483d8b;">format</span>(future)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;future&#29366;&#24577;</span>
    time.sleep(1)

executor.shutdown()
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 11:32:59,859 [MainProcess 26644] [ThreadPoolExecutor-0_0 5764]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 11:32:59,859 [MainProcess 26644] [MainThread 26988]** Not done. &lt;Future at 0x1fe24476f90 state=running&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 11:33:00,860 [MainProcess 26644] [MainThread 26988]** Not done. &lt;Future at 0x1fe24476f90 state=running&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 11:33:01,861 [MainProcess 26644] [MainThread 26988]** Not done. &lt;Future at 0x1fe24476f90 state=running&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 11:33:02,861 [MainProcess 26644] [MainThread 26988]** Not done. &lt;Future at 0x1fe24476f90 state=running&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 11:33:03,862 [MainProcess 26644] [MainThread 26988]** Not done. &lt;Future at 0x1fe24476f90 state=running&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 11:33:04,859 [MainProcess 26644] [ThreadPoolExecutor-0_0 5764]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">==============================</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> concurrent.futures <span style="color: #a020f0;">import</span> ThreadPoolExecutor
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging


<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s [%(processName)s %(process)d] [%(threadName)s %(thread)d]** %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22522;&#26412;&#20351;&#29992;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">Future&#23454;&#20363;&#30340;&#29366;&#24577;state: pending&#20934;&#22791;&#34987;&#25191;&#34892;; running&#27491;&#22312;&#34987;&#25191;&#34892;&#65307;finished&#25191;&#34892;&#23436;&#25104;&#65307;canncelled &#25104;&#21151;&#21462;&#28040;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">done() &#25104;&#21151;&#25191;&#34892;&#20102;&#25110;&#25104;&#21151;&#21462;&#28040;&#20102;finished, canncelled</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29366;&#24577;running&#65292;&#19981;&#20801;&#35768;cancel</span>


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    logging.info(<span style="color: #8b2252;">'start~~~~'</span>)
    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27491;&#24120;&#25191;&#34892;&#30340;&#20195;&#30721;</span>
    time.sleep(5)
    logging.info(<span style="color: #8b2252;">'finished'</span>)

<span style="color: #a0522d;">executor</span> = ThreadPoolExecutor(1)
<span style="color: #a0522d;">future</span> = executor.submit(worker) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20219;&#21153;&#25552;&#20132;&#21518;&#31435;&#21363;&#21551;&#21160;</span>
<span style="color: #a0522d;">f1</span> = executor.submit(worker)
<span style="color: #a020f0;">while</span> <span style="color: #a020f0;">not</span> future.done(): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20219;&#21153;&#20570;&#23436;&#20102;&#21527;</span>
    logging.info(<span style="color: #8b2252;">'Not done. {} | {}'</span>.<span style="color: #483d8b;">format</span>(future, f1)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;future&#29366;&#24577;</span>
    time.sleep(1)
    f1.cancel() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21462;&#28040;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">future.cancel()#&#19968;&#26086;running&#65292;&#19981;&#20801;&#35768;cancel</span>

<span style="color: #a020f0;">while</span> <span style="color: #a020f0;">not</span> f1.done(): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20219;&#21153;&#20570;&#23436;&#20102;&#21527;</span>
    logging.info(<span style="color: #8b2252;">'Not done. {} | {}'</span>.<span style="color: #483d8b;">format</span>(future, f1)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;future&#29366;&#24577;</span>
    time.sleep(1)

<span style="color: #483d8b;">print</span>(future.done(), f1.done())

executor.shutdown()
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 14:21:56,842 [MainProcess 27540] [ThreadPoolExecutor-0_0 20428]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 14:21:56,842 [MainProcess 27540] [MainThread 24160]** Not done. &lt;Future at 0x298c818af90 state=running&gt; | &lt;Future at 0x298c811f250 state=pending&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 14:21:57,842 [MainProcess 27540] [MainThread 24160]** Not done. &lt;Future at 0x298c818af90 state=running&gt; | &lt;Future at 0x298c811f250 state=cancelled&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 14:21:58,843 [MainProcess 27540] [MainThread 24160]** Not done. &lt;Future at 0x298c818af90 state=running&gt; | &lt;Future at 0x298c811f250 state=cancelled&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 14:21:59,844 [MainProcess 27540] [MainThread 24160]** Not done. &lt;Future at 0x298c818af90 state=running&gt; | &lt;Future at 0x298c811f250 state=cancelled&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 14:22:00,845 [MainProcess 27540] [MainThread 24160]** Not done. &lt;Future at 0x298c818af90 state=running&gt; | &lt;Future at 0x298c811f250 state=cancelled&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 14:22:01,842 [MainProcess 27540] [ThreadPoolExecutor-0_0 20428]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">True True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">==============================</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> concurrent.futures <span style="color: #a020f0;">import</span> ThreadPoolExecutor
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging


<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s [%(processName)s %(process)d] [%(threadName)s %(thread)d]** %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22522;&#26412;&#20351;&#29992;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">Future&#23454;&#20363;&#30340;&#29366;&#24577;state: pending&#20934;&#22791;&#34987;&#25191;&#34892;; running&#27491;&#22312;&#34987;&#25191;&#34892;&#65307;finished&#25191;&#34892;&#23436;&#25104;&#65307;canncelled &#25104;&#21151;&#21462;&#28040;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">done() &#25104;&#21151;&#25191;&#34892;&#20102;&#25110;&#25104;&#21151;&#21462;&#28040;&#20102;finished, canncelled&#65292;&#20219;&#21153;&#25191;&#34892;&#26102;&#26377;&#24322;&#24120;&#32456;&#27490;&#20102;&#20063;&#31639;finished</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29366;&#24577;running&#65292;&#19981;&#20801;&#35768;cancel</span>


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    logging.info(<span style="color: #8b2252;">'start~~~~'</span>)
    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27491;&#24120;&#25191;&#34892;&#30340;&#20195;&#30721;</span>
    time.sleep(2)
    logging.info(<span style="color: #8b2252;">'finished'</span>)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker1</span>():
    logging.info(<span style="color: #8b2252;">'start~~~~'</span>)
    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27491;&#24120;&#25191;&#34892;&#30340;&#20195;&#30721;</span>
    time.sleep(5)
    1/0
    logging.info(<span style="color: #8b2252;">'finished'</span>)
    <span style="color: #a020f0;">return</span> 1234

<span style="color: #a0522d;">executor</span> = ThreadPoolExecutor(1)
<span style="color: #a0522d;">future</span> = executor.submit(worker) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20219;&#21153;&#25552;&#20132;&#21518;&#31435;&#21363;&#21551;&#21160;</span>
<span style="color: #a0522d;">f1</span> = executor.submit(worker1)

<span style="color: #a020f0;">while</span> <span style="color: #a020f0;">not</span> future.done(): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20219;&#21153;&#20570;&#23436;&#20102;&#21527;</span>
    logging.info(<span style="color: #8b2252;">'Not done. {} | {}'</span>.<span style="color: #483d8b;">format</span>(future, f1)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;future&#29366;&#24577;</span>
    time.sleep(1)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">logging.info(f1.result(2)) #&#40664;&#35748;&#19968;&#30452;&#38459;&#22622;&#21040;done. &#21462;&#36820;&#22238;&#30340;&#32467;&#26524;,&#31561;&#24453;2&#31186;&#65292;&#36229;&#26102;&#20102;&#25243;&#24322;&#24120;TimeoutError</span>
    <span style="color: #b22222;">#</span><span style="color: #b22222;">result() &#22914;&#26524;&#20219;&#21153;&#20989;&#25968;&#25191;&#34892;&#26102;&#32447;&#31243;&#20869;&#37096;&#26377;&#24322;&#24120;&#65292;&#27809;&#31649;&#12290;&#25343;&#32467;&#26524;&#23601;&#20250;&#25243;&#24322;&#24120;</span>
    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#20351;&#29992;try&#25429;&#33719;&#65307;&#20808;&#21028;&#26029;</span>

    <span style="color: #a0522d;">e</span> = f1.exception()
    logging.info(<span style="color: #8b2252;">"{} {}"</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">type</span>(e), e)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#40664;&#35748;&#19968;&#30452;&#38459;&#22622;&#21040;done. &#21462;&#36820;&#22238;&#30340;&#24322;&#24120;,&#31561;&#24453;x&#31186;&#65292;&#36229;&#26102;&#20102;&#25243;&#24322;&#24120;TimeoutError</span>
    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#20219;&#21153;&#20869;&#37096;&#26377;&#24322;&#24120;&#65292;exception()&#21487;&#20197;&#27491;&#24120;&#21462;&#36208;&#35813;&#24322;&#24120;&#65292;&#25343;&#21040;&#30340;&#26159;&#24322;&#24120;&#23454;&#20363;&#12290;</span>
    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#20219;&#21153;&#27491;&#24120;&#25191;&#34892;&#32467;&#26463;&#65292;&#24322;&#24120;&#23545;&#35937;&#25343;&#19981;&#21040;&#33719;&#21462;&#21040;&#19968;&#20010;None</span>

<span style="color: #a020f0;">while</span> <span style="color: #a020f0;">not</span> f1.done(): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20219;&#21153;&#20570;&#23436;&#20102;&#21527;</span>
    logging.info(<span style="color: #8b2252;">'Not done. {} | {}'</span>.<span style="color: #483d8b;">format</span>(future, f1)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;future&#29366;&#24577;</span>
    time.sleep(1)

<span style="color: #483d8b;">print</span>(future.done(), f1.done())

executor.shutdown()
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 15:34:59,118 [MainProcess 6060] [ThreadPoolExecutor-0_0 32376]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 15:34:59,118 [MainProcess 6060] [MainThread 23788]** Not done. &lt;Future at 0x1e3f7feef90 state=running&gt; | &lt;Future at 0x1e3f7f7f250 state=pending&gt;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 15:35:01,118 [MainProcess 6060] [ThreadPoolExecutor-0_0 32376]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 15:35:01,119 [MainProcess 6060] [ThreadPoolExecutor-0_0 32376]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 15:35:06,120 [MainProcess 6060] [MainThread 23788]** &lt;class 'ZeroDivisionError'&gt; division by zero</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">True True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">==============================</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">all</span>([]))        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#20010;False&#37117;&#27809;&#26377;&#65292;True</span>
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">all</span>([0, 0, 0])) <span style="color: #b22222;">#</span><span style="color: #b22222;">False</span>
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">all</span>([1]))       <span style="color: #b22222;">#</span><span style="color: #b22222;">True</span>
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">all</span>([1, 1, 1, 0])) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#35201;&#26377;&#19968;&#20010;False&#65292;&#23601;&#26159;False</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">any</span>([]))        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#20010;&#37117;&#27809;&#26377;, False</span>
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">any</span>([0, 0, 0, 1])) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#35201;&#26377;&#19968;&#20010;True&#65292;True</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> concurrent.futures <span style="color: #a020f0;">import</span> ThreadPoolExecutor
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">import</span> threading


<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s [%(processName)s %(process)d] [%(threadName)s %(thread)d]** %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22522;&#26412;&#20351;&#29992;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">Future&#23454;&#20363;&#30340;&#29366;&#24577;state: pending&#20934;&#22791;&#34987;&#25191;&#34892;; running&#27491;&#22312;&#34987;&#25191;&#34892;&#65307;finished&#25191;&#34892;&#23436;&#25104;&#65307;canncelled &#25104;&#21151;&#21462;&#28040;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">done() &#25104;&#21151;&#25191;&#34892;&#20102;&#25110;&#25104;&#21151;&#21462;&#28040;&#20102;finished, canncelled&#65292;&#20219;&#21153;&#25191;&#34892;&#26102;&#26377;&#24322;&#24120;&#32456;&#27490;&#20102;&#20063;&#31639;finished</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#29366;&#24577;running&#65292;&#19981;&#20801;&#35768;cancel</span>


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(n):
    logging.info(<span style="color: #8b2252;">'start~~~~'</span>)
    time.sleep(5)
    logging.info(<span style="color: #8b2252;">'finished'</span>)
    <span style="color: #a020f0;">return</span> n, n, n

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#32447;&#31243;&#27744;&#65292;&#27744;&#23481;&#37327;&#20026;3</span>
<span style="color: #a0522d;">executor</span> = ThreadPoolExecutor(3)
time.sleep(1)
<span style="color: #483d8b;">print</span>(threading.<span style="color: #483d8b;">enumerate</span>())

<span style="color: #a0522d;">fs</span> = []
<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(6):
    <span style="color: #a0522d;">f</span> = executor.submit(worker, i) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20219;&#21153;&#25552;&#20132;&#21518;&#31435;&#21363;&#21551;&#21160;</span>
    fs.append(f)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'*'</span> * 30)

<span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
    time.sleep(2)

    <span style="color: #a0522d;">states</span> = [f.done() <span style="color: #a020f0;">for</span> f <span style="color: #a020f0;">in</span> fs]
    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">all</span>(states):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'all done'</span>)
        <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> fs:
            <span style="color: #483d8b;">print</span>(i.done(), i.result())
        <span style="color: #a020f0;">break</span>
    <span style="color: #483d8b;">print</span>(states)
    <span style="color: #483d8b;">print</span>(threading.<span style="color: #483d8b;">enumerate</span>())

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">[&lt;_MainThread(MainThread, started 10956)&gt;]</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:10:01,236 [MainProcess 16524] [ThreadPoolExecutor-0_0 10592]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:10:01,237 [MainProcess 16524] [ThreadPoolExecutor-0_1 32156]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:10:01,237 [MainProcess 16524] [ThreadPoolExecutor-0_2 31680]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">******************************</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">[False, False, False, False, False, False]</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">[&lt;_MainThread(MainThread, started 10956)&gt;, &lt;Thread(ThreadPoolExecutor-0_0, started 10592)&gt;, &lt;Thread(ThreadPoolExecutor-0_1, started 32156)&gt;, &lt;Thread(ThreadPoolExecutor-0_2, started 31680)&gt;]</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">[False, False, False, False, False, False]</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">[&lt;_MainThread(MainThread, started 10956)&gt;, &lt;Thread(ThreadPoolExecutor-0_0, started 10592)&gt;, &lt;Thread(ThreadPoolExecutor-0_1, started 32156)&gt;, &lt;Thread(ThreadPoolExecutor-0_2, started 31680)&gt;]</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:10:06,237 [MainProcess 16524] [ThreadPoolExecutor-0_0 10592]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:10:06,238 [MainProcess 16524] [ThreadPoolExecutor-0_0 10592]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:10:06,239 [MainProcess 16524] [ThreadPoolExecutor-0_1 32156]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:10:06,240 [MainProcess 16524] [ThreadPoolExecutor-0_1 32156]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:10:06,239 [MainProcess 16524] [ThreadPoolExecutor-0_2 31680]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:10:06,240 [MainProcess 16524] [ThreadPoolExecutor-0_2 31680]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">[True, True, True, False, False, False]</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">[&lt;_MainThread(MainThread, started 10956)&gt;, &lt;Thread(ThreadPoolExecutor-0_0, started 10592)&gt;, &lt;Thread(ThreadPoolExecutor-0_1, started 32156)&gt;, &lt;Thread(ThreadPoolExecutor-0_2, started 31680)&gt;]</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">[True, True, True, False, False, False]</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">[&lt;_MainThread(MainThread, started 10956)&gt;, &lt;Thread(ThreadPoolExecutor-0_0, started 10592)&gt;, &lt;Thread(ThreadPoolExecutor-0_1, started 32156)&gt;, &lt;Thread(ThreadPoolExecutor-0_2, started 31680)&gt;]</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:10:11,239 [MainProcess 16524] [ThreadPoolExecutor-0_0 10592]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:10:11,240 [MainProcess 16524] [ThreadPoolExecutor-0_1 32156]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:10:11,241 [MainProcess 16524] [ThreadPoolExecutor-0_2 31680]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">all done</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">True (0, 0, 0)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">True (1, 1, 1)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">True (2, 2, 2)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">True (3, 3, 3)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">True (4, 4, 4)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">True (5, 5, 5)</span>
</pre>
</div>

<p>
wait() æ–¹æ³•
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> concurrent.futures <span style="color: #a020f0;">import</span> ThreadPoolExecutor, wait, Future
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">import</span> threading


<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s [%(processName)s %(process)d] [%(threadName)s %(thread)d]** %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(n):
    logging.info(<span style="color: #8b2252;">'start~~~~'</span>)
    time.sleep(3 + i )
    logging.info(<span style="color: #8b2252;">'finished'</span>)
    <span style="color: #a020f0;">if</span> n == 4:
        1/0
    <span style="color: #a020f0;">return</span> n, n, n

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#32447;&#31243;&#27744;&#65292;&#27744;&#23481;&#37327;&#20026;3</span>
<span style="color: #a0522d;">executor</span> = ThreadPoolExecutor(3)
time.sleep(1)
<span style="color: #483d8b;">print</span>(threading.<span style="color: #483d8b;">enumerate</span>())

<span style="color: #a0522d;">fs</span> = []
<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(6):
    <span style="color: #a0522d;">f</span> = executor.submit(worker, i) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20219;&#21153;&#25552;&#20132;&#21518;&#31435;&#21363;&#21551;&#21160;</span>
    fs.append(f)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'*'</span> * 30)

<span style="color: #b22222;">#</span><span style="color: #b22222;">wait</span>
<span style="color: #a0522d;">ret</span> = wait(fs)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19968;&#25209;futures</span>
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(ret), ret)
<span style="color: #483d8b;">print</span>(ret.done)
<span style="color: #483d8b;">print</span>(ret.not_done)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)

<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> ret.done:
    <span style="color: #b22222;"># </span><span style="color: #b22222;">x:Future = x</span>
    <span style="color: #483d8b;">print</span>(x.done())
    <span style="color: #a020f0;">if</span> x.exception():
        <span style="color: #483d8b;">print</span>(x.exception())
    <span style="color: #a020f0;">else</span>:
        <span style="color: #483d8b;">print</span>(x.result())

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">[&lt;_MainThread(MainThread, started 29256)&gt;]</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:42:34,242 [MainProcess 6280] [ThreadPoolExecutor-0_0 11956]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:42:34,243 [MainProcess 6280] [ThreadPoolExecutor-0_1 13216]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:42:34,243 [MainProcess 6280] [ThreadPoolExecutor-0_2 31820]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">******************************</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:42:38,243 [MainProcess 6280] [ThreadPoolExecutor-0_0 11956]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:42:38,244 [MainProcess 6280] [ThreadPoolExecutor-0_0 11956]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:42:39,243 [MainProcess 6280] [ThreadPoolExecutor-0_1 13216]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:42:39,244 [MainProcess 6280] [ThreadPoolExecutor-0_1 13216]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:42:42,244 [MainProcess 6280] [ThreadPoolExecutor-0_2 31820]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:42:42,245 [MainProcess 6280] [ThreadPoolExecutor-0_2 31820]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:42:46,245 [MainProcess 6280] [ThreadPoolExecutor-0_0 11956]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:42:47,244 [MainProcess 6280] [ThreadPoolExecutor-0_1 13216]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 16:42:50,246 [MainProcess 6280] [ThreadPoolExecutor-0_2 31820]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&lt;class 'concurrent.futures._base.DoneAndNotDoneFutures'&gt; DoneAndNotDoneFutures(done={&lt;Future at 0x2616c5d4830 state=finished returned tuple&gt;, &lt;Future at 0x2616c7fee40 state=finished returned tuple&gt;, &lt;Future at 0x2616c78f250 state=finished returned tuple&gt;, &lt;Future at 0x2616c811480 state=finished returned tuple&gt;, &lt;Future at 0x2616c78f890 state=finished returned tuple&gt;, &lt;Future at 0x2616c811940 state=finished raised ZeroDivisionError&gt;}, not_done=set())</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">{&lt;Future at 0x2616c5d4830 state=finished returned tuple&gt;, &lt;Future at 0x2616c7fee40 state=finished returned tuple&gt;, &lt;Future at 0x2616c78f250 state=finished returned tuple&gt;, &lt;Future at 0x2616c811480 state=finished returned tuple&gt;, &lt;Future at 0x2616c78f890 state=finished returned tuple&gt;, &lt;Future at 0x2616c811940 state=finished raised ZeroDivisionError&gt;}</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">set()</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">==============================</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">(5, 5, 5)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">(0, 0, 0)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">(1, 1, 1)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">(3, 3, 3)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">(2, 2, 2)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">True</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">division by zero</span>
</pre>
</div>

<p>
as_completedæ–¹æ³•
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> concurrent.futures <span style="color: #a020f0;">import</span> ThreadPoolExecutor, wait, Future, as_completed
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">import</span> threading


<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s [%(processName)s %(process)d] [%(threadName)s %(thread)d]** %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(n):
    logging.info(<span style="color: #8b2252;">'start~~~~'</span>)
    time.sleep(n)
    logging.info(<span style="color: #8b2252;">'finished'</span>)
    <span style="color: #a020f0;">return</span> n, n, n

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#32447;&#31243;&#27744;&#65292;&#27744;&#23481;&#37327;&#20026;3</span>
<span style="color: #a0522d;">executor</span> = ThreadPoolExecutor(3)
time.sleep(1)
<span style="color: #483d8b;">print</span>(threading.<span style="color: #483d8b;">enumerate</span>())

<span style="color: #a0522d;">fs</span> = []
<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> (3, 6, 9, 15, 20, 25):
    <span style="color: #a0522d;">f</span> = executor.submit(worker, i) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20219;&#21153;&#25552;&#20132;&#21518;&#31435;&#21363;&#21551;&#21160;</span>
    fs.append(f)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'*'</span> * 30)

<span style="color: #b22222;">#</span><span style="color: #b22222;">as_completed</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(as_completed(fs), '+++') #&#29983;&#25104;&#22120;</span>
<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> as_completed(fs): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38459;&#22622;&#21040;</span>
    logging.info(<span style="color: #8b2252;">'{} {} {}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">type</span>(x), x, x.result()))

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">[&lt;_MainThread(MainThread, started 3836)&gt;]</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:04:33,893 [MainProcess 30716] [ThreadPoolExecutor-0_0 28676]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:04:33,894 [MainProcess 30716] [ThreadPoolExecutor-0_1 30972]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:04:33,894 [MainProcess 30716] [ThreadPoolExecutor-0_2 26244]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">******************************</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:04:36,894 [MainProcess 30716] [ThreadPoolExecutor-0_0 28676]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:04:36,894 [MainProcess 30716] [ThreadPoolExecutor-0_0 28676]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:04:36,895 [MainProcess 30716] [MainThread 3836]** &lt;class 'concurrent.futures._base.Future'&gt; &lt;Future at 0x1dae708ee40 state=finished returned tuple&gt; (3, 3, 3)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:04:39,894 [MainProcess 30716] [ThreadPoolExecutor-0_1 30972]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:04:39,895 [MainProcess 30716] [ThreadPoolExecutor-0_1 30972]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:04:39,895 [MainProcess 30716] [MainThread 3836]** &lt;class 'concurrent.futures._base.Future'&gt; &lt;Future at 0x1dae701f250 state=finished returned tuple&gt; (6, 6, 6)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:04:42,894 [MainProcess 30716] [ThreadPoolExecutor-0_2 26244]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:04:42,895 [MainProcess 30716] [ThreadPoolExecutor-0_2 26244]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:04:42,896 [MainProcess 30716] [MainThread 3836]** &lt;class 'concurrent.futures._base.Future'&gt; &lt;Future at 0x1dae701f890 state=finished returned tuple&gt; (9, 9, 9)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:04:51,896 [MainProcess 30716] [ThreadPoolExecutor-0_0 28676]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:04:51,896 [MainProcess 30716] [MainThread 3836]** &lt;class 'concurrent.futures._base.Future'&gt; &lt;Future at 0x1dae70a15b0 state=finished returned tuple&gt; (15, 15, 15)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:04:59,895 [MainProcess 30716] [ThreadPoolExecutor-0_1 30972]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:04:59,896 [MainProcess 30716] [MainThread 3836]** &lt;class 'concurrent.futures._base.Future'&gt; &lt;Future at 0x1dae70a1a70 state=finished returned tuple&gt; (20, 20, 20)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:05:07,896 [MainProcess 30716] [ThreadPoolExecutor-0_2 26244]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:05:07,897 [MainProcess 30716] [MainThread 3836]** &lt;class 'concurrent.futures._base.Future'&gt; &lt;Future at 0x1dae6e64830 state=finished returned tuple&gt; (25, 25, 25)</span>
</pre>
</div>

<p>
ç”¨as_completedå¤šäº›ã€‚
</p>

<p>
çº¿ç¨‹æ± ä¸€æ—¦åˆ›å»ºäº†çº¿ç¨‹ï¼Œå°±ä¸éœ€è¦é¢‘ç¹æ¸…é™¤
</p>
</div>
</div>
<div id="outline-container-h:33a732a2-b3c8-44d9-9fbd-27f669ffc8f6" class="outline-4">
<h4 id="h:33a732a2-b3c8-44d9-9fbd-27f669ffc8f6">ProcessPoolExecutorå¯¹è±¡</h4>
<div class="outline-text-4" id="text-h:33a732a2-b3c8-44d9-9fbd-27f669ffc8f6">
<p>
æ–¹æ³•ä¸€æ ·ï¼Œå°±æ˜¯ä½¿ç”¨å¤šè¿›ç¨‹å®Œæˆ
</p>

<p>
ProcessPoolExecutorä¾‹å­
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> concurrent.futures <span style="color: #a020f0;">import</span> wait, Future, as_completed, ProcessPoolExecutor
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">import</span> threading


<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s [%(processName)s %(process)d] [%(threadName)s %(thread)d]** %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(n):
    logging.info(<span style="color: #8b2252;">'start~~~~'</span>)
    time.sleep(n)
    logging.info(<span style="color: #8b2252;">'finished'</span>)
    <span style="color: #a020f0;">return</span> n, n, n

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:

    <span style="color: #a0522d;">executor</span> = ProcessPoolExecutor(3)
    <span style="color: #a020f0;">with</span> executor:
        time.sleep(1)
        <span style="color: #483d8b;">print</span>(threading.<span style="color: #483d8b;">enumerate</span>())

        <span style="color: #a0522d;">fs</span> = []
        <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> (3, 6, 9, 15, 20, 25):
            <span style="color: #a0522d;">f</span> = executor.submit(worker, i) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20219;&#21153;&#25552;&#20132;&#21518;&#31435;&#21363;&#21551;&#21160;</span>
            fs.append(f)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'*'</span> * 30)

        <span style="color: #b22222;">#</span><span style="color: #b22222;">as_completed</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">print(as_completed(fs), '+++') #&#29983;&#25104;&#22120;</span>
        <span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> as_completed(fs): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38459;&#22622;&#21040;</span>
            logging.info(<span style="color: #8b2252;">'{} {} {}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">type</span>(x), x, x.result()))

        <span style="color: #b22222;"># </span><span style="color: #b22222;">executor.shutdown()</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#32467;&#26524;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">[&lt;_MainThread(MainThread, started 4196)&gt;]</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">******************************</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:06:49,258 [SpawnProcess-1 25644] [MainThread 30572]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:06:49,270 [SpawnProcess-2 9548] [MainThread 31708]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:06:49,285 [SpawnProcess-3 29000] [MainThread 22776]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:06:52,259 [SpawnProcess-1 25644] [MainThread 30572]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:06:52,260 [SpawnProcess-1 25644] [MainThread 30572]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:06:52,260 [MainProcess 2824] [MainThread 4196]** &lt;class 'concurrent.futures._base.Future'&gt; &lt;Future at 0x130612078c0 state=finished returned tuple&gt; (3, 3, 3)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:06:55,271 [SpawnProcess-2 9548] [MainThread 31708]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:06:55,271 [SpawnProcess-2 9548] [MainThread 31708]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:06:55,271 [MainProcess 2824] [MainThread 4196]** &lt;class 'concurrent.futures._base.Future'&gt; &lt;Future at 0x1306120bed0 state=finished returned tuple&gt; (6, 6, 6)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:06:58,286 [SpawnProcess-3 29000] [MainThread 22776]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:06:58,287 [SpawnProcess-3 29000] [MainThread 22776]** start~~~~</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:06:58,287 [MainProcess 2824] [MainThread 4196]** &lt;class 'concurrent.futures._base.Future'&gt; &lt;Future at 0x13061370690 state=finished returned tuple&gt; (9, 9, 9)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:07:07,260 [SpawnProcess-1 25644] [MainThread 30572]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:07:07,261 [MainProcess 2824] [MainThread 4196]** &lt;class 'concurrent.futures._base.Future'&gt; &lt;Future at 0x13061263820 state=finished returned tuple&gt; (15, 15, 15)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:07:15,271 [SpawnProcess-2 9548] [MainThread 31708]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:07:15,273 [MainProcess 2824] [MainThread 4196]** &lt;class 'concurrent.futures._base.Future'&gt; &lt;Future at 0x13061263a80 state=finished returned tuple&gt; (20, 20, 20)</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:07:23,288 [SpawnProcess-3 29000] [MainThread 22776]** finished</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2025-03-11 17:07:23,289 [MainProcess 2824] [MainThread 4196]** &lt;class 'concurrent.futures._base.Future'&gt; &lt;Future at 0x13061344170 state=finished returned tuple&gt; (25, 25, 25)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:7d9a2214-9d22-4c7e-a28e-2a5882065f7c" class="outline-4">
<h4 id="h:7d9a2214-9d22-4c7e-a28e-2a5882065f7c">æ”¯æŒä¸Šä¸‹æ–‡ç®¡ç†</h4>
<div class="outline-text-4" id="text-h:7d9a2214-9d22-4c7e-a28e-2a5882065f7c">
<ul class="org-ul">
<li>concurrent.futures.ProcessPoolExecutorç»§æ‰¿è‡ªconcurrent.futures._base.Executorï¼Œè€Œçˆ¶ç±»æœ‰__enter__ ã€__exit__æ–¹æ³•ï¼Œæ”¯æŒä¸Šä¸‹æ–‡ç®¡ç†ã€‚å¯ä»¥ä½¿ç”¨withè¯­å¥</li>
<li>__exit__æ–¹æ³•æœ¬è´¨è¿˜æ˜¯è°ƒç”¨çš„shutdown(wait=True)ï¼Œå°±æ˜¯ä¸€ç›´é˜»å¡åˆ°æ‰€æœ‰è¿è¡Œçš„ä»»åŠ¡å®Œæˆ</li>
</ul>


<p>
ä½¿ç”¨ä¸Šä¸‹æ–‡æ”¹é€ ä¸Šé¢çš„ä¾‹å­ï¼Œå¢åŠ è¿”å›è®¡ç®—çš„ç»“æœ
</p>
</div>
</div>
<div id="outline-container-h:c035ffe3-5512-4681-830a-54af10231f88" class="outline-4">
<h4 id="h:c035ffe3-5512-4681-830a-54af10231f88">æ€»ç»“</h4>
<div class="outline-text-4" id="text-h:c035ffe3-5512-4681-830a-54af10231f88">
<ul class="org-ul">
<li>è¯¥åº“ç»Ÿä¸€äº†çº¿ç¨‹æ± ã€è¿›ç¨‹æ± è°ƒç”¨ï¼Œç®€åŒ–äº†ç¼–ç¨‹ã€‚</li>
<li>æ˜¯Pythonç®€å•çš„æ€æƒ³å“²å­¦çš„ä½“ç°ã€‚</li>
<li>å”¯ä¸€çš„ç¼ºç‚¹ï¼šæ— æ³•è®¾ç½®çº¿ç¨‹åç§°ã€‚ä½†è¿™éƒ½ä¸å€¼ä¸€æã€‚</li>
</ul>
</div>
</div>
</div>
</section>
</main class="container">
<footer id="postamble" class="status">
<footer data-astro-cid-sz7xmlte data-turbo-permanent id=rootFooter>
    <script>
        const shuffle = e => e.map((e => ({
            v: e,
            sort: Math.random()
        }))).sort(( (e, o) => e.sort - o.sort)).map(( ({v: e}) => e));
        var songList = ["barbie-girl--stantough", "blue-da-ba-dee--cornelius-link", "hips-dont-lie--stantough", "i-want-it-that-way--stantough", "seven-nation-army--stantough", "smooth-criminal--stantough"]
          , songOrder = songOrder ?? shuffle(songList).map((e => `/audio/music/${e}.opus`))
          , song = new Audio(songOrder[0])
          , nextSong = new Audio(songOrder[1])
          , songIndex = 2
          , musicWrapper = void 0
          , arrow = void 0
          , notes = void 0;
        song.addEventListener("ended", next);
        const toggle = () => song.paused ? play() : pause();
        function play() {
            song.play(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.add("shakeManHorse"),
            notes.classList.remove("hideNotes")
        }
        function pause() {
            song.pause(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.remove("shakeManHorse"),
            notes.classList.add("hideNotes")
        }
        function next() {
            song = nextSong,
            play(),
            songIndex === songOrder.length && (songIndex = 0),
            nextSong = new Audio(songOrder[songIndex]),
            songIndex += 1
        }
        function skip() {
            pause(),
            (arrow = arrow || document.getElementById("musicArrow")).classList.add("shootArrow");
            new Audio("/audio/effects/ohno.m4a").play(),
            arrow.addEventListener("animationend", arrowShootHandler, !1)
        }
        function arrowShootHandler() {
            arrow.removeEventListener("animationend", arrowShootHandler, !1),
            arrow.classList.remove("shootArrow");
            new Audio("/audio/effects/heythathurt.m4a").play(),
            next()
        }
    </script>
    <div id=musicPlayer data-astro-cid-q7a5pyro>
        <button class=skip data-astro-cid-q7a5pyro onclick=skip() title="Skip song">
            <div id=skipWrapper data-astro-cid-q7a5pyro>
                <img alt="Medieval drollery of a man/snail/bat/monkey shooting an arrow" class=archer decoding=async height=334 loading=lazy src=/images/archer-no-arrow.448ccd8b_Z1KfRYq.webp width=226 data-astro-cid-q7a5pyro>
                <img alt="Arrow for archer" class="arrow complete" decoding=async height=23 loading=lazy src=/images/no-archer-full-arrow.87aa9971_Z2qL2KO.webp width=141 data-astro-cid-q7a5pyro id=musicArrow>
            </div>
        </button>
        <button class=playPause data-astro-cid-q7a5pyro onclick=toggle() title="Play/pause song">
            <div id=musicWrapper data-astro-cid-q7a5pyro>
                <div class=hideNotes id=notesWrapper data-astro-cid-q7a5pyro>
                    <div class=lyreNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                    <div class=fluteNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                </div>
                <img alt="Medieval drollery of a man/horse playing a lyre and a horn" class=manHorse decoding=async height=665 loading=lazy src=/images/man-horse-band.e3a2efcf_q8FCa.webp width=531 data-astro-cid-q7a5pyro>
            </div>
        </button>
    </div>
    <hr data-astro-cid-sz7xmlte>
    <div class=salutation data-astro-cid-gdmrbrho>
        <p data-astro-cid-gdmrbrho>
            <span class=flower2 data-astro-cid-gdmrbrho>A</span>
            <span class=smallcap data-astro-cid-gdmrbrho>pax vobiscum</span>
            <span class="flower2 wiggle" data-astro-cid-gdmrbrho id=leaf>a</span>
        </p>
    </div>
    <script>
        function animateLeafBlownHandler() {
            leaf.removeEventListener("animationend", animateLeafBlownHandler, !1),
            leaf.classList.remove("blownAway"),
            leaf.classList.add("wiggle")
        }
        function animateLeaf() {
            leaf = leaf ?? document.getElementById("leaf"),
            leaf.classList.remove("wiggle"),
            leaf.classList.add("blownAway"),
            leaf.addEventListener("animationend", animateLeafBlownHandler, !1)
        }
        document.getElementById("leaf").onclick = animateLeaf
    </script>


    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>æ‰“èµ</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Â© 2024 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
</footer>
</footer>
</body>
</html>
